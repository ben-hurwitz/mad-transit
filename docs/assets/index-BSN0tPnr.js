function Bb(Z,ce){for(var de=0;de<ce.length;de++){const ue=ce[de];if(typeof ue!="string"&&!Array.isArray(ue)){for(const Ae in ue)if(Ae!=="default"&&!(Ae in Z)){const Ce=Object.getOwnPropertyDescriptor(ue,Ae);Ce&&Object.defineProperty(Z,Ae,Ce.get?Ce:{enumerable:!0,get:()=>ue[Ae]})}}}return Object.freeze(Object.defineProperty(Z,Symbol.toStringTag,{value:"Module"}))}(function(){const ce=document.createElement("link").relList;if(ce&&ce.supports&&ce.supports("modulepreload"))return;for(const Ae of document.querySelectorAll('link[rel="modulepreload"]'))ue(Ae);new MutationObserver(Ae=>{for(const Ce of Ae)if(Ce.type==="childList")for(const se of Ce.addedNodes)se.tagName==="LINK"&&se.rel==="modulepreload"&&ue(se)}).observe(document,{childList:!0,subtree:!0});function de(Ae){const Ce={};return Ae.integrity&&(Ce.integrity=Ae.integrity),Ae.referrerPolicy&&(Ce.referrerPolicy=Ae.referrerPolicy),Ae.crossOrigin==="use-credentials"?Ce.credentials="include":Ae.crossOrigin==="anonymous"?Ce.credentials="omit":Ce.credentials="same-origin",Ce}function ue(Ae){if(Ae.ep)return;Ae.ep=!0;const Ce=de(Ae);fetch(Ae.href,Ce)}})();function iy(Z){return Z&&Z.__esModule&&Object.prototype.hasOwnProperty.call(Z,"default")?Z.default:Z}var J0={exports:{}},Kg={};var eb;function mT(){if(eb)return Kg;eb=1;var Z=Symbol.for("react.transitional.element"),ce=Symbol.for("react.fragment");function de(ue,Ae,Ce){var se=null;if(Ce!==void 0&&(se=""+Ce),Ae.key!==void 0&&(se=""+Ae.key),"key"in Ae){Ce={};for(var n in Ae)n!=="key"&&(Ce[n]=Ae[n])}else Ce=Ae;return Ae=Ce.ref,{$$typeof:Z,type:ue,key:se,ref:Ae!==void 0?Ae:null,props:Ce}}return Kg.Fragment=ce,Kg.jsx=de,Kg.jsxs=de,Kg}var tb;function _T(){return tb||(tb=1,J0.exports=mT()),J0.exports}var he=_T(),Q0={exports:{}},ps={};var ib;function gT(){if(ib)return ps;ib=1;var Z=Symbol.for("react.transitional.element"),ce=Symbol.for("react.portal"),de=Symbol.for("react.fragment"),ue=Symbol.for("react.strict_mode"),Ae=Symbol.for("react.profiler"),Ce=Symbol.for("react.consumer"),se=Symbol.for("react.context"),n=Symbol.for("react.forward_ref"),ke=Symbol.for("react.suspense"),Fe=Symbol.for("react.memo"),pt=Symbol.for("react.lazy"),it=Symbol.for("react.activity"),ht=Symbol.iterator;function Ci(Et){return Et===null||typeof Et!="object"?null:(Et=ht&&Et[ht]||Et["@@iterator"],typeof Et=="function"?Et:null)}var Ui={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Vi=Object.assign,qi={};function on(Et,di,mi){this.props=Et,this.context=di,this.refs=qi,this.updater=mi||Ui}on.prototype.isReactComponent={},on.prototype.setState=function(Et,di){if(typeof Et!="object"&&typeof Et!="function"&&Et!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Et,di,"setState")},on.prototype.forceUpdate=function(Et){this.updater.enqueueForceUpdate(this,Et,"forceUpdate")};function Ai(){}Ai.prototype=on.prototype;function an(Et,di,mi){this.props=Et,this.context=di,this.refs=qi,this.updater=mi||Ui}var Un=an.prototype=new Ai;Un.constructor=an,Vi(Un,on.prototype),Un.isPureReactComponent=!0;var rr=Array.isArray;function ln(){}var mn={H:null,A:null,T:null,S:null},Pt=Object.prototype.hasOwnProperty;function Bt(Et,di,mi){var vn=mi.ref;return{$$typeof:Z,type:Et,key:di,ref:vn!==void 0?vn:null,props:mi}}function Ni(Et,di){return Bt(Et.type,di,Et.props)}function tn(Et){return typeof Et=="object"&&Et!==null&&Et.$$typeof===Z}function Li(Et){var di={"=":"=0",":":"=2"};return"$"+Et.replace(/[=:]/g,function(mi){return di[mi]})}var Wi=/\/+/g;function cr(Et,di){return typeof Et=="object"&&Et!==null&&Et.key!=null?Li(""+Et.key):di.toString(36)}function Pr(Et){switch(Et.status){case"fulfilled":return Et.value;case"rejected":throw Et.reason;default:switch(typeof Et.status=="string"?Et.then(ln,ln):(Et.status="pending",Et.then(function(di){Et.status==="pending"&&(Et.status="fulfilled",Et.value=di)},function(di){Et.status==="pending"&&(Et.status="rejected",Et.reason=di)})),Et.status){case"fulfilled":return Et.value;case"rejected":throw Et.reason}}throw Et}function si(Et,di,mi,vn,tr){var vr=typeof Et;(vr==="undefined"||vr==="boolean")&&(Et=null);var Gr=!1;if(Et===null)Gr=!0;else switch(vr){case"bigint":case"string":case"number":Gr=!0;break;case"object":switch(Et.$$typeof){case Z:case ce:Gr=!0;break;case pt:return Gr=Et._init,si(Gr(Et._payload),di,mi,vn,tr)}}if(Gr)return tr=tr(Et),Gr=vn===""?"."+cr(Et,0):vn,rr(tr)?(mi="",Gr!=null&&(mi=Gr.replace(Wi,"$&/")+"/"),si(tr,di,mi,"",function(Lr){return Lr})):tr!=null&&(tn(tr)&&(tr=Ni(tr,mi+(tr.key==null||Et&&Et.key===tr.key?"":(""+tr.key).replace(Wi,"$&/")+"/")+Gr)),di.push(tr)),1;Gr=0;var gr=vn===""?".":vn+":";if(rr(Et))for(var In=0;In<Et.length;In++)vn=Et[In],vr=gr+cr(vn,In),Gr+=si(vn,di,mi,vr,tr);else if(In=Ci(Et),typeof In=="function")for(Et=In.call(Et),In=0;!(vn=Et.next()).done;)vn=vn.value,vr=gr+cr(vn,In++),Gr+=si(vn,di,mi,vr,tr);else if(vr==="object"){if(typeof Et.then=="function")return si(Pr(Et),di,mi,vn,tr);throw di=String(Et),Error("Objects are not valid as a React child (found: "+(di==="[object Object]"?"object with keys {"+Object.keys(Et).join(", ")+"}":di)+"). If you meant to render a collection of children, use an array instead.")}return Gr}function xi(Et,di,mi){if(Et==null)return Et;var vn=[],tr=0;return si(Et,vn,"","",function(vr){return di.call(mi,vr,tr++)}),vn}function Tn(Et){if(Et._status===-1){var di=Et._result;di=di(),di.then(function(mi){(Et._status===0||Et._status===-1)&&(Et._status=1,Et._result=mi)},function(mi){(Et._status===0||Et._status===-1)&&(Et._status=2,Et._result=mi)}),Et._status===-1&&(Et._status=0,Et._result=di)}if(Et._status===1)return Et._result.default;throw Et._result}var zn=typeof reportError=="function"?reportError:function(Et){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var di=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Et=="object"&&Et!==null&&typeof Et.message=="string"?String(Et.message):String(Et),error:Et});if(!window.dispatchEvent(di))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Et);return}console.error(Et)},Er={map:xi,forEach:function(Et,di,mi){xi(Et,function(){di.apply(this,arguments)},mi)},count:function(Et){var di=0;return xi(Et,function(){di++}),di},toArray:function(Et){return xi(Et,function(di){return di})||[]},only:function(Et){if(!tn(Et))throw Error("React.Children.only expected to receive a single React element child.");return Et}};return ps.Activity=it,ps.Children=Er,ps.Component=on,ps.Fragment=de,ps.Profiler=Ae,ps.PureComponent=an,ps.StrictMode=ue,ps.Suspense=ke,ps.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=mn,ps.__COMPILER_RUNTIME={__proto__:null,c:function(Et){return mn.H.useMemoCache(Et)}},ps.cache=function(Et){return function(){return Et.apply(null,arguments)}},ps.cacheSignal=function(){return null},ps.cloneElement=function(Et,di,mi){if(Et==null)throw Error("The argument must be a React element, but you passed "+Et+".");var vn=Vi({},Et.props),tr=Et.key;if(di!=null)for(vr in di.key!==void 0&&(tr=""+di.key),di)!Pt.call(di,vr)||vr==="key"||vr==="__self"||vr==="__source"||vr==="ref"&&di.ref===void 0||(vn[vr]=di[vr]);var vr=arguments.length-2;if(vr===1)vn.children=mi;else if(1<vr){for(var Gr=Array(vr),gr=0;gr<vr;gr++)Gr[gr]=arguments[gr+2];vn.children=Gr}return Bt(Et.type,tr,vn)},ps.createContext=function(Et){return Et={$$typeof:se,_currentValue:Et,_currentValue2:Et,_threadCount:0,Provider:null,Consumer:null},Et.Provider=Et,Et.Consumer={$$typeof:Ce,_context:Et},Et},ps.createElement=function(Et,di,mi){var vn,tr={},vr=null;if(di!=null)for(vn in di.key!==void 0&&(vr=""+di.key),di)Pt.call(di,vn)&&vn!=="key"&&vn!=="__self"&&vn!=="__source"&&(tr[vn]=di[vn]);var Gr=arguments.length-2;if(Gr===1)tr.children=mi;else if(1<Gr){for(var gr=Array(Gr),In=0;In<Gr;In++)gr[In]=arguments[In+2];tr.children=gr}if(Et&&Et.defaultProps)for(vn in Gr=Et.defaultProps,Gr)tr[vn]===void 0&&(tr[vn]=Gr[vn]);return Bt(Et,vr,tr)},ps.createRef=function(){return{current:null}},ps.forwardRef=function(Et){return{$$typeof:n,render:Et}},ps.isValidElement=tn,ps.lazy=function(Et){return{$$typeof:pt,_payload:{_status:-1,_result:Et},_init:Tn}},ps.memo=function(Et,di){return{$$typeof:Fe,type:Et,compare:di===void 0?null:di}},ps.startTransition=function(Et){var di=mn.T,mi={};mn.T=mi;try{var vn=Et(),tr=mn.S;tr!==null&&tr(mi,vn),typeof vn=="object"&&vn!==null&&typeof vn.then=="function"&&vn.then(ln,zn)}catch(vr){zn(vr)}finally{di!==null&&mi.types!==null&&(di.types=mi.types),mn.T=di}},ps.unstable_useCacheRefresh=function(){return mn.H.useCacheRefresh()},ps.use=function(Et){return mn.H.use(Et)},ps.useActionState=function(Et,di,mi){return mn.H.useActionState(Et,di,mi)},ps.useCallback=function(Et,di){return mn.H.useCallback(Et,di)},ps.useContext=function(Et){return mn.H.useContext(Et)},ps.useDebugValue=function(){},ps.useDeferredValue=function(Et,di){return mn.H.useDeferredValue(Et,di)},ps.useEffect=function(Et,di){return mn.H.useEffect(Et,di)},ps.useEffectEvent=function(Et){return mn.H.useEffectEvent(Et)},ps.useId=function(){return mn.H.useId()},ps.useImperativeHandle=function(Et,di,mi){return mn.H.useImperativeHandle(Et,di,mi)},ps.useInsertionEffect=function(Et,di){return mn.H.useInsertionEffect(Et,di)},ps.useLayoutEffect=function(Et,di){return mn.H.useLayoutEffect(Et,di)},ps.useMemo=function(Et,di){return mn.H.useMemo(Et,di)},ps.useOptimistic=function(Et,di){return mn.H.useOptimistic(Et,di)},ps.useReducer=function(Et,di,mi){return mn.H.useReducer(Et,di,mi)},ps.useRef=function(Et){return mn.H.useRef(Et)},ps.useState=function(Et){return mn.H.useState(Et)},ps.useSyncExternalStore=function(Et,di,mi){return mn.H.useSyncExternalStore(Et,di,mi)},ps.useTransition=function(){return mn.H.useTransition()},ps.version="19.2.0",ps}var nb;function pv(){return nb||(nb=1,Q0.exports=gT()),Q0.exports}var Tt=pv();const yT=iy(Tt);var ev={exports:{}},Jg={},tv={exports:{}},iv={};var rb;function vT(){return rb||(rb=1,(function(Z){function ce(si,xi){var Tn=si.length;si.push(xi);e:for(;0<Tn;){var zn=Tn-1>>>1,Er=si[zn];if(0<Ae(Er,xi))si[zn]=xi,si[Tn]=Er,Tn=zn;else break e}}function de(si){return si.length===0?null:si[0]}function ue(si){if(si.length===0)return null;var xi=si[0],Tn=si.pop();if(Tn!==xi){si[0]=Tn;e:for(var zn=0,Er=si.length,Et=Er>>>1;zn<Et;){var di=2*(zn+1)-1,mi=si[di],vn=di+1,tr=si[vn];if(0>Ae(mi,Tn))vn<Er&&0>Ae(tr,mi)?(si[zn]=tr,si[vn]=Tn,zn=vn):(si[zn]=mi,si[di]=Tn,zn=di);else if(vn<Er&&0>Ae(tr,Tn))si[zn]=tr,si[vn]=Tn,zn=vn;else break e}}return xi}function Ae(si,xi){var Tn=si.sortIndex-xi.sortIndex;return Tn!==0?Tn:si.id-xi.id}if(Z.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var Ce=performance;Z.unstable_now=function(){return Ce.now()}}else{var se=Date,n=se.now();Z.unstable_now=function(){return se.now()-n}}var ke=[],Fe=[],pt=1,it=null,ht=3,Ci=!1,Ui=!1,Vi=!1,qi=!1,on=typeof setTimeout=="function"?setTimeout:null,Ai=typeof clearTimeout=="function"?clearTimeout:null,an=typeof setImmediate<"u"?setImmediate:null;function Un(si){for(var xi=de(Fe);xi!==null;){if(xi.callback===null)ue(Fe);else if(xi.startTime<=si)ue(Fe),xi.sortIndex=xi.expirationTime,ce(ke,xi);else break;xi=de(Fe)}}function rr(si){if(Vi=!1,Un(si),!Ui)if(de(ke)!==null)Ui=!0,ln||(ln=!0,Li());else{var xi=de(Fe);xi!==null&&Pr(rr,xi.startTime-si)}}var ln=!1,mn=-1,Pt=5,Bt=-1;function Ni(){return qi?!0:!(Z.unstable_now()-Bt<Pt)}function tn(){if(qi=!1,ln){var si=Z.unstable_now();Bt=si;var xi=!0;try{e:{Ui=!1,Vi&&(Vi=!1,Ai(mn),mn=-1),Ci=!0;var Tn=ht;try{t:{for(Un(si),it=de(ke);it!==null&&!(it.expirationTime>si&&Ni());){var zn=it.callback;if(typeof zn=="function"){it.callback=null,ht=it.priorityLevel;var Er=zn(it.expirationTime<=si);if(si=Z.unstable_now(),typeof Er=="function"){it.callback=Er,Un(si),xi=!0;break t}it===de(ke)&&ue(ke),Un(si)}else ue(ke);it=de(ke)}if(it!==null)xi=!0;else{var Et=de(Fe);Et!==null&&Pr(rr,Et.startTime-si),xi=!1}}break e}finally{it=null,ht=Tn,Ci=!1}xi=void 0}}finally{xi?Li():ln=!1}}}var Li;if(typeof an=="function")Li=function(){an(tn)};else if(typeof MessageChannel<"u"){var Wi=new MessageChannel,cr=Wi.port2;Wi.port1.onmessage=tn,Li=function(){cr.postMessage(null)}}else Li=function(){on(tn,0)};function Pr(si,xi){mn=on(function(){si(Z.unstable_now())},xi)}Z.unstable_IdlePriority=5,Z.unstable_ImmediatePriority=1,Z.unstable_LowPriority=4,Z.unstable_NormalPriority=3,Z.unstable_Profiling=null,Z.unstable_UserBlockingPriority=2,Z.unstable_cancelCallback=function(si){si.callback=null},Z.unstable_forceFrameRate=function(si){0>si||125<si?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Pt=0<si?Math.floor(1e3/si):5},Z.unstable_getCurrentPriorityLevel=function(){return ht},Z.unstable_next=function(si){switch(ht){case 1:case 2:case 3:var xi=3;break;default:xi=ht}var Tn=ht;ht=xi;try{return si()}finally{ht=Tn}},Z.unstable_requestPaint=function(){qi=!0},Z.unstable_runWithPriority=function(si,xi){switch(si){case 1:case 2:case 3:case 4:case 5:break;default:si=3}var Tn=ht;ht=si;try{return xi()}finally{ht=Tn}},Z.unstable_scheduleCallback=function(si,xi,Tn){var zn=Z.unstable_now();switch(typeof Tn=="object"&&Tn!==null?(Tn=Tn.delay,Tn=typeof Tn=="number"&&0<Tn?zn+Tn:zn):Tn=zn,si){case 1:var Er=-1;break;case 2:Er=250;break;case 5:Er=1073741823;break;case 4:Er=1e4;break;default:Er=5e3}return Er=Tn+Er,si={id:pt++,callback:xi,priorityLevel:si,startTime:Tn,expirationTime:Er,sortIndex:-1},Tn>zn?(si.sortIndex=Tn,ce(Fe,si),de(ke)===null&&si===de(Fe)&&(Vi?(Ai(mn),mn=-1):Vi=!0,Pr(rr,Tn-zn))):(si.sortIndex=Er,ce(ke,si),Ui||Ci||(Ui=!0,ln||(ln=!0,Li()))),si},Z.unstable_shouldYield=Ni,Z.unstable_wrapCallback=function(si){var xi=ht;return function(){var Tn=ht;ht=xi;try{return si.apply(this,arguments)}finally{ht=Tn}}}})(iv)),iv}var ab;function xT(){return ab||(ab=1,tv.exports=vT()),tv.exports}var nv={exports:{}},Td={};var sb;function bT(){if(sb)return Td;sb=1;var Z=pv();function ce(ke){var Fe="https://react.dev/errors/"+ke;if(1<arguments.length){Fe+="?args[]="+encodeURIComponent(arguments[1]);for(var pt=2;pt<arguments.length;pt++)Fe+="&args[]="+encodeURIComponent(arguments[pt])}return"Minified React error #"+ke+"; visit "+Fe+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function de(){}var ue={d:{f:de,r:function(){throw Error(ce(522))},D:de,C:de,L:de,m:de,X:de,S:de,M:de},p:0,findDOMNode:null},Ae=Symbol.for("react.portal");function Ce(ke,Fe,pt){var it=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ae,key:it==null?null:""+it,children:ke,containerInfo:Fe,implementation:pt}}var se=Z.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function n(ke,Fe){if(ke==="font")return"";if(typeof Fe=="string")return Fe==="use-credentials"?Fe:""}return Td.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ue,Td.createPortal=function(ke,Fe){var pt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Fe||Fe.nodeType!==1&&Fe.nodeType!==9&&Fe.nodeType!==11)throw Error(ce(299));return Ce(ke,Fe,null,pt)},Td.flushSync=function(ke){var Fe=se.T,pt=ue.p;try{if(se.T=null,ue.p=2,ke)return ke()}finally{se.T=Fe,ue.p=pt,ue.d.f()}},Td.preconnect=function(ke,Fe){typeof ke=="string"&&(Fe?(Fe=Fe.crossOrigin,Fe=typeof Fe=="string"?Fe==="use-credentials"?Fe:"":void 0):Fe=null,ue.d.C(ke,Fe))},Td.prefetchDNS=function(ke){typeof ke=="string"&&ue.d.D(ke)},Td.preinit=function(ke,Fe){if(typeof ke=="string"&&Fe&&typeof Fe.as=="string"){var pt=Fe.as,it=n(pt,Fe.crossOrigin),ht=typeof Fe.integrity=="string"?Fe.integrity:void 0,Ci=typeof Fe.fetchPriority=="string"?Fe.fetchPriority:void 0;pt==="style"?ue.d.S(ke,typeof Fe.precedence=="string"?Fe.precedence:void 0,{crossOrigin:it,integrity:ht,fetchPriority:Ci}):pt==="script"&&ue.d.X(ke,{crossOrigin:it,integrity:ht,fetchPriority:Ci,nonce:typeof Fe.nonce=="string"?Fe.nonce:void 0})}},Td.preinitModule=function(ke,Fe){if(typeof ke=="string")if(typeof Fe=="object"&&Fe!==null){if(Fe.as==null||Fe.as==="script"){var pt=n(Fe.as,Fe.crossOrigin);ue.d.M(ke,{crossOrigin:pt,integrity:typeof Fe.integrity=="string"?Fe.integrity:void 0,nonce:typeof Fe.nonce=="string"?Fe.nonce:void 0})}}else Fe==null&&ue.d.M(ke)},Td.preload=function(ke,Fe){if(typeof ke=="string"&&typeof Fe=="object"&&Fe!==null&&typeof Fe.as=="string"){var pt=Fe.as,it=n(pt,Fe.crossOrigin);ue.d.L(ke,pt,{crossOrigin:it,integrity:typeof Fe.integrity=="string"?Fe.integrity:void 0,nonce:typeof Fe.nonce=="string"?Fe.nonce:void 0,type:typeof Fe.type=="string"?Fe.type:void 0,fetchPriority:typeof Fe.fetchPriority=="string"?Fe.fetchPriority:void 0,referrerPolicy:typeof Fe.referrerPolicy=="string"?Fe.referrerPolicy:void 0,imageSrcSet:typeof Fe.imageSrcSet=="string"?Fe.imageSrcSet:void 0,imageSizes:typeof Fe.imageSizes=="string"?Fe.imageSizes:void 0,media:typeof Fe.media=="string"?Fe.media:void 0})}},Td.preloadModule=function(ke,Fe){if(typeof ke=="string")if(Fe){var pt=n(Fe.as,Fe.crossOrigin);ue.d.m(ke,{as:typeof Fe.as=="string"&&Fe.as!=="script"?Fe.as:void 0,crossOrigin:pt,integrity:typeof Fe.integrity=="string"?Fe.integrity:void 0})}else ue.d.m(ke)},Td.requestFormReset=function(ke){ue.d.r(ke)},Td.unstable_batchedUpdates=function(ke,Fe){return ke(Fe)},Td.useFormState=function(ke,Fe,pt){return se.H.useFormState(ke,Fe,pt)},Td.useFormStatus=function(){return se.H.useHostTransitionStatus()},Td.version="19.2.0",Td}var ob;function Nb(){if(ob)return nv.exports;ob=1;function Z(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Z)}catch(ce){console.error(ce)}}return Z(),nv.exports=bT(),nv.exports}var lb;function wT(){if(lb)return Jg;lb=1;var Z=xT(),ce=pv(),de=Nb();function ue(c){var m="https://react.dev/errors/"+c;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)m+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+c+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Ae(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function Ce(c){var m=c,w=c;if(c.alternate)for(;m.return;)m=m.return;else{c=m;do m=c,(m.flags&4098)!==0&&(w=m.return),c=m.return;while(c)}return m.tag===3?w:null}function se(c){if(c.tag===13){var m=c.memoizedState;if(m===null&&(c=c.alternate,c!==null&&(m=c.memoizedState)),m!==null)return m.dehydrated}return null}function n(c){if(c.tag===31){var m=c.memoizedState;if(m===null&&(c=c.alternate,c!==null&&(m=c.memoizedState)),m!==null)return m.dehydrated}return null}function ke(c){if(Ce(c)!==c)throw Error(ue(188))}function Fe(c){var m=c.alternate;if(!m){if(m=Ce(c),m===null)throw Error(ue(188));return m!==c?null:c}for(var w=c,R=m;;){var G=w.return;if(G===null)break;var Y=G.alternate;if(Y===null){if(R=G.return,R!==null){w=R;continue}break}if(G.child===Y.child){for(Y=G.child;Y;){if(Y===w)return ke(G),c;if(Y===R)return ke(G),m;Y=Y.sibling}throw Error(ue(188))}if(w.return!==R.return)w=G,R=Y;else{for(var be=!1,Qe=G.child;Qe;){if(Qe===w){be=!0,w=G,R=Y;break}if(Qe===R){be=!0,R=G,w=Y;break}Qe=Qe.sibling}if(!be){for(Qe=Y.child;Qe;){if(Qe===w){be=!0,w=Y,R=G;break}if(Qe===R){be=!0,R=Y,w=G;break}Qe=Qe.sibling}if(!be)throw Error(ue(189))}}if(w.alternate!==R)throw Error(ue(190))}if(w.tag!==3)throw Error(ue(188));return w.stateNode.current===w?c:m}function pt(c){var m=c.tag;if(m===5||m===26||m===27||m===6)return c;for(c=c.child;c!==null;){if(m=pt(c),m!==null)return m;c=c.sibling}return null}var it=Object.assign,ht=Symbol.for("react.element"),Ci=Symbol.for("react.transitional.element"),Ui=Symbol.for("react.portal"),Vi=Symbol.for("react.fragment"),qi=Symbol.for("react.strict_mode"),on=Symbol.for("react.profiler"),Ai=Symbol.for("react.consumer"),an=Symbol.for("react.context"),Un=Symbol.for("react.forward_ref"),rr=Symbol.for("react.suspense"),ln=Symbol.for("react.suspense_list"),mn=Symbol.for("react.memo"),Pt=Symbol.for("react.lazy"),Bt=Symbol.for("react.activity"),Ni=Symbol.for("react.memo_cache_sentinel"),tn=Symbol.iterator;function Li(c){return c===null||typeof c!="object"?null:(c=tn&&c[tn]||c["@@iterator"],typeof c=="function"?c:null)}var Wi=Symbol.for("react.client.reference");function cr(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===Wi?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case Vi:return"Fragment";case on:return"Profiler";case qi:return"StrictMode";case rr:return"Suspense";case ln:return"SuspenseList";case Bt:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case Ui:return"Portal";case an:return c.displayName||"Context";case Ai:return(c._context.displayName||"Context")+".Consumer";case Un:var m=c.render;return c=c.displayName,c||(c=m.displayName||m.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case mn:return m=c.displayName||null,m!==null?m:cr(c.type)||"Memo";case Pt:m=c._payload,c=c._init;try{return cr(c(m))}catch{}}return null}var Pr=Array.isArray,si=ce.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,xi=de.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Tn={pending:!1,data:null,method:null,action:null},zn=[],Er=-1;function Et(c){return{current:c}}function di(c){0>Er||(c.current=zn[Er],zn[Er]=null,Er--)}function mi(c,m){Er++,zn[Er]=c.current,c.current=m}var vn=Et(null),tr=Et(null),vr=Et(null),Gr=Et(null);function gr(c,m){switch(mi(vr,m),mi(tr,c),mi(vn,null),m.nodeType){case 9:case 11:c=(c=m.documentElement)&&(c=c.namespaceURI)?F(c):0;break;default:if(c=m.tagName,m=m.namespaceURI)m=F(m),c=O(m,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}di(vn),mi(vn,c)}function In(){di(vn),di(tr),di(vr)}function Lr(c){c.memoizedState!==null&&mi(Gr,c);var m=vn.current,w=O(m,c.type);m!==w&&(mi(tr,c),mi(vn,w))}function br(c){tr.current===c&&(di(vn),di(tr)),Gr.current===c&&(di(Gr),Cm._currentValue=Tn)}var ma,Kr;function oa(c){if(ma===void 0)try{throw Error()}catch(w){var m=w.stack.trim().match(/\n( *(at )?)/);ma=m&&m[1]||"",Kr=-1<w.stack.indexOf(`
    at`)?" (<anonymous>)":-1<w.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ma+c+Kr}var Ma=!1;function $t(c,m){if(!c||Ma)return"";Ma=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var R={DetermineComponentFrameRoot:function(){try{if(m){var hn=function(){throw Error()};if(Object.defineProperty(hn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(hn,[])}catch(Hi){var Oi=Hi}Reflect.construct(c,[],hn)}else{try{hn.call()}catch(Hi){Oi=Hi}c.call(hn.prototype)}}else{try{throw Error()}catch(Hi){Oi=Hi}(hn=c())&&typeof hn.catch=="function"&&hn.catch(function(){})}}catch(Hi){if(Hi&&Oi&&typeof Hi.stack=="string")return[Hi.stack,Oi.stack]}return[null,null]}};R.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var G=Object.getOwnPropertyDescriptor(R.DetermineComponentFrameRoot,"name");G&&G.configurable&&Object.defineProperty(R.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var Y=R.DetermineComponentFrameRoot(),be=Y[0],Qe=Y[1];if(be&&Qe){var Ot=be.split(`
`),Ri=Qe.split(`
`);for(G=R=0;R<Ot.length&&!Ot[R].includes("DetermineComponentFrameRoot");)R++;for(;G<Ri.length&&!Ri[G].includes("DetermineComponentFrameRoot");)G++;if(R===Ot.length||G===Ri.length)for(R=Ot.length-1,G=Ri.length-1;1<=R&&0<=G&&Ot[R]!==Ri[G];)G--;for(;1<=R&&0<=G;R--,G--)if(Ot[R]!==Ri[G]){if(R!==1||G!==1)do if(R--,G--,0>G||Ot[R]!==Ri[G]){var sn=`
`+Ot[R].replace(" at new "," at ");return c.displayName&&sn.includes("<anonymous>")&&(sn=sn.replace("<anonymous>",c.displayName)),sn}while(1<=R&&0<=G);break}}}finally{Ma=!1,Error.prepareStackTrace=w}return(w=c?c.displayName||c.name:"")?oa(w):""}function Va(c,m){switch(c.tag){case 26:case 27:case 5:return oa(c.type);case 16:return oa("Lazy");case 13:return c.child!==m&&m!==null?oa("Suspense Fallback"):oa("Suspense");case 19:return oa("SuspenseList");case 0:case 15:return $t(c.type,!1);case 11:return $t(c.type.render,!1);case 1:return $t(c.type,!0);case 31:return oa("Activity");default:return""}}function Ir(c){try{var m="",w=null;do m+=Va(c,w),w=c,c=c.return;while(c);return m}catch(R){return`
Error generating stack: `+R.message+`
`+R.stack}}var Ar=Object.prototype.hasOwnProperty,la=Z.unstable_scheduleCallback,Po=Z.unstable_cancelCallback,Qs=Z.unstable_shouldYield,Io=Z.unstable_requestPaint,Mr=Z.unstable_now,ws=Z.unstable_getCurrentPriorityLevel,Ds=Z.unstable_ImmediatePriority,Ps=Z.unstable_UserBlockingPriority,Qt=Z.unstable_NormalPriority,Gn=Z.unstable_LowPriority,Ta=Z.unstable_IdlePriority,Ha=Z.log,ms=Z.unstable_setDisableYieldValue,xn=null,er=null;function sr(c){if(typeof Ha=="function"&&ms(c),er&&typeof er.setStrictMode=="function")try{er.setStrictMode(xn,c)}catch{}}var Xs=Math.clz32?Math.clz32:pl,fl=Math.log,Jr=Math.LN2;function pl(c){return c>>>=0,c===0?32:31-(fl(c)/Jr|0)|0}var Uo=256,oc=262144,cl=4194304;function ft(c){var m=c&42;if(m!==0)return m;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function ze(c,m,w){var R=c.pendingLanes;if(R===0)return 0;var G=0,Y=c.suspendedLanes,be=c.pingedLanes;c=c.warmLanes;var Qe=R&134217727;return Qe!==0?(R=Qe&~Y,R!==0?G=ft(R):(be&=Qe,be!==0?G=ft(be):w||(w=Qe&~c,w!==0&&(G=ft(w))))):(Qe=R&~Y,Qe!==0?G=ft(Qe):be!==0?G=ft(be):w||(w=R&~c,w!==0&&(G=ft(w)))),G===0?0:m!==0&&m!==G&&(m&Y)===0&&(Y=G&-G,w=m&-m,Y>=w||Y===32&&(w&4194048)!==0)?m:G}function Pe(c,m){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&m)===0}function et(c,m){switch(c){case 1:case 2:case 4:case 8:case 64:return m+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gt(){var c=cl;return cl<<=1,(cl&62914560)===0&&(cl=4194304),c}function jt(c){for(var m=[],w=0;31>w;w++)m.push(c);return m}function Ge(c,m){c.pendingLanes|=m,m!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function ei(c,m,w,R,G,Y){var be=c.pendingLanes;c.pendingLanes=w,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=w,c.entangledLanes&=w,c.errorRecoveryDisabledLanes&=w,c.shellSuspendCounter=0;var Qe=c.entanglements,Ot=c.expirationTimes,Ri=c.hiddenUpdates;for(w=be&~w;0<w;){var sn=31-Xs(w),hn=1<<sn;Qe[sn]=0,Ot[sn]=-1;var Oi=Ri[sn];if(Oi!==null)for(Ri[sn]=null,sn=0;sn<Oi.length;sn++){var Hi=Oi[sn];Hi!==null&&(Hi.lane&=-536870913)}w&=~hn}R!==0&&kt(c,R,0),Y!==0&&G===0&&c.tag!==0&&(c.suspendedLanes|=Y&~(be&~m))}function kt(c,m,w){c.pendingLanes|=m,c.suspendedLanes&=~m;var R=31-Xs(m);c.entangledLanes|=m,c.entanglements[R]=c.entanglements[R]|1073741824|w&261930}function Pi(c,m){var w=c.entangledLanes|=m;for(c=c.entanglements;w;){var R=31-Xs(w),G=1<<R;G&m|c[R]&m&&(c[R]|=m),w&=~G}}function fi(c,m){var w=m&-m;return w=(w&42)!==0?1:ui(w),(w&(c.suspendedLanes|m))!==0?0:w}function ui(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function kn(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function fr(){var c=xi.p;return c!==0?c:(c=window.event,c===void 0?32:jc(c.type))}function Cr(c,m){var w=xi.p;try{return xi.p=c,m()}finally{xi.p=w}}var ct=Math.random().toString(36).slice(2),te="__reactFiber$"+ct,_e="__reactProps$"+ct,Re="__reactContainer$"+ct,tt="__reactEvents$"+ct,Xe="__reactListeners$"+ct,at="__reactHandles$"+ct,St="__reactResources$"+ct,lt="__reactMarker$"+ct;function It(c){delete c[te],delete c[_e],delete c[tt],delete c[Xe],delete c[at]}function ti(c){var m=c[te];if(m)return m;for(var w=c.parentNode;w;){if(m=w[Re]||w[te]){if(w=m.alternate,m.child!==null||w!==null&&w.child!==null)for(c=lr(c);c!==null;){if(w=c[te])return w;c=lr(c)}return m}c=w,w=c.parentNode}return null}function Gt(c){if(c=c[te]||c[Re]){var m=c.tag;if(m===5||m===6||m===13||m===31||m===26||m===27||m===3)return c}return null}function Ji(c){var m=c.tag;if(m===5||m===26||m===27||m===6)return c.stateNode;throw Error(ue(33))}function Qi(c){var m=c[St];return m||(m=c[St]={hoistableStyles:new Map,hoistableScripts:new Map}),m}function ji(c){c[lt]=!0}var pr=new Set,$n={};function Nn(c,m){qr(c,m),qr(c+"Capture",m)}function qr(c,m){for($n[c]=m,c=0;c<m.length;c++)pr.add(m[c])}var Oa=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ts={},cs={};function Zs(c){return Ar.call(cs,c)?!0:Ar.call(ts,c)?!1:Oa.test(c)?cs[c]=!0:(ts[c]=!0,!1)}function na(c,m,w){if(Zs(m))if(w===null)c.removeAttribute(m);else{switch(typeof w){case"undefined":case"function":case"symbol":c.removeAttribute(m);return;case"boolean":var R=m.toLowerCase().slice(0,5);if(R!=="data-"&&R!=="aria-"){c.removeAttribute(m);return}}c.setAttribute(m,""+w)}}function $r(c,m,w){if(w===null)c.removeAttribute(m);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(m);return}c.setAttribute(m,""+w)}}function _a(c,m,w,R){if(R===null)c.removeAttribute(w);else{switch(typeof R){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(w);return}c.setAttributeNS(m,w,""+R)}}function ur(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function kr(c){var m=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function Xa(c,m,w){var R=Object.getOwnPropertyDescriptor(c.constructor.prototype,m);if(!c.hasOwnProperty(m)&&typeof R<"u"&&typeof R.get=="function"&&typeof R.set=="function"){var G=R.get,Y=R.set;return Object.defineProperty(c,m,{configurable:!0,get:function(){return G.call(this)},set:function(be){w=""+be,Y.call(this,be)}}),Object.defineProperty(c,m,{enumerable:R.enumerable}),{getValue:function(){return w},setValue:function(be){w=""+be},stopTracking:function(){c._valueTracker=null,delete c[m]}}}}function Lo(c){if(!c._valueTracker){var m=kr(c)?"checked":"value";c._valueTracker=Xa(c,m,""+c[m])}}function eo(c){if(!c)return!1;var m=c._valueTracker;if(!m)return!0;var w=m.getValue(),R="";return c&&(R=kr(c)?c.checked?"true":"false":c.value),c=R,c!==w?(m.setValue(c),!0):!1}function ml(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var ih=/[\n"\\]/g;function ns(c){return c.replace(ih,function(m){return"\\"+m.charCodeAt(0).toString(16)+" "})}function Go(c,m,w,R,G,Y,be,Qe){c.name="",be!=null&&typeof be!="function"&&typeof be!="symbol"&&typeof be!="boolean"?c.type=be:c.removeAttribute("type"),m!=null?be==="number"?(m===0&&c.value===""||c.value!=m)&&(c.value=""+ur(m)):c.value!==""+ur(m)&&(c.value=""+ur(m)):be!=="submit"&&be!=="reset"||c.removeAttribute("value"),m!=null?Mc(c,be,ur(m)):w!=null?Mc(c,be,ur(w)):R!=null&&c.removeAttribute("value"),G==null&&Y!=null&&(c.defaultChecked=!!Y),G!=null&&(c.checked=G&&typeof G!="function"&&typeof G!="symbol"),Qe!=null&&typeof Qe!="function"&&typeof Qe!="symbol"&&typeof Qe!="boolean"?c.name=""+ur(Qe):c.removeAttribute("name")}function va(c,m,w,R,G,Y,be,Qe){if(Y!=null&&typeof Y!="function"&&typeof Y!="symbol"&&typeof Y!="boolean"&&(c.type=Y),m!=null||w!=null){if(!(Y!=="submit"&&Y!=="reset"||m!=null)){Lo(c);return}w=w!=null?""+ur(w):"",m=m!=null?""+ur(m):w,Qe||m===c.value||(c.value=m),c.defaultValue=m}R=R??G,R=typeof R!="function"&&typeof R!="symbol"&&!!R,c.checked=Qe?c.checked:!!R,c.defaultChecked=!!R,be!=null&&typeof be!="function"&&typeof be!="symbol"&&typeof be!="boolean"&&(c.name=be),Lo(c)}function Mc(c,m,w){m==="number"&&ml(c.ownerDocument)===c||c.defaultValue===""+w||(c.defaultValue=""+w)}function to(c,m,w,R){if(c=c.options,m){m={};for(var G=0;G<w.length;G++)m["$"+w[G]]=!0;for(w=0;w<c.length;w++)G=m.hasOwnProperty("$"+c[w].value),c[w].selected!==G&&(c[w].selected=G),G&&R&&(c[w].defaultSelected=!0)}else{for(w=""+ur(w),m=null,G=0;G<c.length;G++){if(c[G].value===w){c[G].selected=!0,R&&(c[G].defaultSelected=!0);return}m!==null||c[G].disabled||(m=c[G])}m!==null&&(m.selected=!0)}}function Vc(c,m,w){if(m!=null&&(m=""+ur(m),m!==c.value&&(c.value=m),w==null)){c.defaultValue!==m&&(c.defaultValue=m);return}c.defaultValue=w!=null?""+ur(w):""}function Ah(c,m,w,R){if(m==null){if(R!=null){if(w!=null)throw Error(ue(92));if(Pr(R)){if(1<R.length)throw Error(ue(93));R=R[0]}w=R}w==null&&(w=""),m=w}w=ur(m),c.defaultValue=w,R=c.textContent,R===w&&R!==""&&R!==null&&(c.value=R),Lo(c)}function su(c,m){if(m){var w=c.firstChild;if(w&&w===c.lastChild&&w.nodeType===3){w.nodeValue=m;return}}c.textContent=m}var Kh=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Jh(c,m,w){var R=m.indexOf("--")===0;w==null||typeof w=="boolean"||w===""?R?c.setProperty(m,""):m==="float"?c.cssFloat="":c[m]="":R?c.setProperty(m,w):typeof w!="number"||w===0||Kh.has(m)?m==="float"?c.cssFloat=w:c[m]=(""+w).trim():c[m]=w+"px"}function Mu(c,m,w){if(m!=null&&typeof m!="object")throw Error(ue(62));if(c=c.style,w!=null){for(var R in w)!w.hasOwnProperty(R)||m!=null&&m.hasOwnProperty(R)||(R.indexOf("--")===0?c.setProperty(R,""):R==="float"?c.cssFloat="":c[R]="");for(var G in m)R=m[G],m.hasOwnProperty(G)&&w[G]!==R&&Jh(c,G,R)}else for(var Y in m)m.hasOwnProperty(Y)&&Jh(c,Y,m[Y])}function Uc(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var lc=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),ou=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Ic(c){return ou.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function _o(){}var Zl=null;function ko(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Ao=null,lu=null;function Iu(c){var m=Gt(c);if(m&&(c=m.stateNode)){var w=c[_e]||null;e:switch(c=m.stateNode,m.type){case"input":if(Go(c,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name),m=w.name,w.type==="radio"&&m!=null){for(w=c;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll('input[name="'+ns(""+m)+'"][type="radio"]'),m=0;m<w.length;m++){var R=w[m];if(R!==c&&R.form===c.form){var G=R[_e]||null;if(!G)throw Error(ue(90));Go(R,G.value,G.defaultValue,G.defaultValue,G.checked,G.defaultChecked,G.type,G.name)}}for(m=0;m<w.length;m++)R=w[m],R.form===c.form&&eo(R)}break e;case"textarea":Vc(c,w.value,w.defaultValue);break e;case"select":m=w.value,m!=null&&to(c,!!w.multiple,m,!1)}}}var Mh=!1;function Jf(c,m,w){if(Mh)return c(m,w);Mh=!0;try{var R=c(m);return R}finally{if(Mh=!1,(Ao!==null||lu!==null)&&(el(),Ao&&(m=Ao,c=lu,lu=Ao=null,Iu(m),c)))for(m=0;m<c.length;m++)Iu(c[m])}}function Cc(c,m){var w=c.stateNode;if(w===null)return null;var R=w[_e]||null;if(R===null)return null;w=R[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(R=!R.disabled)||(c=c.type,R=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!R;break e;default:c=!1}if(c)return null;if(w&&typeof w!="function")throw Error(ue(231,m,typeof w));return w}var Ho=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Sd=!1;if(Ho)try{var cu={};Object.defineProperty(cu,"passive",{get:function(){Sd=!0}}),window.addEventListener("test",cu,cu),window.removeEventListener("test",cu,cu)}catch{Sd=!1}var Wl=null,Ap=null,Hd=null;function nh(){if(Hd)return Hd;var c,m=Ap,w=m.length,R,G="value"in Wl?Wl.value:Wl.textContent,Y=G.length;for(c=0;c<w&&m[c]===G[c];c++);var be=w-c;for(R=1;R<=be&&m[w-R]===G[Y-R];R++);return Hd=G.slice(c,1<R?1-R:void 0)}function Qr(c){var m=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&m===13&&(c=13)):c=m,c===10&&(c=13),32<=c||c===13?c:0}function rh(){return!0}function qd(){return!1}function Il(c){function m(w,R,G,Y,be){this._reactName=w,this._targetInst=G,this.type=R,this.nativeEvent=Y,this.target=be,this.currentTarget=null;for(var Qe in c)c.hasOwnProperty(Qe)&&(w=c[Qe],this[Qe]=w?w(Y):Y[Qe]);return this.isDefaultPrevented=(Y.defaultPrevented!=null?Y.defaultPrevented:Y.returnValue===!1)?rh:qd,this.isPropagationStopped=qd,this}return it(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=rh)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=rh)},persist:function(){},isPersistent:rh}),m}var Cl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Cu=Il(Cl),zu=it({},Cl,{view:0,detail:0}),Ru=Il(zu),uu,ss,zl,Qh=it({},zu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:id,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==zl&&(zl&&c.type==="mousemove"?(uu=c.screenX-zl.screenX,ss=c.screenY-zl.screenY):ss=uu=0,zl=c),uu)},movementY:function(c){return"movementY"in c?c.movementY:ss}}),Ih=Il(Qh),ed=it({},Qh,{dataTransfer:0}),td=Il(ed),Rl=it({},zu,{relatedTarget:0}),Ed=Il(Rl),Ad=it({},Cl,{animationName:0,elapsedTime:0,pseudoElement:0}),Gc=Il(Ad),Ia=it({},Cl,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Mp=Il(Ia),Ip=it({},Cl,{data:0}),Ch=Il(Ip),Hn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Cp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$d={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Xl(c){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(c):(c=$d[c])?!!m[c]:!1}function id(){return Xl}var zc=it({},zu,{key:function(c){if(c.key){var m=Hn[c.key]||c.key;if(m!=="Unidentified")return m}return c.type==="keypress"?(c=Qr(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?Cp[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:id,charCode:function(c){return c.type==="keypress"?Qr(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Qr(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),En=Il(zc),ra=it({},Qh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ca=Il(ra),Yl=it({},zu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:id}),Du=Il(Yl),Sa=it({},Cl,{propertyName:0,elapsedTime:0,pseudoElement:0}),Mf=Il(Sa),nd=it({},Qh,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),Hc=Il(nd),rl=it({},Cl,{newState:0,oldState:0}),so=Il(rl),zp=[9,13,27,32],qc=Ho&&"CompositionEvent"in window,zh=null;Ho&&"documentMode"in document&&(zh=document.documentMode);var Pu=Ho&&"TextEvent"in window&&!zh,Md=Ho&&(!qc||zh&&8<zh&&11>=zh),Qf=" ",go=!1;function Dl(c,m){switch(c){case"keyup":return zp.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xa(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Co=!1;function Ls(c,m){switch(c){case"compositionend":return xa(m);case"keypress":return m.which!==32?null:(go=!0,Qf);case"textInput":return c=m.data,c===Qf&&go?null:c;default:return null}}function Ts(c,m){if(Co)return c==="compositionend"||!qc&&Dl(c,m)?(c=nh(),Hd=Ap=Wl=null,Co=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Md&&m.locale!=="ko"?null:m.data;default:return null}}var oo={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pl(c){var m=c&&c.nodeName&&c.nodeName.toLowerCase();return m==="input"?!!oo[c.type]:m==="textarea"}function Rc(c,m,w,R){Ao?lu?lu.push(R):lu=[R]:Ao=R,m=Jm(m,"onChange"),0<m.length&&(w=new Cu("onChange","change",null,w,R),c.push({event:w,listeners:m}))}var io=null,$c=null;function Kl(c){Km(c,0)}function zo(c){var m=Ji(c);if(eo(m))return c}function hr(c,m){if(c==="change")return m}var yn=!1;if(Ho){var rd;if(Ho){var jn="oninput"in document;if(!jn){var Lu=document.createElement("div");Lu.setAttribute("oninput","return;"),jn=typeof Lu.oninput=="function"}rd=jn}else rd=!1;yn=rd&&(!document.documentMode||9<document.documentMode)}function Rh(){io&&(io.detachEvent("onpropertychange",Vn),$c=io=null)}function Vn(c){if(c.propertyName==="value"&&zo($c)){var m=[];Rc(m,$c,c,ko(c)),Jf(Kl,m)}}function Dc(c,m,w){c==="focusin"?(Rh(),io=m,$c=w,io.attachEvent("onpropertychange",Vn)):c==="focusout"&&Rh()}function Zd(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return zo($c)}function Dh(c,m){if(c==="click")return zo(m)}function Zo(c,m){if(c==="input"||c==="change")return zo(m)}function If(c,m){return c===m&&(c!==0||1/c===1/m)||c!==c&&m!==m}var _s=typeof Object.is=="function"?Object.is:If;function qa(c,m){if(_s(c,m))return!0;if(typeof c!="object"||c===null||typeof m!="object"||m===null)return!1;var w=Object.keys(c),R=Object.keys(m);if(w.length!==R.length)return!1;for(R=0;R<w.length;R++){var G=w[R];if(!Ar.call(m,G)||!_s(c[G],m[G]))return!1}return!0}function cc(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function ep(c,m){var w=cc(c);c=0;for(var R;w;){if(w.nodeType===3){if(R=c+w.textContent.length,c<=m&&R>=m)return{node:w,offset:m-c};c=R}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=cc(w)}}function ah(c,m){return c&&m?c===m?!0:c&&c.nodeType===3?!1:m&&m.nodeType===3?ah(c,m.parentNode):"contains"in c?c.contains(m):c.compareDocumentPosition?!!(c.compareDocumentPosition(m)&16):!1:!1}function _l(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var m=ml(c.document);m instanceof c.HTMLIFrameElement;){try{var w=typeof m.contentWindow.location.href=="string"}catch{w=!1}if(w)c=m.contentWindow;else break;m=ml(c.document)}return m}function ad(c){var m=c&&c.nodeName&&c.nodeName.toLowerCase();return m&&(m==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||m==="textarea"||c.contentEditable==="true")}var tp=Ho&&"documentMode"in document&&11>=document.documentMode,hu=null,sd=null,du=null,Pc=!1;function Lc(c,m,w){var R=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Pc||hu==null||hu!==ml(R)||(R=hu,"selectionStart"in R&&ad(R)?R={start:R.selectionStart,end:R.selectionEnd}:(R=(R.ownerDocument&&R.ownerDocument.defaultView||window).getSelection(),R={anchorNode:R.anchorNode,anchorOffset:R.anchorOffset,focusNode:R.focusNode,focusOffset:R.focusOffset}),du&&qa(du,R)||(du=R,R=Jm(sd,"onSelect"),0<R.length&&(m=new Cu("onSelect","select",null,m,w),c.push({event:m,listeners:R}),m.target=hu)))}function fu(c,m){var w={};return w[c.toLowerCase()]=m.toLowerCase(),w["Webkit"+c]="webkit"+m,w["Moz"+c]="moz"+m,w}var Zc={animationend:fu("Animation","AnimationEnd"),animationiteration:fu("Animation","AnimationIteration"),animationstart:fu("Animation","AnimationStart"),transitionrun:fu("Transition","TransitionRun"),transitionstart:fu("Transition","TransitionStart"),transitioncancel:fu("Transition","TransitionCancel"),transitionend:fu("Transition","TransitionEnd")},Cf={},od={};Ho&&(od=document.createElement("div").style,"AnimationEvent"in window||(delete Zc.animationend.animation,delete Zc.animationiteration.animation,delete Zc.animationstart.animation),"TransitionEvent"in window||delete Zc.transitionend.transition);function pu(c){if(Cf[c])return Cf[c];if(!Zc[c])return c;var m=Zc[c],w;for(w in m)if(m.hasOwnProperty(w)&&w in od)return Cf[c]=m[w];return c}var Id=pu("animationend"),mu=pu("animationiteration"),zf=pu("animationstart"),hm=pu("transitionrun"),Rf=pu("transitionstart"),ku=pu("transitioncancel"),ld=pu("transitionend"),Ll=new Map,cd="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");cd.push("scrollEnd");function Ws(c,m){Ll.set(c,m),Nn(m,[c])}var uc=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},hc=[],sh=0,us=0;function kl(){for(var c=sh,m=us=sh=0;m<c;){var w=hc[m];hc[m++]=null;var R=hc[m];hc[m++]=null;var G=hc[m];hc[m++]=null;var Y=hc[m];if(hc[m++]=null,R!==null&&G!==null){var be=R.pending;be===null?G.next=G:(G.next=be.next,be.next=G),R.pending=G}Y!==0&&ud(w,G,Y)}}function pi(c,m,w,R){hc[sh++]=c,hc[sh++]=m,hc[sh++]=w,hc[sh++]=R,us|=R,c.lanes|=R,c=c.alternate,c!==null&&(c.lanes|=R)}function Ph(c,m,w,R){return pi(c,m,w,R),Fu(c)}function _u(c,m){return pi(c,null,null,m),Fu(c)}function ud(c,m,w){c.lanes|=w;var R=c.alternate;R!==null&&(R.lanes|=w);for(var G=!1,Y=c.return;Y!==null;)Y.childLanes|=w,R=Y.alternate,R!==null&&(R.childLanes|=w),Y.tag===22&&(c=Y.stateNode,c===null||c._visibility&1||(G=!0)),c=Y,Y=Y.return;return c.tag===3?(Y=c.stateNode,G&&m!==null&&(G=31-Xs(w),c=Y.hiddenUpdates,R=c[G],R===null?c[G]=[m]:R.push(m),m.lane=w|536870912),Y):null}function Fu(c){if(50<Za)throw Za=0,ba=null,Error(ue(185));for(var m=c.return;m!==null;)c=m,m=c.return;return c.tag===3?c.stateNode:null}var gl={};function gu(c,m,w,R){this.tag=c,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=R,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function yl(c,m,w,R){return new gu(c,m,w,R)}function Ou(c){return c=c.prototype,!(!c||!c.isReactComponent)}function vl(c,m){var w=c.alternate;return w===null?(w=yl(c.tag,m,c.key,c.mode),w.elementType=c.elementType,w.type=c.type,w.stateNode=c.stateNode,w.alternate=c,c.alternate=w):(w.pendingProps=m,w.type=c.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=c.flags&65011712,w.childLanes=c.childLanes,w.lanes=c.lanes,w.child=c.child,w.memoizedProps=c.memoizedProps,w.memoizedState=c.memoizedState,w.updateQueue=c.updateQueue,m=c.dependencies,w.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},w.sibling=c.sibling,w.index=c.index,w.ref=c.ref,w.refCleanup=c.refCleanup,w}function Bu(c,m){c.flags&=65011714;var w=c.alternate;return w===null?(c.childLanes=0,c.lanes=m,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=w.childLanes,c.lanes=w.lanes,c.child=w.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=w.memoizedProps,c.memoizedState=w.memoizedState,c.updateQueue=w.updateQueue,c.type=w.type,m=w.dependencies,c.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),c}function Lh(c,m,w,R,G,Y){var be=0;if(R=c,typeof c=="function")Ou(c)&&(be=1);else if(typeof c=="string")be=Wh(c,w,vn.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case Bt:return c=yl(31,w,m,G),c.elementType=Bt,c.lanes=Y,c;case Vi:return kc(w.children,G,Y,m);case qi:be=8,G|=24;break;case on:return c=yl(12,w,m,G|2),c.elementType=on,c.lanes=Y,c;case rr:return c=yl(13,w,m,G),c.elementType=rr,c.lanes=Y,c;case ln:return c=yl(19,w,m,G),c.elementType=ln,c.lanes=Y,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case an:be=10;break e;case Ai:be=9;break e;case Un:be=11;break e;case mn:be=14;break e;case Pt:be=16,R=null;break e}be=29,w=Error(ue(130,c===null?"null":typeof c,"")),R=null}return m=yl(be,w,m,G),m.elementType=c,m.type=R,m.lanes=Y,m}function kc(c,m,w,R){return c=yl(7,c,R,m),c.lanes=w,c}function kh(c,m,w){return c=yl(6,c,null,m),c.lanes=w,c}function Wd(c){var m=yl(18,null,null,0);return m.stateNode=c,m}function Xd(c,m,w){return m=yl(4,c.children!==null?c.children:[],c.key,m),m.lanes=w,m.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},m}var Yd=new WeakMap;function Wo(c,m){if(typeof c=="object"&&c!==null){var w=Yd.get(c);return w!==void 0?w:(m={value:c,source:m,stack:Ir(m)},Yd.set(c,m),m)}return{value:c,source:m,stack:Ir(m)}}var Nr=[],Fh=0,hd=null,Kd=0,Mo=[],Xo=0,ka=null,al=1,Fl="";function Nu(c,m){Nr[Fh++]=Kd,Nr[Fh++]=hd,hd=c,Kd=m}function Df(c,m,w){Mo[Xo++]=al,Mo[Xo++]=Fl,Mo[Xo++]=ka,ka=c;var R=al;c=Fl;var G=32-Xs(R)-1;R&=~(1<<G),w+=1;var Y=32-Xs(m)+G;if(30<Y){var be=G-G%5;Y=(R&(1<<be)-1).toString(32),R>>=be,G-=be,al=1<<32-Xs(m)+G|w<<G|R,Fl=Y+c}else al=1<<Y|w<<G|R,Fl=c}function Jd(c){c.return!==null&&(Nu(c,1),Df(c,1,0))}function oh(c){for(;c===hd;)hd=Nr[--Fh],Nr[Fh]=null,Kd=Nr[--Fh],Nr[Fh]=null;for(;c===ka;)ka=Mo[--Xo],Mo[Xo]=null,Fl=Mo[--Xo],Mo[Xo]=null,al=Mo[--Xo],Mo[Xo]=null}function Oh(c,m){Mo[Xo++]=al,Mo[Xo++]=Fl,Mo[Xo++]=ka,al=m.id,Fl=m.overflow,ka=c}var yo=null,$a=null,dn=!1,Wc=null,dc=!1,Bh=Error(ue(519));function Jl(c){var m=Error(ue(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw dd(Wo(m,c)),Bh}function lh(c){var m=c.stateNode,w=c.type,R=c.memoizedProps;switch(m[te]=c,m[_e]=R,w){case"dialog":Cs("cancel",m),Cs("close",m);break;case"iframe":case"object":case"embed":Cs("load",m);break;case"video":case"audio":for(w=0;w<Yp.length;w++)Cs(Yp[w],m);break;case"source":Cs("error",m);break;case"img":case"image":case"link":Cs("error",m),Cs("load",m);break;case"details":Cs("toggle",m);break;case"input":Cs("invalid",m),va(m,R.value,R.defaultValue,R.checked,R.defaultChecked,R.type,R.name,!0);break;case"select":Cs("invalid",m);break;case"textarea":Cs("invalid",m),Ah(m,R.value,R.defaultValue,R.children)}w=R.children,typeof w!="string"&&typeof w!="number"&&typeof w!="bigint"||m.textContent===""+w||R.suppressHydrationWarning===!0||wf(m.textContent,w)?(R.popover!=null&&(Cs("beforetoggle",m),Cs("toggle",m)),R.onScroll!=null&&Cs("scroll",m),R.onScrollEnd!=null&&Cs("scrollend",m),R.onClick!=null&&(m.onclick=_o),m=!0):m=!1,m||Jl(c,!0)}function Qd(c){for(yo=c.return;yo;)switch(yo.tag){case 5:case 31:case 13:dc=!1;return;case 27:case 3:dc=!0;return;default:yo=yo.return}}function Ra(c){if(c!==yo)return!1;if(!dn)return Qd(c),dn=!0,!1;var m=c.tag,w;if((w=m!==3&&m!==27)&&((w=m===5)&&(w=c.type,w=!(w!=="form"&&w!=="button")||H(c.type,c.memoizedProps)),w=!w),w&&$a&&Jl(c),Qd(c),m===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ue(317));$a=wr(c)}else if(m===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ue(317));$a=wr(c)}else m===27?(m=$a,Je(c.type)?(c=Mn,Mn=null,$a=c):$a=m):$a=yo?Bn(c.stateNode.nextSibling):null;return!0}function Xc(){$a=yo=null,dn=!1}function ip(){var c=Wc;return c!==null&&(bn===null?bn=c:bn.push.apply(bn,c),Wc=null),c}function dd(c){Wc===null?Wc=[c]:Wc.push(c)}var np=Et(null),Ol=null,ju=null;function ch(c,m,w){mi(np,m._currentValue),m._currentValue=w}function uh(c){c._currentValue=np.current,di(np)}function Rp(c,m,w){for(;c!==null;){var R=c.alternate;if((c.childLanes&m)!==m?(c.childLanes|=m,R!==null&&(R.childLanes|=m)):R!==null&&(R.childLanes&m)!==m&&(R.childLanes|=m),c===w)break;c=c.return}}function Cd(c,m,w,R){var G=c.child;for(G!==null&&(G.return=c);G!==null;){var Y=G.dependencies;if(Y!==null){var be=G.child;Y=Y.firstContext;e:for(;Y!==null;){var Qe=Y;Y=G;for(var Ot=0;Ot<m.length;Ot++)if(Qe.context===m[Ot]){Y.lanes|=w,Qe=Y.alternate,Qe!==null&&(Qe.lanes|=w),Rp(Y.return,w,c),R||(be=null);break e}Y=Qe.next}}else if(G.tag===18){if(be=G.return,be===null)throw Error(ue(341));be.lanes|=w,Y=be.alternate,Y!==null&&(Y.lanes|=w),Rp(be,w,c),be=null}else be=G.child;if(be!==null)be.return=G;else for(be=G;be!==null;){if(be===c){be=null;break}if(G=be.sibling,G!==null){G.return=be.return,be=G;break}be=be.return}G=be}}function fd(c,m,w,R){c=null;for(var G=m,Y=!1;G!==null;){if(!Y){if((G.flags&524288)!==0)Y=!0;else if((G.flags&262144)!==0)break}if(G.tag===10){var be=G.alternate;if(be===null)throw Error(ue(387));if(be=be.memoizedProps,be!==null){var Qe=G.type;_s(G.pendingProps.value,be.value)||(c!==null?c.push(Qe):c=[Qe])}}else if(G===Gr.current){if(be=G.alternate,be===null)throw Error(ue(387));be.memoizedState.memoizedState!==G.memoizedState.memoizedState&&(c!==null?c.push(Cm):c=[Cm])}G=G.return}c!==null&&Cd(m,c,w,R),m.flags|=262144}function ef(c){for(c=c.firstContext;c!==null;){if(!_s(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function Yo(c){Ol=c,ju=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function Ba(c){return pd(Ol,c)}function yu(c,m){return Ol===null&&Yo(c),pd(c,m)}function pd(c,m){var w=m._currentValue;if(m={context:m,memoizedValue:w,next:null},ju===null){if(c===null)throw Error(ue(308));ju=m,c.dependencies={lanes:0,firstContext:m},c.flags|=524288}else ju=ju.next=m;return w}var Nh=typeof AbortController<"u"?AbortController:function(){var c=[],m=this.signal={aborted:!1,addEventListener:function(w,R){c.push(R)}};this.abort=function(){m.aborted=!0,c.forEach(function(w){return w()})}},tf=Z.unstable_scheduleCallback,nf=Z.unstable_NormalPriority,hs={$$typeof:an,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function fc(){return{controller:new Nh,data:new Map,refCount:0}}function Yc(c){c.refCount--,c.refCount===0&&tf(nf,function(){c.controller.abort()})}var Wn=null,Fr=0,vu=0,Vu=null;function md(c,m){if(Wn===null){var w=Wn=[];Fr=0,vu=Xp(),Vu={status:"pending",value:void 0,then:function(R){w.push(R)}}}return Fr++,m.then(L,L),m}function L(){if(--Fr===0&&Wn!==null){Vu!==null&&(Vu.status="fulfilled");var c=Wn;Wn=null,vu=0,Vu=null;for(var m=0;m<c.length;m++)(0,c[m])()}}function o(c,m){var w=[],R={status:"pending",value:null,reason:null,then:function(G){w.push(G)}};return c.then(function(){R.status="fulfilled",R.value=m;for(var G=0;G<w.length;G++)(0,w[G])(m)},function(G){for(R.status="rejected",R.reason=G,G=0;G<w.length;G++)(0,w[G])(void 0)}),R}var v=si.S;si.S=function(c,m){Ea=Mr(),typeof m=="object"&&m!==null&&typeof m.then=="function"&&md(c,m),v!==null&&v(c,m)};var A=Et(null);function M(){var c=A.current;return c!==null?c:Ct.pooledCache}function P(c,m){m===null?mi(A,A.current):mi(A,m.pool)}function q(){var c=M();return c===null?null:{parent:hs._currentValue,pool:c}}var J=Error(ue(460)),ne=Error(ue(474)),fe=Error(ue(542)),we={then:function(){}};function Te(c){return c=c.status,c==="fulfilled"||c==="rejected"}function Be(c,m,w){switch(w=c[w],w===void 0?c.push(m):w!==m&&(m.then(_o,_o),m=w),m.status){case"fulfilled":return m.value;case"rejected":throw c=m.reason,Mt(c),c;default:if(typeof m.status=="string")m.then(_o,_o);else{if(c=Ct,c!==null&&100<c.shellSuspendCounter)throw Error(ue(482));c=m,c.status="pending",c.then(function(R){if(m.status==="pending"){var G=m;G.status="fulfilled",G.value=R}},function(R){if(m.status==="pending"){var G=m;G.status="rejected",G.reason=R}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw c=m.reason,Mt(c),c}throw ot=m,J}}function Ke(c){try{var m=c._init;return m(c._payload)}catch(w){throw w!==null&&typeof w=="object"&&typeof w.then=="function"?(ot=w,J):w}}var ot=null;function wt(){if(ot===null)throw Error(ue(459));var c=ot;return ot=null,c}function Mt(c){if(c===J||c===fe)throw Error(ue(483))}var Rt=null,Ft=0;function yt(c){var m=Ft;return Ft+=1,Rt===null&&(Rt=[]),Be(Rt,c,m)}function Ht(c,m){m=m.props.ref,c.ref=m!==void 0?m:null}function Jt(c,m){throw m.$$typeof===ht?Error(ue(525)):(c=Object.prototype.toString.call(m),Error(ue(31,c==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":c)))}function oi(c){function m(ci,Yt){if(c){var Ii=ci.deletions;Ii===null?(ci.deletions=[Yt],ci.flags|=16):Ii.push(Yt)}}function w(ci,Yt){if(!c)return null;for(;Yt!==null;)m(ci,Yt),Yt=Yt.sibling;return null}function R(ci){for(var Yt=new Map;ci!==null;)ci.key!==null?Yt.set(ci.key,ci):Yt.set(ci.index,ci),ci=ci.sibling;return Yt}function G(ci,Yt){return ci=vl(ci,Yt),ci.index=0,ci.sibling=null,ci}function Y(ci,Yt,Ii){return ci.index=Ii,c?(Ii=ci.alternate,Ii!==null?(Ii=Ii.index,Ii<Yt?(ci.flags|=67108866,Yt):Ii):(ci.flags|=67108866,Yt)):(ci.flags|=1048576,Yt)}function be(ci){return c&&ci.alternate===null&&(ci.flags|=67108866),ci}function Qe(ci,Yt,Ii,un){return Yt===null||Yt.tag!==6?(Yt=kh(Ii,ci.mode,un),Yt.return=ci,Yt):(Yt=G(Yt,Ii),Yt.return=ci,Yt)}function Ot(ci,Yt,Ii,un){var fa=Ii.type;return fa===Vi?sn(ci,Yt,Ii.props.children,un,Ii.key):Yt!==null&&(Yt.elementType===fa||typeof fa=="object"&&fa!==null&&fa.$$typeof===Pt&&Ke(fa)===Yt.type)?(Yt=G(Yt,Ii.props),Ht(Yt,Ii),Yt.return=ci,Yt):(Yt=Lh(Ii.type,Ii.key,Ii.props,null,ci.mode,un),Ht(Yt,Ii),Yt.return=ci,Yt)}function Ri(ci,Yt,Ii,un){return Yt===null||Yt.tag!==4||Yt.stateNode.containerInfo!==Ii.containerInfo||Yt.stateNode.implementation!==Ii.implementation?(Yt=Xd(Ii,ci.mode,un),Yt.return=ci,Yt):(Yt=G(Yt,Ii.children||[]),Yt.return=ci,Yt)}function sn(ci,Yt,Ii,un,fa){return Yt===null||Yt.tag!==7?(Yt=kc(Ii,ci.mode,un,fa),Yt.return=ci,Yt):(Yt=G(Yt,Ii),Yt.return=ci,Yt)}function hn(ci,Yt,Ii){if(typeof Yt=="string"&&Yt!==""||typeof Yt=="number"||typeof Yt=="bigint")return Yt=kh(""+Yt,ci.mode,Ii),Yt.return=ci,Yt;if(typeof Yt=="object"&&Yt!==null){switch(Yt.$$typeof){case Ci:return Ii=Lh(Yt.type,Yt.key,Yt.props,null,ci.mode,Ii),Ht(Ii,Yt),Ii.return=ci,Ii;case Ui:return Yt=Xd(Yt,ci.mode,Ii),Yt.return=ci,Yt;case Pt:return Yt=Ke(Yt),hn(ci,Yt,Ii)}if(Pr(Yt)||Li(Yt))return Yt=kc(Yt,ci.mode,Ii,null),Yt.return=ci,Yt;if(typeof Yt.then=="function")return hn(ci,yt(Yt),Ii);if(Yt.$$typeof===an)return hn(ci,yu(ci,Yt),Ii);Jt(ci,Yt)}return null}function Oi(ci,Yt,Ii,un){var fa=Yt!==null?Yt.key:null;if(typeof Ii=="string"&&Ii!==""||typeof Ii=="number"||typeof Ii=="bigint")return fa!==null?null:Qe(ci,Yt,""+Ii,un);if(typeof Ii=="object"&&Ii!==null){switch(Ii.$$typeof){case Ci:return Ii.key===fa?Ot(ci,Yt,Ii,un):null;case Ui:return Ii.key===fa?Ri(ci,Yt,Ii,un):null;case Pt:return Ii=Ke(Ii),Oi(ci,Yt,Ii,un)}if(Pr(Ii)||Li(Ii))return fa!==null?null:sn(ci,Yt,Ii,un,null);if(typeof Ii.then=="function")return Oi(ci,Yt,yt(Ii),un);if(Ii.$$typeof===an)return Oi(ci,Yt,yu(ci,Ii),un);Jt(ci,Ii)}return null}function Hi(ci,Yt,Ii,un,fa){if(typeof un=="string"&&un!==""||typeof un=="number"||typeof un=="bigint")return ci=ci.get(Ii)||null,Qe(Yt,ci,""+un,fa);if(typeof un=="object"&&un!==null){switch(un.$$typeof){case Ci:return ci=ci.get(un.key===null?Ii:un.key)||null,Ot(Yt,ci,un,fa);case Ui:return ci=ci.get(un.key===null?Ii:un.key)||null,Ri(Yt,ci,un,fa);case Pt:return un=Ke(un),Hi(ci,Yt,Ii,un,fa)}if(Pr(un)||Li(un))return ci=ci.get(Ii)||null,sn(Yt,ci,un,fa,null);if(typeof un.then=="function")return Hi(ci,Yt,Ii,yt(un),fa);if(un.$$typeof===an)return Hi(ci,Yt,Ii,yu(Yt,un),fa);Jt(Yt,un)}return null}function Vr(ci,Yt,Ii,un){for(var fa=null,mo=null,ia=Yt,xs=Yt=0,Ns=null;ia!==null&&xs<Ii.length;xs++){ia.index>xs?(Ns=ia,ia=null):Ns=ia.sibling;var Eo=Oi(ci,ia,Ii[xs],un);if(Eo===null){ia===null&&(ia=Ns);break}c&&ia&&Eo.alternate===null&&m(ci,ia),Yt=Y(Eo,Yt,xs),mo===null?fa=Eo:mo.sibling=Eo,mo=Eo,ia=Ns}if(xs===Ii.length)return w(ci,ia),dn&&Nu(ci,xs),fa;if(ia===null){for(;xs<Ii.length;xs++)ia=hn(ci,Ii[xs],un),ia!==null&&(Yt=Y(ia,Yt,xs),mo===null?fa=ia:mo.sibling=ia,mo=ia);return dn&&Nu(ci,xs),fa}for(ia=R(ia);xs<Ii.length;xs++)Ns=Hi(ia,ci,xs,Ii[xs],un),Ns!==null&&(c&&Ns.alternate!==null&&ia.delete(Ns.key===null?xs:Ns.key),Yt=Y(Ns,Yt,xs),mo===null?fa=Ns:mo.sibling=Ns,mo=Ns);return c&&ia.forEach(function(Ef){return m(ci,Ef)}),dn&&Nu(ci,xs),fa}function sa(ci,Yt,Ii,un){if(Ii==null)throw Error(ue(151));for(var fa=null,mo=null,ia=Yt,xs=Yt=0,Ns=null,Eo=Ii.next();ia!==null&&!Eo.done;xs++,Eo=Ii.next()){ia.index>xs?(Ns=ia,ia=null):Ns=ia.sibling;var Ef=Oi(ci,ia,Eo.value,un);if(Ef===null){ia===null&&(ia=Ns);break}c&&ia&&Ef.alternate===null&&m(ci,ia),Yt=Y(Ef,Yt,xs),mo===null?fa=Ef:mo.sibling=Ef,mo=Ef,ia=Ns}if(Eo.done)return w(ci,ia),dn&&Nu(ci,xs),fa;if(ia===null){for(;!Eo.done;xs++,Eo=Ii.next())Eo=hn(ci,Eo.value,un),Eo!==null&&(Yt=Y(Eo,Yt,xs),mo===null?fa=Eo:mo.sibling=Eo,mo=Eo);return dn&&Nu(ci,xs),fa}for(ia=R(ia);!Eo.done;xs++,Eo=Ii.next())Eo=Hi(ia,ci,xs,Eo.value,un),Eo!==null&&(c&&Eo.alternate!==null&&ia.delete(Eo.key===null?xs:Eo.key),Yt=Y(Eo,Yt,xs),mo===null?fa=Eo:mo.sibling=Eo,mo=Eo);return c&&ia.forEach(function(dy){return m(ci,dy)}),dn&&Nu(ci,xs),fa}function po(ci,Yt,Ii,un){if(typeof Ii=="object"&&Ii!==null&&Ii.type===Vi&&Ii.key===null&&(Ii=Ii.props.children),typeof Ii=="object"&&Ii!==null){switch(Ii.$$typeof){case Ci:e:{for(var fa=Ii.key;Yt!==null;){if(Yt.key===fa){if(fa=Ii.type,fa===Vi){if(Yt.tag===7){w(ci,Yt.sibling),un=G(Yt,Ii.props.children),un.return=ci,ci=un;break e}}else if(Yt.elementType===fa||typeof fa=="object"&&fa!==null&&fa.$$typeof===Pt&&Ke(fa)===Yt.type){w(ci,Yt.sibling),un=G(Yt,Ii.props),Ht(un,Ii),un.return=ci,ci=un;break e}w(ci,Yt);break}else m(ci,Yt);Yt=Yt.sibling}Ii.type===Vi?(un=kc(Ii.props.children,ci.mode,un,Ii.key),un.return=ci,ci=un):(un=Lh(Ii.type,Ii.key,Ii.props,null,ci.mode,un),Ht(un,Ii),un.return=ci,ci=un)}return be(ci);case Ui:e:{for(fa=Ii.key;Yt!==null;){if(Yt.key===fa)if(Yt.tag===4&&Yt.stateNode.containerInfo===Ii.containerInfo&&Yt.stateNode.implementation===Ii.implementation){w(ci,Yt.sibling),un=G(Yt,Ii.children||[]),un.return=ci,ci=un;break e}else{w(ci,Yt);break}else m(ci,Yt);Yt=Yt.sibling}un=Xd(Ii,ci.mode,un),un.return=ci,ci=un}return be(ci);case Pt:return Ii=Ke(Ii),po(ci,Yt,Ii,un)}if(Pr(Ii))return Vr(ci,Yt,Ii,un);if(Li(Ii)){if(fa=Li(Ii),typeof fa!="function")throw Error(ue(150));return Ii=fa.call(Ii),sa(ci,Yt,Ii,un)}if(typeof Ii.then=="function")return po(ci,Yt,yt(Ii),un);if(Ii.$$typeof===an)return po(ci,Yt,yu(ci,Ii),un);Jt(ci,Ii)}return typeof Ii=="string"&&Ii!==""||typeof Ii=="number"||typeof Ii=="bigint"?(Ii=""+Ii,Yt!==null&&Yt.tag===6?(w(ci,Yt.sibling),un=G(Yt,Ii),un.return=ci,ci=un):(w(ci,Yt),un=kh(Ii,ci.mode,un),un.return=ci,ci=un),be(ci)):w(ci,Yt)}return function(ci,Yt,Ii,un){try{Ft=0;var fa=po(ci,Yt,Ii,un);return Rt=null,fa}catch(ia){if(ia===J||ia===fe)throw ia;var mo=yl(29,ia,null,ci.mode);return mo.lanes=un,mo.return=ci,mo}finally{}}}var Xi=oi(!0),An=oi(!1),Cn=!1;function Zn(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ln(c,m){c=c.updateQueue,m.updateQueue===c&&(m.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function Rn(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function ir(c,m,w){var R=c.updateQueue;if(R===null)return null;if(R=R.shared,(At&2)!==0){var G=R.pending;return G===null?m.next=m:(m.next=G.next,G.next=m),R.pending=m,m=Fu(c),ud(c,null,w),m}return pi(c,R,m,w),Fu(c)}function Xr(c,m,w){if(m=m.updateQueue,m!==null&&(m=m.shared,(w&4194048)!==0)){var R=m.lanes;R&=c.pendingLanes,w|=R,m.lanes=w,Pi(c,w)}}function Fn(c,m){var w=c.updateQueue,R=c.alternate;if(R!==null&&(R=R.updateQueue,w===R)){var G=null,Y=null;if(w=w.firstBaseUpdate,w!==null){do{var be={lane:w.lane,tag:w.tag,payload:w.payload,callback:null,next:null};Y===null?G=Y=be:Y=Y.next=be,w=w.next}while(w!==null);Y===null?G=Y=m:Y=Y.next=m}else G=Y=m;w={baseState:R.baseState,firstBaseUpdate:G,lastBaseUpdate:Y,shared:R.shared,callbacks:R.callbacks},c.updateQueue=w;return}c=w.lastBaseUpdate,c===null?w.firstBaseUpdate=m:c.next=m,w.lastBaseUpdate=m}var qn=!1;function ea(){if(qn){var c=Vu;if(c!==null)throw c}}function is(c,m,w,R){qn=!1;var G=c.updateQueue;Cn=!1;var Y=G.firstBaseUpdate,be=G.lastBaseUpdate,Qe=G.shared.pending;if(Qe!==null){G.shared.pending=null;var Ot=Qe,Ri=Ot.next;Ot.next=null,be===null?Y=Ri:be.next=Ri,be=Ot;var sn=c.alternate;sn!==null&&(sn=sn.updateQueue,Qe=sn.lastBaseUpdate,Qe!==be&&(Qe===null?sn.firstBaseUpdate=Ri:Qe.next=Ri,sn.lastBaseUpdate=Ot))}if(Y!==null){var hn=G.baseState;be=0,sn=Ri=Ot=null,Qe=Y;do{var Oi=Qe.lane&-536870913,Hi=Oi!==Qe.lane;if(Hi?(Kt&Oi)===Oi:(R&Oi)===Oi){Oi!==0&&Oi===vu&&(qn=!0),sn!==null&&(sn=sn.next={lane:0,tag:Qe.tag,payload:Qe.payload,callback:null,next:null});e:{var Vr=c,sa=Qe;Oi=m;var po=w;switch(sa.tag){case 1:if(Vr=sa.payload,typeof Vr=="function"){hn=Vr.call(po,hn,Oi);break e}hn=Vr;break e;case 3:Vr.flags=Vr.flags&-65537|128;case 0:if(Vr=sa.payload,Oi=typeof Vr=="function"?Vr.call(po,hn,Oi):Vr,Oi==null)break e;hn=it({},hn,Oi);break e;case 2:Cn=!0}}Oi=Qe.callback,Oi!==null&&(c.flags|=64,Hi&&(c.flags|=8192),Hi=G.callbacks,Hi===null?G.callbacks=[Oi]:Hi.push(Oi))}else Hi={lane:Oi,tag:Qe.tag,payload:Qe.payload,callback:Qe.callback,next:null},sn===null?(Ri=sn=Hi,Ot=hn):sn=sn.next=Hi,be|=Oi;if(Qe=Qe.next,Qe===null){if(Qe=G.shared.pending,Qe===null)break;Hi=Qe,Qe=Hi.next,Hi.next=null,G.lastBaseUpdate=Hi,G.shared.pending=null}}while(!0);sn===null&&(Ot=hn),G.baseState=Ot,G.firstBaseUpdate=Ri,G.lastBaseUpdate=sn,Y===null&&(G.shared.lanes=0),Ei|=be,c.lanes=be,c.memoizedState=hn}}function Da(c,m){if(typeof c!="function")throw Error(ue(191,c));c.call(m)}function Ya(c,m){var w=c.callbacks;if(w!==null)for(c.callbacks=null,c=0;c<w.length;c++)Da(w[c],m)}var Vs=Et(null),sl=Et(0);function pc(c,m){c=Mi,mi(sl,c),mi(Vs,m),Mi=c|m.baseLanes}function Us(){mi(sl,Mi),mi(Vs,Vs.current)}function Fo(){Mi=sl.current,di(Vs),di(sl)}var Gs=Et(null),ks=null;function Ro(c){var m=c.alternate;mi(Fs,Fs.current&1),mi(Gs,c),ks===null&&(m===null||Vs.current!==null||m.memoizedState!==null)&&(ks=c)}function mc(c){mi(Fs,Fs.current),mi(Gs,c),ks===null&&(ks=c)}function Bl(c){c.tag===22?(mi(Fs,Fs.current),mi(Gs,c),ks===null&&(ks=c)):Kc()}function Kc(){mi(Fs,Fs.current),mi(Gs,Gs.current)}function ul(c){di(Gs),ks===c&&(ks=null),di(Fs)}var Fs=Et(0);function xu(c){for(var m=c;m!==null;){if(m.tag===13){var w=m.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||gn(w)||Xn(w)))return m}else if(m.tag===19&&(m.memoizedProps.revealOrder==="forwards"||m.memoizedProps.revealOrder==="backwards"||m.memoizedProps.revealOrder==="unstable_legacy-backwards"||m.memoizedProps.revealOrder==="together")){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===c)break;for(;m.sibling===null;){if(m.return===null||m.return===c)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var Nl=0,hi=null,Na=null,gs=null,Ko=!1,pn=!1,vo=!1,xl=0,ja=0,_c=null,jh=0;function Ys(){throw Error(ue(321))}function rf(c,m){if(m===null)return!1;for(var w=0;w<m.length&&w<c.length;w++)if(!_s(c[w],m[w]))return!1;return!0}function Uu(c,m,w,R,G,Y){return Nl=Y,hi=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,si.H=c===null||c.memoizedState===null?wu:hp,vo=!1,Y=w(R,G),vo=!1,pn&&(Y=qo(m,w,R,G)),Dp(c),Y}function Dp(c){si.H=ff;var m=Na!==null&&Na.next!==null;if(Nl=0,gs=Na=hi=null,Ko=!1,ja=0,_c=null,m)throw Error(ue(300));c===null||Oo||(c=c.dependencies,c!==null&&ef(c)&&(Oo=!0))}function qo(c,m,w,R){hi=c;var G=0;do{if(pn&&(_c=null),ja=0,pn=!1,25<=G)throw Error(ue(301));if(G+=1,gs=Na=null,c.updateQueue!=null){var Y=c.updateQueue;Y.lastEffect=null,Y.events=null,Y.stores=null,Y.memoCache!=null&&(Y.memoCache.index=0)}si.H=dp,Y=m(w,R)}while(pn);return Y}function rp(){var c=si.H,m=c.useState()[0];return m=typeof m.then=="function"?zd(m):m,c=c.useState()[0],(Na!==null?Na.memoizedState:null)!==c&&(hi.flags|=1024),m}function Jo(){var c=xl!==0;return xl=0,c}function gc(c,m,w){m.updateQueue=c.updateQueue,m.flags&=-2053,c.lanes&=~w}function hh(c){if(Ko){for(c=c.memoizedState;c!==null;){var m=c.queue;m!==null&&(m.pending=null),c=c.next}Ko=!1}Nl=0,gs=Na=hi=null,pn=!1,ja=xl=0,_c=null}function Qo(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return gs===null?hi.memoizedState=gs=c:gs=gs.next=c,gs}function no(){if(Na===null){var c=hi.alternate;c=c!==null?c.memoizedState:null}else c=Na.next;var m=gs===null?hi.memoizedState:gs.next;if(m!==null)gs=m,Na=c;else{if(c===null)throw hi.alternate===null?Error(ue(467)):Error(ue(310));Na=c,c={memoizedState:Na.memoizedState,baseState:Na.baseState,baseQueue:Na.baseQueue,queue:Na.queue,next:null},gs===null?hi.memoizedState=gs=c:gs=gs.next=c}return gs}function bu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function zd(c){var m=ja;return ja+=1,_c===null&&(_c=[]),c=Be(_c,c,m),m=hi,(gs===null?m.memoizedState:gs.next)===null&&(m=m.alternate,si.H=m===null||m.memoizedState===null?wu:hp),c}function Gu(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return zd(c);if(c.$$typeof===an)return Ba(c)}throw Error(ue(438,String(c)))}function Ka(c){var m=null,w=hi.updateQueue;if(w!==null&&(m=w.memoCache),m==null){var R=hi.alternate;R!==null&&(R=R.updateQueue,R!==null&&(R=R.memoCache,R!=null&&(m={data:R.data.map(function(G){return G.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),w===null&&(w=bu(),hi.updateQueue=w),w.memoCache=m,w=m.data[m.index],w===void 0)for(w=m.data[m.index]=Array(c),R=0;R<c;R++)w[R]=Ni;return m.index++,w}function dh(c,m){return typeof m=="function"?m(c):m}function af(c){var m=no();return sf(m,Na,c)}function sf(c,m,w){var R=c.queue;if(R===null)throw Error(ue(311));R.lastRenderedReducer=w;var G=c.baseQueue,Y=R.pending;if(Y!==null){if(G!==null){var be=G.next;G.next=Y.next,Y.next=be}m.baseQueue=G=Y,R.pending=null}if(Y=c.baseState,G===null)c.memoizedState=Y;else{m=G.next;var Qe=be=null,Ot=null,Ri=m,sn=!1;do{var hn=Ri.lane&-536870913;if(hn!==Ri.lane?(Kt&hn)===hn:(Nl&hn)===hn){var Oi=Ri.revertLane;if(Oi===0)Ot!==null&&(Ot=Ot.next={lane:0,revertLane:0,gesture:null,action:Ri.action,hasEagerState:Ri.hasEagerState,eagerState:Ri.eagerState,next:null}),hn===vu&&(sn=!0);else if((Nl&Oi)===Oi){Ri=Ri.next,Oi===vu&&(sn=!0);continue}else hn={lane:0,revertLane:Ri.revertLane,gesture:null,action:Ri.action,hasEagerState:Ri.hasEagerState,eagerState:Ri.eagerState,next:null},Ot===null?(Qe=Ot=hn,be=Y):Ot=Ot.next=hn,hi.lanes|=Oi,Ei|=Oi;hn=Ri.action,vo&&w(Y,hn),Y=Ri.hasEagerState?Ri.eagerState:w(Y,hn)}else Oi={lane:hn,revertLane:Ri.revertLane,gesture:Ri.gesture,action:Ri.action,hasEagerState:Ri.hasEagerState,eagerState:Ri.eagerState,next:null},Ot===null?(Qe=Ot=Oi,be=Y):Ot=Ot.next=Oi,hi.lanes|=hn,Ei|=hn;Ri=Ri.next}while(Ri!==null&&Ri!==m);if(Ot===null?be=Y:Ot.next=Qe,!_s(Y,c.memoizedState)&&(Oo=!0,sn&&(w=Vu,w!==null)))throw w;c.memoizedState=Y,c.baseState=be,c.baseQueue=Ot,R.lastRenderedState=Y}return G===null&&(R.lanes=0),[c.memoizedState,R.dispatch]}function Rd(c){var m=no(),w=m.queue;if(w===null)throw Error(ue(311));w.lastRenderedReducer=c;var R=w.dispatch,G=w.pending,Y=m.memoizedState;if(G!==null){w.pending=null;var be=G=G.next;do Y=c(Y,be.action),be=be.next;while(be!==G);_s(Y,m.memoizedState)||(Oo=!0),m.memoizedState=Y,m.baseQueue===null&&(m.baseState=Y),w.lastRenderedState=Y}return[Y,R]}function Vh(c,m,w){var R=hi,G=no(),Y=dn;if(Y){if(w===void 0)throw Error(ue(407));w=w()}else w=m();var be=!_s((Na||G).memoizedState,w);if(be&&(G.memoizedState=w,Oo=!0),G=G.queue,vc(Dd.bind(null,R,G,c),[c]),G.getSnapshot!==m||be||gs!==null&&gs.memoizedState.tag&1){if(R.flags|=2048,Gh(9,{destroy:void 0},Jc.bind(null,R,G,w,m),null),Ct===null)throw Error(ue(349));Y||(Nl&127)!==0||Hu(R,m,w)}return w}function Hu(c,m,w){c.flags|=16384,c={getSnapshot:m,value:w},m=hi.updateQueue,m===null?(m=bu(),hi.updateQueue=m,m.stores=[c]):(w=m.stores,w===null?m.stores=[c]:w.push(c))}function Jc(c,m,w,R){m.value=w,m.getSnapshot=R,bi(m)&&Gi(c)}function Dd(c,m,w){return w(function(){bi(m)&&Gi(c)})}function bi(c){var m=c.getSnapshot;c=c.value;try{var w=m();return!_s(c,w)}catch{return!0}}function Gi(c){var m=_u(c,2);m!==null&&ga(m,c,2)}function _d(c){var m=Qo();if(typeof c=="function"){var w=c;if(c=w(),vo){sr(!0);try{w()}finally{sr(!1)}}}return m.memoizedState=m.baseState=c,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:dh,lastRenderedState:c},m}function da(c,m,w,R){return c.baseState=w,sf(c,Na,typeof R=="function"?R:dh)}function bt(c,m,w,R,G){if(up(c))throw Error(ue(485));if(c=m.action,c!==null){var Y={payload:G,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(be){Y.listeners.push(be)}};si.T!==null?w(!0):Y.isTransition=!1,R(Y),w=m.pending,w===null?(Y.next=m.pending=Y,dm(m,Y)):(Y.next=w.next,m.pending=w.next=Y)}}function dm(c,m){var w=m.action,R=m.payload,G=c.state;if(m.isTransition){var Y=si.T,be={};si.T=be;try{var Qe=w(G,R),Ot=si.S;Ot!==null&&Ot(be,Qe),Uh(c,m,Qe)}catch(Ri){Pd(c,m,Ri)}finally{Y!==null&&be.types!==null&&(Y.types=be.types),si.T=Y}}else try{Y=w(G,R),Uh(c,m,Y)}catch(Ri){Pd(c,m,Ri)}}function Uh(c,m,w){w!==null&&typeof w=="object"&&typeof w.then=="function"?w.then(function(R){yc(c,m,R)},function(R){return Pd(c,m,R)}):yc(c,m,w)}function yc(c,m,w){m.status="fulfilled",m.value=w,gd(m),c.state=w,m=c.pending,m!==null&&(w=m.next,w===m?c.pending=null:(w=w.next,m.next=w,dm(c,w)))}function Pd(c,m,w){var R=c.pending;if(c.pending=null,R!==null){R=R.next;do m.status="rejected",m.reason=w,gd(m),m=m.next;while(m!==R)}c.action=null}function gd(c){c=c.listeners;for(var m=0;m<c.length;m++)(0,c[m])()}function fm(c,m){return m}function Pf(c,m){if(dn){var w=Ct.formState;if(w!==null){e:{var R=hi;if(dn){if($a){t:{for(var G=$a,Y=dc;G.nodeType!==8;){if(!Y){G=null;break t}if(G=Bn(G.nextSibling),G===null){G=null;break t}}Y=G.data,G=Y==="F!"||Y==="F"?G:null}if(G){$a=Bn(G.nextSibling),R=G.data==="F!";break e}}Jl(R)}R=!1}R&&(m=w[0])}}return w=Qo(),w.memoizedState=w.baseState=m,R={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fm,lastRenderedState:m},w.queue=R,w=xo.bind(null,hi,R),R.dispatch=w,R=_d(!1),Y=df.bind(null,hi,!1,R.queue),R=Qo(),G={state:m,dispatch:null,action:c,pending:null},R.queue=G,w=bt.bind(null,hi,G,Y,w),G.dispatch=w,R.memoizedState=c,[m,w,!1]}function Om(c){var m=no();return u_(m,Na,c)}function u_(c,m,w){if(m=sf(c,m,fm)[0],c=af(dh)[0],typeof m=="object"&&m!==null&&typeof m.then=="function")try{var R=zd(m)}catch(be){throw be===J?fe:be}else R=m;m=no();var G=m.queue,Y=G.dispatch;return w!==m.memoizedState&&(hi.flags|=2048,Gh(9,{destroy:void 0},pm.bind(null,G,w),null)),[R,Y,c]}function pm(c,m){c.action=m}function Pp(c){var m=no(),w=Na;if(w!==null)return u_(m,w,c);no(),m=m.memoizedState,w=no();var R=w.queue.dispatch;return w.memoizedState=c,[m,R,!1]}function Gh(c,m,w,R){return c={tag:c,create:w,deps:R,inst:m,next:null},m=hi.updateQueue,m===null&&(m=bu(),hi.updateQueue=m),w=m.lastEffect,w===null?m.lastEffect=c.next=c:(R=w.next,w.next=c,c.next=R,m.lastEffect=c),c}function ap(){return no().memoizedState}function of(c,m,w,R){var G=Qo();hi.flags|=c,G.memoizedState=Gh(1|m,{destroy:void 0},w,R===void 0?null:R)}function qu(c,m,w,R){var G=no();R=R===void 0?null:R;var Y=G.memoizedState.inst;Na!==null&&R!==null&&rf(R,Na.memoizedState.deps)?G.memoizedState=Gh(m,Y,w,R):(hi.flags|=c,G.memoizedState=Gh(1|m,Y,w,R))}function lf(c,m){of(8390656,8,c,m)}function vc(c,m){qu(2048,8,c,m)}function Lp(c){hi.flags|=4;var m=hi.updateQueue;if(m===null)m=bu(),hi.updateQueue=m,m.events=[c];else{var w=m.events;w===null?m.events=[c]:w.push(c)}}function sp(c){var m=no().memoizedState;return Lp({ref:m,nextImpl:c}),function(){if((At&2)!==0)throw Error(ue(440));return m.impl.apply(void 0,arguments)}}function mm(c,m){return qu(4,2,c,m)}function _m(c,m){return qu(4,4,c,m)}function Hh(c,m){if(typeof m=="function"){c=c();var w=m(c);return function(){typeof w=="function"?w():m(null)}}if(m!=null)return c=c(),m.current=c,function(){m.current=null}}function Ks(c,m,w){w=w!=null?w.concat([c]):null,qu(4,4,Hh.bind(null,m,c),w)}function Ld(){}function cf(c,m){var w=no();m=m===void 0?null:m;var R=w.memoizedState;return m!==null&&rf(m,R[1])?R[0]:(w.memoizedState=[c,m],c)}function Bm(c,m){var w=no();m=m===void 0?null:m;var R=w.memoizedState;if(m!==null&&rf(m,R[1]))return R[0];if(R=c(),vo){sr(!0);try{c()}finally{sr(!1)}}return w.memoizedState=[R,m],R}function Ja(c,m,w){return w===void 0||(Nl&1073741824)!==0&&(Kt&261930)===0?c.memoizedState=m:(c.memoizedState=w,c=yr(),hi.lanes|=c,Ei|=c,w)}function Yr(c,m,w,R){return _s(w,m)?w:Vs.current!==null?(c=Ja(c,w,R),_s(c,m)||(Oo=!0),c):(Nl&42)===0||(Nl&1073741824)!==0&&(Kt&261930)===0?(Oo=!0,c.memoizedState=w):(c=yr(),hi.lanes|=c,Ei|=c,m)}function op(c,m,w,R,G){var Y=xi.p;xi.p=Y!==0&&8>Y?Y:8;var be=si.T,Qe={};si.T=Qe,df(c,!1,m,w);try{var Ot=G(),Ri=si.S;if(Ri!==null&&Ri(Qe,Ot),Ot!==null&&typeof Ot=="object"&&typeof Ot.then=="function"){var sn=o(Ot,R);fh(c,m,sn,zr(c))}else fh(c,m,R,zr(c))}catch(hn){fh(c,m,{then:function(){},status:"rejected",reason:hn},zr())}finally{xi.p=Y,be!==null&&Qe.types!==null&&(be.types=Qe.types),si.T=be}}function uf(){}function kd(c,m,w,R){if(c.tag!==5)throw Error(ue(476));var G=hf(c).queue;op(c,G,m,Tn,w===null?uf:function(){return qh(c),w(R)})}function hf(c){var m=c.memoizedState;if(m!==null)return m;m={memoizedState:Tn,baseState:Tn,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:dh,lastRenderedState:Tn},next:null};var w={};return m.next={memoizedState:w,baseState:w,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:dh,lastRenderedState:w},next:null},c.memoizedState=m,c=c.alternate,c!==null&&(c.memoizedState=m),m}function qh(c){var m=hf(c);m.next===null&&(m=c.alternate.memoizedState),fh(c,m.next.queue,{},zr())}function kp(){return Ba(Cm)}function lp(){return no().memoizedState}function Fp(){return no().memoizedState}function cp(c){for(var m=c.return;m!==null;){switch(m.tag){case 24:case 3:var w=zr();c=Rn(w);var R=ir(m,c,w);R!==null&&(ga(R,m,w),Xr(R,m,w)),m={cache:fc()},c.payload=m;return}m=m.return}}function xc(c,m,w){var R=zr();w={lane:R,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},up(c)?Op(m,w):(w=Ph(c,m,w,R),w!==null&&(ga(w,c,R),Fd(w,m,R)))}function xo(c,m,w){var R=zr();fh(c,m,w,R)}function fh(c,m,w,R){var G={lane:R,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null};if(up(c))Op(m,G);else{var Y=c.alternate;if(c.lanes===0&&(Y===null||Y.lanes===0)&&(Y=m.lastRenderedReducer,Y!==null))try{var be=m.lastRenderedState,Qe=Y(be,w);if(G.hasEagerState=!0,G.eagerState=Qe,_s(Qe,be))return pi(c,m,G,0),Ct===null&&kl(),!1}catch{}finally{}if(w=Ph(c,m,G,R),w!==null)return ga(w,c,R),Fd(w,m,R),!0}return!1}function df(c,m,w,R){if(R={lane:2,revertLane:Xp(),gesture:null,action:R,hasEagerState:!1,eagerState:null,next:null},up(c)){if(m)throw Error(ue(479))}else m=Ph(c,w,R,2),m!==null&&ga(m,c,2)}function up(c){var m=c.alternate;return c===hi||m!==null&&m===hi}function Op(c,m){pn=Ko=!0;var w=c.pending;w===null?m.next=m:(m.next=w.next,w.next=m),c.pending=m}function Fd(c,m,w){if((w&4194048)!==0){var R=m.lanes;R&=c.pendingLanes,w|=R,m.lanes=w,Pi(c,w)}}var ff={readContext:Ba,use:Gu,useCallback:Ys,useContext:Ys,useEffect:Ys,useImperativeHandle:Ys,useLayoutEffect:Ys,useInsertionEffect:Ys,useMemo:Ys,useReducer:Ys,useRef:Ys,useState:Ys,useDebugValue:Ys,useDeferredValue:Ys,useTransition:Ys,useSyncExternalStore:Ys,useId:Ys,useHostTransitionStatus:Ys,useFormState:Ys,useActionState:Ys,useOptimistic:Ys,useMemoCache:Ys,useCacheRefresh:Ys};ff.useEffectEvent=Ys;var wu={readContext:Ba,use:Gu,useCallback:function(c,m){return Qo().memoizedState=[c,m===void 0?null:m],c},useContext:Ba,useEffect:lf,useImperativeHandle:function(c,m,w){w=w!=null?w.concat([c]):null,of(4194308,4,Hh.bind(null,m,c),w)},useLayoutEffect:function(c,m){return of(4194308,4,c,m)},useInsertionEffect:function(c,m){of(4,2,c,m)},useMemo:function(c,m){var w=Qo();m=m===void 0?null:m;var R=c();if(vo){sr(!0);try{c()}finally{sr(!1)}}return w.memoizedState=[R,m],R},useReducer:function(c,m,w){var R=Qo();if(w!==void 0){var G=w(m);if(vo){sr(!0);try{w(m)}finally{sr(!1)}}}else G=m;return R.memoizedState=R.baseState=G,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:G},R.queue=c,c=c.dispatch=xc.bind(null,hi,c),[R.memoizedState,c]},useRef:function(c){var m=Qo();return c={current:c},m.memoizedState=c},useState:function(c){c=_d(c);var m=c.queue,w=xo.bind(null,hi,m);return m.dispatch=w,[c.memoizedState,w]},useDebugValue:Ld,useDeferredValue:function(c,m){var w=Qo();return Ja(w,c,m)},useTransition:function(){var c=_d(!1);return c=op.bind(null,hi,c.queue,!0,!1),Qo().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,m,w){var R=hi,G=Qo();if(dn){if(w===void 0)throw Error(ue(407));w=w()}else{if(w=m(),Ct===null)throw Error(ue(349));(Kt&127)!==0||Hu(R,m,w)}G.memoizedState=w;var Y={value:w,getSnapshot:m};return G.queue=Y,lf(Dd.bind(null,R,Y,c),[c]),R.flags|=2048,Gh(9,{destroy:void 0},Jc.bind(null,R,Y,w,m),null),w},useId:function(){var c=Qo(),m=Ct.identifierPrefix;if(dn){var w=Fl,R=al;w=(R&~(1<<32-Xs(R)-1)).toString(32)+w,m="_"+m+"R_"+w,w=xl++,0<w&&(m+="H"+w.toString(32)),m+="_"}else w=jh++,m="_"+m+"r_"+w.toString(32)+"_";return c.memoizedState=m},useHostTransitionStatus:kp,useFormState:Pf,useActionState:Pf,useOptimistic:function(c){var m=Qo();m.memoizedState=m.baseState=c;var w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=w,m=df.bind(null,hi,!0,w),w.dispatch=m,[c,m]},useMemoCache:Ka,useCacheRefresh:function(){return Qo().memoizedState=cp.bind(null,hi)},useEffectEvent:function(c){var m=Qo(),w={impl:c};return m.memoizedState=w,function(){if((At&2)!==0)throw Error(ue(440));return w.impl.apply(void 0,arguments)}}},hp={readContext:Ba,use:Gu,useCallback:cf,useContext:Ba,useEffect:vc,useImperativeHandle:Ks,useInsertionEffect:mm,useLayoutEffect:_m,useMemo:Bm,useReducer:af,useRef:ap,useState:function(){return af(dh)},useDebugValue:Ld,useDeferredValue:function(c,m){var w=no();return Yr(w,Na.memoizedState,c,m)},useTransition:function(){var c=af(dh)[0],m=no().memoizedState;return[typeof c=="boolean"?c:zd(c),m]},useSyncExternalStore:Vh,useId:lp,useHostTransitionStatus:kp,useFormState:Om,useActionState:Om,useOptimistic:function(c,m){var w=no();return da(w,Na,c,m)},useMemoCache:Ka,useCacheRefresh:Fp};hp.useEffectEvent=sp;var dp={readContext:Ba,use:Gu,useCallback:cf,useContext:Ba,useEffect:vc,useImperativeHandle:Ks,useInsertionEffect:mm,useLayoutEffect:_m,useMemo:Bm,useReducer:Rd,useRef:ap,useState:function(){return Rd(dh)},useDebugValue:Ld,useDeferredValue:function(c,m){var w=no();return Na===null?Ja(w,c,m):Yr(w,Na.memoizedState,c,m)},useTransition:function(){var c=Rd(dh)[0],m=no().memoizedState;return[typeof c=="boolean"?c:zd(c),m]},useSyncExternalStore:Vh,useId:lp,useHostTransitionStatus:kp,useFormState:Pp,useActionState:Pp,useOptimistic:function(c,m){var w=no();return Na!==null?da(w,Na,c,m):(w.baseState=c,[c,w.queue.dispatch])},useMemoCache:Ka,useCacheRefresh:Fp};dp.useEffectEvent=sp;function Lf(c,m,w,R){m=c.memoizedState,w=w(R,m),w=w==null?m:it({},m,w),c.memoizedState=w,c.lanes===0&&(c.updateQueue.baseState=w)}var $h={enqueueSetState:function(c,m,w){c=c._reactInternals;var R=zr(),G=Rn(R);G.payload=m,w!=null&&(G.callback=w),m=ir(c,G,R),m!==null&&(ga(m,c,R),Xr(m,c,R))},enqueueReplaceState:function(c,m,w){c=c._reactInternals;var R=zr(),G=Rn(R);G.tag=1,G.payload=m,w!=null&&(G.callback=w),m=ir(c,G,R),m!==null&&(ga(m,c,R),Xr(m,c,R))},enqueueForceUpdate:function(c,m){c=c._reactInternals;var w=zr(),R=Rn(w);R.tag=2,m!=null&&(R.callback=m),m=ir(c,R,w),m!==null&&(ga(m,c,w),Xr(m,c,w))}};function co(c,m,w,R,G,Y,be){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(R,Y,be):m.prototype&&m.prototype.isPureReactComponent?!qa(w,R)||!qa(G,Y):!0}function kf(c,m,w,R){c=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(w,R),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(w,R),m.state!==c&&$h.enqueueReplaceState(m,m.state,null)}function Od(c,m){var w=m;if("ref"in m){w={};for(var R in m)R!=="ref"&&(w[R]=m[R])}if(c=c.defaultProps){w===m&&(w=it({},w));for(var G in c)w[G]===void 0&&(w[G]=c[G])}return w}function gm(c){uc(c)}function pf(c){console.error(c)}function ym(c){uc(c)}function fp(c,m){try{var w=c.onUncaughtError;w(m.value,{componentStack:m.stack})}catch(R){setTimeout(function(){throw R})}}function Ff(c,m,w){try{var R=c.onCaughtError;R(w.value,{componentStack:w.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(G){setTimeout(function(){throw G})}}function Tu(c,m,w){return w=Rn(w),w.tag=3,w.payload={element:null},w.callback=function(){fp(c,m)},w}function Fc(c){return c=Rn(c),c.tag=3,c}function Su(c,m,w,R){var G=w.type.getDerivedStateFromError;if(typeof G=="function"){var Y=R.value;c.payload=function(){return G(Y)},c.callback=function(){Ff(m,w,R)}}var be=w.stateNode;be!==null&&typeof be.componentDidCatch=="function"&&(c.callback=function(){Ff(m,w,R),typeof G!="function"&&(Jn===null?Jn=new Set([this]):Jn.add(this));var Qe=R.stack;this.componentDidCatch(R.value,{componentStack:Qe!==null?Qe:""})})}function Nm(c,m,w,R,G){if(w.flags|=32768,R!==null&&typeof R=="object"&&typeof R.then=="function"){if(m=w.alternate,m!==null&&fd(m,w,G,!0),w=Gs.current,w!==null){switch(w.tag){case 31:case 13:return ks===null?tc():w.alternate===null&&ki===0&&(ki=3),w.flags&=-257,w.flags|=65536,w.lanes=G,R===we?w.flags|=16384:(m=w.updateQueue,m===null?w.updateQueue=new Set([R]):m.add(R),Hm(c,R,G)),!1;case 22:return w.flags|=65536,R===we?w.flags|=16384:(m=w.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([R])},w.updateQueue=m):(w=m.retryQueue,w===null?m.retryQueue=new Set([R]):w.add(R)),Hm(c,R,G)),!1}throw Error(ue(435,w.tag))}return Hm(c,R,G),tc(),!1}if(dn)return m=Gs.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=G,R!==Bh&&(c=Error(ue(422),{cause:R}),dd(Wo(c,w)))):(R!==Bh&&(m=Error(ue(423),{cause:R}),dd(Wo(m,w))),c=c.current.alternate,c.flags|=65536,G&=-G,c.lanes|=G,R=Wo(R,w),G=Tu(c.stateNode,R,G),Fn(c,G),ki!==4&&(ki=2)),!1;var Y=Error(ue(520),{cause:R});if(Y=Wo(Y,w),en===null?en=[Y]:en.push(Y),ki!==4&&(ki=2),m===null)return!0;R=Wo(R,w),w=m;do{switch(w.tag){case 3:return w.flags|=65536,c=G&-G,w.lanes|=c,c=Tu(w.stateNode,R,c),Fn(w,c),!1;case 1:if(m=w.type,Y=w.stateNode,(w.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||Y!==null&&typeof Y.componentDidCatch=="function"&&(Jn===null||!Jn.has(Y))))return w.flags|=65536,G&=-G,w.lanes|=G,G=Fc(G),Su(G,c,w,R),Fn(w,G),!1}w=w.return}while(w!==null);return!1}var bo=Error(ue(461)),Oo=!1;function hl(c,m,w,R){m.child=c===null?An(m,null,w,R):Xi(m,c.child,w,R)}function mf(c,m,w,R,G){w=w.render;var Y=m.ref;if("ref"in R){var be={};for(var Qe in R)Qe!=="ref"&&(be[Qe]=R[Qe])}else be=R;return Yo(m),R=Uu(c,m,w,be,Y,G),Qe=Jo(),c!==null&&!Oo?(gc(c,m,G),$u(c,m,G)):(dn&&Qe&&Jd(m),m.flags|=1,hl(c,m,R,G),m.child)}function pp(c,m,w,R,G){if(c===null){var Y=w.type;return typeof Y=="function"&&!Ou(Y)&&Y.defaultProps===void 0&&w.compare===null?(m.tag=15,m.type=Y,Bd(c,m,Y,R,G)):(c=Lh(w.type,null,R,m,m.mode,G),c.ref=m.ref,c.return=m,m.child=c)}if(Y=c.child,!mh(c,G)){var be=Y.memoizedProps;if(w=w.compare,w=w!==null?w:qa,w(be,R)&&c.ref===m.ref)return $u(c,m,G)}return m.flags|=1,c=vl(Y,R),c.ref=m.ref,c.return=m,m.child=c}function Bd(c,m,w,R,G){if(c!==null){var Y=c.memoizedProps;if(qa(Y,R)&&c.ref===m.ref)if(Oo=!1,m.pendingProps=R=Y,mh(c,G))(c.flags&131072)!==0&&(Oo=!0);else return m.lanes=c.lanes,$u(c,m,G)}return jp(c,m,w,R,G)}function vm(c,m,w,R){var G=R.children,Y=c!==null?c.memoizedState:null;if(c===null&&m.stateNode===null&&(m.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),R.mode==="hidden"){if((m.flags&128)!==0){if(Y=Y!==null?Y.baseLanes|w:w,c!==null){for(R=m.child=c.child,G=0;R!==null;)G=G|R.lanes|R.childLanes,R=R.sibling;R=G&~Y}else R=0,m.child=null;return _f(c,m,Y,w,R)}if((w&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},c!==null&&P(m,Y!==null?Y.cachePool:null),Y!==null?pc(m,Y):Us(),Bl(m);else return R=m.lanes=536870912,_f(c,m,Y!==null?Y.baseLanes|w:w,w,R)}else Y!==null?(P(m,Y.cachePool),pc(m,Y),Kc(),m.memoizedState=null):(c!==null&&P(m,null),Us(),Kc());return hl(c,m,G,w),m.child}function Of(c,m){return c!==null&&c.tag===22||m.stateNode!==null||(m.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.sibling}function _f(c,m,w,R,G){var Y=M();return Y=Y===null?null:{parent:hs._currentValue,pool:Y},m.memoizedState={baseLanes:w,cachePool:Y},c!==null&&P(m,null),Us(),Bl(m),c!==null&&fd(c,m,R,!0),m.childLanes=G,null}function Nd(c,m){return m=Vp({mode:m.mode,children:m.children},c.mode),m.ref=c.ref,c.child=m,m.return=c,m}function Bp(c,m,w){return Xi(m,c.child,null,w),c=Nd(m,m.pendingProps),c.flags|=2,ul(m),m.memoizedState=null,c}function Np(c,m,w){var R=m.pendingProps,G=(m.flags&128)!==0;if(m.flags&=-129,c===null){if(dn){if(R.mode==="hidden")return c=Nd(m,R),m.lanes=536870912,Of(null,c);if(mc(m),(c=$a)?(c=Fi(c,dc),c=c!==null&&c.data==="&"?c:null,c!==null&&(m.memoizedState={dehydrated:c,treeContext:ka!==null?{id:al,overflow:Fl}:null,retryLane:536870912,hydrationErrors:null},w=Wd(c),w.return=m,m.child=w,yo=m,$a=null)):c=null,c===null)throw Jl(m);return m.lanes=536870912,null}return Nd(m,R)}var Y=c.memoizedState;if(Y!==null){var be=Y.dehydrated;if(mc(m),G)if(m.flags&256)m.flags&=-257,m=Bp(c,m,w);else if(m.memoizedState!==null)m.child=c.child,m.flags|=128,m=null;else throw Error(ue(558));else if(Oo||fd(c,m,w,!1),G=(w&c.childLanes)!==0,Oo||G){if(R=Ct,R!==null&&(be=fi(R,w),be!==0&&be!==Y.retryLane))throw Y.retryLane=be,_u(c,be),ga(R,c,be),bo;tc(),m=Bp(c,m,w)}else c=Y.treeContext,$a=Bn(be.nextSibling),yo=m,dn=!0,Wc=null,dc=!1,c!==null&&Oh(m,c),m=Nd(m,R),m.flags|=4096;return m}return c=vl(c.child,{mode:R.mode,children:R.children}),c.ref=m.ref,m.child=c,c.return=m,c}function gf(c,m){var w=m.ref;if(w===null)c!==null&&c.ref!==null&&(m.flags|=4194816);else{if(typeof w!="function"&&typeof w!="object")throw Error(ue(284));(c===null||c.ref!==w)&&(m.flags|=4194816)}}function jp(c,m,w,R,G){return Yo(m),w=Uu(c,m,w,R,void 0,G),R=Jo(),c!==null&&!Oo?(gc(c,m,G),$u(c,m,G)):(dn&&R&&Jd(m),m.flags|=1,hl(c,m,w,G),m.child)}function mp(c,m,w,R,G,Y){return Yo(m),m.updateQueue=null,w=qo(m,R,w,G),Dp(c),R=Jo(),c!==null&&!Oo?(gc(c,m,Y),$u(c,m,Y)):(dn&&R&&Jd(m),m.flags|=1,hl(c,m,w,Y),m.child)}function _p(c,m,w,R,G){if(Yo(m),m.stateNode===null){var Y=gl,be=w.contextType;typeof be=="object"&&be!==null&&(Y=Ba(be)),Y=new w(R,Y),m.memoizedState=Y.state!==null&&Y.state!==void 0?Y.state:null,Y.updater=$h,m.stateNode=Y,Y._reactInternals=m,Y=m.stateNode,Y.props=R,Y.state=m.memoizedState,Y.refs={},Zn(m),be=w.contextType,Y.context=typeof be=="object"&&be!==null?Ba(be):gl,Y.state=m.memoizedState,be=w.getDerivedStateFromProps,typeof be=="function"&&(Lf(m,w,be,R),Y.state=m.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof Y.getSnapshotBeforeUpdate=="function"||typeof Y.UNSAFE_componentWillMount!="function"&&typeof Y.componentWillMount!="function"||(be=Y.state,typeof Y.componentWillMount=="function"&&Y.componentWillMount(),typeof Y.UNSAFE_componentWillMount=="function"&&Y.UNSAFE_componentWillMount(),be!==Y.state&&$h.enqueueReplaceState(Y,Y.state,null),is(m,R,Y,G),ea(),Y.state=m.memoizedState),typeof Y.componentDidMount=="function"&&(m.flags|=4194308),R=!0}else if(c===null){Y=m.stateNode;var Qe=m.memoizedProps,Ot=Od(w,Qe);Y.props=Ot;var Ri=Y.context,sn=w.contextType;be=gl,typeof sn=="object"&&sn!==null&&(be=Ba(sn));var hn=w.getDerivedStateFromProps;sn=typeof hn=="function"||typeof Y.getSnapshotBeforeUpdate=="function",Qe=m.pendingProps!==Qe,sn||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(Qe||Ri!==be)&&kf(m,Y,R,be),Cn=!1;var Oi=m.memoizedState;Y.state=Oi,is(m,R,Y,G),ea(),Ri=m.memoizedState,Qe||Oi!==Ri||Cn?(typeof hn=="function"&&(Lf(m,w,hn,R),Ri=m.memoizedState),(Ot=Cn||co(m,w,Ot,R,Oi,Ri,be))?(sn||typeof Y.UNSAFE_componentWillMount!="function"&&typeof Y.componentWillMount!="function"||(typeof Y.componentWillMount=="function"&&Y.componentWillMount(),typeof Y.UNSAFE_componentWillMount=="function"&&Y.UNSAFE_componentWillMount()),typeof Y.componentDidMount=="function"&&(m.flags|=4194308)):(typeof Y.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=R,m.memoizedState=Ri),Y.props=R,Y.state=Ri,Y.context=be,R=Ot):(typeof Y.componentDidMount=="function"&&(m.flags|=4194308),R=!1)}else{Y=m.stateNode,Ln(c,m),be=m.memoizedProps,sn=Od(w,be),Y.props=sn,hn=m.pendingProps,Oi=Y.context,Ri=w.contextType,Ot=gl,typeof Ri=="object"&&Ri!==null&&(Ot=Ba(Ri)),Qe=w.getDerivedStateFromProps,(Ri=typeof Qe=="function"||typeof Y.getSnapshotBeforeUpdate=="function")||typeof Y.UNSAFE_componentWillReceiveProps!="function"&&typeof Y.componentWillReceiveProps!="function"||(be!==hn||Oi!==Ot)&&kf(m,Y,R,Ot),Cn=!1,Oi=m.memoizedState,Y.state=Oi,is(m,R,Y,G),ea();var Hi=m.memoizedState;be!==hn||Oi!==Hi||Cn||c!==null&&c.dependencies!==null&&ef(c.dependencies)?(typeof Qe=="function"&&(Lf(m,w,Qe,R),Hi=m.memoizedState),(sn=Cn||co(m,w,sn,R,Oi,Hi,Ot)||c!==null&&c.dependencies!==null&&ef(c.dependencies))?(Ri||typeof Y.UNSAFE_componentWillUpdate!="function"&&typeof Y.componentWillUpdate!="function"||(typeof Y.componentWillUpdate=="function"&&Y.componentWillUpdate(R,Hi,Ot),typeof Y.UNSAFE_componentWillUpdate=="function"&&Y.UNSAFE_componentWillUpdate(R,Hi,Ot)),typeof Y.componentDidUpdate=="function"&&(m.flags|=4),typeof Y.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof Y.componentDidUpdate!="function"||be===c.memoizedProps&&Oi===c.memoizedState||(m.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||be===c.memoizedProps&&Oi===c.memoizedState||(m.flags|=1024),m.memoizedProps=R,m.memoizedState=Hi),Y.props=R,Y.state=Hi,Y.context=Ot,R=sn):(typeof Y.componentDidUpdate!="function"||be===c.memoizedProps&&Oi===c.memoizedState||(m.flags|=4),typeof Y.getSnapshotBeforeUpdate!="function"||be===c.memoizedProps&&Oi===c.memoizedState||(m.flags|=1024),R=!1)}return Y=R,gf(c,m),R=(m.flags&128)!==0,Y||R?(Y=m.stateNode,w=R&&typeof w.getDerivedStateFromError!="function"?null:Y.render(),m.flags|=1,c!==null&&R?(m.child=Xi(m,c.child,null,G),m.child=Xi(m,null,w,G)):hl(c,m,w,G),m.memoizedState=Y.state,c=m.child):c=$u(c,m,G),c}function jm(c,m,w,R){return Xc(),m.flags|=256,hl(c,m,w,R),m.child}var Vm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xm(c){return{baseLanes:c,cachePool:q()}}function Ss(c,m,w){return c=c!==null?c.childLanes&~w:0,m&&(c|=nn),c}function ph(c,m,w){var R=m.pendingProps,G=!1,Y=(m.flags&128)!==0,be;if((be=Y)||(be=c!==null&&c.memoizedState===null?!1:(Fs.current&2)!==0),be&&(G=!0,m.flags&=-129),be=(m.flags&32)!==0,m.flags&=-33,c===null){if(dn){if(G?Ro(m):Kc(),(c=$a)?(c=Fi(c,dc),c=c!==null&&c.data!=="&"?c:null,c!==null&&(m.memoizedState={dehydrated:c,treeContext:ka!==null?{id:al,overflow:Fl}:null,retryLane:536870912,hydrationErrors:null},w=Wd(c),w.return=m,m.child=w,yo=m,$a=null)):c=null,c===null)throw Jl(m);return Xn(c)?m.lanes=32:m.lanes=536870912,null}var Qe=R.children;return R=R.fallback,G?(Kc(),G=m.mode,Qe=Vp({mode:"hidden",children:Qe},G),R=kc(R,G,w,null),Qe.return=m,R.return=m,Qe.sibling=R,m.child=Qe,R=m.child,R.memoizedState=xm(w),R.childLanes=Ss(c,be,w),m.memoizedState=Vm,Of(null,R)):(Ro(m),Um(m,Qe))}var Ot=c.memoizedState;if(Ot!==null&&(Qe=Ot.dehydrated,Qe!==null)){if(Y)m.flags&256?(Ro(m),m.flags&=-257,m=yf(c,m,w)):m.memoizedState!==null?(Kc(),m.child=c.child,m.flags|=128,m=null):(Kc(),Qe=R.fallback,G=m.mode,R=Vp({mode:"visible",children:R.children},G),Qe=kc(Qe,G,w,null),Qe.flags|=2,R.return=m,Qe.return=m,R.sibling=Qe,m.child=R,Xi(m,c.child,null,w),R=m.child,R.memoizedState=xm(w),R.childLanes=Ss(c,be,w),m.memoizedState=Vm,m=Of(null,R));else if(Ro(m),Xn(Qe)){if(be=Qe.nextSibling&&Qe.nextSibling.dataset,be)var Ri=be.dgst;be=Ri,R=Error(ue(419)),R.stack="",R.digest=be,dd({value:R,source:null,stack:null}),m=yf(c,m,w)}else if(Oo||fd(c,m,w,!1),be=(w&c.childLanes)!==0,Oo||be){if(be=Ct,be!==null&&(R=fi(be,w),R!==0&&R!==Ot.retryLane))throw Ot.retryLane=R,_u(c,R),ga(be,c,R),bo;gn(Qe)||tc(),m=yf(c,m,w)}else gn(Qe)?(m.flags|=192,m.child=c.child,m=null):(c=Ot.treeContext,$a=Bn(Qe.nextSibling),yo=m,dn=!0,Wc=null,dc=!1,c!==null&&Oh(m,c),m=Um(m,R.children),m.flags|=4096);return m}return G?(Kc(),Qe=R.fallback,G=m.mode,Ot=c.child,Ri=Ot.sibling,R=vl(Ot,{mode:"hidden",children:R.children}),R.subtreeFlags=Ot.subtreeFlags&65011712,Ri!==null?Qe=vl(Ri,Qe):(Qe=kc(Qe,G,w,null),Qe.flags|=2),Qe.return=m,R.return=m,R.sibling=Qe,m.child=R,Of(null,R),R=m.child,Qe=c.child.memoizedState,Qe===null?Qe=xm(w):(G=Qe.cachePool,G!==null?(Ot=hs._currentValue,G=G.parent!==Ot?{parent:Ot,pool:Ot}:G):G=q(),Qe={baseLanes:Qe.baseLanes|w,cachePool:G}),R.memoizedState=Qe,R.childLanes=Ss(c,be,w),m.memoizedState=Vm,Of(c.child,R)):(Ro(m),w=c.child,c=w.sibling,w=vl(w,{mode:"visible",children:R.children}),w.return=m,w.sibling=null,c!==null&&(be=m.deletions,be===null?(m.deletions=[c],m.flags|=16):be.push(c)),m.child=w,m.memoizedState=null,w)}function Um(c,m){return m=Vp({mode:"visible",children:m},c.mode),m.return=c,c.child=m}function Vp(c,m){return c=yl(22,c,null,m),c.lanes=0,c}function yf(c,m,w){return Xi(m,c.child,null,w),c=Um(m,m.pendingProps.children),c.flags|=2,m.memoizedState=null,c}function gp(c,m,w){c.lanes|=m;var R=c.alternate;R!==null&&(R.lanes|=m),Rp(c.return,m,w)}function Up(c,m,w,R,G,Y){var be=c.memoizedState;be===null?c.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:R,tail:w,tailMode:G,treeForkCount:Y}:(be.isBackwards=m,be.rendering=null,be.renderingStartTime=0,be.last=R,be.tail=w,be.tailMode=G,be.treeForkCount=Y)}function bm(c,m,w){var R=m.pendingProps,G=R.revealOrder,Y=R.tail;R=R.children;var be=Fs.current,Qe=(be&2)!==0;if(Qe?(be=be&1|2,m.flags|=128):be&=1,mi(Fs,be),hl(c,m,R,w),R=dn?Kd:0,!Qe&&c!==null&&(c.flags&128)!==0)e:for(c=m.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&gp(c,w,m);else if(c.tag===19)gp(c,w,m);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===m)break e;for(;c.sibling===null;){if(c.return===null||c.return===m)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(G){case"forwards":for(w=m.child,G=null;w!==null;)c=w.alternate,c!==null&&xu(c)===null&&(G=w),w=w.sibling;w=G,w===null?(G=m.child,m.child=null):(G=w.sibling,w.sibling=null),Up(m,!1,G,w,Y,R);break;case"backwards":case"unstable_legacy-backwards":for(w=null,G=m.child,m.child=null;G!==null;){if(c=G.alternate,c!==null&&xu(c)===null){m.child=G;break}c=G.sibling,G.sibling=w,w=G,G=c}Up(m,!0,w,null,Y,R);break;case"together":Up(m,!1,null,null,void 0,R);break;default:m.memoizedState=null}return m.child}function $u(c,m,w){if(c!==null&&(m.dependencies=c.dependencies),Ei|=m.lanes,(w&m.childLanes)===0)if(c!==null){if(fd(c,m,w,!1),(w&m.childLanes)===0)return null}else return null;if(c!==null&&m.child!==c.child)throw Error(ue(153));if(m.child!==null){for(c=m.child,w=vl(c,c.pendingProps),m.child=w,w.return=m;c.sibling!==null;)c=c.sibling,w=w.sibling=vl(c,c.pendingProps),w.return=m;w.sibling=null}return m.child}function mh(c,m){return(c.lanes&m)!==0?!0:(c=c.dependencies,!!(c!==null&&ef(c)))}function wm(c,m,w){switch(m.tag){case 3:gr(m,m.stateNode.containerInfo),ch(m,hs,c.memoizedState.cache),Xc();break;case 27:case 5:Lr(m);break;case 4:gr(m,m.stateNode.containerInfo);break;case 10:ch(m,m.type,m.memoizedProps.value);break;case 31:if(m.memoizedState!==null)return m.flags|=128,mc(m),null;break;case 13:var R=m.memoizedState;if(R!==null)return R.dehydrated!==null?(Ro(m),m.flags|=128,null):(w&m.child.childLanes)!==0?ph(c,m,w):(Ro(m),c=$u(c,m,w),c!==null?c.sibling:null);Ro(m);break;case 19:var G=(c.flags&128)!==0;if(R=(w&m.childLanes)!==0,R||(fd(c,m,w,!1),R=(w&m.childLanes)!==0),G){if(R)return bm(c,m,w);m.flags|=128}if(G=m.memoizedState,G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),mi(Fs,Fs.current),R)break;return null;case 22:return m.lanes=0,vm(c,m,w,m.pendingProps);case 24:ch(m,hs,c.memoizedState.cache)}return $u(c,m,w)}function Bo(c,m,w){if(c!==null)if(c.memoizedProps!==m.pendingProps)Oo=!0;else{if(!mh(c,w)&&(m.flags&128)===0)return Oo=!1,wm(c,m,w);Oo=(c.flags&131072)!==0}else Oo=!1,dn&&(m.flags&1048576)!==0&&Df(m,Kd,m.index);switch(m.lanes=0,m.tag){case 16:e:{var R=m.pendingProps;if(c=Ke(m.elementType),m.type=c,typeof c=="function")Ou(c)?(R=Od(c,R),m.tag=1,m=_p(null,m,c,R,w)):(m.tag=0,m=jp(null,m,c,R,w));else{if(c!=null){var G=c.$$typeof;if(G===Un){m.tag=11,m=mf(null,m,c,R,w);break e}else if(G===mn){m.tag=14,m=pp(null,m,c,R,w);break e}}throw m=cr(c)||c,Error(ue(306,m,""))}}return m;case 0:return jp(c,m,m.type,m.pendingProps,w);case 1:return R=m.type,G=Od(R,m.pendingProps),_p(c,m,R,G,w);case 3:e:{if(gr(m,m.stateNode.containerInfo),c===null)throw Error(ue(387));R=m.pendingProps;var Y=m.memoizedState;G=Y.element,Ln(c,m),is(m,R,null,w);var be=m.memoizedState;if(R=be.cache,ch(m,hs,R),R!==Y.cache&&Cd(m,[hs],w,!0),ea(),R=be.element,Y.isDehydrated)if(Y={element:R,isDehydrated:!1,cache:be.cache},m.updateQueue.baseState=Y,m.memoizedState=Y,m.flags&256){m=jm(c,m,R,w);break e}else if(R!==G){G=Wo(Error(ue(424)),m),dd(G),m=jm(c,m,R,w);break e}else{switch(c=m.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for($a=Bn(c.firstChild),yo=m,dn=!0,Wc=null,dc=!0,w=An(m,null,R,w),m.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling}else{if(Xc(),R===G){m=$u(c,m,w);break e}hl(c,m,R,w)}m=m.child}return m;case 26:return gf(c,m),c===null?(w=Sc(m.type,null,m.pendingProps,null))?m.memoizedState=w:dn||(w=m.type,c=m.pendingProps,R=z(vr.current).createElement(w),R[te]=m,R[_e]=c,wc(R,w,c),ji(R),m.stateNode=R):m.memoizedState=Sc(m.type,c.memoizedProps,m.pendingProps,c.memoizedState),null;case 27:return Lr(m),c===null&&dn&&(R=m.stateNode=nr(m.type,m.pendingProps,vr.current),yo=m,dc=!0,G=$a,Je(m.type)?(Mn=G,$a=Bn(R.firstChild)):$a=G),hl(c,m,m.pendingProps.children,w),gf(c,m),c===null&&(m.flags|=4194304),m.child;case 5:return c===null&&dn&&((G=R=$a)&&(R=Vt(R,m.type,m.pendingProps,dc),R!==null?(m.stateNode=R,yo=m,$a=Bn(R.firstChild),dc=!1,G=!0):G=!1),G||Jl(m)),Lr(m),G=m.type,Y=m.pendingProps,be=c!==null?c.memoizedProps:null,R=Y.children,H(G,Y)?R=null:be!==null&&H(G,be)&&(m.flags|=32),m.memoizedState!==null&&(G=Uu(c,m,rp,null,null,w),Cm._currentValue=G),gf(c,m),hl(c,m,R,w),m.child;case 6:return c===null&&dn&&((c=w=$a)&&(w=ii(w,m.pendingProps,dc),w!==null?(m.stateNode=w,yo=m,$a=null,c=!0):c=!1),c||Jl(m)),null;case 13:return ph(c,m,w);case 4:return gr(m,m.stateNode.containerInfo),R=m.pendingProps,c===null?m.child=Xi(m,null,R,w):hl(c,m,R,w),m.child;case 11:return mf(c,m,m.type,m.pendingProps,w);case 7:return hl(c,m,m.pendingProps,w),m.child;case 8:return hl(c,m,m.pendingProps.children,w),m.child;case 12:return hl(c,m,m.pendingProps.children,w),m.child;case 10:return R=m.pendingProps,ch(m,m.type,R.value),hl(c,m,R.children,w),m.child;case 9:return G=m.type._context,R=m.pendingProps.children,Yo(m),G=Ba(G),R=R(G),m.flags|=1,hl(c,m,R,w),m.child;case 14:return pp(c,m,m.type,m.pendingProps,w);case 15:return Bd(c,m,m.type,m.pendingProps,w);case 19:return bm(c,m,w);case 31:return Np(c,m,w);case 22:return vm(c,m,w,m.pendingProps);case 24:return Yo(m),R=Ba(hs),c===null?(G=M(),G===null&&(G=Ct,Y=fc(),G.pooledCache=Y,Y.refCount++,Y!==null&&(G.pooledCacheLanes|=w),G=Y),m.memoizedState={parent:R,cache:G},Zn(m),ch(m,hs,G)):((c.lanes&w)!==0&&(Ln(c,m),is(m,null,null,w),ea()),G=c.memoizedState,Y=m.memoizedState,G.parent!==R?(G={parent:R,cache:R},m.memoizedState=G,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=G),ch(m,hs,R)):(R=Y.cache,ch(m,hs,R),R!==G.cache&&Cd(m,[hs],w,!0))),hl(c,m,m.pendingProps.children,w),m.child;case 29:throw m.pendingProps}throw Error(ue(156,m.tag))}function Ql(c){c.flags|=4}function Bf(c,m,w,R,G){if((m=(c.mode&32)!==0)&&(m=!1),m){if(c.flags|=16777216,(G&335544128)===G)if(c.stateNode.complete)c.flags|=8192;else if(dl())c.flags|=8192;else throw ot=we,ne}else c.flags&=-16777217}function Nf(c,m){if(m.type!=="stylesheet"||(m.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!El(m))if(dl())c.flags|=8192;else throw ot=we,ne}function _h(c,m){m!==null&&(c.flags|=4),c.flags&16384&&(m=c.tag!==22?gt():536870912,c.lanes|=m,$i|=m)}function jf(c,m){if(!dn)switch(c.tailMode){case"hidden":m=c.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?c.tail=null:w.sibling=null;break;case"collapsed":w=c.tail;for(var R=null;w!==null;)w.alternate!==null&&(R=w),w=w.sibling;R===null?m||c.tail===null?c.tail=null:c.tail.sibling=null:R.sibling=null}}function uo(c){var m=c.alternate!==null&&c.alternate.child===c.child,w=0,R=0;if(m)for(var G=c.child;G!==null;)w|=G.lanes|G.childLanes,R|=G.subtreeFlags&65011712,R|=G.flags&65011712,G.return=c,G=G.sibling;else for(G=c.child;G!==null;)w|=G.lanes|G.childLanes,R|=G.subtreeFlags,R|=G.flags,G.return=c,G=G.sibling;return c.subtreeFlags|=R,c.childLanes=w,m}function Tm(c,m,w){var R=m.pendingProps;switch(oh(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return uo(m),null;case 1:return uo(m),null;case 3:return w=m.stateNode,R=null,c!==null&&(R=c.memoizedState.cache),m.memoizedState.cache!==R&&(m.flags|=2048),uh(hs),In(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(c===null||c.child===null)&&(Ra(m)?Ql(m):c===null||c.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,ip())),uo(m),null;case 26:var G=m.type,Y=m.memoizedState;return c===null?(Ql(m),Y!==null?(uo(m),Nf(m,Y)):(uo(m),Bf(m,G,null,R,w))):Y?Y!==c.memoizedState?(Ql(m),uo(m),Nf(m,Y)):(uo(m),m.flags&=-16777217):(c=c.memoizedProps,c!==R&&Ql(m),uo(m),Bf(m,G,c,R,w)),null;case 27:if(br(m),w=vr.current,G=m.type,c!==null&&m.stateNode!=null)c.memoizedProps!==R&&Ql(m);else{if(!R){if(m.stateNode===null)throw Error(ue(166));return uo(m),null}c=vn.current,Ra(m)?lh(m):(c=nr(G,R,w),m.stateNode=c,Ql(m))}return uo(m),null;case 5:if(br(m),G=m.type,c!==null&&m.stateNode!=null)c.memoizedProps!==R&&Ql(m);else{if(!R){if(m.stateNode===null)throw Error(ue(166));return uo(m),null}if(Y=vn.current,Ra(m))lh(m);else{var be=z(vr.current);switch(Y){case 1:Y=be.createElementNS("http://www.w3.org/2000/svg",G);break;case 2:Y=be.createElementNS("http://www.w3.org/1998/Math/MathML",G);break;default:switch(G){case"svg":Y=be.createElementNS("http://www.w3.org/2000/svg",G);break;case"math":Y=be.createElementNS("http://www.w3.org/1998/Math/MathML",G);break;case"script":Y=be.createElement("div"),Y.innerHTML="<script><\/script>",Y=Y.removeChild(Y.firstChild);break;case"select":Y=typeof R.is=="string"?be.createElement("select",{is:R.is}):be.createElement("select"),R.multiple?Y.multiple=!0:R.size&&(Y.size=R.size);break;default:Y=typeof R.is=="string"?be.createElement(G,{is:R.is}):be.createElement(G)}}Y[te]=m,Y[_e]=R;e:for(be=m.child;be!==null;){if(be.tag===5||be.tag===6)Y.appendChild(be.stateNode);else if(be.tag!==4&&be.tag!==27&&be.child!==null){be.child.return=be,be=be.child;continue}if(be===m)break e;for(;be.sibling===null;){if(be.return===null||be.return===m)break e;be=be.return}be.sibling.return=be.return,be=be.sibling}m.stateNode=Y;e:switch(wc(Y,G,R),G){case"button":case"input":case"select":case"textarea":R=!!R.autoFocus;break e;case"img":R=!0;break e;default:R=!1}R&&Ql(m)}}return uo(m),Bf(m,m.type,c===null?null:c.memoizedProps,m.pendingProps,w),null;case 6:if(c&&m.stateNode!=null)c.memoizedProps!==R&&Ql(m);else{if(typeof R!="string"&&m.stateNode===null)throw Error(ue(166));if(c=vr.current,Ra(m)){if(c=m.stateNode,w=m.memoizedProps,R=null,G=yo,G!==null)switch(G.tag){case 27:case 5:R=G.memoizedProps}c[te]=m,c=!!(c.nodeValue===w||R!==null&&R.suppressHydrationWarning===!0||wf(c.nodeValue,w)),c||Jl(m,!0)}else c=z(c).createTextNode(R),c[te]=m,m.stateNode=c}return uo(m),null;case 31:if(w=m.memoizedState,c===null||c.memoizedState!==null){if(R=Ra(m),w!==null){if(c===null){if(!R)throw Error(ue(318));if(c=m.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ue(557));c[te]=m}else Xc(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;uo(m),c=!1}else w=ip(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=w),c=!0;if(!c)return m.flags&256?(ul(m),m):(ul(m),null);if((m.flags&128)!==0)throw Error(ue(558))}return uo(m),null;case 13:if(R=m.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(G=Ra(m),R!==null&&R.dehydrated!==null){if(c===null){if(!G)throw Error(ue(318));if(G=m.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(ue(317));G[te]=m}else Xc(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;uo(m),G=!1}else G=ip(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=G),G=!0;if(!G)return m.flags&256?(ul(m),m):(ul(m),null)}return ul(m),(m.flags&128)!==0?(m.lanes=w,m):(w=R!==null,c=c!==null&&c.memoizedState!==null,w&&(R=m.child,G=null,R.alternate!==null&&R.alternate.memoizedState!==null&&R.alternate.memoizedState.cachePool!==null&&(G=R.alternate.memoizedState.cachePool.pool),Y=null,R.memoizedState!==null&&R.memoizedState.cachePool!==null&&(Y=R.memoizedState.cachePool.pool),Y!==G&&(R.flags|=2048)),w!==c&&w&&(m.child.flags|=8192),_h(m,m.updateQueue),uo(m),null);case 4:return In(),c===null&&wl(m.stateNode.containerInfo),uo(m),null;case 10:return uh(m.type),uo(m),null;case 19:if(di(Fs),R=m.memoizedState,R===null)return uo(m),null;if(G=(m.flags&128)!==0,Y=R.rendering,Y===null)if(G)jf(R,!1);else{if(ki!==0||c!==null&&(c.flags&128)!==0)for(c=m.child;c!==null;){if(Y=xu(c),Y!==null){for(m.flags|=128,jf(R,!1),c=Y.updateQueue,m.updateQueue=c,_h(m,c),m.subtreeFlags=0,c=w,w=m.child;w!==null;)Bu(w,c),w=w.sibling;return mi(Fs,Fs.current&1|2),dn&&Nu(m,R.treeForkCount),m.child}c=c.sibling}R.tail!==null&&Mr()>_n&&(m.flags|=128,G=!0,jf(R,!1),m.lanes=4194304)}else{if(!G)if(c=xu(Y),c!==null){if(m.flags|=128,G=!0,c=c.updateQueue,m.updateQueue=c,_h(m,c),jf(R,!0),R.tail===null&&R.tailMode==="hidden"&&!Y.alternate&&!dn)return uo(m),null}else 2*Mr()-R.renderingStartTime>_n&&w!==536870912&&(m.flags|=128,G=!0,jf(R,!1),m.lanes=4194304);R.isBackwards?(Y.sibling=m.child,m.child=Y):(c=R.last,c!==null?c.sibling=Y:m.child=Y,R.last=Y)}return R.tail!==null?(c=R.tail,R.rendering=c,R.tail=c.sibling,R.renderingStartTime=Mr(),c.sibling=null,w=Fs.current,mi(Fs,G?w&1|2:w&1),dn&&Nu(m,R.treeForkCount),c):(uo(m),null);case 22:case 23:return ul(m),Fo(),R=m.memoizedState!==null,c!==null?c.memoizedState!==null!==R&&(m.flags|=8192):R&&(m.flags|=8192),R?(w&536870912)!==0&&(m.flags&128)===0&&(uo(m),m.subtreeFlags&6&&(m.flags|=8192)):uo(m),w=m.updateQueue,w!==null&&_h(m,w.retryQueue),w=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(w=c.memoizedState.cachePool.pool),R=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(R=m.memoizedState.cachePool.pool),R!==w&&(m.flags|=2048),c!==null&&di(A),null;case 24:return w=null,c!==null&&(w=c.memoizedState.cache),m.memoizedState.cache!==w&&(m.flags|=2048),uh(hs),uo(m),null;case 25:return null;case 30:return null}throw Error(ue(156,m.tag))}function h_(c,m){switch(oh(m),m.tag){case 1:return c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 3:return uh(hs),In(),c=m.flags,(c&65536)!==0&&(c&128)===0?(m.flags=c&-65537|128,m):null;case 26:case 27:case 5:return br(m),null;case 31:if(m.memoizedState!==null){if(ul(m),m.alternate===null)throw Error(ue(340));Xc()}return c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 13:if(ul(m),c=m.memoizedState,c!==null&&c.dehydrated!==null){if(m.alternate===null)throw Error(ue(340));Xc()}return c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 19:return di(Fs),null;case 4:return In(),null;case 10:return uh(m.type),null;case 22:case 23:return ul(m),Fo(),c!==null&&di(A),c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 24:return uh(hs),null;case 25:return null;default:return null}}function Gp(c,m){switch(oh(m),m.tag){case 3:uh(hs),In();break;case 26:case 27:case 5:br(m);break;case 4:In();break;case 31:m.memoizedState!==null&&ul(m);break;case 13:ul(m);break;case 19:di(Fs);break;case 10:uh(m.type);break;case 22:case 23:ul(m),Fo(),c!==null&&di(A);break;case 24:uh(hs)}}function Vf(c,m){try{var w=m.updateQueue,R=w!==null?w.lastEffect:null;if(R!==null){var G=R.next;w=G;do{if((w.tag&c)===c){R=void 0;var Y=w.create,be=w.inst;R=Y(),be.destroy=R}w=w.next}while(w!==G)}}catch(Qe){ds(m,m.return,Qe)}}function Oc(c,m,w){try{var R=m.updateQueue,G=R!==null?R.lastEffect:null;if(G!==null){var Y=G.next;R=Y;do{if((R.tag&c)===c){var be=R.inst,Qe=be.destroy;if(Qe!==void 0){be.destroy=void 0,G=m;var Ot=w,Ri=Qe;try{Ri()}catch(sn){ds(G,Ot,sn)}}}R=R.next}while(R!==Y)}}catch(sn){ds(m,m.return,sn)}}function Uf(c){var m=c.updateQueue;if(m!==null){var w=c.stateNode;try{Ya(m,w)}catch(R){ds(c,c.return,R)}}}function Gf(c,m,w){w.props=Od(c.type,c.memoizedProps),w.state=c.memoizedState;try{w.componentWillUnmount()}catch(R){ds(c,m,R)}}function Zu(c,m){try{var w=c.ref;if(w!==null){switch(c.tag){case 26:case 27:case 5:var R=c.stateNode;break;case 30:R=c.stateNode;break;default:R=c.stateNode}typeof w=="function"?c.refCleanup=w(R):w.current=R}}catch(G){ds(c,m,G)}}function ec(c,m){var w=c.ref,R=c.refCleanup;if(w!==null)if(typeof R=="function")try{R()}catch(G){ds(c,m,G)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof w=="function")try{w(null)}catch(G){ds(c,m,G)}else w.current=null}function yd(c){var m=c.type,w=c.memoizedProps,R=c.stateNode;try{e:switch(m){case"button":case"input":case"select":case"textarea":w.autoFocus&&R.focus();break e;case"img":w.src?R.src=w.src:w.srcSet&&(R.srcset=w.srcSet)}}catch(G){ds(c,c.return,G)}}function vd(c,m,w){try{var R=c.stateNode;xg(R,c.type,w,m),R[_e]=m}catch(G){ds(c,c.return,G)}}function gh(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&Je(c.type)||c.tag===4}function Sm(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||gh(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&Je(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Hp(c,m,w){var R=c.tag;if(R===5||R===6)c=c.stateNode,m?(w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w).insertBefore(c,m):(m=w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w,m.appendChild(c),w=w._reactRootContainer,w!=null||m.onclick!==null||(m.onclick=_o));else if(R!==4&&(R===27&&Je(c.type)&&(w=c.stateNode,m=null),c=c.child,c!==null))for(Hp(c,m,w),c=c.sibling;c!==null;)Hp(c,m,w),c=c.sibling}function qp(c,m,w){var R=c.tag;if(R===5||R===6)c=c.stateNode,m?w.insertBefore(c,m):w.appendChild(c);else if(R!==4&&(R===27&&Je(c.type)&&(w=c.stateNode),c=c.child,c!==null))for(qp(c,m,w),c=c.sibling;c!==null;)qp(c,m,w),c=c.sibling}function Gm(c){var m=c.stateNode,w=c.memoizedProps;try{for(var R=c.type,G=m.attributes;G.length;)m.removeAttributeNode(G[0]);wc(m,R,w),m[te]=c,m[_e]=w}catch(Y){ds(c,c.return,Y)}}var yh=!1,ys=!1,bc=!1,$p=typeof WeakSet=="function"?WeakSet:Set,jl=null;function yp(c,m){if(c=c.containerInfo,g=tm,c=_l(c),ad(c)){if("selectionStart"in c)var w={start:c.selectionStart,end:c.selectionEnd};else e:{w=(w=c.ownerDocument)&&w.defaultView||window;var R=w.getSelection&&w.getSelection();if(R&&R.rangeCount!==0){w=R.anchorNode;var G=R.anchorOffset,Y=R.focusNode;R=R.focusOffset;try{w.nodeType,Y.nodeType}catch{w=null;break e}var be=0,Qe=-1,Ot=-1,Ri=0,sn=0,hn=c,Oi=null;t:for(;;){for(var Hi;hn!==w||G!==0&&hn.nodeType!==3||(Qe=be+G),hn!==Y||R!==0&&hn.nodeType!==3||(Ot=be+R),hn.nodeType===3&&(be+=hn.nodeValue.length),(Hi=hn.firstChild)!==null;)Oi=hn,hn=Hi;for(;;){if(hn===c)break t;if(Oi===w&&++Ri===G&&(Qe=be),Oi===Y&&++sn===R&&(Ot=be),(Hi=hn.nextSibling)!==null)break;hn=Oi,Oi=hn.parentNode}hn=Hi}w=Qe===-1||Ot===-1?null:{start:Qe,end:Ot}}else w=null}w=w||{start:0,end:0}}else w=null;for(T={focusedElem:c,selectionRange:w},tm=!1,jl=m;jl!==null;)if(m=jl,c=m.child,(m.subtreeFlags&1028)!==0&&c!==null)c.return=m,jl=c;else for(;jl!==null;){switch(m=jl,Y=m.alternate,c=m.flags,m.tag){case 0:if((c&4)!==0&&(c=m.updateQueue,c=c!==null?c.events:null,c!==null))for(w=0;w<c.length;w++)G=c[w],G.ref.impl=G.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&Y!==null){c=void 0,w=m,G=Y.memoizedProps,Y=Y.memoizedState,R=w.stateNode;try{var Vr=Od(w.type,G);c=R.getSnapshotBeforeUpdate(Vr,Y),R.__reactInternalSnapshotBeforeUpdate=c}catch(sa){ds(w,w.return,sa)}}break;case 3:if((c&1024)!==0){if(c=m.stateNode.containerInfo,w=c.nodeType,w===9)ai(c);else if(w===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":ai(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(ue(163))}if(c=m.sibling,c!==null){c.return=m.return,jl=c;break}jl=m.return}}function Em(c,m,w){var R=w.flags;switch(w.tag){case 0:case 11:case 15:V(c,w),R&4&&Vf(5,w);break;case 1:if(V(c,w),R&4)if(c=w.stateNode,m===null)try{c.componentDidMount()}catch(be){ds(w,w.return,be)}else{var G=Od(w.type,m.memoizedProps);m=m.memoizedState;try{c.componentDidUpdate(G,m,c.__reactInternalSnapshotBeforeUpdate)}catch(be){ds(w,w.return,be)}}R&64&&Uf(w),R&512&&Zu(w,w.return);break;case 3:if(V(c,w),R&64&&(c=w.updateQueue,c!==null)){if(m=null,w.child!==null)switch(w.child.tag){case 27:case 5:m=w.child.stateNode;break;case 1:m=w.child.stateNode}try{Ya(c,m)}catch(be){ds(w,w.return,be)}}break;case 27:m===null&&R&4&&Gm(w);case 26:case 5:V(c,w),m===null&&R&4&&yd(w),R&512&&Zu(w,w.return);break;case 12:V(c,w);break;case 31:V(c,w),R&4&&t(c,w);break;case 13:V(c,w),R&4&&a(c,w),R&64&&(c=w.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(w=d_.bind(null,w),Rr(c,w))));break;case 22:if(R=w.memoizedState!==null||yh,!R){m=m!==null&&m.memoizedState!==null||ys,G=yh;var Y=ys;yh=R,(ys=m)&&!Y?X(c,w,(w.subtreeFlags&8772)!==0):V(c,w),yh=G,ys=Y}break;case 30:break;default:V(c,w)}}function Wu(c){var m=c.alternate;m!==null&&(c.alternate=null,Wu(m)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(m=c.stateNode,m!==null&&It(m)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var Es=null,bl=!1;function Eu(c,m,w){for(w=w.child;w!==null;)h(c,m,w),w=w.sibling}function h(c,m,w){if(er&&typeof er.onCommitFiberUnmount=="function")try{er.onCommitFiberUnmount(xn,w)}catch{}switch(w.tag){case 26:ys||ec(w,m),Eu(c,m,w),w.memoizedState?w.memoizedState.count--:w.stateNode&&(w=w.stateNode,w.parentNode.removeChild(w));break;case 27:ys||ec(w,m);var R=Es,G=bl;Je(w.type)&&(Es=w.stateNode,bl=!1),Eu(c,m,w),Zi(w.stateNode),Es=R,bl=G;break;case 5:ys||ec(w,m);case 6:if(R=Es,G=bl,Es=null,Eu(c,m,w),Es=R,bl=G,Es!==null)if(bl)try{(Es.nodeType===9?Es.body:Es.nodeName==="HTML"?Es.ownerDocument.body:Es).removeChild(w.stateNode)}catch(Y){ds(w,m,Y)}else try{Es.removeChild(w.stateNode)}catch(Y){ds(w,m,Y)}break;case 18:Es!==null&&(bl?(c=Es,xt(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,w.stateNode),nm(c)):xt(Es,w.stateNode));break;case 4:R=Es,G=bl,Es=w.stateNode.containerInfo,bl=!0,Eu(c,m,w),Es=R,bl=G;break;case 0:case 11:case 14:case 15:Oc(2,w,m),ys||Oc(4,w,m),Eu(c,m,w);break;case 1:ys||(ec(w,m),R=w.stateNode,typeof R.componentWillUnmount=="function"&&Gf(w,m,R)),Eu(c,m,w);break;case 21:Eu(c,m,w);break;case 22:ys=(R=ys)||w.memoizedState!==null,Eu(c,m,w),ys=R;break;default:Eu(c,m,w)}}function t(c,m){if(m.memoizedState===null&&(c=m.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{nm(c)}catch(w){ds(m,m.return,w)}}}function a(c,m){if(m.memoizedState===null&&(c=m.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{nm(c)}catch(w){ds(m,m.return,w)}}function d(c){switch(c.tag){case 31:case 13:case 19:var m=c.stateNode;return m===null&&(m=c.stateNode=new $p),m;case 22:return c=c.stateNode,m=c._retryCache,m===null&&(m=c._retryCache=new $p),m;default:throw Error(ue(435,c.tag))}}function y(c,m){var w=d(c);m.forEach(function(R){if(!w.has(R)){w.add(R);var G=qm.bind(null,c,R);R.then(G,G)}})}function b(c,m){var w=m.deletions;if(w!==null)for(var R=0;R<w.length;R++){var G=w[R],Y=c,be=m,Qe=be;e:for(;Qe!==null;){switch(Qe.tag){case 27:if(Je(Qe.type)){Es=Qe.stateNode,bl=!1;break e}break;case 5:Es=Qe.stateNode,bl=!1;break e;case 3:case 4:Es=Qe.stateNode.containerInfo,bl=!0;break e}Qe=Qe.return}if(Es===null)throw Error(ue(160));h(Y,be,G),Es=null,bl=!1,Y=G.alternate,Y!==null&&(Y.return=null),G.return=null}if(m.subtreeFlags&13886)for(m=m.child;m!==null;)I(m,c),m=m.sibling}var S=null;function I(c,m){var w=c.alternate,R=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:b(m,c),D(c),R&4&&(Oc(3,c,c.return),Vf(3,c),Oc(5,c,c.return));break;case 1:b(m,c),D(c),R&512&&(ys||w===null||ec(w,w.return)),R&64&&yh&&(c=c.updateQueue,c!==null&&(R=c.callbacks,R!==null&&(w=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=w===null?R:w.concat(R))));break;case 26:var G=S;if(b(m,c),D(c),R&512&&(ys||w===null||ec(w,w.return)),R&4){var Y=w!==null?w.memoizedState:null;if(R=c.memoizedState,w===null)if(R===null)if(c.stateNode===null){e:{R=c.type,w=c.memoizedProps,G=G.ownerDocument||G;t:switch(R){case"title":Y=G.getElementsByTagName("title")[0],(!Y||Y[lt]||Y[te]||Y.namespaceURI==="http://www.w3.org/2000/svg"||Y.hasAttribute("itemprop"))&&(Y=G.createElement(R),G.head.insertBefore(Y,G.querySelector("head > title"))),wc(Y,R,w),Y[te]=c,ji(Y),R=Y;break e;case"link":var be=wh("link","href",G).get(R+(w.href||""));if(be){for(var Qe=0;Qe<be.length;Qe++)if(Y=be[Qe],Y.getAttribute("href")===(w.href==null||w.href===""?null:w.href)&&Y.getAttribute("rel")===(w.rel==null?null:w.rel)&&Y.getAttribute("title")===(w.title==null?null:w.title)&&Y.getAttribute("crossorigin")===(w.crossOrigin==null?null:w.crossOrigin)){be.splice(Qe,1);break t}}Y=G.createElement(R),wc(Y,R,w),G.head.appendChild(Y);break;case"meta":if(be=wh("meta","content",G).get(R+(w.content||""))){for(Qe=0;Qe<be.length;Qe++)if(Y=be[Qe],Y.getAttribute("content")===(w.content==null?null:""+w.content)&&Y.getAttribute("name")===(w.name==null?null:w.name)&&Y.getAttribute("property")===(w.property==null?null:w.property)&&Y.getAttribute("http-equiv")===(w.httpEquiv==null?null:w.httpEquiv)&&Y.getAttribute("charset")===(w.charSet==null?null:w.charSet)){be.splice(Qe,1);break t}}Y=G.createElement(R),wc(Y,R,w),G.head.appendChild(Y);break;default:throw Error(ue(468,R))}Y[te]=c,ji(Y),R=Y}c.stateNode=R}else Th(G,c.type,c.stateNode);else c.stateNode=To(G,R,c.memoizedProps);else Y!==R?(Y===null?w.stateNode!==null&&(w=w.stateNode,w.parentNode.removeChild(w)):Y.count--,R===null?Th(G,c.type,c.stateNode):To(G,R,c.memoizedProps)):R===null&&c.stateNode!==null&&vd(c,c.memoizedProps,w.memoizedProps)}break;case 27:b(m,c),D(c),R&512&&(ys||w===null||ec(w,w.return)),w!==null&&R&4&&vd(c,c.memoizedProps,w.memoizedProps);break;case 5:if(b(m,c),D(c),R&512&&(ys||w===null||ec(w,w.return)),c.flags&32){G=c.stateNode;try{su(G,"")}catch(Vr){ds(c,c.return,Vr)}}R&4&&c.stateNode!=null&&(G=c.memoizedProps,vd(c,G,w!==null?w.memoizedProps:G)),R&1024&&(bc=!0);break;case 6:if(b(m,c),D(c),R&4){if(c.stateNode===null)throw Error(ue(162));R=c.memoizedProps,w=c.stateNode;try{w.nodeValue=R}catch(Vr){ds(c,c.return,Vr)}}break;case 3:if(Qu=null,G=S,S=aa(m.containerInfo),b(m,c),S=G,D(c),R&4&&w!==null&&w.memoizedState.isDehydrated)try{nm(m.containerInfo)}catch(Vr){ds(c,c.return,Vr)}bc&&(bc=!1,N(c));break;case 4:R=S,S=aa(c.stateNode.containerInfo),b(m,c),D(c),S=R;break;case 12:b(m,c),D(c);break;case 31:b(m,c),D(c),R&4&&(R=c.updateQueue,R!==null&&(c.updateQueue=null,y(c,R)));break;case 13:b(m,c),D(c),c.child.flags&8192&&c.memoizedState!==null!=(w!==null&&w.memoizedState!==null)&&(jr=Mr()),R&4&&(R=c.updateQueue,R!==null&&(c.updateQueue=null,y(c,R)));break;case 22:G=c.memoizedState!==null;var Ot=w!==null&&w.memoizedState!==null,Ri=yh,sn=ys;if(yh=Ri||G,ys=sn||Ot,b(m,c),ys=sn,yh=Ri,D(c),R&8192)e:for(m=c.stateNode,m._visibility=G?m._visibility&-2:m._visibility|1,G&&(w===null||Ot||yh||ys||K(c)),w=null,m=c;;){if(m.tag===5||m.tag===26){if(w===null){Ot=w=m;try{if(Y=Ot.stateNode,G)be=Y.style,typeof be.setProperty=="function"?be.setProperty("display","none","important"):be.display="none";else{Qe=Ot.stateNode;var hn=Ot.memoizedProps.style,Oi=hn!=null&&hn.hasOwnProperty("display")?hn.display:null;Qe.style.display=Oi==null||typeof Oi=="boolean"?"":(""+Oi).trim()}}catch(Vr){ds(Ot,Ot.return,Vr)}}}else if(m.tag===6){if(w===null){Ot=m;try{Ot.stateNode.nodeValue=G?"":Ot.memoizedProps}catch(Vr){ds(Ot,Ot.return,Vr)}}}else if(m.tag===18){if(w===null){Ot=m;try{var Hi=Ot.stateNode;G?zt(Hi,!0):zt(Ot.stateNode,!1)}catch(Vr){ds(Ot,Ot.return,Vr)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===c)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===c)break e;for(;m.sibling===null;){if(m.return===null||m.return===c)break e;w===m&&(w=null),m=m.return}w===m&&(w=null),m.sibling.return=m.return,m=m.sibling}R&4&&(R=c.updateQueue,R!==null&&(w=R.retryQueue,w!==null&&(R.retryQueue=null,y(c,w))));break;case 19:b(m,c),D(c),R&4&&(R=c.updateQueue,R!==null&&(c.updateQueue=null,y(c,R)));break;case 30:break;case 21:break;default:b(m,c),D(c)}}function D(c){var m=c.flags;if(m&2){try{for(var w,R=c.return;R!==null;){if(gh(R)){w=R;break}R=R.return}if(w==null)throw Error(ue(160));switch(w.tag){case 27:var G=w.stateNode,Y=Sm(c);qp(c,Y,G);break;case 5:var be=w.stateNode;w.flags&32&&(su(be,""),w.flags&=-33);var Qe=Sm(c);qp(c,Qe,be);break;case 3:case 4:var Ot=w.stateNode.containerInfo,Ri=Sm(c);Hp(c,Ri,Ot);break;default:throw Error(ue(161))}}catch(sn){ds(c,c.return,sn)}c.flags&=-3}m&4096&&(c.flags&=-4097)}function N(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var m=c;N(m),m.tag===5&&m.flags&1024&&m.stateNode.reset(),c=c.sibling}}function V(c,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)Em(c,m.alternate,m),m=m.sibling}function K(c){for(c=c.child;c!==null;){var m=c;switch(m.tag){case 0:case 11:case 14:case 15:Oc(4,m,m.return),K(m);break;case 1:ec(m,m.return);var w=m.stateNode;typeof w.componentWillUnmount=="function"&&Gf(m,m.return,w),K(m);break;case 27:Zi(m.stateNode);case 26:case 5:ec(m,m.return),K(m);break;case 22:m.memoizedState===null&&K(m);break;case 30:K(m);break;default:K(m)}c=c.sibling}}function X(c,m,w){for(w=w&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var R=m.alternate,G=c,Y=m,be=Y.flags;switch(Y.tag){case 0:case 11:case 15:X(G,Y,w),Vf(4,Y);break;case 1:if(X(G,Y,w),R=Y,G=R.stateNode,typeof G.componentDidMount=="function")try{G.componentDidMount()}catch(Ri){ds(R,R.return,Ri)}if(R=Y,G=R.updateQueue,G!==null){var Qe=R.stateNode;try{var Ot=G.shared.hiddenCallbacks;if(Ot!==null)for(G.shared.hiddenCallbacks=null,G=0;G<Ot.length;G++)Da(Ot[G],Qe)}catch(Ri){ds(R,R.return,Ri)}}w&&be&64&&Uf(Y),Zu(Y,Y.return);break;case 27:Gm(Y);case 26:case 5:X(G,Y,w),w&&R===null&&be&4&&yd(Y),Zu(Y,Y.return);break;case 12:X(G,Y,w);break;case 31:X(G,Y,w),w&&be&4&&t(G,Y);break;case 13:X(G,Y,w),w&&be&4&&a(G,Y);break;case 22:Y.memoizedState===null&&X(G,Y,w),Zu(Y,Y.return);break;case 30:break;default:X(G,Y,w)}m=m.sibling}}function Q(c,m){var w=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(w=c.memoizedState.cachePool.pool),c=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(c=m.memoizedState.cachePool.pool),c!==w&&(c!=null&&c.refCount++,w!=null&&Yc(w))}function ae(c,m){c=null,m.alternate!==null&&(c=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==c&&(m.refCount++,c!=null&&Yc(c))}function ie(c,m,w,R){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)ge(c,m,w,R),m=m.sibling}function ge(c,m,w,R){var G=m.flags;switch(m.tag){case 0:case 11:case 15:ie(c,m,w,R),G&2048&&Vf(9,m);break;case 1:ie(c,m,w,R);break;case 3:ie(c,m,w,R),G&2048&&(c=null,m.alternate!==null&&(c=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==c&&(m.refCount++,c!=null&&Yc(c)));break;case 12:if(G&2048){ie(c,m,w,R),c=m.stateNode;try{var Y=m.memoizedProps,be=Y.id,Qe=Y.onPostCommit;typeof Qe=="function"&&Qe(be,m.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(Ot){ds(m,m.return,Ot)}}else ie(c,m,w,R);break;case 31:ie(c,m,w,R);break;case 13:ie(c,m,w,R);break;case 23:break;case 22:Y=m.stateNode,be=m.alternate,m.memoizedState!==null?Y._visibility&2?ie(c,m,w,R):Se(c,m):Y._visibility&2?ie(c,m,w,R):(Y._visibility|=2,me(c,m,w,R,(m.subtreeFlags&10256)!==0||!1)),G&2048&&Q(be,m);break;case 24:ie(c,m,w,R),G&2048&&ae(m.alternate,m);break;default:ie(c,m,w,R)}}function me(c,m,w,R,G){for(G=G&&((m.subtreeFlags&10256)!==0||!1),m=m.child;m!==null;){var Y=c,be=m,Qe=w,Ot=R,Ri=be.flags;switch(be.tag){case 0:case 11:case 15:me(Y,be,Qe,Ot,G),Vf(8,be);break;case 23:break;case 22:var sn=be.stateNode;be.memoizedState!==null?sn._visibility&2?me(Y,be,Qe,Ot,G):Se(Y,be):(sn._visibility|=2,me(Y,be,Qe,Ot,G)),G&&Ri&2048&&Q(be.alternate,be);break;case 24:me(Y,be,Qe,Ot,G),G&&Ri&2048&&ae(be.alternate,be);break;default:me(Y,be,Qe,Ot,G)}m=m.sibling}}function Se(c,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var w=c,R=m,G=R.flags;switch(R.tag){case 22:Se(w,R),G&2048&&Q(R.alternate,R);break;case 24:Se(w,R),G&2048&&ae(R.alternate,R);break;default:Se(w,R)}m=m.sibling}}var De=8192;function Ee(c,m,w){if(c.subtreeFlags&De)for(c=c.child;c!==null;)We(c,m,w),c=c.sibling}function We(c,m,w){switch(c.tag){case 26:Ee(c,m,w),c.flags&De&&c.memoizedState!==null&&Tf(w,S,c.memoizedState,c.memoizedProps);break;case 5:Ee(c,m,w);break;case 3:case 4:var R=S;S=aa(c.stateNode.containerInfo),Ee(c,m,w),S=R;break;case 22:c.memoizedState===null&&(R=c.alternate,R!==null&&R.memoizedState!==null?(R=De,De=16777216,Ee(c,m,w),De=R):Ee(c,m,w));break;default:Ee(c,m,w)}}function Ve(c){var m=c.alternate;if(m!==null&&(c=m.child,c!==null)){m.child=null;do m=c.sibling,c.sibling=null,c=m;while(c!==null)}}function He(c){var m=c.deletions;if((c.flags&16)!==0){if(m!==null)for(var w=0;w<m.length;w++){var R=m[w];jl=R,nt(R,c)}Ve(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)Ne(c),c=c.sibling}function Ne(c){switch(c.tag){case 0:case 11:case 15:He(c),c.flags&2048&&Oc(9,c,c.return);break;case 3:He(c);break;case 12:He(c);break;case 22:var m=c.stateNode;c.memoizedState!==null&&m._visibility&2&&(c.return===null||c.return.tag!==13)?(m._visibility&=-3,Oe(c)):He(c);break;default:He(c)}}function Oe(c){var m=c.deletions;if((c.flags&16)!==0){if(m!==null)for(var w=0;w<m.length;w++){var R=m[w];jl=R,nt(R,c)}Ve(c)}for(c=c.child;c!==null;){switch(m=c,m.tag){case 0:case 11:case 15:Oc(8,m,m.return),Oe(m);break;case 22:w=m.stateNode,w._visibility&2&&(w._visibility&=-3,Oe(m));break;default:Oe(m)}c=c.sibling}}function nt(c,m){for(;jl!==null;){var w=jl;switch(w.tag){case 0:case 11:case 15:Oc(8,w,m);break;case 23:case 22:if(w.memoizedState!==null&&w.memoizedState.cachePool!==null){var R=w.memoizedState.cachePool.pool;R!=null&&R.refCount++}break;case 24:Yc(w.memoizedState.cache)}if(R=w.child,R!==null)R.return=w,jl=R;else e:for(w=c;jl!==null;){R=jl;var G=R.sibling,Y=R.return;if(Wu(R),R===w){jl=null;break e}if(G!==null){G.return=Y,jl=G;break e}jl=Y}}}var mt={getCacheForType:function(c){var m=Ba(hs),w=m.data.get(c);return w===void 0&&(w=c(),m.data.set(c,w)),w},cacheSignal:function(){return Ba(hs).controller.signal}},dt=typeof WeakMap=="function"?WeakMap:Map,At=0,Ct=null,Dt=null,Kt=0,vt=0,rt=null,Nt=!1,Lt=!1,li=!1,Mi=0,ki=0,Ei=0,_i=0,fn=0,nn=0,$i=0,en=null,bn=null,ar=!1,jr=0,Ea=0,_n=1/0,ca=null,Jn=null,xr=0,Zr=null,ta=null,Wr=0,_r=0,Aa=null,Hs=null,Za=0,ba=null;function zr(){return(At&2)!==0&&Kt!==0?Kt&-Kt:si.T!==null?Xp():fr()}function yr(){if(nn===0)if((Kt&536870912)===0||dn){var c=oc;oc<<=1,(oc&3932160)===0&&(oc=262144),nn=c}else nn=536870912;return c=Gs.current,c!==null&&(c.flags|=32),nn}function ga(c,m,w){(c===Ct&&(vt===2||vt===9)||c.cancelPendingCommit!==null)&&($o(c,0),No(c,Kt,nn,!1)),Ge(c,w),((At&2)===0||c!==Ct)&&(c===Ct&&((At&2)===0&&(_i|=w),ki===4&&No(c,Kt,nn,!1)),eu(c))}function As(c,m,w){if((At&6)!==0)throw Error(ue(327));var R=!w&&(m&127)===0&&(m&c.expiredLanes)===0||Pe(c,m),G=R?Ua(c,m):qs(c,m,!0),Y=R;do{if(G===0){Lt&&!R&&No(c,m,0,!1);break}else{if(w=c.current.alternate,Y&&!Wa(w)){G=qs(c,m,!1),Y=!1;continue}if(G===2){if(Y=m,c.errorRecoveryDisabledLanes&Y)var be=0;else be=c.pendingLanes&-536870913,be=be!==0?be:be&536870912?536870912:0;if(be!==0){m=be;e:{var Qe=c;G=en;var Ot=Qe.current.memoizedState.isDehydrated;if(Ot&&($o(Qe,be).flags|=256),be=qs(Qe,be,!1),be!==2){if(li&&!Ot){Qe.errorRecoveryDisabledLanes|=Y,_i|=Y,G=4;break e}Y=bn,bn=G,Y!==null&&(bn===null?bn=Y:bn.push.apply(bn,Y))}G=be}if(Y=!1,G!==2)continue}}if(G===1){$o(c,0),No(c,m,0,!0);break}e:{switch(R=c,Y=G,Y){case 0:case 1:throw Error(ue(345));case 4:if((m&4194048)!==m)break;case 6:No(R,m,nn,!Nt);break e;case 2:bn=null;break;case 3:case 5:break;default:throw Error(ue(329))}if((m&62914560)===m&&(G=jr+300-Mr(),10<G)){if(No(R,m,nn,!Nt),ze(R,0,!0)!==0)break e;Wr=m,R.timeoutHandle=pe(Ms.bind(null,R,w,bn,ca,ar,m,nn,_i,$i,Nt,Y,"Throttled",-0,0),G);break e}Ms(R,w,bn,ca,ar,m,nn,_i,$i,Nt,Y,null,-0,0)}}break}while(!0);eu(c)}function Ms(c,m,w,R,G,Y,be,Qe,Ot,Ri,sn,hn,Oi,Hi){if(c.timeoutHandle=-1,hn=m.subtreeFlags,hn&8192||(hn&16785408)===16785408){hn={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:_o},We(m,Y,hn);var Vr=(Y&62914560)===Y?jr-Mr():(Y&4194048)===Y?Ea-Mr():0;if(Vr=D_(hn,Vr),Vr!==null){Wr=Y,c.cancelPendingCommit=Vr(vf.bind(null,c,m,Y,w,R,G,be,Qe,Ot,sn,hn,null,Oi,Hi)),No(c,Y,be,!Ri);return}}vf(c,m,Y,w,R,G,be,Qe,Ot)}function Wa(c){for(var m=c;;){var w=m.tag;if((w===0||w===11||w===15)&&m.flags&16384&&(w=m.updateQueue,w!==null&&(w=w.stores,w!==null)))for(var R=0;R<w.length;R++){var G=w[R],Y=G.getSnapshot;G=G.value;try{if(!_s(Y(),G))return!1}catch{return!1}}if(w=m.child,m.subtreeFlags&16384&&w!==null)w.return=m,m=w;else{if(m===c)break;for(;m.sibling===null;){if(m.return===null||m.return===c)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function No(c,m,w,R){m&=~fn,m&=~_i,c.suspendedLanes|=m,c.pingedLanes&=~m,R&&(c.warmLanes|=m),R=c.expirationTimes;for(var G=m;0<G;){var Y=31-Xs(G),be=1<<Y;R[Y]=-1,G&=~be}w!==0&&kt(c,w,m)}function el(){return(At&6)===0?(Wp(0),!1):!0}function ho(){if(Dt!==null){if(vt===0)var c=Dt.return;else c=Dt,ju=Ol=null,hh(c),Rt=null,Ft=0,c=Dt;for(;c!==null;)Gp(c.alternate,c),c=c.return;Dt=null}}function $o(c,m){var w=c.timeoutHandle;w!==-1&&(c.timeoutHandle=-1,ve(w)),w=c.cancelPendingCommit,w!==null&&(c.cancelPendingCommit=null,w()),Wr=0,ho(),Ct=c,Dt=w=vl(c.current,null),Kt=m,vt=0,rt=null,Nt=!1,Lt=Pe(c,m),li=!1,$i=nn=fn=_i=Ei=ki=0,bn=en=null,ar=!1,(m&8)!==0&&(m|=m&32);var R=c.entangledLanes;if(R!==0)for(c=c.entanglements,R&=m;0<R;){var G=31-Xs(R),Y=1<<G;m|=c[G],R&=~Y}return Mi=m,kl(),w}function Vl(c,m){hi=null,si.H=ff,m===J||m===fe?(m=wt(),vt=3):m===ne?(m=wt(),vt=4):vt=m===bo?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,rt=m,Dt===null&&(ki=1,fp(c,Wo(m,c.current)))}function dl(){var c=Gs.current;return c===null?!0:(Kt&4194048)===Kt?ks===null:(Kt&62914560)===Kt||(Kt&536870912)!==0?c===ks:!1}function Qc(){var c=si.H;return si.H=ff,c===null?ff:c}function Xu(){var c=si.A;return si.A=mt,c}function tc(){ki=4,Nt||(Kt&4194048)!==Kt&&Gs.current!==null||(Lt=!0),(Ei&134217727)===0&&(_i&134217727)===0||Ct===null||No(Ct,Kt,nn,!1)}function qs(c,m,w){var R=At;At|=2;var G=Qc(),Y=Xu();(Ct!==c||Kt!==m)&&(ca=null,$o(c,m)),m=!1;var be=ki;e:do try{if(vt!==0&&Dt!==null){var Qe=Dt,Ot=rt;switch(vt){case 8:ho(),be=6;break e;case 3:case 2:case 9:case 6:Gs.current===null&&(m=!0);var Ri=vt;if(vt=0,rt=null,ic(c,Qe,Ot,Ri),w&&Lt){be=0;break e}break;default:Ri=vt,vt=0,rt=null,ic(c,Qe,Ot,Ri)}}fo(),be=ki;break}catch(sn){Vl(c,sn)}while(!0);return m&&c.shellSuspendCounter++,ju=Ol=null,At=R,si.H=G,si.A=Y,Dt===null&&(Ct=null,Kt=0,kl()),be}function fo(){for(;Dt!==null;)Os(Dt)}function Ua(c,m){var w=At;At|=2;var R=Qc(),G=Xu();Ct!==c||Kt!==m?(ca=null,_n=Mr()+500,$o(c,m)):Lt=Pe(c,m);e:do try{if(vt!==0&&Dt!==null){m=Dt;var Y=rt;t:switch(vt){case 1:vt=0,rt=null,ic(c,m,Y,1);break;case 2:case 9:if(Te(Y)){vt=0,rt=null,Is(m);break}m=function(){vt!==2&&vt!==9||Ct!==c||(vt=7),eu(c)},Y.then(m,m);break e;case 3:vt=7;break e;case 4:vt=5;break e;case 7:Te(Y)?(vt=0,rt=null,Is(m)):(vt=0,rt=null,ic(c,m,Y,7));break;case 5:var be=null;switch(Dt.tag){case 26:be=Dt.memoizedState;case 5:case 27:var Qe=Dt;if(be?El(be):Qe.stateNode.complete){vt=0,rt=null;var Ot=Qe.sibling;if(Ot!==null)Dt=Ot;else{var Ri=Qe.return;Ri!==null?(Dt=Ri,jd(Ri)):Dt=null}break t}}vt=0,rt=null,ic(c,m,Y,5);break;case 6:vt=0,rt=null,ic(c,m,Y,6);break;case 8:ho(),ki=6;break e;default:throw Error(ue(462))}}$s();break}catch(sn){Vl(c,sn)}while(!0);return ju=Ol=null,si.H=R,si.A=G,At=w,Dt!==null?0:(Ct=null,Kt=0,kl(),ki)}function $s(){for(;Dt!==null&&!Qs();)Os(Dt)}function Os(c){var m=Bo(c.alternate,c,Mi);c.memoizedProps=c.pendingProps,m===null?jd(c):Dt=m}function Is(c){var m=c,w=m.alternate;switch(m.tag){case 15:case 0:m=mp(w,m,m.pendingProps,m.type,void 0,Kt);break;case 11:m=mp(w,m,m.pendingProps,m.type.render,m.ref,Kt);break;case 5:hh(m);default:Gp(w,m),m=Dt=Bu(m,Mi),m=Bo(w,m,Mi)}c.memoizedProps=c.pendingProps,m===null?jd(c):Dt=m}function ic(c,m,w,R){ju=Ol=null,hh(m),Rt=null,Ft=0;var G=m.return;try{if(Nm(c,G,m,w,Kt)){ki=1,fp(c,Wo(w,c.current)),Dt=null;return}}catch(Y){if(G!==null)throw Dt=G,Y;ki=1,fp(c,Wo(w,c.current)),Dt=null;return}m.flags&32768?(dn||R===1?c=!0:Lt||(Kt&536870912)!==0?c=!1:(Nt=c=!0,(R===2||R===9||R===3||R===6)&&(R=Gs.current,R!==null&&R.tag===13&&(R.flags|=16384))),Yu(m,c)):jd(m)}function jd(c){var m=c;do{if((m.flags&32768)!==0){Yu(m,Nt);return}c=m.return;var w=Tm(m.alternate,m,Mi);if(w!==null){Dt=w;return}if(m=m.sibling,m!==null){Dt=m;return}Dt=m=c}while(m!==null);ki===0&&(ki=5)}function Yu(c,m){do{var w=h_(c.alternate,c);if(w!==null){w.flags&=32767,Dt=w;return}if(w=c.return,w!==null&&(w.flags|=32768,w.subtreeFlags=0,w.deletions=null),!m&&(c=c.sibling,c!==null)){Dt=c;return}Dt=c=w}while(c!==null);ki=6,Dt=null}function vf(c,m,w,R,G,Y,be,Qe,Ot){c.cancelPendingCommit=null;do tl();while(xr!==0);if((At&6)!==0)throw Error(ue(327));if(m!==null){if(m===c.current)throw Error(ue(177));if(Y=m.lanes|m.childLanes,Y|=us,ei(c,w,Y,be,Qe,Ot),c===Ct&&(Dt=Ct=null,Kt=0),ta=m,Zr=c,Wr=w,_r=Y,Aa=G,Hs=R,(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,$m(Qt,function(){return Au(),null})):(c.callbackNode=null,c.callbackPriority=0),R=(m.flags&13878)!==0,(m.subtreeFlags&13878)!==0||R){R=si.T,si.T=null,G=xi.p,xi.p=2,be=At,At|=4;try{yp(c,m,w)}finally{At=be,xi.p=G,si.T=R}}xr=1,Zh(),vh(),xh()}}function Zh(){if(xr===1){xr=0;var c=Zr,m=ta,w=(m.flags&13878)!==0;if((m.subtreeFlags&13878)!==0||w){w=si.T,si.T=null;var R=xi.p;xi.p=2;var G=At;At|=4;try{I(m,c);var Y=T,be=_l(c.containerInfo),Qe=Y.focusedElem,Ot=Y.selectionRange;if(be!==Qe&&Qe&&Qe.ownerDocument&&ah(Qe.ownerDocument.documentElement,Qe)){if(Ot!==null&&ad(Qe)){var Ri=Ot.start,sn=Ot.end;if(sn===void 0&&(sn=Ri),"selectionStart"in Qe)Qe.selectionStart=Ri,Qe.selectionEnd=Math.min(sn,Qe.value.length);else{var hn=Qe.ownerDocument||document,Oi=hn&&hn.defaultView||window;if(Oi.getSelection){var Hi=Oi.getSelection(),Vr=Qe.textContent.length,sa=Math.min(Ot.start,Vr),po=Ot.end===void 0?sa:Math.min(Ot.end,Vr);!Hi.extend&&sa>po&&(be=po,po=sa,sa=be);var ci=ep(Qe,sa),Yt=ep(Qe,po);if(ci&&Yt&&(Hi.rangeCount!==1||Hi.anchorNode!==ci.node||Hi.anchorOffset!==ci.offset||Hi.focusNode!==Yt.node||Hi.focusOffset!==Yt.offset)){var Ii=hn.createRange();Ii.setStart(ci.node,ci.offset),Hi.removeAllRanges(),sa>po?(Hi.addRange(Ii),Hi.extend(Yt.node,Yt.offset)):(Ii.setEnd(Yt.node,Yt.offset),Hi.addRange(Ii))}}}}for(hn=[],Hi=Qe;Hi=Hi.parentNode;)Hi.nodeType===1&&hn.push({element:Hi,left:Hi.scrollLeft,top:Hi.scrollTop});for(typeof Qe.focus=="function"&&Qe.focus(),Qe=0;Qe<hn.length;Qe++){var un=hn[Qe];un.element.scrollLeft=un.left,un.element.scrollTop=un.top}}tm=!!g,T=g=null}finally{At=G,xi.p=R,si.T=w}}c.current=m,xr=2}}function vh(){if(xr===2){xr=0;var c=Zr,m=ta,w=(m.flags&8772)!==0;if((m.subtreeFlags&8772)!==0||w){w=si.T,si.T=null;var R=xi.p;xi.p=2;var G=At;At|=4;try{Em(c,m.alternate,m)}finally{At=G,xi.p=R,si.T=w}}xr=3}}function xh(){if(xr===4||xr===3){xr=0,Io();var c=Zr,m=ta,w=Wr,R=Hs;(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?xr=5:(xr=0,ta=Zr=null,xf(c,c.pendingLanes));var G=c.pendingLanes;if(G===0&&(Jn=null),kn(w),m=m.stateNode,er&&typeof er.onCommitFiberRoot=="function")try{er.onCommitFiberRoot(xn,m,void 0,(m.current.flags&128)===128)}catch{}if(R!==null){m=si.T,G=xi.p,xi.p=2,si.T=null;try{for(var Y=c.onRecoverableError,be=0;be<R.length;be++){var Qe=R[be];Y(Qe.value,{componentStack:Qe.stack})}}finally{si.T=m,xi.p=G}}(Wr&3)!==0&&tl(),eu(c),G=c.pendingLanes,(w&261930)!==0&&(G&42)!==0?c===ba?Za++:(Za=0,ba=c):Za=0,Wp(0)}}function xf(c,m){(c.pooledCacheLanes&=m)===0&&(m=c.pooledCache,m!=null&&(c.pooledCache=null,Yc(m)))}function tl(){return Zh(),vh(),xh(),Au()}function Au(){if(xr!==5)return!1;var c=Zr,m=_r;_r=0;var w=kn(Wr),R=si.T,G=xi.p;try{xi.p=32>w?32:w,si.T=null,w=Aa,Aa=null;var Y=Zr,be=Wr;if(xr=0,ta=Zr=null,Wr=0,(At&6)!==0)throw Error(ue(331));var Qe=At;if(At|=4,Ne(Y.current),ge(Y,Y.current,be,w),At=Qe,Wp(0,!1),er&&typeof er.onPostCommitFiberRoot=="function")try{er.onPostCommitFiberRoot(xn,Y)}catch{}return!0}finally{xi.p=G,si.T=R,xf(c,m)}}function Ku(c,m,w){m=Wo(w,m),m=Tu(c.stateNode,m,2),c=ir(c,m,2),c!==null&&(Ge(c,2),eu(c))}function ds(c,m,w){if(c.tag===3)Ku(c,c,w);else for(;m!==null;){if(m.tag===3){Ku(m,c,w);break}else if(m.tag===1){var R=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof R.componentDidCatch=="function"&&(Jn===null||!Jn.has(R))){c=Wo(w,c),w=Fc(2),R=ir(m,w,2),R!==null&&(Su(w,R,m,c),Ge(R,2),eu(R));break}}m=m.return}}function Hm(c,m,w){var R=c.pingCache;if(R===null){R=c.pingCache=new dt;var G=new Set;R.set(m,G)}else G=R.get(m),G===void 0&&(G=new Set,R.set(m,G));G.has(w)||(li=!0,G.add(w),c=I_.bind(null,c,m,w),m.then(c,c))}function I_(c,m,w){var R=c.pingCache;R!==null&&R.delete(m),c.pingedLanes|=c.suspendedLanes&w,c.warmLanes&=~w,Ct===c&&(Kt&w)===w&&(ki===4||ki===3&&(Kt&62914560)===Kt&&300>Mr()-jr?(At&2)===0&&$o(c,0):fn|=w,$i===Kt&&($i=0)),eu(c)}function Am(c,m){m===0&&(m=gt()),c=_u(c,m),c!==null&&(Ge(c,m),eu(c))}function d_(c){var m=c.memoizedState,w=0;m!==null&&(w=m.retryLane),Am(c,w)}function qm(c,m){var w=0;switch(c.tag){case 31:case 13:var R=c.stateNode,G=c.memoizedState;G!==null&&(w=G.retryLane);break;case 19:R=c.stateNode;break;case 22:R=c.stateNode._retryCache;break;default:throw Error(ue(314))}R!==null&&R.delete(m),Am(c,w)}function $m(c,m){return la(c,m)}var xd=null,bf=null,Mm=!1,Zp=!1,Zm=!1,Hf=0;function eu(c){c!==bf&&c.next===null&&(bf===null?xd=bf=c:bf=bf.next=c),Zp=!0,Mm||(Mm=!0,Ym())}function Wp(c,m){if(!Zm&&Zp){Zm=!0;do for(var w=!1,R=xd;R!==null;){if(c!==0){var G=R.pendingLanes;if(G===0)var Y=0;else{var be=R.suspendedLanes,Qe=R.pingedLanes;Y=(1<<31-Xs(42|c)+1)-1,Y&=G&~(be&~Qe),Y=Y&201326741?Y&201326741|1:Y?Y|2:0}Y!==0&&(w=!0,Xm(R,Y))}else Y=Kt,Y=ze(R,R===Ct?Y:0,R.cancelPendingCommit!==null||R.timeoutHandle!==-1),(Y&3)===0||Pe(R,Y)||(w=!0,Xm(R,Y));R=R.next}while(w);Zm=!1}}function vp(){f_()}function f_(){Zp=Mm=!1;var c=0;Hf!==0&&re()&&(c=Hf);for(var m=Mr(),w=null,R=xd;R!==null;){var G=R.next,Y=Wm(R,m);Y===0?(R.next=null,w===null?xd=G:w.next=G,G===null&&(bf=w)):(w=R,(c!==0||(Y&3)!==0)&&(Zp=!0)),R=G}xr!==0&&xr!==5||Wp(c),Hf!==0&&(Hf=0)}function Wm(c,m){for(var w=c.suspendedLanes,R=c.pingedLanes,G=c.expirationTimes,Y=c.pendingLanes&-62914561;0<Y;){var be=31-Xs(Y),Qe=1<<be,Ot=G[be];Ot===-1?((Qe&w)===0||(Qe&R)!==0)&&(G[be]=et(Qe,m)):Ot<=m&&(c.expiredLanes|=Qe),Y&=~Qe}if(m=Ct,w=Kt,w=ze(c,c===m?w:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),R=c.callbackNode,w===0||c===m&&(vt===2||vt===9)||c.cancelPendingCommit!==null)return R!==null&&R!==null&&Po(R),c.callbackNode=null,c.callbackPriority=0;if((w&3)===0||Pe(c,w)){if(m=w&-w,m===c.callbackPriority)return m;switch(R!==null&&Po(R),kn(w)){case 2:case 8:w=Ps;break;case 32:w=Qt;break;case 268435456:w=Ta;break;default:w=Qt}return R=C_.bind(null,c),w=la(w,R),c.callbackPriority=m,c.callbackNode=w,m}return R!==null&&R!==null&&Po(R),c.callbackPriority=2,c.callbackNode=null,2}function C_(c,m){if(xr!==0&&xr!==5)return c.callbackNode=null,c.callbackPriority=0,null;var w=c.callbackNode;if(tl()&&c.callbackNode!==w)return null;var R=Kt;return R=ze(c,c===Ct?R:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),R===0?null:(As(c,R,m),Wm(c,Mr()),c.callbackNode!=null&&c.callbackNode===w?C_.bind(null,c):null)}function Xm(c,m){if(tl())return null;As(c,m,!0)}function Ym(){Le(function(){(At&6)!==0?la(Ds,vp):f_()})}function Xp(){if(Hf===0){var c=vu;c===0&&(c=Uo,Uo<<=1,(Uo&261888)===0&&(Uo=256)),Hf=c}return Hf}function X_(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:Ic(""+c)}function z_(c,m){var w=m.ownerDocument.createElement("input");return w.name=m.name,w.value=m.value,c.id&&w.setAttribute("form",c.id),m.parentNode.insertBefore(w,m),c=new FormData(c),w.parentNode.removeChild(w),c}function vg(c,m,w,R,G){if(m==="submit"&&w&&w.stateNode===G){var Y=X_((G[_e]||null).action),be=R.submitter;be&&(m=(m=be[_e]||null)?X_(m.formAction):be.getAttribute("formAction"),m!==null&&(Y=m,be=null));var Qe=new Cu("action","action",null,R,G);c.push({event:Qe,listeners:[{instance:null,listener:function(){if(R.defaultPrevented){if(Hf!==0){var Ot=be?z_(G,be):new FormData(G);kd(w,{pending:!0,data:Ot,method:G.method,action:Y},null,Ot)}}else typeof Y=="function"&&(Qe.preventDefault(),Ot=be?z_(G,be):new FormData(G),kd(w,{pending:!0,data:Ot,method:G.method,action:Y},Y,Ot))},currentTarget:G}]})}}for(var xp=0;xp<cd.length;xp++){var Ul=cd[xp],qf=Ul.toLowerCase(),p_=Ul[0].toUpperCase()+Ul.slice(1);Ws(qf,"on"+p_)}Ws(Id,"onAnimationEnd"),Ws(mu,"onAnimationIteration"),Ws(zf,"onAnimationStart"),Ws("dblclick","onDoubleClick"),Ws("focusin","onFocus"),Ws("focusout","onBlur"),Ws(hm,"onTransitionRun"),Ws(Rf,"onTransitionStart"),Ws(ku,"onTransitionCancel"),Ws(ld,"onTransitionEnd"),qr("onMouseEnter",["mouseout","mouseover"]),qr("onMouseLeave",["mouseout","mouseover"]),qr("onPointerEnter",["pointerout","pointerover"]),qr("onPointerLeave",["pointerout","pointerover"]),Nn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Nn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Nn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Nn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Nn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Nn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Yp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),R_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Yp));function Km(c,m){m=(m&4)!==0;for(var w=0;w<c.length;w++){var R=c[w],G=R.event;R=R.listeners;e:{var Y=void 0;if(m)for(var be=R.length-1;0<=be;be--){var Qe=R[be],Ot=Qe.instance,Ri=Qe.currentTarget;if(Qe=Qe.listener,Ot!==Y&&G.isPropagationStopped())break e;Y=Qe,G.currentTarget=Ri;try{Y(G)}catch(sn){uc(sn)}G.currentTarget=null,Y=Ot}else for(be=0;be<R.length;be++){if(Qe=R[be],Ot=Qe.instance,Ri=Qe.currentTarget,Qe=Qe.listener,Ot!==Y&&G.isPropagationStopped())break e;Y=Qe,G.currentTarget=Ri;try{Y(G)}catch(sn){uc(sn)}G.currentTarget=null,Y=Ot}}}}function Cs(c,m){var w=m[tt];w===void 0&&(w=m[tt]=new Set);var R=c+"__bubble";w.has(R)||(m_(m,c,2,!1),w.add(R))}function Im(c,m,w){var R=0;m&&(R|=4),m_(w,c,R,m)}var bd="_reactListening"+Math.random().toString(36).slice(2);function wl(c){if(!c[bd]){c[bd]=!0,pr.forEach(function(w){w!=="selectionchange"&&(R_.has(w)||Im(w,!1,c),Im(w,!0,c))});var m=c.nodeType===9?c:c.ownerDocument;m===null||m[bd]||(m[bd]=!0,Im("selectionchange",!1,m))}}function m_(c,m,w,R){switch(jc(m)){case 2:var G=eh;break;case 8:G=t_;break;default:G=i_}w=G.bind(null,m,w,c),G=void 0,!Sd||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(G=!0),R?G!==void 0?c.addEventListener(m,w,{capture:!0,passive:G}):c.addEventListener(m,w,!0):G!==void 0?c.addEventListener(m,w,{passive:G}):c.addEventListener(m,w,!1)}function $f(c,m,w,R,G){var Y=R;if((m&1)===0&&(m&2)===0&&R!==null)e:for(;;){if(R===null)return;var be=R.tag;if(be===3||be===4){var Qe=R.stateNode.containerInfo;if(Qe===G)break;if(be===4)for(be=R.return;be!==null;){var Ot=be.tag;if((Ot===3||Ot===4)&&be.stateNode.containerInfo===G)return;be=be.return}for(;Qe!==null;){if(be=ti(Qe),be===null)return;if(Ot=be.tag,Ot===5||Ot===6||Ot===26||Ot===27){R=Y=be;continue e}Qe=Qe.parentNode}}R=R.return}Jf(function(){var Ri=Y,sn=ko(w),hn=[];e:{var Oi=Ll.get(c);if(Oi!==void 0){var Hi=Cu,Vr=c;switch(c){case"keypress":if(Qr(w)===0)break e;case"keydown":case"keyup":Hi=En;break;case"focusin":Vr="focus",Hi=Ed;break;case"focusout":Vr="blur",Hi=Ed;break;case"beforeblur":case"afterblur":Hi=Ed;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Hi=Ih;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Hi=td;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Hi=Du;break;case Id:case mu:case zf:Hi=Gc;break;case ld:Hi=Mf;break;case"scroll":case"scrollend":Hi=Ru;break;case"wheel":Hi=Hc;break;case"copy":case"cut":case"paste":Hi=Mp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Hi=Ca;break;case"toggle":case"beforetoggle":Hi=so}var sa=(m&4)!==0,po=!sa&&(c==="scroll"||c==="scrollend"),ci=sa?Oi!==null?Oi+"Capture":null:Oi;sa=[];for(var Yt=Ri,Ii;Yt!==null;){var un=Yt;if(Ii=un.stateNode,un=un.tag,un!==5&&un!==26&&un!==27||Ii===null||ci===null||(un=Cc(Yt,ci),un!=null&&sa.push(Kp(Yt,un,Ii))),po)break;Yt=Yt.return}0<sa.length&&(Oi=new Hi(Oi,Vr,null,w,sn),hn.push({event:Oi,listeners:sa}))}}if((m&7)===0){e:{if(Oi=c==="mouseover"||c==="pointerover",Hi=c==="mouseout"||c==="pointerout",Oi&&w!==Zl&&(Vr=w.relatedTarget||w.fromElement)&&(ti(Vr)||Vr[Re]))break e;if((Hi||Oi)&&(Oi=sn.window===sn?sn:(Oi=sn.ownerDocument)?Oi.defaultView||Oi.parentWindow:window,Hi?(Vr=w.relatedTarget||w.toElement,Hi=Ri,Vr=Vr?ti(Vr):null,Vr!==null&&(po=Ce(Vr),sa=Vr.tag,Vr!==po||sa!==5&&sa!==27&&sa!==6)&&(Vr=null)):(Hi=null,Vr=Ri),Hi!==Vr)){if(sa=Ih,un="onMouseLeave",ci="onMouseEnter",Yt="mouse",(c==="pointerout"||c==="pointerover")&&(sa=Ca,un="onPointerLeave",ci="onPointerEnter",Yt="pointer"),po=Hi==null?Oi:Ji(Hi),Ii=Vr==null?Oi:Ji(Vr),Oi=new sa(un,Yt+"leave",Hi,w,sn),Oi.target=po,Oi.relatedTarget=Ii,un=null,ti(sn)===Ri&&(sa=new sa(ci,Yt+"enter",Vr,w,sn),sa.target=Ii,sa.relatedTarget=po,un=sa),po=un,Hi&&Vr)t:{for(sa=Qm,ci=Hi,Yt=Vr,Ii=0,un=ci;un;un=sa(un))Ii++;un=0;for(var fa=Yt;fa;fa=sa(fa))un++;for(;0<Ii-un;)ci=sa(ci),Ii--;for(;0<un-Ii;)Yt=sa(Yt),un--;for(;Ii--;){if(ci===Yt||Yt!==null&&ci===Yt.alternate){sa=ci;break t}ci=sa(ci),Yt=sa(Yt)}sa=null}else sa=null;Hi!==null&&__(hn,Oi,Hi,sa,!1),Vr!==null&&po!==null&&__(hn,po,Vr,sa,!0)}}e:{if(Oi=Ri?Ji(Ri):window,Hi=Oi.nodeName&&Oi.nodeName.toLowerCase(),Hi==="select"||Hi==="input"&&Oi.type==="file")var mo=hr;else if(Pl(Oi))if(yn)mo=Zo;else{mo=Zd;var ia=Dc}else Hi=Oi.nodeName,!Hi||Hi.toLowerCase()!=="input"||Oi.type!=="checkbox"&&Oi.type!=="radio"?Ri&&Uc(Ri.elementType)&&(mo=hr):mo=Dh;if(mo&&(mo=mo(c,Ri))){Rc(hn,mo,w,sn);break e}ia&&ia(c,Oi,Ri),c==="focusout"&&Ri&&Oi.type==="number"&&Ri.memoizedProps.value!=null&&Mc(Oi,"number",Oi.value)}switch(ia=Ri?Ji(Ri):window,c){case"focusin":(Pl(ia)||ia.contentEditable==="true")&&(hu=ia,sd=Ri,du=null);break;case"focusout":du=sd=hu=null;break;case"mousedown":Pc=!0;break;case"contextmenu":case"mouseup":case"dragend":Pc=!1,Lc(hn,w,sn);break;case"selectionchange":if(tp)break;case"keydown":case"keyup":Lc(hn,w,sn)}var xs;if(qc)e:{switch(c){case"compositionstart":var Ns="onCompositionStart";break e;case"compositionend":Ns="onCompositionEnd";break e;case"compositionupdate":Ns="onCompositionUpdate";break e}Ns=void 0}else Co?Dl(c,w)&&(Ns="onCompositionEnd"):c==="keydown"&&w.keyCode===229&&(Ns="onCompositionStart");Ns&&(Md&&w.locale!=="ko"&&(Co||Ns!=="onCompositionStart"?Ns==="onCompositionEnd"&&Co&&(xs=nh()):(Wl=sn,Ap="value"in Wl?Wl.value:Wl.textContent,Co=!0)),ia=Jm(Ri,Ns),0<ia.length&&(Ns=new Ch(Ns,c,null,w,sn),hn.push({event:Ns,listeners:ia}),xs?Ns.data=xs:(xs=xa(w),xs!==null&&(Ns.data=xs)))),(xs=Pu?Ls(c,w):Ts(c,w))&&(Ns=Jm(Ri,"onBeforeInput"),0<Ns.length&&(ia=new Ch("onBeforeInput","beforeinput",null,w,sn),hn.push({event:ia,listeners:Ns}),ia.data=xs)),vg(hn,c,Ri,w,sn)}Km(hn,m)})}function Kp(c,m,w){return{instance:c,listener:m,currentTarget:w}}function Jm(c,m){for(var w=m+"Capture",R=[];c!==null;){var G=c,Y=G.stateNode;if(G=G.tag,G!==5&&G!==26&&G!==27||Y===null||(G=Cc(c,w),G!=null&&R.unshift(Kp(c,G,Y)),G=Cc(c,m),G!=null&&R.push(Kp(c,G,Y))),c.tag===3)return R;c=c.return}return[]}function Qm(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function __(c,m,w,R,G){for(var Y=m._reactName,be=[];w!==null&&w!==R;){var Qe=w,Ot=Qe.alternate,Ri=Qe.stateNode;if(Qe=Qe.tag,Ot!==null&&Ot===R)break;Qe!==5&&Qe!==26&&Qe!==27||Ri===null||(Ot=Ri,G?(Ri=Cc(w,Y),Ri!=null&&be.unshift(Kp(w,Ri,Ot))):G||(Ri=Cc(w,Y),Ri!=null&&be.push(Kp(w,Ri,Ot)))),w=w.return}be.length!==0&&c.push({event:m,listeners:be})}var Jp=/\r\n?/g,g_=/\u0000|\uFFFD/g;function Vd(c){return(typeof c=="string"?c:""+c).replace(Jp,`
`).replace(g_,"")}function wf(c,m){return m=Vd(m),Vd(c)===m}function wo(c,m,w,R,G,Y){switch(w){case"children":typeof R=="string"?m==="body"||m==="textarea"&&R===""||su(c,R):(typeof R=="number"||typeof R=="bigint")&&m!=="body"&&su(c,""+R);break;case"className":$r(c,"class",R);break;case"tabIndex":$r(c,"tabindex",R);break;case"dir":case"role":case"viewBox":case"width":case"height":$r(c,w,R);break;case"style":Mu(c,R,Y);break;case"data":if(m!=="object"){$r(c,"data",R);break}case"src":case"href":if(R===""&&(m!=="a"||w!=="href")){c.removeAttribute(w);break}if(R==null||typeof R=="function"||typeof R=="symbol"||typeof R=="boolean"){c.removeAttribute(w);break}R=Ic(""+R),c.setAttribute(w,R);break;case"action":case"formAction":if(typeof R=="function"){c.setAttribute(w,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof Y=="function"&&(w==="formAction"?(m!=="input"&&wo(c,m,"name",G.name,G,null),wo(c,m,"formEncType",G.formEncType,G,null),wo(c,m,"formMethod",G.formMethod,G,null),wo(c,m,"formTarget",G.formTarget,G,null)):(wo(c,m,"encType",G.encType,G,null),wo(c,m,"method",G.method,G,null),wo(c,m,"target",G.target,G,null)));if(R==null||typeof R=="symbol"||typeof R=="boolean"){c.removeAttribute(w);break}R=Ic(""+R),c.setAttribute(w,R);break;case"onClick":R!=null&&(c.onclick=_o);break;case"onScroll":R!=null&&Cs("scroll",c);break;case"onScrollEnd":R!=null&&Cs("scrollend",c);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(ue(61));if(w=R.__html,w!=null){if(G.children!=null)throw Error(ue(60));c.innerHTML=w}}break;case"multiple":c.multiple=R&&typeof R!="function"&&typeof R!="symbol";break;case"muted":c.muted=R&&typeof R!="function"&&typeof R!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(R==null||typeof R=="function"||typeof R=="boolean"||typeof R=="symbol"){c.removeAttribute("xlink:href");break}w=Ic(""+R),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",w);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":R!=null&&typeof R!="function"&&typeof R!="symbol"?c.setAttribute(w,""+R):c.removeAttribute(w);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":R&&typeof R!="function"&&typeof R!="symbol"?c.setAttribute(w,""):c.removeAttribute(w);break;case"capture":case"download":R===!0?c.setAttribute(w,""):R!==!1&&R!=null&&typeof R!="function"&&typeof R!="symbol"?c.setAttribute(w,R):c.removeAttribute(w);break;case"cols":case"rows":case"size":case"span":R!=null&&typeof R!="function"&&typeof R!="symbol"&&!isNaN(R)&&1<=R?c.setAttribute(w,R):c.removeAttribute(w);break;case"rowSpan":case"start":R==null||typeof R=="function"||typeof R=="symbol"||isNaN(R)?c.removeAttribute(w):c.setAttribute(w,R);break;case"popover":Cs("beforetoggle",c),Cs("toggle",c),na(c,"popover",R);break;case"xlinkActuate":_a(c,"http://www.w3.org/1999/xlink","xlink:actuate",R);break;case"xlinkArcrole":_a(c,"http://www.w3.org/1999/xlink","xlink:arcrole",R);break;case"xlinkRole":_a(c,"http://www.w3.org/1999/xlink","xlink:role",R);break;case"xlinkShow":_a(c,"http://www.w3.org/1999/xlink","xlink:show",R);break;case"xlinkTitle":_a(c,"http://www.w3.org/1999/xlink","xlink:title",R);break;case"xlinkType":_a(c,"http://www.w3.org/1999/xlink","xlink:type",R);break;case"xmlBase":_a(c,"http://www.w3.org/XML/1998/namespace","xml:base",R);break;case"xmlLang":_a(c,"http://www.w3.org/XML/1998/namespace","xml:lang",R);break;case"xmlSpace":_a(c,"http://www.w3.org/XML/1998/namespace","xml:space",R);break;case"is":na(c,"is",R);break;case"innerText":case"textContent":break;default:(!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(w=lc.get(w)||w,na(c,w,R))}}function e_(c,m,w,R,G,Y){switch(w){case"style":Mu(c,R,Y);break;case"dangerouslySetInnerHTML":if(R!=null){if(typeof R!="object"||!("__html"in R))throw Error(ue(61));if(w=R.__html,w!=null){if(G.children!=null)throw Error(ue(60));c.innerHTML=w}}break;case"children":typeof R=="string"?su(c,R):(typeof R=="number"||typeof R=="bigint")&&su(c,""+R);break;case"onScroll":R!=null&&Cs("scroll",c);break;case"onScrollEnd":R!=null&&Cs("scrollend",c);break;case"onClick":R!=null&&(c.onclick=_o);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$n.hasOwnProperty(w))e:{if(w[0]==="o"&&w[1]==="n"&&(G=w.endsWith("Capture"),m=w.slice(2,G?w.length-7:void 0),Y=c[_e]||null,Y=Y!=null?Y[w]:null,typeof Y=="function"&&c.removeEventListener(m,Y,G),typeof R=="function")){typeof Y!="function"&&Y!==null&&(w in c?c[w]=null:c.hasAttribute(w)&&c.removeAttribute(w)),c.addEventListener(m,R,G);break e}w in c?c[w]=R:R===!0?c.setAttribute(w,""):na(c,w,R)}}}function wc(c,m,w){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Cs("error",c),Cs("load",c);var R=!1,G=!1,Y;for(Y in w)if(w.hasOwnProperty(Y)){var be=w[Y];if(be!=null)switch(Y){case"src":R=!0;break;case"srcSet":G=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(ue(137,m));default:wo(c,m,Y,be,w,null)}}G&&wo(c,m,"srcSet",w.srcSet,w,null),R&&wo(c,m,"src",w.src,w,null);return;case"input":Cs("invalid",c);var Qe=Y=be=G=null,Ot=null,Ri=null;for(R in w)if(w.hasOwnProperty(R)){var sn=w[R];if(sn!=null)switch(R){case"name":G=sn;break;case"type":be=sn;break;case"checked":Ot=sn;break;case"defaultChecked":Ri=sn;break;case"value":Y=sn;break;case"defaultValue":Qe=sn;break;case"children":case"dangerouslySetInnerHTML":if(sn!=null)throw Error(ue(137,m));break;default:wo(c,m,R,sn,w,null)}}va(c,Y,Qe,Ot,Ri,be,G,!1);return;case"select":Cs("invalid",c),R=be=Y=null;for(G in w)if(w.hasOwnProperty(G)&&(Qe=w[G],Qe!=null))switch(G){case"value":Y=Qe;break;case"defaultValue":be=Qe;break;case"multiple":R=Qe;default:wo(c,m,G,Qe,w,null)}m=Y,w=be,c.multiple=!!R,m!=null?to(c,!!R,m,!1):w!=null&&to(c,!!R,w,!0);return;case"textarea":Cs("invalid",c),Y=G=R=null;for(be in w)if(w.hasOwnProperty(be)&&(Qe=w[be],Qe!=null))switch(be){case"value":R=Qe;break;case"defaultValue":G=Qe;break;case"children":Y=Qe;break;case"dangerouslySetInnerHTML":if(Qe!=null)throw Error(ue(91));break;default:wo(c,m,be,Qe,w,null)}Ah(c,R,G,Y);return;case"option":for(Ot in w)if(w.hasOwnProperty(Ot)&&(R=w[Ot],R!=null))switch(Ot){case"selected":c.selected=R&&typeof R!="function"&&typeof R!="symbol";break;default:wo(c,m,Ot,R,w,null)}return;case"dialog":Cs("beforetoggle",c),Cs("toggle",c),Cs("cancel",c),Cs("close",c);break;case"iframe":case"object":Cs("load",c);break;case"video":case"audio":for(R=0;R<Yp.length;R++)Cs(Yp[R],c);break;case"image":Cs("error",c),Cs("load",c);break;case"details":Cs("toggle",c);break;case"embed":case"source":case"link":Cs("error",c),Cs("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Ri in w)if(w.hasOwnProperty(Ri)&&(R=w[Ri],R!=null))switch(Ri){case"children":case"dangerouslySetInnerHTML":throw Error(ue(137,m));default:wo(c,m,Ri,R,w,null)}return;default:if(Uc(m)){for(sn in w)w.hasOwnProperty(sn)&&(R=w[sn],R!==void 0&&e_(c,m,sn,R,w,void 0));return}}for(Qe in w)w.hasOwnProperty(Qe)&&(R=w[Qe],R!=null&&wo(c,m,Qe,R,w,null))}function xg(c,m,w,R){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var G=null,Y=null,be=null,Qe=null,Ot=null,Ri=null,sn=null;for(Hi in w){var hn=w[Hi];if(w.hasOwnProperty(Hi)&&hn!=null)switch(Hi){case"checked":break;case"value":break;case"defaultValue":Ot=hn;default:R.hasOwnProperty(Hi)||wo(c,m,Hi,null,R,hn)}}for(var Oi in R){var Hi=R[Oi];if(hn=w[Oi],R.hasOwnProperty(Oi)&&(Hi!=null||hn!=null))switch(Oi){case"type":Y=Hi;break;case"name":G=Hi;break;case"checked":Ri=Hi;break;case"defaultChecked":sn=Hi;break;case"value":be=Hi;break;case"defaultValue":Qe=Hi;break;case"children":case"dangerouslySetInnerHTML":if(Hi!=null)throw Error(ue(137,m));break;default:Hi!==hn&&wo(c,m,Oi,Hi,R,hn)}}Go(c,be,Qe,Ot,Ri,sn,Y,G);return;case"select":Hi=be=Qe=Oi=null;for(Y in w)if(Ot=w[Y],w.hasOwnProperty(Y)&&Ot!=null)switch(Y){case"value":break;case"multiple":Hi=Ot;default:R.hasOwnProperty(Y)||wo(c,m,Y,null,R,Ot)}for(G in R)if(Y=R[G],Ot=w[G],R.hasOwnProperty(G)&&(Y!=null||Ot!=null))switch(G){case"value":Oi=Y;break;case"defaultValue":Qe=Y;break;case"multiple":be=Y;default:Y!==Ot&&wo(c,m,G,Y,R,Ot)}m=Qe,w=be,R=Hi,Oi!=null?to(c,!!w,Oi,!1):!!R!=!!w&&(m!=null?to(c,!!w,m,!0):to(c,!!w,w?[]:"",!1));return;case"textarea":Hi=Oi=null;for(Qe in w)if(G=w[Qe],w.hasOwnProperty(Qe)&&G!=null&&!R.hasOwnProperty(Qe))switch(Qe){case"value":break;case"children":break;default:wo(c,m,Qe,null,R,G)}for(be in R)if(G=R[be],Y=w[be],R.hasOwnProperty(be)&&(G!=null||Y!=null))switch(be){case"value":Oi=G;break;case"defaultValue":Hi=G;break;case"children":break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(ue(91));break;default:G!==Y&&wo(c,m,be,G,R,Y)}Vc(c,Oi,Hi);return;case"option":for(var Vr in w)if(Oi=w[Vr],w.hasOwnProperty(Vr)&&Oi!=null&&!R.hasOwnProperty(Vr))switch(Vr){case"selected":c.selected=!1;break;default:wo(c,m,Vr,null,R,Oi)}for(Ot in R)if(Oi=R[Ot],Hi=w[Ot],R.hasOwnProperty(Ot)&&Oi!==Hi&&(Oi!=null||Hi!=null))switch(Ot){case"selected":c.selected=Oi&&typeof Oi!="function"&&typeof Oi!="symbol";break;default:wo(c,m,Ot,Oi,R,Hi)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var sa in w)Oi=w[sa],w.hasOwnProperty(sa)&&Oi!=null&&!R.hasOwnProperty(sa)&&wo(c,m,sa,null,R,Oi);for(Ri in R)if(Oi=R[Ri],Hi=w[Ri],R.hasOwnProperty(Ri)&&Oi!==Hi&&(Oi!=null||Hi!=null))switch(Ri){case"children":case"dangerouslySetInnerHTML":if(Oi!=null)throw Error(ue(137,m));break;default:wo(c,m,Ri,Oi,R,Hi)}return;default:if(Uc(m)){for(var po in w)Oi=w[po],w.hasOwnProperty(po)&&Oi!==void 0&&!R.hasOwnProperty(po)&&e_(c,m,po,void 0,R,Oi);for(sn in R)Oi=R[sn],Hi=w[sn],!R.hasOwnProperty(sn)||Oi===Hi||Oi===void 0&&Hi===void 0||e_(c,m,sn,Oi,R,Hi);return}}for(var ci in w)Oi=w[ci],w.hasOwnProperty(ci)&&Oi!=null&&!R.hasOwnProperty(ci)&&wo(c,m,ci,null,R,Oi);for(hn in R)Oi=R[hn],Hi=w[hn],!R.hasOwnProperty(hn)||Oi===Hi||Oi==null&&Hi==null||wo(c,m,hn,Oi,R,Hi)}function f(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function l(){if(typeof performance.getEntriesByType=="function"){for(var c=0,m=0,w=performance.getEntriesByType("resource"),R=0;R<w.length;R++){var G=w[R],Y=G.transferSize,be=G.initiatorType,Qe=G.duration;if(Y&&Qe&&f(be)){for(be=0,Qe=G.responseEnd,R+=1;R<w.length;R++){var Ot=w[R],Ri=Ot.startTime;if(Ri>Qe)break;var sn=Ot.transferSize,hn=Ot.initiatorType;sn&&f(hn)&&(Ot=Ot.responseEnd,be+=sn*(Ot<Qe?1:(Qe-Ri)/(Ot-Ri)))}if(--R,m+=8*(Y+be)/(G.duration/1e3),c++,10<c)break}}if(0<c)return m/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var g=null,T=null;function z(c){return c.nodeType===9?c:c.ownerDocument}function F(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function O(c,m){if(c===0)switch(m){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&m==="foreignObject"?0:c}function H(c,m){return c==="textarea"||c==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.children=="bigint"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var W=null;function re(){var c=window.event;return c&&c.type==="popstate"?c===W?!1:(W=c,!0):(W=null,!1)}var pe=typeof setTimeout=="function"?setTimeout:void 0,ve=typeof clearTimeout=="function"?clearTimeout:void 0,Me=typeof Promise=="function"?Promise:void 0,Le=typeof queueMicrotask=="function"?queueMicrotask:typeof Me<"u"?function(c){return Me.resolve(null).then(c).catch(qe)}:pe;function qe(c){setTimeout(function(){throw c})}function Je(c){return c==="head"}function xt(c,m){var w=m,R=0;do{var G=w.nextSibling;if(c.removeChild(w),G&&G.nodeType===8)if(w=G.data,w==="/$"||w==="/&"){if(R===0){c.removeChild(G),nm(m);return}R--}else if(w==="$"||w==="$?"||w==="$~"||w==="$!"||w==="&")R++;else if(w==="html")Zi(c.ownerDocument.documentElement);else if(w==="head"){w=c.ownerDocument.head,Zi(w);for(var Y=w.firstChild;Y;){var be=Y.nextSibling,Qe=Y.nodeName;Y[lt]||Qe==="SCRIPT"||Qe==="STYLE"||Qe==="LINK"&&Y.rel.toLowerCase()==="stylesheet"||w.removeChild(Y),Y=be}}else w==="body"&&Zi(c.ownerDocument.body);w=G}while(w);nm(m)}function zt(c,m){var w=c;c=0;do{var R=w.nextSibling;if(w.nodeType===1?m?(w._stashedDisplay=w.style.display,w.style.display="none"):(w.style.display=w._stashedDisplay||"",w.getAttribute("style")===""&&w.removeAttribute("style")):w.nodeType===3&&(m?(w._stashedText=w.nodeValue,w.nodeValue=""):w.nodeValue=w._stashedText||""),R&&R.nodeType===8)if(w=R.data,w==="/$"){if(c===0)break;c--}else w!=="$"&&w!=="$?"&&w!=="$~"&&w!=="$!"||c++;w=R}while(w)}function ai(c){var m=c.firstChild;for(m&&m.nodeType===10&&(m=m.nextSibling);m;){var w=m;switch(m=m.nextSibling,w.nodeName){case"HTML":case"HEAD":case"BODY":ai(w),It(w);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(w.rel.toLowerCase()==="stylesheet")continue}c.removeChild(w)}}function Vt(c,m,w,R){for(;c.nodeType===1;){var G=w;if(c.nodeName.toLowerCase()!==m.toLowerCase()){if(!R&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(R){if(!c[lt])switch(m){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(Y=c.getAttribute("rel"),Y==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(Y!==G.rel||c.getAttribute("href")!==(G.href==null||G.href===""?null:G.href)||c.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin)||c.getAttribute("title")!==(G.title==null?null:G.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(Y=c.getAttribute("src"),(Y!==(G.src==null?null:G.src)||c.getAttribute("type")!==(G.type==null?null:G.type)||c.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin))&&Y&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(m==="input"&&c.type==="hidden"){var Y=G.name==null?null:""+G.name;if(G.type==="hidden"&&c.getAttribute("name")===Y)return c}else return c;if(c=Bn(c.nextSibling),c===null)break}return null}function ii(c,m,w){if(m==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!w||(c=Bn(c.nextSibling),c===null))return null;return c}function Fi(c,m){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!m||(c=Bn(c.nextSibling),c===null))return null;return c}function gn(c){return c.data==="$?"||c.data==="$~"}function Xn(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function Rr(c,m){var w=c.ownerDocument;if(c.data==="$~")c._reactRetry=m;else if(c.data!=="$?"||w.readyState!=="loading")m();else{var R=function(){m(),w.removeEventListener("DOMContentLoaded",R)};w.addEventListener("DOMContentLoaded",R),c._reactRetry=R}}function Bn(c){for(;c!=null;c=c.nextSibling){var m=c.nodeType;if(m===1||m===3)break;if(m===8){if(m=c.data,m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"||m==="F!"||m==="F")break;if(m==="/$"||m==="/&")return null}}return c}var Mn=null;function wr(c){c=c.nextSibling;for(var m=0;c;){if(c.nodeType===8){var w=c.data;if(w==="/$"||w==="/&"){if(m===0)return Bn(c.nextSibling);m--}else w!=="$"&&w!=="$!"&&w!=="$?"&&w!=="$~"&&w!=="&"||m++}c=c.nextSibling}return null}function lr(c){c=c.previousSibling;for(var m=0;c;){if(c.nodeType===8){var w=c.data;if(w==="$"||w==="$!"||w==="$?"||w==="$~"||w==="&"){if(m===0)return c;m--}else w!=="/$"&&w!=="/&"||m++}c=c.previousSibling}return null}function nr(c,m,w){switch(m=z(w),c){case"html":if(c=m.documentElement,!c)throw Error(ue(452));return c;case"head":if(c=m.head,!c)throw Error(ue(453));return c;case"body":if(c=m.body,!c)throw Error(ue(454));return c;default:throw Error(ue(451))}}function Zi(c){for(var m=c.attributes;m.length;)c.removeAttributeNode(m[0]);It(c)}var or=new Map,Tr=new Set;function aa(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var vs=xi.d;xi.d={f:ro,r:Tl,D:Gl,C:tu,L:Tc,m:il,X:rc,S:nl,M:iu};function ro(){var c=vs.f(),m=el();return c||m}function Tl(c){var m=Gt(c);m!==null&&m.tag===5&&m.type==="form"?qh(m):vs.r(c)}var Bc=typeof document>"u"?null:document;function nc(c,m,w){var R=Bc;if(R&&typeof m=="string"&&m){var G=ns(m);G='link[rel="'+c+'"][href="'+G+'"]',typeof w=="string"&&(G+='[crossorigin="'+w+'"]'),Tr.has(G)||(Tr.add(G),c={rel:c,crossOrigin:w,href:m},R.querySelector(G)===null&&(m=R.createElement("link"),wc(m,"link",c),ji(m),R.head.appendChild(m)))}}function Gl(c){vs.D(c),nc("dns-prefetch",c,null)}function tu(c,m){vs.C(c,m),nc("preconnect",c,m)}function Tc(c,m,w){vs.L(c,m,w);var R=Bc;if(R&&c&&m){var G='link[rel="preload"][as="'+ns(m)+'"]';m==="image"&&w&&w.imageSrcSet?(G+='[imagesrcset="'+ns(w.imageSrcSet)+'"]',typeof w.imageSizes=="string"&&(G+='[imagesizes="'+ns(w.imageSizes)+'"]')):G+='[href="'+ns(c)+'"]';var Y=G;switch(m){case"style":Y=Hl(c);break;case"script":Y=os(c)}or.has(Y)||(c=it({rel:"preload",href:m==="image"&&w&&w.imageSrcSet?void 0:c,as:m},w),or.set(Y,c),R.querySelector(G)!==null||m==="style"&&R.querySelector(Sl(Y))||m==="script"&&R.querySelector(Bs(Y))||(m=R.createElement("link"),wc(m,"link",c),ji(m),R.head.appendChild(m)))}}function il(c,m){vs.m(c,m);var w=Bc;if(w&&c){var R=m&&typeof m.as=="string"?m.as:"script",G='link[rel="modulepreload"][as="'+ns(R)+'"][href="'+ns(c)+'"]',Y=G;switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":Y=os(c)}if(!or.has(Y)&&(c=it({rel:"modulepreload",href:c},m),or.set(Y,c),w.querySelector(G)===null)){switch(R){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(w.querySelector(Bs(Y)))return}R=w.createElement("link"),wc(R,"link",c),ji(R),w.head.appendChild(R)}}}function nl(c,m,w){vs.S(c,m,w);var R=Bc;if(R&&c){var G=Qi(R).hoistableStyles,Y=Hl(c);m=m||"default";var be=G.get(Y);if(!be){var Qe={loading:0,preload:null};if(be=R.querySelector(Sl(Y)))Qe.loading=5;else{c=it({rel:"stylesheet",href:c,"data-precedence":m},w),(w=or.get(Y))&&So(c,w);var Ot=be=R.createElement("link");ji(Ot),wc(Ot,"link",c),Ot._p=new Promise(function(Ri,sn){Ot.onload=Ri,Ot.onerror=sn}),Ot.addEventListener("load",function(){Qe.loading|=1}),Ot.addEventListener("error",function(){Qe.loading|=2}),Qe.loading|=4,Nc(be,m,R)}be={type:"stylesheet",instance:be,count:1,state:Qe},G.set(Y,be)}}}function rc(c,m){vs.X(c,m);var w=Bc;if(w&&c){var R=Qi(w).hoistableScripts,G=os(c),Y=R.get(G);Y||(Y=w.querySelector(Bs(G)),Y||(c=it({src:c,async:!0},m),(m=or.get(G))&&Zf(c,m),Y=w.createElement("script"),ji(Y),wc(Y,"link",c),w.head.appendChild(Y)),Y={type:"script",instance:Y,count:1,state:null},R.set(G,Y))}}function iu(c,m){vs.M(c,m);var w=Bc;if(w&&c){var R=Qi(w).hoistableScripts,G=os(c),Y=R.get(G);Y||(Y=w.querySelector(Bs(G)),Y||(c=it({src:c,async:!0,type:"module"},m),(m=or.get(G))&&Zf(c,m),Y=w.createElement("script"),ji(Y),wc(Y,"link",c),w.head.appendChild(Y)),Y={type:"script",instance:Y,count:1,state:null},R.set(G,Y))}}function Sc(c,m,w,R){var G=(G=vr.current)?aa(G):null;if(!G)throw Error(ue(446));switch(c){case"meta":case"title":return null;case"style":return typeof w.precedence=="string"&&typeof w.href=="string"?(m=Hl(w.href),w=Qi(G).hoistableStyles,R=w.get(m),R||(R={type:"style",instance:null,count:0,state:null},w.set(m,R)),R):{type:"void",instance:null,count:0,state:null};case"link":if(w.rel==="stylesheet"&&typeof w.href=="string"&&typeof w.precedence=="string"){c=Hl(w.href);var Y=Qi(G).hoistableStyles,be=Y.get(c);if(be||(G=G.ownerDocument||G,be={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},Y.set(c,be),(Y=G.querySelector(Sl(c)))&&!Y._p&&(be.instance=Y,be.state.loading=5),or.has(c)||(w={rel:"preload",as:"style",href:w.href,crossOrigin:w.crossOrigin,integrity:w.integrity,media:w.media,hrefLang:w.hrefLang,referrerPolicy:w.referrerPolicy},or.set(c,w),Y||Ju(G,c,w,be.state))),m&&R===null)throw Error(ue(528,""));return be}if(m&&R!==null)throw Error(ue(529,""));return null;case"script":return m=w.async,w=w.src,typeof w=="string"&&m&&typeof m!="function"&&typeof m!="symbol"?(m=os(w),w=Qi(G).hoistableScripts,R=w.get(m),R||(R={type:"script",instance:null,count:0,state:null},w.set(m,R)),R):{type:"void",instance:null,count:0,state:null};default:throw Error(ue(444,c))}}function Hl(c){return'href="'+ns(c)+'"'}function Sl(c){return'link[rel="stylesheet"]['+c+"]"}function bh(c){return it({},c,{"data-precedence":c.precedence,precedence:null})}function Ju(c,m,w,R){c.querySelector('link[rel="preload"][as="style"]['+m+"]")?R.loading=1:(m=c.createElement("link"),R.preload=m,m.addEventListener("load",function(){return R.loading|=1}),m.addEventListener("error",function(){return R.loading|=2}),wc(m,"link",w),ji(m),c.head.appendChild(m))}function os(c){return'[src="'+ns(c)+'"]'}function Bs(c){return"script[async]"+c}function To(c,m,w){if(m.count++,m.instance===null)switch(m.type){case"style":var R=c.querySelector('style[data-href~="'+ns(w.href)+'"]');if(R)return m.instance=R,ji(R),R;var G=it({},w,{"data-href":w.href,"data-precedence":w.precedence,href:null,precedence:null});return R=(c.ownerDocument||c).createElement("style"),ji(R),wc(R,"style",G),Nc(R,w.precedence,c),m.instance=R;case"stylesheet":G=Hl(w.href);var Y=c.querySelector(Sl(G));if(Y)return m.state.loading|=4,m.instance=Y,ji(Y),Y;R=bh(w),(G=or.get(G))&&So(R,G),Y=(c.ownerDocument||c).createElement("link"),ji(Y);var be=Y;return be._p=new Promise(function(Qe,Ot){be.onload=Qe,be.onerror=Ot}),wc(Y,"link",R),m.state.loading|=4,Nc(Y,w.precedence,c),m.instance=Y;case"script":return Y=os(w.src),(G=c.querySelector(Bs(Y)))?(m.instance=G,ji(G),G):(R=w,(G=or.get(Y))&&(R=it({},w),Zf(R,G)),c=c.ownerDocument||c,G=c.createElement("script"),ji(G),wc(G,"link",R),c.head.appendChild(G),m.instance=G);case"void":return null;default:throw Error(ue(443,m.type))}else m.type==="stylesheet"&&(m.state.loading&4)===0&&(R=m.instance,m.state.loading|=4,Nc(R,w.precedence,c));return m.instance}function Nc(c,m,w){for(var R=w.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),G=R.length?R[R.length-1]:null,Y=G,be=0;be<R.length;be++){var Qe=R[be];if(Qe.dataset.precedence===m)Y=Qe;else if(Y!==G)break}Y?Y.parentNode.insertBefore(c,Y.nextSibling):(m=w.nodeType===9?w.head:w,m.insertBefore(c,m.firstChild))}function So(c,m){c.crossOrigin==null&&(c.crossOrigin=m.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=m.referrerPolicy),c.title==null&&(c.title=m.title)}function Zf(c,m){c.crossOrigin==null&&(c.crossOrigin=m.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=m.referrerPolicy),c.integrity==null&&(c.integrity=m.integrity)}var Qu=null;function wh(c,m,w){if(Qu===null){var R=new Map,G=Qu=new Map;G.set(w,R)}else G=Qu,R=G.get(w),R||(R=new Map,G.set(w,R));if(R.has(c))return R;for(R.set(c,null),w=w.getElementsByTagName(c),G=0;G<w.length;G++){var Y=w[G];if(!(Y[lt]||Y[te]||c==="link"&&Y.getAttribute("rel")==="stylesheet")&&Y.namespaceURI!=="http://www.w3.org/2000/svg"){var be=Y.getAttribute(m)||"";be=c+be;var Qe=R.get(be);Qe?Qe.push(Y):R.set(be,[Y])}}return R}function Th(c,m,w){c=c.ownerDocument||c,c.head.insertBefore(w,m==="title"?c.querySelector("head > title"):null)}function Wh(c,m,w){if(w===1||m.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof m.precedence!="string"||typeof m.href!="string"||m.href==="")break;return!0;case"link":if(typeof m.rel!="string"||typeof m.href!="string"||m.href===""||m.onLoad||m.onError)break;switch(m.rel){case"stylesheet":return c=m.disabled,typeof m.precedence=="string"&&c==null;default:return!0}case"script":if(m.async&&typeof m.async!="function"&&typeof m.async!="symbol"&&!m.onLoad&&!m.onError&&m.src&&typeof m.src=="string")return!0}return!1}function El(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function Tf(c,m,w,R){if(w.type==="stylesheet"&&(typeof R.media!="string"||matchMedia(R.media).matches!==!1)&&(w.state.loading&4)===0){if(w.instance===null){var G=Hl(R.href),Y=m.querySelector(Sl(G));if(Y){m=Y._p,m!==null&&typeof m=="object"&&typeof m.then=="function"&&(c.count++,c=Qp.bind(c),m.then(c,c)),w.state.loading|=4,w.instance=Y,ji(Y);return}Y=m.ownerDocument||m,R=bh(R),(G=or.get(G))&&So(R,G),Y=Y.createElement("link"),ji(Y);var be=Y;be._p=new Promise(function(Qe,Ot){be.onload=Qe,be.onerror=Ot}),wc(Y,"link",R),w.instance=Y}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(w,m),(m=w.state.preload)&&(w.state.loading&3)===0&&(c.count++,w=Qp.bind(c),m.addEventListener("load",w),m.addEventListener("error",w))}}var bp=0;function D_(c,m){return c.stylesheets&&c.count===0&&wp(c,c.stylesheets),0<c.count||0<c.imgCount?function(w){var R=setTimeout(function(){if(c.stylesheets&&wp(c,c.stylesheets),c.unsuspend){var Y=c.unsuspend;c.unsuspend=null,Y()}},6e4+m);0<c.imgBytes&&bp===0&&(bp=62500*l());var G=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&wp(c,c.stylesheets),c.unsuspend)){var Y=c.unsuspend;c.unsuspend=null,Y()}},(c.imgBytes>bp?50:800)+m);return c.unsuspend=w,function(){c.unsuspend=null,clearTimeout(R),clearTimeout(G)}}:null}function Qp(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)wp(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var em=null;function wp(c,m){c.stylesheets=null,c.unsuspend!==null&&(c.count++,em=new Map,m.forEach(Wf,c),em=null,Qp.call(c))}function Wf(c,m){if(!(m.state.loading&4)){var w=em.get(c);if(w)var R=w.get(null);else{w=new Map,em.set(c,w);for(var G=c.querySelectorAll("link[data-precedence],style[data-precedence]"),Y=0;Y<G.length;Y++){var be=G[Y];(be.nodeName==="LINK"||be.getAttribute("media")!=="not all")&&(w.set(be.dataset.precedence,be),R=be)}R&&w.set(null,R)}G=m.instance,be=G.getAttribute("data-precedence"),Y=w.get(be)||R,Y===R&&w.set(null,G),w.set(be,G),this.count++,R=Qp.bind(this),G.addEventListener("load",R),G.addEventListener("error",R),Y?Y.parentNode.insertBefore(G,Y.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(G,c.firstChild)),m.state.loading|=4}}var Cm={$$typeof:an,Provider:null,Consumer:null,_currentValue:Tn,_currentValue2:Tn,_threadCount:0};function Y_(c,m,w,R,G,Y,be,Qe,Ot){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=jt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jt(0),this.hiddenUpdates=jt(null),this.identifierPrefix=R,this.onUncaughtError=G,this.onCaughtError=Y,this.onRecoverableError=be,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ot,this.incompleteTransitions=new Map}function K_(c,m,w,R,G,Y,be,Qe,Ot,Ri,sn,hn){return c=new Y_(c,m,w,be,Ot,Ri,sn,hn,Qe),m=1,Y===!0&&(m|=24),Y=yl(3,null,null,m),c.current=Y,Y.stateNode=c,m=fc(),m.refCount++,c.pooledCache=m,m.refCount++,Y.memoizedState={element:R,isDehydrated:w,cache:m},Zn(Y),c}function P_(c){return c?(c=gl,c):gl}function Sf(c,m,w,R,G,Y){G=P_(G),R.context===null?R.context=G:R.pendingContext=G,R=Rn(m),R.payload={element:w},Y=Y===void 0?null:Y,Y!==null&&(R.callback=Y),w=ir(c,R,m),w!==null&&(ga(w,c,m),Xr(w,c,m))}function L_(c,m){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var w=c.retryLane;c.retryLane=w!==0&&w<m?w:m}}function y_(c,m){L_(c,m),(c=c.alternate)&&L_(c,m)}function zm(c){if(c.tag===13||c.tag===31){var m=_u(c,67108864);m!==null&&ga(m,c,67108864),y_(c,67108864)}}function Rm(c){if(c.tag===13||c.tag===31){var m=zr();m=ui(m);var w=_u(c,m);w!==null&&ga(w,c,m),y_(c,m)}}var tm=!0;function eh(c,m,w,R){var G=si.T;si.T=null;var Y=xi.p;try{xi.p=2,i_(c,m,w,R)}finally{xi.p=Y,si.T=G}}function t_(c,m,w,R){var G=si.T;si.T=null;var Y=xi.p;try{xi.p=8,i_(c,m,w,R)}finally{xi.p=Y,si.T=G}}function i_(c,m,w,R){if(tm){var G=v_(R);if(G===null)$f(c,m,R,n_,w),bg(c,R);else if(ly(G,c,m,w,R))R.stopPropagation();else if(bg(c,R),m&4&&-1<oy.indexOf(c)){for(;G!==null;){var Y=Gt(G);if(Y!==null)switch(Y.tag){case 3:if(Y=Y.stateNode,Y.current.memoizedState.isDehydrated){var be=ft(Y.pendingLanes);if(be!==0){var Qe=Y;for(Qe.pendingLanes|=2,Qe.entangledLanes|=2;be;){var Ot=1<<31-Xs(be);Qe.entanglements[1]|=Ot,be&=~Ot}eu(Y),(At&6)===0&&(_n=Mr()+500,Wp(0))}}break;case 31:case 13:Qe=_u(Y,2),Qe!==null&&ga(Qe,Y,2),el(),y_(Y,2)}if(Y=v_(R),Y===null&&$f(c,m,R,n_,w),Y===G)break;G=Y}G!==null&&R.stopPropagation()}else $f(c,m,R,null,w)}}function v_(c){return c=ko(c),k_(c)}var n_=null;function k_(c){if(n_=null,c=ti(c),c!==null){var m=Ce(c);if(m===null)c=null;else{var w=m.tag;if(w===13){if(c=se(m),c!==null)return c;c=null}else if(w===31){if(c=n(m),c!==null)return c;c=null}else if(w===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;c=null}else m!==c&&(c=null)}}return n_=c,null}function jc(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ws()){case Ds:return 2;case Ps:return 8;case Qt:case Gn:return 32;case Ta:return 268435456;default:return 32}default:return 32}}var nu=!1,ru=null,Ec=null,Sh=null,th=new Map,r_=new Map,im=[],oy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function bg(c,m){switch(c){case"focusin":case"focusout":ru=null;break;case"dragenter":case"dragleave":Ec=null;break;case"mouseover":case"mouseout":Sh=null;break;case"pointerover":case"pointerout":th.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":r_.delete(m.pointerId)}}function x_(c,m,w,R,G,Y){return c===null||c.nativeEvent!==Y?(c={blockedOn:m,domEventName:w,eventSystemFlags:R,nativeEvent:Y,targetContainers:[G]},m!==null&&(m=Gt(m),m!==null&&zm(m)),c):(c.eventSystemFlags|=R,m=c.targetContainers,G!==null&&m.indexOf(G)===-1&&m.push(G),c)}function ly(c,m,w,R,G){switch(m){case"focusin":return ru=x_(ru,c,m,w,R,G),!0;case"dragenter":return Ec=x_(Ec,c,m,w,R,G),!0;case"mouseover":return Sh=x_(Sh,c,m,w,R,G),!0;case"pointerover":var Y=G.pointerId;return th.set(Y,x_(th.get(Y)||null,c,m,w,R,G)),!0;case"gotpointercapture":return Y=G.pointerId,r_.set(Y,x_(r_.get(Y)||null,c,m,w,R,G)),!0}return!1}function cy(c){var m=ti(c.target);if(m!==null){var w=Ce(m);if(w!==null){if(m=w.tag,m===13){if(m=se(w),m!==null){c.blockedOn=m,Cr(c.priority,function(){Rm(w)});return}}else if(m===31){if(m=n(w),m!==null){c.blockedOn=m,Cr(c.priority,function(){Rm(w)});return}}else if(m===3&&w.stateNode.current.memoizedState.isDehydrated){c.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}c.blockedOn=null}function F_(c){if(c.blockedOn!==null)return!1;for(var m=c.targetContainers;0<m.length;){var w=v_(c.nativeEvent);if(w===null){w=c.nativeEvent;var R=new w.constructor(w.type,w);Zl=R,w.target.dispatchEvent(R),Zl=null}else return m=Gt(w),m!==null&&zm(m),c.blockedOn=w,!1;m.shift()}return!0}function wg(c,m,w){F_(c)&&w.delete(m)}function a_(){nu=!1,ru!==null&&F_(ru)&&(ru=null),Ec!==null&&F_(Ec)&&(Ec=null),Sh!==null&&F_(Sh)&&(Sh=null),th.forEach(wg),r_.forEach(wg)}function O_(c,m){c.blockedOn===m&&(c.blockedOn=null,nu||(nu=!0,Z.unstable_scheduleCallback(Z.unstable_NormalPriority,a_)))}var B_=null;function Tg(c){B_!==c&&(B_=c,Z.unstable_scheduleCallback(Z.unstable_NormalPriority,function(){B_===c&&(B_=null);for(var m=0;m<c.length;m+=3){var w=c[m],R=c[m+1],G=c[m+2];if(typeof R!="function"){if(k_(R||w)===null)continue;break}var Y=Gt(w);Y!==null&&(c.splice(m,3),m-=3,kd(Y,{pending:!0,data:G,method:w.method,action:R},R,G))}}))}function nm(c){function m(Ot){return O_(Ot,c)}ru!==null&&O_(ru,c),Ec!==null&&O_(Ec,c),Sh!==null&&O_(Sh,c),th.forEach(m),r_.forEach(m);for(var w=0;w<im.length;w++){var R=im[w];R.blockedOn===c&&(R.blockedOn=null)}for(;0<im.length&&(w=im[0],w.blockedOn===null);)cy(w),w.blockedOn===null&&im.shift();if(w=(c.ownerDocument||c).$$reactFormReplay,w!=null)for(R=0;R<w.length;R+=3){var G=w[R],Y=w[R+1],be=G[_e]||null;if(typeof Y=="function")be||Tg(w);else if(be){var Qe=null;if(Y&&Y.hasAttribute("formAction")){if(G=Y,be=Y[_e]||null)Qe=be.formAction;else if(k_(G)!==null)continue}else Qe=be.action;typeof Qe=="function"?w[R+1]=Qe:(w.splice(R,3),R-=3),Tg(w)}}}function uy(){function c(Y){Y.canIntercept&&Y.info==="react-transition"&&Y.intercept({handler:function(){return new Promise(function(be){return G=be})},focusReset:"manual",scroll:"manual"})}function m(){G!==null&&(G(),G=null),R||setTimeout(w,20)}function w(){if(!R&&!navigation.transition){var Y=navigation.currentEntry;Y&&Y.url!=null&&navigation.navigate(Y.url,{state:Y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var R=!1,G=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",m),navigation.addEventListener("navigateerror",m),setTimeout(w,100),function(){R=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",m),navigation.removeEventListener("navigateerror",m),G!==null&&(G(),G=null)}}}function J_(c){this._internalRoot=c}Dm.prototype.render=J_.prototype.render=function(c){var m=this._internalRoot;if(m===null)throw Error(ue(409));var w=m.current,R=zr();Sf(w,R,c,m,null,null)},Dm.prototype.unmount=J_.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var m=c.containerInfo;Sf(c.current,2,null,c,null,null),el(),m[Re]=null}};function Dm(c){this._internalRoot=c}Dm.prototype.unstable_scheduleHydration=function(c){if(c){var m=fr();c={blockedOn:null,target:c,priority:m};for(var w=0;w<im.length&&m!==0&&m<im[w].priority;w++);im.splice(w,0,c),w===0&&cy(c)}};var Sg=ce.version;if(Sg!=="19.2.0")throw Error(ue(527,Sg,"19.2.0"));xi.findDOMNode=function(c){var m=c._reactInternals;if(m===void 0)throw typeof c.render=="function"?Error(ue(188)):(c=Object.keys(c).join(","),Error(ue(268,c)));return c=Fe(m),c=c!==null?pt(c):null,c=c===null?null:c.stateNode,c};var hy={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:si,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var N_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!N_.isDisabled&&N_.supportsFiber)try{xn=N_.inject(hy),er=N_}catch{}}return Jg.createRoot=function(c,m){if(!Ae(c))throw Error(ue(299));var w=!1,R="",G=gm,Y=pf,be=ym;return m!=null&&(m.unstable_strictMode===!0&&(w=!0),m.identifierPrefix!==void 0&&(R=m.identifierPrefix),m.onUncaughtError!==void 0&&(G=m.onUncaughtError),m.onCaughtError!==void 0&&(Y=m.onCaughtError),m.onRecoverableError!==void 0&&(be=m.onRecoverableError)),m=K_(c,1,!1,null,null,w,R,null,G,Y,be,uy),c[Re]=m.current,wl(c),new J_(m)},Jg.hydrateRoot=function(c,m,w){if(!Ae(c))throw Error(ue(299));var R=!1,G="",Y=gm,be=pf,Qe=ym,Ot=null;return w!=null&&(w.unstable_strictMode===!0&&(R=!0),w.identifierPrefix!==void 0&&(G=w.identifierPrefix),w.onUncaughtError!==void 0&&(Y=w.onUncaughtError),w.onCaughtError!==void 0&&(be=w.onCaughtError),w.onRecoverableError!==void 0&&(Qe=w.onRecoverableError),w.formState!==void 0&&(Ot=w.formState)),m=K_(c,1,!0,m,w??null,R,G,Ot,Y,be,Qe,uy),m.context=P_(null),w=m.current,R=zr(),R=ui(R),G=Rn(R),G.callback=null,ir(w,G,R),w=R,m.current.lanes=w,Ge(m,w),eu(m),c[Re]=m.current,wl(c),new Dm(m)},Jg.version="19.2.0",Jg}var cb;function TT(){if(cb)return ev.exports;cb=1;function Z(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Z)}catch(ce){console.error(ce)}}return Z(),ev.exports=wT(),ev.exports}var ST=TT();const ET=iy(ST);var ub="popstate";function AT(Z={}){function ce(ue,Ae){let{pathname:Ce,search:se,hash:n}=ue.location;return hv("",{pathname:Ce,search:se,hash:n},Ae.state&&Ae.state.usr||null,Ae.state&&Ae.state.key||"default")}function de(ue,Ae){return typeof Ae=="string"?Ae:ty(Ae)}return IT(ce,de,null,Z)}function Ac(Z,ce){if(Z===!1||Z===null||typeof Z>"u")throw new Error(ce)}function Ep(Z,ce){if(!Z){typeof console<"u"&&console.warn(ce);try{throw new Error(ce)}catch{}}}function MT(){return Math.random().toString(36).substring(2,10)}function hb(Z,ce){return{usr:Z.state,key:Z.key,idx:ce}}function hv(Z,ce,de=null,ue){return{pathname:typeof Z=="string"?Z:Z.pathname,search:"",hash:"",...typeof ce=="string"?gg(ce):ce,state:de,key:ce&&ce.key||ue||MT()}}function ty({pathname:Z="/",search:ce="",hash:de=""}){return ce&&ce!=="?"&&(Z+=ce.charAt(0)==="?"?ce:"?"+ce),de&&de!=="#"&&(Z+=de.charAt(0)==="#"?de:"#"+de),Z}function gg(Z){let ce={};if(Z){let de=Z.indexOf("#");de>=0&&(ce.hash=Z.substring(de),Z=Z.substring(0,de));let ue=Z.indexOf("?");ue>=0&&(ce.search=Z.substring(ue),Z=Z.substring(0,ue)),Z&&(ce.pathname=Z)}return ce}function IT(Z,ce,de,ue={}){let{window:Ae=document.defaultView,v5Compat:Ce=!1}=ue,se=Ae.history,n="POP",ke=null,Fe=pt();Fe==null&&(Fe=0,se.replaceState({...se.state,idx:Fe},""));function pt(){return(se.state||{idx:null}).idx}function it(){n="POP";let qi=pt(),on=qi==null?null:qi-Fe;Fe=qi,ke&&ke({action:n,location:Vi.location,delta:on})}function ht(qi,on){n="PUSH";let Ai=hv(Vi.location,qi,on);Fe=pt()+1;let an=hb(Ai,Fe),Un=Vi.createHref(Ai);try{se.pushState(an,"",Un)}catch(rr){if(rr instanceof DOMException&&rr.name==="DataCloneError")throw rr;Ae.location.assign(Un)}Ce&&ke&&ke({action:n,location:Vi.location,delta:1})}function Ci(qi,on){n="REPLACE";let Ai=hv(Vi.location,qi,on);Fe=pt();let an=hb(Ai,Fe),Un=Vi.createHref(Ai);se.replaceState(an,"",Un),Ce&&ke&&ke({action:n,location:Vi.location,delta:0})}function Ui(qi){return CT(qi)}let Vi={get action(){return n},get location(){return Z(Ae,se)},listen(qi){if(ke)throw new Error("A history only accepts one active listener");return Ae.addEventListener(ub,it),ke=qi,()=>{Ae.removeEventListener(ub,it),ke=null}},createHref(qi){return ce(Ae,qi)},createURL:Ui,encodeLocation(qi){let on=Ui(qi);return{pathname:on.pathname,search:on.search,hash:on.hash}},push:ht,replace:Ci,go(qi){return se.go(qi)}};return Vi}function CT(Z,ce=!1){let de="http://localhost";typeof window<"u"&&(de=window.location.origin!=="null"?window.location.origin:window.location.href),Ac(de,"No window.location.(origin|href) available to create URL");let ue=typeof Z=="string"?Z:ty(Z);return ue=ue.replace(/ $/,"%20"),!ce&&ue.startsWith("//")&&(ue=de+ue),new URL(ue,de)}function jb(Z,ce,de="/"){return zT(Z,ce,de,!1)}function zT(Z,ce,de,ue){let Ae=typeof ce=="string"?gg(ce):ce,Ce=c_(Ae.pathname||"/",de);if(Ce==null)return null;let se=Vb(Z);RT(se);let n=null;for(let ke=0;n==null&&ke<se.length;++ke){let Fe=UT(Ce);n=jT(se[ke],Fe,ue)}return n}function Vb(Z,ce=[],de=[],ue="",Ae=!1){let Ce=(se,n,ke=Ae,Fe)=>{let pt={relativePath:Fe===void 0?se.path||"":Fe,caseSensitive:se.caseSensitive===!0,childrenIndex:n,route:se};if(pt.relativePath.startsWith("/")){if(!pt.relativePath.startsWith(ue)&&ke)return;Ac(pt.relativePath.startsWith(ue),`Absolute route path "${pt.relativePath}" nested under path "${ue}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),pt.relativePath=pt.relativePath.slice(ue.length)}let it=l_([ue,pt.relativePath]),ht=de.concat(pt);se.children&&se.children.length>0&&(Ac(se.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${it}".`),Vb(se.children,ce,ht,it,ke)),!(se.path==null&&!se.index)&&ce.push({path:it,score:BT(it,se.index),routesMeta:ht})};return Z.forEach((se,n)=>{if(se.path===""||!se.path?.includes("?"))Ce(se,n);else for(let ke of Ub(se.path))Ce(se,n,!0,ke)}),ce}function Ub(Z){let ce=Z.split("/");if(ce.length===0)return[];let[de,...ue]=ce,Ae=de.endsWith("?"),Ce=de.replace(/\?$/,"");if(ue.length===0)return Ae?[Ce,""]:[Ce];let se=Ub(ue.join("/")),n=[];return n.push(...se.map(ke=>ke===""?Ce:[Ce,ke].join("/"))),Ae&&n.push(...se),n.map(ke=>Z.startsWith("/")&&ke===""?"/":ke)}function RT(Z){Z.sort((ce,de)=>ce.score!==de.score?de.score-ce.score:NT(ce.routesMeta.map(ue=>ue.childrenIndex),de.routesMeta.map(ue=>ue.childrenIndex)))}var DT=/^:[\w-]+$/,PT=3,LT=2,kT=1,FT=10,OT=-2,db=Z=>Z==="*";function BT(Z,ce){let de=Z.split("/"),ue=de.length;return de.some(db)&&(ue+=OT),ce&&(ue+=LT),de.filter(Ae=>!db(Ae)).reduce((Ae,Ce)=>Ae+(DT.test(Ce)?PT:Ce===""?kT:FT),ue)}function NT(Z,ce){return Z.length===ce.length&&Z.slice(0,-1).every((ue,Ae)=>ue===ce[Ae])?Z[Z.length-1]-ce[ce.length-1]:0}function jT(Z,ce,de=!1){let{routesMeta:ue}=Z,Ae={},Ce="/",se=[];for(let n=0;n<ue.length;++n){let ke=ue[n],Fe=n===ue.length-1,pt=Ce==="/"?ce:ce.slice(Ce.length)||"/",it=Jy({path:ke.relativePath,caseSensitive:ke.caseSensitive,end:Fe},pt),ht=ke.route;if(!it&&Fe&&de&&!ue[ue.length-1].route.index&&(it=Jy({path:ke.relativePath,caseSensitive:ke.caseSensitive,end:!1},pt)),!it)return null;Object.assign(Ae,it.params),se.push({params:Ae,pathname:l_([Ce,it.pathname]),pathnameBase:ZT(l_([Ce,it.pathnameBase])),route:ht}),it.pathnameBase!=="/"&&(Ce=l_([Ce,it.pathnameBase]))}return se}function Jy(Z,ce){typeof Z=="string"&&(Z={path:Z,caseSensitive:!1,end:!0});let[de,ue]=VT(Z.path,Z.caseSensitive,Z.end),Ae=ce.match(de);if(!Ae)return null;let Ce=Ae[0],se=Ce.replace(/(.)\/+$/,"$1"),n=Ae.slice(1);return{params:ue.reduce((Fe,{paramName:pt,isOptional:it},ht)=>{if(pt==="*"){let Ui=n[ht]||"";se=Ce.slice(0,Ce.length-Ui.length).replace(/(.)\/+$/,"$1")}const Ci=n[ht];return it&&!Ci?Fe[pt]=void 0:Fe[pt]=(Ci||"").replace(/%2F/g,"/"),Fe},{}),pathname:Ce,pathnameBase:se,pattern:Z}}function VT(Z,ce=!1,de=!0){Ep(Z==="*"||!Z.endsWith("*")||Z.endsWith("/*"),`Route path "${Z}" will be treated as if it were "${Z.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${Z.replace(/\*$/,"/*")}".`);let ue=[],Ae="^"+Z.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(se,n,ke)=>(ue.push({paramName:n,isOptional:ke!=null}),ke?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return Z.endsWith("*")?(ue.push({paramName:"*"}),Ae+=Z==="*"||Z==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):de?Ae+="\\/*$":Z!==""&&Z!=="/"&&(Ae+="(?:(?=\\/|$))"),[new RegExp(Ae,ce?void 0:"i"),ue]}function UT(Z){try{return Z.split("/").map(ce=>decodeURIComponent(ce).replace(/\//g,"%2F")).join("/")}catch(ce){return Ep(!1,`The URL path "${Z}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${ce}).`),Z}}function c_(Z,ce){if(ce==="/")return Z;if(!Z.toLowerCase().startsWith(ce.toLowerCase()))return null;let de=ce.endsWith("/")?ce.length-1:ce.length,ue=Z.charAt(de);return ue&&ue!=="/"?null:Z.slice(de)||"/"}var GT=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,HT=Z=>GT.test(Z);function qT(Z,ce="/"){let{pathname:de,search:ue="",hash:Ae=""}=typeof Z=="string"?gg(Z):Z,Ce;if(de)if(HT(de))Ce=de;else{if(de.includes("//")){let se=de;de=de.replace(/\/\/+/g,"/"),Ep(!1,`Pathnames cannot have embedded double slashes - normalizing ${se} -> ${de}`)}de.startsWith("/")?Ce=fb(de.substring(1),"/"):Ce=fb(de,ce)}else Ce=ce;return{pathname:Ce,search:WT(ue),hash:XT(Ae)}}function fb(Z,ce){let de=ce.replace(/\/+$/,"").split("/");return Z.split("/").forEach(Ae=>{Ae===".."?de.length>1&&de.pop():Ae!=="."&&de.push(Ae)}),de.length>1?de.join("/"):"/"}function rv(Z,ce,de,ue){return`Cannot include a '${Z}' character in a manually specified \`to.${ce}\` field [${JSON.stringify(ue)}].  Please separate it out to the \`to.${de}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function $T(Z){return Z.filter((ce,de)=>de===0||ce.route.path&&ce.route.path.length>0)}function Gb(Z){let ce=$T(Z);return ce.map((de,ue)=>ue===ce.length-1?de.pathname:de.pathnameBase)}function Hb(Z,ce,de,ue=!1){let Ae;typeof Z=="string"?Ae=gg(Z):(Ae={...Z},Ac(!Ae.pathname||!Ae.pathname.includes("?"),rv("?","pathname","search",Ae)),Ac(!Ae.pathname||!Ae.pathname.includes("#"),rv("#","pathname","hash",Ae)),Ac(!Ae.search||!Ae.search.includes("#"),rv("#","search","hash",Ae)));let Ce=Z===""||Ae.pathname==="",se=Ce?"/":Ae.pathname,n;if(se==null)n=de;else{let it=ce.length-1;if(!ue&&se.startsWith("..")){let ht=se.split("/");for(;ht[0]==="..";)ht.shift(),it-=1;Ae.pathname=ht.join("/")}n=it>=0?ce[it]:"/"}let ke=qT(Ae,n),Fe=se&&se!=="/"&&se.endsWith("/"),pt=(Ce||se===".")&&de.endsWith("/");return!ke.pathname.endsWith("/")&&(Fe||pt)&&(ke.pathname+="/"),ke}var l_=Z=>Z.join("/").replace(/\/\/+/g,"/"),ZT=Z=>Z.replace(/\/+$/,"").replace(/^\/*/,"/"),WT=Z=>!Z||Z==="?"?"":Z.startsWith("?")?Z:"?"+Z,XT=Z=>!Z||Z==="#"?"":Z.startsWith("#")?Z:"#"+Z;function YT(Z){return Z!=null&&typeof Z.status=="number"&&typeof Z.statusText=="string"&&typeof Z.internal=="boolean"&&"data"in Z}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var qb=["POST","PUT","PATCH","DELETE"];new Set(qb);var KT=["GET",...qb];new Set(KT);var yg=Tt.createContext(null);yg.displayName="DataRouter";var e0=Tt.createContext(null);e0.displayName="DataRouterState";Tt.createContext(!1);var $b=Tt.createContext({isTransitioning:!1});$b.displayName="ViewTransition";var JT=Tt.createContext(new Map);JT.displayName="Fetchers";var QT=Tt.createContext(null);QT.displayName="Await";var km=Tt.createContext(null);km.displayName="Navigation";var ny=Tt.createContext(null);ny.displayName="Location";var Fm=Tt.createContext({outlet:null,matches:[],isDataRoute:!1});Fm.displayName="Route";var mv=Tt.createContext(null);mv.displayName="RouteError";function eS(Z,{relative:ce}={}){Ac(ry(),"useHref() may be used only in the context of a <Router> component.");let{basename:de,navigator:ue}=Tt.useContext(km),{hash:Ae,pathname:Ce,search:se}=ay(Z,{relative:ce}),n=Ce;return de!=="/"&&(n=Ce==="/"?de:l_([de,Ce])),ue.createHref({pathname:n,search:se,hash:Ae})}function ry(){return Tt.useContext(ny)!=null}function M_(){return Ac(ry(),"useLocation() may be used only in the context of a <Router> component."),Tt.useContext(ny).location}var Zb="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Wb(Z){Tt.useContext(km).static||Tt.useLayoutEffect(Z)}function $_(){let{isDataRoute:Z}=Tt.useContext(Fm);return Z?fS():tS()}function tS(){Ac(ry(),"useNavigate() may be used only in the context of a <Router> component.");let Z=Tt.useContext(yg),{basename:ce,navigator:de}=Tt.useContext(km),{matches:ue}=Tt.useContext(Fm),{pathname:Ae}=M_(),Ce=JSON.stringify(Gb(ue)),se=Tt.useRef(!1);return Wb(()=>{se.current=!0}),Tt.useCallback((ke,Fe={})=>{if(Ep(se.current,Zb),!se.current)return;if(typeof ke=="number"){de.go(ke);return}let pt=Hb(ke,JSON.parse(Ce),Ae,Fe.relative==="path");Z==null&&ce!=="/"&&(pt.pathname=pt.pathname==="/"?ce:l_([ce,pt.pathname])),(Fe.replace?de.replace:de.push)(pt,Fe.state,Fe)},[ce,de,Ce,Ae,Z])}Tt.createContext(null);function Xb(){let{matches:Z}=Tt.useContext(Fm),ce=Z[Z.length-1];return ce?ce.params:{}}function ay(Z,{relative:ce}={}){let{matches:de}=Tt.useContext(Fm),{pathname:ue}=M_(),Ae=JSON.stringify(Gb(de));return Tt.useMemo(()=>Hb(Z,JSON.parse(Ae),ue,ce==="path"),[Z,Ae,ue,ce])}function iS(Z,ce){return Yb(Z,ce)}function Yb(Z,ce,de,ue,Ae){Ac(ry(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:Ce}=Tt.useContext(km),{matches:se}=Tt.useContext(Fm),n=se[se.length-1],ke=n?n.params:{},Fe=n?n.pathname:"/",pt=n?n.pathnameBase:"/",it=n&&n.route;{let Ai=it&&it.path||"";Kb(Fe,!it||Ai.endsWith("*")||Ai.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${Fe}" (under <Route path="${Ai}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Ai}"> to <Route path="${Ai==="/"?"*":`${Ai}/*`}">.`)}let ht=M_(),Ci;if(ce){let Ai=typeof ce=="string"?gg(ce):ce;Ac(pt==="/"||Ai.pathname?.startsWith(pt),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${pt}" but pathname "${Ai.pathname}" was given in the \`location\` prop.`),Ci=Ai}else Ci=ht;let Ui=Ci.pathname||"/",Vi=Ui;if(pt!=="/"){let Ai=pt.replace(/^\//,"").split("/");Vi="/"+Ui.replace(/^\//,"").split("/").slice(Ai.length).join("/")}let qi=jb(Z,{pathname:Vi});Ep(it||qi!=null,`No routes matched location "${Ci.pathname}${Ci.search}${Ci.hash}" `),Ep(qi==null||qi[qi.length-1].route.element!==void 0||qi[qi.length-1].route.Component!==void 0||qi[qi.length-1].route.lazy!==void 0,`Matched leaf route at location "${Ci.pathname}${Ci.search}${Ci.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let on=oS(qi&&qi.map(Ai=>Object.assign({},Ai,{params:Object.assign({},ke,Ai.params),pathname:l_([pt,Ce.encodeLocation?Ce.encodeLocation(Ai.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Ai.pathname]),pathnameBase:Ai.pathnameBase==="/"?pt:l_([pt,Ce.encodeLocation?Ce.encodeLocation(Ai.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Ai.pathnameBase])})),se,de,ue,Ae);return ce&&on?Tt.createElement(ny.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Ci},navigationType:"POP"}},on):on}function nS(){let Z=dS(),ce=YT(Z)?`${Z.status} ${Z.statusText}`:Z instanceof Error?Z.message:JSON.stringify(Z),de=Z instanceof Error?Z.stack:null,ue="rgba(200,200,200, 0.5)",Ae={padding:"0.5rem",backgroundColor:ue},Ce={padding:"2px 4px",backgroundColor:ue},se=null;return console.error("Error handled by React Router default ErrorBoundary:",Z),se=Tt.createElement(Tt.Fragment,null,Tt.createElement("p",null," Hey developer "),Tt.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Tt.createElement("code",{style:Ce},"ErrorBoundary")," or"," ",Tt.createElement("code",{style:Ce},"errorElement")," prop on your route.")),Tt.createElement(Tt.Fragment,null,Tt.createElement("h2",null,"Unexpected Application Error!"),Tt.createElement("h3",{style:{fontStyle:"italic"}},ce),de?Tt.createElement("pre",{style:Ae},de):null,se)}var rS=Tt.createElement(nS,null),aS=class extends Tt.Component{constructor(Z){super(Z),this.state={location:Z.location,revalidation:Z.revalidation,error:Z.error}}static getDerivedStateFromError(Z){return{error:Z}}static getDerivedStateFromProps(Z,ce){return ce.location!==Z.location||ce.revalidation!=="idle"&&Z.revalidation==="idle"?{error:Z.error,location:Z.location,revalidation:Z.revalidation}:{error:Z.error!==void 0?Z.error:ce.error,location:ce.location,revalidation:Z.revalidation||ce.revalidation}}componentDidCatch(Z,ce){this.props.onError?this.props.onError(Z,ce):console.error("React Router caught the following error during render",Z)}render(){return this.state.error!==void 0?Tt.createElement(Fm.Provider,{value:this.props.routeContext},Tt.createElement(mv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function sS({routeContext:Z,match:ce,children:de}){let ue=Tt.useContext(yg);return ue&&ue.static&&ue.staticContext&&(ce.route.errorElement||ce.route.ErrorBoundary)&&(ue.staticContext._deepestRenderedBoundaryId=ce.route.id),Tt.createElement(Fm.Provider,{value:Z},de)}function oS(Z,ce=[],de=null,ue=null,Ae=null){if(Z==null){if(!de)return null;if(de.errors)Z=de.matches;else if(ce.length===0&&!de.initialized&&de.matches.length>0)Z=de.matches;else return null}let Ce=Z,se=de?.errors;if(se!=null){let pt=Ce.findIndex(it=>it.route.id&&se?.[it.route.id]!==void 0);Ac(pt>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(se).join(",")}`),Ce=Ce.slice(0,Math.min(Ce.length,pt+1))}let n=!1,ke=-1;if(de)for(let pt=0;pt<Ce.length;pt++){let it=Ce[pt];if((it.route.HydrateFallback||it.route.hydrateFallbackElement)&&(ke=pt),it.route.id){let{loaderData:ht,errors:Ci}=de,Ui=it.route.loader&&!ht.hasOwnProperty(it.route.id)&&(!Ci||Ci[it.route.id]===void 0);if(it.route.lazy||Ui){n=!0,ke>=0?Ce=Ce.slice(0,ke+1):Ce=[Ce[0]];break}}}let Fe=de&&ue?(pt,it)=>{ue(pt,{location:de.location,params:de.matches?.[0]?.params??{},errorInfo:it})}:void 0;return Ce.reduceRight((pt,it,ht)=>{let Ci,Ui=!1,Vi=null,qi=null;de&&(Ci=se&&it.route.id?se[it.route.id]:void 0,Vi=it.route.errorElement||rS,n&&(ke<0&&ht===0?(Kb("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Ui=!0,qi=null):ke===ht&&(Ui=!0,qi=it.route.hydrateFallbackElement||null)));let on=ce.concat(Ce.slice(0,ht+1)),Ai=()=>{let an;return Ci?an=Vi:Ui?an=qi:it.route.Component?an=Tt.createElement(it.route.Component,null):it.route.element?an=it.route.element:an=pt,Tt.createElement(sS,{match:it,routeContext:{outlet:pt,matches:on,isDataRoute:de!=null},children:an})};return de&&(it.route.ErrorBoundary||it.route.errorElement||ht===0)?Tt.createElement(aS,{location:de.location,revalidation:de.revalidation,component:Vi,error:Ci,children:Ai(),routeContext:{outlet:null,matches:on,isDataRoute:!0},onError:Fe}):Ai()},null)}function _v(Z){return`${Z} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function lS(Z){let ce=Tt.useContext(yg);return Ac(ce,_v(Z)),ce}function cS(Z){let ce=Tt.useContext(e0);return Ac(ce,_v(Z)),ce}function uS(Z){let ce=Tt.useContext(Fm);return Ac(ce,_v(Z)),ce}function gv(Z){let ce=uS(Z),de=ce.matches[ce.matches.length-1];return Ac(de.route.id,`${Z} can only be used on routes that contain a unique "id"`),de.route.id}function hS(){return gv("useRouteId")}function dS(){let Z=Tt.useContext(mv),ce=cS("useRouteError"),de=gv("useRouteError");return Z!==void 0?Z:ce.errors?.[de]}function fS(){let{router:Z}=lS("useNavigate"),ce=gv("useNavigate"),de=Tt.useRef(!1);return Wb(()=>{de.current=!0}),Tt.useCallback(async(Ae,Ce={})=>{Ep(de.current,Zb),de.current&&(typeof Ae=="number"?Z.navigate(Ae):await Z.navigate(Ae,{fromRouteId:ce,...Ce}))},[Z,ce])}var pb={};function Kb(Z,ce,de){!ce&&!pb[Z]&&(pb[Z]=!0,Ep(!1,de))}Tt.memo(pS);function pS({routes:Z,future:ce,state:de,unstable_onError:ue}){return Yb(Z,void 0,de,ue,ce)}function Af(Z){Ac(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function mS({basename:Z="/",children:ce=null,location:de,navigationType:ue="POP",navigator:Ae,static:Ce=!1}){Ac(!ry(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let se=Z.replace(/^\/*/,"/"),n=Tt.useMemo(()=>({basename:se,navigator:Ae,static:Ce,future:{}}),[se,Ae,Ce]);typeof de=="string"&&(de=gg(de));let{pathname:ke="/",search:Fe="",hash:pt="",state:it=null,key:ht="default"}=de,Ci=Tt.useMemo(()=>{let Ui=c_(ke,se);return Ui==null?null:{location:{pathname:Ui,search:Fe,hash:pt,state:it,key:ht},navigationType:ue}},[se,ke,Fe,pt,it,ht,ue]);return Ep(Ci!=null,`<Router basename="${se}"> is not able to match the URL "${ke}${Fe}${pt}" because it does not start with the basename, so the <Router> won't render anything.`),Ci==null?null:Tt.createElement(km.Provider,{value:n},Tt.createElement(ny.Provider,{children:ce,value:Ci}))}function _S({children:Z,location:ce}){return iS(dv(Z),ce)}function dv(Z,ce=[]){let de=[];return Tt.Children.forEach(Z,(ue,Ae)=>{if(!Tt.isValidElement(ue))return;let Ce=[...ce,Ae];if(ue.type===Tt.Fragment){de.push.apply(de,dv(ue.props.children,Ce));return}Ac(ue.type===Af,`[${typeof ue.type=="string"?ue.type:ue.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ac(!ue.props.index||!ue.props.children,"An index route cannot have child routes.");let se={id:ue.props.id||Ce.join("-"),caseSensitive:ue.props.caseSensitive,element:ue.props.element,Component:ue.props.Component,index:ue.props.index,path:ue.props.path,middleware:ue.props.middleware,loader:ue.props.loader,action:ue.props.action,hydrateFallbackElement:ue.props.hydrateFallbackElement,HydrateFallback:ue.props.HydrateFallback,errorElement:ue.props.errorElement,ErrorBoundary:ue.props.ErrorBoundary,hasErrorBoundary:ue.props.hasErrorBoundary===!0||ue.props.ErrorBoundary!=null||ue.props.errorElement!=null,shouldRevalidate:ue.props.shouldRevalidate,handle:ue.props.handle,lazy:ue.props.lazy};ue.props.children&&(se.children=dv(ue.props.children,Ce)),de.push(se)}),de}var Zy="get",Wy="application/x-www-form-urlencoded";function t0(Z){return Z!=null&&typeof Z.tagName=="string"}function gS(Z){return t0(Z)&&Z.tagName.toLowerCase()==="button"}function yS(Z){return t0(Z)&&Z.tagName.toLowerCase()==="form"}function vS(Z){return t0(Z)&&Z.tagName.toLowerCase()==="input"}function xS(Z){return!!(Z.metaKey||Z.altKey||Z.ctrlKey||Z.shiftKey)}function bS(Z,ce){return Z.button===0&&(!ce||ce==="_self")&&!xS(Z)}function fv(Z=""){return new URLSearchParams(typeof Z=="string"||Array.isArray(Z)||Z instanceof URLSearchParams?Z:Object.keys(Z).reduce((ce,de)=>{let ue=Z[de];return ce.concat(Array.isArray(ue)?ue.map(Ae=>[de,Ae]):[[de,ue]])},[]))}function wS(Z,ce){let de=fv(Z);return ce&&ce.forEach((ue,Ae)=>{de.has(Ae)||ce.getAll(Ae).forEach(Ce=>{de.append(Ae,Ce)})}),de}var qy=null;function TS(){if(qy===null)try{new FormData(document.createElement("form"),0),qy=!1}catch{qy=!0}return qy}var SS=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function av(Z){return Z!=null&&!SS.has(Z)?(Ep(!1,`"${Z}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Wy}"`),null):Z}function ES(Z,ce){let de,ue,Ae,Ce,se;if(yS(Z)){let n=Z.getAttribute("action");ue=n?c_(n,ce):null,de=Z.getAttribute("method")||Zy,Ae=av(Z.getAttribute("enctype"))||Wy,Ce=new FormData(Z)}else if(gS(Z)||vS(Z)&&(Z.type==="submit"||Z.type==="image")){let n=Z.form;if(n==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let ke=Z.getAttribute("formaction")||n.getAttribute("action");if(ue=ke?c_(ke,ce):null,de=Z.getAttribute("formmethod")||n.getAttribute("method")||Zy,Ae=av(Z.getAttribute("formenctype"))||av(n.getAttribute("enctype"))||Wy,Ce=new FormData(n,Z),!TS()){let{name:Fe,type:pt,value:it}=Z;if(pt==="image"){let ht=Fe?`${Fe}.`:"";Ce.append(`${ht}x`,"0"),Ce.append(`${ht}y`,"0")}else Fe&&Ce.append(Fe,it)}}else{if(t0(Z))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');de=Zy,ue=null,Ae=Wy,se=Z}return Ce&&Ae==="text/plain"&&(se=Ce,Ce=void 0),{action:ue,method:de.toLowerCase(),encType:Ae,formData:Ce,body:se}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function yv(Z,ce){if(Z===!1||Z===null||typeof Z>"u")throw new Error(ce)}function AS(Z,ce,de){let ue=typeof Z=="string"?new URL(Z,typeof window>"u"?"server://singlefetch/":window.location.origin):Z;return ue.pathname==="/"?ue.pathname=`_root.${de}`:ce&&c_(ue.pathname,ce)==="/"?ue.pathname=`${ce.replace(/\/$/,"")}/_root.${de}`:ue.pathname=`${ue.pathname.replace(/\/$/,"")}.${de}`,ue}async function MS(Z,ce){if(Z.id in ce)return ce[Z.id];try{let de=await import(Z.module);return ce[Z.id]=de,de}catch(de){return console.error(`Error loading route module \`${Z.module}\`, reloading page...`),console.error(de),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function IS(Z){return Z==null?!1:Z.href==null?Z.rel==="preload"&&typeof Z.imageSrcSet=="string"&&typeof Z.imageSizes=="string":typeof Z.rel=="string"&&typeof Z.href=="string"}async function CS(Z,ce,de){let ue=await Promise.all(Z.map(async Ae=>{let Ce=ce.routes[Ae.route.id];if(Ce){let se=await MS(Ce,de);return se.links?se.links():[]}return[]}));return PS(ue.flat(1).filter(IS).filter(Ae=>Ae.rel==="stylesheet"||Ae.rel==="preload").map(Ae=>Ae.rel==="stylesheet"?{...Ae,rel:"prefetch",as:"style"}:{...Ae,rel:"prefetch"}))}function mb(Z,ce,de,ue,Ae,Ce){let se=(ke,Fe)=>de[Fe]?ke.route.id!==de[Fe].route.id:!0,n=(ke,Fe)=>de[Fe].pathname!==ke.pathname||de[Fe].route.path?.endsWith("*")&&de[Fe].params["*"]!==ke.params["*"];return Ce==="assets"?ce.filter((ke,Fe)=>se(ke,Fe)||n(ke,Fe)):Ce==="data"?ce.filter((ke,Fe)=>{let pt=ue.routes[ke.route.id];if(!pt||!pt.hasLoader)return!1;if(se(ke,Fe)||n(ke,Fe))return!0;if(ke.route.shouldRevalidate){let it=ke.route.shouldRevalidate({currentUrl:new URL(Ae.pathname+Ae.search+Ae.hash,window.origin),currentParams:de[0]?.params||{},nextUrl:new URL(Z,window.origin),nextParams:ke.params,defaultShouldRevalidate:!0});if(typeof it=="boolean")return it}return!0}):[]}function zS(Z,ce,{includeHydrateFallback:de}={}){return RS(Z.map(ue=>{let Ae=ce.routes[ue.route.id];if(!Ae)return[];let Ce=[Ae.module];return Ae.clientActionModule&&(Ce=Ce.concat(Ae.clientActionModule)),Ae.clientLoaderModule&&(Ce=Ce.concat(Ae.clientLoaderModule)),de&&Ae.hydrateFallbackModule&&(Ce=Ce.concat(Ae.hydrateFallbackModule)),Ae.imports&&(Ce=Ce.concat(Ae.imports)),Ce}).flat(1))}function RS(Z){return[...new Set(Z)]}function DS(Z){let ce={},de=Object.keys(Z).sort();for(let ue of de)ce[ue]=Z[ue];return ce}function PS(Z,ce){let de=new Set;return new Set(ce),Z.reduce((ue,Ae)=>{let Ce=JSON.stringify(DS(Ae));return de.has(Ce)||(de.add(Ce),ue.push({key:Ce,link:Ae})),ue},[])}function Jb(){let Z=Tt.useContext(yg);return yv(Z,"You must render this element inside a <DataRouterContext.Provider> element"),Z}function LS(){let Z=Tt.useContext(e0);return yv(Z,"You must render this element inside a <DataRouterStateContext.Provider> element"),Z}var vv=Tt.createContext(void 0);vv.displayName="FrameworkContext";function Qb(){let Z=Tt.useContext(vv);return yv(Z,"You must render this element inside a <HydratedRouter> element"),Z}function kS(Z,ce){let de=Tt.useContext(vv),[ue,Ae]=Tt.useState(!1),[Ce,se]=Tt.useState(!1),{onFocus:n,onBlur:ke,onMouseEnter:Fe,onMouseLeave:pt,onTouchStart:it}=ce,ht=Tt.useRef(null);Tt.useEffect(()=>{if(Z==="render"&&se(!0),Z==="viewport"){let Vi=on=>{on.forEach(Ai=>{se(Ai.isIntersecting)})},qi=new IntersectionObserver(Vi,{threshold:.5});return ht.current&&qi.observe(ht.current),()=>{qi.disconnect()}}},[Z]),Tt.useEffect(()=>{if(ue){let Vi=setTimeout(()=>{se(!0)},100);return()=>{clearTimeout(Vi)}}},[ue]);let Ci=()=>{Ae(!0)},Ui=()=>{Ae(!1),se(!1)};return de?Z!=="intent"?[Ce,ht,{}]:[Ce,ht,{onFocus:Qg(n,Ci),onBlur:Qg(ke,Ui),onMouseEnter:Qg(Fe,Ci),onMouseLeave:Qg(pt,Ui),onTouchStart:Qg(it,Ci)}]:[!1,ht,{}]}function Qg(Z,ce){return de=>{Z&&Z(de),de.defaultPrevented||ce(de)}}function FS({page:Z,...ce}){let{router:de}=Jb(),ue=Tt.useMemo(()=>jb(de.routes,Z,de.basename),[de.routes,Z,de.basename]);return ue?Tt.createElement(BS,{page:Z,matches:ue,...ce}):null}function OS(Z){let{manifest:ce,routeModules:de}=Qb(),[ue,Ae]=Tt.useState([]);return Tt.useEffect(()=>{let Ce=!1;return CS(Z,ce,de).then(se=>{Ce||Ae(se)}),()=>{Ce=!0}},[Z,ce,de]),ue}function BS({page:Z,matches:ce,...de}){let ue=M_(),{manifest:Ae,routeModules:Ce}=Qb(),{basename:se}=Jb(),{loaderData:n,matches:ke}=LS(),Fe=Tt.useMemo(()=>mb(Z,ce,ke,Ae,ue,"data"),[Z,ce,ke,Ae,ue]),pt=Tt.useMemo(()=>mb(Z,ce,ke,Ae,ue,"assets"),[Z,ce,ke,Ae,ue]),it=Tt.useMemo(()=>{if(Z===ue.pathname+ue.search+ue.hash)return[];let Ui=new Set,Vi=!1;if(ce.forEach(on=>{let Ai=Ae.routes[on.route.id];!Ai||!Ai.hasLoader||(!Fe.some(an=>an.route.id===on.route.id)&&on.route.id in n&&Ce[on.route.id]?.shouldRevalidate||Ai.hasClientLoader?Vi=!0:Ui.add(on.route.id))}),Ui.size===0)return[];let qi=AS(Z,se,"data");return Vi&&Ui.size>0&&qi.searchParams.set("_routes",ce.filter(on=>Ui.has(on.route.id)).map(on=>on.route.id).join(",")),[qi.pathname+qi.search]},[se,n,ue,Ae,Fe,ce,Z,Ce]),ht=Tt.useMemo(()=>zS(pt,Ae),[pt,Ae]),Ci=OS(pt);return Tt.createElement(Tt.Fragment,null,it.map(Ui=>Tt.createElement("link",{key:Ui,rel:"prefetch",as:"fetch",href:Ui,...de})),ht.map(Ui=>Tt.createElement("link",{key:Ui,rel:"modulepreload",href:Ui,...de})),Ci.map(({key:Ui,link:Vi})=>Tt.createElement("link",{key:Ui,nonce:de.nonce,...Vi})))}function NS(...Z){return ce=>{Z.forEach(de=>{typeof de=="function"?de(ce):de!=null&&(de.current=ce)})}}var ew=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{ew&&(window.__reactRouterVersion="7.9.6")}catch{}function jS({basename:Z,children:ce,window:de}){let ue=Tt.useRef();ue.current==null&&(ue.current=AT({window:de,v5Compat:!0}));let Ae=ue.current,[Ce,se]=Tt.useState({action:Ae.action,location:Ae.location}),n=Tt.useCallback(ke=>{Tt.startTransition(()=>se(ke))},[se]);return Tt.useLayoutEffect(()=>Ae.listen(n),[Ae,n]),Tt.createElement(mS,{basename:Z,children:ce,location:Ce.location,navigationType:Ce.action,navigator:Ae})}var tw=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Yf=Tt.forwardRef(function({onClick:ce,discover:de="render",prefetch:ue="none",relative:Ae,reloadDocument:Ce,replace:se,state:n,target:ke,to:Fe,preventScrollReset:pt,viewTransition:it,...ht},Ci){let{basename:Ui}=Tt.useContext(km),Vi=typeof Fe=="string"&&tw.test(Fe),qi,on=!1;if(typeof Fe=="string"&&Vi&&(qi=Fe,ew))try{let Bt=new URL(window.location.href),Ni=Fe.startsWith("//")?new URL(Bt.protocol+Fe):new URL(Fe),tn=c_(Ni.pathname,Ui);Ni.origin===Bt.origin&&tn!=null?Fe=tn+Ni.search+Ni.hash:on=!0}catch{Ep(!1,`<Link to="${Fe}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Ai=eS(Fe,{relative:Ae}),[an,Un,rr]=kS(ue,ht),ln=GS(Fe,{replace:se,state:n,target:ke,preventScrollReset:pt,relative:Ae,viewTransition:it});function mn(Bt){ce&&ce(Bt),Bt.defaultPrevented||ln(Bt)}let Pt=Tt.createElement("a",{...ht,...rr,href:qi||Ai,onClick:on||Ce?ce:mn,ref:NS(Ci,Un),target:ke,"data-discover":!Vi&&de==="render"?"true":void 0});return an&&!Vi?Tt.createElement(Tt.Fragment,null,Pt,Tt.createElement(FS,{page:Ai})):Pt});Yf.displayName="Link";var Yh=Tt.forwardRef(function({"aria-current":ce="page",caseSensitive:de=!1,className:ue="",end:Ae=!1,style:Ce,to:se,viewTransition:n,children:ke,...Fe},pt){let it=ay(se,{relative:Fe.relative}),ht=M_(),Ci=Tt.useContext(e0),{navigator:Ui,basename:Vi}=Tt.useContext(km),qi=Ci!=null&&WS(it)&&n===!0,on=Ui.encodeLocation?Ui.encodeLocation(it).pathname:it.pathname,Ai=ht.pathname,an=Ci&&Ci.navigation&&Ci.navigation.location?Ci.navigation.location.pathname:null;de||(Ai=Ai.toLowerCase(),an=an?an.toLowerCase():null,on=on.toLowerCase()),an&&Vi&&(an=c_(an,Vi)||an);const Un=on!=="/"&&on.endsWith("/")?on.length-1:on.length;let rr=Ai===on||!Ae&&Ai.startsWith(on)&&Ai.charAt(Un)==="/",ln=an!=null&&(an===on||!Ae&&an.startsWith(on)&&an.charAt(on.length)==="/"),mn={isActive:rr,isPending:ln,isTransitioning:qi},Pt=rr?ce:void 0,Bt;typeof ue=="function"?Bt=ue(mn):Bt=[ue,rr?"active":null,ln?"pending":null,qi?"transitioning":null].filter(Boolean).join(" ");let Ni=typeof Ce=="function"?Ce(mn):Ce;return Tt.createElement(Yf,{...Fe,"aria-current":Pt,className:Bt,ref:pt,style:Ni,to:se,viewTransition:n},typeof ke=="function"?ke(mn):ke)});Yh.displayName="NavLink";var VS=Tt.forwardRef(({discover:Z="render",fetcherKey:ce,navigate:de,reloadDocument:ue,replace:Ae,state:Ce,method:se=Zy,action:n,onSubmit:ke,relative:Fe,preventScrollReset:pt,viewTransition:it,...ht},Ci)=>{let Ui=$S(),Vi=ZS(n,{relative:Fe}),qi=se.toLowerCase()==="get"?"get":"post",on=typeof n=="string"&&tw.test(n),Ai=an=>{if(ke&&ke(an),an.defaultPrevented)return;an.preventDefault();let Un=an.nativeEvent.submitter,rr=Un?.getAttribute("formmethod")||se;Ui(Un||an.currentTarget,{fetcherKey:ce,method:rr,navigate:de,replace:Ae,state:Ce,relative:Fe,preventScrollReset:pt,viewTransition:it})};return Tt.createElement("form",{ref:Ci,method:qi,action:Vi,onSubmit:ue?ke:Ai,...ht,"data-discover":!on&&Z==="render"?"true":void 0})});VS.displayName="Form";function US(Z){return`${Z} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function iw(Z){let ce=Tt.useContext(yg);return Ac(ce,US(Z)),ce}function GS(Z,{target:ce,replace:de,state:ue,preventScrollReset:Ae,relative:Ce,viewTransition:se}={}){let n=$_(),ke=M_(),Fe=ay(Z,{relative:Ce});return Tt.useCallback(pt=>{if(bS(pt,ce)){pt.preventDefault();let it=de!==void 0?de:ty(ke)===ty(Fe);n(Z,{replace:it,state:ue,preventScrollReset:Ae,relative:Ce,viewTransition:se})}},[ke,n,Fe,de,ue,ce,Z,Ae,Ce,se])}function nw(Z){Ep(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let ce=Tt.useRef(fv(Z)),de=Tt.useRef(!1),ue=M_(),Ae=Tt.useMemo(()=>wS(ue.search,de.current?null:ce.current),[ue.search]),Ce=$_(),se=Tt.useCallback((n,ke)=>{const Fe=fv(typeof n=="function"?n(new URLSearchParams(Ae)):n);de.current=!0,Ce("?"+Fe,ke)},[Ce,Ae]);return[Ae,se]}var HS=0,qS=()=>`__${String(++HS)}__`;function $S(){let{router:Z}=iw("useSubmit"),{basename:ce}=Tt.useContext(km),de=hS();return Tt.useCallback(async(ue,Ae={})=>{let{action:Ce,method:se,encType:n,formData:ke,body:Fe}=ES(ue,ce);if(Ae.navigate===!1){let pt=Ae.fetcherKey||qS();await Z.fetch(pt,de,Ae.action||Ce,{preventScrollReset:Ae.preventScrollReset,formData:ke,body:Fe,formMethod:Ae.method||se,formEncType:Ae.encType||n,flushSync:Ae.flushSync})}else await Z.navigate(Ae.action||Ce,{preventScrollReset:Ae.preventScrollReset,formData:ke,body:Fe,formMethod:Ae.method||se,formEncType:Ae.encType||n,replace:Ae.replace,state:Ae.state,fromRouteId:de,flushSync:Ae.flushSync,viewTransition:Ae.viewTransition})},[Z,ce,de])}function ZS(Z,{relative:ce}={}){let{basename:de}=Tt.useContext(km),ue=Tt.useContext(Fm);Ac(ue,"useFormAction must be used inside a RouteContext");let[Ae]=ue.matches.slice(-1),Ce={...ay(Z||".",{relative:ce})},se=M_();if(Z==null){Ce.search=se.search;let n=new URLSearchParams(Ce.search),ke=n.getAll("index");if(ke.some(pt=>pt==="")){n.delete("index"),ke.filter(it=>it).forEach(it=>n.append("index",it));let pt=n.toString();Ce.search=pt?`?${pt}`:""}}return(!Z||Z===".")&&Ae.route.index&&(Ce.search=Ce.search?Ce.search.replace(/^\?/,"?index&"):"?index"),de!=="/"&&(Ce.pathname=Ce.pathname==="/"?de:l_([de,Ce.pathname])),ty(Ce)}function WS(Z,{relative:ce}={}){let de=Tt.useContext($b);Ac(de!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:ue}=iw("useViewTransitionState"),Ae=ay(Z,{relative:ce});if(!de.isTransitioning)return!1;let Ce=c_(de.currentLocation.pathname,ue)||de.currentLocation.pathname,se=c_(de.nextLocation.pathname,ue)||de.nextLocation.pathname;return Jy(Ae.pathname,se)!=null||Jy(Ae.pathname,Ce)!=null}var rw=Nb();const XS=[{title:"Bus Rapid Transit",routes:[{code:"A",color:"#DA322C",name:"Route A"},{code:"B*",color:"#8FBA40",name:"Route B (limited service)"},{code:"F*",color:"#2967A0",name:"Route F (limited service)"}]},{title:"Campus Buses",routes:[{code:"80",color:"#2D2D51",name:"Route 80"},{code:"82",color:"#2D2D51",name:"Route 82"},{code:"81",color:"#2D2D51",name:"Route 81"},{code:"84",color:"#2D2D51",name:"Route 84"}]},{title:"Standard Service",routes:[{code:"C",color:"#2D2D51",name:"Route C"},{code:"D",color:"#2D2D51",name:"Route D"},{code:"E",color:"#2967A0",name:"Route E"},{code:"G",color:"#2967A0",name:"Route G"},{code:"H",color:"#2967A0",name:"Route H"},{code:"J",color:"#2967A0",name:"Route J"},{code:"L",color:"#4BA0BF",name:"Route L"},{code:"O",color:"#4BA0BF",name:"Route O"},{code:"P",color:"#4BA0BF",name:"Route P"},{code:"R",color:"#4BA0BF",name:"Route R"},{code:"S",color:"#4BA0BF",name:"Route S"},{code:"W",color:"#2967A0",name:"Route W"},{code:"28",color:"#2967A0",name:"Route 28"},{code:"38",color:"#2967A0",name:"Route 38"},{code:"55",color:"#4BA0BF",name:"Route 55"},{code:"60",color:"#4BA0BF",name:"Route 60"},{code:"61",color:"#4BA0BF",name:"Route 61"},{code:"62",color:"#4BA0BF",name:"Route 62"},{code:"63",color:"#4BA0BF",name:"Route 63"},{code:"64",color:"#4BA0BF",name:"Route 64"},{code:"65",color:"#4BA0BF",name:"Route 65"},{code:"75",color:"#4BA0BF",name:"Route 75"}]}];function YS(){const Z=new Date,ce=Z.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),de=Z.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return he.jsx("main",{className:"routes-root",children:he.jsxs("div",{className:"routes-inner",children:[he.jsxs("header",{className:"home-header",children:[he.jsxs("div",{className:"home-header-top",children:[he.jsxs(Yf,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[he.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),he.jsxs("div",{className:"home-wordmark",children:[he.jsx("div",{className:"home-logo-text-main",children:"badger"}),he.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),he.jsxs("div",{className:"home-clock","aria-live":"off",children:[he.jsx("div",{className:"home-clock-date",children:de}),he.jsx("div",{className:"home-clock-time",children:ce})]})]}),he.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[he.jsx(Yh,{to:"/",end:!0,className:({isActive:ue})=>`home-nav-tab${ue?" home-nav-tab--active":""}`,children:"Home"}),he.jsx(Yh,{to:"/recent",className:({isActive:ue})=>`home-nav-tab${ue?" home-nav-tab--active":""}`,children:"Recent"}),he.jsx(Yh,{to:"/map",className:({isActive:ue})=>`home-nav-tab${ue?" home-nav-tab--active":""}`,children:"Map"}),he.jsx(Yh,{to:"/routes",className:({isActive:ue})=>`home-nav-tab${ue?" home-nav-tab--active":""}`,children:"Routes"})]})]}),he.jsxs("section",{className:"routes-hero","aria-labelledby":"routes-title",children:[he.jsx("h1",{id:"routes-title",className:"routes-hero-title",children:" Routes"}),he.jsx("p",{className:"routes-hero-subtitle",children:"Select a route to see live bus locations"})]}),he.jsx("div",{className:"routes-groups",children:XS.map(ue=>he.jsxs("section",{className:"routes-panel","aria-labelledby":`group-${ue.title.replace(/\s+/g,"-").toLowerCase()}`,children:[he.jsx("h2",{id:`group-${ue.title.replace(/\s+/g,"-").toLowerCase()}`,className:"routes-panel-title",children:ue.title}),he.jsx("nav",{className:"routes-chip-row","aria-label":`${ue.title} routes`,children:ue.routes.map(Ae=>he.jsx(Yf,{to:`/map/${Ae.code}`,className:"route-chip-link",style:{backgroundColor:Ae.color},"aria-label":`View ${Ae.name} on map`,children:he.jsx("span",{"aria-hidden":"true",children:Ae.code})},Ae.code))})]},ue.title))}),he.jsxs("footer",{className:"home-footer routes-footer",children:[he.jsxs("div",{className:"home-footer-left",children:[he.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),he.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),he.jsxs("div",{className:"home-footer-links",children:[he.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),he.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),he.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}const KS="modulepreload",JS=function(Z){return"/mad-transit/"+Z},_b={},aw=function(ce,de,ue){let Ae=Promise.resolve();if(de&&de.length>0){let Fe=function(pt){return Promise.all(pt.map(it=>Promise.resolve(it).then(ht=>({status:"fulfilled",value:ht}),ht=>({status:"rejected",reason:ht}))))};var se=Fe;document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),ke=n?.nonce||n?.getAttribute("nonce");Ae=Fe(de.map(pt=>{if(pt=JS(pt),pt in _b)return;_b[pt]=!0;const it=pt.endsWith(".css"),ht=it?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${pt}"]${ht}`))return;const Ci=document.createElement("link");if(Ci.rel=it?"stylesheet":KS,it||(Ci.as="script"),Ci.crossOrigin="",Ci.href=pt,ke&&Ci.setAttribute("nonce",ke),document.head.appendChild(Ci),it)return new Promise((Ui,Vi)=>{Ci.addEventListener("load",Ui),Ci.addEventListener("error",()=>Vi(new Error(`Unable to preload CSS for ${pt}`)))})}))}function Ce(n){const ke=new Event("vite:preloadError",{cancelable:!0});if(ke.payload=n,window.dispatchEvent(ke),!ke.defaultPrevented)throw n}return Ae.then(n=>{for(const ke of n||[])ke.status==="rejected"&&Ce(ke.reason);return ce().catch(Ce)})},sw=Tt.createContext(null);function ow(){var Z;const ce=(Z=Tt.useContext(sw))===null||Z===void 0?void 0:Z.maps,de=Tt.useContext(Z_);return Tt.useMemo(()=>({...ce,current:de?.map}),[ce,de])}function QS(Z,ce){const de=Array.isArray(Z)?Z[0]:Z?Z.x:0,ue=Array.isArray(Z)?Z[1]:Z?Z.y:0,Ae=Array.isArray(ce)?ce[0]:ce?ce.x:0,Ce=Array.isArray(ce)?ce[1]:ce?ce.y:0;return de===Ae&&ue===Ce}function Kf(Z,ce){if(Z===ce)return!0;if(!Z||!ce)return!1;if(Array.isArray(Z)){if(!Array.isArray(ce)||Z.length!==ce.length)return!1;for(let de=0;de<Z.length;de++)if(!Kf(Z[de],ce[de]))return!1;return!0}else if(Array.isArray(ce))return!1;if(typeof Z=="object"&&typeof ce=="object"){const de=Object.keys(Z),ue=Object.keys(ce);if(de.length!==ue.length)return!1;for(const Ae of de)if(!ce.hasOwnProperty(Ae)||!Kf(Z[Ae],ce[Ae]))return!1;return!0}return!1}function e4(Z){const ce=Z.clone();return ce.pixelsToGLUnits=Z.pixelsToGLUnits,ce}function gb(Z,ce){if(!Z.getProjection)return;const de=Z.getProjection(),ue=ce.getProjection();Kf(de,ue)||ce.setProjection(de)}function yb(Z){return{longitude:Z.center.lng,latitude:Z.center.lat,zoom:Z.zoom,pitch:Z.pitch,bearing:Z.bearing,padding:Z.padding}}function vb(Z,ce){const de=ce.viewState||ce;let ue=!1;if("zoom"in de){const Ae=Z.zoom;Z.zoom=de.zoom,ue=ue||Ae!==Z.zoom}if("bearing"in de){const Ae=Z.bearing;Z.bearing=de.bearing,ue=ue||Ae!==Z.bearing}if("pitch"in de){const Ae=Z.pitch;Z.pitch=de.pitch,ue=ue||Ae!==Z.pitch}if(de.padding&&!Z.isPaddingEqual(de.padding)&&(ue=!0,Z.padding=de.padding),"longitude"in de&&"latitude"in de){const Ae=Z.center;Z.center=new Ae.constructor(de.longitude,de.latitude),ue=ue||Ae!==Z.center}return ue}const t4=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function xb(Z){if(!Z)return null;if(typeof Z=="string"||("toJS"in Z&&(Z=Z.toJS()),!Z.layers))return Z;const ce={};for(const ue of Z.layers)ce[ue.id]=ue;const de=Z.layers.map(ue=>{let Ae=null;"interactive"in ue&&(Ae=Object.assign({},ue),delete Ae.interactive);const Ce=ce[ue.ref];if(Ce){Ae=Ae||Object.assign({},ue),delete Ae.ref;for(const se of t4)se in Ce&&(Ae[se]=Ce[se])}return Ae||ue});return{...Z,layers:de}}var bb={};const wb={version:8,sources:{},layers:[]},Tb={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},sv={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},Sb={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},i4=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],n4=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class _g{constructor(ce,de,ue){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=Ae=>{const Ce=this.props[Sb[Ae.type]];Ce?Ce(Ae):Ae.type==="error"&&console.error(Ae.error)},this._onPointerEvent=Ae=>{(Ae.type==="mousemove"||Ae.type==="mouseout")&&this._updateHover(Ae);const Ce=this.props[Tb[Ae.type]];Ce&&(this.props.interactiveLayerIds&&Ae.type!=="mouseover"&&Ae.type!=="mouseout"&&(Ae.features=this._hoveredFeatures||this._queryRenderedFeatures(Ae.point)),Ce(Ae),delete Ae.features)},this._onCameraEvent=Ae=>{if(!this._internalUpdate){const Ce=this.props[sv[Ae.type]];Ce&&Ce(Ae)}Ae.type in this._deferredEvents&&(this._deferredEvents[Ae.type]=!1)},this._MapClass=ce,this.props=de,this._initialize(ue)}get map(){return this._map}get transform(){return this._renderTransform}setProps(ce){const de=this.props;this.props=ce;const ue=this._updateSettings(ce,de);ue&&this._createShadowTransform(this._map);const Ae=this._updateSize(ce),Ce=this._updateViewState(ce,!0);this._updateStyle(ce,de),this._updateStyleComponents(ce,de),this._updateHandlers(ce,de),(ue||Ae||Ce&&!this._map.isMoving())&&this.redraw()}static reuse(ce,de){const ue=_g.savedMaps.pop();if(!ue)return null;const Ae=ue.map,Ce=Ae.getContainer();for(de.className=Ce.className;Ce.childNodes.length>0;)de.appendChild(Ce.childNodes[0]);Ae._container=de;const se=Ae._resizeObserver;se&&(se.disconnect(),se.observe(de)),ue.setProps({...ce,styleDiffing:!1}),Ae.resize();const{initialViewState:n}=ce;return n&&(n.bounds?Ae.fitBounds(n.bounds,{...n.fitBoundsOptions,duration:0}):ue._updateViewState(n,!1)),Ae.isStyleLoaded()?Ae.fire("load"):Ae.once("styledata",()=>Ae.fire("load")),Ae._update(),ue}_initialize(ce){const{props:de}=this,{mapStyle:ue=wb}=de,Ae={...de,...de.initialViewState,accessToken:de.mapboxAccessToken||r4()||null,container:ce,style:xb(ue)},Ce=Ae.initialViewState||Ae.viewState||Ae;if(Object.assign(Ae,{center:[Ce.longitude||0,Ce.latitude||0],zoom:Ce.zoom||0,pitch:Ce.pitch||0,bearing:Ce.bearing||0}),de.gl){const pt=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=pt,de.gl)}const se=new this._MapClass(Ae);Ce.padding&&se.setPadding(Ce.padding),de.cursor&&(se.getCanvas().style.cursor=de.cursor),this._createShadowTransform(se);const n=se._render;se._render=pt=>{this._inRender=!0,n.call(se,pt),this._inRender=!1};const ke=se._renderTaskQueue.run;se._renderTaskQueue.run=pt=>{ke.call(se._renderTaskQueue,pt),this._onBeforeRepaint()},se.on("render",()=>this._onAfterRepaint());const Fe=se.fire;se.fire=this._fireEvent.bind(this,Fe),se.on("resize",()=>{this._renderTransform.resize(se.transform.width,se.transform.height)}),se.on("styledata",()=>{this._updateStyleComponents(this.props,{}),gb(se.transform,this._renderTransform)}),se.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const pt in Tb)se.on(pt,this._onPointerEvent);for(const pt in sv)se.on(pt,this._onCameraEvent);for(const pt in Sb)se.on(pt,this._onEvent);this._map=se}recycle(){const de=this.map.getContainer().querySelector("[mapboxgl-children]");de?.remove(),_g.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const ce=this._map;!this._inRender&&ce.style&&(ce._frame&&(ce._frame.cancel(),ce._frame=null),ce._render())}_createShadowTransform(ce){const de=e4(ce.transform);ce.painter.transform=de,this._renderTransform=de}_updateSize(ce){const{viewState:de}=ce;if(de){const ue=this._map;if(de.width!==ue.transform.width||de.height!==ue.transform.height)return ue.resize(),!0}return!1}_updateViewState(ce,de){if(this._internalUpdate)return!1;const ue=this._map,Ae=this._renderTransform,{zoom:Ce,pitch:se,bearing:n}=Ae,ke=ue.isMoving();ke&&(Ae.cameraElevationReference="sea");const Fe=vb(Ae,{...yb(ue.transform),...ce});if(ke&&(Ae.cameraElevationReference="ground"),Fe&&de){const pt=this._deferredEvents;pt.move=!0,pt.zoom||(pt.zoom=Ce!==Ae.zoom),pt.rotate||(pt.rotate=n!==Ae.bearing),pt.pitch||(pt.pitch=se!==Ae.pitch)}return ke||vb(ue.transform,ce),Fe}_updateSettings(ce,de){const ue=this._map;let Ae=!1;for(const Ce of i4)if(Ce in ce&&!Kf(ce[Ce],de[Ce])){Ae=!0;const se=ue[`set${Ce[0].toUpperCase()}${Ce.slice(1)}`];se?.call(ue,ce[Ce])}return Ae}_updateStyle(ce,de){if(ce.cursor!==de.cursor&&(this._map.getCanvas().style.cursor=ce.cursor||""),ce.mapStyle!==de.mapStyle){const{mapStyle:ue=wb,styleDiffing:Ae=!0}=ce,Ce={diff:Ae};return"localIdeographFontFamily"in ce&&(Ce.localIdeographFontFamily=ce.localIdeographFontFamily),this._map.setStyle(xb(ue),Ce),!0}return!1}_updateStyleComponents(ce,de){const ue=this._map;let Ae=!1;return ue.isStyleLoaded()&&("light"in ce&&ue.setLight&&!Kf(ce.light,de.light)&&(Ae=!0,ue.setLight(ce.light)),"fog"in ce&&ue.setFog&&!Kf(ce.fog,de.fog)&&(Ae=!0,ue.setFog(ce.fog)),"terrain"in ce&&ue.setTerrain&&!Kf(ce.terrain,de.terrain)&&(!ce.terrain||ue.getSource(ce.terrain.source))&&(Ae=!0,ue.setTerrain(ce.terrain))),Ae}_updateHandlers(ce,de){var ue,Ae;const Ce=this._map;let se=!1;for(const n of n4){const ke=(ue=ce[n])!==null&&ue!==void 0?ue:!0,Fe=(Ae=de[n])!==null&&Ae!==void 0?Ae:!0;Kf(ke,Fe)||(se=!0,ke?Ce[n].enable(ke):Ce[n].disable())}return se}_queryRenderedFeatures(ce){const de=this._map,ue=de.transform,{interactiveLayerIds:Ae=[]}=this.props;try{return de.transform=this._renderTransform,de.queryRenderedFeatures(ce,{layers:Ae.filter(de.getLayer.bind(de))})}catch{return[]}finally{de.transform=ue}}_updateHover(ce){var de;const{props:ue}=this;if(ue.interactiveLayerIds&&(ue.onMouseMove||ue.onMouseEnter||ue.onMouseLeave)){const Ce=ce.type,se=((de=this._hoveredFeatures)===null||de===void 0?void 0:de.length)>0,n=this._queryRenderedFeatures(ce.point),ke=n.length>0;!ke&&se&&(ce.type="mouseleave",this._onPointerEvent(ce)),this._hoveredFeatures=n,ke&&!se&&(ce.type="mouseenter",this._onPointerEvent(ce)),ce.type=Ce}else this._hoveredFeatures=null}_fireEvent(ce,de,ue){const Ae=this._map,Ce=Ae.transform,se=typeof de=="string"?de:de.type;return se==="move"&&this._updateViewState(this.props,!1),se in sv&&(typeof de=="object"&&(de.viewState=yb(Ce)),this._map.isMoving())?(Ae.transform=this._renderTransform,ce.call(Ae,de,ue),Ae.transform=Ce,Ae):(ce.call(Ae,de,ue),Ae)}_onBeforeRepaint(){const ce=this._map;this._internalUpdate=!0;for(const ue in this._deferredEvents)this._deferredEvents[ue]&&ce.fire(ue);this._internalUpdate=!1;const de=this._map.transform;ce.transform=this._renderTransform,this._onAfterRepaint=()=>{gb(this._renderTransform,de),ce.transform=de}}}_g.savedMaps=[];function r4(){let Z=null;if(typeof location<"u"){const ce=/access_token=([^&\/]*)/.exec(location.search);Z=ce&&ce[1]}try{Z=Z||bb.MapboxAccessToken}catch{}try{Z=Z||bb.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return Z}const a4=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function s4(Z){if(!Z)return null;const ce=Z.map,de={getMap:()=>ce,getCenter:()=>Z.transform.center,getZoom:()=>Z.transform.zoom,getBearing:()=>Z.transform.bearing,getPitch:()=>Z.transform.pitch,getPadding:()=>Z.transform.padding,getBounds:()=>Z.transform.getBounds(),project:ue=>{const Ae=ce.transform;ce.transform=Z.transform;const Ce=ce.project(ue);return ce.transform=Ae,Ce},unproject:ue=>{const Ae=ce.transform;ce.transform=Z.transform;const Ce=ce.unproject(ue);return ce.transform=Ae,Ce},queryTerrainElevation:(ue,Ae)=>{const Ce=ce.transform;ce.transform=Z.transform;const se=ce.queryTerrainElevation(ue,Ae);return ce.transform=Ce,se},queryRenderedFeatures:(ue,Ae)=>{const Ce=ce.transform;ce.transform=Z.transform;const se=ce.queryRenderedFeatures(ue,Ae);return ce.transform=Ce,se}};for(const ue of o4(ce))!(ue in de)&&!a4.includes(ue)&&(de[ue]=ce[ue].bind(ce));return de}function o4(Z){const ce=new Set;let de=Z;for(;de;){for(const ue of Object.getOwnPropertyNames(de))ue[0]!=="_"&&typeof Z[ue]=="function"&&ue!=="fire"&&ue!=="setEventedParent"&&ce.add(ue);de=Object.getPrototypeOf(de)}return Array.from(ce)}const l4=typeof document<"u"?Tt.useLayoutEffect:Tt.useEffect,c4=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function u4(Z,ce){for(const ue of c4)ue in ce&&(Z[ue]=ce[ue]);const{RTLTextPlugin:de="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=ce;de&&Z.getRTLTextPluginStatus&&Z.getRTLTextPluginStatus()==="unavailable"&&Z.setRTLTextPlugin(de,ue=>{ue&&console.error(ue)},!0)}const Z_=Tt.createContext(null);function lw(Z,ce,de){const ue=Tt.useContext(sw),[Ae,Ce]=Tt.useState(null),se=Tt.useRef(),{current:n}=Tt.useRef({mapLib:null,map:null});Tt.useEffect(()=>{const pt=Z.mapLib;let it=!0,ht;return Promise.resolve(pt||de).then(Ci=>{if(!it)return;if(!Ci)throw new Error("Invalid mapLib");const Ui="Map"in Ci?Ci:Ci.default;if(!Ui.Map)throw new Error("Invalid mapLib");if(u4(Ui,Z),!Ui.supported||Ui.supported(Z))Z.reuseMaps&&(ht=_g.reuse(Z,se.current)),ht||(ht=new _g(Ui.Map,Z,se.current)),n.map=s4(ht),n.mapLib=Ui,Ce(ht),ue?.onMapMount(n.map,Z.id);else throw new Error("Map is not supported by this browser")}).catch(Ci=>{const{onError:Ui}=Z;Ui?Ui({type:"error",target:null,originalEvent:null,error:Ci}):console.error(Ci)}),()=>{it=!1,ht&&(ue?.onMapUnmount(Z.id),Z.reuseMaps?ht.recycle():ht.destroy())}},[]),l4(()=>{Ae&&Ae.setProps(Z)}),Tt.useImperativeHandle(ce,()=>n.map,[Ae]);const ke=Tt.useMemo(()=>({position:"relative",width:"100%",height:"100%",...Z.style}),[Z.style]),Fe={height:"100%"};return Tt.createElement("div",{id:Z.id,ref:se,style:ke},Ae&&Tt.createElement(Z_.Provider,{value:n},Tt.createElement("div",{"mapboxgl-children":"",style:Fe},Z.children)))}const h4=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function W_(Z,ce){if(!Z||!ce)return;const de=Z.style;for(const ue in ce){const Ae=ce[ue];Number.isFinite(Ae)&&!h4.test(ue)?de[ue]=`${Ae}px`:de[ue]=Ae}}function d4(Z,ce){const{map:de,mapLib:ue}=Tt.useContext(Z_),Ae=Tt.useRef({props:Z});Ae.current.props=Z;const Ce=Tt.useMemo(()=>{let Vi=!1;Tt.Children.forEach(Z.children,Ai=>{Ai&&(Vi=!0)});const qi={...Z,element:Vi?document.createElement("div"):null},on=new ue.Marker(qi);return on.setLngLat([Z.longitude,Z.latitude]),on.getElement().addEventListener("click",Ai=>{var an,Un;(Un=(an=Ae.current.props).onClick)===null||Un===void 0||Un.call(an,{type:"click",target:on,originalEvent:Ai})}),on.on("dragstart",Ai=>{var an,Un;const rr=Ai;rr.lngLat=Ce.getLngLat(),(Un=(an=Ae.current.props).onDragStart)===null||Un===void 0||Un.call(an,rr)}),on.on("drag",Ai=>{var an,Un;const rr=Ai;rr.lngLat=Ce.getLngLat(),(Un=(an=Ae.current.props).onDrag)===null||Un===void 0||Un.call(an,rr)}),on.on("dragend",Ai=>{var an,Un;const rr=Ai;rr.lngLat=Ce.getLngLat(),(Un=(an=Ae.current.props).onDragEnd)===null||Un===void 0||Un.call(an,rr)}),on},[]);Tt.useEffect(()=>(Ce.addTo(de.getMap()),()=>{Ce.remove()}),[]);const{longitude:se,latitude:n,offset:ke,style:Fe,draggable:pt=!1,popup:it=null,rotation:ht=0,rotationAlignment:Ci="auto",pitchAlignment:Ui="auto"}=Z;return Tt.useEffect(()=>{W_(Ce.getElement(),Fe)},[Fe]),Tt.useImperativeHandle(ce,()=>Ce,[]),(Ce.getLngLat().lng!==se||Ce.getLngLat().lat!==n)&&Ce.setLngLat([se,n]),ke&&!QS(Ce.getOffset(),ke)&&Ce.setOffset(ke),Ce.isDraggable()!==pt&&Ce.setDraggable(pt),Ce.getRotation()!==ht&&Ce.setRotation(ht),Ce.getRotationAlignment()!==Ci&&Ce.setRotationAlignment(Ci),Ce.getPitchAlignment()!==Ui&&Ce.setPitchAlignment(Ui),Ce.getPopup()!==it&&Ce.setPopup(it),rw.createPortal(Z.children,Ce.getElement())}const f4=Tt.memo(Tt.forwardRef(d4));function Eb(Z){return new Set(Z?Z.trim().split(/\s+/):[])}function p4(Z,ce){const{map:de,mapLib:ue}=Tt.useContext(Z_),Ae=Tt.useMemo(()=>document.createElement("div"),[]),Ce=Tt.useRef({props:Z});Ce.current.props=Z;const se=Tt.useMemo(()=>{const n={...Z},ke=new ue.Popup(n);return ke.setLngLat([Z.longitude,Z.latitude]),ke.once("open",Fe=>{var pt,it;(it=(pt=Ce.current.props).onOpen)===null||it===void 0||it.call(pt,Fe)}),ke},[]);if(Tt.useEffect(()=>{const n=ke=>{var Fe,pt;(pt=(Fe=Ce.current.props).onClose)===null||pt===void 0||pt.call(Fe,ke)};return se.on("close",n),se.setDOMContent(Ae).addTo(de.getMap()),()=>{se.off("close",n),se.isOpen()&&se.remove()}},[]),Tt.useEffect(()=>{W_(se.getElement(),Z.style)},[Z.style]),Tt.useImperativeHandle(ce,()=>se,[]),se.isOpen()&&((se.getLngLat().lng!==Z.longitude||se.getLngLat().lat!==Z.latitude)&&se.setLngLat([Z.longitude,Z.latitude]),Z.offset&&!Kf(se.options.offset,Z.offset)&&se.setOffset(Z.offset),(se.options.anchor!==Z.anchor||se.options.maxWidth!==Z.maxWidth)&&(se.options.anchor=Z.anchor,se.setMaxWidth(Z.maxWidth)),se.options.className!==Z.className)){const n=Eb(se.options.className),ke=Eb(Z.className);for(const Fe of n)ke.has(Fe)||se.removeClassName(Fe);for(const Fe of ke)n.has(Fe)||se.addClassName(Fe);se.options.className=Z.className}return rw.createPortal(Z.children,Ae)}Tt.memo(Tt.forwardRef(p4));function sy(Z,ce,de,ue){const Ae=Tt.useContext(Z_),Ce=Tt.useMemo(()=>Z(Ae),[]);return Tt.useEffect(()=>{const se=ce,n=null,ke=typeof ce=="function"?ce:null,{map:Fe}=Ae;return Fe.hasControl(Ce)||(Fe.addControl(Ce,se?.position),n&&n(Ae)),()=>{ke&&ke(Ae),Fe.hasControl(Ce)&&Fe.removeControl(Ce)}},[]),Ce}function m4(Z){const ce=sy(({mapLib:de})=>new de.AttributionControl(Z),{position:Z.position});return Tt.useEffect(()=>{W_(ce._container,Z.style)},[Z.style]),null}Tt.memo(m4);function _4(Z){const ce=sy(({mapLib:de})=>new de.FullscreenControl({container:Z.containerId&&document.getElementById(Z.containerId)}),{position:Z.position});return Tt.useEffect(()=>{W_(ce._controlContainer,Z.style)},[Z.style]),null}Tt.memo(_4);function g4(Z,ce){const de=Tt.useRef({props:Z}),ue=sy(({mapLib:Ae})=>{const Ce=new Ae.GeolocateControl(Z),se=Ce._setupUI;return Ce._setupUI=n=>{Ce._container.hasChildNodes()||se(n)},Ce.on("geolocate",n=>{var ke,Fe;(Fe=(ke=de.current.props).onGeolocate)===null||Fe===void 0||Fe.call(ke,n)}),Ce.on("error",n=>{var ke,Fe;(Fe=(ke=de.current.props).onError)===null||Fe===void 0||Fe.call(ke,n)}),Ce.on("outofmaxbounds",n=>{var ke,Fe;(Fe=(ke=de.current.props).onOutOfMaxBounds)===null||Fe===void 0||Fe.call(ke,n)}),Ce.on("trackuserlocationstart",n=>{var ke,Fe;(Fe=(ke=de.current.props).onTrackUserLocationStart)===null||Fe===void 0||Fe.call(ke,n)}),Ce.on("trackuserlocationend",n=>{var ke,Fe;(Fe=(ke=de.current.props).onTrackUserLocationEnd)===null||Fe===void 0||Fe.call(ke,n)}),Ce},{position:Z.position});return de.current.props=Z,Tt.useImperativeHandle(ce,()=>ue,[]),Tt.useEffect(()=>{W_(ue._container,Z.style)},[Z.style]),null}Tt.memo(Tt.forwardRef(g4));function y4(Z){const ce=sy(({mapLib:de})=>new de.NavigationControl(Z),{position:Z.position});return Tt.useEffect(()=>{W_(ce._container,Z.style)},[Z.style]),null}Tt.memo(y4);function v4(Z){const ce=sy(({mapLib:Ce})=>new Ce.ScaleControl(Z),{position:Z.position}),de=Tt.useRef(Z),ue=de.current;de.current=Z;const{style:Ae}=Z;return Z.maxWidth!==void 0&&Z.maxWidth!==ue.maxWidth&&(ce.options.maxWidth=Z.maxWidth),Z.unit!==void 0&&Z.unit!==ue.unit&&ce.setUnit(Z.unit),Tt.useEffect(()=>{W_(ce._container,Ae)},[Ae]),null}Tt.memo(v4);function Qy(Z,ce){if(!Z)throw new Error(ce)}function x4(Z,ce,de,ue){if(Qy(de.id===ue.id,"layer id changed"),Qy(de.type===ue.type,"layer type changed"),de.type==="custom"||ue.type==="custom")return;const{layout:Ae={},paint:Ce={},filter:se,minzoom:n,maxzoom:ke,beforeId:Fe}=de;if(Fe!==ue.beforeId&&Z.moveLayer(ce,Fe),Ae!==ue.layout){const pt=ue.layout||{};for(const it in Ae)Kf(Ae[it],pt[it])||Z.setLayoutProperty(ce,it,Ae[it]);for(const it in pt)Ae.hasOwnProperty(it)||Z.setLayoutProperty(ce,it,void 0)}if(Ce!==ue.paint){const pt=ue.paint||{};for(const it in Ce)Kf(Ce[it],pt[it])||Z.setPaintProperty(ce,it,Ce[it]);for(const it in pt)Ce.hasOwnProperty(it)||Z.setPaintProperty(ce,it,void 0)}Kf(se,ue.filter)||Z.setFilter(ce,se),(n!==ue.minzoom||ke!==ue.maxzoom)&&Z.setLayerZoomRange(ce,n,ke)}function b4(Z,ce,de){if(Z.style&&Z.style._loaded&&(!("source"in de)||Z.getSource(de.source))){const ue={...de,id:ce};delete ue.beforeId,Z.addLayer(ue,de.beforeId)}}let w4=0;function cw(Z){const ce=Tt.useContext(Z_).map.getMap(),de=Tt.useRef(Z),[,ue]=Tt.useState(0),Ae=Tt.useMemo(()=>Z.id||`jsx-layer-${w4++}`,[]);if(Tt.useEffect(()=>{if(ce){const se=()=>ue(n=>n+1);return ce.on("styledata",se),se(),()=>{ce.off("styledata",se),ce.style&&ce.style._loaded&&ce.getLayer(Ae)&&ce.removeLayer(Ae)}}},[ce]),ce&&ce.style&&ce.getLayer(Ae))try{x4(ce,Ae,Z,de.current)}catch(se){console.warn(se)}else b4(ce,Ae,Z);return de.current=Z,null}let T4=0;function S4(Z,ce,de){if(Z.style&&Z.style._loaded){const ue={...de};return delete ue.id,delete ue.children,Z.addSource(ce,ue),Z.getSource(ce)}return null}function E4(Z,ce,de){Qy(ce.id===de.id,"source id changed"),Qy(ce.type===de.type,"source type changed");let ue="",Ae=0;for(const se in ce)se!=="children"&&se!=="id"&&!Kf(de[se],ce[se])&&(ue=se,Ae++);if(!Ae)return;const Ce=ce.type;Ce==="geojson"?Z.setData(ce.data):Ce==="image"?Z.updateImage({url:ce.url,coordinates:ce.coordinates}):"setCoordinates"in Z&&Ae===1&&ue==="coordinates"?Z.setCoordinates(ce.coordinates):"setUrl"in Z&&ue==="url"?Z.setUrl(ce.url):"setTiles"in Z&&ue==="tiles"?Z.setTiles(ce.tiles):console.warn(`Unable to update <Source> prop: ${ue}`)}function uw(Z){const ce=Tt.useContext(Z_).map.getMap(),de=Tt.useRef(Z),[,ue]=Tt.useState(0),Ae=Tt.useMemo(()=>Z.id||`jsx-source-${T4++}`,[]);Tt.useEffect(()=>{if(ce){const se=()=>setTimeout(()=>ue(n=>n+1),0);return ce.on("styledata",se),se(),()=>{var n;if(ce.off("styledata",se),ce.style&&ce.style._loaded&&ce.getSource(Ae)){const ke=(n=ce.getStyle())===null||n===void 0?void 0:n.layers;if(ke)for(const Fe of ke)Fe.source===Ae&&ce.removeLayer(Fe.id);ce.removeSource(Ae)}}}},[ce]);let Ce=ce&&ce.style&&ce.getSource(Ae);return Ce?E4(Ce,Z,de.current):Ce=S4(ce,Ae,Z),de.current=Z,Ce&&Tt.Children.map(Z.children,se=>se&&Tt.cloneElement(se,{source:Ae}))||null}function A4(){return ow()}const M4=aw(()=>Promise.resolve().then(()=>R4),[]),I4=Tt.forwardRef(function(ce,de){return lw(ce,de,M4)}),ov=f4,um=cw,pg=uw;function hw({children:Z,onMapClick:ce,onLoad:de,viewState:ue,onMove:Ae,mapRef:Ce}){const se=Tt.useRef(null),n=Ce||se,ke={longitude:-89.4012,latitude:43.0731,zoom:16},Fe=pt=>{const it=pt.target;n.current=it,it.getFog()&&it.setFog(null),it.getLight()&&it.setLight({intensity:.5}),de&&de(pt)};return he.jsx("div",{className:"map-view-root",style:{width:"100%",height:"100%",position:"relative"},children:he.jsx(I4,{...ue?{...ue}:{},initialViewState:ue?void 0:ke,minZoom:11.75,maxZoom:18,mapStyle:"mapbox://styles/ben-hurwitz/cmixuervv003501rxg4mjgm6k",mapboxAccessToken:"pk.eyJ1IjoiYmVuLWh1cndpdHoiLCJhIjoiY21oOGF0cjVjMDlzdDJscG9oemZpZ2J0ZSJ9.WDhxlwNRVnVxBlbDIgrppQ",onClick:ce,onLoad:Fe,onMove:Ae,style:{width:"100%",height:"100%"},children:Z})})}var Xy={exports:{}},C4=Xy.exports,Ab;function z4(){return Ab||(Ab=1,(function(Z,ce){(function(de,ue){Z.exports=ue()})(C4,(function(){var de,ue,Ae;function Ce(n,ke){if(!de)de=ke;else if(!ue)ue=ke;else{var Fe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+de+")(sharedChunk); ("+ue+")(sharedChunk); self.onerror = null;",pt={};de(pt),Ae=ke(pt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ae.workerUrl=window.URL.createObjectURL(new Blob([Fe],{type:"text/javascript"})))}}Ce(["exports"],(function(n){var ke=1e-6,Fe=typeof Float32Array<"u"?Float32Array:Array;function pt(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=i*p-u*s;return _?(r[0]=p*(_=1/_),r[1]=-s*_,r[2]=-u*_,r[3]=i*_,r):null}function it(){var r=new Fe(9);return Fe!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ht(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=e[4],x=e[5],E=e[6],C=e[7],k=e[8];return r[0]=_*k-x*C,r[1]=u*C-s*k,r[2]=s*x-u*_,r[3]=x*E-p*k,r[4]=i*k-u*E,r[5]=u*p-i*x,r[6]=p*C-_*E,r[7]=s*E-i*C,r[8]=i*_-s*p,r}function Ci(r,e,i){var s=e[0],u=e[1],p=e[2],_=e[3],x=e[4],E=e[5],C=e[6],k=e[7],B=e[8],j=i[0],U=i[1],$=i[2],ee=i[3],le=i[4],oe=i[5],ye=i[6],xe=i[7],Ie=i[8];return r[0]=j*s+U*_+$*C,r[1]=j*u+U*x+$*k,r[2]=j*p+U*E+$*B,r[3]=ee*s+le*_+oe*C,r[4]=ee*u+le*x+oe*k,r[5]=ee*p+le*E+oe*B,r[6]=ye*s+xe*_+Ie*C,r[7]=ye*u+xe*x+Ie*k,r[8]=ye*p+xe*E+Ie*B,r}function Ui(){var r=new Fe(16);return Fe!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Vi(r){var e=new Fe(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function qi(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function on(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=e[4],x=e[5],E=e[6],C=e[7],k=e[8],B=e[9],j=e[10],U=e[11],$=e[12],ee=e[13],le=e[14],oe=e[15],ye=i*x-s*_,xe=i*E-u*_,Ie=i*C-p*_,$e=s*E-u*x,je=s*C-p*x,Ye=u*C-p*E,st=k*ee-B*$,ut=k*le-j*$,Ut=k*oe-U*$,_t=B*le-j*ee,Wt=B*oe-U*ee,ni=j*oe-U*le,ri=ye*ni-xe*Wt+Ie*_t+$e*Ut-je*ut+Ye*st;return ri?(r[0]=(x*ni-E*Wt+C*_t)*(ri=1/ri),r[1]=(u*Wt-s*ni-p*_t)*ri,r[2]=(ee*Ye-le*je+oe*$e)*ri,r[3]=(j*je-B*Ye-U*$e)*ri,r[4]=(E*Ut-_*ni-C*ut)*ri,r[5]=(i*ni-u*Ut+p*ut)*ri,r[6]=(le*Ie-$*Ye-oe*xe)*ri,r[7]=(k*Ye-j*Ie+U*xe)*ri,r[8]=(_*Wt-x*Ut+C*st)*ri,r[9]=(s*Ut-i*Wt-p*st)*ri,r[10]=($*je-ee*Ie+oe*ye)*ri,r[11]=(B*Ie-k*je-U*ye)*ri,r[12]=(x*ut-_*_t-E*st)*ri,r[13]=(i*_t-s*ut+u*st)*ri,r[14]=(ee*xe-$*$e-le*ye)*ri,r[15]=(k*$e-B*xe+j*ye)*ri,r):null}function Ai(r,e,i){var s=e[0],u=e[1],p=e[2],_=e[3],x=e[4],E=e[5],C=e[6],k=e[7],B=e[8],j=e[9],U=e[10],$=e[11],ee=e[12],le=e[13],oe=e[14],ye=e[15],xe=i[0],Ie=i[1],$e=i[2],je=i[3];return r[0]=xe*s+Ie*x+$e*B+je*ee,r[1]=xe*u+Ie*E+$e*j+je*le,r[2]=xe*p+Ie*C+$e*U+je*oe,r[3]=xe*_+Ie*k+$e*$+je*ye,r[4]=(xe=i[4])*s+(Ie=i[5])*x+($e=i[6])*B+(je=i[7])*ee,r[5]=xe*u+Ie*E+$e*j+je*le,r[6]=xe*p+Ie*C+$e*U+je*oe,r[7]=xe*_+Ie*k+$e*$+je*ye,r[8]=(xe=i[8])*s+(Ie=i[9])*x+($e=i[10])*B+(je=i[11])*ee,r[9]=xe*u+Ie*E+$e*j+je*le,r[10]=xe*p+Ie*C+$e*U+je*oe,r[11]=xe*_+Ie*k+$e*$+je*ye,r[12]=(xe=i[12])*s+(Ie=i[13])*x+($e=i[14])*B+(je=i[15])*ee,r[13]=xe*u+Ie*E+$e*j+je*le,r[14]=xe*p+Ie*C+$e*U+je*oe,r[15]=xe*_+Ie*k+$e*$+je*ye,r}function an(r,e,i){var s,u,p,_,x,E,C,k,B,j,U,$,ee=i[0],le=i[1],oe=i[2];return e===r?(r[12]=e[0]*ee+e[4]*le+e[8]*oe+e[12],r[13]=e[1]*ee+e[5]*le+e[9]*oe+e[13],r[14]=e[2]*ee+e[6]*le+e[10]*oe+e[14],r[15]=e[3]*ee+e[7]*le+e[11]*oe+e[15]):(u=e[1],p=e[2],_=e[3],x=e[4],E=e[5],C=e[6],k=e[7],B=e[8],j=e[9],U=e[10],$=e[11],r[0]=s=e[0],r[1]=u,r[2]=p,r[3]=_,r[4]=x,r[5]=E,r[6]=C,r[7]=k,r[8]=B,r[9]=j,r[10]=U,r[11]=$,r[12]=s*ee+x*le+B*oe+e[12],r[13]=u*ee+E*le+j*oe+e[13],r[14]=p*ee+C*le+U*oe+e[14],r[15]=_*ee+k*le+$*oe+e[15]),r}function Un(r,e,i){var s=i[0],u=i[1],p=i[2];return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r[4]=e[4]*u,r[5]=e[5]*u,r[6]=e[6]*u,r[7]=e[7]*u,r[8]=e[8]*p,r[9]=e[9]*p,r[10]=e[10]*p,r[11]=e[11]*p,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function rr(r,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[4],_=e[5],x=e[6],E=e[7],C=e[8],k=e[9],B=e[10],j=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=p*u+C*s,r[5]=_*u+k*s,r[6]=x*u+B*s,r[7]=E*u+j*s,r[8]=C*u-p*s,r[9]=k*u-_*s,r[10]=B*u-x*s,r[11]=j*u-E*s,r}function ln(r,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[0],_=e[1],x=e[2],E=e[3],C=e[8],k=e[9],B=e[10],j=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*u-C*s,r[1]=_*u-k*s,r[2]=x*u-B*s,r[3]=E*u-j*s,r[8]=p*s+C*u,r[9]=_*s+k*u,r[10]=x*s+B*u,r[11]=E*s+j*u,r}function mn(r,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[0],_=e[1],x=e[2],E=e[3],C=e[4],k=e[5],B=e[6],j=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*u+C*s,r[1]=_*u+k*s,r[2]=x*u+B*s,r[3]=E*u+j*s,r[4]=C*u-p*s,r[5]=k*u-_*s,r[6]=B*u-x*s,r[7]=j*u-E*s,r}function Pt(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Bt(r,e,i){var s,u,p,_=i[0],x=i[1],E=i[2],C=Math.sqrt(_*_+x*x+E*E);return C<ke?null:(_*=C=1/C,x*=C,E*=C,s=Math.sin(e),u=Math.cos(e),r[0]=_*_*(p=1-u)+u,r[1]=x*_*p+E*s,r[2]=E*_*p-x*s,r[3]=0,r[4]=_*x*p-E*s,r[5]=x*x*p+u,r[6]=E*x*p+_*s,r[7]=0,r[8]=_*E*p+x*s,r[9]=x*E*p-_*s,r[10]=E*E*p+u,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Ni(r,e){var i=e[0],s=e[1],u=e[2],p=e[4],_=e[5],x=e[6],E=e[8],C=e[9],k=e[10];return r[0]=Math.sqrt(i*i+s*s+u*u),r[1]=Math.sqrt(p*p+_*_+x*x),r[2]=Math.sqrt(E*E+C*C+k*k),r}function tn(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=i+i,x=s+s,E=u+u,C=i*_,k=s*_,B=s*x,j=u*_,U=u*x,$=u*E,ee=p*_,le=p*x,oe=p*E;return r[0]=1-B-$,r[1]=k+oe,r[2]=j-le,r[3]=0,r[4]=k-oe,r[5]=1-C-$,r[6]=U+ee,r[7]=0,r[8]=j+le,r[9]=U-ee,r[10]=1-C-B,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var Li=Ai;function Wi(){var r=new Fe(3);return Fe!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function cr(r){var e=new Fe(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Pr(r){var e=r[0],i=r[1],s=r[2];return Math.sqrt(e*e+i*i+s*s)}function si(r,e,i){var s=new Fe(3);return s[0]=r,s[1]=e,s[2]=i,s}function xi(r,e,i,s){return r[0]=e,r[1]=i,r[2]=s,r}function Tn(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function zn(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function Er(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function Et(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function di(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function mi(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function vn(r,e,i,s){return r[0]=e[0]+i[0]*s,r[1]=e[1]+i[1]*s,r[2]=e[2]+i[2]*s,r}function tr(r,e){var i=e[0]-r[0],s=e[1]-r[1],u=e[2]-r[2];return Math.sqrt(i*i+s*s+u*u)}function vr(r,e){var i=e[0]-r[0],s=e[1]-r[1],u=e[2]-r[2];return i*i+s*s+u*u}function Gr(r){var e=r[0],i=r[1],s=r[2];return e*e+i*i+s*s}function gr(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function In(r,e){var i=e[0],s=e[1],u=e[2],p=i*i+s*s+u*u;return p>0&&(p=1/Math.sqrt(p)),r[0]=e[0]*p,r[1]=e[1]*p,r[2]=e[2]*p,r}function Lr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function br(r,e,i){var s=e[0],u=e[1],p=e[2],_=i[0],x=i[1],E=i[2];return r[0]=u*E-p*x,r[1]=p*_-s*E,r[2]=s*x-u*_,r}function ma(r,e,i,s){var u=e[0],p=e[1],_=e[2];return r[0]=u+s*(i[0]-u),r[1]=p+s*(i[1]-p),r[2]=_+s*(i[2]-_),r}function Kr(r,e,i){var s=e[0],u=e[1],p=e[2],_=i[3]*s+i[7]*u+i[11]*p+i[15];return r[0]=(i[0]*s+i[4]*u+i[8]*p+i[12])/(_=_||1),r[1]=(i[1]*s+i[5]*u+i[9]*p+i[13])/_,r[2]=(i[2]*s+i[6]*u+i[10]*p+i[14])/_,r}function oa(r,e,i){var s=e[0],u=e[1],p=e[2];return r[0]=s*i[0]+u*i[3]+p*i[6],r[1]=s*i[1]+u*i[4]+p*i[7],r[2]=s*i[2]+u*i[5]+p*i[8],r}function Ma(r,e,i){var s=i[0],u=i[1],p=i[2],_=i[3],x=e[0],E=e[1],C=e[2],k=u*C-p*E,B=p*x-s*C,j=s*E-u*x;return r[0]=x+_*(k+=k)+u*(j+=j)-p*(B+=B),r[1]=E+_*B+p*k-s*j,r[2]=C+_*j+s*B-u*k,r}function $t(r){return r[0]=0,r[1]=0,r[2]=0,r}function Va(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var Ir=zn,Ar=Er,la=Pr;function Po(){var r=new Fe(4);return Fe!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Qs(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function Io(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=i*i+s*s+u*u+p*p;return _>0&&(_=1/Math.sqrt(_)),r[0]=i*_,r[1]=s*_,r[2]=u*_,r[3]=p*_,r}function Mr(r,e,i){var s=e[0],u=e[1],p=e[2],_=e[3];return r[0]=i[0]*s+i[4]*u+i[8]*p+i[12]*_,r[1]=i[1]*s+i[5]*u+i[9]*p+i[13]*_,r[2]=i[2]*s+i[6]*u+i[10]*p+i[14]*_,r[3]=i[3]*s+i[7]*u+i[11]*p+i[15]*_,r}function ws(){var r=new Fe(4);return Fe!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Ds(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Ps(r,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return r[0]=s*E+_*x,r[1]=u*E+p*x,r[2]=p*E-u*x,r[3]=_*E-s*x,r}function Qt(r,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return r[0]=s*E-p*x,r[1]=u*E+_*x,r[2]=p*E+s*x,r[3]=_*E-u*x,r}Wi(),Po();var Gn,Ta,Ha,ms=Io,xn=(Gn=Wi(),Ta=si(1,0,0),Ha=si(0,1,0),function(r,e,i){var s=Lr(e,i);return s<-.999999?(br(Gn,Ta,e),la(Gn)<1e-6&&br(Gn,Ha,e),In(Gn,Gn),(function(u,p,_){_*=.5;var x=Math.sin(_);u[0]=x*p[0],u[1]=x*p[1],u[2]=x*p[2],u[3]=Math.cos(_)})(r,Gn,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(br(Gn,e,i),r[0]=Gn[0],r[1]=Gn[1],r[2]=Gn[2],r[3]=1+s,ms(r,r))});function er(){var r=new Fe(2);return Fe!=Float32Array&&(r[0]=0,r[1]=0),r}function sr(r,e){var i=new Fe(2);return i[0]=r,i[1]=e,i}function Xs(r,e,i){return r[0]=e,r[1]=i,r}function fl(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function Jr(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function pl(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function Uo(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function oc(r,e){var i=e[0],s=e[1],u=i*i+s*s;return u>0&&(u=1/Math.sqrt(u)),r[0]=e[0]*u,r[1]=e[1]*u,r}function cl(r,e){return r[0]*e[0]+r[1]*e[1]}ws(),ws(),it();var ft,ze,Pe=Jr;function et(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}er();var gt=(function(){if(ze)return ft;function r(e,i,s,u){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=u}return ze=1,ft=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,u=0;u<8;u++){var p=this.sampleCurveX(s)-e;if(Math.abs(p)<i)return s;var _=this.sampleCurveDerivativeX(s);if(Math.abs(_)<1e-6)break;s-=p/_}var x=0,E=1;for(s=e,u=0;u<20&&(p=this.sampleCurveX(s),!(Math.abs(p-e)<i));u++)e>p?x=s:E=s,s=.5*(E-x)+x;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ft})(),jt=et(gt);function Ge(r,e){this.x=r,this.y=e}function ei(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!ei(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!ei(r[i],e[i]))return!1;return!0}return r===e}Ge.prototype={clone(){return new Ge(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround(r,e){const i=Math.cos(r),s=Math.sin(r),u=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ge},Ge.convert=function(r){if(r instanceof Ge)return r;if(Array.isArray(r))return new Ge(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new Ge(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const kt=Math.PI/180,Pi=180/Math.PI;function fi(r){return r*kt}function ui(r){return r*Pi}const kn=[[0,0],[1,0],[1,1],[0,1]];function fr(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Cr(r,e,i,s){const u=new jt(r,e,i,s);return function(p){return u.solve(p)}}const ct=Cr(.25,.1,.25,1);function te(r,e,i){return Math.min(i,Math.max(e,r))}function _e(r,e,i){return(i=te((i-r)/(e-r),0,1))*i*(3-2*i)}function Re(r,e,i){const s=i-e,u=((r-e)%s+s)%s+e;return u===e?i:u}function tt(r,e,i){if(!r.length)return i(null,[]);let s=r.length;const u=new Array(r.length);let p=null;r.forEach(((_,x)=>{e(_,((E,C)=>{E&&(p=E),u[x]=C,--s==0&&i(p,u)}))}))}let Xe=1;function at(){return Xe++}function St(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function lt(r,e){r.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function It(r,e,i){const s={};for(const u in r)s[u]=e.call(this,r[u],u,r);return s}function ti(r,e,i){const s={};for(const u in r)e.call(this,r[u],u,r)&&(s[u]=r[u]);return s}function Gt(r){return Array.isArray(r)?r.map(Gt):typeof r=="object"&&r?It(r,Gt):r}function Ji(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const Qi={};function ji(r){Qi[r]||(typeof console<"u"&&console.warn(r),Qi[r]=!0)}function pr(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function $n(r){let e=0;for(let i,s,u=0,p=r.length,_=p-1;u<p;_=u++)i=r[u],s=r[_],e+=(s.x-i.x)*(i.y+s.y);return e}function Nn([r,e,i]){const s=fi(e+90),u=fi(i);return{x:r*Math.cos(s)*Math.sin(u),y:r*Math.sin(s)*Math.sin(u),z:r*Math.cos(u),azimuthal:e,polar:i}}function qr(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function Oa(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,s,u,p)=>{const _=u||p;return e[s]=!_||_.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ts=null;function cs(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Zs(r,e,i,s){for(;e<i;){const u=e+i>>1;r[u]<s?e=u+1:i=u}return e}function na(r,e,i,s){for(;e<i;){const u=e+i>>1;r[u]<=s?e=u+1:i=u}return e}function $r(r){return r>0?1/(1.001-r):1+r}function _a(r){return r>0?1-1/(1.001-r):-r}function ur(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const kr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!kr.API_URL)return null;try{const r=new URL(kr.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Xa(r){return kr.API_URL_REGEX.test(r)}function Lo(r){return kr.API_SPRITE_REGEX.test(r)}let eo,ml,ih,ns,Go,va;function Mc(){return eo==null&&(eo=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),eo}const to={now:()=>ns!==void 0?ns:performance.now(),setNow(r){ns=r},restoreNow(){ns=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:s}=r;Go||(Go=document.createElement("canvas"));const u=Go.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>Go.width||s>Go.height)&&(Go.width=i,Go.height=s),u.clearRect(-e,-e,i+2*e,s+2*e),u.drawImage(r,0,0,i,s),u.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:r=>(ml||(ml=document.createElement("a")),ml.href=r,ml.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(ih==null&&(ih=window.matchMedia("(prefers-reduced-motion: reduce)")),ih.matches)},hasCanvasFingerprintNoise(){if(va!==void 0)return va;if(!Mc())return va=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let u=0;u<r.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);const s=e.getImageData(0,0,r.width,r.height);i=0;for(let u=0;u<s.data.length;++u)if(u%4!=3&&i++!==s.data[u])return va=!0,!0;return va=!1,!1}};function Vc(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(r.slice(i));for(const u in e)s.set(u,e[u]);return`${r.slice(0,i)}?${s.toString()}`}function Ah(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const s=new URLSearchParams,u=new URLSearchParams(r.slice(i));for(const _ of e.persistentParams){const x=u.get(_);x&&s.set(_,x)}const p=s.toString();return`${r.slice(0,i)}${p.length>0?`?${p}`:""}`}const su="mapbox-tiles";let Kh=500,Jh=50;const Mu=["language","worldview","jobid"];let Uc,lc;function ou(){try{return caches}catch{}}function Ic(){const r=ou();r&&Uc==null&&(Uc=r.open(su))}let _o=1/0;const Zl={supported:!1,testSupport:function(r){!lu&&Ao&&(Iu?Jf(r):ko=r)}};let ko,Ao,lu=!1,Iu=!1;const Mh=typeof self<"u"?self:{};function Jf(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ao),r.isContextLost())return;Zl.supported=!0}catch{}r.deleteTexture(e),lu=!0}Mh.document&&(Ao=Mh.document.createElement("img"),Ao.onload=function(){ko&&Jf(ko),ko=null,Iu=!0},Ao.onerror=function(){lu=!0,ko=null},Ao.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Cc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Cc);class Ho extends Error{constructor(e,i,s){i===401&&Xa(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Sd=qr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,cu=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Sd())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(s,u){const p=new AbortController,_=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Sd(),referrerPolicy:s.referrerPolicy,signal:p.signal});let x=!1,E=!1;const C=(k=_.url).indexOf("sku=")>0&&Xa(k);var k;s.type==="json"&&_.headers.set("Accept","application/json");const B=(U,$,ee)=>{if(E)return;if(U&&U.message!=="SecurityError"&&ji(U.toString()),$&&ee)return j($);const le=Date.now();fetch(_).then((oe=>{if(oe.ok){const ye=C?oe.clone():null;return j(oe,ye,le)}return u(new Ho(oe.statusText,oe.status,s.url))})).catch((oe=>{oe.name!=="AbortError"&&u(new Error(`${oe.message} ${s.url}`))}))},j=(U,$,ee)=>{(s.type==="arrayBuffer"?U.arrayBuffer():s.type==="json"?U.json():U.text()).then((le=>{E||($&&ee&&(function(oe,ye,xe){if(Ic(),Uc==null)return;const Ie=Oa(ye.headers.get("Cache-Control")||"");if(Ie["no-store"])return;const $e={status:ye.status,statusText:ye.statusText,headers:new Headers};ye.headers.forEach(((st,ut)=>$e.headers.set(ut,st))),Ie["max-age"]&&$e.headers.set("Expires",new Date(xe+1e3*Ie["max-age"]).toUTCString());const je=$e.headers.get("Expires");if(!je||new Date(je).getTime()-xe<42e4)return;let Ye=Ah(oe.url,{persistentParams:Mu});if(ye.status===206){const st=oe.headers.get("Range");if(!st)return;$e.status=200,Ye=Vc(Ye,{range:st})}(function(st,ut){if(lc===void 0)try{new Response(new ReadableStream),lc=!0}catch{lc=!1}lc?ut(st.body):st.blob().then(ut).catch((Ut=>ji(Ut.message)))})(ye,(st=>{const ut=new Response((Ut=ye.status)!==200&&Ut!==404&&[101,103,204,205,304].includes(Ut)?null:st,$e);var Ut;Ic(),Uc?.then((_t=>_t.put(Ye,ut))).catch((_t=>ji(_t.message)))}))})(_,$,ee),x=!0,u(null,le,U.headers))})).catch((le=>{E||u(new Error(le.message))}))};return C?(function(U,$){if(Ic(),Uc==null)return $(null);Uc.then((ee=>{let le=Ah(U.url,{persistentParams:Mu});const oe=U.headers.get("Range");oe&&(le=Vc(le,{range:oe})),ee.match(le).then((ye=>{const xe=(function(Ie){if(!Ie)return!1;const $e=new Date(Ie.headers.get("Expires")||0),je=Oa(Ie.headers.get("Cache-Control")||"");return Number($e)>Date.now()&&!je["no-cache"]})(ye);ee.delete(le).catch($),xe&&ee.put(le,ye.clone()).catch($),$(null,ye,xe)})).catch($)})).catch($)})(_,B):B(null,null),{cancel:()=>{E=!0,x||p.abort()}}})(r,e);if(qr(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return(function(s,u){const p=new XMLHttpRequest;p.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const _ in s.headers)p.setRequestHeader(_,s.headers[_]);return s.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=s.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let _=p.response;if(s.type==="json")try{_=JSON.parse(p.response)}catch(E){return u(E)}const x=new Headers;p.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((E=>{const C=E.split(": "),k=C.shift(),B=C.join(": ");x.append(k,B)})),u(null,_,x)}else u(new Ho(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}})(r,e)},Wl=function(r,e){return cu(Object.assign(r,{type:"arrayBuffer"}),e)};function Ap(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const Hd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let nh,Qr;nh=[],Qr=0;const rh=function(r,e){if(Zl.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Qr>=kr.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return nh.push(p),p}Qr++;let i=!1;const s=()=>{if(!i)for(i=!0,Qr--;nh.length&&Qr<kr.MAX_PARALLEL_IMAGE_REQUESTS;){const p=nh.shift(),{requestParameters:_,callback:x,cancelled:E}=p;E||(p.cancel=rh(_,x).cancel)}},u=Wl(r,((p,_,x)=>{s(),p?e(p):_&&(self.createImageBitmap?(function(E,C){const k=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(k).then((B=>{C(null,B)})).catch((B=>{C(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(_,((E,C)=>e(E,C,x))):(function(E,C){const k=new Image;k.onload=()=>{C(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame((()=>{k.src=Hd}))},k.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const B=new Blob([new Uint8Array(E)],{type:"image/png"});k.src=E.byteLength?URL.createObjectURL(B):Hd})(_,((E,C)=>e(E,C,x))))}));return{cancel:()=>{u.cancel(),s()}}};var qd,Il,Cl,Cu={exports:{}},zu={exports:{}},Ru={exports:{}},uu=(function(){if(Cl)return Cu.exports;Cl=1;var r=(qd||(qd=1,zu.exports=function(i,s){var u,p,_,x,E,C,k,B;for(p=i.length-(u=3&i.length),_=s,E=3432918353,C=461845907,B=0;B<p;)k=255&i.charCodeAt(B)|(255&i.charCodeAt(++B))<<8|(255&i.charCodeAt(++B))<<16|(255&i.charCodeAt(++B))<<24,++B,_=27492+(65535&(x=5*(65535&(_=(_^=k=(65535&(k=(k=(65535&k)*E+(((k>>>16)*E&65535)<<16)&4294967295)<<15|k>>>17))*C+(((k>>>16)*C&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(k=0,u){case 3:k^=(255&i.charCodeAt(B+2))<<16;case 2:k^=(255&i.charCodeAt(B+1))<<8;case 1:_^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(B)))*E+(((k>>>16)*E&65535)<<16)&4294967295)<<15|k>>>17))*C+(((k>>>16)*C&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),zu.exports),e=(Il||(Il=1,Ru.exports=function(i,s){for(var u,p=i.length,_=s^p,x=0;p>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++x;switch(p){case 3:_^=(255&i.charCodeAt(x+2))<<16;case 2:_^=(255&i.charCodeAt(x+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(x)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Ru.exports);return Cu.exports=r,Cu.exports.murmur3=r,Cu.exports.murmur2=e,Cu.exports})(),ss=et(uu);class zl{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Qh extends zl{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function Ih(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function ed(r,e,i){if(i&&i[r]){const s=i[r].indexOf(e);s!==-1&&i[r].splice(s,1)}}class td{on(e,i){return this._listeners=this._listeners||{},Ih(e,i,this._listeners),this}off(e,i){return ed(e,i,this._listeners),ed(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Ih(e,i,this._oneTimeListeners),this):new Promise((s=>{this.once(e,s)}))}fire(e,i){const s=typeof e=="string"?new zl(e,i):e,u=s.type;if(this.listens(u)){s.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const E of p)E.call(this,s);const _=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const E of _)ed(u,E,this._oneTimeListeners),E.call(this,s);const x=this._eventedParent;if(x){const E=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(s,E),x.fire(s)}}else s instanceof Qh&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Rl{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Rl(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,s]=e.split("");return new Rl({name:i,iconsetId:s})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Rl.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ed,Ad={},Gc=(function(){if(Ed)return Ad;Ed=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function i(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function s(p){return(_=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:_>1?1:_;var _}function u(p,_,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?p+(_-p)*x*6:2*x<1?_:3*x<2?p+(_-p)*(2/3-x)*6:p}try{Ad.parseCSSColor=function(p){var _,x=p.replace(/ /g,"").toLowerCase();if(x in r)return r[x].slice();if(x[0]==="#")return x.length===4?(_=parseInt(x.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:x.length===7&&(_=parseInt(x.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var E=x.indexOf("("),C=x.indexOf(")");if(E!==-1&&C+1===x.length){var k=x.substr(0,E),B=x.substr(E+1,C-(E+1)).split(","),j=1;switch(k){case"rgba":if(B.length!==4)return null;j=s(B.pop());case"rgb":return B.length!==3?null:[i(B[0]),i(B[1]),i(B[2]),j];case"hsla":if(B.length!==4)return null;j=s(B.pop());case"hsl":if(B.length!==3)return null;var U=(parseFloat(B[0])%360+360)%360/360,$=s(B[1]),ee=s(B[2]),le=ee<=.5?ee*($+1):ee+$-ee*$,oe=2*ee-le;return[e(255*u(oe,le,U+1/3)),e(255*u(oe,le,U)),e(255*u(oe,le,U-1/3)),j];default:return null}}return null}}catch{}return Ad})();class Ia{constructor(e,i,s,u=1){this.r=e,this.g=i,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Ia)return e;if(typeof e!="string")return;const i=Gc.parseCSSColor(e);return i?new Ia(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,s,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${u})`}toNonPremultipliedRenderColor(e){const{r:i,g:s,b:u,a:p}=this;return new Ip(e,i,s,u,p)}toPremultipliedRenderColor(e){const{r:i,g:s,b:u,a:p}=this;return new Ch(e,i*p,s*p,u*p,p)}clone(){return new Ia(this.r,this.g,this.b,this.a)}}class Mp{constructor(e,i,s,u,p,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const x=e.image.height,E=x*x;this.premultiplied?(i=p===0?0:i/p*(x-1),s=p===0?0:s/p*(x-1),u=p===0?0:u/p*(x-1)):(i*=x-1,s*=x-1,u*=x-1);const C=Math.floor(i),k=Math.floor(s),B=Math.floor(u),j=Math.ceil(i),U=Math.ceil(s),$=Math.ceil(u),ee=i-C,le=s-k,oe=u-B,ye=e.image.data,xe=4*(C+k*E+B*x),Ie=4*(C+k*E+$*x),$e=4*(C+U*E+B*x),je=4*(C+U*E+$*x),Ye=4*(j+k*E+B*x),st=4*(j+k*E+$*x),ut=4*(j+U*E+B*x),Ut=4*(j+U*E+$*x);if(xe<0||Ut>=ye.length)throw new Error("out of range");this.r=Hn(Hn(Hn(ye[xe],ye[Ie],oe),Hn(ye[$e],ye[je],oe),le),Hn(Hn(ye[Ye],ye[st],oe),Hn(ye[ut],ye[Ut],oe),le),ee)/255*(this.premultiplied?p:1),this.g=Hn(Hn(Hn(ye[xe+1],ye[Ie+1],oe),Hn(ye[$e+1],ye[je+1],oe),le),Hn(Hn(ye[Ye+1],ye[st+1],oe),Hn(ye[ut+1],ye[Ut+1],oe),le),ee)/255*(this.premultiplied?p:1),this.b=Hn(Hn(Hn(ye[xe+2],ye[Ie+2],oe),Hn(ye[$e+2],ye[je+2],oe),le),Hn(Hn(ye[Ye+2],ye[st+2],oe),Hn(ye[ut+2],ye[Ut+2],oe),le),ee)/255*(this.premultiplied?p:1),this.a=p}else this.r=i,this.g=s,this.b=u,this.a=p}toArray(){const{r:e,g:i,b:s,a:u}=this;return[255*e,255*i,255*s,u]}toHslaArray(){let{r:e,g:i,b:s,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const $=1/u;e*=$,i*=$,s*=$}const p=Math.min(Math.max(e,0),1),_=Math.min(Math.max(i,0),1),x=Math.min(Math.max(s,0),1),E=Math.min(p,_,x),C=Math.max(p,_,x),k=C-E,B=.5*(E+C);if(k===0)return[0,0,100*B,u];const j=B>.5?k/(2-C-E):k/(C+E);let U;switch(C){case p:U=60*((_-x)/k+(_<x?6:0));break;case _:U=60*((x-p)/k+2);break;default:U=60*((p-_)/k+4)}return[U,100*j,100*B,u]}toArray01(){const{r:e,g:i,b:s,a:u}=this;return[e,i,s,u]}toArray01Scaled(e){const{r:i,g:s,b:u}=this;return[i*e,s*e,u*e]}toArray01Linear(){const{r:e,g:i,b:s,a:u}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(s,2.2),u]}}class Ip extends Mp{constructor(e,i,s,u,p){super(e,i,s,u,p,!1)}}class Ch extends Mp{constructor(e,i,s,u,p){super(e,i,s,u,p,!0)}}function Hn(r,e,i){return r*(1-i)+e*i}function Cp(r,e,i){return r.map(((s,u)=>Hn(s,e[u],i)))}Ia.black=new Ia(0,0,0,1),Ia.white=new Ia(1,1,1,1),Ia.transparent=new Ia(0,0,0,0),Ia.red=new Ia(1,0,0,1),Ia.blue=new Ia(0,0,1,1);var $d=Object.freeze({__proto__:null,array:Cp,color:function(r,e,i){return new Ia(Hn(r.r,e.r,i),Hn(r.g,e.g,i),Hn(r.b,e.b,i),Hn(r.a,e.a,i))},number:Hn});class Xl extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class id{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,u]of i)this.bindings[s]=u}concat(e){return new id(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const zc={kind:"null"},En={kind:"number"},ra={kind:"string"},Ca={kind:"boolean"},Yl={kind:"color"},Du={kind:"object"},Sa={kind:"value"},Mf={kind:"collator"},nd={kind:"formatted"},Hc={kind:"resolvedImage"};function rl(r,e){return{kind:"array",itemType:r,N:e}}function so(r){if(r.kind==="array"){const e=so(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const zp=[zc,En,ra,Ca,Yl,nd,Du,rl(Sa),Hc];function qc(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!qc(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of zp)if(!qc(i,e))return null}}return`Expected ${so(r)} but found ${so(e)} instead.`}function zh(r,e){return e.some((i=>i.kind===r.kind))}function Pu(r,e){return e.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function Md(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&Md(r.itemType,e.itemType):r.kind===e.kind}class Qf{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class go{constructor(e,i,s,u,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=u,this.textColor=p}}class Dl{constructor(e){this.sections=e}static fromString(e){return new Dl([new go(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof Dl?e:Dl.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const u=i.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(s)}return e}}class xa{constructor(e,i={}){this.id=Rl.from(e),this.params=i.params,this.sx=i.sx||1,this.sy=i.sy||1}toString(){return JSON.stringify(this)}static parse(e){let i,s,u,p;try{({id:i,params:s,sx:u,sy:p}=JSON.parse(e)||{})}catch{return null}return i?new xa(i,{params:s,sx:u,sy:p}):null}scaleSelf(e,i=e){return this.sx*=e,this.sy*=i,this}}class Co{constructor(e,i,s,u,p=!1){this.primaryId=Rl.from(e),this.primaryOptions=i,s&&(this.secondaryId=Rl.from(s)),this.secondaryOptions=u,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new xa(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new xa(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Co.build({name:e}):e}static build(e,i,s,u){return!e||typeof e=="object"&&!("name"in e)?null:new Co(e,s,i,u)}}function Ls(r,e,i,s){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[r,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[r,e,i,s]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ts(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ia||r instanceof Qf||r instanceof Dl||r instanceof Co)return!0;if(Array.isArray(r)){for(const e of r)if(!Ts(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Ts(r[e]))return!1;return!0}return!1}function oo(r){if(r===null)return zc;if(typeof r=="string")return ra;if(typeof r=="boolean")return Ca;if(typeof r=="number")return En;if(r instanceof Ia)return Yl;if(r instanceof Qf)return Mf;if(r instanceof Dl)return nd;if(r instanceof Co)return Hc;if(Array.isArray(r)){const e=r.length;let i;for(const s of r){const u=oo(s);if(i){if(i===u)continue;i=Sa;break}i=u}return rl(i||Sa,e)}return Du}function Pl(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Dl||r instanceof Co||r instanceof Ia?r.toString():JSON.stringify(r)}class Rc{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ts(e[1]))return i.error("invalid value");const s=e[1];let u=oo(s);const p=i.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new Rc(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ia?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Dl?this.value.serialize():this.value}}class io{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const $c={string:ra,number:En,boolean:Ca,object:Du};class Kl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,u=1;const p=e[0];if(p==="array"){let x,E;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in $c)||C==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=$c[C],u++}else x=Sa;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);E=e[2],u++}s=rl(x,E)}else s=$c[p];const _=[];for(;u<e.length;u++){const x=i.parse(e[u],u,Sa);if(!x)return null;_.push(x)}return new Kl(s,_)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!qc(this.type,oo(s)))return s;if(i===this.args.length-1)throw new io(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${so(oo(s))} but was expected to be of type ${so(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map((s=>s.serialize())))}}class zo{constructor(e){this.type=nd,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const u=[];let p=!1;for(let _=1;_<=e.length-1;++_){const x=e[_];if(p&&typeof x=="object"&&!Array.isArray(x)){p=!1;let E=null;if(x["font-scale"]&&(E=i.parseObjectValue(x["font-scale"],_,"font-scale",En),!E))return null;let C=null;if(x["text-font"]&&(C=i.parseObjectValue(x["text-font"],_,"text-font",rl(ra)),!C))return null;let k=null;if(x["text-color"]&&(k=i.parseObjectValue(x["text-color"],_,"text-color",Yl),!k))return null;const B=u[u.length-1];B.scale=E,B.font=C,B.textColor=k}else{const E=i.parse(e[_],_,Sa);if(!E)return null;const C=E.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:E,scale:null,font:null,textColor:null})}}return new zo(u)}evaluate(e){return new Dl(this.sections.map((i=>{const s=i.content.evaluate(e);return Md(oo(s),Hc)?new go("",s,null,null,null):new go(Pl(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class hr{constructor(e,i,s,u){this._imageWarnHistory={},this.type=Hc,this.namePrimary=e,this.nameSecondary=i,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const u=[];function p(){if(s<e.length){const x=i.parse(e[s],s++,ra);return x?(u.push({image:x,options:{}}),!0):(i.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(s<e.length){const E=e[s];if((x=E)===null||typeof x!="object"||Array.isArray(x))return!0;const C=E.params,k=E.iconset,B=i.concat(s);if(!C&&!k)return s++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return B.error('Image options "params" should be an object'),!1;const j={},U=B.concat(void 0,"params");for(const $ in C){if(!$)return U.error("Image parameter name should be non-empty"),!1;const ee=U.concat(void 0,$).parse(C[$],void 0,Yl,void 0,{typeAnnotation:"coerce"});if(!ee)return!1;j[$]=ee}u[u.length-1].options.params=j}if(k){if(typeof k!="object"||k.constructor!==Object)return B.error('Image options "iconset" should be an object'),!1;if(!k.id)return B.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=k}return s++,!0}var x;return!0}for(let x=0;x<2;x++)if(!p()||!_())return;return new hr(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const u in i)if(i[u])try{s[u]=i[u].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=Co.build(i,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const p=u.getPrimary().id;if(u.available=e.availableImages.some((_=>Rl.isEqual(_,p))),u.available){const _=u.getSecondary()?u.getSecondary().id:null;_&&(u.available=e.availableImages.some((x=>Rl.isEqual(x,_))))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const s={};if(i&&(s.iconset={id:i}),e){s.params={};for(const u in e)e[u]&&(s.params[u]=e[u].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function yn(r){return jn(r)?"string":Lu(r)?"number":Rh(r)?"boolean":Array.isArray(r)?"array":r===null?"null":rd(r)?"object":typeof r}function rd(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function jn(r){return typeof r=="string"||r instanceof String}function Lu(r){return typeof r=="number"||r instanceof Number}function Rh(r){return typeof r=="boolean"||r instanceof Boolean}const Vn={"to-boolean":Ca,"to-color":Yl,"to-number":En,"to-string":ra};class Dc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],u=[];let p=zc;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);p=rl(i.expectedType.itemType,_)}else{if(!(_>0&&Ts(e[1][0])))return null;p=rl(oo(e[1][0]),_)}for(let x=0;x<_;x++){const E=e[1][x];let C;if(Array.isArray(E))C=i.parse(E,void 0,p.itemType);else{const k=yn(E);if(k!==p.itemType.kind)return i.error(`Expected ${p.itemType.kind} but found ${k}.`);C=i.registry.literal.parse(["literal",E===void 0?null:E],i)}if(!C)return null;u.push(C)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");p=Vn[s];for(let _=1;_<e.length;_++){const x=i.parse(e[_],_,Sa);if(!x)return null;u.push(x)}}return new Dc(p,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const u of this.args){if(i=u.evaluate(e),s=null,i instanceof Ia)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Ls(i[0],i[1],i[2],i[3]),!s))return new Ia(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new io(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new io(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Dl.fromString(Pl(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Co.build(Pl(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):Pl(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new zo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new hr(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const Zd=["Unknown","Point","LineString","Polygon"];class Dh{constructor(e,i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Zd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Ia.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Zo{constructor(e,i,s,u,p){this.name=e,this.type=i,this._evaluate=s,this.args=u,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const i=Zo.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const s=e[0],u=Zo.definitions[s];if(!u)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=[];let E=null,C=-1;for(const[k,B]of _){if(Array.isArray(k)&&k.length!==e.length-1)continue;x.push(k),C++,E=new lh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const j=[];let U=!1;for(let $=1;$<e.length;$++){const ee=e[$],le=Array.isArray(k)?k[$-1]:k.type,oe=E.parse(ee,1+j.length,le);if(!oe){U=!0;break}j.push(oe)}if(!U)if(Array.isArray(k)&&k.length!==j.length)E.error(`Expected ${k.length} arguments, but found ${j.length} instead.`);else{for(let $=0;$<j.length;$++){const ee=Array.isArray(k)?k[$]:k.type,le=j[$];E.concat($+1).checkSubtype(ee,le.type)}if(E.errors.length===0)return new Zo(s,p,B,j,C)}}if(x.length===1)i.errors.push(...E.errors);else{const k=(x.length?x:_.map((([j])=>j))).map(If).join(" | "),B=[];for(let j=1;j<e.length;j++){const U=i.parse(e[j],1+B.length);if(!U)return null;B.push(so(U.type))}i.error(`Expected arguments of type ${k}, but found (${B.join(", ")}) instead.`)}return null}static register(e,i){Zo.definitions=i;for(const s in i)e[s]=Zo}}function If(r){return Array.isArray(r)?`(${r.map(so).join(", ")})`:`(${so(r.type)}...)`}class _s{constructor(e,i,s){this.type=Mf,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const u=s["case-sensitive"]===void 0?i.parse(!1,1,Ca):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",Ca);if(!u)return null;const p=s["diacritic-sensitive"]===void 0?i.parse(!1,1,Ca):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",Ca);if(!p)return null;let _=null;return s.locale&&(_=i.parseObjectValue(s.locale,1,"locale",ra),!_)?null:new _s(u,p,_)}evaluate(e){return new Qf(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function qa(r,e,i=0,s=r.length-1,u=ep){for(;s>i;){if(s-i>600){const E=s-i+1,C=e-i+1,k=Math.log(E),B=.5*Math.exp(2*k/3),j=.5*Math.sqrt(k*B*(E-B)/E)*(C-E/2<0?-1:1);qa(r,e,Math.max(i,Math.floor(e-C*B/E+j)),Math.min(s,Math.floor(e+(E-C)*B/E+j)),u)}const p=r[e];let _=i,x=s;for(cc(r,i,e),u(r[s],p)>0&&cc(r,i,s);_<x;){for(cc(r,_,x),_++,x--;u(r[_],p)<0;)_++;for(;u(r[x],p)>0;)x--}u(r[i],p)===0?cc(r,i,x):(x++,cc(r,x,s)),x<=e&&(i=x+1),e<=x&&(s=x-1)}}function cc(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}function ep(r,e){return r<e?-1:r>e?1:0}function ah(r){let e=0;for(let i,s,u=0,p=r.length,_=p-1;u<p;_=u++)i=r[u],s=r[_],e+=(s.x-i.x)*(i.y+s.y);return e}function _l(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function ad(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function tp(r,e,i){const s=r[0]-e[0],u=r[1]-e[1],p=r[0]-i[0],_=r[1]-i[1];return s*_-p*u==0&&s*p<=0&&u*_<=0}function hu(r,e,i=!1){let s=!1;for(let x=0,E=e.length;x<E;x++){const C=e[x];for(let k=0,B=C.length,j=B-1;k<B;j=k++){const U=C[j],$=C[k];if(tp(r,U,$))return i;(p=U)[1]>(u=r)[1]!=(_=$)[1]>u[1]&&u[0]<(_[0]-p[0])*(u[1]-p[1])/(_[1]-p[1])+p[0]&&(s=!s)}}var u,p,_;return s}function sd(r,e,i,s){const u=s[0]-i[0],p=s[1]-i[1],_=(r[0]-i[0])*p-u*(r[1]-i[1]),x=(e[0]-i[0])*p-u*(e[1]-i[1]);return _>0&&x<0||_<0&&x>0}function du(r,e,i,s){return(u=[s[0]-i[0],s[1]-i[1]])[0]*(p=[e[0]-r[0],e[1]-r[1]])[1]-u[1]*p[0]!=0&&!(!sd(r,e,i,s)||!sd(i,s,r,e));var u,p}function Pc(r){const e=new Ge(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Ge(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const s of r[0])e.x>s.x&&(e.x=s.x),e.y>s.y&&(e.y=s.y),i.x<s.x&&(i.x=s.x),i.y<s.y&&(i.y=s.y);return{min:e,max:i}}const Lc=8192;function fu(r,e){const i=(180+r[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Lc),Math.round(s*u*Lc)]}function Zc(r,e){for(let i=0;i<e.length;i++)if(hu(r,e[i]))return!0;return!1}function Cf(r,e,i){for(const s of i)for(let u=0,p=s.length,_=p-1;u<p;_=u++)if(du(r,e,s[_],s[u]))return!0;return!1}function od(r,e){for(let i=0;i<r.length;++i)if(!hu(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(Cf(r[i],r[i+1],e))return!1;return!0}function pu(r,e){for(let i=0;i<e.length;i++)if(od(r,e[i]))return!0;return!1}function Id(r,e,i){const s=[];for(let u=0;u<r.length;u++){const p=[];for(let _=0;_<r[u].length;_++){const x=fu(r[u][_],i);_l(e,x),p.push(x)}s.push(p)}return s}function mu(r,e,i){const s=[];for(let u=0;u<r.length;u++){const p=Id(r[u],e,i);s.push(p)}return s}function zf(r,e,i,s){if(r[0]<i[0]||r[0]>i[2]){const u=.5*s;let p=r[0]-i[0]>u?-s:i[0]-r[0]>u?s:0;p===0&&(p=r[0]-i[2]>u?-s:i[2]-r[0]>u?s:0),r[0]+=p}_l(e,r)}function hm(r,e,i,s){const u=Math.pow(2,s.z)*Lc,p=[s.x*Lc,s.y*Lc],_=[];if(!r)return _;for(const x of r)for(const E of x){const C=[E.x+p[0],E.y+p[1]];zf(C,e,i,u),_.push(C)}return _}function Rf(r,e,i,s){const u=Math.pow(2,s.z)*Lc,p=[s.x*Lc,s.y*Lc],_=[];if(!r)return _;for(const E of r){const C=[];for(const k of E){const B=[k.x+p[0],k.y+p[1]];_l(e,B),C.push(B)}_.push(C)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const E of _)for(const C of E)zf(C,e,i,u)}var x;return _}class ku{constructor(e,i){this.type=Ca,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ts(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let u=0;u<s.features.length;++u){const p=s.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new ku(s,s.features[u].geometry)}else if(s.type==="Feature"){const u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new ku(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new ku(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(s.type==="Polygon"){const x=Id(s.coordinates,p,_),E=hm(i.geometry(),u,p,_);if(!ad(u,p))return!1;for(const C of E)if(!hu(C,x))return!1}if(s.type==="MultiPolygon"){const x=mu(s.coordinates,p,_),E=hm(i.geometry(),u,p,_);if(!ad(u,p))return!1;for(const C of E)if(!Zc(C,x))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(s.type==="Polygon"){const x=Id(s.coordinates,p,_),E=Rf(i.geometry(),u,p,_);if(!ad(u,p))return!1;for(const C of E)if(!od(C,x))return!1}if(s.type==="MultiPolygon"){const x=mu(s.coordinates,p,_),E=Rf(i.geometry(),u,p,_);if(!ad(u,p))return!1;for(const C of E)if(!pu(C,x))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const ld={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Ll=1/298.257223563,cd=Ll*(2-Ll),Ws=Math.PI/180;class uc{static fromTile(e,i,s){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),p=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Ws;return new uc(p,s)}static get units(){return ld}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!ld[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(ld).join(", ")}`);const s=6378.137*Ws*(i?ld[i]:1),u=Math.cos(e*Ws),p=1/(1-cd*(1-u*u)),_=Math.sqrt(p);this.kx=s*_*u,this.ky=s*_*p*(1-cd)}distance(e,i){const s=us(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+u*u)}bearing(e,i){const s=us(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/Ws}destination(e,i,s){const u=s*Ws;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const u=e[s];for(let p=0,_=u.length,x=_-1;p<_;x=p++)i+=us(u[p][0]-u[x][0])*(u[p][1]+u[x][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){const p=e[u],_=e[u+1],x=this.distance(p,_);if(s+=x,s>i)return sh(p,_,(i-(s-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[u,p]=i,_=us(s[0]-u)*this.kx,x=(s[1]-p)*this.ky;if(_!==0||x!==0){const E=(us(e[0]-u)*this.kx*_+(e[1]-p)*this.ky*x)/(_*_+x*x);E>1?(u=s[0],p=s[1]):E>0&&(u+=_/this.kx*E,p+=x/this.ky*E)}return _=us(e[0]-u)*this.kx,x=(e[1]-p)*this.ky,Math.sqrt(_*_+x*x)}pointOnLine(e,i){let s=1/0,u=e[0][0],p=e[0][1],_=0,x=0;for(let E=0;E<e.length-1;E++){let C=e[E][0],k=e[E][1],B=us(e[E+1][0]-C)*this.kx,j=(e[E+1][1]-k)*this.ky,U=0;B===0&&j===0||(U=(us(i[0]-C)*this.kx*B+(i[1]-k)*this.ky*j)/(B*B+j*j),U>1?(C=e[E+1][0],k=e[E+1][1]):U>0&&(C+=B/this.kx*U,k+=j/this.ky*U)),B=us(i[0]-C)*this.kx,j=(i[1]-k)*this.ky;const $=B*B+j*j;$<s&&(s=$,u=C,p=k,_=E,x=U)}return{point:[u,p],index:_,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,s){let u=this.pointOnLine(s,e),p=this.pointOnLine(s,i);if(u.index>p.index||u.index===p.index&&u.t>p.t){const C=u;u=p,p=C}const _=[u.point],x=u.index+1,E=p.index;!hc(s[x],_[0])&&x<=E&&_.push(s[x]);for(let C=x+1;C<=E;C++)_.push(s[C]);return hc(s[E],p.point)||_.push(p.point),_}lineSliceAlong(e,i,s){let u=0;const p=[];for(let _=0;_<s.length-1;_++){const x=s[_],E=s[_+1],C=this.distance(x,E);if(u+=C,u>e&&p.length===0&&p.push(sh(x,E,(e-(u-C))/C)),u>=i)return p.push(sh(x,E,(i-(u-C))/C)),p;u>e&&p.push(E)}return p}bufferPoint(e,i){const s=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-s,e[0]+u,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-s,e[2]+u,e[3]+s]}insideBBox(e,i){return us(e[0]-i[0])>=0&&us(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function hc(r,e){return r[0]===e[0]&&r[1]===e[1]}function sh(r,e,i){const s=us(e[0]-r[0]);return[r[0]+s*i,r[1]+(e[1]-r[1])*i]}function us(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class kl{constructor(e=[],i=((s,u)=>s<u?-1:s>u?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,u=i[e];for(;e>0;){const p=e-1>>1,_=i[p];if(s(u,_)>=0)break;i[e]=_,e=p}i[e]=u}_down(e){const{data:i,compare:s}=this,u=this.length>>1,p=i[e];for(;e<u;){let _=1+(e<<1);const x=_+1;if(x<this.length&&s(i[x],i[_])<0&&(_=x),s(i[_],p)>=0)break;i[e]=i[_],e=_}i[e]=p}}var pi=8192;function Ph(r,e){return e.dist-r.dist}const _u=100,ud=50;function Fu(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function gl(r){return r[1]-r[0]+1}function gu(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function yl(r,e){if(r[0]>r[1])return[null,null];const i=gl(r);if(e){if(i===2)return[r,null];const s=Math.floor(i/2);return[[r[0],r[0]+s],[r[0]+s,r[1]]]}{if(i===1)return[r,null];const s=Math.floor(i/2)-1;return[[r[0],r[0]+s],[r[0]+s+1,r[1]]]}}function Ou(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!gu(e,r.length))return i;for(let s=e[0];s<=e[1];++s)_l(i,r[s]);return i}function vl(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let s=0;s<r[i].length;++s)_l(e,r[i][s]);return e}function Bu(r,e,i){if(Fu(r)||Fu(e))return NaN;let s=0,u=0;return r[2]<e[0]&&(s=e[0]-r[2]),r[0]>e[2]&&(s=r[0]-e[2]),r[1]>e[3]&&(u=r[1]-e[3]),r[3]<e[1]&&(u=e[1]-r[3]),i.distance([0,0],[s,u])}function Lh(r){return 360*r-180}function kc(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function kh(r,e){const i=Math.pow(2,e.z),s=(r.y/pi+e.y)/i;return[Lh((r.x/pi+e.x)/i),kc(s)]}function Wd(r,e){const i=[];for(let s=0;s<r.length;++s)i.push(kh(r[s],e));return i}function Xd(r,e,i){const s=i.pointOnLine(e,r).point;return i.distance(r,s)}function Yd(r,e,i,s,u){const p=i.slice(s[0],s[1]+1);let _=1/0;for(let x=e[0];x<=e[1];++x)if((_=Math.min(_,Xd(r[x],p,u)))===0)return 0;return _}function Wo(r,e,i,s,u){const p=Math.min(u.pointToSegmentDistance(r,i,s),u.pointToSegmentDistance(e,i,s)),_=Math.min(u.pointToSegmentDistance(i,r,e),u.pointToSegmentDistance(s,r,e));return Math.min(p,_)}function Nr(r,e,i,s,u){if(!gu(e,r.length)||!gu(s,i.length))return NaN;let p=1/0;for(let _=e[0];_<e[1];++_)for(let x=s[0];x<s[1];++x){if(du(r[_],r[_+1],i[x],i[x+1]))return 0;p=Math.min(p,Wo(r[_],r[_+1],i[x],i[x+1],u))}return p}function Fh(r,e,i,s,u){if(!gu(e,r.length)||!gu(s,i.length))return NaN;let p=1/0;for(let _=e[0];_<=e[1];++_)for(let x=s[0];x<=s[1];++x)if((p=Math.min(p,u.distance(r[_],i[x])))===0)return p;return p}function hd(r,e,i){if(hu(r,e,!0))return 0;let s=1/0;for(const u of e){const p=u.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[p-1]&&(s=Math.min(s,i.pointToSegmentDistance(r,u[p-1],u[0])))===0||(s=Math.min(s,Xd(r,u,i)))===0)return s}return s}function Kd(r,e,i,s){if(!gu(e,r.length))return NaN;for(let p=e[0];p<=e[1];++p)if(hu(r[p],i,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p)for(const _ of i)for(let x=0,E=_.length,C=E-1;x<E;C=x++){if(du(r[p],r[p+1],_[C],_[x]))return 0;u=Math.min(u,Wo(r[p],r[p+1],_[C],_[x],s))}return u}function Mo(r,e){for(const i of r)for(let s=0;s<=i.length-1;++s)if(hu(i[s],e,!0))return!0;return!1}function Xo(r,e,i,s=1/0){const u=vl(r),p=vl(e);if(s!==1/0&&Bu(u,p,i)>=s)return s;if(ad(u,p)){if(Mo(r,e))return 0}else if(Mo(e,r))return 0;let _=s;for(const x of r)for(let E=0,C=x.length,k=C-1;E<C;k=E++)for(const B of e)for(let j=0,U=B.length,$=U-1;j<U;$=j++){if(du(x[k],x[E],B[$],B[j]))return 0;_=Math.min(_,Wo(x[k],x[E],B[$],B[j],i))}return _}function ka(r,e,i,s,u,p,_){if(p===null||_===null)return;const x=Bu(Ou(s,p),Ou(u,_),i);x<e&&r.push({dist:x,range1:p,range2:_})}function al(r,e,i,s,u=1/0){let p=Math.min(s.distance(r[0],i[0][0]),u);if(p===0)return p;const _=new kl([{dist:0,range1:[0,r.length-1],range2:[0,0]}],Ph),x=e?ud:_u,E=vl(i);for(;_.length;){const C=_.pop();if(C.dist>=p)continue;const k=C.range1;if(gl(k)<=x){if(!gu(k,r.length))return NaN;if(e){const B=Kd(r,k,i,s);if((p=Math.min(p,B))===0)return p}else for(let B=k[0];B<=k[1];++B){const j=hd(r[B],i,s);if((p=Math.min(p,j))===0)return p}}else{const B=yl(k,e);if(B[0]!==null){const j=Bu(Ou(r,B[0]),E,s);j<p&&_.push({dist:j,range1:B[0],range2:[0,0]})}if(B[1]!==null){const j=Bu(Ou(r,B[1]),E,s);j<p&&_.push({dist:j,range1:B[1],range2:[0,0]})}}}return p}function Fl(r,e,i,s,u,p=1/0){let _=Math.min(p,u.distance(r[0],i[0]));if(_===0)return _;const x=new kl([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],Ph),E=e?ud:_u,C=s?ud:_u;for(;x.length;){const k=x.pop();if(k.dist>=_)continue;const B=k.range1,j=k.range2;if(gl(B)<=E&&gl(j)<=C){if(!gu(B,r.length)||!gu(j,i.length))return NaN;if(e&&s?_=Math.min(_,Nr(r,B,i,j,u)):e||s?e&&!s?_=Math.min(_,Yd(i,j,r,B,u)):!e&&s&&(_=Math.min(_,Yd(r,B,i,j,u))):_=Math.min(_,Fh(r,B,i,j,u)),_===0)return _}else{const U=yl(B,e),$=yl(j,s);ka(x,_,u,r,i,U[0],$[0]),ka(x,_,u,r,i,U[0],$[1]),ka(x,_,u,r,i,U[1],$[0]),ka(x,_,u,r,i,U[1],$[1])}}return _}function Nu(r,e,i,s,u=1/0){let p=u;const _=Ou(r,[0,r.length-1]);for(const x of i)if(!(p!==1/0&&Bu(_,Ou(x,[0,x.length-1]),s)>=p)&&(p=Math.min(p,Fl(r,e,x,!0,s,p)),p===0))return p;return p}function Df(r,e,i,s,u=1/0){let p=u;const _=Ou(r,[0,r.length-1]);for(const x of i){if(p!==1/0&&Bu(_,vl(x),s)>=p)continue;const E=al(r,e,x,s,p);if(isNaN(E))return E;if((p=Math.min(p,E))===0)return p}return p}function Jd(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class oh{constructor(e,i){this.type=En,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Ts(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let u=0;u<s.features.length;++u)if(Jd(s.features[u].geometry.type))return new oh(s,s.features[u].geometry)}else if(s.type==="Feature"){if(Jd(s.geometry.type))return new oh(s,s.geometry)}else if(Jd(s.type))return new oh(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return(function(u,p,_){const x=[];for(const C of u)for(const k of C)x.push(kh(k,p));const E=new uc(x[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?Fl(x,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",E):_.type==="MultiLineString"?Nu(x,!1,_.coordinates,E):_.type==="Polygon"||_.type==="MultiPolygon"?Df(x,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,E):null})(i,s,this.geometries);if(e.geometryType()==="LineString")return(function(u,p,_){const x=[];for(const C of u){const k=[];for(const B of C)k.push(kh(B,p));x.push(k)}const E=new uc(x[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Nu(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",x,E);if(_.type==="MultiLineString"){let C=1/0;for(let k=0;k<_.coordinates.length;k++){const B=Nu(_.coordinates[k],!0,x,E,C);if(isNaN(B))return B;if((C=Math.min(C,B))===0)return C}return C}if(_.type==="Polygon"||_.type==="MultiPolygon"){let C=1/0;for(let k=0;k<x.length;k++){const B=Df(x[k],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,E,C);if(isNaN(B))return B;if((C=Math.min(C,B))===0)return C}return C}return null})(i,s,this.geometries);if(e.geometryType()==="Polygon")return(function(u,p,_){const x=[];for(const C of(function(k,B){const j=k.length;if(j<=1)return[k];const U=[];let $,ee;for(let le=0;le<j;le++){const oe=ah(k[le]);oe!==0&&(k[le].area=Math.abs(oe),ee===void 0&&(ee=oe<0),ee===oe<0?($&&U.push($),$=[k[le]]):$.push(k[le]))}return $&&U.push($),U})(u)){const k=[];for(let B=0;B<C.length;++B)k.push(Wd(C[B],p));x.push(k)}const E=new uc(x[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Df(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",x,E);if(_.type==="MultiLineString"){let C=1/0;for(let k=0;k<_.coordinates.length;k++){const B=Df(_.coordinates[k],!0,x,E,C);if(isNaN(B))return B;if((C=Math.min(C,B))===0)return C}return C}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(C,k,B){let j=1/0;for(const U of C)for(const $ of k){const ee=Xo(U,$,B,j);if(isNaN(ee))return ee;if((j=Math.min(j,ee))===0)return j}return j})(_.type==="Polygon"?[_.coordinates]:_.coordinates,x,E):null})(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Oh(r){if(r instanceof Zo&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ku||r instanceof oh)return!1;if(r instanceof Bh)return r.featureConstant;let e=!0;return r.eachChild((i=>{e&&!Oh(i)&&(e=!1)})),e}function yo(r){if(r instanceof Zo&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((i=>{e&&!yo(i)&&(e=!1)})),e}function $a(r,e){if(r instanceof Zo&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((s=>{i&&!$a(s,e)&&(i=!1)})),i}function dn(r,e,i){return[r,e,i].filter(Boolean).join("")}function Wc(r,e){switch(r){case"string":return Pl(e);case"number":return+e;case"boolean":return!!e;case"color":return Ia.parse(e);case"formatted":return Dl.fromString(Pl(e));case"resolvedImage":return Co.build(Pl(e))}return e}function dc(r,e,i,s){return s!==void 0&&(r=s*Math.round(r/s)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Bh{constructor(e,i,s,u=!1){this.type=e,this.key=i,this.scope=s,this.featureConstant=u}static parse(e,i){let s=i.expectedType;if(s==null&&(s=Sa),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const u=i.parse(e[1],1);if(!(u instanceof Rc))return i.error("Key name of 'config' expression must be a string literal.");let p,_=!0;const x=Pl(u.value);if(e.length>=3){const E=i.parse(e[2],2);if(!(E instanceof Rc))return i.error("Scope of 'config' expression must be a string literal.");p=Pl(E.value)}if(i.options){const E=dn(x,p,i._scope),C=i.options.get(E);C&&(_=Oh(C.value||C.default))}return new Bh(s,x,p,_)}evaluate(e){const i=dn(this.key,this.scope,e.scope),s=e.getConfig(i);if(!s)return null;const{type:u,value:p,values:_,minValue:x,maxValue:E,stepValue:C}=s,k=s.default.evaluate(e);let B=k;if(p){const j=e.scope;e.scope=(j||"").split("").slice(1).join(""),B=p.evaluate(e),e.scope=j}return u&&(B=Wc(u,B)),B===void 0||x===void 0&&E===void 0&&C===void 0||(typeof B=="number"?B=dc(B,x,E,C):Array.isArray(B)&&(B=B.map((j=>typeof j=="number"?dc(j,x,E,C):j)))),p!==void 0&&B!==void 0&&_&&!_.includes(B)&&(B=k,u&&(B=Wc(u,B))),(u&&u!==this.type||B!==void 0&&!Md(oo(B),this.type))&&(B=Wc(this.type.kind,B)),B}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Jl{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new Jl(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class lh{constructor(e,i=[],s,u=new id,p=[],_,x,E){this.registry=e,this.path=i,this.key=i.map((C=>typeof C=="string"?`['${C}']`:`[${C}]`)).join(""),this.scope=u,this.errors=p,this.expectedType=s,this._scope=_,this.options=x,this.iconImageUseTheme=E}parse(e,i,s,u,p={}){return i||s?this.concat(i,null,s,u)._parse(e,p):this._parse(e,p)}parseObjectValue(e,i,s,u,p,_={}){return this.concat(i,s,u,p)._parse(e,_)}_parse(e,i){function s(u,p,_){return _==="assert"?new Kl(p,[u]):_==="coerce"?new Dc(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const _=this.expectedType,x=p.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||x.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(_,x))return null}else p=s(p,_,i.typeAnnotation||"coerce");else p=s(p,_,i.typeAnnotation||"assert")}if(!(p instanceof Rc)&&p.type.kind!=="resolvedImage"&&Qd(p)){const _=new Dh(this._scope,this.options,this.iconImageUseTheme);try{p=new Rc(p.type,p.evaluate(_))}catch(x){return this.error(x.message),null}}return p}return Dc.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,u){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof i=="string"?p.concat(i):p;const _=u?this.scope.concat(u):this.scope;return new lh(this.registry,p,s||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const s=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new Xl(s,e))}checkSubtype(e,i){const s=qc(e,i);return s&&this.error(s),s}}function Qd(r){if(r instanceof Jl)return Qd(r.boundExpression);if(r instanceof Zo&&r.name==="error"||r instanceof _s||r instanceof ku||r instanceof oh||r instanceof Bh)return!1;const e=r instanceof Dc||r instanceof Kl;let i=!0;return r.eachChild((s=>{i=e?i&&Qd(s):i&&s instanceof Rc})),!!i&&Oh(r)&&$a(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ra(r,e){const i=r.length-1;let s,u,p=0,_=i,x=0;for(;p<=_;)if(x=Math.floor((p+_)/2),s=r[x],u=r[x+1],s<=e){if(x===i||e<u)return x;p=x+1}else{if(!(s>e))throw new io("Input is not a number.");_=x-1}return 0}class Xc{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,p]of s)this.labels.push(u),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,En);if(!s)return null;const u=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let _=1;_<e.length;_+=2){const x=_===1?-1/0:e[_],E=e[_+1],C=_,k=_+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const B=i.parse(E,k,p);if(!B)return null;p=p||B.type,u.push([x,B])}return new Xc(p,s,u)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const p=i.length;return u>=i[p-1]?s[p-1].evaluate(e):s[Ra(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const ip=.95047,dd=1.08883,np=4/29,Ol=6/29,ju=3*Ol*Ol,ch=Ol*Ol*Ol,uh=Math.PI/180,Rp=180/Math.PI;function Cd(r){return r>ch?Math.pow(r,1/3):r/ju+np}function fd(r){return r>Ol?r*r*r:ju*(r-np)}function ef(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Yo(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Ba(r){const e=Yo(r.r),i=Yo(r.g),s=Yo(r.b),u=Cd((.4124564*e+.3575761*i+.1804375*s)/ip),p=Cd((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-Cd((.0193339*e+.119192*i+.9503041*s)/dd)),alpha:r.a}}function yu(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,s=isNaN(r.b)?e:e-r.b/200;return e=1*fd(e),i=ip*fd(i),s=dd*fd(s),new Ia(ef(3.2404542*i-1.5371385*e-.4985314*s),ef(-.969266*i+1.8760108*e+.041556*s),ef(.0556434*i-.2040259*e+1.0572252*s),r.alpha)}function pd(r,e,i){const s=e-r;return r+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Nh={forward:Ba,reverse:yu,interpolate:function(r,e,i){return{l:Hn(r.l,e.l,i),a:Hn(r.a,e.a,i),b:Hn(r.b,e.b,i),alpha:Hn(r.alpha,e.alpha,i)}}},tf={forward:function(r){const{l:e,a:i,b:s}=Ba(r),u=Math.atan2(s,i)*Rp;return{h:u<0?u+360:u,c:Math.sqrt(i*i+s*s),l:e,alpha:r.a}},reverse:function(r){const e=r.h*uh,i=r.c;return yu({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:pd(r.h,e.h,i),c:Hn(r.c,e.c,i),l:Hn(r.l,e.l,i),alpha:Hn(r.alpha,e.alpha,i)}}};var nf=Object.freeze({__proto__:null,hcl:tf,lab:Nh});class hs{constructor(e,i,s,u,p){this.type=e,this.operator=i,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[_,x]of p)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(e,i,s,u){let p=0;if(e.name==="exponential")p=fc(i,e.base,s,u);else if(e.name==="linear")p=fc(i,1,s,u);else if(e.name==="cubic-bezier"){const _=e.controlPoints;p=new jt(_[0],_[1],_[2],_[3]).solve(fc(i,1,s,u))}return p}static parse(e,i){let[s,u,p,..._]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const C=u[1];if(typeof C!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(C.length!==4||C.some((k=>typeof k!="number"||k<0||k>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,En),!p)return null;const x=[];let E=null;s==="interpolate-hcl"||s==="interpolate-lab"?E=Yl:i.expectedType&&i.expectedType.kind!=="value"&&(E=i.expectedType);for(let C=0;C<_.length;C+=2){const k=_[C],B=_[C+1],j=C+3,U=C+4;if(typeof k!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(x.length&&x[x.length-1][0]>=k)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const $=i.parse(B,U,E);if(!$)return null;E=E||$.type,x.push([k,$])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new hs(E,s,u,p,x):i.error(`Type ${so(E)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const p=i.length;if(u>=i[p-1])return s[p-1].evaluate(e);const _=Ra(i,u),x=hs.interpolationFactor(this.interpolation,u,i[_],i[_+1]),E=s[_].evaluate(e),C=s[_+1].evaluate(e);return this.operator==="interpolate"?$d[this.type.kind.toLowerCase()](E,C,x):this.operator==="interpolate-hcl"?tf.reverse(tf.interpolate(tf.forward(E),tf.forward(C),x)):Nh.reverse(Nh.interpolate(Nh.forward(E),Nh.forward(C),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function fc(r,e,i,s){const u=s-i,p=r-i;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class Yc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const u=i.expectedType;u&&u.kind!=="value"&&(s=u);const p=[];for(const x of e.slice(1)){const E=i.parse(x,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!E)return null;s=s||E.type,p.push(E)}const _=u&&p.some((x=>qc(u,x.type)));return new Yc(_?Sa:s,p)}evaluate(e){let i,s=null,u=0;for(const p of this.args){if(u++,s=p.evaluate(e),s&&s instanceof Co&&!s.available&&(i||(i=s),s=null,u===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Wn{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let p=1;p<e.length-1;p+=2){const _=e[p];if(typeof _!="string")return i.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const x=i.parse(e[p+1],p+1);if(!x)return null;s.push([_,x])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return u?new Wn(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class Fr{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,En),u=i.parse(e[2],2,rl(i.expectedType||Sa));return s&&u?new Fr(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new io("Array index out of bounds: negative index");if(i>=s.length)throw new io("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new io("Array index must be an integer. Use at-interpolated for fractional indices");return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vu{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,En),u=i.parse(e[2],2,rl(i.expectedType||Sa));return s&&u?new vu(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new io(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new io(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const u=Math.floor(i),p=Math.ceil(i),_=s[u],x=s[p];if(typeof _!="number"||typeof x!="number")throw new io(`Cannot interpolate between non-number values at index ${i}.`);const E=i-u;return _*(1-E)+x*E}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Vu{constructor(e,i){this.type=Ca,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Sa),u=i.parse(e[2],2,Sa);return s&&u?zh(s.type,[Ca,ra,En,zc,Sa])?new Vu(s,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${so(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Pu(i,["boolean","string","number","null"]))throw new io(`Expected first argument to be of type boolean, string, number or null, but found ${so(oo(i))} instead.`);if(!Pu(s,["string","array"]))throw new io(`Expected second argument to be of type array or string, but found ${so(oo(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class md{constructor(e,i,s){this.type=En,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Sa),u=i.parse(e[2],2,Sa);if(!s||!u)return null;if(!zh(s.type,[Ca,ra,En,zc,Sa]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${so(s.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,En);return p?new md(s,u,p):null}return new md(s,u)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Pu(i,["boolean","string","number","null"]))throw new io(`Expected first argument to be of type boolean, string, number or null, but found ${so(oo(i))} instead.`);if(!Pu(s,["string","array"]))throw new io(`Expected second argument to be of type array or string, but found ${so(oo(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(i,u)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class L{constructor(e,i,s,u,p,_){this.inputType=e,this.type=i,this.input=s,this.cases=u,this.outputs=p,this.otherwise=_}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const p={},_=[];for(let C=2;C<e.length-1;C+=2){let k=e[C];const B=e[C+1];Array.isArray(k)||(k=[k]);const j=i.concat(C);if(k.length===0)return j.error("Expected at least one branch label.");for(const $ of k){if(typeof $!="number"&&typeof $!="string")return j.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return j.error("Numeric branch labels must be integer values.");if(s){if(j.checkSubtype(s,oo($)))return null}else s=oo($);if(p[String($)]!==void 0)return j.error("Branch labels must be unique.");p[String($)]=_.length}const U=i.parse(B,C,u);if(!U)return null;u=u||U.type,_.push(U)}const x=i.parse(e[1],1,Sa);if(!x)return null;const E=i.parse(e[e.length-1],e.length-1,u);return E?x.type.kind!=="value"&&i.concat(1).checkSubtype(s,x.type)?null:new L(s,u,x,p,_,E):null}evaluate(e){const i=this.input.evaluate(e);return(Md(oo(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],u={};for(const _ of i){const x=u[this.cases[_]];x===void 0?(u[this.cases[_]]=s.length,s.push([this.cases[_],[_]])):s[x][1].push(_)}const p=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,x]of s)e.push(x.length===1?p(x[0]):x.map(p)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class o{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const x=i.parse(e[_],_,Ca);if(!x)return null;const E=i.parse(e[_+1],_+1,s);if(!E)return null;u.push([x,E]),s=s||E.type}const p=i.parse(e[e.length-1],e.length-1,s);return p?new o(s,u,p):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class v{constructor(e,i,s,u){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Sa),u=i.parse(e[2],2,En);if(!s||!u)return null;if(!zh(s.type,[rl(Sa),ra,Sa]))return i.error(`Expected first argument to be of type array or string, but found ${so(s.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,En);return p?new v(s.type,s,u,p):null}return new v(s.type,s,u)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Pu(i,["string","array"]))throw new io(`Expected first argument to be of type array or string, but found ${so(oo(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(s,u)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class A{constructor(e,i){this.type=rl(ra),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ra),u=i.parse(e[2],2,ra);return s&&u?new A(s,u):void 0}evaluate(e){const i=this.str.evaluate(e),s=this.delimiter.evaluate(e);return i.split(s)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function M(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function P(r,e,i,s){return s.compare(e,i)===0}function q(r,e,i){const s=r!=="=="&&r!=="!=";return class dw{constructor(p,_,x){this.type=Ca,this.lhs=p,this.rhs=_,this.collator=x,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");const x=p[0];let E=_.parse(p[1],1,Sa);if(!E)return null;if(!M(x,E.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${so(E.type)}'.`);let C=_.parse(p[2],2,Sa);if(!C)return null;if(!M(x,C.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${so(C.type)}'.`);if(E.type.kind!==C.type.kind&&E.type.kind!=="value"&&C.type.kind!=="value")return _.error(`Cannot compare types '${so(E.type)}' and '${so(C.type)}'.`);s&&(E.type.kind==="value"&&C.type.kind!=="value"?E=new Kl(C.type,[E]):E.type.kind!=="value"&&C.type.kind==="value"&&(C=new Kl(E.type,[C])));let k=null;if(p.length===4){if(E.type.kind!=="string"&&C.type.kind!=="string"&&E.type.kind!=="value"&&C.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(k=_.parse(p[3],3,Mf),!k)return null}return new dw(E,C,k)}evaluate(p){const _=this.lhs.evaluate(p),x=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const E=oo(_),C=oo(x);if(E.kind!==C.kind||E.kind!=="string"&&E.kind!=="number")throw new io(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${E.kind}, ${C.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const E=oo(_),C=oo(x);if(E.kind!=="string"||C.kind!=="string")return e(p,_,x)}return this.collator?i(p,_,x,this.collator.evaluate(p)):e(p,_,x)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[r];return this.eachChild((_=>{p.push(_.serialize())})),p}}}const J=q("==",(function(r,e,i){return e===i}),P),ne=q("!=",(function(r,e,i){return e!==i}),(function(r,e,i,s){return!P(0,e,i,s)})),fe=q("<",(function(r,e,i){return e<i}),(function(r,e,i,s){return s.compare(e,i)<0})),we=q(">",(function(r,e,i){return e>i}),(function(r,e,i,s){return s.compare(e,i)>0})),Te=q("<=",(function(r,e,i){return e<=i}),(function(r,e,i,s){return s.compare(e,i)<=0})),Be=q(">=",(function(r,e,i){return e>=i}),(function(r,e,i,s){return s.compare(e,i)>=0}));class Ke{constructor(e,i,s,u,p,_){this.type=ra,this.number=e,this.locale=i,this.currency=s,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,En);if(!s)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=i.parseObjectValue(u.locale,2,"locale",ra),!p))return null;let _=null;if(u.currency&&(_=i.parseObjectValue(u.currency,2,"currency",ra),!_))return null;let x=null;if(u.unit&&(x=i.parseObjectValue(u.unit,2,"unit",ra),!x))return null;let E=null;if(u["min-fraction-digits"]&&(E=i.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",En),!E))return null;let C=null;return u["max-fraction-digits"]&&(C=i.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",En),!C)?null:new Ke(s,p,_,x,E,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ot{constructor(e){this.type=En,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${so(s.type)} instead.`):new ot(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new io(`Expected value to be of type string or array, but found ${so(oo(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function wt(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Mt={"==":J,"!=":ne,">":we,"<":fe,">=":Be,"<=":Te,array:Kl,at:Fr,"at-interpolated":vu,boolean:Kl,case:o,coalesce:Yc,collator:_s,format:zo,image:hr,in:Vu,"index-of":md,interpolate:hs,"interpolate-hcl":hs,"interpolate-lab":hs,length:ot,let:Wn,literal:Rc,match:L,number:Kl,"number-format":Ke,object:Kl,slice:v,step:Xc,string:Kl,"to-boolean":Dc,"to-color":Dc,"to-number":Dc,"to-string":Dc,var:Jl,within:ku,distance:oh,config:Bh,split:A};function Rt(r,[e,i,s,u]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const p=u?u.evaluate(r):1,_=Ls(e,i,s,p);if(_)throw new io(_);return new Ia(e/255,i/255,s/255,p)}function Ft(r,[e,i,s,u]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const p=u?u.evaluate(r):1,_=(function(C,k,B,j){return typeof C=="number"&&C>=0&&C<=360?typeof k=="number"&&k>=0&&k<=100&&typeof B=="number"&&B>=0&&B<=100?j===void 0||typeof j=="number"&&j>=0&&j<=1?null:`Invalid hsla value [${[C,k,B,j].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof j=="number"?[C,k,B,j]:[C,k,B]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof j=="number"?[C,k,B,j]:[C,k,B]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,s,p);if(_)throw new io(_);const x=`hsla(${e}, ${i}%, ${s}%, ${p})`,E=Ia.parse(x);if(!E)throw new io(`Failed to parse HSLA color: ${x}`);return E}function yt(r,e){return r in e}function Ht(r,e){const i=e[r];return i===void 0?null:i}function Jt(r){return{type:r}}function oi(r){if(r instanceof Bh)return new Set([r.key]);let e=new Set;return r.eachChild((i=>{e=new Set([...e,...oi(i)])})),e}function Xi(r){if(r instanceof Zo&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild((i=>{!e&&Xi(i)&&(e=!0)})),e}function An(r){return{result:"success",value:r}}function Cn(r){return{result:"error",value:r}}function Zn(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Ln(r){return r["property-type"]==="data-driven"}function Rn(r){return Zn(r.expression,"measure-light")}function ir(r){return Zn(r.expression,"zoom")}function Xr(r){return!!r.expression&&r.expression.interpolated}function Fn(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function qn(r){return r}function ea(r,e){const i=e.type==="color",s=r.stops&&typeof r.stops[0][0]=="object",u=s||!(s||r.property!==void 0),p=r.type||(Xr(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map((C=>[C[0],Ia.parse(C[1])]))),r.default=Ia.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!nf[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,x,E;if(p==="exponential")_=Vs;else if(p==="interval")_=Ya;else if(p==="categorical"){_=Da,x=Object.create(null);for(const C of r.stops)x[C[0]]=C[1];E=typeof r.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=sl}if(s){const C={},k=[];for(let U=0;U<r.stops.length;U++){const $=r.stops[U],ee=$[0].zoom;C[ee]===void 0&&(C[ee]={zoom:ee,type:r.type,property:r.property,default:r.default,stops:[]},k.push(ee)),C[ee].stops.push([$[0].value,$[1]])}const B=[];for(const U of k)B.push([C[U].zoom,ea(C[U],e)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:hs.interpolationFactor.bind(void 0,j),zoomStops:B.map((U=>U[0])),evaluate:({zoom:U},$)=>Vs({stops:B,base:r.base},e,U).evaluate(U,$)}}if(u){const C=p==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:hs.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map((k=>k[0])),evaluate:({zoom:k})=>_(r,e,k,x,E)}}return{kind:"source",evaluate(C,k){const B=k&&k.properties?k.properties[r.property]:void 0;return B===void 0?is(r.default,e.default):_(r,e,B,x,E)}}}function is(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function Da(r,e,i,s,u){return is(typeof i===u?s[i]:void 0,r.default,e.default)}function Ya(r,e,i){if(!Lu(i))return is(r.default,e.default);const s=r.stops.length;if(s===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[s-1][0])return r.stops[s-1][1];const u=Ra(r.stops.map((p=>p[0])),i);return r.stops[u][1]}function Vs(r,e,i){const s=r.base!==void 0?r.base:1;if(!Lu(i))return is(r.default,e.default);const u=r.stops.length;if(u===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[u-1][0])return r.stops[u-1][1];const p=Ra(r.stops.map((k=>k[0])),i),_=(function(k,B,j,U){const $=U-j,ee=k-j;return $===0?0:B===1?ee/$:(Math.pow(B,ee)-1)/(Math.pow(B,$)-1)})(i,s,r.stops[p][0],r.stops[p+1][0]),x=r.stops[p][1],E=r.stops[p+1][1];let C=$d[e.type]||qn;if(r.colorSpace&&r.colorSpace!=="rgb"){const k=nf[r.colorSpace];C=(B,j)=>k.reverse(k.interpolate(k.forward(B),k.forward(j),_))}return typeof x.evaluate=="function"?{evaluate(...k){const B=x.evaluate.apply(void 0,k),j=E.evaluate.apply(void 0,k);if(B!==void 0&&j!==void 0)return C(B,j,_)}}:C(x,E,_)}function sl(r,e,i){return e.type==="color"?i=Ia.parse(i):e.type==="formatted"?i=Dl.fromString(i.toString()):e.type==="resolvedImage"?i=Co.build(i.toString()):yn(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),is(i,r.default,e.default)}Zo.register(Mt,{error:[{kind:"error"},[ra],(r,[e])=>{throw new io(e.evaluate(r))}],typeof:[ra,[Sa],(r,[e])=>so(oo(e.evaluate(r)))],"to-rgba":[rl(En,4),[Yl],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[rl(En,4),[Yl],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Yl,[En,En,En],Rt],rgba:[Yl,[En,En,En,En],Rt],hsl:[Yl,[En,En,En],Ft],hsla:[Yl,[En,En,En,En],Ft],has:{type:Ca,overloads:[[[ra],(r,[e])=>yt(e.evaluate(r),r.properties())],[[ra,Du],(r,[e,i])=>yt(e.evaluate(r),i.evaluate(r))]]},get:{type:Sa,overloads:[[[ra],(r,[e])=>Ht(e.evaluate(r),r.properties())],[[ra,Du],(r,[e,i])=>Ht(e.evaluate(r),i.evaluate(r))]]},"feature-state":[Sa,[ra],(r,[e])=>Ht(e.evaluate(r),r.featureState||{})],properties:[Du,[],r=>r.properties()],"geometry-type":[ra,[],r=>r.geometryType()],worldview:[ra,[],r=>r.globals.worldview||""],"is-active-floor":[Ca,Jt(ra),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const i=r.globals.activeFloors;return e.some((s=>{const u=s.evaluate(r);return i.has(u)}))}],id:[Sa,[],r=>r.id()],zoom:[En,[],r=>r.globals.zoom],pitch:[En,[],r=>r.globals.pitch||0],"distance-from-center":[En,[],r=>r.distanceFromCenter()],"measure-light":[En,[ra],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[En,[],r=>r.globals.heatmapDensity||0],"line-progress":[En,[],r=>r.globals.lineProgress||0],"raster-value":[En,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[En,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[En,[],r=>r.globals.skyRadialProgress||0],accumulated:[Sa,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[En,Jt(En),(r,e)=>{let i=0;for(const s of e)i+=s.evaluate(r);return i}],"*":[En,Jt(En),(r,e)=>{let i=1;for(const s of e)i*=s.evaluate(r);return i}],"-":{type:En,overloads:[[[En,En],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[En],(r,[e])=>-e.evaluate(r)]]},"/":[En,[En,En],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[En,[En,En],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[En,[],()=>Math.LN2],pi:[En,[],()=>Math.PI],e:[En,[],()=>Math.E],"^":[En,[En,En],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[En,[En],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[En,[En],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[En,[En],(r,[e])=>Math.log(e.evaluate(r))],log2:[En,[En],(r,[e])=>Math.log2(e.evaluate(r))],sin:[En,[En],(r,[e])=>Math.sin(e.evaluate(r))],cos:[En,[En],(r,[e])=>Math.cos(e.evaluate(r))],tan:[En,[En],(r,[e])=>Math.tan(e.evaluate(r))],asin:[En,[En],(r,[e])=>Math.asin(e.evaluate(r))],acos:[En,[En],(r,[e])=>Math.acos(e.evaluate(r))],atan:[En,[En],(r,[e])=>Math.atan(e.evaluate(r))],min:[En,Jt(En),(r,e)=>Math.min(...e.map((i=>i.evaluate(r))))],max:[En,Jt(En),(r,e)=>Math.max(...e.map((i=>i.evaluate(r))))],abs:[En,[En],(r,[e])=>Math.abs(e.evaluate(r))],round:[En,[En],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[En,[En],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[En,[En],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Ca,[ra,Sa],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[Ca,[Sa],(r,[e])=>r.id()===e.value],"filter-type-==":[Ca,[ra],(r,[e])=>r.geometryType()===e.value],"filter-<":[Ca,[ra,Sa],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Ca,[Sa],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Ca,[ra,Sa],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s>u}],"filter-id->":[Ca,[Sa],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Ca,[ra,Sa],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Ca,[Sa],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Ca,[ra,Sa],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Ca,[Sa],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Ca,[Sa],(r,[e])=>e.value in r.properties()],"filter-has-id":[Ca,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Ca,[rl(ra)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Ca,[rl(Sa)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Ca,[ra,rl(Sa)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Ca,[ra,rl(Sa)],(r,[e,i])=>(function(s,u,p,_){for(;p<=_;){const x=p+_>>1;if(u[x]===s)return!0;u[x]>s?_=x-1:p=x+1}return!1})(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Ca,overloads:[[[Ca,Ca],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Jt(Ca),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Ca,overloads:[[[Ca,Ca],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Jt(Ca),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[Ca,[Ca],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Ca,[ra],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[ra,[ra],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[ra,[ra],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[ra,Jt(Sa),(r,e)=>e.map((i=>Pl(i.evaluate(r)))).join("")],"resolved-locale":[ra,[Mf],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[En,[En,En,Sa],(r,e)=>{const[i,s,u]=e.map((_=>_.evaluate(r)));if(i>s||i===s)return i;let p;if(typeof u=="string")p=(function(_){let x=0;if(_.length===0)return x;for(let E=0;E<_.length;E++)x=(x<<5)-x+_.charCodeAt(E),x|=0;return x})(u);else{if(typeof u!="number")throw new io(`Invalid seed input: ${u}`);p=u}return i+wt(p)()*(s-i)}]});class pc{constructor(e,i,s,u,p){this.expression=e,this._warningHistory={},this._scope=s,this._options=u,this._iconImageUseTheme=p,this._evaluator=new Dh(s,u,p),this._defaultValue=i?(function(_){return _.type==="color"&&(Fn(_.default)||Array.isArray(_.default))?new Ia(0,0,0,0):_.type==="color"?Ia.parse(_.default)||null:_.default===void 0?null:_.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=oi(e),this.isIndoorDependent=Xi(e)}evaluateWithoutErrorHandling(e,i,s,u,p,_,x,E){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,u,p,_,x,E,C){this._evaluator||(this._evaluator=new Dh(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=E||null,this._evaluator.iconImageUseTheme=C||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new io(`Expected value to be one of ${Object.keys(this._enumValues).map((B=>JSON.stringify(B))).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){const B=k;return this._warningHistory[B.message]||(this._warningHistory[B.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${B.message}`)),this._defaultValue}}}function Us(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Mt}function Fo(r,e,i,s,u){const p=new lh(Mt,[],e?(function(x){const E={color:Yl,string:ra,number:En,enum:ra,boolean:Ca,formatted:nd,resolvedImage:Hc};return x.type==="array"?rl(E[x.value]||Sa,x.length):E[x.type]})(e):void 0,void 0,void 0,i,s,u),_=p.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?An(new pc(_,e,i,s,u)):Cn(p.errors)}class Gs{constructor(e,i,s,u){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!yo(i.expression),this.configDependencies=oi(i.expression),this.isIndoorDependent=Xi(i.expression)}evaluateWithoutErrorHandling(e,i,s,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,p,_)}evaluate(e,i,s,u,p,_,x){return this._styleExpression.evaluate(e,i,s,u,p,_,void 0,void 0,x)}}class ks{constructor(e,i,s,u,p,_){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!yo(i.expression),this.isIndoorDependent=Xi(i.expression),this.isLightConstant=p,this.isLineProgressConstant=_,this.configDependencies=oi(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,s,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,p,_)}evaluate(e,i,s,u,p,_){return this._styleExpression.evaluate(e,i,s,u,p,_)}interpolationFactor(e,i,s){return this.interpolationType?hs.interpolationFactor(this.interpolationType,e,i,s):0}}function Ro(r,e,i,s,u){if((r=Fo(r,e,i,s,u)).result==="error")return r;const p=r.value.expression,_=Oh(p);if(!_&&!Ln(e))return Cn([new Xl("","data expressions not supported")]);const x=$a(p,["zoom","pitch","distance-from-center"]);if(!x&&!ir(e))return Cn([new Xl("","zoom expressions not supported")]);const E=$a(p,["measure-light"]);if(!E&&!Rn(e))return Cn([new Xl("","measure-light expression not supported")]);const C=$a(p,["line-progress"]);if(!C&&!(function(j){return Zn(j.expression,"line-progress")})(e))return Cn([new Xl("","line-progress expression not supported")]);const k=e.expression&&e.expression.relaxZoomRestriction,B=Bl(p);return B||x||k?B instanceof Xl?Cn([B]):B instanceof hs&&!Xr(e)?Cn([new Xl("",'"interpolate" expressions cannot be used with this property')]):An(B?new ks(_&&C?"camera":"composite",r.value,B.labels,B instanceof hs?B.interpolation:void 0,E,C):new Gs(_&&C?"constant":"source",r.value,E,C)):Cn([new Xl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class mc{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,ea(this._parameters,this._specification))}static deserialize(e){return new mc(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bl(r){let e=null;if(r instanceof Wn)e=Bl(r.result);else if(r instanceof Yc){for(const i of r.args)if(e=Bl(i),e)break}else(r instanceof Xc||r instanceof hs)&&r.input instanceof Zo&&r.input.name==="zoom"&&(e=r);return e instanceof Xl||r.eachChild((i=>{const s=Bl(i);s instanceof Xl?e=s:e&&s&&e!==s&&(e=new Xl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Kc,ul,Fs=(function(){if(ul)return Kc;ul=1,Kc=e;var r=3;function e(i,s,u){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var _=new Int32Array(this.arrayBuffer);i=_[0],this.d=(s=_[1])+2*(u=_[2]);for(var x=0;x<this.d*this.d;x++){var E=_[r+x],C=_[r+x+1];p.push(E===C?null:_.subarray(E,C))}var k=_[r+p.length+1];this.keys=_.subarray(_[r+p.length],k),this.bboxes=_.subarray(k),this.insert=this._insertReadonly}else{this.d=s+2*u;for(var B=0;B<this.d*this.d;B++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=u,this.scale=s/i,this.uid=0;var j=u/s*i;this.min=-j,this.max=i+j}return e.prototype.insert=function(i,s,u,p,_){this._forEachCell(s,u,p,_,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,u,p,_,x){this.cells[_].push(x)},e.prototype.query=function(i,s,u,p,_){var x=this.min,E=this.max;if(i<=x&&s<=x&&E<=u&&E<=p&&!_)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(i,s,u,p,this._queryCell,C,{},_),C},e.prototype._queryCell=function(i,s,u,p,_,x,E,C){var k=this.cells[_];if(k!==null)for(var B=this.keys,j=this.bboxes,U=0;U<k.length;U++){var $=k[U];if(E[$]===void 0){var ee=4*$;(C?C(j[ee+0],j[ee+1],j[ee+2],j[ee+3]):i<=j[ee+2]&&s<=j[ee+3]&&u>=j[ee+0]&&p>=j[ee+1])?(E[$]=!0,x.push(B[$])):E[$]=!1}}},e.prototype._forEachCell=function(i,s,u,p,_,x,E,C){for(var k=this._convertToCellCoord(i),B=this._convertToCellCoord(s),j=this._convertToCellCoord(u),U=this._convertToCellCoord(p),$=k;$<=j;$++)for(var ee=B;ee<=U;ee++){var le=this.d*ee+$;if((!C||C(this._convertFromCellCoord($),this._convertFromCellCoord(ee),this._convertFromCellCoord($+1),this._convertFromCellCoord(ee+1)))&&_.call(this,i,s,u,p,le,x,E,C))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=r+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var _=new Int32Array(s+u+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var x=s,E=0;E<i.length;E++){var C=i[E];_[r+E]=x,_.set(C,x),x+=C.length}return _[r+i.length]=x,_.set(this.keys,x),_[r+i.length+1]=x+=this.keys.length,_.set(this.bboxes,x),x+=this.bboxes.length,_.buffer},Kc})(),xu=et(Fs);const Nl={};function hi(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Nl[e]={klass:r,omit:i.omit||[]}}hi(Object,"Object"),xu.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},xu.deserialize=function(r){return new xu(r.buffer)},Object.defineProperty(xu,"name",{value:"Grid"}),hi(xu,"Grid"),delete Ge.prototype.constructor,hi(Ia,"Color"),hi(Error,"Error"),hi(Dl,"Formatted"),hi(go,"FormattedSection"),hi(Ho,"AJAXError"),hi(Co,"ResolvedImage"),hi(mc,"StylePropertyFunction"),hi(pc,"StyleExpression",{omit:["_evaluator"]}),hi(Rl,"ImageId"),hi(xa,"ImageVariant"),hi(ks,"ZoomDependentExpression"),hi(Gs,"ZoomConstantExpression"),hi(Zo,"CompoundExpression",{omit:["_evaluate"]});for(const r in Mt)Nl[Mt[r]._classRegistryKey]||hi(Mt[r],`Expression${r}`);function Na(r){return r&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function gs(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Na(r)||r instanceof ImageBitmap)return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const s of r)i.push(gs(s,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[s,u]of r.entries())i.entries.push(gs(s),gs(u,e));return i}if(r instanceof Set){const i={$name:"Set"};let s=0;for(const u of r.values())i[++s]=gs(u);return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const u=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const p in r)r.hasOwnProperty(p)&&(Nl[s].omit.indexOf(p)>=0||(u[p]=gs(r[p],e)));r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof r)}function Ko(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Na(r)||r instanceof ImageBitmap||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Ko);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const u=r.entries||[],p=new Map;for(let _=0;_<u.length;_+=2)p.set(Ko(u[_]),Ko(u[_+1]));return p}if(e==="Set"){const u=new Set;for(const p of Object.keys(r))p!=="$name"&&u.add(Ko(r[p]));return u}if(e==="BigInt")return BigInt(r.value);const{klass:i}=Nl[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const s=Object.create(i.prototype);for(const u of Object.keys(r))u!=="$name"&&(s[u]=Ko(r[u]));return s}throw new Error("can't deserialize object of type "+typeof r)}const pn={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function vo(r){for(const e of r)if(_c(e.charCodeAt(0)))return!0;return!1}function xl(r){for(const e of r)if(!ja(e.charCodeAt(0)))return!1;return!0}function ja(r){return!(pn.Arabic(r)||pn["Arabic Supplement"](r)||pn["Arabic Extended-A"](r)||pn["Arabic Presentation Forms-A"](r)||pn["Arabic Presentation Forms-B"](r))}function _c(r){return!(r!==746&&r!==747&&(r<4352||!(pn["Bopomofo Extended"](r)||pn.Bopomofo(r)||pn["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||pn["CJK Compatibility Ideographs"](r)||pn["CJK Compatibility"](r)||pn["CJK Radicals Supplement"](r)||pn["CJK Strokes"](r)||!(!pn["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||pn["CJK Unified Ideographs Extension A"](r)||pn["CJK Unified Ideographs"](r)||pn["Enclosed CJK Letters and Months"](r)||pn["Hangul Compatibility Jamo"](r)||pn["Hangul Jamo Extended-A"](r)||pn["Hangul Jamo Extended-B"](r)||pn["Hangul Jamo"](r)||pn["Hangul Syllables"](r)||pn.Hiragana(r)||pn["Ideographic Description Characters"](r)||pn.Kanbun(r)||pn["Kangxi Radicals"](r)||pn["Katakana Phonetic Extensions"](r)||pn.Katakana(r)&&r!==12540||!(!pn["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!pn["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||pn["Unified Canadian Aboriginal Syllabics"](r)||pn["Unified Canadian Aboriginal Syllabics Extended"](r)||pn["Vertical Forms"](r)||pn["Yijing Hexagram Symbols"](r)||pn["Yi Syllables"](r)||pn["Yi Radicals"](r))))}function jh(r){return!(_c(r)||(function(e){return!!(pn["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||pn["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||pn["Letterlike Symbols"](e)||pn["Number Forms"](e)||pn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||pn["Control Pictures"](e)&&e!==9251||pn["Optical Character Recognition"](e)||pn["Enclosed Alphanumerics"](e)||pn["Geometric Shapes"](e)||pn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||pn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||pn["CJK Symbols and Punctuation"](e)||pn.Katakana(e)||pn["Private Use Area"](e)||pn["CJK Compatibility Forms"](e)||pn["Small Form Variants"](e)||pn["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}function Ys(r){return pn.Arabic(r)||pn["Arabic Supplement"](r)||pn["Arabic Extended-A"](r)||pn["Arabic Presentation Forms-A"](r)||pn["Arabic Presentation Forms-B"](r)}function rf(r){return r>=1424&&r<=2303||pn["Arabic Presentation Forms-A"](r)||pn["Arabic Presentation Forms-B"](r)}function Uu(r,e){return!(!e&&rf(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||pn.Khmer(r))}function Dp(r){for(const e of r)if(rf(e.charCodeAt(0)))return!0;return!1}const qo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let rp=null,Jo=qo.unavailable,gc=null;const hh=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Jo=qo.error),rp&&rp(r)};function Qo(){no.fire(new zl("pluginStateChange",{pluginStatus:Jo,pluginURL:gc}))}const no=new td,bu=function(){return Jo},zd=function(){if(Jo!==qo.deferred||!gc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Jo=qo.loading,Qo(),gc&&Wl({url:gc},(r=>{r?hh(r):(Jo=qo.loaded,Qo())}))},Gu={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Jo===qo.loaded||Gu.applyArabicShaping!=null,isLoading:()=>Jo===qo.loading,setState(r){Jo=r.pluginStatus,gc=r.pluginURL},isParsing:()=>Jo===qo.parsing,isParsed:()=>Jo===qo.parsed,getPluginURL:()=>gc};class Ka{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,s){for(const u of i)if(!Uu(u.charCodeAt(0),s))return!1;return!0})(e,Gu.isLoaded())}}class dh{constructor(e,i,s,u,p){this.property=e,this.value=i,this.expression=(function(_,x,E,C,k){if(Fn(_))return new mc(_,x);if(Us(_)||Array.isArray(_)&&_.length>0){const B=Ro(_,x,E,C,k);if(B.result==="error")throw new Error(B.value.map((j=>`${j.key}: ${j.message}`)).join(", "));return B.value}{let B=_;return typeof _=="string"&&x.type==="color"&&(B=Ia.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>B}}})(i===void 0?e.specification.default:i,e.specification,s,u,p)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s,u){return this.property.possiblyEvaluate(this,e,i,s,u)}}class af{constructor(e,i,s,u){this.property=e,this.value=new dh(e,void 0,i,s,u)}transitioned(e,i){return new Rd(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Rd(this.property,this.value,null,{},0)}}class sf{constructor(e,i,s,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Gt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new af(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new dh(this._values[e].property,i===null?void 0:Gt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const u in e){const p=e[u];if(u.endsWith("-transition")){const _=u.slice(0,-11);s[_]&&this.setTransition(_,p)}else s.hasOwnProperty(u)&&this.setValue(u,p)}}getTransition(e){return Gt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new af(this._values[e].property)),this._values[e].transition=Gt(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const s=new Vh(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,i._values[u]);return s}untransitioned(){const e=new Vh(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Rd{constructor(e,i,s,u,p){const _=u.delay||0,x=u.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+_,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const u=e.now||0,p=this.value.possiblyEvaluate(e,i,s),_=this.prior;if(_){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return _.possiblyEvaluate(e,i,s);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,i,s),p,fr(x))}}return p}}class Vh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const u=new Dd(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Hu{constructor(e,i,s,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Gt(this._values[e].value)}setValue(e,i){this._values[e]=new dh(this._values[e].property,i===null?void 0:Gt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s,u){const p=new Dd(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,i,s,u);return p}isIndoorDependent(){return this._isIndoorDependent}}class Jc{constructor(e,i,s,u){this.property=e,this.value=i,this.parameters=s,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,u){return this.property.evaluate(this.value,this.parameters,e,i,s,u,this.iconImageUseTheme)}}class Dd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class bi{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const u=$d[this.specification.type];return u?u(e,i,s):e}}class Gi{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,u,p){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Jc(this,{kind:"constant",value:e.expression.evaluate(i,null,{},s,u,void 0,p)},i):new Jc(this,e.expression,i,p)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Jc(this,{kind:"constant",value:void 0},e.parameters);const u=$d[this.specification.type];return u?new Jc(this,{kind:"constant",value:u(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,u,p,_,x){return e.kind==="constant"?e.value:e.evaluate(i,s,u,p,_,void 0,x)}}class _d{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){return!!e.expression.evaluate(i,null,{},s,u)}interpolate(){return!1}}class da{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Ka(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new dh(u,void 0),_=this.defaultTransitionablePropertyValues[s]=new af(u);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate(i)}}}hi(Gi,"DataDrivenProperty"),hi(bi,"DataConstantProperty"),hi(_d,"ColorRampProperty");var bt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function dm(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Uh(r){if(Array.isArray(r))return r.map(Uh);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Uh(r[i]);return e}return dm(r)}function yc(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!yc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Pd(r,e="",i=null,s="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yc(r)||(r=Pp(r));const u=r;let p=!0;try{p=(function(k){if(!Pf(k))return k;let B=Uh(k);return fm(B),B=gd(B),B})(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let _=null,x=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){x=bt[`filter_${s}`];const k=Fo(p,x,e,i);if(k.result==="error")throw new Error(k.value.map((B=>`${B.key}: ${B.message}`)).join(", "));_=(B,j,U)=>k.value.evaluate(B,j,{},U)}let E=null,C=null;if(p!==u){const k=Fo(u,x,e,i);if(k.result==="error")throw new Error(k.value.map((B=>`${B.key}: ${B.message}`)).join(", "));E=(B,j,U,$,ee)=>k.value.evaluate(B,j,{},U,void 0,void 0,$,ee),C=!Oh(k.value.expression)}return{filter:_,dynamicFilter:E||void 0,needGeometry:pm(p),needFeature:!!C}}function gd(r){if(!Array.isArray(r))return r;const e=(function(i){if(Om.has(i[0])){for(let s=1;s<i.length;s++)if(Pf(i[s]))return!0}return i})(r);return e===!0?e:e.map((i=>gd(i)))}function fm(r){let e=!1;const i=[];if(r[0]==="case"){for(let s=1;s<r.length-1;s+=2)e=e||Pf(r[s]),i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Pf(r[1]);for(let s=2;s<r.length-1;s+=2)i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Pf(r[1]);for(let s=1;s<r.length-1;s+=2)i.push(r[s+1])}e&&(r.length=0,r.push("any",...i));for(let s=1;s<r.length;s++)fm(r[s])}function Pf(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Pf(r[i]))return!0;return!1}const Om=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function u_(r,e){return r<e?-1:r>e?1:0}function pm(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(pm(r[e]))return!0;return!1}function Pp(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Gh(r[1],r[2],"=="):e==="!="?qu(Gh(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Gh(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Pp))):e==="all"?["all"].concat(r.slice(1).map(Pp)):e==="none"?["all"].concat(r.slice(1).map(Pp).map(qu)):e==="in"?ap(r[1],r.slice(2)):e==="!in"?qu(ap(r[1],r.slice(2))):e==="has"?of(r[1]):e!=="!has"||qu(of(r[1]));var i}function Gh(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function ap(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(u_)]]:["filter-in-small",r,["literal",e]]}}function of(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function qu(r){return["!",r]}const lf="";function vc(r,e){return e?`${r}${lf}${e}`:r}let Lp;const sp=()=>Lp||(Lp=new da({"icon-size":new Gi(bt.layout_symbol["icon-size"]),"icon-image":new Gi(bt.layout_symbol["icon-image"]),"icon-rotate":new Gi(bt.layout_symbol["icon-rotate"]),"icon-offset":new Gi(bt.layout_symbol["icon-offset"]),"text-size":new Gi(bt.layout_symbol["text-size"]),"text-rotate":new Gi(bt.layout_symbol["text-rotate"]),"text-offset":new Gi(bt.layout_symbol["text-offset"])}));class mm{constructor(e,i,s,u,p,_){const x=Fo(e,bt.appearance.condition);if(x.result==="success"&&(this.condition=x.value),this.name=i,s){this.properties=new Dd(sp()),this.unevaluatedLayout=new Hu(sp(),u,p,_);for(const E in s)this.unevaluatedLayout.setValue(E,s[E])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,i,s){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,s))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),i=this.hasProperty("icon-size"),s=this.hasProperty("icon-offset"),u=this.hasProperty("icon-rotate");return e||i||s||u}hasTextProperties(){const e=this.hasProperty("text-size"),i=this.hasProperty("text-offset"),s=this.hasProperty("text-rotate");return e||i||s}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const _m="-transition",Hh=new Set(["fill","line","background","hillshade","raster"]);class Ks extends td{constructor(e,i,s,u,p,_){if(super(),this.id=e.id,this.fqid=vc(this.id,s),this.type=e.type,this.scope=s,this.lut=u,this.options=p,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const x=Fo(this.filter,bt[`filter_${e.type}`]);x.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...x.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||x.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Hu(i.layout,this.scope,p,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new sf(i.paint,this.scope,p);for(const x in e.paint)this.setPaintProperty(x,e.paint[x]);for(const x in e.layout)this.setLayoutProperty(x,e.layout[x]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Dd(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Hh.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((i=>{this.appearances.push(new mm(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(_m)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const s=this._transitionablePaint,u=s._properties.properties;if(e.endsWith(_m)){const B=e.slice(0,-11);return u[B]&&s.setTransition(B,i||void 0),!1}if(!u[e])return!1;const p=s._values[e],_=p.value.isDataDriven(),x=p.value;s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const E=s._values[e].value,C=E.isDataDriven(),k=e.endsWith("pattern")||e==="line-dasharray";return C||_||k||this._handleOverridablePaintPropertyUpdate(e,x,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),ti(e,((i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Jc&&Ln(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!yo(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Pd(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,s){return{}}queryRadius(e){}queryIntersectsFeature(e,i,s,u,p,_,x,E,C){}}const Ld={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cf{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Bm=new ArrayBuffer(0);class Ja{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,i){return e._trim(),i&&e.arrayBuffer&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,e.arrayBuffer?i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement:(i.capacity=0,i.arrayBuffer=Bm),i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Yr(r,e=1){let i=0,s=0;return{members:r.map((u=>{const p=Ld[u.type].BYTES_PER_ELEMENT,_=i=op(i,Math.max(e,p)),x=u.components||1;return s=Math.max(s,p),i+=p*x,{name:u.name,type:u.type,components:x,offset:_}})),size:op(i,Math.max(s,e)),alignment:e}}function op(r,e){return Math.ceil(r/e)*e}class uf extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,e}}uf.prototype.bytesPerElement=4,hi(uf,"StructArrayLayout2i4");class kd extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=u,e}}kd.prototype.bytesPerElement=6,hi(kd,"StructArrayLayout3i6");class hf extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=4*e;return this.int16[_+0]=i,this.int16[_+1]=s,this.int16[_+2]=u,this.int16[_+3]=p,e}}hf.prototype.bytesPerElement=8,hi(hf,"StructArrayLayout4i8");class qh extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}qh.prototype.bytesPerElement=4,hi(qh,"StructArrayLayout1f4");class kp extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=4*e,_=2*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.float32[_+1]=u,e}}kp.prototype.bytesPerElement=8,hi(kp,"StructArrayLayout2i1f8");class lp extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=u,e}}lp.prototype.bytesPerElement=8,hi(lp,"StructArrayLayout3i8");class Fp extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const x=5*e;return this.int16[x+0]=i,this.int16[x+1]=s,this.int16[x+2]=u,this.int16[x+3]=p,this.int16[x+4]=_,e}}Fp.prototype.bytesPerElement=10,hi(Fp,"StructArrayLayout5i10");class cp extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,x)}emplace(e,i,s,u,p,_,x,E){const C=6*e,k=12*e,B=3*e;return this.int16[C+0]=i,this.int16[C+1]=s,this.uint8[k+4]=u,this.uint8[k+5]=p,this.uint8[k+6]=_,this.uint8[k+7]=x,this.float32[B+2]=E,e}}cp.prototype.bytesPerElement=12,hi(cp,"StructArrayLayout2i4ub1f12");class xc extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=u,e}}xc.prototype.bytesPerElement=12,hi(xc,"StructArrayLayout3f12");class xo extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const x=6*e,E=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=s,this.uint16[x+2]=u,this.uint16[x+3]=p,this.float32[E+2]=_,e}}xo.prototype.bytesPerElement=12,hi(xo,"StructArrayLayout4ui1f12");class fh extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=4*e;return this.uint16[_+0]=i,this.uint16[_+1]=s,this.uint16[_+2]=u,this.uint16[_+3]=p,e}}fh.prototype.bytesPerElement=8,hi(fh,"StructArrayLayout4ui8");class df extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,u,p,_)}emplace(e,i,s,u,p,_,x){const E=6*e;return this.int16[E+0]=i,this.int16[E+1]=s,this.int16[E+2]=u,this.int16[E+3]=p,this.int16[E+4]=_,this.int16[E+5]=x,e}}df.prototype.bytesPerElement=12,hi(df,"StructArrayLayout6i12");class up extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,C,k,B,j){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,s,u,p,_,x,E,C,k,B,j)}emplace(e,i,s,u,p,_,x,E,C,k,B,j,U){const $=12*e;return this.int16[$+0]=i,this.int16[$+1]=s,this.int16[$+2]=u,this.int16[$+3]=p,this.uint16[$+4]=_,this.uint16[$+5]=x,this.uint16[$+6]=E,this.uint16[$+7]=C,this.int16[$+8]=k,this.int16[$+9]=B,this.int16[$+10]=j,this.int16[$+11]=U,e}}up.prototype.bytesPerElement=24,hi(up,"StructArrayLayout4i4ui4i24");class Op extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,u,p,_)}emplace(e,i,s,u,p,_,x){const E=10*e,C=5*e;return this.int16[E+0]=i,this.int16[E+1]=s,this.int16[E+2]=u,this.float32[C+2]=p,this.float32[C+3]=_,this.float32[C+4]=x,e}}Op.prototype.bytesPerElement=20,hi(Op,"StructArrayLayout3i3f20");class Fd extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=4*e;return this.float32[_+0]=i,this.float32[_+1]=s,this.float32[_+2]=u,this.float32[_+3]=p,e}}Fd.prototype.bytesPerElement=16,hi(Fd,"StructArrayLayout4f16");class ff extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}ff.prototype.bytesPerElement=4,hi(ff,"StructArrayLayout1ul4");class wu extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,e}}wu.prototype.bytesPerElement=4,hi(wu,"StructArrayLayout2ui4");class hp extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,C,k,B,j,U){const $=this.length;return this.resize($+1),this.emplace($,e,i,s,u,p,_,x,E,C,k,B,j,U)}emplace(e,i,s,u,p,_,x,E,C,k,B,j,U,$){const ee=20*e,le=10*e;return this.int16[ee+0]=i,this.int16[ee+1]=s,this.int16[ee+2]=u,this.int16[ee+3]=p,this.int16[ee+4]=_,this.float32[le+3]=x,this.float32[le+4]=E,this.float32[le+5]=C,this.float32[le+6]=k,this.int16[ee+14]=B,this.uint32[le+8]=j,this.uint16[ee+18]=U,this.uint16[ee+19]=$,e}}hp.prototype.bytesPerElement=40,hi(hp,"StructArrayLayout5i4f1i1ul2ui40");class dp extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,x)}emplace(e,i,s,u,p,_,x,E){const C=8*e;return this.int16[C+0]=i,this.int16[C+1]=s,this.int16[C+2]=u,this.int16[C+4]=p,this.int16[C+5]=_,this.int16[C+6]=x,this.int16[C+7]=E,e}}dp.prototype.bytesPerElement=16,hi(dp,"StructArrayLayout3i2i2i16");class Lf extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const x=4*e,E=8*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=u,this.int16[E+6]=p,this.int16[E+7]=_,e}}Lf.prototype.bytesPerElement=16,hi(Lf,"StructArrayLayout2f1f2i16");class $h extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,u,p,_)}emplace(e,i,s,u,p,_,x){const E=20*e,C=5*e;return this.uint8[E+0]=i,this.uint8[E+1]=s,this.float32[C+1]=u,this.float32[C+2]=p,this.float32[C+3]=_,this.float32[C+4]=x,e}}$h.prototype.bytesPerElement=20,hi($h,"StructArrayLayout2ub4f20");class co extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=u,e}}co.prototype.bytesPerElement=6,hi(co,"StructArrayLayout3ui6");class kf extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye,xe,Ie,$e){const je=this.length;return this.resize(je+1),this.emplace(je,e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye,xe,Ie,$e)}emplace(e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye,xe,Ie,$e,je){const Ye=30*e,st=15*e,ut=60*e;return this.int16[Ye+0]=i,this.int16[Ye+1]=s,this.int16[Ye+2]=u,this.float32[st+2]=p,this.float32[st+3]=_,this.uint16[Ye+8]=x,this.uint16[Ye+9]=E,this.uint32[st+5]=C,this.uint32[st+6]=k,this.uint32[st+7]=B,this.uint16[Ye+16]=j,this.uint16[Ye+17]=U,this.uint16[Ye+18]=$,this.float32[st+10]=ee,this.float32[st+11]=le,this.uint8[ut+48]=oe,this.uint8[ut+49]=ye,this.uint8[ut+50]=xe,this.uint32[st+13]=Ie,this.int16[Ye+28]=$e,this.uint8[ut+58]=je,e}}kf.prototype.bytesPerElement=60,hi(kf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Od extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye,xe,Ie,$e,je,Ye,st,ut,Ut,_t,Wt,ni,ri,wi,Si,gi){const yi=this.length;return this.resize(yi+1),this.emplace(yi,e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye,xe,Ie,$e,je,Ye,st,ut,Ut,_t,Wt,ni,ri,wi,Si,gi)}emplace(e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye,xe,Ie,$e,je,Ye,st,ut,Ut,_t,Wt,ni,ri,wi,Si,gi,yi){const Zt=20*e,qt=40*e,vi=80*e;return this.float32[Zt+0]=i,this.float32[Zt+1]=s,this.int16[qt+4]=u,this.int16[qt+5]=p,this.int16[qt+6]=_,this.int16[qt+7]=x,this.int16[qt+8]=E,this.int16[qt+9]=C,this.int16[qt+10]=k,this.int16[qt+11]=B,this.int16[qt+12]=j,this.uint16[qt+13]=U,this.uint16[qt+14]=$,this.uint16[qt+15]=ee,this.uint16[qt+16]=le,this.uint16[qt+17]=oe,this.uint16[qt+18]=ye,this.uint16[qt+19]=xe,this.uint16[qt+20]=Ie,this.uint16[qt+21]=$e,this.uint16[qt+22]=je,this.uint16[qt+23]=Ye,this.uint16[qt+24]=st,this.uint16[qt+25]=ut,this.uint16[qt+26]=Ut,this.uint16[qt+27]=_t,this.uint32[Zt+14]=Wt,this.float32[Zt+15]=ni,this.float32[Zt+16]=ri,this.float32[Zt+17]=wi,this.float32[Zt+18]=Si,this.uint8[vi+76]=gi,this.uint16[qt+39]=yi,e}}Od.prototype.bytesPerElement=80,hi(Od,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class gm extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,s,u,p,_)}emplace(e,i,s,u,p,_,x){const E=6*e;return this.float32[E+0]=i,this.float32[E+1]=s,this.float32[E+2]=u,this.float32[E+3]=p,this.float32[E+4]=_,this.float32[E+5]=x,e}}gm.prototype.bytesPerElement=24,hi(gm,"StructArrayLayout6f24");class pf extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=s,this.float32[x+2]=u,this.float32[x+3]=p,this.float32[x+4]=_,e}}pf.prototype.bytesPerElement=20,hi(pf,"StructArrayLayout5f20");class ym extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,x)}emplace(e,i,s,u,p,_,x,E){const C=7*e;return this.float32[C+0]=i,this.float32[C+1]=s,this.float32[C+2]=u,this.float32[C+3]=p,this.float32[C+4]=_,this.float32[C+5]=x,this.float32[C+6]=E,e}}ym.prototype.bytesPerElement=28,hi(ym,"StructArrayLayout7f28");class fp extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,C,k,B){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,s,u,p,_,x,E,C,k,B)}emplace(e,i,s,u,p,_,x,E,C,k,B,j){const U=11*e;return this.float32[U+0]=i,this.float32[U+1]=s,this.float32[U+2]=u,this.float32[U+3]=p,this.float32[U+4]=_,this.float32[U+5]=x,this.float32[U+6]=E,this.float32[U+7]=C,this.float32[U+8]=k,this.float32[U+9]=B,this.float32[U+10]=j,e}}fp.prototype.bytesPerElement=44,hi(fp,"StructArrayLayout11f44");class Ff extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,s,u,p,_,x,E,C)}emplace(e,i,s,u,p,_,x,E,C,k){const B=9*e;return this.float32[B+0]=i,this.float32[B+1]=s,this.float32[B+2]=u,this.float32[B+3]=p,this.float32[B+4]=_,this.float32[B+5]=x,this.float32[B+6]=E,this.float32[B+7]=C,this.float32[B+8]=k,e}}Ff.prototype.bytesPerElement=36,hi(Ff,"StructArrayLayout9f36");class Tu extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=s,e}}Tu.prototype.bytesPerElement=8,hi(Tu,"StructArrayLayout2f8");class Fc extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=6*e;return this.uint32[3*e+0]=i,this.uint16[_+2]=s,this.uint16[_+3]=u,this.uint16[_+4]=p,e}}Fc.prototype.bytesPerElement=12,hi(Fc,"StructArrayLayout1ul3ui12");class Su extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Su.prototype.bytesPerElement=2,hi(Su,"StructArrayLayout1ui2");class Nm extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le)}emplace(e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe){const ye=16*e;return this.float32[ye+0]=i,this.float32[ye+1]=s,this.float32[ye+2]=u,this.float32[ye+3]=p,this.float32[ye+4]=_,this.float32[ye+5]=x,this.float32[ye+6]=E,this.float32[ye+7]=C,this.float32[ye+8]=k,this.float32[ye+9]=B,this.float32[ye+10]=j,this.float32[ye+11]=U,this.float32[ye+12]=$,this.float32[ye+13]=ee,this.float32[ye+14]=le,this.float32[ye+15]=oe,e}}Nm.prototype.bytesPerElement=64,hi(Nm,"StructArrayLayout16f64");class bo extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,x){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,x)}emplace(e,i,s,u,p,_,x,E){const C=10*e,k=5*e;return this.uint16[C+0]=i,this.uint16[C+1]=s,this.uint16[C+2]=u,this.uint16[C+3]=p,this.float32[k+2]=_,this.float32[k+3]=x,this.float32[k+4]=E,e}}bo.prototype.bytesPerElement=20,hi(bo,"StructArrayLayout4ui3f20");class Oo extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Oo.prototype.bytesPerElement=2,hi(Oo,"StructArrayLayout1i2");class hl extends Ja{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}hl.prototype.bytesPerElement=1,hi(hl,"StructArrayLayout1ub1");class mf extends cf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}mf.prototype.size=40;class pp extends hp{get(e){return new mf(this,e)}}hi(pp,"CollisionBoxArray");class Bd extends cf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Bd.prototype.size=60;class vm extends kf{get(e){return new Bd(this,e)}}hi(vm,"PlacedSymbolArray");class Of extends cf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Of.prototype.size=80;class _f extends Od{get(e){return new Of(this,e)}}hi(_f,"SymbolInstanceArray");class Nd extends qh{getoffsetX(e){return this.float32[1*e+0]}}hi(Nd,"GlyphOffsetArray");class Bp extends uf{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}hi(Bp,"SymbolLineVertexArray");class Np extends cf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Np.prototype.size=12;class gf extends Fc{get(e){return new Np(this,e)}}hi(gf,"FeatureIndexArray");class jp extends wu{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}hi(jp,"FillExtrusionCentroidArray");class mp extends cf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}mp.prototype.size=6;class _p extends kd{get(e){return new mp(this,e)}}hi(_p,"FillExtrusionWallArray");const jm=Yr([{name:"a_pos",components:2,type:"Int16"}],4),Vm=Yr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),xm=Yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ss{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,u){let p=this.segments[this.segments.length-1];return e>Ss.MAX_VERTEX_ARRAY_LENGTH&&ji(`Max vertices per segment is ${Ss.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Ss.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}prepareSegment(e,i,s,u){return this._prepareSegment(e,i.length,s.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,u){return new Ss([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}function ph(r,e){return 256*(r=te(Math.floor(r),0,255))+te(Math.floor(e),0,255)}Ss.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,hi(Ss,"SegmentVector");const Um=Yr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vp=Yr([{name:"a_pattern_b",components:4,type:"Uint16"}]),yf=Yr([{name:"a_dash",components:4,type:"Uint16"}]);class gp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,u){this.ids.push(Up(e)),this.positions.push(i,s,u)}eachPosition(e,i){const s=Up(e);let u=0,p=this.ids.length-1;for(;u<p;){const _=u+p>>1;this.ids[_]>=s?p=_:u=_+1}for(;this.ids[u]===s;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return bm(s,u,0,s.length-1),i&&(i.add(s.buffer),i.add(u.buffer)),{ids:s,positions:u}}static deserialize(e){const i=new gp;let s;i.ids=e.ids,i.positions=e.positions;for(const u of i.ids)u!==s&&i.uniqueIds.push(u),s=u;return i.indexed=!0,i}}function Up(r){const e=+r;return Number.isSafeInteger(e)?e:ss(String(r))}function bm(r,e,i,s){for(;i<s;){const u=r[i+s>>1];let p=i-1,_=s+1;for(;;){do p++;while(r[p]<u);do _--;while(r[_]>u);if(p>=_)break;$u(r,p,_),$u(e,3*p,3*_),$u(e,3*p+1,3*_+1),$u(e,3*p+2,3*_+2)}_-i<s-_?(bm(r,e,i,_),i=_+1):(bm(r,e,_+1,s),s=_)}}function $u(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}hi(gp,"FeaturePositionMap");class mh{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class wm extends mh{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Bo extends mh{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class Ql extends mh{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Bf extends mh{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Nf extends mh{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class _h extends mh{constructor(e){super(e),this.current=Ia.transparent.toPremultipliedRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const jf=new Float32Array(16);class uo extends mh{constructor(e){super(e),this.current=jf}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let u=1;u<16;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const Tm=new Float32Array(9),h_=new Float32Array(4);class Gp extends mh{constructor(e){super(e),this.current=h_}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function Vf(r){return[ph(255*r.r,255*r.g),ph(255*r.b,255*r.a)]}function Oc(r,e,i,s,u,p,_,x){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Ka(0,{brightness:p,worldview:x}),e,i,u,s,_)==="none":r.value==="none")}class Uf{constructor(e,i,s,u){this.value=e,this.uniformNames=i.map((p=>`u_${p}`)),this.type=s,this.context=u}setUniform(e,i,s,u,p){const _=u.constantOr(this.value);i.set(e,p,_ instanceof Ia?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,i){return this.type==="color"?new _h(e):new Bo(e)}}class Gf{constructor(e,i){this.uniformNames=i.map((s=>`u_${s}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,s,u,p){let _=null;p!=="u_pattern"&&p!=="u_dash"||(_=this.pattern),p==="u_pattern_b"&&(_=this.patternTransition),p==="u_pixel_ratio"&&(_=this.pixelRatio),_&&i.set(e,p,_)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Nf(e):new Bo(e)}}class Zu{constructor(e,i,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map((p=>({name:`a_${p}`,type:"Float32",components:s==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,s,u,p,_,x,E){const C=this.paintVertexArray.length,k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Ka(0,{brightness:_,worldview:E}),i,{},p,u,x):this.expression.kind==="constant"&&this.expression.value,B=Oc(this.lutExpression,i,{},u,p,_,x,E);this.paintVertexArray.resize(e),this._setPaintValue(C,e,k,B?null:this.context.lut)}updatePaintArray(e,i,s,u,p,_,x,E){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:E},s,u,void 0,p):this.expression.kind==="constant"&&this.expression.value,k=Oc(this.lutExpression,s,u,p,void 0,x,void 0,E);this._setPaintValue(e,i,C,k?null:this.context.lut)}_setPaintValue(e,i,s,u){if(this.type==="color"){const p=Vf(s.toPremultipliedRenderColor(u));for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ec{constructor(e,i,s,u,p,_){this.expression=e,this.uniformNames=i.map((x=>`u_${x}_t`)),this.type=s,this.useIntegerZoom=u,this.context=p,this.maxValue=0,this.paintVertexAttributes=i.map((x=>({name:`a_${x}`,type:"Float32",components:s==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(e,i,s,u,p,_,x,E){const C=this.expression.evaluate(new Ka(this.context.zoom,{brightness:_,worldview:E}),i,{},p,u,x),k=this.expression.evaluate(new Ka(this.context.zoom+1,{brightness:_,worldview:E}),i,{},p,u,x),B=Oc(this.lutExpression,i,{},u,p,_,x,E),j=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(j,e,C,k,B?null:this.context.lut)}updatePaintArray(e,i,s,u,p,_,x,E){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:E},s,u,void 0,p),k=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:E},s,u,void 0,p),B=Oc(this.lutExpression,s,u,p,void 0,x,void 0,E);this._setPaintValue(e,i,C,k,B?null:this.context.lut)}_setPaintValue(e,i,s,u,p){if(this.type==="color"){const _=Vf(s.toPremultipliedRenderColor(p)),x=Vf(s.toPremultipliedRenderColor(p));for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,_[0],_[1],x[0],x[1])}else{for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,u,p){const _=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,x=te(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);i.set(e,p,x)}getBinding(e,i){return new Bo(e)}}class yd{constructor(e,i,s,u,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(s==="array"?yf:Um).members;for(let _=0;_<i.length;++_);this.paintVertexArray=new u,this.paintTransitionVertexArray=new fh}populatePaintArray(e,i,s,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,u,p,_,x){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],_)}_setPaintValues(e,i,s,u){if(!u||!s)return;const p=u[s[0]],_=u[s[1]];if(p){if(p){const{tl:x,br:E,pixelRatio:C}=p;for(let k=e;k<i;k++)this.paintVertexArray.emplace(k,x[0],x[1],E[0],E[1],C)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:E}=_;for(let C=e;C<i;C++)this.paintTransitionVertexArray.emplace(C,x[0],x[1],E[0],E[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Vp.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class vd{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const u=[];for(const p in e.paint._values){const _=e.paint.get(p);if(p.endsWith("-use-theme")||!s(p)||!(_ instanceof Jc&&Ln(_.property.specification)))continue;const x=Hp(p,e.type),E=_.value,C=_.property.specification.type,k=!!_.property.useIntegerZoom,B=p==="line-dasharray"||p.endsWith("pattern"),j=e.paint.get(`${p}-use-theme`),U=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||j&&j.value.kind!=="constant";if(E.kind!=="constant"||U)if(E.kind==="source"||U||B){const $=yh(p,C,"source");this.binders[p]=B?new yd(E,x,C,$,e.id):new Zu(E,x,C,$),u.push(`/a_${p}`)}else{const $=yh(p,C,"composite");this.binders[p]=new ec(E,x,C,k,i,$),u.push(`/z_${p}`)}else this.binders[p]=B?new Gf(E.value,x):new Uf(E.value,x,C,i),u.push(`/u_${p}`);j&&(this.binders[p].lutExpression=j.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Zu||i instanceof ec?i.maxValue:0}populatePaintArrays(e,i,s,u,p,_,x,E){for(const C in this.binders){const k=this.binders[C];k.context=this.context,(k instanceof Zu||k instanceof ec||k instanceof yd)&&k.populatePaintArray(e,i,s,u,p,_,x,E)}}setConstantPatternPositions(e,i){for(const s in this.binders){const u=this.binders[s];u instanceof Gf&&u.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof yd?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,s,u,p,_,x,E,C,k){let B=!1;const j=Object.keys(e),U=j.length!==0&&!E,$=U?j:i.uniqueIds;this.context.lut=p.lut;for(const ee in this.binders){const le=this.binders[ee];if(le.context=this.context,(le instanceof Zu||le instanceof ec||le instanceof yd)&&le.expression&&le.expression.kind&&le.expression.kind!=="constant"&&(le.expression.isStateDependent===!0||le.expression.isLightConstant===!1)){const oe=p.paint.get(ee);le.expression=oe.value;for(const ye of $){const xe=e[ye.toString()];i.eachPosition(ye,((Ie,$e,je)=>{const Ye=u.feature(Ie);le.updatePaintArray($e,je,Ye,xe,_,x,C,k)}))}if(!U)for(const ye of s.uniqueIds){const xe=e[ye.toString()];s.eachPosition(ye,((Ie,$e,je)=>{const Ye=u.feature(Ie);le.updatePaintArray($e,je,Ye,xe,_,x,C,k)}))}B=!0}}return B}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof Uf||s instanceof Gf)&&e.push(...s.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof Uf||u instanceof Gf||u instanceof ec)for(const p of u.uniformNames)i.push({name:p,property:s,binding:u.getBinding(e,p)})}return i}setUniforms(e,i,s,u,p){for(const{name:_,property:x,binding:E}of s)this.binders[x].setUniform(e,E,p,u.get(x),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Zu||i instanceof ec||i instanceof yd)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof yd&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Zu||s instanceof ec||s instanceof yd)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Zu||i instanceof ec||i instanceof yd)&&i.destroy()}}}class gh{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new vd(u,i,s);this.needsUpload=!1,this._featureMap=new gp,this._featureMapWithoutIds=new gp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,u,p,_,x,E,C){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(e,i,u,p,_,x,E,C);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,u,p,_,x,E){for(const C of s)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,C,u,p,_,x||0,E)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Sm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Hp(r,e){return Sm[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const qp={"line-pattern":{source:xo,composite:xo},"fill-pattern":{source:xo,composite:xo},"fill-extrusion-pattern":{source:xo,composite:xo},"line-dasharray":{source:fh,composite:fh}},Gm={color:{source:Tu,composite:Fd},number:{source:qh,composite:Tu}};function yh(r,e,i){const s=qp[r];return s&&s[i]||Gm[e][i]}hi(Uf,"ConstantBinder"),hi(Gf,"PatternConstantBinder"),hi(Zu,"SourceExpressionBinder"),hi(yd,"PatternCompositeBinder"),hi(ec,"CompositeExpressionBinder"),hi(vd,"ProgramConfiguration",{omit:["_buffers"]}),hi(gh,"ProgramConfigurationSet");const ys=pi/Math.PI/2,bc=5,$p=6,jl=16383,yp=64,Em=[yp,32,16],Wu=-ys,Es=ys;function bl(r,e,i,s=ys){return i=fi(i),[r*Math.sin(i)*s,-e*s,r*Math.cos(i)*s]}function Eu(r,e,i){return bl(Math.cos(fi(r)),Math.sin(fi(r)),e,i)}const h=63710088e-1,t=2*Math.PI*h;class a{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new a(Re(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,u=e.lat*i,p=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return h*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new d({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return Eu(this.lat,this.lng,ys+e*ys/h)}static convert(e){if(e instanceof a)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new a(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new a(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class d{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof a?new a(e.lng,e.lat):a.convert(e),this}setSouthWest(e){return this._sw=e instanceof a?new a(e.lng,e.lat):a.convert(e),this}extend(e){const i=this._sw,s=this._ne;let u,p;if(e instanceof a)u=e,p=e;else{if(!(e instanceof d))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(d.convert(e)):this.extend(a.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(a.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return i||s?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new a(u.lng,u.lat),this._ne=new a(p.lng,p.lat)),this}getCenter(){return new a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a(this.getWest(),this.getNorth())}getSouthEast(){return new a(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=a.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){if(e)return e instanceof d?e:new d(e)}}const y=0,b=25.5;function S(r){return t*Math.cos(r*Math.PI/180)}function I(r){return(180+r)/360}function D(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function N(r,e){return r/S(e)}function V(r){return 360*r-180}function K(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function X(r,e){return r*S(K(e))}const Q=85.051129;function ae(r){return Math.cos(fi(te(r,-Q,Q)))}function ie(r,e){const i=te(e,y,b),s=Math.pow(2,i);return ae(r)*t/(512*s)}function ge(r){return 1/Math.cos(r*Math.PI/180)}function me(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/pi)/(1<<r.z)*2));return 80150034*i/(i*i+1)/pi/(1<<r.z)}class Se{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=a.convert(e);return new Se(I(s.lng),D(s.lat),N(i,s.lat))}toLngLat(){return new a(V(this.x),K(this.y))}toAltitude(){return X(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/t*ge(K(this.y))}}function De(r,e,i,s,u,p,_,x,E){const C=(e+s)/2,k=(i+u)/2,B=new Ge(C,k);x(B),(function(j,U,$,ee,le,oe){const ye=$-le,xe=ee-oe;return Math.abs((ee-U)*ye-($-j)*xe)/Math.hypot(ye,xe)})(B.x,B.y,p.x,p.y,_.x,_.y)>=E?(De(r,e,i,C,k,p,B,x,E),De(r,C,k,s,u,B,_,x,E)):r.push(_)}function Ee(r,e,i){let s=r[0],u=s.x,p=s.y;e(s);const _=[s];for(let x=1;x<r.length;x++){const E=r[x],{x:C,y:k}=E;e(E),De(_,u,p,C,k,s,E,e,i),u=C,p=k,s=E}return _}function We(r,e,i,s){if(s(e,i)){const u=e.add(i)._mult(.5);We(r,e,u,s),We(r,u,i,s)}else r.push(i)}function Ve(r,e){let i=r[0];const s=[i];for(let u=1;u<r.length;u++){const p=r[u];We(s,i,p,e),i=p}return s}const He=Math.pow(2,14)-1,Ne=-He-1;function Oe(r,e){const i=Math.round(r.x*e),s=Math.round(r.y*e);return r.x=te(i,Ne,He),r.y=te(s,Ne,He),(i<r.x||i>r.x+1||s<r.y||s>r.y+1)&&ji("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function nt(r,e,i){const s=r.loadGeometry(),u=r.extent,p=pi/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:x,x:E,y:C,projection:k}=i,B=j=>{const U=V((e.x+j.x/u)/_),$=K((e.y+j.y/u)/_),ee=k.project(U,$);j.x=(ee.x*x-E)*u,j.y=(ee.y*x-C)*u};for(let j=0;j<s.length;j++)if(r.type!==1)s[j]=Ee(s[j],B,1);else{const U=[];for(const $ of s[j])$.x<0||$.x>=u||$.y<0||$.y>=u||(B($),U.push($));s[j]=U}}for(const _ of s)for(const x of _)Oe(x,p);return s}function mt(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?nt(r):[]}}class dt{constructor(e,i,s,u,p){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=p,e.readFields(At,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,s=[];let u,p=1,_=0,x=0,E=0;for(;e.pos<i;){if(_<=0){const C=e.readVarint();p=7&C,_=C>>3}if(_--,p===1||p===2)x+=e.readSVarint(),E+=e.readSVarint(),p===1&&(u&&s.push(u),u=[]),u&&u.push(new Ge(x,E));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&s.push(u),s}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let s=1,u=0,p=0,_=0,x=1/0,E=-1/0,C=1/0,k=-1/0;for(;e.pos<i;){if(u<=0){const B=e.readVarint();s=7&B,u=B>>3}if(u--,s===1||s===2)p+=e.readSVarint(),_+=e.readSVarint(),p<x&&(x=p),p>E&&(E=p),_<C&&(C=_),_>k&&(k=_);else if(s!==7)throw new Error(`unknown command ${s}`)}return[x,C,E,k]}toGeoJSON(e,i,s){const u=this.extent*Math.pow(2,s),p=this.extent*e,_=this.extent*i,x=this.loadGeometry();function E(j){return[360*(j.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(j.y+_)/u)*Math.PI))-90]}function C(j){return j.map(E)}let k;if(this.type===1){const j=[];for(const $ of x)j.push($[0]);const U=C(j);k=j.length===1?{type:"Point",coordinates:U[0]}:{type:"MultiPoint",coordinates:U}}else if(this.type===2){const j=x.map(C);k=j.length===1?{type:"LineString",coordinates:j[0]}:{type:"MultiLineString",coordinates:j}}else{if(this.type!==3)throw new Error("unknown feature type");{const j=(function($){const ee=$.length;if(ee<=1)return[$];const le=[];let oe,ye;for(let xe=0;xe<ee;xe++){const Ie=Ct($[xe]);Ie!==0&&(ye===void 0&&(ye=Ie<0),ye===Ie<0?(oe&&le.push(oe),oe=[$[xe]]):oe&&oe.push($[xe]))}return oe&&le.push(oe),le})(x),U=[];for(const $ of j)U.push($.map(C));k=U.length===1?{type:"Polygon",coordinates:U[0]}:{type:"MultiPolygon",coordinates:U}}}const B={type:"Feature",geometry:k,properties:this.properties};return this.id!=null&&(B.id=this.id),B}}function At(r,e,i){r===1?e.id=i.readVarint():r===2?(function(s,u){const p=s.readVarint()+s.pos;for(;s.pos<p;){const _=u._keys[s.readVarint()],x=u._values[s.readVarint()];u.properties[_]=x}})(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function Ct(r){let e=0;for(let i,s,u=0,p=r.length,_=p-1;u<p;_=u++)i=r[u],s=r[_],e+=(s.x-i.x)*(i.y+s.y);return e}dt.types=["Unknown","Point","LineString","Polygon"];class Dt{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Kt,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new dt(this._pbf,i,this.extent,this._keys,this._values)}}function Kt(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push((function(s){let u=null;const p=s.readVarint()+s.pos;for(;s.pos<p;){const _=s.readVarint()>>3;u=_===1?s.readString():_===2?s.readFloat():_===3?s.readDouble():_===4?s.readVarint64():_===5?s.readVarint():_===6?s.readSVarint():_===7?s.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class vt{constructor(e,i){this.layers=e.readFields(rt,{},i)}}function rt(r,e,i){if(r===3){const s=new Dt(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}const Nt="3d_elevation_id",Lt="level";class li{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,s){return this.get(e,!0,i,s)}optional(e,i,s){return this.get(e,!1,i,s)}success(){return this._valid}get(e,i,s,u){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?s(u?u(p):p):i&&(this._valid=!1),this}}class Mi{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,s){return this.featureFunc(e,i,s)}parseVertex(e,i,s){return this.vertexFunc(e,i,s)}}const ki=new Mi(((r,e,i)=>r.reset(e).require(Nt,(s=>{i.id=s})).optional("fixed_height_relative",(s=>{i.constantHeight=s}),_i.decodeRelativeHeight).geometry((s=>{i.bounds=s}),Pc).success()),((r,e,i)=>r.reset(e).require(Nt,(s=>{i.id=s})).require("elevation_idx",(s=>{i.idx=s})).require("extent",(s=>{i.extent=s})).require("height_relative",(s=>{i.height=s}),_i.decodeRelativeHeight).geometry((s=>{i.position=s}),_i.getPoint).success())),Ei=new Mi(((r,e,i)=>r.reset(e).require(Nt,(s=>{i.id=s})).optional("fixed_height",(s=>{i.constantHeight=s}),_i.decodeMetricHeight).geometry((s=>{i.bounds=s}),Pc).success()),((r,e,i)=>r.reset(e).require(Nt,(s=>{i.id=s})).require("elevation_idx",(s=>{i.idx=s})).require("extent",(s=>{i.extent=s})).require("height",(s=>{i.height=s}),_i.decodeMetricHeight).geometry((s=>{i.position=s}),_i.getPoint).success()));class _i{static getPoint(e){return sr(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Ei:void 0:ki}static parse(e){const i=[],s=[],u=e.length,p=new li;for(let _=0;_<u;_++){const x=e.feature(_),E=x.properties.version,C=_i.getVersionSchema(E);if(C===void 0){ji(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const k=x.properties.type;if(!k)continue;const B=dt.types[x.type];if(B==="Point"&&k==="curve_point"){const j={};C.parseVertex(p,x,j)&&i.push(j)}else if(B==="Polygon"&&k==="curve_meta"){const j={};C.parseFeature(p,x,j)&&s.push(j)}}return{vertices:i,features:s}}}class fn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const u=cl(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/u;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,!0}}class nn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const u=Lr(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,s){if((function(U,$){var ee=U[0],le=U[1],oe=U[2],ye=$[0],xe=$[1],Ie=$[2];return Math.abs(ee-ye)<=ke*Math.max(1,Math.abs(ee),Math.abs(ye))&&Math.abs(le-xe)<=ke*Math.max(1,Math.abs(le),Math.abs(xe))&&Math.abs(oe-Ie)<=ke*Math.max(1,Math.abs(oe),Math.abs(Ie))})(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[u,p,_]=this.dir,x=this.pos[0]-e[0],E=this.pos[1]-e[1],C=this.pos[2]-e[2],k=u*u+p*p+_*_,B=2*(x*u+E*p+C*_),j=B*B-4*k*(x*x+E*E+C*C-i*i);if(j<0){const U=Math.max(-B/2,0),$=x+u*U,ee=E+p*U,le=C+_*U,oe=Math.hypot($,ee,le);return s[0]=$*i/oe,s[1]=ee*i/oe,s[2]=le*i/oe,!1}{const U=(-B-Math.sqrt(j))/(2*k);if(U<0){const $=Math.hypot(x,E,C);return s[0]=x*i/$,s[1]=E*i/$,s[2]=C*i/$,!1}return s[0]=x+u*U,s[1]=E+p*U,s[2]=C+_*U,!0}}}class $i{constructor(e,i,s,u,p){this.TL=e,this.TR=i,this.BR=s,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(e,i,s){const u=[-1,1,1],p=[1,1,1],_=[1,-1,1],x=[-1,-1,1],E=Kr(u,u,e),C=Kr(p,p,e),k=Kr(_,_,e),B=Kr(x,x,e);return new $i(E,C,k,B,i/s)}}function en(r,e,i){let s=1/0,u=-1/0;const p=[];for(const _ of r){Ir(p,_,e);const x=Lr(p,i);s=Math.min(s,x),u=Math.max(u,x)}return[s,u]}function bn(r,e){let i=!0;for(let s=0;s<r.planes.length;s++){const u=r.planes[s];let p=0;for(let _=0;_<e.length;_++)p+=+(Lr(u,e[_])+u[3]>=0);if(p===0)return 0;p!==e.length&&(i=!1)}return i?2:1}function ar(r,e){for(const i of r.projections){const s=en(e,r.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function jr(r,e){let i=0;const s=[0,0,0,0];for(let _=0;_<r.length;_++)s[0]=r[_][0],s[1]=r[_][1],s[2]=r[_][2],s[3]=1,(u=s)[0]*(p=e)[0]+u[1]*p[1]+u[2]*p[2]+u[3]*p[3]>=0&&i++;var u,p;return i}class Ea{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=_n.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ir([],this.points[2],this.points[3]),Ir([],this.points[0],this.points[3]),Ir([],this.points[4],this.points[0]),Ir([],this.points[5],this.points[1]),Ir([],this.points[6],this.points[2]),Ir([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const u=[0,-s[2],s[1]],p=[s[2],0,-s[0]];this.projections.push({axis:u,projection:en(this.points,this.points[0],u)}),this.projections.push({axis:p,projection:en(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,i,s,u){const p=Math.pow(2,s),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((C=>{const k=Mr([],C,e),B=1/k[3]/i*p;return(j=k)[0]=(U=k)[0]*($=[B,B,u?1/k[3]:B,B])[0],j[1]=U[1]*$[1],j[2]=U[2]*$[2],j[3]=U[3]*$[3],j;var j,U,$})),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((C=>{const k=In([],br([],Ir([],_[C[0]],_[C[1]]),Ir([],_[C[2]],_[C[1]]))),B=-Lr(k,_[C[1]]);return k.concat(B)})),E=[];for(let C=0;C<_.length;C++)E.push([_[C][0],_[C][1],_[C][2]]);return new Ea(E,x)}intersectsPrecise(e,i,s){for(let u=0;u<i.length;u++)if(!jr(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!jr(e,this.planes[u]))return 0;for(const u of s)for(const p of this.frustumEdges){const _=br([],u,p),x=Pr(_);if(x===0)continue;mi(_,_,1/x);const E=en(this.points,this.points[0],_),C=en(e,this.points[0],_);if(E[0]>C[1]||C[0]>E[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(Lr([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class _n{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)Et(i,i,u),di(s,s,u);return new _n(i,s)}static fromTileIdAndHeight(e,i,s){const u=1<<e.canonical.z,p=e.canonical.x,_=e.canonical.y;return new _n([p/u,_/u,i],[(p+1)/u,(_+1)/u,s])}static applyTransform(e,i){const s=e.getCorners();for(let u=0;u<s.length;++u)Kr(s[u],s[u],i);return _n.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],u=[...s];for(let p=0;p<3;p++)for(let _=0;_<3;_++){const x=i[4*_+p],E=x*e.min[_],C=x*e.max[_];s[p]+=Math.min(E,C),u[p]+=Math.max(E,C)}return new _n(s,u)}static projectAabbCorners(e,i){const s=e.getCorners();for(let u=0;u<s.length;++u)Kr(s[u],s[u],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=mi([],Tn([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=cr(this.min),u=cr(this.max);for(let p=0;p<i.length;p++)s[p]=i[p]?this.min[p]:this.center[p],u[p]=i[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new _n(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?bn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?bn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?ar(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?ar(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}hi(_n,"Aabb");class ca{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,s=i[1],u=-i[0],p=(e.extent+1)*this.metersToTile;return[new Ge(Math.trunc(e.position[0]+s*p),Math.trunc(e.position[1]+u*p)),new Ge(Math.trunc(e.position[0]-s*p),Math.trunc(e.position[1]-u*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Jn{constructor(e,i,s,u,p,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[er(),er(),er(),er(),er(),er(),er()],this.id=e,this.heightRange={min:s,max:s},this.safeArea=i,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=p,this.edges=this.edges.filter((x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((E=this.vertices[x.a].position)[0]===(C=this.vertices[x.b].position)[0]&&E[1]===C[1]);var E,C})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:sr(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const E=this.vertices[x.a].position,C=this.vertices[x.b].position,k=Jr(er(),C,E),B=Uo(k),j=pl(er(),k,1/B);this.edgeProps.push({vec:k,dir:j,len:B});const U=this.vertexProps[x.a].dir,$=this.vertexProps[x.b].dir;fl(U,U,j),fl($,$,j)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||oc(x.dir,x.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[s,u]=i;return Hn(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,u)}computeSlopeNormal(e,i){const s=this.getClosestEdge(e);if(!s)return si(0,0,1);const u=s[0],p=this.edges[u],_=this.edgeProps[u].vec,x=si(_[0],_[1],(this.vertices[p.b].height-this.vertices[p.a].height)*i),E=si(x[1],-x[0],0);br(E,E,x);const C=Pr(E);return C>0?mi(E,E,1/C):xi(E,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,s=Number.POSITIVE_INFINITY,u=0;const[p,_,x,E,C,k,B]=this._tmpVec2;Xs(B,e.x,e.y);const j=new fn(B,null);for(let U=0;U<this.edges.length;U++){const $=this.edges[U],ee=this.edgeProps[U].dir;j.dir=ee;const le=this.vertices[$.a].position,oe=this.vertices[$.b].position,ye=j.intersectsPlane(le,this.vertexProps[$.a].dir,p),xe=j.intersectsPlane(oe,this.vertexProps[$.b].dir,_);if(!ye||!xe)continue;Jr(x,_,p),Jr(E,B,p);const Ie=cl(x,x),$e=Ie>0?cl(E,x)/Ie:0,je=te($e,0,1),Ye=Math.abs(($e-je)*this.edgeProps[U].len);Jr(C,B,le),Xs(k,ee[1],-ee[0]);const st=Ye+Math.abs(cl(C,k));st<s&&(i=U,s=st,u=je)}return[i,u]}tessellate(e){const i=Wi(),s=Wi(),u=Wi(),p=Wi();for(let _=this.edges.length-1;_>=0;--_){const x=this.edges[_].a,E=this.edges[_].b,{position:C,height:k,extent:B}=this.vertices[x],{position:j,height:U,extent:$}=this.vertices[E],ee=this.vertexProps[x].dir,le=this.vertexProps[E].dir;if(xi(i,C[0]/e,C[1]/e,k),xi(s,j[0]/e,j[1]/e,U),xi(u,ee[1],-ee[0],0),mi(u,u,B),xi(p,le[1],-le[0],0),mi(p,p,$),this.distSqLines(si(i[0]+.5*u[0],i[1]+.5*u[1],i[2]+.5*u[2]),si(s[0]-.5*p[0],s[1]-.5*p[1],s[2]-.5*p[2]),si(i[0]-.5*u[0],i[1]-.5*u[1],i[2]-.5*u[2]),si(s[0]+.5*p[0],s[1]+.5*p[1],s[2]+.5*p[2]))<=.0025000000000000005)continue;const oe=this.vertices.length,ye=fl(er(),C,j);this.vertices.push({position:pl(ye,ye,.5),height:.5*(k+U),extent:.5*(B+$)});const xe=fl(er(),ee,le);this.vertexProps.push({dir:oc(xe,xe)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:x,b:oe}),this.edges.push({a:oe,b:E});const Ie=Jr(er(),this.vertices[oe].position,C),$e=Uo(Ie),je={vec:Ie,dir:pl(er(),Ie,1/$e),len:$e};this.edgeProps.push(je),this.edgeProps.push(je)}}distSqLines(e,i,s,u){const p=zn(Wi(),i,e),_=zn(Wi(),u,s),x=zn(Wi(),e,s),E=Lr(p,p),C=Lr(p,_),k=Lr(p,x),B=Lr(_,_),j=Lr(_,x),U=E*B-C*C;if(U===0)return vr(ma(p,s,u,Lr(x,_)/Lr(_,_)),e);const $=(E*j-C*k)/U;return vr(ma(p,e,i,(C*j-k*B)/U),ma(_,s,u,$))}}class xr{static parseFrom(e,i){const s=_i.parse(e);if(!s)return[];let{vertices:u,features:p}=s;const _=1/me(i);p.sort(((k,B)=>k.id-B.id)),u.sort(((k,B)=>k.id-B.id||k.idx-B.idx)),u=u.filter(((k,B,j)=>B===j.findIndex((U=>U.id===k.id&&U.idx===k.idx))));const x=new Array;let E=0;const C=u.length;for(const k of p){if(k.constantHeight){x.push(new Jn(k.id,k.bounds,k.constantHeight));continue}for(;E!==C&&u[E].id<k.id;)E++;if(E===C||u[E].id!==k.id)continue;const B=new Array,j=new Array,U=E;for(;E!==C&&u[E].id===k.id;){const $=u[E];if(B.push({position:$.position,height:$.height,extent:$.extent}),E!==U&&u[E-1].idx===$.idx-1){const ee=E-U;j.push({a:ee-1,b:ee})}E++}x.push(new Jn(k.id,k.bounds,void 0,B,j,_))}return x}static getElevationFeature(e,i){if(!i)return;const s=+e.properties[Nt];return Number.isNaN(s)?void 0:i.find((u=>u.id===s))}}class Zr{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*pi,this.yOffset=(e.y*this.zScale-i.y)*pi)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,s){const u=this.constantElevation(i,s);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),s))}computeBiasedHeight(e,i){return i<=0?e:e+i*_e(0,i,e>=0?e:Math.abs(.5*e))}}hi(Jn,"ElevationFeature");class ta{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new uf,this.indexArray=new co,this.segments=new Ss,this.programConfigurations=new gh(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new qh),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){const p=this.layers[0],_=[];let x=null;p.type==="circle"&&(x=p.layout.get("circle-sort-key"));for(const{feature:C,id:k,index:B,sourceLayerIndex:j}of e){const U=this.layers[0]._featureFilter.needGeometry,$=mt(C,U);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),$,s))continue;const ee=x?x.evaluate($,{},s):void 0,le={id:k,properties:C.properties,type:C.type,sourceLayerIndex:j,index:B,geometry:U?$.geometry:nt(C,s,u),patterns:{},sortKey:ee};_.push(le)}x&&_.sort(((C,k)=>C.sortKey-k.sortKey));let E=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new df,E=u.projection);for(const C of _){const{geometry:k,index:B,sourceLayerIndex:j}=C,U=e[B].feature;this.addFeature(C,k,B,i.availableImages,s,E,i.brightness,i.elevationFeatures),i.featureIndex.insert(U,k,B,j,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,s,u,p,_,x){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,jm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xm.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Vm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,s,u,p,_,x,E){let C;this.elevationMode!=="none"&&(C=xr.getElevationFeature(e,E));for(const k of i)for(const B of k){const j=B.x,U=B.y;if(j<0||j>=pi||U<0||U>=pi)continue;if(_){const le=_.projectTilePoint(j,U,p),oe=_.upVector(p,j,U);this.addGlobeExtVertex(le,oe),this.addGlobeExtVertex(le,oe),this.addGlobeExtVertex(le,oe),this.addGlobeExtVertex(le,oe)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ee=$.vertexLength;if(this.addCircleVertex(j,U,-1,-1),this.addCircleVertex(j,U,1,-1),this.addCircleVertex(j,U,1,1),this.addCircleVertex(j,U,-1,1),this.elevationMode!=="none"){const le=C?C.pointElevation(new Ge(j,U)):0;this.hasElevation=this.hasElevation||le!==0;for(let oe=0;oe<4;oe++)this.elevatedLayoutVertexArray.emplaceBack(le)}this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+2,ee+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,p,x,void 0,this.worldview)}addCircleVertex(e,i,s,u){this.layoutVertexArray.emplaceBack(2*e+(s+1)/2,2*i+(u+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Wr(r,e){for(let i=0;i<r.length;i++)if(Wa(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Wa(r,e[i]))return!0;return!!Za(r,e)}function _r(r,e,i){return!!Wa(r,e)||!!ga(e,r,i)}function Aa(r,e){if(r.length===1)return Ms(e,r[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let u=0;u<s.length;u++)if(Wa(r,s[u]))return!0}for(let i=0;i<r.length;i++)if(Ms(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Za(r,e[i]))return!0;return!1}function Hs(r,e,i){if(r.length>1){if(Za(r,e))return!0;for(let s=0;s<e.length;s++)if(ga(e[s],r,i))return!0}for(let s=0;s<r.length;s++)if(ga(r[s],e,i))return!0;return!1}function Za(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const s=r[i],u=r[i+1];for(let p=0;p<e.length-1;p++)if(ba(s,u,e[p],e[p+1]))return!0}return!1}function ba(r,e,i,s){return pr(r,i,s)!==pr(e,i,s)&&pr(r,e,i)!==pr(r,e,s)}function zr(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function yr(r,e,i,s){const u=zr(r,e,s),p=zr(r,e,i);if(Math.sign(u)===Math.sign(p))return;const _=zr(i,s,r),x=_+p-u;return Math.sign(_)!==Math.sign(x)?[_/(_-x),p/(p-u)]:void 0}function ga(r,e,i){const s=i*i;if(e.length===1)return r.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(As(r,e[u-1],e[u])<s)return!0;return!1}function As(r,e,i){const s=e.distSqr(i);if(s===0)return r.distSqr(e);const u=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/s;return r.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function Ms(r,e){let i,s,u,p=!1;for(let _=0;_<r.length;_++){i=r[_];for(let x=0,E=i.length-1;x<i.length;E=x++)s=i[x],u=i[E],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(p=!p)}return p}function Wa(r,e){let i=!1;for(let s=0,u=r.length-1;s<r.length;u=s++){const p=r[s],_=r[u];p.y>e.y!=_.y>e.y&&e.x<(_.x-p.x)*(e.y-p.y)/(_.y-p.y)+p.x&&(i=!i)}return i}function No(r,e,i,s,u){for(const _ of r)if(e<=_.x&&i<=_.y&&s>=_.x&&u>=_.y)return!0;const p=[new Ge(e,i),new Ge(e,u),new Ge(s,u),new Ge(s,i)];if(r.length>2){for(const _ of p)if(Wa(r,_))return!0}for(let _=0;_<r.length-1;_++)if(el(r[_],r[_+1],p))return!0;return!1}function el(r,e,i){const s=i[0],u=i[2];if(r.x<s.x&&e.x<s.x||r.x>u.x&&e.x>u.x||r.y<s.y&&e.y<s.y||r.y>u.y&&e.y>u.y)return!1;const p=pr(r,e,i[0]);return p!==pr(r,e,i[1])||p!==pr(r,e,i[2])||p!==pr(r,e,i[3])}function ho(r,e,i,s,u,p){let _=e.y-r.y,x=r.x-e.x;if(p=p||0){const E=_*_+x*x;if(E===0)return!0;const C=Math.sqrt(E);_/=C,x/=C}return!((i.x-r.x)*_+(i.y-r.y)*x-p<0||(s.x-r.x)*_+(s.y-r.y)*x-p<0||(u.x-r.x)*_+(u.y-r.y)*x-p<0)}function $o(r,e,i,s,u,p,_){return!(ho(r,e,s,u,p,_)||ho(e,i,s,u,p,_)||ho(i,r,s,u,p,_)||ho(s,u,r,e,i,_)||ho(u,p,r,e,i,_)||ho(p,s,r,e,i,_))}function Vl(r,e,i){const s=e.paint.get(r).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(r)}function dl(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function Qc(r,e,i,s,u){if(!e[0]&&!e[1])return r;const p=Ge.convert(e)._mult(u);i==="viewport"&&p._rotate(-s);const _=[];for(let x=0;x<r.length;x++)_.push(r[x].sub(p));return _}function Xu(r,e,i,s){const u=Ge.convert(r)._mult(s);return e==="viewport"&&u._rotate(-i),u}let tc,qs;function fo(r,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[r*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}hi(ta,"CircleBucket",{omit:["layers"]});class Ua{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Is(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const s=(function(p,_,x){var E=fo(256*p,256*(_=Math.pow(2,x)-_-1),x),C=fo(256*(p+1),256*(_+1),x);return E[0]+","+E[1]+","+C[0]+","+C[1]})(this.x,this.y,this.z),u=(function(p,_,x){let E,C="";for(let k=p;k>0;k--)E=1<<k-1,C+=(_&E?1:0)+(x&E?2:0);return C})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class $s{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Is(e,i.z,i.z,i.x,i.y)}}class Os{constructor(e,i,s,u,p){this.overscaledZ=e,this.wrap=i,this.canonical=new Ua(s,+u,+p),this.key=i===0&&e===s?this.canonical.key:Is(i,e,s,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Os(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Os(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Is(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Is(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Os(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new Os(i,this.wrap,i,s,u),new Os(i,this.wrap,i,s+1,u),new Os(i,this.wrap,i,s,u+1),new Os(i,this.wrap,i,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Os(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Os(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new $s(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Is(r,e,i,s,u){const p=1<<Math.min(i,22);let _=p*(u%p)+s%p;return r&&i<22&&(_+=p*p*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*_+i)+(e-i)}const ic=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new Os(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new Os(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new Os(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Os(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];hi(Ua,"CanonicalTileID"),hi(Os,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const jd=Yr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Yu}=jd,vf=Yr([{name:"a_pos_3",components:3,type:"Int16"}]);var Zh=Yr([{name:"a_pos",type:"Int16",components:2}]);function vh(r){return r*ys/h}const xh=[new _n([Wu,Wu,Wu],[Es,Es,Es]),new _n([Wu,Wu,Wu],[0,0,Es]),new _n([0,Wu,Wu],[Es,0,Es]),new _n([Wu,0,Wu],[0,Es,Es]),new _n([0,0,Wu],[Es,Es,Es])];function xf(r,e,i,s=!0){const u=mi([],r._camera.position,r.worldSize),p=[e,i,1,1];Mr(p,p,r.pixelMatrixInverse),Qs(p,p,1/p[3]);const _=In([],Ir([],p,u)),x=r.globeMatrix,E=[x[12],x[13],x[14]],C=Ir([],E,u),k=Pr(C),B=In([],C),j=r.worldSize/(2*Math.PI),U=Lr(B,_),$=Math.asin(j/k);if($<Math.acos(U)){if(!s)return null;const Ut=[],_t=[];mi(Ut,_,k/U),In(_t,Ir(_t,Ut,C)),In(_,Tn(_,C,mi(_,_t,Math.tan($)*k)))}const ee=[];new nn(u,_).closestPointOnSphere(E,j,ee);const le=In([],cs(x,0)),oe=In([],cs(x,1)),ye=In([],cs(x,2)),xe=Lr(le,ee),Ie=Lr(oe,ee),$e=Lr(ye,ee),je=ui(Math.asin(-Ie/j));let Ye=ui(Math.atan2(xe,$e));Ye=r.center.lng+(function(Ut,_t){const Wt=(_t-Ut+180)%360-180;return Wt<-180?Wt+360:Wt})(r.center.lng,Ye);const st=I(Ye),ut=te(D(je),0,1);return new Se(st,ut)}class tl{constructor(e,i,s){this.a=Ir([],e,s),this.b=Ir([],i,s),this.center=s;const u=In([],this.a),p=In([],this.b);this.angle=Math.acos(Lr(u,p))}}function Au(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:(function(s,u,p,_){const x=Math.sin(p);return s*(Math.sin((1-_)*p)/x)+u*(Math.sin(_*p)/x)})(r.a[e],r.b[e],r.angle,te(i,0,1))+r.center[e]}function Ku(r){if(r.z<=1)return xh[r.z+2*r.y+r.x];const e=d_(Am(r));return _n.fromPoints(e)}function ds(r,e,i){return mi(r,r,1-i),vn(r,r,e,i)}function Hm(r,e,i){for(const s of r)Kr(s,s,e),mi(s,s,i)}function I_(r,e,i,s){const u=e/r.worldSize,p=r.globeMatrix;if(i.z<=1){const ut=Ku(i).getCorners();return Hm(ut,p,u),_n.fromPoints(ut)}const _=Am(i,s),x=d_(_,ys+vh(r._tileCoverLift));Hm(x,p,u);const E=Number.MAX_VALUE,C=[-E,-E,-E],k=[E,E,E];if(_.contains(r.center)){for(const _t of x)Et(k,k,_t),di(C,C,_t);C[2]=0;const ut=r.point,Ut=[ut.x*u,ut.y*u,0];return Et(k,k,Ut),di(C,C,Ut),new _n(k,C)}if(r._tileCoverLift>0){for(const ut of x)Et(k,k,ut),di(C,C,ut);return new _n(k,C)}const B=[p[12]*u,p[13]*u,p[14]*u],j=_.getCenter(),U=te(r.center.lat,-Q,Q),$=te(j.lat,-Q,Q),ee=I(r.center.lng),le=D(U);let oe=ee-I(j.lng);const ye=le-D($);oe>.5?oe-=1:oe<-.5&&(oe+=1);let xe=0;Math.abs(oe)>Math.abs(ye)?xe=oe>=0?1:3:(xe=ye>=0?0:2,vn(B,B,[p[4]*u,p[5]*u,p[6]*u],-Math.sin(fi(ye>=0?_.getSouth():_.getNorth()))*ys));const Ie=x[xe],$e=x[(xe+1)%4],je=new tl(Ie,$e,B),Ye=[Au(je,0)||Ie[0],Au(je,1)||Ie[1],Au(je,2)||Ie[2]],st=eu(r.zoom);if(st>0){const ut=(function({x:_t,y:Wt,z:ni},ri,wi,Si,gi){const yi=1/(1<<ni);let Zt=_t*yi,qt=Zt+yi,vi=Wt*yi,Bi=vi+yi,zi=0;const Dn=(Zt+qt)/2-Si;return Dn>.5?zi=-1:Dn<-.5&&(zi=1),Zt=((Zt+zi)*ri-(Si*=ri))*wi+Si,qt=((qt+zi)*ri-Si)*wi+Si,vi=(vi*ri-(gi*=ri))*wi+gi,Bi=(Bi*ri-gi)*wi+gi,[[Zt,Bi,0],[qt,Bi,0],[qt,vi,0],[Zt,vi,0]]})(i,e,r._pixelsPerMercatorPixel,ee,le);for(let _t=0;_t<x.length;_t++)ds(x[_t],ut[_t],st);const Ut=Tn([],ut[xe],ut[(xe+1)%4]);mi(Ut,Ut,.5),ds(Ye,Ut,st)}for(const ut of x)Et(k,k,ut),di(C,C,ut);return k[2]=Math.min(Ie[2],$e[2]),Et(k,k,Ye),di(C,C,Ye),new _n(k,C)}function Am({x:r,y:e,z:i},s=!1){const u=1/(1<<i),p=new a(V(r*u),e===(1<<i)-1&&s?-90:K((e+1)*u)),_=new a(V((r+1)*u),e===0&&s?90:K(e*u));return new d(p,_)}function d_(r,e=ys){const i=fi(r.getNorth()),s=fi(r.getSouth()),u=Math.cos(i),p=Math.cos(s),_=Math.sin(i),x=Math.sin(s),E=r.getWest(),C=r.getEast();return[bl(p,x,E,e),bl(p,x,C,e),bl(u,_,C,e),bl(u,_,E,e)]}function qm(r,e,i,s){const u=1<<i.z,p=(r/pi+i.x)/u;return Eu(K((e/pi+i.y)/u),V(p),s)}function $m({min:r,max:e}){return jl/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const xd=new Float64Array(16);function bf(r){const e=$m(r),i=Pt(xd,[e,e,e]);return an(i,i,gr([],r.min))}function Mm(r){const e=(s=r.min,(i=xd)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const u=1/$m(r);return Un(e,e,[u,u,u])}function Zp(r){const e=pi/(2*Math.PI);return r/(2*Math.PI)/e}function Zm(r,e){return pi/(512*Math.pow(2,r))*$m(Ku(e))}function Hf(r,e,i,s,u){const p=Zp(i),_=[r,e,-i/(2*Math.PI)],x=qi(new Float64Array(16));return an(x,x,_),Un(x,x,[p,p,p]),rr(x,x,fi(-u)),ln(x,x,fi(-s)),x}function eu(r){return _e(bc,$p,r)}function Wp(r,e){const i=Eu(e.lat,e.lng),s=(function($){const ee=Eu($._center.lat,$._center.lng);let le=br([],si(0,1,0),ee);const oe=Bt([],-$.angle,ee);le=Kr(le,le,oe),Bt(oe,-$._pitch,le);const ye=In([],ee);return mi(ye,ye,vh($.cameraToCenterDistance/$.pixelsPerMeter)),Kr(ye,ye,oe),Tn([],ee,ye)})(r);return _=(u=zn([],s,i))[0],x=u[1],E=u[2],C=(p=i)[0],k=p[1],B=p[2],U=(j=Math.sqrt((_*_+x*x+E*E)*(C*C+k*k+B*B)))&&Lr(u,p)/j,Math.acos(Math.min(Math.max(U,-1),1));var u,p,_,x,E,C,k,B,j,U}function vp(r,e){return Wp(r,e)>Math.PI/2*1.01}const f_=fi(85),Wm=Math.cos(f_),C_=Math.sin(f_),Xm=Ui(),Ym=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Xp(r,e,i,s,u,p,_,x,E){if(p&&r.queryGeometry.isAboveHorizon)return!1;p&&(E*=r.pixelToTileUnitsFactor);const C=r.tileID.canonical,k=i.projection.upVectorScale(C,i.center.lat,i.worldSize).metersToTile;for(const B of e)for(const j of B){const U=j.add(x),$=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(U.x,U.y,!0):0,ee=i.projection.projectTilePoint(U.x,U.y,C);if($>0){const xe=i.projection.upVector(C,U.x,U.y);ee.x+=xe[0]*k*$,ee.y+=xe[1]*k*$,ee.z+=xe[2]*k*$}const le=p?U:X_(ee.x,ee.y,ee.z,s),oe=p?r.tilespaceRays.map((xe=>xp(xe,$))):r.queryGeometry.screenGeometry,ye=Mr([],[ee.x,ee.y,ee.z,1],s);if(!_&&p?E*=ye[3]/i.cameraToCenterDistance:_&&!p&&(E*=i.cameraToCenterDistance/ye[3]),p){const xe=K((j.y/pi+C.y)/(1<<C.z));E/=i.projection.pixelsPerMeter(xe,1)/N(1,xe)}if(_r(oe,le,E))return!0}return!1}function X_(r,e,i,s){const u=Mr([],[r,e,i,1],s);return new Ge(u[0]/u[3],u[1]/u[3])}const z_=si(0,0,0),vg=si(0,0,1);function xp(r,e){const i=Wi();return z_[2]=e,r.intersectsPlane(z_,vg,i),new Ge(i[0],i[1])}class Ul extends ta{}let qf,p_,Yp,R_;function Km(r,{width:e,height:i},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*s);return r.width=e,r.height=i,r.data=u,r}function Cs(r,e,i){const{width:s,height:u}=e;s===r.width&&u===r.height||(Im(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,s),height:Math.min(r.height,u)},i,null),r.width=s,r.height=u,r.data=e.data)}function Im(r,e,i,s,u,p,_,x){if(u.width===0||u.height===0)return e;if(u.width>r.width||u.height>r.height||i.x>r.width-u.width||i.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const E=r.data,C=e.data,k=p===4&&x;for(let B=0;B<u.height;B++){const j=((i.y+B)*r.width+i.x)*p,U=((s.y+B)*e.width+s.x)*p;if(k)for(let $=0;$<u.width;$++){const ee=j+$*p+3,le=U+$*p;C[le+0]=255,C[le+1]=255,C[le+2]=255,C[le+3]=E[ee]}else if(_)for(let $=0;$<u.width;$++){const ee=j+$*p,le=U+$*p,oe=new Ia(E[ee+0]/255,E[ee+1]/255,E[ee+2]/255,E[ee+3]).toNonPremultipliedRenderColor(_).toArray();C[le+0]=oe[0],C[le+1]=oe[1],C[le+2]=oe[2],C[le+3]=oe[3]}else for(let $=0;$<u.width*p;$++)C[U+$]=E[j+$]}return e}hi(Ul,"HeatmapBucket",{omit:["layers"]});class bd{constructor(e,i){Km(this,e,1,i)}resize(e){Cs(this,new bd(e),1)}clone(){return new bd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,p){Im(e,i,s,u,p,1,null)}}class wl{constructor(e,i){Km(this,e,4,i)}resize(e){Cs(this,new wl(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new wl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,p,_,x){Im(e,i,s,u,p,4,_,x)}}class m_{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function $f(r){const e={},i=r.resolution||256,s=r.clips?r.clips.length:1,u=r.image||new wl({width:i,height:s}),p=(_,x,E)=>{e[r.evaluationKey]=E;const C=r.expression.evaluate(e),k=C?C.toNonPremultipliedRenderColor(null):null;k&&(u.data[_+x+0]=Math.floor(255*k.r),u.data[_+x+1]=Math.floor(255*k.g),u.data[_+x+2]=Math.floor(255*k.b),u.data[_+x+3]=Math.floor(255*k.a))};if(r.clips)for(let _=0,x=0;_<s;++_,x+=4*i)for(let E=0,C=0;E<i;E++,C+=4){const k=E/(i-1),{start:B,end:j}=r.clips[_];p(x,C,B*(1-k)+j*k)}else for(let _=0,x=0;_<i;_++,x+=4)p(0,x,_/(i-1));return u}hi(bd,"AlphaImage"),hi(wl,"RGBAImage");const Kp=Yr([{name:"a_pos",components:2,type:"Int16"}],4),Jm=Yr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Qm=Yr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),__=Yr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Jp(r,e,i=2){const s=e&&e.length,u=s?e[0]*i:r.length;let p=g_(r,0,u,i,!0);const _=[];if(!p||p.next===p.prev)return _;let x,E,C;if(s&&(p=(function(k,B,j,U){const $=[];for(let ee=0,le=B.length;ee<le;ee++){const oe=g_(k,B[ee]*U,ee<le-1?B[ee+1]*U:k.length,U,!1);oe===oe.next&&(oe.steiner=!0),$.push(z(oe))}$.sort(f);for(let ee=0;ee<$.length;ee++)j=l($[ee],j);return j})(r,e,p,i)),r.length>80*i){x=r[0],E=r[1];let k=x,B=E;for(let j=i;j<u;j+=i){const U=r[j],$=r[j+1];U<x&&(x=U),$<E&&(E=$),U>k&&(k=U),$>B&&(B=$)}C=Math.max(k-x,B-E),C=C!==0?32767/C:0}return wf(p,_,i,x,E,C,0),_}function g_(r,e,i,s,u){let p;if(u===(function(_,x,E,C){let k=0;for(let B=x,j=E-C;B<E;B+=C)k+=(_[j]-_[B])*(_[B+1]+_[j+1]),j=B;return k})(r,e,i,s)>0)for(let _=e;_<i;_+=s)p=Je(_/s|0,r[_],r[_+1],p);else for(let _=i-s;_>=e;_-=s)p=Je(_/s|0,r[_],r[_+1],p);return p&&re(p,p.next)&&(xt(p),p=p.next),p}function Vd(r,e){if(!r)return r;e||(e=r);let i,s=r;do if(i=!1,s.steiner||!re(s,s.next)&&W(s.prev,s,s.next)!==0)s=s.next;else{if(xt(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function wf(r,e,i,s,u,p,_){if(!r)return;!_&&p&&(function(E,C,k,B){let j=E;do j.z===0&&(j.z=T(j.x,j.y,C,k,B)),j.prevZ=j.prev,j.nextZ=j.next,j=j.next;while(j!==E);j.prevZ.nextZ=null,j.prevZ=null,(function(U){let $,ee=1;do{let le,oe=U;U=null;let ye=null;for($=0;oe;){$++;let xe=oe,Ie=0;for(let je=0;je<ee&&(Ie++,xe=xe.nextZ,xe);je++);let $e=ee;for(;Ie>0||$e>0&&xe;)Ie!==0&&($e===0||!xe||oe.z<=xe.z)?(le=oe,oe=oe.nextZ,Ie--):(le=xe,xe=xe.nextZ,$e--),ye?ye.nextZ=le:U=le,le.prevZ=ye,ye=le;oe=xe}ye.nextZ=null,ee*=2}while($>1)})(j)})(r,s,u,p);let x=r;for(;r.prev!==r.next;){const E=r.prev,C=r.next;if(p?e_(r,s,u,p):wo(r))e.push(E.i,r.i,C.i),xt(r),r=C.next,x=C.next;else if((r=C)===x){_?_===1?wf(r=wc(Vd(r),e),e,i,s,u,p,2):_===2&&xg(r,e,i,s,u,p):wf(Vd(r),e,i,s,u,p,1);break}}}function wo(r){const e=r.prev,i=r,s=r.next;if(W(e,i,s)>=0)return!1;const u=e.x,p=i.x,_=s.x,x=e.y,E=i.y,C=s.y,k=Math.min(u,p,_),B=Math.min(x,E,C),j=Math.max(u,p,_),U=Math.max(x,E,C);let $=s.next;for(;$!==e;){if($.x>=k&&$.x<=j&&$.y>=B&&$.y<=U&&O(u,x,p,E,_,C,$.x,$.y)&&W($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function e_(r,e,i,s){const u=r.prev,p=r,_=r.next;if(W(u,p,_)>=0)return!1;const x=u.x,E=p.x,C=_.x,k=u.y,B=p.y,j=_.y,U=Math.min(x,E,C),$=Math.min(k,B,j),ee=Math.max(x,E,C),le=Math.max(k,B,j),oe=T(U,$,e,i,s),ye=T(ee,le,e,i,s);let xe=r.prevZ,Ie=r.nextZ;for(;xe&&xe.z>=oe&&Ie&&Ie.z<=ye;){if(xe.x>=U&&xe.x<=ee&&xe.y>=$&&xe.y<=le&&xe!==u&&xe!==_&&O(x,k,E,B,C,j,xe.x,xe.y)&&W(xe.prev,xe,xe.next)>=0||(xe=xe.prevZ,Ie.x>=U&&Ie.x<=ee&&Ie.y>=$&&Ie.y<=le&&Ie!==u&&Ie!==_&&O(x,k,E,B,C,j,Ie.x,Ie.y)&&W(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;xe&&xe.z>=oe;){if(xe.x>=U&&xe.x<=ee&&xe.y>=$&&xe.y<=le&&xe!==u&&xe!==_&&O(x,k,E,B,C,j,xe.x,xe.y)&&W(xe.prev,xe,xe.next)>=0)return!1;xe=xe.prevZ}for(;Ie&&Ie.z<=ye;){if(Ie.x>=U&&Ie.x<=ee&&Ie.y>=$&&Ie.y<=le&&Ie!==u&&Ie!==_&&O(x,k,E,B,C,j,Ie.x,Ie.y)&&W(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function wc(r,e){let i=r;do{const s=i.prev,u=i.next.next;!re(s,u)&&pe(s,i,i.next,u)&&Le(s,u)&&Le(u,s)&&(e.push(s.i,i.i,u.i),xt(i),xt(i.next),i=r=u),i=i.next}while(i!==r);return Vd(i)}function xg(r,e,i,s,u,p){let _=r;do{let x=_.next.next;for(;x!==_.prev;){if(_.i!==x.i&&H(_,x)){let E=qe(_,x);return _=Vd(_,_.next),E=Vd(E,E.next),wf(_,e,i,s,u,p,0),void wf(E,e,i,s,u,p,0)}x=x.next}_=_.next}while(_!==r)}function f(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function l(r,e){const i=(function(u,p){let _=p;const x=u.x,E=u.y;let C,k=-1/0;if(re(u,_))return _;do{if(re(u,_.next))return _.next;if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){const ee=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(ee<=x&&ee>k&&(k=ee,C=_.x<_.next.x?_:_.next,ee===x))return C}_=_.next}while(_!==p);if(!C)return null;const B=C,j=C.x,U=C.y;let $=1/0;_=C;do{if(x>=_.x&&_.x>=j&&x!==_.x&&F(E<U?x:k,E,j,U,E<U?k:x,E,_.x,_.y)){const ee=Math.abs(E-_.y)/(x-_.x);Le(_,u)&&(ee<$||ee===$&&(_.x>C.x||_.x===C.x&&g(C,_)))&&(C=_,$=ee)}_=_.next}while(_!==B);return C})(r,e);if(!i)return e;const s=qe(i,r);return Vd(s,s.next),Vd(i,i.next)}function g(r,e){return W(r.prev,r,e.prev)<0&&W(e.next,r,r.next)<0}function T(r,e,i,s,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function z(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function F(r,e,i,s,u,p,_,x){return(u-_)*(e-x)>=(r-_)*(p-x)&&(r-_)*(s-x)>=(i-_)*(e-x)&&(i-_)*(p-x)>=(u-_)*(s-x)}function O(r,e,i,s,u,p,_,x){return!(r===_&&e===x)&&F(r,e,i,s,u,p,_,x)}function H(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(i,s){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==s.i&&u.next.i!==s.i&&pe(u,u.next,i,s))return!0;u=u.next}while(u!==i);return!1})(r,e)&&(Le(r,e)&&Le(e,r)&&(function(i,s){let u=i,p=!1;const _=(i.x+s.x)/2,x=(i.y+s.y)/2;do u.y>x!=u.next.y>x&&u.next.y!==u.y&&_<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==i);return p})(r,e)&&(W(r.prev,r,e.prev)||W(r,e.prev,e))||re(r,e)&&W(r.prev,r,r.next)>0&&W(e.prev,e,e.next)>0)}function W(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function re(r,e){return r.x===e.x&&r.y===e.y}function pe(r,e,i,s){const u=Me(W(r,e,i)),p=Me(W(r,e,s)),_=Me(W(i,s,r)),x=Me(W(i,s,e));return u!==p&&_!==x||!(u!==0||!ve(r,i,e))||!(p!==0||!ve(r,s,e))||!(_!==0||!ve(i,r,s))||!(x!==0||!ve(i,e,s))}function ve(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Me(r){return r>0?1:r<0?-1:0}function Le(r,e){return W(r.prev,r,r.next)<0?W(r,e,r.next)>=0&&W(r,r.prev,e)>=0:W(r,e,r.prev)<0||W(r,r.next,e)<0}function qe(r,e){const i=zt(r.i,r.x,r.y),s=zt(e.i,e.x,e.y),u=r.next,p=e.prev;return r.next=e,e.prev=r,i.next=u,u.prev=i,s.next=i,i.prev=s,p.next=s,s.prev=p,s}function Je(r,e,i,s){const u=zt(r,e,i);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function xt(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function zt(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function ai(r,e){const i=r.length;if(i<=1)return[r];const s=[];let u,p;for(let _=0;_<i;_++){const x=$n(r[_]);x!==0&&(r[_].area=Math.abs(x),p===void 0&&(p=x<0),p===x<0?(u&&s.push(u),u=[r[_]]):u.push(r[_]))}if(u&&s.push(u),e>1)for(let _=0;_<s.length;_++)s[_].length<=e||(qa(s[_],e,1,s[_].length-1,Vt),s[_]=s[_].slice(0,e));return s}function Vt(r,e){return e.area-r.area}function ii(r,e,i=1){if(!r)return null;const s=typeof r=="string"?Co.from(r).getPrimary():r.getPrimary(),u=typeof r=="string"?null:r.getSecondary();for(const p of[s,u]){if(!p)continue;const _=p.id.toString();e.has(_)||e.set(_,[]),p.scaleSelf(i),e.get(_).push(p)}return{primary:s.toString(),secondary:u?u.toString():null}}function Fi(r,e,i,s){const u=s.patternDependencies;let p=!1;for(const _ of e){const x=_.paint.get(`${r}-pattern`);x.isConstant()||(p=!0),ii(x.constantOr(null),u,i)&&(p=!0)}return p}function gn(r,e,i,s,u,p){const _=p.patternDependencies;for(const x of e){const E=x.paint.get(`${r}-pattern`).value;if(E.kind!=="constant"){let C=E.evaluate({zoom:s},i,{},p.availableImages);C=C&&C.name?C.name:C;const k=ii(C,_,u);if(!k)continue;const{primary:B,secondary:j}=k;B&&(i.patterns[x.id]=[B,j].filter(Boolean))}}return i}class Xn{constructor(){this.polygons=new Map}add(e,...i){const s=this.polygons.get(e);s?s.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,s]of e.polygons)this.add(i,...s)}}class Rr{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=pi&&i>=pi}static evaluate(e){if(e.length===0)return new Rr;let i=[];for(const E of e)i.push(...E.portals);if(i.length===0)return new Rr;for(const E of i){const C=E.va,k=E.vb;(Rr.isOnBorder(C.x,k.x)||Rr.isOnBorder(C.y,k.y))&&(E.type="border")}const s=i.filter((E=>E.type!=="unevaluated")),u=i.filter((E=>E.type==="unevaluated"));if(u.length===0)return new Rr;u.sort(((E,C)=>E.hash===C.hash?E.isTunnel===C.isTunnel?0:E.isTunnel?-1:1:E.hash<C.hash?1:-1)),i=s.concat(u);let p=s.length,_=p,x=p;do if(_++,_===i.length||i[p].hash!==i[_].hash){if(_-p==2){x<p&&(i[x]=i[p],i[p]=null);const E=i[x],C=i[_-1];E.type=E.isTunnel!==C.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:C.connection.a},x++}p=_}while(p!==i.length);return i.splice(x),i.sort(((E,C)=>E.hash<C.hash?1:-1)),{portals:i}}}hi(Rr,"ElevationPortalGraph"),hi(Xn,"ElevationPolygons");class Bn{constructor(e,i,s){this.outPositions=e,this.outNormals=i,this.outIndices=s,this.vertexLookup=new Map}addVertex(e,i,s){let u=e[2];s!=null&&(u*=s);const p=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,_=this.vertexLookup.get(p);if(_!=null)return _;const x=this.outPositions.length;this.vertexLookup.set(p,x);const E=Math.trunc(16384*i[0]),C=Math.trunc(16384*i[1]),k=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(E,C,k),x}addTriangle(e,i,s){this.outIndices.emplaceBack(e,i,s)}addTriangles(e,i,s){if(e.length===0)return;const u=s.length===1,p=Wi(),_=Wi();for(let x=0;x<e.length;x+=3){const E=i[e[x+0]],C=i[e[x+1]],k=i[e[x+2]],B=u?s[0]:s[e[x+1]],j=u?s[0]:s[e[x+2]];xi(p,E.x,E.y,u?s[0]:s[e[x+0]]);const U=this.addVertex(p,_);xi(p,C.x,C.y,B);const $=this.addVertex(p,_);xi(p,k.x,k.y,j);const ee=this.addVertex(p,_);this.outIndices.emplaceBack(U,$,ee)}}addQuad(e,i,s,u,p,_){const x=this.addVertex(e,p,_),E=this.addVertex(i,p,_),C=this.addVertex(s,p,_),k=this.addVertex(u,p,_);this.addTriangle(x,E,C),this.addTriangle(C,k,x)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class Mn{constructor(e,i,s,u){this.unevaluatedPortals=new Rr,this.portalPolygons=new Xn,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new kp,this.vertexNormals=new lp,this.indexArray=new co,this.tileToMeters=me(e),this.bridgeProgramConfigurations=new gh(i,{zoom:s,lut:u},(p=>p!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new gh(i,{zoom:s,lut:u},(p=>p!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const s=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(i[u]);return s}addTriangles(e,i,s){const u=s?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)u.push(p+i)}addRenderableRing(e,i,s,u,p,_){const x=[new Ge(p.min.x,p.min.y),new Ge(p.max.x,p.min.y),new Ge(p.max.x,p.max.y),new Ge(p.min.x,p.max.y)];for(let E=0;E<s-1;E++){const C=i+E,k=C+1,B=this.unevalVertices[C],j=this.unevalVertices[k];if(!(B.x>=p.min.x&&B.x<=p.max.x&&B.y>=p.min.y&&B.y<=p.max.y||j.x>=p.min.x&&j.x<=p.max.x&&j.y>=p.min.y&&j.y<=p.max.y||el(B,j,x))||this.isOnBorder(B.x,j.x)||this.isOnBorder(B.y,j.y))continue;const U=Mn.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[k]);let $,ee=this.vertexHashLookup.get(Mn.computePosHash(B));ee!=null?$=ee.next:(ee=this.vertexHashLookup.get(Mn.computePosHash(j)),$=ee!=null?ee.prev:U),this.unevalEdges.push({polygonIdx:e,a:C,b:k,hash:U,portalHash:$,isTunnel:u,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,i,s,u,p){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:p});const _=i[0];this.vertexHashLookup.clear();let x=Mn.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let E=0;E<_.length-1;E++){const C=_[E+0],k=_[E+1],B=sr(k.x-C.x,k.y-C.y),j=Uo(B);if(j===0)continue;let U="unevaluated";const $=u.pointElevation(C),ee=u.pointElevation(k);Math.abs($)<.01&&Math.abs(ee)<.01?U="entrance":(this.isOnBorder(C.x,k.x)||this.isOnBorder(C.y,k.y))&&(U="border");const le=Mn.computeEdgeHash(C,k);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:C,vb:k,vab:B,length:j,hash:le,isTunnel:s,type:U});const oe=Mn.computePosHash(C);this.vertexHashLookup.set(oe,{prev:x,next:le}),x=le}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=j=>{j.primitiveLength=this.indexArray.length-j.primitiveOffset},u=new Bn(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=i(),_=i(),x=i(),E=(j,U)=>{j.sort(((ee,le)=>ee.type===U&&le.type!==U?-1:ee.type!==U&&le.type===U?1:0));const $=j.findIndex((ee=>ee.type!==U));return $>=0?$:j.length};let C=0;this.unevalEdges.length>0&&(C=E(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),s(x);const k=i(),B=i();if(this.unevalEdges.length>0){const j=this.unevalEdges.splice(C),U=E(j,"tunnel")+C;this.unevalEdges.push(...j),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:U})}s(k),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(B),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(_),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(p),this.maskSegments=Ss.simpleSegment(0,B.primitiveOffset,0,B.primitiveLength),this.depthSegments=Ss.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=Ss.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=Ss.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.shadowCasterSegments=Ss.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,i,s,u,p,_,x,E){this.bridgeProgramConfigurations.updatePaintArrays(e,i,p,s,u,_,x,E),this.tunnelProgramConfigurations.updatePaintArrays(e,i,p,s,u,_,x,E)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Qm.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,__.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,s,u,p){const _=(x,E)=>{for(let C=0;C<E.length-1;C++){const k=E[C].featureIndex,B=E[C+1].vertexStart,j=e.feature(k);x.populatePaintArrays(B,j,k,{},s,i,u,void 0,p)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,s,u,p){const _=new Map;for(let x=u;x<p;x++){const E=s[x],C=E.a,k=E.b,B=Mn.computePosHash(e[C]),j=Mn.computePosHash(e[k]);let U=_.get(B);U||(U={},_.set(B,U));let $=_.get(j);$||($={},_.set(j,$)),i[C]<=0&&i[k]<=0||(U.to=k,$.from=C)}return _}isTerminalVertex(e,i){const s=Mn.computePosHash(this.unevalVertices[e]),u=i.get(s);return!u||!u.from||!u.to}constructBridgeStructures(e,i,s,u,p,_){e.clearVertexLookup();const x=this.computeVertexConnections(i,s,u,p.min,p.max),E=1/_,C=.5*E,k=(wi,Si)=>xi(wi,i[Si].x,i[Si].y,s[Si]*E),B=Wi(),j=Wi(),U=Wi(),$=Wi(),ee=Wi(),le=(wi,Si)=>{const gi=x.get(Mn.computePosHash(i[Si])),yi=gi.from,Zt=gi.to;if(!yi||!Zt)return;k(B,yi),k(j,Si),k(U,Zt),$t($),Va(B,j)||(Ir(ee,j,B),In($,ee)),Va(U,j)||(Ir(ee,U,j),Tn($,$,In(ee,ee)));const qt=la($);return qt>0?mi(wi,$,1/qt):void 0};let oe=Number.POSITIVE_INFINITY;this.sortSubarray(u,p.min,p.max,((wi,Si)=>wi.featureInfo.featureIndex-Si.featureInfo.featureIndex));const ye=Wi(),xe=Wi(),Ie=Wi(),$e=Wi(),je=Wi(),Ye=Wi(),st=Wi(),ut=Wi(),Ut=Wi(),_t=[Wi(),Wi(),Wi(),Wi()],Wt=[Wi(),Wi(),Wi(),Wi()],ni=[{coord:new Ge(0,0),height:0},{coord:new Ge(0,0),height:0}],ri=(wi,Si)=>wi>Si;for(let wi=p.min;wi<p.max;wi++){const Si=u[wi];if(!Si.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ni,i,s,Si,ri))continue;const[gi,yi]=ni;if(xi(ye,gi.coord.x,gi.coord.y,E*gi.height),xi(xe,yi.coord.x,yi.coord.y,E*yi.height),Va(ye,xe))continue;Ir(Ie,xe,ye),In(Ie,Ie);const Zt=le(ut,Si.a)||Ie,qt=le(Ut,Si.b)||Ie;xi($e,Zt[1],-Zt[0],0),In($e,$e),xi(je,qt[1],-qt[0],0),In(je,je),br(ut,$e,Zt),In(Ye,ut),br(ut,je,qt),In(st,ut),Tn(_t[0],ye,mi(ut,Ir(ut,$e,Ye),C)),Tn(_t[1],ye,mi(ut,Tn(ut,$e,Ye),C)),Tn(_t[2],ye,mi(ut,Ye,C)),_t[3]=ye,Tn(Wt[0],xe,mi(ut,Ir(ut,je,st),C)),Tn(Wt[1],xe,mi(ut,Tn(ut,je,st),C)),Tn(Wt[2],xe,mi(ut,st,C)),Wt[3]=xe,oe=this.addFeatureSection(Si.featureInfo.featureIndex,oe,this.bridgeFeatureSections,e);const vi=e.addVertex(_t[0],$e,_),Bi=e.addVertex(_t[1],$e,_),zi=e.addVertex(Wt[0],je,_),Dn=e.addVertex(Wt[1],je,_);e.addTriangle(vi,Bi,zi),e.addTriangle(Bi,Dn,zi);const rn=e.addVertex(_t[1],Ye,_),cn=e.addVertex(_t[2],Ye,_),wn=e.addVertex(Wt[1],st,_),Hr=e.addVertex(Wt[2],st,_);e.addTriangle(rn,cn,wn),e.addTriangle(cn,Hr,wn),gr($e,$e),gr(je,je);const Di=e.addVertex(_t[2],$e,_),Sn=e.addVertex(_t[3],$e,_),mr=e.addVertex(Wt[2],je,_),pa=e.addVertex(Wt[3],je,_);e.addTriangle(Di,Sn,mr),e.addTriangle(Sn,pa,mr);const wa=this.isTerminalVertex(Si.a,x),Dr=this.isTerminalVertex(Si.b,x);gi.height<.01&&wa&&e.addQuad(_t[3],_t[2],_t[1],_t[0],gr(Zt,Zt),_),yi.height<.01&&Dr&&e.addQuad(Wt[0],Wt[1],Wt[2],Wt[3],qt,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,s,u,p,_){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const E=(oe,ye)=>oe.featureInfo.featureIndex-ye.featureInfo.featureIndex;this.sortSubarray(u,p.min,p.max,E),this.sortSubarray(u,_.min,_.max,E);const C=oe=>In(oe,oe),k=[{coord:new Ge(0,0),height:0},{coord:new Ge(0,0),height:0}],B=(oe,ye)=>oe<ye,j=Wi(),U=Wi(),$=Wi(),ee=Wi(),le=Wi();for(let oe=p.min;oe<p.max;oe++){if(!this.prepareEdgePoints(k,i,s,u[oe],B))continue;const[ye,xe]=k,Ie=C(xi(le,-(xe.coord.y-ye.coord.y),xe.coord.x-ye.coord.x,0));x=this.addFeatureSection(u[oe].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(xi(j,ye.coord.x,ye.coord.y,ye.height),xi(U,xe.coord.x,xe.coord.y,xe.height),xi($,xe.coord.x,xe.coord.y,u[oe].isTunnel?-.1:0),xi(ee,ye.coord.x,ye.coord.y,u[oe].isTunnel?-.1:0),Ie)}for(let oe=_.min;oe<_.max;oe++){const ye=u[oe];ye.isTunnel&&([ye.a,ye.b]=[ye.b,ye.a]);const xe=i[ye.a],Ie=i[ye.b],$e=C(xi(le,-(Ie.y-xe.y),Ie.x-xe.x,0));x=this.addFeatureSection(ye.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad(xi(j,Ie.x,Ie.y,0),xi(U,xe.x,xe.y,0),xi($,xe.x,xe.y,s[ye.a]+4),xi(ee,Ie.x,Ie.y,s[ye.b]+4),$e),e.addQuad(xi(j,xe.x,xe.y,0),xi(U,Ie.x,Ie.y,0),xi($,Ie.x,Ie.y,s[ye.b]+4),xi(ee,xe.x,xe.y,s[ye.a]+4),$e)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,s,u){e.coord.x=i,e.coord.y=s,e.height=u}prepareEdgePoints(e,i,s,u,p){let _=i[u.a].x,x=i[u.a].y,E=i[u.b].x,C=i[u.b].y,k=s[u.a],B=s[u.b];const j=p(k,0),U=p(B,0);if(j&&U)return this.setElevatedPoint(e[0],_,x,k),this.setElevatedPoint(e[1],E,C,B),!0;if(!j&&!U)return!1;if(j){if(!U){const $=B/(B-k);E=Hn(E,_,$),C=Hn(C,x,$),B=Hn(B,k,$)}}else{const $=k/(k-B);_=Hn(_,E,$),x=Hn(x,C,$),k=Hn(k,B,$)}return this.setElevatedPoint(e[0],_,x,k),this.setElevatedPoint(e[1],E,C,B),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((x,E)=>x.hash===E.hash?E.polygonIdx-x.polygonIdx:E.hash>x.hash?1:-1));let s=0,u=0,p=0,_=i[s].polygonIdx;do u++,(u===i.length||i[s].hash!==i[u].hash)&&((u-s==1||i[u-1].polygonIdx!==_)&&(p<s&&(i[p]=i[s],i[s]=null),i[p].type="none",p++),s=u,s!==i.length&&(_=i[s].polygonIdx));while(s!==i.length);if(i.splice(p),i.length!==0&&e.length!==0){i.sort(((C,k)=>C.portalHash<k.portalHash?1:-1));let x=0,E=0;for(;x!==i.length&&E!==e.length;){const C=i[x],k=e[E];C.portalHash>k.hash?x++:k.hash>C.portalHash?E++:(C.type=k.type,x++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=pi&&i>=pi}addFeatureSection(e,i,s,u){return e!==i&&(i=e,s.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),i}sortSubarray(e,i,s,u){const p=e.slice(i,s);p.sort(u),e.splice(i,p.length,...p)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Mn.computePosHash(e))<<32n|BigInt(Mn.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var wr,lr={exports:{}},nr=(wr||(wr=1,(function(r){function e(Ue,Ze){return Ue>Ze?1:Ue<Ze?-1:0}var i=function(Ue,Ze){Ue===void 0&&(Ue=e),Ze===void 0&&(Ze=!1),this._compare=Ue,this._root=null,this._size=0,this._noDuplicates=!!Ze},s={size:{configurable:!0}};function u(Ue,Ze,Xt,Ti,Yi){var Ki=Yi-Ti;if(Ki>0){var Pn=Ti+Math.floor(Ki/2),On={key:Ze[Pn],data:Xt[Pn],parent:Ue};return On.left=u(On,Ze,Xt,Ti,Pn),On.right=u(On,Ze,Xt,Pn+1,Yi),On}return null}function p(Ue,Ze,Xt,Ti,Yi){if(!(Xt>=Ti)){for(var Ki=Ue[Xt+Ti>>1],Pn=Xt-1,On=Ti+1;;){do Pn++;while(Yi(Ue[Pn],Ki)<0);do On--;while(Yi(Ue[On],Ki)>0);if(Pn>=On)break;var Sr=Ue[Pn];Ue[Pn]=Ue[On],Ue[On]=Sr,Sr=Ze[Pn],Ze[Pn]=Ze[On],Ze[On]=Sr}p(Ue,Ze,Xt,On,Yi),p(Ue,Ze,On+1,Ti,Yi)}}i.prototype.rotateLeft=function(Ue){var Ze=Ue.right;Ze&&(Ue.right=Ze.left,Ze.left&&(Ze.left.parent=Ue),Ze.parent=Ue.parent),Ue.parent?Ue===Ue.parent.left?Ue.parent.left=Ze:Ue.parent.right=Ze:this._root=Ze,Ze&&(Ze.left=Ue),Ue.parent=Ze},i.prototype.rotateRight=function(Ue){var Ze=Ue.left;Ze&&(Ue.left=Ze.right,Ze.right&&(Ze.right.parent=Ue),Ze.parent=Ue.parent),Ue.parent?Ue===Ue.parent.left?Ue.parent.left=Ze:Ue.parent.right=Ze:this._root=Ze,Ze&&(Ze.right=Ue),Ue.parent=Ze},i.prototype._splay=function(Ue){for(;Ue.parent;){var Ze=Ue.parent;Ze.parent?Ze.left===Ue&&Ze.parent.left===Ze?(this.rotateRight(Ze.parent),this.rotateRight(Ze)):Ze.right===Ue&&Ze.parent.right===Ze?(this.rotateLeft(Ze.parent),this.rotateLeft(Ze)):Ze.left===Ue&&Ze.parent.right===Ze?(this.rotateRight(Ze),this.rotateLeft(Ze)):(this.rotateLeft(Ze),this.rotateRight(Ze)):Ze.left===Ue?this.rotateRight(Ze):this.rotateLeft(Ze)}},i.prototype.splay=function(Ue){for(var Ze,Xt,Ti,Yi,Ki;Ue.parent;)(Xt=(Ze=Ue.parent).parent)&&Xt.parent?((Ti=Xt.parent).left===Xt?Ti.left=Ue:Ti.right=Ue,Ue.parent=Ti):(Ue.parent=null,this._root=Ue),Yi=Ue.left,Ki=Ue.right,Ue===Ze.left?(Xt&&(Xt.left===Ze?(Ze.right?(Xt.left=Ze.right,Xt.left.parent=Xt):Xt.left=null,Ze.right=Xt,Xt.parent=Ze):(Yi?(Xt.right=Yi,Yi.parent=Xt):Xt.right=null,Ue.left=Xt,Xt.parent=Ue)),Ki?(Ze.left=Ki,Ki.parent=Ze):Ze.left=null,Ue.right=Ze,Ze.parent=Ue):(Xt&&(Xt.right===Ze?(Ze.left?(Xt.right=Ze.left,Xt.right.parent=Xt):Xt.right=null,Ze.left=Xt,Xt.parent=Ze):(Ki?(Xt.left=Ki,Ki.parent=Xt):Xt.left=null,Ue.right=Xt,Xt.parent=Ue)),Yi?(Ze.right=Yi,Yi.parent=Ze):Ze.right=null,Ue.left=Ze,Ze.parent=Ue)},i.prototype.replace=function(Ue,Ze){Ue.parent?Ue===Ue.parent.left?Ue.parent.left=Ze:Ue.parent.right=Ze:this._root=Ze,Ze&&(Ze.parent=Ue.parent)},i.prototype.minNode=function(Ue){if(Ue===void 0&&(Ue=this._root),Ue)for(;Ue.left;)Ue=Ue.left;return Ue},i.prototype.maxNode=function(Ue){if(Ue===void 0&&(Ue=this._root),Ue)for(;Ue.right;)Ue=Ue.right;return Ue},i.prototype.insert=function(Ue,Ze){var Xt=this._root,Ti=null,Yi=this._compare;if(this._noDuplicates)for(;Xt;){if(Ti=Xt,Yi(Xt.key,Ue)===0)return;Xt=Yi(Xt.key,Ue)<0?Xt.right:Xt.left}else for(;Xt;)Ti=Xt,Xt=Yi(Xt.key,Ue)<0?Xt.right:Xt.left;return Xt={key:Ue,data:Ze,left:null,right:null,parent:Ti},Ti?Yi(Ti.key,Xt.key)<0?Ti.right=Xt:Ti.left=Xt:this._root=Xt,this.splay(Xt),this._size++,Xt},i.prototype.find=function(Ue){for(var Ze=this._root,Xt=this._compare;Ze;){var Ti=Xt(Ze.key,Ue);if(Ti<0)Ze=Ze.right;else{if(!(Ti>0))return Ze;Ze=Ze.left}}return null},i.prototype.contains=function(Ue){for(var Ze=this._root,Xt=this._compare;Ze;){var Ti=Xt(Ue,Ze.key);if(Ti===0)return!0;Ze=Ti<0?Ze.left:Ze.right}return!1},i.prototype.remove=function(Ue){var Ze=this.find(Ue);if(!Ze)return!1;if(this.splay(Ze),Ze.left)if(Ze.right){var Xt=this.minNode(Ze.right);Xt.parent!==Ze&&(this.replace(Xt,Xt.right),Xt.right=Ze.right,Xt.right.parent=Xt),this.replace(Ze,Xt),Xt.left=Ze.left,Xt.left.parent=Xt}else this.replace(Ze,Ze.left);else this.replace(Ze,Ze.right);return this._size--,!0},i.prototype.removeNode=function(Ue){if(!Ue)return!1;if(this.splay(Ue),Ue.left)if(Ue.right){var Ze=this.minNode(Ue.right);Ze.parent!==Ue&&(this.replace(Ze,Ze.right),Ze.right=Ue.right,Ze.right.parent=Ze),this.replace(Ue,Ze),Ze.left=Ue.left,Ze.left.parent=Ze}else this.replace(Ue,Ue.left);else this.replace(Ue,Ue.right);return this._size--,!0},i.prototype.erase=function(Ue){var Ze=this.find(Ue);if(Ze){this.splay(Ze);var Xt=Ze.left,Ti=Ze.right,Yi=null;Xt&&(Xt.parent=null,Yi=this.maxNode(Xt),this.splay(Yi),this._root=Yi),Ti&&(Xt?Yi.right=Ti:this._root=Ti,Ti.parent=Yi),this._size--}},i.prototype.pop=function(){var Ue=this._root,Ze=null;if(Ue){for(;Ue.left;)Ue=Ue.left;Ze={key:Ue.key,data:Ue.data},this.remove(Ue.key)}return Ze},i.prototype.next=function(Ue){var Ze=Ue;if(Ze)if(Ze.right)for(Ze=Ze.right;Ze&&Ze.left;)Ze=Ze.left;else for(Ze=Ue.parent;Ze&&Ze.right===Ue;)Ue=Ze,Ze=Ze.parent;return Ze},i.prototype.prev=function(Ue){var Ze=Ue;if(Ze)if(Ze.left)for(Ze=Ze.left;Ze&&Ze.right;)Ze=Ze.right;else for(Ze=Ue.parent;Ze&&Ze.left===Ue;)Ue=Ze,Ze=Ze.parent;return Ze},i.prototype.forEach=function(Ue){for(var Ze=this._root,Xt=[],Ti=!1,Yi=0;!Ti;)Ze?(Xt.push(Ze),Ze=Ze.left):Xt.length>0?(Ue(Ze=Xt.pop(),Yi++),Ze=Ze.right):Ti=!0;return this},i.prototype.range=function(Ue,Ze,Xt,Ti){for(var Yi=[],Ki=this._compare,Pn=this._root;Yi.length!==0||Pn;)if(Pn)Yi.push(Pn),Pn=Pn.left;else{if(Ki((Pn=Yi.pop()).key,Ze)>0)break;if(Ki(Pn.key,Ue)>=0&&Xt.call(Ti,Pn))return this;Pn=Pn.right}return this},i.prototype.keys=function(){for(var Ue=this._root,Ze=[],Xt=[],Ti=!1;!Ti;)Ue?(Ze.push(Ue),Ue=Ue.left):Ze.length>0?(Ue=Ze.pop(),Xt.push(Ue.key),Ue=Ue.right):Ti=!0;return Xt},i.prototype.values=function(){for(var Ue=this._root,Ze=[],Xt=[],Ti=!1;!Ti;)Ue?(Ze.push(Ue),Ue=Ue.left):Ze.length>0?(Ue=Ze.pop(),Xt.push(Ue.data),Ue=Ue.right):Ti=!0;return Xt},i.prototype.at=function(Ue){for(var Ze=this._root,Xt=[],Ti=!1,Yi=0;!Ti;)if(Ze)Xt.push(Ze),Ze=Ze.left;else if(Xt.length>0){if(Ze=Xt.pop(),Yi===Ue)return Ze;Yi++,Ze=Ze.right}else Ti=!0;return null},i.prototype.load=function(Ue,Ze,Xt){if(Ue===void 0&&(Ue=[]),Ze===void 0&&(Ze=[]),Xt===void 0&&(Xt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Ti=Ue.length;return Xt&&p(Ue,Ze,0,Ti-1,this._compare),this._root=u(null,Ue,Ze,0,Ti),this._size=Ti,this},i.prototype.min=function(){var Ue=this.minNode(this._root);return Ue?Ue.key:null},i.prototype.max=function(){var Ue=this.maxNode(this._root);return Ue?Ue.key:null},i.prototype.isEmpty=function(){return this._root===null},s.size.get=function(){return this._size},i.createTree=function(Ue,Ze,Xt,Ti,Yi){return new i(Xt,Yi).load(Ue,Ze,Ti)},Object.defineProperties(i.prototype,s);var _=0,x=1,E=2,C=3,k=0,B=1,j=2,U=3;function $(Ue,Ze,Xt){Ze===null?(Ue.inOut=!1,Ue.otherInOut=!0):(Ue.isSubject===Ze.isSubject?(Ue.inOut=!Ze.inOut,Ue.otherInOut=Ze.otherInOut):(Ue.inOut=!Ze.otherInOut,Ue.otherInOut=Ze.isVertical()?!Ze.inOut:Ze.inOut),Ze&&(Ue.prevInResult=!ee(Ze,Xt)||Ze.isVertical()?Ze.prevInResult:Ze));var Ti=ee(Ue,Xt);Ue.resultTransition=Ti?(function(Yi,Ki){var Pn,On=!Yi.inOut,Sr=!Yi.otherInOut;switch(Ki){case k:Pn=On&&Sr;break;case B:Pn=On||Sr;break;case U:Pn=On^Sr;break;case j:Pn=Yi.isSubject?On&&!Sr:Sr&&!On}return Pn?1:-1})(Ue,Xt):0}function ee(Ue,Ze){switch(Ue.type){case _:switch(Ze){case k:return!Ue.otherInOut;case B:return Ue.otherInOut;case j:return Ue.isSubject&&Ue.otherInOut||!Ue.isSubject&&!Ue.otherInOut;case U:return!0}break;case E:return Ze===k||Ze===B;case C:return Ze===j;case x:return!1}return!1}var le=function(Ue,Ze,Xt,Ti,Yi){this.left=Ze,this.point=Ue,this.otherEvent=Xt,this.isSubject=Ti,this.type=Yi||_,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},oe={inResult:{configurable:!0}};function ye(Ue,Ze){return Ue[0]===Ze[0]&&Ue[1]===Ze[1]}le.prototype.isBelow=function(Ue){var Ze=this.point,Xt=this.otherEvent.point;return this.left?(Ze[0]-Ue[0])*(Xt[1]-Ue[1])-(Xt[0]-Ue[0])*(Ze[1]-Ue[1])>0:(Xt[0]-Ue[0])*(Ze[1]-Ue[1])-(Ze[0]-Ue[0])*(Xt[1]-Ue[1])>0},le.prototype.isAbove=function(Ue){return!this.isBelow(Ue)},le.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},oe.inResult.get=function(){return this.resultTransition!==0},le.prototype.clone=function(){var Ue=new le(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ue.contourId=this.contourId,Ue.resultTransition=this.resultTransition,Ue.prevInResult=this.prevInResult,Ue.isExteriorRing=this.isExteriorRing,Ue.inOut=this.inOut,Ue.otherInOut=this.otherInOut,Ue},Object.defineProperties(le.prototype,oe);var xe=11102230246251565e-32,Ie=134217729,$e=(3+8*xe)*xe;function je(Ue,Ze,Xt,Ti,Yi){var Ki,Pn,On,Sr,Or=Ze[0],Ur=Ti[0],ua=0,Qn=0;Ur>Or==Ur>-Or?(Ki=Or,Or=Ze[++ua]):(Ki=Ur,Ur=Ti[++Qn]);var dr=0;if(ua<Ue&&Qn<Xt)for(Ur>Or==Ur>-Or?(On=Ki-((Pn=Or+Ki)-Or),Or=Ze[++ua]):(On=Ki-((Pn=Ur+Ki)-Ur),Ur=Ti[++Qn]),Ki=Pn,On!==0&&(Yi[dr++]=On);ua<Ue&&Qn<Xt;)Ur>Or==Ur>-Or?(On=Ki-((Pn=Ki+Or)-(Sr=Pn-Ki))+(Or-Sr),Or=Ze[++ua]):(On=Ki-((Pn=Ki+Ur)-(Sr=Pn-Ki))+(Ur-Sr),Ur=Ti[++Qn]),Ki=Pn,On!==0&&(Yi[dr++]=On);for(;ua<Ue;)On=Ki-((Pn=Ki+Or)-(Sr=Pn-Ki))+(Or-Sr),Or=Ze[++ua],Ki=Pn,On!==0&&(Yi[dr++]=On);for(;Qn<Xt;)On=Ki-((Pn=Ki+Ur)-(Sr=Pn-Ki))+(Ur-Sr),Ur=Ti[++Qn],Ki=Pn,On!==0&&(Yi[dr++]=On);return Ki===0&&dr!==0||(Yi[dr++]=Ki),dr}function Ye(Ue){return new Float64Array(Ue)}var st=33306690738754716e-32,ut=22204460492503146e-32,Ut=11093356479670487e-47,_t=Ye(4),Wt=Ye(8),ni=Ye(12),ri=Ye(16),wi=Ye(4);function Si(Ue,Ze,Xt){var Ti=(function(Yi,Ki,Pn,On,Sr,Or){var Ur=(Ki-Or)*(Pn-Sr),ua=(Yi-Sr)*(On-Or),Qn=Ur-ua;if(Ur===0||ua===0||Ur>0!=ua>0)return Qn;var dr=Math.abs(Ur+ua);return Math.abs(Qn)>=st*dr?Qn:-(function(za,Pa,La,Qa,fs,as,Fa){var Ga,Br,ya,ao,Yn,ha,ls,bs,js,jo,zs,Kn,lo,es,Js,Al,sc,ol,ll=za-fs,$l=La-fs,Xh=Pa-as,Rs=Qa-as;_t[0]=(Js=(bs=ll-(ls=(ha=Ie*ll)-(ha-ll)))*(jo=Rs-(js=(ha=Ie*Rs)-(ha-Rs)))-((es=ll*Rs)-ls*js-bs*js-ls*jo))-((zs=Js-(sc=(bs=Xh-(ls=(ha=Ie*Xh)-(ha-Xh)))*(jo=$l-(js=(ha=Ie*$l)-(ha-$l)))-((Al=Xh*$l)-ls*js-bs*js-ls*jo)))+(Yn=Js-zs))+(Yn-sc),_t[1]=(lo=es-((Kn=es+zs)-(Yn=Kn-es))+(zs-Yn))-((zs=lo-Al)+(Yn=lo-zs))+(Yn-Al),_t[2]=Kn-((ol=Kn+zs)-(Yn=ol-Kn))+(zs-Yn),_t[3]=ol;var Do=(function(Lm,au){for(var Eh=au[0],Gd=1;Gd<4;Gd++)Eh+=au[Gd];return Eh})(0,_t),Vo=ut*Fa;if(Do>=Vo||-Do>=Vo||(Ga=za-(ll+(Yn=za-ll))+(Yn-fs),ya=La-($l+(Yn=La-$l))+(Yn-fs),Br=Pa-(Xh+(Yn=Pa-Xh))+(Yn-as),ao=Qa-(Rs+(Yn=Qa-Rs))+(Yn-as),Ga===0&&Br===0&&ya===0&&ao===0)||(Vo=Ut*Fa+$e*Math.abs(Do),(Do+=ll*ao+Rs*Ga-(Xh*ya+$l*Br))>=Vo||-Do>=Vo))return Do;wi[0]=(Js=(bs=Ga-(ls=(ha=Ie*Ga)-(ha-Ga)))*(jo=Rs-(js=(ha=Ie*Rs)-(ha-Rs)))-((es=Ga*Rs)-ls*js-bs*js-ls*jo))-((zs=Js-(sc=(bs=Br-(ls=(ha=Ie*Br)-(ha-Br)))*(jo=$l-(js=(ha=Ie*$l)-(ha-$l)))-((Al=Br*$l)-ls*js-bs*js-ls*jo)))+(Yn=Js-zs))+(Yn-sc),wi[1]=(lo=es-((Kn=es+zs)-(Yn=Kn-es))+(zs-Yn))-((zs=lo-Al)+(Yn=lo-zs))+(Yn-Al),wi[2]=Kn-((ol=Kn+zs)-(Yn=ol-Kn))+(zs-Yn),wi[3]=ol;var wd=je(4,_t,4,wi,Wt);wi[0]=(Js=(bs=ll-(ls=(ha=Ie*ll)-(ha-ll)))*(jo=ao-(js=(ha=Ie*ao)-(ha-ao)))-((es=ll*ao)-ls*js-bs*js-ls*jo))-((zs=Js-(sc=(bs=Xh-(ls=(ha=Ie*Xh)-(ha-Xh)))*(jo=ya-(js=(ha=Ie*ya)-(ha-ya)))-((Al=Xh*ya)-ls*js-bs*js-ls*jo)))+(Yn=Js-zs))+(Yn-sc),wi[1]=(lo=es-((Kn=es+zs)-(Yn=Kn-es))+(zs-Yn))-((zs=lo-Al)+(Yn=lo-zs))+(Yn-Al),wi[2]=Kn-((ol=Kn+zs)-(Yn=ol-Kn))+(zs-Yn),wi[3]=ol;var Ml=je(wd,Wt,4,wi,ni);wi[0]=(Js=(bs=Ga-(ls=(ha=Ie*Ga)-(ha-Ga)))*(jo=ao-(js=(ha=Ie*ao)-(ha-ao)))-((es=Ga*ao)-ls*js-bs*js-ls*jo))-((zs=Js-(sc=(bs=Br-(ls=(ha=Ie*Br)-(ha-Br)))*(jo=ya-(js=(ha=Ie*ya)-(ha-ya)))-((Al=Br*ya)-ls*js-bs*js-ls*jo)))+(Yn=Js-zs))+(Yn-sc),wi[1]=(lo=es-((Kn=es+zs)-(Yn=Kn-es))+(zs-Yn))-((zs=lo-Al)+(Yn=lo-zs))+(Yn-Al),wi[2]=Kn-((ol=Kn+zs)-(Yn=ol-Kn))+(zs-Yn),wi[3]=ol;var Sp=je(Ml,ni,4,wi,ri);return ri[Sp-1]})(Yi,Ki,Pn,On,Sr,Or,dr)})(Ue[0],Ue[1],Ze[0],Ze[1],Xt[0],Xt[1]);return Ti>0?-1:Ti<0?1:0}function gi(Ue,Ze){var Xt=Ue.point,Ti=Ze.point;return Xt[0]>Ti[0]?1:Xt[0]<Ti[0]?-1:Xt[1]!==Ti[1]?Xt[1]>Ti[1]?1:-1:(function(Yi,Ki,Pn,On){return Yi.left!==Ki.left?Yi.left?1:-1:Si(Pn,Yi.otherEvent.point,Ki.otherEvent.point)!==0?Yi.isBelow(Ki.otherEvent.point)?-1:1:!Yi.isSubject&&Ki.isSubject?1:-1})(Ue,Ze,Xt)}function yi(Ue,Ze,Xt){var Ti=new le(Ze,!1,Ue,Ue.isSubject),Yi=new le(Ze,!0,Ue.otherEvent,Ue.isSubject);return ye(Ue.point,Ue.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ue),Ti.contourId=Yi.contourId=Ue.contourId,gi(Yi,Ue.otherEvent)>0&&(Ue.otherEvent.left=!0,Yi.left=!1),Ue.otherEvent.otherEvent=Yi,Ue.otherEvent=Ti,Xt.push(Yi),Xt.push(Ti),Xt}function Zt(Ue,Ze){return Ue[0]*Ze[1]-Ue[1]*Ze[0]}function qt(Ue,Ze){return Ue[0]*Ze[0]+Ue[1]*Ze[1]}function vi(Ue,Ze,Xt){var Ti=(function(Sr,Or,Ur,ua,Qn){var dr=[Or[0]-Sr[0],Or[1]-Sr[1]],za=[ua[0]-Ur[0],ua[1]-Ur[1]];function Pa(ha,ls,bs){return[ha[0]+ls*bs[0],ha[1]+ls*bs[1]]}var La=[Ur[0]-Sr[0],Ur[1]-Sr[1]],Qa=Zt(dr,za),fs=Qa*Qa,as=qt(dr,dr);if(fs>0){var Fa=Zt(La,za)/Qa;if(Fa<0||Fa>1)return null;var Ga=Zt(La,dr)/Qa;return Ga<0||Ga>1?null:Fa===0||Fa===1?[Pa(Sr,Fa,dr)]:Ga===0||Ga===1?[Pa(Ur,Ga,za)]:[Pa(Sr,Fa,dr)]}if((fs=(Qa=Zt(La,dr))*Qa)>0)return null;var Br=qt(dr,La)/as,ya=Br+qt(dr,za)/as,ao=Math.min(Br,ya),Yn=Math.max(Br,ya);return ao<=1&&Yn>=0?ao===1?[Pa(Sr,ao>0?ao:0,dr)]:Yn===0?[Pa(Sr,Yn<1?Yn:1,dr)]:[Pa(Sr,ao>0?ao:0,dr),Pa(Sr,Yn<1?Yn:1,dr)]:null})(Ue.point,Ue.otherEvent.point,Ze.point,Ze.otherEvent.point),Yi=Ti?Ti.length:0;if(Yi===0||Yi===1&&(ye(Ue.point,Ze.point)||ye(Ue.otherEvent.point,Ze.otherEvent.point))||Yi===2&&Ue.isSubject===Ze.isSubject)return 0;if(Yi===1)return ye(Ue.point,Ti[0])||ye(Ue.otherEvent.point,Ti[0])||yi(Ue,Ti[0],Xt),ye(Ze.point,Ti[0])||ye(Ze.otherEvent.point,Ti[0])||yi(Ze,Ti[0],Xt),1;var Ki=[],Pn=!1,On=!1;return ye(Ue.point,Ze.point)?Pn=!0:gi(Ue,Ze)===1?Ki.push(Ze,Ue):Ki.push(Ue,Ze),ye(Ue.otherEvent.point,Ze.otherEvent.point)?On=!0:gi(Ue.otherEvent,Ze.otherEvent)===1?Ki.push(Ze.otherEvent,Ue.otherEvent):Ki.push(Ue.otherEvent,Ze.otherEvent),Pn&&On||Pn?(Ze.type=x,Ue.type=Ze.inOut===Ue.inOut?E:C,Pn&&!On&&yi(Ki[1].otherEvent,Ki[0].point,Xt),2):On?(yi(Ki[0],Ki[1].point,Xt),3):Ki[0]!==Ki[3].otherEvent?(yi(Ki[0],Ki[1].point,Xt),yi(Ki[1],Ki[2].point,Xt),3):(yi(Ki[0],Ki[1].point,Xt),yi(Ki[3].otherEvent,Ki[2].point,Xt),3)}function Bi(Ue,Ze){if(Ue===Ze)return 0;if(Si(Ue.point,Ue.otherEvent.point,Ze.point)!==0||Si(Ue.point,Ue.otherEvent.point,Ze.otherEvent.point)!==0)return ye(Ue.point,Ze.point)?Ue.isBelow(Ze.otherEvent.point)?-1:1:Ue.point[0]===Ze.point[0]?Ue.point[1]<Ze.point[1]?-1:1:gi(Ue,Ze)===1?Ze.isAbove(Ue.point)?-1:1:Ue.isBelow(Ze.point)?-1:1;if(Ue.isSubject!==Ze.isSubject)return Ue.isSubject?-1:1;var Xt=Ue.point,Ti=Ze.point;return Xt[0]===Ti[0]&&Xt[1]===Ti[1]?(Xt=Ue.otherEvent.point)[0]===(Ti=Ze.otherEvent.point)[0]&&Xt[1]===Ti[1]?0:Ue.contourId>Ze.contourId?1:-1:gi(Ue,Ze)===1?1:-1}var zi=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Dn(Ue,Ze,Xt,Ti){var Yi,Ki=Ue+1,Pn=Ze[Ue].point,On=Ze.length;for(Ki<On&&(Yi=Ze[Ki].point);Ki<On&&Yi[0]===Pn[0]&&Yi[1]===Pn[1];){if(!Xt[Ki])return Ki;++Ki<On&&(Yi=Ze[Ki].point)}for(Ki=Ue-1;Xt[Ki]&&Ki>Ti;)Ki--;return Ki}zi.prototype.isExterior=function(){return this.holeOf==null};var rn=wn,cn=wn;function wn(Ue,Ze){if(!(this instanceof wn))return new wn(Ue,Ze);if(this.data=Ue||[],this.length=this.data.length,this.compare=Ze||Hr,this.length>0)for(var Xt=(this.length>>1)-1;Xt>=0;Xt--)this._down(Xt)}function Hr(Ue,Ze){return Ue<Ze?-1:Ue>Ze?1:0}wn.prototype={push:function(Ue){this.data.push(Ue),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ue=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ue}},peek:function(){return this.data[0]},_up:function(Ue){for(var Ze=this.data,Xt=this.compare,Ti=Ze[Ue];Ue>0;){var Yi=Ue-1>>1,Ki=Ze[Yi];if(Xt(Ti,Ki)>=0)break;Ze[Ue]=Ki,Ue=Yi}Ze[Ue]=Ti},_down:function(Ue){for(var Ze=this.data,Xt=this.compare,Ti=this.length>>1,Yi=Ze[Ue];Ue<Ti;){var Ki=1+(Ue<<1),Pn=Ki+1,On=Ze[Ki];if(Pn<this.length&&Xt(Ze[Pn],On)<0&&(Ki=Pn,On=Ze[Pn]),Xt(On,Yi)>=0)break;Ze[Ue]=On,Ue=Ki}Ze[Ue]=Yi}},rn.default=cn;var Di=Math.max,Sn=Math.min,mr=0;function pa(Ue,Ze,Xt,Ti,Yi,Ki){var Pn,On,Sr,Or,Ur,ua;for(Pn=0,On=Ue.length-1;Pn<On;Pn++)if(Or=Ue[Pn+1],Ur=new le(Sr=Ue[Pn],!1,void 0,Ze),ua=new le(Or,!1,Ur,Ze),Ur.otherEvent=ua,Sr[0]!==Or[0]||Sr[1]!==Or[1]){Ur.contourId=ua.contourId=Xt,Ki||(Ur.isExteriorRing=!1,ua.isExteriorRing=!1),gi(Ur,ua)>0?ua.left=!0:Ur.left=!0;var Qn=Sr[0],dr=Sr[1];Yi[0]=Sn(Yi[0],Qn),Yi[1]=Sn(Yi[1],dr),Yi[2]=Di(Yi[2],Qn),Yi[3]=Di(Yi[3],dr),Ti.push(Ur),Ti.push(ua)}}var wa=[];function Dr(Ue,Ze,Xt){typeof Ue[0][0][0]=="number"&&(Ue=[Ue]),typeof Ze[0][0][0]=="number"&&(Ze=[Ze]);var Ti=(function(dr,za,Pa){var La=null;return dr.length*za.length==0&&(Pa===k?La=wa:Pa===j?La=dr:Pa!==B&&Pa!==U||(La=dr.length===0?za:dr)),La})(Ue,Ze,Xt);if(Ti)return Ti===wa?null:Ti;var Yi=[1/0,1/0,-1/0,-1/0],Ki=[1/0,1/0,-1/0,-1/0],Pn=(function(dr,za,Pa,La,Qa){var fs,as,Fa,Ga,Br,ya,ao=new rn(null,gi);for(Fa=0,Ga=dr.length;Fa<Ga;Fa++)for(Br=0,ya=(fs=dr[Fa]).length;Br<ya;Br++)(as=Br===0)&&mr++,pa(fs[Br],!0,mr,ao,Pa,as);for(Fa=0,Ga=za.length;Fa<Ga;Fa++)for(Br=0,ya=(fs=za[Fa]).length;Br<ya;Br++)as=Br===0,Qa===j&&(as=!1),as&&mr++,pa(fs[Br],!1,mr,ao,La,as);return ao})(Ue,Ze,Yi,Ki,Xt);if(Ti=(function(dr,za,Pa,La,Qa){var fs=null;return(Pa[0]>La[2]||La[0]>Pa[2]||Pa[1]>La[3]||La[1]>Pa[3])&&(Qa===k?fs=wa:Qa===j?fs=dr:Qa!==B&&Qa!==U||(fs=dr.concat(za))),fs})(Ue,Ze,Yi,Ki,Xt))return Ti===wa?null:Ti;for(var On=(function(dr){var za,Pa,La=(function(Fa){var Ga,Br,ya,ao,Yn=[];for(Br=0,ya=Fa.length;Br<ya;Br++)((Ga=Fa[Br]).left&&Ga.inResult||!Ga.left&&Ga.otherEvent.inResult)&&Yn.push(Ga);for(var ha=!1;!ha;)for(ha=!0,Br=0,ya=Yn.length;Br<ya;Br++)Br+1<ya&&gi(Yn[Br],Yn[Br+1])===1&&(ao=Yn[Br],Yn[Br]=Yn[Br+1],Yn[Br+1]=ao,ha=!1);for(Br=0,ya=Yn.length;Br<ya;Br++)(Ga=Yn[Br]).otherPos=Br;for(Br=0,ya=Yn.length;Br<ya;Br++)(Ga=Yn[Br]).left||(ao=Ga.otherPos,Ga.otherPos=Ga.otherEvent.otherPos,Ga.otherEvent.otherPos=ao);return Yn})(dr),Qa={},fs=[],as=function(){if(!Qa[za]){var Fa=fs.length,Ga=(function(Yn,ha,ls){var bs=new zi;if(Yn.prevInResult!=null){var js=Yn.prevInResult,jo=js.outputContourId;if(js.resultTransition>0){var zs=ha[jo];if(zs.holeOf!=null){var Kn=zs.holeOf;ha[Kn].holeIds.push(ls),bs.holeOf=Kn,bs.depth=ha[jo].depth}else ha[jo].holeIds.push(ls),bs.holeOf=jo,bs.depth=ha[jo].depth+1}else bs.holeOf=null,bs.depth=ha[jo].depth}else bs.holeOf=null,bs.depth=0;return bs})(La[za],fs,Fa),Br=function(Yn){Qa[Yn]=!0,Yn<La.length&&La[Yn]&&(La[Yn].outputContourId=Fa)},ya=za,ao=za;for(Ga.points.push(La[za].point);Br(ya),Br(ya=La[ya].otherPos),Ga.points.push(La[ya].point),!((ya=Dn(ya,La,Qa,ao))==ao||ya>=La.length)&&La[ya];);fs.push(Ga)}};for(za=0,Pa=La.length;za<Pa;za++)as();return fs})((function(dr,za,Pa,La,Qa,fs){for(var as,Fa,Ga,Br=new i(Bi),ya=[],ao=Math.min(La[2],Qa[2]);dr.length!==0;){var Yn=dr.pop();if(ya.push(Yn),fs===k&&Yn.point[0]>ao||fs===j&&Yn.point[0]>La[2])break;if(Yn.left){Fa=as=Br.insert(Yn),as=as!==(Ga=Br.minNode())?Br.prev(as):null,Fa=Br.next(Fa);var ha=as?as.key:null;if($(Yn,ha,fs),Fa&&vi(Yn,Fa.key,dr)===2&&($(Yn,ha,fs),$(Fa.key,Yn,fs)),as&&vi(as.key,Yn,dr)===2){var ls=as;$(ha,(ls=ls!==Ga?Br.prev(ls):null)?ls.key:null,fs),$(Yn,ha,fs)}}else Fa=as=Br.find(Yn=Yn.otherEvent),as&&Fa&&(as=as!==Ga?Br.prev(as):null,Fa=Br.next(Fa),Br.remove(Yn),Fa&&as&&vi(as.key,Fa.key,dr))}return ya})(Pn,0,0,Yi,Ki,Xt)),Sr=[],Or=0;Or<On.length;Or++){var Ur=On[Or];if(Ur.isExterior()){for(var ua=[Ur.points],Qn=0;Qn<Ur.holeIds.length;Qn++)ua.push(On[Ur.holeIds[Qn]].points);Sr.push(ua)}}return Sr}var rs={UNION:B,DIFFERENCE:j,INTERSECTION:k,XOR:U};r.diff=function(Ue,Ze){return Dr(Ue,Ze,j)},r.intersection=function(Ue,Ze){return Dr(Ue,Ze,k)},r.operations=rs,r.union=function(Ue,Ze){return Dr(Ue,Ze,B)},r.xor=function(Ue,Ze){return Dr(Ue,Ze,U)},Object.defineProperty(r,"__esModule",{value:!0})})(lr.exports)),lr.exports);function Zi(r,e,i,s){const u=[],p=s===0?(_,x,E,C,k,B)=>{_.push(new Ge(B,E+(B-x)/(C-x)*(k-E)))}:(_,x,E,C,k,B)=>{_.push(new Ge(x+(B-E)/(k-E)*(C-x),B))};for(const _ of r){const x=[];for(const E of _){if(E.length<=2)continue;const C=[];for(let j=0;j<E.length-1;j++){const U=E[j].x,$=E[j].y,ee=E[j+1].x,le=E[j+1].y,oe=s===0?U:$,ye=s===0?ee:le;oe<e?ye>e&&p(C,U,$,ee,le,e):oe>i?ye<i&&p(C,U,$,ee,le,i):C.push(E[j]),ye<e&&oe>=e&&p(C,U,$,ee,le,e),ye>i&&oe<=i&&p(C,U,$,ee,le,i)}let k=E[E.length-1];const B=s===0?k.x:k.y;B>=e&&B<=i&&C.push(k),C.length&&(k=C[C.length-1],C[0].x===k.x&&C[0].y===k.y||C.push(C[0]),x.push(C))}x.length&&u.push(x)}return u}function or(r,e){const i=aa(r),s=aa([e]),u=nr.intersection(i,s);return u==null?[]:vs(u)}function Tr(r,e){let s=aa(r,65536);const u=[];for(;e.valid();e.next()){const[p,_]=e.get(),x=p.x*65536,E=p.y*65536,C=_.x*65536,k=_.y*65536,B=C-x,j=k-E,U=Math.hypot(B,j);if(U===0)continue;const $=Math.trunc(j/U*3),ee=-Math.trunc(B/U*3);u.push([[[x,E],[C,k],[C+$,k+ee],[x+$,E+ee],[x,E]]])}return u.length>0&&(s=nr.diff(s,u)),vs(s,1/65536)}function aa(r,e=1){return[r.map((i=>i.map((s=>[s.x*e,s.y*e]))))]}function vs(r,e=1){return r.map((i=>i.map(((s,u)=>{const p=s.map((_=>new Ge(_[0]*e,_[1]*e).round()));return u>0&&p.reverse(),p}))))}class ro{constructor(e,i){this.layoutVertexArray=new uf,this.indexArray=new co,this.lineIndexArray=new wu,this.triangleSegments=new Ss,this.lineSegments=new Ss,this.programConfigurations=new gh(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new qh)}update(e,i,s,u,p,_,x,E){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,x,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Jm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,s,u,p,_,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,s,u,p,_,void 0,x)}}class Tl{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new ro(e,!1),this.elevationBufferData=new ro(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){this.hasPattern=Fi("fill",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:E,index:C,sourceLayerIndex:k}of e){const B=this.layers[0]._featureFilter.needGeometry,j=mt(x,B);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),j,s))continue;const U=p?p.evaluate(j,{},s,i.availableImages):void 0,$={id:E,properties:x.properties,type:x.type,sourceLayerIndex:k,index:C,geometry:B?j.geometry:nt(x,s,u),patterns:{},sortKey:U};_.push($)}p&&_.sort(((x,E)=>x.sortKey-E.sortKey));for(const x of _){const{geometry:E,index:C,sourceLayerIndex:k}=x;if(this.hasPattern){const B=gn("fill",this.layers,x,this.zoom,this.pixelRatio,i);this.patternFeatures.push(B)}else this.addFeature(x,E,C,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[C].feature,E,C,k,this.index)}}update(e,i,s,u,p,_,x){this.bufferData.update(e,i,s,u,p,_,x,this.worldview),this.elevationBufferData.update(e,i,s,u,p,_,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,s,u,p,_,x,this.worldview)}addFeatures(e,i,s,u,p,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,s,u,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,s,u,p,_=[],x,E){const C=ai(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,C,u,s,E):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(e,s,p,_,u,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,s,p,_,u,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,s,u,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,s,u,p,this.worldview))}addElevatedRoadFeature(e,i,s,u,p){const _=new Array,x=xr.getElevationFeature(e,p);if(!x)return void this.addGeometry(i,this.bufferData);{const C=this.clipPolygonsToTile(i,1);C.length>0&&_.push({polygons:C,elevationFeature:x,elevationTileID:s})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},s),featureIndex:u};for(const C of _)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Mn(C.elevationTileID,this.layers,this.zoom,this.lut));const B=C.elevationFeature.isTunnel();let j=0;e.properties.hasOwnProperty(Lt)&&(j=+e.properties[Lt]);for(const U of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,U,B,C.elevationFeature,j)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));const k=new Zr(s,C.elevationTileID);this.addElevatedGeometry(C.polygons,k,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,E)}}addElevatedGeometry(e,i,s,u,p,_){const x={elevation:s,elevationSampler:i,bias:u,index:p,featureInfo:_},[E,C]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(e,i,s){let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,_=null;s&&(_=s.elevationSampler.constantElevation(s.elevation,s.bias),_!=null&&(u=_,p=_));const x=(E,C,k)=>{if(s!=null)if(C.push(E),_!=null)i.elevatedLayoutVertexArray.emplaceBack(_),k.push(_);else{const B=s.elevationSampler.pointElevation(E,s.elevation,s.bias);i.elevatedLayoutVertexArray.emplaceBack(B),k.push(B),u=Math.min(u,B),p=Math.max(p,B)}};for(const E of e){let C=0;for(const xe of E)C+=xe.length;const k=i.triangleSegments.prepareSegment(C,i.layoutVertexArray,i.indexArray),B=k.vertexLength,j=[],U=[],$=[],ee=[],le=[],oe=i.layoutVertexArray.length;for(const xe of E){if(xe.length===0)continue;xe!==E[0]&&U.push(j.length/2);const Ie=i.lineSegments.prepareSegment(xe.length,i.layoutVertexArray,i.lineIndexArray),$e=Ie.vertexLength;s&&le.push(i.layoutVertexArray.length-oe),x(xe[0],$,ee),i.layoutVertexArray.emplaceBack(xe[0].x,xe[0].y),i.lineIndexArray.emplaceBack($e+xe.length-1,$e),j.push(xe[0].x),j.push(xe[0].y);for(let je=1;je<xe.length;je++)x(xe[je],$,ee),i.layoutVertexArray.emplaceBack(xe[je].x,xe[je].y),i.lineIndexArray.emplaceBack($e+je-1,$e+je),j.push(xe[je].x),j.push(xe[je].y);Ie.vertexLength+=xe.length,Ie.primitiveLength+=xe.length}const ye=Jp(j,U);for(let xe=0;xe<ye.length;xe+=3)i.indexArray.emplaceBack(B+ye[xe],B+ye[xe+1],B+ye[xe+2]);if(ye.length>0&&s&&this.elevationMode==="hd-road-base"){const xe=s.elevation.isTunnel(),Ie=s.elevation.safeArea,$e=this.elevatedStructures.addVertices($,ee);this.elevatedStructures.addTriangles(ye,$e,xe);const je=le.length;if(je>0){for(let Ye=0;Ye<je-1;Ye++)this.elevatedStructures.addRenderableRing(s.index,le[Ye]+$e,le[Ye+1]-le[Ye],xe,Ie,s.featureInfo);this.elevatedStructures.addRenderableRing(s.index,le[je-1]+$e,$.length-le[je-1],xe,Ie,s.featureInfo)}}k.vertexLength+=C,k.primitiveLength+=ye.length/3}return[u,p]}prepareElevatedPolygons(e,i,s){const u=1/me(s),p=[];for(const _ of e){const x=Tr(_,new ca(i,u));p.push(...x)}return p}clipPolygonsToTile(e,i){const s=-i,u=-i,p=pi+i,_=pi+i;let x=0;const E=[],C=[];for(;x<e.length;x++){const j=e[x],U=Pc(j);(U.min.x>=s&&U.max.x<=p&&U.min.y>=u&&U.max.y<=_?E:C).push(j)}if(E.length===e.length)return e;const k=[new Ge(s,u),new Ge(p,u),new Ge(p,_),new Ge(s,_),new Ge(s,u)],B=E;for(const j of C)B.push(...or(j,k));return B}}let Bc,nc,Gl,tu;hi(Tl,"FillBucket",{omit:["layers","patternFeatures"]}),hi(ro,"FillBufferData"),hi(Mn,"ElevatedStructures");class Tc{constructor(e,i,s,u){if(this.triangleCount=i.length/3,this.min=new Ge(0,0),this.max=new Ge(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,_]=[e[0].clone(),e[0].clone()];for(let B=1;B<e.length;++B){const j=e[B];p.x=Math.min(p.x,j.x),p.y=Math.min(p.y,j.y),_.x=Math.max(_.x,j.x),_.y=Math.max(_.y,j.y)}if(u){const B=Math.ceil(Math.max(_.x-p.x,_.y-p.y)/u);s=Math.max(s,B)}if(s===0)return;this.min=p,this.max=_;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const E=Math.max(x.x,x.y)/s;this.cellsX=Math.max(1,Math.ceil(x.x/E)),this.cellsY=Math.max(1,Math.ceil(x.y/E)),this.xScale=1/E,this.yScale=1/E;const C=[];for(let B=0;B<this.triangleCount;B++){const j=e[i[3*B+0]].sub(this.min),U=e[i[3*B+1]].sub(this.min),$=e[i[3*B+2]].sub(this.min),ee=il(Math.floor(Math.min(j.x,U.x,$.x)),this.xScale,this.cellsX),le=il(Math.floor(Math.max(j.x,U.x,$.x)),this.xScale,this.cellsX),oe=il(Math.floor(Math.min(j.y,U.y,$.y)),this.yScale,this.cellsY),ye=il(Math.floor(Math.max(j.y,U.y,$.y)),this.yScale,this.cellsY),xe=new Ge(0,0),Ie=new Ge(0,0),$e=new Ge(0,0),je=new Ge(0,0);for(let Ye=oe;Ye<=ye;++Ye){xe.y=Ie.y=Ye*E,$e.y=je.y=(Ye+1)*E;for(let st=ee;st<=le;++st)xe.x=$e.x=st*E,Ie.x=je.x=(st+1)*E,($o(j,U,$,xe,Ie,je)||$o(j,U,$,xe,je,$e))&&C.push({cellIdx:Ye*this.cellsX+st,triIdx:B})}}if(C.length===0)return;C.sort(((B,j)=>B.cellIdx-j.cellIdx||B.triIdx-j.triIdx));let k=0;for(;k<C.length;){const B=C[k].cellIdx,j={start:this.payload.length,len:0};for(;k<C.length&&C[k].cellIdx===B;)++j.len,this.payload.push(C[k++].triIdx);this.cells[B]=j}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=il(e.x-this.min.x,this.xScale,this.cellsX),u=il(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[u*this.cellsX+s];if(p){this._lazyInitLookup();for(let _=0;_<p.len;_++){const x=this.payload[p.start+_],E=Math.floor(x/8),C=1<<x%8;if(!(this.lookup[E]&C)&&(this.lookup[E]|=C,i.push(x),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const u=il(e.x-this.min.x,this.xScale,this.cellsX),p=il(i.x-this.min.x,this.xScale,this.cellsX),_=il(e.y-this.min.y,this.yScale,this.cellsY),x=il(i.y-this.min.y,this.yScale,this.cellsY);for(let E=_;E<=x;E++)for(let C=u;C<=p;C++){const k=this.cells[E*this.cellsX+C];if(k)for(let B=0;B<k.len;B++){const j=this.payload[k.start+B],U=Math.floor(j/8),$=1<<j%8;if(!(this.lookup[U]&$)&&(this.lookup[U]|=$,s.push(j),s.length===this.triangleCount))return}}}}function il(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}hi(Tc,"TriangleGridIndex");class nl{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}updateAppearances(e,i,s,u){}populate(e,i,s,u){const p=[];for(const{feature:_,id:x,index:E,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,B=mt(_,k);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),B,s))continue;const j={id:x,properties:_.properties,type:_.type,sourceLayerIndex:C,index:E,geometry:k?B.geometry:nt(_,s,u),patterns:{}};p.push(j)}for(const _ of p){const{geometry:x,index:E,sourceLayerIndex:C}=_;this.addFeature(_,x,E,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[E].feature,x,E,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,u,p,_,x){}destroy(){}addFeature(e,i,s,u,p,_=[],x){for(const E of ai(i,2)){const C=[],k=[],B=[],j=new Ge(1/0,1/0),U=new Ge(-1/0,-1/0);for(const le of E)if(le.length!==0){le!==E[0]&&B.push(k.length/2);for(let oe=0;oe<le.length;oe++)k.push(le[oe].x),k.push(le[oe].y),C.push(le[oe]),j.x=Math.min(j.x,le[oe].x),j.y=Math.min(j.y,le[oe].y),U.x=Math.max(U.x,le[oe].x),U.y=Math.max(U.y,le[oe].y)}const $=Jp(k,B),ee=new Tc(C,$,8,256);this.footprints.push({vertices:C,indices:$,grid:ee,min:j,max:U})}}}hi(nl,"ClipBucket",{omit:["layers"]});const rc=Yr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),iu=Yr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Sc=Yr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Hl=Yr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Sl=Yr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),bh=Yr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Ju=Yr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:os}=rc,Bs=Number.MAX_SAFE_INTEGER,To=Bs-1;function Nc(r,e,i,s){return r.order<e||r.order===Bs||!(r.clipMask&i)||(function(u,p){return p.length!==0&&p.find((_=>_===u))===void 0})(s,r.clipScope)}function So(r,e){return r.x-e.x||r.y-e.y}function Zf(r,e){return So(r.min,e.min)===0&&So(r.max,e.max)===0}function Qu(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function wh(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!Zf(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!ei(r[i].clipScope,e[i].clipScope))return!1;return!0}function Th(r,e,i){const s=1/pi,u=1/(1<<i.canonical.z),p=(e.x*s+i.canonical.x)*u+i.wrap,_=(e.y*s+i.canonical.y)*u;return{min:new Ge((r.x*s+i.canonical.x)*u+i.wrap,(r.y*s+i.canonical.y)*u),max:new Ge(p,_)}}function Wh(r,e,i){const s=1<<i.canonical.z,u=((e.x-i.wrap)*s-i.canonical.x)*pi,p=(e.y*s-i.canonical.y)*pi;return{min:new Ge(((r.x-i.wrap)*s-i.canonical.x)*pi,(r.y*s-i.canonical.y)*pi),max:new Ge(u,p)}}function El(r,e,i,s,u,p,_){const x=r.indices,E=r.vertices,C=[];for(let k=s;k<s+u;k+=3){const B=e[i[k+0]+p],j=e[i[k+1]+p],U=e[i[k+2]+p],$=Math.min(B.x,j.x,U.x),ee=Math.max(B.x,j.x,U.x),le=Math.min(B.y,j.y,U.y),oe=Math.max(B.y,j.y,U.y);C.length=0,r.grid.query(new Ge($,le),new Ge(ee,oe),C);for(let ye=0;ye<C.length;ye++){const xe=C[ye];if($o(E[x[3*xe+0]],E[x[3*xe+1]],E[x[3*xe+2]],B,j,U,_))return!0}}return!1}function Tf(r,e,i,s){if(!r||!i)return!1;let u=r.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<r.vertices.length)return Tf(i,s,r,e);const p=e.canonical,_=s.canonical,x=Math.pow(2,_.z-p.z);u=r.vertices.map((E=>new Ge((E.x+p.x*pi)*x-_.x*pi,(E.y+p.y*pi)*x-_.y*pi)))}return El(i,u,r.indices,0,r.indices.length,0,0)}function bp(r,e,i,s){const u=Math.pow(2,s.z-i.z);return new Ge((r+i.x*pi)*u-s.x*pi,(e+i.y*pi)*u-s.y*pi)}function D_(r,e){const i=[];e.grid.queryPoint(r,i);const s=e.indices,u=e.vertices;for(let p=0;p<i.length;p++){const _=i[p];if(Wa([u[s[3*_+0]],u[s[3*_+1]],u[s[3*_+2]]],r))return!0}return!1}const Qp=[new Ge(0,0),new Ge(pi,0),new Ge(pi,pi),new Ge(0,pi)];function em(r,e){const i=[];let s=[];if(!e||r.length<2)return[r];if(r.length===2)return el(r[0],r[1],Qp)?[r]:[];for(let u=0;u<r.length+2;u++){const p=r[u%r.length],_=r[(u+1)%r.length],x=el(u===0?r[r.length-1]:r[(u-1)%r.length],p,Qp),E=el(p,_,Qp),C=x||E;C&&s.push(p),C&&E||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const wp=dt.types,Wf=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Cm=["fill-extrusion-flood-light-ground-radius"],Y_=Math.pow(2,13),K_=Math.pow(2,15)-1,P_=new Ge(0,1),Sf=2147483648,L_=7,y_=450;function zm(r,e,i,s,u,p,_,x){r.emplaceBack((e<<1)+_,(i<<1)+p,(Math.floor(s*Y_)<<1)+u,Math.round(x))}function Rm(r,e,i){r.emplaceBack(e.x*pi,e.y*pi,i?1:0)}function tm(r,e,i,s,u,p){r.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+u,p)}function eh(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class t_{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class i_{constructor(){this.centroidXY=new Ge(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ge(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ge(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ge(this.max.x-this.min.x,this.max.y-this.min.y)}}class v_{constructor(){this.acc=new Ge(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===pi)&&i.x===s.x)!=((i.y===0||i.y===pi)&&i.y===s.y)&&this.processBorderOverlap(i,s),u&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Hn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>pi!=e.x>pi&&this.addBorderIntersection(1,Hn(i.y,e.y,(pi-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Hn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>pi!=e.y>pi&&this.addBorderIntersection(3,Hn(i.x,e.x,(pi-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new Ge(0,0):new Ge(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function n_(r,e){const i=r.add(e)._unit(),s=te(r.x*i.x+r.y*i.y,-1,1);var u,p,_;return u=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(u)))/4*K_*((p=r).x*(_=e).y-p.y*_.x<0?-1:1)}const k_=[r=>r.x<0,r=>r.x>pi,r=>r.y<0,r=>r.y>pi];function jc(r,e,i,s){const u=[4];if(s===0)return u;i._mult(s);const p=r.sub(i),_=e.sub(i),x=[r,e,p,_];for(let E=0;E<4;E++)for(const C of x)if(k_[E](C)){u.push(E);break}return u}class nu{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Fp,this.indexArray=new co,this.programConfigurations=new gh(e.layers,{zoom:e.zoom,lut:e.lut},(i=>Cm.includes(i))),this._segments=new Ss,this.hiddenByLandmarkVertexArray=new hl,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Ss}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,u=!1){const p=e.length;if(p>2){let _=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let E;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const C=e[0],k=e[1];E=n_(C.sub(e[p-1])._perp()._unit(),k.sub(C)._perp()._unit())}for(let C=0;C<p;C++){const k=C===p-1?0:C+1,B=e[C],j=e[k],U=e[k===p-1?0:k+1],$=j.sub(B)._perp()._unit(),ee=n_($,U.sub(j)._perp()._unit()),le=E,oe=ee;if(r_(B,j,i)||u&&im(B,i)&&im(j,i)){E=ee;continue}const ye=x.vertexLength;tm(this.vertexArray,B,j,1,1,le),tm(this.vertexArray,B,j,1,0,le),tm(this.vertexArray,B,j,0,1,oe),tm(this.vertexArray,B,j,0,0,oe),x.vertexLength+=4;const xe=jc(B,j,$,s);for(const Ie of xe)this._segmentToGroundQuads[_].push({id:ye,region:Ie}),this._segmentToRegionTriCounts[_][Ie]+=2,x.primitiveLength+=2;E=ee}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort(((u,p)=>u.region-p.region));for(let s=0;s<i;s++){const u=this._segmentToGroundQuads[s],p=e[s],_=this._segmentToRegionTriCounts[s];_.reduce(((E,C)=>E+C),0);let x=0;for(let E=0;E<=4;E++){const C=_[E];if(C!==0){let k=this.regionSegments[E];k||(k=this.regionSegments[E]=new Ss);const B={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+x,vertexLength:p.vertexLength,primitiveLength:C};k.get().push(B)}x+=C}for(let E=0;E<u.length;E++){const C=u[E].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,u,p,_,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,u,p,_,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,iu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,Sc.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,u,p,_,x,E){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,u,p,_,x,E)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Sf))}updateHiddenByLandmarkRange(e,i,s){if(!this.hasData())return;const u=i+e;if(i!==0){for(let p=e;p<u;++p)this.hiddenByLandmarkVertexArray.emplace(p,s?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,bh.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class ru{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new co,this.footprintVertices=new uf,this.footprintSegments=[],this.layoutVertexArray=new hf,this.centroidVertexArray=new jp,this.wallVertexArray=new _p,this.indexArray=new co,this.programConfigurations=new gh(e.layers,{zoom:e.zoom,lut:e.lut},(i=>Wf.includes(i))),this.segments=new Ss,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new nu(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){this.features=[],this.hasPattern=Fi("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=me(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:_,index:x,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,k=mt(p,C);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,s))continue;const B={id:_,sourceLayerIndex:E,index:x,geometry:C?k.geometry:nt(p,s,u),properties:p.properties,type:p.type,patterns:{}},j=this.layoutVertexArray.length,U=wp[B.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:gn("fill-extrusion",this.layers,B,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const $ of B.geometry)for(const ee of em($,U))this.addFeature(p.id,B,[ee],x,s,{},i.availableImages,u,i.brightness);else this.addFeature(p.id,B,B.geometry,x,s,{},i.availableImages,u,i.brightness);i.featureIndex.insert(p,B.geometry,x,E,this.index,j)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,u,p,_){for(const{featureId:x,feature:E}of this.features){const C=wp[E.type]==="Polygon",{geometry:k}=E;if(this.wallMode)for(const B of k)for(const j of em(B,C))this.addFeature(x,E,[j],E.index,i,s,u,p,_);else this.addFeature(x,E,k,E.index,i,s,u,p,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,u,p,_,x){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,x,this.worldview),this.groundEffect.update(e,i,p,s,u,_,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,os),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Sl.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Ju.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Hl.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,u,p,_,x,E,C){const k=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,B=[new Ge(0,0),new Ge(pi,pi)],j=E.projection,U=j.name==="globe",$=this.wallMode||wp[i.type]==="Polygon",ee=new v_;ee.centroidDataIndex=this.centroidData.length;const le=new i_;le.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(le.buildingId=i.properties.building_id);const oe=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},p)<=0,ye=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},p);let xe;if(le.height=ye,le.vertexArrayOffset=this.layoutVertexArray.length,le.groundVertexArrayOffset=this.groundEffect.vertexArray.length,U&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new df),this.wallMode){if(U)return void ji("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;xe=(function(_t){const Wt=_t[0].x===_t[_t.length-1].x&&_t[0].y===_t[_t.length-1].y;(function(cn){let wn=0;const Hr=cn.length;for(let Di=0;Di<Hr;Di++)wn+=(cn[(Di+1)%Hr].x-cn[Di].x)*(cn[(Di+1)%Hr].y+cn[Di].y);return wn>=0})(_t)||(_t=_t.reverse());const ri={geometry:[],joinNormals:[],indices:[]},wi=[],Si=[],gi=[];let yi=_t.length;for(;yi>=2&&_t[yi-1].equals(_t[yi-2]);)yi--;if(yi<(Wt?3:2))return ri;let Zt,qt,vi,Bi,zi,Dn=0;for(;Dn<yi-1&&_t[Dn].equals(_t[Dn+1]);)Dn++;Wt&&(Zt=_t[yi-2],zi=_t[Dn].sub(Zt)._unit()._perp());for(let cn=Dn;cn<yi;cn++){if(vi=cn===yi-1?Wt?_t[Dn+1]:void 0:_t[cn+1],vi&&_t[cn].equals(vi))continue;zi&&(Bi=zi),Zt&&(qt=Zt),Zt=_t[cn],zi=vi?vi.sub(Zt)._unit()._perp():Bi,Bi=Bi||zi;let wn=Bi.add(zi);wn.x===0&&wn.y===0||wn._unit();const Hr=wn.x*zi.x+wn.y*zi.y,Di=Hr!==0?1/Hr:1/0,Sn=Bi.x*zi.y-Bi.y*zi.x>0;let mr="miter";const pa=2;mr==="miter"&&Di>pa&&(mr="bevel"),mr==="bevel"&&(Di>100&&(mr="flipbevel"),Di<pa&&(mr="miter"));const wa=(Dr,rs,Ue,Ze)=>{const Xt=new Ge(Dr.x,Dr.y),Ti=new Ge(Dr.x,Dr.y);Xt.x+=rs.x*Ze,Xt.y+=rs.y*Ze,Ti.x-=rs.x*Math.max(Ue,1),Ti.y-=rs.y*Math.max(Ue,1),gi.push(rs),wi.push(Xt),Si.push(Ti)};if(mr==="miter")wn._mult(Di),wa(Zt,wn,0,0);else if(mr==="flipbevel")wn=zi.mult(-1),wa(Zt,wn,0,0),wa(Zt,wn.mult(-1),0,0);else{const Dr=-Math.sqrt(Di*Di-1),rs=Sn?Dr:0,Ue=Sn?0:Dr;qt&&wa(Zt,Bi,rs,Ue),vi&&wa(Zt,zi,rs,Ue)}}ri.geometry=[...wi,...Si.reverse(),wi[0]],ri.joinNormals=[...gi,...gi.reverse(),gi[gi.length-1]];const rn=ri.geometry.length-1;for(let cn=0;cn<rn/2;cn++)if(cn+1<rn/2){let wn=cn,Hr=cn+1,Di=rn-1-cn,Sn=rn-2-cn;wn=wn===0?rn-1:wn-1,Hr=Hr===0?rn-1:Hr-1,Di=Di===0?rn-1:Di-1,Sn=Sn===0?rn-1:Sn-1,ri.indices.push(Di),ri.indices.push(Hr),ri.indices.push(wn),ri.indices.push(Di),ri.indices.push(Sn),ri.indices.push(Hr)}return ri})(s[0]),s=[xe.geometry]}const Ie=(_t,Wt)=>_t<(Wt.length-1)/2||_t===Wt.length-1,$e=this.wallMode?[s]:ai(s,500);for(let _t=$e.length-1;_t>=0;_t--){const Wt=$e[_t];(Wt.length===0||(je=Wt[0]).every((ni=>ni.x<=0))||je.every((ni=>ni.x>=pi))||je.every((ni=>ni.y<=0))||je.every((ni=>ni.y>=pi)))&&$e.splice(_t,1)}var je;let Ye;if(U)Ye=ly($e,B,p);else{Ye=[];for(const _t of $e)Ye.push({polygon:_t,bounds:B})}const st=$?this.edgeRadius:0,ut=st>0&&this.zoom<17,Ut=(_t,Wt)=>{if(_t.length===0)return!1;const ni=_t[_t.length-1];return Wt.x===ni.x&&Wt.y===ni.y};for(const{polygon:_t,bounds:Wt}of Ye){let ni=0,ri=0;for(const yi of _t)$&&!yi[0].equals(yi[yi.length-1])&&yi.push(yi[0]),ri+=$?yi.length-1:yi.length;const wi=this.segments.prepareSegment(($?5:4)*ri,this.layoutVertexArray,this.indexArray);le.footprintSegIdx<0&&(le.footprintSegIdx=this.footprintSegments.length),le.polygonSegIdx<0&&(le.polygonSegIdx=this.polygonSegments.length);const Si={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},gi=new t_;if(gi.vertexOffset=this.footprintVertices.length,gi.indexOffset=3*this.footprintIndices.length,gi.ringIndices=[],$){const yi=[],Zt=[];ni=wi.vertexLength;for(let vi=0;vi<_t.length;vi++){const Bi=_t[vi];Bi.length&&vi!==0&&Zt.push(yi.length/2);const zi=[];let Dn,rn;Dn=Bi[1].sub(Bi[0])._perp()._unit(),gi.ringIndices.push(Bi.length-1);for(let cn=1;cn<Bi.length;cn++){const wn=Bi[cn],Hr=Bi[cn===Bi.length-1?1:cn+1],Di=wn.clone();if(st){rn=Hr.sub(wn)._perp()._unit();const Sn=Dn.add(rn)._unit(),mr=st*Math.min(4,1/(Dn.x*Sn.x+Dn.y*Sn.y));Di.x+=mr*Sn.x,Di.y+=mr*Sn.y,Di.x=Math.round(Di.x),Di.y=Math.round(Di.y),Dn=rn}if(!oe||st!==0&&!ut||Ut(zi,Di)||zi.push(Di),zm(this.layoutVertexArray,Di.x,Di.y,0,0,1,1,0),this.wallMode){const Sn=Ie(cn,Bi);Rm(this.wallVertexArray,xe.joinNormals[cn],!Sn)}wi.vertexLength++,this.footprintVertices.emplaceBack(wn.x,wn.y),yi.push(wn.x,wn.y),U&&eh(this.layoutVertexExtArray,j.projectTilePoint(Di.x,Di.y,p),j.upVector(p,Di.x,Di.y))}oe&&(st===0||ut)&&(zi.length!==0&&Ut(zi,zi[0])&&zi.pop(),this.groundEffect.addData(zi,Wt,k))}const qt=this.wallMode?xe.indices:Jp(yi,Zt);for(let vi=0;vi<qt.length;vi+=3)this.footprintIndices.emplaceBack(gi.vertexOffset+qt[vi+0],gi.vertexOffset+qt[vi+1],gi.vertexOffset+qt[vi+2]),this.indexArray.emplaceBack(ni+qt[vi],ni+qt[vi+2],ni+qt[vi+1]),wi.primitiveLength++;gi.indexCount+=qt.length,gi.vertexCount+=this.footprintVertices.length-gi.vertexOffset}for(let yi=0;yi<_t.length;yi++){const Zt=_t[yi];ee.startRing(le,Zt[0]);let qt=Zt.length>4&&oy(Zt[Zt.length-2],Zt[0],Zt[1]),vi=st?Sh(Zt[Zt.length-2],Zt[0],Zt[1],st):0;const Bi=[];let zi,Dn,rn;Dn=Zt[1].sub(Zt[0])._perp()._unit();let cn=!0;for(let wn=1,Hr=0;wn<Zt.length;wn++){let Di=Zt[wn-1],Sn=Zt[wn];const mr=Zt[wn===Zt.length-1?1:wn+1];if(ee.appendEdge(le,Sn,Di),r_(Sn,Di,Wt)){st&&(Dn=mr.sub(Sn)._perp()._unit(),cn=!cn);continue}const pa=Sn.sub(Di)._perp(),wa=pa.x/(Math.abs(pa.x)+Math.abs(pa.y)),Dr=pa.y>0?1:0,rs=Di.dist(Sn);if(Hr+rs>32768&&(Hr=0),st){rn=mr.sub(Sn)._perp()._unit();let Ti=th(Di,Sn,mr,Ec(Dn,rn),st);isNaN(Ti)&&(Ti=0);const Yi=Sn.sub(Di)._unit();Di=Di.add(Yi.mult(vi))._round(),Sn=Sn.add(Yi.mult(-Ti))._round(),vi=Ti,Dn=rn,oe&&this.zoom>=17&&(Ut(Bi,Di)||Bi.push(Di),Ut(Bi,Sn)||Bi.push(Sn))}const Ue=wi.vertexLength,Ze=Zt.length>4&&oy(Di,Sn,mr);let Xt=bg(Hr,qt,cn);if(zm(this.layoutVertexArray,Di.x,Di.y,wa,Dr,0,0,Xt),zm(this.layoutVertexArray,Di.x,Di.y,wa,Dr,0,1,Xt),this.wallMode){const Ti=Ie(wn-1,Zt),Yi=xe.joinNormals[wn-1];Rm(this.wallVertexArray,Yi,Ti),Rm(this.wallVertexArray,Yi,Ti)}if(Hr+=rs,Xt=bg(Hr,Ze,!cn),qt=Ze,zm(this.layoutVertexArray,Sn.x,Sn.y,wa,Dr,0,0,Xt),zm(this.layoutVertexArray,Sn.x,Sn.y,wa,Dr,0,1,Xt),this.wallMode){const Ti=Ie(wn,Zt),Yi=xe.joinNormals[wn];Rm(this.wallVertexArray,Yi,Ti),Rm(this.wallVertexArray,Yi,Ti)}if(wi.vertexLength+=4,this.indexArray.emplaceBack(Ue+0,Ue+1,Ue+2),this.indexArray.emplaceBack(Ue+1,Ue+3,Ue+2),wi.primitiveLength+=2,st){const Ti=ni+(wn===1?Zt.length-2:wn-2),Yi=wn===1?ni:Ti+1;if(this.indexArray.emplaceBack(Ue+1,Ti,Ue+3),this.indexArray.emplaceBack(Ti,Yi,Ue+3),wi.primitiveLength+=2,zi===void 0&&(zi=Ue),!r_(mr,Zt[wn],Wt)){const Ki=wn===Zt.length-1?zi:wi.vertexLength;this.indexArray.emplaceBack(Ue+2,Ue+3,Ki),this.indexArray.emplaceBack(Ue+3,Ki+1,Ki),this.indexArray.emplaceBack(Ue+3,Yi,Ki+1),wi.primitiveLength+=3}cn=!cn}if(U){const Ti=this.layoutVertexExtArray,Yi=j.projectTilePoint(Di.x,Di.y,p),Ki=j.projectTilePoint(Sn.x,Sn.y,p),Pn=j.upVector(p,Di.x,Di.y),On=j.upVector(p,Sn.x,Sn.y);eh(Ti,Yi,Pn),eh(Ti,Yi,Pn),eh(Ti,Ki,On),eh(Ti,Ki,On)}}$&&(ni+=Zt.length-1),oe&&st&&this.zoom>=17&&(Bi.length!==0&&Ut(Bi,Bi[0])&&Bi.pop(),this.groundEffect.addData(Bi,Wt,k,st>0))}this.footprintSegments.push(gi),Si.triangleCount=this.indexArray.length-Si.triangleArrayOffset,this.polygonSegments.push(Si),++le.footprintSegLen,++le.polygonSegLen}if(le.vertexCount=this.layoutVertexArray.length-le.vertexArrayOffset,le.groundVertexCount=this.groundEffect.vertexArray.length-le.groundVertexArrayOffset,le.vertexCount!==0){if(le.centroidXY=ee.borders?P_:this.encodeCentroid(ee,le),this.centroidData.push(le),ee.borders){this.featuresOnBorder.push(ee);const _t=this.featuresOnBorder.length-1;for(let Wt=0;Wt<ee.borders.length;Wt++)ee.borders[Wt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Wt].push(_t)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,_,x,p,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,u,_,x,p,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,ye)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0]))}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const E=this.centroidData[x],C=+(E.min.y+E.max.y>pi),k=2*C+(+(E.min.x+E.max.x>pi)^C);for(let B=0;B<E.polygonSegLen;B++){const j=E.polygonSegIdx+B;e.push({centroidIdx:x,subtile:k,polygonSegmentIdx:j,triangleSegmentIdx:this.polygonSegments[j].triangleSegIdx})}}const i=new co;e.sort(((x,E)=>x.triangleSegmentIdx===E.triangleSegmentIdx?x.subtile-E.subtile:x.triangleSegmentIdx-E.triangleSegmentIdx));let s=0,u=0,p=0;for(const x of e){if(x.triangleSegmentIdx!==s)break;p++}const _=e.length;for(;u!==e.length;){s=e[u].triangleSegmentIdx;let x=0,E=u,C=u;for(let k=E;k<p&&e[k].subtile===x;k++)C++;for(;E!==p;){const k=e[E];x=k.subtile;const B=this.centroidData[k.centroidIdx].min.clone(),j=this.centroidData[k.centroidIdx].max.clone(),U={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let $=E;$<C;$++){const ee=e[$],le=this.polygonSegments[ee.polygonSegmentIdx],oe=this.centroidData[ee.centroidIdx].min,ye=this.centroidData[ee.centroidIdx].max,xe=this.indexArray.uint16;for(let Ie=le.triangleArrayOffset;Ie<le.triangleArrayOffset+le.triangleCount;Ie++)i.emplaceBack(xe[3*Ie],xe[3*Ie+1],xe[3*Ie+2]);U.primitiveLength+=le.triangleCount,B.x=Math.min(B.x,oe.x),B.y=Math.min(B.y,oe.y),j.x=Math.max(j.x,ye.x),j.y=Math.max(j.y,ye.y)}U.primitiveLength>0&&this.triangleSubSegments.push({segment:U,min:B,max:j}),E=C;for(let $=E;$<p&&e[$].subtile===e[E].subtile;$++)C++}u=p;for(let k=u;k<_&&e[k].triangleSegmentIdx===e[u].triangleSegmentIdx;k++)p++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const u=new Ss;if(this.wallMode){for(const ee of this.triangleSubSegments)u.segments.push(ee.segment);return u}let p=0,_=0;const x=1<<e.canonical.z;if(i){const ee=i.getMinMaxForTile(e);ee&&(p=ee.min,_=ee.max)}_+=this.maxHeight;const E=e.toUnwrapped();let C;const k=[E.canonical.x/x+E.wrap,E.canonical.y/x],B=[(E.canonical.x+1)/x+E.wrap,(E.canonical.y+1)/x],j=(ee,le,oe)=>[ee[0]*(1-oe[0])+le[0]*oe[0],ee[1]*(1-oe[1])+le[1]*oe[1]],U=[],$=[];for(const ee of this.triangleSubSegments){U[0]=ee.min.x/pi,U[1]=ee.min.y/pi,$[0]=ee.max.x/pi,$[1]=ee.max.y/pi;const le=j(k,B,U),oe=j(k,B,$);if(new _n([le[0],le[1],p],[oe[0],oe[1],_]).intersectsPrecise(s)===0){C&&(u.segments.push(C),C=void 0);continue}const ye=ee.segment;C&&C.vertexOffset!==ye.vertexOffset&&(u.segments.push(C),C=void 0),C?(C.vertexLength+=ye.vertexLength,C.primitiveLength+=ye.primitiveLength):C={vertexOffset:ye.vertexOffset,primitiveLength:ye.primitiveLength,vertexLength:ye.vertexLength,primitiveOffset:ye.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&u.segments.push(C),u}encodeCentroid(e,i){const s=e.centroid(),u=i.span(),p=Math.min(7,Math.round(u.x*this.tileToMeter/10)),_=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new Ge(te(s.x,1,pi-1)<<3|p,te(s.y,1,pi-1)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new Ge(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const u=i[0][0]!==s?0:1;return new Ge(6|(i[0][0]!==s?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{const u=i[2][0]!==s?2:3;return new Ge((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,u=e.flags&Sf?P_:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||p!==u.x){for(let _=i;_<s;++_)this.centroidVertexArray.emplace(_,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(wh(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const p=[];for(const _ of this.activeReplacements){if(_.order<s)continue;const x=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingIds)for(const E of this.centroidData)E.flags&Sf||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y||_.footprint.buildingIds.has(E.buildingId)&&(E.flags|=Sf);else for(const E of this.centroidData)if(!(E.flags&Sf||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y))for(let C=0;C<E.footprintSegLen;C++){const k=this.footprintSegments[E.footprintSegIdx+C];if(p.length=0,cy(this.footprintVertices,k.vertexOffset,k.vertexCount,_.footprintTileId.canonical,e.canonical,p),El(_.footprint,p,this.footprintIndices.uint16,k.indexOffset,k.indexCount,-k.vertexOffset,-x)){E.flags|=Sf;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let u=!1;for(let p=0;p<s.footprintSegLen;p++){const _=this.footprintSegments[s.footprintSegIdx+p];let x=0;for(const E of _.ringIndices){for(let C=x,k=E+x-1;C<E+x;k=C++){const B=this.footprintVertices.int16[2*(C+_.vertexOffset)+0],j=this.footprintVertices.int16[2*(C+_.vertexOffset)+1],U=this.footprintVertices.int16[2*(k+_.vertexOffset)+1];j>i!=U>i&&e<(this.footprintVertices.int16[2*(k+_.vertexOffset)+0]-B)*(i-j)/(U-j)+B&&(u=!u)}x=E}}return u}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+pi)*pi+(i+pi);if(this.partLookup.hasOwnProperty(p)){const _=this.partLookup[p];return _?{height:_.height,hidden:!!(_.flags&Sf)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||i>_.max.y||_.min.y>i||_.height<=s||this.footprintContainsPoint(e,i,_)&&(s=_.height,this.partLookup[p]=_,u=!!(_.flags&Sf));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:u};this.partLookup[p]=void 0}}function Ec(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function Sh(r,e,i,s){const u=e.sub(r)._perp()._unit(),p=i.sub(e)._perp()._unit();return th(r,e,i,Ec(u,p),s)}function th(r,e,i,s,u){const p=Math.sqrt(1-s*s);return Math.min(r.dist(e)/3,e.dist(i)/3,u*p/s)}function r_(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function im(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function oy(r,e,i){if(r.x<0||r.x>=pi||e.x<0||e.x>=pi||i.x<0||i.x>=pi)return!1;const s=i.sub(e),u=s.perp(),p=r.sub(e);return(s.x*p.x+s.y*p.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function bg(r,e,i){const s=e?2|r:-3&r;return i?1|s:-2&s}function x_(){const r=Math.PI/32,e=Math.tan(r),i=h;return i*Math.sqrt(1+2*e*e)-i}function ly(r,e,i){const s=1<<i.z,u=V(i.x/s),p=V((i.x+1)/s),_=K(i.y/s),x=K((i.y+1)/s);return(function(E,C,k,B,j=0,U){const $=[];if(!E.length||!k||!B)return $;const ee=(je,Ye)=>{for(const st of je)$.push({polygon:st,bounds:Ye})},le=Math.ceil(Math.log2(k)),oe=Math.ceil(Math.log2(B)),ye=le-oe,xe=[];for(let je=0;je<Math.abs(ye);je++)xe.push(ye>0?0:1);for(let je=0;je<Math.min(le,oe);je++)xe.push(0),xe.push(1);let Ie=E;if(Ie=Zi(Ie,C[0].y-j,C[1].y+j,1),Ie=Zi(Ie,C[0].x-j,C[1].x+j,0),!Ie.length)return $;const $e=[];for(xe.length?$e.push({polygons:Ie,bounds:C,depth:0}):ee(Ie,C);$e.length;){const je=$e.pop(),Ye=je.depth,st=xe[Ye],ut=je.bounds[0],Ut=je.bounds[1],_t=st===0?ut.x:ut.y,Wt=st===0?Ut.x:Ut.y,ni=U?U(st,_t,Wt):.5*(_t+Wt),ri=Zi(je.polygons,_t-j,ni+j,st),wi=Zi(je.polygons,ni-j,Wt+j,st);if(ri.length){const Si=[ut,new Ge(st===0?ni:Ut.x,st===1?ni:Ut.y)];xe.length>Ye+1?$e.push({polygons:ri,bounds:Si,depth:Ye+1}):ee(ri,Si)}if(wi.length){const Si=[new Ge(st===0?ni:ut.x,st===1?ni:ut.y),Ut];xe.length>Ye+1?$e.push({polygons:wi,bounds:Si,depth:Ye+1}):ee(wi,Si)}}return $})(r,e,Math.ceil((p-u)/11.25),Math.ceil((_-x)/11.25),1,((E,C,k)=>{if(E===0)return .5*(C+k);{const B=K((i.y+C/pi)/s);return(D(.5*(K((i.y+k/pi)/s)+B))*s-i.y)*pi}}))}function cy(r,e,i,s,u,p){const _=Math.pow(2,s.z-u.z);for(let x=0;x<i;x++){let E=r.int16[2*(x+e)+0],C=r.int16[2*(x+e)+1];E=(E+u.x*pi)*_-s.x*pi,C=(C+u.y*pi)*_-s.y*pi,p.push(new Ge(E,C))}}let F_,wg;hi(ru,"FillExtrusionBucket",{omit:["layers","features"]}),hi(i_,"PartData"),hi(t_,"FootprintSegment"),hi(v_,"BorderCentroidData"),hi(nu,"GroundEffect");class a_ extends Ge{constructor(e,i,s){super(e,i),this.z=s}}class O_ extends a_{constructor(e,i,s,u){super(e,i,s),this.w=u}}function B_(r,e,i,s){const u=i==="x"?"y":"x",p=(s-r[i])/(e[i]-r[i]);r[u]=Math.round(r[u]+(e[u]-r[u])*p),r[i]=s,r.hasOwnProperty("z")&&(r.z=Hn(r.z,e.z,p)),r.hasOwnProperty("w")&&(r.w=Hn(r.w,e.w,p))}function Tg(r,e,i,s){const u=i,p=s;for(const _ of["x","y"]){let x=r,E=e;x[_]>=E[_]&&(x=e,E=r),x[_]<u&&E[_]>u&&B_(x,E,_,u),x[_]<p&&E[_]>p&&B_(E,x,_,p)}}function nm(r,e,i,s,u,p){const _=[];for(let x=0;x<r.length;x++){const E=r[x];let C;const k=_.length;let B=0;for(let j=0;j<E.length-1;j++){let U=E[j],$=E[j+1],ee=0;const le=B;let oe,ye;p&&(ee=Math.hypot($.x-U.x,$.y-U.y),B+=ee,oe=U,ye=$),U.x<e&&$.x<e||(U.x<e?U=new Ge(e,U.y+(e-U.x)/($.x-U.x)*($.y-U.y))._round():$.x<e&&($=new Ge(e,U.y+(e-U.x)/($.x-U.x)*($.y-U.y))._round()),U.y<i&&$.y<i||(U.y<i?U=new Ge(U.x+(i-U.y)/($.y-U.y)*($.x-U.x),i)._round():$.y<i&&($=new Ge(U.x+(i-U.y)/($.y-U.y)*($.x-U.x),i)._round()),U.x>=s&&$.x>=s||(U.x>=s?U=new Ge(s,U.y+(s-U.x)/($.x-U.x)*($.y-U.y))._round():$.x>=s&&($=new Ge(s,U.y+(s-U.x)/($.x-U.x)*($.y-U.y))._round()),U.y>=u&&$.y>=u||(U.y>=u?U=new Ge(U.x+(u-U.y)/($.y-U.y)*($.x-U.x),u)._round():$.y>=u&&($=new Ge(U.x+(u-U.y)/($.y-U.y)*($.x-U.x),u)._round()),C&&U.equals(C[C.length-1])||(C=[U],_.push(C),p&&p.push({progress:{min:le+J_(oe,ye,U)*ee,max:1},parentIndex:x,prevPoint:oe,nextPoint:ye})),C.push($),p&&(p[p.length-1].progress.max=le+J_(oe,ye,$)*ee,p[p.length-1].nextPoint=ye)))))}if(p&&B>0)for(let j=k;j<_.length;j++)p[j].progress.min/=B,p[j].progress.max/=B}return _}function uy(r,e,i,s,u){if(r.length<2)return void s.push(r);const p=[];for(;e.valid();){const[C,k]=e.get();for(let B=0;B<r.length-1;B++){const j=r[B],U=r[B+1],$=yr(j,U,C,k);if($){const[ee]=$,le=new Ge(Hn(j.x,U.x,ee),Hn(j.y,U.y,ee));p.push({t:B+ee,distance:0,point:le})}}e.next()}if(p.length===0)return void s.push(r);p.sort(((C,k)=>C.t-k.t));let _=0,x=0,E=[];for(s.push(E);_!==r.length;){if(x===p.length){for(;_!==r.length;)E.length!==0&&E[E.length-1].equals(r[_])||E.push(r[_]),_++;break}p[x].t<=_?(E.length!==0&&E[E.length-1].equals(p[x].point)||E.push(p[x].point),Math.trunc(p[x].t),x++):(E.length!==0&&E[E.length-1].equals(r[_])||E.push(r[_]),_++)}}function J_(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function Dm(r,e){return r.x*e.x+r.y*e.y}function Sg(r,e){if(r.length===1){let i=0;const s=e[i++];let u;for(;!u||s.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const p=e[i],_=r[0],x=u.sub(s),E=p.sub(s),C=_.sub(s),k=Dm(x,x),B=Dm(x,E),j=Dm(E,E),U=Dm(C,x),$=Dm(C,E),ee=k*j-B*B,le=(j*U-B*$)/ee,oe=(k*$-B*U)/ee,ye=s.z*(1-le-oe)+u.z*le+p.z*oe;if(isFinite(ye))return ye}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function hy(r,e,i){let s=1/0;Aa(i,e)&&(s=Sg(i,e[0]));for(let u=0;u<e.length;u++){const p=e[u],_=r[u];for(let x=0;x<p.length-1;x++){const E=p[x],C=[E,p[x+1],_[x+1],_[x],E];Wr(i,C)&&(s=Math.min(s,Sg(i,C)))}}return s!==1/0&&s}function N_(r,e,i,s,u,p,_,x,E,C,k){return r.projection.name==="globe"?(function(B,j,U,$,ee,le,oe,ye,xe,Ie,$e){const je=[],Ye=[],st=B.projection.upVectorScale($e,B.center.lat,B.worldSize).metersToTile,ut=[0,0,0,1],Ut=[0,0,0,1],_t=(ni,ri,wi,Si)=>{ni[0]=ri,ni[1]=wi,ni[2]=Si,ni[3]=1},Wt=x_();U>0&&(U+=Wt),$+=Wt;for(const ni of j){const ri=[],wi=[];for(const Si of ni){const gi=Si.x+ee.x,yi=Si.y+ee.y,Zt=B.projection.projectTilePoint(gi,yi,$e),qt=B.projection.upVector($e,Si.x,Si.y);let vi=U,Bi=$;if(oe){const zi=c(gi,yi,U,$,oe,ye,xe,Ie);vi+=zi.base,Bi+=zi.top}U!==0?_t(ut,Zt.x+qt[0]*st*vi,Zt.y+qt[1]*st*vi,Zt.z+qt[2]*st*vi):_t(ut,Zt.x,Zt.y,Zt.z),_t(Ut,Zt.x+qt[0]*st*Bi,Zt.y+qt[1]*st*Bi,Zt.z+qt[2]*st*Bi),Kr(ut,ut,le),Kr(Ut,Ut,le),ri.push(new a_(ut[0],ut[1],ut[2])),wi.push(new a_(Ut[0],Ut[1],Ut[2]))}je.push(ri),Ye.push(wi)}return[je,Ye]})(r,e,i,s,u,p,_,x,E,C,k):_?(function(B,j,U,$,ee,le,oe,ye,xe){const Ie=[],$e=[],je=[0,0,0,1];for(const Ye of B){const st=[],ut=[];for(const Ut of Ye){const _t=Ut.x+$.x,Wt=Ut.y+$.y,ni=c(_t,Wt,j,U,le,oe,ye,xe);je[0]=_t,je[1]=Wt,je[2]=ni.base,je[3]=1,Mr(je,je,ee),je[3]=Math.max(je[3],1e-5);const ri=new a_(je[0]/je[3],je[1]/je[3],je[2]/je[3]);je[0]=_t,je[1]=Wt,je[2]=ni.top,je[3]=1,Mr(je,je,ee),je[3]=Math.max(je[3],1e-5);const wi=new a_(je[0]/je[3],je[1]/je[3],je[2]/je[3]);st.push(ri),ut.push(wi)}Ie.push(st),$e.push(ut)}return[Ie,$e]})(e,i,s,u,p,_,x,E,C):(function(B,j,U,$,ee){const le=[],oe=[],ye=ee[8]*j,xe=ee[9]*j,Ie=ee[10]*j,$e=ee[11]*j,je=ee[8]*U,Ye=ee[9]*U,st=ee[10]*U,ut=ee[11]*U;for(const Ut of B){const _t=[],Wt=[];for(const ni of Ut){const ri=ni.x+$.x,wi=ni.y+$.y,Si=ee[0]*ri+ee[4]*wi+ee[12],gi=ee[1]*ri+ee[5]*wi+ee[13],yi=ee[2]*ri+ee[6]*wi+ee[14],Zt=ee[3]*ri+ee[7]*wi+ee[15],qt=Si+ye,vi=gi+xe,Bi=yi+Ie,zi=Math.max(Zt+$e,1e-5),Dn=Si+je,rn=gi+Ye,cn=yi+st,wn=Math.max(Zt+ut,1e-5);_t.push(new a_(qt/zi,vi/zi,Bi/zi)),Wt.push(new a_(Dn/wn,rn/wn,cn/wn))}le.push(_t),oe.push(Wt)}return[le,oe]})(e,i,s,u,p)}function c(r,e,i,s,u,p,_,x){const E=_*u.getElevationAt(r,e,!0,!0),C=p[0]!==0,k=C?p[1]===0?_*(p[0]/L_-y_):_*(function(B,j,U){const $=Math.floor(j[0]/8),ee=Math.floor(j[1]/8),le=10*(j[0]-8*$),oe=10*(j[1]-8*ee),ye=B.getElevationAt($,ee,!0,!0),xe=B.getMeterToDEM(U),Ie=Math.floor(.5*(le*xe-1)),$e=Math.floor(.5*(oe*xe-1)),je=B.tileCoordToPixel($,ee),Ye=2*Ie+1,st=2*$e+1,ut=(function(wi,Si,gi,yi,Zt){return[wi.getElevationAtPixel(Si,gi,!0),wi.getElevationAtPixel(Si+Zt,gi,!0),wi.getElevationAtPixel(Si,gi+Zt,!0),wi.getElevationAtPixel(Si+yi,gi+Zt,!0)]})(B,je.x-Ie,je.y-$e,Ye,st),Ut=Math.abs(ut[0]-ut[1]),_t=Math.abs(ut[2]-ut[3]),Wt=Math.abs(ut[0]-ut[2])+Math.abs(ut[1]-ut[3]),ni=Math.min(.25,.5*xe*(Ut+_t)/Ye),ri=Math.min(.25,.5*xe*Wt/st);return ye+Math.max(ni*le,ri*oe)})(u,p,x):E;return{base:E+(i===0?-1:i),top:C?Math.max(k+s,E+i+2):E+s}}class m{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class w{constructor(){this.tasks={},this.taskQueue=[],lt(["process"],this),this.invoker=new m(this.process),this.nextId=0}add(e,i){const s=this.nextId++,u=(function({type:p,isSymbolTile:_,zoom:x}){return x=x||0,p==="message"?0:p!=="maybePrepare"||_?p!=="parseTile"||_?p==="parseTile"&&_?300-x:p==="maybePrepare"&&_?400-x:500:200-x:100-x})(i);if(u===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((s=>!!this.tasks[s])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<i&&(i=p.priority,e=u)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class R{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},lt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new w}send(e,i,s,u,p=!1,_){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=_,this.callbacks[x]=s);const E=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!s,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:gs(i,E)},E),{cancel:()=>{s&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[s];delete this.cancelCallbacks[s],u&&u.cancel()}else if(i.mustQueue||qr(self)){const u=this.callbacks[s],p=this.scheduler.add((()=>this.processTask(s,i)),u&&u.metadata||{type:"message"});p&&(this.cancelCallbacks[s]=p)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(Ko(i.error)):s(null,Ko(i.data)))}else{const s=new Set,u=i.hasCallback?(_,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?gs(_):null,data:gs(x,s)},s)}:()=>{},p=Ko(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,u);else if(this.parent.getWorkerSource){const _=i.type.split("."),{source:x,scope:E}=p;this.parent.getWorkerSource(i.sourceMapId,_[0],x,E)[_[1]](p,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var G={workerUrl:"",workerClass:null,workerParams:void 0};const Y="mapboxgl_preloaded_worker_pool";class be{constructor(e){this.active={},this.name=e}acquire(e,i=be.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;){const u=(s=`${this.name||""}WorkerPool: ${e}-${this.workers.length}`,G.workerClass!=null?new G.workerClass:new self.Worker(G.workerUrl,Object.assign({name:s},G.workerParams)));this.workers.push(u)}var s;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[Y]}numActive(){return Object.keys(this.active).length}}be.workerCount=2;class Qe{constructor(e,i,s="Worker",u=be.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=at();const p=this.workerPool.acquire(this.id,u);for(let _=0;_<p.length;_++){const x=new Qe.Actor(p[_],i,this.id);x.name=`${s} ${_}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,s){tt(this.actors,((u,p)=>{u.send(e,i,p)}),s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let Ot,Ri;function sn(){return Ot||(Ot=new be),Ot}Qe.Actor=R;const hn=4096;class Oi{constructor(e){this.module=e,this.memoryStack=this.module.malloc(hn),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>hn?-1:(new Int32Array(this.module.heap32.buffer,i,e.length).set(e),i)}createFloatArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>hn?-1:(new Float32Array(this.module.heapF32.buffer,i,e.length).set(e),i)}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.normalScale;this.module.setStyle(i[0],i[1],i[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,s){this.module.setFauxFacadeOptions(e?1:0,i?1:0,s)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){this.memoryStackNextFree=this.memoryStack;for(const x of e){const E=this.createIntArray(x.ringIndices),C=this.createFloatArray(x.coordinates);if(E===-1||C===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,x.roofType,C,E,x.ringIndices.length-1)}for(const x of i){let E;E=x.entrances?JSON.parse(x.entrances):[];const C=this.createFloatArray(E),k=this.createFloatArray(x.coordinates);if(C===-1||k===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,C,E.length,k,x.coordinates.length)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const s=this.module.getMeshCount(),u=new Array(s);for(let x=0;x<s;x++){const E=this.module.getPositionsPtr(x),C=this.module.getPositionsLength(x),k=new Float32Array(this.module.heapF32.buffer,E,C),B=this.module.getNormalsPtr(x),j=this.module.getNormalsLength(x),U=new Float32Array(this.module.heapF32.buffer,B,j),$=this.module.getAOPtr(x),ee=this.module.getAOLength(x),le=new Float32Array(this.module.heapF32.buffer,$,ee),oe=this.module.getUVPtr(x),ye=this.module.getUVLength(x),xe=new Float32Array(this.module.heapF32.buffer,oe,ye),Ie=this.module.getFauxFacadePtr(x),$e=this.module.getFauxFacadeLength(x),je=new Uint8Array(this.module.heapU8.buffer,Ie,$e),Ye=this.module.getIndicesPtr(x),st=this.module.getIndicesLength(x),ut=new Int16Array(this.module.heap16.buffer,Ye,st),Ut=this.module.getBuildingPart(x);u[x]={positions:k,normals:U,ao:le,uv:xe,isFauxFacade:je,indices:ut,buildingPart:Ut}}const p=this.module.getRingCount(),_=[];for(let x=0;x<p;x++){const E=this.module.getRingPtr(x),C=this.module.getRingLength(x),k=new Float32Array(this.module.heapF32.buffer,E,C);_.push(k)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Hi,Vr,sa,po,ci,Yt=null,Ii=null,un=null,fa=null;function mo(){return qr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Vr||kr.DRACO_URL}function ia(){if(qr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(po)return po;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return po=WebAssembly.validate(r)?kr.MESHOPT_SIMD_URL:kr.MESHOPT_URL,po}function xs(){return fa}const Ns={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Eo={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Ef={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function dy(r,e,i){const s=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:u,byteLength:r.byteLength},i.buffers[u]=r}const i0="KHR_draco_mesh_compression";function Tw(r,e){const i=r.extensions&&r.extensions[i0];if(!i)return;const s=new sa.Decoder,u=Sv(e,i.bufferView),p=new sa.Mesh;if(!s.DecodeArrayToMesh(u,u.byteLength,p))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[r.indices],x=Ns[_.componentType],E=_.count*x.BYTES_PER_ELEMENT,C=sa._malloc(E);x===Uint16Array?s.GetTrianglesUInt16Array(p,E,C):s.GetTrianglesUInt32Array(p,E,C),dy(sa.memory.buffer.slice(C,C+E),_,e),sa._free(C);for(const k of Object.keys(i.attributes)){const B=s.GetAttributeByUniqueId(p,i.attributes[k]),j=e.json.accessors[r.attributes[k]],U=Eo[j.componentType],$=j.count*Ef[j.type]*Ns[j.componentType].BYTES_PER_ELEMENT,ee=sa._malloc($);s.GetAttributeDataArrayForAllPoints(p,B,sa[U],$,ee),dy(sa.memory.buffer.slice(ee,ee+$),j,e),sa._free(ee)}s.destroy(),p.destroy(),delete r.extensions[i0]}const fy="EXT_meshopt_compression";function Sw(r,e){if(!r.extensions||!r.extensions[fy])return;const i=r.extensions[fy],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);ci.decodeGltfBuffer(u,i.count,i.byteStride,s,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=u.buffer,delete r.extensions[fy]}const bv=1179937895,wv=new TextDecoder("utf8");function Tv(r,e){return new URL(r,e).href}function Ew(r,e,i,s){return fetch(Tv(r.uri,s)).then((u=>u.arrayBuffer())).then((u=>{e.buffers[i]=u}))}function Sv(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function Aw(r,e,i,s){if(r.uri){const u=Tv(r.uri,s);return fetch(u).then((p=>p.blob())).then((p=>createImageBitmap(p))).then((p=>{e.images[i]=p}))}if(r.bufferView!==void 0){const u=Sv(e,r.bufferView),p=new Blob([u],{type:r.mimeType});return createImageBitmap(p).then((_=>{e.images[i]=_}))}}function Ev(r,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===bv){const k=new Uint32Array(r,e);let B=2;const j=(k[B++]>>2)-3,U=k[B++]>>2;if(B++,s.json=JSON.parse(wv.decode(k.subarray(B,B+U))),B+=U,B<j){const $=k[B++];B++;const ee=e+(B<<2);s.buffers[0]=r.slice(ee,ee+$)}}else s.json=JSON.parse(wv.decode(new Uint8Array(r,e)));const{buffers:u,images:p,meshes:_,extensionsUsed:x,bufferViews:E}=s.json;let C=Promise.resolve();if(u){const k=[];for(let B=0;B<u.length;B++){const j=u[B];j.uri?k.push(Ew(j,s,B,i)):s.buffers[B]||(s.buffers[B]=null)}C=Promise.all(k)}return C.then((()=>{const k=[],B=x&&x.includes(i0),j=x&&x.includes(fy);if(B&&k.push((function(){if(!sa)return Hi??(Hi=(function(U){let $,ee=null;function le(){$=new Uint8Array(ee.buffer)}function oe(){throw new Error("Unexpected Draco error.")}const ye={a:{a:oe,d:function(xe,Ie,$e){return $.copyWithin(xe,Ie,Ie+$e)},c:function(xe){const Ie=$.length,$e=Math.max(xe>>>0,Math.ceil(1.2*Ie)),je=Math.ceil(($e-Ie)/65536);try{return ee.grow(je),le(),!0}catch{return!1}},b:oe}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(U,ye):U.then((xe=>xe.arrayBuffer())).then((xe=>WebAssembly.instantiate(xe,ye)))).then((xe=>{const{Rb:Ie,Qb:$e,P:je,T:Ye,X:st,Ja:ut,La:Ut,Qa:_t,Va:Wt,Wa:ni,eb:ri,jb:wi,f:Si,e:gi,yb:yi,zb:Zt,Ab:qt,Bb:vi,Db:Bi,Gb:zi}=xe.instance.exports;ee=gi;const Dn=(()=>{let rn=0,cn=0,wn=0,Hr=0;return Di=>{wn&&(Ie(Hr),Ie(rn),cn+=wn,wn=rn=0),rn||(cn+=128,rn=$e(cn));const Sn=Di.length+7&-8;let mr=rn;Sn>=cn&&(wn=Sn,mr=Hr=$e(Sn));for(let pa=0;pa<Di.length;pa++)$[mr+pa]=Di[pa];return mr}})();return le(),Si(),{memory:gi,_free:Ie,_malloc:$e,Mesh:class{constructor(){this.ptr=je()}destroy(){Ye(this.ptr)}},Decoder:class{constructor(){this.ptr=ut()}destroy(){wi(this.ptr)}DecodeArrayToMesh(rn,cn,wn){const Hr=Dn(rn),Di=Ut(this.ptr,Hr,cn,wn.ptr);return!!st(Di)}GetAttributeByUniqueId(rn,cn){return{ptr:_t(this.ptr,rn.ptr,cn)}}GetTrianglesUInt16Array(rn,cn,wn){Wt(this.ptr,rn.ptr,cn,wn)}GetTrianglesUInt32Array(rn,cn,wn){ni(this.ptr,rn.ptr,cn,wn)}GetAttributeDataArrayForAllPoints(rn,cn,wn,Hr,Di){ri(this.ptr,rn.ptr,cn.ptr,wn,Hr,Di)}},DT_INT8:yi(),DT_UINT8:Zt(),DT_INT16:qt(),DT_UINT16:vi(),DT_UINT32:Bi(),DT_FLOAT32:zi()}}))})(fetch(mo())),Hi.then((U=>{sa=U,Hi=void 0})))})()),j&&k.push((function(){if(ci)return;const U=(function($){let ee;const le=WebAssembly.instantiateStreaming($,{}).then((xe=>{ee=xe.instance,ee.exports.__wasm_call_ctors()})),oe={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ye={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:le,supported:!0,decodeGltfBuffer(xe,Ie,$e,je,Ye,st){(function(ut,Ut,_t,Wt,ni,ri,wi){const Si=ut.exports.sbrk,gi=Wt+3&-4,yi=Si(gi*ni),Zt=Si(ri.length),qt=new Uint8Array(ut.exports.memory.buffer);qt.set(ri,Zt);const vi=Ut(yi,Wt,ni,Zt,ri.length);if(vi===0&&wi&&wi(yi,gi,ni),_t.set(qt.subarray(yi,yi+Wt*ni)),Si(yi-Si(0)),vi!==0)throw new Error(`Malformed buffer data: ${vi}`)})(ee,ee.exports[ye[Ye]],xe,Ie,$e,je,ee.exports[oe[st]])}}})(fetch(ia()));return U.ready.then((()=>{ci=U}))})()),p)for(let U=0;U<p.length;U++)k.push(Aw(p[U],s,U,i));return(k.length?Promise.all(k):Promise.resolve()).then((()=>{if(B&&_)for(const{primitives:U}of _)for(const $ of U)Tw($,s);if(j&&_&&E)for(const U of E)Sw(U,s);return s}))}))}function Av(r){return fetch(r).then((e=>e.arrayBuffer())).then((e=>Ev(e,0,r)))}function n0(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function r0(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class a0{constructor(e,i,s,u){this.context=e,this.format=s,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:u&&u.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:_}=p,{x,y:E}=i&&i.position?i.position:{x:0,y:0},C=x+s,k=E+u;!this.size||this.size[0]===C&&this.size[1]===k||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!i||i.premultiply!==!1));const B=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&C>0&&k>0){const j=this.useMipmap?Math.floor(Math.log2(Math.max(C,k)))+1:1;_.texStorage2D(_.TEXTURE_2D,j,this.format,C,k),this.size=[C,k]}this.size&&(B?_.texSubImage2D(_.TEXTURE_2D,0,x,E,n0(this.format),r0(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,x,E,s,u,n0(this.format),r0(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i,s=!1){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,u,p){const{context:_}=this,{gl:x}=_;x.bindTexture(x.TEXTURE_2D,this.texture),i!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,s),this.wrapS=s),u!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,u),this.wrapT=u),p!==this.compareMode&&(p?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,p)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Eg{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}const Mw=Yr([{name:"a_pos_3f",components:3,type:"Float32"}]),Iw=Yr([{name:"a_color_3f",components:3,type:"Float32"}]),Cw=Yr([{name:"a_color_4f",components:4,type:"Float32"}]),zw=Yr([{name:"a_uv_2f",components:2,type:"Float32"}]),Rw=Yr([{name:"a_normal_3f",components:3,type:"Float32"}]),Dw=Yr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Pw=Yr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function Mv(r,e){const i=py(r.projection,r.zoom,r.width,r.height),s=(function(p,_,x,E,C){const k=new a(x.lng-180*b_,x.lat),B=new a(x.lng+180*b_,x.lat),j=p.project(k.lng,k.lat),U=p.project(B.lng,B.lat),$=-Math.atan2(U.y-j.y,U.x-j.x),ee=Se.fromLngLat(x);ee.y=te(ee.y,-1+b_,1-b_);const le=ee.toLngLat(),oe=p.project(le.lng,le.lat),ye=Se.fromLngLat(le);ye.x+=b_;const xe=ye.toLngLat(),Ie=p.project(xe.lng,xe.lat),$e=Cv(Ie.x-oe.x,Ie.y-oe.y,$),je=Se.fromLngLat(le);je.y+=b_;const Ye=je.toLngLat(),st=p.project(Ye.lng,Ye.lat),ut=Cv(st.x-oe.x,st.y-oe.y,$),Ut=Math.abs($e.x)/Math.abs(ut.y),_t=qi([]);mn(_t,_t,-$*(1-(C?0:E)));const Wt=qi([]);return Un(Wt,Wt,[1,1-(1-Ut)*E,1]),Wt[4]=-ut.x/ut.y*E,mn(Wt,Wt,$),Ai(Wt,_t,Wt),Wt})(r.projection,0,r.center,i,e),u=Iv(r);return Un(s,s,[u,u,1]),s}function Iv(r){const e=r.projection,i=py(r.projection,r.zoom,r.width,r.height),s=s0(e,r.center),u=s0(e,a.convert(e.center));return Math.pow(2,s*i+(1-i)*u)}function py(r,e,i,s,u=1/0){const p=r.range;if(!p)return 0;const _=Math.min(u,Math.max(i,s)),x=Math.log2(_/1024);return _e(p[0]+x,p[1]+x,e)}const b_=1/4e4;function s0(r,e){const i=te(e.lat,-Q,Q),s=new a(e.lng-180*b_,i),u=new a(e.lng+180*b_,i),p=r.project(s.lng,i),_=r.project(u.lng,i),x=Se.fromLngLat(s),E=Se.fromLngLat(u),C=_.x-p.x,k=_.y-p.y,B=E.x-x.x,j=E.y-x.y,U=Math.sqrt((B*B+j*j)/(C*C+k*k));return Math.log2(U)}function Cv(r,e,i){const s=Math.cos(i),u=Math.sin(i);return{x:r*s-e*u,y:r*u+e*s}}function zv(r,e,i){qi(r),mn(r,r,fi(e[2])),rr(r,r,fi(e[0])),ln(r,r,fi(e[1])),Un(r,r,i),Ai(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function my(r,e,i,s,u,p,_,x){const E=[i[0]-e[0],i[1]-e[1],0],C=[s[0]-e[0],s[1]-e[1],0];if(Pr(E)<1e-12||Pr(C)<1e-12)return Ds(r);const k=br([],E,C);In(k,k),zn(C,s,e),E[2]=(p-u)*x,C[2]=(_-u)*x;const B=E;return br(B,E,C),In(B,B),xn(r,k,B)}function _y(r,e,i=!1){const s=eu(e.zoom),u=(function(p,_,x){const E=_.worldSize,C=[p[12],p[13],p[14]],k=K(C[1]/E),B=V(C[0]/E),j=qi([]),U=N(1,k)*E,$=N(1,0)*E*ie(k,_.zoom),ee=1/Zp(E);let le=$*ee;if(x){const Ie=py(_.projection,_.zoom,_.width,_.height,1024);le=ee*_.projection.pixelSpaceConversion(_.center.lat,E,Ie)}const oe=Eu(k,B);Tn(oe,oe,mi([],In([],oe),U*le*C[2]));const ye=(function(Ie){const $e=[Ie[0],Ie[1],Ie[2]];let je=[0,1,0];const Ye=br([],je,$e);return br(je,$e,Ye),Gr(je)===0&&(je=[0,1,0],br(Ye,$e,je)),In(Ye,Ye),In(je,je),In($e,$e),[Ye[0],Ye[1],Ye[2],0,je[0],je[1],je[2],0,$e[0],$e[1],$e[2],0,Ie[0],Ie[1],Ie[2],1]})(oe);Un(j,j,[le,le,le*U]),an(j,j,[-C[0],-C[1],-C[2]]);const xe=Ai([],_.globeMatrix,ye);return Ai(xe,xe,j),Ai(xe,xe,p),xe})(r,e,i);if(s>0){const p=(function(_,x){const E=x.worldSize,C=N(1,0)*E*ie(x.center.lat,x.zoom)/Zp(E),k=N(1,x.center.lat)*E,B=qi([]);ln(B,B,fi(x.center.lng)),rr(B,B,fi(x.center.lat)),an(B,B,[0,0,ys]),Un(B,B,[C,C,C*k]);const j=x.point;return an(B,B,[-j.x,-j.y,0]),Ai(B,B,_),Ai(B,x.globeMatrix,B)})(r,e);return(function(_,x,E){const C=($,ee,le)=>{const oe=Pr($),ye=Pr(ee),xe=ds($,ee,le);return mi(xe,xe,1/Pr(xe)*Hn(oe,ye,le))},k=C([_[0],_[1],_[2]],[x[0],x[1],x[2]],E),B=C([_[4],_[5],_[6]],[x[4],x[5],x[6]],E),j=C([_[8],_[9],_[10]],[x[8],x[9],x[10]],E),U=ds([_[12],_[13],_[14]],[x[12],x[13],x[14]],E);return[k[0],k[1],k[2],0,B[0],B[1],B[2],0,j[0],j[1],j[2],0,U[0],U[1],U[2],1]})(u,p,s)}return u}function o0(r,e,i,s){const u=_n.projectAabbCorners(s,i);let p=Number.MAX_VALUE;for(let x=0;x<u.length;++x){const E=u[x];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<p&&(p=E[2])}const _=(function(x){const E=[];let C=0;for(let U=1;U<x.length;U++)(x[U][0]<x[C][0]||x[U][0]===x[C][0]&&x[U][1]<x[C][1])&&(C=U);let k,B=C;const j=new Uint8Array(x.length);do{if(j[B])break;E.push(new Ge(x[B][0],x[B][1])),j[B]=1,k=(B+1)%x.length;for(let U=0;U<x.length;U++){if(x[U][0]===x[k][0]&&x[U][1]===x[k][1]||x[U][0]===x[B][0]&&x[U][1]===x[B][1])continue;const $=[x[U][0]-x[B][0],x[U][1]-x[B][1]],ee=[x[k][0]-x[B][0],x[k][1]-x[B][1]],le=$[0]*ee[1]-$[1]*ee[0];(le>0||le===0&&$[0]*ee[0]+$[1]*ee[1]>=0&&$[0]*$[0]+$[1]*$[1]>ee[0]*ee[0]+ee[1]*ee[1])&&(k=U)}B=k}while(B!==C);return E.length>0&&E.push(E[0]),E})(u);if(Wr(r,_))return p}const j_=64,Q_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function gy(r,e,i,s,u,p,_,x,E,C=!1){const k=i.zoom,B=i.project(s),j=ie(s.lat,k),U=1/j;qi(r),an(r,r,[B.x+_[0]*U,B.y+_[1]*U,_[2]]);let $=1,ee=1;const le=i.worldSize;if(C){if(i.projection.name==="mercator"){let Ie=0;i.elevation&&(Ie=i.elevation.getAtPointOrZero(new Se(B.x/le,B.y/le),0));const $e=Mr([],[B.x,B.y,Ie,1],i.projMatrix)[3]/i.cameraToCenterDistance;$=$e,ee=$e*ie(i.center.lat,k)}else if(i.projection.name==="globe"){const Ie=_y(r,i),$e=[0,0,0,1];Mr($e,$e,Ai([],i.projMatrix,Ie));const je=$e[3]/i.cameraToCenterDistance,Ye=eu(k),st=i.projection.pixelsPerMeter(s.lat,le)*ie(s.lat,k),ut=i.projection.pixelsPerMeter(i.center.lat,le)*ie(i.center.lat,k);$=je/Hn(st,ae(i.center.lat),Ye),ee=je*j/st,$*=ut,ee*=ut}}else $=U;Un(r,r,[$,$,ee]);const oe=[...r],ye=e.orientation,xe=[];if(zv(xe,[ye[0]+(u?u[0]:0),ye[1]+(u?u[1]:0),ye[2]+(u?u[2]:0)],p),Ai(r,oe,xe),x&&i.elevation){let Ie=0;const $e=[];if(E&&i.elevation){Ie=(function(Ye,st,ut,Ut,_t){const Wt=st.elevation;if(!Wt)return 0;const ni=_n.projectAabbCorners(ut,Ut),ri=N(1,_t.lat)*st.worldSize,wi=(function(cn,wn){const Hr=[0,0,1],Di=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Sn of Di){const mr=cn[Sn.corners[0]],pa=cn[Sn.corners[1]],wa=cn[Sn.corners[2]],Dr=[pa[0]-mr[0],pa[1]-mr[1],wn*(pa[2]-mr[2])],rs=br(Dr,Dr,[wa[0]-mr[0],wa[1]-mr[1],wn*(wa[2]-mr[2])]);In(rs,rs),Sn.dotProductWithUp=Lr(rs,Hr)}return Di.sort(((Sn,mr)=>Sn.dotProductWithUp-mr.dotProductWithUp)),Di[0].corners})(ni,ri),Si=ni[wi[0]],gi=ni[wi[1]],yi=ni[wi[2]],Zt=ni[wi[3]],qt=Wt.getAtPointOrZero(new Se(Si[0]/st.worldSize,Si[1]/st.worldSize),0),vi=Wt.getAtPointOrZero(new Se(gi[0]/st.worldSize,gi[1]/st.worldSize),0),Bi=Wt.getAtPointOrZero(new Se(yi[0]/st.worldSize,yi[1]/st.worldSize),0),zi=Wt.getAtPointOrZero(new Se(Zt[0]/st.worldSize,Zt[1]/st.worldSize),0),Dn=(qt+zi)/2,rn=(vi+Bi)/2;return Dn>rn?vi<Bi?my(Ye,gi,Zt,Si,vi,zi,qt,ri):my(Ye,yi,Si,Zt,Bi,qt,zi,ri):qt<zi?my(Ye,Si,gi,yi,qt,vi,Bi,ri):my(Ye,Zt,yi,gi,zi,Bi,vi,ri),Math.max(Dn,rn)})($e,i,e.aabb,r,s);const je=Ai([],tn([],$e),xe);Ai(r,oe,je)}else Ie=i.elevation.getAtPointOrZero(new Se(B.x/le,B.y/le),0);Ie!==0&&(r[14]+=Ie)}}class Rv{constructor(e,i,s,u,p){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=s!=null?new a(s[0],s[1]):new a(0,0),this.orientation=u??[0,0,0],this.nodes=p,this.uploaded=!1,this.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){Ai(e.globalMatrix,i,e.localMatrix);const s=this.nodeOverrides.get(e.name);if(s!==void 0){const _=[];p=s.orientation,qi(u=_),ln(u,u,fi(p[1])),mn(u,u,fi(p[2])),rr(u,u,fi(p[0])),Ai(e.globalMatrix,e.globalMatrix,_)}var u,p;if(e.meshes)for(const _ of e.meshes){const x=_n.applyTransformFast(_.aabb,e.globalMatrix);this.aabb.encapsulate(x)}if(e.children)for(const _ of e.children)this._applyTransformations(_,e.globalMatrix)}computeBoundsAndApplyParent(){const e=qi([]);this.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,s,u,p,_,x=!1){gy(this.matrix,this,e.transform,this.position,i,s,u,p,_,x)}upload(e){if(!this.uploaded){for(const i of this.nodes)l0(i,e);for(const i of this.nodes)yy(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)c0(e)}}function Ag(r,e,i=!1){r.uploaded||(r.gfxTexture=new a0(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function Lw(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,Mw.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,Rw.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,zw.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?Iw:Cw).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,Pw.members,!0)),r.segments=Ss.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const s=r.material;s.pbrMetallicRoughness.baseColorTexture&&Ag(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&Ag(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&Ag(s.normalTexture,e),s.occlusionTexture&&Ag(s.occlusionTexture,e,i),s.emissionTexture&&Ag(s.emissionTexture,e)}function l0(r,e,i){if(r.meshes)for(const s of r.meshes)Lw(s,e,i);if(r.children)for(const s of r.children)l0(s,e,i)}function yy(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)yy(e)}function c0(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)c0(i)}function V_(r,e){const i=r.json.bufferViews[e.bufferView],s=Ns[e.componentType];return new s(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Ef[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:Ef[e.type]))}function u0(r,e,i,s){const u=Ns[e.componentType],p=(function(k){switch(k){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(u),_=r.json.bufferViews[e.bufferView],x=_.byteStride?_.byteStride/u.BYTES_PER_ELEMENT:Ef[e.type],E=i.float32,C=E.length/i.capacity;for(let k=0,B=0;k<e.count*x;k+=x,B+=C)for(let j=0;j<C;j++)E[B+j]=s[k+j]*p;i._trim()}function kw(r,e,i){const s=r.indices,u=r.attributes,p={};p.indexArray=new co;const _=e.json.accessors[s],x=_.count/3;p.indexArray.reserve(x);const E=V_(e,_);for(let j=0;j<x;j++)p.indexArray.emplaceBack(E[3*j],E[3*j+1],E[3*j+2]);p.indexArray._trim(),p.vertexArray=new xc;const C=e.json.accessors[u.POSITION];p.vertexArray.reserve(C.count);const k=V_(e,C);for(let j=0;j<C.count;j++)p.vertexArray.emplaceBack(k[3*j],k[3*j+1],k[3*j+2]);if(p.vertexArray._trim(),p.aabb=new _n(C.min,C.max),p.centroid=(function(j,U){const $=[0,0,0],ee=j.length;if(ee>0){for(let le=0;le<ee;le++){const oe=3*j[le];$[0]+=U[oe],$[1]+=U[oe+1],$[2]+=U[oe+2]}$[0]/=ee,$[1]/=ee,$[2]/=ee}return $})(E,k),u.COLOR_0!==void 0){const j=e.json.accessors[u.COLOR_0],U=Ef[j.type],$=V_(e,j);p.colorArray=U===3?new xc:new Fd,p.colorArray.resize(j.count),u0(e,j,p.colorArray,$)}if(u.NORMAL!==void 0){p.normalArray=new xc;const j=e.json.accessors[u.NORMAL];p.normalArray.resize(j.count);const U=V_(e,j);u0(e,j,p.normalArray,U)}if(u.TEXCOORD_0!==void 0&&i.length>0){p.texcoordArray=new Tu;const j=e.json.accessors[u.TEXCOORD_0];p.texcoordArray.resize(j.count);const U=V_(e,j);u0(e,j,p.texcoordArray,U)}if(u._FEATURE_ID_RGBA4444!==void 0){const j=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=V_(e,j))}u._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(V_(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const B=r.material;return p.material=(function(j,U){const{emissiveFactor:$=[0,0,0],alphaMode:ee="OPAQUE",alphaCutoff:le=.5,normalTexture:oe,occlusionTexture:ye,emissiveTexture:xe,doubleSided:Ie,name:$e}=j,{baseColorFactor:je=[1,1,1,1],metallicFactor:Ye=1,roughnessFactor:st=1,baseColorTexture:ut,metallicRoughnessTexture:Ut}=j.pbrMetallicRoughness||{},_t=ye?U[ye.index]:void 0;if(ye&&ye.extensions&&ye.extensions.KHR_texture_transform&&_t){const Wt=ye.extensions.KHR_texture_transform;_t.offsetScale=[Wt.offset[0],Wt.offset[1],Wt.scale[0],Wt.scale[1]]}return{name:$e,pbrMetallicRoughness:{baseColorFactor:new Ia(...je),metallicFactor:Ye,roughnessFactor:st,baseColorTexture:ut?U[ut.index]:void 0,metallicRoughnessTexture:Ut?U[Ut.index]:void 0},doubleSided:Ie,emissiveFactor:new Ia(...$),alphaMode:ee,alphaCutoff:le,normalTexture:oe?U[oe.index]:void 0,occlusionTexture:_t,emissionTexture:xe?U[xe.index]:void 0,defined:j.defined===void 0}})(B!==void 0?e.json.materials[B]:{defined:!1},i),p}function Dv(r,e,i){const{matrix:s,rotation:u,translation:p,scale:_,mesh:x,extras:E,children:C,name:k}=r,B={};if(B.name=k,B.localMatrix=s||(function(j,U,$,ee){var le=U[0],oe=U[1],ye=U[2],xe=U[3],Ie=le+le,$e=oe+oe,je=ye+ye,Ye=le*Ie,st=le*$e,ut=le*je,Ut=oe*$e,_t=oe*je,Wt=ye*je,ni=xe*Ie,ri=xe*$e,wi=xe*je,Si=ee[0],gi=ee[1],yi=ee[2];return j[0]=(1-(Ut+Wt))*Si,j[1]=(st+wi)*Si,j[2]=(ut-ri)*Si,j[3]=0,j[4]=(st-wi)*gi,j[5]=(1-(Ye+Wt))*gi,j[6]=(_t+ni)*gi,j[7]=0,j[8]=(ut+ri)*yi,j[9]=(_t-ni)*yi,j[10]=(1-(Ye+Ut))*yi,j[11]=0,j[12]=$[0],j[13]=$[1],j[14]=$[2],j[15]=1,j})([],u||[0,0,0,1],p||[0,0,0],_||[1,1,1]),B.globalMatrix=Vi(B.localMatrix),x!==void 0){B.meshes=i[x];const j=B.anchor=[0,0];for(const U of B.meshes){const{min:$,max:ee}=U.aabb;j[0]+=$[0]+ee[0],j[1]+=$[1]+ee[1]}j[0]=Math.floor(j[0]/B.meshes.length/2),j[1]=Math.floor(j[1]/B.meshes.length/2)}if(E&&(E.id&&(B.id=E.id),E.lights&&(B.lights=(function(j){if(!j.length)return[];const U=(function(ye){const xe=atob(ye),Ie=new Uint8Array(xe.length);for(let $e=0;$e<xe.length;$e++)Ie[$e]=xe.codePointAt($e);return Ie})(j),$=[],ee=U.length/24,le=new Uint16Array(U.buffer),oe=new Float32Array(U.buffer);for(let ye=0;ye<ee;ye++){const xe=le[2*ye*6]/30,Ie=le[2*ye*6+1]/30,$e=le[2*ye*6+10]/100,je=oe[6*ye+1],Ye=oe[6*ye+2],st=oe[6*ye+3],ut=oe[6*ye+4],Ut=st-je,_t=ut-Ye,Wt=Math.hypot(Ut,_t);$.push({pos:[je+.5*Ut,Ye+.5*_t,Ie],normal:[_t/Wt,-Ut/Wt,0],width:Wt,height:xe,depth:$e,points:[je,Ye,st,ut]})}return $})(E.lights)),E.MAPBOX_geometry_bloom&&(B.isGeometryBloom=E.MAPBOX_geometry_bloom)),C){const j=[];for(const U of C)j.push(Dv(e.json.nodes[U],e,i));B.children=j}return B}function Fw(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Tc(r.vertices,r.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:s}}function Ow(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const _ of i){if(!Array.isArray(_)||_.length!==2)continue;const x=_[0],E=_[1];typeof x=="number"&&typeof E=="number"&&s.push(new Ge(x,E))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let u=0;for(let _=0;_<s.length;_++){const x=s[_],E=s[(_+1)%s.length],C=s[(_+2)%s.length];u+=(x.x-E.x)*(C.y-E.y)-(C.x-E.x)*(x.y-E.y)}u>0&&s.reverse();const p=Jp(s.flatMap((_=>[_.x,_.y])),[]);return p.length===0?null:{vertices:s,indices:p}}function Bw(r,e){const i=[],s=[];let u=0;const p=[];for(const _ of r){u=i.length;const x=_.vertexArray.float32,E=_.indexArray.uint16;for(let C=0;C<_.vertexArray.length;C++)p[0]=x[3*C+0],p[1]=x[3*C+1],p[2]=x[3*C+2],Kr(p,p,e),i.push(new Ge(p[0],p[1]));for(let C=0;C<3*_.indexArray.length;C++)s.push(E[C]+u)}if(s.length%3!=0)return null;for(let _=0;_<s.length;_+=3){const x=i[s[_+0]],E=i[s[_+1]],C=i[s[_+2]];(x.x-E.x)*(C.y-E.y)-(C.x-E.x)*(x.y-E.y)>0&&([s[_+1],s[_+2]]=[s[_+2],s[_+1]])}return{vertices:i,indices:s}}function h0(r){const e=(function(E,C){const k=[],B=WebGL2RenderingContext;if(E.json.textures)for(const j of E.json.textures){const U={magFilter:B.LINEAR,minFilter:B.NEAREST,wrapS:B.REPEAT,wrapT:B.REPEAT};j.sampler!==void 0&&Object.assign(U,E.json.samplers[j.sampler]),k.push({image:C[j.source],sampler:U,uploaded:!1})}return k})(r,r.images),i=(function(E,C){const k=[];for(const B of E.json.meshes){const j=[];for(const U of B.primitives)j.push(kw(U,E,C));k.push(j)}return k})(r,e),{scenes:s,scene:u,nodes:p}=r.json,_=s?s[u||0].nodes:[...p.keys()],x=[];for(const E of _)x.push(Dv(p[E],r,i));return(function(E,C,k){const B={},j=new Set;for(let U=0;U<E.length;U++){const $=k[C[U]];if(!$.extras)continue;const ee=$.extras["mapbox:footprint:version"],le=$.extras["mapbox:footprint:id"];(ee||le)&&j.add(U),ee==="1.0.0"&&le&&(B[le]=U)}for(let U=0;U<E.length;U++){if(j.has(U))continue;const $=E[U],ee=k[C[U]];if(!ee.extras)continue;let le=null;$.id in B&&(le=Bw(E[B[$.id]].meshes,$.localMatrix)),le||(le=Ow(ee)),le&&($.footprint=Fw(le))}if(j.size>0){const U=Array.from(j.values()).sort((($,ee)=>$-ee));for(let $=U.length-1;$>=0;$--)E.splice(U[$],1)}})(x,_,r.json.nodes),x}function Nw(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,s=r.aabb.min[1]-1,u=j_/(r.aabb.max[0]-i+2),p=j_/(r.aabb.max[1]-s+2);for(let _=0;_<e.length;_+=3){const x=e[_+2],E=(e[_+0]-i)*u|0,C=(e[_+1]-s)*p|0;x>r.heightmap[C*j_+E]&&(r.heightmap[C*j_+E]=x)}}function Pv(r,e,i,s,u){i.reserve(i.length+4*r.length),s.reserve(s.length+10*r.length),u.reserve(u.length+10*r.length);let p=s.length;for(const _ of r){const x=Math.min(10,Math.max(4,1.3*_.height))*e,E=[-_.normal[1],_.normal[0],0],C=Math.min(.29,.1*_.width/_.depth),k=_.width-2*_.depth*e*(C+.01),B=vn([],_.pos,E,k/2),j=vn([],_.pos,E,-k/2),U=[B[0],B[1],B[2]+_.height],$=[j[0],j[1],j[2]+_.height],ee=vn([],_.normal,E,C);mi(ee,ee,x);const le=vn([],_.normal,E,-C);mi(le,le,x),Tn(ee,B,ee),Tn(le,j,le),B[2]+=.1,j[2]+=.1,s.emplaceBack(ee[0],ee[1],ee[2]),s.emplaceBack(le[0],le[1],le[2]),s.emplaceBack(B[0],B[1],B[2]),s.emplaceBack(j[0],j[1],j[2]),s.emplaceBack(U[0],U[1],U[2]),s.emplaceBack($[0],$[1],$[2]),s.emplaceBack(B[0],B[1],B[2]),s.emplaceBack(j[0],j[1],j[2]),s.emplaceBack(ee[0],ee[1],ee[2]),s.emplaceBack(le[0],le[1],le[2]);const oe=k/x/2;u.emplaceBack(-oe-C,-1,oe,.8),u.emplaceBack(oe+C,-1,oe,.8),u.emplaceBack(-oe,0,oe,1.3),u.emplaceBack(oe,0,oe,1.3),u.emplaceBack(oe+C,-.8,oe,.7),u.emplaceBack(oe+C,-.8,oe,.7),u.emplaceBack(0,0,oe,1.3),u.emplaceBack(0,0,oe,1.3),u.emplaceBack(oe+C,-1.2,oe,.8),u.emplaceBack(oe+C,-1.2,oe,.8),i.emplaceBack(6+p,4+p,8+p),i.emplaceBack(7+p,9+p,5+p),i.emplaceBack(0+p,1+p,2+p),i.emplaceBack(1+p,3+p,2+p),p+=10}}function jw(r,e){const i={};i.indexArray=new co,i.vertexArray=new xc,i.colorArray=new Fd,Pv(r,e,i.indexArray,i.vertexArray,i.colorArray);const s={defined:!0};s.emissiveFactor=Ia.black;const u={};return u.baseColorFactor=Ia.white,s.pbrMetallicRoughness=u,i.material=s,i.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const Lv=Yr([{name:"a_pos_3f",components:3,type:"Float32"}]),Vw=Yr([{name:"a_normal_3",components:3,type:"Int16"}]),Uw=Yr([{name:"a_centroid_3",components:3,type:"Int16"}]),kv=Yr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Gw=Yr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Hw=Yr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),qw=Yr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),$w=Yr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Zw=Yr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Fv=dt.types,vy=32767;function Ww(r,e){const i=pi+e;for(const s of r)for(const u of s)if(u.x<-e||u.x>i||u.y<-e||u.y>i)return!1;return!0}function Xw(r){switch(r){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${r}`)}}class d0{constructor(){this.layoutVertexArray=new xc,this.layoutAttenuationArray=new Fd,this.layoutColorArray=new wu,this.indexArray=new co,this.indexArrayForConflation=new co,this.segmentsBucket=new Ss}}class f0{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new Ss,this.entranceBloom=new d0;const i=66560;this.layoutVertexArray=new xc,this.layoutVertexArray.reserve(i),this.layoutNormalArray=new kd,this.layoutNormalArray.reserve(i),this.layoutCentroidArray=new kd,this.layoutCentroidArray.reserve(i),this.layoutColorArray=new wu,this.layoutColorArray.reserve(i),this.layoutFloodLightDataArray=new Su,this.layoutFloodLightDataArray.reserve(i),this.layoutAOArray=new hl,this.layoutAOArray.reserve(i),this.indexArray=new co,this.indexArray.reserve(66560),this.indexArrayForConflation=new co,this.segmentsBucket=new Ss,this.entranceBloom=new d0,e&&(this.layoutFacadePaintArray=new wu,this.layoutFacadeDataArray=new fh,this.layoutFacadeVerticalRangeArray=new wu)}reserve(e,i,s){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(i),s&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class Ov{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Tu,this.footprintsIndices=new Su,this.footprintsMin=new Ge(1/0,1/0),this.footprintsMax=new Ge(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new f0(!1),this.buildingWithFacade=new f0(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new gh(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new nu(e),this.groundEffect.groundRadiusArray=new qh,this.hasAppearances=null}updateFootprints(e,i){const s=new Tc([],[],1),u={vertices:[],indices:new Uint32Array(0),grid:s,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};i.push({footprint:u,id:e})}updateAppearances(e,i,s,u){}prepare(){return(function(){if(fa!=null||un!=null)return null;if(Ii!=null)return Ii;const e=fetch(kr.BUILDING_GEN_URL);return Ii=(function(i){let s,u,p,_,x;function E(){s=new Uint8Array(x.buffer),u=new Int16Array(x.buffer),p=new Int32Array(x.buffer),_=new Float32Array(x.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const k=()=>{},B={a:{a:C,f:function(j){const U=s.length,$=Math.max(j>>>0,Math.ceil(1.2*U)),ee=Math.ceil(($-U)/65536);try{return x.grow(ee),E(),!0}catch{return!1}},g:C,b:k,c:k,d:k,e:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,B):i.then((j=>j.arrayBuffer())).then((j=>WebAssembly.instantiate(j,B)))).then((j=>{const U=j.instance.exports;return(0,U.g)(),x=U.f,E(),new Oi({setStyle:U.h,setAOOptions:U.i,setMetricOptions:U.j,setStructuralOptions:U.k,setFacadeOptions:U.l,setFauxFacadeOptions:U.m,setFacadeClassifierOptions:U.n,addFeature:U.o,addFacade:U.p,generateMesh:U.q,getLastError:U.r,getOuterRingLength:U.s,getMeshCount:U.t,getPositionsPtr:U.u,getPositionsLength:U.v,getNormalsPtr:U.w,getNormalsLength:U.x,getAOPtr:U.y,getAOLength:U.z,getUVPtr:U.A,getUVLength:U.B,getFauxFacadePtr:U.C,getFauxFacadeLength:U.D,getIndicesPtr:U.E,getIndicesLength:U.F,getBuildingPart:U.G,getRingCount:U.H,getRingPtr:U.I,getRingLength:U.J,malloc:U.K,free:U.L,heapU8:s,heap16:u,heap32:p,heapF32:_})}))})(e).then((i=>(Ii=null,fa=i,fa))).catch((i=>{ji("Could not load building-gen"),Ii=null,un=i})),Ii})()}populate(e,i,s,u){const p=xs();if(!p)return;const _=me(s);this.tileToMeter=_,this.brightness=i.brightness,p.setStyle({normalScale:[1,-1,_],tileToMeters:_}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeClassifierOptions(3);const x=new Map,E=new Map;let C=0;for(const{feature:oe}of e){if(Fv[oe.type]!=="LineString"){x.set(oe.id,oe.properties.source_id);continue}const ye=this.layers[0]._featureFilter.needGeometry;if(ye&&!this.layers[0]._featureFilter.filter(new Ka(this.zoom),oe,s))continue;const xe=mt(oe,ye);if(!ye&&!this.layers[0]._featureFilter.filter(new Ka(this.zoom),xe,s))continue;const Ie=ye?xe.geometry:nt(oe,s,u),$e=[];for(const ut of Ie)for(const Ut of ut)$e.push(Ut.x),$e.push(Ut.y);const je={coordinates:$e,crossPerc:oe.properties.cross_perc,distanceToRoad:oe.properties.distance_to_road,entrances:oe.properties.entrances,sourceId:0},Ye=oe.properties.source_id;let st=E.get(Ye);st||(st=[],E.set(Ye,st)),st.push(je),++C}this.maxHeight=0;const k=new Array,B=new Set,j=oe=>{oe!=null&&B.add(oe)},U=(oe,ye)=>{oe!=null&&k.push({buildingId:oe,footprintIndex:ye})},$=64*(e.length-C),ee=$/2;this.buildingWithFacade.reserve($,ee,!0),this.buildingWithoutFacade.reserve(2*$,2*ee,!1),this.footprintsIndices.reserve(16*(e.length-C)),this.footprintsVertices.reserve(8*(e.length-C));for(const{feature:oe,id:ye,index:xe,sourceLayerIndex:Ie}of e){if(Fv[oe.type]==="LineString")continue;const $e=this.layers[0]._featureFilter.needGeometry;if($e&&!this.layers[0]._featureFilter.filter(new Ka(this.zoom),oe,s))continue;let je=null;if(oe.properties&&oe.properties.hasOwnProperty("building_id")&&(je=oe.properties.building_id,B.has(je)))continue;const Ye=mt(oe,$e);if(!$e&&!this.layers[0]._featureFilter.filter(new Ka(this.zoom),Ye,s))continue;const st=$e?Ye.geometry:nt(oe,s,u),ut=ai(st,500);let Ut=!1;for(const Kn of ut)if(Kn.length!==1){Ut=!0;break}if(Ut){j(je);continue}if(!Ww(st,163)){j(je);continue}const _t=this.layers[0],Wt=Xw(_t.layout.get("building-roof-shape").evaluate(oe,{},s)),ni=_t.layout.get("building-base").evaluate(oe,{},s),ri=_t.layout.get("building-height").evaluate(oe,{},s),wi=_t.layout.get("building-flood-light-ground-radius").evaluate(oe,{},s),Si=_t.paint.get("building-ambient-occlusion-intensity"),gi=wi/this.tileToMeter;oe.properties["building-part"]="roof";const yi=_t.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),Zt=_t.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="wall";const qt=_t.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),vi=_t.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="window";const Bi=_t.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),zi=_t.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);oe.properties["building-part"]="door";const Dn=_t.paint.get("building-color").evaluate(oe,{},this.canonical).toPremultipliedRenderColor(this.lut),rn=_t.paint.get("building-emissive-strength").evaluate(oe,{},this.canonical);let cn=_t.layout.get("building-flood-light-wall-radius").evaluate(oe,{},s);cn=te(cn,0,2048);const wn=cn/2048*vy,Hr=x.get(ye),Di=E.get(Hr)||[],Sn=Di.length!==0&&_t.layout.get("building-facade").evaluate(oe,{},s);p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(Sn,!1,1);let mr=0,pa=0,wa=0,Dr=0,rs=0,Ue=0,Ze=0,Xt=0,Ti=0,Yi=0,Ki=0;if(Sn){let Kn=Math.round(_t.layout.get("building-facade-floors").evaluate(oe,{},s));if(ni===0){Kn=Math.max(1,Kn-(Di.length>0?1:0));let es=4;if(ri>100){const Js=[10,13,15];es=Js[oe.id?oe.id%Js.length:0]}else ri<=10&&(es=3);p.setFacadeOptions(es,!0),rs=(ri<15?1.3:1.61803)*es/_}else rs=ni/_;Ue=ri/_,rs=Math.min(rs,Ue),wa=_t.layout.get("building-facade-unit-width").evaluate(oe,{},s)/_,Dr=(Ue-rs)/Kn,p.setFauxFacadeOptions(!0,!0,wa);const lo=_t.layout.get("building-facade-window").evaluate(oe,{},s);mr=lo[0],pa=lo[1],Ze=Math.floor(65535*Math.min(1,rs/pi)),Xt=Math.floor(65535*Math.min(1,Ue/pi)),Ti=Math.floor(255*mr)<<8|Math.floor(255*pa),Yi=Math.floor(65535*Math.min(1,wa/pi)),Ki=Math.floor(65535*Math.min(1,Dr/pi))}const Pn=Array(ut.length),On={x:1/0,y:1/0},Sr={x:-1/0,y:-1/0},Or={x:0,y:0};let Ur=0;for(let Kn=0;Kn<ut.length;Kn++){const lo=ut[Kn];if(lo.length>0){const es=[],Js=Array(lo.length+1);Js[0]=0;for(let Al=0;Al<lo.length;Al++){const sc=lo[Al];for(let ol=0;ol<sc.length;ol++){const ll=sc[sc.length-ol-1];On.x=Math.min(On.x,ll.x),On.y=Math.min(On.y,ll.y),Sr.x=Math.max(Sr.x,ll.x),Sr.y=Math.max(Sr.y,ll.y),Or.x+=ll.x,Or.y+=ll.y,Ur++,es.push(ll.x),es.push(ll.y)}Js[Al+1]=es.length}Pn[Kn]={id:oe.id?oe.id:0,height:ri,minHeight:ni,sourceId:0,roofType:Wt,coordinates:es,ringIndices:Js}}}Or.x/=Ur||1,Or.y/=Ur||1;const ua=p.generateMesh(Pn,Di);if(typeof ua=="string"){ji(`Unable to generate building ${oe.id}: ${ua}`),j(je);continue}if(ua.meshes.length===0||ua.modifiedPolygonRings.length===0){j(je);continue}const Qn=Sn?this.buildingWithFacade:this.buildingWithoutFacade;let dr=0;for(const Kn of ua.meshes)dr+=Kn.positions.length/3;const za=Qn.segmentsBucket.prepareSegment(dr,Qn.layoutVertexArray,Qn.indexArray),Pa=[];let La=null,Qa=0,fs=-1;const as=Qn.layoutVertexArray.length,Fa=as+dr;Qn.layoutVertexArray.resize(Fa),Qn.layoutCentroidArray.resize(Fa),Qn.layoutNormalArray.resize(Fa),Qn.layoutAOArray.resize(Fa),Qn.layoutColorArray.resize(Fa),Qn.layoutFloodLightDataArray.resize(Fa),Sn&&(Qn.layoutFacadePaintArray.resize(Fa),Qn.layoutFacadeDataArray.resize(Fa),Qn.layoutFacadeVerticalRangeArray.resize(Fa));const Ga=Qn.indexArray.length;let Br=0,ya=as;for(const Kn of ua.meshes){let lo,es;if(Kn.buildingPart===1)lo=yi,es=Zt;else if(Kn.buildingPart===0)lo=qt,es=vi;else if(Kn.buildingPart===2)lo=Bi,es=zi;else{if(Kn.buildingPart!==3)continue;lo=Dn,es=rn}if(es=te(es,0,1),Kn.buildingPart===3){const Rs=new Array;for(let Ml=0;Ml<Kn.positions.length;Ml+=12){const Sp=Kn.positions[Ml+0],Lm=Kn.positions[Ml+1],au=Kn.positions[Ml+3],Eh=Kn.positions[Ml+4],Gd=Kn.positions[Ml+2],E_=Kn.positions[Ml+8]-Gd,dg=1,lm=au-Sp,cm=Eh-Lm,Yg=Math.hypot(lm,cm);Rs.push({pos:[Sp+.5*lm,Lm+.5*cm,Gd],normal:[cm/Yg,-lm/Yg,0],width:Yg,height:E_,depth:dg,points:[Sp,Lm,au,Eh]})}const Do=Qn.entranceBloom.segmentsBucket.prepareSegment(10*Rs.length,Qn.entranceBloom.layoutVertexArray,Qn.entranceBloom.indexArray),Vo=Qn.entranceBloom.layoutVertexArray.length;Qa=Qn.entranceBloom.indexArray.length,Pv(Rs,.5/this.tileToMeter,Qn.entranceBloom.indexArray,Qn.entranceBloom.layoutVertexArray,Qn.entranceBloom.layoutAttenuationArray);const wd=Qn.entranceBloom.layoutVertexArray.length-Vo;fs=Qn.entranceBloom.indexArray.length-Qa;for(let Ml=0;Ml<wd;Ml++)Qn.entranceBloom.layoutColorArray.emplaceBack(255*Dn.r<<8|255*Dn.g,255*Dn.b<<8|51*rn);Do.vertexLength+=wd,Do.primitiveLength+=fs,La={part:Kn.buildingPart,vertexOffset:Vo,vertexLength:wd}}Qn.layoutVertexArray.float32.set(Kn.positions,3*ya);const Js=Kn.positions.length/3;for(let Rs=0;Rs<Js;++Rs){const Do=3*Rs;Br=Math.max(Br,Kn.positions[Do+2]);const Vo=Kn.normals[Do+1]*vy,wd=Kn.normals[Do+2]*vy,Ml=3*(ya+Rs);Qn.layoutNormalArray.int16[Ml]=Kn.normals[Do]*vy,Qn.layoutNormalArray.int16[Ml+1]=Vo,Qn.layoutNormalArray.int16[Ml+2]=wd;const Sp=Kn.ao[Rs];Qn.layoutAOArray.uint8[ya+Rs]=255*Sp;const Lm=1+(Sp-1)*Si,au=255*lo.b*Lm<<8|255*es;Qn.layoutColorArray.uint16[2*(ya+Rs)]=255*lo.r*Lm<<8|255*lo.g*Lm,Qn.layoutColorArray.uint16[2*(ya+Rs)+1]=au}const Al=Math.floor(Or.x),sc=Math.floor(Or.y),ol=Math.floor(ri);for(let Rs=0;Rs<Js;++Rs){const Do=3*(ya+Rs);Qn.layoutCentroidArray.int16[Do]=Al,Qn.layoutCentroidArray.int16[Do+1]=sc,Qn.layoutCentroidArray.int16[Do+2]=ol}if(Qn.layoutFloodLightDataArray.uint16.fill(Kn.buildingPart===0?wn:0,ya,ya+Js),Sn){const Rs=255*Bi.r<<8|255*Bi.g,Do=255*Bi.b<<8|255*zi;for(let Vo=0;Vo<Js;++Vo){const wd=2*(ya+Vo);Qn.layoutFacadePaintArray.uint16[wd]=Rs,Qn.layoutFacadePaintArray.uint16[wd+1]=Do}for(let Vo=0;Vo<Js;++Vo)if(Kn.isFauxFacade[Vo]){const wd=Math.min(65535,Math.floor(Kn.uv[2*Vo]*ua.outerRingLength));Qn.layoutFacadeDataArray.emplace(ya+Vo,1|wd,Ti,Yi,Ki),Qn.layoutFacadeVerticalRangeArray.emplace(ya+Vo,Ze,Xt)}else Qn.layoutFacadeDataArray.emplace(ya+Vo,0,0,0,0),Qn.layoutFacadeVerticalRangeArray.emplace(ya+Vo,0,0)}const ll=za.vertexLength,$l=Kn.indices.length/3,Xh=Qn.indexArray.length;Qn.indexArray.resize(Xh+$l);for(let Rs=0;Rs<$l;++Rs){const Do=3*Rs,Vo=3*Xh+Do;Qn.indexArray.uint16[Vo]=ll+Kn.indices[Do],Qn.indexArray.uint16[Vo+1]=ll+Kn.indices[Do+1],Qn.indexArray.uint16[Vo+2]=ll+Kn.indices[Do+2]}Kn.buildingPart!==1&&Kn.buildingPart!==0&&Kn.buildingPart!==2&&Kn.buildingPart!==3||Pa.push({part:Kn.buildingPart,vertexOffset:ya,vertexLength:Kn.positions.length/3}),ya+=Js,za.vertexLength+=Js,za.primitiveLength+=Kn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Br);const ao=Qn.indexArray.length-Ga,Yn=this.footprintsIndices.length,ha=this.footprintsVertices.length,ls=[],bs=new Ge(1/0,1/0),js=new Ge(-1/0,-1/0),jo=this.groundEffect.vertexArray.length;for(const Kn of ua.modifiedPolygonRings){const lo=[],es=new Ge(1/0,1/0),Js=new Ge(-1/0,-1/0);for(let Al=0;Al<Kn.length;Al+=2){const sc=Kn.length-Al-2;es.x=Math.min(es.x,Kn[sc]),es.y=Math.min(es.y,Kn[sc+1]),Js.x=Math.max(Js.x,Kn[sc]),Js.y=Math.max(Js.y,Kn[sc+1]);const ol=new Ge(Kn[sc],Kn[sc+1]);lo.push(ol),ls.push(ol.x,ol.y),this.footprintsVertices.emplaceBack(ol.x,ol.y)}bs.x=Math.min(bs.x,es.x),bs.y=Math.min(bs.y,es.y),js.x=Math.max(js.x,Js.x),js.y=Math.max(js.y,Js.y),this.groundEffect.addData(lo,[es,Js],gi)}const zs=this.groundEffect.vertexArray.length-jo;this.groundEffect.groundRadiusArray.reserveForAdditional(zs);for(let Kn=0;Kn<zs;Kn++)this.groundEffect.groundRadiusArray.emplaceBack(wi);(On.x<0||Sr.x>pi||On.y<0||Sr.y>pi)&&this.featuresOnBorder.push({featureId:oe.id,footprintIndex:this.footprints.length});{const Kn=Jp(ls,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Kn.length),this.footprintsIndices.uint16.set(Kn,Yn),this.buildingIds.add(je??oe.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,bs.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,bs.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,js.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,js.y);const lo={footprintVertexOffset:ha,footprintVertexLength:this.footprintsVertices.length-ha,footprintIndexOffset:Yn,footprintIndexLength:this.footprintsIndices.length-Yn,min:bs,max:js,hiddenFlags:0,indicesOffset:Ga,indicesLength:ao,bloomIndicesOffset:Qa,bloomIndicesLength:fs,groundEffectVertexOffset:jo,groundEffectVertexLength:zs,hasFauxFacade:Sn,height:Br,promoteId:ye,feature:Ye,parts:Pa,buildingBloom:La},es=this.footprints.length;oe.id!==void 0&&this.featureFootprintLookup.set(oe.id,es),U(je,es),this.footprints.push(lo)}this.programConfigurations.populatePaintArrays(Qn.layoutVertexArray.length,oe,xe,{},i.availableImages,s,i.brightness),this.groundEffect.addPaintPropertiesData(oe,xe,{},i.availableImages,s,i.brightness),i.featureIndex.insert(oe,st,xe,Ie,this.index,as)}k.forEach((({buildingId:oe,footprintIndex:ye})=>{B.has(oe)&&(this.footprints[ye].hiddenFlags|=4)}));const le=new Set;this.buildingIds.forEach(((oe,ye,xe)=>{B.has(oe)||le.add(oe)})),this.buildingIds=le,this.groundEffect.prepareBorderSegments()}update(e,i,s,u,p,_,x){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,x),this.groundEffect.update(e,i,p,s,u,_,x),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=s=>{s.layoutVertexBuffer=e.createVertexBuffer(s.layoutVertexArray,Lv.members),s.layoutNormalBuffer=e.createVertexBuffer(s.layoutNormalArray,Vw.members),s.layoutCentroidBuffer=e.createVertexBuffer(s.layoutCentroidArray,Uw.members),s.layoutFloodLightDataBuffer=e.createVertexBuffer(s.layoutFloodLightDataArray,Zw.members),s.layoutFacadeDataArray&&s.layoutFacadeDataArray.length&&(s.layoutFacadeDataBuffer=e.createVertexBuffer(s.layoutFacadeDataArray,Hw.members)),s.layoutFacadeVerticalRangeArray&&s.layoutFacadeVerticalRangeArray.length&&(s.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(s.layoutFacadeVerticalRangeArray,qw.members)),s.entranceBloom.layoutVertexArray.length&&(s.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(s.entranceBloom.layoutVertexArray,Lv.members),s.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(s.entranceBloom.layoutAttenuationArray,$w.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,s=!0){let u=!1;const p=s?i:0,_=0|(s?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of e){const E=this.footprints[x],C=E.hiddenFlags&_|p;E.hiddenFlags!==C&&(E.hiddenFlags=C,u=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const u of this.footprints){const p=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let E=u.indicesOffset;E<_;E++)p.indexArrayForConflation.uint16[3*E+0]=0,p.indexArrayForConflation.uint16[3*E+1]=0,p.indexArrayForConflation.uint16[3*E+2]=0;const x=u.bloomIndicesOffset+u.bloomIndicesLength;for(let E=u.bloomIndicesOffset;E<x;E++)p.entranceBloom.indexArrayForConflation.uint16[3*E+0]=0,p.entranceBloom.indexArrayForConflation.uint16[3*E+1]=0,p.entranceBloom.indexArrayForConflation.uint16[3*E+2]=0}}const s=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=s=>{s.layoutColorBuffer?s.layoutColorBuffer.updateData(s.layoutColorArray):s.layoutColorBuffer=e.createVertexBuffer(s.layoutColorArray,kv.members,!0),s.layoutFacadePaintArray&&(s.layoutFacadePaintBuffer?s.layoutFacadePaintBuffer.updateData(s.layoutFacadePaintArray):s.layoutFacadePaintBuffer=e.createVertexBuffer(s.layoutFacadePaintArray,Gw.members,!0)),s.entranceBloom.layoutColorBuffer?s.entranceBloom.layoutColorBuffer.updateData(s.entranceBloom.layoutColorArray):s.entranceBloom.layoutColorBuffer=e.createVertexBuffer(s.entranceBloom.layoutColorArray,kv.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const s=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.footprints){if(4&u.hiddenFlags)continue;const p=i[u.promoteId],_=u.feature;_.properties["building-part"]="roof";const x=e.paint.get("building-color").evaluate(_,p,this.canonical).toPremultipliedRenderColor(this.lut),E=e.paint.get("building-emissive-strength").evaluate(_,p,this.canonical);_.properties["building-part"]="wall";const C=e.paint.get("building-color").evaluate(_,p,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(_,p,this.canonical);_.properties["building-part"]="window";const B=e.paint.get("building-color").evaluate(_,p,this.canonical).toPremultipliedRenderColor(this.lut),j=e.paint.get("building-emissive-strength").evaluate(_,p,this.canonical);_.properties["building-part"]="door";const U=e.paint.get("building-color").evaluate(_,p,this.canonical).toPremultipliedRenderColor(this.lut),$=e.paint.get("building-emissive-strength").evaluate(_,p,this.canonical),ee=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const oe of u.parts){let ye,xe=x;oe.part===1?(xe=x,ye=E):oe.part===0?(xe=C,ye=k):oe.part===2?(xe=B,ye=j):oe.part===3&&(xe=U,ye=$),ye=te(ye,0,1);for(let Ie=0;Ie<oe.vertexLength;Ie++){const $e=oe.vertexOffset+Ie,je=1+(ee.layoutAOArray.uint8[$e]/255-1)*s;ee.layoutColorArray.emplace($e,xe.r*je*255<<8|xe.g*je*255,xe.b*je*255<<8|255*ye),u.hasFauxFacade&&ee.layoutFacadePaintArray.emplace($e,255*B.r<<8|255*B.g,255*B.b<<8|255*j)}}const le=u.buildingBloom;if(le)for(let oe=0;oe<le.vertexLength;oe++)ee.entranceBloom.layoutColorArray.emplace(le.vertexOffset+oe,255*U.r<<8|255*U.g,255*U.b<<8|51*$)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(wh(this.activeReplacements,u))return;this.activeReplacements=u;for(const _ of this.footprints)_.hiddenFlags&=-2;const p=[];for(const _ of this.activeReplacements){if(_.order<=To)continue;const x=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const E of this.footprints)E.min.x>_.max.x||E.max.x<_.min.x||E.min.y>_.max.y||E.max.y<_.min.y||(p.length=0,Kw(this.footprintsVertices,E.footprintVertexOffset,E.footprintVertexLength,_.footprintTileId.canonical,e.canonical,p),El(_.footprint,p,this.footprintsIndices.uint16,E.footprintIndexOffset,E.footprintIndexLength,0,-x)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+pi)*pi+(i+pi);if(this.footprintLookup.hasOwnProperty(p)){const x=this.footprintLookup[p];return x?{height:x.height,hidden:x.hiddenFlags!==0}:void 0}const _=new Ge(e,i);for(const x of this.footprints)e>x.max.x||x.min.x>e||i>x.max.y||x.min.y>i||x.height<=s||Yw(_,this.footprintsVertices.float32.subarray(2*x.footprintVertexOffset,2*(x.footprintVertexOffset+x.footprintVertexLength)),this.footprintsIndices.uint16.subarray(x.footprintIndexOffset,x.footprintIndexOffset+x.footprintIndexLength))&&(s=x.height,this.footprintLookup[p]=x,u=x.hiddenFlags!==0);if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:u};this.footprintLookup[p]=void 0}}function Yw(r,e,i){for(let s=0;s<i.length;s+=3){const u=i[s],p=i[s+1],_=i[s+2],x=e[2*u+0],E=e[2*u+1],C=e[2*p+0],k=e[2*p+1],B=e[2*_+0],j=e[2*_+1],U=(x-B)*(r.y-j)-(E-j)*(r.x-B),$=(C-x)*(r.y-E)-(k-E)*(r.x-x);if(U<0!=$<0&&U!==0&&$!==0)continue;const ee=(B-C)*(r.y-k)-(j-k)*(r.x-C);if(ee===0||ee<0==U+$<=0)return!0}return!1}function Kw(r,e,i,s,u,p){const _=Math.pow(2,s.z-u.z);for(let x=0;x<i;x++){let E=r.float32[2*(x+e)+0],C=r.float32[2*(x+e)+1];E=(E+u.x*pi)*_-s.x*pi,C=(C+u.y*pi)*_-s.y*pi,p.push(new Ge(E,C))}}let Bv,Nv;hi(Ov,"BuildingBucket",{omit:["layers"]}),hi(f0,"BuildingGeometry"),hi(d0,"BuildingBloomGeometry");const Jw=Yr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Qw=Yr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:e2}=Jw,t2=Yr([{name:"a_packed",components:3,type:"Float32"}]),{members:i2}=t2,n2=Yr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:r2}=n2;class jv{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new bd({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=St(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const u=[];let p=e.length%2==1?-e[e.length-1]*s:0,_=e[0]*s,x=!0;u.push({left:p,right:_,isDash:x,zeroLength:e[0]===0});let E=e[0];for(let C=1;C<e.length;C++){x=!x;const k=e[C];p=E*s,E+=k,_=E*s,u.push({left:p,right:_,isDash:x,zeroLength:k===0})}return u}addRoundDash(e,i,s){const u=i/2;for(let p=-s;p<=s;p++){const _=this.width*(this.nextRow+s+p);let x=0,E=e[x];for(let C=0;C<this.width;C++){C/E.right>1&&(E=e[++x]);const k=Math.abs(C-E.left),B=Math.abs(C-E.right),j=Math.min(k,B);let U;const $=p/s*(u+1);if(E.isDash){const ee=u-Math.abs($);U=Math.sqrt(j*j+ee*ee)}else U=u-Math.sqrt(j*j+$*$);this.image.data[_+C]=Math.max(0,Math.min(255,U+128))}}}addRegularDash(e,i){for(let E=e.length-1;E>=0;--E){const C=e[E],k=e[E+1];C.zeroLength?e.splice(E,1):k&&k.isDash===C.isDash&&(k.left=C.left,e.splice(E,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const p=this.width*this.nextRow;let _=0,x=e[_];for(let E=0;E<this.width;E++){E/x.right>1&&(x=e[++_]);const C=Math.abs(E-x.left),k=Math.abs(E-x.right),B=Math.min(C,k);this.image.data[p+E]=Math.max(0,Math.min(255,(x.isDash?B:-B)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const u=i==="round",p=u?7:0,_=2*p+1;if(this.nextRow+_>this.height)return ji("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let k=0;k<e.length;k++)e[k]<0&&(ji("Negative value is found in line dasharray, replacing values with 0"),e[k]=0),x+=e[k];if(x!==0){const k=this.width/x,B=this.getDashRanges(e,this.width,k);u?this.addRoundDash(B,k,p):this.addRegularDash(B,i==="square"?.5*k:0)}const E=this.nextRow+p;this.nextRow+=_;const C={tl:[E,p],br:[x,0]};return this.positions[s]=C,C}}hi(jv,"LineAtlas");const a2=dt.types,s2=Math.cos(Math.PI/180*37.5),o2=Math.cos(Math.PI/180*5);class p0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new cp,this.layoutVertexArray2=new xc,this.patternVertexArray=new xc,this.indexArray=new co,this.programConfigurations=new gh(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Ss,this.maxLineLength=0,this.zOffsetVertexArray=new xc,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:pi/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){this.hasPattern=Fi("line",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=me(s);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const j=this.layers[0].layout.get("line-z-offset"),U=j.isConstant()&&!j.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&U?"none":"offset",this.elevationType==="offset"&&_==="none"&&ji(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const E=[];for(const{feature:j,id:U,index:$,sourceLayerIndex:ee}of e){const le=this.layers[0]._featureFilter.needGeometry,oe=mt(j,le);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),oe,s))continue;const ye=p?p.evaluate(oe,{},s):void 0,xe={id:U,properties:j.properties,type:j.type,sourceLayerIndex:ee,index:$,geometry:le?oe.geometry:nt(j,s,u),patterns:{},sortKey:ye};E.push(xe)}p&&E.sort(((j,U)=>j.sortKey-U.sortKey));const{lineAtlas:C,featureIndex:k}=i,B=this.addConstantDashes(C);for(const j of E){const{geometry:U,index:$,sourceLayerIndex:ee}=j;if(B&&this.addFeatureDashes(j,C),this.hasPattern){const le=gn("line",this.layers,j,this.zoom,this.pixelRatio,i);this.patternFeatures.push(le)}else this.addFeature(j,U,$,s,C.positions,i.availableImages,i.brightness,i.elevationFeatures);k.insert(e[$].feature,U,$,ee,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if(u.kind!=="constant"||p.kind!=="constant")i=!0;else{const _=p.value,x=u.value;if(!x)continue;e.addDash(x,_)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if(p.kind==="constant"&&_.kind==="constant")continue;let x,E;if(p.kind==="constant"){if(x=p.value,!x)continue}else x=p.evaluate({zoom:s},e);E=_.kind==="constant"?_.value:_.evaluate({zoom:s},e),i.addDash(x,E),e.patterns[u.id]=[i.getKey(x,E)]}}update(e,i,s,u,p,_,x,E){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,x,E)}addFeatures(e,i,s,u,p,_){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,s,u,_,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,i2)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,r2)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Qw.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,e2),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let s,u;if(i&&i>0?(s=`mapbox_clip_start_${i}`,u=`mapbox_clip_end_${i}`):(s="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(s)&&e.properties.hasOwnProperty(u))return{start:+e.properties[s],end:+e.properties[u]}}addFeature(e,i,s,u,p,_,x,E){const C=this.layers[0].layout,k=C.get("line-join").evaluate(e,{}),B=C.get("line-cap").evaluate(e,{}),j=C.get("line-miter-limit"),U=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const $=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=C.get("line-z-offset").value;const ee=this.layers[0].paint.get("line-width").value;if(ee.kind!=="constant"&&ee.isLineProgressConstant===!1&&(this.variableWidthValue=ee),this.elevationType==="road"){const le=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,u,E,k,B,j,U)){const[oe,ye]=this.clipRuntimeLinesToTile(i,1);for(let xe=0;xe<oe.length;xe++){const Ie=oe[xe],$e=ye[xe],je={progress:{min:$e.progress.min,max:$e.progress.max},nextDir:this.computeSegNextDir($e,Ie),prevDir:this.computeSegPrevDir($e,Ie)};this.addLine(Ie,e,u,k,B,j,U,je,$&&$e.parentIndex>0?$e.parentIndex:null)}this.fillNonElevatedRoadSegment(le)}}else for(let le=0;le<i.length;le++)this.addLine(i[le],e,u,k,B,j,U,void 0,$&&le>0?le:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,_,u,x,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return nm(e,-i,-i,pi+i,pi+i)}clipRuntimeLinesToTile(e,i){const s=[];return[nm(e,-i,-i,pi+i,pi+i,s),s]}addElevatedRoadFeature(e,i,s,u,p,_,x,E){const C=[],k=xr.getElevationFeature(e,u);if(k){const B=this.clipLinesToTile(i,1),j=this.prepareElevatedLines(B,k,s);for(const U of j)C.push({geometry:U,elevation:k,elevationTileID:s,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(const B of C){const j=this.layoutVertexArray.length;this.addLine(B.geometry,e,s,p,_,x,E);const U=new Zr(s,B.elevationTileID);if(B.elevation)for(let $=j;$<this.layoutVertexArray.length;$++){const ee=new Ge(this.layoutVertexArray.int16[6*$]>>1,this.layoutVertexArray.int16[6*$+1]>>1),le=U.pointElevation(ee,B.elevation,.05);this.updateHeightRange(le),this.zOffsetVertexArray.emplaceBack(le,0,0)}else this.fillNonElevatedRoadSegment(j)}return!0}prepareElevatedLines(e,i,s){if(i.constantHeight!=null)return e;const u=[],p=1/me(s);for(const _ of e)uy(_,new ca(i,p),0,u);return u}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,s,u,p,_,x,E,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=C?this.lineFeatureClips(i,C):this.lineClips;const k=u==="none";this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const B=E&&E.progress.min>0,j=E&&E.progress.max<1;if(this.lineClips){let ut={min:this.lineClips.start,max:this.lineClips.end},Ut=1;if(E){const ni=this.lineClips.end-this.lineClips.start;ut=(function(ri,wi,Si){return{min:ur(ri.min,wi,Si),max:ur(ri.max,wi,Si)}})(E.progress,{min:0,max:1},ut),ni>0&&(Ut=(ut.max-ut.min)/ni)}const _t=+i.properties.mapbox_clip_feature_len,Wt=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(_t)||Number.isNaN(Wt)){for(let ri=0;ri<e.length-1;ri++)this.totalDistance+=e[ri].dist(e[ri+1]);const ni=this.totalDistance/(ut.max-ut.min);this.totalFeatureLength=Number.isFinite(ni)?ni:0,this.lineClips.start=ut.min,this.lineClips.end=ut.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=_t,this.distance=Wt*Ut,this.lineClips.start=ut.min,this.lineClips.end=ut.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const U=a2[i.type]==="Polygon";let $=e.length;for(;$>=2&&e[$-1].equals(e[$-2]);)$--;let ee=0;for(;ee<$-1&&e[ee].equals(e[ee+1]);)ee++;if($<(U?3:2))return;u==="bevel"&&(_=1.05);const le=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let oe,ye,xe,Ie,$e,je,Ye,st;E&&E.prevDir&&(je=E.prevDir.perp()),E&&E.nextDir&&(Ye=E.nextDir.perp()),this.e1=this.e2=-1,U&&(oe=e[$-2],$e=e[ee].sub(oe)._unit()._perp());for(let ut=ee;ut<$;ut++){if(xe=ut===$-1?U?e[ee+1]:void 0:e[ut+1],xe&&e[ut].equals(xe))continue;$e&&(Ie=$e),oe&&(ye=oe),oe=e[ut],st=this.evaluateLineProgressFeatures(ye?ye.dist(oe):0),$e=xe?xe.sub(oe)._unit()._perp():Ie,Ie=Ie||$e;const Ut=ye&&xe;let _t=Ut?u:U||k?"butt":p;const Wt=Ie.x*$e.x+Ie.y*$e.y;if(k){const qt=function(vi){if(vi.patternJoinNone){const Bi=vi.segmentPoints.length/2,zi=vi.lineSoFar-vi.segmentStart;for(let Dn=0;Dn<Bi;++Dn){const rn=vi.segmentPoints[2*Dn+1],cn=Math.round(vi.segmentPoints[2*Dn])+.5+.25*rn;vi.patternVertexArray.emplaceBack(cn,zi,vi.segmentStart),vi.patternVertexArray.emplaceBack(cn,zi,vi.segmentStart)}vi.segmentPoints.length=0}vi.e1=vi.e2=-1};if(Ut&&Wt<o2){this.updateDistance(ye,oe),this.addCurrentVertex(oe,Ie,1,1,le,st),qt(this),this.addCurrentVertex(oe,$e,-1,-1,le,st);continue}if(ye){if(!xe){this.updateDistance(ye,oe),this.addCurrentVertex(oe,Ie,1,1,le,st),qt(this);continue}_t="miter"}}let ni=Ie.add($e);ni.x===0&&ni.y===0||ni._unit();const ri=ni.x*$e.x+ni.y*$e.y,wi=ri!==0?1/ri:1/0,Si=2*Math.sqrt(2-2*ri),gi=ri<s2&&ye&&xe,yi=Ie.x*$e.y-Ie.y*$e.x>0,Zt=this.overscaling<=16?15*pi/(512*this.overscaling):0;if(Ut&&_t==="round"){if(wi<x)_t="miter";else if(wi<=2){const qt=m0(oe,-10,pi+10);_t=this.elevationType==="offset"&&(qt||this.hasCrossSlope)?"miter":"fakeround"}}if(_t==="miter"&&wi>_&&(_t="bevel"),_t==="bevel"&&(wi>2&&(_t="flipbevel"),wi<_&&(_t="miter")),ye&&!(_t==="miter"&&gi)&&this.updateDistance(ye,oe),_t==="miter")if(gi){const qt=oe.dist(ye);if(qt>2*Zt){const Bi=oe.sub(oe.sub(ye)._mult(Zt/qt)._round());this.updateDistance(ye,Bi),this.addCurrentVertex(Bi,Ie,0,0,le,st),ye=Bi}this.updateDistance(ye,oe),ni._mult(wi),this.addCurrentVertex(oe,ni,0,0,le,st);const vi=oe.dist(xe);if(vi>2*Zt){const Bi=oe.add(xe.sub(oe)._mult(Zt/vi)._round());this.updateDistance(oe,Bi),this.addCurrentVertex(Bi,$e,0,0,le,st),oe=Bi}}else ni._mult(wi),this.addCurrentVertex(oe,ni,0,0,le,st);else if(_t==="flipbevel"){if(wi>100)ni=$e.mult(-1);else{const qt=wi*Ie.add($e).mag()/Ie.sub($e).mag();ni._perp()._mult(qt*(yi?-1:1))}this.addCurrentVertex(oe,ni,0,0,le,st),this.addCurrentVertex(oe,ni.mult(-1),0,0,le,st)}else if(_t==="bevel"||_t==="fakeround"){st!=null&&ye&&this.addCurrentVertex(oe,Ye||Ie,-1,-1,le,st);const qt=oe.dist(ye)<=2*Zt&&_t!=="bevel",vi=ni.mult(yi?1:-1);vi._mult(wi);const Bi=$e.mult(yi?-1:1),zi=Ie.mult(yi?-1:1),Dn=this.evaluateLineProgressFeatures(this.distance);if(st==null&&(this.addHalfVertex(oe,vi.x,vi.y,!1,!yi,0,le,Dn),qt||this.addHalfVertex(oe,vi.x+2*zi.x,vi.y+2*zi.y,!1,yi,0,le,Dn)),_t==="fakeround"){const rn=Math.round(180*Si/Math.PI/20);this.addHalfVertex(oe,zi.x,zi.y,!1,yi,0,le,Dn);for(let cn=0;cn<rn;cn++){let wn=cn/rn;if(wn!==.5){const Di=wn-.5;wn+=wn*Di*(wn-1)*((1.0904+Wt*(Wt*(3.55645-1.43519*Wt)-3.2452))*Di*Di+(.848013+Wt*(.215638*Wt-1.06021)))}const Hr=Bi.sub(zi)._mult(wn)._add(zi)._unit();this.addHalfVertex(oe,Hr.x,Hr.y,!1,yi,0,le,Dn)}this.addHalfVertex(oe,Bi.x,Bi.y,!1,yi,0,le,Dn)}qt||st!=null||this.addHalfVertex(oe,vi.x+2*Bi.x,vi.y+2*Bi.y,!1,yi,0,le,Dn),st!=null&&xe&&this.addCurrentVertex(oe,je||$e,1,1,le,st)}else if(_t==="butt")this.addCurrentVertex(oe,ni,0,0,le,st);else if(_t==="square"){if(!ye){const qt=B?0:-1;this.addCurrentVertex(oe,ni,qt,qt,le,st)}if(this.addCurrentVertex(oe,ni,0,0,le,st),ye){const qt=j?0:1;this.addCurrentVertex(oe,ni,qt,qt,le,st)}}else if(_t==="round"){if(ye){const qt=!Ut&&Ye?Ye:Ie;this.addCurrentVertex(oe,qt,0,0,le,st),!Ut&&j||this.addCurrentVertex(oe,qt,1,1,le,st,!0)}if(xe){const qt=!Ut&&je?je:$e;!Ut&&B||this.addCurrentVertex(oe,qt,-1,-1,le,st,!0),this.addCurrentVertex(oe,qt,0,0,le,st)}}}}addVerticesTo(e,i,s,u,p,_,x,E,C,k){const B=(i.w-e.w)/this.tessellationStep|0;let j=0;const U=this.scaledDistance;if(B>1){this.lineSoFar=e.w;const ee=(i.x-e.x)/B,le=(i.y-e.y)/B,oe=(i.z-e.z)/B,ye=(i.w-e.w)/B;for(let xe=1;xe<B;++xe){e.x+=ee,e.y+=le,e.z+=oe,this.lineSoFar+=ye,j+=ye;const Ie=this.evaluateLineProgressFeatures(this.prevDistance+j);this.scaledDistance=(this.prevDistance+j)/this.totalDistance,this.addHalfVertex(e,s,u,k,!1,x,C,Ie),this.addHalfVertex(e,p,_,k,!0,-E,C,Ie)}}this.lineSoFar=i.w,this.scaledDistance=U;const $=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,u,k,!1,x,C,$),this.addHalfVertex(i,p,_,k,!0,-E,C,$)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):ji(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,s,u,p,_,x=!1){const E=i.x+i.y*s,C=i.y-i.x*s,k=i.y*u-i.x,B=-i.y-i.x*u;if(_!=null){const j=this.elevationType==="offset",U=-10,$=pi+10,ee=_.zOffset,le=new O_(e.x,e.y,ee,this.lineSoFar),oe=!!j&&m0(e,U,$),ye=this.lineSoFar,xe=this.distance;if(this.currentVertex)if(oe){const Ie=this.currentVertexIsOutside,$e=this.currentVertex,je=new O_(e.x,e.y,ee,this.lineSoFar);if(Tg($e,je,U,$),!m0(je,U,$)){if(Ie){this.e1=this.e2=-1,this.distance-=$e.dist(le),this.lineSoFar=$e.w;const Ye=this.evaluateLineProgressFeatures($e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex($e,E,C,x,!1,s,p,Ye),this.addHalfVertex($e,k,B,x,!0,-u,p,Ye),this.prevDistance=this.distance}this.distance=this.prevDistance+$e.dist(je),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo($e,je,E,C,k,B,s,u,p,x),this.distance=xe,this.scaledDistance=this.distance/this.totalDistance}}else{const Ie=this.currentVertex;if(this.currentVertexIsOutside){Tg(Ie,le,U,$),this.e1=this.e2=-1,this.distance-=Ie.dist(le),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Ie.w;const $e=this.evaluateLineProgressFeatures(Ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ie,E,C,x,!1,s,p,$e),this.addHalfVertex(Ie,k,B,x,!0,-u,p,$e),this.prevDistance=this.distance,this.distance=xe,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Ie,le,E,C,k,B,s,u,p,x)}else oe||(this.addHalfVertex(e,E,C,x,!1,s,p,_),this.addHalfVertex(e,k,B,x,!0,-u,p,_));this.currentVertex=le,this.currentVertexIsOutside=oe,this.lineSoFar=ye}else this.addHalfVertex(e,E,C,x,!1,s,p,_),this.addHalfVertex(e,k,B,x,!0,-u,p,_)}addHalfVertex({x:e,y:i},s,u,p,_,x,E,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const B=Hn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,B)}const k=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),E.primitiveLength++),_?this.e2=k:this.e1=k,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function m0(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let Vv,Uv;function Gv(r,e,i){return e*(pi/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}hi(p0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Hv=(r,e,i)=>(1-i)*r+i*e;function qv(r,e){return 1/Gv(r,1,e.tileZoom)}function $v(r,e,i,s){return r.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Zv=r=>{const e=[];Wv(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=r.layout.get("line-join").constantOr("miter")==="none",u=!!r.paint.get("line-pattern").constantOr(1);return s&&u&&e.push("LINE_JOIN_NONE"),e};function Wv(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let _0;const Xv=()=>_0||(_0={layout:Vv||(Vv=new da({"line-cap":new Gi(bt.layout_line["line-cap"]),"line-join":new Gi(bt.layout_line["line-join"]),"line-miter-limit":new bi(bt.layout_line["line-miter-limit"]),"line-round-limit":new bi(bt.layout_line["line-round-limit"]),"line-sort-key":new Gi(bt.layout_line["line-sort-key"]),"line-z-offset":new Gi(bt.layout_line["line-z-offset"]),"line-elevation-reference":new bi(bt.layout_line["line-elevation-reference"]),"line-cross-slope":new bi(bt.layout_line["line-cross-slope"]),visibility:new bi(bt.layout_line.visibility),"line-width-unit":new bi(bt.layout_line["line-width-unit"])})),paint:Uv||(Uv=new da({"line-opacity":new Gi(bt.paint_line["line-opacity"]),"line-color":new Gi(bt.paint_line["line-color"]),"line-translate":new bi(bt.paint_line["line-translate"]),"line-translate-anchor":new bi(bt.paint_line["line-translate-anchor"]),"line-width":new Gi(bt.paint_line["line-width"]),"line-gap-width":new Gi(bt.paint_line["line-gap-width"]),"line-offset":new Gi(bt.paint_line["line-offset"]),"line-blur":new Gi(bt.paint_line["line-blur"]),"line-dasharray":new Gi(bt.paint_line["line-dasharray"]),"line-pattern":new Gi(bt.paint_line["line-pattern"]),"line-pattern-cross-fade":new bi(bt.paint_line["line-pattern-cross-fade"]),"line-gradient":new _d(bt.paint_line["line-gradient"]),"line-trim-offset":new bi(bt.paint_line["line-trim-offset"]),"line-trim-fade-range":new bi(bt.paint_line["line-trim-fade-range"]),"line-trim-color":new bi(bt.paint_line["line-trim-color"]),"line-emissive-strength":new Gi(bt.paint_line["line-emissive-strength"]),"line-border-width":new Gi(bt.paint_line["line-border-width"]),"line-border-color":new Gi(bt.paint_line["line-border-color"]),"line-occlusion-opacity":new bi(bt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},_0);class l2 extends Gi{possiblyEvaluate(e,i){return i=new Ka(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,u){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,u)}}let Mg;function Yv(r,e){return e>0?e+2*r:r}const c2=Yr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),u2=Yr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),h2=Yr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Yr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const d2=Yr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),f2=Yr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),p2=Yr([{name:"a_texb",components:2,type:"Uint16"}]),m2=Yr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),_2=Yr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Kv=Yr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),g2=Yr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Yr([{name:"triangle",components:3,type:"Uint16"}]),Yr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Yr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Yr([{type:"Float32",name:"offsetX"}]),Yr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ac=24;function y2(r,e,i){return r.sections.forEach((s=>{s.text=(function(u,p,_){const x=p.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?u=u.toLocaleUpperCase():x==="lowercase"&&(u=u.toLocaleLowerCase()),Gu.applyArabicShaping&&(u=Gu.applyArabicShaping(u)),u})(s.text,e,i)})),r}const Ig={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function v2(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function x2(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const g0=4294967296,Jv=1/g0,Qv=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let xy=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){const s=this.readVarint(),u=s>>3,p=this.pos;this.type=7&s,r(u,e,this),this.pos===p&&this.skip(s)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*g0;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*g0;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let i,s;return s=e[this.pos++],i=127&s,s<128?i:(s=e[this.pos++],i|=(127&s)<<7,s<128?i:(s=e[this.pos++],i|=(127&s)<<14,s<128?i:(s=e[this.pos++],i|=(127&s)<<21,s<128?i:(s=e[this.pos],i|=(15&s)<<28,(function(u,p,_){const x=_.buf;let E,C;if(C=x[_.pos++],E=(112&C)>>4,C<128||(C=x[_.pos++],E|=(127&C)<<3,C<128)||(C=x[_.pos++],E|=(127&C)<<10,C<128)||(C=x[_.pos++],E|=(127&C)<<17,C<128)||(C=x[_.pos++],E|=(127&C)<<24,C<128)||(C=x[_.pos++],E|=(1&C)<<31,C<128))return eg(u,E,p);throw new Error("Expected varint not more than 10 bytes")})(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Qv?Qv.decode(this.buf.subarray(e,r)):(function(i,s,u){let p="",_=s;for(;_<u;){const x=i[_];let E,C,k,B=null,j=x>239?4:x>223?3:x>191?2:1;if(_+j>u)break;j===1?x<128&&(B=x):j===2?(E=i[_+1],(192&E)==128&&(B=(31&x)<<6|63&E,B<=127&&(B=null))):j===3?(E=i[_+1],C=i[_+2],(192&E)==128&&(192&C)==128&&(B=(15&x)<<12|(63&E)<<6|63&C,(B<=2047||B>=55296&&B<=57343)&&(B=null))):j===4&&(E=i[_+1],C=i[_+2],k=i[_+3],(192&E)==128&&(192&C)==128&&(192&k)==128&&(B=(15&x)<<18|(63&E)<<12|(63&C)<<6|63&k,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,j=1):B>65535&&(B-=65536,p+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),p+=String.fromCharCode(B),_+=j}return p})(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Jv),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*Jv),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(e,i){let s,u;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(s=~(-e%4294967296),u=~(-e/4294967296),4294967295^s?s=s+1|0:(s=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(p,_,x){x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,p>>>=7,x.buf[x.pos++]=127&p|128,x.buf[x.pos]=127&(p>>>=7)})(s,0,i),(function(p,_){const x=(7&p)<<4;_.buf[_.pos++]|=x|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))})(u,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=(function(s,u,p){for(let _,x,E=0;E<u.length;E++){if(_=u.charCodeAt(E),_>55295&&_<57344){if(!x){_>56319||E+1===u.length?(s[p++]=239,s[p++]=191,s[p++]=189):x=_;continue}if(_<56320){s[p++]=239,s[p++]=191,s[p++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(s[p++]=239,s[p++]=191,s[p++]=189,x=null);_<128?s[p++]=_:(_<2048?s[p++]=_>>6|192:(_<65536?s[p++]=_>>12|224:(s[p++]=_>>18|240,s[p++]=_>>12&63|128),s[p++]=_>>6&63|128),s[p++]=63&_|128)}return p})(this.buf,r,this.pos);const i=this.pos-e;i>=128&&ex(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;const i=this.pos;r(e,this);const s=this.pos-i;s>=128&&ex(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,b2,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,w2,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,E2,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,T2,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,S2,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,A2,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,M2,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,I2,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,C2,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function eg(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function ex(r,e,i){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(let u=i.pos-1;u>=r;u--)i.buf[u+s]=i.buf[u]}function b2(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function w2(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function T2(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function S2(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function E2(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function A2(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function M2(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function I2(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function C2(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}const y0=3;function z2(r,e,i){e.glyphs=[],r===1&&i.readMessage(R2,e)}function R2(r,e,i){if(r===3){const{id:s,bitmap:u,width:p,height:_,left:x,top:E,advance:C}=i.readMessage(D2,{});e.glyphs.push({id:s,bitmap:new bd({width:p+2*y0,height:_+2*y0},u),metrics:{width:p,height:_,left:x,top:E,advance:C}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function D2(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const tx=y0,Ud={horizontal:1,vertical:2,horizontalOnly:3};class Cg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new Cg;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Cg;return i.image=e,i}}class tg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,s){const u=new tg;for(let p=0;p<e.sections.length;p++){const _=e.sections[p];_.image?u.addImageSection(_,s):u.addTextSection(_,i)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,s){let u="";for(let p=0;p<i.length;p++){const _=i.charCodeAt(p+1)||null,x=i.charCodeAt(p-1)||null;u+=!s&&(_&&jh(_)&&!Ig[i[p+1]]||x&&jh(x)&&!Ig[i[p-1]])||!Ig[i[p]]?i[p]:Ig[i[p]]}return u})(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&by[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&by[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new tg;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Cg.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e,i){const s=e.image?e.image.getPrimary():null;if(!s)return void ji("Can't add FormattedSection with an empty image.");s.scaleSelf(i);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(Cg.forImage(s)),this.sectionIndex.push(this.sections.length-1)):ji("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function v0(r,e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee=1){const le=tg.fromFeature(r,u,ee);B===Ud.vertical&&le.verticalizePunctuation(j);let oe=[];const ye=(function(Ye,st,ut,Ut,_t,Wt){if(!Ye)return[];const ni=[],ri=(function(yi,Zt,qt,vi,Bi,zi){let Dn=0;for(let rn=0;rn<yi.length();rn++){const cn=yi.getSection(rn);Dn+=ix(yi.getCodePoint(rn),cn,vi,Bi,Zt,zi)}return Dn/Math.max(1,Math.ceil(Dn/qt))})(Ye,st,ut,Ut,_t,Wt),wi=Ye.text.indexOf("")>=0;let Si=0;for(let yi=0;yi<Ye.length();yi++){const Zt=Ye.getSection(yi),qt=Ye.getCodePoint(yi);if(by[qt]||(Si+=ix(qt,Zt,Ut,_t,st,Wt)),yi<Ye.length()-1){const vi=!((gi=qt)<11904||!(pn["Bopomofo Extended"](gi)||pn.Bopomofo(gi)||pn["CJK Compatibility Forms"](gi)||pn["CJK Compatibility Ideographs"](gi)||pn["CJK Compatibility"](gi)||pn["CJK Radicals Supplement"](gi)||pn["CJK Strokes"](gi)||pn["CJK Symbols and Punctuation"](gi)||pn["CJK Unified Ideographs Extension A"](gi)||pn["CJK Unified Ideographs"](gi)||pn["Enclosed CJK Letters and Months"](gi)||pn["Halfwidth and Fullwidth Forms"](gi)||pn.Hiragana(gi)||pn["Ideographic Description Characters"](gi)||pn["Kangxi Radicals"](gi)||pn["Katakana Phonetic Extensions"](gi)||pn.Katakana(gi)||pn["Vertical Forms"](gi)||pn["Yi Radicals"](gi)||pn["Yi Syllables"](gi)));(P2[qt]||vi||Zt.image)&&ni.push(rx(yi+1,Si,ri,ni,L2(qt,Ye.getCodePoint(yi+1),vi&&wi),!1))}}var gi;return ax(rx(Ye.length(),Si,ri,ni,0,!0))})(le,C,p,e,s,U),{processBidirectionalText:xe,processStyledBidirectionalText:Ie}=Gu;if(xe&&le.sections.length===1){const Ye=xe(le.toString(),ye);for(const st of Ye){const ut=new tg;ut.text=st,ut.sections=le.sections;for(let Ut=0;Ut<st.length;Ut++)ut.sectionIndex.push(0);oe.push(ut)}}else if(Ie){const Ye=Ie(le.text,le.sectionIndex,ye);for(const st of Ye){const ut=new tg;ut.text=st[0],ut.sectionIndex=st[1],ut.sections=le.sections,oe.push(ut)}}else oe=(function(Ye,st){const ut=[],Ut=Ye.text;let _t=0;for(const Wt of st)ut.push(Ye.substring(_t,Wt)),_t=Wt;return _t<Ut.length&&ut.push(Ye.substring(_t,Ut.length)),ut})(le,ye);const $e=[],je={positionedLines:$e,text:le.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:B,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(Ye,st,ut,Ut,_t,Wt,ni,ri,wi,Si,gi,yi){let Zt=0,qt=0,vi=0;const Bi=ri==="right"?1:ri==="left"?0:.5;let zi=!1;for(const Di of _t){const Sn=Di.getSections();for(const mr of Sn){if(mr.image)continue;const pa=st[mr.fontStack];if(pa&&(zi=pa.ascender!==void 0&&pa.descender!==void 0,!zi))break}if(!zi)break}let Dn=0;for(const Di of _t){Di.trim();const Sn=Di.getMaxScale(),mr=(Sn-1)*ac,pa={positionedGlyphs:[],lineOffset:0};Ye.positionedLines[Dn]=pa;const wa=pa.positionedGlyphs;let Dr=0;if(!Di.length()){qt+=Wt,++Dn;continue}let rs=0,Ue=0;for(let Xt=0;Xt<Di.length();Xt++){const Ti=Di.getSection(Xt),Yi=Di.getSectionIndex(Xt),Ki=Di.getCodePoint(Xt);let Pn=Ti.scale,On=null,Sr=null,Or=null,Ur=ac,ua=0,Qn=wi;Qn===Ud.vertical&&((rn=Ki)===12312||rn===12313||rn===12316||rn===12540||rn===12448)&&(Qn=Ud.horizontal);const dr=!(Qn===Ud.horizontal||!gi&&!_c(Ki)||gi&&(by[Ki]||Ys(Ki)));if(Ti.image){const za=Ut.get(Ti.image.toString());if(!za)continue;Or=Ti.image,Ye.iconsInText=Ye.iconsInText||!0,Sr=za.paddedRect;const Pa=za.displaySize;Pn=Pn*ac/yi,On={width:Pa[0],height:Pa[1],left:0,top:-tx,advance:dr?Pa[1]:Pa[0],localGlyph:!1},ua=zi?-On.height*Pn:Sn*ac-17-Pa[1]*Pn,Ur=On.advance;const La=(dr?Pa[0]:Pa[1])*Pn-ac*Sn;La>0&&La>Dr&&(Dr=La)}else{const za=ut[Ti.fontStack];if(!za)continue;za[Ki]&&(Sr=za[Ki]);const Pa=st[Ti.fontStack];if(!Pa)continue;const La=Pa.glyphs[Ki];if(!La)continue;if(On=La.metrics,Ur=Ki!==8203?ac:0,zi){const Qa=Pa.ascender!==void 0?Math.abs(Pa.ascender):0,fs=Pa.descender!==void 0?Math.abs(Pa.descender):0,as=(Qa+fs)*Pn;rs<as&&(rs=as,Ue=(Qa-fs)/2*Pn),ua=-Qa*Pn}else ua=(Sn-Pn)*ac-17}dr?(Ye.verticalizable=!0,wa.push({glyph:Ki,image:Or,x:Zt,y:qt+ua,vertical:dr,scale:Pn,localGlyph:On.localGlyph,fontStack:Ti.fontStack,sectionIndex:Yi,metrics:On,rect:Sr}),Zt+=Ur*Pn+Si):(wa.push({glyph:Ki,image:Or,x:Zt,y:qt+ua,vertical:dr,scale:Pn,localGlyph:On.localGlyph,fontStack:Ti.fontStack,sectionIndex:Yi,metrics:On,rect:Sr}),Zt+=On.advance*Pn+Si)}wa.length!==0&&(vi=Math.max(Zt-Si,vi),zi?sx(wa,Bi,Dr,Ue,Wt*Sn/2):sx(wa,Bi,Dr,0,Wt/2)),Zt=0;const Ze=Wt*Sn+Dr;pa.lineOffset=Math.max(Dr,mr),qt+=Ze,++Dn}var rn;const cn=qt,{horizontalAlign:wn,verticalAlign:Hr}=x0(ni);(function(Di,Sn,mr,pa,wa,Dr){const rs=(Sn-mr)*wa,Ue=-Dr*pa;for(const Ze of Di)for(const Xt of Ze.positionedGlyphs)Xt.x+=rs,Xt.y+=Ue})(Ye.positionedLines,Bi,wn,Hr,vi,cn),Ye.top+=-Hr*cn,Ye.bottom=Ye.top+cn,Ye.left+=-wn*vi,Ye.right=Ye.left+vi,Ye.hasBaseline=zi})(je,e,i,s,oe,_,x,E,B,C,j,$),!(function(Ye){for(const st of Ye)if(st.positionedGlyphs.length!==0)return!1;return!0})($e))return je}const by={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},P2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ix(r,e,i,s,u,p){if(e.image){const _=s.get(e.image.toString());return _?_.displaySize[0]*e.scale*ac/p+u:0}{const _=i[e.fontStack],x=_&&_.glyphs[r];return x?x.metrics.advance*e.scale+u:0}}function nx(r,e,i,s){const u=Math.pow(r-e,2);return s?r<e?u/2:2*u:u+Math.abs(i)*i}function L2(r,e,i){let s=0;return r===10&&(s-=1e4),i&&(s+=150),r!==40&&r!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function rx(r,e,i,s,u,p){let _=null,x=nx(e,i,u,p);for(const E of s){const C=nx(e-E.x,i,u,p)+E.badness;C<=x&&(_=E,x=C)}return{index:r,x:e,priorBreak:_,badness:x}}function ax(r){return r?ax(r.priorBreak).concat(r.index):[]}function x0(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function sx(r,e,i,s,u){if(!(e||i||s||u))return;const p=r.length-1,_=r[p],x=(_.x+_.metrics.advance*_.scale)*e;for(let E=0;E<=p;E++)r[E].x-=x,r[E].y+=i+s+u}function b0(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function wy(r,e,i,s){const{horizontalAlign:u,verticalAlign:p}=x0(s),_=i[0]-r.displaySize[0]*u,x=i[1]-r.displaySize[1]*p;return{imagePrimary:r,imageSecondary:e,top:x,bottom:x+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function w0(r,e,i,s,u,p){const _=r.imagePrimary;let x;if(_.content){const le=_.content,oe=_.pixelRatio||1;x=[le[0]/oe,le[1]/oe,_.displaySize[0]-le[2]/oe,_.displaySize[1]-le[3]/oe]}const E=e.left*p,C=e.right*p;let k,B,j,U;i==="width"||i==="both"?(U=u[0]+E-s[3],B=u[0]+C+s[1]):(U=u[0]+(E+C-_.displaySize[0])/2,B=U+_.displaySize[0]);const $=e.top*p,ee=e.bottom*p;return i==="height"||i==="both"?(k=u[1]+$-s[0],j=u[1]+ee+s[2]):(k=u[1]+($+ee-_.displaySize[1])/2,j=k+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:k,right:B,bottom:j,left:U,collisionPadding:x}}function ox(r){return!r.imagePrimary.stretchX}function lx(r){return!r.imagePrimary.stretchY}function cx(r){return{width:r.right-r.left,height:r.bottom-r.top}}const rm=128;function ig(r,e,i){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Ka(r+1,{worldview:i}))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=s;let _=0;for(;_<u.length&&u[_]<=r;)_++;_=Math.max(0,_-1);let x=_;for(;x<u.length&&u[x]<r+1;)x++;x=Math.min(u.length-1,x);const E=u[_],C=u[x];return s.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:E,maxZoom:C,minSize:s.evaluate(new Ka(E,{worldview:i})),maxSize:s.evaluate(new Ka(C,{worldview:i})),interpolationType:p}}}function T0(r,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:u}){return r.kind==="source"?s/rm:r.kind==="composite"?Hn(s/rm,u/rm,i):e}function ng(r,e,i=1){let s=0,u=0;if(r.kind==="constant")u=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:x}=r,E=p?te(hs.interpolationFactor(p,e,_,x),0,1):0;r.kind==="camera"?u=Hn(r.minSize,r.maxSize,E)*i:s=E*i}return{uSizeT:s,uSize:u}}class s_ extends Ge{constructor(e,i,s,u,p){super(e,i),this.angle=u,this.z=s,p!==void 0&&(this.segment=p)}clone(){return new s_(this.x,this.y,this.z,this.angle,this.segment)}}function ux(r,e,i,s,u){if(e.segment===void 0)return!0;let p=e,_=e.segment+1,x=0;for(;x>-i/2;){if(_--,_<0)return!1;x-=r[_].dist(p),p=r[_]}x+=r[_].dist(r[_+1]),_++;const E=[];let C=0;for(;x<i/2;){const k=r[_],B=r[_+1];if(!B)return!1;let j=r[_-1].angleTo(k)-k.angleTo(B);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:x,angleDelta:j}),C+=j;x-E[0].distance>s;)C-=E.shift().angleDelta;if(C>u)return!1;_++,x+=k.dist(B)}return!0}function hx(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function dx(r,e,i){return r?.6*e*i:0}function fx(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function k2(r,e,i,s,u,p){const _=dx(i,u,p),x=fx(i,s)*p;let E=0;const C=hx(r)/2;for(let k=0;k<r.length-1;k++){const B=r[k],j=r[k+1],U=B.dist(j);if(E+U>C){const $=(C-E)/U,ee=Hn(B.x,j.x,$),le=Hn(B.y,j.y,$),oe=new s_(ee,le,0,j.angleTo(B),k);return!_||ux(r,oe,x,_,e)?oe:void 0}E+=U}}function F2(r,e,i,s,u,p,_,x,E){const C=dx(s,p,_),k=fx(s,u),B=k*_,j=r[0].x===0||r[0].x===E||r[0].y===0||r[0].y===E;return e-B<e/4&&(e=B+e/4),px(r,j?e/2*x%e:(k/2+2*p)*_*x%e,e,C,i,B,j,!1,E)}function px(r,e,i,s,u,p,_,x,E){const C=p/2,k=hx(r);let B=0,j=e-i,U=[];for(let $=0;$<r.length-1;$++){const ee=r[$],le=r[$+1],oe=ee.dist(le),ye=le.angleTo(ee);for(;j+i<B+oe;){j+=i;const xe=(j-B)/oe,Ie=Hn(ee.x,le.x,xe),$e=Hn(ee.y,le.y,xe);if(Ie>=0&&Ie<E&&$e>=0&&$e<E&&j-C>=0&&j+C<=k){const je=new s_(Ie,$e,0,ye,$);s&&!ux(r,je,p,s,u)||U.push(je)}}B+=oe}return x||U.length||_||(U=px(r,B/2,i,s,u,p,_,!0,E)),U}function mx(r){let e=0,i=0;for(const _ of r)e+=_.w*_.h,i=Math.max(i,_.w);r.sort(((_,x)=>x.h-_.h));const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,p=0;for(const _ of r)for(let x=s.length-1;x>=0;x--){const E=s[x];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,p=Math.max(p,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===E.w&&_.h===E.h){const C=s.pop();C&&x<s.length&&(s[x]=C)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(s.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}hi(s_,"Anchor");const U_=1;class zg{static getImagePositionScale(e,i,s){if(i&&e){const{sx:u,sy:p}=e;return{x:u,y:p}}return{x:s,y:s}}constructor(e,i,s,u){this.paddedRect=e;const{pixelRatio:p,version:_,stretchX:x,stretchY:E,content:C,sdf:k,usvg:B}=i;this.pixelRatio=p,this.stretchX=x,this.stretchY=E,this.content=C,this.version=_,this.padding=s,this.sdf=k,this.usvg=B,this.scale=zg.getImagePositionScale(u,B,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function S0(r,e,i){const s=xa.parse(r),u=(function(p,_,x=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*x[0])+2*_,h:(p.data?p.data.height:p.height*x[1])+2*_}})(e,i,[s.sx,s.sy]);return{bin:u,imagePosition:new zg(u,e,i,s),imageVariant:s}}class _x{constructor(e,i,s){const u=new Map,p=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,u,U_,_),this.addImages(i,p,2,_);const{w:x,h:E}=mx(_),C=new wl({width:x||1,height:E||1});for(const[k,B]of e.entries()){const j=u.get(k).paddedRect;wl.copy(B.data,C,{x:0,y:0},{x:j.x+U_,y:j.y+U_},B.data,null,B.sdf)}for(const[k,B]of i.entries()){const j=p.get(k),U=j.paddedRect;let $=j.padding;const ee=U.x+$,le=U.y+$,oe=B.data.width,ye=B.data.height;$=$>1?$-1:$,wl.copy(B.data,C,{x:0,y:0},{x:ee,y:le},B.data,s),wl.copy(B.data,C,{x:0,y:ye-$},{x:ee,y:le-$},{width:oe,height:$},s),wl.copy(B.data,C,{x:0,y:0},{x:ee,y:le+ye},{width:oe,height:$},s),wl.copy(B.data,C,{x:oe-$,y:0},{x:ee-$,y:le},{width:$,height:ye},s),wl.copy(B.data,C,{x:0,y:0},{x:ee+oe,y:le},{width:$,height:ye},s),wl.copy(B.data,C,{x:oe-$,y:ye-$},{x:ee-$,y:le-$},{width:$,height:$},s),wl.copy(B.data,C,{x:0,y:ye-$},{x:ee+oe,y:le-$},{width:$,height:$},s),wl.copy(B.data,C,{x:0,y:0},{x:ee+oe,y:le+ye},{width:$,height:$},s),wl.copy(B.data,C,{x:oe-$,y:0},{x:ee-$,y:le+ye},{width:$,height:$},s)}this.lut=s,this.image=C,this.iconPositions=u,this.patternPositions=p}addImages(e,i,s,u){for(const[p,_]of e.entries()){const{bin:x,imagePosition:E,imageVariant:C}=S0(p,_,s);i.set(p,E),u.push(x),_.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((u=>e.hasImage(u,s))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const u of e.getUpdatedImages(s)){for(const p of this.iconPositions.keys()){const _=xa.parse(p);if(Rl.isEqual(_.id,u)){const x=e.getImage(u,s);this.patchUpdatedImage(this.iconPositions.get(p),x,i,null)}}for(const p of this.patternPositions.keys()){const _=xa.parse(p);if(Rl.isEqual(_.id,u)){const x=e.getImage(u,s);this.patchUpdatedImage(this.patternPositions.get(p),x,i,this.lut)}}}}patchUpdatedImage(e,i,s,u=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[p,_]=e.tl,x=e.sdf;if(this.lut||x){const E={width:i.data.width,height:i.data.height},C=new wl(E);wl.copy(i.data,C,{x:0,y:0},{x:0,y:0},E,u,x),s.update(C,{position:{x:p,y:_}})}else s.update(i.data,{position:{x:p,y:_}})}}hi(zg,"ImagePosition"),hi(_x,"ImageAtlas");const Rg=1e20;function gx(r,e,i,s,u,p,_,x,E){for(let C=e;C<e+s;C++)yx(r,i*p+C,p,u,_,x,E);for(let C=i;C<i+u;C++)yx(r,C*p+e,1,s,_,x,E)}function yx(r,e,i,s,u,p,_){p[0]=0,_[0]=-Rg,_[1]=Rg,u[0]=r[e];for(let x=1,E=0,C=0;x<s;x++){u[x]=r[e+x*i];const k=x*x;do{const B=p[E];C=(u[x]-u[B]+k-B*B)/(x-B)/2}while(C<=_[E]&&--E>-1);E++,p[E]=x,_[E]=C,_[E+1]=Rg}for(let x=0,E=0;x<s;x++){for(;_[E+1]<x;)E++;const C=p[E],k=x-C;r[e+x*i]=u[C]+k*k}}const am=2,E0={none:0,ideographs:1,all:2};class rg{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[],u=this.url||kr.GLYPHS_URL;for(const p in e)for(const _ of e[p])s.push({stack:p,id:_});tt(s,(({stack:p,id:_},x)=>{let E=this.entries[p];E||(E=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=E.glyphs[_];if(C!==void 0)return void x(null,{stack:p,id:_,glyph:C});if(C=this._tinySDF(E,p,_),C)return E.glyphs[_]=C,void x(null,{stack:p,id:_,glyph:C});const k=Math.floor(_/256);if(256*k>65535)return ji("glyphs > 65535 not supported"),void x(null,{stack:p,id:_,glyph:C});if(E.ranges[k])return void x(null,{stack:p,id:_,glyph:C});let B=E.requests[k];B||(B=E.requests[k]=[],rg.loadGlyphRange(p,k,u,this.requestManager,((j,U)=>{if(U){E.ascender=U.ascender,E.descender=U.descender;for(const $ in U.glyphs)this._doesCharSupportLocalGlyph(+$)||(E.glyphs[+$]=U.glyphs[+$]);E.ranges[k]=!0}for(const $ of B)$(j,U);delete E.requests[k]}))),B.push(((j,U)=>{j?x(j):U&&x(null,{stack:p,id:_,glyph:U.glyphs[_]||null})}))}),((p,_)=>{if(p)i(p);else if(_){const x={};for(const{stack:E,id:C,glyph:k}of _)x[E]===void 0&&(x[E]={}),x[E].glyphs===void 0&&(x[E].glyphs={}),x[E].glyphs[C]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},x[E].ascender=this.entries[E].ascender,x[E].descender=this.entries[E].descender;i(null,x)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==E0.none&&(this.localGlyphMode===E0.all?!!this.localFontFamily:!!this.localFontFamily&&(pn["CJK Unified Ideographs"](e)||pn["Hangul Syllables"](e)||pn.Hiragana(e)||pn.Katakana(e)||pn["CJK Symbols and Punctuation"](e)||pn["CJK Unified Ideographs Extension A"](e)||pn["CJK Unified Ideographs Extension B"](e)||pn.Osage(e)))}_tinySDF(e,i,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let ee="400";/bold/i.test(i)?ee="900":/medium/i.test(i)?ee="500":/light/i.test(i)&&(ee="200"),p=e.tinySDF=new rg.TinySDF({fontFamily:u,fontWeight:ee,fontSize:24*am,buffer:3*am,radius:8*am}),p.fontWeight=ee}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const _=String.fromCodePoint(s),{data:x,width:E,height:C,glyphWidth:k,glyphHeight:B,glyphLeft:j,glyphTop:U,glyphAdvance:$}=p.draw(_);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new bd({width:E,height:C},x),metrics:{width:k/am,height:B/am,left:j/am,top:U/am-27,advance:$/am,localGlyph:!0}}}}rg.loadGlyphRange=function(r,e,i,s,u){const p=256*e,_=p+255,x=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${p}-${_}`),Cc.Glyphs);Wl(x,((E,C)=>{if(E)u(E);else if(C){const k={},B=(function(j){return new xy(j).readFields(z2,{})})(C);for(const j of B.glyphs)k[j.id]=j;u(null,{glyphs:k,ascender:B.ascender,descender:B.descender})}}))},rg.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:_="normal",lang:x=null}={}){this.buffer=e,this.cutoff=s,this.radius=i,this.lang=x;const E=this.size=r+4*e,C=this._createCanvas(E),k=this.ctx=C.getContext("2d",{willReadFrequently:!0});k.font=`${_} ${p} ${r}px ${u}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(r),_=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),E=Math.min(this.size-this.buffer,_+Math.ceil(s)),C=x+2*this.buffer,k=E+2*this.buffer,B=Math.max(C*k,0),j=new Uint8ClampedArray(B),U={data:j,width:C,height:k,glyphWidth:x,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(x===0||E===0)return U;const{ctx:$,buffer:ee,gridInner:le,gridOuter:oe}=this;this.lang&&($.lang=this.lang),$.clearRect(ee,ee,x,E),$.fillText(r,ee,ee+_);const ye=$.getImageData(ee,ee,x,E);oe.fill(Rg,0,B),le.fill(0,0,B);for(let xe=0;xe<E;xe++)for(let Ie=0;Ie<x;Ie++){const $e=ye.data[4*(xe*x+Ie)+3]/255;if($e===0)continue;const je=(xe+ee)*C+Ie+ee;if($e===1)oe[je]=0,le[je]=Rg;else{const Ye=.5-$e;oe[je]=Ye>0?Ye*Ye:0,le[je]=Ye<0?Ye*Ye:0}}gx(oe,0,0,C,k,C,this.f,this.v,this.z),gx(le,ee,ee,x,E,C,this.f,this.v,this.z);for(let xe=0;xe<B;xe++){const Ie=Math.sqrt(oe[xe])-Math.sqrt(le[xe]);j[xe]=Math.round(255-255*(Ie/this.radius+this.cutoff))}return U}};const Pm=U_;function vx(r,e){return r+e[1]-e[0]}function A0(r,e,i,s,u=1){const p=[],_=r.imagePrimary,x=_.pixelRatio,E=_.paddedRect.w-2*Pm,C=_.paddedRect.h-2*Pm,k=(r.right-r.left)*u,B=(r.bottom-r.top)*u,j=_.stretchX||[[0,E]],U=_.stretchY||[[0,C]],$=j.reduce(vx,0),ee=U.reduce(vx,0),le=E-$,oe=C-ee;let ye=0,xe=$,Ie=0,$e=ee,je=0,Ye=le,st=0,ut=oe;if(_.content&&s){const _t=_.content;ye=Ty(j,0,_t[0]),Ie=Ty(U,0,_t[1]),xe=Ty(j,_t[0],_t[2]),$e=Ty(U,_t[1],_t[3]),je=_t[0]-ye,st=_t[1]-Ie,Ye=_t[2]-_t[0]-xe,ut=_t[3]-_t[1]-$e}const Ut=(_t,Wt,ni,ri)=>{const wi=Sy(_t.stretch-ye,xe,k,r.left*u),Si=Ey(_t.fixed-je,Ye,_t.stretch,$),gi=Sy(Wt.stretch-Ie,$e,B,r.top*u),yi=Ey(Wt.fixed-st,ut,Wt.stretch,ee),Zt=Sy(ni.stretch-ye,xe,k,r.left*u),qt=Ey(ni.fixed-je,Ye,ni.stretch,$),vi=Sy(ri.stretch-Ie,$e,B,r.top*u),Bi=Ey(ri.fixed-st,ut,ri.stretch,ee),zi=new Ge(wi,gi),Dn=new Ge(Zt,gi),rn=new Ge(Zt,vi),cn=new Ge(wi,vi),wn=new Ge(Si/x,yi/x),Hr=new Ge(qt/x,Bi/x),Di=e*Math.PI/180;if(Di){const rs=Math.sin(Di),Ue=Math.cos(Di),Ze=[Ue,-rs,rs,Ue];zi._matMult(Ze),Dn._matMult(Ze),cn._matMult(Ze),rn._matMult(Ze)}const Sn=_t.stretch+_t.fixed,mr=ni.stretch+ni.fixed,pa=Wt.stretch+Wt.fixed,wa=ri.stretch+ri.fixed,Dr=r.imageSecondary;return{tl:zi,tr:Dn,bl:cn,br:rn,texPrimary:{x:_.paddedRect.x+Pm+Sn,y:_.paddedRect.y+Pm+pa,w:mr-Sn,h:wa-pa},texSecondary:Dr?{x:Dr.paddedRect.x+Pm+Sn,y:Dr.paddedRect.y+Pm+pa,w:mr-Sn,h:wa-pa}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wn,pixelOffsetBR:Hr,minFontScaleX:Ye/x/k,minFontScaleY:ut/x/B,isSDF:i}};if(s&&(_.stretchX||_.stretchY)){const _t=xx(j,le,$),Wt=xx(U,oe,ee);for(let ni=0;ni<_t.length-1;ni++){const ri=_t[ni],wi=_t[ni+1];for(let Si=0;Si<Wt.length-1;Si++)p.push(Ut(ri,Wt[Si],wi,Wt[Si+1]))}}else p.push(Ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:C+1}));return p}function O2(r,e){const i=r.stretchY||[[0,r.paddedRect.h-2*Pm]];return e&&(r.stretchX||r.stretchY)?bx(r.stretchX||[[0,r.paddedRect.w-2*Pm]])*bx(i):1}function Ty(r,e,i){let s=0;for(const u of r)s+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return s}function xx(r,e,i){const s=[{fixed:-Pm,stretch:0}];for(const[u,p]of r){const _=s[s.length-1];s.push({fixed:u-_.stretch,stretch:_.stretch}),s.push({fixed:u-_.stretch,stretch:_.stretch+(p-u)})}return s.push({fixed:e+Pm,stretch:i}),s}function bx(r){return 2*r.length+1}function Sy(r,e,i,s){return r/e*i+s}function Ey(r,e,i,s){return r-e*i/s}function B2(r,e,i,s){const u=e+r.positionedLines[s].lineOffset;return s===0?i+u/2:i+(u+(e+r.positionedLines[s-1].lineOffset))/2}function N2(r,e=1,i=!1){let s=1/0,u=1/0,p=-1/0,_=-1/0;const x=r[0];for(let U=0;U<x.length;U++){const $=x[U];(!U||$.x<s)&&(s=$.x),(!U||$.y<u)&&(u=$.y),(!U||$.x>p)&&(p=$.x),(!U||$.y>_)&&(_=$.y)}const E=Math.min(p-s,_-u);let C=E/2;const k=new kl([],j2);if(E===0)return new Ge(s,u);for(let U=s;U<p;U+=E)for(let $=u;$<_;$+=E)k.push(new ag(U+C,$+C,C,r));let B=(function(U){let $=0,ee=0,le=0;const oe=U[0];for(let ye=0,xe=oe.length,Ie=xe-1;ye<xe;Ie=ye++){const $e=oe[ye],je=oe[Ie],Ye=$e.x*je.y-je.x*$e.y;ee+=($e.x+je.x)*Ye,le+=($e.y+je.y)*Ye,$+=3*Ye}return new ag(ee/$,le/$,0,U)})(r),j=k.length;for(;k.length;){const U=k.pop();(U.d>B.d||!B.d)&&(B=U,i&&console.log("found best %d after %d probes",Math.round(1e4*U.d)/1e4,j)),U.max-B.d<=e||(C=U.h/2,k.push(new ag(U.p.x-C,U.p.y-C,C,r)),k.push(new ag(U.p.x+C,U.p.y-C,C,r)),k.push(new ag(U.p.x-C,U.p.y+C,C,r)),k.push(new ag(U.p.x+C,U.p.y+C,C,r)),j+=4)}return i&&(console.log(`num probes: ${j}`),console.log(`best distance: ${B.d}`)),B.p}function j2(r,e){return e.max-r.max}class ag{constructor(e,i,s,u){this.p=new Ge(e,i),this.h=s,this.d=(function(p,_){let x=!1,E=1/0;for(let C=0;C<_.length;C++){const k=_[C];for(let B=0,j=k.length,U=j-1;B<j;U=B++){const $=k[B],ee=k[U];$.y>p.y!=ee.y>p.y&&p.x<(ee.x-$.x)*(p.y-$.y)/(ee.y-$.y)+$.x&&(x=!x),E=Math.min(E,As(p,$,ee))}}return(x?1:-1)*Math.sqrt(E)})(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const V2=Object.keys,M0=Number.POSITIVE_INFINITY,U2=Math.sqrt(2);function w_(r,e,i,s,u){const p=b0(r)&&r.collisionPadding?r.collisionPadding:[0,0,0,0],_={top:r.top-p[1],bottom:r.bottom+p[3],left:r.left-p[0],right:r.right+p[2],scaled:!1};return s!==void 0&&(function(x,E){x.top*=E,x.bottom*=E,x.left*=E,x.right*=E,x.scaled=!0})(_,s),i&&(function(x,E){if(!E)return;const C=fi(E),k=new Ge(x.left,x.top),B=new Ge(x.right,x.top),j=new Ge(x.left,x.bottom),U=new Ge(x.right,x.bottom),$=new Ge(0,0);k._rotateAround(C,$),B._rotateAround(C,$),j._rotateAround(C,$),U._rotateAround(C,$),x.left=Math.min(k.x,B.x,j.x,U.x),x.right=Math.max(k.x,B.x,j.x,U.x),x.top=Math.min(k.y,B.y,j.y,U.y),x.bottom=Math.max(k.y,B.y,j.y,U.y)})(_,i),u&&(_.left+=u[0],_.right+=u[0],_.top+=u[1],_.bottom+=u[1]),e?{top:Math.min(e.top,_.top),bottom:Math.max(e.bottom,_.bottom),left:Math.min(e.left,_.left),right:Math.max(e.right,_.right),scaled:e.scaled||_.scaled}:_}function wx(r,[e,i]){let s=0,u=0;if(i===M0){e<0&&(e=0);const p=e/U2;switch(r){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(r){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(r){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function G2(r,e,i,s,u,p,_,x,E,C,k,B,j,U){const $=r.layers[0],ee=$.appearances;if(ee.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const le={iconBBox:null,iconVerticalBBox:null},oe={textBBox:null,textVerticalBBox:null},{baseIconRotate:ye,baseTextRotate:xe,iconScaleFactor:Ie}=(function(je,Ye,st){const ut=je.get("icon-rotate").evaluate(Ye,{},st),Ut=je.get("text-rotate").evaluate(Ye,{},st),[_t,Wt]=je.get("icon-size-scale-range");return{baseIconRotate:ut,baseTextRotate:Ut,iconScaleFactor:te(1,_t,Wt)}})(s,u,p);e&&(le.iconBBox=w_(e,le.iconBBox,ye,_),i)&&(le.iconVerticalBBox=w_(i,le.iconVerticalBBox,ye+90,_));const $e=My(B.horizontal);$e&&(oe.textBBox=w_($e,oe.textBBox,xe,1,U)),B.vertical&&(oe.textVerticalBBox=w_(B.vertical,oe.textVerticalBBox,xe+90,1,U));for(const je of ee)je.hasIconProperties()&&H2(le,r,$,je,u,p,x,ye,_,E,e,C,Ie,k),je.hasTextProperties()&&q2(oe,$,je,u,p,U,xe,j,$e,B.vertical);return{iconBBox:le.iconBBox,iconVerticalBBox:le.iconVerticalBBox,textBBox:oe.textBBox,textVerticalBBox:oe.textVerticalBBox}}function H2(r,e,i,s,u,p,_,x,E,C,k,B,j,U){const{appearanceIconOffset:$,appearanceIconRotate:ee,appearanceIconSize:le}=(function(Ie,$e,je,Ye,st,ut,Ut,_t){const Wt=Ie.hasProperty("icon-offset")?$e.getAppearanceValueAndResolveTokens(Ie,"icon-offset",je,Ye,[]):null,ni=Wt&&Array.isArray(Wt)?Wt:st,ri=Ie.hasProperty("icon-rotate")?$e.getAppearanceValueAndResolveTokens(Ie,"icon-rotate",je,Ye,[]):null,wi=typeof ri=="number"?ri:ut,Si=Ie.hasProperty("icon-size")?$e.getAppearanceValueAndResolveTokens(Ie,"icon-size",je,Ye,[]):null;return{appearanceIconOffset:ni,appearanceIconRotate:wi,appearanceIconSize:typeof Si=="number"?Si*_t.iconScaleFactor:Ut}})(s,i,u,p,_,x,E,C);let oe=null,ye=null,xe=null;s.hasProperty("icon-image")?xe=(function(Ie,$e,je,Ye,st,ut,Ut){let _t=null;const Wt=$e.getAppearanceValueAndResolveTokens(je,"icon-image",Ye,st,[]);if(Wt){const ni=Ie.getResolvedImageFromTokens(Wt),ri=je.getUnevaluatedProperty("icon-size"),wi=Dg(ni,ig(Ie.zoom,ri,Ie.worldview),ri,st,Ie.zoom,Ye,Ie.pixelRatio,Ut,Ie.worldview);_t=ut.get(wi.iconPrimary.toString())}return _t})(e,i,s,u,p,B,j):k&&(xe=k.imagePrimary),xe&&(oe=wy(xe,null,$,U),e.allowVerticalPlacement&&(ye=wy(xe,null,$,U))),oe&&(r.iconBBox=w_(oe,r.iconBBox,ee,le)),ye&&(r.iconVerticalBBox=w_(ye,r.iconVerticalBBox,ee+90,le))}function q2(r,e,i,s,u,p,_,x,E,C){const{appearanceTextOffset:k,appearanceTextRotate:B,appearanceTextSize:j}=(function($,ee,le,oe,ye,xe,Ie){const $e=$.hasProperty("text-offset")?ee.getAppearanceValueAndResolveTokens($,"text-offset",le,oe,[]):null,je=$e&&Array.isArray($e)?[$e[0]*ac,$e[1]*ac]:ye,Ye=$.hasProperty("text-rotate")?ee.getAppearanceValueAndResolveTokens($,"text-rotate",le,oe,[]):null,st=typeof Ye=="number"?Ye:xe,ut=$.hasProperty("text-size")?ee.getAppearanceValueAndResolveTokens($,"text-size",le,oe,[]):null;return{appearanceTextOffset:je,appearanceTextRotate:st,appearanceTextSize:typeof ut=="number"?ut:Ie}})(i,e,s,u,p,_,x),U=j/x;E&&(r.textBBox=w_(E,r.textBBox,B,U,k)),C&&(r.textVerticalBBox=w_(C,r.textVerticalBBox,B+90,U,k))}function Ay(r,e,i,s,u,p,_,x,E){if(!e||!e.usvg)return;const C=cx(s),k=cx(u),B=p!=="both"&&p!=="width"||!ox(s)?1:k.width/C.width,j=p!=="both"&&p!=="height"||!lx(s)?1:k.height/C.height;i.scaleSelf(B,j);const U=i.toString();_.set(U,i),x.set(U,e);const{imagePosition:$}=S0(U,e,U_);E.set(U,$)}function Tx(r,e,i,s,u,p,_,x,E){if(!r)return;const C=(function(k,B,j,U,$,ee){if(k.kind==="camera")return k.maxSize;if(k.kind==="composite"){const le=B.possiblyEvaluate(new Ka(k.maxZoom,{worldview:ee}),j).evaluate($,{},j),oe=B.possiblyEvaluate(new Ka(k.minZoom,{worldview:ee}),j).evaluate($,{},j);return Math.max(le,oe)}return B.possiblyEvaluate(new Ka(U,{worldview:ee})).evaluate($,{},j)})(e,i,s,u,p,E);return r.scaleSelf(C*x*_)}function Dg(r,e,i,s,u,p,_,x,E){return{iconPrimary:Tx(r.getPrimary(),e,i,s,u,p,_,x,E),iconSecondary:Tx(r.getSecondary(),e,i,s,u,p,_,x,E)}}function $2(r,e,i){if(!e)return;const s=i.get(r.toString()),u=i.get(e.toString());s&&u&&(s.paddedRect.w===u.paddedRect.w&&s.paddedRect.h===u.paddedRect.h||ji(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),s.usvg!==u.usvg&&ji(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function Sx(r,e,i,s){if(!r)return;const u=e.get(i.toString());if(r.imagePrimary=u,s){const p=e.get(s.toString());r.imageSecondary=p}}function Z2(r,e){for(const i in r.horizontal)Ex(r.horizontal[i],e);Ex(r.vertical,e)}function Ex(r,e){if(r){for(const i of r.positionedLines)for(const s of i.positionedGlyphs)if(s.image!==null){const u=s.image.toString();s.rect=e.get(u).paddedRect}}}function I0(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function W2(r,e,i,s,u,p,_,x,E){const C=My(p.horizontal)||p.vertical,k=i.get("icon-text-fit-padding").evaluate(s,{},u);let B,j=e;return e&&E!=="none"&&(r.allowVerticalPlacement&&p.vertical&&(B=w0(e,p.vertical,E,k,x,_)),C&&(j=w0(e,C,E,k,x,_))),{defaultShapedIcon:j,verticallyShapedIcon:B}}function X2(r,e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye,xe,Ie,$e,je,Ye){let st=_.textMaxSize.evaluate(e,{},j);st===void 0?st=x*_.textScaleFactor:st*=_.textScaleFactor;const ut=r.layers[0].layout,Ut=ac,_t=x*_.textScaleFactor/Ut,Wt=My(i.horizontal)||i.vertical;if(le!=="none"&&r.appearanceFeatureData&&e.index<r.appearanceFeatureData.length){const rn=r.appearanceFeatureData[e.index];rn&&(rn.textShaping=Wt,rn.iconTextFitPadding=ut.get("icon-text-fit-padding").evaluate(e,{},j),rn.fontScale=_t)}const ni=U.name==="globe",ri=r.tilePixelRatio*st/Ut,wi=(vi=r.overscaling,r.zoom>18&&vi>2&&(vi>>=1),Math.max(pi/(512*vi),1)*ut.get("symbol-spacing")),Si=ut.get("text-padding")*r.tilePixelRatio,gi=ut.get("icon-padding")*r.tilePixelRatio,yi=fi(ut.get("text-max-angle")),Zt=ut.get("icon-rotation-alignment")==="map"&&xe!=="point",qt=wi/2;var vi;r.hasAnyIconTextFit===!1&&le!=="none"&&(r.hasAnyIconTextFit=!0);const Bi=e.properties?+e.properties[Nt]:null,zi=Bi&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(Bi):65535,Dn=(rn,cn,wn)=>{if(cn.x<0||cn.x>=pi||cn.y<0||cn.y>=pi)return;let Hr=null;if(ni){const{x:Di,y:Sn,z:mr}=U.projectTilePoint(cn.x,cn.y,wn);Hr={anchor:new s_(Di,Sn,mr,0,void 0),up:U.upVector(wn,cn.x,cn.y)}}(function(Di,Sn,mr,pa,wa,Dr,rs,Ue,Ze,Xt,Ti,Yi,Ki,Pn,On,Sr,Or,Ur,ua,Qn,dr,za,Pa,La,Qa,fs,as,Fa,Ga,Br,ya,ao,Yn){const ha=Di.addToLineVertexArray(Sn,pa);let ls,bs,js,jo,zs,Kn,lo,es=0,Js=0,Al=0,sc=0,ol=-1,ll=-1;const $l={};let Xh=ss("");const Rs=mr?mr.anchor:Sn,Do=Fa!=="none";let Vo=0,wd=0;if(Ze._unevaluatedLayout.getValue("text-radial-offset")===void 0){const au=Ze.layout.get("text-offset").evaluate(dr,{},Qa);Vo=au[0]*ac,wd=au[1]*ac}else Vo=Ze.layout.get("text-radial-offset").evaluate(dr,{},Qa)*ac,wd=M0;if(Di.allowVerticalPlacement&&wa.vertical){const au=wa.vertical;if(On)Kn=C0(au),Ue&&(lo=C0(Ue));else{const Eh=Ze.layout.get("text-rotate").evaluate(dr,{},Qa)+90;js=Iy(Xt,Rs,Sn,Ti,Yi,Ki,au,Pn,Eh,Sr,ao),Ue&&(jo=Iy(Xt,Rs,Sn,Ti,Yi,Ki,Ue,Ur,Eh,null,ya))}}if(Dr){const au=Di.iconSizeData,Eh=Ze.layout.get("icon-rotate").evaluate(dr,{},Qa),Gd=A0(Dr,Eh,Pa,Do,za.iconScaleFactor),E_=Ue?A0(Ue,Eh,Pa,Do,za.iconScaleFactor):void 0;bs=Iy(Xt,Rs,Sn,Ti,Yi,Ki,Dr,Ur,Eh,null,Br);const dg=(function(cm,Yg,H1,oT,q1,$1,lT,cT){const Z1=cm.layers[0],W1=Z1.appearances;let fg=Yg.length;if(H1&&(fg=Math.max(fg,H1.length)),W1.length===0)return fg;const[uT,hT]=oT.get("icon-size-scale-range"),dT=te(1,uT,hT);for(const X1 of W1){const Y1=X1.getUnevaluatedProperties();if(Y1._values["icon-image"].value!==void 0){const K1=Z1.getAppearanceValueAndResolveTokens(X1,"icon-image",q1,$1,[]);if(K1){const J1=cm.getResolvedImageFromTokens(K1);if(J1){const Q1=Y1._values["icon-size"],fT=Dg(J1,ig(cm.zoom,Q1,cm.worldview),Q1,$1,cm.zoom,q1,cm.pixelRatio,dT,cm.worldview),pT=lT.get(fT.iconPrimary.toString());fg=Math.max(fg,O2(pT,cT))}}}}return fg})(Di,Gd,E_,Ze.layout,dr,Qa,Di.iconAtlasPositions,Do);es=4*dg;let lm=null;au.kind==="source"?(lm=[rm*Ze.layout.get("icon-size").evaluate(dr,{},Qa)*za.iconScaleFactor],lm[0]>o_&&ji(`${Di.layerIds[0]}: Value for "icon-size" is >= ${Pg}. Reduce your "icon-size".`)):au.kind==="composite"&&(lm=[rm*za.compositeIconSizes[0].evaluate(dr,{},Qa)*za.iconScaleFactor,rm*za.compositeIconSizes[1].evaluate(dr,{},Qa)*za.iconScaleFactor],(lm[0]>o_||lm[1]>o_)&&ji(`${Di.layerIds[0]}: Value for "icon-size" is >= ${Pg}. Reduce your "icon-size".`)),Di.addSymbols(Di.icon,Gd,lm,Qn,ua,dr,void 0,mr,Sn,ha.lineStartIndex,ha.lineLength,-1,La,Qa,fs,as,Di.symbolInstances.length,dg),ol=Di.icon.placedSymbolArray.length-1,E_&&(Js=4*dg,Di.addSymbols(Di.icon,E_,lm,Qn,ua,dr,Ud.vertical,mr,Sn,ha.lineStartIndex,ha.lineLength,-1,La,Qa,fs,as,Di.symbolInstances.length,dg),ll=Di.icon.placedSymbolArray.length-1)}for(const au in wa.horizontal){const Eh=au,Gd=wa.horizontal[Eh];ls||(Xh=ss(Gd.text),On?zs=C0(Gd):ls=Iy(Xt,Rs,Sn,Ti,Yi,Ki,Gd,Pn,Ze.layout.get("text-rotate").evaluate(dr,{},Qa),Sr,ao));const E_=Gd.positionedLines.length===1;if(Al+=Ax(Di,mr,Sn,Gd,rs,Ze,On,dr,Sr,ha,wa.vertical?Ud.horizontal:Ud.horizontalOnly,E_?V2(wa.horizontal):[Eh],$l,ol,za,La,Qa,Di.symbolInstances.length,fs),E_)break}wa.vertical&&(sc+=Ax(Di,mr,Sn,wa.vertical,rs,Ze,On,dr,Sr,ha,Ud.vertical,["vertical"],$l,ll,za,La,Qa,Di.symbolInstances.length,fs));let Ml=-1;const Sp=(au,Eh)=>au?Math.max(au,Eh):Eh;Ml=Sp(zs,Ml),Ml=Sp(Kn,Ml),Ml=Sp(lo,Ml);const Lm=Ml>-1?1:0;Di.glyphOffsetArray.length>=65535&&ji("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),dr.sortKey!==void 0&&Di.addToSortKeyRanges(Di.symbolInstances.length,dr.sortKey),Di.symbolInstances.emplaceBack(Sn.x,Sn.y,Rs.x,Rs.y,Rs.z,$l.right>=0?$l.right:-1,$l.center>=0?$l.center:-1,$l.left>=0?$l.left:-1,$l.vertical>=0?$l.vertical:-1,ol,ll,Xh,ls!==void 0?ls:Di.collisionBoxArray.length,ls!==void 0?ls+1:Di.collisionBoxArray.length,js!==void 0?js:Di.collisionBoxArray.length,js!==void 0?js+1:Di.collisionBoxArray.length,bs!==void 0?bs:Di.collisionBoxArray.length,bs!==void 0?bs+1:Di.collisionBoxArray.length,jo||Di.collisionBoxArray.length,jo?jo+1:Di.collisionBoxArray.length,Ti,Al,sc,es,Js,Lm,0,Vo,wd,Ml,0,Do?1:0,Ga)})(r,cn,Hr,rn,i,s,p,u,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Si,ye,C,0,gi,Zt,oe,e,_,k,B,j,$,ee,le,zi,Ie,$e,je)};if(xe==="line")for(const rn of nm(e.geometry,0,0,pi,pi)){const cn=F2(rn,wi,yi,i.vertical||Wt,s,Ut,ri,r.overscaling,pi);for(const wn of cn)Wt&&Y2(r,Wt.text,qt,wn)||Dn(rn,wn,j)}else if(xe==="line-center"){for(const rn of e.geometry)if(rn.length>1){const cn=k2(rn,yi,i.vertical||Wt,s,Ut,ri);cn&&Dn(rn,cn,j)}}else if(e.type==="Polygon")for(const rn of ai(e.geometry,0)){const cn=N2(rn,16);Dn(rn[0],new s_(cn.x,cn.y,0,0,void 0),j)}else if(e.type==="LineString")for(const rn of e.geometry)Dn(rn,new s_(rn[0].x,rn[0].y,0,0,void 0),j);else if(e.type==="Point")for(const rn of e.geometry)for(const cn of rn)Dn([cn],new s_(cn.x,cn.y,0,0,void 0),j)}const Pg=255,o_=Pg*rm;function Ax(r,e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye){const xe=(function(je,Ye,st,ut,Ut,_t,Wt,ni){const ri=[];if(Ye.positionedLines.length===0)return ri;const wi=ut.layout.get("text-rotate").evaluate(_t,{})*Math.PI/180,Si=(function(vi){const Bi=vi[0],zi=vi[1],Dn=Bi*zi;return Dn>0?[Bi,-zi]:Dn<0?[-Bi,zi]:Bi===0?[zi,Bi]:[zi,-Bi]})(st);let gi=Math.abs(Ye.top-Ye.bottom);for(const vi of Ye.positionedLines)gi-=vi.lineOffset;const yi=Ye.positionedLines.length,Zt=gi/yi;let qt=Ye.top-st[1];for(let vi=0;vi<yi;++vi){const Bi=Ye.positionedLines[vi];qt=B2(Ye,Zt,qt,vi);for(const zi of Bi.positionedGlyphs){if(!zi.rect)continue;const Dn=zi.rect||{};let rn=tx+1,cn=!0,wn=1,Hr=0;if(zi.image){const Or=Wt.get(zi.image.toString());if(!Or)continue;if(Or.sdf){ji("SDF images are not supported in formatted text and will be ignored.");continue}cn=!1,wn=Or.pixelRatio,rn=U_/wn}const Di=(Ut||ni)&&zi.vertical,Sn=zi.metrics.advance*zi.scale/2,mr=zi.metrics,pa=zi.rect;if(pa===null)continue;ni&&Ye.verticalizable&&(Hr=zi.image?Sn-zi.metrics.width*zi.scale/2:0);const wa=Ut?[zi.x+Sn,zi.y]:[0,0];let Dr=[0,0],rs=[0,0],Ue=!1;Ut||(Di?(rs=[zi.x+Sn+Si[0],zi.y+Si[1]-Hr],Ue=!0):Dr=[zi.x+Sn+st[0],zi.y+st[1]-Hr]);const Ze=pa.w*zi.scale/(wn*(zi.localGlyph?am:1)),Xt=pa.h*zi.scale/(wn*(zi.localGlyph?am:1));let Ti,Yi,Ki,Pn;if(Di){const Or=zi.y-qt,Ur=new Ge(-Sn,Sn-Or),ua=-Math.PI/2,Qn=new Ge(...rs);Ti=new Ge(-Sn+Dr[0],Dr[1]),Ti._rotateAround(ua,Ur)._add(Qn),Ti.x+=-Or+Sn,Ti.y-=(mr.left-rn)*zi.scale;const dr=zi.image?mr.advance*zi.scale:ac*zi.scale,za=String.fromCodePoint(zi.glyph);v2(za)?Ti.x+=(1-rn)*zi.scale:x2(za)?Ti.x+=dr-mr.height*zi.scale+(-rn-1)*zi.scale:Ti.x+=zi.image||mr.width+2*rn===pa.w&&mr.height+2*rn===pa.h?(dr-Xt)/2:(dr-(mr.height+2*rn)*zi.scale)/2,Yi=new Ge(Ti.x,Ti.y-Ze),Ki=new Ge(Ti.x+Xt,Ti.y),Pn=new Ge(Ti.x+Xt,Ti.y-Ze)}else{const Or=(mr.left-rn)*zi.scale-Sn+Dr[0],Ur=(-mr.top-rn)*zi.scale+Dr[1],ua=Or+Ze,Qn=Ur+Xt;Ti=new Ge(Or,Ur),Yi=new Ge(ua,Ur),Ki=new Ge(Or,Qn),Pn=new Ge(ua,Qn)}if(wi){let Or;Or=Ut?new Ge(0,0):Ue?new Ge(Si[0],Si[1]):new Ge(st[0],st[1]),Ti._rotateAround(wi,Or),Yi._rotateAround(wi,Or),Ki._rotateAround(wi,Or),Pn._rotateAround(wi,Or)}const On=new Ge(0,0),Sr=new Ge(0,0);ri.push({tl:Ti,tr:Yi,bl:Ki,br:Pn,texPrimary:Dn,texSecondary:void 0,writingMode:Ye.writingMode,glyphOffset:wa,sectionIndex:zi.sectionIndex,isSDF:cn,pixelOffsetTL:On,pixelOffsetBR:Sr,minFontScaleX:0,minFontScaleY:0})}}return ri})(0,s,E,p,_,x,u,r.allowVerticalPlacement),Ie=r.textSizeData;let $e=null;Ie.kind==="source"?($e=[rm*p.layout.get("text-size").evaluate(x,{},le)*$.textScaleFactor],$e[0]>o_&&ji(`${r.layerIds[0]}: Value for "text-size" is >= ${Pg}. Reduce your "text-size".`)):Ie.kind==="composite"&&($e=[rm*$.compositeTextSizes[0].evaluate(x,{},le)*$.textScaleFactor,rm*$.compositeTextSizes[1].evaluate(x,{},le)*$.textScaleFactor],($e[0]>o_||$e[1]>o_)&&ji(`${r.layerIds[0]}: Value for "text-size" is >= ${Pg}. Reduce your "text-size".`)),r.addSymbols(r.text,xe,$e,E,_,x,k,e,i,C.lineStartIndex,C.lineLength,U,ee,le,ye,!1,oe,xe.length);for(const je of B)j[je]=r.text.placedSymbolArray.length-1;return 4*xe.length}function My(r){for(const e in r)return r[e];return null}function Iy(r,e,i,s,u,p,_,x,E,C,k){let B,j,U,$;if(B=k?k.top:_.top,j=k?k.bottom:_.bottom,U=k?k.left:_.left,$=k?k.right:_.right,b0(_)&&_.collisionPadding){const ee=_.collisionPadding;U-=ee[0],B-=ee[1],$+=ee[2],j+=ee[3]}if(E){const ee=new Ge(U,B),le=new Ge($,B),oe=new Ge(U,j),ye=new Ge($,j),xe=fi(E);let Ie=new Ge(0,0);C&&(Ie=new Ge(C[0],C[1])),ee._rotateAround(xe,Ie),le._rotateAround(xe,Ie),oe._rotateAround(xe,Ie),ye._rotateAround(xe,Ie),U=Math.min(ee.x,le.x,oe.x,ye.x),$=Math.max(ee.x,le.x,oe.x,ye.x),B=Math.min(ee.y,le.y,oe.y,ye.y),j=Math.max(ee.y,le.y,oe.y,ye.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,U,B,$,j,x,s,u,p),r.length-1}function C0(r){b0(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function Y2(r,e,i,s){const u=r.compareText;if(e in u){const p=u[e];for(let _=p.length-1;_>=0;_--)if(s.dist(p[_])<i)return!0}else u[e]=[];return u[e].push(s),!1}function Mx(r,e){const i=r.fovAboveCenter,s=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,u=(r._camera.position[2]*r.worldSize-s)/Math.cos(r._pitch),p=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let _=Math.sin(r._pitch)*p+u;const x=u*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let E=Math.max(r.zoom-17,0);r.isOrthographic&&(E/=10),_*=1+E}return Math.min(1.01*_,x)}function Lg(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),s=r.x*i,u=(r.x+1)*i,p=r.y*i,_=(r.y+1)*i,x=V(s),E=V(u),C=K(p),k=K(_),B=e.project(x,C),j=e.project(E,C),U=e.project(E,k),$=e.project(x,k);let ee=Math.min(B.x,j.x,U.x,$.x),le=Math.min(B.y,j.y,U.y,$.y),oe=Math.max(B.x,j.x,U.x,$.x),ye=Math.max(B.y,j.y,U.y,$.y);const xe=i/16;function Ie(je,Ye,st,ut,Ut,_t){const Wt=(st+Ut)/2,ni=(ut+_t)/2,ri=e.project(V(Wt),K(ni)),wi=Math.max(0,ee-ri.x,le-ri.y,ri.x-oe,ri.y-ye);ee=Math.min(ee,ri.x),oe=Math.max(oe,ri.x),le=Math.min(le,ri.y),ye=Math.max(ye,ri.y),wi>xe&&(Ie(je,ri,st,ut,Wt,ni),Ie(ri,Ye,Wt,ni,Ut,_t))}Ie(B,j,s,p,u,p),Ie(j,U,u,p,u,_),Ie(U,$,u,_,s,_),Ie($,B,s,_,s,p),ee-=xe,le-=xe,oe+=xe,ye+=xe;const $e=1/Math.max(oe-ee,ye-le);return{scale:$e,x:ee*$e,y:le*$e,x2:oe*$e,y2:ye*$e,projection:e}}function Ix(r,{x:e,y:i},s=0){return new Ge(((e-s)*r.scale-r.x)*pi,(i*r.scale-r.y)*pi)}const K2=qi(new Float32Array(16));class T_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new a(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s,u=!0){return e._coordinatePoint(e.locationCoordinate(i,s),u)}pixelsPerMeter(e,i){return N(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return Mx(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,u){const p=e.horizonLineFromTop(!1),_=new Ge(i,Math.max(p,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,u))}pointCoordinate3D(e,i,s){const u=new Ge(i,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const p=this.pointCoordinate(e,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return K2}createTileMatrix(e,i,s){let u,p,_;const x=s.canonical,E=qi(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=Lg(x,this);u=1,p=C.x+s.wrap*C.scale,_=C.y,Un(E,E,[u/C.scale,u/C.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(x.z),p=(x.x+Math.pow(2,x.z)*s.wrap)*u,_=x.y*u;return an(E,E,[p,_,0]),Un(E,E,[u/pi,u/pi,1]),E}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class J2 extends T_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(fi(i));this.n=(u+Math.sin(fi(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:u,r0:p}=this,_=fi(e-this.center[0]),x=fi(i),E=Math.sqrt(u-2*s*Math.sin(x))/s;return{x:E*Math.sin(_*s),y:E*Math.cos(_*s)-p,z:0}}unproject(e,i){const{n:s,c:u,r0:p}=this,_=p+i;let x=Math.atan2(e,Math.abs(_))*Math.sign(_);_*s<0&&(x-=Math.PI*Math.sign(e)*Math.sign(_));const E=fi(this.center[0])*s;x=Re(x,-Math.PI-E,Math.PI-E);const C=te(ui(x/s)+this.center[0],-180,180),k=Math.asin(te((u-(e*e+_*_)*s*s)/(2*s),-1,1)),B=te(ui(k),-Q,Q);return new a(C,B)}}const kg=1.340264,Fg=-.081106,Og=893e-6,Bg=.003796,Cy=Math.sqrt(3)/2;class Q2 extends T_{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Cy*Math.sin(i)),u=s*s,p=u*u*u;return{x:.5*(e*Math.cos(s)/(Cy*(kg+3*Fg*u+p*(7*Og+9*Bg*u)))/Math.PI+.5),y:1-.5*(s*(kg+Fg*u+p*(Og+Bg*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=s*s,p=u*u*u;for(let k,B,j,U=0;U<12&&(B=s*(kg+Fg*u+p*(Og+Bg*u))-i,j=kg+3*Fg*u+p*(7*Og+9*Bg*u),k=B/j,s=te(s-k,-Math.PI/3,Math.PI/3),u=s*s,p=u*u*u,!(Math.abs(k)<1e-12));++U);const _=Cy*e*(kg+3*Fg*u+p*(7*Og+9*Bg*u))/Math.cos(s),x=Math.asin(Math.sin(s)/Cy),E=te(180*_/Math.PI,-180,180),C=te(180*x/Math.PI,-Q,Q);return new a(E,C)}}class e3 extends T_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),u=te(360*(.5-i),-Q,Q);return new a(s,u)}}const sg=Math.PI/2;function zy(r){return Math.tan((sg+r)/2)}class t3 extends T_{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let u=fi(i),p=fi(s);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const _=Math.cos(u),x=zy(u);this.n=u===p?Math.sin(u):Math.log(_/Math.cos(p))/Math.log(zy(p)/x),this.f=_*Math.pow(zy(u),this.n)/this.n}project(e,i){i=fi(i),this.southernCenter&&(i=-i),e=fi(e-this.center[0]);const s=1e-6,{n:u,f:p}=this;p>0?i<-sg+s&&(i=-sg+s):i>sg-s&&(i=sg-s);const _=p/Math.pow(zy(i),u);let x=_*Math.sin(u*e),E=p-_*Math.cos(u*e);return x=.5*(x/Math.PI+.5),E=.5*(E/Math.PI+.5),{x,y:this.southernCenter?E:1-E,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:u}=this,p=u-i,_=Math.sign(p),x=Math.sign(s)*Math.sqrt(e*e+p*p);let E=Math.atan2(e,Math.abs(p))*_;p*s<0&&(E-=Math.PI*Math.sign(e)*_);const C=te(ui(E/s)+this.center[0],-180,180),k=te(ui(2*Math.atan(Math.pow(u/x,1/s))-sg),-Q,Q);return new a(C,this.southernCenter?-k:k)}}class Cx extends T_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:I(e),y:D(i),z:0}}unproject(e,i){const s=V(e),u=K(i);return new a(s,u)}}const zx=fi(Q);class i3 extends T_{project(e,i){const s=(i=fi(i))*i,u=s*s;return{x:.5*((e=fi(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=25,p=0,_=s*s;do{_=s*s;const C=_*_;p=(s*(1.007226+_*(.015085+C*(.028874*_-.044475-.005916*C)))-i)/(1.007226+_*(.045255+C*(.259866*_-.311325-.005916*11*C))),s=te(s-p,-zx,zx)}while(Math.abs(p)>1e-6&&--u>0);_=s*s;const x=te(ui(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),E=ui(s);return new a(x,E)}}const Rx=fi(Q);class n3 extends T_{project(e,i){i=fi(i),e=fi(e);const s=Math.cos(i),u=2/Math.PI,p=Math.acos(s*Math.cos(e/2)),_=Math.sin(p)/p,x=.5*(e*u+2*s*Math.sin(e/2)/_)||0,E=.5*(i+Math.sin(i)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,p=25;const _=1e-6;let x=0,E=0;do{const C=Math.cos(u),k=Math.sin(u),B=2*k*C,j=k*k,U=C*C,$=Math.cos(s/2),ee=Math.sin(s/2),le=2*$*ee,oe=ee*ee,ye=1-U*$*$,xe=ye?1/ye:0,Ie=ye?Math.acos(C*$)*Math.sqrt(1/ye):0,$e=.5*(2*Ie*C*ee+2*s/Math.PI)-e,je=.5*(Ie*k+u)-i,Ye=.5*xe*(U*oe+Ie*C*$*j)+1/Math.PI,st=xe*(le*B/4-Ie*k*ee),ut=.125*xe*(B*ee-Ie*k*U*le),Ut=.5*xe*(j*$+Ie*oe*C)+.5,_t=st*ut-Ut*Ye;x=(je*st-$e*Ut)/_t,E=($e*ut-je*Ye)/_t,s=te(s-x,-Math.PI,Math.PI),u=te(u-E,-Rx,Rx)}while((Math.abs(x)>_||Math.abs(E)>_)&&--p>0);return new a(ui(s),ui(u))}}class Dx extends T_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:u}=this;return{x:fi(e)*u*s+.5,y:-Math.sin(fi(i))/u*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:u}=this,p=-(i-.5)/s,_=te(ui((e-.5)/s)/u,-180,180),x=Math.asin(te(p*u,-1,1)),E=te(ui(x),-Q,Q);return new a(_,E)}}class r3 extends Cx{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const u=qm(e,i,s);return Kr(u,u,bf(Ku(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i,s){const u=Eu(i.lat,i.lng),p=In([],u),_=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;vn(u,u,p,N(1,0)*pi*_);const x=qi(new Float64Array(16));return Ai(x,e.pixelMatrix,e.globeMatrix),Kr(u,u,x),new Ge(u[0],u[1])}pixelsPerMeter(e,i){return N(1,0)*i}pixelSpaceConversion(e,i,s){const u=N(1,e)*i,p=Hn(N(1,45)*i,u,s);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,s){const u=Mm(Ku(s.canonical));return Ai(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:s}=e,u=bf(Ku(i));return ln(u,u,fi(s.lng)),rr(u,u,fi(s.lat)),Un(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,s,u){return xf(e,i,s,!0)||new Se(0,0)}pointCoordinate3D(e,i,s){const u=this.pointCoordinate(e,i,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!xf(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(u,p){const _=u.cameraToCenterDistance,x=u._centerAltitude*p,E=u._camera,C=u._camera.forward(),k=Tn([],mi([],C,-_),[0,0,x]),B=u.worldSize/(2*Math.PI),j=[0,0,-B],U=u.width/u.height,$=Math.tan(u.fovAboveCenter),ee=mi([],E.up(),$),le=mi([],E.right(),$*U),oe=In([],Tn([],Tn([],C,ee),le)),ye=[];let xe;if(new nn(k,oe).closestPointOnSphere(j,B,ye)){const Ie=Tn([],ye,j),$e=Ir([],Ie,k);xe=Math.cos(u.fovAboveCenter)*Pr($e)}else{const Ie=Ir([],k,j),$e=Ir([],j,k);In($e,$e);const je=Pr(Ie)-B;xe=Math.sqrt(je*(je+2*B));const Ye=Math.acos(xe/(B+je))-Math.acos(Lr(C,$e));xe*=Math.cos(Ye)}return 1.01*xe})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=eu(e.zoom);if(s>0){const u=Mx(e,N(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Hn(i,u+p*(1-Math.cos(_)),Math.pow(s,10))}return i}upVector(e,i,s){return qm(i,s,e,1)}upVectorScale(e){return{metersToTile:vh($m(Ku(e)))}}}function Px(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new Cx(r);case"equirectangular":return new e3(r);case"naturalEarth":return new i3(r);case"equalEarth":return new Q2(r);case"winkelTripel":return new n3(r);case"albers":return i?new Dx(r):new J2(r);case"lambertConformalConic":return i?new Dx(r):new t3(r);case"globe":return new r3(r)}throw new Error(`Invalid projection name: ${r.name}`)}const a3=dt.types,s3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ng(r,e,i,s,u,p,_,x,E,C,k,B,j){const U=x?Math.min(o_,Math.round(x[0])):0,$=x?Math.min(o_,Math.round(x[1])):0;r.emplaceBack(e,i,Math.round(32*s),Math.round(32*u),p,_,(U<<1)+(E?1:0),0+($<<1),16*C,16*k,256*B,256*j)}function jg(r,e,i){r.emplaceBack(e,i)}function Vg(r,e,i,s,u,p,_){r.emplaceBack(e,i,s,u,p,_)}const Ry=(r,e,i,s)=>{for(let u=0;u<e;u++)r.emplaceBack(i[0],i[1],i[2],s[0],s[1],s[2])};function og(r,e,i,s,u){r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u)}function o3(r){for(const e of r.sections)if(Dp(e.text))return!0;return!1}class z0{constructor(e){this.layoutVertexArray=new up,this.indexArray=new co,this.programConfigurations=e,this.segments=new Ss,this.dynamicLayoutVertexArray=new Fd,this.opacityVertexArray=new ff,this.placedSymbolArray=new vm,this.iconTransitioningVertexArray=new wu,this.globeExtVertexArray=new Op,this.zOffsetVertexArray=new qh,this.orientationVertexArray=new gm,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){const s=[],u=this.layoutVertexArray.uint16;for(let p=0;p<i;++p){const _=12*(e+p);s.push(...u.slice(_,_+12))}return s}updateIconVertexData(e,i,s,u,p,_,x,E,C,k,B,j,U){const $=this.layoutVertexArray.uint16,ee=12*e;$[ee]=i,$[ee+1]=s,$[ee+2]=u,$[ee+3]=p,$[ee+4]=_,$[ee+5]=x,$[ee+6]=E,$[ee+7]=C,$[ee+8]=k,$[ee+9]=B,$[ee+10]=j,$[ee+11]=U}upload(e,i,s,u,p,_){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,c2.members,!!_),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,h2.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,s3,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,p2.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,u2.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,d2.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,f2.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}hi(z0,"SymbolBuffers");class R0{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Ss,this.collisionVertexArray=new $h,this.collisionVertexArrayExt=new Fd}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,m2.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}hi(R0,"CollisionBuffers");class Dy{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((_=>_.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=qi([]),this.placementViewportMatrix=qi([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=ig(this.zoom,i["text-size"],this.worldview),this.iconSizeData=ig(this.zoom,i["icon-size"],this.worldview);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.lut=e.lut,this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map((_=>Ud[_])),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some((s=>s.getProperty(e)!=null))}createArrays(){this.text=new z0(new gh(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new z0(new gh(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new Nd,this.lineVertexArray=new Bp,this.symbolInstances=new _f}calculateGlyphDependencies(e,i,s,u,p){for(const _ of e){const x=_.codePointAt(0);if(x===void 0)break;if(i[x]=!0,u&&p&&x<=65535){const E=Ig[_];E&&(i[E.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,s,u,p,_){let x=1;const E=e.getUnevaluatedProperties()._values["icon-size"],C=ig(this.zoom,E,this.worldview),k=ng(C,i);if(C.kind!=="constant"&&C.kind!=="camera"||(x=k.uSize),C.kind==="composite"){const{minZoom:B,maxZoom:j}=C,U=E.possiblyEvaluate(new Ka(B,{worldview:this.worldview}),u),$=E.possiblyEvaluate(new Ka(j,{worldview:this.worldview}),u),ee=U.evaluate(s,{},u,p);x=ee+($.evaluate(s,{},u,p)-ee)*k.uSizeT}return C.kind==="source"&&(x=E.possiblyEvaluate(new Ka(this.zoom,{worldview:this.worldview}),u).evaluate(s,{},u,p)),x*_}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!wh(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?Co.build(e):e}populate(e,i,s,u){const p=this.layers[0],_=p.layout,x=this.projection.name==="globe",E=_.get("text-font"),C=_.get("text-field"),k=_.get("icon-image"),[B,j]=_.get("icon-size-scale-range"),U=te(i.scaleFactor||1,B,j),$=(C.value.kind!=="constant"||C.value.value instanceof Dl&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),ee=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,le=this.hasAnyAppearanceProperty("icon-image"),oe=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!$&&!ee&&!le)return;const ye=i.iconDependencies,xe=i.glyphDependencies,Ie=i.availableImages,$e=new Ka(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),je=Ye=>{const st=Ye.id.toString();ye.has(st)?ye.get(st).push(Ye):ye.set(st,[Ye])};for(const Ye of e){const{feature:st,id:ut,index:Ut,sourceLayerIndex:_t}=Ye,Wt=p._featureFilter.needGeometry,ni=mt(st,Wt);if(!p._featureFilter.filter($e,ni,s))continue;if(Wt||(ni.geometry=nt(st,s,u)),x&&st.type!==1&&s.z<=5){const vi=ni.geometry,Bi=.98078528056,zi=(Dn,rn)=>Lr(qm(Dn.x,Dn.y,s,1),qm(rn.x,rn.y,s,1))<Bi;for(let Dn=0;Dn<vi.length;Dn++)vi[Dn]=Ve(vi[Dn],zi)}let ri,wi;if($){const vi=p.getValueAndResolveTokens("text-field",ni,s,Ie),Bi=Dl.factory(vi);o3(Bi)&&(this.hasRTLText=!0),(!this.hasRTLText||bu()==="unavailable"||this.hasRTLText&&Gu.isParsed())&&(ri=y2(Bi,p,ni))}if(ee){const vi=p.getValueAndResolveTokens("icon-image",ni,s,Ie);wi=this.getResolvedImageFromTokens(vi)}const Si=this.layers[0];let gi=!1;if(!wi&&le){const vi=Si.getAppearances();for(const Bi of vi)if(Bi.getProperty("icon-image")){const zi=Si.getAppearanceValueAndResolveTokens(Bi,"icon-image",ni,s,Ie);if(zi){wi=this.getResolvedImageFromTokens(zi),gi=!0;break}}}if(!ri&&!wi)continue;const yi=this.sortFeaturesByKey?oe.evaluate(ni,{},s):void 0,Zt={id:ut,text:ri,icon:wi,index:Ut,sourceLayerIndex:_t,geometry:ni.geometry,properties:st.properties,type:a3[st.type],sortKey:yi};if(this.features.push(Zt),this.featureToAppearanceIndex[Ut]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:ut,properties:st.properties,usesAppearanceIconAsPlaceholder:gi,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),wi){const vi=Si._unevaluatedLayout._values,{iconPrimary:Bi,iconSecondary:zi}=Dg(wi,this.iconSizeData,vi["icon-size"],s,this.zoom,Zt,this.pixelRatio,U,this.worldview);je(Bi),zi&&(this.hasAnySecondaryIcon=!0,je(zi))}const qt=Si.getAppearances();if(qt.length!==0&&qt.forEach((vi=>{if(!vi.getProperty("icon-image"))return;const Bi=this.getCombinedIconPrimary(vi,Si,ni,s,Ie,Zt,U);Bi&&je(Bi)})),ri){const vi=E.evaluate(ni,{},s).join(","),Bi=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ud.vertical)>=0;for(const zi of ri.sections)if(zi.image){const Dn=zi.image.getPrimary().scaleSelf(this.pixelRatio),rn=Dn.id.toString(),cn=ye.get(rn)||[];cn.push(Dn),ye.set(rn,cn)}else{const Dn=vo(ri.toString()),rn=zi.fontStack||vi,cn=xe[rn]=xe[rn]||{};this.calculateGlyphDependencies(zi.text,cn,Bi,this.allowVerticalPlacement,Dn)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(Ye){const st={},ut={},Ut=[];let _t=0;function Wt(Si){Ut.push(Ye[Si]),_t++}function ni(Si,gi,yi){const Zt=ut[Si];return delete ut[Si],ut[gi]=Zt,Ut[Zt].geometry[0].pop(),Ut[Zt].geometry[0]=Ut[Zt].geometry[0].concat(yi[0]),Zt}function ri(Si,gi,yi){const Zt=st[gi];return delete st[gi],st[Si]=Zt,Ut[Zt].geometry[0].shift(),Ut[Zt].geometry[0]=yi[0].concat(Ut[Zt].geometry[0]),Zt}function wi(Si,gi,yi){const Zt=yi?gi[0][gi[0].length-1]:gi[0][0];return`${Si}:${Zt.x}:${Zt.y}`}for(let Si=0;Si<Ye.length;Si++){const gi=Ye[Si],yi=gi.geometry,Zt=gi.text?gi.text.toString():null;if(!Zt){Wt(Si);continue}const qt=wi(Zt,yi),vi=wi(Zt,yi,!0);if(qt in ut&&vi in st&&ut[qt]!==st[vi]){const Bi=ri(qt,vi,yi),zi=ni(qt,vi,Ut[Bi].geometry);delete st[qt],delete ut[vi],ut[wi(Zt,Ut[zi].geometry,!0)]=zi,Ut[Bi].geometry=null}else qt in ut?ni(qt,vi,yi):vi in st?ri(qt,vi,yi):(Wt(Si),st[qt]=_t-1,ut[vi]=_t-1)}return Ut.filter((Si=>Si.geometry))})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ye of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Ye.id,this.elevationFeatures.length),this.elevationFeatures.push(Ye)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Ye,st)=>Ye.sortKey-st.sortKey))}getCombinedIconPrimary(e,i,s,u,p,_,x){let E,C;const k=e.getUnevaluatedProperties();if(k._values["icon-image"].value!==void 0){const B=i.getAppearanceValueAndResolveTokens(e,"icon-image",s,u,p);E=this.getResolvedImageFromTokens(B)}else{const B=i.getValueAndResolveTokens("icon-image",s,u,p);E=this.getResolvedImageFromTokens(B)}if(E){const B=k._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];C=Dg(E,ig(this.zoom,B,this.worldview),B,u,this.zoom,_,this.pixelRatio,x,this.worldview).iconPrimary}return C}updateAppearanceBasedIconTextures(e,i,s,u){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const p=this.layers[0];let _=!1,x=0;const E=p.layout,[C,k]=E.get("icon-size-scale-range"),B=te(1,C,k);for(let j=0;j<this.symbolInstances.length;j++){const U=this.symbolInstances.get(j),$=this.featureToAppearanceIndex[U.featureIndex],ee=$!==void 0?this.appearanceFeatureData[$]:void 0;if(ee&&U.placedIconSymbolIndex>=0){const le=ee.id,oe=i&&le!==void 0?i[String(le)]:void 0,ye={type:"Point",id:ee.id,properties:ee.properties,geometry:[]},xe=this.layers[0].appearances&&this.layers[0].appearances.find((Ie=>Ie.isActive({globals:u,feature:ye,canonical:e,featureState:oe})));if(ee.activeAppearance===xe){x+=U.numIconVertices;continue}if(xe){ee.activeAppearance=xe;const Ie=this.getCombinedIconPrimary(xe,p,ye,e,s,{sortKey:void 0,text:void 0,icon:null,index:U.featureIndex,sourceLayerIndex:U.featureIndex,geometry:[],properties:ee.properties,type:"Point",id:ee.id},B);if(!Ie)continue;const $e=Ie.toString(),je=this.iconAtlasPositions&&this.iconAtlasPositions.get($e);if(je){const Ye=p.getAppearanceValueAndResolveTokens(xe,"icon-offset",ye,e,s),st=Ye&&Array.isArray(Ye)?Ye:[0,0];let ut=wy(je,void 0,st,p.layout.get("icon-anchor").evaluate(ye,{},e));const Ut=p.getAppearanceValueAndResolveTokens(xe,"icon-rotate",ye,e,s),_t=typeof Ut=="number"?Ut:0,Wt=je.sdf,ni=p.layout.get("icon-text-fit").constantOr("none");ni!=="none"&&ee.textShaping&&ee.iconTextFitPadding&&ee.fontScale&&(ut=w0(ut,ee.textShaping,ni,ee.iconTextFitPadding,st,ee.fontScale));const ri=this.calculateEffectiveAppearanceIconSize(xe,u.zoom,ye,e,s,B),wi=0,Si=1+(Math.min(o_,Math.round(ri*rm))<<1),gi=A0(ut,_t,Wt,ni!=="none",B);ee.isUsingAppearanceVertexData||(ee.isUsingAppearanceVertexData=!0,ee.layoutBasedVertexData=this.icon.getIconVertexData(x,U.numIconVertices));for(let Zt=0;Zt<gi.length;++Zt){const qt=gi[Zt],vi=ee.layoutBasedVertexData[0]||U.tileAnchorX,Bi=ee.layoutBasedVertexData[1]||U.tileAnchorY,zi=16*qt.pixelOffsetTL.x,Dn=16*qt.pixelOffsetTL.y,rn=16*qt.pixelOffsetBR.x,cn=16*qt.pixelOffsetBR.y,wn=16*qt.minFontScaleX,Hr=16*qt.minFontScaleY;this.icon.updateIconVertexData(x,vi,Bi,Math.round(32*qt.tl.x),Math.round(32*qt.tl.y),qt.texPrimary.x,qt.texPrimary.y,wi,Si,zi,Dn,wn,Hr),this.icon.updateIconVertexData(x+1,vi,Bi,Math.round(32*qt.tr.x),Math.round(32*qt.tr.y),qt.texPrimary.x+qt.texPrimary.w,qt.texPrimary.y,wi,Si,rn,Dn,wn,Hr),this.icon.updateIconVertexData(x+2,vi,Bi,Math.round(32*qt.bl.x),Math.round(32*qt.bl.y),qt.texPrimary.x,qt.texPrimary.y+qt.texPrimary.h,wi,Si,zi,cn,wn,Hr),this.icon.updateIconVertexData(x+3,vi,Bi,Math.round(32*qt.br.x),Math.round(32*qt.br.y),qt.texPrimary.x+qt.texPrimary.w,qt.texPrimary.y+qt.texPrimary.h,wi,Si,rn,cn,wn,Hr),x+=4}const yi=U.numIconVertices-4*gi.length;for(let Zt=0;Zt<yi;++Zt)this.icon.updateIconVertexData(x+Zt,0,0,0,0,0,0,0,0,0,0,0,0);_=!0}else x+=U.numIconVertices}else if(ee.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(x,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(x+3,0,0,0,0,0,0,0,0,0,0,0,0),_=!0),x+=U.numIconVertices,ee.activeAppearance=null;else if(ee.isUsingAppearanceVertexData){const $e=ee.layoutBasedVertexData.length/12;for(let je=0;je<$e;++je){const Ye=je*12;this.icon.updateIconVertexData(x+je,ee.layoutBasedVertexData[Ye+0],ee.layoutBasedVertexData[Ye+1],ee.layoutBasedVertexData[Ye+2],ee.layoutBasedVertexData[Ye+3],ee.layoutBasedVertexData[Ye+4],ee.layoutBasedVertexData[Ye+5],ee.layoutBasedVertexData[Ye+6],ee.layoutBasedVertexData[Ye+7],ee.layoutBasedVertexData[Ye+8],ee.layoutBasedVertexData[Ye+9],ee.layoutBasedVertexData[Ye+10],ee.layoutBasedVertexData[Ye+11])}x+=$e,ee.isUsingAppearanceVertexData=!1,ee.activeAppearance=null,_=!0}else x+=U.numIconVertices,ee.activeAppearance=null}}return _}update(e,i,s,u,p,_,x){this.text.programConfigurations.updatePaintArrays(e,i,p,s,u,_,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,p,s,u,_,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const s=me(e),u=1/s;let p=!1,_=!1;for(let x=0;x<this.symbolInstances.length;x++){const E=this.symbolInstances.get(x),C=si(1,0,0),k=si(0,1,0),{numHorizontalGlyphVertices:B,numVerticalGlyphVertices:j,numIconVertices:U,numVerticalIconVertices:$}=E,ee=B>0||j>0,le=U>0,oe=this.elevationFeatures[E.elevationFeatureIndex];if(oe){const ye=new Ge(E.tileAnchorX,E.tileAnchorY),xe=.075+oe.pointElevation(ye);E.zOffset!==xe&&(i=!0,E.zOffset=xe),xe!==0&&(this.hasAnyZOffset=!0);const Ie=oe.computeSlopeNormal(ye,u),$e=xn(ws(),si(0,0,1),Ie);Ma(C,C,$e),Ma(k,k,$e),C[2]*=s,k[2]*=s,C[0]===1&&C[1]===0&&C[2]===0&&k[0]===0&&k[1]===1&&k[2]===0||(p=p||ee,_=_||le)}if(ee&&(Ry(this.text.orientationVertexArray,B,C,k),Ry(this.text.orientationVertexArray,j,C,k)),le){const{placedIconSymbolIndex:ye,verticalPlacedIconSymbolIndex:xe}=E;ye>=0&&Ry(this.icon.orientationVertexArray,U,C,k),xe>=0&&Ry(this.icon.orientationVertexArray,$,C,k)}}p||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,_,x)=>{s+=_,s>p.length&&p.resize(s);for(let E=-_;E<0;E++)p.emplace(E+s,x)},i=(p,_,x)=>{u+=_,u>p.length&&p.resize(u);for(let E=-_;E<0;E++)p.emplace(E+u,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,u=0;for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:E,numIconVertices:C}=_,k=_.zOffset,B=C>0;if((x>0||E>0)&&(e(this.text.zOffsetVertexArray,x,k),e(this.text.zOffsetVertexArray,E,k)),B){const{placedIconSymbolIndex:j,verticalPlacedIconSymbolIndex:U}=_;j>=0&&i(this.icon.zOffsetVertexArray,C,k),U>=0&&i(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,k)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,s,u,p){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((_=>_.appearances&&_.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,s,u){return!!(e&&i&&s)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,s,u)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Px(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:p}of i)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee,le,oe,ye){const xe=e.indexArray,Ie=e.layoutVertexArray,$e=e.globeExtVertexArray,je=e.segments.prepareSegment(4*ye,Ie,xe,this.canOverlap?_.sortKey:void 0),Ye=this.glyphOffsetArray.length,st=je.vertexLength,ut=this.allowVerticalPlacement&&x===Ud.vertical?Math.PI/2:0,Ut=_.text&&_.text.sections;for(let ni=0;ni<i.length;ni++){const{tl:ri,tr:wi,bl:Si,br:gi,texPrimary:yi,texSecondary:Zt,pixelOffsetTL:qt,pixelOffsetBR:vi,minFontScaleX:Bi,minFontScaleY:zi,glyphOffset:Dn,isSDF:rn,sectionIndex:cn}=i[ni],wn=je.vertexLength,Hr=Dn[1];if(Ng(Ie,C.x,C.y,ri.x,Hr+ri.y,yi.x,yi.y,s,rn,qt.x,qt.y,Bi,zi),Ng(Ie,C.x,C.y,wi.x,Hr+wi.y,yi.x+yi.w,yi.y,s,rn,vi.x,qt.y,Bi,zi),Ng(Ie,C.x,C.y,Si.x,Hr+Si.y,yi.x,yi.y+yi.h,s,rn,qt.x,vi.y,Bi,zi),Ng(Ie,C.x,C.y,gi.x,Hr+gi.y,yi.x+yi.w,yi.y+yi.h,s,rn,vi.x,vi.y,Bi,zi),E){const{x:Di,y:Sn,z:mr}=E.anchor,[pa,wa,Dr]=E.up;Vg($e,Di,Sn,mr,pa,wa,Dr),Vg($e,Di,Sn,mr,pa,wa,Dr),Vg($e,Di,Sn,mr,pa,wa,Dr),Vg($e,Di,Sn,mr,pa,wa,Dr),og(e.dynamicLayoutVertexArray,Di,Sn,mr,ut)}else og(e.dynamicLayoutVertexArray,C.x,C.y,C.z,ut);if(le){const Di=Zt||yi;jg(e.iconTransitioningVertexArray,Di.x,Di.y),jg(e.iconTransitioningVertexArray,Di.x+Di.w,Di.y),jg(e.iconTransitioningVertexArray,Di.x,Di.y+Di.h),jg(e.iconTransitioningVertexArray,Di.x+Di.w,Di.y+Di.h)}xe.emplaceBack(wn,wn+1,wn+2),xe.emplaceBack(wn+1,wn+2,wn+3),je.vertexLength+=4,je.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dn[0]),ni!==i.length-1&&cn===i[ni+1].sectionIndex||e.programConfigurations.populatePaintArrays(Ie.length,_,_.index,{},U,$,ee,Ut&&Ut[cn],this.worldview)}const _t=ye-i.length;_t!==0&&this._addNullVertices(_t,Ie,s,E,$e,e,le,je,xe);const Wt=E?E.anchor:C;e.placedSymbolArray.emplaceBack(Wt.x,Wt.y,Wt.z,C.x,C.y,Ye,this.glyphOffsetArray.length-Ye,st,k,B,C.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],x,0,0,0,j,0),e.symbolInstanceIndices.push(oe)}_addNullVertices(e,i,s,u,p,_,x,E,C){for(let k=0;k<e;k++){for(let j=0;j<4;j++)Ng(i,0,0,0,0,0,0,s,!1,0,0,0,0),u&&Vg(p,0,0,0,0,0,0),og(_.dynamicLayoutVertexArray,0,0,0,0),x&&jg(_.iconTransitioningVertexArray,0,0);const B=E.vertexLength;C.emplaceBack(B,B+1,B+2),C.emplaceBack(B+1,B+2,B+3),E.vertexLength+=4,E.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,s,u,p,_,x){e.emplaceBack(i,s,u,p,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,s,u,p,_,x){const E=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),C=E.vertexLength,k=x.tileAnchorX,B=x.tileAnchorY;for(let U=0;U<4;U++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,k,B,new Ge(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,k,B,new Ge(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,k,B,new Ge(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,k,B,new Ge(e.x1,e.y2)),E.vertexLength+=4;const j=s.indexArray;j.emplaceBack(C,C+1),j.emplaceBack(C+1,C+2),j.emplaceBack(C+2,C+3),j.emplaceBack(C+3,C),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,u,p,_){for(let x=u;x<p;x++){const E=s.get(x),C=this.getSymbolInstanceTextSize(e,_,i,x);this._addCollisionDebugVertices(E,C,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,i,s,u,p,_){for(let x=u;x<p;x++){const E=s.get(x),C=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._addCollisionDebugVertices(E,C,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new R0(dp,Kv.members,wu),this.iconCollisionBox=new R0(dp,Kv.members,wu);const u=ng(this.iconSizeData,e),p=ng(this.textSizeData,e,s);for(let _=0;_<this.symbolInstances.length;_++){const x=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(p,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(u,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(u,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,i,s,u){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),_=T0(this.textSizeData,e,p)/ac;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,i,s){const u=this.icon.placedSymbolArray.get(s),p=T0(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,s,u){e.emplaceBack(i,-s,-s,u),e.emplaceBack(i,s,-s,u),e.emplaceBack(i,s,s,u),e.emplaceBack(i,-s,s,u)}_updateTextDebugCollisionBoxes(e,i,s,u,p,_,x){for(let E=u;E<p;E++){const C=s.get(E),k=this.getSymbolInstanceTextSize(e,_,i,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,C.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,u,p,_,x){for(let E=u;E<p;E++){const C=s.get(E),k=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,C.padding,_.zOffset)}}updateCollisionDebugBuffers(e,i,s,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=ng(this.iconSizeData,e,u),_=ng(this.textSizeData,e,s);for(let x=0;x<this.symbolInstances.length;x++){const E=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(_,e,i,E.textBoxStartIndex,E.textBoxEndIndex,E,s),this._updateTextDebugCollisionBoxes(_,e,i,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,s),this._updateIconDebugCollisionBoxes(p,e,i,E.iconBoxStartIndex,E.iconBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(p,e,i,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,u,p,_,x,E,C){const k={};if(i<s){const{x1:B,y1:j,x2:U,y2:$,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:ye,tileAnchorX:xe,tileAnchorY:Ie,featureIndex:$e}=e.get(i);k.textBox={x1:B,y1:j,x2:U,y2:$,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:ye,tileAnchorX:xe,tileAnchorY:Ie},k.textFeatureIndex=$e}if(u<p){const{x1:B,y1:j,x2:U,y2:$,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:ye,tileAnchorX:xe,tileAnchorY:Ie,featureIndex:$e}=e.get(u);k.verticalTextBox={x1:B,y1:j,x2:U,y2:$,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:ye,tileAnchorX:xe,tileAnchorY:Ie},k.verticalTextFeatureIndex=$e}if(_<x){const{x1:B,y1:j,x2:U,y2:$,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:ye,tileAnchorX:xe,tileAnchorY:Ie,featureIndex:$e}=e.get(_);k.iconBox={x1:B,y1:j,x2:U,y2:$,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:ye,tileAnchorX:xe,tileAnchorY:Ie},k.iconFeatureIndex=$e}if(E<C){const{x1:B,y1:j,x2:U,y2:$,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:ye,tileAnchorX:xe,tileAnchorY:Ie,featureIndex:$e}=e.get(E);k.verticalIconBox={x1:B,y1:j,x2:U,y2:$,padding:ee,projectedAnchorX:le,projectedAnchorY:oe,projectedAnchorZ:ye,tileAnchorX:xe,tileAnchorY:Ie},k.verticalIconFeatureIndex=$e}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),u=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),u=[],p=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const E=this.symbolInstances.get(x);u.push(0|Math.round(i*E.tileAnchorX+s*E.tileAnchorY)),p.push(E.featureIndex)}return _.sort(((x,E)=>u[x]-u[E]||p[E]-p[x])),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:C}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&_!==u&&this.addIndicesForPlacedSymbol(this.text,_),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let s;return this.elevationFeatures&&i<this.elevationFeatures.length&&(s=this.elevationFeatures[i]),s}}function Lx(r,e){return e.replace(/{([^{}]+)}/g,((i,s)=>s in r?String(r[s]):""))}let kx,Fx,D0;hi(Dy,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Dy.addDynamicAttributes=og;class Ox{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:zc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}hi(Ox,"FormatSectionOverride",{omit:["defaultValue"]});const P0=()=>D0||(D0={layout:kx||(kx=new da({"symbol-placement":new bi(bt.layout_symbol["symbol-placement"]),"symbol-spacing":new bi(bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new bi(bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gi(bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new bi(bt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new bi(bt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new bi(bt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new bi(bt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new bi(bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new bi(bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new bi(bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gi(bt.layout_symbol["icon-size"]),"icon-size-scale-range":new bi(bt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Gi(bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gi(bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gi(bt.layout_symbol["icon-image"]),"icon-image-use-theme":new bi({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Gi(bt.layout_symbol["icon-rotate"]),"icon-padding":new bi(bt.layout_symbol["icon-padding"]),"icon-keep-upright":new bi(bt.layout_symbol["icon-keep-upright"]),"icon-offset":new Gi(bt.layout_symbol["icon-offset"]),"icon-anchor":new Gi(bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new bi(bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new bi(bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new bi(bt.layout_symbol["text-rotation-alignment"]),"text-field":new Gi(bt.layout_symbol["text-field"]),"text-font":new Gi(bt.layout_symbol["text-font"]),"text-size":new Gi(bt.layout_symbol["text-size"]),"text-size-scale-range":new bi(bt.layout_symbol["text-size-scale-range"]),"text-max-width":new Gi(bt.layout_symbol["text-max-width"]),"text-line-height":new Gi(bt.layout_symbol["text-line-height"]),"text-letter-spacing":new Gi(bt.layout_symbol["text-letter-spacing"]),"text-justify":new Gi(bt.layout_symbol["text-justify"]),"text-radial-offset":new Gi(bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new bi(bt.layout_symbol["text-variable-anchor"]),"text-anchor":new Gi(bt.layout_symbol["text-anchor"]),"text-max-angle":new bi(bt.layout_symbol["text-max-angle"]),"text-writing-mode":new bi(bt.layout_symbol["text-writing-mode"]),"text-rotate":new Gi(bt.layout_symbol["text-rotate"]),"text-padding":new bi(bt.layout_symbol["text-padding"]),"text-keep-upright":new bi(bt.layout_symbol["text-keep-upright"]),"text-transform":new Gi(bt.layout_symbol["text-transform"]),"text-offset":new Gi(bt.layout_symbol["text-offset"]),"text-allow-overlap":new bi(bt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new bi(bt.layout_symbol["text-ignore-placement"]),"text-optional":new bi(bt.layout_symbol["text-optional"]),visibility:new bi(bt.layout_symbol.visibility)})),paint:Fx||(Fx=new da({"icon-opacity":new Gi(bt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Gi(bt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Gi(bt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gi(bt.paint_symbol["text-emissive-strength"]),"icon-color":new Gi(bt.paint_symbol["icon-color"]),"icon-halo-color":new Gi(bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gi(bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gi(bt.paint_symbol["icon-halo-blur"]),"icon-translate":new bi(bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new bi(bt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new bi(bt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gi(bt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Gi(bt.paint_symbol["text-occlusion-opacity"]),"text-color":new Gi(bt.paint_symbol["text-color"],{runtimeType:Yl,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Gi(bt.paint_symbol["text-halo-color"]),"text-halo-width":new Gi(bt.paint_symbol["text-halo-width"]),"text-halo-blur":new Gi(bt.paint_symbol["text-halo-blur"]),"text-translate":new bi(bt.paint_symbol["text-translate"]),"text-translate-anchor":new bi(bt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new bi(bt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new bi(bt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new bi(bt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new bi(bt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Gi(bt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},D0);class Py extends Ks{constructor(e,i,s,u){super(e,P0(),i,s,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=qi([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach((u=>{u.recalculate(e,i,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const p of s)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===u||(this._colorAdjustmentMatrix=(function(p,_,x,E){p=_a(p),_=$r(_);const C=Ui(),k=p/3,B=1-2*k,j=[B,k,k,0,k,B,k,0,k,k,B,0,0,0,0,1],U=.5-.5*_,$=E-x;return Ai(C,[$,0,0,0,0,$,0,0,0,0,$,0,x,x,x,1],[_,0,0,0,0,_,0,0,0,0,_,0,U,U,U,1]),Ai(C,C,j),C})(e,i,s,u),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,u){const p=this.layout.get(e).evaluate(i,{},s,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||Us(_.value)||!p?p:Lx(i.properties,p)}getAppearanceValueAndResolveTokens(e,i,s,u,p){const _=e.getProperty(i);if(!_)return;const x=_.evaluate(s,{},u,p),E=e.getUnevaluatedProperties()._values[i];return E.isDataDriven()||Us(E.value)||!x||typeof x!="string"?x:Lx(s.properties,x)}createBucket(e){return new Dy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of P0().paint.overridableProperties){if(!Py.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new Ox(i),u=new pc(s,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new Gs("source",u):new ks("composite",u,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Jc(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&Py.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),u=P0().paint.properties[i];let p=!1;const _=x=>{for(const E of x)if(u.overrides&&u.overrides.hasOverride(E))return void(p=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Dl)_(s.value.value.sections);else if(s.value.kind==="source"){const x=C=>{p||(C instanceof Rc&&oo(C.value)===nd?_(C.value.sections):C instanceof zo?_(C.sections):C.eachChild(x))},E=s.value;E._styleExpression&&x(E._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new vd(this,{zoom:i,lut:s}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let Bx,Nx,jx,Vx;var L0=Yr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Ly(r,e,i,s,u,p,_,x){const E=[r,e,1,i,s,1,u,p,1],C=[_,x,1],k=ht([],E),[B,j,U]=oa(C,C,k);return Ci(E,E,[B,0,0,0,j,0,0,0,U])}function Ux(r,e,i,s,u,p,_,x){const E=(function(C,k,B,j,U,$,ee,le){const oe=Ly(0,0,1,0,1,1,0,1),ye=Ly(C,k,B,j,U,$,ee,le);return Ci(ye,ye,ht([],oe))})(r,e,i,s,u,p,_,x);return[E[2]/E[8]/pi,E[5]/E[8]/pi]}function ky(r){return[r[0],Math.min(Math.max(r[1],-Q),Q)]}class Gx extends td{constructor(e,i,s,u){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new zl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=rh(this.map._requestManager.transformRequest(this.url,Cc.Image),((s,u)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Qh(s)):u&&(this.image=u instanceof HTMLImageElement?to.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Eg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new zl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Eg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const p of e)p[1]>s&&(s=p[1]),p[1]<i&&(i=p[1]);const u=(s+i)/2;if(u>Q?this.onNorthPole=!0:u<-Q&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Se.fromLngLat);this.tileID=(function(_){let x=1/0,E=1/0,C=-1/0,k=-1/0;for(const ee of _)x=Math.min(x,ee.x),E=Math.min(E,ee.y),C=Math.max(C,ee.x),k=Math.max(k,ee.y);const B=Math.max(C-x,k-E),j=Math.max(0,Math.floor(-Math.log2(B))),U=Math.pow(2,j);let $=Math.floor((x+C)/2*U);return $>1&&($-=1),new Ua(j,$,Math.floor((E+k)/2*U))})(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new zl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Eg||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const oe in this.tiles){const ye=this.tiles[oe];ye.state!=="loaded"&&(ye.state="loaded",ye.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=Lg(new Ua(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(oe){const ye=oe[1].x-oe[0].x,xe=oe[1].y-oe[0].y,Ie=oe[2].x-oe[1].x,$e=oe[2].y-oe[1].y,je=oe[3].x-oe[2].x,Ye=oe[3].y-oe[2].y,st=oe[0].x-oe[3].x,ut=oe[0].y-oe[3].y,Ut=ye*$e-Ie*xe,_t=Ie*Ye-je*$e,Wt=je*ut-st*Ye,ni=st*xe-ye*ut;return Ut>0&&_t>0&&Wt>0&&ni>0||Ut<0&&_t<0&&Wt<0&&ni<0})(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=Lg(this.tileID,this.map.transform.projection),[p,_,x,E]=this.coordinates.map((oe=>{const ye=u.projection.project(oe[0],oe[1]);return Ix(u,ye)._round()}));this.perspectiveTransform=Ux(p.x,p.y,_.x,_.y,x.x,x.y,E.x,E.y);const C=this._boundsArray=new hf;C.emplaceBack(p.x,p.y,0,0),C.emplaceBack(_.x,_.y,pi,0),C.emplaceBack(E.x,E.y,0,pi),C.emplaceBack(x.x,x.y,pi,pi),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(C,L0.members),this.boundsSegments=Ss.simpleSegment(0,0,4,2);const k=[],B=[ky((j=this.coordinates)[0]),ky(j[1]),ky(j[2]),ky(j[3])];var j;const[U,$,ee,le]=(function(oe){let ye=oe[0][0],xe=ye,Ie=oe[0][1],$e=Ie;for(let je=1;je<oe.length;je++)oe[je][0]<ye?ye=oe[je][0]:oe[je][0]>xe&&(xe=oe[je][0]),oe[je][1]<Ie?Ie=oe[je][1]:oe[je][1]>$e&&($e=oe[je][1]);return[ye,Ie,xe-ye,$e-Ie]})(B);{const oe=new hf,[ye,xe,Ie,$e]=(function(gi){let yi=gi[0].x,Zt=yi,qt=gi[0].y,vi=qt;for(let Bi=1;Bi<gi.length;Bi++)gi[Bi].x<yi?yi=gi[Bi].x:gi[Bi].x>Zt&&(Zt=gi[Bi].x),gi[Bi].y<qt?qt=gi[Bi].y:gi[Bi].y>vi&&(vi=gi[Bi].y);return[yi,qt,Zt-yi,vi-qt]})(s),je=gi=>[(gi.x-ye)/Ie,(gi.y-xe)/$e],[Ye,st,ut,Ut]=s.map(je),_t=(function(gi,yi,Zt,qt,vi,Bi,zi,Dn){const rn=Ly(0,0,1,0,1,1,0,1);return Ci(rn,rn,ht([],Ly(gi,yi,Zt,qt,vi,Bi,zi,Dn)))})(Ye[0],Ye[1],st[0],st[1],ut[0],ut[1],Ut[0],Ut[1]);this.elevatedGlobePerspectiveTransform=Ux(Ye[0],Ye[1],st[0],st[1],ut[0],ut[1],Ut[0],Ut[1]);const Wt=(gi,yi)=>{k.push(gi.lng);const Zt=Math.round((gi.lng-U)/ee*pi),qt=Math.round((gi.lat-$)/le*pi),vi=je(yi),Bi=oa([],[vi[0],vi[1],1],_t),zi=Math.round(Bi[0]/Bi[2]*pi),Dn=Math.round(Bi[1]/Bi[2]*pi);oe.emplaceBack(Zt,qt,zi,Dn)},ni=s[3].x-s[0].x,ri=s[3].y-s[0].y,wi=s[2].x-s[1].x,Si=s[2].y-s[1].y;for(let gi=0;gi<65;gi++){const yi=gi/64,Zt=[s[0].x+yi*ni,s[0].y+yi*ri],qt=[s[1].x+yi*wi,s[1].y+yi*Si],vi=qt[0]-Zt[0],Bi=qt[1]-Zt[1];for(let zi=0;zi<65;zi++){const Dn=zi/64,rn={x:Zt[0]+vi*Dn,y:Zt[1]+Bi*Dn};Wt(i.projection.unproject(rn.x,rn.y),rn)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(oe,L0.members)}{this.maxLongitudeTriangleSize=0;let oe=[],ye=new co;const xe=(Ie,$e,je)=>{ye.emplaceBack(Ie,$e,je);const Ye=k[Ie],st=k[$e],ut=k[je],Ut=Math.min(Math.min(Ye,st),ut),_t=Math.max(Math.max(Ye,st),ut)-Ut;_t>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=_t),oe.push(Ut+_t/2)};for(let Ie=0;Ie<64;Ie++)for(let $e=0;$e<64;$e++){const je=65*Ie+$e,Ye=je+1,st=je+65,ut=st+1;xe(je,st,Ye),xe(Ye,st,ut)}[oe,ye]=(function(Ie,$e){const je=Array.from({length:Ie.length},((ut,Ut)=>Ut));je.sort(((ut,Ut)=>Ie[ut]-Ie[Ut]));const Ye=[],st=new co;for(let ut=0;ut<je.length;ut++){const Ut=je[ut];Ye.push(Ie[Ut]);const _t=3*Ut,Wt=_t+1;st.emplaceBack($e.uint16[_t],$e.uint16[Wt],$e.uint16[Wt+1])}return[Ye,st]})(oe,ye),this.elevatedGlobeTrianglesCenterLongitudes=oe,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ye)}this.elevatedGlobeSegments=Ss.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ee/pi,0,le/pi,0,0,$,U,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof Eg||(this.texture?this.texture.update(this.image):(this.texture=new a0(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let u=(p=e+180)+360*Math.round((s[0]-p)/360);var p;const _=new Ss,x=(B,j)=>{_.segments.push({vertexOffset:0,primitiveOffset:B,vertexLength:i.segments[0].vertexLength,primitiveLength:j,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-u)<=E){const B=na(s,0,s.length,u+E);return B===s.length||x(B,Zs(s,B+1,s.length,u+360-E)-B),_}u<s[0]&&(u+=360);const C=Zs(s,0,s.length,u-E);if(C===s.length)return x(0,s.length),_;x(0,C-0);const k=na(s,C+1,s.length,u+E);return k!==s.length&&x(k,s.length-k),_}}const l3=(Math.pow(256,2)-1)/16907520;class Hx extends Ks{constructor(e,i,s,u){super(e,{layout:jx||(jx=new da({visibility:new bi(bt.layout_raster.visibility)})),paint:Vx||(Vx=new da({"raster-opacity":new bi(bt.paint_raster["raster-opacity"]),"raster-color":new _d(bt.paint_raster["raster-color"]),"raster-color-mix":new bi(bt.paint_raster["raster-color-mix"]),"raster-color-range":new bi(bt.paint_raster["raster-color-range"]),"raster-hue-rotate":new bi(bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new bi(bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new bi(bt.paint_raster["raster-brightness-max"]),"raster-saturation":new bi(bt.paint_raster["raster-saturation"]),"raster-contrast":new bi(bt.paint_raster["raster-contrast"]),"raster-resampling":new bi(bt.paint_raster["raster-resampling"]),"raster-fade-duration":new bi(bt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new bi(bt.paint_raster["raster-emissive-strength"]),"raster-array-band":new bi(bt.paint_raster["raster-array-band"]),"raster-elevation":new bi(bt.paint_raster["raster-elevation"]),"raster-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof Gx&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(u)||s===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=$f({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,u])}}let qx,$x,Zx,Wx,Xx;class Yx extends Ks{constructor(e,i,s,u){super(e,{layout:qx||(qx=new da({visibility:new bi(bt["layout_raster-particle"].visibility)})),paint:$x||($x=new da({"raster-particle-array-band":new bi(bt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new bi(bt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new _d(bt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new bi(bt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new bi(bt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new bi(bt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new bi(bt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new bi(bt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this._updateColorRamp(),this.lastInvalidatedAt=to.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=$f({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=to.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class c3 extends Ks{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function k0(r,e,i){const s=[0,0,1],u=Ds([]);return Qt(u,u,i?-fi(r)+Math.PI:fi(r)),Ps(u,u,-fi(e)),Ma(s,s,u),In(s,s)}const Kx={None:0,Model:1,Symbol:2,FillExtrusion:4};class Fy{constructor(e,i,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function F0(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class Jx{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Qx{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Nm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let u=Math.floor(s[i+2]);const p=1.05*(s[i+2]-u);return u/=100,[s[i]%1*1.05,s[i+1]%1*1.05,p,u]}tileCoordinatesForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let u=s[i+0];return u=u>pi?u-pi:u,new Ge(Math.trunc(u),Math.trunc(s[i+1]))}translationForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+4],s[i+5],s[i+6]]}rotationScaleForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+10],s[i+11],s[i+12],s[i+13],s[i+14],s[i+15]]}transformForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+4],s[i+10],s[i+11],s[i+12],s[i+5],s[i+13],s[i+14],s[i+15],s[i+6],0,0,0,1]}}class O0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){this.tileToMeter=me(s);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:x,index:E,sourceLayerIndex:C}of e){const k=x??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),B=mt(_,p);if(!this.layers[0]._featureFilter.filter(new Ka(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),B,s))continue;const j={id:k,sourceLayerIndex:C,index:E,geometry:p?B.geometry:nt(_,s,u),properties:_.properties,type:_.type,patterns:{}},U=this.addFeature(j,j.geometry,B);U&&i.featureIndex.insert(_,j.geometry,E,C,this.index,this.instancesPerModel[U].instancedDataArray.length,pi/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let s=0;for(const u of this.modelUris){const p=e.getModel(u,i);if(!p)continue;const _=this.instancesPerModel[u];if(_){const x=.5*tr(p.aabb.max,p.aabb.min)*_.maxScale+_.maxXYTranslationDistance,E=Math.min(pi,Math.max(x/this.tileToMeter,pi/32));s=Math.max(E,s)}}return s}update(e,i,s,u){for(const p in this.instancesPerModel){const _=this.instancesPerModel[p];for(const x in e)_.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(_.features[_.idToFeaturesIndex[x]],e[x],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const u of s.features){const p=this.layers[0],_=u.feature,x=this.canonical,E=p.paint.get("model-rotation").evaluate(_,{},x),C=p.paint.get("model-scale").evaluate(_,{},x),k=p.paint.get("model-translation").evaluate(_,{},x);Va(u.rotation,E)&&Va(u.scale,C)&&Va(u.translation,k)||(this.evaluate(u,u.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,u){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(wh(this.activeReplacements,p))return!1;this.activeReplacements=p;let _=!1;for(const x in this.instancesPerModel){const E=this.instancesPerModel[x],C=E.instancedDataArray;for(const k of E.features){const B=k.instancedDataOffset,j=k.instancedDataCount;for(let U=0;U<j;U++){const $=16*(U+B);let ee=C.float32[$+0];const le=ee>pi;ee=le?ee-pi:ee;const oe=Math.floor(ee),ye=Math.floor(C.float32[$+1]);let xe=!1;for(const Ie of this.activeReplacements)if(!Nc(Ie,s,Kx.Model,u)&&!(Ie.min.x>oe||oe>Ie.max.x||Ie.min.y>ye||ye>Ie.max.y)&&(xe=D_(bp(oe,ye,e.canonical,Ie.footprintTileId.canonical),Ie.footprint),xe))break;C.float32[$]=xe?ee+pi:ee,_=_||xe!==le}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,Dw.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(e&&i&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)i.removeModel(s,"",!0)}addFeature(e,i,s){const u=this.layers[0],p=u.layout.get("model-id").evaluate(s,{},this.canonical);if(!p)return ji(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),p;(F0(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new Qx);const _=this.instancesPerModel[p],x=_.instancedDataArray,E=new Jx(s,x.length);for(const C of i)for(const k of C){if(k.x<0||k.x>=pi||k.y<0||k.y>=pi)continue;if(this.lookupDim!==0){const j=(this.lookupDim-1)/pi,U=this.lookupDim*(k.y*j|0)+k.x*j|0;if(this.lookup){if(this.lookup[U]!==0)continue;this.lookup[U]=1}}this.instanceCount++;const B=x.length;x.resize(B+1),_.instancesEvaluatedElevation.push(0),x.float32[16*B]=k.x,x.float32[16*B+1]=k.y}return E.instancedDataCount=_.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(e.id&&(_.idToFeaturesIndex[e.id]=_.features.length),_.features.push(E),this.evaluate(E,{},_,!1)),p}getModelUris(){return this.modelUris}evaluate(e,i,s,u){const p=this.layers[0],_=e.feature,x=this.canonical,E=e.rotation=p.paint.get("model-rotation").evaluate(_,i,x),C=e.scale=p.paint.get("model-scale").evaluate(_,i,x),k=e.translation=p.paint.get("model-translation").evaluate(_,i,x),B=Object.assign({},p.paint.get("model-color").evaluate(_,i,x));B.a=p.paint.get("model-color-mix-intensity").evaluate(_,i,x);const j=[];this.maxVerticalOffset<k[2]&&(this.maxVerticalOffset=k[2]);const U=k[0]*k[0]+k[1]*k[1],$=U>0?Math.sqrt(U):0;s.maxScale=Math.max(Math.max(s.maxScale,C[0]),Math.max(C[1],C[2])),s.maxXYTranslationDistance=Math.max(s.maxXYTranslationDistance,$),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),zv(j,E,C);const ee=Math.round(100*B.a)+B.b/1.05;for(let le=0;le<e.instancedDataCount;++le){const oe=e.instancedDataOffset+le,ye=16*oe,xe=s.instancedDataArray.float32;let Ie=0;u&&(Ie=xe[ye+6]-s.instancesEvaluatedElevation[oe]);const $e=0|xe[ye+1];xe[ye]=(0|xe[ye])+B.r/1.05,xe[ye+1]=$e+B.g/1.05,xe[ye+2]=ee,xe[ye+3]=1/(x.z>10?this.tileToMeter:me(x,$e)),xe[ye+4]=k[0],xe[ye+5]=k[1],xe[ye+6]=k[2]+Ie,xe[ye+7]=j[0],xe[ye+8]=j[1],xe[ye+9]=j[2],xe[ye+10]=j[4],xe[ye+11]=j[5],xe[ye+12]=j[6],xe[ye+13]=j[8],xe[ye+14]=j[9],xe[ye+15]=j[10],s.instancesEvaluatedElevation[oe]=k[2]}}}let e1,t1;hi(O0,"ModelBucket",{omit:["layers"]}),hi(Qx,"PerModelAttributes"),hi(Jx,"ModelFeature");class lg{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const u=s||e.findDEMTileFor(i);if(!u||!u.dem)return;const p=u.dem,_=u.tileID,x=1<<i.canonical.z-_.canonical.z;return new lg(u,p.dim/pi/x,[(i.canonical.x/x-_.canonical.x)*p.dim,(i.canonical.y/x-_.canonical.y)*p.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1];return new Ge(Math.floor(e*this._scale+this._offset[0]),Math.floor(s))}getElevationAt(e,i,s,u){const p=e*this._scale+this._offset[0],_=i*this._scale+this._offset[1],x=Math.floor(p),E=Math.floor(_),C=this._dem;return u=!!u,s?Hn(Hn(C.get(x,E,u),C.get(x,E+1,u),_-E),Hn(C.get(x+1,E,u),C.get(x+1,E+1,u),_-E),p-x):C.get(x,E,u)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*N(1,e)*this._dem.stride}}const B0=new Float32Array(262144),G_=new Uint8Array(262144);function i1(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,i1(i));return e}function n1(r,e,i){if(r.meshes)for(const s of r.meshes){if(s.aabb.min[0]===1/0)continue;const u=_n.applyTransform(s.aabb,r.globalMatrix);i.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(r.children)for(const s of r.children)n1(s,e,i)}const r1=["","wall","door","roof","window","lamp","logo"];class a1{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:i1(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=_n.applyTransformFast(s.aabb,this.node.globalMatrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Oy{constructor(e,i,s,u,p,_,x,E){this.id=s,this.layers=e,this.layerIds=this.layers.map((C=>C.fqid)),this.stateDependentLayerIds=this.layers.filter((C=>C.isStateDependent())).map((C=>C.id)),this.modelTraits|=Q_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Q_.HasMapboxMeshFeatures),p&&(this.modelTraits|=Q_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const C of i)this.nodesInfo.push(new a1(C)),n1(C,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const s of this.getNodesInfo()){const u=s.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}updateAppearances(e,i,s,u){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!ei(e,this.states))for(const u of s)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const u=s.node;this.uploaded?this.updatePbrBuffer(u):l0(u,e,!0)}for(const s of i)yy(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const u=e.transform.projectionOptions,p=e.style.getBrightness(),_=this.brightness!==p;if(!this.uploaded||this.dirty||u.name!==this.projection.name||Ug(s.paint.get("model-color").value,_)||Ug(s.paint.get("model-color-mix-intensity").value,_)||Ug(s.paint.get("model-roughness").value,_)||Ug(s.paint.get("model-emissive-strength").value,_)||Ug(s.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=u,this.brightness=p;const x=this.getNodesInfo();for(const E of x)E.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),u=this.id.canonical;for(const p of s){const _=p.feature;p.evaluatedTranslation=i.paint.get("model-translation").evaluate(_,{},u),p.evaluatedScale=i.paint.get("model-scale").evaluate(_,{},u)}}evaluate(e,i){const s=this.getNodesInfo();for(const u of s){if(!u.node.meshes)continue;const p=u.feature,_=i&&i[p.id];if(ei(_,u.state))continue;u.state=structuredClone(_);const x=u.node.meshes&&u.node.meshes[0].featureData,E=u.evaluatedColor[2],C=u.evaluatedRMEA[2],k=this.id.canonical;if(u.hasTranslucentParts=!1,x){for(let B=0;B<r1.length;B++){const j=r1[B];j.length&&(p.properties.part=j);const U=e.paint.get("model-color").evaluate(p,_,k).toPremultipliedRenderColor(null),$=e.paint.get("model-color-mix-intensity").evaluate(p,_,k);u.evaluatedColor[B]=[U.r,U.g,U.b,$],u.evaluatedRMEA[B][0]=e.paint.get("model-roughness").evaluate(p,_,k),u.evaluatedRMEA[B][2]=e.paint.get("model-emissive-strength").evaluate(p,_,k),u.evaluatedRMEA[B][3]=U.a,u.emissionHeightBasedParams[B]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,_,k),!u.hasTranslucentParts&&U.a<1&&(u.hasTranslucentParts=!0)}delete p.properties.part,h3(u,E!==u.evaluatedColor[2]||C!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,_,k);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,_,k),u.evaluatedScale=e.paint.get("model-scale").evaluate(p,_,k),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,u){const p=e.findDEMTileFor(s);if(p&&(p.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const _=lg.create(e,s,p);if(!_)return;this.modelTraits&Q_.HasMapboxMeshFeatures&&this.updateDEM(e,_,s,u);for(const x of this.getNodesInfo()){const E=x.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const C=E.footprint.vertices;let k=_.getElevationAt(C[0].x,C[0].y,!0,!0);for(let B=1;B<C.length;B++)k=Math.min(k,_.getElevationAt(C[B].x,C[B].y,!0,!0));E.elevation=k}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,u){let p=i._dem._modifiedForSources[u];if(p===void 0&&(i._dem._modifiedForSources[u]=[],p=i._dem._modifiedForSources[u]),p.includes(s.canonical))return;const _=i._dem.dim;p.push(s.canonical);let x=!1;for(const E of this.getNodesInfo()){const C=E.node;if(!C.footprint||!C.footprint.grid)continue;const k=C.footprint.grid,B=i.tileCoordToPixel(k.min.x,k.min.y),j=i.tileCoordToPixel(k.max.x,k.max.y),U=Math.min(Math.min(_-j.y,B.x),Math.min(B.y,_-j.x));if(U<0)continue;const $=te(U,2,5);let ee=Math.max(0,B.x-$),le=Math.max(0,B.y-$),oe=Math.min(j.x+$,_-1),ye=Math.min(j.y+$,_-1);for(let je=le;je<=ye;++je)for(let Ye=ee;Ye<=oe;++Ye)G_[je*_+Ye]=255;let xe=0,Ie=0;for(let je=0;je<k.cellsY;++je)for(let Ye=0;Ye<k.cellsX;++Ye){if(!k.cells[je*k.cellsX+Ye])continue;const st=i.tileCoordToPixel(k.min.x+Ye/k.xScale,k.min.y+je/k.yScale),ut=i.tileCoordToPixel(k.min.x+(Ye+1)/k.xScale,k.min.y+(je+1)/k.yScale);for(let Ut=st.y;Ut<=Math.min(ut.y+1,_-1);++Ut)for(let _t=st.x;_t<=Math.min(ut.x+1,_-1);++_t)G_[Ut*_+_t]===255&&(G_[Ut*_+_t]=0,xe+=i.getElevationAtPixel(_t,Ut),Ie++)}const $e=xe/Ie;ee=Math.max(1,B.x-$),le=Math.max(1,B.y-$),oe=Math.min(j.x+$,_-2),ye=Math.min(j.y+$,_-2),x=!0;for(let je=le;je<=ye;++je)for(let Ye=ee;Ye<=oe;++Ye)G_[je*_+Ye]===0&&(B0[je*_+Ye]=i._dem.set(Ye,je,$e));for(let je=1;je<$;++je){ee=Math.max(1,B.x-je),le=Math.max(1,B.y-je),oe=Math.min(j.x+je,_-2),ye=Math.min(j.y+je,_-2);for(let Ye=le;Ye<=ye;++Ye)for(let st=ee;st<=oe;++st){const ut=Ye*_+st;if(G_[ut]===255){let Ut=0,_t=0,Wt=-1,ni=-1;for(let ri=-1;ri<=1;++ri)for(let wi=-1;wi<=1;++wi){const Si=(Ye+ri)*_+st+wi;if(G_[Si]>=je)continue;const gi=B0[Si],yi=Math.abs(gi);yi>_t&&(Ut=gi,_t=yi,Wt=wi,ni=ri)}if(_t>.1){const ri=1-(je+.5*Math.abs(Wt*ni))/$;let wi=i._dem.get(st,Ye)+Ut*ri;const Si=i._dem.get(st+Wt,Ye+ni),gi=i._dem.get(st-Wt,Ye-ni,!0);(wi-Si)*(wi-gi)>0&&(wi=(Si+gi)/2),B0[ut]=i._dem.set(st,Ye,wi),G_[ut]=je}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=to.now())}setFilter(e){this.filter=e?Pd(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Ka(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)yy(i.node),c0(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const p=u.node.footprint;u.hiddenByReplacement=!!p&&!s.find((_=>_.footprint===p))}}getHeightAtTileCoord(e,i){const s=[],u=[0,0,0],p=qi([]);for(const _ of this.getNodesInfo()){const x=_.node.meshes[0],E=x.transformedAabb;if(e<E.min[0]||i<E.min[1]||e>E.max[0]||i>E.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};on(p,_.node.globalMatrix),u[0]=e,u[1]=i,Kr(u,u,p);const C=(u[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*j_|0,k=Math.min(63,(u[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*j_|0)*j_+Math.min(63,C),B=x.heightmap[k];if(!(B<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:B,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new Ge(e,i),new Ge(e,i),s),s.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Ug(r,e){return r instanceof Gs&&!r.isLightConstant&&e}function u3(r,e,i,s,u,p,_,x){let E=(61440&e|(61440&e)>>4)>>8,C=(3840&e|(3840&e)>>4)>>4,k=240&e|(240&e)>>4;i[3]>0&&(E=Hn(E,255*i[0],i[3]),C=Hn(C,255*i[1],i[3]),k=Hn(k,255*i[2],i[3]));const B=E<<8|C,j=k<<8|Math.floor(255*s[3]),U=(function(je){const Ye=te(je,0,2);return Math.min(Math.round(.5*Ye*255),255)})(s[2])<<8|15*s[0]<<4|15*s[1],$=te(u[0],0,1),ee=te(u[1],0,1),le=te(u[2],0,1),oe=te(u[3],0,1);let ye,xe,Ie,$e;if($!==ee&&_!==p&&ee!==$){const je=_-p;xe=1/(je*(ee-$)),Ie=-(p+je*$)/(je*(ee-$));const Ye=te(u[4],-1,1);$e=Math.pow(10,Ye),ye=255*le<<8|255*oe}else ye=65535,xe=0,Ie=1,$e=1;if(r.emplaceBack(B,j,U,ye,xe,Ie,$e),x){const je=x.length;x.clear();for(let Ye=0;Ye<je;Ye++)x.emplaceBack(B,j,U,ye,xe,Ie,$e)}}function h3(r,e,i){const s=r.node;let u=0;const p=i&Q_.HasMeshoptCompression;for(const _ of s.meshes){if(s.lights&&s.lightMeshIndex===u||!_.featureData)continue;_.featureArray=new bo,_.featureArray.reserve(_.featureData.length);let x=e;for(const E of _.featureData){const C=p?65535&E:E>>16&65535,k=p?E>>16&65535:65535&E,B=(15&k)<8?15&k:0,j=r.evaluatedRMEA[B],U=r.evaluatedColor[B],$=r.emissionHeightBasedParams[B];let ee;if(x&&B===2&&s.lights&&(ee=new bo,ee.resize(10*s.lights.length)),u3(_.featureArray,C,U,j,$,_.aabb.min[2],_.aabb.max[2],ee),ee&&x){x=!1;const le=s.meshes[s.lightMeshIndex];le.featureArray=ee,le.featureArray._trim()}}_.featureArray._trim(),u++}}hi(Oy,"Tiled3dModelBucket",{omit:["layers"]}),hi(a1,"Tiled3dModelFeature");const d3=["id","tile","layer","source","sourceLayer","state"];class H_{constructor(e,i,s,u,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=u,this.properties=e?e.properties:{},this.id=p}clone(){const e=new H_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of d3)this[i]!==void 0&&(e[i]=this[i]);return e}}class q_ extends td{constructor(e,i,s,u){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){const e=[];for(const i in this._options.models){const s=this._options.models[i],u=this._modelsInfo.get(i);if(u){const p=u.model;p.position=s.position!=null?new a(s.position[0],s.position[1]):new a(0,0),p.orientation=s.orientation!=null?s.orientation:[0,0,0],u.modelSpec=s,q_.applyModelSpecification(p,s),p.computeBoundsAndApplyParent(),this.models.push(p)}else{const p=Av(this.map._requestManager.transformRequest(s.uri,Cc.Model).url).then((_=>{if(!_)return;const x=h0(_),E=new Rv(i,s.uri,s.position,s.orientation,x);q_.applyModelSpecification(E,s),E.computeBoundsAndApplyParent(),this.models.push(E),this._modelsInfo.set(i,{modelSpec:s,model:E})})).catch((_=>{this.fire(new Qh(new Error(`Could not load model ${i} from ${s.uri}: ${_.message}`)))}));e.push(p)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new zl("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((i=>{this._loaded=!0,this.fire(new Qh(new Error(`Could not load models: ${i.message}`)))}))}static applyModelSpecification(e,i){i.nodeOverrides&&q_.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&q_.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every((s=>typeof s=="string"))){e.nodeOverrideNames=[];for(const s of i)e.nodeOverrideNames.push(s)}else Object.entries(i).forEach((([s,u])=>{const p={orientation:[0,0,0]};if(u.hasOwnProperty("orientation")){const _=u.orientation;_&&(p.orientation=_)}e.nodeOverrides.set(s,p)}))}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every((s=>typeof s=="string"))){e.materialOverrideNames=[];for(const s of i)e.materialOverrideNames.push(s)}else Object.entries(i).forEach((([s,u])=>{const p={color:new Ia(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=u["model-color"];_!==void 0&&(p.color.r=_[0],p.color.g=_[1],p.color.b=_[2]);const x=u["model-color-mix-intensity"];x!==void 0&&(p.colorMix=x);const E=u["model-emissive-strength"];E!==void 0&&(p.emissionStrength=E);const C=u["model-opacity"];C!==void 0&&(p.opacity=C),e.materialOverrides.set(s,p)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=vc(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const i=new Map;for(const s in e){const u=e[s];if(this._modelsInfo.has(s)){const p=this._modelsInfo.get(s);p&&p.modelSpec.uri===u.uri&&i.set(s,p)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function N0(r,e,i,s){const u=1<<r.z;e.lat=K((s/pi+r.y)/u),e.lng=V((i/pi+r.x)/u)}function f3(r,e,i,s){const u=r.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let p=Number.MAX_VALUE;const _=u.node,x=i.tile,E=s.calculatePosMatrix(x.tileID.toUnwrapped(),s.worldSize),C=u.evaluatedScale;let k=0;s.elevation&&_.elevation&&(k=_.elevation*s.elevation.exaggeration()),an(E,E,[(_.anchor?_.anchor[0]:0)*(C[0]-1),(_.anchor?_.anchor[1]:0)*(C[1]-1),k]),Un(E,E,C);const B=i.queryGeometry,j=B.isPointQuery()?B.screenBounds:B.screenGeometry,U=function(ee){const le=Ai([],E,ee.globalMatrix);Ai(le,s.expandedFarZProjMatrix,le);for(let oe=0;oe<ee.meshes.length;++oe){const ye=ee.meshes[oe];if(oe===ee.lightMeshIndex)continue;const xe=o0(j,s,le,ye.aabb);xe!=null&&(p=Math.min(xe,p))}if(ee.children)for(const oe of ee.children)U(oe)};if(U(_),p===Number.MAX_VALUE)return;const $=new a(0,0);return N0(x.tileID.canonical,$,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:p,position:$,feature:u.feature}}const p3={circle:class extends Ks{constructor(r,e,i,s){super(r,{layout:tc||(tc=new da({"circle-sort-key":new Gi(bt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new bi(bt.layout_circle["circle-elevation-reference"]),visibility:new bi(bt.layout_circle.visibility)})),paint:qs||(qs=new da({"circle-radius":new Gi(bt.paint_circle["circle-radius"]),"circle-color":new Gi(bt.paint_circle["circle-color"]),"circle-blur":new Gi(bt.paint_circle["circle-blur"]),"circle-opacity":new Gi(bt.paint_circle["circle-opacity"]),"circle-translate":new bi(bt.paint_circle["circle-translate"]),"circle-translate-anchor":new bi(bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new bi(bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new bi(bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gi(bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gi(bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gi(bt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new bi(bt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(r){return new ta(r)}queryRadius(r){const e=r;return Vl("circle-radius",this,e)+Vl("circle-stroke-width",this,e)+dl(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,s,u,p,_,x){const E=Xu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Xp(r,s,p,_,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const s=Ym(this);return{config:new vd(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Ks{createBucket(r){return new Ul(r)}constructor(r,e,i,s){super(r,{layout:qf||(qf=new da({visibility:new bi(bt.layout_heatmap.visibility)})),paint:p_||(p_=new da({"heatmap-radius":new Gi(bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gi(bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new bi(bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _d(bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new bi(bt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$f({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return Vl("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,s,u,p,_,x){const E=this.paint.get("heatmap-radius").evaluate(e,i);return Xp(r,s,p,_,x,!0,!0,new Ge(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new vd(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Ks{constructor(r,e,i,s){super(r,{layout:Yp||(Yp=new da({visibility:new bi(bt.layout_hillshade.visibility)})),paint:R_||(R_=new da({"hillshade-illumination-direction":new bi(bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new bi(bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new bi(bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new bi(bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new bi(bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new bi(bt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new bi(bt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends Ks{constructor(r,e,i,s){super(r,{layout:Bc||(Bc=new da({"fill-sort-key":new Gi(bt.layout_fill["fill-sort-key"]),visibility:new bi(bt.layout_fill.visibility),"fill-elevation-reference":new bi(bt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Gi(bt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:nc||(nc=new da({"fill-antialias":new bi(bt.paint_fill["fill-antialias"]),"fill-opacity":new Gi(bt.paint_fill["fill-opacity"]),"fill-color":new Gi(bt.paint_fill["fill-color"]),"fill-outline-color":new Gi(bt.paint_fill["fill-outline-color"]),"fill-translate":new bi(bt.paint_fill["fill-translate"]),"fill-translate-anchor":new bi(bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gi(bt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new bi(bt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new bi(bt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Gi(bt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Gi(bt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Gi(bt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new vd(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Tl(r)}queryRadius(){return dl(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,s,u,p){return!r.queryGeometry.isAboveHorizon&&Aa(Qc(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Ks{constructor(r,e,i,s){super(r,{layout:F_||(F_=new da({visibility:new bi(bt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new bi(bt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:wg||(wg=new da({"fill-extrusion-opacity":new bi(bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gi(bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new bi(bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new bi(bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gi(bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new bi(bt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Gi(bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gi(bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new bi(bt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new bi(bt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new bi(bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new bi(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new bi(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new bi(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new bi(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new bi(bt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new bi(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new bi(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gi(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gi(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new bi(bt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new bi(bt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new bi(bt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new bi(bt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Gi(bt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Gi(bt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new bi(bt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new ru(r)}queryRadius(){return dl(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,s,u,p,_,x,E){const C=Xu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(e,i),B=this.paint.get("fill-extrusion-base").evaluate(e,i),j=[0,0],U=x&&p.elevation,$=p.elevation?p.elevation.exaggeration():1,ee=r.tile.getBucket(this);if(U&&ee instanceof ru){const Ie=ee.centroidVertexArray,$e=E+1;$e<Ie.length&&(j[0]=Ie.geta_centroid_pos0($e),j[1]=Ie.geta_centroid_pos1($e))}if(j[0]===0&&j[1]===1)return!1;p.projection.name==="globe"&&(s=ly([s],[new Ge(0,0),new Ge(pi,pi)],r.tileID.canonical).map((Ie=>Ie.polygon)).flat());const le=U?x:null,[oe,ye]=N_(p,s,B,k,C,_,le,j,$,p.center.lat,r.tileID.canonical),xe=r.queryGeometry;return hy(oe,ye,xe.isPointQuery()?xe.screenBounds:xe.screenGeometry)}},building:class extends Ks{constructor(r,e,i,s){super(r,{layout:Bv||(Bv=new da({visibility:new bi(bt.layout_building.visibility),"building-facade":new Gi(bt.layout_building["building-facade"]),"building-facade-floors":new Gi(bt.layout_building["building-facade-floors"]),"building-facade-unit-width":new Gi(bt.layout_building["building-facade-unit-width"]),"building-facade-window":new Gi(bt.layout_building["building-facade-window"]),"building-roof-shape":new Gi(bt.layout_building["building-roof-shape"]),"building-height":new Gi(bt.layout_building["building-height"]),"building-base":new Gi(bt.layout_building["building-base"]),"building-flood-light-wall-radius":new Gi(bt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Gi(bt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Gi(bt.layout_building["building-flip-roof-orientation"])})),paint:Nv||(Nv=new da({"building-opacity":new bi(bt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new bi(bt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new bi(bt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new bi(bt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new bi(bt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new bi(bt.paint_building["building-vertical-scale"]),"building-cast-shadows":new bi(bt.paint_building["building-cast-shadows"]),"building-color":new Gi(bt.paint_building["building-color"]),"building-emissive-strength":new Gi(bt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new bi(bt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new bi(bt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new bi(bt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new bi(bt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new bi(bt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Ov(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,i,s,u,p,_,x,E){let C=this.layout.get("building-height").evaluate(e,i);const k=this.layout.get("building-base").evaluate(e,i),B=r.tile.getBucket(this).getFootprint(e);if(B){if(B.hiddenFlags!==0)return!1;C=B.height}const[j,U]=N_(p,s,k,C,new Ge(0,0),_,null,[0,0],1,p.center.lat,r.tileID.canonical),$=r.queryGeometry;return hy(j,U,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends Ks{constructor(r,e,i,s){const u=Xv();super(r,u,e,i,s),u.layout&&(this.layout=new Dd(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Xc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Mg)return Mg;const i=Xv();return Mg=new l2(i.paint.properties["line-width"].specification),Mg.useIntegerZoom=!0,Mg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new p0(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const s=Zv(this);return{config:new vd(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(r){const e=r,i=Yv(Vl("line-width",this,e),Vl("line-gap-width",this,e)),s=Vl("line-offset",this,e);return i/2+Math.abs(s)+dl(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,s,u,p){if(r.queryGeometry.isAboveHorizon)return!1;const _=Qc(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),x=r.pixelToTileUnitsFactor/2*Yv(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),E=this.paint.get("line-offset").evaluate(e,i);return E&&(s=(function(C,k){const B=[],j=new Ge(0,0);for(let U=0;U<C.length;U++){const $=C[U],ee=[];for(let le=0;le<$.length;le++){const oe=$[le],ye=$[le+1],xe=le===0?j:oe.sub($[le-1])._unit()._perp(),Ie=le===$.length-1?j:ye.sub(oe)._unit()._perp(),$e=xe._add(Ie)._unit();$e._mult(1/($e.x*Ie.x+$e.y*Ie.y)),ee.push($e._mult(k)._add(oe))}B.push(ee)}return B})(s,E*r.pixelToTileUnitsFactor)),(function(C,k,B){for(let j=0;j<k.length;j++){const U=k[j];if(C.length>=3){for(let $=0;$<U.length;$++)if(Wa(C,U[$]))return!0}if(Hs(C,U,B))return!0}return!1})(_,s,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Py,background:class extends Ks{constructor(r,e,i,s){super(r,{layout:Bx||(Bx=new da({visibility:new bi(bt.layout_background.visibility)})),paint:Nx||(Nx=new da({"background-pitch-alignment":new bi(bt.paint_background["background-pitch-alignment"]),"background-color":new bi(bt.paint_background["background-color"]),"background-pattern":new bi(bt.paint_background["background-pattern"]),"background-opacity":new bi(bt.paint_background["background-opacity"]),"background-emissive-strength":new bi(bt.paint_background["background-emissive-strength"]),"background-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Hx,"raster-particle":Yx,sky:class extends Ks{constructor(r,e,i,s){super(r,{layout:Zx||(Zx=new da({visibility:new bi(bt.layout_sky.visibility)})),paint:Wx||(Wx=new da({"sky-type":new bi(bt.paint_sky["sky-type"]),"sky-atmosphere-sun":new bi(bt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new bi(bt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new bi(bt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new bi(bt.paint_sky["sky-gradient-radius"]),"sky-gradient":new _d(bt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new bi(bt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new bi(bt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new bi(bt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$f({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),u=!s,p=r.style.light,_=p.properties.get("position");return u&&p.properties.get("anchor")==="viewport"&&ji("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?k0(_.azimuthal,90-_.polar,e):k0(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return k0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Ks{constructor(r,e,i,s){super(r,{paint:Xx||(Xx=new da({}))},e,null)}},model:class extends Ks{constructor(r,e,i,s){super(r,{layout:e1||(e1=new da({visibility:new bi(bt.layout_model.visibility),"model-id":new Gi(bt.layout_model["model-id"])})),paint:t1||(t1=new da({"model-opacity":new Gi(bt.paint_model["model-opacity"]),"model-rotation":new Gi(bt.paint_model["model-rotation"]),"model-scale":new Gi(bt.paint_model["model-scale"]),"model-translation":new Gi(bt.paint_model["model-translation"]),"model-color":new Gi(bt.paint_model["model-color"]),"model-color-mix-intensity":new Gi(bt.paint_model["model-color-mix-intensity"]),"model-type":new bi(bt.paint_model["model-type"]),"model-cast-shadows":new bi(bt.paint_model["model-cast-shadows"]),"model-receive-shadows":new bi(bt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new bi(bt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gi(bt.paint_model["model-emissive-strength"]),"model-roughness":new Gi(bt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gi(bt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new bi(bt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new bi(bt.paint_model["model-front-cutoff"]),"model-elevation-reference":new bi(bt.paint_model["model-elevation-reference"]),"model-color-use-theme":new Gi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new O0(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof Oy?pi-1:0}queryRenderedFeatures(r,e,i){const s=e.getSource();if(!(s&&s instanceof q_))return{};const u=s,p={};p[this.id]=[];const _=p[this.id];let x=0;for(const E of u.models){const C=e.getFeatureState(this.sourceLayer,E.id),k={type:"Unknown",id:E.id,properties:E.featureProperties},B=this.paint.get("model-rotation").evaluate(k,C),j=this.paint.get("model-scale").evaluate(k,C),U=this.paint.get("model-translation").evaluate(k,C),$=this.paint.get("model-elevation-reference");let ee=[];gy(ee,E,i,E.position,B,j,U,$==="ground",$==="ground",!1),i.projection.name==="globe"&&(ee=_y(ee,i));const le=Ai([],i.projMatrix,ee),oe=o0(r.isPointQuery()?r.screenBounds:r.screenGeometry,i,le,E.aabb);if(oe!=null){const ye=new H_(void 0,0,0,0,E.id);ye.layer=this.layer,ye.properties=structuredClone(E.featureProperties),ye.properties.layer=this.id,ye.properties.uri=E.uri,ye.properties.orientation=E.orientation,ye.sourceLayer=this.sourceLayer,ye.geometry={type:"Point",coordinates:[E.position.lng,E.position.lat]},ye.state=C,ye.source=this.source,_.push({featureIndex:x,feature:ye,intersectionZ:oe})}++x}return p}queryIntersectsFeature(r,e,i,s,u,p){if(!this.modelManager)return!1;const _=this.modelManager,x=r.tile.getBucket(this);if(!(x&&x instanceof O0))return!1;for(const E in x.instancesPerModel){const C=x.instancesPerModel[E],k=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(k)){const B=C.features[C.idToFeaturesIndex[k]],j=_.getModel(E,this.scope);if(!j)return!1;let U=[];const $=new a(0,0),ee=x.canonical;let le=Number.MAX_VALUE;for(let oe=0;oe<B.instancedDataCount;++oe){const ye=16*(B.instancedDataOffset+oe),xe=C.instancedDataArray.float32,Ie=[xe[ye+4],xe[ye+5],xe[ye+6]];N0(ee,$,Math.floor(xe[ye]),Math.floor(xe[ye+1])),gy(U,j,p,$,B.rotation,B.scale,Ie,!1,!1,!1),p.projection.name==="globe"&&(U=_y(U,p));const $e=Ai([],p.projMatrix,U),je=r.queryGeometry,Ye=o0(je.isPointQuery()?je.screenBounds:je.screenGeometry,p,$e,j.aabb);Ye!=null&&(le=Math.min(Ye,le))}return le!==Number.MAX_VALUE&&le}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof ks}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Ks{constructor(r,e,i,s){super(r,{layout:Gl||(Gl=new da({"clip-layer-types":new bi(bt.layout_clip["clip-layer-types"]),"clip-layer-scope":new bi(bt.layout_clip["clip-layer-scope"])})),paint:tu||(tu=new da({}))},e,i,s)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new nl(r)}is3D(r){return!0}}},j0=new Ia(0,0,0),V0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},U0={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},By={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},m3={PAINT_ORDER_FILL_AND_STROKE:1},Gg={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},s1={MASK_TYPE_LUMINANCE:1};function _3(r,e,i){r===1&&e.icons.push((function(s,u){return(function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:_}=p;if(_.content_area){const{content_area:x}=_;x.left==null&&(x.left=0),x.top==null&&(x.top=x.left),x.width==null&&(x.width=p.usvg_tree.width),x.height==null&&(x.height=x.width)}if(_.text_placeholder){const{text_placeholder:x}=_;x.top==null&&(x.top=x.left),x.height==null&&(x.height=x.width)}return _.stretch_x&&_.stretch_x.length&&o1(_,"x"),_.stretch_y&&_.stretch_y.length&&o1(_,"y"),p})(s.readFields(g3,{name:void 0},u))})(i,i.readVarint()+i.pos))}function o1(r,e){const i=[],s=r[`stretch_${e}`];let u=null;for(let p=0;p<s.length;p++)u===null?u=i.length===0?s[0]:i[i.length-1][1]+s[p]:(i.push([u,u+s[p]]),u=null);r[`stretch_${e}_areas`]=i}function g3(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=(function(s,u){return s.readFields(y3,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)})(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=(function(s,u){return s.readFields(b3,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function y3(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=l1(i,i.readVarint()+i.pos):r===4?e.variables.push((function(s,u){return s.readFields(x3,{name:void 0},u)})(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=l1(i,i.readVarint()+i.pos))}function l1(r,e){return r.readFields(v3,{},e)}function v3(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function x3(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=Vy(i.readVarint()),e.value="rgb_color")}function b3(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(Ny(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push((function(s,u){return s.readFields(I3,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)})(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push((function(s,u){return s.readFields(z3,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)})(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push((function(s,u){return s.readFields(R3,{children:[]},u)})(i,i.readVarint()+i.pos)):r===8&&e.masks.push((function(s,u){const p=s.readFields(D3,{left:0,width:20,mask_type:s1.MASK_TYPE_LUMINANCE,children:[]},u);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p})(i,i.readVarint()+i.pos))}function Ny(r,e){return r.readFields(w3,{},e)}function w3(r,e,i){r===1?(e.group=(function(s,u){return s.readFields(T3,{opacity:255,children:[]},u)})(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=(function(s,u){return s.readFields(E3,{paint_order:1,commands:[],step:1,diffs:[],rule:V0.PATH_RULE_NON_ZERO},u)})(i,i.readVarint()+i.pos),e.node="path")}function T3(r,e,i){r===1?e.transform=jy(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(Ny(i,i.readVarint()+i.pos))}function jy(r,e){return r.readFields(S3,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function S3(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function E3(r,e,i){r===1?e.fill=(function(s,u){return s.readFields(A3,{rgb_color:j0,paint:"rgb_color",opacity:255},u)})(i,i.readVarint()+i.pos):r===2?e.stroke=(function(s,u){return s.readFields(M3,{rgb_color:j0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)})(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function A3(r,e,i){r===1?(e.rgb_color=Vy(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function Vy(r){return new Ia((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function M3(r,e,i){r===1?(e.rgb_color=Vy(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function I3(r,e,i){r===1?e.transform=jy(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(c1(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function c1(r,e){return r.readFields(C3,{offset:0,opacity:255,rgb_color:j0},e)}function C3(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=Vy(i.readVarint()))}function z3(r,e,i){r===1?e.transform=jy(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(c1(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function R3(r,e,i){r===1?e.transform=jy(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(Ny(i,i.readVarint()+i.pos))}function D3(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(Ny(i,i.readVarint()+i.pos))}class P3{static calculate(e={},i=[]){const s=new Map,u=new Map;if(Object.keys(e).length===0)return s;i.forEach((p=>{u.set(p.name,p.rgb_color||new Ia(0,0,0))}));for(const[p,_]of Object.entries(e))u.has(p)?s.set(u.get(p).toString(),_):console.warn(`Ignoring unknown image variable "${p}"`);return s}}function cg(r,e=255,i){const s=e/255,u=r.toString(),p=i.has(u)?i.get(u).clone():r.clone();return p.a*=s,p.toString()}function Hg(r,e){if(!Mc()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}let G0,qg=null;function H0(r,e,i,s,u){for(const p of s.children)u1(r,e,i,p,u)}function u1(r,e,i,s,u){s.group?(r.save(),(function(p,_,x,E,C){const k=E.mask_idx!=null?x.masks[E.mask_idx]:null,B=E.clip_path_idx!=null?x.clip_paths[E.clip_path_idx]:null;if(E.transform&&(_=ug(E.transform).preMultiplySelf(_)),!(function($,ee,le){return $.opacity!==255||ee||le})(E,B!=null,k!=null))return void H0(p,_,x,E,C);const j=Hg(p.canvas.width,p.canvas.height),U=j.getContext("2d");H0(U,_,x,E,C),B&&g1(U,_,x,B),k&&y1(U,_,x,k,C),p.globalAlpha=E.opacity/255,p.drawImage(j,0,0)})(r,e,i,s.group,u),r.restore()):s.path&&(r.save(),(function(p,_,x,E,C){p.setTransform(_),E.paint_order===m3.PAINT_ORDER_FILL_AND_STROKE?(h1(p,x,E,C),f1(p,x,E,C)):(f1(p,x,E,C),h1(p,x,E,C))})(r,e,i,s.path,u),r.restore())}function h1(r,e,i,s){const u=i.fill;if(!u)return;const p=u.opacity/255;switch(r.save(),r.beginPath(),v1(i,r),u.paint){case"rgb_color":r.fillStyle=cg(u.rgb_color,u.opacity,s);break;case"linear_gradient_idx":{const _=e.linear_gradients[u.linear_gradient_idx];_.transform&&r.setTransform(ug(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=p1(r,_,p,s);break}case"radial_gradient_idx":{const _=e.radial_gradients[u.radial_gradient_idx];_.transform&&r.setTransform(ug(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=m1(r,_,p,s)}}r.fill(d1(i)),r.restore()}function d1(r){return r.rule===V0.PATH_RULE_NON_ZERO?"nonzero":r.rule===V0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function f1(r,e,i,s){const u=i.stroke;if(!u)return;const p=x1(i);r.lineWidth=u.width,r.miterLimit=u.miterlimit,r.setLineDash(u.dasharray),r.lineDashOffset=u.dashoffset;const _=u.opacity/255;switch(u.paint){case"rgb_color":r.strokeStyle=cg(u.rgb_color,u.opacity,s);break;case"linear_gradient_idx":r.strokeStyle=p1(r,e.linear_gradients[u.linear_gradient_idx],_,s,!0);break;case"radial_gradient_idx":r.strokeStyle=m1(r,e.radial_gradients[u.radial_gradient_idx],_,s,!0)}switch(u.linejoin){case By.LINE_JOIN_MITER_CLIP:case By.LINE_JOIN_MITER:r.lineJoin="miter";break;case By.LINE_JOIN_ROUND:r.lineJoin="round";break;case By.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(u.linecap){case U0.LINE_CAP_BUTT:r.lineCap="butt";break;case U0.LINE_CAP_ROUND:r.lineCap="round";break;case U0.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(p)}function p1(r,e,i,s,u=!1){if(e.stops.length===1){const j=e.stops[0];return cg(j.rgb_color,j.opacity*i,s)}const{x1:p,y1:_,x2:x,y2:E}=e;let C=new DOMPoint(p,_),k=new DOMPoint(x,E);if(u){const j=ug(e.transform);C=j.transformPoint(C),k=j.transformPoint(k)}const B=r.createLinearGradient(C.x,C.y,k.x,k.y);for(const j of e.stops)B.addColorStop(j.offset,cg(j.rgb_color,j.opacity*i,s));return B}function m1(r,e,i,s,u=!1){if(e.stops.length===1){const oe=e.stops[0];return cg(oe.rgb_color,oe.opacity*i,s)}const p=ug(e.transform),{fx:_,fy:x,fr:E,cx:C,cy:k,r:B}=e;let j=new DOMPoint(_,x),U=new DOMPoint(C,k),$=E,ee=B;if(u){j=p.transformPoint(j),U=p.transformPoint(U);const oe=(p.a+p.d)/2;$=E*oe,ee=e.r*oe}const le=r.createRadialGradient(j.x,j.y,$,U.x,U.y,ee);for(const oe of e.stops)le.addColorStop(oe.offset,cg(oe.rgb_color,oe.opacity*i,s));return le}function _1(r,e,i,s){const u=s.transform?ug(s.transform).preMultiplySelf(e):e,p=Hg(r.canvas.width,r.canvas.height),_=p.getContext("2d");for(const E of s.children)if(E.group)_1(_,u,i,E.group);else if(E.path){const C=E.path,k=new Path2D;k.addPath(x1(C),u),_.fill(k,d1(C))}const x=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;x&&g1(_,u,i,x),r.globalCompositeOperation="source-over",r.drawImage(p,0,0)}function g1(r,e,i,s){const u=Hg(r.canvas.width,r.canvas.height);_1(u.getContext("2d"),e,i,s),r.globalCompositeOperation="destination-in",r.drawImage(u,0,0)}function y1(r,e,i,s,u){if(s.children.length===0)return;const p=s.mask_idx!=null?i.masks[s.mask_idx]:null;p&&y1(r,e,i,p,u);const _=r.canvas.width,x=r.canvas.height,E=Hg(_,x),C=E.getContext("2d"),k=s.width,B=s.height,j=s.left,U=s.top,$=new Path2D,ee=new Path2D;ee.rect(j,U,k,B),$.addPath(ee,e),C.clip($);for(const ye of s.children)u1(C,e,i,ye,u);const le=C.getImageData(0,0,_,x),oe=le.data;if(s.mask_type===s1.MASK_TYPE_LUMINANCE)for(let ye=0;ye<oe.length;ye+=4)oe[ye+3]=oe[ye+3]/255*(.2126*oe[ye]+.7152*oe[ye+1]+.0722*oe[ye+2]);C.putImageData(le,0,0),r.globalCompositeOperation="destination-in",r.drawImage(E,0,0)}function ug(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function v1(r,e){const i=r.step;let s=r.diffs[0]*i,u=r.diffs[1]*i;e.moveTo(s,u);for(let p=0,_=2;p<r.commands.length;p++)switch(r.commands[p]){case Gg.PATH_COMMAND_MOVE:s+=r.diffs[_++]*i,u+=r.diffs[_++]*i,e.moveTo(s,u);break;case Gg.PATH_COMMAND_LINE:s+=r.diffs[_++]*i,u+=r.diffs[_++]*i,e.lineTo(s,u);break;case Gg.PATH_COMMAND_QUAD:{const x=s+r.diffs[_++]*i,E=u+r.diffs[_++]*i;s=x+r.diffs[_++]*i,u=E+r.diffs[_++]*i,e.quadraticCurveTo(x,E,s,u);break}case Gg.PATH_COMMAND_CUBIC:{const x=s+r.diffs[_++]*i,E=u+r.diffs[_++]*i,C=x+r.diffs[_++]*i,k=E+r.diffs[_++]*i;s=C+r.diffs[_++]*i,u=k+r.diffs[_++]*i,e.bezierCurveTo(x,E,C,k,s,u);break}case Gg.PATH_COMMAND_CLOSE:e.closePath()}return e}function x1(r){return v1(r,new Path2D)}class Uy{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}hi(Uy,"LRUCache");class q0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new wl(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new Uy(150)),this.cacheMap.get(s).get(vc(e.toString(),i))}setInCache(e,i,s,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new Uy(150));const p=this.cacheDependenciesMap.get(u),_=vc(e.id.toString(),s);p.get(_)||p.set(_,new Set);const x=this.cacheMap.get(u),E=e.toString();p.get(_).add(E),x.put(vc(e.toString(),s),i)}removeImagesFromCacheByIds(e,i,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const u=this.cacheMap.get(s),p=this.cacheDependenciesMap.get(s);for(const _ of e){const x=vc(_.toString(),i);if(p.has(x)){for(const E of p.get(x))u.delete(E);p.delete(x)}}}rasterize(e,i,s,u){const p=this.getFromCache(e,s,u);if(p)return p.clone();const _=(function(E,C){const k=P3.calculate(C.params,E.metadata?E.metadata.variables:[]),B=E.usvg_tree,j=B.width,U=B.height,$=Math.max(1,Math.round(j*C.sx)),ee=Math.max(1,Math.round(U*C.sy)),le=new DOMMatrix([$/j,0,0,ee/U,0,0]);return qg===null&&(qg=Hg(10,10),G0=qg.getContext("2d",{willReadFrequently:!0})),qg.width=$,qg.height=ee,H0(G0,le,B,B,k),G0.getImageData(0,0,$,ee)})(i.icon,e),x=q0._getImage(_);return this.setInCache(e,x,s,u),x.clone()}}class b1{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function w1(r,e,i,s){let u=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(s[_])<1e-15){if(i[_]<r[_]||i[_]>e[_])return null}else{const x=1/s[_];let E=(r[_]-i[_])*x,C=(e[_]-i[_])*x;if(E>C){const k=E;E=C,C=k}if(E>u&&(u=E),C<p&&(p=C),u>p)return null}return u}function T1(r,e,i,s,u,p,_,x,E,C,k){const B=s-r,j=u-e,U=p-i,$=_-r,ee=x-e,le=E-i,oe=k[1]*le-k[2]*ee,ye=k[2]*$-k[0]*le,xe=k[0]*ee-k[1]*$,Ie=B*oe+j*ye+U*xe;if(Math.abs(Ie)<1e-15)return null;const $e=1/Ie,je=C[0]-r,Ye=C[1]-e,st=C[2]-i,ut=(je*oe+Ye*ye+st*xe)*$e;if(ut<0||ut>1)return null;const Ut=Ye*U-st*j,_t=st*B-je*U,Wt=je*j-Ye*B,ni=(k[0]*Ut+k[1]*_t+k[2]*Wt)*$e;return ni<0||ut+ni>1?null:($*Ut+ee*_t+le*Wt)*$e}function S1(r,e,i){return(r-e)/(i-e)}function E1(r,e,i,s,u,p,_,x,E){const C=1<<i,k=p-s,B=_-u,j=(r+1)/C*k+s,U=(e+0)/C*B+u,$=(e+1)/C*B+u;x[0]=(r+0)/C*k+s,x[1]=U,E[0]=j,E[1]=$}class A1{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(p){const _=Math.ceil(Math.log2(p.dim/8)),x=[];let E=Math.ceil(Math.pow(2,_));const C=1/E,k=(U,$,ee,le,oe)=>{const ye=le?1:0,xe=(U+1)*ee-ye,Ie=$*ee,$e=($+1)*ee-ye;oe[0]=U*ee,oe[1]=Ie,oe[2]=xe,oe[3]=$e};let B=new b1(E);const j=[];for(let U=0;U<E*E;U++){k(U%E,Math.floor(U/E),C,!1,j);const $=S_(j[0],j[1],p),ee=S_(j[2],j[1],p),le=S_(j[2],j[3],p),oe=S_(j[0],j[3],p);B.minimums.push(Math.min($,ee,le,oe)),B.maximums.push(Math.max($,ee,le,oe)),B.leaves.push(1)}for(x.push(B),E/=2;E>=1;E/=2){const U=x[x.length-1];B=new b1(E);for(let $=0;$<E*E;$++){k($%E,Math.floor($/E),2,!0,j);const ee=U.getElevation(j[0],j[1]),le=U.getElevation(j[2],j[1]),oe=U.getElevation(j[2],j[3]),ye=U.getElevation(j[0],j[3]),xe=U.isLeaf(j[0],j[1]),Ie=U.isLeaf(j[2],j[1]),$e=U.isLeaf(j[2],j[3]),je=U.isLeaf(j[0],j[3]),Ye=Math.min(ee.min,le.min,oe.min,ye.min),st=Math.max(ee.max,le.max,oe.max,ye.max),ut=xe&&Ie&&$e&&je;B.maximums.push(st),B.minimums.push(Ye),B.leaves.push(st-Ye<=5&&ut?1:0)}x.push(B)}return x})(this.dem),s=i.length-1,u=i[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,u,p,_,x=1){return w1([e,i,-100],[s,u,this.maximums[0]*x],p,_)}raycast(e,i,s,u,p,_,x=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,i,s,u,p,_,x);if(E==null)return null;const C=[],k=[],B=[],j=[],U=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;U.length>0;){const{idx:$,t:ee,nodex:le,nodey:oe,depth:ye}=U.pop();if(this.leaves[$]){E1(le,oe,ye,e,i,s,u,B,j);const Ie=1<<ye,$e=(le+0)/Ie,je=(le+1)/Ie,Ye=(oe+0)/Ie,st=(oe+1)/Ie,ut=S_($e,Ye,this.dem)*x,Ut=S_(je,Ye,this.dem)*x,_t=S_(je,st,this.dem)*x,Wt=S_($e,st,this.dem)*x,ni=T1(B[0],B[1],ut,j[0],B[1],Ut,j[0],j[1],_t,p,_),ri=T1(j[0],j[1],_t,B[0],j[1],Wt,B[0],B[1],ut,p,_),wi=Math.min(ni!==null?ni:Number.MAX_VALUE,ri!==null?ri:Number.MAX_VALUE);if(wi!==Number.MAX_VALUE)return wi;{const Si=vn([],p,_,ee);if(M1(ut,Ut,Wt,_t,S1(Si[0],B[0],j[0]),S1(Si[1],B[1],j[1]))>=Si[2])return ee}continue}let xe=0;for(let Ie=0;Ie<this._siblingOffset.length;Ie++){E1((le<<1)+this._siblingOffset[Ie][0],(oe<<1)+this._siblingOffset[Ie][1],ye+1,e,i,s,u,B,j),B[2]=-100,j[2]=this.maximums[this.childOffsets[$]+Ie]*x;const $e=w1(B,j,p,_);if($e!=null){const je=$e;C[Ie]=je;let Ye=!1;for(let st=0;st<xe&&!Ye;st++)je>=C[k[st]]&&(k.splice(st,0,Ie),Ye=!0);Ye||(k[xe]=Ie),xe++}}for(let Ie=0;Ie<xe;Ie++){const $e=k[Ie];U.push({idx:this.childOffsets[$]+$e,t:C[$e],nodex:(le<<1)+this._siblingOffset[$e][0],nodey:(oe<<1)+this._siblingOffset[$e][1],depth:ye+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,u,p){if(e[u].isLeaf(i,s)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=u-1,x=e[_];let E=0,C=0;for(let k=0;k<this._siblingOffset.length;k++){const B=2*i+this._siblingOffset[k][0],j=2*s+this._siblingOffset[k][1],U=x.getElevation(B,j),$=x.isLeaf(B,j),ee=this._addNode(U.min,U.max,$);$&&(E|=1<<k),C||(C=ee)}for(let k=0;k<this._siblingOffset.length;k++)E&1<<k||this._construct(e,2*i+this._siblingOffset[k][0],2*s+this._siblingOffset[k][1],_,C+k)}}function M1(r,e,i,s,u,p){return Hn(Hn(r,i,p),Hn(e,s,p),u)}function S_(r,e,i){const s=i.dim,u=te(r*s-.5,0,s-1),p=te(e*s-.5,0,s-1),_=Math.floor(u),x=Math.floor(p),E=Math.min(_+1,s-1),C=Math.min(x+1,s-1);return M1(i.get(_,x),i.get(E,x),i.get(_,C),i.get(E,C),u-_,p-x)}const L3={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function k3(r,e,i){return(256*r*256+256*e+i)/10-1e4}function F3(r,e,i){return 256*r+e+i/256-32768}class Gy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void ji(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,_=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let E=0;E<p;E++)_[this._idx(-1,E)]=_[this._idx(0,E)],_[this._idx(p,E)]=_[this._idx(p-1,E)],_[this._idx(E,-1)]=_[this._idx(E,0)],_[this._idx(E,p)]=_[this._idx(E,p-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(p,-1)]=_[this._idx(p-1,0)],_[this._idx(-1,p)]=_[this._idx(0,p-1)],_[this._idx(p,p)]=_[this._idx(p-1,p-1)]}const x=s==="terrarium"?F3:k3;for(let E=0;E<_.length;++E){const C=4*E;this.floatView[E]=x(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=to.now()}_buildQuadTree(){this._tree=new A1(this)}get(e,i,s=!1){s&&(e=te(e,-1,this.dim),i=te(i,-1,this.dim));const u=this._idx(e,i);return this.floatView[u]}set(e,i,s){const u=this._idx(e,i),p=this.floatView[u];return this.floatView[u]=s,s-p}static getUnpackVector(e){return L3[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],u=Gy.getUnpackVector(i);let p=Math.floor((e+u[3])/u[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new m_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,p=i*this.dim+this.dim,_=s*this.dim,x=s*this.dim+this.dim;switch(i){case-1:u=p-1;break;case 1:p=u+1}switch(s){case-1:_=x-1;break;case 1:x=_+1}const E=-i*this.dim,C=-s*this.dim;for(let k=_;k<x;k++)for(let B=u;B<p;B++){const j=4*this._idx(B,k),U=4*this._idx(B+E,k+C);this.pixels[j+0]=e.pixels[U+0],this.pixels[j+1]=e.pixels[U+1],this.pixels[j+2]=e.pixels[U+2],this.pixels[j+3]=e.pixels[U+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function O3(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push((function(s,u){return s.readFields(U3,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)})(i,i.readVarint()+i.pos))}function B3(r,e,i){r===1?(e.delta_filter=(function(s,u){return s.readFields(N3,{blockSize:0},u)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function N3(r,e,i){r===1&&(e.blockSize=i.readVarint())}function j3(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function V3(r,e,i){let s=0,u=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push((function(p,_){return p.readFields(B3,{},_)})(i,i.readVarint()+i.pos)):r===4?e.codec=(function(p,_){return p.readFields(j3,{},_)})(i,i.readVarint()+i.pos):r===5?u=i.readFloat():r===6?s=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=s)}function U3(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push((function(s,u){return s.readFields(V3,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)})(i,i.readVarint()+i.pos))}function G3(r,e,i){if(r===2)(function(s,u,p){s.readFields(H3,p,u)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function H3(r,e,i){if(r===1){let s=0;const u=i.readVarint()+i.pos;for(;i.pos<u;)e[s++]=i.readVarint()}}function q3(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const u=s===1?1:0,p=s===2?1:0;for(let _=0;_<e[0];_++){const x=e[1]*_;for(let E=u;E<e[1];E++){const C=e[2]*(E+x);for(let k=p;k<e[2];k++){const B=e[3]*(k+C);for(let j=0;j<e[3];j++){const U=B+j;r[U]+=r[U-i]}}}}i*=e[s]}return r}function $3(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function Z3(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const s=r[i],u=r[i+1];r[i]=(240&s)>>4|(61440&s)>>8|(240&u)<<4|61440&u,r[i+1]=15&s|(3840&s)>>4|(15&u)<<8|(3840&u)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const s=r[i],u=r[i+1],p=r[i+2],_=r[i+3];r[i+0]=(192&s)>>6|(192&u)>>4|(192&p)>>2|192&_,r[i+1]=(48&s)>>4|(48&u)>>2|48&p|(48&_)<<2,r[i+2]=(12&s)>>2|12&u|(12&p)<<2|(12&_)<<4,r[i+3]=3&s|(3&u)<<2|(3&p)<<4|(3&_)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}hi(Gy,"DEMData"),hi(A1,"DemMinMaxQuadTree",{omit:["dem"]});var Xf=Uint8Array,$g=Uint16Array,W3=Int32Array,I1=new Xf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),C1=new Xf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),X3=new Xf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),z1=function(r,e){for(var i=new $g(31),s=0;s<31;++s)i[s]=e+=1<<r[s-1];var u=new W3(i[30]);for(s=1;s<30;++s)for(var p=i[s];p<i[s+1];++p)u[p]=p-i[s]<<5|s;return{b:i,r:u}},R1=z1(I1,2),D1=R1.b,Y3=R1.r;D1[28]=258,Y3[258]=28;for(var K3=z1(C1,0).b,P1=new $g(32768),ql=0;ql<32768;++ql){var hg=(43690&ql)>>1|(21845&ql)<<1;P1[ql]=((65280&(hg=(61680&(hg=(52428&hg)>>2|(13107&hg)<<2))>>4|(3855&hg)<<4))>>8|(255&hg)<<8)>>1}var Zg=function(r,e,i){for(var s=r.length,u=0,p=new $g(e);u<s;++u)r[u]&&++p[r[u]-1];var _,x=new $g(e);for(u=1;u<e;++u)x[u]=x[u-1]+p[u-1]<<1;_=new $g(1<<e);var E=15-e;for(u=0;u<s;++u)if(r[u])for(var C=u<<4|r[u],k=e-r[u],B=x[r[u]-1]++<<k,j=B|(1<<k)-1;B<=j;++B)_[P1[B]>>E]=C;return _},Wg=new Xf(288);for(ql=0;ql<144;++ql)Wg[ql]=8;for(ql=144;ql<256;++ql)Wg[ql]=9;for(ql=256;ql<280;++ql)Wg[ql]=7;for(ql=280;ql<288;++ql)Wg[ql]=8;var L1=new Xf(32);for(ql=0;ql<32;++ql)L1[ql]=5;var J3=Zg(Wg,9),Q3=Zg(L1,5),$0=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},sm=function(r,e,i){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(7&e)&i},Z0=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},eT=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],om=function(r,e,i){var s=new Error(e||eT[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,om),!i)throw s;return s},tT=new Xf(0),iT=typeof TextDecoder<"u"&&new TextDecoder;try{iT.decode(tT,{stream:!0})}catch{}const nT={gzip_data:"gzip"};class Tp extends Error{constructor(e){super(e),this.name="MRTError"}}const rT={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},k1={uint32:1,uint16:2,uint8:4},aT={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let W0;class Hy{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Tp(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new Tp("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new Tp(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const u=new W0(i.subarray(0,s)).readFields(O3,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new Tp(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new F1(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let u of e.blockIndices){const p=s.dataIndex[u],_=p.firstByte-e.firstByte,x=p.lastByte-e.firstByte;if(s._blocksInProgress.has(u))continue;const E={layerName:s.name,firstByte:_,lastByte:x,pixelFormat:s.pixelFormat,blockIndex:u,blockShape:[p.bands.length].concat(s.bandShape),buffer:s.buffer,codec:p.codec.codec,filters:p.filters.map((C=>C.filter))};s._blocksInProgress.add(u),i.push(E)}return new O1(i,(()=>{i.forEach((u=>s._blocksInProgress.delete(u.blockIndex)))}),((u,p)=>{if(i.forEach((_=>s._blocksInProgress.delete(_.blockIndex))),u)throw u;p.forEach((_=>{this.getLayer(_.layerName).processDecodedData(_)}))}))}}class F1{constructor({version:e,name:i,units:s,tileSize:u,pixelFormat:p,buffer:_,dataIndex:x},E){if(this.version=e,this.version!==1)throw new Tp(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=u,this.buffer=_,this.pixelFormat=rT[p],this.dataIndex=x,this.bandShape=[u+2*_,u+2*_,k1[this.pixelFormat]],this._decodedBlocks=new Uy(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return k1[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,u]of this.dataIndex.entries()){for(const[p,_]of u.bands.entries())if(_===e)return{bandIndex:i+p,blockIndex:s,blockBandIndex:p};i+=u.bands.length}break;case"number":for(const[s,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new Tp(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,s=-1/0;const u=[],p=new Set;for(const _ of e){const{blockIndex:x}=this.getBlockForBand(_);if(x<0)throw new Tp(`Invalid band: ${JSON.stringify(_)}`);const E=this.dataIndex[x];u.includes(x)||u.push(x),p.add(x),i=Math.min(i,E.firstByte),s=Math.max(s,E.lastByte)}if(p.size>this.cacheSize)throw new Tp(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e);if(i<0)throw new Tp(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(i.toString());if(!u)throw new Tp(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[i],_=this.bandShape.reduce(((C,k)=>C*k),1),x=s*_,E=u.subarray(x,x+_);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Hy.setPbf=function(r){W0=r};class O1{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Hy.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map((s=>{const{layerName:u,firstByte:p,lastByte:_,pixelFormat:x,blockShape:E,blockIndex:C,filters:k,codec:B}=s,j=i.subarray(p,_+1),U=new Uint32Array(E[0]*E[1]*E[2]);let $;if(B!=="gzip_data")throw new Tp(`Unhandled codec: ${B}`);return $=(function(ee,le){if(!globalThis.DecompressionStream&&le==="gzip_data")return Promise.resolve(((Ie=(function(Ye){Ye[0]==31&&Ye[1]==139&&Ye[2]==8||om(6,"invalid gzip data");var st=Ye[3],ut=10;4&st&&(ut+=2+(Ye[10]|Ye[11]<<8));for(var Ut=(st>>3&1)+(st>>4&1);Ut>0;Ut-=!Ye[ut++]);return ut+(2&st)})(xe=ee))+8>xe.length&&om(6,"invalid gzip data"),(function(Ye,st,ut,Ut){var _t=Ye.length;if(!_t||st.f&&!st.l)return ut||new Xf(0);var Wt=!ut,ni=Wt||st.i!=2,ri=st.i;Wt&&(ut=new Xf(3*_t));var wi,Si,gi=function(as){var Fa=ut.length;if(as>Fa){var Ga=new Xf(Math.max(2*Fa,as));Ga.set(ut),ut=Ga}},yi=st.f||0,Zt=st.p||0,qt=st.b||0,vi=st.l,Bi=st.d,zi=st.m,Dn=st.n,rn=8*_t;do{if(!vi){yi=sm(Ye,Zt,1);var cn=sm(Ye,Zt+1,3);if(Zt+=3,!cn){var wn=Ye[(Xt=4+((Zt+7)/8|0))-4]|Ye[Xt-3]<<8,Hr=Xt+wn;if(Hr>_t){ri&&om(0);break}ni&&gi(qt+wn),ut.set(Ye.subarray(Xt,Hr),qt),st.b=qt+=wn,st.p=Zt=8*Hr,st.f=yi;continue}if(cn==1)vi=J3,Bi=Q3,zi=9,Dn=5;else if(cn==2){var Di=sm(Ye,Zt,31)+257,Sn=sm(Ye,Zt+10,15)+4,mr=Di+sm(Ye,Zt+5,31)+1;Zt+=14;for(var pa=new Xf(mr),wa=new Xf(19),Dr=0;Dr<Sn;++Dr)wa[X3[Dr]]=sm(Ye,Zt+3*Dr,7);Zt+=3*Sn;var rs=$0(wa),Ue=(1<<rs)-1,Ze=Zg(wa,rs);for(Dr=0;Dr<mr;){var Xt,Ti=Ze[sm(Ye,Zt,Ue)];if(Zt+=15&Ti,(Xt=Ti>>4)<16)pa[Dr++]=Xt;else{var Yi=0,Ki=0;for(Xt==16?(Ki=3+sm(Ye,Zt,3),Zt+=2,Yi=pa[Dr-1]):Xt==17?(Ki=3+sm(Ye,Zt,7),Zt+=3):Xt==18&&(Ki=11+sm(Ye,Zt,127),Zt+=7);Ki--;)pa[Dr++]=Yi}}var Pn=pa.subarray(0,Di),On=pa.subarray(Di);zi=$0(Pn),Dn=$0(On),vi=Zg(Pn,zi),Bi=Zg(On,Dn)}else om(1);if(Zt>rn){ri&&om(0);break}}ni&&gi(qt+131072);for(var Sr=(1<<zi)-1,Or=(1<<Dn)-1,Ur=Zt;;Ur=Zt){var ua=(Yi=vi[Z0(Ye,Zt)&Sr])>>4;if((Zt+=15&Yi)>rn){ri&&om(0);break}if(Yi||om(2),ua<256)ut[qt++]=ua;else{if(ua==256){Ur=Zt,vi=null;break}var Qn=ua-254;ua>264&&(Qn=sm(Ye,Zt,(1<<(Pa=I1[Dr=ua-257]))-1)+D1[Dr],Zt+=Pa);var dr=Bi[Z0(Ye,Zt)&Or],za=dr>>4;if(dr||om(3),Zt+=15&dr,On=K3[za],za>3){var Pa=C1[za];On+=Z0(Ye,Zt)&(1<<Pa)-1,Zt+=Pa}if(Zt>rn){ri&&om(0);break}ni&&gi(qt+131072);var La=qt+Qn;if(qt<On){var Qa=0-On,fs=Math.min(On,La);for(Qa+qt<0&&om(3);qt<fs;++qt)ut[qt]=(void 0)[Qa+qt]}for(;qt<La;++qt)ut[qt]=ut[qt-On]}}st.l=vi,st.p=Ur,st.b=qt,st.f=yi,vi&&(yi=1,st.m=zi,st.d=Bi,st.n=Dn)}while(!yi);return qt!=ut.length&&Wt?(wi=ut,((Si=qt)==null||Si>wi.length)&&(Si=wi.length),new Xf(wi.subarray(0,Si))):ut.subarray(0,qt)})(xe.subarray(Ie,-8),{i:2},new Xf(((oe=xe)[(ye=oe.length)-4]|oe[ye-3]<<8|oe[ye-2]<<16|oe[ye-1]<<24)>>>0))));var oe,ye,xe,Ie;const $e=nT[le];if(!$e)throw new Error(`Unhandled codec: ${le}`);const je=new globalThis.DecompressionStream($e);return new Response(new Blob([ee]).stream().pipeThrough(je)).arrayBuffer().then((Ye=>new Uint8Array(Ye)))})(j,B).then((ee=>((function(le,oe){le.readFields(G3,oe)})(new W0(ee),U),new aT[x](U.buffer)))),$.then((ee=>{for(let le=k.length-1;le>=0;le--)switch(k[le]){case"delta_filter":q3(ee,E);break;case"zigzag_filter":$3(ee);break;case"bitshuffle_filter":Z3(ee,x);break;default:throw new Tp(`Unhandled filter "${k[le]}"`)}return{layerName:u,blockIndex:C,data:ee}})).catch((ee=>{throw ee}))})))},hi(O1,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),hi(Hy,"MapboxRasterTile"),hi(F1,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class B1{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class N1{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new xu(pi,16,0),this.featureIndexArray=new gf,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,u,p,_=0,x=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,p,_);const C=this.grid;for(let k=0;k<i.length;k++){const B=i[k],j=[1/0,1/0,-1/0,-1/0];for(let U=0;U<B.length;U++){const $=B[U];j[0]=Math.min(j[0],$.x),j[1]=Math.min(j[1],$.y),j[2]=Math.max(j[2],$.x),j[3]=Math.max(j[3],$.y)}x!==0&&(j[0]-=x,j[1]-=x,j[2]+=x,j[3]+=x),j[0]<pi&&j[1]<pi&&j[2]>=0&&j[3]>=0&&C.insert(E,j[0],j[1],j[2],j[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new vt(new xy(this.rawTileData)).layers,this.sourceLayerCoder=new B1(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:u,tileTransform:p,pixelPosMatrix:_,availableImages:x,worldview:E}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const C=i.queryRadius?i.queryRadius:0,k=s.bufferedTilespaceBounds,B=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,((ee,le,oe,ye)=>No(s.bufferedTilespaceGeometry,ee-C,le-C,oe+C,ye+C)));B.sort(sT);let j=null;u.elevation&&B.length>0&&(j=lg.create(u.elevation,this.tileID));const U={};let $;for(let ee=0;ee<B.length;ee++){const le=B[ee];if(le===$)continue;$=le;const oe=this.featureIndexArray.get(le);let ye=null;this.is3DTile?this.loadMatchingModelFeature(U,oe,e,s,u,E):this.loadMatchingFeature(U,oe,e,x,E,((xe,Ie,$e,je=0)=>(ye||(ye=nt(xe,this.tileID.canonical,p)),Ie.queryIntersectsFeature(s,xe,$e,ye,this.z,u,_,j,je))))}return U}loadMatchingFeature(e,i,s,u,p,_){const{featureIndex:x,bucketIndex:E,sourceLayerIndex:C,layoutVertexArrayOffset:k}=i,B=this.bucketLayerIDs[E],j=s.layers,U=Object.keys(j);if(U.length&&!Ji(U,B))return;const $=s.sourceCache,ee=this.sourceLayerCoder.decode(C),le=this.vtLayers[ee].feature(x),oe=this.getId(le,ee);for(let ye=0;ye<B.length;ye++){const xe=B[ye];if(!j[xe])continue;const{styleLayer:Ie,targets:$e}=j[xe];let je={};oe!==void 0&&(je=$.getFeatureState(Ie.sourceLayer,oe));const Ye=!_||_(le,Ie,je,k);if(!Ye)continue;const st=new H_(le,this.z,this.x,this.y,oe);st.tile=this.tileID.canonical,st.state=je;let ut=this.serializedLayersCache.get(xe);ut||(ut=Ie.serialize(),ut.id=xe,this.serializedLayersCache.set(xe,ut)),st.source=ut.source,st.sourceLayer=ut["source-layer"],st.layer=Object.assign({},ut),st.layer.paint=j1(ut.paint,Ie.paint,le,je,u),st.layer.layout=j1(ut.layout,Ie.layout,le,je,u);let Ut=!1;for(const _t of $e){this.updateFeatureProperties(st,_t);const{filter:Wt}=_t;if(Wt){if(le.properties=st.properties,Wt.needGeometry){const ni=mt(le,!0);if(!Wt.filter(new Ka(this.tileID.overscaledZ,{worldview:p}),ni,this.tileID.canonical))continue}else if(!Wt.filter(new Ka(this.tileID.overscaledZ,{worldview:p}),le))continue}Ut=!0,_t.targetId&&this.addFeatureVariant(st,_t)}Ut&&this.appendToResult(e,xe,x,st,Ye)}}loadMatchingModelFeature(e,i,s,u,p,_){const{featureIndex:x,bucketIndex:E}=i,C=this.bucketLayerIDs[E],k=s.layers,B=Object.keys(k);if(!B.length||Ji(B,C))for(let j=0;j<C.length;j++){const U=C[j],{styleLayer:$,targets:ee}=k[U];if($.type!=="model")continue;const le=u.tile,oe=le.getBucket($);if(!(oe&&oe instanceof Oy))continue;const ye=f3(oe,x,u,p);if(!ye)continue;const{z:xe,x:Ie,y:$e}=le.tileID.canonical,{feature:je,intersectionZ:Ye,position:st}=ye;let ut={};je.id!==void 0&&(ut=s.sourceCache.getFeatureState($.sourceLayer,je.id));const Ut=new H_({},xe,Ie,$e,je.id);Ut.tile=this.tileID.canonical,Ut.state=ut,Ut.properties=je.properties,Ut.geometry={type:"Point",coordinates:[st.lng,st.lat]};let _t=this.serializedLayersCache.get(U);_t||(_t=$.serialize(),_t.id=U,this.serializedLayersCache.set(U,_t)),Ut.source=_t.source,Ut.sourceLayer=_t["source-layer"],Ut.layer=Object.assign({},_t);let Wt=!1;for(const ni of ee){this.updateFeatureProperties(Ut,ni);const{filter:ri}=ni;if(ri){if(je.properties=Ut.properties,ri.needGeometry){if(!ri.filter(new Ka(this.tileID.overscaledZ,{worldview:_}),je,this.tileID.canonical))continue}else if(!ri.filter(new Ka(this.tileID.overscaledZ,{worldview:_}),je))continue}Wt=!0,ni.targetId&&this.addFeatureVariant(Ut,ni)}Wt&&this.appendToResult(e,U,x,Ut,Ye)}}updateFeatureProperties(e,i,s){if(i.properties){const u={};for(const p in i.properties){const _=i.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);_!=null&&(u[p]=_)}e.properties=u}}addFeatureVariant(e,i,s){const u={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(u)}appendToResult(e,i,s,u,p){let _=e[i];_===void 0&&(_=e[i]=[]),_.push({featureIndex:s,feature:u,intersectionZ:p})}lookupSymbolFeatures(e,i,s,u,p,_){const x={};this.loadVTLayers();for(const E of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:s,featureIndex:E,layoutVertexArrayOffset:0},u,p,_);return x}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),p=this.vtFeatures[u];if(p[i])return p[i];const _=this.vtLayers[u].feature(i);return p[i]=_,_}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const p=Fo(u);if(p.result!=="success"){const _=p.value.map((x=>`${x.key}: ${x.message}`)).join(", ");return void ji(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=p.value}s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[u];typeof s=="boolean"&&(s=Number(s))}return s}}function j1(r,e,i,s,u){return It(r,((p,_)=>{const x=e instanceof Dd?e.get(_):null;return x&&x.evaluate?x.evaluate(i,s,void 0,u):x}))}function sT(r,e){return e-r}hi(N1,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const V1=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class X0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=V1[15&s];if(!p)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new X0(x,_,p,e)}constructor(e,i=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=V1.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-x%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+x+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Y0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:x}=this,E=[0,p.length-1,0],C=[];for(;E.length;){const k=E.pop()||0,B=E.pop()||0,j=E.pop()||0;if(B-j<=x){for(let le=j;le<=B;le++){const oe=_[2*le],ye=_[2*le+1];oe>=e&&oe<=s&&ye>=i&&ye<=u&&C.push(p[le])}continue}const U=j+B>>1,$=_[2*U],ee=_[2*U+1];$>=e&&$<=s&&ee>=i&&ee<=u&&C.push(p[U]),(k===0?e<=$:i<=ee)&&(E.push(j),E.push(U-1),E.push(1-k)),(k===0?s>=$:u>=ee)&&(E.push(U+1),E.push(B),E.push(1-k))}return C}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:_}=this,x=[0,u.length-1,0],E=[],C=s*s;for(;x.length;){const k=x.pop()||0,B=x.pop()||0,j=x.pop()||0;if(B-j<=_){for(let le=j;le<=B;le++)G1(p[2*le],p[2*le+1],e,i)<=C&&E.push(u[le]);continue}const U=j+B>>1,$=p[2*U],ee=p[2*U+1];G1($,ee,e,i)<=C&&E.push(u[U]),(k===0?e-s<=$:i-s<=ee)&&(x.push(j),x.push(U-1),x.push(1-k)),(k===0?e+s>=$:i+s>=ee)&&(x.push(U+1),x.push(B),x.push(1-k))}return E}}function Y0(r,e,i,s,u,p){if(u-s<=i)return;const _=s+u>>1;U1(r,e,_,s,u,p),Y0(r,e,i,s,_-1,1-p),Y0(r,e,i,_+1,u,1-p)}function U1(r,e,i,s,u,p){for(;u>s;){if(u-s>600){const C=u-s+1,k=i-s+1,B=Math.log(C),j=.5*Math.exp(2*B/3),U=.5*Math.sqrt(B*j*(C-j)/C)*(k-C/2<0?-1:1);U1(r,e,i,Math.max(s,Math.floor(i-k*j/C+U)),Math.min(u,Math.floor(i+(C-k)*j/C+U)),p)}const _=e[2*i+p];let x=s,E=u;for(Xg(r,e,s,i),e[2*u+p]>_&&Xg(r,e,s,u);x<E;){for(Xg(r,e,x,E),x++,E--;e[2*x+p]<_;)x++;for(;e[2*E+p]>_;)E--}e[2*s+p]===_?Xg(r,e,s,E):(E++,Xg(r,e,E,u)),E<=i&&(s=E+1),i<=E&&(u=E-1)}}function Xg(r,e,i,s){K0(r,i,s),K0(e,2*i,2*s),K0(e,2*i+1,2*s+1)}function K0(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}function G1(r,e,i,s){const u=r-i,p=e-s;return u*u+p*p}n.$=Rh,n.A=xa,n.B=vc,n.C=2,n.D=Qe,n.E=td,n.F=zg,n.G=mx,n.H=rd,n.I=Rl,n.J=dm,n.K=yn,n.L=Lu,n.M=Xr,n.N=Ln,n.O=ir,n.P=Ge,n.Q=Us,n.R=Cc,n.S=Uh,n.T=a0,n.U=Fo,n.V=Fy,n.W=Ro,n.X=$a,n.Y=Oh,n.Z=yo,n._=Zo,n.a=function(r){return kr.API_CDN_URL_REGEX.test(r)},n.a$=K,n.a0=jn,n.a1=Gc,n.a2=yc,n.a3=class extends Fy{},n.a4=Fn,n.a5=Rn,n.a6=bt,n.a7=function(r){const e=r.value;return e?jn(e)?F0(e,!0)?[]:[new Fy(r.key,e,`invalid url "${e}"`)]:[new Fy(r.key,e,`string expected, "${yn(e)}" found`)]:[]},n.a8=sf,n.a9=da,n.aA=te,n.aB=Ai,n.aC=Mr,n.aD=ys,n.aE=Wa,n.aF=I,n.aG=Ee,n.aH=function(r,e){const i={};for(let s=0;s<e.length;s++){const u=e[s];u in r&&(i[u]=r[u])}return i},n.aI=d,n.aJ=D,n.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,s){const u=this.entries[r]=this.entries[r]||{callbacks:[]};if(u.result){const[p,_]=u.result;return this.scheduler?this.scheduler.add((()=>{s(p,_)}),e):s(p,_),()=>{}}return u.callbacks.push(s),u.cancel||(u.cancel=i(((p,_)=>{u.result=[p,_];for(const x of u.callbacks)this.scheduler?this.scheduler.add((()=>{x(p,_)}),e):x(p,_);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{u.result||(u.callbacks=u.callbacks.filter((p=>p!==s)),u.callbacks.length||(u.cancel(),delete this.entries[r]))}}},n.aL=function(r,e,i){const s=JSON.stringify(r.request);return r.data&&(this.deduped.entries[s]={result:[null,r.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},(u=>{const p=Wl(r.request,((_,x,E)=>{_?u(_):x&&u(null,{rawData:x,vectorTile:i?void 0:new vt(new xy(x)),responseHeaders:new Map(E.entries())})}));return()=>{p.cancel(),u()}}),e)},n.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},n.aN=Ho,n.aO=function(r){_o++,_o>Jh&&(r.getActor().send("enforceCacheSizeLimit",Kh),_o=0)},n.aP=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},n.aQ=Os,n.aR=Hx,n.aS=Yx,n.aT=a,n.aU=Gx,n.aV=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<r.length;s++){const u=document.createElement("source");Ap(r[s])||(i.crossOrigin="Anonymous"),u.src=r[s],i.appendChild(u)}return{cancel:()=>{}}},n.aW=Eg,n.aX=q_,n.aY=lt,n.aZ=Lg,n.a_=V,n.aa=bi,n.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Nn(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Hn(r.x,e.x,i),y:Hn(r.y,e.y,i),z:Hn(r.z,e.z,i),azimuthal:Hn(r.azimuthal,e.azimuthal,i),polar:Hn(r.polar,e.polar,i)}}},n.ac=Ka,n.ad=ks,n.ae=Se,n.af=Kr,n.ag=Pr,n.ah=_e,n.ai=Dd,n.aj=eu,n.ak=Hn,n.al=pi,n.am=Cp,n.an=fi,n.ao=Ia,n.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return(function([i,s]){const u=Nn([1,i,s]);return{x:u.x,y:u.y,z:u.z}})(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Hn(r.x,e.x,i),y:Hn(r.y,e.y,i),z:Hn(r.z,e.z,i)}}},n.aq=function(r,e,i=0,s=!0){const u=new Ge(i,i),p=r.sub(u),_=e.add(u),x=[p,new Ge(_.x,p.y),_,new Ge(p.x,_.y)];return s&&x.push(p.clone()),x},n.ar=function(r,e){const i=[];for(let s=0;s<r.length;s++){const u=Re(s-1,-1,r.length-1),p=Re(s+1,-1,r.length-1),_=r[s],x=r[p],E=r[u].sub(_).unit(),C=x.sub(_).unit(),k=C.angleWithSep(E.x,E.y),B=E.add(C).unit().mult(-1*e/Math.sin(k/2));i.push(_.add(B))}return i},n.as=Ix,n.at=No,n.au=function(r,e,i=0){return si(((e.x-i)*r.scale-r.x)*pi,(e.y*r.scale-r.y)*pi,X(e.z,e.y))},n.av=Ir,n.aw=In,n.ax=nn,n.ay=Gv,n.az=function(r){let e=1/0,i=1/0,s=-1/0,u=-1/0;for(const p of r)e=Math.min(e,p.x),i=Math.min(i,p.y),s=Math.max(s,p.x),u=Math.max(u,p.y);return{min:new Ge(e,i),max:new Ge(s,u)}},n.b=function(r){return kr.API_FONTS_REGEX.test(r)},n.b$=bp,n.b0=co,n.b1=hf,n.b2=at,n.b3=pp,n.b4=Dy,n.b5=function(){Gu.isLoading()||Gu.isLoaded()||bu()!=="deferred"||zd()},n.b6=Pd,n.b7=mt,n.b8=H_,n.b9=Oa,n.bA=qi,n.bB=mn,n.bC=Ui,n.bD=function(r,e){const{x:i,y:s}=r.point,u=Hf(i,s,r.worldSize/r._pixelsPerMercatorPixel,0,0);return Ai(u,u,Mm(Ku(e)))},n.bE=pt,n.bF=$t,n.bG=tr,n.bH=vn,n.bI=br,n.bJ=Lr,n.bK=ng,n.bL=Ud,n.bM=T0,n.bN=function(r,e,i,s,u){const p=5*e+2;r.float32[p+0]=i,r.float32[p+1]=s,r.float32[p+2]=u},n.bO=og,n.bP=sr,n.bQ=pl,n.bR=fl,n.bS=Pe,n.bT=Re,n.bU=function(r,e,i,s){var u=new Fe(4);return u[0]=r,u[1]=e,u[2]=i,u[3]=s,u},n.bV=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,u=Math.floor(r.x),p=Math.floor((r.x-u)*s),_=Math.floor(r.y*s),x=this.findDEMTileFor(new Os(i,u,i,p,_));return!(!x||!x.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||r.y<0||r.y>1)return e;const u=s.getSource().maxzoom,p=1<<u,_=Math.floor(r.x),x=r.x-_,E=new Os(u,_,u,Math.floor(x*p),Math.floor(r.y*p)),C=this.findDEMTileFor(E);if(!C||!C.dem)return e;const k=C.dem,B=1<<C.tileID.canonical.z,j=(x*B-C.tileID.canonical.x)*k.dim,U=(r.y*B-C.tileID.canonical.y)*k.dim,$=Math.floor(j),ee=Math.floor(U);return(i?this.exaggeration():1)*Hn(Hn(k.get($,ee),k.get($,ee+1),U-ee),Hn(k.get($+1,ee),k.get($+1,ee+1),U-ee),j-$)}static getAtTileOffset(r,e,i,s){const u=1<<r.canonical.z;return s?s.pointElevation(e):i?i.getAtPointOrZero(new Se(r.wrap+(r.canonical.x+e.x/pi)/u,(r.canonical.y+e.y/pi)/u)):0}static getAtTileOffsetFunc(r,e,i,s){return(u,p,_)=>{const x=this.getAtTileOffset(r,u,p,_),E=s.upVector(r.canonical,u.x,u.y);return mi(E,E,x*s.upVectorScale(r.canonical,e,i).metersToTile),E}}getForTilePoints(r,e,i,s){if(this.isUsingMockSource())return!1;const u=lg.create(this,r,s);return!!u&&(e.forEach((p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],i)})),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,u=1<<r.canonical.z-s.canonical.z;let p=r.canonical.x/u-s.canonical.x,_=r.canonical.y/u-s.canonical.y,x=0;for(let E=0;E<r.canonical.z-s.canonical.z&&!i.leaves[x];E++){p*=2,_*=2;const C=2*Math.floor(_)+Math.floor(p);x=i.childOffsets[x]+C,p%=1,_%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const u of r){const p=this.getMinMaxForTile(u.tileID);p&&(i=Math.min(i,p.min),s=Math.max(s,p.max),e=!0)}return e?{min:i,max:s}:null}},n.bW=nm,n.bX=Wr,n.bY=ac,n.bZ=Nc,n.b_=Kx,n.ba=p0,n.bb=Tl,n.bc=nt,n.bd=uf,n.be=Su,n.bf=Zh,n.bg=Ss,n.bh=Jp,n.bi=L0,n.bj=function(r,e){const i=eu(e.zoom);if(i===0)return Ku(r);const s=Am(r),u=d_(s),p=I(s.getWest())*e.worldSize,_=I(s.getEast())*e.worldSize,x=D(s.getNorth())*e.worldSize,E=D(s.getSouth())*e.worldSize,C=[p,x,0],k=[_,x,0],B=[p,E,0],j=[_,E,0],U=on([],e.globeMatrix);return Kr(C,C,U),Kr(k,k,U),Kr(B,B,U),Kr(j,j,U),u[0]=ds(u[0],B,i),u[1]=ds(u[1],j,i),u[2]=ds(u[2],k,i),u[3]=ds(u[3],C,i),_n.fromPoints(u)},n.bk=bf,n.bl=on,n.bm=qm,n.bn=ds,n.bo=kd,n.bp=vf,n.bq=Pt,n.br=an,n.bs=Hy,n.bt=xy,n.bu=Wl,n.bv=function(r,e){const i=[];for(const s in r)s in e||i.push(s);return i},n.bw=tt,n.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.by=ei,n.bz=Vi,n.c=Lo,n.c$=function(r,e,i){let s=0;for(let u=0;u<2;++u)r[u]>0&&(s+=(r[u]-0)*(r[u]-0)),e[u]<0&&(s+=(0-e[u])*(0-e[u]));return s},n.c0=D_,n.c1=x0,n.c2=wx,n.c3=I0,n.c4=X0,n.c5=mi,n.c6=la,n.c7=Ds,n.c8=function(r,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return r[0]=s*E+u*x,r[1]=u*E-s*x,r[2]=p*E+_*x,r[3]=_*E-p*x,r},n.c9=Ps,n.cA=Wi,n.cB=Ea,n.cC=Iv,n.cD=Ua,n.cE=I_,n.cF=function(r,e,i,s,u,p,_,x,E){if(E.name==="globe")return I_(r,e,new Ua(i,s,u),!1);const C=Lg({z:i,x:s,y:u},E);return new _n([(p+C.x/C.scale)*e,e*(C.y/C.scale),_],[(p+C.x2/C.scale)*e,e*(C.y2/C.scale),x])},n.cG=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},n.cH=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},n.cI=function(r){const e=Math.round((r+45+360)%360/90)%4;return kn[e]},n.cJ=Q,n.cK=Qs,n.cL=$p,n.cM=function(r){const e=qi(new Float64Array(16));Ai(e,r.pixelMatrix,r.globeMatrix);const i=[0,Wu,0],s=[0,Es,0];return Kr(i,i,e),Kr(s,s,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!vp(r,new a(r.center.lat,90)),s[0]>0&&s[0]<=r.width&&s[1]>0&&s[1]<=r.height&&!vp(r,new a(r.center.lat,-90))]},n.cN=function(r,e){const{scale:i}=r.tileTransform,s=i*pi/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return(function(u,p,_){var x=p[1],E=p[2],C=p[3],k=_[0],B=_[1];return u[0]=p[0]*k,u[1]=x*k,u[2]=E*B,u[3]=C*B,u})(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},n.cO=py,n.cP=Li,n.cQ=Mv,n.cR=function(r){const e=Mv(r,!0);return pt([],[e[0],e[1],e[4],e[5]])},n.cS=Un,n.cT=$i,n.cU=rr,n.cV=function(r){const{x:e,y:i}=r.point,{lng:s,lat:u}=r._center;return Hf(e,i,r.worldSize,s,u)},n.cW=Er,n.cX=ui,n.cY=Is,n.cZ=el,n.c_=bc,n.ca=cs,n.cb=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},n.cc=tn,n.cd=function(r,e,i,s,u){var p=1/Math.tan(e/2);if(r[0]=p/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=p,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0){var _=1/(s-u);r[10]=(u+s)*_,r[14]=2*u*s*_}else r[10]=-1,r[14]=-2*s;return r},n.ce=function(r,e,i,s,u,p,_){var x=1/(e-i),E=1/(s-u),C=1/(p-_);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*E,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*C,r[11]=0,r[12]=(e+i)*x,r[13]=(u+s)*E,r[14]=(_+p)*C,r[15]=1,r},n.cf=N,n.cg=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},n.ch=wm,n.ci=Bf,n.cj=Bo,n.ck=Ql,n.cl=uo,n.cm=Px,n.cn=function(){var r=new Fe(4);return Fe!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},n.co=function(r,e,i){var s=e[0],u=e[1],p=e[2],_=e[3],x=Math.sin(i),E=Math.cos(i);return r[0]=s*E+p*x,r[1]=u*E+_*x,r[2]=s*-x+p*E,r[3]=u*-x+_*E,r},n.cp=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},n.cq=Va,n.cr=function(r){var e=r[0],i=r[1],s=r[2],u=r[3];return Math.sqrt(e*e+i*i+s*s+u*u)},n.cs=ms,n.ct=Ma,n.cu=$s,n.cv=3,n.cw=2,n.cx=7,n.cy=6,n.cz=ma,n.d=function(r){return kr.API_TILEJSON_REGEX.test(r)},n.d$=class{constructor(r,e,i,s){this.context=r,this.format=s,this.size=i,this.texture=r.gl.createTexture();const[u,p,_]=this.size,{gl:x}=r;x.bindTexture(x.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&x.texImage3D(x.TEXTURE_3D,0,this.format,u,p,_,0,n0(this.format),r0(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),r!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,r),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},n.d0=function(r){return r*r*r*r*r},n.d1=S,n.d2=45,n.d3=Nf,n.d4=function(r,e,i){const s=Math.sqrt(r*r+e*e+i*i),u=s>0?Math.acos(i/s)*Pi:0;let p=r!==0||e!==0?Math.atan2(-e,-r)*Pi+90:0;return p<0&&(p+=360),[s,p,u]},n.d5=si,n.d6=Nn,n.d7=me,n.d8=Tn,n.d9=_n,n.dA=function(r){return r({pluginStatus:Jo,pluginURL:gc}),no.on("pluginStateChange",r),r},n.dB=_h,n.dC=class extends mh{constructor(r){super(r),this.current=Tm}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},n.dD=fr,n.dE=function(r,e,i){const s=eu(i.zoom),u=r.style.map._antialias,p=r.terrain&&r.terrain.exaggeration()>0;return s===0&&!u&&!p},n.dF=function(r){const e=r.pixelsPerMeter,i=e/N(1,r.center.lat),s=qi(new Float64Array(16));return an(s,s,[r.point.x,r.point.y,0]),Un(s,s,[i,i,e]),Float32Array.from(s)},n.dG=Am,n.dH=function(r){const e=Q-5;r=te(r,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(fi(r))),3);return Math.round(i*(Em.length-1))},n.dI=function(r,e,i,s){const u=e.getNorth(),p=e.getSouth(),_=e.getWest(),x=e.getEast(),E=1<<r.z,C=x-_,k=u-p,B=C/yp,j=-k/Em[i],U=[0,B,0,j,0,0,u,_,0];if(r.z>0){const $=180/s;Ci(U,U,[$/C+1,0,0,0,$/k+1,0,-.5*$/B,.5*$/j,1])}return U[2]=E,U[5]=r.x,U[8]=r.y,U},n.dJ=Ku,n.dK=function(r,e,i){const s=qi(new Float64Array(16)),u=(e/(1<<r)-.5)*Math.PI*2;return ln(s,i.globeMatrix,u),Float32Array.from(s)},n.dL=m_,n.dM=vh,n.dN=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},n.dO=it,n.dP=function(r,e){var i=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=i,r[2]=0,r[3]=-i,r[4]=s,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},n.dQ=oa,n.dR=Zm,n.dS=$r,n.dT=_a,n.dU=256,n.dV=function(r,e){const i=[0,0,0];return Kr(i,i,bf(Ku(e.canonical))),Kr(i,i,r),i},n.dW=r=>({u_matrix:new uo(r),u_texsize:new Ql(r),u_pixels_to_tile_units:new Gp(r),u_device_pixel_ratio:new Bo(r),u_width_scale:new Bo(r),u_floor_width_scale:new Bo(r),u_image:new wm(r),u_units_to_pixels:new Ql(r),u_tile_units_to_pixels:new Bo(r),u_alpha_discard_threshold:new Bo(r),u_trim_offset:new Ql(r),u_trim_fade_range:new Ql(r),u_trim_color:new Nf(r),u_zbias_factor:new Bo(r),u_tile_to_meter:new Bo(r),u_ground_shadow_factor:new Bf(r),u_pattern_transition:new Bo(r)}),n.dX=r=>({u_matrix:new uo(r),u_pixels_to_tile_units:new Gp(r),u_device_pixel_ratio:new Bo(r),u_width_scale:new Bo(r),u_floor_width_scale:new Bo(r),u_units_to_pixels:new Ql(r),u_dash_image:new wm(r),u_gradient_image:new wm(r),u_image_height:new Bo(r),u_texsize:new Ql(r),u_tile_units_to_pixels:new Bo(r),u_alpha_discard_threshold:new Bo(r),u_trim_offset:new Ql(r),u_trim_fade_range:new Ql(r),u_trim_color:new Nf(r),u_zbias_factor:new Bo(r),u_tile_to_meter:new Bo(r),u_ground_shadow_factor:new Bf(r)}),n.dY=r=>({u_camera_to_center_distance:new Bo(r),u_extrude_scale:new Gp(r),u_device_pixel_ratio:new Bo(r),u_matrix:new uo(r),u_inv_rot_matrix:new uo(r),u_merc_center:new Ql(r),u_tile_id:new Bf(r),u_zoom_transition:new Bo(r),u_up_dir:new Bf(r),u_emissive_strength:new Bo(r)}),n.dZ=Lf,n.d_=g2,n.da=zn,n.db=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},n.dc=Av,n.dd=h0,n.de=Rv,n.df=F0,n.dg=function(r,e){return r.readFields(_3,{icons:[]},e)},n.dh=sn,n.di=rg,n.dj=E0,n.dk=Sd,n.dl=hh,n.dm=Ah,n.dn=ss,n.dp=Gt,n.dq=function(r){const e=r.indexOf(lf);return e>=0?r.slice(0,e):r},n.dr=function(r){return r.indexOf(lf)>=0},n.ds=function(r){const e=r.lastIndexOf(lf);return e>=0?r.slice(e+1):""},n.dt=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.du=function(r,e,i,s){return r.type==="custom"?new c3(r,e):new p3[r.type](r,e,i,s)},n.dv=ti,n.dw=function(r){const e=r.indexOf(lf);return e>=0?r.slice(e+1):""},n.dx=class extends H_{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},n.dy=no,n.dz=cu,n.e=kr,n.e$=xi,n.e0=Ym,n.e1=(r,e,i,s,u,p)=>{const _=r.transform,x=_.projection.name==="globe";let E;if(p.paint.get("circle-pitch-alignment")==="map")if(x){const k=Zm(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;E=Float32Array.from([k,0,0,k])}else E=_.calculatePixelsToTileUnitsMatrix(i);else E=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(_.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:to.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Xm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(x){C.u_inv_rot_matrix=s,C.u_merc_center=u,C.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],C.u_zoom_transition=eu(_.zoom);const k=u[0]*pi,B=u[1]*pi;C.u_up_dir=_.projection.upVector(new Ua(0,0,0),k,B)}return C},n.e2=Zv,n.e3=Co,n.e4=(r,e,i,s,u,p,_,x,E,C)=>{const k=r.transform,B=k.pitch<15?Hv(.07,.7,te((14-k.zoom)/5,0,1)):.07,j=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:$v(r,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:p,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:qv(e,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(j?null:i.lut).toArray01(),u_zbias_factor:B,u_tile_to_meter:me(e.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:C}},n.e5=(r,e,i,s,u,p,_,x,E,C)=>{const k=r.transform,B=k.calculatePixelsToTileUnitsMatrix(e),j=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",U=k.pitch<15?Hv(.07,.7,te((14-k.zoom)/5,0,1)):.07;return{u_matrix:$v(r,e,i,s),u_pixels_to_tile_units:B,u_device_pixel_ratio:p,u_width_scale:_,u_floor_width_scale:x,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:Wv(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:qv(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(j?null:i.lut).toArray01(),u_zbias_factor:U,u_tile_to_meter:me(e.tileID.canonical,0),u_ground_shadow_factor:C}},n.e6=St,n.e7=$f,n.e8=X,n.e9=ic,n.eA=function(r,e){var i=2*Math.acos(e[3]),s=Math.sin(i/2);return s>ke?(r[0]=e[0]/s,r[1]=e[1]/s,r[2]=e[2]/s):(r[0]=1,r[1]=0,r[2]=0),i},n.eB=N0,n.eC=gy,n.eD=_y,n.eE=[1,1,1],n.eF=lg,n.eG=Po,n.eH=function(r,e,i,s){var u=e[0],p=e[1],_=e[2],x=e[3];return r[0]=u+s*(i[0]-u),r[1]=p+s*(i[1]-p),r[2]=_+s*(i[2]-_),r[3]=x+s*(i[3]-x),r},n.eI=Q_,n.eJ=wu,n.eK=Tu,n.eL=function(r,e,i,s,u,p,_,x,E,C,k,B,j,U,$,ee){var le=new Fe(16);return le[0]=r,le[1]=e,le[2]=i,le[3]=s,le[4]=u,le[5]=p,le[6]=_,le[7]=x,le[8]=E,le[9]=C,le[10]=k,le[11]=B,le[12]=j,le[13]=U,le[14]=$,le[15]=ee,le},n.eM=h,n.eN=Ff,n.eO=fp,n.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ge(1/0,1/0),max:new Ge(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=Th(new Ge(0,0),new Ge(pi,pi),r),s=[];if(e&&!Qu(i,this._globalClipBounds))return s;for(const u of this._activeRegions){if(u.hiddenByOverlap||!Qu(i,u))continue;const p=Wh(u.min,u.max,r);s.push({min:p.min,max:p.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return s}setSources(r){this._setSources(r.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(s).buckets[e.layer];u&&u.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),s=r.getClipMask(),u=r.getClipScope();for(const p of e){if(!p.footprint)continue;const _=Th(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:i,clipMask:s,clipScope:u})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||So(e.min,i.min)||So(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(s,u){const p=(_,x)=>_+x;return s.length-u.length||s.reduce(p,"").localeCompare(u.reduce(p,""))})(e.clipScope,i.clipScope)));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];r=i.priority!==s.priority||!Zf(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!ei(i.clipScope,s.clipScope),this._activeRegions[e].hiddenByOverlap=s.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Bs&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const u=s[i].priority;for(;i<s.length&&s[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let u=i;const p=i;for(;u!==s;){const _=this._activeRegions[u];_.hiddenByOverlap=!1;for(let x=0;x<p;x++){const E=this._activeRegions[x];if(!E.hiddenByOverlap&&_.order===Bs&&Qu(_,E)&&(_.hiddenByOverlap=Tf(_.footprint,_.tileId,E.footprint,E.tileId),_.hiddenByOverlap))break}++u}i=s,s=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},n.eQ=Bs,n.eR=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new uf,s=new co,u=[],p=r+1+2,_=e[0]+1,x=e[0]+1+(1+e.length),E=(C,k,B)=>{let j=C===p-1?C-2:C===0?C:C-1;return j+=B?24575:0,[j,k]};for(let C=0;C<p;++C)i.emplaceBack(...E(C,0,!0));for(let C=0;C<_;++C)for(let k=0;k<p;++k)i.emplaceBack(...E(k,C,(k===0||k===p-1)&&!0));for(let C=0;C<e.length;++C){const k=e[C];for(let B=0;B<p;++B)i.emplaceBack(...E(B,k,!0))}for(let C=0;C<e.length;++C){const k=s.length,B=e[C]+1+2,j=new co;for(let ee=0;ee<B-1;ee++){const le=ee===B-2,oe=le?p*(x-e.length+C-ee):p;for(let ye=0;ye<p-1;ye++){const xe=ee*p+ye;ee===0||le||ye===0||ye===p-2?(j.emplaceBack(xe+1,xe,xe+oe),j.emplaceBack(xe+oe,xe+oe+1,xe+1)):(s.emplaceBack(xe+1,xe,xe+oe),s.emplaceBack(xe+oe,xe+oe+1,xe+1))}}const U=Ss.simpleSegment(0,k,i.length,s.length-k);for(let ee=0;ee<j.uint16.length;ee+=3)s.emplaceBack(j.uint16[ee],j.uint16[ee+1],j.uint16[ee+2]);const $=Ss.simpleSegment(0,k,i.length,s.length-k);u.push({withoutSkirts:U,withSkirts:$})}return{vertices:i,indices:s,segments:u}}_createGrid(r){const e=this._fillGridMeshWithLods(yp,Em);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Zh.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new co;for(let _=0;_<=yp;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new pf,s=new pf,u=new pf,p=new pf;this._poleSegments=[];for(let _=0,x=0;_<bc;_++){const E=360/(1<<_);i.emplaceBack(0,-ys,0,.5,0),s.emplaceBack(0,-ys,0,.5,1),u.emplaceBack(0,-ys,0,.5,.5),p.emplaceBack(0,-ys,0,.5,.5);for(let C=0;C<=yp;C++){let k=C/yp,B=0;const j=Hn(0,E,k),[U,$,ee]=bl(Wm,C_,j,ys);i.emplaceBack(U,$,ee,k,B),s.emplaceBack(U,$,ee,k,1-B);const le=fi(j);k=.5+.5*Math.sin(le),B=.5+.5*Math.cos(le),u.emplaceBack(U,$,ee,k,B),p.emplaceBack(U,$,ee,k,1-B)}this._poleSegments.push(Ss.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Yu,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(s,Yu,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(u,Yu,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(p,Yu,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},n.eS=To,n.eT=Cr,n.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.eV=ct,n.eW=ge,n.eX=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},n.eY=Ar,n.eZ=Eu,n.e_=Gr,n.ea=ru,n.eb=x_,n.ec=Sf,n.ed=y_,n.ee=L_,n.ef=ie,n.eg=function(r,e){if(r===e){var i=e[1],s=e[2],u=e[3],p=e[6],_=e[7],x=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=s,r[9]=p,r[11]=e[14],r[12]=u,r[13]=_,r[14]=x}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},n.eh=l3,n.ei=Yr,n.ej=Oo,n.ek=256,n.el=Mm,n.em=xc,n.en=ln,n.eo=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},n.ep=pf,n.eq=wt,n.er=ym,n.es=function(r,e,i,s,u){return te((r-e)/(i-e)*(u-s)+s,s,u)},n.et=Qt,n.eu=function(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=e[4],x=e[5],E=e[6],C=e[7],k=e[8],B=k*_-x*C,j=-k*p+x*E,U=C*p-_*E,$=i*B+s*j+u*U;return $?(r[0]=B*($=1/$),r[1]=(-k*s+u*C)*$,r[2]=(x*s-u*_)*$,r[3]=j*$,r[4]=(k*i-u*E)*$,r[5]=(-x*i+u*p)*$,r[6]=U*$,r[7]=(-C*i+s*E)*$,r[8]=(_*i-s*p)*$,r):null},n.ev=2,n.ew=gr,n.ex=ws,n.ey=Ni,n.ez=function(r,e){var i=new Fe(3);Ni(i,e);var s=1/i[0],u=1/i[1],p=1/i[2],_=e[0]*s,x=e[1]*u,E=e[2]*p,C=e[4]*s,k=e[5]*u,B=e[6]*p,j=e[8]*s,U=e[9]*u,$=e[10]*p,ee=_+k+$,le=0;return ee>0?(le=2*Math.sqrt(ee+1),r[3]=.25*le,r[0]=(B-U)/le,r[1]=(j-E)/le,r[2]=(x-C)/le):_>k&&_>$?(le=2*Math.sqrt(1+_-k-$),r[3]=(B-U)/le,r[0]=.25*le,r[1]=(x+C)/le,r[2]=(j+E)/le):k>$?(le=2*Math.sqrt(1+k-_-$),r[3]=(j-E)/le,r[0]=(x+C)/le,r[1]=.25*le,r[2]=(B+U)/le):(le=2*Math.sqrt(1+$-_-k),r[3]=(x-C)/le,r[0]=(j+E)/le,r[1]=(B+U)/le,r[2]=.25*le),r},n.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},n.f0=function([r,e,i]){const s=Math.hypot(r,e,i),u=Math.atan2(r,i),p=.5*Math.PI-Math.acos(-e/s);return new a(ui(u),ui(p))},n.f1=Io,n.f2=s0,n.f3=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!(function(i){if(ts==null){const s=i.navigator?i.navigator.userAgent:null;ts=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return ts})(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},n.f4=function(r,e){Kh=r,Jh=e},n.f5=vp,n.f6=Wp,n.f7=function(r){const e=[0,0,0],i=qi(new Float64Array(16));return Ai(i,r.pixelMatrix,r.globeMatrix),Kr(e,e,i),new Ge(e[0],e[1])},n.f8=function(){const r=Ot;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Y),Ot=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.f9=function(){sn().acquire(Y)},n.fA=Gy,n.fB=dt,n.fC=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==bv){const i=new Uint32Array(r,0,7),[,,s,u,p,_]=i;e=i.byteLength+u+p+_+p,(s!==r.byteLength||e>=r.byteLength)&&ji("Invalid b3dm header information.")}return Ev(r,e)},n.fD=function(r,e){const i=h0(r);for(const s of i){for(const u of s.meshes)Nw(u);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(jw(s.lights,e)))}return i},n.fE=Oy,n.fF=qr,n.fG=R,n.fH=Gu,n.fI=qo,n.fJ=function(r){Ic(),Uc?.then((e=>{e.keys().then((i=>{for(let s=0;s<i.length-r;s++)e.delete(i[s]).catch((u=>ji(u.message)))})).catch((i=>ji(i.message)))})).catch((e=>ji(e.message)))},n.fa=bu,n.fb=function(r,e,i=!1){if(Jo===qo.deferred||Jo===qo.loading||Jo===qo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");gc=to.resolveURL(r),Jo=qo.deferred,rp=e,Qo(),i||zd()},n.fc=function(r){po=to.resolveURL(r),Yt||(Yt=new Qe(sn(),new td)),Yt.broadcast("setMeshoptUrl",po)},n.fd=ia,n.fe=function(r){Vr=to.resolveURL(r),Yt||(Yt=new Qe(sn(),new td)),Yt.broadcast("setDracoUrl",Vr)},n.ff=mo,n.fg=G,n.fh=function(r){const e=ou();if(!e)return;const i=e.delete(su);r&&i.then((()=>r())).catch(r)},n.fi=be,n.fj=hi,n.fk=bd,n.fl=am,n.fm=B1,n.fn=N1,n.fo=jv,n.fp=Nt,n.fq="hd_road_elevation",n.fr=xr,n.fs=It,n.ft=Rr,n.fu=S0,n.fv=U_,n.fw=function(r,e,i,s,u,p,_,x=1,E,C,k){r.createArrays(),r.tilePixelRatio=pi/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const B=r.layers[0].layout,j=r.layers[0]._unevaluatedLayout._values,U={};U.scaleFactor=x,U.textSizeScaleRange=B.get("text-size-scale-range"),U.iconSizeScaleRange=B.get("icon-size-scale-range");const[$,ee]=U.textSizeScaleRange,[le,oe]=U.iconSizeScaleRange;U.textScaleFactor=te(U.scaleFactor,$,ee),U.iconScaleFactor=te(U.scaleFactor,le,oe);const ye=j["text-size"],xe=j["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:ut,maxZoom:Ut}=r.textSizeData;U.compositeTextSizes=[ye.possiblyEvaluate(new Ka(ut,{worldview:k}),p),ye.possiblyEvaluate(new Ka(Ut,{worldview:k}),p)]}if(r.iconSizeData.kind==="composite"){const{minZoom:ut,maxZoom:Ut}=r.iconSizeData;U.compositeIconSizes=[xe.possiblyEvaluate(new Ka(ut,{worldview:k}),p),xe.possiblyEvaluate(new Ka(Ut,{worldview:k}),p)]}U.layoutTextSize=ye.possiblyEvaluate(new Ka(_+1,{worldview:k}),p),U.layoutIconSize=xe.possiblyEvaluate(new Ka(_+1,{worldview:k}),p),U.textMaxSize=ye.possiblyEvaluate(new Ka(18,{worldview:k}),p);const Ie=B.get("symbol-placement"),$e=B.get("text-rotation-alignment")==="map"&&Ie!=="point",je=B.get("text-size");let Ye=!1;const st=[];for(const ut of r.features){const Ut=B.get("text-font").evaluate(ut,{},p).join(","),_t=je.evaluate(ut,{},p)*U.textScaleFactor,Wt=U.layoutTextSize.evaluate(ut,{},p)*U.textScaleFactor,ni=U.layoutIconSize.evaluate(ut,{},p)*U.iconScaleFactor,ri={horizontal:{},vertical:void 0},wi=ut.text;let Si,gi=[0,0];if(wi){const Dr=wi.toString(),rs=B.get("text-letter-spacing").evaluate(ut,{},p)*ac,Ue=B.get("text-line-height").evaluate(ut,{},p)*ac,Ze=xl(Dr)?rs:0,Xt=B.get("text-anchor").evaluate(ut,{},p),Ti=B.get("text-variable-anchor");if(!Ti){const Sr=B.get("text-radial-offset").evaluate(ut,{},p);if(Sr)gi=wx(Xt,[Sr*ac,M0]);else{const Or=B.get("text-offset").evaluate(ut,{},p);gi=[Or[0]*ac,Or[1]*ac]}}let Yi=$e?"center":B.get("text-justify").evaluate(ut,{},p);const Ki=Ie==="point",Pn=Ki?B.get("text-max-width").evaluate(ut,{},p)*ac:1/0,On=Sr=>{r.allowVerticalPlacement&&vo(Dr)&&(ri.vertical=v0(wi,e,i,u,Ut,Pn,Ue,Xt,Sr,Ze,gi,Ud.vertical,!0,Wt,_t,E))};if(!$e&&Ti){const Sr=Yi==="auto"?Ti.map((Ur=>I0(Ur))):[Yi];let Or=!1;for(let Ur=0;Ur<Sr.length;Ur++){const ua=Sr[Ur];if(!ri.horizontal[ua])if(Or)ri.horizontal[ua]=ri.horizontal[0];else{const Qn=v0(wi,e,i,u,Ut,Pn,Ue,"center",ua,Ze,gi,Ud.horizontal,!1,Wt,_t,E);Qn&&(ri.horizontal[ua]=Qn,Or=Qn.positionedLines.length===1)}}On("left")}else{if(Yi==="auto"&&(Yi=I0(Xt)),Ki||B.get("text-writing-mode").indexOf("horizontal")>=0||!vo(Dr)){const Sr=v0(wi,e,i,u,Ut,Pn,Ue,Xt,Yi,Ze,gi,Ud.horizontal,!1,Wt,_t,E);Sr&&(ri.horizontal[Yi]=Sr)}On(Ki?"left":Yi)}}let yi,Zt,qt,vi,Bi,zi,Dn=!1;const rn=B.get("icon-text-fit").evaluate(ut,{},p);if(ut.icon&&ut.icon.hasPrimary()){const Dr=Dg(ut.icon,r.iconSizeData,j["icon-size"],p,r.zoom,ut,E,U.iconScaleFactor,k);yi=Dr.iconPrimary,qt=Dr.iconSecondary;const rs=yi.toString();if(Zt=s.get(rs),Zt&&(Bi=B.get("icon-offset").evaluate(ut,{},p),zi=B.get("icon-anchor").evaluate(ut,{},p),Si=wy(u.get(rs),qt?u.get(qt.toString()):void 0,Bi,zi),Dn=Zt.sdf,r.sdfIcons===void 0?r.sdfIcons=Zt.sdf:r.sdfIcons!==Zt.sdf&&ji("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Zt.pixelRatio!==r.pixelRatio||B.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),qt){const Ue=qt.toString();vi=s.get(Ue)}}Ye=Ye||!(!ut.icon||!ut.icon.hasSecondary());const cn=My(ri.horizontal)||ri.vertical;r.iconsInText||(r.iconsInText=!!cn&&cn.iconsInText);const wn=Wt*U.textScaleFactor/ac,{defaultShapedIcon:Hr,verticallyShapedIcon:Di}=W2(r,Si,B,ut,p,ri,wn,Bi,rn);rn!=="none"&&Si&&(ox(Si)||lx(Si))&&(Ay(0,Zt,yi,Si,Hr,rn,C,s,u),Ay(0,vi,qt,Si,Hr,rn,C,s,u),Di&&(Ay(0,Zt,yi,Si,Di,rn,C,s,u),Ay(0,vi,qt,Si,Di,rn,C,s,u))),Si=Hr;const{iconBBox:Sn,iconVerticalBBox:mr,textBBox:pa,textVerticalBBox:wa}=G2(r,Si,Di,B,ut,p,ni,Bi,U,u,zi,ri,Wt,gi);st.push({feature:ut,shapedTextOrientations:ri,shapedText:cn,shapedIcon:Si,iconPrimary:yi,iconSecondary:qt,iconOffset:Bi,iconAnchor:zi,verticallyShapedIcon:Di,layoutTextSize:Wt,layoutIconSize:ni,textOffset:gi,isSDFIcon:Dn,iconTextFit:rn,iconCollisionBounds:Sn,iconVerticalCollisionBounds:mr,textCollisionBounds:pa,textVerticalCollisionBounds:wa})}return{featureData:st,sizes:U,hasAnySecondaryIcon:Ye,textAlongLine:$e,symbolPlacement:Ie}},n.fx=_x,n.fy=function(r,e,i,s,u,p,_,x,E,C){r.iconAtlasPositions=C.iconPositions;const{featureData:k,hasAnySecondaryIcon:B,sizes:j,textAlongLine:U,symbolPlacement:$}=e;for(const ee of k){const{shapedIcon:le,verticallyShapedIcon:oe,feature:ye,shapedTextOrientations:xe,shapedText:Ie,layoutTextSize:$e,textOffset:je,isSDFIcon:Ye,iconPrimary:st,iconSecondary:ut,iconTextFit:Ut,iconOffset:_t,iconCollisionBounds:Wt,iconVerticalCollisionBounds:ni,textCollisionBounds:ri}=ee;Sx(le,C.iconPositions,st,ut),Sx(oe,C.iconPositions,st,ut),Z2(xe,C.iconPositions),$2(st,ut,C.iconPositions),(Ie||le)&&X2(r,ye,xe,le,oe,E,j,$e,0,je,Ye,s,u,_,x,B,Ut,_t,U,$,Wt,ni,ri)}i&&r.generateCollisionDebugBuffers(p,r.collisionBoxArray,j.textScaleFactor)},n.fz=vt,n.g=function(r,e){return cu(Object.assign(r,{method:"GET"}),e)},n.h=function(r){return r.indexOf("mapbox:")===0},n.i=function(r){return kr.API_STYLE_REGEX.test(r)&&!Lo(r)},n.j=Xa,n.k=Zl,n.l=function(r){return decodeURIComponent(atob(r).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},n.m=function(r,e){return cu(Object.assign(r,{type:"json"}),e)},n.n=rh,n.o=to,n.p=function(r,e){return cu(Object.assign(r,{method:"POST"}),e)},n.q=wl,n.r=Mc,n.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=function(){return Ri||(Ri=new be("ImageRasterizer")),Ri},n.u=function(){return(function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)})()},n.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},n.w=ji,n.x=q0,n.y=Qh,n.z=zl})),Ce(["./shared"],(function(n){function ke(ct){const te=ct?ct.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function Fe(ct){if(typeof ct=="number"||typeof ct=="boolean"||typeof ct=="string"||ct==null)return JSON.stringify(ct);if(Array.isArray(ct)){let _e="[";for(const Re of ct)_e+=`${Fe(Re)},`;return`${_e}]`}let te="{";for(const _e of Object.keys(ct).sort())te+=`${_e}:${Fe(ct[_e])},`;return`${te}}`}function pt(ct){let te="";for(const _e of n.bx)te+=`/${Fe(ct[_e])}`;return te}class it{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,_e){this._layerConfigs={},this._layers={},this.update(te,[],_e)}update(te,_e,Re){this._options=Re;for(const Xe of te)this._layerConfigs[Xe.id]=Xe,(this._layers[Xe.id]=n.du(Xe,this.scope,null,this._options)).compileFilter(Re),this.keyCache[Xe.id]&&delete this.keyCache[Xe.id];for(const Xe of _e)delete this.keyCache[Xe],delete this._layerConfigs[Xe],delete this._layers[Xe];this.familiesBySource={};const tt=(function(Xe,at){const St={};for(let It=0;It<Xe.length;It++){const ti=Xe[It];let Gt=at&&at[ti.id];Gt||(ti.type==="symbol"?Gt=ti.id:(Gt=pt(ti),ti.type==="line"&&ti.paint&&(function Qi(ji){return typeof ji=="string"&&ji==="line-progress"||(Array.isArray(ji)?ji.some(Qi):!(!ji||typeof ji!="object")&&Object.values(ji).some(Qi))})(ti.paint["line-width"])&&(Gt+=`/${Fe(ti.paint["line-width"])}`))),at&&(at[ti.id]=Gt);let Ji=St[Gt];Ji||(Ji=St[Gt]=[]),Ji.push(ti)}const lt=[];for(const It in St)lt.push(St[It]);return lt})(Object.values(this._layerConfigs),this.keyCache);for(const Xe of tt){const at=Xe.map((Ji=>this._layers[Ji.id])),St=at[0];if(St.visibility==="none")continue;const lt=St.source||"";let It=this.familiesBySource[lt];It||(It=this.familiesBySource[lt]={});const ti=St.sourceLayer||"_geojsonTileLayer";let Gt=It[ti];Gt||(Gt=It[ti]=[]),Gt.push(at)}}}const ht=1*n.fl;class Ci{constructor(te){const _e={},Re=[];for(const St in te){const lt=te[St],It=_e[St]={};for(const ti in lt.glyphs){const Gt=lt.glyphs[+ti];if(!Gt||Gt.bitmap.width===0||Gt.bitmap.height===0)continue;const Ji=Gt.metrics.localGlyph?ht:1,Qi={x:0,y:0,w:Gt.bitmap.width+2*Ji,h:Gt.bitmap.height+2*Ji};Re.push(Qi),It[ti]=Qi}}const{w:tt,h:Xe}=n.G(Re),at=new n.fk({width:tt||1,height:Xe||1});for(const St in te){const lt=te[St];for(const It in lt.glyphs){const ti=lt.glyphs[+It];if(!ti||ti.bitmap.width===0||ti.bitmap.height===0)continue;const Gt=_e[St][It],Ji=ti.metrics.localGlyph?ht:1;n.fk.copy(ti.bitmap,at,{x:0,y:0},{x:Gt.x+Ji,y:Gt.y+Ji},ti.bitmap)}}this.image=at,this.positions=_e}}function Ui(ct,te,_e){ct[te]?_e&&(ct[te].center=_e):ct[te]={floorIds:new Set,center:_e||[0,0],floors:{}}}function Vi(ct,te,_e,Re){for(const tt of te)Ui(ct,tt),ct[tt].floors[_e]=Re,ct[tt].floorIds.add(_e)}function qi(ct){return{id:ct.properties.id.toString(),center:ct.properties.center.toString().split(";").map(Number)}}function on(ct){return{id:ct.properties.id.toString(),isDefault:!!ct.properties.is_default&&ct.properties.is_default,connections:ct.properties.connected_floor_ids?new Set(ct.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:ct.properties.conflicted_floor_ids?new Set(ct.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:ct.properties.building_ids?new Set(ct.properties.building_ids.toString().split(";")):new Set,name:ct.properties.name.toString(),zIndex:ct.properties.z_index}}function Ai(ct,te){return te.every((_e=>ct.properties&&ct.properties[_e]!=null))}function an(ct){return Ai(ct,["type","id","name"])&&ct.properties.type==="building"}function Un(ct){return Ai(ct,["type","id","name","z_index"])&&ct.properties.type==="floor"}n.fj(Ci,"GlyphAtlas");class rr{constructor(te){this.tileID=new n.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.request&&te.request.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=n.aZ(te.tileID.canonical,te.projection),this.projection=te.projection,this.worldview=te.worldview,this.localizableLayerIds=te.localizableLayerIds,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep,this.scaleFactor=te.scaleFactor,this.worldview=te.worldview,this.indoor=te.indoor}parse(te,_e,Re,tt,Xe,at){this.status="parsing",this.data=te,this.collisionBoxArray=new n.b3;const St=new n.fm(Object.keys(te.layers).sort()),lt=new n.fn(this.tileID,this.promoteId);lt.bucketLayerIDs=[];const It={},ti=new n.fo(256,256),Gt={featureIndex:lt,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ti,availableImages:Re,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const pr=this.indoor.indoorState.activeFloorsVisible,$n=(function(Nn,qr,Oa){const ts=(function(na,$r){if(!na)return n.w("No source layers defined in indoor specification"),$r;if(na.size===0)return $r;const _a=na.difference($r);for(const ur of _a)n.w(`Missing source layer required in indoor specification: ${ur}`);return $r.intersection($r)})(qr.sourceLayers,new Set(Object.keys(Nn.layers))),cs=qr.indoorState,Zs=(function(na,$r,_a,ur){const kr=new Set,Xa=new Set,Lo=new Set,eo=new Map,ml={},ih=ns=>{const Go=eo.get(ns)||new Set;for(const va of kr)if((eo.get(va)||new Set).has(ns)||Go.has(va))return!0;return!1};for(const ns of $r){const Go=na.layers[ns];if(Go)for(let va=0;va<Go.length;va++){const Mc=Go.feature(va);if(an(Mc)){const{id:to,center:Vc}=qi(Mc);Ui(ml,to,Vc),kr.add(to)}else if(Un(Mc)){const{id:to,isDefault:Vc,connections:Ah,conflicts:su,buildings:Kh,name:Jh,zIndex:Mu}=on(Mc);Vi(ml,Kh,to,{name:Jh,zIndex:Mu}),eo.set(to,su),(to===ur||Ah.has(ur))&&kr.add(to),Xa.add(to),Vc&&Lo.add(to)}}else n.w(`indoor source layer not found: ${ns}`)}if(_a)for(const ns of _a)Xa.has(ns)&&(ih(ns)||kr.add(ns));for(const ns of Lo)kr.has(ns)||ih(ns)||kr.add(ns);return{buildings:ml,activeFloors:kr}})(Nn,ts,cs.lastActiveFloors,cs.selectedFloorId);return Oa.send("setIndoorData",Zs),Zs})(te,this.indoor,Xe);Gt.activeFloors=pr?$n.activeFloors:void 0}const Ji=[],Qi=_e.familiesBySource[this.source];for(const pr in Qi){const $n=te.layers[pr];if(!$n)continue;let Nn=!1,qr=!1,Oa=!1;for(const $r of Qi[pr])$r[0].type==="symbol"?Nn=!0:qr=!0,$r[0].is3D()&&$r[0].type!=="model"&&(Oa=!0);if(this.extraShadowCaster&&!Oa||this.isSymbolTile===!0&&!Nn||this.isSymbolTile===!1&&!qr)continue;$n.version===1&&n.w(`Vector tile source "${this.source}" layer "${pr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ts=St.encode(pr),cs=[],Zs=this.localizableLayerIds&&this.localizableLayerIds.has(pr);let na=!1;for(let $r=0,_a=0;$r<$n.length;$r++){const ur=$n.feature($r),kr=lt.getId(ur,pr),Xa=ur.properties?ur.properties.worldview:null;if(Zs&&this.worldview&&typeof Xa=="string")if(Xa==="all")ur.properties.$localized=!0;else{if(!Xa.split(",").includes(this.worldview))continue;ur.properties.$localized=!0,ur.properties.worldview=this.worldview}!na&&ur.properties&&ur.properties.hasOwnProperty(n.fp)&&(na=!0),cs.push({feature:ur,id:kr,index:_a,sourceLayerIndex:ts}),_a++}na&&!Gt.elevationFeatures&&te.layers.hasOwnProperty(n.fq)&&(Gt.elevationFeatures=n.fr.parseFrom(te.layers[n.fq],this.canonical));for(const $r of Qi[pr]){const _a=$r[0];if(this.extraShadowCaster&&(!_a.is3D()||_a.type==="model")||this.isSymbolTile!==void 0&&_a.type==="symbol"!==this.isSymbolTile||_a.minzoom&&this.zoom<Math.floor(_a.minzoom)||_a.maxzoom&&this.zoom>=_a.maxzoom||_a.visibility==="none")continue;ln($r,this.zoom,Gt.brightness,Re,this.worldview);const ur=It[_a.id]=_a.createBucket({index:lt.bucketLayerIDs.length,layers:$r,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ts,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:tt,worldview:this.worldview,localizable:Zs});lt.bucketLayerIDs.push($r.map((Xa=>n.B(Xa.id,Xa.scope))));let kr=ur.prepare?ur.prepare():null;kr!=null?(kr=kr.then((()=>ur.populate(cs,Gt,this.tileID.canonical,this.tileTransform))),Ji.push(kr)):ur.populate(cs,Gt,this.tileID.canonical,this.tileTransform)}}const ji=()=>{let pr,$n,Nn,qr,Oa,ts;ti.trim();const cs={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Zs=()=>{if(pr)return this.status="done",at(pr);if(this.extraShadowCaster)this.status="done",at(null,{buckets:Object.values(It).filter(($r=>!$r.isEmpty())),featureIndex:lt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Gt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if($n&&Nn&&qr){const $r=new Ci($n),_a=new Map;for(const[Xa,Lo]of Nn.entries()){const{imagePosition:eo}=n.fu(Xa,Lo,n.fv);_a.set(Xa,eo)}const ur={};for(const Xa in It){const Lo=It[Xa];Lo instanceof n.b4&&(ln(Lo.layers,this.zoom,Gt.brightness,Re,this.worldview),ur[Xa]=n.fw(Lo,$n,$r.positions,Nn,_a,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Oa,this.worldview))}const kr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Xe,Nn,Oa,(()=>{kr.iconsPending=!1,na(ur,$r,kr)})),this.rasterizeIfNeeded(Xe,qr,ts,(()=>{kr.patternsPending=!1,na(ur,$r,kr)}))}},na=($r,_a,ur,kr)=>{if(ur.iconsPending||ur.patternsPending)return;const Xa=new n.fx(Nn,qr,this.lut);for(const Lo in It){const eo=It[Lo];if(Lo in $r)n.fy(eo,$r[Lo],this.showCollisionBoxes,Re,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Nn,Xa);else if(eo.hasPattern&&(eo instanceof n.ba||eo instanceof n.bb||eo instanceof n.ea)){ln(eo.layers,this.zoom,Gt.brightness,Re,this.worldview);const ml=Object.fromEntries(Xa.patternPositions);eo.addFeatures(Gt,this.tileID.canonical,ml,Re,this.tileTransform,this.brightness)}}this.status="done",at(null,{buckets:Object.values(It).filter((Lo=>!Lo.isEmpty())),featureIndex:lt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_a.image,lineAtlas:ti,imageAtlas:Xa,brightness:Gt.brightness})};if(!this.extraShadowCaster){const $r=n.fs(Gt.glyphDependencies,(kr=>Object.keys(kr).map(Number)));Object.keys($r).length?Xe.send("getGlyphs",{uid:this.uid,stacks:$r},((kr,Xa)=>{pr||(pr=kr,$n=Xa,Zs())}),void 0,!1,cs):$n={};const _a=Array.from(Gt.iconDependencies.keys()).map((kr=>n.I.parse(kr)));_a.length?Xe.send("getImages",{images:_a,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((kr,Xa)=>{pr||(pr=kr,Nn=new Map,Oa=this.updateImageMapAndGetImageTaskQueue(Nn,Xa,Gt.iconDependencies),Zs())}),void 0,!1,cs):(Nn=new Map,Oa=new Map);const ur=Array.from(Gt.patternDependencies.keys()).map((kr=>n.I.parse(kr)));ur.length?Xe.send("getImages",{images:ur,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((kr,Xa)=>{pr||(pr=kr,qr=new Map,ts=this.updateImageMapAndGetImageTaskQueue(qr,Xa,Gt.patternDependencies),Zs())}),void 0,!1,cs):(qr=new Map,ts=new Map)}if(Gt.elevationFeatures&&Gt.elevationFeatures.length>0){const $r=[];for(const ur of Object.values(It))if(ur instanceof n.bb){const kr=ur.getUnevaluatedPortalGraph();kr&&$r.push(kr)}const _a=n.ft.evaluate($r);for(const ur of Object.values(It))if(ur instanceof n.bb){const kr=te.layers[St.decode(ur.sourceLayerIndex)];ur.setEvaluatedPortalGraph(_a,kr,this.tileID.canonical,Gt.availableImages,Gt.brightness)}}Zs()};Ji.length>0?Promise.allSettled(Ji).then(ji).catch(at):ji()}updateParameters(te){this.scaleFactor=te.scaleFactor,this.showCollisionBoxes=te.showCollisionBoxes,this.projection=te.projection,this.brightness=te.brightness,this.tileTransform=n.aZ(te.tileID.canonical,te.projection),this.extraShadowCaster=te.extraShadowCaster,this.lut=te.lut,this.worldview=te.worldview,this.indoor=te.indoor}rasterizeIfNeeded(te,_e,Re,tt){Array.from(_e.values()).some((Xe=>Xe.usvg))?this.rasterize(te,_e,Re,tt):tt()}updateImageMapAndGetImageTaskQueue(te,_e,Re){const tt=new Map;for(const Xe of _e.keys()){const at=Re.get(Xe)||[];for(const St of at){const lt=St.toString(),It=_e.get(St.id.toString());It.usvg?tt.has(lt)||(tt.set(lt,St),te.set(lt,Object.assign({},It))):te.set(lt,It)}}return tt}rasterize(te,_e,Re,tt){this.rasterizeTask=te.send("rasterizeImages",{scope:this.scope,tasks:Re},((Xe,at)=>{if(!Xe)for(const[St,lt]of at.entries()){const It=Object.assign(_e.get(St),{data:lt});_e.set(St,It)}tt()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ln(ct,te,_e,Re,tt){const Xe=new n.ac(te,{brightness:_e,worldview:tt});for(const at of ct)at.recalculate(Xe,Re)}class mn extends n.E{constructor(te,_e,Re,tt,Xe,at,St){super(),this.actor=te,this.layerIndex=_e,this.availableImages=Re,this.availableModels=tt,this.loadVectorData=at||n.aL,this.loading={},this.loaded={},this.deduped=new n.aK(te.scheduler),this.isSpriteLoaded=Xe,this.scheduler=te.scheduler,this.brightness=St}loadTile(te,_e){const Re=te.uid,tt=te&&te.request,Xe=tt&&tt.collectResourceTiming,at=this.loading[Re]=new rr(te);at.abort=this.loadVectorData(te,((St,lt)=>{const It=!this.loading[Re];if(delete this.loading[Re],at.cancelRasterize(),It||St||!lt)return at.status="done",It||(this.loaded[Re]=at),_e(St);const ti=lt.rawData,Gt={},Ji=n.aM(lt.responseHeaders);Ji&&Ji.expires&&(Gt.expires=Ji.expires),Ji&&Ji.cacheControl&&(Gt.cacheControl=Ji.cacheControl),at.vectorTile=lt.vectorTile||new n.fz(new n.bt(ti));const Qi=()=>{at.parse(at.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((ji,pr)=>{if(ji||!pr)return _e(ji);const $n={};if(Xe){const Nn=ke(tt);Nn.length>0&&($n.resourceTiming=JSON.parse(JSON.stringify(Nn)))}_e(null,Object.assign({rawTileData:ti.slice(0),responseHeaders:lt.responseHeaders},pr,Gt,$n))}))};this.isSpriteLoaded?Qi():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(Qi,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):Qi()})),this.loaded=this.loaded||{},this.loaded[Re]=at}))}reloadTile(te,_e){const Re=this.loaded,tt=te.uid;if(Re&&Re[tt]){const Xe=Re[tt];Xe.updateParameters(te);const at=(St,lt)=>{const It=Xe.reloadCallback;It&&(delete Xe.reloadCallback,Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,It)),_e(St,lt)};Xe.status==="parsing"?Xe.reloadCallback=at:Xe.status==="done"&&(Xe.vectorTile?Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,at):at())}else _e(null,void 0)}abortTile(te,_e){const Re=te.uid,tt=this.loading[Re];tt&&(tt.abort&&tt.abort(),delete this.loading[Re]),_e()}removeTile(te,_e){const Re=this.loaded,tt=te.uid;Re&&Re[tt]&&delete Re[tt],_e()}}class Pt{loadTile(te,_e){const{uid:Re,encoding:tt,rawImageData:Xe,padding:at}=te,St=ImageBitmap&&Xe instanceof ImageBitmap?this.getImageData(Xe,at):Xe;_e(null,new n.fA(Re,St,tt,at<1))}reloadTile(te,_e){_e(null,null)}abortTile(te,_e){_e()}removeTile(te,_e){_e()}getImageData(te,_e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const Re=this.offscreenCanvasContext.getImageData(-_e,-_e,te.width+2*_e,te.height+2*_e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Re}}n.bs.setPbf(n.bt);class Bt{constructor(te){this._mrt=new n.bs(te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=te.uid,this.tileID=te.tileID,this.source=te.source}parse(te,_e){const Re=this._mrt;this.status="parsing",this._entireBuffer=te;try{Re.parseHeader(te),this._isHeaderLoaded=!0;const tt=[];for(const Xe in Re.layers){const at=Re.getLayer(Xe),St=at.getDataRange(at.getBandList()),lt=Re.createDecodingTask(St),It=te.slice(St.firstByte,St.lastByte+1),ti=n.bs.performDecoding(It,lt).then((Gt=>lt.complete(null,Gt))).catch((Gt=>lt.complete(Gt,null)));tt.push(ti)}Promise.allSettled(tt).then((()=>_e(null,Re))).catch((Xe=>_e(Xe)))}catch(tt){_e(tt)}}}class Ni{constructor(te){this.actor=te,this.loading={},this.loaded={}}loadTile(te,_e){const Re=te.uid,tt=te.request,Xe=this.loading[Re]=new Bt(te),{cancel:at}=n.bu(tt,((St,lt,It)=>{const ti=!this.loading[Re];if(delete this.loading[Re],ti||St||!lt)return Xe.status="done",ti||(this.loaded[Re]=Xe),_e(St);Xe.parse(lt,((Gt,Ji)=>{if(Gt||!Ji)return _e(Gt);_e(null,Ji,It)})),this.loaded[Re]=Xe}));Xe.abort=at}reloadTile(te,_e){_e(null,void 0)}abortTile(te,_e){const Re=te.uid,tt=this.loading[Re];tt&&(tt.abort&&tt.abort(),delete this.loading[Re]),_e()}removeTile(te,_e){const Re=te.uid;this.loaded[Re]&&delete this.loaded[Re],_e()}decodeRasterArray(te,_e){n.bs.performDecoding(te.buffer,te.task).then((Re=>_e(null,Re))).catch((Re=>_e(Re)))}}const tn=n.fB.prototype.toGeoJSON;class Li{constructor(te){this._feature=te,this.extent=n.al,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const _e of this._feature.geometry)te.push([new n.P(_e[0],_e[1])]);return te}{const te=[];for(const _e of this._feature.geometry){const Re=[];for(const tt of _e)Re.push(new n.P(tt[0],tt[1]));te.push(Re)}return te}}toGeoJSON(te,_e,Re){return tn.call(this,te,_e,Re)}}class Wi{constructor(te,_e){this.name=te,this.extent=n.al,this.length=_e.length,this._jsonFeatures=_e}feature(te){return new Li(this._jsonFeatures[te])}}class cr{constructor(te){this.layers={},this.extent=n.al;for(const _e of Object.keys(te))this.layers[_e]=new Wi(_e,te[_e])}}const Pr=64/4096,si=128;class xi{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],_e){for(const Re of te){const tt=Re.id;if(tt==null)continue;let Xe=this.features.get(tt);Xe&&this.updateCache(Xe,_e),Re.geometry?(Xe=zn(Re),this.updateCache(Xe,_e),this.features.set(tt,Xe)):this.features.delete(tt),this.updateCache(Xe,_e)}}updateCache(te,_e){for(const{canonical:Re,uid:tt}of Object.values(_e)){const{z:Xe,x:at,y:St}=Re;Tn(te,Math.pow(2,Xe),at,St)&&delete _e[tt]}}getTile(te,_e,Re){const tt=Math.pow(2,te),Xe=[];for(const at of this.features.values())Tn(at,tt,_e,Re)&&Xe.push(mi(at,tt,_e,Re));return{features:Xe}}getFeatures(){return[...this.features.values()]}}function Tn({minX:ct,minY:te,maxX:_e,maxY:Re},tt,Xe,at){return ct<(Xe+1+Pr)/tt&&te<(at+1+Pr)/tt&&_e>(Xe-Pr)/tt&&Re>(at-Pr)/tt}function zn(ct){const{id:te,geometry:_e,properties:Re}=ct;if(!_e)return;if(_e.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:tt,coordinates:Xe}=_e,at={id:te,type:1,geometry:[],tags:Re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},St=at.geometry;if(tt==="Point")Er(Xe,St,at);else if(tt==="MultiPoint")for(const lt of Xe)Er(lt,St,at);else if(tt==="LineString")at.type=2,Et(Xe,St,at);else if(tt==="MultiLineString")at.type=2,di(Xe,St,at);else if(tt==="Polygon")at.type=3,di(Xe,St,at,!0);else{if(tt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");at.type=3;for(const lt of Xe)di(lt,St,at,!0)}return at}function Er([ct,te],_e,Re){const tt=n.aF(ct);let Xe=n.aJ(te);Xe=Xe<0?0:Xe>1?1:Xe,_e.push(tt,Xe),Re.minX=Math.min(Re.minX,tt),Re.minY=Math.min(Re.minY,Xe),Re.maxX=Math.max(Re.maxX,tt),Re.maxY=Math.max(Re.maxY,Xe)}function Et(ct,te,_e,Re=!1,tt=!1){const Xe=[];for(const at of ct)Er(at,Xe,_e);te.push(Xe),Re&&(function(at,St){let lt=0;for(let It=0,ti=at.length,Gt=ti-2;It<ti;Gt=It,It+=2)lt+=(at[It]-at[Gt])*(at[It+1]+at[Gt+1]);if(lt>0===St)for(let It=0,ti=at.length;It<ti/2;It+=2){const Gt=at[It],Ji=at[It+1];at[It]=at[ti-2-It],at[It+1]=at[ti-1-It],at[ti-2-It]=Gt,at[ti-1-It]=Ji}})(Xe,tt)}function di(ct,te,_e,Re=!1){for(let tt=0;tt<ct.length;tt++)Et(ct[tt],te,_e,Re,tt===0)}function mi(ct,te,_e,Re){const{id:tt,type:Xe,geometry:at,tags:St}=ct,lt=[];if(Xe===1)(function(It,ti,Gt,Ji,Qi){for(let ji=0;ji<It.length;ji+=2){const pr=Math.round(n.al*(It[ji+0]*ti-Gt)),$n=Math.round(n.al*(It[ji+1]*ti-Ji));Qi.push([pr,$n])}})(at,te,_e,Re,lt);else if(Xe===2)for(const It of at)vn(It,te,_e,Re,lt);else if(Xe===3)for(const It of at)tr(It,te,_e,Re,lt);return{id:tt,type:Xe,geometry:lt,tags:St}}function vn(ct,te,_e,Re,tt){const Xe=-si,at=n.al+si;let St;for(let lt=0;lt<ct.length-2;lt+=2){let It=Math.round(n.al*(ct[lt+0]*te-_e)),ti=Math.round(n.al*(ct[lt+1]*te-Re)),Gt=Math.round(n.al*(ct[lt+2]*te-_e)),Ji=Math.round(n.al*(ct[lt+3]*te-Re));const Qi=Gt-It,ji=Ji-ti;It<Xe&&Gt<Xe||(It<Xe?(ti+=Math.round(ji*((Xe-It)/Qi)),It=Xe):Gt<Xe&&(Ji=ti+Math.round(ji*((Xe-It)/Qi)),Gt=Xe),ti<Xe&&Ji<Xe||(ti<Xe?(It+=Math.round(Qi*((Xe-ti)/ji)),ti=Xe):Ji<Xe&&(Gt=It+Math.round(Qi*((Xe-ti)/ji)),Ji=Xe),It>=at&&Gt>=at||(It>=at?(ti+=Math.round(ji*((at-It)/Qi)),It=at):Gt>=at&&(Ji=ti+Math.round(ji*((at-It)/Qi)),Gt=at),ti>=at&&Ji>=at||(ti>=at?(It+=Math.round(Qi*((at-ti)/ji)),ti=at):Ji>=at&&(Gt=It+Math.round(Qi*((at-ti)/ji)),Ji=at),St&&It===St[St.length-1][0]&&ti===St[St.length-1][1]||(St=[[It,ti]],tt.push(St)),St.push([Gt,Ji])))))}}function tr(ct,te,_e,Re,tt){const Xe=(_e-Pr)/te,at=(Re-Pr)/te,St=(_e+1+Pr)/te,lt=(Re+1+Pr)/te;function It(Ji,Qi){let ji=0;return Ji<Xe?ji|=1:Ji>St&&(ji|=2),Qi<at?ji|=4:Qi>lt&&(ji|=8),ji}let ti=[];for(let Ji=1;Ji<=8;Ji*=2){let Qi=ct[ct.length-2],ji=ct[ct.length-1],pr=!(It(Qi,ji)&Ji);for(let $n=0;$n<ct.length;$n+=2){const Nn=ct[$n],qr=ct[$n+1],Oa=!(It(Nn,qr)&Ji);Oa!==pr&&(8&Ji?ti.push(Qi+(Nn-Qi)*(lt-ji)/(qr-ji),lt):4&Ji?ti.push(Qi+(Nn-Qi)*(at-ji)/(qr-ji),at):2&Ji?ti.push(St,ji+(qr-ji)*(St-Qi)/(Nn-Qi)):1&Ji&&ti.push(Xe,ji+(qr-ji)*(Xe-Qi)/(Nn-Qi))),Oa&&ti.push(Nn,qr),Qi=Nn,ji=qr,pr=Oa}if(!(ct=ti).length||Ji===8)break;ti=[]}const Gt=[];for(let Ji=0;Ji<ti.length;Ji+=2)Gt.push([Math.round(n.al*(ti[Ji]*te-_e)),Math.round(n.al*(ti[Ji+1]*te-Re))]);tt.push(Gt)}function vr({name:ct,features:te},_e){_e.writeStringField(1,ct),_e.writeVarintField(5,n.al);const Re=new Map,tt=new Map,Xe={keys:Re,values:tt,feature:null};for(const at of te)Xe.feature=at,_e.writeMessage(2,Gr,Xe);for(const at of Re.keys())_e.writeStringField(3,at);for(const at of tt.keys())_e.writeMessage(4,ma,at)}function Gr(ct,te){const _e=ct.feature;_e.id!==void 0&&Number.isSafeInteger(+_e.id)&&te.writeVarintField(1,+_e.id),_e.tags&&te.writeMessage(2,gr,ct),te.writeVarintField(3,_e.type),te.writeMessage(4,br,_e)}function gr({keys:ct,values:te,feature:_e},Re){for(const tt of Object.keys(_e.tags)){let Xe=_e.tags[tt];if(Xe===null)continue;let at=ct.get(tt);at===void 0&&(at=ct.size,ct.set(tt,at)),Re.writeVarint(at);const St=typeof Xe;St!=="string"&&St!=="boolean"&&St!=="number"&&(Xe=JSON.stringify(Xe));let lt=te.get(Xe);lt===void 0&&(lt=te.size,te.set(Xe,lt)),Re.writeVarint(lt)}}function In(ct,te){return(te<<3)+(7&ct)}function Lr(ct){return ct<<1^ct>>31}function br(ct,te){const{geometry:_e,type:Re}=ct;let tt=0,Xe=0;if(Re===1){te.writeVarint(In(1,_e.length));for(const at of _e){const St=at[0]-tt,lt=at[1]-Xe;te.writeVarint(Lr(St)),te.writeVarint(Lr(lt)),tt+=St,Xe+=lt}}else for(const at of _e){te.writeVarint(In(1,1));const St=at.length-(Re===3?1:0);for(let lt=0;lt<St;lt++){lt===1&&te.writeVarint(In(2,St-1));const It=at[lt][0]-tt,ti=at[lt][1]-Xe;te.writeVarint(Lr(It)),te.writeVarint(Lr(ti)),tt+=It,Xe+=ti}Re===3&&te.writeVarint(In(7,1))}}function ma(ct,te){const _e=typeof ct;_e==="string"?te.writeStringField(1,ct):_e==="boolean"?te.writeBooleanField(7,ct):_e==="number"&&(ct%1!=0?te.writeDoubleField(3,ct):ct<0?te.writeSVarintField(6,ct):te.writeVarintField(5,ct))}const Kr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ct=>ct},oa=Math.fround||(Ma=new Float32Array(1),ct=>(Ma[0]=+ct,Ma[0]));var Ma;const $t=3,Va=5,Ir=6;class Ar{constructor(te){this.options=Object.assign(Object.create(Kr),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:_e,minZoom:Re,maxZoom:tt}=this.options;_e&&console.time("total time");const Xe=`prepare ${te.length} points`;_e&&console.time(Xe),this.points=te;const at=[];for(let lt=0;lt<te.length;lt++){const It=te[lt];if(!It.geometry)continue;const[ti,Gt]=It.geometry.coordinates,Ji=oa(Qs(ti)),Qi=oa(Io(Gt));at.push(Ji,Qi,1/0,lt,-1,1),this.options.reduce&&at.push(0)}let St=this.trees[tt+1]=this._createTree(at);_e&&console.timeEnd(Xe);for(let lt=tt;lt>=Re;lt--){const It=+Date.now();St=this.trees[lt]=this._createTree(this._cluster(St,lt)),_e&&console.log("z%d: %d clusters in %dms",lt,St.numItems,+Date.now()-It)}return _e&&console.timeEnd("total time"),this}getClusters(te,_e){let Re=((te[0]+180)%360+360)%360-180;const tt=Math.max(-90,Math.min(90,te[1]));let Xe=te[2]===180?180:((te[2]+180)%360+360)%360-180;const at=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)Re=-180,Xe=180;else if(Re>Xe){const Gt=this.getClusters([Re,tt,180,at],_e),Ji=this.getClusters([-180,tt,Xe,at],_e);return Gt.concat(Ji)}const St=this.trees[this._limitZoom(_e)],lt=St.range(Qs(Re),Io(at),Qs(Xe),Io(tt)),It=St.data,ti=[];for(const Gt of lt){const Ji=this.stride*Gt;ti.push(It[Ji+Va]>1?la(It,Ji,this.clusterProps):this.points[It[Ji+$t]])}return ti}getChildren(te){const _e=this._getOriginId(te),Re=this._getOriginZoom(te),tt="No cluster with the specified id.",Xe=this.trees[Re];if(!Xe)throw new Error(tt);const at=Xe.data;if(_e*this.stride>=at.length)throw new Error(tt);const St=this.options.radius/(this.options.extent*Math.pow(2,Re-1)),lt=Xe.within(at[_e*this.stride],at[_e*this.stride+1],St),It=[];for(const ti of lt){const Gt=ti*this.stride;at[Gt+4]===te&&It.push(at[Gt+Va]>1?la(at,Gt,this.clusterProps):this.points[at[Gt+$t]])}if(It.length===0)throw new Error(tt);return It}getLeaves(te,_e,Re){const tt=[];return this._appendLeaves(tt,te,_e=_e||10,Re=Re||0,0),tt}getTile(te,_e,Re){const tt=this.trees[this._limitZoom(te)],Xe=Math.pow(2,te),{extent:at,radius:St}=this.options,lt=St/at,It=(Re-lt)/Xe,ti=(Re+1+lt)/Xe,Gt={features:[]};return this._addTileFeatures(tt.range((_e-lt)/Xe,It,(_e+1+lt)/Xe,ti),tt.data,_e,Re,Xe,Gt),_e===0&&this._addTileFeatures(tt.range(1-lt/Xe,It,1,ti),tt.data,Xe,Re,Xe,Gt),_e===Xe-1&&this._addTileFeatures(tt.range(0,It,lt/Xe,ti),tt.data,-1,Re,Xe,Gt),Gt.features.length?Gt:null}getClusterExpansionZoom(te){let _e=this._getOriginZoom(te)-1;for(;_e<=this.options.maxZoom;){const Re=this.getChildren(te);if(_e++,Re.length!==1)break;te=Re[0].properties.cluster_id}return _e}_appendLeaves(te,_e,Re,tt,Xe){const at=this.getChildren(_e);for(const St of at){const lt=St.properties;if(lt&&lt.cluster?Xe+lt.point_count<=tt?Xe+=lt.point_count:Xe=this._appendLeaves(te,lt.cluster_id,Re,tt,Xe):Xe<tt?Xe++:te.push(St),te.length===Re)break}return Xe}_createTree(te){const _e=new n.c4(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Re=0;Re<te.length;Re+=this.stride)_e.add(te[Re],te[Re+1]);return _e.finish(),_e.data=te,_e}_addTileFeatures(te,_e,Re,tt,Xe,at){for(const St of te){const lt=St*this.stride,It=_e[lt+Va]>1;let ti,Gt,Ji;if(It)ti=Po(_e,lt,this.clusterProps),Gt=_e[lt],Ji=_e[lt+1];else{const pr=this.points[_e[lt+$t]];ti=pr.properties;const[$n,Nn]=pr.geometry.coordinates;Gt=Qs($n),Ji=Io(Nn)}const Qi={type:1,geometry:[[Math.round(this.options.extent*(Gt*Xe-Re)),Math.round(this.options.extent*(Ji*Xe-tt))]],tags:ti};let ji;ji=It||this.options.generateId?_e[lt+$t]:this.points[_e[lt+$t]].id,ji!==void 0&&(Qi.id=ji),at.features.push(Qi)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,_e){const{radius:Re,extent:tt,reduce:Xe,minPoints:at}=this.options,St=Re/(tt*Math.pow(2,_e)),lt=te.data,It=[],ti=this.stride;for(let Gt=0;Gt<lt.length;Gt+=ti){if(lt[Gt+2]<=_e)continue;lt[Gt+2]=_e;const Ji=lt[Gt],Qi=lt[Gt+1],ji=te.within(lt[Gt],lt[Gt+1],St),pr=lt[Gt+Va];let $n=pr;for(const Nn of ji){const qr=Nn*ti;lt[qr+2]>_e&&($n+=lt[qr+Va])}if($n>pr&&$n>=at){let Nn,qr=Ji*pr,Oa=Qi*pr,ts=-1;const cs=(Gt/ti<<5)+(_e+1)+this.points.length;for(const Zs of ji){const na=Zs*ti;if(lt[na+2]<=_e)continue;lt[na+2]=_e;const $r=lt[na+Va];qr+=lt[na]*$r,Oa+=lt[na+1]*$r,lt[na+4]=cs,Xe&&(Nn||(Nn=this._map(lt,Gt,!0),ts=this.clusterProps.length,this.clusterProps.push(Nn)),Xe(Nn,this._map(lt,na)))}lt[Gt+4]=cs,It.push(qr/$n,Oa/$n,1/0,cs,-1,$n),Xe&&It.push(ts)}else{for(let Nn=0;Nn<ti;Nn++)It.push(lt[Gt+Nn]);if($n>1)for(const Nn of ji){const qr=Nn*ti;if(!(lt[qr+2]<=_e)){lt[qr+2]=_e;for(let Oa=0;Oa<ti;Oa++)It.push(lt[qr+Oa])}}}}return It}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,_e,Re){if(te[_e+Va]>1){const at=this.clusterProps[te[_e+Ir]];return Re?Object.assign({},at):at}const tt=this.points[te[_e+$t]].properties,Xe=this.options.map(tt);return Re&&Xe===tt?Object.assign({},Xe):Xe}}function la(ct,te,_e){return{type:"Feature",id:ct[te+$t],properties:Po(ct,te,_e),geometry:{type:"Point",coordinates:[(Re=ct[te],360*(Re-.5)),Mr(ct[te+1])]}};var Re}function Po(ct,te,_e){const Re=ct[te+Va],tt=Re>=1e4?`${Math.round(Re/1e3)}k`:Re>=1e3?Math.round(Re/100)/10+"k":Re,Xe=ct[te+Ir],at=Xe===-1?{}:Object.assign({},_e[Xe]);return Object.assign(at,{cluster:!0,cluster_id:ct[te+$t],point_count:Re,point_count_abbreviated:tt})}function Qs(ct){return ct/360+.5}function Io(ct){const te=Math.sin(ct*Math.PI/180),_e=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return _e<0?0:_e>1?1:_e}function Mr(ct){const te=(180-360*ct)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function ws(ct,te,_e,Re){let tt=Re;const Xe=te+(_e-te>>1);let at,St=_e-te;const lt=ct[te],It=ct[te+1],ti=ct[_e],Gt=ct[_e+1];for(let Ji=te+3;Ji<_e;Ji+=3){const Qi=Ds(ct[Ji],ct[Ji+1],lt,It,ti,Gt);if(Qi>tt)at=Ji,tt=Qi;else if(Qi===tt){const ji=Math.abs(Ji-Xe);ji<St&&(at=Ji,St=ji)}}tt>Re&&(at-te>3&&ws(ct,te,at,Re),ct[at+2]=tt,_e-at>3&&ws(ct,at,_e,Re))}function Ds(ct,te,_e,Re,tt,Xe){let at=tt-_e,St=Xe-Re;if(at!==0||St!==0){const lt=((ct-_e)*at+(te-Re)*St)/(at*at+St*St);lt>1?(_e=tt,Re=Xe):lt>0&&(_e+=at*lt,Re+=St*lt)}return at=ct-_e,St=te-Re,at*at+St*St}function Ps(ct,te,_e,Re){const tt={id:ct??null,type:te,geometry:_e,tags:Re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")Qt(tt,_e);else if(te==="Polygon")Qt(tt,_e[0]);else if(te==="MultiLineString")for(const Xe of _e)Qt(tt,Xe);else if(te==="MultiPolygon")for(const Xe of _e)Qt(tt,Xe[0]);return tt}function Qt(ct,te){for(let _e=0;_e<te.length;_e+=3)ct.minX=Math.min(ct.minX,te[_e]),ct.minY=Math.min(ct.minY,te[_e+1]),ct.maxX=Math.max(ct.maxX,te[_e]),ct.maxY=Math.max(ct.maxY,te[_e+1])}function Gn(ct,te,_e,Re){if(!te.geometry)return;const tt=te.geometry.coordinates;if(tt&&tt.length===0)return;const Xe=te.geometry.type,at=Math.pow(_e.tolerance/((1<<_e.maxZoom)*_e.extent),2);let St=[],lt=te.id;if(_e.promoteId?lt=te.properties[_e.promoteId]:_e.generateId&&(lt=Re||0),Xe==="Point")Ta(tt,St);else if(Xe==="MultiPoint")for(const It of tt)Ta(It,St);else if(Xe==="LineString")Ha(tt,St,at,!1);else if(Xe==="MultiLineString"){if(_e.lineMetrics){for(const It of tt)St=[],Ha(It,St,at,!1),ct.push(Ps(lt,"LineString",St,te.properties));return}ms(tt,St,at,!1)}else if(Xe==="Polygon")ms(tt,St,at,!0);else{if(Xe!=="MultiPolygon"){if(Xe==="GeometryCollection"){for(const It of te.geometry.geometries)Gn(ct,{id:lt,geometry:It,properties:te.properties},_e,Re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const It of tt){const ti=[];ms(It,ti,at,!0),St.push(ti)}}ct.push(Ps(lt,Xe,St,te.properties))}function Ta(ct,te){te.push(xn(ct[0]),er(ct[1]),0)}function Ha(ct,te,_e,Re){let tt,Xe,at=0;for(let lt=0;lt<ct.length;lt++){const It=xn(ct[lt][0]),ti=er(ct[lt][1]);te.push(It,ti,0),lt>0&&(at+=Re?(tt*ti-It*Xe)/2:Math.sqrt(Math.pow(It-tt,2)+Math.pow(ti-Xe,2))),tt=It,Xe=ti}const St=te.length-3;te[2]=1,ws(te,0,St,_e),te[St+2]=1,te.size=Math.abs(at),te.start=0,te.end=te.size}function ms(ct,te,_e,Re){for(let tt=0;tt<ct.length;tt++){const Xe=[];Ha(ct[tt],Xe,_e,Re),te.push(Xe)}}function xn(ct){return ct/360+.5}function er(ct){const te=Math.sin(ct*Math.PI/180),_e=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return _e<0?0:_e>1?1:_e}function sr(ct,te,_e,Re,tt,Xe,at,St){if(Re/=te,Xe>=(_e/=te)&&at<Re)return ct;if(at<_e||Xe>=Re)return null;const lt=[];for(const It of ct){const ti=It.geometry;let Gt=It.type;const Ji=tt===0?It.minX:It.minY,Qi=tt===0?It.maxX:It.maxY;if(Ji>=_e&&Qi<Re){lt.push(It);continue}if(Qi<_e||Ji>=Re)continue;let ji=[];if(Gt==="Point"||Gt==="MultiPoint")Xs(ti,ji,_e,Re,tt);else if(Gt==="LineString")fl(ti,ji,_e,Re,tt,!1,St.lineMetrics);else if(Gt==="MultiLineString")pl(ti,ji,_e,Re,tt,!1);else if(Gt==="Polygon")pl(ti,ji,_e,Re,tt,!0);else if(Gt==="MultiPolygon")for(const pr of ti){const $n=[];pl(pr,$n,_e,Re,tt,!0),$n.length&&ji.push($n)}if(ji.length){if(St.lineMetrics&&Gt==="LineString"){for(const pr of ji)lt.push(Ps(It.id,Gt,pr,It.tags));continue}Gt!=="LineString"&&Gt!=="MultiLineString"||(ji.length===1?(Gt="LineString",ji=ji[0]):Gt="MultiLineString"),Gt!=="Point"&&Gt!=="MultiPoint"||(Gt=ji.length===3?"Point":"MultiPoint"),lt.push(Ps(It.id,Gt,ji,It.tags))}}return lt.length?lt:null}function Xs(ct,te,_e,Re,tt){for(let Xe=0;Xe<ct.length;Xe+=3){const at=ct[Xe+tt];at>=_e&&at<=Re&&Uo(te,ct[Xe],ct[Xe+1],ct[Xe+2])}}function fl(ct,te,_e,Re,tt,Xe,at){let St=Jr(ct);const lt=tt===0?oc:cl;let It,ti,Gt=ct.start;for(let $n=0;$n<ct.length-3;$n+=3){const Nn=ct[$n],qr=ct[$n+1],Oa=ct[$n+2],ts=ct[$n+3],cs=ct[$n+4],Zs=tt===0?Nn:qr,na=tt===0?ts:cs;let $r=!1;at&&(It=Math.sqrt(Math.pow(Nn-ts,2)+Math.pow(qr-cs,2))),Zs<_e?na>_e&&(ti=lt(St,Nn,qr,ts,cs,_e),at&&(St.start=Gt+It*ti)):Zs>Re?na<Re&&(ti=lt(St,Nn,qr,ts,cs,Re),at&&(St.start=Gt+It*ti)):Uo(St,Nn,qr,Oa),na<_e&&Zs>=_e&&(ti=lt(St,Nn,qr,ts,cs,_e),$r=!0),na>Re&&Zs<=Re&&(ti=lt(St,Nn,qr,ts,cs,Re),$r=!0),!Xe&&$r&&(at&&(St.end=Gt+It*ti),te.push(St),St=Jr(ct)),at&&(Gt+=It)}let Ji=ct.length-3;const Qi=ct[Ji],ji=ct[Ji+1],pr=tt===0?Qi:ji;pr>=_e&&pr<=Re&&Uo(St,Qi,ji,ct[Ji+2]),Ji=St.length-3,Xe&&Ji>=3&&(St[Ji]!==St[0]||St[Ji+1]!==St[1])&&Uo(St,St[0],St[1],St[2]),St.length&&te.push(St)}function Jr(ct){const te=[];return te.size=ct.size,te.start=ct.start,te.end=ct.end,te}function pl(ct,te,_e,Re,tt,Xe){for(const at of ct)fl(at,te,_e,Re,tt,Xe,!1)}function Uo(ct,te,_e,Re){ct.push(te,_e,Re)}function oc(ct,te,_e,Re,tt,Xe){const at=(Xe-te)/(Re-te);return Uo(ct,Xe,_e+(tt-_e)*at,1),at}function cl(ct,te,_e,Re,tt,Xe){const at=(Xe-_e)/(tt-_e);return Uo(ct,te+(Re-te)*at,Xe,1),at}function ft(ct,te){const _e=[];for(let Re=0;Re<ct.length;Re++){const tt=ct[Re],Xe=tt.type;let at;if(Xe==="Point"||Xe==="MultiPoint"||Xe==="LineString")at=ze(tt.geometry,te);else if(Xe==="MultiLineString"||Xe==="Polygon"){at=[];for(const St of tt.geometry)at.push(ze(St,te))}else if(Xe==="MultiPolygon"){at=[];for(const St of tt.geometry){const lt=[];for(const It of St)lt.push(ze(It,te));at.push(lt)}}_e.push(Ps(tt.id,Xe,at,tt.tags))}return _e}function ze(ct,te){const _e=[];_e.size=ct.size,ct.start!==void 0&&(_e.start=ct.start,_e.end=ct.end);for(let Re=0;Re<ct.length;Re+=3)_e.push(ct[Re]+te,ct[Re+1],ct[Re+2]);return _e}function Pe(ct,te){if(ct.transformed)return ct;const _e=1<<ct.z,Re=ct.x,tt=ct.y;for(const Xe of ct.features){const at=Xe.geometry,St=Xe.type;if(Xe.geometry=[],St===1)for(let lt=0;lt<at.length;lt+=2)Xe.geometry.push(et(at[lt],at[lt+1],te,_e,Re,tt));else for(let lt=0;lt<at.length;lt++){const It=[];for(let ti=0;ti<at[lt].length;ti+=2)It.push(et(at[lt][ti],at[lt][ti+1],te,_e,Re,tt));Xe.geometry.push(It)}}return ct.transformed=!0,ct}function et(ct,te,_e,Re,tt,Xe){return[Math.round(_e*(ct*Re-tt)),Math.round(_e*(te*Re-Xe))]}function gt(ct,te,_e,Re,tt){const Xe=te===tt.maxZoom?0:tt.tolerance/((1<<te)*tt.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:ct.length,source:null,x:_e,y:Re,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const St of ct)jt(at,St,Xe,tt);return at}function jt(ct,te,_e,Re){const tt=te.geometry,Xe=te.type,at=[];if(ct.minX=Math.min(ct.minX,te.minX),ct.minY=Math.min(ct.minY,te.minY),ct.maxX=Math.max(ct.maxX,te.maxX),ct.maxY=Math.max(ct.maxY,te.maxY),Xe==="Point"||Xe==="MultiPoint")for(let St=0;St<tt.length;St+=3)at.push(tt[St],tt[St+1]),ct.numPoints++,ct.numSimplified++;else if(Xe==="LineString")Ge(at,tt,ct,_e,!1,!1);else if(Xe==="MultiLineString"||Xe==="Polygon")for(let St=0;St<tt.length;St++)Ge(at,tt[St],ct,_e,Xe==="Polygon",St===0);else if(Xe==="MultiPolygon")for(let St=0;St<tt.length;St++){const lt=tt[St];for(let It=0;It<lt.length;It++)Ge(at,lt[It],ct,_e,!0,It===0)}if(at.length){let St=te.tags||null;if(Xe==="LineString"&&Re.lineMetrics){St={};for(const It in te.tags)St[It]=te.tags[It];St.mapbox_clip_start=tt.start/tt.size,St.mapbox_clip_end=tt.end/tt.size}const lt={geometry:at,type:Xe==="Polygon"||Xe==="MultiPolygon"?3:Xe==="LineString"||Xe==="MultiLineString"?2:1,tags:St};te.id!==null&&(lt.id=te.id),ct.features.push(lt)}}function Ge(ct,te,_e,Re,tt,Xe){const at=Re*Re;if(Re>0&&te.size<(tt?at:Re))return void(_e.numPoints+=te.length/3);const St=[];for(let lt=0;lt<te.length;lt+=3)(Re===0||te[lt+2]>at)&&(_e.numSimplified++,St.push(te[lt],te[lt+1])),_e.numPoints++;tt&&(function(lt,It){let ti=0;for(let Gt=0,Ji=lt.length,Qi=Ji-2;Gt<Ji;Qi=Gt,Gt+=2)ti+=(lt[Gt]-lt[Qi])*(lt[Gt+1]+lt[Qi+1]);if(ti>0===It)for(let Gt=0,Ji=lt.length;Gt<Ji/2;Gt+=2){const Qi=lt[Gt],ji=lt[Gt+1];lt[Gt]=lt[Ji-2-Gt],lt[Gt+1]=lt[Ji-1-Gt],lt[Ji-2-Gt]=Qi,lt[Ji-1-Gt]=ji}})(St,Xe),ct.push(St)}const ei={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class kt{constructor(te,_e){const Re=(_e=this.options=(function(Xe,at){for(const St in at)Xe[St]=at[St];return Xe})(Object.create(ei),_e)).debug;if(Re&&console.time("preprocess data"),_e.maxZoom<0||_e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(_e.promoteId&&_e.generateId)throw new Error("promoteId and generateId cannot be used together.");let tt=(function(Xe,at){const St=[];if(Xe.type==="FeatureCollection")for(let lt=0;lt<Xe.features.length;lt++)Gn(St,Xe.features[lt],at,lt);else Gn(St,Xe.type==="Feature"?Xe:{geometry:Xe},at);return St})(te,_e);this.tiles={},this.tileCoords=[],Re&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",_e.indexMaxZoom,_e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),tt=(function(Xe,at){const St=at.buffer/at.extent;let lt=Xe;const It=sr(Xe,1,-1-St,St,0,-1,2,at),ti=sr(Xe,1,1-St,2+St,0,-1,2,at);return(It||ti)&&(lt=sr(Xe,1,-St,1+St,0,-1,2,at)||[],It&&(lt=ft(It,1).concat(lt)),ti&&(lt=lt.concat(ft(ti,-1)))),lt})(tt,_e),tt.length&&this.splitTile(tt,0,0,0),Re&&(tt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,_e,Re,tt,Xe,at,St){const lt=[te,_e,Re,tt],It=this.options,ti=It.debug;for(;lt.length;){tt=lt.pop(),Re=lt.pop(),_e=lt.pop(),te=lt.pop();const Gt=1<<_e,Ji=Pi(_e,Re,tt);let Qi=this.tiles[Ji];if(!Qi&&(ti>1&&console.time("creation"),Qi=this.tiles[Ji]=gt(te,_e,Re,tt,It),this.tileCoords.push({z:_e,x:Re,y:tt}),ti)){ti>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",_e,Re,tt,Qi.numFeatures,Qi.numPoints,Qi.numSimplified),console.timeEnd("creation"));const $r=`z${_e}`;this.stats[$r]=(this.stats[$r]||0)+1,this.total++}if(Qi.source=te,Xe==null){if(_e===It.indexMaxZoom||Qi.numPoints<=It.indexMaxPoints)continue}else{if(_e===It.maxZoom||_e===Xe)continue;if(Xe!=null){const $r=Xe-_e;if(Re!==at>>$r||tt!==St>>$r)continue}}if(Qi.source=null,te.length===0)continue;ti>1&&console.time("clipping");const ji=.5*It.buffer/It.extent,pr=.5-ji,$n=.5+ji,Nn=1+ji;let qr=null,Oa=null,ts=null,cs=null,Zs=sr(te,Gt,Re-ji,Re+$n,0,Qi.minX,Qi.maxX,It),na=sr(te,Gt,Re+pr,Re+Nn,0,Qi.minX,Qi.maxX,It);te=null,Zs&&(qr=sr(Zs,Gt,tt-ji,tt+$n,1,Qi.minY,Qi.maxY,It),Oa=sr(Zs,Gt,tt+pr,tt+Nn,1,Qi.minY,Qi.maxY,It),Zs=null),na&&(ts=sr(na,Gt,tt-ji,tt+$n,1,Qi.minY,Qi.maxY,It),cs=sr(na,Gt,tt+pr,tt+Nn,1,Qi.minY,Qi.maxY,It),na=null),ti>1&&console.timeEnd("clipping"),lt.push(qr||[],_e+1,2*Re,2*tt),lt.push(Oa||[],_e+1,2*Re,2*tt+1),lt.push(ts||[],_e+1,2*Re+1,2*tt),lt.push(cs||[],_e+1,2*Re+1,2*tt+1)}}getTile(te,_e,Re){te=+te,_e=+_e,Re=+Re;const tt=this.options,{extent:Xe,debug:at}=tt;if(te<0||te>24)return null;const St=1<<te,lt=Pi(te,_e=_e+St&St-1,Re);if(this.tiles[lt])return Pe(this.tiles[lt],Xe);at>1&&console.log("drilling down to z%d-%d-%d",te,_e,Re);let It,ti=te,Gt=_e,Ji=Re;for(;!It&&ti>0;)ti--,Gt>>=1,Ji>>=1,It=this.tiles[Pi(ti,Gt,Ji)];return It&&It.source?(at>1&&(console.log("found parent tile z%d-%d-%d",ti,Gt,Ji),console.time("drilling down")),this.splitTile(It.source,ti,Gt,Ji,te,_e,Re),at>1&&console.timeEnd("drilling down"),this.tiles[lt]?Pe(this.tiles[lt],Xe):null):null}}function Pi(ct,te,_e){return 32*((1<<ct)*_e+te)+ct}function fi(ct,te){const _e=ct.tileID.canonical;if(!this._geoJSONIndex)return void te(null,null);const Re=this._geoJSONIndex.getTile(_e.z,_e.x,_e.y);if(!Re)return void te(null,null);const tt=It=>It.tags&&"3d_elevation_id"in It.tags&&"source"in It.tags&&It.tags.source==="elevation",Xe=Re.features.filter((It=>tt(It)));let at={_geojsonTileLayer:Re.features};Xe.length>0&&(at={_geojsonTileLayer:Re.features.filter((It=>!tt(It))),hd_road_elevation:Xe});const St=new cr(at),lt=(function(It){const ti=new n.bt;for(const Gt of Object.keys(It))ti.writeMessage(3,vr,{name:Gt,features:It[Gt]});return ti.finish()})(at).buffer;te(null,{vectorTile:St,rawData:lt})}class ui extends mn{constructor(te,_e,Re,tt,Xe,at,St){super(te,_e,Re,tt,Xe,fi,St),at&&(this.loadGeoJSON=at),this._dynamicIndex=new xi}loadData(te,_e){const Re=te&&te.request,tt=Re&&Re.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(te,((Xe,at)=>{if(Xe||!at)return _e(Xe);if(typeof at!="object")return _e(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const lt=n.U(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(lt.result==="error")throw new Error(lt.value.map((It=>`${It.key}: ${It.message}`)).join(", "));at.features=at.features.filter((It=>lt.value.evaluate({zoom:0},It)))}te.dynamic?(at.type==="Feature"&&(at={type:"FeatureCollection",features:[at]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(at.features,this.loaded),te.cluster&&(at.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new Ar((function({superclusterOptions:lt,clusterProperties:It}){if(!It||!lt)return lt;const ti={},Gt={},Ji={accumulated:null,zoom:0},Qi={properties:null},ji=Object.keys(It);for(const pr of ji){const[$n,Nn]=It[pr],qr=n.U(Nn),Oa=n.U(typeof $n=="string"?[$n,["accumulated"],["get",pr]]:$n);ti[pr]=qr.value,Gt[pr]=Oa.value}return lt.map=pr=>{Qi.properties=pr;const $n={};for(const Nn of ji)$n[Nn]=ti[Nn].evaluate(Ji,Qi);return $n},lt.reduce=(pr,$n)=>{Qi.properties=$n;for(const Nn of ji)Ji.accumulated=pr[Nn],pr[Nn]=Gt[Nn].evaluate(Ji,Qi)},lt})(te)).load(at.features):te.dynamic?this._dynamicIndex:(function(lt,It){return new kt(lt,It)})(at,te.geojsonVtOptions)}catch(lt){return _e(lt)}const St={};if(tt){const lt=ke(Re);lt&&(St.resourceTiming={},St.resourceTiming[te.source]=JSON.parse(JSON.stringify(lt)))}_e(null,St)}}))}reloadTile(te,_e){const Re=this.loaded;return Re&&Re[te.uid]?te.partial?_e(null,void 0):super.reloadTile(te,_e):this.loadTile(te,_e)}loadGeoJSON(te,_e){if(te.request)n.m(te.request,_e);else{if(typeof te.data!="string")return _e(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return _e(null,JSON.parse(te.data))}catch{return _e(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(te,_e){try{_e(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(Re){_e(Re)}}getClusterChildren(te,_e){try{_e(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(Re){_e(Re)}}getClusterLeaves(te,_e){try{_e(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(Re){_e(Re)}}}class kn{constructor(te,_e,Re){this.tileID=new n.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=_e,this.worldview=Re}parse(te,_e,Re,tt){this.status="parsing";const Xe=new n.aQ(Re.tileID.overscaledZ,Re.tileID.wrap,Re.tileID.canonical.z,Re.tileID.canonical.x,Re.tileID.canonical.y),at=[],St=_e.familiesBySource[Re.source],lt=new n.fn(Xe,Re.promoteId);lt.bucketLayerIDs=[],lt.is3DTile=!0,n.fC(te).then((It=>{if(!It)return tt(new Error("Could not parse tile"));const ti=It.json.extensionsUsed&&It.json.extensionsUsed.includes("MAPBOX_mesh_features")||It.json.asset.extras&&It.json.asset.extras.MAPBOX_mesh_features,Gt=It.json.extensionsUsed&&It.json.extensionsUsed.includes("EXT_meshopt_compression"),Ji=new n.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Qi in St)for(const ji of St[Qi]){const pr=ji[0];lt.bucketLayerIDs.push(ji.map((qr=>n.B(qr.id,qr.scope)))),pr.recalculate(Ji,[]);const $n=n.fD(It,1/n.d7(Re.tileID.canonical)),Nn=new n.fE(ji,$n,Xe,ti,Gt,this.brightness,lt,this.worldview);ti||(Nn.needsUpload=!0),at.push(Nn),Nn.evaluate(pr)}this.status="done",tt(null,{buckets:at,featureIndex:lt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((It=>tt(new Error(It.message))))}}class fr{constructor(te,_e,Re,tt,Xe,at,St,lt){this.actor=te,this.layerIndex=_e,this.availableImages=Re,this.availableModels=tt,this.brightness=St,this.loading={},this.loaded={},this.worldview=lt}loadTile(te,_e){const Re=te.uid,tt=this.loading[Re]=new kn(te,this.brightness,this.worldview);n.bu(te.request,((Xe,at)=>{const St=!this.loading[Re];return delete this.loading[Re],St||Xe?(tt.status="done",St||(this.loaded[Re]=tt),_e(Xe)):at&&at.byteLength!==0?void tt.parse(at,this.layerIndex,te,((lt,It)=>{tt.status="done",this.loaded=this.loaded||{},this.loaded[Re]=tt,lt||!It?_e(lt):_e(null,It)})):(tt.status="done",this.loaded[Re]=tt,_e())}))}reloadTile(te,_e){const Re=this.loaded,tt=te.uid;if(Re&&Re[tt]){const Xe=Re[tt];Xe.projection=te.projection,Xe.brightness=te.brightness;const at=(St,lt)=>{Xe.reloadCallback&&(delete Xe.reloadCallback,this.loadTile(te,_e)),_e(St,lt)};Xe.status==="parsing"?Xe.reloadCallback=at:Xe.status==="done"&&this.loadTile(te,_e)}}abortTile(te,_e){const Re=te.uid;this.loading[Re]&&delete this.loading[Re],_e()}removeTile(te,_e){const Re=this.loaded,tt=te.uid;Re&&Re[tt]&&delete Re[tt],_e()}}class Cr{constructor(te){this.self=te,this.actor=new n.fG(te,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new n.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=n.cm({name:"mercator"}),this.workerSourceTypes={vector:mn,geojson:ui,"raster-dem":Pt,"raster-array":Ni,"batched-model":fr},this.workerSources={},this.self.registerWorkerSource=(_e,Re)=>{if(this.workerSourceTypes[_e])throw new Error(`Worker source with name "${_e}" already registered.`);this.workerSourceTypes[_e]=Re},this.self.registerRTLTextPlugin=_e=>{if(n.fH.isParsed())throw new Error("RTL text plugin already registered.");n.fH.setState({pluginStatus:n.fI.parsed,pluginURL:n.fH.getPluginURL()}),n.fH.applyArabicShaping=_e.applyArabicShaping,n.fH.processBidirectionalText=_e.processBidirectionalText,n.fH.processStyledBidirectionalText=_e.processStyledBidirectionalText;for(const Re of this.rtlPluginParsingListeners)Re(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(te,_e,Re){delete this.layerIndexes[te],delete this.availableImages[te],delete this.availableModels[te],delete this.workerSources[te],Re()}checkIfReady(te,_e,Re){Re()}setReferrer(te,_e){this.referrer=_e}spriteLoaded(te,_e){this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={});const{scope:Re,isLoaded:tt}=_e;if(this.isSpriteLoaded[te][Re]=tt,this.workerSources[te]&&this.workerSources[te][Re])for(const Xe in this.workerSources[te][Re]){const at=this.workerSources[te][Re][Xe];for(const St in at){const lt=at[St];lt instanceof mn&&(lt.isSpriteLoaded=tt,lt.fire(new n.z("isSpriteLoaded")))}}}setImages(te,_e,Re){this.availableImages[te]||(this.availableImages[te]={});const{scope:tt,images:Xe}=_e;if(this.availableImages[te][tt]=Xe,this.workerSources[te]&&this.workerSources[te][tt]){for(const at in this.workerSources[te][tt]){const St=this.workerSources[te][tt][at];for(const lt in St)St[lt].availableImages=Xe}Re()}else Re()}setModels(te,{scope:_e,models:Re},tt){if(this.availableModels[te]||(this.availableModels[te]={}),this.availableModels[te][_e]=Re,this.workerSources[te]&&this.workerSources[te][_e]){for(const Xe in this.workerSources[te][_e]){const at=this.workerSources[te][_e][Xe];for(const St in at)at[St].availableModels=Re}tt()}else tt()}setProjection(te,_e){this.projections[te]=n.cm(_e)}setBrightness(te,_e,Re){this.brightness=_e,Re()}setWorldview(te,_e,Re){this.worldview=_e,Re()}setLayers(te,_e,Re){this.getLayerIndex(te,_e.scope).replace(_e.layers,_e.options),Re()}updateLayers(te,_e,Re){this.getLayerIndex(te,_e.scope).update(_e.layers,_e.removedIds,_e.options),Re()}loadTile(te,_e,Re){_e.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,_e.type,_e.source,_e.scope).loadTile(_e,Re)}decodeRasterArray(te,_e,Re){this.getWorkerSource(te,_e.type,_e.source,_e.scope).decodeRasterArray(_e,Re)}reloadTile(te,_e,Re){_e.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,_e.type,_e.source,_e.scope).reloadTile(_e,Re)}abortTile(te,_e,Re){this.getWorkerSource(te,_e.type,_e.source,_e.scope).abortTile(_e,Re)}removeTile(te,_e,Re){this.getWorkerSource(te,_e.type,_e.source,_e.scope).removeTile(_e,Re)}removeSource(te,_e,Re){if(!(this.workerSources[te]&&this.workerSources[te][_e.scope]&&this.workerSources[te][_e.scope][_e.type]&&this.workerSources[te][_e.scope][_e.type][_e.source]))return;const tt=this.workerSources[te][_e.scope][_e.type][_e.source];delete this.workerSources[te][_e.scope][_e.type][_e.source],tt.removeSource!==void 0?tt.removeSource(_e,Re):Re()}loadWorkerSource(te,_e,Re){try{this.self.importScripts(_e.url),Re()}catch(tt){Re(tt)}}syncRTLPluginState(te,_e,Re){if(n.fH.isParsed())Re(null,!0);else if(n.fH.isParsing())this.rtlPluginParsingListeners.push(Re);else try{n.fH.setState(_e);const tt=n.fH.getPluginURL();!n.fH.isLoaded()||n.fH.isParsed()||n.fH.isParsing()||tt==null||(n.fH.setState({pluginStatus:n.fI.parsing,pluginURL:n.fH.getPluginURL()}),this.self.importScripts(tt),n.fH.isParsed()?Re(null,!0):this.rtlPluginParsingListeners.push(Re))}catch(tt){Re(tt)}}setDracoUrl(te,_e){this.dracoUrl=_e}getAvailableImages(te,_e){this.availableImages[te]||(this.availableImages[te]={});let Re=this.availableImages[te][_e];return Re||(Re=[]),Re}getAvailableModels(te,_e){this.availableModels[te]||(this.availableModels[te]={});let Re=this.availableModels[te][_e];return Re||(Re={}),Re}getLayerIndex(te,_e){this.layerIndexes[te]||(this.layerIndexes[te]={});let Re=this.layerIndexes[te][_e];return Re||(Re=this.layerIndexes[te][_e]=new it,Re.scope=_e),Re}getWorkerSource(te,_e,Re,tt){const Xe=this.workerSources;return Xe[te]||(Xe[te]={}),Xe[te][tt]||(Xe[te][tt]={}),Xe[te][tt][_e]||(Xe[te][tt][_e]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),Xe[te][tt][_e][Re]||(Xe[te][tt][_e][Re]=new this.workerSourceTypes[_e]({send:(at,St,lt,It,ti,Gt)=>this.actor.send(at,St,lt,te,ti,Gt),scheduler:this.actor.scheduler},this.getLayerIndex(te,tt),this.getAvailableImages(te,tt),this.getAvailableModels(te,tt),this.isSpriteLoaded[te][tt],void 0,this.brightness,this.worldview)),Xe[te][tt][_e][Re]}rasterizeImagesWorker(te,_e,Re){const tt=new Map;for(const[Xe,{image:at,imageVariant:St}]of _e.tasks.entries()){const lt=this.imageRasterizer.rasterize(St,at,_e.scope,te);tt.set(Xe,lt)}Re(void 0,tt)}removeRasterizedImages(te,_e,Re){this.imageRasterizer.removeImagesFromCacheByIds(_e.imageIds,_e.scope,te),Re()}enforceCacheSizeLimit(te,_e){n.fJ(_e)}getWorkerPerformanceMetrics(te,_e,Re){Re(void 0,void 0)}}return n.fF(self)&&(self.worker=new Cr(self)),Cr})),Ce(["./shared"],(function(n){var ke="3.17.0";const Fe={create:"create",load:"load",fullLoad:"fullLoad"},pt={mark(h){performance.mark(h)},measure(h,t,a){performance.measure(h,t,a)}};function it(h){const t=h.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var ht,Ci={},Ui=(function(){if(ht)return Ci;function h(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,S,I=new Blob([""],{type:"text/javascript"}),D=URL.createObjectURL(I);try{S=new Worker(D),b=!0}catch{b=!1}return S&&S.terminate(),URL.revokeObjectURL(D),b})()?(function(){var b=document.createElement("canvas");b.width=b.height=1;var S=b.getContext("2d");if(!S)return!1;var I=S.getImageData(0,0,1,1);return I&&I.width===b.width})()?(a[y=d&&d.failIfMajorPerformanceCaveat]===void 0&&(a[y]=(function(b){var S,I=(function(D){var N=document.createElement("canvas"),V=Object.create(h.webGLContextAttributes);return V.failIfMajorPerformanceCaveat=D,N.getContext("webgl2",V)})(b);if(!I)return!1;try{S=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!S||I.isContextLost())&&(I.shaderSource(S,"void main() {}"),I.compileShader(S),I.getShaderParameter(S,I.COMPILE_STATUS)===!0)})(y)),a[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}ht=1,Ci.supported=h,Ci.notSupportedReason=t;var a={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Ci})();function Vi(h,t,a){const d=document.createElement(h);return t!=null&&(d.className=t),a&&a.appendChild(d),d}function qi(h,t,a){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const y of Object.keys(t))d.setAttributeNS(null,y,String(t[y]));return a&&a.appendChild(d),d}const on=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ai=on&&on.userSelect!==void 0?"userSelect":"WebkitUserSelect";let an;function Un(){on&&Ai&&(an=on[Ai],on[Ai]="none")}function rr(){on&&Ai&&(on[Ai]=an)}function ln(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",ln,!0)}function mn(){window.addEventListener("click",ln,!0),window.setTimeout((()=>{window.removeEventListener("click",ln,!0)}),0)}function Pt(h,t){const a=h.getBoundingClientRect();return tn(h,a,t)}function Bt(h,t){const a=h.getBoundingClientRect(),d=[];for(let y=0;y<t.length;y++)d.push(tn(h,a,t[y]));return d}function Ni(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function tn(h,t,a){const d=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new n.P((a.clientX-t.left)*d,(a.clientY-t.top)*d)}const Li="01",Wi="NO_ACCESS_TOKEN";class cr{constructor(t,a,d){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=(function(){let a="";for(let d=0;d<10;d++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Li,a].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!n.h(t))return t;const d=si(t);return d.params.push(`sdk=js-${ke}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!n.h(t))return t;const d=si(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeModelURL(t,a){if(!n.h(t))return t;const d=si(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeSourceURL(t,a,d,y){if(!n.h(t))return t;const b=si(t);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),d&&b.params.push(`language=${d}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||a)}normalizeIconsetURL(t,a){const d=si(t);return n.h(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||a)):xi(d)}normalizeSpriteURL(t,a,d,y){const b=si(t);return n.h(t)?(b.path=`/styles/v1${b.path}/sprite${a}${d}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${a}${d}`,xi(b))}normalizeTileURL(t,a,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.h(t))return t;const y=si(t);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||d&&y.authority!=="raster"&&d===512?"@2x":""}${n.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${n.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${n.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${n.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||(function(S){for(const I of S){const D=I.match(/^access_token=(.*)$/);if(D)return D[1]}return null})(y.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(t,a){const d=si(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${d.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let b=d.params;return a&&(b=b.filter((S=>!S.match(/^access_token=/)))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(t,a){const d=!!a&&n.h(a),y=[];for(const b of t.tiles||[])n.j(b)?y.push(this.canonicalizeTileURL(b,d)):y.push(b);return y}_makeAPIURL(t,a){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=si(n.e.API_URL);if(t.protocol=y.protocol,t.authority=y.authority,t.protocol==="http"){const b=t.params.indexOf("secure");b>=0&&t.params.splice(b,1)}if(y.path!=="/"&&(t.path=`${y.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return xi(t);if(a=a||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter((b=>b.indexOf("access_token")===-1)),t.params.push(`access_token=${a||""}`),xi(t)}}const Pr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function si(h){const t=h.match(Pr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function xi(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const Tn="mapbox.eventData";function zn(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.l(t[1]))}catch{return null}}class Er{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=zn(n.e.ACCESS_TOKEN);let d="";return d=a&&a.u?n.f(a.u):n.e.ACCESS_TOKEN||"",t?`${Tn}.${t}:${d}`:`${Tn}:${d}`}fetchEventData(){const t=n.s("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(t)try{const b=localStorage.getItem(a);b&&(this.eventData=JSON.parse(b));const S=localStorage.getItem(d);S&&(this.anonId=S);const I=localStorage.getItem(y);I&&(this.anonIdTimestamp=Number(I));const D=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<D)&&this.refreshUUID()}catch{n.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=n.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=n.s("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),b=this.anonId,S=this.anonIdTimestamp;if(t&&b)try{localStorage.setItem(d,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData)),S&&localStorage.setItem(y,S.toString())}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,d,y){if(!n.e.EVENTS_URL)return;const b=si(n.e.EVENTS_URL);b.params.push(`access_token=${y||n.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(t).toISOString()},I=a?Object.assign(S,a):S,D={url:xi(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=n.p(D,(N=>{this.pendingRequest=null,d(N),this.saveEventData(),this.processRequests(y)}))}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}class Et extends Er{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!n.e.EVENTS_URL||!t&&!n.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),n.v(this.anonId)||this.refreshUUID();const a=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:a},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:d}=this.queue.shift();this.postEvent(a,d,(()=>{}),t)}}const di=new class extends Er{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some((a=>n.h(a)||n.j(a)))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=zn(n.e.ACCESS_TOKEN),a=t?t.u:n.e.ACCESS_TOKEN;let d=a!==this.eventData.tokenU;n.v(this.anonId)||(this.refreshUUID(),d=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),S=new Date(y),I=(y-this.eventData.lastSuccess)/864e5;d=d||I>=1||I<-1||b.getDate()!==S.getDate()}else d=!0;d?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ke,skuId:Li,"enabled.telemetry":!1,userId:this.anonId},(b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=a)}),h):this.processRequests()}},mi=di.postTurnstileEvent.bind(di),vn=new class extends Er{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,a,d){this.skuToken=t,this.errorCb=d,n.e.EVENTS_URL&&(a||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error(Wi)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),n.v(this.anonId)||this.refreshUUID(),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ke,skuId:Li,skuToken:this.skuToken,userId:this.anonId},(d=>{d?this.errorCb(d):t&&(this.success[t]=!0)}),h))}remove(){this.errorCb=null}},tr=vn.postMapLoadEvent.bind(vn),vr=new class extends Er{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=n.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:a,style:d,importedStyles:y}=t;if(!n.e.EVENTS_URL||!h&&!n.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(a),S={mapInstanceId:b,eventId:this.getEventId(b),style:d};y.length&&(S.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:S},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,(()=>{}),h)}},Gr=vr.postStyleLoadEvent.bind(vr),gr=new Et({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),In=gr.postMetricsEvent.bind(gr),Lr=new Et({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),br=Lr.postMetricsEvent.bind(Lr),ma=new class extends Er{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){n.e.EVENTS_URL&&(h||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:a}=this.queue.shift(),d=(function(y){const b=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),I=(function(Q){const ae={};if(Q){for(const ie in Q)if(ie!=="other")for(const ge of Q[ie]){const me=`${ie}ResolveRangeMin`,Se=`${ie}ResolveRangeMax`,De=`${ie}RequestCount`,Ee=`${ie}RequestCachedCount`;ae[me]=Math.min(ae[me]||1/0,ge.startTime),ae[Se]=Math.max(ae[Se]||-1/0,ge.responseEnd);const We=Ve=>{ae[Ve]===void 0&&(ae[Ve]=0),++ae[Ve]};ge.transferSize!==void 0&&ge.transferSize===0&&We(Ee),We(De)}}return ae})((function(Q,ae){const ie={};if(Q)for(const ge of Q){const me=ae(ge);ie[me]===void 0&&(ie[me]=[]),ie[me].push(ge)}return ie})(b,it)),D=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,V=N?N.effectiveType:void 0,K={counters:[],metadata:[],attributes:[]},X=(Q,ae,ie)=>{ie!=null&&Q.push({name:ae,value:ie.toString()})};for(const Q in I)X(K.counters,Q,I[Q]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(X(K.counters,"interactionRangeMin",y.interactionRange[0]),X(K.counters,"interactionRangeMax",y.interactionRange[1])),S)for(const Q of Object.values(Fe)){const ae=S.find((ie=>ie.name===Q));ae&&X(K.counters,Q,ae.startTime)}return X(K.counters,"visibilityHidden",y.visibilityHidden),X(K.attributes,"style",(function(Q){if(Q)for(const ae of Q){const ie=ae.name.split("?")[0];if(n.i(ie)){const ge=ie.split("/").slice(-2);if(ge.length===2)return`mapbox://styles/${ge[0]}/${ge[1]}`}}})(b)),X(K.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),X(K.attributes,"fogEnabled",y.fogEnabled?"true":"false"),X(K.attributes,"projection",y.projection),X(K.attributes,"zoom",y.zoom),X(K.metadata,"devicePixelRatio",D),X(K.metadata,"connectionEffectiveType",V),X(K.metadata,"navigatorUserAgent",navigator.userAgent),X(K.metadata,"screenWidth",window.screen.width),X(K.metadata,"screenHeight",window.screen.height),X(K.metadata,"windowWidth",window.innerWidth),X(K.metadata,"windowHeight",window.innerHeight),X(K.metadata,"mapWidth",y.width/D),X(K.metadata,"mapHeight",y.height/D),X(K.metadata,"webglRenderer",y.renderer),X(K.metadata,"webglVendor",y.vendor),X(K.metadata,"sdkVersion",ke),X(K.metadata,"sdkIdentifier","mapbox-gl-js"),K})(a);for(const y of d.metadata);for(const y of d.counters);for(const y of d.attributes);this.postEvent(t,d,(()=>{}),h)}},Kr=ma.postPerformanceEvent.bind(ma),oa=new class extends Er{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,a,d){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const y=si(n.e.API_URL+n.e.SESSION_PATH);y.params.push(`sku=${t||""}`),y.params.push(`access_token=${d||n.e.ACCESS_TOKEN||""}`);const b={url:xi(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(b,(S=>{this.pendingRequest=null,a(S),this.saveEventData(),this.processRequests(d)}))}getSessionAPI(h,t,a,d){this.skuToken=t,this.errorCb=d,n.e.SESSION_PATH&&n.e.API_URL&&(a||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error(Wi)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,(d=>{d?this.errorCb(d):t&&(this.success[t]=!0)}),h)}remove(){this.errorCb=null}},Ma=oa.getSessionAPI.bind(oa),$t=new Set;function Va(h,t){t?$t.add(h):$t.delete(h)}class Ir{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){const a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(n.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ar(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class la extends n.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&n.r()&&(this.imageRasterizerDispatcher=new n.D(n.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new n.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const a=this.atlasTexture.get(t);a&&(a.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(t.id,t)}removeImageProvider(t,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(t)}getPendingImageProviders(){const t=[];for(const a of this.imageProviders.values())for(const d of a.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,a){if(this.loaded.get(a)!==t&&(this.loaded.set(a,t),t)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,a,y);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images.get(a).get(t.toString())}addImage(t,a,d){this._validate(t,d)&&this.images.get(a).set(t.toString(),d)}_validate(t,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,a){if(!t)return!0;let d=0;for(const y of t){if(y[0]<d||y[1]<y[0]||a<y[1])return!1;d=y[1]}return!0}_validateContent(t,a){return t?t.length!==4||!a.usvg&&(t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,a,d){const y=this.images.get(a).get(t.toString());d.version=y.version+1,this.images.get(a).set(t.toString(),d),this.updatedImages.get(a).add(t),this.removeFromImageRasterizerCache(t,a)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,a){this.spriteFormat!=="raster"&&(n.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([t],a))}removeImage(t,a){const d=this.images.get(a),y=d.get(t.toString());d.delete(t.toString()),this.patterns.get(a).delete(t.toString()),this.removeFromImageRasterizerCache(t,a),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((a=>n.I.from(a)))}getImages(t,a,d){const y=[],b=[],S=this.imageProviders.get(a);for(const V of t){if(!V.iconsetId){y.push(V);continue}const K=S.get(V.iconsetId);K&&(this.getImage(V,a)?b.push(V):K.addPendingRequest(V))}if(y.length===0)return void this._notify(b,a,d);let I=!0;const D=!!this.loaded.get(a),N=this.images.get(a);if(!D)for(const V of y)N.has(V.toString())||(I=!1);D||I?this._notify(y,a,d):this.requestors.push({ids:y,scope:a,callback:d})}rasterizeImages(t,a){const d=new Map,{tasks:y,scope:b}=t;for(const[S,I]of y.entries()){const D=this.getImage(I.id,b);D&&d.set(S,{image:D,imageVariant:I})}this._rasterizeImages(b,d,a)}_rasterizeImages(t,a,d){if(n.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:t},d);else{const y=new Map;for(const[b,{image:S,imageVariant:I}]of a.entries())y.set(b,this.imageRasterizer.rasterize(I,S,t,0));d(void 0,y)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,a,d){const y=this.images.get(a),b=new Map;for(const S of t){if(!y.get(S.toString())){if(S.iconsetId)continue;this.fire(new n.z("styleimagemissing",{id:S.name}))}const I=y.get(S.toString());if(!I){n.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const D={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(D,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),b.set(n.I.toString(S),D)}d(null,b)}getPixelSize(t){const{width:a,height:d}=this.atlasImage.get(t);return{width:a,height:d}}getPattern(t,a,d){const y=t.toString(),b=this.patterns.get(a),S=b.get(y),I=this.getImage(t,a);if(!I)return null;if(S){if(S.position.version===I.version)return S.position;S.position.version=I.version}else{if(I.usvg&&!I.data){const D=this.getPatternInFlightId(y,a);if(this.patternsInFlight.has(D))return null;this.patternsInFlight.add(D);const N=new n.A(t).scaleSelf(n.o.devicePixelRatio),V=new Map([[N.toString(),{image:I,imageVariant:N}]]);return this._rasterizeImages(a,V,((K,X)=>this.storePatternImage(N,a,I,d,X))),null}this.storePattern(t,a,I)}return this._updatePatternAtlas(a,d),b.get(y).position}getPatternInFlightId(t,a){return n.B(t,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,a,d,y,b){const S=t.toString(),I=b?b.get(S):void 0;I&&(d.data=I,this.storePattern(t.id,a,d),this._updatePatternAtlas(a,y),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),a)))}storePattern(t,a,d){const y={w:d.data.width+2*n.C,h:d.data.height+2*n.C,x:0,y:0},b=new n.F(y,d,n.C);this.patterns.get(a).set(t.toString(),{bin:y,position:b})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,a){const d=t.gl;let y=this.atlasTexture.get(a);y?this.dirty&&(y.update(this.atlasImage.get(a)),this.dirty=!1):(y=new n.T(t,this.atlasImage.get(a),d.RGBA8),this.atlasTexture.set(a,y)),y.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){const d=this.patterns.get(t),y=Array.from(d.values()).map((({bin:N})=>N)),{w:b,h:S}=n.G(y),I=this.atlasImage.get(t);I.resize({width:b||1,height:S||1});const D=this.images.get(t);for(const[N,{bin:V,position:K}]of d.entries()){let X=K.padding;const Q=V.x+X,ae=V.y+X,ie=D.get(N).data,ge=ie.width,me=ie.height;X=X>1?X-1:X,n.q.copy(ie,I,{x:0,y:0},{x:Q,y:ae},{width:ge,height:me},a),n.q.copy(ie,I,{x:0,y:me-X},{x:Q,y:ae-X},{width:ge,height:X},a),n.q.copy(ie,I,{x:0,y:0},{x:Q,y:ae+me},{width:ge,height:X},a),n.q.copy(ie,I,{x:ge-X,y:0},{x:Q-X,y:ae},{width:X,height:me},a),n.q.copy(ie,I,{x:0,y:0},{x:Q+ge,y:ae},{width:X,height:me},a),n.q.copy(ie,I,{x:ge-X,y:me-X},{x:Q-X,y:ae-X},{width:X,height:X},a),n.q.copy(ie,I,{x:0,y:me-X},{x:Q+ge,y:ae-X},{width:X,height:X},a),n.q.copy(ie,I,{x:0,y:0},{x:Q+ge,y:ae+me},{width:X,height:X},a),n.q.copy(ie,I,{x:ge-X,y:0},{x:Q-X,y:ae+me},{width:X,height:X},a)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,a){const d=this.images.get(a);for(const y of t){if(this.callbackDispatchedThisFrame.get(a).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(y.toString());const b=d.get(y.toString());Ar(b)&&this.updateImage(y,a,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Po(h){const t=h.value,a=h.valueSpec,d=h.style,y=h.styleSpec,b=h.key,S=h.arrayElementValidator||ft;if(!Array.isArray(t))return[new n.V(b,t,`array expected, ${n.K(t)} found`)];if(a.length&&t.length!==a.length)return[new n.V(b,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new n.V(b,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let I={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};y.$version<7&&(I.function=a.function),n.H(a.value)&&(I=a.value);let D=[];for(let N=0;N<t.length;N++)D=D.concat(S({array:t,arrayIndex:N,value:t[N],valueSpec:I,style:d,styleSpec:y,key:`${b}[${N}]`},!0));return D}function Qs(h){const t=h.key,a=h.value,d=h.valueSpec;if(!n.L(a))return[new n.V(t,a,`number expected, ${n.K(a)} found`)];if(a!=a)return[new n.V(t,a,"number expected, NaN found")];if("minimum"in d){let y=d.minimum;if(Array.isArray(d.minimum)&&(y=d.minimum[h.arrayIndex]),a<y)return[new n.V(t,a,`${a} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(Array.isArray(d.maximum)&&(y=d.maximum[h.arrayIndex]),a>y)return[new n.V(t,a,`${a} is greater than the maximum value ${y}`)]}return[]}function Io(h){const t=h.key,a=h.value;if(!n.H(a))return[new n.V(t,a,`object expected, ${n.K(a)} found`)];const d=h.valueSpec,y=n.J(a.type);let b,S,I,D={};const N=y!=="categorical"&&a.property===void 0,V=!N,K=(function(ie){const ge=ie.stops;return Array.isArray(ge)&&Array.isArray(ge[0])&&n.H(ge[0][0])})(a),X=ze({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(ie){if(y==="identity")return[new n.V(ie.key,ie.value,'identity function may not have a "stops" property')];let ge=[];const me=ie.value;return ge=ge.concat(Po({key:ie.key,value:me,valueSpec:ie.valueSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:Q})),Array.isArray(me)&&me.length===0&&ge.push(new n.V(ie.key,me,"array must have at least one stop")),ge},default:function(ie){return ft({key:ie.key,value:ie.value,valueSpec:d,style:ie.style,styleSpec:ie.styleSpec})}}});return y==="identity"&&N&&X.push(new n.V(h.key,h.value,'missing required property "property"')),y==="identity"||a.stops||X.push(new n.V(h.key,h.value,'missing required property "stops"')),y==="exponential"&&d.expression&&!n.M(d)&&X.push(new n.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(V&&!n.N(d)?X.push(new n.V(h.key,h.value,"property functions not supported")):N&&!n.O(d)&&X.push(new n.V(h.key,h.value,"zoom functions not supported"))),y!=="categorical"&&!K||a.property!==void 0||X.push(new n.V(h.key,h.value,'"property" property is required')),X;function Q(ie){let ge=[];const me=ie.value,Se=ie.key;if(!Array.isArray(me))return[new n.V(Se,me,`array expected, ${n.K(me)} found`)];if(me.length!==2)return[new n.V(Se,me,`array length 2 expected, length ${me.length} found`)];if(K){if(!n.H(me[0]))return[new n.V(Se,me,`object expected, ${n.K(me[0])} found`)];const De=me[0];if(De.zoom===void 0)return[new n.V(Se,me,"object stop key must have zoom")];if(De.value===void 0)return[new n.V(Se,me,"object stop key must have value")];const Ee=n.J(De.zoom);if(typeof Ee!="number")return[new n.V(Se,De.zoom,"stop zoom values must be numbers")];if(I&&I>Ee)return[new n.V(Se,De.zoom,"stop zoom values must appear in ascending order")];Ee!==I&&(I=Ee,S=void 0,D={}),ge=ge.concat(ze({key:`${Se}[0]`,value:me[0],valueSpec:{zoom:{}},style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:Qs,value:ae}}))}else ge=ge.concat(ae({key:`${Se}[0]`,value:me[0],style:ie.style,styleSpec:ie.styleSpec},me));return n.Q(n.S(me[1]))?ge.concat([new n.V(`${Se}[1]`,me[1],"expressions are not allowed in function stops.")]):ge.concat(ft({key:`${Se}[1]`,value:me[1],valueSpec:d,style:ie.style,styleSpec:ie.styleSpec}))}function ae(ie,ge){const me=n.K(ie.value),Se=n.J(ie.value),De=ie.value!==null?ie.value:ge;if(b){if(me!==b)return[new n.V(ie.key,De,`${me} stop domain type must match previous stop domain type ${b}`)]}else b=me;if(me!=="number"&&me!=="string"&&me!=="boolean"&&typeof Se!="number"&&typeof Se!="string"&&typeof Se!="boolean")return[new n.V(ie.key,De,"stop domain value must be a number, string, or boolean")];if(me!=="number"&&y!=="categorical"){let Ee=`number expected, ${me} found`;return n.N(d)&&y===void 0&&(Ee+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(ie.key,De,Ee)]}return y!=="categorical"||me!=="number"||typeof Se=="number"&&isFinite(Se)&&Math.floor(Se)===Se?y!=="categorical"&&me==="number"&&typeof Se=="number"&&typeof S=="number"&&S!==void 0&&Se<S?[new n.V(ie.key,De,"stop domain values must appear in ascending order")]:(S=Se,y==="categorical"&&Se in D?[new n.V(ie.key,De,"stop domain values must be unique")]:(D[Se]=!0,[])):[new n.V(ie.key,De,`integer expected, found ${String(Se)}`)]}}function Mr(h){const t=(h.expressionContext==="property"?n.W:n.U)(n.S(h.value),h.valueSpec);if(t.result==="error")return t.value.map((d=>new n.V(`${h.key}${d.key}`,h.value,d.message)));const a=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!a.outputDefined())return[new n.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!n.Z(a))return[new n.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return ws(a,h);if(h.expressionContext==="appearance")return Ds(a,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!n.X(a,["zoom","feature-state"]))return[new n.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!n.Y(a))return[new n.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ws(h,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)a.delete(y);if(a.size===0)return[];const d=[];return h instanceof n._&&a.has(h.name)?[new n.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild((y=>{d.push(...ws(y,t))})),d)}function Ds(h,t){const a=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)a.add(y);if(a.size===0)return[];const d=[];return h instanceof n._&&!a.has(h.name)?[new n.V(t.key,t.value,`["${h.name}"] is not an allowed parameter`)]:(h.eachChild((y=>{d.push(...Ds(y,t))})),d)}function Ps(h){const t=h.key,a=h.value,d=h.valueSpec,y=[];return Array.isArray(d.values)?d.values.indexOf(n.J(a))===-1&&y.push(new n.V(t,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(n.J(a))===-1&&y.push(new n.V(t,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),y}function Qt(h){return n.a2(n.S(h.value))?Mr(Object.assign({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Gn(h)}function Gn(h){const t=h.value,a=h.key;if(!Array.isArray(t))return[new n.V(a,t,`array expected, ${n.K(t)} found`)];if(t.length<1)return[new n.V(a,t,"filter array must have at least 1 element")];const d=h.styleSpec;let y=Ps({key:`${a}[0]`,value:t[0],valueSpec:d.filter_operator});const b=()=>{t.length>=2&&(n.a0(t[1])||y.push(new n.V(`${a}[1]`,t[1],`string expected, ${n.K(t[1])} found`)));for(let S=2;S<t.length;S++)n.J(t[1])==="$type"?y=y.concat(Ps({key:`${a}[${S}]`,value:t[S],valueSpec:d.geometry_type})):n.a0(t[S])||n.L(t[S])||n.$(t[S])||y.push(new n.V(`${a}[${S}]`,t[S],`string, number, or boolean expected, ${n.K(t[S])} found.`))};switch(n.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.J(t[1])==="$type"&&y.push(new n.V(a,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&y.push(new n.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`)),b();break;case"==":case"!=":t.length!==3&&y.push(new n.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`)),b();break;case"in":case"!in":b();break;case"any":case"all":case"none":for(let S=1;S<t.length;S++)y=y.concat(Gn({key:`${a}[${S}]`,value:t[S],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":t.length!==2?y.push(new n.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):n.a0(t[1])||y.push(new n.V(`${a}[1]`,t[1],`string expected, ${n.K(t[1])} found`))}return y}function Ta(h,t){const a=h.key,d=h.style,y=h.layer,b=h.styleSpec,S=h.value,I=h.objectKey,D=b[`${t}_${h.layerType}`];if(!D)return[];const N=I.match(/^(.*)-use-theme$/);if(N&&D[N[1]])return n.Q(n.S(S))?[].concat(ft({key:a,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:I})):ft({key:a,value:S,valueSpec:{type:"string"},style:d,styleSpec:b});const V=I.match(/^(.*)-transition$/);if(t==="paint"&&V&&D[V[1]]&&D[V[1]].transition)return ft({key:a,value:S,valueSpec:b.transition,style:d,styleSpec:b});const K=h.valueSpec||D[I];if(!K)return[new n.a3(a,S,`unknown property "${I}"`)];let X;if(n.a0(S)&&n.N(K)&&!K.tokens&&(X=/^{([^}]+)}$/.exec(S))){const ae=`\`{ "type": "identity", "property": ${X?JSON.stringify(X[1]):'"_"'} }\``;return[new n.V(a,S,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${ae}.`)]}const Q=[];if(h.layerType==="symbol")I!=="text-field"||!d||d.glyphs||d.imports||Q.push(new n.V(a,S,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&n.a4(n.S(S))&&n.J(S.type)==="identity"&&Q.push(new n.V(a,S,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&n.N(K)&&(n.a5(K)||n.O(K))){const ae=n.W(n.S(S),K).value,ie="expression"in ae&&ae.expression||"_styleExpression"in ae&&ae._styleExpression&&ae._styleExpression.expression;ie&&!n.X(ie,["measure-light"])&&(I==="model-emissive-strength"&&n.Y(ie)&&n.Z(ie)||Q.push(new n.V(a,S,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Q.concat(ft({key:h.key,value:S,valueSpec:K,style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:I}))}function Ha(h){return Ta(h,"paint")}function ms(h){return Ta(h,"layout")}function xn(h){let t=[];const a=h.value,d=h.key,y=h.style,b=h.styleSpec;if(!n.H(a))return[new n.V(d,a,"object expected")];a.type||a.ref||t.push(new n.V(d,a,'either "type" or "ref" is required'));let S=n.J(a.type);const I=n.J(a.ref);if(a.id){const D=n.J(a.id);for(let N=0;N<h.arrayIndex;N++){const V=y.layers[N];n.J(V.id)===D&&t.push(new n.V(d,a.id,`duplicate layer id "${D}", previously used at line ${V.id.__line__}`))}}if("ref"in a){let D;["type","source","source-layer","filter","layout"].forEach((N=>{N in a&&t.push(new n.V(d,a[N],`"${N}" is prohibited for ref layers`))})),y.layers.forEach((N=>{n.J(N.id)===I&&(D=N)})),D?D.ref?t.push(new n.V(d,a.ref,"ref cannot reference another ref layer")):S=n.J(D.type):typeof I=="string"&&t.push(new n.V(d,a.ref,`ref layer "${I}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(a.source)if(n.a0(a.source)){const D=y.sources&&y.sources[a.source],N=D&&n.J(D.type);D?N==="vector"&&S==="raster"?t.push(new n.V(d,a.source,`layer "${a.id}" requires a raster source`)):N==="raster"&&S!=="raster"?t.push(new n.V(d,a.source,`layer "${a.id}" requires a vector source`)):N!=="vector"||a["source-layer"]?N==="raster-dem"&&S!=="hillshade"?t.push(new n.V(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&N==="geojson"&&!D.lineMetrics?t.push(new n.V(d,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&N!=="raster-array"&&t.push(new n.V(d,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new n.V(d,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(d,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new n.V(d,a.source,`source "${a.source}" not found`))}else t.push(new n.V(`${d}.source`,a.source,'"source" must be a string'));else t.push(new n.V(d,a,'missing required property "source"'));return t=t.concat(ze({key:d,value:a,valueSpec:b.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ft({key:`${d}.type`,value:a.type,valueSpec:b.layer.type,style:h.style,styleSpec:h.styleSpec,object:a,objectKey:"type"}),filter:D=>Qt(Object.assign({layerType:S},D)),layout:D=>ze({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":N=>ms(Object.assign({layerType:S},N))}}),paint:D=>ze({layer:a,key:D.key,value:D.value,valueSpec:{},style:D.style,styleSpec:D.styleSpec,objectElementValidators:{"*":N=>Ha(Object.assign({layerType:S,layer:a},N))}}),appearances(D){const N=Po({key:D.key,value:D.value,valueSpec:D.valueSpec,style:D.style,styleSpec:D.styleSpec,arrayElementValidator:X=>(function(Q){const{key:ae,layer:ie,layerType:ge}=Q,me=n.J(Q.value),Se=n.J(me.name),De=n.J(me.condition),Ee=ze({key:ae,value:me,valueSpec:Q.styleSpec.appearance,style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{condition:We=>(function(Ve){const He=[];return He.push(...Mr({key:Ve.key,value:Ve.object.condition,valueSpec:n.a6.appearance.condition,expressionContext:"appearance"})),He})(Object.assign({layer:ie,layerType:ge},We)),properties:We=>(function(Ve){const He=[],{styleSpec:Ne,layer:Oe,layerType:nt}=Ve,mt=Ne[`paint_${nt}`],dt=Ne[`layout_${nt}`],At=Ve.object[Ve.objectKey];for(const Ct in At){const Dt=Ct in mt?"paint":Ct in dt?"layout":void 0;if(!Dt){He.push(new n.V(Ve.key,Ct,`unknown property "${Ct}" for layer type "${nt}"`));continue}const Kt=Object.assign({},Ve,{key:`${Ve.key}.${Ct}`,object:At,objectKey:Ct,layer:Oe,layerType:nt,value:At[Ct],valueSpec:Dt==="paint"?mt[Ct]:dt[Ct]});He.push(...Ta(Kt,Dt))}return He})(Object.assign({layer:ie,layerType:ge},We))}});return Se!=="hidden"&&De===void 0&&Ee.push(new n.V(Q.key,"name",'Appearance with name different than "hidden" must have a condition')),Ee})(Object.assign({layerType:S,layer:a},X))}),V=Array.isArray(D.value)?D.value:[],K=new Set;return V.forEach(((X,Q)=>{const ae=n.J(X.name);if(ae)if(K.has(ae)){const ie=n.J(a.id);N.push(new n.V(D.key,ae,`Duplicated appearance name "${ae}" for layer "${ie}"`))}else K.add(ae)})),N}}})),t}function er({key:h,value:t}){return n.a0(t)?[]:[new n.V(h,t,`string expected, ${n.K(t)} found`)]}const sr={promoteId:function h({key:t,value:a}){if(n.a0(a))return er({key:t,value:a});if(Array.isArray(a)){const y=[],b=n.S(a),S=n.U(b);return S.result==="error"&&S.value.forEach((I=>{y.push(new n.V(`${t}${I.key}`,null,`${I.message}`))})),n.X(S.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new n.V(`${t}`,null,"promoteId expression should be only feature dependent")),y}if(!n.H(a))return[new n.V(t,a,`string, expression or object expected, "${n.K(a)}" found`)];const d=[];for(const y in a)d.push(...h({key:`${t}.${y}`,value:a[y]}));return d}};function Xs(h){const t=h.value,a=h.key,d=h.styleSpec,y=h.style;if(!n.H(t))return[new n.V(a,t,`object expected, ${n.K(t)} found`)];if(!("type"in t))return[new n.V(a,t,'"type" is required')];const b=n.J(t.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in t||"tiles"in t||S.push(new n.a3(a,t,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(ze({key:a,value:t,valueSpec:d[`source_${b.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:sr})),S;case"geojson":if(S=ze({key:a,value:t,valueSpec:d.source_geojson,style:y,styleSpec:d,objectElementValidators:sr}),"cluster"in t&&"clusterProperties"in t){if(!n.H(t.clusterProperties))return[new n.V(`${a}.clusterProperties`,t,`object expected, ${n.K(t)} found`)];for(const I in t.clusterProperties){const D=t.clusterProperties[I];if(!Array.isArray(D))return[new n.V(`${a}.clusterProperties.${I}`,D,"array expected")];const[N,V]=D,K=typeof N=="string"?[N,["accumulated"],["get",I]]:N;S.push(...Mr({key:`${a}.${I}.map`,value:V,expressionContext:"cluster-map"})),S.push(...Mr({key:`${a}.${I}.reduce`,value:K,expressionContext:"cluster-reduce"}))}}return S;case"video":return ze({key:a,value:t,valueSpec:d.source_video,style:y,styleSpec:d});case"image":return ze({key:a,value:t,valueSpec:d.source_image,style:y,styleSpec:d});case"canvas":return[new n.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ps({key:`${a}.type`,value:t.type,valueSpec:{values:fl(d)}})}}function fl(h){return h.source.reduce(((t,a)=>{const d=h[a];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values||{}))),t}),[])}function Jr(h){const t=h.value,a=h.styleSpec,d=a.light,y=h.style;if(t===void 0)return[];if(!n.H(t))return[new n.V("light",t,`object expected, ${n.K(t)} found`)];let b=[];for(const S in t){const I=S.match(/^(.*)-transition$/),D=S.match(/^(.*)-use-theme$/);b=b.concat(D&&d[D[1]]?ft({key:S,value:t[S],valueSpec:{type:"string"},style:y,styleSpec:a}):I&&d[I[1]]&&d[I[1]].transition?ft({key:S,value:t[S],valueSpec:a.transition,style:y,styleSpec:a}):d[S]?ft({key:S,value:t[S],valueSpec:d[S],style:y,styleSpec:a}):[new n.V(S,t[S],`unknown property "${S}"`)])}return b}function pl(h){const t=h.value;if(!t)return[];const a=h.key;if(!n.H(t))return[new n.V(a,t,`object expected, ${n.K(t)} found`)];let d=[];const y=h.styleSpec,b=y["light-3d"],S=h.style,I=h.style.lights;for(const V of["type","id"])if(!(V in t))return d=d.concat([new n.V(a,t,`missing property "${V}"`)]),d;if(!n.a0(t.type))return d=d.concat([new n.V(`${a}.type`,t.type,"string expected")]),d;if(I)for(let V=0;V<h.arrayIndex;V++){const K=n.J(t.type),X=I[V];n.J(X.type)===K&&d.push(new n.V(a,t.id,`duplicate light type "${t.type}", previously defined at line ${X.id.__line__}`))}const D=`properties_light_${t.type}`;if(!(D in y))return d=d.concat([new n.V(`${a}.type`,t,`Invalid light type ${t.type}`)]),d;const N=y[D];for(const V in t)if(V==="properties"){const K=t[V];if(!n.H(K))return d=d.concat([new n.V("properties",K,`object expected, ${n.K(K)} found`)]),d;for(const X in K){const Q=X.match(/^(.*)-transition$/),ae=X.match(/^(.*)-use-theme$/);d=d.concat(ae&&N[ae[1]]?ft({key:V,value:K[X],valueSpec:{type:"string"},style:S,styleSpec:y}):Q&&N[Q[1]]&&N[Q[1]].transition?ft({key:V,value:t[V],valueSpec:y.transition,style:S,styleSpec:y}):N[X]?ft({key:X,value:K[X],valueSpec:N[X],style:S,styleSpec:y}):[new n.a3(h.key,K[X],`unknown property "${X}"`)])}}else d=d.concat(b[V]?ft({key:V,value:t[V],valueSpec:b[V],style:S,styleSpec:y}):[new n.a3(V,t[V],`unknown property "${V}"`)]);return d}function Uo(h){const t=h.value,a=h.key,d=h.style,y=h.styleSpec,b=y.terrain;if(t==null)return[];if(!n.H(t))return[new n.V("terrain",t,`object expected, ${n.K(t)} found`)];let S=[];for(const I in t){const D=I.match(/^(.*)-transition$/),N=I.match(/^(.*)-use-theme$/);S=S.concat(N&&b[N[1]]?ft({key:I,value:t[I],valueSpec:{type:"string"},style:d,styleSpec:y}):D&&b[D[1]]&&b[D[1]].transition?ft({key:I,value:t[I],valueSpec:y.transition,style:d,styleSpec:y}):b[I]?ft({key:I,value:t[I],valueSpec:b[I],style:d,styleSpec:y}):[new n.a3(I,t[I],`unknown property "${I}"`)])}if(t.source)if(n.a0(t.source)){const I=d.sources&&d.sources[t.source],D=I&&n.J(I.type);I?D!=="raster-dem"&&S.push(new n.V(`${a}.source`,t.source,`terrain cannot be used with a source of type ${D}, it only be used with a "raster-dem" source type`)):S.push(new n.V(`${a}.source`,t.source,`source "${t.source}" not found`))}else S.push(new n.V(`${a}.source`,t.source,"source must be a string"));else S.push(new n.V(a,t,'terrain is missing required property "source"'));return S}function oc(h){const t=h.value,a=h.style,d=h.styleSpec,y=d.fog;if(t===void 0)return[];if(!n.H(t))return[new n.V("fog",t,`object expected, ${n.K(t)} found`)];let b=[];for(const S in t){const I=S.match(/^(.*)-transition$/),D=S.match(/^(.*)-use-theme$/);b=b.concat(D&&y[D[1]]?ft({key:S,value:t[S],valueSpec:{type:"string"},style:a,styleSpec:d}):I&&y[I[1]]&&y[I[1]].transition?ft({key:S,value:t[S],valueSpec:d.transition,style:a,styleSpec:d}):y[S]?ft({key:S,value:t[S],valueSpec:y[S],style:a,styleSpec:d}):[new n.a3(S,t[S],`unknown property "${S}"`)])}return b}const cl={"*":()=>[],array:Po,boolean:function(h){const t=h.value,a=h.key;return n.$(t)?[]:[new n.V(a,t,`boolean expected, ${n.K(t)} found`)]},number:Qs,color:function({key:h,value:t}){return n.a0(t)?n.a1.parseCSSColor(t)===null?[new n.V(h,t,`color expected, "${t}" found`)]:[]:[new n.V(h,t,`color expected, ${n.K(t)} found`)]},enum:Ps,filter:Qt,function:Io,layer:xn,object:ze,source:Xs,model:n.a7,light:Jr,"light-3d":pl,terrain:Uo,fog:oc,string:er,formatted:function(h){return er(h).length===0?[]:Mr(h)},resolvedImage:function(h){return er(h).length===0?[]:Mr(h)},projection:function(h){const t=h.value,a=h.styleSpec,d=a.projection,y=h.style;if(n.H(t)){let b=[];for(const S in t)b=b.concat(ft({key:S,value:t[S],valueSpec:d[S],style:y,styleSpec:a}));return b}return n.a0(t)?[]:[new n.V("projection",t,`object or string expected, ${n.K(t)} found`)]},import:function(h){const t=h.key,{value:a,styleSpec:d}=h;if(!n.H(a))return[new n.V(t,a,"import must be an object")];const{data:y,...b}=a;Object.defineProperty(b,"__line__",{value:a.__line__,enumerable:!1});let S=ze(Object.assign({},h,{value:b,valueSpec:d.import}));return n.J(b.id)===""&&S.push(new n.V(`${h.key}.id`,b,"import id can't be an empty string")),y&&(S=S.concat(et(y,d,{key:`${h.key}.data`}))),S},iconset:function(h){const t=h.value,a=h.key,d=h.styleSpec,y=h.style;if(!n.H(t))return[new n.V(a,t,"object expected")];if(!t.type)return[new n.V(a,t,'"type" is required')];const b=n.J(t.type);let S=[];if(S=S.concat(ze({key:a,value:t,valueSpec:d[`iconset_${b}`],style:y,styleSpec:d})),(function(I,D){return!(I!=="source"||!D.source)})(b,t)){const I=y.sources&&y.sources[t.source],D=I&&n.J(I.type);I?D!=="raster-array"&&S.push(new n.V(a,t.source,`iconset cannot be used with a source of type ${String(D)}, it only be used with a "raster-array" source type`)):S.push(new n.V(a,t.source,`source "${t.source}" not found`))}return S}};function ft(h,t=!1){const a=h.value,d=h.valueSpec,y=h.styleSpec;if(d.expression){if(n.a4(n.J(a)))return Io(h);if(n.Q(n.S(a)))return Mr(h)}if(d.type&&cl[d.type]){const b=cl[d.type](h);return t===!0&&b.length>0&&Array.isArray(h.value)?Mr(h):b}return ze(Object.assign({},h,{valueSpec:d.type?y[d.type]:d}))}function ze(h){const t=h.key,a=h.value,d=h.valueSpec||{},y=h.objectElementValidators||{},b=h.style,S=h.styleSpec;if(!n.H(a))return[new n.V(t,a,`object expected, ${n.K(a)} found`)];let I=[];for(const D in a){const N=D.split(".")[0];let V;y[N]?V=y[N]:d[N]?V=ft:y["*"]?V=y["*"]:d["*"]&&(V=ft),V?I=I.concat(V({key:(t&&`${t}.`)+D,value:a[D],valueSpec:d[N]||d["*"],style:b,styleSpec:S,object:a,objectKey:D},a)):I.push(new n.a3(t,a[D],`unknown property "${D}"`))}for(const D in d){if(y[D])continue;const N=d[D];N.required&&N.default===void 0&&a[D]===void 0&&I.push(new n.V(t,a,`missing required property "${D}"`))}return I}function Pe({key:h,value:t}){const a=er({key:h,value:t});if(a.length)return a;const d=t;return d.indexOf("{fontstack}")===-1&&a.push(new n.V(h,t,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&a.push(new n.V(h,t,'"glyphs" url must include a "{range}" token')),a}function et(h,t=n.a6,a={}){return ze({key:a.key||"",value:h,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:h,objectElementValidators:{glyphs:Pe}})}function gt(h,t=n.a6){return _e(et(h,t))}const jt=h=>_e(Xs(h)),Ge=h=>_e(Jr(h)),ei=h=>_e(pl(h)),kt=h=>_e(Uo(h)),Pi=h=>_e(oc(h)),fi=h=>_e((function(t){const a=t.value,d=t.style,y=t.styleSpec,b=y.snow;if(a===void 0)return[];if(!n.H(a))return[new n.V("snow",a,`object expected, ${n.K(a)} found`)];let S=[];for(const I in a){const D=I.match(/^(.*)-transition$/);S=S.concat(D&&b[D[1]]&&b[D[1]].transition?ft({key:I,value:a[I],valueSpec:y.transition,style:d,styleSpec:y}):b[I]?ft({key:I,value:a[I],valueSpec:b[I],style:d,styleSpec:y}):[new n.a3(I,a[I],`unknown property "${I}"`)])}return S})(h)),ui=h=>_e((function(t){const a=t.value,d=t.style,y=t.styleSpec,b=y.rain;if(a===void 0)return[];if(!n.H(a))return[new n.V("rain",a,`object expected, ${n.K(a)} found`)];let S=[];for(const I in a){const D=I.match(/^(.*)-transition$/);S=S.concat(D&&b[D[1]]&&b[D[1]].transition?ft({key:I,value:a[I],valueSpec:y.transition,style:d,styleSpec:y}):b[I]?ft({key:I,value:a[I],valueSpec:b[I],style:d,styleSpec:y}):[new n.a3(I,a[I],`unknown property "${I}"`)])}return S})(h)),kn=h=>_e(xn(h)),fr=h=>_e(Qt(h)),Cr=h=>_e(Ha(h)),ct=h=>_e(ms(h)),te=h=>_e(n.a7(h));function _e(h){return h.slice().sort(((t,a)=>t.line&&a.line?t.line-a.line:0))}function Re(h,t){let a=!1;if(t&&t.length)for(const d of t)d instanceof n.a3?n.w(d.message):(h.fire(new n.y(new Error(d.message))),a=!0);return a}const tt=n.a6.light;let Xe;class at extends n.E{constructor(t,a="flat"){super(),this._transitionable=new n.a8(Xe||(Xe=new n.a9({anchor:new n.aa(tt.anchor),position:new n.ab(tt.position),color:new n.aa(tt.color),intensity:new n.aa(tt.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,d={}){this._validate(Ge,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&Re(this,t.call(gt,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}const St=n.a6.terrain;let lt=class extends n.E{constructor(h,t,a,d,y){super(),this.scope=a,this._transitionable=new n.a8(new n.a9({source:new n.aa(St.source),exaggeration:new n.aa(St.exaggeration)}),a,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=y}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new n.ac(h,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let a=-1,d=-1,y=1;for(const b of t.zoomStops)y=t.evaluate(new n.ac(b,{worldview:this.worldview})),y>.01?(a=b,d=-1):d=b;return y<.01&&a>0&&d>a?[a,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof n.ad}};const It=45,ti=65,Gt=.05;function Ji(h,t,a,d){const y=n.ah(It,ti,a),[b,S]=Qi(h,d);let I=1-Math.min(1,Math.exp((t-b)/(S-b)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*y*h.alpha}function Qi(h,t){const a=.5/Math.tan(.5*t);return[h.range[0]+a,h.range[1]+a]}function ji(h,t,a,d,y){const b=n.af([],[t,a,d],y.mercatorFogMatrix);return Ji(h,n.ag(b),y.pitch,y._fov)}function pr(h,t,a,d,y,b,S){const I=[[a,d,0],[y,d,0],[y,b,0],[a,b,0]];let D=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const V of I){const K=n.af([],V,t),X=n.ag(K);D=Math.min(D,X),N=Math.max(N,X)}return[Ji(h,D,S.pitch,S._fov),Ji(h,N,S.pitch,S._fov)]}const $n=n.a6.fog;class Nn extends n.E{constructor(t,a,d,y){super();const b=new n.a9({range:new n.aa($n.range),color:new n.aa($n.color),"color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.aa($n["high-color"]),"high-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.aa($n["space-color"]),"space-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.aa($n["horizon-blend"]),"star-intensity":new n.aa($n["star-intensity"]),"vertical-range":new n.aa($n["vertical-range"])});this._transitionable=new n.a8(b,d,new Map(y)),this.set(t,y),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new n.ai(b),this.scope=d}get state(){const t=this._transform,a=t.projection.name==="globe",d=n.aj(t.zoom),y=this.properties.get("range"),b=[.5,3];return{range:a?[n.ak(b[0],y[0],d),n.ak(b[1],y[1],d)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,d={}){if(this._validate(Pi,t,d))return;const y=Object.assign({},t);for(const b of Object.keys($n))y[b]===void 0&&(y[b]=$n[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.ah(It,ti,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?(function(d,y,b){const S=n.ae.fromLngLat(y),I=b.elevation?b.elevation.getAtPointOrZero(S):0;return ji(d,S.x,S.y,I,b)})(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return pr(this.state,a,0,0,n.al,n.al,this._transform)}getOpacityForBounds(t,a,d,y,b){return this._transform.projection.supportsFog?pr(this.state,t,a,d,y,b,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Qi(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const d of a){const y=t.points[d];let b;if(y[2]>=0)b=y;else{const S=t.points[d-4];b=n.am(S,y,S[2]/(S[2]-y[2]))}if(ji(this.state,b[0],b[1],0,this._transform)>=Gt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&Re(this,t.call(gt,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}let qr,Oa,ts,cs,Zs=class extends n.E{constructor(h,t,a,d){super();const y=qr||(qr=new n.a9({density:new n.aa(n.a6.snow.density),intensity:new n.aa(n.a6.snow.intensity),color:new n.aa(n.a6.snow.color),opacity:new n.aa(n.a6.snow.opacity),vignette:new n.aa(n.a6.snow.vignette),"vignette-color":new n.aa(n.a6.snow["vignette-color"]),"center-thinning":new n.aa(n.a6.snow["center-thinning"]),direction:new n.aa(n.a6.snow.direction),"flake-size":new n.aa(n.a6.snow["flake-size"])}));this._transitionable=new n.a8(y,a,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(y),this.scope=a}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),d=n.an(a[0]),y=-Math.max(n.an(a[1]),.01),b=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(t.r,t.g,t.b,t.a*h),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(h,t,a={}){if(this._validate(fi,h,a))return;const d=Object.assign({},h),y=n.a6.snow;for(const b of Object.keys(y))d[b]===void 0&&(d[b]=y[b].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,a){return(!a||a.validate!==!1)&&Re(this,h.call(gt,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}},na=class extends n.E{constructor(h,t,a,d){super();const y=Oa||(Oa=new n.a9({density:new n.aa(n.a6.rain.density),intensity:new n.aa(n.a6.rain.intensity),color:new n.aa(n.a6.rain.color),opacity:new n.aa(n.a6.rain.opacity),vignette:new n.aa(n.a6.rain.vignette),"vignette-color":new n.aa(n.a6.rain["vignette-color"]),"center-thinning":new n.aa(n.a6.rain["center-thinning"]),direction:new n.aa(n.a6.rain.direction),"droplet-size":new n.aa(n.a6.rain["droplet-size"]),"distortion-strength":new n.aa(n.a6.rain["distortion-strength"])}));this._transitionable=new n.a8(y,a,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(y),this.scope=a}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),d=n.an(a[0]),y=-Math.max(n.an(a[1]),.01),b=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(t.r,t.g,t.b,t.a*h),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(h,t,a={}){if(this._validate(ui,h,a))return;const d=Object.assign({},h),y=n.a6.rain;for(const b of Object.keys(y))d[b]===void 0&&(d[b]=y[b].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,a){return(!a||a.validate!==!1)&&Re(this,h.call(gt,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}};class $r extends n.E{constructor(t,a,d,y){super(),this.scope=d,this._options=t,this.properties=new n.ai(a),this._transitionable=new n.a8(a,d,new Map(y)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class _a{constructor(t,a,d){this.screenBounds=t,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(t,a){let d,y;if(t instanceof n.P||typeof t[0]=="number"){const b=n.P.convert(t);d=[b],y=a.isPointAboveHorizon(b)}else{const b=n.P.convert(t[0]),S=n.P.convert(t[1]),I=b.add(S)._div(2);d=[b,S],y=n.aq(b,S).every((D=>a.isPointAboveHorizon(D)))&&a.isPointAboveHorizon(I)}return new _a(d,y,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],y=n.aq(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?y[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(y[3]=this.cameraPoint)),n.ar(y,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],y=n.aq(a,d,t),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>d.y))+((b.x>a.x)+(b.x>d.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(t,a,d,y=0){const b=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/a._pixelsPerMercatorPixel+1,S=d?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let I=t.tileID.wrap+(S.unwrapped?y:0);const D=S.polygon.map((ge=>n.as(t.tileTransform,ge,I)));if(!n.at(D,0,0,n.al,n.al))return;I=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const N=this.screenGeometryMercator.polygon.map((ge=>n.au(t.tileTransform,ge,I))),V=N.map((ge=>new n.P(ge[0],ge[1]))),K=a.getFreeCameraOptions().position||new n.ae(0,0,0),X=n.au(t.tileTransform,K,I),Q=N.map((ge=>{const me=n.av(ge,ge,X);return n.aw(me,me),new n.ax(X,me)})),ae=n.ay(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:V,tilespaceRays:Q,bufferedTilespaceGeometry:D,bufferedTilespaceBounds:(ie=n.az(D),ie.min.x=n.aA(ie.min.x,0,n.al),ie.min.y=n.aA(ie.min.y,0,n.al),ie.max.x=n.aA(ie.max.x,0,n.al),ie.max.y=n.aA(ie.max.y,0,n.al),ie),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:ae};var ie}_bufferedScreenMercator(t,a){const d=Xa(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let y;return y=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._screenRaycastCache[d]=y,y}}_bufferedCameraMercator(t,a){const d=Xa(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let y;return y=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._cameraRaycastCache[d]=y,y}}_projectAndResample(t,a){const d=(function(b,S){const I=n.aB([],S.pixelMatrix,S.globeMatrix),D=[0,-n.aD,0,1],N=[0,n.aD,0,1],V=[0,0,0,1];n.aC(D,D,I),n.aC(N,N,I),n.aC(V,V,I);const K=new n.P(D[0]/D[3],D[1]/D[3]),X=new n.P(N[0]/N[3],N[1]/N[3]),Q=n.aE(b,K)&&D[3]<V[3],ae=n.aE(b,X)&&N[3]<V[3];if(!Q&&!ae)return null;const ie=(function(He,Ne,Oe){for(let nt=1;nt<He.length;nt++){const mt=kr(Ne.pointCoordinate3D(He[nt-1]).x),dt=kr(Ne.pointCoordinate3D(He[nt]).x);if(Oe<0){if(mt<dt)return{idx:nt,t:-mt/(dt-1-mt)}}else if(dt<mt)return{idx:nt,t:(1-mt)/(dt+1-mt)}}return null})(b,S,Q?-1:1);if(!ie)return null;const{idx:ge,t:me}=ie;let Se=ge>1?ur(b.slice(0,ge),S):[],De=ge<b.length?ur(b.slice(ge),S):[];Se=Se.map((He=>new n.P(kr(He.x),He.y))),De=De.map((He=>new n.P(kr(He.x),He.y)));const Ee=[...Se];Ee.length===0&&Ee.push(De[De.length-1]);const We=n.ak(Ee[Ee.length-1].y,(De.length===0?Se[0]:De[0]).y,me);let Ve;return Ve=Q?[new n.P(0,We),new n.P(0,0),new n.P(1,0),new n.P(1,We)]:[new n.P(1,We),new n.P(1,1),new n.P(0,1),new n.P(0,We)],Ee.push(...Ve),De.length===0?Ee.push(Se[0]):Ee.push(...De),{polygon:Ee.map((He=>new n.ae(He.x,He.y))),unwrapped:!1}})(t,a);if(d)return d;const y=(function(b,S){let I=!1,D=-1/0,N=0;for(let K=0;K<b.length-1;K++)b[K].x>D&&(D=b[K].x,N=K);for(let K=0;K<b.length-1;K++){const X=(N+K)%(b.length-1),Q=b[X],ae=b[X+1];Math.abs(Q.x-ae.x)>.5&&(Q.x<ae.x?(Q.x+=1,X===0&&(b[b.length-1].x+=1)):(ae.x+=1,X+1===b.length-1&&(b[0].x+=1)),I=!0)}const V=n.aF(S.center.lng);return I&&V<Math.abs(V-1)&&b.forEach((K=>{K.x-=1})),{polygon:b,unwrapped:I}})(ur(t,a).map((b=>new n.P(kr(b.x),b.y))),a);return{polygon:y.polygon.map((b=>new n.ae(b.x,b.y))),unwrapped:y.unwrapped}}}function ur(h,t){return n.aG(h,(a=>{const d=t.pointCoordinate3D(a);a.x=d.x,a.y=d.y}),1/256)}function kr(h){return h<0?1+h%1:h%1}function Xa(h){return 100*h|0}function Lo(h,t,a,d,y){const b=function(I,D){if(I)return y(I);if(D){if(h.url&&D.tiles&&h.tiles&&delete h.tiles,D.variants){if(!Array.isArray(D.variants))return y(new Error("variants must be an array"));for(const V of D.variants){if(V==null||typeof V!="object"||V.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(V.capabilities))return y(new Error("capabilities must be an array"));if(V.capabilities.length===1&&V.capabilities[0]==="meshopt"){D=Object.assign(D,V);break}}}const N=n.aH(Object.assign({},D,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=t.canonicalizeTileset(N,h.url),y(null,N)}},S=(function(I,D,N){if(!I)return null;if(!D&&!N)return I;N=N||I.worldview_default;const V=Object.values(I.language||{});if(V.length===0)return null;const K=Object.values(I.worldview||{});if(K.length===0)return null;const X=V.every((ae=>ae===D)),Q=K.every((ae=>ae===N));return X&&Q?I:D in(I.language_options||{})||N in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null})(h.data,a,d);return S?n.o.frame((()=>b(null,S))):h.url?n.m(t.transformRequest(t.normalizeSourceURL(h.url,null,a,d),n.R.Source),b):n.o.frame((()=>{const{data:I,...D}=h;b(null,D)}))}function eo(h,t){const a=Math.pow(2,t.z),d=Math.floor(n.aF(h.getWest())*a),y=Math.floor(n.aJ(h.getNorth())*a),b=Math.ceil(n.aF(h.getEast())*a),S=Math.ceil(n.aJ(h.getSouth())*a);return t.x>=d&&t.x<b&&t.y>=y&&t.y<S}class ml{constructor(t,a,d){this.bounds=t?n.aI.convert(this.validateBounds(t)):null,this.minzoom=a||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const a of t)this.extraBounds.push(n.aI.convert(this.validateBounds(a)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!eo(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(eo(a,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const a=new ml(t.bounds,t.minzoom,t.maxzoom);return a.addExtraBounds(t.extra_bounds),a}}class ih extends n.E{constructor(t,a,d,y){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,n.aH(a,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new n.aK}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Lo(this._options,this.map._requestManager,a,d,((y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new n.y(y));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of b.vector_layers)this.vectorLayerIds.push(S.id),b.worldview&&b.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=ml.fromTileJSON(b),mi(b.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(y)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,a){const d=t.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(d),b=this.map._requestManager.transformRequest(y,n.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,I=S?{image:S.image.clone()}:null,D={request:b,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&n.h(d)&&(D.localizableLayerIds=this.localizableLayerIds),D.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",D,N.bind(this));else if(t.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",D,N.bind(this),void 0,!0);else{const V=n.aL.call({deduped:this._deduped},D,((K,X)=>{if(K||!X)N.call(this,K);else{const Q=n.aM(X.responseHeaders);D.data={rawData:X.rawData.slice(0),expires:Q.expires,cacheControl:Q.cacheControl},t.actor&&t.actor.send("loadTile",D,N.bind(this),void 0,!0)}}),!0);t.request={cancel:V}}function N(V,K){return delete t.request,t.aborted?a(null):V&&V instanceof n.aN&&V.status!==404?a(V):(K&&K.resourceTiming&&(t.resourceTiming=K.resourceTiming),this.map._refreshExpiredTiles&&K&&t.setExpiryData(K),t.loadVectorData(K,this.map.painter),n.aO(this.dispatcher),a(null,K),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ns extends n.E{constructor(t,a,d,y){super(),this.id=t,this.dispatcher=d,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},a),Object.assign(this,n.aH(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=Lo(this._options,this.map._requestManager,null,a,((d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new n.y(d)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map((b=>b.id))),this.tileBounds=ml.fromTileJSON(y),mi(y.tiles),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const d=n.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=n.n(this.map._requestManager.transformRequest(y,n.R.Tile),((b,S,I)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(b)return t.state="errored",a(b);if(!S)return a(null);const D=n.aM(I);this.map._refreshExpiredTiles&&t.setExpiryData(D),t.setTexture(S,this.map.painter),t.state="loaded",n.aO(this.dispatcher),a(null)}))}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof n.T?(t.destroy(!1),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Go([h,t],a,d,{scaled:y=!0}={}){const{tileSize:b,buffer:S}=d,{x:I,y:D,z:N}=a;if(!isFinite(I)||!isFinite(D)||!isFinite(N))throw new Error("Invalid MRT header");const V=2**N,K=V*n.aF(h),X=V*n.aJ(t);return(function([Q,ae],ie,{scaled:ge=!0}={}){if(!ie)throw new Error("bandView is undefined");const{data:me,tileSize:Se,buffer:De,offset:Ee,scale:We,dimension:Ve}=ie;if(Q<-De||Q>Se+De||ae<-De||ae>Se+De)throw new Error(`Point (${Q}, ${ae}) out of bounds for tileSize=${Se}, buffer=${De}`);const He=(ae+De)*(Se+2*De)+(Q+De);if(new Uint32Array(me.buffer)[He]===4294967295)return null;let Ne=[];Ne=ge?[]:new ie.data.constructor(Ve);for(let Oe=0;Oe<Ve;Oe++)Ne[Oe]=Math.round(1e12*(me[Ve*He+Oe]*We+Ee))/1e12;return Ne})([Math.min(Math.max(-S,Math.floor((K-I)*b)),b-1+S),Math.min(Math.max(-S,Math.floor((X-D)*b)),b-1+S)],d,{scaled:y})}class va extends ns{constructor(t,a,d,y){super(t,a,d,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},a)}triggerRepaint(t){const a=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);a&&a.enabled&&d&&a._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,n.R.Tile),b={request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=y,t.actor||(t.actor=this.dispatcher.getActor());const S=(I,D,N)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(I)return I.name==="AbortError"?void 0:(t.state="errored",a(I));if(this.map._refreshExpiredTiles&&D){const V=n.aM(N);t.setExpiryData(V)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!D)return a(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=D}a(null)};t.request=this.partial?t.fetchHeader(void 0,S.bind(this)):t.actor.send("loadTile",b,S.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){const d=t.texturePerLayer;if(t.flushAllQueues(),d.size){t.destroy(!1);for(const y of d.values())this.map.painter.saveTileTexture(y)}else t.destroy()}prepareTile(t,a,d,y){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(a,d,y,((b,S)=>{if(b)return t.state="errored",this.fire(new n.y(b)),void this.triggerRepaint(t);S&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(d,S,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find((({id:b})=>b===t)),d=a&&a.fields,y=d&&d.bands&&d.bands;return y?y[0]:0}getTextureDescriptor(t,a,d){if(!t)return;const y=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;a instanceof n.aR?b=a.paint.get("raster-array-band"):a instanceof n.aS&&(b=a.paint.get("raster-particle-array-band"));const S=b||this.getInitialBand(y);if(S==null)return;if(!t.textureDescriptorPerLayer.get(a.id))return void this.prepareTile(t,y,a.id,S);if(t.updateNeeded(a.id,S)&&!d)return;const I=t.textureDescriptorPerLayer.get(a.id);return Object.assign({},I,{texture:t.texturePerLayer.get(a.id)})}getImages(t,a){const d=new Map;for(const y of t)for(const b of a){const[S,I]=b.split("/"),D=y.getLayer(S);if(!D||!D.hasBand(I)||!D.hasDataForBand(I))continue;const{bytes:N,tileSize:V,buffer:K}=D.getBandView(I),X=V+2*K,Q={data:new n.q({width:X,height:X},N),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(b,Q)}return d}queryRasterArrayValueByBandId(t,a,d){const y=a._mrt;return new Promise((b=>{const S={},I=new Set;for(const[D,N]of Object.entries(y.layers)){if(d.layerName&&D!==d.layerName)continue;const V={};S[D]=V;for(const{bands:K}of N.dataIndex)for(const X of K)d.bands&&!d.bands.includes(X)||(I.add(n.B(D,X)),a.fetchBand(D,null,X,(Q=>{n.o.frame((()=>{V[X]=Q?null:Go([t.lng,t.lat],y,N.getBandView(X)),I.delete(n.B(D,X)),I.size===0&&b(S)}))}),!1))}I.size===0&&b(S)}))}_loadTileForQuery(t,a){if(this._loadTileLoaded[t.uid])return void a(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(a);this._loadTilePending[t.uid]=[a];const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,n.R.Tile);t.actor.send("loadTile",{request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((b,S,I)=>{if(b)return this._loadTilePending[t.uid].forEach((D=>D(b,null))),void delete this._loadTilePending[t.uid];if(!S)return this._loadTilePending[t.uid].forEach((D=>D(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&S){const D=n.aM(I);t.setExpiryData(D)}t._mrt=S,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((D=>D(null,S))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,a,d){return new Promise(((y,b)=>{this._loadTileForQuery(a,((S,I)=>{S?b(S):y(I?this.queryRasterArrayValueByBandId(t,a,d):null)}))}))}queryRasterArrayValue(t,a){const d=n.aT.convert(t),y=this.findLoadedParent(d);return y&&y._mrt?a.bands||!this.partial?this.queryRasterArrayValueByBandId(d,y,a):this.queryRasterArrayValueByAllBands(d,y,a):Promise.resolve(null)}findLoadedParent(t){const a=n.ae.fromLngLat(t,this.map.transform.tileSize),d=this.maxzoom+1,y=1<<d,b=Math.floor(a.x),S=Math.floor((a.x-b)*y),I=Math.floor(a.y*y),D=this.map.style.getSourceCache(this.id),N=new n.aQ(d,b,d,S,I);return D.findLoadedParent(N,this.minzoom)}}const Mc={vector:ih,raster:ns,"raster-dem":class extends ns{constructor(h,t,a,d){super(h,t,a,d),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(y,b){y&&(h.state="errored",t(y)),b&&(h.dem=b,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=n.n(this.map._requestManager.transformRequest(a,n.R.Tile),(function(y,b,S){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(y)h.state="errored",t(y);else if(b){const I=n.aM(S);this.map._refreshExpiredTiles&&h.setExpiryData(I);const D=ImageBitmap&&b instanceof ImageBitmap&&n.r(),N=1-(b.width-n.aP(b.width))/2;N<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const V=D?b:n.o.getImageData(b,N),K={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:V,encoding:this.encoding,padding:N};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",K,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,a=Math.pow(2,t.z),d=(t.x-1+a)%a,y=t.x===0?h.wrap-1:h.wrap,b=(t.x+1+a)%a,S=t.x+1===a?h.wrap+1:h.wrap,I={};return I[new n.aQ(h.overscaledZ,y,t.z,d,t.y).key]={backfilled:!1},I[new n.aQ(h.overscaledZ,S,t.z,b,t.y).key]={backfilled:!1},t.y>0&&(I[new n.aQ(h.overscaledZ,y,t.z,d,t.y-1).key]={backfilled:!1},I[new n.aQ(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},I[new n.aQ(h.overscaledZ,S,t.z,b,t.y-1).key]={backfilled:!1}),t.y+1<a&&(I[new n.aQ(h.overscaledZ,y,t.z,d,t.y+1).key]={backfilled:!1},I[new n.aQ(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},I[new n.aQ(h.overscaledZ,S,t.z,b,t.y+1).key]={backfilled:!1}),I}},"raster-array":va,geojson:class extends n.E{constructor(h,t,a,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const y=n.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*y,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*y,extent:n.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*y,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new n.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new n.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const a of this._data.features)t.set(a.id,a);for(const a of h.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:a},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:h},this.workerOptions);t.scope=this.scope;const a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(n.o.resolveURL(a),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new n.y(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new n.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const h=n.B(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,y=d?{image:d.image.clone()}:null,b=this._partialReload,S={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};h.request=this.actor.send(a,S,((I,D)=>b&&!D?(h.state="loaded",t(null)):(delete h.request,h.destroy(!1),h.aborted?t(null):I?t(I):(h.loadVectorData(D,this.map.painter,a==="reloadTile"),t(null)))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aU{constructor(h,t,a,d){super(h,t,a,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aV(this.urls,((t,a)=>{this._loaded=!0,t?this.fire(new n.y(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new n.y(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aU,model:n.aX,"batched-model":class extends n.E{constructor(h,t,a,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(h)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=Lo(this._options,this.map._requestManager,t,a,((d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new n.y(d))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new ml(y.bounds,this.minzoom,this.maxzoom)),mi(y.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)}))}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,n.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:n.o.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const b=Object.values(h.buckets);for(const S of b)S.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,y.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,y.bind(this),void 0,!0);function y(b,S){return h.aborted?t(null):b&&b.status!==404?t(b):(this.map._refreshExpiredTiles&&S&&h.setExpiryData(S),h.loadModelData(S,this.map.painter),h.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends n.aU{constructor(h,t,a,d){super(h,t,a,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((b=>typeof b!="number"))))||this.fire(new n.y(new n.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.y(new n.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.y(new n.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.y(new n.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.y(new n.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof n.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends n.E{constructor(h,t,a,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ml(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,n.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:a,z:d}=h.canonical;return this._implementation.hasTile({x:t,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:a,y:d,z:y}=h.tileID.canonical,b=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:a,y:d,z:y},{signal:b.signal})).then((function(S){return delete h.request,h.aborted?(h.state="unloaded",t(null)):S===void 0?(h.state="errored",t(null)):S===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):(function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement})(S)?(this.loadTileData(h,S),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((S=>{S.name!=="AbortError"&&(h.state="errored",t(S))})),h.request.cancel=()=>b.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof n.T?(h.destroy(!1),h.texture&&h.texture instanceof n.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:a,y:d,z:y}=h.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:y})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z})))}_clearTiles(){const h=n.B(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}}},to=function(h,t,a,d){const y=new Mc[t.type](h,t,a,d);if(y.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${y.id}`);return n.aY(["load","abort","unload","serialize","prepare"],y),y};function Vc(h,t,a=""){return`${a}:${t.id||""}:${t.layer.id}:${(function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:y,importId:b}=d;return`featureset:${y}${b?`:import:${b}`:""}`}})(h.target)}`}function Ah(h,t,a,d=""){if(h.uniqueFeatureID){const y=Vc(h,t,d);if(a.has(y))return!0;a.add(y)}return!1}function su(h,t,a,d,y=!1){const b=t.sourceCache.transform,S=t.sourceCache.tilesIn(h,t.has3DLayers,y);S.sort(Mu);const I=[];for(const D of S){const N=D.tile.queryRenderedFeatures(t,D,a,d,b,y);Object.keys(N).length&&I.push({wrappedTileID:D.tile.tileID.wrapped().key,queryResults:N})}for(const D in t.layers){const N=t.layers[D];if(N.styleLayer){const V=N.styleLayer.queryRenderedFeatures(h,t.sourceCache,d);Object.keys(V).length&&I.push({wrappedTileID:0,queryResults:V})}}return I.length===0?{}:(function(D){const N={},V={};for(const K of D){const X=K.queryResults,Q=K.wrappedTileID,ae=V[Q]=V[Q]||{};for(const ie in X){const ge=X[ie],me=ae[ie]=ae[ie]||{},Se=N[ie]=N[ie]||[];for(const De of ge)me[De.featureIndex]||(me[De.featureIndex]=!0,Se.push(De))}}return N})(I)}function Kh(h,t,a,d,y,b){const S={},I=d.queryRenderedSymbols(h),D=[];for(const N of Object.keys(I).map(Number))D.push(y[N]);D.sort(Mu);for(const N of D){const V=N.featureIndex.lookupSymbolFeatures(I[N.bucketInstanceId],N.bucketIndex,N.sourceLayerIndex,t,a,b);for(const K in V){const X=S[K]=S[K]||[],Q=V[K];Q.sort(((ae,ie)=>{const ge=N.featureSortOrder;if(ge){const me=ge.indexOf(ae.featureIndex);return ge.indexOf(ie.featureIndex)-me}return ie.featureIndex-ae.featureIndex}));for(const ae of Q)X.push(ae)}}return S}function Jh(h,t){const a=h.getRenderableIds().map((b=>h.getTileByID(b))),d=[],y={};for(let b=0;b<a.length;b++){const S=a[b],I=S.tileID.canonical.key;y[I]||(y[I]=!0,S.querySourceFeatures(d,t))}return d}function Mu(h,t){const a=h.tileID,d=t.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function Uc(h,t){const a={};if(!t)return a;for(const d of h){const y=d.layerIds.map((b=>t.getLayer(b))).filter(Boolean);if(y.length!==0){d.layers=y,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map((b=>y.filter((S=>S.id===b))[0])));for(const b of y)a[b.fqid]=d}}return a}const lc=32,ou=33,Ic=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,a=0,d=0,y=0,b=0,S=0,I=0;for(1&t?y=b=S=lc:a=d=I=lc;(t>>=1)>1;){const N=a+y>>1,V=d+b>>1;1&t?(y=a,b=d,a=S,d=I):(a=y,d=b,y=S,b=I),S=N,I=V}const D=4*h;Ic[D+0]=a,Ic[D+1]=d,Ic[D+2]=y,Ic[D+3]=b}const _o=new Uint16Array(2178),Zl=new Uint8Array(1089),ko=new Uint16Array(1089);function Ao(h){return h===0?-.03125:h===32?.03125:0}const lu={type:2,extent:n.al,loadGeometry:()=>[[new n.P(0,0),new n.P(n.al+1,0),new n.P(n.al+1,n.al+1),new n.P(0,n.al+1),new n.P(0,0)]]};class Iu{constructor(t,a,d,y,b,S){this.tileID=t,this.uid=n.b2(),this.uses=0,this.tileSize=a,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=S,this._hasAppearances=null}registerFadeDuration(t){const a=t+this.timeAdded;a<n.o.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Uc(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof n.b4){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof n.b4&&b.hasRTLText){this.hasRTLText=!0,n.b5();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],S=a.style.getOwnLayer(y);if(!S)continue;const I=S.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,I)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,a,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Uc(t.buckets,a.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,a){for(const b in this.buckets){const S=this.buckets[b];if(S.uploadPending()){let I={},D=[],N={zoom:0,pitch:0,brightness:0,worldview:""};if(a){if(a.style){D=a.style.listImages();const V=S.layers[0],K=V.sourceLayer||"_geojsonTileLayer",X=a.style.getLayerSourceCache(V);X&&(I=X._state.getState(K,void 0))}N={zoom:a.transform.zoom||0,pitch:a.transform.pitch||0,brightness:a.style.getBrightness()||0,worldview:a.worldview||""}}S.upload(t,this.tileID.canonical,I,D,N)}}const d=t.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new n.T(t,y.image,d.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,d.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,d.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=a.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(a)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const a in this.buckets){const d=this.buckets[a];d.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,d.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,a,d,y,b,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=this.evaluateQueryRenderedFeaturePadding(),D=(function(N,V){const K=n.bq([],[.5*N.width,.5*-N.height,1]);return n.br(K,K,[1,-1,0]),n.aB(K,K,N.calculateProjMatrix(V.toUnwrapped())),Float32Array.from(K)})(b,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:a,pixelPosMatrix:D,transform:y,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:I})}querySourceFeatures(t,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const y=d.loadVTLayers(),b=a?a.sourceLayer:"",S=y._geojsonTileLayer||y[b];if(!S)return;const I=n.b6(a&&a.filter),{z:D,x:N,y:V}=this.tileID.canonical,K={z:D,x:N,y:V};for(let X=0;X<S.length;X++){const Q=S.feature(X);if(I.needGeometry){const ge=n.b7(Q,!0);if(!I.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),ge,this.tileID.canonical))continue}else if(!I.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Q))continue;const ae=d.getId(Q,b),ie=new n.b8(Q,D,N,V,ae);ie.tile=K,t.push(ie)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const d=n.b9(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let y=!1;if(this.expirationTime>d)y=!1;else if(a)if(this.expirationTime<a)y=!0;else{const b=this.expirationTime-a;b?this.expirationTime=d+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const a in this.buckets)if(t.style.hasLayer(a)&&this.buckets[a].layers.some((d=>d.appearances&&d.appearances.length>0)))return!0;return!1}updateBuckets(t,a){if(!this.latestFeatureIndex||!t.style)return;const d=t.style.listImages(),y=t.style.getBrightness();for(const b in this.buckets){if(!t.style.hasLayer(b))continue;const S=this.buckets[b],I=S.layers[0],D=I.sourceLayer||"_geojsonTileLayer",N=t.style.getLayerSourceCache(I);let V={};N&&(V=N._state.getState(D,void 0));const K=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(V).length>0&&!a;S.hasAppearances=S.layers.some((ie=>ie.appearances&&ie.appearances.length>0));const Q=X?S.stateDependentLayers:S.layers;if(X&&S.stateDependentLayers.length!==0||a){const ie=this.latestFeatureIndex.loadVTLayers();S.update(V,ie[D],d,K,Q,a,y)}if(X&&S.stateDependentLayers.length!==0||a||S.hasAppearances){const ie={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};S.updateAppearances(this.tileID.canonical,V,d,ie)}(S instanceof n.ba||S instanceof n.bb)&&t._terrain&&t._terrain.enabled&&N&&S.uploadPending()&&t._terrain._clearRenderCacheForTile(N.id,this.tileID);const ae=t&&t.style&&t.style.getOwnLayer(b);ae&&(this.queryPadding=Math.max(this.queryPadding,ae.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.o.now()+t}setTexture(t,a){const d=a.context,y=d.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(d,t,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(t,a){const d={};for(const y of a)d[y]=!0;this.dependencies[t]=d}hasDependency(t,a){for(const d of t){const y=this.dependencies[d];if(y){for(const b of a)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const d=n.bc(lu,this.tileID.canonical,this.tileTransform)[0],y=new n.bd,b=new n.be;for(let S=0;S<d.length;S++){const{x:I,y:D}=d[S];y.emplaceBack(I,D),b.emplaceBack(S)}b.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(y,n.bf.members),this._tileDebugSegments=n.bg.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const d=n.bc(lu,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const S=(function(I,D){const N=n.aZ(I,D),V=Math.pow(2,I.z);for(let ge=0;ge<ou;ge++)for(let me=0;me<ou;me++){const Se=n.a_((I.x+(me+Ao(me))/lc)/V),De=n.a$((I.y+(ge+Ao(ge))/lc)/V),Ee=D.project(Se,De),We=ge*ou+me;_o[2*We+0]=Math.round((Ee.x*N.scale-N.x)*n.al),_o[2*We+1]=Math.round((Ee.y*N.scale-N.y)*n.al)}Zl.fill(0),ko.fill(0);for(let ge=2045;ge>=0;ge--){const me=4*ge,Se=Ic[me+0],De=Ic[me+1],Ee=Ic[me+2],We=Ic[me+3],Ve=Se+Ee>>1,He=De+We>>1,Ne=Ve+He-De,Oe=He+Se-Ve,nt=De*ou+Se,mt=We*ou+Ee,dt=He*ou+Ve,At=Math.hypot((_o[2*nt+0]+_o[2*mt+0])/2-_o[2*dt+0],(_o[2*nt+1]+_o[2*mt+1])/2-_o[2*dt+1])>=16;Zl[dt]=Zl[dt]||(At?1:0),ge<1022&&(Zl[dt]=Zl[dt]||Zl[(De+Oe>>1)*ou+(Se+Ne>>1)]||Zl[(We+Oe>>1)*ou+(Ee+Ne>>1)])}const K=new n.b1,X=new n.b0;let Q=0;function ae(ge,me){const Se=me*ou+ge;return ko[Se]===0&&(K.emplaceBack(_o[2*Se+0],_o[2*Se+1],ge*n.al/lc,me*n.al/lc),ko[Se]=++Q),ko[Se]-1}function ie(ge,me,Se,De,Ee,We){const Ve=ge+Se>>1,He=me+De>>1;if(Math.abs(ge-Ee)+Math.abs(me-We)>1&&Zl[He*ou+Ve])ie(Ee,We,ge,me,Ve,He),ie(Se,De,Ee,We,Ve,He);else{const Ne=ae(ge,me),Oe=ae(Se,De),nt=ae(Ee,We);X.emplaceBack(Ne,Oe,nt)}}return ie(0,0,lc,lc,lc,0),ie(lc,lc,0,0,0,lc),{vertices:K,indices:X}})(this.tileID.canonical,a);y=S.vertices,b=S.indices}else{y=new n.b1,b=new n.b0;for(const{x:I,y:D}of d)y.emplaceBack(I,D,0,0);const S=n.bh(y.int16.subarray(0,4*y.length),void 0,4);for(let I=0;I<S.length;I+=3)b.emplaceBack(S[I],S[I+1],S[I+2])}this._tileBoundsBuffer=t.createVertexBuffer(y,n.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(b),this._tileBoundsSegments=n.bg.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(t,a){const d=a.projection;if(!d||d.name!=="globe"||a.freezeTileCoverage)return;const y=this.tileID.canonical,b=n.bj(y,a),S=n.bk(b),I=n.aj(a.zoom);let D;I>0&&(D=n.bl(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,y,a,S,D,I),this._makeGlobeTileDebugTextBuffer(t,y,a,S,D,I)}_globePoint(t,a,d,y,b,S,I){let D=n.bm(t,a,d);if(S){const N=1<<d.z,V=n.aF(y.center.lng),K=n.aJ(y.center.lat),X=(d.x+.5)/N-V;let Q=0;X>.5?Q=-1:X<-.5&&(Q=1);let ae=(t/n.al+d.x)/N+Q,ie=(a/n.al+d.y)/N;ae=(ae-V)*y._pixelsPerMercatorPixel+V,ie=(ie-K)*y._pixelsPerMercatorPixel+K;const ge=[ae*y.worldSize,ie*y.worldSize,0];n.af(ge,ge,S),D=n.bn(D,ge,I)}return n.af(D,D,b)}_makeGlobeTileDebugBorderBuffer(t,a,d,y,b,S){const I=new n.bd,D=new n.be,N=new n.bo,V=(X,Q,ae,ie,ge)=>{const me=(ae-X)/(ge-1),Se=(ie-Q)/(ge-1),De=I.length;for(let Ee=0;Ee<ge;Ee++){const We=X+Ee*me,Ve=Q+Ee*Se;I.emplaceBack(We,Ve);const He=this._globePoint(We,Ve,a,d,y,b,S);N.emplaceBack(He[0],He[1],He[2]),D.emplaceBack(De+Ee)}},K=n.al;V(0,0,K,0,16),V(K,0,K,K,16),V(K,K,0,K,16),V(0,K,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(D),this._tileDebugBuffer=t.createVertexBuffer(I,n.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(N,n.bp.members),this._tileDebugSegments=n.bg.simpleSegment(0,0,I.length,D.length)}_makeGlobeTileDebugTextBuffer(t,a,d,y,b,S){const I=n.al/4,D=new n.bd,N=new n.b0,V=new n.bo,K=25;N.reserve(32),D.reserve(K),V.reserve(K);const X=(Q,ae)=>K*Q+ae;for(let Q=0;Q<K;Q++){const ae=Q*I;for(let ie=0;ie<K;ie++){const ge=ie*I;D.emplaceBack(ge,ae);const me=this._globePoint(ge,ae,a,d,y,b,S);V.emplaceBack(me[0],me[1],me[2])}}for(let Q=0;Q<4;Q++)for(let ae=0;ae<4;ae++){const ie=X(Q,ae),ge=X(Q,ae+1),me=X(Q+1,ae),Se=X(Q+1,ae+1);N.emplaceBack(ie,ge,me),N.emplaceBack(me,ge,Se)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(N),this._tileDebugTextBuffer=t.createVertexBuffer(D,n.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(V,n.bp.members),this._tileDebugTextSegments=n.bg.simpleSegment(0,0,K,32)}destroy(t=!0){for(const a in this.buckets)this.buckets[a].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof n.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bs.setPbf(n.bt);class Mh extends Iu{constructor(t,a,d,y,b){super(t,a,d,y,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,a,d){const y=d.context,b=y.gl;let S=this.texturePerLayer.get(t)||d.getTileTexture(a.width);S&&S instanceof n.T?S.update(a,{premultiply:!1}):S=new n.T(y,a,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,S)}flushQueues(t){const a=this._workQueuePerLayer.get(t)||[],d=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const a=this._workQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const a=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}}fetchHeader(t=16384,a){const d=this._mrt=new n.bs(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bu(y,((b,S,I)=>{if(b)a(b);else try{const D=d.getHeaderLength(S);if(D>t)return void(this.request=this.fetchHeader(D,a));d.parseHeader(S),this._isHeaderLoaded=!0;let N=0;for(const V of Object.values(d.layers))N=Math.max(N,V.dataIndex[V.dataIndex.length-1].lastByte);S.byteLength>=N&&(this.entireBuffer=S),a(null,this.entireBuffer||S,I)}catch(D){a(D)}})),this.request}fetchBandForRender(t,a,d,y){this.fetchBand(t,a,d,(b=>{if(b)return void y(b);this.updateTextureDescriptor(t,a,d);const S=this.textureDescriptorPerLayer.get(a);y(null,S?S.img:null)}))}fetchBand(t,a,d,y,b=!0){const S=this._mrt;if(!this._isHeaderLoaded||!S)return void y(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void y(new Error("Can't fetch tile band without an actor"));let D;const N=n.B(String(d),n.B(this.tileID.key,t));let V=this._taskQueue.get(N);V?V.add(y):(V=new Set,V.add(y),this._taskQueue.set(N,V));const K=(ie,ge)=>{D.complete(ie,ge),ie?y(ie):(V.forEach((me=>me(null,ge))),this._taskQueue.delete(N))},X=(ie,ge)=>{if(ie)return y(ie);const me=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:ge,task:D},K,void 0,!0);if(a!==null){const Se=this._workQueuePerLayer.get(a)||[];Se.push((()=>{me&&me.cancel(),D.cancel()})),this._workQueuePerLayer.has(a)||this._workQueuePerLayer.set(a,Se)}};let Q;try{Q=S.getLayer(t)}catch(ie){if(this.state==="reloading")return;throw ie}if(!Q)return void y(new Error(`Unknown sourceLayer "${t}"`));if(Q.hasDataForBand(d))return V.forEach((ie=>ie(null,null))),void this._taskQueue.delete(N);const ae=Q.getDataRange([d]);if(D=S.createDecodingTask(ae),!D||D.tasks.length)if(a!==null&&this.flushQueues(a),this.entireBuffer)X(null,this.entireBuffer.slice(ae.firstByte,ae.lastByte+1));else{const ie=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ae.firstByte}-${ae.lastByte}`}}),ge=n.bu(ie,X);if(a!==null){const me=this._fetchQueuePerLayer.get(a)||[];me.push((()=>{ge.cancel(),D.cancel()})),this._fetchQueuePerLayer.has(a)||this._fetchQueuePerLayer.set(a,me)}}}updateNeeded(t,a){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==a||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,a,d){if(!this._mrt)return;const y=this._mrt.getLayer(t);if(!y||!y.hasBand(d)||!y.hasDataForBand(d))return;const{bytes:b,tileSize:S,buffer:I,offset:D,scale:N}=y.getBandView(d),V=S+2*I,K=new n.q({width:V,height:V},b),X=this.texturePerLayer.get(a);X&&X instanceof n.T&&X.update(K,{premultiply:!1}),this.textureDescriptorPerLayer.set(a,{layer:t,band:d,img:K,buffer:I,offset:D,tileSize:S,format:y.pixelFormat,mix:[N,256*N,65536*N,16777216*N]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const a of this.texturePerLayer.values())a&&a instanceof n.T&&a.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Jf{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,d){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:a,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout((()=>{this.remove(t,b)}),d)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const d=t.wrapped().key,y=a===void 0?0:this.data[d].indexOf(a),b=this.data[d][y];return this.data[d].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const d in this.data)for(const y of this.data[d])t(y.value)||a.push(y);for(const d of a)this.remove(d.value.tileID,d)}}class Cc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,d){const y=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},Object.assign(this.stateChanges[t][y],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==y&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const b in this.state[t][y])d[b]||(this.deletedStates[t][y][b]=null)}else for(const b in d)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][b]===null&&delete this.deletedStates[t][y][b]}removeFeatureState(t,a,d){if(this.deletedStates[t]===null)return;const y=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&a!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][d]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(d in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][d]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,a){const d=this.state[t]||{},y=this.stateChanges[t]||{},b=this.deletedStates[t];if(b===null)return{};if(a!==void 0){const I=String(a),D=Object.assign({},d[I],y[I]);if(b){const N=b[a];if(N===null)return{};for(const V in N)delete D[V]}return D}const S=Object.assign({},d,y);if(b)for(const I in b)delete S[I];return S}initializeTileState(t,a){t.refreshFeatureState(a)}coalesceChanges(t,a){const d={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),Object.assign(this.state[y][S],this.stateChanges[y][S]),b[S]=this.state[y][S];d[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const S in this.state[y])b[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else if(this.state[y][S])for(const I of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][I];b[S]=this.state[y][S]}d[y]=d[y]||{},Object.assign(d[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const y in t)t[y].refreshFeatureState(a)}}class Ho extends n.E{constructor(t,a,d){super(),this.id=t,this._onlySymbols=d,a.on("data",(y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),a.on("error",(()=>{this._sourceErrored=!0})),this._source=a,this._tiles={},this._cache=new Jf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Cc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(t,this.map?this.map.painter:void 0),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Sd).map((t=>t.key))}getRenderableIds(t,a){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,t,a)&&d.push(this._tiles[y]);return t?d.sort(((y,b)=>{const S=y.tileID,I=b.tileID,D=new n.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),N=new n.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-I.overscaledZ||N.y-D.y||N.x-D.x})).map((y=>y.tileID.key)):d.map((y=>y.tileID)).sort(Sd).map((y=>y.key))}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,t,a)))}_tileLoaded(t,a,d,y,b){if(y){if(t.state="errored",y.status!==404)this._source.fire(new n.y(y,{tile:t}));else{if(this._source.fire(new n.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const I=this.map.painter.terrain;this.update(this.transform,I.getScaledDemTileSize(),!0),I.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=n.o.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let S=new Map;b&&b.responseHeaders&&(S=b.responseHeaders),this._source.fire(new n.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:S}))}_backfillDEM(t){const a=this.getRenderableIds();for(let y=0;y<a.length;y++){const b=a[y];if(t.neighboringTiles&&t.neighboringTiles[b]){const S=this.getTileByID(b);d(t,S),d(S,t)}}function d(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let S=b.tileID.canonical.x-y.tileID.canonical.x;const I=b.tileID.canonical.y-y.tileID.canonical.y,D=Math.pow(2,y.tileID.canonical.z),N=b.tileID.key;S===0&&I===0||Math.abs(I)>1||(Math.abs(S)>1&&(Math.abs(S+D)===1?S+=D:Math.abs(S-D)===1&&(S-=D)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,S,I),y.neighboringTiles&&y.neighboringTiles[N]&&(y.neighboringTiles[N].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,d,y){for(const b in this._tiles){let S=this._tiles[b];if(y[b]||!S.hasData()||S.tileID.overscaledZ<=a||S.tileID.overscaledZ>d)continue;let I=S.tileID;for(;S&&S.tileID.overscaledZ>a+1;){const N=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[N.key],S&&S.hasData()&&(I=N)}let D=I;for(;D.overscaledZ>a;)if(D=D.scaledTo(D.overscaledZ-1),t[D.key]){y[I.key]=I;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=t.overscaledZ-1;d>=a;d--){const y=t.scaledTo(d),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const d=Math.ceil(t.width/a)+1,y=Math.ceil(t.height/a)+1,b=Math.floor(d*y*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(I)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const d={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),d[b.tileID.key]=b}this._tiles=d;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(t,a,d,y,b){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let I,D=this._source.maxzoom;const N=this.map&&this.map.painter?this.map.painter._terrain:null;if(N&&N.sourceCache===this&&N.attenuationRange()){const X=N.attenuationRange()[0],Q=Math.floor(X)-Math.log2(N.getDemUpscale());D>Q&&(D=Q)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((X=>new n.aQ(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y)));else if(this.tileCoverLift!==0){const X=t.clone();X.tileCoverLift=this.tileCoverLift,I=X.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&t.projection.name==="globe"&&(I.push(new n.aQ(1,0,1,0,0)),I.push(new n.aQ(1,0,1,1,0)),I.push(new n.aQ(1,0,1,0,1)),I.push(new n.aQ(1,0,1,1,1)))}else if(I=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:D,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const X=this._source.hasTile.bind(this._source);I=I.filter((Q=>X(Q)))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!cu(this._source.type)){const X=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),Q=Math.min(X,this._source.maxzoom);if(S){const ae=t.extendTileCover(I,Q);for(const ie of ae)I.push(ie)}else if(b){const ae=t.extendTileCoverToNearPlane(I,this.transform.getFrustum(Q),Q);for(const ie of ae)I.push(ie)}else if(this.castsShadows&&y){const ae=t.extendTileCover(I,Q,y,16);for(const ie of ae)this._shadowCasterTiles[ie.key]=!0,I.push(ie)}}const V=this._updateRetainedTiles(I);if(cu(this._source.type)&&I.length!==0){const X={},Q={},ae=Object.keys(V);for(const ge of ae){const me=V[ge],Se=this._tiles[ge];if(!Se||Se.fadeEndTime&&Se.fadeEndTime<=n.o.now())continue;const De=this.findLoadedParent(me,Math.max(me.overscaledZ-Ho.maxOverzooming,this._source.minzoom));De&&(this._addTile(De.tileID),X[De.tileID.key]=De.tileID),Q[ge]=me}const ie=I[I.length-1].overscaledZ;for(const ge in this._tiles){const me=this._tiles[ge];if(V[ge]||!me.hasData())continue;let Se=me.tileID;for(;Se.overscaledZ>ie;){Se=Se.scaledTo(Se.overscaledZ-1);const De=this._tiles[Se.key];if(De&&De.hasData()&&Q[Se.key]){V[ge]=me.tileID;break}}}for(const ge in X)V[ge]||(this._coveredTiles[ge]=!0,V[ge]=X[ge])}for(const X in V)this._tiles[X].clearFadeHold();const K=n.bv(this._tiles,V);for(const X of K){const Q=this._tiles[X];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(+X)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(t.length===0)return a;const d={},y=t.reduce(((N,V)=>Math.min(N,V.overscaledZ)),1/0),b=t[0].overscaledZ,S=Math.max(b-Ho.maxOverzooming,this._source.minzoom),I=Math.max(b+Ho.maxUnderzooming,this._source.minzoom),D={};for(const N of t){const V=this._addTile(N);a[N.key]=N,V.hasData()||y<this._source.maxzoom&&(D[N.key]=N)}this._retainLoadedChildren(D,y,I,a);for(const N of t){let V=this._tiles[N.key];if(V.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const X=N.children(this._source.maxzoom)[0],Q=this.getTile(X);if(Q&&Q.hasData()){a[X.key]=X;continue}}else{const X=N.children(this._source.maxzoom);if(a[X[0].key]&&a[X[1].key]&&a[X[2].key]&&a[X[3].key])continue}let K=V.wasRequested();for(let X=N.overscaledZ-1;X>=S;--X){const Q=N.scaledTo(X);if(d[Q.key]||(d[Q.key]=!0,V=this.getTile(Q),!V&&K&&(V=this._addTile(Q)),V&&(a[Q.key]=Q,K=V.wasRequested(),V.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let d,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){d=this._loadedParentTiles[y.key];break}a.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;y=b}for(const b of a)this._loadedParentTiles[b]=d}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const d=!!a;if(!d){const y=this.map?this.map.painter:null,b=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new Mh(t,b,this.transform.tileZoom,y,this._isRaster):new Iu(t,b,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a.uses++,this._tiles[t.key]=a,d||this._source.fire(new n.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=a.getExpiryTimeout();d&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),d))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,d){const y=[],b=this.transform;if(!b)return y;const S=b.projection.name==="globe",I=n.aF(b.center.lng);for(const D in this._tiles){const N=this._tiles[D];if(d&&N.clearQueryDebugViz(),N.holdingForFade())continue;let V;if(S){const K=N.tileID.canonical;if(K.z===0){const X=[Math.abs(n.aA(I,...Wl(K,-1))-I),Math.abs(n.aA(I,...Wl(K,1))-I)];V=[0,2*X.indexOf(Math.min(...X))-1]}else{const X=[Math.abs(n.aA(I,...Wl(K,-1))-I),Math.abs(n.aA(I,...Wl(K,0))-I),Math.abs(n.aA(I,...Wl(K,1))-I)];V=[X.indexOf(Math.min(...X))-1]}}else V=[0];for(const K of V){const X=t.containsTile(N,b,a,K);X&&y.push(X)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){const d=this.getRenderableIds(t,a).map((b=>this._tiles[b].tileID)),y=this.transform.projection.name==="globe";for(const b of d)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return d}sortCoordinatesByDistance(t){const a=t.slice(),d=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const S of a){const I=1/(1<<S.canonical.z);b[S.key]=((S.canonical.x+.5)*I+S.wrap-d[0])*y[0]+((S.canonical.y+.5)*I-d[1])*y[1]-d[2]*y[2]}return a.sort(((S,I)=>b[S.key]-b[I.key])),a}hasTransition(){if(this._source.hasTransition())return!0;if(cu(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=n.o.now())return!0}return!1}setFeatureState(t,a,d){this._state.updateState(t=t||"_geojsonTileLayer",a,d)}removeFeatureState(t,a,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,d)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,d){const y=this._tiles[t];y&&y.setDependencies(a,d)}reloadTilesForDependencies(t,a){for(const d in this._tiles)this._tiles[d].hasDependency(t,a)&&this._reloadTile(+d,"reloading");this._cache.filter((d=>!d.hasDependency(t,a)))}_preloadTiles(t,a){if(!this._sourceLoaded){const D=()=>{this._sourceLoaded&&(this._source.off("data",D),this._preloadTiles(t,a))};return void this._source.on("data",D)}const d=new Map,y=Array.isArray(t)?t:[t],b=this.map.painter.terrain,S=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const D of y){const N=D.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const V of N)d.set(V.key,V);this.usedForTerrain&&D.updateElevation(!1)}const I=Array.from(d.values());n.bw(I,((D,N)=>{const V=new Iu(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(V,(K=>{this._source.type==="raster-dem"&&V.dem&&this._backfillDEM(V),N(K,V)}))}),a)}}function Sd(h,t){const a=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||d-a||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function cu(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Wl(h,t){const a=1<<h.z;return[h.x/a+t,(h.x+1)/a+t]}Ho.maxOverzooming=10,Ho.maxUnderzooming=3;class Ap{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,a=!1;for(const d in this.style._mergedLayers){const y=this.style._mergedLayers[d];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:t,visibilityChanged:a});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(const a of this.layers){const d=a.layer;let y=!1;d.type==="fill-extrusion"?y=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?y=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(y=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&a.visible,a.visible=y}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,S=this.style.getLayerSourceCache(b);let I=1;b.type==="fill-extrusion"?I=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(I=y.visible?b.paint.get("building-vertical-scale"):0);let D=S?S.getTile(a):null;if(!D&&S)for(const N in S._tiles){const V=S._tiles[N];if(a.canonical.isChildOf(V.tileID.canonical)){D=V;break}}this.currentBuildingBuckets.push({bucket:D?D.getBucket(b):null,tileID:D?D.tileID:a,verticalScale:I})}t.hasAnyZOffset=!1;let d=!1;for(let y=0;y<t.symbolInstances.length;y++){const b=t.symbolInstances.get(y),S=b.zOffset,I=this._getHeightAtTileOffset(a,b.tileAnchorX,b.tileAnchorY);b.zOffset=I!==Number.NEGATIVE_INFINITY?I:S,d||S===b.zOffset||(d=!0),t.hasAnyZOffset||b.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,d,y){let b=a,S=d;if(t.canonical.z!==y.canonical.z){const I=y.canonical,D=1/(1<<t.canonical.z-I.z);b=(a+t.canonical.x*n.al)*D-I.x*n.al|0,S=(d+t.canonical.y*n.al)*D-I.y*n.al|0}return{tileX:b,tileY:S}}_getHeightAtTileOffset(t,a,d){let y,b;for(let S=0;S<this.layers.length;++S){const I=this.layers[S].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:D,tileID:N,verticalScale:V}=this.currentBuildingBuckets[S];if(!D)continue;const{tileX:K,tileY:X}=this._mapCoordToOverlappingTile(t,a,d,N),Q=D.getHeightAtTileCoord(K,X);Q&&Q.height!==void 0&&(Q.hidden?y=Q.height:b=Math.max(Q.height*V,b||0))}if(b!==void 0)return b;for(let S=0;S<this.layers.length;++S){const I=this.layers[S];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:D,tileID:N}=this.currentBuildingBuckets[S];if(!D)continue;const{tileX:V,tileY:K}=this._mapCoordToOverlappingTile(t,a,d,N),X=D.getHeightAtTileCoord(V,K);if(X&&!X.hidden)return X.height===void 0&&y!==void 0?Math.min(X.maxHeight,y)*X.verticalScale:X.height?X.height*X.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Hd(h,t){const a={};for(const d in h)d!=="ref"&&(a[d]=h[d]);return n.bx.forEach((d=>{d in t&&(a[d]=t[d])})),a}function nh(h){h=h.slice();const t=Object.create(null);for(let a=0;a<h.length;a++)t[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=Hd(h[a],t[h[a].ref]));return h}const Qr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function rh(h,t,a){a.push({command:Qr.addSource,args:[h,t[h]]})}function qd(h,t,a){t.push({command:Qr.removeSource,args:[h]}),a[h]=!0}function Il(h,t,a,d){qd(h,a,d),rh(h,t,a)}function Cl(h,t,a){let d;for(d in h[a])if(h[a].hasOwnProperty(d)&&d!=="data"&&!n.by(h[a][d],t[a][d]))return!1;for(d in t[a])if(t[a].hasOwnProperty(d)&&d!=="data"&&!n.by(h[a][d],t[a][d]))return!1;return!0}function Cu(h,t,a,d,y,b){let S;for(S in t=t||{},h=h||{})h.hasOwnProperty(S)&&(n.by(h[S],t[S])||a.push({command:b,args:[d,S,t[S],y]}));for(S in t)t.hasOwnProperty(S)&&!h.hasOwnProperty(S)&&(n.by(h[S],t[S])||a.push({command:b,args:[d,S,t[S],y]}))}function zu(h){return h.id}function Ru(h,t){return h[t.id]=t,h}function uu(h,t,a){const d=t.createTileMatrix(h,h.worldSize,a.toUnwrapped());return n.aB(new Float32Array(16),h.projMatrix,d)}function ss(h,t,a){if(t.projection.name===a.projection.name)return h.projMatrix;const d=a.clone();return d.setProjection(t.projection),uu(d,t.getProjection(),h)}function zl(h,t,a){return t.name===a.projection.name?h.projMatrix:uu(a,t,h)}class Qh{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.aA(t,0,1);let a=1,d=this._distances[a];const y=t*this.paddedLength+this.padding;for(;d<y&&a<this._distances.length;)d=this._distances[++a];const b=a-1,S=this._distances[b],I=d-S,D=I>0?(y-S)/I:0;return this.points[b].mult(1-D).add(this.points[a].mult(D))}}class Ih{constructor(t,a,d){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(a/d);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,d,y,b){this._forEachCell(a,d,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(t,a,d,y){this._forEachCell(a-y,d-y,a+y,d+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(d),this.circles.push(y)}_insertBoxCell(t,a,d,y,b,S){this.boxCells[b].push(S)}_insertCircleCell(t,a,d,y,b,S){this.circleCells[b].push(S)}_query(t,a,d,y,b,S){if(d<0||t>this.width||y<0||a>this.height)return!b&&[];const I=[];if(t<=0&&a<=0&&this.width<=d&&this.height<=y){if(b)return!0;for(let D=0;D<this.boxKeys.length;D++)I.push({key:this.boxKeys[D],x1:this.bboxes[4*D],y1:this.bboxes[4*D+1],x2:this.bboxes[4*D+2],y2:this.bboxes[4*D+3]});for(let D=0;D<this.circleKeys.length;D++){const N=this.circles[3*D],V=this.circles[3*D+1],K=this.circles[3*D+2];I.push({key:this.circleKeys[D],x1:N-K,y1:V-K,x2:N+K,y2:V+K})}return S?I.filter(S):I}return this._forEachCell(t,a,d,y,this._queryCell,I,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?I.length>0:I}_queryCircle(t,a,d,y,b){const S=t-d,I=t+d,D=a-d,N=a+d;if(I<0||S>this.width||N<0||D>this.height)return!y&&[];const V=[];return this._forEachCell(S,D,I,N,this._queryCellCircle,V,{hitTest:y,circle:{x:t,y:a,radius:d},seenUids:{box:{},circle:{}}},b),y?V.length>0:V}query(t,a,d,y,b){return this._query(t,a,d,y,!1,b)}hitTest(t,a,d,y,b){return this._query(t,a,d,y,!0,b)}hitTestCircle(t,a,d,y){return this._queryCircle(t,a,d,!0,y)}_queryCell(t,a,d,y,b,S,I,D){const N=I.seenUids,V=this.boxCells[b];if(V!==null){const X=this.bboxes;for(const Q of V)if(!N.box[Q]){N.box[Q]=!0;const ae=4*Q;if(t<=X[ae+2]&&a<=X[ae+3]&&d>=X[ae+0]&&y>=X[ae+1]&&(!D||D(this.boxKeys[Q]))){if(I.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Q],x1:X[ae],y1:X[ae+1],x2:X[ae+2],y2:X[ae+3]})}}}const K=this.circleCells[b];if(K!==null){const X=this.circles;for(const Q of K)if(!N.circle[Q]){N.circle[Q]=!0;const ae=3*Q;if(this._circleAndRectCollide(X[ae],X[ae+1],X[ae+2],t,a,d,y)&&(!D||D(this.circleKeys[Q]))){if(I.hitTest)return S.push(!0),!0;{const ie=X[ae],ge=X[ae+1],me=X[ae+2];S.push({key:this.circleKeys[Q],x1:ie-me,y1:ge-me,x2:ie+me,y2:ge+me})}}}}}_queryCellCircle(t,a,d,y,b,S,I,D){const N=I.circle,V=I.seenUids,K=this.boxCells[b];if(K!==null){const Q=this.bboxes;for(const ae of K)if(!V.box[ae]){V.box[ae]=!0;const ie=4*ae;if(this._circleAndRectCollide(N.x,N.y,N.radius,Q[ie+0],Q[ie+1],Q[ie+2],Q[ie+3])&&(!D||D(this.boxKeys[ae])))return S.push(!0),!0}}const X=this.circleCells[b];if(X!==null){const Q=this.circles;for(const ae of X)if(!V.circle[ae]){V.circle[ae]=!0;const ie=3*ae;if(this._circlesCollide(Q[ie],Q[ie+1],Q[ie+2],N.x,N.y,N.radius)&&(!D||D(this.circleKeys[ae])))return S.push(!0),!0}}}_forEachCell(t,a,d,y,b,S,I,D){const N=this._convertToXCellCoord(t),V=this._convertToYCellCoord(a),K=this._convertToXCellCoord(d),X=this._convertToYCellCoord(y);for(let Q=N;Q<=K;Q++)for(let ae=V;ae<=X;ae++)if(b.call(this,t,a,d,y,this.xCellCount*ae+Q,S,I,D))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,d,y,b,S){const I=y-t,D=b-a,N=d+S;return N*N>I*I+D*D}_circleAndRectCollide(t,a,d,y,b,S,I){const D=(S-y)/2,N=Math.abs(t-(y+D));if(N>D+d)return!1;const V=(I-b)/2,K=Math.abs(a-(b+V));if(K>V+d)return!1;if(N<=D||K<=V)return!0;const X=N-D,Q=K-V;return X*X+Q*Q<=d*d}}const ed={unknown:0,flipRequired:1,flipNotRequired:2},td=Math.tan(85*Math.PI/180);function Rl(h,t,a,d,y,b,S){const I=n.bC();if(a)if(b.name==="globe"){const D=n.bD(y,t);n.aB(I,I,D)}else{const D=n.bE([],S);I[0]=D[0],I[1]=D[1],I[4]=D[2],I[5]=D[3],d||n.bB(I,I,y.angle)}else n.aB(I,y.labelPlaneMatrix,h);return I}function Ed(h,t,a,d,y,b,S){const I=Rl(h,t,a,d,y,b,S);return b.name==="globe"&&a||(I[2]=I[6]=I[10]=I[14]=0),I}function Ad(h,t,a,d,y,b,S){if(a){if(b.name==="globe"){const I=Rl(h,t,a,d,y,b,S);return n.bl(I,I),n.aB(I,h,I),I}{const I=n.bz(h),D=n.bA([]);return D[0]=S[0],D[1]=S[1],D[4]=S[2],D[5]=S[3],n.aB(I,I,D),d||n.bB(I,I,-y.angle),I}}return y.glCoordMatrix}function Gc(h,t,a,d){const y=[h,t,a,1];a?n.aC(y,y,d):En(y,y,d);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function Ia(h,t){return Math.min(.5+h/t*.5,1.5)}function Mp(h,t){const a=h[0]/h[3],d=h[1]/h[3];return a>=-t[0]&&a<=t[0]&&d>=-t[1]&&d<=t[1]}function Ip(h,t,a,d,y,b,S,I,D,N,V=1){const K=a.transform,X=d?h.textSizeData:h.iconSizeData,Q=n.bK(X,a.transform.zoom,V),ae=K.projection.name==="globe",ie=[256/a.width*2+1,256/a.height*2+1],ge=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ge.clear();let me=null;ae&&(me=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const Se=h.lineVertexArray,De=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,Ee=a.transform.width/a.transform.height;let We,Ve=!1;for(let He=0;He<De.length;He++){const Ne=De.get(He),{numGlyphs:Oe,writingMode:nt}=Ne;if(nt!==n.bL.vertical||Ve||We===n.bL.horizontal||(Ve=!0),We=nt,(Ne.hidden||nt===n.bL.vertical)&&!Ve){zc(Oe,ge);continue}Ve=!1;const mt=new n.P(Ne.tileAnchorX,Ne.tileAnchorY),dt=h.elevationType==="road",At=!!K.elevation||dt;let{x:Ct,y:Dt,z:Kt}=K.projection.projectTilePoint(mt.x,mt.y,N.canonical),vt=null;if(At){const en=dt?h.getElevationFeatureForText(He):null;vt={getElevation:D,elevation:K.elevation,elevationFeature:en};const[bn,ar,jr]=D(mt,K.elevation,en);Ct+=bn,Dt+=ar,Kt+=jr}const rt=[Ct,Dt,Kt,1];if(n.aC(rt,rt,t),!Mp(rt,ie)){zc(Oe,ge);continue}const Nt=rt[3],Lt=Ia(a.transform.getCameraToCenterDistance(K.projection),Nt),li=n.bM(X,Q,Ne),Mi=S?li/Lt:li*Lt,ki=Gc(Ct,Dt,Kt,y);if(ki[3]<=0){zc(Oe,ge);continue}let Ei={};const _i=n.an(h.layers[0].layout.get("text-max-angle")),fn=Math.cos(_i),nn=S?null:vt,$i=Cp(Ne,Mi,!1,I,t,y,b,h.glyphOffsetArray,Se,ge,me,ki,mt,Ei,Ee,nn,K.projection,N,S,fn);Ve=$i.useVertical,nn&&$i.needsFlipping&&(Ei={}),($i.notEnoughRoom||Ve||$i.needsFlipping&&Cp(Ne,Mi,!0,I,t,y,b,h.glyphOffsetArray,Se,ge,me,ki,mt,Ei,Ee,nn,K.projection,N,S,fn).notEnoughRoom)&&zc(Oe,ge)}d?(h.text.dynamicLayoutVertexBuffer.updateData(ge),me&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(me)):(h.icon.dynamicLayoutVertexBuffer.updateData(ge),me&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(me))}function Ch(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge){const{lineStartIndex:me,glyphStartIndex:Se,segment:De}=I,Ee=Se+I.numGlyphs,We=me+I.lineLength,Ve=t.getoffsetX(Se),He=t.getoffsetX(Ee-1),Ne=id(h*Ve,a,d,y,b,S,De,me,We,D,N,V,K,X,!0,Q,ae,ie,ge);if(!Ne)return null;const Oe=id(h*He,a,d,y,b,S,De,me,We,D,N,V,K,X,!0,Q,ae,ie,ge);return Oe?{first:Ne,last:Oe}:null}function Hn(h,t,a,d){return h===n.bL.horizontal&&Math.abs(d)>Math.abs(a)?{useVertical:!0}:h===n.bL.vertical?d>0?{needsFlipping:!0}:null:t!==ed.unknown&&(function(y,b){return y===0||Math.abs(b/y)>td})(a,d)?t===ed.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Cp(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge,me,Se,De){const Ee=t/24,We=h.lineOffsetX*Ee,Ve=h.lineOffsetY*Ee,{lineStartIndex:He,glyphStartIndex:Ne,numGlyphs:Oe,segment:nt,writingMode:mt,flipState:dt}=h,At=He+h.lineLength,Ct=Dt=>{if(V){const[Nt,Lt,li]=Dt.up,Mi=N.length;n.bN(V,Mi+0,Nt,Lt,li),n.bN(V,Mi+1,Nt,Lt,li),n.bN(V,Mi+2,Nt,Lt,li),n.bN(V,Mi+3,Nt,Lt,li)}const[Kt,vt,rt]=Dt.point;n.bO(N,Kt,vt,rt,Dt.angle)};if(Oe>1){const Dt=Ch(Ee,I,We,Ve,a,K,X,h,D,b,Q,ie,!1,ge,me,Se,De);if(!Dt)return{notEnoughRoom:!0};if(d&&!a){let[Kt,vt,rt]=Dt.first.point,[Nt,Lt,li]=Dt.last.point;[Kt,vt]=Gc(Kt,vt,rt,S),[Nt,Lt]=Gc(Nt,Lt,li,S);const Mi=Hn(mt,dt,(Nt-Kt)*ae,Lt-vt);if(h.flipState=Mi&&Mi.needsFlipping?ed.flipRequired:ed.flipNotRequired,Mi)return Mi}Ct(Dt.first);for(let Kt=Ne+1;Kt<Ne+Oe-1;Kt++){const vt=id(Ee*I.getoffsetX(Kt),We,Ve,a,K,X,nt,He,At,D,b,Q,ie,!1,!1,ge,me,Se,De);if(!vt)return N.length-=4*(Kt-Ne),{notEnoughRoom:!0};Ct(vt)}Ct(Dt.last)}else{if(d&&!a){const Kt=Gc(X.x,X.y,0,y),vt=He+nt+1,rt=new n.P(D.getx(vt),D.gety(vt)),Nt=Gc(rt.x,rt.y,0,y),Lt=Nt[3]>0?Nt:Xl(X,rt,Kt,1,y,void 0,ge,me.canonical),li=Hn(mt,dt,(Lt[0]-Kt[0])*ae,Lt[1]-Kt[1]);if(h.flipState=li&&li.needsFlipping?ed.flipRequired:ed.flipNotRequired,li)return li}const Dt=id(Ee*I.getoffsetX(Ne),We,Ve,a,K,X,nt,He,At,D,b,Q,ie,!1,!1,ge,me,Se,De);if(!Dt)return{notEnoughRoom:!0};Ct(Dt)}return{}}function $d(h,t,a,d,y){const{x:b,y:S,z:I}=d.projectTilePoint(h.x,h.y,t);if(!y)return Gc(b,S,I,a);const[D,N,V]=y.getElevation(h,y.elevation,y.elevationFeature);return Gc(b+D,S+N,I+V,a)}function Xl(h,t,a,d,y,b,S,I){const D=$d(h.sub(t)._unit()._add(h),I,y,S,b);return n.av(D,a,D),n.aw(D,D),n.bH(D,a,D,d)}function id(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge,me,Se){const De=d?h-t:h+t;let Ee=De>0?1:-1,We=0;d&&(Ee*=-1,We=Math.PI),Ee<0&&(We+=Math.PI);let Ve=I+S+(Ee>0?0:1)|0,He=y,Ne=y,Oe=0,nt=0;const mt=Math.abs(De),dt=[],At=[];let Ct=b,Dt=Ct,Kt=n.bF([]);const vt=()=>Xl(Dt,Ct,Ne,mt-Oe+1,V,X,ie,ge.canonical);for(;Oe+nt<=mt;){if(Ve+=Ee,Ve<I||Ve>=D)return null;if(Ne=He,Dt=Ct,dt.push(Ne),Q&&At.push(Dt),Ct=new n.P(N.getx(Ve),N.gety(Ve)),He=K[Ve],!He){const nn=$d(Ct,ge.canonical,V,ie,X);He=nn[3]>0?K[Ve]=nn:vt()}Oe+=nt;const _i=n.av([],He,Ne),fn=n.bG(Ne,He);if(a&&fn>0&&nt>0&&n.bJ(Kt,_i)/(nt*fn)<Se)return null;nt=fn,Kt=_i}ae&&X&&(K[Ve]&&(He=vt(),nt=n.bG(Ne,He),Kt=n.av([],He,Ne)),K[Ve]=He);const rt=(mt-Oe)/nt,Nt=Ct.sub(Dt)._mult(rt)._add(Dt),Lt=n.bH([],Ne,Kt,rt);let li=[0,0,1],Mi=Kt[0],ki=Kt[1];if(me&&(li=ie.upVector(ge.canonical,Nt.x,Nt.y),li[0]!==0||li[1]!==0||li[2]!==1)){const _i=[li[2],0,-li[0]],fn=n.bI([],li,_i);n.aw(_i,_i),n.aw(fn,fn),Mi=n.bJ(Kt,_i),ki=n.bJ(Kt,fn)}if(a){const _i=n.bI([],li,Kt);n.aw(_i,_i),n.bH(Lt,Lt,_i,a*Ee)}const Ei=We+Math.atan2(ki,Mi);return dt.push(Lt),Q&&At.push(Nt),{point:Lt,angle:Ei,path:dt,tilePath:At,up:li}}function zc(h,t){const a=t.length,d=a+4*h;t.resize(d),t.float32.fill(-1/0,4*a,4*d)}function En(h,t,a){const d=t[0],y=t[1];return h[0]=a[0]*d+a[4]*y+a[12],h[1]=a[1]*d+a[5]*y+a[13],h[3]=a[3]*d+a[7]*y+a[15],h}const ra=100;class Ca{constructor(t,a,d=new Ih(t.width+200,t.height+200,25),y=new Ih(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ra,this.screenBottomBoundary=t.height+ra,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,d,y,b,S,I,D,N,V,K){let X=d.projectedAnchorX,Q=d.projectedAnchorY,ae=d.projectedAnchorZ;const ie=d.tileAnchorX,ge=d.tileAnchorY,me=d.elevation,Se=d.tileID,De=t.getProjection();if(me&&Se){const[At,Ct,Dt]=De.upVector(Se.canonical,d.tileAnchorX,d.tileAnchorY),Kt=De.upVectorScale(Se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;X+=At*me*Kt,Q+=Ct*me*Kt,ae+=Dt*me*Kt}const Ee=t.projection.name==="globe",We=t.projection.name==="globe"?n.aj(this.transform.zoom):0;if(Se&&Ee&&We<1&&!S){const At=1<<Se.canonical.z,Ct=n.bP(ie,ge);n.bQ(Ct,Ct,1/n.al),n.bR(Ct,Ct,n.bP(Se.canonical.x,Se.canonical.y)),n.bQ(Ct,Ct,1/At),n.bS(Ct,Ct,n.bP(y[0],y[1])),Ct[0]=n.bT(Ct[0],-.5,.5),n.bQ(Ct,Ct,n.al);const Dt=n.bU(Ct[0],Ct[1],n.al/(2*Math.PI),1);n.aC(Dt,Dt,b),X=n.ak(X,Dt[0],We),Q=n.ak(Q,Dt[1],We),ae=n.ak(ae,Dt[2],We)}const Ve=this.projectAndGetPerspectiveRatio(V,X,Q,ae,d.tileID,De.name==="globe"||!!me||this.transform.pitch>0,De),He=N*Ve.perspectiveRatio,Ne=(d.x1*a+I.x-d.padding)*He+Ve.point.x,Oe=(d.y1*a+I.y-d.padding)*He+Ve.point.y,nt=(d.x2*a+I.x+d.padding)*He+Ve.point.x,mt=(d.y2*a+I.y+d.padding)*He+Ve.point.y,dt=Ve.perspectiveRatio<=.55||Ve.occluded;return!this.isInsideGrid(Ne,Oe,nt,mt)||!D&&this.grid.hitTest(Ne,Oe,nt,mt,K)||dt?{box:[],offscreen:!1,occluded:Ve.occluded}:{box:[Ne,Oe,nt,mt],offscreen:this.isOffscreen(Ne,Oe,nt,mt),occluded:!1}}placeCollisionCircles(t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge){const me=[],Se=this.transform.elevation,De=t.getProjection(),Ee=t.elevationType==="road",We=!!Se||Ee,Ve=n.bV.getAtTileOffsetFunc(ge,this.transform.center.lat,this.transform.worldSize,De),He=new n.P(d.tileAnchorX,d.tileAnchorY),Ne=new n.P(d.tileAnchorX,d.tileAnchorY);let{x:Oe,y:nt,z:mt}=De.projectTilePoint(Ne.x,Ne.y,ge.canonical),dt=null;if(We){const fn=Ee?t.getElevationFeatureForText(y):null;dt={getElevation:Ve,elevation:Se,elevationFeature:fn};const[nn,$i,en]=Ve(He,Se,fn);Oe+=nn,nt+=$i,mt+=en}const At=De.name==="globe",Ct=this.projectAndGetPerspectiveRatio(D,Oe,nt,mt,ge,At||!!Se||this.transform.pitch>0,De),{perspectiveRatio:Dt}=Ct,Kt=(X?I/Dt:I*Dt)/n.bY,vt=Gc(Oe,nt,mt,N),rt=d.lineOffsetX*Kt,Nt=d.lineOffsetY*Kt,Lt=n.an(t.layers[0].layout.get("text-max-angle")),li=Math.cos(Lt),Mi=Ct.signedDistanceFromCamera>0?Ch(Kt,S,rt,Nt,Ee&&d.flipState===1,vt,Ne,d,b,N,{},We&&!X?dt:null,X&&We,De,ge,X,li):null;let ki=!1,Ei=!1,_i=!0;if(Mi&&!Ct.occluded){const fn=.5*ae*Dt+ie,nn=new n.P(-100,-100),$i=new n.P(this.screenRightBoundary,this.screenBottomBoundary),en=new Qh,{first:bn,last:ar}=Mi,jr=bn.path.length;let Ea=[];for(let Jn=jr-1;Jn>=1;Jn--)Ea.push(bn.path[Jn]);for(let Jn=1;Jn<ar.path.length;Jn++)Ea.push(ar.path[Jn]);const _n=2.5*fn;V&&(Ea=Ea.map((([Jn,xr,Zr],ta)=>(We&&!At&&(Zr=Ve(ta<jr-1?bn.tilePath[jr-1-ta]:ar.tilePath[ta-jr+2],Se,dt.elevationFeature)[2]),Gc(Jn,xr,Zr,V)))),Ea.some((Jn=>Jn[3]<=0))&&(Ea=[]));let ca=[];if(Ea.length>0){let Jn=1/0,xr=-1/0,Zr=1/0,ta=-1/0;for(const Wr of Ea)Jn=Math.min(Jn,Wr[0]),Zr=Math.min(Zr,Wr[1]),xr=Math.max(xr,Wr[0]),ta=Math.max(ta,Wr[1]);xr>=nn.x&&Jn<=$i.x&&ta>=nn.y&&Zr<=$i.y&&(ca=[Ea.map((Wr=>new n.P(Wr[0],Wr[1])))],(Jn<nn.x||xr>$i.x||Zr<nn.y||ta>$i.y)&&(ca=n.bW(ca,nn.x,nn.y,$i.x,$i.y)))}for(const Jn of ca){en.reset(Jn,.25*fn);let xr=0;xr=en.length<=.5*fn?1:Math.ceil(en.paddedLength/_n)+1;for(let Zr=0;Zr<xr;Zr++){const ta=Zr/Math.max(xr-1,1),Wr=en.lerp(ta),_r=Wr.x+ra,Aa=Wr.y+ra;me.push(_r,Aa,fn,0);const Hs=_r-fn,Za=Aa-fn,ba=_r+fn,zr=Aa+fn;if(_i=_i&&this.isOffscreen(Hs,Za,ba,zr),Ei=Ei||this.isInsideGrid(Hs,Za,ba,zr),!a&&this.grid.hitTestCircle(_r,Aa,fn,Q)&&(ki=!0,!K))return{circles:[],offscreen:!1,collisionDetected:ki,occluded:!1}}}}return{circles:!K&&ki||!Ei?[]:me,offscreen:_i,collisionDetected:ki,occluded:Ct.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,y=1/0,b=-1/0,S=-1/0;for(const V of t){const K=new n.P(V.x+ra,V.y+ra);d=Math.min(d,K.x),y=Math.min(y,K.y),b=Math.max(b,K.x),S=Math.max(S,K.y),a.push(K)}const I=this.grid.query(d,y,b,S).concat(this.ignoredGrid.query(d,y,b,S)),D={},N={};for(const V of I){const K=V.key;if(D[K.bucketInstanceId]===void 0&&(D[K.bucketInstanceId]={}),D[K.bucketInstanceId][K.featureIndex])continue;const X=[new n.P(V.x1,V.y1),new n.P(V.x2,V.y1),new n.P(V.x2,V.y2),new n.P(V.x1,V.y2)];n.bX(a,X)&&(D[K.bucketInstanceId][K.featureIndex]=!0,N[K.bucketInstanceId]===void 0&&(N[K.bucketInstanceId]=[]),N[K.bucketInstanceId].push(K.featureIndex))}return N}insertCollisionBox(t,a,d,y,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:b},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,d,y,b){const S=a?this.ignoredGrid:this.grid,I={bucketInstanceId:d,featureIndex:y,collisionGroupID:b};for(let D=0;D<t.length;D+=4)S.insertCircle(I,t[D],t[D+1],t[D+2])}projectAndGetPerspectiveRatio(t,a,d,y,b,S,I){const D=[a,d,y,1];let N=!1;y||this.transform.pitch>0?(n.aC(D,D,t),this.fogState&&b&&I.name!=="globe"&&(N=(function(X,Q,ae,ie,ge,me){const Se=me.calculateFogTileMatrix(ge),De=[Q,ae,ie];return n.af(De,De,Se),Ji(X,n.ag(De),me.pitch,me._fov)})(this.fogState,a,d,y,b.toUnwrapped(),this.transform)>.9)):En(D,D,t);const V=D[3];return{point:new n.P((D[0]/V+1)/2*this.transform.width+ra,(-D[1]/V+1)/2*this.transform.height+ra),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/V*.5,1.5),signedDistanceFromCamera:V,occluded:S&&D[2]>V||N}}isOffscreen(t,a,d,y){return d<ra||t>=this.screenRightBoundary||y<ra||a>this.screenBottomBoundary}isInsideGrid(t,a,d,y){return d>=0&&t<this.gridRightBoundary&&y>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=n.bA([]);return n.br(t,t,[-100,-100,0]),t}}class Yl{constructor(t,a,d,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):y&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Du{constructor(t,a,d,y,b,S=!1){this.text=new Yl(t?t.text:null,a,d,b),this.icon=new Yl(t?t.icon:null,a,y,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Sa{constructor(t,a,d,y=!1){this.text=t,this.icon=a,this.skipFade=d,this.clipped=y}}class Mf{constructor(){this.invProjMatrix=n.bC(),this.viewportMatrix=n.bC(),this.circles=[]}}class nd{constructor(t,a,d,y,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=y,this.tileID=b}}class Hc{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[t]}}function rl(h,t,a,d,y){const{horizontalAlign:b,verticalAlign:S}=n.c1(h),I=-(b-.5)*t,D=-(S-.5)*a,N=n.c2(h,d);return new n.P(I+N[0]*y,D+N[1]*y)}function so(h,t,a,d,y){const b=new n.P(h,t);return a&&b._rotate(d?y:-y),b}class zp{constructor(t,a,d,y,b,S){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Ca(this.transform,b),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Hc(d),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,a,d,y,b=1){const S=d.getBucket(a),I=d.latestFeatureIndex;if(!S||!I||a.fqid!==S.layerIds[0])return;const D=S.layers[0].layout,N=S.layers[0].paint,V=d.collisionBoxArray,K=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),X=d.tileSize/n.al,Q=d.tileID.toUnwrapped();this.transform.setProjection(S.projection);const ae=(ie=d.tileID,ge=S.getProjection(),me=this.transform,ge.name===this.projection?me.calculateProjMatrix(ie.toUnwrapped()):uu(me,ge,ie));var ie,ge,me;const Se=D.get("text-pitch-alignment")==="map",De=D.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const Ee=a.dynamicFilter(),We=a.dynamicFilterNeedsFeature(),Ve=this.transform.calculatePixelsToTileUnitsMatrix(d),He=Ed(ae,d.tileID.canonical,Se,De,this.transform,S.getProjection(),Ve);let Ne=null;const Oe=S.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(Se){const rt=Ad(ae,d.tileID.canonical,Se,De,this.transform,S.getProjection(),Ve);Ne=n.aB([],this.transform.labelPlaneMatrix,rt)}let nt=null;Ee&&d.latestFeatureIndex&&(nt={unwrappedTileID:Q,dynamicFilter:Ee,dynamicFilterNeedsFeature:We}),this.retainedQueryData[S.bucketInstanceId]=new nd(S.bucketInstanceId,I,S.sourceLayerIndex,S.index,d.tileID);const[mt,dt]=S.layers[0].layout.get("text-size-scale-range"),At=n.aA(b,mt,dt),[Ct,Dt]=D.get("icon-size-scale-range"),Kt=n.aA(b,Ct,Dt),vt={bucket:S,layout:D,paint:N,posMatrix:ae,invMatrix:Oe,mercatorCenter:[n.aF(this.transform.center.lng),n.aJ(this.transform.center.lat)],textLabelPlaneMatrix:He,labelToScreenMatrix:Ne,clippingData:nt,scale:K,textPixelRatio:X,holdingForFade:d.holdingForFade(),collisionBoxArray:V,partiallyEvaluatedTextSize:n.bK(S.textSizeData,this.transform.zoom,At),partiallyEvaluatedIconSize:n.bK(S.iconSizeData,this.transform.zoom,Kt),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(y)for(const rt of S.sortKeyRanges){const{sortKey:Nt,symbolInstanceStart:Lt,symbolInstanceEnd:li}=rt;t.push({sortKey:Nt,symbolInstanceStart:Lt,symbolInstanceEnd:li,parameters:vt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:vt})}attemptAnchorPlacement(t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge,me,Se,De,Ee,We){const{textOffset0:Ve,textOffset1:He,crossTileID:Ne}=ie,Oe=[Ve,He],nt=rl(t,S,I,Oe,D),mt=this.collisionIndex.placeCollisionBox(me,D,a,d,y,b,so(nt.x,nt.y,N,V,this.transform.angle),ae,K,X,Q.predicate);if(De){const dt=me.getSymbolInstanceIconSize(We,this.transform.zoom,ie.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(me,dt,De,d,y,b,so(nt.x,nt.y,N,V,this.transform.angle),ae,K,X,Q.predicate).box.length===0)return}if(mt.box.length>0){let dt;return this.prevPlacement&&this.prevPlacement.variableOffsets[Ne]&&this.prevPlacement.placements[Ne]&&this.prevPlacement.placements[Ne].text&&(dt=this.prevPlacement.variableOffsets[Ne].anchor),this.variableOffsets[Ne]={textOffset:Oe,width:S,height:I,anchor:t,textScale:D,prevAnchor:dt},this.markUsedJustification(me,t,ie,Se),me.allowVerticalPlacement&&(this.markUsedOrientation(me,Se,ie),this.placedOrientations[Ne]=Se),{shift:nt,placedGlyphBoxes:mt}}}placeLayerBucketPart(t,a,d,y,b=1){const{bucket:S,layout:I,paint:D,posMatrix:N,textLabelPlaneMatrix:V,labelToScreenMatrix:K,clippingData:X,textPixelRatio:Q,mercatorCenter:ae,invMatrix:ie,holdingForFade:ge,collisionBoxArray:me,partiallyEvaluatedTextSize:Se,partiallyEvaluatedIconSize:De,collisionGroup:Ee,latestFeatureIndex:We}=t.parameters,Ve=I.get("text-optional"),He=I.get("icon-optional"),Ne=I.get("text-allow-overlap"),Oe=I.get("icon-allow-overlap"),nt=I.get("text-rotation-alignment")==="map",mt=I.get("icon-rotation-alignment")==="map",dt=I.get("text-pitch-alignment")==="map",At=D.get("symbol-z-offset"),Ct=I.get("symbol-elevation-reference")==="sea",Dt=I.get("symbol-placement"),[Kt,vt]=I.get("text-size-scale-range"),[rt,Nt]=I.get("icon-size-scale-range"),Lt=n.aA(b,Kt,vt),li=n.aA(b,rt,Nt),Mi=I.get("text-variable-anchor"),ki=nt&&Dt!=="point",Ei=mt&&Dt!=="point",_i=Mi&&S.hasTextData(),fn=S.hasIconTextFit()&&_i&&S.hasIconData();this.transform.setProjection(S.projection);const nn=_i||ki,$i=Ei||fn;let en=Ne&&(Oe||!S.hasIconData()||He),bn=Oe&&(Ne||!S.hasTextData()||Ve);const ar=!At.isConstant();!S.collisionArrays&&me&&S.deserializeCollisionBoxes(me),d&&y&&S.updateCollisionDebugBuffers(this.transform.zoom,me,Lt,li);const jr=(_n,ca,Jn)=>{const{crossTileID:xr,numVerticalGlyphVertices:Zr}=_n;let ta=null;if(X&&X.dynamicFilterNeedsFeature||ar){const qs=this.retainedQueryData[S.bucketInstanceId];ta=We.loadFeature({featureIndex:_n.featureIndex,bucketIndex:qs.bucketIndex,sourceLayerIndex:qs.sourceLayerIndex,layoutVertexArrayOffset:0});const fo=ta.properties?ta.properties.worldview:null;if(S.localizable&&S.worldview&&typeof fo=="string")if(fo==="all")ta.properties.$localized=!0;else{if(!fo.split(",").includes(S.worldview))return;ta.properties.$localized=!0,ta.properties.worldview=S.worldview}}if(X&&!(0,X.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:S.worldview},ta,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new n.P(_n.tileAnchorX,_n.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[xr]=new Sa(!1,!1,!1,!0),void a.add(xr);const Wr=At.evaluate(ta,{});if(a.has(xr))return;if(ge)return void(this.placements[xr]=new Sa(!1,!1,!1));let _r=!1,Aa=!1,Hs=!0,Za=!1,ba=!1,zr=null,yr={box:null,offscreen:null,occluded:null},ga={box:null},As=null,Ms=null,Wa=null,No=0,el=0,ho=0;Jn.textFeatureIndex?No=Jn.textFeatureIndex:_n.useRuntimeCollisionCircles&&(No=_n.featureIndex),Jn.verticalTextFeatureIndex&&(el=Jn.verticalTextFeatureIndex);const $o=S.elevationFeatures?S.elevationFeatures[_n.elevationFeatureIndex]:void 0,Vl=qs=>{qs.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const fo=this.transform.elevation;qs.elevation=Ct?Wr:Wr+n.bV.getAtTileOffset(qs.tileID,new n.P(qs.tileAnchorX,qs.tileAnchorY),fo,$o),qs.elevation+=_n.zOffset},dl=Jn.textBox;if(dl){Vl(dl);const qs=Ua=>{let $s=n.bL.horizontal;if(S.allowVerticalPlacement&&!Ua&&this.prevPlacement){const Os=this.prevPlacement.placedOrientations[xr];Os&&(this.placedOrientations[xr]=Os,$s=Os,this.markUsedOrientation(S,$s,_n))}return $s},fo=(Ua,$s)=>{if(S.allowVerticalPlacement&&Zr>0&&Jn.verticalTextBox){for(const Os of S.writingModes)if(Os===n.bL.vertical?(yr=$s(),ga=yr):yr=Ua(),yr&&yr.box&&yr.box.length)break}else yr=Ua()};if(Mi){let Ua=Mi;if(this.prevPlacement&&this.prevPlacement.variableOffsets[xr]){const Is=this.prevPlacement.variableOffsets[xr];Ua.indexOf(Is.anchor)>0&&(Ua=Ua.filter((ic=>ic!==Is.anchor)),Ua.unshift(Is.anchor))}const $s=(Is,ic,jd)=>{const Yu=S.getSymbolInstanceTextSize(Se,_n,this.transform.zoom,ca),vf=(Is.x2-Is.x1)*Yu+2*Is.padding,Zh=(Is.y2-Is.y1)*Yu+2*Is.padding,vh=_n.hasIconTextFit&&!Oe?ic:null;vh&&Vl(vh);let xh={box:[],offscreen:!1,occluded:!1};const xf=Ne?2*Ua.length:Ua.length;for(let tl=0;tl<xf;++tl){const Au=this.attemptAnchorPlacement(Ua[tl%Ua.length],Is,ae,ie,nn,vf,Zh,Yu,nt,dt,Q,N,Ee,tl>=Ua.length,_n,ca,S,jd,vh,Se,De);if(Au&&(xh=Au.placedGlyphBoxes,xh&&xh.box&&xh.box.length)){_r=!0,zr=Au.shift;break}}return xh};fo((()=>$s(dl,Jn.iconBox,n.bL.horizontal)),(()=>{const Is=Jn.verticalTextBox;return Is&&Vl(Is),S.allowVerticalPlacement&&!(yr&&yr.box&&yr.box.length)&&Zr>0&&Is?$s(Is,Jn.verticalIconBox,n.bL.vertical):{box:null,offscreen:null,occluded:null}})),yr&&(_r=yr.box,Hs=yr.offscreen,Za=yr.occluded);const Os=qs(!(!yr||!yr.box));if(!_r&&this.prevPlacement){const Is=this.prevPlacement.variableOffsets[xr];Is&&(this.variableOffsets[xr]=Is,this.markUsedJustification(S,Is.anchor,_n,Os))}}else{const Ua=($s,Os)=>{const Is=S.getSymbolInstanceTextSize(Se,_n,this.transform.zoom,ca),ic=this.collisionIndex.placeCollisionBox(S,Is,$s,ae,ie,nn,new n.P(0,0),Ne,Q,N,Ee.predicate);return ic&&ic.box&&ic.box.length&&(this.markUsedOrientation(S,Os,_n),this.placedOrientations[xr]=Os),ic};fo((()=>Ua(dl,n.bL.horizontal)),(()=>{const $s=Jn.verticalTextBox;return S.allowVerticalPlacement&&Zr>0&&$s?(Vl($s),Ua($s,n.bL.vertical)):{box:null,offscreen:null,occluded:null}})),qs(!!(yr&&yr.box&&yr.box.length))}}if(As=yr,_r=As&&As.box&&As.box.length>0,Hs=As&&As.offscreen,Za=As&&As.occluded,_n.useRuntimeCollisionCircles){const qs=_n.centerJustifiedTextSymbolIndex>=0?_n.centerJustifiedTextSymbolIndex:_n.verticalPlacedTextSymbolIndex,fo=S.text.placedSymbolArray.get(qs),Ua=n.bM(S.textSizeData,Se,fo),$s=I.get("text-padding");Ms=this.collisionIndex.placeCollisionCircles(S,Ne,fo,qs,S.lineVertexArray,S.glyphOffsetArray,Ua,N,V,K,d,dt,Ee.predicate,_n.collisionCircleDiameter*Ua/n.bY,$s,this.retainedQueryData[S.bucketInstanceId].tileID),_r=Ne||Ms.circles.length>0&&!Ms.collisionDetected,Hs=Hs&&Ms.offscreen,Za=Ms.occluded}if(Jn.iconFeatureIndex&&(ho=Jn.iconFeatureIndex),Jn.iconBox){const qs=fo=>{Vl(fo);const Ua=_n.hasIconTextFit&&zr?so(zr.x,zr.y,nt,dt,this.transform.angle):new n.P(0,0),$s=S.getSymbolInstanceIconSize(De,this.transform.zoom,_n.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,$s,fo,ae,ie,$i,Ua,Oe,Q,N,Ee.predicate)};ga&&ga.box&&ga.box.length&&Jn.verticalIconBox?(Wa=qs(Jn.verticalIconBox),Aa=Wa.box.length>0):(Wa=qs(Jn.iconBox),Aa=Wa.box.length>0),Hs=Hs&&Wa.offscreen,ba=Wa.occluded}const Qc=Ve||_n.numHorizontalGlyphVertices===0&&Zr===0,Xu=He||_n.numIconVertices===0;if(Qc||Xu?Xu?Qc||(Aa=Aa&&_r):_r=Aa&&_r:Aa=_r=Aa&&_r,_r&&As&&As.box&&this.collisionIndex.insertCollisionBox(As.box,I.get("text-ignore-placement"),S.bucketInstanceId,ga&&ga.box&&el?el:No,Ee.ID),Aa&&Wa&&this.collisionIndex.insertCollisionBox(Wa.box,I.get("icon-ignore-placement"),S.bucketInstanceId,ho,Ee.ID),Ms&&(_r&&this.collisionIndex.insertCollisionCircles(Ms.circles,I.get("text-ignore-placement"),S.bucketInstanceId,No,Ee.ID),d)){const qs=S.bucketInstanceId;let fo=this.collisionCircleArrays[qs];fo===void 0&&(fo=this.collisionCircleArrays[qs]=new Mf);for(let Ua=0;Ua<Ms.circles.length;Ua+=4)fo.circles.push(Ms.circles[Ua+0]),fo.circles.push(Ms.circles[Ua+1]),fo.circles.push(Ms.circles[Ua+2]),fo.circles.push(Ms.collisionDetected?1:0)}const tc=S.projection.name!=="globe";en=en&&(tc||!Za),bn=bn&&(tc||!ba),this.placements[xr]=new Sa(_r||en,Aa||bn,Hs||S.justReloaded),a.add(xr)},Ea=this.retainedQueryData[S.bucketInstanceId].tileID;if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,Ea),S.elevationType==="road"&&S.updateRoadElevation(Ea.canonical),S.updateZOffset(),S.sortFeaturesByY){const _n=S.getSortedSymbolIndexes(this.transform.angle);for(let ca=_n.length-1;ca>=0;--ca){const Jn=_n[ca];jr(S.symbolInstances.get(Jn),Jn,S.collisionArrays[Jn])}S.hasAnyZOffset&&n.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const _n=S.getSortedIndexesByZOffset();for(let ca=0;ca<_n.length;++ca){const Jn=_n[ca];jr(S.symbolInstances.get(Jn),Jn,S.collisionArrays[Jn])}}else for(let _n=t.symbolInstanceStart;_n<t.symbolInstanceEnd;_n++)jr(S.symbolInstances.get(_n),_n,S.collisionArrays[_n]);if(d&&S.bucketInstanceId in this.collisionCircleArrays){const _n=this.collisionCircleArrays[S.bucketInstanceId];n.bl(_n.invProjMatrix,N),_n.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(t,a,d,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:D,crossTileID:N}=d,V=n.c3(a),K=y===n.bL.vertical?D:V==="left"?b:V==="center"?S:V==="right"?I:-1;b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=K>=0&&b!==K?0:N),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=K>=0&&S!==K?0:N),I>=0&&(t.text.placedSymbolArray.get(I).crossTileID=K>=0&&I!==K?0:N),D>=0&&(t.text.placedSymbolArray.get(D).crossTileID=K>=0&&D!==K?0:N)}markUsedOrientation(t,a,d){const y=a===n.bL.horizontal||a===n.bL.horizontalOnly?a:0,b=a===n.bL.vertical?a:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:D,verticalPlacedTextSymbolIndex:N}=d,V=t.text.placedSymbolArray;S>=0&&(V.get(S).placedOrientation=y),I>=0&&(V.get(I).placedOrientation=y),D>=0&&(V.get(D).placedOrientation=y),N>=0&&(V.get(N).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const y=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},S=a?a.variableOffsets:{},I=a?a.placedOrientations:{};for(const D in this.placements){const N=this.placements[D],V=b[D];V?(this.opacities[D]=new Du(V,y,N.text,N.icon,null,N.clipped),d=d||N.text!==V.text.placed||N.icon!==V.icon.placed):(this.opacities[D]=new Du(null,y,N.text,N.icon,N.skipFade,N.clipped),d=d||N.text||N.icon)}for(const D in b){const N=b[D];if(!this.opacities[D]){const V=new Du(N,y,!1,!1);V.isHidden()||(this.opacities[D]=V,d=d||N.text.placed||N.icon.placed)}}for(const D in S)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=S[D]);for(const D in I)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=I[D]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,d,y){y&&(this.lastReplacementSourceUpdateTime=y.updateTime);const b=new Set;for(const S of a){const I=S.getBucket(t);I&&S.latestFeatureIndex&&t.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,b,S,S.collisionBoxArray,d,y,S.tileID,t.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,S.tileID),I.elevationType==="road"&&I.updateRoadElevation(S.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(t,a,d,y,b,S,I,D){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const N=t.layers[0].layout,V=t.layers[0].paint,K=!!t.layers[0].dynamicFilter(),X=new Du(null,0,!1,!1,!0),Q=N.get("text-allow-overlap"),ae=N.get("icon-allow-overlap"),ie=N.get("text-variable-anchor"),ge=N.get("text-rotation-alignment")==="map",me=N.get("text-pitch-alignment")==="map",Se=V.get("symbol-z-offset"),De=N.get("symbol-elevation-reference")==="sea",Ee=!Se.isConstant(),We=new Du(null,0,Q&&(ae||!t.hasIconData()||N.get("icon-optional")),ae&&(Q||!t.hasTextData()||N.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const Ve=(Ne,Oe,nt)=>{for(let mt=0;mt<Oe/4;mt++)Ne.opacityVertexArray.emplaceBack(nt)};let He=0;S&&t.updateReplacement(I,S);for(let Ne=0;Ne<t.symbolInstances.length;Ne++){const Oe=t.symbolInstances.get(Ne),{numHorizontalGlyphVertices:nt,numVerticalGlyphVertices:mt,crossTileID:dt,numIconVertices:At,tileAnchorX:Ct,tileAnchorY:Dt}=Oe;let Kt=null;const vt=this.retainedQueryData[t.bucketInstanceId];Ee&&Oe&&vt&&(Kt=d.latestFeatureIndex.loadFeature({featureIndex:Oe.featureIndex,bucketIndex:vt.bucketIndex,sourceLayerIndex:vt.sourceLayerIndex,layoutVertexArrayOffset:0}));const rt=Se.evaluate(Kt,{}),Nt=a.has(dt);let Lt=this.opacities[dt];Nt?Lt=X:Lt||(Lt=We,this.opacities[dt]=Lt),a.add(dt);const li=nt>0||mt>0,Mi=At>0,ki=this.placedOrientations[dt],Ei=ki===n.bL.vertical,_i=ki===n.bL.horizontal||ki===n.bL.horizontalOnly;!li&&!Mi||Lt.isHidden()||He++;let fn=!1;if((li||Mi)&&S)for(const nn of t.activeReplacements){if(n.bZ(nn,b,n.b_.Symbol,D)||nn.min.x>Ct||Ct>nn.max.x||nn.min.y>Dt||Dt>nn.max.y)continue;const $i=n.b$(Ct,Dt,I.canonical,nn.footprintTileId.canonical);if(fn=n.c0($i,nn.footprint),fn)break}if(li){const nn=fn?Ls:Co(Lt.text);Ve(t.text,nt,Ei?Ls:nn),Ve(t.text,mt,_i?Ls:nn);const $i=Lt.text.isHidden(),{leftJustifiedTextSymbolIndex:en,centerJustifiedTextSymbolIndex:bn,rightJustifiedTextSymbolIndex:ar,verticalPlacedTextSymbolIndex:jr}=Oe,Ea=t.text.placedSymbolArray,_n=$i||Ei?1:0;en>=0&&(Ea.get(en).hidden=_n),bn>=0&&(Ea.get(bn).hidden=_n),ar>=0&&(Ea.get(ar).hidden=_n),jr>=0&&(Ea.get(jr).hidden=$i||_i?1:0);const ca=this.variableOffsets[dt];ca&&this.markUsedJustification(t,ca.anchor,Oe,ki);const Jn=this.placedOrientations[dt];Jn&&(this.markUsedJustification(t,"left",Oe,Jn),this.markUsedOrientation(t,Jn,Oe))}if(Mi){const nn=fn?Ls:Co(Lt.icon),{placedIconSymbolIndex:$i,verticalPlacedIconSymbolIndex:en}=Oe,bn=t.icon.placedSymbolArray,ar=Lt.icon.isHidden()?1:0;$i>=0&&(Ve(t.icon,At,Ei?Ls:nn),bn.get($i).hidden=ar),en>=0&&(Ve(t.icon,Oe.numVerticalIconVertices,_i?Ls:nn),bn.get(en).hidden=ar)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const nn=t.collisionArrays[Ne];if(nn){let $i=new n.P(0,0),en=!0;if(nn.textBox||nn.verticalTextBox){if(ie){const ar=this.variableOffsets[dt];ar?($i=rl(ar.anchor,ar.width,ar.height,ar.textOffset,ar.textScale),ge&&$i._rotate(me?this.transform.angle:-this.transform.angle)):en=!1}K&&(en=!Lt.clipped),nn.textBox&&qc(t.textCollisionBox.collisionVertexArray,Lt.text.placed,!en||Ei,rt,De,$i.x,$i.y),nn.verticalTextBox&&qc(t.textCollisionBox.collisionVertexArray,Lt.text.placed,!en||_i,rt,De,$i.x,$i.y)}const bn=en&&!!(!_i&&nn.verticalIconBox);nn.iconBox&&qc(t.iconCollisionBox.collisionVertexArray,Lt.icon.placed,bn,rt,De,Oe.hasIconTextFit?$i.x:0,Oe.hasIconTextFit?$i.y:0),nn.verticalIconBox&&qc(t.iconCollisionBox.collisionVertexArray,Lt.icon.placed,!bn,rt,De,Oe.hasIconTextFit?$i.x:0,Oe.hasIconTextFit?$i.y:0)}}}if(t.fullyClipped=He===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Ne=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Ne.invProjMatrix,t.placementViewportMatrix=Ne.viewportMatrix,t.collisionCircleArray=Ne.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>t}isStale(){return this.stale}setStale(){this.stale=!0}}function qc(h,t,a,d,y,b,S){h.emplaceBack(t?1:0,a?1:0,b||0,S||0,d,y?1:0),h.emplaceBack(t?1:0,a?1:0,b||0,S||0,d,y?1:0),h.emplaceBack(t?1:0,a?1:0,b||0,S||0,d,y?1:0),h.emplaceBack(t?1:0,a?1:0,b||0,S||0,d,y?1:0)}const zh=Math.pow(2,25),Pu=Math.pow(2,24),Md=Math.pow(2,17),Qf=Math.pow(2,16),go=Math.pow(2,9),Dl=Math.pow(2,8),xa=Math.pow(2,1);function Co(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,a=Math.floor(127*h.opacity);return a*zh+t*Pu+a*Md+t*Qf+a*go+t*Dl+a*xa+t}const Ls=0;class Ts{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,d,y,b,S){const I=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(I,y,t[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(((D,N)=>D.sortKey-N.sortKey)));this._currentPartIndex<I.length;){const D=I[this._currentPartIndex];if(a.placeLayerBucketPart(D,this._seenCrossTileIDs,d,D.symbolInstanceStart===0,S),this._currentPartIndex++,b())return!0}return!1}}class oo{constructor(t,a,d,y,b,S,I,D,N){this.placement=new zp(t,b,S,I,D,N),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,a,d,y,b){const S=n.o.now(),I=()=>{const D=n.o.now()-S;return!this._forceFullPlacement&&D>2};for(;this._currentPlacementIndex>=0;){const D=a[t[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(D.type==="symbol"&&D.visibility!=="none"&&(!D.minzoom||D.minzoom<=N)&&(!D.maxzoom||D.maxzoom>N)){const V=D,K=V.layout.get("symbol-z-elevate"),X=V.layout.get("symbol-sort-key").constantOr(1)!==void 0,Q=V.layout.get("symbol-z-order"),ae=Q==="viewport-y"||Q==="auto"&&!(Q!=="viewport-y"&&X),ie=V.layout.get("text-allow-overlap")||V.layout.get("icon-allow-overlap")||V.layout.get("text-ignore-placement")||V.layout.get("icon-ignore-placement"),ge=ae&&ie,me=this._inProgressLayer=this._inProgressLayer||new Ts(V),Se=n.B(D.source,D.scope);if(me.continuePlacement(K||ge?y[Se]:d[Se],this.placement,this._showCollisionBoxes,D,I,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Pl=512/n.al/2;class Rc{constructor(t,a,d){this.tileID=t,this.bucketInstanceId=d,this.index=new n.c4(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=t.canonical.x*n.al,b=t.canonical.y*n.al;for(let S=0;S<a.length;S++){const{key:I,crossTileID:D,tileAnchorX:N,tileAnchorY:V}=a.get(S),K=Math.floor((y+N)*Pl),X=Math.floor((b+V)*Pl);this.index.add(K,X),this.keys.push(I),this.crossTileIDs.push(D)}this.index.finish()}findMatches(t,a,d){const y=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=Pl/Math.pow(2,a.canonical.z-this.tileID.canonical.z),S=a.canonical.x*n.al,I=a.canonical.y*n.al;for(let D=0;D<t.length;D++){const N=t.get(D);if(N.crossTileID)continue;const{key:V,tileAnchorX:K,tileAnchorY:X}=N,Q=Math.floor((S+K)*b),ae=Math.floor((I+X)*b),ie=this.index.range(Q-y,ae-y,Q+y,ae+y).sort(((ge,me)=>ge-me));for(const ge of ie){const me=this.crossTileIDs[ge];if(this.keys[ge]===V&&!d.has(me)){d.add(me),N.crossTileID=me;break}}}}}class io{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class $c{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const d in this.indexes){const y=this.indexes[d],b={};for(const S in y){const I=y[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+a),b[I.tileID.key]=I}this.indexes[d]=b}this.lng=t}addBucket(t,a,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const y=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>t.overscaledZ)for(const I in S){const D=S[I];D.tileID.isChildOf(t)&&D.findMatches(a.symbolInstances,t,y)}else{const I=S[t.scaledTo(Number(b)).key];I&&I.findMatches(a.symbolInstances,t,y)}}for(let b=0;b<a.symbolInstances.length;b++){const S=a.symbolInstances.get(b);S.crossTileID||(S.crossTileID=d.generate(),y.add(S.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Rc(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const d of a.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let a=!1;for(const d in this.indexes){const y=this.indexes[d];for(const b in y)t[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,y[b]),delete y[b],a=!0)}return a}}class Kl{constructor(){this.layerIndexes={},this.crossTileIDs=new io,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,d,y){let b=this.layerIndexes[t.fqid];b===void 0&&(b=this.layerIndexes[t.fqid]=new $c);let S=!1;const I={};y.name!=="globe"&&b.handleWrapJump(d);for(const D of a){const N=D.getBucket(t);N&&t.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(D.tileID,N,this.crossTileIDs)&&(S=!0),I[N.bucketInstanceId]=!0)}return b.removeStaleBuckets(I)&&(S=!0),S}pruneUnusedLayers(t){const a={};t.forEach((d=>{a[d]=!0}));for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const zo=771;class hr{constructor(t,a,d,y){this.blendFunction=t,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=y}}hr.Replace=[1,0,1,0],hr.disabled=new hr(hr.Replace,n.ao.transparent,[!1,!1,!1,!1]),hr.unblended=new hr(hr.Replace,n.ao.transparent,[!0,!0,!0,!0]),hr.alphaBlended=new hr([1,zo,1,zo],n.ao.transparent,[!0,!0,!0,!0]),hr.alphaBlendedNonPremultiplied=new hr([770,zo,770,zo],n.ao.transparent,[!0,!0,!0,!0]),hr.multiply=new hr([774,0,774,0],n.ao.transparent,[!0,!0,!0,!0]),hr.additive=new hr([1,1,1,1],n.ao.transparent,[!0,!0,!0,!0]);class yn{constructor(t,a,d){this.func=t,this.mask=a,this.range=d}}yn.ReadOnly=!1,yn.ReadWrite=!0,yn.disabled=new yn(519,yn.ReadOnly,[0,1]);const rd=7680;class jn{constructor(t,a,d,y,b,S){this.test=t,this.ref=a,this.mask=d,this.fail=y,this.depthFail=b,this.pass=S}}jn.disabled=new jn({func:519,mask:0},0,0,rd,rd,rd);const Lu=1029,Rh=2305;class Vn{constructor(t,a,d){this.enable=t,this.mode=a,this.frontFace=d}}function Dc(h,t){const a=n.ca(h,3);n.cc(h,t),n.cg(h,3,a)}function Zd(h,t){const a=n.c7([]);return n.c8(a,a,-t),n.c9(a,a,-h),a}function Dh(h,t){const a=[h[0],h[1],0],d=[t[0],t[1],0];if(n.ag(a)>=1e-15){const S=n.aw([],a);n.c5(d,S,n.bJ(d,S)),t[0]=d[0],t[1]=d[1]}const y=n.bI([],t,h);if(n.c6(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return Zd(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),b)}Vn.disabled=new Vn(!1,Lu,Rh),Vn.backCCW=new Vn(!0,Lu,Rh),Vn.backCW=new Vn(!0,Lu,2304),Vn.frontCW=new Vn(!0,1028,2304),Vn.frontCCW=new Vn(!0,1028,Rh);class Zo{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof n.ae?t:new n.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=n.bT(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a,d){if(this.orientation=null,!this.position)return;const y=this.position,b=d||(this._elevation?this._elevation.getAtPointOrZero(n.ae.fromLngLat(t)):0),S=n.ae.fromLngLat(t,b),I=[S.x-y.x,S.y-y.y,S.z-y.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Dh(I,a)}setPitchBearing(t,a){this.orientation=Zd(n.an(t),n.an(-a))}}class If{constructor(t,a){this._transform=n.bA([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new n.ae(t[0],t[1],t[2])}get position(){const t=n.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&n.cg(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.c7([]),t&&Dc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=Zd(t,a),Dc(this._transform,this._orientation)}forward(){const t=n.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=n.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=n.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const d=new Float64Array(16);return n.bl(d,this.getWorldToCamera(t,a)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,d){const y=this.position;n.c5(y,y,-t);const b=new Float64Array(16);return n.bq(b,[d,d,d]),n.br(b,b,y),b[10]*=a,b}getWorldToCamera(t,a){const d=new Float64Array(16),y=new Float64Array(4),b=this.position;return n.cb(y,this._orientation),n.c5(b,b,-t),n.cc(d,y),n.br(d,d,b),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(t,a,d,y){const b=new Float64Array(16);return n.cd(b,t,a,d,y),b}getCameraToClipOrthographic(t,a,d,y,b,S){const I=new Float64Array(16);return n.ce(I,t,a,d,y,b,S),I}getDistanceToElevation(t,a=!1){const d=t===0?0:n.cf(t,a?n.a$(this.position[1]):this.position[1]),y=this.forward();return(d-this.position[2])/y[2]}clone(){return new If([...this.position],[...this.orientation])}}const _s={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class qa{constructor(t=0,a=0,d=0,y=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=d,this.right=y}interpolate(t,a,d){return a.top!=null&&t.top!=null&&(this.top=n.ak(t.top,a.top,d)),a.bottom!=null&&t.bottom!=null&&(this.bottom=n.ak(t.bottom,a.bottom,d)),a.left!=null&&t.left!=null&&(this.left=n.ak(t.left,a.left,d)),a.right!=null&&t.right!=null&&(this.right=n.ak(t.right,a.right,d)),this}getCenter(t,a){const d=n.aA((this.left+t-this.right)/2,0,t),y=n.aA((this.top+a-this.bottom)/2,0,a);return new n.P(d,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new qa(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const cc=15;class ep{constructor(t,a,d,y,b,S,I){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=y??60,this.setProjection(S),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new n.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new qa,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new If,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new ep(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<cc}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return n.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=n.cm(this.projectionOptions);const d=this.getProjection(),y=!n.by(a,d);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.cm({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=n.cn(),n.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=n.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let y=0,b=0;for(let S=0;S<a.length;S++){const I=new n.P(a[S][0]*this.width,d+a[S][1]*(this.height-d)),D=t.pointCoordinate(I);if(!D)continue;const N=1/Math.hypot(D[0]-this._camera.position[0],D[1]-this._camera.position[1]);y+=D[3]*N,b+=N}return b===0?NaN:y/b}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,y=this._mercatorZfromZoom(t),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(y-d,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const a=this.elevation,d=t.elevation,y=a!=null!=(d!=null)||a&&d&&a.exaggeration()!==d.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!y}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const y=n.ag(n.av([],this._camera.position,d));return n.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!n.cp(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];n.cq(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new Zo;return a.position=new n.ae(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!n.cr(t))return!1;n.cs(t,t);const a=n.ct([],[0,0,-1],t),d=n.ct([],[0,-1,0],t);if(d[2]<0)return!1;const y=Dh(a,d);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;t[2]=n.aA(t[2],y/d,y/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,d){this._unmodified=!1,this._edgeInsets.interpolate(t,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new n.cu(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new n.P(0,0)),y=this.pointCoordinate(new n.P(this.width,0)),b=this.pointCoordinate(new n.P(this.width,this.height)),S=this.pointCoordinate(new n.P(0,this.height)),I=Math.floor(Math.min(d.x,y.x,b.x,S.x)),D=Math.floor(Math.max(d.x,y.x,b.x,S.x)),N=1;for(let V=I-N;V<=D+N;V++)V!==0&&a.push(new n.cu(V,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,d,y){let b=[];const S=d!=null,I=!S;if(I&&this.zoom<a||S&&d[0]===0&&d[1]===0)return b;const D=new Set,N=(K,X,Q,ae,ie)=>{const ge=n.cY(X,K,Q,ae,ie);D.has(ge)||(b.push(new n.aQ(K,X,Q,ae,ie)),D.add(ge))};for(let K=0;K<t.length;K++){const X=t[K];if(I&&X.canonical.z!==a||S&&y!==void 0&&y>X.canonical.z)continue;const Q=X.canonical,ae=X.overscaledZ,ie=X.wrap,ge=1<<Q.z,me=Q.x+1<ge,Se=Q.x>0,De=Q.y+1<ge,Ee=Q.y>0,We=X.wrap-(Se?0:1),Ve=X.wrap+(me?0:1),He=Se?Q.x-1:ge-1,Ne=me?Q.x+1:0;if(S)d[0]<0?(N(ae,Ve,Q.z,Ne,Q.y),d[1]<0&&De&&(N(ae,ie,Q.z,Q.x,Q.y+1),N(ae,Ve,Q.z,Ne,Q.y+1)),d[1]>0&&Ee&&(N(ae,ie,Q.z,Q.x,Q.y-1),N(ae,Ve,Q.z,Ne,Q.y-1))):d[0]>0?(N(ae,We,Q.z,He,Q.y),d[1]<0&&De&&(N(ae,ie,Q.z,Q.x,Q.y+1),N(ae,We,Q.z,He,Q.y+1)),d[1]>0&&Ee&&(N(ae,ie,Q.z,Q.x,Q.y-1),N(ae,We,Q.z,He,Q.y-1))):d[1]<0&&De?N(ae,ie,Q.z,Q.x,Q.y+1):Ee&&N(ae,ie,Q.z,Q.x,Q.y-1);else{const Oe=X.visibleQuadrants;1&Oe&&(N(ae,We,Q.z,He,Q.y),Ee&&(N(ae,ie,Q.z,Q.x,Q.y-1),N(ae,We,Q.z,He,Q.y-1))),2&Oe&&(N(ae,Ve,Q.z,Ne,Q.y),Ee&&(N(ae,ie,Q.z,Q.x,Q.y-1),N(ae,Ve,Q.z,Ne,Q.y-1))),4&Oe&&(N(ae,We,Q.z,He,Q.y),De&&(N(ae,ie,Q.z,Q.x,Q.y+1),N(ae,We,Q.z,He,Q.y+1))),8&Oe&&(N(ae,Ve,Q.z,Ne,Q.y),De&&(N(ae,ie,Q.z,Q.x,Q.y+1),N(ae,Ve,Q.z,Ne,Q.y+1)))}}const V=[];for(const K of b)b.some((X=>K.isChildOf(X)))||V.push(K);if(b=V.filter((K=>!t.some((X=>!!(K.overscaledZ<a&&X.isChildOf(K))||K.equals(X)||K.isChildOf(X))))),I){const K=1<<a,X=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=[K*X.x,K*X.y],ae=4,ie=ae*ae;b=b.filter((ge=>{const me=ge.canonical.x+.5-Q[0],Se=ge.canonical.y+.5-Q[1];return me*me+Se*Se<ie}))}return b}extendTileCoverToNearPlane(t,a,d){const y=[],b=new Set;for(const Se of t)b.add(Se.key);const S=(Se,De,Ee,We,Ve)=>{const He=n.cY(De,Se,Ee,We,Ve);b.has(He)||(y.push(new n.aQ(Se,De,Ee,We,Ve)),b.add(He))},I=t.reduce(((Se,De)=>Math.max(Se,De.overscaledZ)),d),D=1<<d,N=[new n.P(0,0),new n.P(n.al,0),new n.P(n.al,n.al),new n.P(0,n.al)],V=new n.P(0,0),K=new n.P(0,0),X=(Se,De)=>{const Ee=Math.floor(Se[0]),We=Math.floor(Se[1]),Ve=(Se[0]-Ee)*n.al,He=(Se[1]-We)*n.al,Ne=Math.floor(De[0]),Oe=Math.floor(De[1]),nt=(De[0]-Ne)*n.al,mt=(De[1]-Oe)*n.al;for(let dt=-1;dt<=1;dt++){const At=Ee+dt;if(!(At<0||At>=D)){V.x=Ve-dt*n.al,K.x=nt-(At-Ne)*n.al;for(let Ct=-1;Ct<=1;Ct++){const Dt=We+Ct;V.y=He-Ct*n.al,K.y=mt-(Dt-Oe)*n.al,n.cZ(V,K,N)&&S(I,0,d,At,Dt)}}}},Q=a.points,ae=Q[n.cv],ie=Q[n.cw],ge=this._projectToGround(ae,Q[n.cx]),me=this._projectToGround(ie,Q[n.cy]);return X(ae,ge),X(ie,me),y}_projectToGround(t,a){return n.cz(n.cA(),t,a,t[2]/(t[2]-a[2]))}coveringTiles(t){let a=this.coveringZoomLevel(t);const d=a,y=this.elevation&&this.elevation.exaggeration(),b=y&&!t.isTerrainDEM,S=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const I=this.locationCoordinate(this.center),D=this.center.lat,N=1<<a,V=[N*I.x,N*I.y,0],K=this.projection.name==="globe",X=!K,Q=n.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,X),ae=K?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=N*n.cf(1,this.center.lat),ge=this._camera.position[2]/n.cf(1,this.center.lat),me=[N*ae.x,N*ae.y,ge*(X?1:ie)],Se=K||y,De=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),Ee=this.isLODDisabled(!0)?a:0;let We;if(this._elevation&&t.isTerrainDEM)We=1e4*this._elevation.exaggeration();else if(this._elevation){const rt=this._elevation.getMinMaxForVisibleTiles();We=rt?rt.max:this._centerAltitude}else We=this._centerAltitude;const Ve=t.isTerrainDEM?-We:this._elevation?this._elevation.getMinElevationBelowMSL():0,He=this.projection.isReprojectedInTileSpace?n.cC(this):1,Ne=rt=>{const Lt=new n.ae(rt.x+25e-6,rt.y,rt.z),li=new n.ae(rt.x,rt.y+25e-6,rt.z),Mi=rt.toLngLat(),ki=Lt.toLngLat(),Ei=li.toLngLat(),_i=this.locationCoordinate(Mi),fn=this.locationCoordinate(ki),nn=this.locationCoordinate(Ei),$i=Math.hypot(fn.x-_i.x,fn.y-_i.y),en=Math.hypot(nn.x-_i.x,nn.y-_i.y);return Math.sqrt($i*en)*He/25e-6},Oe=rt=>{const Nt=We,Lt=Ve;return{aabb:n.cF(this,N,0,0,0,rt,Lt,Nt,this.projection),zoom:0,x:0,y:0,minZ:Lt,maxZ:Nt,wrap:rt,fullyVisible:!1}},nt=[];let mt=[];const dt=a,At=t.reparseOverscaled?d:a,Ct=(ge-this._centerAltitude)*ie,Dt=rt=>{if(!this._elevation||!rt.tileID||!S)return;const Nt=this._elevation.getMinMaxForTile(rt.tileID),Lt=rt.aabb;Nt?(Lt.min[2]=Nt.min,Lt.max[2]=Nt.max,Lt.center[2]=(Lt.min[2]+Lt.max[2])/2):(rt.shouldSplit=vt(rt),rt.shouldSplit||(Lt.min[2]=Lt.max[2]=Lt.center[2]=this._centerAltitude))},Kt=(rt,Nt)=>{if(.707*Nt<rt)return 1;const Lt=Nt/rt;return Lt/(1.4144271570014144+(Math.pow(1.1,Lt-1.4144271570014144+1)-1)/(1.1-1)-1)},vt=rt=>{if(rt.zoom<Ee)return!0;if(rt.zoom===dt)return!1;if(rt.shouldSplit!=null)return rt.shouldSplit;const Nt=rt.aabb.distanceX(me),Lt=rt.aabb.distanceY(me);let li=Ct,Mi=1;if(K){li=rt.aabb.distanceZ(me);const en=Math.pow(2,rt.zoom),bn=n.a$((rt.y+1)/en),ar=n.a$(rt.y/en),jr=Math.min(Math.max(D,bn),ar),Ea=n.d1(jr)/n.d1(D);if(Mi=jr===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ea/this._mercatorScaleRatio),this.zoom<=n.c_&&rt.zoom===dt-1&&Ea>=.9)return!0}else if(b&&(li=rt.aabb.distanceZ(me)*ie),this.projection.isReprojectedInTileSpace&&d<=5){const en=Math.pow(2,rt.zoom),bn=Ne(new n.ae((rt.x+.5)/en,(rt.y+.5)/en));Mi=bn>.85?1:bn}if(!S&&!K){const en=Math.sqrt(Nt*Nt+Lt*Lt+li*li);let bn=(1<<dt-rt.zoom)*De*Mi;return bn*=Kt(Math.max(li,Ct),en),en<bn}let ki=Number.MAX_VALUE,Ei=0;const _i=rt.aabb.getCorners(),fn=[];for(const en of _i){n.av(fn,en,me),K||(b?fn[2]*=ie:fn[2]=Ct);const bn=n.bJ(fn,this._camera.forward());bn<ki&&(ki=bn,Ei=Math.abs(fn[2]))}let nn=(1<<dt-rt.zoom)*De*Mi;if(nn*=Kt(Math.max(Ei,Ct),ki),ki<nn)return!0;const $i=rt.aabb.closestPoint(V);return $i[0]===V[0]&&$i[1]===V[1]};if(this.renderWorldCopies)for(let rt=1;rt<=3;rt++)nt.push(Oe(-rt)),nt.push(Oe(rt));for(nt.push(Oe(0));nt.length>0;){const rt=nt.pop(),Nt=rt.x,Lt=rt.y;let li=rt.fullyVisible;const Mi=()=>this.projection.name==="globe"&&(rt.y===0||rt.y===(1<<rt.zoom)-1);if(!li){let ki=Se?rt.aabb.intersects(Q):rt.aabb.intersectsFlat(Q);if(ki===0&&Mi()){const Ei=new n.cD(rt.zoom,Nt,Lt);ki=n.cE(this,N,Ei,!0).intersects(Q)}if(ki===0)continue;li=ki===2}if(rt.zoom!==dt&&vt(rt))for(let ki=0;ki<4;ki++){const Ei=(Nt<<1)+ki%2,_i=(Lt<<1)+(ki>>1),fn={aabb:S?rt.aabb.quadrant(ki):n.cF(this,N,rt.zoom+1,Ei,_i,rt.wrap,rt.minZ,rt.maxZ,this.projection),zoom:rt.zoom+1,x:Ei,y:_i,wrap:rt.wrap,fullyVisible:li,tileID:void 0,shouldSplit:void 0,minZ:rt.minZ,maxZ:rt.maxZ};b&&!K&&(fn.tileID=new n.aQ(rt.zoom+1===dt?At:rt.zoom+1,rt.wrap,rt.zoom+1,Ei,_i),Dt(fn)),nt.push(fn)}else{const ki=rt.zoom===dt?At:rt.zoom;if(t.minzoom&&t.minzoom>ki)continue;let Ei=0;if(!li){let $i=Se?rt.aabb.intersectsPrecise(Q):rt.aabb.intersectsPreciseFlat(Q);if($i===0&&Mi()){const en=new n.cD(rt.zoom,Nt,Lt);$i=n.cE(this,N,en,!0).intersectsPrecise(Q)}if($i===0)continue;if(t.calculateQuadrantVisibility)if(Q.containsPoint(rt.aabb.center))Ei=15;else for(let en=0;en<4;en++)rt.aabb.quadrant(en).intersects(Q)!==0&&(Ei|=1<<en)}const _i=V[0]-(.5+Nt+(rt.wrap<<rt.zoom))*(1<<a-rt.zoom),fn=V[1]-.5-Lt,nn=rt.tileID?rt.tileID:new n.aQ(ki,rt.wrap,rt.zoom,Nt,Lt);t.calculateQuadrantVisibility&&(nn.visibleQuadrants=Ei),mt.push({tileID:nn,distanceSq:_i*_i+fn*fn})}}if(this.fogCullDistSq){const rt=this.fogCullDistSq,Nt=this.horizonLineFromTop();mt=mt.filter((Lt=>{const li=[0,0,0,1],Mi=[n.al,n.al,0,1],ki=this.calculateFogTileMatrix(Lt.tileID.toUnwrapped());n.aC(li,li,ki),n.aC(Mi,Mi,ki);const Ei=n.cG([],li,Mi),_i=n.cH([],li,Mi),fn=n.c$(Ei,_i);if(fn===0)return!0;let nn=!1;const $i=this._elevation;if($i&&fn>rt&&Nt!==0){const en=this.calculateProjMatrix(Lt.tileID.toUnwrapped());let bn;t.isTerrainDEM||(bn=$i.getMinMaxForTile(Lt.tileID)),bn||(bn={min:Ve,max:We});const ar=n.cI(this.rotation),jr=[ar[0]*n.al,ar[1]*n.al,bn.max];n.af(jr,jr,en),nn=(1-jr[1])*this.height*.5<Nt}return fn<rt||nn}))}return mt.sort(((rt,Nt)=>rt.distanceSq-Nt.distanceSq)).map((rt=>rt.tileID))}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const a=n.aA(t.lat,-n.cJ,n.cJ),d=this.projection.project(t.lng,a);return new n.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let d,y;const b=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;d=(a.x-b.x)/I,y=(a.y-b.y)/I}else{const I=this.pointCoordinate(a),D=this.pointCoordinate(b);d=I.x-D.x,y=I.y-D.y}const S=this.locationCoordinate(t);this.setLocation(new n.ae(S.x-d,S.y-y))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,a){return this.projection.locationPoint(this,t,a)}locationPoint3D(t,a){return this.projection.locationPoint(this,t,a,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,a){return this.coordinateLocation(this.pointCoordinate3D(t,a))}locationCoordinate(t,a){const d=a?n.cf(a,t.lat):void 0,y=this.projection.project(t.lng,t.lat);return new n.ae(y.x,y.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const d=a??this._centerAltitude,y=[t.x,t.y,0,1],b=[t.x,t.y,1,1];n.aC(y,y,this.pixelMatrixInverse),n.aC(b,b,this.pixelMatrixInverse);const S=b[3];n.cK(y,y,1/y[3]),n.cK(b,b,1/S);const I=y[2],D=b[2];return{p0:y,p1:b,t:I===D?0:(d-I)/(D-I)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return n.aC(a,a,this.pixelMatrixInverse),n.aC(d,d,this.pixelMatrixInverse),n.cK(a,a,1/a[3]),n.cK(d,d,1/d[3]),a[2]=n.cf(a[2],this._center.lat)*this.worldSize,d[2]=n.cf(d[2],this._center.lat)*this.worldSize,n.cK(a,a,1/this.worldSize),n.cK(d,d,1/this.worldSize),new n.ax([a[0],a[1],a[2]],n.aw([],n.av([],d,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:d,t:y}=t,b=n.cf(a[2],this._center.lat),S=n.cf(d[2],this._center.lat);return new n.ae(n.ak(a[0],d[0],y)/this.worldSize,n.ak(a[1],d[1],y)/this.worldSize,n.ak(b,S,y))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t,a){if(!this.elevation)return this.pointCoordinate(t,a);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new n.ae(d[0],d[1],d[2]);let y=0,b=this.horizonLineFromTop();if(t.y>b)return this.pointCoordinate(t,a);const S=.02*b,I=t.clone();for(let D=0;D<10&&b-y>S;D++){I.y=n.ak(y,b,.66);const N=this.projection.pointCoordinate3D(this,I.x,I.y);N?(b=I.y,d=N):y=I.y}return d?new n.ae(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.cL)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,y=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return n.aC(y,y,this.pixelMatrix),y[3]>0?new n.P(y[0]/y[3],y[1]/y[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new n.P(a,t)),S=this.pointLocation3D(new n.P(y,t)),I=this.pointLocation3D(new n.P(y,d)),D=this.pointLocation3D(new n.P(a,d));let N=Math.min(b.lng,S.lng,I.lng,D.lng),V=Math.max(b.lng,S.lng,I.lng,D.lng),K=Math.min(b.lat,S.lat,I.lat,D.lat),X=Math.max(b.lat,S.lat,I.lat,D.lat);const Q=Math.pow(2,-this.zoom)/16*270,ae=this.projection.name==="globe"?1:4,ie=(ge,me,Se,De,Ee)=>{const We=(ge+Se)/2,Ve=(me+De)/2,He=new n.P(We,Ve),{lng:Ne,lat:Oe}=this.pointLocation3D(He),nt=Math.max(0,N-Ne,K-Oe,Ne-V,Oe-X);N=Math.min(N,Ne),V=Math.max(V,Ne),K=Math.min(K,Oe),X=Math.max(X,Oe),(Ee<ae||nt>Q)&&(ie(ge,me,We,Ve,Ee+1),ie(We,Ve,Se,De,Ee+1))};if(ie(a,t,y,t,1),ie(y,t,y,d,1),ie(y,d,a,d,1),ie(a,d,a,t,1),this.projection.name==="globe"){const[ge,me]=n.cM(this);ge?(X=90,V=180,N=-180):me&&(K=-90,V=180,N=-180)}return new n.aI(new n.aT(N,K),new n.aT(V,X))}_getBoundsRectangular(t,a){const{top:d,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,I=new n.P(y,d),D=new n.P(S,d),N=new n.P(S,b),V=new n.P(y,b);let K=this.pointCoordinate(I,t),X=this.pointCoordinate(D,t);const Q=this.pointCoordinate(N,a),ae=this.pointCoordinate(V,a),ie=(ge,me)=>(me.y-ge.y)/(me.x-ge.x);return K.y>1&&X.y>=0?K=new n.ae((1-ae.y)/ie(ae,K)+ae.x,1):K.y<0&&X.y<=1&&(K=new n.ae(-ae.y/ie(ae,K)+ae.x,0)),X.y>1&&K.y>=0?X=new n.ae((1-Q.y)/ie(Q,X)+Q.x,1):X.y<0&&K.y<=1&&(X=new n.ae(-Q.y/ie(Q,X)+Q.x,0)),new n.aI().extend(this.coordinateLocation(K)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce(((d,y)=>{if(y.dem){const b=y.dem.tree;d.min=Math.min(d.min,b.minimums[0]),d.max=Math.max(d.max,b.maximums[0])}return d}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.cJ,this.maxLat=n.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.aF(this.minLng)*this.tileSize,this.worldMaxX=n.aF(this.maxLng)*this.tileSize,this.worldMinY=n.aJ(this.maxLat)*this.tileSize,this.worldMaxY=n.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,d=this._distanceTileDataCache;if(d[a])return d[a];const y=t.canonical,b=1/this.height,S=this.cameraWorldSize,I=S/this.zoomScale(y.z),D=(y.x+Math.pow(2,y.z)*t.wrap)*I,N=y.y*I,V=this.point;V.x*=S/this.worldSize,V.y*=S/this.worldSize;const K=this.angle,X=Math.sin(-K),Q=-Math.cos(-K);return d[a]={bearing:[X,Q],center:[(V.x-D)*b,(V.y-N)*b],scale:I/n.al*b},d[a]}calculateFogTileMatrix(t){const a=t.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.aB(y,this.worldToFogMatrix,y),d[a]=new Float32Array(y),d[a]}calculateProjMatrix(t,a=!1,d=!1){const y=t.key;let b;if(b=d?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const S=this.calculatePosMatrix(t,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,n.aB(S,I,S),b[y]=new Float32Array(S),b[y]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const y=n.cN(t,this);return d[a]=y,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,a=n.bq([],[t,t,t]);return n.aB(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=n.cf(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),y=this._camera.forward(),b=n.cf(1,this._center.lat);d[2]/=b,y[2]/=b,n.aw(y,y);const S=t.raycast(d,y,t.exaggeration());if(S){const I=n.bH([],d,y,S),D=new n.ae(I[0],I[1],n.cf(I[2],n.a$(I[1]))),N=(D.z+n.ag([D.x-d[0],D.y-d[1],D.z-d[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=D.toAltitude(),this._center=this.coordinateLocation(D),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,d=n.cf(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=a.getAtPointOrZero(new n.ae(...y)),S=this.pixelsPerMeter/this.worldSize*b,I=this._minimumHeightOverTerrain(),D=y[2]-S;if(D<=I)if(D<0||t){const N=this.locationCoordinate(this._center,this._centerAltitude),V=[y[0],y[1],N.z-y[2]],K=n.ag(V);V[2]-=(I-D)/this._pixelsPerMercatorPixel;const X=n.ag(V);if(X===0)return;n.c5(V,V,K/X*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],N.z*this._pixelsPerMercatorPixel-V[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const X=this.center;return X.lat=n.aA(X.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(X.lng=n.aA(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const a=this._unmodified,{x:d,y}=this.point;let b=0,S=d,I=y;const D=this.width/2,N=this.height/2,V=this.worldMinY*this.scale,K=this.worldMaxY*this.scale;if(y-N<V&&(I=V+N),y+N>K&&(I=K-N),K-V<this.height&&(b=Math.max(b,this.height/(K-V)),I=(K+V)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,ae=this.worldSize/2-(X+Q)/2;S=(d+ae+this.worldSize)%this.worldSize-ae,S-D<X&&(S=X+D),S+D>Q&&(S=Q-D),Q-X<this.width&&(b=Math.max(b,this.width/(Q-X)),S=(Q+X)/2)}S===d&&I===y||this._allowWorldUnderZoom||(this.center=this.unproject(new n.P(S,I))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.cf(1,this.center.lat)/n.cf(1,n.d2));const y=n.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?d:1,S=this._camera.getWorldToCamera(this.worldSize,b);let I;const D=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(D[8]=2*-t.x/this.width,D[9]=2*t.y/this.height,this.isOrthographic){let Oe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),nt=Oe*this.aspect,mt=-nt,dt=-Oe;nt-=t.x,mt-=t.x,Oe+=t.y,dt+=t.y,I=this._camera.getCameraToClipOrthographic(mt,nt,dt,Oe,this._nearZ,this._farZ),((At,Ct,Dt,Kt)=>{for(let vt=0;vt<16;vt++)At[vt]=n.ak(Ct[vt],Dt[vt],Kt)})(I,I,D,n.d0(this.pitch>=cc?1:this.pitch/cc))}else I=D;const N=n.cP([],D,S);let V=n.cP([],I,S);if(this.projection.isReprojectedInTileSpace){const Oe=this.locationCoordinate(this.center),nt=n.bA([]);n.br(nt,nt,[Oe.x*this.worldSize,Oe.y*this.worldSize,0]),n.aB(nt,nt,n.cQ(this)),n.br(nt,nt,[-Oe.x*this.worldSize,-Oe.y*this.worldSize,0]),n.aB(V,V,nt),n.aB(N,N,nt),this.inverseAdjustmentMatrix=n.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.cS([],V,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=V,this.invProjMatrix=n.bl(new Float64Array(16),this.projMatrix),a){const Oe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Oe[8]=2*-t.x/this.width,Oe[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.cP([],Oe,S)}else this.expandedFarZProjMatrix=this.projMatrix;const K=n.bl([],I);this.frustumCorners=n.cT.fromInvProjectionMatrix(K,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const X=new Float32Array(16);n.bA(X),n.cS(X,X,[1,-1,1]),n.cU(X,X,this._pitch),n.bB(X,X,this.angle);const Q=n.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.bz(Q);const ae=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-t.x/this.width,Q[9]=2*(t.y+ae)/this.height,this.skyboxMatrix=n.aB(X,Q,X);const ie=this.point,ge=ie.x,me=ie.y,Se=this.width%2/2,De=this.height%2/2,Ee=Math.cos(this.angle),We=Math.sin(this.angle),Ve=ge-Math.round(ge)+Ee*Se+We*De,He=me-Math.round(me)+Ee*De+We*Se,Ne=new Float64Array(V);if(n.br(Ne,Ne,[Ve>.5?Ve-1:Ve,He>.5?He-1:He,0]),this.alignedProjMatrix=Ne,V=n.bC(),n.cS(V,V,[this.width/2,-this.height/2,1]),n.br(V,V,[1,-1,0]),this.labelPlaneMatrix=V,V=n.bC(),n.cS(V,V,[1,-1,1]),n.br(V,V,[-1,-1,0]),n.cS(V,V,[2/this.width,2/this.height,1]),this.glCoordMatrix=V,this.pixelMatrix=n.aB(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},V=n.bl(new Float64Array(16),this.pixelMatrix),!V)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=V,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.cV(this);const Oe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.af(Oe,Oe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=V;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,d=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[t,t,a];n.c5(b,b,y),n.c5(d,d,-1),n.cW(d,d,b);const S=n.bC();n.br(S,S,d),n.cS(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,y)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-d[0]*b,y.y/this.worldSize-d[1]*b,t/this.worldSize*this._centerAltitude-d[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],y=t[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((a-d)/y,1)),this._camera.position=n.bH([],this._camera.position,t,b),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:y}=this._camera.getPitchBearing(),b=n.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.an(this._maxPitch)),I=Math.max((t[2]-b)/Math.cos(d),S),D=this._zoomFromMercatorZ(I);n.bH(t,t,a,I),this._pitch=n.aA(d,n.an(this.minPitch),n.an(this.maxPitch)),this.angle=n.bT(y,-Math.PI,Math.PI),this._setZoom(n.aA(D,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,d=n.cL,y=0,b=1/0;for(;d-a>1e-6&&d>a;){const S=a+.5*(d-a),I=this.tileSize*Math.pow(2,S),D=this.getCameraToCenterDistance(this.projection,S,I),N=this.scaleZoom(D/(Math.max(0,t)*this.tileSize)),V=Math.abs(S-N);V<b&&(b=V,y=S),S<N?a=S:d=S}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const d=Math.min(t.x,a.x),y=Math.max(t.x,a.x),b=Math.min(t.y,a.y),S=Math.max(t.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new n.P(d,b),new n.P(y,S),new n.P(d,S),new n.P(y,b)],D=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const V of I){const K=this.pointRayIntersection(V);if(K.t<0)return!0;const X=this.rayIntersectionCoordinate(K);if(X.x<D||X.y<0||X.x>N||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,a){const d=n.ag(n.av([],this._camera.position,t)),y=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([a,d,y],b){const S=[a,d,y,1];n.aC(S,S,b);const I=S[3]=Math.max(S[3],1e-6);return S[0]/=I,S[1]/=I,S[2]/=I,S})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,d=this.worldSize){const y=n.cO(t,a,this.width,this.height,1024),b=t.pixelSpaceConversion(this.center.lat,d,y);let S=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(S=n.ak(1,S,n.d0(this.pitch>=cc?1:this.pitch/cc))),S}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.aB(t,t,this.globeMatrix),t}getFrustum(t){return n.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const ah=(h,t)=>{if(t>0&&h.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=h.transform,d=Math.max(Math.abs(a._zoom-(h.minCutoffZoom-1)),1),y=a.isLODDisabled(!1)?n.ah(60,45,a.pitch):n.ah(30,15,a.pitch),b=a._farZ-a._nearZ,S=t*a.height,I=((1-(D=y))*a.cameraToCenterDistance+D*(a._farZ+S))*d;var D;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(I-a._nearZ)/b,(I-S-a._nearZ)/b]}}},_l=2048;class ad{constructor(t,a){this.aabb=t,this.lastCascade=a}}class tp{add(t,a){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],a.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],a.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],a.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],a.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],a.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],a.max[2])):this.receivers[t.key]=new ad(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,d){const y=n.d9.fromPoints(t.points);let b=0;for(const S in this.receivers){const I=this.receivers[S];if(!I||!y.intersectsAabb(I.aabb))continue;I.aabb.min=y.closestPoint(I.aabb.min),I.aabb.max=y.closestPoint(I.aabb.max);const D=I.aabb.getCorners();for(let N=0;N<d.length;N++){let V=!0;for(const K of D){const X=[K[0]*a,K[1]*a,K[2]];if(n.af(X,X,d[N].matrix),X[0]<-1||X[0]>1||X[1]<-1||X[1]>1){V=!1;break}}if(I.lastCascade=N,b=Math.max(b,N),V)break}}return b+1}}class hu{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new tp,this._depthMode=new yn(t.context.gl.LEQUAL,yn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const y=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||y<=0||(this._shadowLayerCount=d.style.order.reduce(((ae,ie)=>{const ge=d.style._mergedLayers[ie];return ae+(ge.hasShadowPass()&&!ge.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=d.context,S=_l,I=_l;if(this._cascades.length===0||_l!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ae=0;ae<2;++ae){const ie=d._shadowMapDebug,ge=b.gl,me=b.createFramebuffer(S,I,ie?1:0,"texture"),Se=new n.T(b,{width:S,height:I,data:null},ge.DEPTH_COMPONENT16);if(me.depthAttachment.set(Se.texture),ie){const De=new n.T(b,{width:S,height:I,data:null},ge.RGBA8);me.colorAttachment0.set(De.texture)}this._cascades.push({framebuffer:me,texture:Se,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.cB,scale:0})}}this.shadowDirection=du(a);let D=0;if(t.elevation){const ae=t.elevation,ie=[1e4,-1e4];ae.visibleDemTiles.filter((ge=>ge.dem)).forEach((ge=>{const me=ge.dem.tree;ie[0]=Math.min(ie[0],me.minimums[0]),ie[1]=Math.max(ie[1],me.maximums[0])})),ie[0]!==1e4&&(D=(ie[1]-ie[0])*ae.exaggeration())}const N=1.5*t.cameraToCenterDistance,V=3*N,K=new Float64Array(16);for(let ae=0;ae<this._cascades.length;++ae){const ie=this._cascades[ae];let ge=t.height/50,me=1;ae===0?me=N:(ge=N,me=V);const[Se,De]=Lc(t,this.shadowDirection,ge,me,_l,D);ie.scale=t.scale,ie.matrix=Se,ie.boundingSphereRadius=De,n.bl(K,ie.matrix),ie.frustum=n.cB.fromInvProjectionMatrix(K,1,0,!0),ie.far=me}const X=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[X].far,this._cascades[X].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=_l,this._uniformValues.u_shadowmap_0=_s.ShadowMap0,this._uniformValues.u_shadowmap_1=_s.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=d.transform.elevation;for(const ae of this._groundShadowTiles){let ie={min:0,max:0};if(Q){const ge=Q.getMinMaxForTile(ae);ge&&(ie=ge)}this.addShadowReceiver(ae.toUnwrapped(),ie.min,ie.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;const d=this.painter,y=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),y.viewport.set([0,0,_l,_l]);for(let b=0;b<this._numCascadesToRender;++b){d.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:n.ao.white,depth:1});for(const S of t.order){const I=t._mergedLayers[S];if(!I.hasShadowPass()||I.isHidden(d.transform.zoom))continue;const D=t.getLayerSourceCache(I),N=D?a[D.id]:void 0;(I.type==="model"||N&&N.length)&&d.renderLayer(d,D,I,N)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,a=t.style,d=t.context,y=d.gl,b=a.directionalLight,S=a.ambientLight;if(!b||!S)return;const I=[],D=ah(t,t.longestCutoffRange);D.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const N=Pc(a,b,S),V=new yn(y.LEQUAL,yn.ReadOnly,t.depthRangeFor3D),K=new jn({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const X of this._groundShadowTiles){const Q=X.toUnwrapped(),ae=t.isTileAffectedByFog(X),ie=t.getOrCreateProgram("groundShadow",{defines:I,overrideFog:ae});this.setupShadows(Q,ie),t.uploadCommonUniforms(d,ie,Q,null,D);const ge={u_matrix:t.transform.calculateProjMatrix(Q),u_ground_shadow_factor:N};ie.draw(t,y.TRIANGLES,V,K,hr.multiply,Vn.disabled,ge,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?hr.unblended:hr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const a=this.painter.transform,d=a.calculatePosMatrix(t,a.worldSize);return n.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){const a=n.bz(t);return n.aB(a,this._cascades[this.painter.currentShadowCascade].matrix,t),a}setupShadows(t,a,d){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,S=b.gl,I=this._uniformValues,D=new Float64Array(16),N=y.calculatePosMatrix(t,y.worldSize);for(let V=0;V<this._cascades.length;V++)n.aB(D,this._cascades[V].matrix,N),I[V===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(D),b.activeTexture.set(S.TEXTURE0+_s.ShadowMap0+V),this._cascades[V].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const V=n.d7(t.canonical),K=2/y.tileSize*n.al/_l,X=K*this._cascades[0].boundingSphereRadius,Q=K*this._cascades[this._cascades.length-1].boundingSphereRadius,ae=(d==="vector-tile"?1:3)*(function(ie,ge,me,Se,De){const Ee=n.aA((ie-22)/-22,0,1);return .125*(1-Ee)+4*Ee})(y.zoom);I.u_shadow_normal_offset=[V,X*ae,Q*ae],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,I)}setupShadowsFromMatrix(t,a,d=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,S=this._uniformValues,I=new Float64Array(16);for(let D=0;D<2;D++)n.aB(I,this._cascades[D].matrix,t),S[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),y.activeTexture.set(b.TEXTURE0+_s.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);this.useNormalOffset=d,d?(S.u_shadow_normal_offset=[1,3,3],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],a.setShadowUniformValues(y,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,d,y){if(y[2]>=0)return{};const b=(function(D,N,V){const K=V/(1<<D.canonical.z);return new n.d9([D.canonical.x*K+D.wrap*V,D.canonical.y*K+D.wrap*V,0],[(D.canonical.x+1)*K+D.wrap*V,(D.canonical.y+1)*K+D.wrap*V,N])})(t,a,d).getCorners(),S=a/-y[2];y[0]<0?(n.d8(b[0],b[0],[y[0]*S,0,0]),n.d8(b[3],b[3],[y[0]*S,0,0])):y[0]>0&&(n.d8(b[1],b[1],[y[0]*S,0,0]),n.d8(b[2],b[2],[y[0]*S,0,0])),y[1]<0?(n.d8(b[0],b[0],[0,y[1]*S,0]),n.d8(b[1],b[1],[0,y[1]*S,0])):y[1]>0&&(n.d8(b[2],b[2],[0,y[1]*S,0]),n.d8(b[3],b[3],[0,y[1]*S,0]));const I={};return I.vertices=b,I.planes=[sd(b[1],b[0],b[4]),sd(b[2],b[1],b[5]),sd(b[3],b[2],b[6]),sd(b[0],b[3],b[7])],I}addShadowReceiver(t,a,d){this._receivers.add(t,n.d9.fromTileIdAndHeight(t,a,d))}getMaxCascadeForTile(t){const a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function sd(h,t,a){const d=n.av([],a,t),y=n.av([],h,t),b=n.bI([],d,y),S=n.ag(b);return S===0?[0,0,1,0]:(n.c5(b,b,1/S),[b[0],b[1],b[2],-n.bJ(b,t)])}function du(h){const t=h.properties.get("direction"),a=n.d4(t.x,t.y,t.z);a[2]=n.aA(a[2],0,75);const d=n.d6([a[0],a[1],a[2]]);return n.d5(d.x,d.y,d.z)}function Pc(h,t,a){const d=t.properties.get("color-use-theme")==="none",y=t.properties.get("color"),b=t.properties.get("intensity"),S=t.properties.get("direction"),I=[S.x,S.y,S.z],D=a.properties.get("color-use-theme")==="none",N=a.properties.get("color"),V=a.properties.get("intensity"),K=Math.max(n.bJ([0,0,1],I),0),X=[0,0,0];n.c5(X,N.toPremultipliedRenderColor(D?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),V);const Q=[0,0,0];return n.c5(Q,y.toPremultipliedRenderColor(d?null:h.getLut(a.scope)).toArray01Linear().slice(0,3),K*b),n.db([X[0]>0?X[0]/(X[0]+Q[0]):0,X[1]>0?X[1]/(X[1]+Q[1]):0,X[2]>0?X[2]/(X[2]+Q[2]):0])}function Lc(h,t,a,d,y,b){const S=h.zoom,I=h.scale,D=h.worldSize,N=1/D,V=h.aspect,K=Math.sqrt(1+V*V)*Math.tan(.5*h.fovX),X=K*K,Q=d-a,ae=d+a;let ie,ge;X>Q/ae?(ie=d,ge=d*K):(ie=.5*ae*(1+X),ge=.5*Math.sqrt(Q*Q+2*(d*d+a*a)*X+ae*ae*X*X));const me=h.projection.pixelsPerMeter(h.center.lat,D),Se=h._camera.getCameraToWorldMercator(),De=[0,0,-ie*N];n.af(De,De,Se);let Ee=ge*N;const We=h._edgeInsets;if(!(We.left===0&&We.top===0&&We.right===0&&We.bottom===0||We.left===We.right&&We.top===We.bottom)){const li=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?me:1),Mi=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,a,d);Mi[8]=2*-h.centerOffset.x/h.width,Mi[9]=2*h.centerOffset.y/h.height;const ki=new Float64Array(16);n.cP(ki,Mi,li);const Ei=new Float64Array(16);n.bl(Ei,ki);const _i=n.cB.fromInvProjectionMatrix(Ei,D,S,!0);for(const fn of _i.points){const nn=((Ve=fn)[0]/=I,Ve[1]/=I,Ve[2]=n.cf(Ve[2],h._center.lat),Ve);Ee=Math.max(Ee,n.c6(n.da([],De,nn)))}}var Ve;Ee*=y/(y-1);const He=Math.acos(t[2]),Ne=Math.atan2(-t[0],-t[1]),Oe=new If;Oe.position=De,Oe.setPitchBearing(He,Ne);const nt=Oe.getWorldToCamera(D,me),mt=Ee*D,dt=Math.min(h._mercatorZfromZoom(17)*D*-2,-2*mt),At=Oe.getCameraToClipOrthographic(-mt,mt,-mt,mt,dt,(mt+b*me)/t[2]),Ct=new Float64Array(16);n.aB(Ct,At,nt);const Dt=n.d5(Math.floor(1e6*De[0])/1e6*D,Math.floor(1e6*De[1])/1e6*D,0),Kt=.5*y,vt=[0,0,0];n.af(vt,Dt,Ct),n.c5(vt,vt,Kt);const rt=[Math.floor(vt[0]),Math.floor(vt[1]),Math.floor(vt[2])],Nt=[0,0,0];n.av(Nt,vt,rt),n.c5(Nt,Nt,-1/Kt);const Lt=new Float64Array(16);return n.bA(Lt),n.br(Lt,Lt,Nt),n.aB(Ct,Lt,Ct),[Ct,mt]}class fu extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,a){return n.dc(this.requestManager.transformRequest(a,n.R.Model).url).then((d=>{if(!d)return;const y=n.dd(d),b=new n.de(t,a,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b})).catch((d=>{if(d&&d.status===404)return null;this.fire(new n.y(new Error(`Could not load model ${t} from ${a}: ${d.message}`)))}))}load(t,a,d={forceReload:!1}){this.models[a]||(this.models[a]={});const y=Object.keys(t),b=[],S=[];for(const I of y){const D=t[I];this.hasURLBeenRequested(D)&&!d.forceReload||(this.modelByURL[D]={modelId:I,scope:a},b.push(this.loadModel(I,D)),S.push(I)),this.models[a][I]||(this.models[a][I]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+S.length,Promise.allSettled(b).then((I=>{for(let D=0;D<I.length;D++){const{status:N}=I[D];if(N==="rejected")continue;const{value:V}=I[D];this.models[a][S[D]]||(this.models[a][S[D]]={model:null,numReferences:1}),this.models[a][S[D]].model=V}this.numModelsLoading[a]-=S.length,this.fire(new n.z("data",{dataType:"style"}))})).catch((I=>{this.fire(new n.y(new Error(`Could not load models: ${I.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,a):this.getModelByURL(this.modelUris[a][t]))}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}getModelByURL(t){if(!t)return null;const a=this.modelByURL[t];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(t,a){return this.models[a]&&this.models[a][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,a,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const y=this.requestManager.normalizeModelURL(a);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===y)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:b,modelId:S}=this.modelByURL[y];this.models[b][S].numReferences++}else this.modelUris[d][t]=y,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const d=this.modelUris[a];for(const y in t)d[y]=this.requestManager.normalizeModelURL(t[y])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const d={};for(const y of t)this.hasModel(y,a,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[a][y].numReferences++:this.modelUris[a][y]&&!this.hasURLBeenRequested(y)?d[y]=this.modelUris[a][y]:!this.hasURLBeenRequested(y)&&n.df(y,!1)&&(this.modelUris[a][y]=this.requestManager.normalizeModelURL(y),d[y]=this.modelUris[a][y]);this.load(d,a)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,a,d=!1,y=!1){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0||y)){const b=this.modelUris[a][t];d||delete this.modelUris[a][t],delete this.modelByURL[b];const S=this.models[a][t].model;if(!S)return;delete this.models[a][t],S.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const a of Object.keys(this.models[t])){const d=this.models[t][a].model;delete this.models[t][a],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(const d in this.models[a])this.models[a][d].model&&this.models[a][d].model.upload(t.context)}}const Zc=n.a6.colorTheme,Cf=new n.a9({data:new n.aa(Zc.data)});function od(h){if(!h.metadata||!h.metadata.content_area)return;const t=n.o.devicePixelRatio,{left:a,top:d,width:y,height:b}=h.metadata.content_area,S=a*t,I=d*t;return[S,I,S+y*t,I+b*t]}function pu(h){if(h)return h.map((([t,a])=>[t*n.o.devicePixelRatio,a*n.o.devicePixelRatio]))}class Id{constructor(t,a,d){this.id=t,this.scope=a,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof va))return t;const y=a.map((S=>this.sourceCache.getTile(S))),b=d.getImages(y,Array.from(this.pendingRequests));for(const[S,I]of b)t.set(n.I.from({name:S,iconsetId:this.id}),I),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),t}}const mu=(h,t)=>Re(h,t&&t.filter((a=>a.identifier!=="source.canvas"))),zf=n.aH(Qr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),hm=n.aH(Qr,["setCenter","setZoom","setBearing","setPitch"]),Rf=new Set(["background","sky","slot","custom"]),ku={version:8,layers:[],sources:{}},ld={duration:300,delay:0};class Ll extends n.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=Object.assign({},ld),this._buildingIndex=new Ap(this),this.crossTileSymbolIndex=new Kl,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=a.styleChanges||new Ir,this._hasDataDrivenEmissive=!1,this.dispatcher=a.dispatcher?a.dispatcher:new n.D(n.dh(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new la(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new n.di(t._requestManager,a.localFontFamily?n.dj.all:a.localIdeographFontFamily?n.dj.ideographs:n.dj.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new fu(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._indoorDependentLayers=a.indoorDependentLayers?a.indoorDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",n.dk());const d=this;this._rtlTextPluginCallback=Ll.registerForPluginStateChange((y=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},((b,S)=>{if(n.dl(b),S&&S.every((I=>I)))for(const I in d._sourceCaches){const D=d._sourceCaches[I],N=D.getSource().type;N!=="vector"&&N!=="geojson"||D.reload()}}))})),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const I=this._layers[S];I.source===b.id&&this._validateLayer(I)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.h(t))return t;const a=n.dm(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${n.dn(JSON.stringify(t))}`}_diffStyle(t,a,d){this.globalId=this._getGlobalId(t);const y=(b,S)=>{try{S(null,this.setState(b,d))}catch(I){S(I,!1)}};if(typeof t=="string"){const b=this.map._requestManager.normalizeStyleURL(t),S=this.map._requestManager.transformRequest(b,n.R.Style);n.m(S,((I,D)=>{I?this.fire(new n.y(I)):D&&y(D,a)}))}else typeof t=="object"&&y(t,a)}loadURL(t,a={}){this.fire(new n.z("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!n.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);const y=this.importsCache.get(t);if(y)return this._load(y,d);const b=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.m(b,((S,I)=>{if(this._request=null,S)this.fire(new n.y(S));else if(I)return this.importsCache.set(t,I),this._load(I,d)}))}loadJSON(t,a={}){this.fire(new n.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.o.frame((()=>{this._request=null,this._load(t,a.validate!==!1)}))}loadEmpty(){this.fire(new n.z("dataloading",{dataType:"style"})),this._load(ku,!1)}_loadImports(t,a,d){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of t){const S=this._createFragmentStyle(b),I=new Promise((V=>{S.once("style.import.load",V),S.once("error",V)})).then((()=>this.mergeAll()));if(y.push(I),this.resolvedImports.has(b.url)){S.loadEmpty();continue}const D=b.data||this.importsCache.get(b.url);D?(S.loadJSON(D,{validate:a}),this._isInternalStyle(D)&&(S.globalId=null)):b.url?S.loadURL(b.url,{validate:a}):S.loadEmpty();const N={style:S,id:b.id,config:b.config};if(d){const V=this.fragments.findIndex((({id:K})=>K===d));this.fragments=this.fragments.slice(0,V).concat(N).concat(this.fragments.slice(V))}else this.fragments.push(N)}return Promise.allSettled(y)}getImportGlobalIds(t=this,a=new Set){for(const d of t.fragments)d.style.globalId&&a.add(d.style.globalId),this.getImportGlobalIds(d.style,a);return[...a.values()]}_createFragmentStyle(t){const a=this.scope?n.B(t.id,this.scope):t.id;let d;const y=this._initialConfig&&this._initialConfig[a];(t.config||y)&&(d=Object.assign({},t.config,y));const b=new Ll(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){if(this._isInternalStyle(t)){const b=Object.assign({},ku,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(b,a)}if(this.updateConfig(this._config,t.schema),a&&mu(this,gt(t)))return;this._loaded=!0,this.stylesheet=n.dp(t);const d=()=>{for(const D in t.sources)this.addSource(D,t.sources[D],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const D in t.iconsets)this.addIconset(D,t.iconsets[D]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const b=nh(this.stylesheet.layers);if(this._order=b.map((D=>D.id)),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const D=this.stylesheet.lights[0];this.light=new at(D.properties,D.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new at(this.stylesheet.light)),this._layers={};for(const D of b){const N=n.du(D,this.scope,this._styleColorTheme.lut,this.options);N.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(N.fqid),N.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(N.fqid),this._hasAppearances=this._hasAppearances||N.getAppearances().length!==0,N.setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N;const V=this.getOwnLayerSourceCache(N),K=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&N.canCastShadows()&&K&&(V.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.z("data",{dataType:"style"}));const I=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then((()=>{this._reloadImports(),this.fire(new n.z(I?"style.load":"style.import.load"))})).catch((D=>{this.fire(new n.y(new Error("Failed to load imports",D))),this.fire(new n.z(I?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new n.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then((()=>{d()})).catch((S=>{n.w(`Couldn't load color theme from the stylesheet: ${S}`),d()}))}else this._styleColorTheme.lut=null,d()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some((t=>t.style.hasAppearances()))}mergeAll(){let t,a,d,y,b,S,I,D,N,V;const K={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((X=>{if(X.stylesheet){if(X.light!=null&&(t=X.light),X.stylesheet.lights)for(const Q of X.stylesheet.lights)Q.type==="ambient"&&X.ambientLight!=null&&(a=X.ambientLight),Q.type==="directional"&&X.directionalLight!=null&&(d=X.directionalLight);y=this._prioritizeTerrain(y,X.terrain,X.stylesheet.terrain),X.stylesheet.fog&&X.fog!=null&&(b=X.fog),X.stylesheet.snow&&X.snow!=null&&(S=X.snow),X.stylesheet.rain&&X.rain!=null&&(I=X.rain),X.stylesheet.camera!=null&&(V=X.stylesheet.camera),X.stylesheet.projection!=null&&(D=X.stylesheet.projection),X.stylesheet.transition!=null&&(N=X.stylesheet.transition),K[X.scope]=X._styleColorTheme}})),this.light=t,this.ambientLight=a,this.directionalLight=d,this.fog=b,this.snow=S,this.rain=I,this._styleColorThemeForScope=K,y===null?delete this.terrain:this.terrain=y,this.camera=V||{"camera-projection":"perspective"},this.projection=D||{name:"mercator"},this.transition=Object.assign({},ld,N),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const a=d=>{for(const y of d.fragments)a(y.style);t(d)};a(this)}_prioritizeTerrain(t,a,d){const y=t&&t.drapeRenderMode===0;return d===null?a&&a.drapeRenderMode===0?a:y?t:null:a!=null&&(!t||y||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},a={},d={};this.forEachFragmentStyle((y=>{for(const b in y._sourceCaches){const S=n.B(b,y.scope);t[S]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const S=n.B(b,y.scope);a[S]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const S=n.B(b,y.scope);d[S]=y._symbolSourceCaches[b]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=d}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const a of Object.values(t.stylesheet.indoor)){const d=a,y=n.B(d.sourceId,t.scope);this._mergedIndoor[y]=new Set(d.sourceLayers||[])}}))}mergeLayers(){const t={},a=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((S=>{for(const I of S._order){const D=S._layers[I];if(D.type==="slot"){const N=n.dq(I);if(t[N])continue;t[N]=[]}D.slot&&t[D.slot]?t[D.slot].push(D):a.push(D)}})),this._mergedOrder=[];let y=-1;const b=(S=[])=>{for(const I of S)if(I.type==="slot"){const D=n.dq(I.id);t[D]&&b(t[D]),this._mergedSlots.push(D)}else{const D=n.B(I.id,I.scope);this._mergedOrder.push(D),d[D]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(a),this._has3DLayers){const S={};for(let I=0;I<this._mergedOrder.length;++I){const D=this._mergedOrder[I];S[D]=I===y?1:I<y?d[D].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((I,D)=>S[I]-S[D]))}this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(a,d,y,b){const S=Object.assign({},d);for(const D of Object.keys(Zc))S[D]===void 0&&(S[D]=Zc[D].default);const I=new n.a8(Cf,a,new Map(y));return I.setTransitionOrValue(S,y),I.untransitioned().possiblyEvaluate(new n.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((d,y)=>{const b="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let S=t;S.startsWith(b)||(S=b+S);const I=n.I.from("mapbox-reserved-lut"),D=new Image;D.src=S,D.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},D.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void d();this._styleColorTheme.lutLoading=!1;const{width:N,height:V,data:K}=n.o.getImageData(D);if(V>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==V*V)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new n.q({width:N,height:V},K),pixelRatio:1,sdf:!1,usvg:!1,version:0});const X=this.imageManager.getImage(I,this.scope);X?(this._styleColorTheme.lut={image:X.data,data:t},d()):y(new Error("Missing LUT image."))}}))}getLut(t){const a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(a,d,y){let b,S,I;const D=n.o.devicePixelRatio>1?"@2x":"";let N=n.m(d.transformRequest(d.normalizeSpriteURL(a,D,".json"),n.R.SpriteJSON),((X,Q)=>{N=null,I||(I=X,b=Q,K())})),V=n.n(d.transformRequest(d.normalizeSpriteURL(a,D,".png"),n.R.SpriteImage),((X,Q)=>{V=null,I||(I=X,S=Q,K())}));function K(){if(I)y(I);else if(b&&S){const X=n.o.getImageData(S),Q={};for(const ae in b){const{width:ie,height:ge,x:me,y:Se,sdf:De,pixelRatio:Ee,stretchX:We,stretchY:Ve,content:He}=b[ae],Ne=new n.q({width:ie,height:ge});n.q.copy(X,Ne,{x:me,y:Se},{x:0,y:0},{width:ie,height:ge},null),Q[ae]={data:Ne,pixelRatio:Ee!==void 0?Ee:1,sdf:De!==void 0&&De,stretchX:We,stretchY:Ve,content:He,usvg:!1,version:0}}y(null,Q)}}return{cancel(){N&&(N.cancel(),N=null),V&&(V.cancel(),V=null)}}})(t,this.map._requestManager,((a,d)=>{if(this._spriteRequest=null,a)this.fire(new n.y(a));else if(d){const y=new Map;for(const b in d)y.set(n.I.from(b),d[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))}))}addIconset(t,a){if(a.type==="sprite")return void this._loadSprite(a.url);const d=this.getOwnSourceCache(a.source);if(!d)return void this.fire(new n.y(new Error(`Source "${a.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const y=d.getSource();if(y.type!=="raster-array")return void this.fire(new n.y(new Error(`Source "${a.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const b=new Id(t,this.scope,d);this.imageManager.addImageProvider(b,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!n.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const a=this.map._spriteFormat==="auto";var d,y;this._spriteRequest=(y=(b,S)=>{if(this._spriteRequest=null,b)a?this._loadSprite(t):this.fire(new n.y(b));else if(S){const I=new Map;for(const D in S)I.set(n.I.from(D),S[D]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))},n.bu((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),n.R.Iconset),((b,S)=>{if(b)return void y(b);const I={},D=n.dg(new n.bt(S));for(const N of D.icons){const V={version:1,pixelRatio:n.o.devicePixelRatio,content:od(N),stretchX:N.metadata?pu(N.metadata.stretch_x_areas):void 0,stretchY:N.metadata?pu(N.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:N};I[N.name]=V}y(null,I)})))}_validateLayer(t){const a=this.getOwnSource(t.source);if(!a)return;const d=t.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new n.y(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,a)=>{const d=this.fragments[a];return d&&d.style&&(t.data=d.style.serialize()),t}))}_serializeSources(){const t={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const a=[];for(const d of t){const y=this._layers[d];y&&y.type!=="custom"&&a.push(y.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const a=this._mergedLayers[t];if(a._transitionablePaint&&a._transitionablePaint._values){const d=a._transitionablePaint._values["line-emissive-strength"];if(d&&d.value&&d.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const a=this.getOwnLayer(t);if(a)return a;this.fire(new n.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const a=this.getOwnSource(t);if(a)return a;this.fire(new n.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){const d=this.map.painter;if(d)for(let y=t.minzoom||0;y<(t.maxzoom||25.5);y++){const b=t.getProgramIds();if(b)for(const S of b){const I=t.getDefaultProgramParams(S,a.zoom,this._styleColorTheme.lut);I&&(d.style=this,this.fog&&(d._fogVisible=!0,I.overrideFog=!0,d.getOrCreateProgram(S,I)),d._fogVisible=!1,I.overrideFog=!1,d.getOrCreateProgram(S,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,d.getOrCreateProgram(S,I)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const D in I){const{updatedIds:N,removedIds:V}=I[D];(N||V)&&(this._updateWorkerLayers(D,N,V),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const b={};for(const I in this._mergedSourceCaches){const D=this._mergedSourceCaches[I];b[I]=D.used,D.used=!1,D.tileCoverLift=0}for(const I of this._mergedOrder){const D=this._mergedLayers[I];if(D.visibility!=="none"&&D.recalculate(t,this._availableImages),!D.isHidden(t.zoom)){const N=this.getLayerSourceCache(D);N&&(N.used=!0,N.tileCoverLift=Math.max(N.tileCoverLift,D.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(D,t)})):this.precompilePrograms(D,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const I of S)I.sourceCache.used=!0;for(const I in b){const D=this._mergedSourceCaches[I];b[I]!==D.used&&D.getSource().fire(new n.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:D.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new n.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const a of t){const d=a.resolvePendingRequests(),y=this.getFragmentStyle(a.scope);y&&y.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const a in this._mergedSourceCaches){const d=this._mergedSourceCaches[a].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const a in t)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(t,a,d){const y=this.getFragmentStyle(t);y&&this.dispatcher.broadcast("updateLayers",{layers:a?y._serializeLayers(a):[],scope:t,removedIds:d||[],options:y.options})}setState(t,a){if(this._checkLoaded(),mu(this,gt(t)))return!1;(t=n.dp(t)).layers=nh(t.layers);const d=(function(S,I){if(!S)return[{command:Qr.setStyle,args:[I]}];let D=[];try{if(!n.by(S.version,I.version))return[{command:Qr.setStyle,args:[I]}];if(n.by(S.center,I.center)||D.push({command:Qr.setCenter,args:[I.center]}),n.by(S.zoom,I.zoom)||D.push({command:Qr.setZoom,args:[I.zoom]}),n.by(S.bearing,I.bearing)||D.push({command:Qr.setBearing,args:[I.bearing]}),n.by(S.pitch,I.pitch)||D.push({command:Qr.setPitch,args:[I.pitch]}),n.by(S.sprite,I.sprite)||D.push({command:Qr.setSprite,args:[I.sprite]}),n.by(S.glyphs,I.glyphs)||D.push({command:Qr.setGlyphs,args:[I.glyphs]}),n.by(S.imports,I.imports)||(function(Q=[],ae=[],ie){ae=ae||[];const ge=(Q=Q||[]).map(zu),me=ae.map(zu),Se=Q.reduce(Ru,{}),De=ae.reduce(Ru,{}),Ee=ge.slice();let We,Ve,He,Ne;for(We=0,Ve=0;We<ge.length;We++)He=ge[We],De.hasOwnProperty(He)?Ve++:(ie.push({command:Qr.removeImport,args:[He]}),Ee.splice(Ee.indexOf(He,Ve),1));for(We=0,Ve=0;We<me.length;We++)He=me[me.length-1-We],Ee[Ee.length-1-We]!==He&&(Se.hasOwnProperty(He)?(ie.push({command:Qr.removeImport,args:[He]}),Ee.splice(Ee.lastIndexOf(He,Ee.length-Ve),1)):Ve++,Ne=Ee[Ee.length-We],ie.push({command:Qr.addImport,args:[De[He],Ne]}),Ee.splice(Ee.length-We,0,He));for(const Oe of ae){const nt=Se[Oe.id];nt&&(delete nt.data,n.by(nt,Oe)||ie.push({command:Qr.updateImport,args:[Oe.id,Oe]}))}})(S.imports,I.imports,D),n.by(S.transition,I.transition)||D.push({command:Qr.setTransition,args:[I.transition]}),n.by(S.light,I.light)||D.push({command:Qr.setLight,args:[I.light]}),n.by(S.fog,I.fog)||D.push({command:Qr.setFog,args:[I.fog]}),n.by(S.snow,I.snow)||D.push({command:Qr.setSnow,args:[I.snow]}),n.by(S.rain,I.rain)||D.push({command:Qr.setRain,args:[I.rain]}),n.by(S.projection,I.projection)||D.push({command:Qr.setProjection,args:[I.projection]}),n.by(S.lights,I.lights)||D.push({command:Qr.setLights,args:[I.lights]}),n.by(S.camera,I.camera)||D.push({command:Qr.setCamera,args:[I.camera]}),n.by(S.iconsets,I.iconsets)||(function(Q,ae,ie){let ge;for(ge in ae=ae||{},Q=Q||{})Q.hasOwnProperty(ge)&&(ae.hasOwnProperty(ge)||ie.push({command:Qr.removeIconset,args:[ge]}));for(ge in ae){if(!ae.hasOwnProperty(ge))continue;const me=ae[ge];Q.hasOwnProperty(ge)?n.by(Q[ge],me)||(ie.push({command:Qr.removeIconset,args:[ge]}),ie.push({command:Qr.addIconset,args:[ge,me]})):ie.push({command:Qr.addIconset,args:[ge,me]})}})(S.iconsets,I.iconsets,D),!n.by(S["color-theme"],I["color-theme"]))return[{command:Qr.setStyle,args:[I]}];const N={},V=[];(function(Q,ae,ie,ge){let me;for(me in ae=ae||{},Q=Q||{})Q.hasOwnProperty(me)&&(ae.hasOwnProperty(me)||qd(me,ie,ge));for(me in ae){if(!ae.hasOwnProperty(me))continue;const Se=ae[me];Q.hasOwnProperty(me)?n.by(Q[me],Se)||(Q[me].type==="geojson"&&Se.type==="geojson"&&Cl(Q,ae,me)?ie.push({command:Qr.setGeoJSONSourceData,args:[me,Se.data]}):Il(me,ae,ie,ge)):rh(me,ae,ie)}})(S.sources,I.sources,V,N);const K=[];S.layers&&S.layers.forEach((Q=>{Q.source&&N[Q.source]?D.push({command:Qr.removeLayer,args:[Q.id]}):K.push(Q)}));let X=S.terrain;X&&N[X.source]&&(D.push({command:Qr.setTerrain,args:[void 0]}),X=void 0),D=D.concat(V),n.by(X,I.terrain)||D.push({command:Qr.setTerrain,args:[I.terrain]}),(function(Q,ae,ie){ae=ae||[];const ge=(Q=Q||[]).map(zu),me=ae.map(zu),Se=Q.reduce(Ru,{}),De=ae.reduce(Ru,{}),Ee=ge.slice(),We=Object.create(null);let Ve,He,Ne,Oe,nt,mt,dt;for(Ve=0,He=0;Ve<ge.length;Ve++)Ne=ge[Ve],De.hasOwnProperty(Ne)?He++:(ie.push({command:Qr.removeLayer,args:[Ne]}),Ee.splice(Ee.indexOf(Ne,He),1));for(Ve=0,He=0;Ve<me.length;Ve++)Ne=me[me.length-1-Ve],Ee[Ee.length-1-Ve]!==Ne&&(Se.hasOwnProperty(Ne)?(ie.push({command:Qr.removeLayer,args:[Ne]}),Ee.splice(Ee.lastIndexOf(Ne,Ee.length-He),1)):He++,mt=Ee[Ee.length-Ve],ie.push({command:Qr.addLayer,args:[De[Ne],mt]}),Ee.splice(Ee.length-Ve,0,Ne),We[Ne]=!0);for(Ve=0;Ve<me.length;Ve++)if(Ne=me[Ve],Oe=Se[Ne],nt=De[Ne],!We[Ne]&&!n.by(Oe,nt))if(n.by(Oe.source,nt.source)&&n.by(Oe["source-layer"],nt["source-layer"])&&n.by(Oe.type,nt.type)){for(dt in Cu(Oe.layout,nt.layout,ie,Ne,null,Qr.setLayoutProperty),Cu(Oe.paint,nt.paint,ie,Ne,null,Qr.setPaintProperty),n.by(Oe.slot,nt.slot)||ie.push({command:Qr.setSlot,args:[Ne,nt.slot]}),n.by(Oe.filter,nt.filter)||ie.push({command:Qr.setFilter,args:[Ne,nt.filter]}),n.by(Oe.minzoom,nt.minzoom)&&n.by(Oe.maxzoom,nt.maxzoom)||ie.push({command:Qr.setLayerZoomRange,args:[Ne,nt.minzoom,nt.maxzoom]}),Oe)Oe.hasOwnProperty(dt)&&dt!=="layout"&&dt!=="paint"&&dt!=="filter"&&dt!=="metadata"&&dt!=="minzoom"&&dt!=="maxzoom"&&dt!=="slot"&&(dt.indexOf("paint.")===0?Cu(Oe[dt],nt[dt],ie,Ne,dt.slice(6),Qr.setPaintProperty):n.by(Oe[dt],nt[dt])||ie.push({command:Qr.setLayerProperty,args:[Ne,dt,nt[dt]]}));for(dt in nt)nt.hasOwnProperty(dt)&&!Oe.hasOwnProperty(dt)&&dt!=="layout"&&dt!=="paint"&&dt!=="filter"&&dt!=="metadata"&&dt!=="minzoom"&&dt!=="maxzoom"&&dt!=="slot"&&(dt.indexOf("paint.")===0?Cu(Oe[dt],nt[dt],ie,Ne,dt.slice(6),Qr.setPaintProperty):n.by(Oe[dt],nt[dt])||ie.push({command:Qr.setLayerProperty,args:[Ne,dt,nt[dt]]}))}else ie.push({command:Qr.removeLayer,args:[Ne]}),mt=Ee[Ee.lastIndexOf(Ne)+1],ie.push({command:Qr.addLayer,args:[nt,mt]})})(K,I.layers,D)}catch(N){console.warn("Unable to compute style diff:",N),D=[{command:Qr.setStyle,args:[I]}]}return D})(this.serialize(),t).filter((S=>!(S.command in hm)));if(d.length===0)return!1;const y=d.filter((S=>!(S.command in zf)));if(y.length>0)throw new Error(`Unimplemented: ${y.map((S=>S.command)).join(", ")}.`);const b=[];return d.forEach((S=>{b.push(this[S.command](...S.args))})),a&&Promise.all(b).then(a).catch(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[a,d]of t.entries()){if(this.getImage(a))return this.fire(new n.y(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,d),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this}addImage(t,a){return this.getImage(t)?this.fire(new n.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,a),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this)}updateImage(t,a,d=!1){this.imageManager.updateImage(t,this.scope,a),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new n.z("data",{dataType:"style"})),this}addModel(t,a,d={}){return this._checkLoaded(),this._validate(te,`models.${t}`,a,null,d)||(this.modelManager.addModel(t,a,this.getActualScope()),this.fire(new n.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,a,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(jt,`sources.${t}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const y=to(t,a,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id})));const b=S=>{const I=(S?"symbol:":"other:")+y.id,D=n.B(I,this.scope),N=this._sourceCaches[I]=new Ho(D,y,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=N,N.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find((([b,S])=>S.type==="source"&&S.source===t));if(y)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while iconset "${y[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const y of d){const b=n.dq(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new n.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){const a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){const t=[];for(const a in this._otherSourceCaches){const d=this.getOwnSourceCache(a);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const a in t){const d=t[a]._tiles;for(const y in d){const b=d[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const b of t){if(this._validate(ei,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(b),S.updateTransitions(a)}else this.ambientLight=new $r(b,ts||(ts=new n.a9({color:new n.aa(n.a6.properties_light_ambient.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(b),S.updateTransitions(a)}else this.directionalLight=new $r(b,cs||(cs=new n.a9({direction:new n.ap(n.a6.properties_light_directional.direction),color:new n.aa(n.a6.properties_light_directional.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_directional.intensity),"cast-shadows":new n.aa(n.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new n.aa(n.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.aa(n.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(a,{worldview:this.map.getWorldview()}),y=new n.ac(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;const d=X=>.2126*(X[0]<=.03928?X[0]/12.92:Math.pow((X[0]+.055)/1.055,2.4))+.7152*(X[1]<=.03928?X[1]/12.92:Math.pow((X[1]+.055)/1.055,2.4))+.0722*(X[2]<=.03928?X[2]/12.92:Math.pow((X[2]+.055)/1.055,2.4)),y=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=t.properties.get("intensity"),S=t.properties.get("direction"),I=1-n.d4(S.x,S.y,S.z)[2]/90,D=d(y)*b*I,N=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),V=a.properties.get("intensity"),K=d(N)*V;return Number(((D+K)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(n.dr(t)){const a=n.ds(t),d=this.fragments.find((({id:b})=>b===a));if(!d)return;const y=n.dq(t);return d.style.getFragmentStyle(y)}{const a=this.fragments.find((({id:d})=>d===t));return a?a.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const a={},d=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in t){const b=this._featuresetSelectors[y]=[];for(const S of t[y].selectors){if(S.featureNamespace){const D=this.getOwnLayer(S.layer);if(!D){n.w(`Layer is undefined for selector: ${S.layer}`);continue}const N=d(D.source,D.sourceLayer);if(N in a&&a[N]!==S.featureNamespace){n.w(`"featureNamespace ${S.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}a[N]=S.featureNamespace}let I;if(S.properties)for(const D in S.properties){const N=n.U(S.properties[D]);N.result==="success"&&(I=I||{},I[D]=N.value)}b.push({layerId:S.layer,namespace:S.featureNamespace,properties:I,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const a=this.getFragmentStyle(t);if(!a||!a.stylesheet.featuresets)return[];const d=[];for(const y in a.stylesheet.featuresets)d.push({featuresetId:y,importId:a.scope?a.scope:void 0});return d}getFeaturesetLayers(t,a){const d=this.getFragmentStyle(a),y=d.stylesheet.featuresets;if(!y||!y[t])return this.fire(new n.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const S of y[t].selectors){const I=d.getOwnLayer(S.layer);I&&b.push(I)}return b}getConfigProperty(t,a){const d=this.getFragmentStyle(t);if(!d)return null;const y=n.B(a,d.scope),b=d.options.get(y),S=b?b.value||b.default:null;return S?S.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,a){const d=n.B(t,a);return this._mergedIndoor[d]}setIndoorData(t,a){this.map.indoor.setIndoorData(a)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,a,d){const y=this.getFragmentStyle(t);if(!y)return;const b=y.stylesheet.schema;if(!b||!b[a])return;const S=n.U(d);if(S.result!=="success")return void mu(this,S.value);const I=S.value.expression,D=n.B(a,y.scope),N=y.options.get(D);if(!N)return;let V;const{minValue:K,maxValue:X,stepValue:Q,type:ae,values:ie}=b[a],ge=n.U(b[a].default);ge.result==="success"&&(V=ge.value.expression),V?(this.options.set(D,Object.assign({},N,{value:I,default:V,minValue:K,maxValue:X,stepValue:Q,type:ae,values:ie})),this.updateConfigDependencies(a)):this.fire(new n.y(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){const a=this.getFragmentStyle(t);if(!a)return null;const d=a.stylesheet.schema;if(!d)return null;const y={};for(const b in d){const S=n.B(b,a.scope),I=a.options.get(S),D=I?I.value||I.default:null;y[b]=D?D.serialize():null}return y}setConfig(t,a){const d=this.getFragmentStyle(t);d&&(d.updateConfig(a,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=a,d.updateConfig(d._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(const d in a){let y,b;const S=n.U(a[d].default);if(S.result==="success"&&(y=S.value.expression),t&&t[d]!==void 0){const X=n.U(t[d]);X.result==="success"&&(b=X.value.expression)}const{minValue:I,maxValue:D,stepValue:N,type:V,values:K}=a[d];if(y){const X=n.B(d,this.scope);this.options.set(X,{default:y,value:b,minValue:I,maxValue:D,stepValue:N,type:V,values:K})}else this.fire(new n.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new n.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,a=(()=>!0)){for(const d of t){const y=this.getLayer(d);y&&a(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(a=>!t||a.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((a=>{const d=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(d){const y=a._evaluateColorThemeData(d);(!a._styleColorTheme.lut&&y!==""||a._styleColorTheme.lut&&y!==a._styleColorTheme.lut.data)&&a.setColorTheme(d)}})),this._changes.setDirty()}addLayer(t,a,d={}){this._checkLoaded();const y=t.id;if(this._layers[y])return void this.fire(new n.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(t.type==="custom"){if(mu(this,n.dt(t)))return;b=n.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=n.dp(t),t=Object.assign(t,{source:y})),this._validate(kn,`layers.${y}`,t,{arrayIndex:-1},d))return;b=n.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const S=n.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S);let I=this._order.length;if(a){const K=this._order.indexOf(a);if(K===-1)return void this.fire(new n.y(new Error(`Layer with id "${a}" does not exist on this map.`)));b.slot===this._layers[a].slot?I=K:n.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(I,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const D=this.getOwnLayerSourceCache(b),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();D&&b.canCastShadows()&&N&&(D.castsShadows=!0);const V=this._changes.getRemovedLayer(b);if(V&&b.source&&D&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const K=n.B(b.source,b.scope);V.type!==b.type?this._changes.updateSourceCache(K,"clear"):(this._changes.updateSourceCache(K,"reload"),D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===a)return;const y=this._order.indexOf(t);this._order.splice(y,1);let b=this._order.length;if(a){const S=this._order.indexOf(a);if(S===-1)return void this.fire(new n.y(new Error(`Layer with id "${a}" does not exist on this map.`)));d.slot===this._layers[a].slot?b=S:n.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._indoorDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const y=this.getOwnLayerSourceCache(a);if(y&&y.castsShadows){let b=!1;for(const S in this._layers)if(this._layers[S].source===a.source&&this._layers[S].canCastShadows()){b=!0;break}y.castsShadows=b}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,d){this._checkLoaded();const y=this._checkLayer(t);y&&(y.minzoom===a&&y.maxzoom===d||(a!=null&&(y.minzoom=a),d!=null&&(y.maxzoom=d),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==a&&(d.slot=a,this._updateLayer(d))}setFilter(t,a,d={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!n.by(y.filter,a))return a==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(fr,`layers.${y.id}.filter`,a,{layerType:y.type},d)||(y.filter=n.dp(a),this._updateLayer(y)))}getFilter(t){const a=this._checkLayer(t);if(a)return n.dp(a.filter)}setLayoutProperty(t,a,d,y={}){this._checkLoaded();const b=this._checkLayer(t);if(b&&!n.by(b.getLayoutProperty(a),d)){if(d!=null&&(!y||y.validate!==!1)&&mu(b,ct.call(gt,{key:`layers.${t}.layout.${a}`,layerType:b.type,objectKey:a,value:d,styleSpec:n.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(a,d),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(t,a,d,y={}){this._checkLoaded();const b=this._checkLayer(t);b&&(a==="appearances"?(b.setAppearances(d),this._changes.setDirty()):b.isPaintProperty(a)?this.setPaintProperty(t,a,d,y):this.setLayoutProperty(t,a,d,y))}getLayoutProperty(t,a){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(a)}setPaintProperty(t,a,d,y={}){this._checkLoaded();const b=this._checkLayer(t);if(!b||n.by(b.getPaintProperty(a),d)||d!=null&&(!y||y.validate!==!1)&&mu(b,Cr.call(gt,{key:`layers.${t}.paint.${a}`,layerType:b.type,objectKey:a,value:d,styleSpec:n.a6})))return;const S=b.setPaintProperty(a,d);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),S&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(t,a){const d=this._checkLayer(t);if(d)return d.getPaintProperty(a)}setFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:D,importId:N}=t.target,V=this.getFragmentStyle(N),K=V.getFeaturesetLayers(D);for(const{source:X,sourceLayer:Q}of K)V.setFeatureState({id:t.id,source:X,sourceLayer:Q},a)}else if("layerId"in t.target){const{layerId:D}=t.target,N=this.getLayer(D);this.setFeatureState({id:t.id,source:N.source,sourceLayer:N.sourceLayer},a)}return}const d=t.source,y=t.sourceLayer,b=this._checkSource(d);if(!b)return;const S=b.type;if(S==="geojson"&&y)return void this.fire(new n.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!y)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(d);for(const D of I)D.setFeatureState(y,t.id,a)}removeFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:D,importId:N}=t.target,V=this.getFragmentStyle(N),K=V.getFeaturesetLayers(D);for(const{source:X,sourceLayer:Q}of K)V.removeFeatureState({id:t.id,source:X,sourceLayer:Q},a)}else if("layerId"in t.target){const{layerId:D}=t.target,N=this.getLayer(D);this.removeFeatureState({id:t.id,source:N.source,sourceLayer:N.sourceLayer},a)}return}const d=t.source,y=this._checkSource(d);if(!y)return;const b=y.type,S=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!S)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(d);for(const D of I)D.removeFeatureState(S,t.id,a)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let b;if("featuresetId"in t.target){const{featuresetId:S,importId:I}=t.target,D=this.getFragmentStyle(I),N=D.getFeaturesetLayers(S);for(const{source:V,sourceLayer:K}of N){const X=D.getFeatureState({id:t.id,source:V,sourceLayer:K});if(X&&!b)b=X;else if(!n.by(b,X))return void this.fire(new n.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:S}=t.target,I=this.getLayer(S);b=this.getFeatureState({id:t.id,source:I.source,sourceLayer:I.sourceLayer})}return b}const a=t.source,d=t.sourceLayer,y=this._checkSource(a);if(y){if(y.type!=="vector"||d)return t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(d,t.id);this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(d=>d!==void 0))}_updateFilteredLayers(t){for(const a of Object.values(this._mergedLayers))t(a)&&this._updateLayer(a)}_updateLayer(t){this._changes.updateLayer(t);const a=this.getLayerSourceCache(t),d=n.B(t.source,t.scope),y=this._changes.getUpdatedSourceCaches();t.source&&!y[d]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=I=>this._mergedLayers[I].is3D(!!this.terrain),d=this.order,y={},b=[];for(let I=d.length-1;I>=0;I--){const D=d[I];if(a(D)){y[D]=I;for(const N of t){const V=N[D];if(V)for(const K of V)b.push(K)}}}b.sort(((I,D)=>D.intersectionZ-I.intersectionZ));const S=[];for(let I=d.length-1;I>=0;I--){const D=d[I];if(a(D))for(let N=b.length-1;N>=0;N--){const V=b[N].feature;if(V.layer&&y[V.layer.id]<I)break;S.push(V),b.pop()}else for(const N of t){const V=N[D];if(V)for(const K of V)S.push(K.feature)}}return S}queryRasterValue(t,a,d){const y=this.getOwnSource(t);return y?y.type!=="raster-array"?(this.fire(new n.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(a,d):(this.fire(new n.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,a,d){let y;a&&!Array.isArray(a)&&a.filter&&(this._validate(fr,"queryRenderedFeatures.filter",a.filter,null,a),y=n.b6(a.filter));const b={},S=V=>{if(Rf.has(V.type))return;const K=this.getOwnLayerSourceCache(V),X=b[K.id]=b[K.id]||{sourceCache:K,layers:{},has3DLayers:!1};V.is3D(!!this.terrain)&&(X.has3DLayers=!0),X.layers[V.fqid]=X.layers[V.fqid]||{styleLayer:V,targets:[]},X.layers[V.fqid].targets.push({filter:y})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new n.y(new Error("parameters.layers must be an Array."))),[];for(const V of a.layers){const K=this._layers[V];if(!K)return this.fire(new n.y(new Error(`The layer '${V}' does not exist in the map's style and cannot be queried for features.`))),[];S(K)}}else for(const V in this._layers)S(this._layers[V]);const I=this._queryRenderedFeatures(t,b,d),D=this._flattenAndSortRenderedFeatures(I),N=[];for(const V of D)n.dw(V.layer.id)===this.scope&&N.push(V);return N}queryRenderedFeatureset(t,a,d){let y;a&&!Array.isArray(a)&&a.filter&&(this._validate(fr,"queryRenderedFeatures.filter",a.filter,null,a),y=n.b6(a.filter));const b="mock",S=[];if(a&&a.target)S.push(Object.assign({},a,{targetId:b,filter:y}));else{const V=this.getFeaturesetDescriptors();for(const K of V)S.push({targetId:b,filter:y,target:K});for(const{style:K}of this.fragments){const X=K.getFeaturesetDescriptors();for(const Q of X)S.push({targetId:b,filter:y,target:Q})}}const I=this.queryRenderedTargets(t,S,d),D=[],N=new Set;for(const V of I)for(const K of V.variants[b])Ah(K,V,N)||D.push(new n.dx(V,K));return D}queryRenderedTargets(t,a,d){const y={},b=(I,D,N,V)=>{const K=y[D.id]=y[D.id]||{sourceCache:D,layers:{},has3DLayers:!1};if(K.layers[I.fqid]=K.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(K.has3DLayers=!0),!V)return N.uniqueFeatureID=!1,void K.layers[I.fqid].targets.push(N);K.layers[I.fqid].targets.push(Object.assign({},N,{namespace:V.namespace,properties:V.properties,uniqueFeatureID:V.uniqueFeatureID}))};for(const I of a)if("featuresetId"in I.target){const{featuresetId:D,importId:N}=I.target,V=this.getFragmentStyle(N);if(!V||!V._featuresetSelectors)continue;const K=V._featuresetSelectors[D];if(!K){this.fire(new n.y(new Error(`The featureset '${D}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const X of K){const Q=V.getOwnLayer(X.layerId);Q&&!Rf.has(Q.type)&&b(Q,V.getOwnLayerSourceCache(Q),I,X)}}else if("layerId"in I.target){const{layerId:D}=I.target,N=this.getLayer(D);if(!N||Rf.has(N.type))continue;b(N,this.getLayerSourceCache(N),I)}const S=this._queryRenderedFeatures(t,y,d);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(t,a,d){const y=[],b=!!this.map._showQueryGeometry,S=_a.createFromScreenPoints(t,d);for(const I in a){const D=su(S,a[I],this._availableImages,d,b);Object.keys(D).length&&y.push(D)}if(this.placement)for(const I in a){if(!a[I].sourceCache._onlySymbols)continue;const D=Kh(S.screenGeometry,a[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(D).length&&y.push(D)}return y}querySourceFeatures(t,a){const d=a&&a.filter;d&&this._validate(fr,"querySourceFeatures.filter",d,null,a);let y=[];const b=this.getOwnSourceCaches(t);for(const S of b)y=y.concat(Jh(S,a));return y}addSourceType(t,a,d){return Ll.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(Ll.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,d={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const I in t)if(!n.by(t[I],y[I])){b=!0;break}if(!b)return;const S=this._getTransitionParameters();this.light.setLight(t,a,d),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const y=!("source"in t)||t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if("source"in d&&typeof d.source=="object"){const I="terrain-dem-src";this.addSource(I,d.source),d=n.dp(d),d=Object.assign(d,{source:I})}const b=Object.assign({},d),S={};if(this.terrain&&y){b.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(S.style=I.serialize())}if(this._validate(kt,"terrain",b,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&a!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,a),this.fire(new n.z("data",{dataType:"style"}))}else{const b=this.terrain,S=b.get();for(const I of Object.keys(n.a6.terrain))!d.hasOwnProperty(I)&&n.a6.terrain[I].default&&(d[I]=n.a6.terrain[I].default);for(const I in t)if(!n.by(t[I],S[I])){b.set(t,this.options),this.stylesheet.terrain=t;const D=this._getTransitionParameters({duration:0});b.updateTransitions(D),this.fire(new n.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Nn(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_createSnow(t){const a=this.snow=new Zs(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_createRain(t){const a=this.rain=new na(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!n.by(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!n.by(a.get(),t)){a.set(t,this.options),this.stylesheet.snow=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!n.by(a.get(),t)){a.set(t,this.options),this.stylesheet.rain=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(a);this._loadColorTheme(d).then((()=>{this.fire(new n.z("colorthemeset")),t()})).catch((y=>{n.w(`Couldn't set color theme: ${y}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,a){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=a,d._reloadColorTheme())}_getTransitionParameters(t){return{now:n.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],a=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):a.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const d=this.terrain=new lt(t,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,d,y,b={}){if(b&&b.validate===!1)return!1;const S=Object.assign({},this.serialize());return mu(this,t.call(gt,Object.assign({key:a,style:S,value:d,styleSpec:n.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const a=this.getSourceCaches(t);for(const d of a)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const a=this._mergedLayers[t];a._clear&&a._clear()}}reloadSource(t){const a=this.getSourceCaches(t);for(const d of a)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let a;this.directionalLight&&(a=du(this.directionalLight));const d=new Set,y=new Set;for(const b in this._mergedLayers){const S=this._mergedLayers[b];S.type==="building"&&d.add(S.source),S.hasElevation()&&!y.has(S.source)&&y.add(S.source)}for(const b in this._mergedSourceCaches){const S=this._mergedSourceCaches[b],I=y.has(S._source.id);d.has(S._source.id)&&(S._source.reparseOverscaled=!1),S.update(t,void 0,void 0,a,I)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,d,y,b,S,I=!1){let D=!1,N=!1;const V={},K={};for(const ie of this._mergedOrder){const ge=this._mergedLayers[ie];if(ge.type!=="symbol")continue;const me=n.B(ge.source,ge.scope);let Se=V[me];if(!Se){const Ee=this.getLayerSourceCache(ge);if(!Ee)continue;const We=Ee.getRenderableIds(!0).map((Ve=>Ee.getTileByID(Ve)));K[me]=We.slice(),Se=V[me]=We.sort(((Ve,He)=>He.tileID.overscaledZ-Ve.tileID.overscaledZ||(Ve.tileID.isLessThan(He.tileID)?-1:1)))}const De=this.crossTileSymbolIndex.addLayer(ge,Se,a.center.lng,a.projection);D=D||De}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new n.z("neworder"));const X=!!(this.placement&&!a.equals(this.placement.transform)),Q=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!S||this.placement.lastReplacementSourceUpdateTime!==S.updateTime)),ae=(X||Q||D||this.placement&&this.placement.isStale())&&y===0;if((I||!this.pauseablePlacement||ae||y!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.o.now(),a.zoom))&&(this.pauseablePlacement=new oo(a,this._mergedOrder,I||y===0,d,y,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,V,K,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.o.now()),N=!0),D&&this.pauseablePlacement.placement.setStale()),N||D){this._buildingIndex.onNewFrame(a.zoom);for(let ie=0;ie<this._mergedOrder.length;ie++){const ge=this._mergedLayers[this._mergedOrder[ie]];if(ge.type!=="symbol"||ge.visibility==="none")continue;const me=this.isLayerClipped(ge);this.placement.updateLayerOpacities(ge,V[n.B(ge.source,ge.scope)],ie,me?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex((({id:b})=>b===t.id))!==-1)return void this.fire(new n.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return d.push(t),this._loadImports([t],!0);const y=d.findIndex((({id:b})=>b===a));return y===-1&&this.fire(new n.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,y).concat(t).concat(d.slice(y)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);return y===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==d[y].url&&this.setImportUrl(t,a.url),n.by(a.config,d[y].config)||this.setImportConfig(t,a.config,a.data.schema),n.by(a.data,d[y].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let d=this.stylesheet.imports||[];const y=this.getImportIndex(t);if(y===-1)return this;const b=this.getImportIndex(a);if(b===-1)return this;const S=d[y],I=this.fragments[y];return d=d.filter((({id:D})=>D!==t)),this.fragments=this.fragments.filter((({id:D})=>D!==t)),this.stylesheet.imports=d.slice(0,b).concat(S).concat(d.slice(b)),this.fragments=this.fragments.slice(0,b).concat(I).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);if(y===-1)return this;d[y].url=a;const b=this.fragments[y];return b.style=this._createFragmentStyle(d[y]),b.style.on("style.import.load",(()=>this.mergeAll())),b.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();const d=this.getImportIndex(t),y=this.stylesheet.imports||[];return d===-1?this:a?(this.fragments[d].style.setState(a),this._reloadImports(),this):(delete y[d].data,this.setImportUrl(t,y[d].url))}setImportConfig(t,a,d){this._checkLoaded();const y=this.getImportIndex(t),b=this.stylesheet.imports||[];if(y===-1)return this;a?b[y].config=a:delete b[y].config;const S=this.fragments[y];d&&S.style.stylesheet&&(S.style.stylesheet.schema=d);const I=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=a,S.style.updateConfig(a,I),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const a=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(a.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const a=(this.stylesheet.imports||[]).findIndex((d=>d.id===t));return a===-1&&this.fire(new n.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const a in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[a];d&&t.push(d.getSource())}return t}getSource(t,a){const d=this.getSourceCache(t,a);return d&&d.getSource()}getLayerSource(t){const a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){const d=n.B(t,a);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const a=n.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const a in t){const d=t[a];d==="reload"?this.reloadSource(a):d==="clear"&&this.clearSource(a)}}updateLayers(t){const a=this._changes.getUpdatedPaintProperties();for(const d of a){const y=this.getLayer(d);y&&y.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,a,d){this.imageManager.getImages(a.images,a.scope,d),this._updateTilesForChangedImages();const y=S=>{if(S){const I=a.images.map((D=>n.I.toString(D)));S.setDependencies(a.tileID.key,a.type,I)}},b=n.B(a.source,a.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b]),a.images.some((S=>S.iconsetId))&&this.fire(new n.z("data",{dataType:"style"}))}rasterizeImages(t,a,d){this.imageManager.rasterizeImages(a,d)}getGlyphs(t,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(t,a,d){return n.dz(a,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new n.y(new Error(`There is no source with ID '${t}'`))),!1):a.every((d=>d.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),y=t.type==="building";if(t.is3D(!!this.terrain)){if(d||y||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ll.getSourceType=function(h){return Mc[h]},Ll.setSourceType=function(h,t){Mc[h]=t},Ll.registerForPluginStateChange=n.dA;class cd extends n.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},n.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[a,d]of Object.entries(t.buildings))if(this._buildings[a])for(const y of d.floorIds)this._buildings[a].floors[y]||(this._buildings[a].floors[y]=d.floors[y]);else this._buildings[a]=d;for(const a of t.activeFloors)this._activeFloors.add(a);this._updateIndoorSelector()}getIndoorTileOptions(t,a){const d=this._style.getIndoorSourceLayers(t,a);return d&&this._indoorState?{sourceLayers:d,indoorState:this._indoorState}:null}_updateUI(t,a,d){const y=(function(b,S,I,D){let N=null,V=Number.MAX_SAFE_INTEGER;if(D<16)return null;for(const[K,X]of Object.entries(b)){const Q=X.center;if(Q){const ae=S.distanceTo(n.aT.convert(Q));ae<V&&I.contains(Q)&&(V=ae,N=K)}}return N})(this._buildings,a,d,t);y!==this._closestBuildingId&&(this._closestBuildingId=y,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,a=this._closestBuildingId,d=a&&t?t[a]:void 0;if(!d)return void this.fire(new n.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let y=null;for(const S of d.floorIds)if(this._activeFloors&&this._activeFloors.has(S)){y=S;break}const b=Array.from(d.floorIds).map((S=>({id:S,name:d.floors[S].name,zIndex:d.floors[S].zIndex}))).sort(((S,I)=>I.zIndex-S.zIndex));this.fire(new n.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Ws=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,uc=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,hc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,sh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",us=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,kl=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,pi=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ph=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,_u=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,ud=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,Fu=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const gl=/#include\s+"([^"]+)"/g,gu=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,yl=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Ou=new Set(["ifdef","ifndef","elif","if","defined"]),vl=new Set;Wo(Ws,vl),Wo(hc,vl),Wo(uc,vl);const Bu={"_prelude_fog.vertex.glsl":kl,"_prelude_terrain.vertex.glsl":us,"_prelude_shadow.vertex.glsl":ud,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":pi,"_prelude_shadow.fragment.glsl":Fu,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Ph,"_prelude_raster_particle.glsl":_u},Lh={};Nr("",us),Nr(pi,kl),Nr(Fu,ud),Nr(Ph,""),Nr(_u,"");const kc=Nr(uc,hc),kh=Ws,Wd=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",kh,kc.fragmentSource].join(`
`),Xd=["precision highp float;",kh,kc.vertexSource].join(`
`);var Yd={background:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Nr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Nr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Nr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Nr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Nr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Nr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Nr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Nr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Nr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Nr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Nr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Nr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Nr(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Nr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Nr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Nr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Nr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Nr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Nr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,sh),skyboxGradient:Nr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,sh),skyboxCapture:Nr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Nr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Nr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Nr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Nr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Nr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Nr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Nr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Wo(h,t){const a=h.split(`
`);for(let d of a){if(d=d.trimStart(),d[0]!=="#"||!d.includes("if")||d.startsWith("#endif"))continue;const y=d.match(yl);if(y)for(const b of y)Ou.has(b)||t.add(b)}}function Nr(h,t){const a=new Set,d=[],y=[];h=h.replace(gl,((S,I)=>(y.push(I),""))),t=t.replace(gl,((S,I)=>(d.push(I),"")));let b=new Set(vl);Wo(h,b),Wo(t,b);for(const S of[...d,...y])Lh[S]||(Lh[S]=new Set,Wo(Bu[S],Lh[S])),b=new Set([...b,...Lh[S]]);return{fragmentSource:h=h.replace(gu,((S,I,D,N,V)=>(a.add(V),I==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${D} ${N} ${V};
#else
uniform ${D} ${N} u_${V};
#endif
`:I==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${D} ${N} ${V} = u_${V};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${D} ${N} ${V};
#endif
`:I==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(gu,((S,I,D,N,V)=>{const K=`MATERIAL_ATTRIBUTE_OFFSET_${V}`,X=N==="float"?"vec2":N,Q=`GET_ATTRIBUTE_${X}(a_${V}, materialInfo, ${K})`,ae=V.match(/color/)?"color":X;return I==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${D} ${N} a_${V};
#endif
`:a.has(V)?I==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
    #if !defined(${K})
        in ${D} ${X} a_${V};
    #endif
out ${D} ${N} ${V};
#else
uniform ${D} ${N} u_${V};
#endif
`:I==="initialize"?ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${D} ${N} ${V} = u_${V};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${V})
    #ifdef ${K}
        ${V} = unpack_mix_${ae}(${Q}, u_${V}_t);
    #else
        ${V} = unpack_mix_${ae}(a_${V}, u_${V}_t);
    #endif
#else
    ${D} ${N} ${V} = u_${V};
#endif
`:I==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${D} ${N} a_${V};
    out ${D} ${N} ${V};
#endif
`:I==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:I==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
    #if !defined(${K})
        in ${D} ${X} a_${V};
    #endif
#else
uniform ${D} ${N} u_${V};
#endif
`:I==="define-instanced"?ae==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${D} ${N} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${D} ${X} a_${V};
#else
uniform ${D} ${N} u_${V};
#endif
`:I==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${D} ${N} ${V} = a_${V};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    #ifdef ${K}
        ${D} ${N} ${V} = ${Q};
    #else
        ${D} ${N} ${V} = a_${V};
    #endif
#else
    ${D} ${N} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    #ifdef ${K}
        ${D} ${N} ${V} = unpack_mix_${ae}(${Q}, u_${V}_t);
    #else
        ${D} ${N} ${V} = unpack_mix_${ae}(a_${V}, u_${V}_t);
    #endif
#else
    ${D} ${N} ${V} = u_${V};
#endif
`})),usedDefines:b,vertexIncludes:d,fragmentIncludes:y}}class Fh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,d,y,b,S,I,D){this.context=t;let N=this.boundPaintVertexBuffers.length!==y.length;for(let K=0;!N&&K<y.length;K++)this.boundPaintVertexBuffers[K]!==y[K]&&(N=!0);let V=this.boundDynamicVertexBuffers.length!==I.length;for(let K=0;!V&&K<I.length;K++)this.boundDynamicVertexBuffers[K]!==I[K]&&(V=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||N||V||this.boundIndexBuffer!==b||this.boundVertexOffset!==S)this.freshBind(a,d,y,b,S,I,D);else{t.bindVertexArrayOES.set(this.vao);for(const K of I)K&&(K.bind(),D&&K.instanceCount&&K.setVertexAttribDivisor(t.gl,a,D));b&&b.dynamicDraw&&b.bind()}}freshBind(t,a,d,y,b,S,I){const D=this.context,N=D.gl;this.vao&&this.destroy(),this.vao=D.gl.createVertexArray(),D.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=S,a.enableAttributes(N,t),a.bind(),a.setVertexAttribPointers(N,t,b);for(const V of d)V.enableAttributes(N,t),V.bind(),V.setVertexAttribPointers(N,t,b);for(const V of S)V&&(V.enableAttributes(N,t),V.bind(),V.setVertexAttribPointers(N,t,b),I&&V.instanceCount&&V.setVertexAttribDivisor(N,t,I));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function hd(h,t){const a=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new n.ae(0,d/a).toLngLat().lat,new n.ae(0,(d+1)/a).toLngLat().lat]}function Kd(h,t,a,d,y,b,S){const I=h.context,D=I.gl,N=a.hillshadeFBO;if(!N)return;h.prepareDrawTile();const V=h.isTileAffectedByFog(t),K=[];h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&K.push("USE_MRT1");const X=h.getOrCreateProgram("hillshade",{overrideFog:V,defines:K});I.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,N.colorAttachment0.get());const Q=((me,Se,De,Ee)=>{const We=De.paint.get("hillshade-shadow-color"),Ve=De.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",He=De.paint.get("hillshade-highlight-color"),Ne=De.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Oe=De.paint.get("hillshade-accent-color"),nt=De.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",mt=De.paint.get("hillshade-emissive-strength");let dt=n.an(De.paint.get("hillshade-illumination-direction"));if(De.paint.get("hillshade-illumination-anchor")==="viewport")dt-=me.transform.angle;else if(me.style&&me.style.enable3dLights()&&me.style.directionalLight){const Ct=me.style.directionalLight.properties.get("direction"),Dt=n.d4(Ct.x,Ct.y,Ct.z);dt=n.an(Dt[1])}const At=!me.options.moving;return{u_matrix:Ee||me.transform.calculateProjMatrix(Se.tileID.toUnwrapped(),At),u_image:0,u_latrange:hd(0,Se.tileID),u_light:[De.paint.get("hillshade-exaggeration"),dt],u_shadow:We.toPremultipliedRenderColor(Ve?null:De.lut),u_highlight:He.toPremultipliedRenderColor(Ne?null:De.lut),u_emissive_strength:mt,u_accent:Oe.toPremultipliedRenderColor(nt?null:De.lut)}})(h,a,d,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(I,X,t.toUnwrapped());const{tileBoundsBuffer:ae,tileBoundsIndexBuffer:ie,tileBoundsSegments:ge}=h.getTileBoundsBuffers(a);X.draw(h,D.TRIANGLES,y,b,S,Vn.disabled,Q,d.id,ae,ie,ge)}function Mo(h,t,a){if(!t.needsDEMTextureUpload)return;const d=h.context,y=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(a.stride);const b=a.getPixels();t.demTexture?t.demTexture.update(b,{premultiply:!1}):t.demTexture=new n.T(d,b,y.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Xo(h,t,a){const d=h.context,y=d.gl;if(!t.dem)return;const b=t.dem;if(d.activeTexture.set(y.TEXTURE1),Mo(h,t,b),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const S=b.dim;d.activeTexture.set(y.TEXTURE0);let I=t.hillshadeFBO;if(!I){const X=new n.T(d,{width:S,height:S,data:null},y.RGBA8);X.bind(y.LINEAR,y.CLAMP_TO_EDGE),I=t.hillshadeFBO=d.createFramebuffer(S,S,1,"renderbuffer"),I.colorAttachment0.set(X.texture)}d.bindFramebuffer.set(I.framebuffer),d.viewport.set([0,0,S,S]);const{tileBoundsBuffer:D,tileBoundsIndexBuffer:N,tileBoundsSegments:V}=h.getMercatorTileBoundsBuffers(),K=[];h.linearFloatFilteringSupported()&&K.push("TERRAIN_DEM_FLOAT_FORMAT"),h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&K.push("USE_MRT1"),h.getOrCreateProgram("hillshadePrepare",{defines:K}).draw(h,y.TRIANGLES,yn.disabled,jn.disabled,hr.unblended,Vn.disabled,((X,Q)=>{const ae=Q.stride,ie=n.bC();return n.ce(ie,0,n.al,-n.al,0,0,1),n.br(ie,ie,[0,-n.al,0]),{u_matrix:ie,u_image:1,u_dimension:[ae,ae],u_zoom:X.overscaledZ}})(t.tileID,b),a.id,D,N,V),t.needsHillshadePrepare=!1}class ka{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class al extends ka{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Fl extends ka{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Nu extends ka{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Df extends ka{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Jd extends ka{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class oh extends ka{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Oh extends ka{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class yo extends ka{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class $a extends ka{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class dn extends ka{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Wc extends ka{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class dc extends ka{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Bh extends ka{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Jl extends ka{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class lh extends ka{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Qd extends ka{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Ra extends ka{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Xc extends ka{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class ip extends ka{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let dd=class extends ka{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class np extends ka{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Ol extends ka{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ju extends ka{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ch extends ka{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class uh extends ka{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Rp extends ka{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Cd extends ka{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class fd extends ka{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class ef extends ka{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Yo extends ka{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Ba extends ka{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class yu extends ka{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class pd extends yu{constructor(t,a,d=0){super(t,a),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+d}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachmentPoint,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Nh extends yu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class tf extends yu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class nf extends Nh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const hs=(h,t,a,d)=>({u_matrix:h,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:a,u_emissive_texture_available:d}),fc=(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_image1:1,u_frustum_tl:S,u_frustum_tr:I,u_frustum_br:D,u_frustum_bl:N,u_globe_pos:V,u_globe_radius:K,u_viewport:X,u_grid_matrix:ge?Float32Array.from(ge):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:ae,u_emissive_texture_available:ie});function Yc(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const Wn=new class{constructor(){this.operations={}}newMorphing(h,t,a,d,y){if(h in this.operations){const b=this.operations[h];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[h]={startTime:d,phase:0,duration:y,from:t,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const a=this.operations[t];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Fr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function vu(h,t,a){if(t===0)return 0;const d=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*d}function Vu(h,t){const a=1<<h.z;return!t&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}function md(h,t){if(!h.style||!h.style.enable3dLights())return;const a=h.context,d=a.gl;a.activeTexture.set(d.TEXTURE1),t?t.bind(d.LINEAR,d.CLAMP_TO_EDGE):h.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}const L=h=>({u_matrix:h});function o(h,t,a,d,y){if(y>0){const b=n.o.now(),S=(b-h.timeAdded)/y,I=t?(b-t.timeAdded)/y:-1,D=a.getSource(),N=d.coveringZoomLevel({tileSize:D.tileSize,roundZoom:D.roundZoom}),V=!t||Math.abs(t.tileID.overscaledZ-N)>Math.abs(h.tileID.overscaledZ-N),K=V&&h.refreshedUponExpiration?1:n.aA(V?S:1-I,0,1);return t?{opacity:1,mix:1-K,isFading:S<1}:{opacity:K,mix:0,isFading:S<1}}return{opacity:1,mix:0,isFading:!1}}class v extends Ho{constructor(t){const a=to("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class A extends Ho{constructor(t){const a=to("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,d){if(t.freezeTileCoverage)return;this.transform=t;const y=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const I=new Iu(S,this._source.tileSize*S.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[S.key]=I}return b}),{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class M extends n.aQ{constructor(t,a,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class P extends n.bV{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,y,b]=(function(D){const N=new n.bd,V=new n.b0,K=131;N.reserve(17161),V.reserve(33800);const X=n.al/128,Q=n.al+X/2,ae=Q+X;for(let ge=-X;ge<ae;ge+=X)for(let me=-X;me<ae;me+=X){const Se=me<0||me>Q||ge<0||ge>Q?24575:0,De=n.aA(Math.round(me),0,n.al),Ee=n.aA(Math.round(ge),0,n.al);N.emplaceBack(De+Se,Ee)}const ie=(ge,me)=>{const Se=me*K+ge;V.emplaceBack(Se+1,Se,Se+K),V.emplaceBack(Se+K,Se+K+1,Se+1)};for(let ge=1;ge<129;ge++)for(let me=1;me<129;me++)ie(me,ge);return[0,129].forEach((ge=>{for(let me=0;me<130;me++)ie(me,ge),ie(ge,me)})),[N,V,32768]})(),S=t.context;this.gridBuffer=S.createVertexBuffer(d,n.bf.members),this.gridIndexBuffer=S.createIndexBuffer(y),this.gridSegments=n.bg.simpleSegment(0,0,d.length,y.length),this.gridNoSkirtSegments=n.bg.simpleSegment(0,0,d.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new A(a.map),this.orthoMatrix=n.bC(),n.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.al,0,n.al,0,1);const I=S.gl;this._overlapStencilMode=new jn({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new v(a.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,a,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const y=t.terrain.properties,b=t.terrain.drapeRenderMode===0,S=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.o.now();const I=t.terrain&&t.terrain.scope,D=y.get("source"),N=b?this._mockSourceCache:t.getSourceCache(D,I);if(!N)return void n.w(`Couldn't find terrain source "${D}".`);if(this.sourceCache=N,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(a):y.get("exaggeration"),!a.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const V=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const K=this.getScaledDemTileSize();this.sourceCache.update(a,K,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,V(),this._initializing=!0),V(),a.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const a=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const y=a!=null?d-a:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=t.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(b);let I=b-this._previousZoom;const D=this._previousUpdateTimestamp;let N=b;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(b-N)>.5&&(I=.5*(b-N+I)),I*y<0&&(N+=I)),this._evaluationZoom=N;const V=S.getExaggeration(N),K=V===S.getExaggeration(Math.max(0,N-.1));if(K&&Math.abs(V-this._exaggeration)<.01)return V;let X=Math.min(.1,.00375*(this._updateTimestamp-D));return(K||V<.1||Math.abs(I)<1e-4)&&(X=Math.min(.2,4*X)),n.ak(this._exaggeration,V,X)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(n.ae.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=a.getIds().map((D=>{const N=a.getTileByID(D).tileID;return N.projMatrix=d.calculateProjMatrix(N.toUnwrapped()),N}));(function(D,N){const V=N.transform.pointCoordinate(N.transform.getCameraPoint()),K=new n.P(V.x,V.y);D.sort(((X,Q)=>{if(Q.overscaledZ-X.overscaledZ)return Q.overscaledZ-X.overscaledZ;const ae=new n.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ie=new n.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),ge=K.mult(1<<X.canonical.z);return ge.x-=.5,ge.y-=.5,ge.distSqr(ae)-ge.distSqr(ie)}))})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach((D=>{this.proxyToSource[D.key]={}})),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const D in S){const N=S[D];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,t[D],b),N.usedForTerrain))continue;const V=t[D];N.getSource().reparseOverscaled&&this._assignTerrainTiles(V)}this.proxiedCoords[a.id]=y.map((D=>new M(D,D.key,this.orthoMatrix))),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const D of this.proxyCoords){const N=this.terrainTileForTile[D.key];if(!N)continue;const V=N.tileID.key;V in I||(this._visibleDemTiles.push(N),I[V]=V)}}_assignTerrainTiles(t){this._initializing||t.forEach((a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)}))}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const d in this.terrainTileForTile){const y=this.terrainTileForTile[d],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Mo(this.painter,y,b))}}_prepareDemTileUniforms(t,a,d,y){if(!a||a.demTexture==null)return!1;const b=t.tileID.canonical,S=Math.pow(2,a.tileID.canonical.z-b.z),I=y||"";return d[`u_dem_tl${I}`]=[b.x*S%1,b.y*S%1],d[`u_dem_scale${I}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const a=this._visibleDemTiles.reduce(((d,y)=>{if(!y.dem)return d;const b=y.dem.tree.minimums[0];return b>0&&t++,d+b}),0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),y=new n.dL({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new n.T(t,y,a.R32F,{premultiply:!1}),b}setupElevationDraw(t,a,d){const y=this.painter.context,b=y.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let I=null,D=null,N=1;if(d&&d.morphing&&this._useVertexMorphing){const Q=d.morphing.srcDemTile,ae=d.morphing.dstDemTile;N=d.morphing.phase,Q&&ae&&(this._prepareDemTileUniforms(t,Q,S,"_prev")&&(D=Q),this._prepareDemTileUniforms(t,ae,S)&&(I=ae))}const V=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let K=null;var X;if(this.enabled?D&&I?(K=I.demTexture,y.activeTexture.set(b.TEXTURE4),D.demTexture.bind(V(D),b.CLAMP_TO_EDGE),S.u_dem_lerp=N):(I=this.terrainTileForTile[t.tileID.key],K=this._prepareDemTileUniforms(t,I,S)?I.demTexture:this.emptyDEMTexture):K=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),K&&(S.u_dem_size=(X=K).size[0]===1?1:X.size[0]-2,K.bind(V(I),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,a,S),d&&d.useMeterToDem&&I){const Q=(1<<I.tileID.canonical.z)*n.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=Q}if(d&&d.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(y,S),this.painter.transform.projection.name==="globe"){const Q=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);a.setGlobeUniformValues(y,Q)}}globeUniformValues(t,a,d){const y=t.projection;return{u_tile_tl_up:y.upVector(a,0,0),u_tile_tr_up:y.upVector(a,n.al,0),u_tile_br_up:y.upVector(a,n.al,n.al),u_tile_bl_up:y.upVector(a,0,n.al),u_tile_up_scale:d?n.dM(1):y.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,b,S,I,D){if(y.transform.projection.name==="globe")(function(N,V,K,X,Q){const ae=N.context,ie=ae.gl;let ge,me;const Se=N.transform,De=n.dE(N,ae,Se),Ee=(At,Ct)=>{if(me===Ct)return;const Dt=[Fr[Ct],"PROJECTION_GLOBE_VIEW"];De&&Dt.push("CUSTOM_ANTIALIASING");const Kt=N.isTileAffectedByFog(At);ge=N.getOrCreateProgram("globeRaster",{defines:Dt,overrideFog:Kt}),me=Ct},We=N.colorModeForRenderPass(),Ve=new yn(ie.LEQUAL,yn.ReadWrite,N.depthRangeFor3D);Wn.update(Q);const He=n.dF(Se),Ne=[n.aF(Se.center.lng),n.aJ(Se.center.lat)],Oe=N.globeSharedBuffers,nt=[Se.width*n.o.devicePixelRatio,Se.height*n.o.devicePixelRatio],mt=Float32Array.from(Se.globeMatrix),dt={useDenormalizedUpVectorScale:!0};{const At=N.transform,Ct=vu(At.zoom,V.exaggeration(),V.sourceCache._source.tileSize);me=-1;const Dt=ie.TRIANGLES;for(const Kt of X){const vt=K.getTile(Kt),rt=jn.disabled,Nt=V.prevTerrainTileForTile[Kt.key],Lt=V.terrainTileForTile[Kt.key];Yc(Nt,Lt)&&Wn.newMorphing(Kt.key,Nt,Lt,Q,250),md(N,vt.emissiveTexture),ae.activeTexture.set(ie.TEXTURE0),vt.texture&&vt.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const li=Wn.getMorphValuesForProxy(Kt.key),Mi=li?1:0;li&&Object.assign(dt,{morphing:{srcDemTile:li.from,dstDemTile:li.to,phase:n.dD(li.phase)}});const ki=n.dG(Kt.canonical),Ei=n.dH(ki.getCenter().lat),_i=n.dI(Kt.canonical,ki,Ei,At.worldSize/At._pixelsPerMercatorPixel),fn=n.bk(n.dJ(Kt.canonical)),nn=N.emissiveMode==="mrt-fallback"?1:0,$i=fc(At.expandedFarZProjMatrix,mt,He,fn,n.aj(At.zoom),Ne,At.frustumCorners.TL,At.frustumCorners.TR,At.frustumCorners.BR,At.frustumCorners.BL,At.globeCenterInViewSpace,At.globeRadius,nt,Ct,At._farZ,nn,_i);if(Ee(Kt,Mi),ge&&(V.setupElevationDraw(vt,ge,dt),N.uploadCommonUniforms(ae,ge,Kt.toUnwrapped()),Oe)){const[en,bn,ar]=Oe.getGridBuffers(Ei,Ct!==0);ge.draw(N,Dt,Ve,rt,We,Vn.backCCW,$i,"globe_raster",en,bn,ar)}}}if(Oe&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const At=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];De&&At.push("CUSTOM_ANTIALIASING"),ge=N.getOrCreateProgram("globeRaster",{defines:At});for(const Ct of X){const{x:Dt,y:Kt,z:vt}=Ct.canonical,rt=Kt===0,Nt=Kt===(1<<vt)-1,[Lt,li,Mi,ki]=Oe.getPoleBuffers(vt,!1);if(ki&&(rt||Nt)){const Ei=K.getTile(Ct);md(N,Ei.emissiveTexture),ae.activeTexture.set(ie.TEXTURE0),Ei.texture&&Ei.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);let _i=n.dK(vt,Dt,Se);const fn=n.bk(n.dJ(Ct.canonical)),nn=N.emissiveMode==="mrt-fallback"?1:0,$i=(en,bn)=>en.draw(N,ie.TRIANGLES,Ve,jn.disabled,We,Vn.disabled,fc(Se.expandedFarZProjMatrix,_i,_i,fn,0,Ne,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,nt,0,Se._farZ,nn),"globe_pole_raster",bn,Mi,ki);V.setupElevationDraw(Ei,ge,dt),N.uploadCommonUniforms(ae,ge,Ct.toUnwrapped()),rt&&N.renderDefaultNorthPole&&$i(ge,Lt),Nt&&N.renderDefaultSouthPole&&(_i=n.cS(n.bC(),_i,[1,-1,1]),$i(ge,li))}}}})(y,b,S,I,D);else{const N=y.context,V=N.gl;let K,X;const Q=y.shadowRenderer,ae=ah(y,y.longestCutoffRange),ie=We=>{if(X===We)return;const Ve=[];Ve.push(Fr[We]),ae.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),Q&&(Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&Ve.push("NORMAL_OFFSET")),K=y.getOrCreateProgram("terrainRaster",{defines:Ve}),X=We},ge=y.colorModeForRenderPass(),me=new yn(V.LEQUAL,yn.ReadWrite,y.depthRangeFor3D);Wn.update(D);const Se=y.transform,De=vu(Se.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let Ee=[0,0,0];if(Q){const We=y.style.directionalLight,Ve=y.style.ambientLight;We&&Ve&&(Ee=Pc(y.style,We,Ve))}{X=-1;const We=V.TRIANGLES,[Ve,He]=[b.gridIndexBuffer,b.gridSegments];for(const Ne of I){const Oe=S.getTile(Ne),nt=jn.disabled,mt=b.prevTerrainTileForTile[Ne.key],dt=b.terrainTileForTile[Ne.key];Yc(mt,dt)&&Wn.newMorphing(Ne.key,mt,dt,D,250),md(y,Oe.emissiveTexture),N.activeTexture.set(V.TEXTURE0),Oe.texture&&Oe.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const At=Wn.getMorphValuesForProxy(Ne.key),Ct=At?1:0;let Dt;At&&(Dt={morphing:{srcDemTile:At.from,dstDemTile:At.to,phase:n.dD(At.phase)}});const Kt=y.emissiveMode==="mrt-fallback"?1:0,vt=hs(Ne.projMatrix,Vu(Ne.canonical,Se.renderWorldCopies)?De/10:De,Ee,Kt);if(ie(Ct),!K)continue;b.setupElevationDraw(Oe,K,Dt);const rt=Ne.toUnwrapped();Q&&Q.setupShadows(rt,K),y.uploadCommonUniforms(N,K,rt,null,ae),K.draw(y,We,me,nt,ge,Vn.backCCW,vt,"terrain_raster",b.gridBuffer,Ve,He)}}}})(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],S=this._drapedRenderBatches.shift(),I=a.style.order,D=[];this._updateFBOs(a.emissiveMode==="mrt-fallback");let N=0;for(const V of b){const K=y.getTileByID(V.proxyTileKey),X=y.proxyCachedFBO[V.key]?y.proxyCachedFBO[V.key][t]:void 0,Q=X!==void 0?y.renderCache[X]:this.pool[N++],ae=X!==void 0;if(K.texture=Q.tex,K.emissiveTexture=Q.emissiveTex,ae&&!Q.dirty){D.push(K.tileID);continue}d.bindFramebuffer.set(Q.fb.framebuffer);const ie=d.gl;let ge;ie.drawBuffers(a.emissiveMode==="mrt-fallback"?[ie.COLOR_ATTACHMENT0,ie.COLOR_ATTACHMENT1]:[ie.COLOR_ATTACHMENT0]),this.renderedToTile=!1,Q.dirty&&(d.clear({color:n.ao.transparent,stencil:0}),Q.dirty=!1);for(let me=S.start;me<=S.end;++me){const Se=a.style._mergedLayers[I[me]];if(Se.isHidden(a.transform.zoom))continue;const De=a.style.getLayerSourceCache(Se),Ee=De?this.proxyToSource[V.key][De.id]:[V];if(!Ee)continue;const We=Ee;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),ge!==(De?De.id:null)&&(this._setupStencil(Q,Ee,Se,De),ge=De?De.id:null),a.renderLayer(a,De,Se,We)}if(ie.drawBuffers([ie.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const me of this._pendingGroundEffectLayers){const Se=a.style._mergedLayers[I[me]];if(Se.isHidden(a.transform.zoom))continue;const De=a.style.getLayerSourceCache(Se),Ee=De?this.proxyToSource[V.key][De.id]:[V];if(!Ee)continue;const We=Ee;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),ge!==(De?De.id:null)&&(this._setupStencil(Q,Ee,Se,De),ge=De?De.id:null),a.renderLayer(a,De,Se,We)}this.renderedToTile?(Q.dirty=!0,D.push(K.tileID)):ae||--N,N===5&&(N=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),S.end+1}postRender(){}isLayerOrderingCorrect(t){const a=t.order.length;let d=-1,y=a;for(let b=0;b<a;++b)this._style.isLayerDraped(t._mergedLayers[t.order[b]])?d=Math.max(d,b):y=Math.min(y,b);return y>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((a=>a.dem)).forEach((a=>{t=Math.min(t,a.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,a,d){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter((b=>b.dem)).map((b=>{const S=b.tileID,I=1<<S.overscaledZ,{x:D,y:N}=S.canonical,V=D/I,K=(D+1)/I,X=N/I,Q=(N+1)/I;return{minx:V,miny:X,maxx:K,maxy:Q,t:b.dem.tree.raycastRoot(V,X,K,Q,t,a,d),tile:b}}));y.sort(((b,S)=>(b.t!==null?b.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE)));for(const b of y){if(b.t==null)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,t,a,d);if(S!=null)return S}return null}_createFBO(){const t=this.painter.context,a=t.gl,d=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const y=new n.T(t,{width:d[0],height:d[1],data:null},a.RGBA8);y.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=t.createFramebuffer(d[0],d[1],1,null);let S;return b.colorAttachment0.set(y.texture),this._emissiveTexture&&(S=new n.T(t,{width:d[0],height:d[1],data:null},a.R8),S.bind(a.LINEAR,a.CLAMP_TO_EDGE),b.createColorAttachment(t,1),b.colorAttachment1.set(S.texture)),b.depthAttachment=new nf(t,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:b,tex:y,emissiveTex:S,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const a of this.pool)this._updateFBO(a,t);for(const a of this.proxySourceCache.renderCache)this._updateFBO(a,t);this._emissiveTexture=t}}_updateFBO(t,a){const d=t.fb,y=this.painter.context,b=y.gl,S=this.drapeBufferSize;if(a){const I=new n.T(y,{width:S[0],height:S[1],data:null},b.R8);I.bind(b.LINEAR,b.CLAMP_TO_EDGE),t.emissiveTex=I,d.createColorAttachment(y,1),d.colorAttachment1.set(I.texture)}else t.emissiveTex=void 0,d.removeColorAttachment(y,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const a=this._style._mergedLayers[t],d=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!d&&a.shouldRedrape():!d&&a.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof ih){t=!0;break}if(!t)return;const a={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(y);if(!b||a[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="line")continue;const S=y.widthExpression(),I=y.emissiveStrengthExpression();if(S instanceof n.ad||I instanceof n.ad){a[b.id]=!0;for(const D of this.proxyCoords){const N=this.proxyToSource[D.key][b.id];if(N)for(const V of N)this._clearRenderCacheForTile(b.id,V)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof ns){t=!0;break}if(!t)return;const a={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(y);if(!b||a[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const S=y.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const D=this.proxyToSource[I.key][b.id];if(D)for(const N of D){const V=o(b.getTile(N),b.findLoadedParent(N,0),b,this.painter.transform,S);(V.opacity!==1||V.mix!==0)&&this._clearRenderCacheForTile(b.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,a=t.length;if(a===0)return;const d=[];this._pendingGroundEffectLayers=[];let y,b=0,S=this._style._mergedLayers[t[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<a;)S=this._style._mergedLayers[t[b]];for(;b<a;++b){const I=this._style._mergedLayers[t[b]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?y===void 0&&(y=b):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(d.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&d.push({start:y,end:b-1}),d.length!==0){const I=d[d.length-1];this._pendingGroundEffectLayers.every((D=>D>I.end))||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const S=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let I=0;I<S.length;++I){const D=Object.values(S[I]);a.renderCachePool.push(...D)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,y=this._tilesDirty;for(let S=d.length-1;S>=0;S--){const I=d[S];if(a.getTileByID(I.key),a.proxyCachedFBO[I.key]!==void 0){const D=t[I.key],N=this.proxyToSource[I.key];let V=0;for(const K in N){const X=N[K],Q=D[K];if(!Q||Q.length!==X.length||X.some(((ae,ie)=>ae!==Q[ie]||y[K]&&y[K].hasOwnProperty(ae.key)))){V=-1;break}++V}for(const K in a.proxyCachedFBO[I.key])a.renderCache[a.proxyCachedFBO[I.key][K]].dirty=V<0||V!==Object.values(D).length}}const b=[...this._drapedRenderBatches];b.sort(((S,I)=>I.end-I.start-(S.end-S.start)));for(const S of b)for(const I of d){if(a.proxyCachedFBO[I.key])continue;let D=a.renderCachePool.pop();D===void 0&&a.renderCache.length<50&&(D=a.renderCache.length,a.renderCache.push(this._createFBO())),D!==void 0&&(a.proxyCachedFBO[I.key]={},a.proxyCachedFBO[I.key][S.start]=D,a.renderCache[D].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,d,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let I;if(d.isTileClipped())I=a.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):jn.disabled}_renderTileClippingMasks(t,a){const d=this.painter,y=this.painter.context,b=y.gl;d._tileClippingMaskIDs={},y.setColorMode(hr.disabled),y.setDepthMode(yn.disabled);const S=d.getOrCreateProgram("clippingMask");for(const I of t){const D=d._tileClippingMaskIDs[I.key]=--a;S.draw(d,b.TRIANGLES,yn.disabled,new jn({func:b.ALWAYS,mask:0},D,255,b.KEEP,b.KEEP,b.REPLACE),hr.disabled,Vn.disabled,L(I.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const d=[t.x,t.y,1,1];n.aC(d,d,a.pixelMatrixInverse),n.cK(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const y=a._camera.position,b=n.cf(1,a.center.lat),S=[y[0],y[1],y[2]/b,0],I=n.da([],d.slice(0,3),S);n.aw(I,I);const D=this.raycast(S,I,this._exaggeration);return D!==null&&D?(n.bH(S,S,I,D),S[3]=S[2],S[2]*=b,S):null}_setupProxiedCoordsForOrtho(t,a,d){if(t.getSource()instanceof n.aU)return this._setupProxiedCoordsForImageSource(t,a,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords;for(let D=0;D<b.length;D++){const N=b[D],V=this._findTileCoveringTileID(N,t);if(V){const K=this._createProxiedId(N,V,d[N.key]&&d[N.key][t.id]);y.push(K),this.proxyToSource[N.key][t.id]=[K]}}let S=!1;const I=new Set;for(let D=0;D<a.length;D++){const N=t.getTile(a[D]);if(!N||!N.hasData())continue;const V=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(V&&V.tileID.canonical.z!==N.tileID.canonical.z){const K=this.proxyToSource[V.tileID.key][t.id],X=this._createProxiedId(V.tileID,N,d[V.tileID.key]&&d[V.tileID.key][t.id]);K?K.splice(K.length-1,0,X):this.proxyToSource[V.tileID.key][t.id]=[X];const Q=this.proxyToSource[V.tileID.key][t.id];I.has(Q)||I.add(Q),y.push(X),S=!0}}if(this._sourceTilesOverlap[t.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const D of I)D.sort(((N,V)=>V.overscaledZ-N.overscaledZ))}_setupProxiedCoordsForImageSource(t,a,d){if(!t.getSource().loaded())return;const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords,S=t.getSource(),I=S.tileID;if(!I)return;const D=new n.P(I.x,I.y)._div(1<<I.z),N=S.coordinates.map(n.ae.fromLngLat).reduce(((K,X)=>(K.min.x=Math.min(K.min.x,X.x-D.x),K.min.y=Math.min(K.min.y,X.y-D.y),K.max.x=Math.max(K.max.x,X.x-D.x),K.max.y=Math.max(K.max.y,X.y-D.y),K)),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),V=(K,X)=>{const Q=K.wrap+K.canonical.x/(1<<K.canonical.z),ae=K.canonical.y/(1<<K.canonical.z),ie=n.al/(1<<K.canonical.z),ge=X.wrap+X.canonical.x/(1<<X.canonical.z),me=X.canonical.y/(1<<X.canonical.z);return Q+ie<ge+N.min.x||Q>ge+N.max.x||ae+ie<me+N.min.y||ae>me+N.max.y};for(let K=0;K<b.length;K++){const X=b[K];for(let Q=0;Q<a.length;Q++){const ae=t.getTile(a[Q]);if(!ae||!ae.hasData()||V(X,ae.tileID))continue;const ie=this._createProxiedId(X,ae,d[X.key]&&d[X.key][t.id]),ge=this.proxyToSource[X.key][t.id];ge?ge.push(ie):this.proxyToSource[X.key][t.id]=[ie],y.push(ie)}}}_createProxiedId(t,a,d){let y=this.orthoMatrix;if(d){const b=d.find((S=>S.key===a.tileID.key));if(b)return b}if(a.tileID.key!==t.key){const b=t.canonical.z-a.tileID.canonical.z;let S,I,D;y=n.bC();const N=a.tileID.wrap-t.wrap<<t.overscaledZ;b>0?(S=n.al>>b,I=S*((a.tileID.canonical.x<<b)-t.canonical.x+N),D=S*((a.tileID.canonical.y<<b)-t.canonical.y)):(S=n.al<<-b,I=n.al*(a.tileID.canonical.x-(t.canonical.x+N<<-b)),D=n.al*(a.tileID.canonical.y-(t.canonical.y<<-b))),n.ce(y,0,S,0,S,0,1),n.br(y,y,[I,D,0])}return new M(a.tileID,t.key,y)}_findTileCoveringTileID(t,a){let d=a.getTile(t);if(d&&d.hasData())return d;const y=this._findCoveringTileCache[a.id],b=y[t.key];if(d=b?a.getTileByID(b):null,d&&d.hasData()||b===null)return d;let S=d?d.tileID:t,I=S.overscaledZ;const D=a.getSource().minzoom,N=[];if(!b){const K=a.getSource().maxzoom;if(t.canonical.z>=K){const X=t.canonical.z-K;a.getSource().reparseOverscaled?(I=Math.max(t.canonical.z+2,a.transform.tileZoom),S=new n.aQ(I,t.wrap,K,t.canonical.x>>X,t.canonical.y>>X)):X!==0&&(I=K,S=new n.aQ(I,t.wrap,K,t.canonical.x>>X,t.canonical.y>>X))}S.key!==t.key&&(N.push(S.key),d=a.getTile(S))}const V=K=>{N.forEach((X=>{y[X]=K})),N.length=0};for(I-=1;I>=D&&(!d||!d.hasData());I--){d&&V(d.tileID.key);const K=S.calculateScaledKey(I);if(d=a.getTileByID(K),d&&d.hasData())break;const X=y[K];if(X===null)break;X===void 0?N.push(K):d=a.getTileByID(X)}return V(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[a.key]=!0}}function q(h,t,a){const d=(function(I,D,N){const V=n.bJ(D,I),K=n.bJ(N,[.2126,.7152,.0722]),X=(ae,ie,ge)=>(1-ge)*ae+ge*ie,Q=X(1-.3*Math.min(K,1),1,Math.min(V+1,1));return X(.92,1,Math.asin(n.aA(D[2],-1,1))/Math.PI+.5)*Q})(h,[0,0,1],t),y=[0,0,0];n.c5(y,a.slice(0,3),d);const b=[0,0,0];n.c5(b,t.slice(0,3),h[2]);const S=[0,0,0];return n.d8(S,y,b),n.db(S)}const J=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ne=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class fe{static cacheKey(t,a,d,y){const b=[a];y&&b.push(y.cacheKey);for(const S of d)t.usedDefines.has(S)&&b.push(S);return b.join("/")}constructor(t,a,d,y,b,S){const I=t.gl;this.program=I.createProgram(),this.configuration=y,this.name=a,this.fixedDefines=[...S];const D=`#version 300 es
${(y?y.defines():[]).concat(S.map((ie=>`#define ${ie}`))).join(`
`)}`,N=[D,Wd];for(const ie of d.fragmentIncludes)N.push(Bu[ie]);N.push(d.fragmentSource);const V=N.join(`
`),K=[D,Xd];for(const ie of d.vertexIncludes)K.push(Bu[ie]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&K.push("uniform int u_instanceID;"),K.push(d.vertexSource);let X=K.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(X=X.replaceAll("gl_InstanceID","u_instanceID"));const Q=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Q,V),I.compileShader(Q),I.attachShader(this.program,Q);const ae=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(ae,X),I.compileShader(ae),I.attachShader(this.program,ae),this.attributes={},I.linkProgram(this.program),I.deleteShader(ae),I.deleteShader(Q),this.fixedUniforms=b(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=y?y.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ie=>({u_instanceID:new n.ch(ie)}))(t)),(S.includes("TERRAIN")||a.includes("symbol")||a.includes("circle"))&&(this.terrainUniforms=(ie=>({u_dem:new n.ch(ie),u_dem_prev:new n.ch(ie),u_dem_tl:new n.ck(ie),u_dem_scale:new n.cj(ie),u_dem_tl_prev:new n.ck(ie),u_dem_scale_prev:new n.cj(ie),u_dem_size:new n.cj(ie),u_dem_lerp:new n.cj(ie),u_exaggeration:new n.cj(ie),u_depth:new n.ch(ie),u_depth_size_inv:new n.ck(ie),u_depth_range_unpack:new n.ck(ie),u_occluder_half_size:new n.cj(ie),u_occlusion_depth_offset:new n.cj(ie),u_meter_to_dem:new n.cj(ie),u_label_plane_matrix_inv:new n.cl(ie)}))(t)),S.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new n.ci(ie),u_tile_tr_up:new n.ci(ie),u_tile_br_up:new n.ci(ie),u_tile_bl_up:new n.ci(ie),u_tile_up_scale:new n.cj(ie)}))(t)),S.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new n.cl(ie),u_fog_range:new n.ck(ie),u_fog_color:new n.d3(ie),u_fog_horizon_blend:new n.cj(ie),u_fog_vertical_limit:new n.ck(ie),u_fog_temporal_offset:new n.cj(ie),u_frustum_tl:new n.ci(ie),u_frustum_tr:new n.ci(ie),u_frustum_br:new n.ci(ie),u_frustum_bl:new n.ci(ie),u_globe_pos:new n.ci(ie),u_globe_radius:new n.cj(ie),u_globe_transition:new n.cj(ie),u_is_globe:new n.ch(ie),u_viewport:new n.ck(ie)}))(t)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new n.d3(ie)}))(t)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new n.ci(ie),u_lighting_directional_dir:new n.ci(ie),u_lighting_directional_color:new n.ci(ie),u_ground_radiance:new n.ci(ie)}))(t)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new n.cl(ie),u_light_matrix_1:new n.cl(ie),u_fade_range:new n.ck(ie),u_shadow_normal_offset:new n.ci(ie),u_shadow_intensity:new n.cj(ie),u_shadow_texel_size:new n.cj(ie),u_shadow_map_resolution:new n.cj(ie),u_shadow_direction:new n.ci(ie),u_shadow_bias:new n.ci(ie),u_shadowmap_0:new n.ch(ie),u_shadowmap_1:new n.ch(ie)}))(t)))}getAttributeLocation(t,a){let d=this.attributes[a];return d===void 0&&(d=this.attributes[a]=t.getAttribLocation(this.program,a)),d}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y]&&d[y].set(this.program,y,a[y])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y]&&d[y].set(this.program,y,a[y])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y].set(this.program,y,a[y])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y].set(this.program,y,a[y])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y].set(this.program,y,a[y])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const y in a)d[y].set(this.program,y,a[y])}_drawDebugWireframe(t,a,d,y,b,S,I,D,N,V){const K=t.options.wireframe;if(K.terrain===!1&&K.layers2D===!1&&K.layers3D===!1)return;const X=t.context;if(!(!(!K.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!K.layers2D||t._terrain&&t._terrain.renderingToTexture||!J.includes(this.name))||!(!K.layers3D||!ne.includes(this.name))))return;const Q=X.gl,ae=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,b,X);if(!ae)return;const ie=[...this.fixedDefines,"DEBUG_WIREFRAME"],ge=t.getOrCreateProgram(this.name,{config:this.configuration,defines:ie});X.program.set(ge.program);const me=(Ee,We,Ve)=>{if(We[Ee]&&Ve[Ee])for(const He in We[Ee])Ve[Ee][He]&&Ve[Ee][He].set(Ve.program,He,We[Ee][He].current)};N&&N.setUniforms(ge.program,X,ge.binderUniforms,I,{zoom:D}),me("fixedUniforms",this,ge),me("terrainUniforms",this,ge),me("globeUniforms",this,ge),me("fogUniforms",this,ge),me("lightsUniforms",this,ge),me("shadowUniforms",this,ge),ae.bind(),X.setColorMode(new hr([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],n.ao.transparent,[!0,!0,!0,!1])),X.setDepthMode(new yn(a.func===Q.LESS?Q.LEQUAL:a.func,yn.ReadOnly,a.range)),X.setStencilMode(jn.disabled);const Se=3*S.primitiveLength*2,De=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Ee=V||1;for(let We=0;We<Ee;++We)ge.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",We),Q.drawElements(Q.LINES,Se,Q.UNSIGNED_SHORT,De)}else V&&V>1?Q.drawElementsInstanced(Q.LINES,Se,Q.UNSIGNED_SHORT,De,V):Q.drawElements(Q.LINES,Se,Q.UNSIGNED_SHORT,De);b.bind(),X.program.set(this.program),X.setDepthMode(a),X.setStencilMode(d),X.setColorMode(y)}checkUniforms(t,a,d){if(this.fixedDefines.includes(a)){for(const y of Object.keys(d))if(!d[y].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${y} not set but required by ${a} being defined`)}}draw(t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge){const me=t.context,Se=me.gl;if(this.failedToCreate)return;me.program.set(this.program),me.setDepthMode(d),me.setStencilMode(y),me.setColorMode(b),me.setCullFace(S);for(const[Ne,Oe]of this.fixedUniformsEntries)Oe.set(this.program,Ne,I[Ne]);ae&&ae.setUniforms(this.program,me,this.binderUniforms,X,{zoom:Q});const De={[Se.POINTS]:1,[Se.LINES]:2,[Se.TRIANGLES]:3,[Se.LINE_STRIP]:1}[a];this.checkUniforms(D,"RENDER_SHADOWS",this.shadowUniforms);const Ee=ie||[],We=ae?ae.getPaintVertexBuffers():[],Ve=a===Se.TRIANGLES&&V,He=ge&&ge>0?1:void 0;for(const Ne of K.get()){const Oe=Ne.vaos||(Ne.vaos={});if((Oe[D]||(Oe[D]=new Fh)).bind(me,this,N,We,V,Ne.vertexOffset,Ee,He),this.forceManualRenderingForInstanceIDShaders){const nt=ge||1;for(let mt=0;mt<nt;++mt)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",mt),V?Se.drawElements(a,Ne.primitiveLength*De,Se.UNSIGNED_SHORT,Ne.primitiveOffset*De*2):Se.drawArrays(a,Ne.vertexOffset,Ne.vertexLength)}else ge&&ge>1?Se.drawElementsInstanced(a,Ne.primitiveLength*De,Se.UNSIGNED_SHORT,Ne.primitiveOffset*De*2,ge):V?Se.drawElements(a,Ne.primitiveLength*De,Se.UNSIGNED_SHORT,Ne.primitiveOffset*De*2):Se.drawArrays(a,Ne.vertexOffset,Ne.vertexLength);Ve&&this._drawDebugWireframe(t,d,y,b,V,Ne,X,Q,ae,ge)}}}function we(h,t,a=0){const d=Math.pow(2,t.tileID.overscaledZ),y=t.tileSize*Math.pow(2,h.transform.tileZoom)/d,b=y*(t.tileID.canonical.x+t.tileID.wrap*d),S=y*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ay(t,1,h.transform.tileZoom),u_pixel_coord_upper:[b>>16,S>>16],u_pixel_coord_lower:[65535&b,65535&S],u_pattern_transition:a}}const Te={terrain:0,flat:1},Be=n.bC(),Ke=(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge,me)=>{const Se=t.style.light,De=Se.properties.get("position"),Ee=[De.x,De.y,De.z],We=n.dO();Se.properties.get("anchor")==="viewport"&&(n.dP(We,-t.transform.angle),n.dQ(Ee,Ee,We));const Ve=Se.properties.get("color").toPremultipliedRenderColor(null),He=t.transform,Ne={u_matrix:h,u_lightpos:Ee,u_lightintensity:Se.properties.get("intensity"),u_lightcolor:[Ve.r,Ve.g,Ve.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Be,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Te[N],u_base_type:Te[V],u_ao:y,u_edge_radius:b,u_width_scale:S,u_flood_light_color:ae,u_vertical_scale:ie,u_flood_light_intensity:ge,u_ground_shadow_factor:me};return He.projection.name==="globe"&&(Ne.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],Ne.u_zoom_transition=K,Ne.u_inv_rot_matrix=Q,Ne.u_merc_center=X,Ne.u_up_dir=He.projection.upVector(new n.cD(0,0,0),X[0]*n.al,X[1]*n.al),Ne.u_height_lift=D),Ne},ot=(h,t,a,d,y,b)=>({u_matrix:h,u_edge_radius:t,u_width_scale:a,u_vertical_scale:d,u_height_type:Te[y],u_base_type:Te[b]}),wt=(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge,me)=>{const Se=Ke(h,t,a,d,y,b,S,I,N,V,K,X,Q,ae,ie,ge,1,[0,0,0]),De={u_height_factor:-Math.pow(2,I.overscaledZ)/D.tileSize/8};return Object.assign(Se,we(t,D,me),De)},Mt=(h,t,a,d,y,b,S,I,D,N,V)=>({u_matrix:t,u_opacity:a,u_ao_pass:d?1:0,u_meter_to_tile:y,u_ao:b,u_flood_light_intensity:S,u_flood_light_color:I,u_attenuation:D,u_edge_radius:N,u_fb:0,u_fb_size:V,u_dynamic_offset:1}),Rt=(h,t,a)=>({u_matrix:h,u_emissive_strength:t,u_ground_shadow_factor:a}),Ft=(h,t,a,d,y,b=0)=>Object.assign(Rt(h,t,y),we(a,d,b)),yt=(h,t,a,d)=>({u_matrix:h,u_world:a,u_emissive_strength:t,u_ground_shadow_factor:d}),Ht=(h,t,a,d,y,b,S=0)=>Object.assign(Ft(h,t,a,d,b,S),{u_world:y}),Jt=(h,t)=>({u_matrix:h,u_ground_shadow_factor:t}),oi=(h,t,a,d,y)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:a,u_height_scale:d,u_reset_depth:y}),Xi=(h,t,a,d,y,b,S,I,D)=>({u_matrix:h,u_normal_matrix:t,u_opacity:a,u_faux_facade_ao_intensity:d,u_camera_pos:y,u_tile_to_meter:b,u_facade_emissive_chance:S,u_flood_light_color:I,u_flood_light_intensity:D}),An=h=>({u_matrix:h}),Cn=h=>({u_matrix:h}),Zn=(h,t,a,d,y,b,S,I)=>{const D=n.al/b.tileSize;return{u_matrix:h,u_inv_rot_matrix:t,u_camera_to_center_distance:a.getCameraToCenterDistance(I),u_extrude_scale:[a.pixelsToGLUnits[0]/D,a.pixelsToGLUnits[1]/D],u_zoom_transition:d,u_tile_id:S,u_merc_center:y}},Ln=(h,t,a=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:a}),Rn=n.bC(),ir=(h,t,a,d,y,b,S)=>{const I=h.transform,D=I.projection.name==="globe",N=D?n.dR(I.zoom,t.canonical)*I._pixelsPerMercatorPixel:n.ay(a,1,b),V={u_matrix:t.projMatrix,u_extrude_scale:N,u_intensity:S,u_inv_rot_matrix:Rn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){V.u_inv_rot_matrix=d,V.u_merc_center=y,V.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],V.u_zoom_transition=n.aj(I.zoom);const K=y[0]*n.al,X=y[1]*n.al;V.u_up_dir=I.projection.upVector(new n.cD(0,0,0),K,X)}return V};function Xr(h,[t,a,d,y],[b,S]){if(b===S)return[0,0,0,0];const I=255*(h-1)/(h*(S-b));return[t*I,a*I,d*I,y*I]}function Fn(h,t,[a,d]){return a===d?0:.5/h+(t-a)*(h-1)/(h*(d-a))}const qn=(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge,me,Se,De,Ee)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:N,u_fade_t:V.mix,u_opacity:V.opacity*K.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:K.paint.get("raster-brightness-min"),u_brightness_high:K.paint.get("raster-brightness-max"),u_saturation_factor:n.dT(K.paint.get("raster-saturation")),u_contrast_factor:n.dS(K.paint.get("raster-contrast")),u_spin_weights:ea(K.paint.get("raster-hue-rotate")),u_perspective_transform:X,u_raster_elevation:Q,u_zoom_transition:S,u_merc_center:I,u_cutoff_params:D,u_colorization_mix:Xr(n.dU,ie,me),u_colorization_offset:Fn(n.dU,ge,me),u_color_ramp:ae,u_texture_offset:[De/(Se+2*De),Se/(Se+2*De)],u_texture_res:[Se+2*De,Se+2*De],u_emissive_strength:Ee});function ea(h){h*=Math.PI/180;const t=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const is=.05,Da=(h,t,a,d,y,b,S,I,D,N,V,K)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:N,u_fade_t:V.mix,u_opacity:V.opacity,u_image0:0,u_image1:1,u_raster_elevation:K,u_zoom_transition:S,u_merc_center:I,u_cutoff_params:D}),Ya=(h,t,a,d,y,b,S,I,D,N)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:d,u_color_ramp:b,u_velocity_res:y,u_max_speed:S,u_uv_offset:I,u_data_scale:[255*D[0],255*D[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[is,is]}),Vs=(h,t,a,d,y,b,S,I,D,N)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:d,u_max_speed:y,u_speed_factor:b,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*D[0],255*D[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[is,is]}),sl=n.bC(),pc=(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge,me,Se,De,Ee,We,Ve,He)=>{const Ne=y.transform,Oe={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Ne.getCameraToCenterDistance(Se),u_rotate_symbol:+a,u_aspect_ratio:Ne.width/Ne.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+N,u_elevation_from_sea:D?1:0,u_pitch_with_map:+d,u_texsize:V,u_texsize_icon:K,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:sl,u_up_vector:[0,-1,0],u_color_adj_mat:We,u_icon_transition:Ve||0,u_gamma_scale:d?y.transform.getCameraToCenterDistance(Se)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:n.o.devicePixelRatio,u_is_halo:1,u_scale_factor:He||1,u_ground_shadow_factor:De,u_inv_matrix:n.bl(n.bC(),S),u_normal_scale:Ee,u_lutTexture:_s.LUT};return Se.name==="globe"&&(Oe.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],Oe.u_zoom_transition=ae,Oe.u_inv_rot_matrix=ge,Oe.u_merc_center=ie,Oe.u_camera_forward=Ne._camera.forward(),Oe.u_ecef_origin=n.dV(Ne.globeMatrix,Q.toUnwrapped()),Oe.u_tile_matrix=Float32Array.from(Ne.globeMatrix),Oe.u_up_vector=me),Oe},Us=(h,t,a,d)=>({u_matrix:h,u_emissive_strength:t,u_opacity:a,u_color:d}),Fo=(h,t,a,d,y,b,S,I,D)=>Object.assign((function(N,V,K,X,Q,ae){const{width:ie,height:ge}=X.imageManager.getPixelSize(V),me=Math.pow(2,ae.tileID.overscaledZ),Se=ae.tileSize*Math.pow(2,X.transform.tileZoom)/me,De=Se*(ae.tileID.canonical.x+ae.tileID.wrap*me),Ee=Se*ae.tileID.canonical.y;return{u_image:0,u_pattern_tl:K.tl,u_pattern_br:K.br,u_texsize:[ie,ge],u_pattern_size:K.displaySize,u_pattern_units_to_pixels:Q?[X.transform.width,-1*X.transform.height]:[1/n.ay(ae,1,X.transform.tileZoom),1/n.ay(ae,1,X.transform.tileZoom)],u_pixel_coord_upper:[De>>16,Ee>>16],u_pixel_coord_lower:[65535&De,65535&Ee]}})(0,b,S,d,I,D),{u_matrix:h,u_emissive_strength:t,u_opacity:a}),Gs=new Float32Array(n.bA([])),ks=(h,t,a,d,y,b,S,I,D,N,V,K,X,Q=[0,0,0],ae,ie,ge)=>{const me=y.style.light,Se=me.properties.get("position"),De=[-Se.x,-Se.y,Se.z],Ee=n.dO();me.properties.get("anchor")==="viewport"&&(n.dP(Ee,-y.transform.angle),n.dQ(De,De,Ee));const We=V.alphaMode==="MASK",Ve=me.properties.get("color").toNonPremultipliedRenderColor(null),He=X.paint.get("model-ambient-occlusion-intensity"),Ne=X.paint.get("model-color").constantOr(n.ao.white).toNonPremultipliedRenderColor(null);return Ne.a=X.paint.get("model-color-mix-intensity").constantOr(0),ge&&(Ne.r=ge[0],Ne.g=ge[1],Ne.b=ge[2],Ne.a=ge[3]),ie&&(Ne.r=ie.color.r,Ne.g=ie.color.g,Ne.b=ie.color.b,Ne.a=ie.colorMix,K=ie.emissionStrength,b*=ie.opacity),{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:d||Gs,u_lightpos:De,u_lightintensity:me.properties.get("intensity"),u_lightcolor:[Ve.r,Ve.g,Ve.b],u_camera_pos:Q,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+We,u_alphaCutoff:V.alphaCutoff,u_baseColorFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:D,u_roughnessFactor:N,u_baseColorTexture:_s.BaseColor,u_metallicRoughnessTexture:_s.MetallicRoughness,u_normalTexture:_s.Normal,u_occlusionTexture:_s.Occlusion,u_emissionTexture:_s.Emission,u_lutTexture:_s.LUT,u_color_mix:Ne.toArray01(),u_aoIntensity:He,u_emissive_strength:K,u_occlusionTextureTransform:ae||[0,0,0,0]}},Ro=(h,t=Gs,a=Gs)=>({u_matrix:h,u_instance:t,u_node_matrix:a}),mc={fillExtrusion:h=>({u_matrix:new n.cl(h),u_lightpos:new n.ci(h),u_lightintensity:new n.cj(h),u_lightcolor:new n.ci(h),u_vertical_gradient:new n.cj(h),u_opacity:new n.cj(h),u_edge_radius:new n.cj(h),u_width_scale:new n.cj(h),u_ao:new n.ck(h),u_height_type:new n.ch(h),u_base_type:new n.ch(h),u_tile_id:new n.ci(h),u_zoom_transition:new n.cj(h),u_inv_rot_matrix:new n.cl(h),u_merc_center:new n.ck(h),u_up_dir:new n.ci(h),u_height_lift:new n.cj(h),u_flood_light_color:new n.ci(h),u_vertical_scale:new n.cj(h),u_flood_light_intensity:new n.cj(h),u_ground_shadow_factor:new n.ci(h)}),fillExtrusionDepth:h=>({u_matrix:new n.cl(h),u_edge_radius:new n.cj(h),u_width_scale:new n.cj(h),u_vertical_scale:new n.cj(h),u_height_type:new n.ch(h),u_base_type:new n.ch(h)}),fillExtrusionPattern:h=>({u_matrix:new n.cl(h),u_lightpos:new n.ci(h),u_lightintensity:new n.cj(h),u_lightcolor:new n.ci(h),u_vertical_gradient:new n.cj(h),u_height_factor:new n.cj(h),u_edge_radius:new n.cj(h),u_width_scale:new n.cj(h),u_ao:new n.ck(h),u_height_type:new n.ch(h),u_base_type:new n.ch(h),u_tile_id:new n.ci(h),u_zoom_transition:new n.cj(h),u_inv_rot_matrix:new n.cl(h),u_merc_center:new n.ck(h),u_up_dir:new n.ci(h),u_height_lift:new n.cj(h),u_image:new n.ch(h),u_texsize:new n.ck(h),u_pixel_coord_upper:new n.ck(h),u_pixel_coord_lower:new n.ck(h),u_tile_units_to_pixels:new n.cj(h),u_opacity:new n.cj(h),u_pattern_transition:new n.cj(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new n.cl(h),u_opacity:new n.cj(h),u_ao_pass:new n.cj(h),u_meter_to_tile:new n.cj(h),u_ao:new n.ck(h),u_flood_light_intensity:new n.cj(h),u_flood_light_color:new n.ci(h),u_attenuation:new n.cj(h),u_edge_radius:new n.cj(h),u_fb:new n.ch(h),u_fb_size:new n.cj(h),u_dynamic_offset:new n.cj(h)}),fill:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_ground_shadow_factor:new n.ci(h)}),fillPattern:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_image:new n.ch(h),u_texsize:new n.ck(h),u_pixel_coord_upper:new n.ck(h),u_pixel_coord_lower:new n.ck(h),u_tile_units_to_pixels:new n.cj(h),u_ground_shadow_factor:new n.ci(h),u_pattern_transition:new n.cj(h)}),fillOutline:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_world:new n.ck(h),u_ground_shadow_factor:new n.ci(h)}),fillOutlinePattern:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_world:new n.ck(h),u_image:new n.ch(h),u_texsize:new n.ck(h),u_pixel_coord_upper:new n.ck(h),u_pixel_coord_lower:new n.ck(h),u_tile_units_to_pixels:new n.cj(h),u_ground_shadow_factor:new n.ci(h),u_pattern_transition:new n.cj(h)}),building:h=>({u_matrix:new n.cl(h),u_normal_matrix:new n.cl(h),u_opacity:new n.cj(h),u_faux_facade_ao_intensity:new n.cj(h),u_camera_pos:new n.ci(h),u_tile_to_meter:new n.cj(h),u_facade_emissive_chance:new n.cj(h),u_flood_light_color:new n.ci(h),u_flood_light_intensity:new n.cj(h)}),buildingBloom:h=>({u_matrix:new n.cl(h)}),buildingDepth:h=>({u_matrix:new n.cl(h)}),elevatedStructuresDepth:h=>({u_matrix:new n.cl(h),u_depth_bias:new n.cj(h)}),elevatedStructures:h=>({u_matrix:new n.cl(h),u_ground_shadow_factor:new n.ci(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new n.cl(h),u_camera_pos:new n.ci(h),u_depth_bias:new n.cj(h),u_height_scale:new n.cj(h),u_reset_depth:new n.cj(h)}),circle:n.dY,collisionBox:h=>({u_matrix:new n.cl(h),u_inv_rot_matrix:new n.cl(h),u_camera_to_center_distance:new n.cj(h),u_extrude_scale:new n.ck(h),u_zoom_transition:new n.cj(h),u_merc_center:new n.ck(h),u_tile_id:new n.ci(h)}),collisionCircle:h=>({u_matrix:new n.cl(h),u_inv_matrix:new n.cl(h),u_camera_to_center_distance:new n.cj(h),u_viewport_size:new n.ck(h)}),debug:h=>({u_color:new n.dB(h),u_matrix:new n.cl(h),u_overlay:new n.ch(h),u_overlay_scale:new n.cj(h)}),clippingMask:h=>({u_matrix:new n.cl(h)}),heatmap:h=>({u_extrude_scale:new n.cj(h),u_intensity:new n.cj(h),u_matrix:new n.cl(h),u_inv_rot_matrix:new n.cl(h),u_merc_center:new n.ck(h),u_tile_id:new n.ci(h),u_zoom_transition:new n.cj(h),u_up_dir:new n.ci(h)}),heatmapTexture:h=>({u_image:new n.ch(h),u_color_ramp:new n.ch(h),u_opacity:new n.cj(h)}),hillshade:h=>({u_matrix:new n.cl(h),u_image:new n.ch(h),u_latrange:new n.ck(h),u_light:new n.ck(h),u_shadow:new n.dB(h),u_highlight:new n.dB(h),u_emissive_strength:new n.cj(h),u_accent:new n.dB(h)}),hillshadePrepare:h=>({u_matrix:new n.cl(h),u_image:new n.ch(h),u_dimension:new n.ck(h),u_zoom:new n.cj(h)}),line:n.dX,linePattern:n.dW,raster:h=>({u_matrix:new n.cl(h),u_normalize_matrix:new n.cl(h),u_globe_matrix:new n.cl(h),u_merc_matrix:new n.cl(h),u_grid_matrix:new n.dC(h),u_tl_parent:new n.ck(h),u_scale_parent:new n.cj(h),u_fade_t:new n.cj(h),u_opacity:new n.cj(h),u_image0:new n.ch(h),u_image1:new n.ch(h),u_brightness_low:new n.cj(h),u_brightness_high:new n.cj(h),u_saturation_factor:new n.cj(h),u_contrast_factor:new n.cj(h),u_spin_weights:new n.ci(h),u_perspective_transform:new n.ck(h),u_raster_elevation:new n.cj(h),u_zoom_transition:new n.cj(h),u_merc_center:new n.ck(h),u_cutoff_params:new n.d3(h),u_colorization_mix:new n.d3(h),u_colorization_offset:new n.cj(h),u_color_ramp:new n.ch(h),u_texture_offset:new n.ck(h),u_texture_res:new n.ck(h),u_emissive_strength:new n.cj(h)}),rasterParticle:h=>({u_matrix:new n.cl(h),u_normalize_matrix:new n.cl(h),u_globe_matrix:new n.cl(h),u_merc_matrix:new n.cl(h),u_grid_matrix:new n.dC(h),u_tl_parent:new n.ck(h),u_scale_parent:new n.cj(h),u_fade_t:new n.cj(h),u_opacity:new n.cj(h),u_image0:new n.ch(h),u_image1:new n.ch(h),u_raster_elevation:new n.cj(h),u_zoom_transition:new n.cj(h),u_merc_center:new n.ck(h),u_cutoff_params:new n.d3(h)}),rasterParticleTexture:h=>({u_texture:new n.ch(h),u_opacity:new n.cj(h)}),rasterParticleDraw:h=>({u_particle_texture:new n.ch(h),u_particle_texture_side_len:new n.cj(h),u_tile_offset:new n.ck(h),u_velocity:new n.ch(h),u_color_ramp:new n.ch(h),u_velocity_res:new n.ck(h),u_max_speed:new n.cj(h),u_uv_offset:new n.ck(h),u_data_scale:new n.ck(h),u_data_offset:new n.cj(h),u_particle_pos_scale:new n.cj(h),u_particle_pos_offset:new n.ck(h)}),rasterParticleUpdate:h=>({u_particle_texture:new n.ch(h),u_particle_texture_side_len:new n.cj(h),u_velocity:new n.ch(h),u_velocity_res:new n.ck(h),u_max_speed:new n.cj(h),u_speed_factor:new n.cj(h),u_reset_rate:new n.cj(h),u_rand_seed:new n.cj(h),u_uv_offset:new n.ck(h),u_data_scale:new n.ck(h),u_data_offset:new n.cj(h),u_particle_pos_scale:new n.cj(h),u_particle_pos_offset:new n.ck(h)}),symbol:h=>({u_is_size_zoom_constant:new n.ch(h),u_is_size_feature_constant:new n.ch(h),u_size_t:new n.cj(h),u_size:new n.cj(h),u_camera_to_center_distance:new n.cj(h),u_rotate_symbol:new n.ch(h),u_aspect_ratio:new n.cj(h),u_fade_change:new n.cj(h),u_matrix:new n.cl(h),u_label_plane_matrix:new n.cl(h),u_coord_matrix:new n.cl(h),u_is_text:new n.ch(h),u_elevation_from_sea:new n.ch(h),u_pitch_with_map:new n.ch(h),u_texsize:new n.ck(h),u_texsize_icon:new n.ck(h),u_texture:new n.ch(h),u_texture_icon:new n.ch(h),u_gamma_scale:new n.cj(h),u_device_pixel_ratio:new n.cj(h),u_tile_id:new n.ci(h),u_zoom_transition:new n.cj(h),u_inv_rot_matrix:new n.cl(h),u_merc_center:new n.ck(h),u_camera_forward:new n.ci(h),u_tile_matrix:new n.cl(h),u_up_vector:new n.ci(h),u_ecef_origin:new n.ci(h),u_is_halo:new n.ch(h),u_icon_transition:new n.cj(h),u_color_adj_mat:new n.cl(h),u_scale_factor:new n.cj(h),u_ground_shadow_factor:new n.ci(h),u_inv_matrix:new n.cl(h),u_normal_scale:new n.cj(h),u_lutTexture:new n.ch(h)}),background:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_opacity:new n.cj(h),u_color:new n.dB(h)}),backgroundPattern:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_opacity:new n.cj(h),u_image:new n.ch(h),u_pattern_tl:new n.ck(h),u_pattern_br:new n.ck(h),u_texsize:new n.ck(h),u_pattern_size:new n.ck(h),u_pixel_coord_upper:new n.ck(h),u_pixel_coord_lower:new n.ck(h),u_pattern_units_to_pixels:new n.ck(h)}),terrainRaster:h=>({u_matrix:new n.cl(h),u_image0:new n.ch(h),u_image1:new n.ch(h),u_skirt_height:new n.cj(h),u_ground_shadow_factor:new n.ci(h),u_emissive_texture_available:new n.cj(h)}),skybox:h=>({u_matrix:new n.cl(h),u_sun_direction:new n.ci(h),u_cubemap:new n.ch(h),u_opacity:new n.cj(h),u_temporal_offset:new n.cj(h)}),skyboxGradient:h=>({u_matrix:new n.cl(h),u_color_ramp:new n.ch(h),u_center_direction:new n.ci(h),u_radius:new n.cj(h),u_opacity:new n.cj(h),u_temporal_offset:new n.cj(h)}),skyboxCapture:h=>({u_matrix_3f:new n.dC(h),u_sun_direction:new n.ci(h),u_sun_intensity:new n.cj(h),u_color_tint_r:new n.d3(h),u_color_tint_m:new n.d3(h),u_luminance:new n.cj(h)}),globeRaster:h=>({u_proj_matrix:new n.cl(h),u_globe_matrix:new n.cl(h),u_normalize_matrix:new n.cl(h),u_merc_matrix:new n.cl(h),u_zoom_transition:new n.cj(h),u_merc_center:new n.ck(h),u_image0:new n.ch(h),u_image1:new n.ch(h),u_grid_matrix:new n.dC(h),u_skirt_height:new n.cj(h),u_far_z_cutoff:new n.cj(h),u_frustum_tl:new n.ci(h),u_frustum_tr:new n.ci(h),u_frustum_br:new n.ci(h),u_frustum_bl:new n.ci(h),u_globe_pos:new n.ci(h),u_globe_radius:new n.cj(h),u_viewport:new n.ck(h),u_emissive_texture_available:new n.cj(h)}),globeAtmosphere:h=>({u_frustum_tl:new n.ci(h),u_frustum_tr:new n.ci(h),u_frustum_br:new n.ci(h),u_frustum_bl:new n.ci(h),u_horizon:new n.cj(h),u_transition:new n.cj(h),u_fadeout_range:new n.cj(h),u_atmosphere_fog_color:new n.d3(h),u_high_color:new n.d3(h),u_space_color:new n.d3(h),u_temporal_offset:new n.cj(h),u_horizon_angle:new n.cj(h)}),model:h=>({u_matrix:new n.cl(h),u_lighting_matrix:new n.cl(h),u_normal_matrix:new n.cl(h),u_node_matrix:new n.cl(h),u_lightpos:new n.ci(h),u_lightintensity:new n.cj(h),u_lightcolor:new n.ci(h),u_camera_pos:new n.ci(h),u_opacity:new n.cj(h),u_baseColorFactor:new n.d3(h),u_emissiveFactor:new n.d3(h),u_metallicFactor:new n.cj(h),u_roughnessFactor:new n.cj(h),u_baseTextureIsAlpha:new n.ch(h),u_alphaMask:new n.ch(h),u_alphaCutoff:new n.cj(h),u_baseColorTexture:new n.ch(h),u_metallicRoughnessTexture:new n.ch(h),u_normalTexture:new n.ch(h),u_occlusionTexture:new n.ch(h),u_emissionTexture:new n.ch(h),u_lutTexture:new n.ch(h),u_color_mix:new n.d3(h),u_aoIntensity:new n.cj(h),u_emissive_strength:new n.cj(h),u_occlusionTextureTransform:new n.d3(h)}),modelDepth:h=>({u_matrix:new n.cl(h),u_instance:new n.cl(h),u_node_matrix:new n.cl(h)}),groundShadow:h=>({u_matrix:new n.cl(h),u_ground_shadow_factor:new n.ci(h)}),stars:h=>({u_matrix:new n.cl(h),u_up:new n.ci(h),u_right:new n.ci(h),u_intensity_multiplier:new n.cj(h)}),snowParticle:h=>({u_modelview:new n.cl(h),u_projection:new n.cl(h),u_time:new n.cj(h),u_cam_pos:new n.ci(h),u_velocityConeAperture:new n.cj(h),u_velocity:new n.cj(h),u_horizontalOscillationRadius:new n.cj(h),u_horizontalOscillationRate:new n.cj(h),u_boxSize:new n.cj(h),u_billboardSize:new n.cj(h),u_simpleShapeParameters:new n.ck(h),u_screenSize:new n.ck(h),u_thinningCenterPos:new n.ck(h),u_thinningShape:new n.ci(h),u_thinningAffectedRatio:new n.cj(h),u_thinningParticleOffset:new n.cj(h),u_particleColor:new n.d3(h),u_direction:new n.ci(h)}),rainParticle:h=>({u_modelview:new n.cl(h),u_projection:new n.cl(h),u_time:new n.cj(h),u_cam_pos:new n.ci(h),u_texScreen:new n.ch(h),u_velocityConeAperture:new n.cj(h),u_velocity:new n.cj(h),u_boxSize:new n.cj(h),u_rainDropletSize:new n.ck(h),u_distortionStrength:new n.cj(h),u_rainDirection:new n.ci(h),u_color:new n.d3(h),u_screenSize:new n.ck(h),u_thinningCenterPos:new n.ck(h),u_thinningShape:new n.ci(h),u_thinningAffectedRatio:new n.cj(h),u_thinningParticleOffset:new n.cj(h),u_shapeDirectionalPower:new n.cj(h),u_shapeNormalPower:new n.cj(h),u_mode:new n.cj(h)}),vignette:h=>({u_vignetteShape:new n.ci(h),u_vignetteColor:new n.d3(h)}),occlusion:h=>({u_matrix:new n.cl(h),u_anchorPos:new n.ci(h),u_screenSizePx:new n.ck(h),u_occluderSizePx:new n.ck(h),u_color:new n.d3(h)})};class Bl{constructor(t,a,d,y){this.id=Bl.uniqueIdxCounter,Bl.uniqueIdxCounter++,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Bl.uniqueIdxCounter,Bl.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Bl.uniqueIdxCounter=0;const Kc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ul{constructor(t,a,d,y,b,S){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=y,this.instanceCount=S,this.context=t;const I=t.gl;this.buffer=I.createBuffer(),t.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let d=0;d<this.attributes.length;d++){const y=a.getAttributeLocation(t,this.attributes[d].name);y!==-1&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,a,d){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],S=a.getAttributeLocation(t,b.name);S!==-1&&t.vertexAttribPointer(S,b.components,t[Kc[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,a,d){for(let y=0;y<this.attributes.length;y++){const b=a.getAttributeLocation(t,this.attributes[y].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(b,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Fs{constructor(t,a,d,y,b){this.context=t,this.width=a,this.height=d;const S=this.framebuffer=t.gl.createFramebuffer();y>0&&(this.colorAttachment0=new pd(t,S,0)),y>1&&(this.colorAttachment1=new pd(t,S,1)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new Nh(t,S):new tf(t,S))}createColorAttachment(t,a){a===0?this.colorAttachment0=new pd(t,this.framebuffer,0):a===1&&(this.colorAttachment1=new pd(t,this.framebuffer,1))}removeColorAttachment(t,a){const d=this.context.gl;let y;a===0?(y=this.colorAttachment0.get(),this.colorAttachment0=void 0):a===1&&(y=this.colorAttachment1.get(),this.colorAttachment1=void 0),y&&d.deleteTexture(y)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const a=this.colorAttachment0.get();a&&t.deleteTexture(a)}if(this.colorAttachment1){const a=this.colorAttachment1.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class xu{constructor(t,a){this.gl=t,this.clearColor=new al(this),this.clearDepth=new Fl(this),this.clearStencil=new Nu(this),this.colorMask=new Df(this),this.depthMask=new Jd(this),this.stencilMask=new oh(this),this.stencilFunc=new Oh(this),this.stencilOp=new yo(this),this.stencilTest=new $a(this),this.depthRange=new dn(this),this.depthTest=new Wc(this),this.depthFunc=new dc(this),this.blend=new Bh(this),this.blendFunc=new Jl(this),this.blendColor=new lh(this),this.blendEquation=new Qd(this),this.cullFace=new Ra(this),this.cullFaceSide=new Xc(this),this.frontFace=new ip(this),this.program=new dd(this),this.activeTexture=new np(this),this.viewport=new Ol(this),this.bindFramebuffer=new ju(this),this.bindRenderbuffer=new ch(this),this.bindTexture=new uh(this),this.bindVertexBuffer=new Rp(this),this.bindElementBuffer=new Cd(this),this.bindVertexArrayOES=new fd(this),this.pixelStoreUnpack=new ef(this),this.pixelStoreUnpackPremultiplyAlpha=new Yo(this),this.pixelStoreUnpackFlipY=new Ba(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,d){return new Bl(this,t,a,d)}createVertexBuffer(t,a,d,y,b){return new ul(this,t,a,d,y,b)}createRenderbuffer(t,a,d){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,t,a,d),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,d,y){return new Fs(this,t,a,d,y)}clear({color:t,depth:a,stencil:d,colorMask:y}){const b=this.gl;let S=0;t&&(S|=b.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),a!==void 0&&(S|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(S|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),b.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.by(t.blendFunction,hr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Nl;function hi(h,t,a,d,y,b,S){const I=h.context,D=I.gl,N=h.transform,V=[n.aF(N.center.lng),n.aJ(N.center.lat)],K=a.layout.get("symbol-placement"),X=a.layout.get("text-variable-anchor"),Q=a.layout.get("icon-rotation-alignment")==="map",ae=a.layout.get("text-rotation-alignment")==="map",ie=K!=="point",ge=[];let me=0,Se=0;for(let Oe=0;Oe<d.length;Oe++){const nt=d[Oe],mt=t.getTile(nt),dt=mt.getBucket(a);if(!dt)continue;const At=dt.getProjection().createInversionMatrix(N,nt.canonical),Ct=[],Dt=ss(nt,dt,N),Kt=!S&&Q&&ie,vt=S&&ae&&ie,rt=X&&dt.hasTextData(),Nt=dt.hasIconTextFit()&&rt&&dt.hasIconData(),Lt=Kt||vt||S&&rt||Nt,li=dt.projection.name==="globe",Mi=li?n.aj(N.zoom):0;li&&(Ct.push("PROJECTION_GLOBE_VIEW"),Lt&&Ct.push("PROJECTED_POS_ON_VIEWPORT"));const ki=h.getOrCreateProgram("collisionBox",{defines:Ct});let Ei=Dt;y[0]===0&&y[1]===0||(Ei=h.translatePosMatrix(Dt,mt,y,b));const _i=S?dt.textCollisionBox:dt.iconCollisionBox,fn=dt.collisionCircleArray;if(fn.length>0){const $i=n.bC(),en=Ei;n.cP($i,dt.placementInvProjMatrix,N.glCoordMatrix),n.cP($i,$i,dt.placementViewportMatrix),ge.push({circleArray:fn,circleOffset:Se,transform:en,invTransform:$i,projection:dt.getProjection()}),me+=fn.length/4,Se=me}if(!_i)continue;h.terrain&&h.terrain.setupElevationDraw(mt,ki);const nn=li?[nt.canonical.x,nt.canonical.y,1<<nt.canonical.z]:[0,0,0];ki.draw(h,D.LINES,yn.disabled,jn.disabled,h.colorModeForRenderPass(),Vn.disabled,Zn(Ei,At,N,Mi,V,mt,nn,dt.getProjection()),a.id,_i.layoutVertexBuffer,_i.indexBuffer,_i.segments,null,N.zoom,null,[_i.collisionVertexBuffer,_i.collisionVertexBufferExt])}if(!S||!ge.length)return;const De=h.getOrCreateProgram("collisionCircle"),Ee=new n.dZ;Ee.resize(4*me),Ee._trim();let We=0;for(const Oe of ge)for(let nt=0;nt<Oe.circleArray.length/4;nt++){const mt=4*nt,dt=Oe.circleArray[mt+0],At=Oe.circleArray[mt+1],Ct=Oe.circleArray[mt+2],Dt=Oe.circleArray[mt+3];Ee.emplace(We++,dt,At,Ct,Dt,0),Ee.emplace(We++,dt,At,Ct,Dt,1),Ee.emplace(We++,dt,At,Ct,Dt,2),Ee.emplace(We++,dt,At,Ct,Dt,3)}(!Nl||Nl.length<2*me)&&(Nl=(function(Oe){const nt=2*Oe,mt=new n.b0;mt.resize(nt),mt._trim();for(let dt=0;dt<nt;dt++){const At=6*dt;mt.uint16[At+0]=4*dt+0,mt.uint16[At+1]=4*dt+1,mt.uint16[At+2]=4*dt+2,mt.uint16[At+3]=4*dt+2,mt.uint16[At+4]=4*dt+3,mt.uint16[At+5]=4*dt+0}return mt})(me));const Ve=I.createIndexBuffer(Nl,!0),He=I.createVertexBuffer(Ee,n.d_.members,!0);for(const Oe of ge){const nt={u_matrix:Oe.transform,u_inv_matrix:Oe.invTransform,u_camera_to_center_distance:(Ne=N).getCameraToCenterDistance(Oe.projection),u_viewport_size:[Ne.width,Ne.height]};De.draw(h,D.TRIANGLES,yn.disabled,jn.disabled,h.colorModeForRenderPass(),Vn.disabled,nt,a.id,He,Ve,n.bg.simpleSegment(0,2*Oe.circleOffset,Oe.circleArray.length,Oe.circleArray.length/2),null,N.zoom)}var Ne;He.destroy(),Ve.destroy()}const Na=n.bC();function gs(h){const t=h._camera.getWorldToCamera(h.worldSize,1),a=n.aB([],t,h.globeMatrix);n.bl(a,a);const d=[0,0,0],y=[0,1,0,0];return n.aC(y,y,a),d[0]=y[0],d[1]=y[1],d[2]=y[2],n.aw(d,d),d}function Ko({width:h,height:t,anchor:a,textOffset:d,textScale:y},b){const{horizontalAlign:S,verticalAlign:I}=n.c1(a),D=-(S-.5)*h,N=-(I-.5)*t,V=n.c2(a,d);return new n.P((D/y+V[0])*b,(N/y+V[1])*b)}function pn(h,t,a,d,y,b,S,I,D,N){const V=h.text.placedSymbolArray,K=h.text.dynamicLayoutVertexArray,X=h.icon.dynamicLayoutVertexArray,Q={},ae=h.getProjection(),ie=zl(S,ae,y),ge=y.elevation,me=ae.upVectorScale(S.canonical,y.center.lat,y.worldSize).metersToTile;K.clear();for(let Se=0;Se<V.length;Se++){const De=V.get(Se),{tileAnchorX:Ee,tileAnchorY:We,numGlyphs:Ve}=De,He=De.hidden||!De.crossTileID||h.allowVerticalPlacement&&!De.placedOrientation?null:d[De.crossTileID];if(He){let Ne=0,Oe=0,nt=0;const mt=h.elevationType==="road";if(ge||mt){const Lt=mt?h.getElevationFeatureForText(Se):null,li=n.bV.getAtTileOffset(S,new n.P(Ee,We),ge,Lt),[Mi,ki,Ei]=ae.upVector(S.canonical,Ee,We);Ne=li*Mi*me,Oe=li*ki*me,nt=li*Ei*me}let[dt,At,Ct,Dt]=Gc(De.projectedAnchorX+Ne,De.projectedAnchorY+Oe,De.projectedAnchorZ+nt,a?ie:b);const Kt=Ia(y.getCameraToCenterDistance(ae),Dt);let vt=n.bM(h.textSizeData,D,De)*Kt/n.bY;a&&(vt*=h.tilePixelRatio/I);const rt=Ko(He,vt);a?({x:dt,y:At,z:Ct}=ae.projectTilePoint(Ee+rt.x,We+rt.y,S.canonical),[dt,At,Ct]=Gc(dt+Ne,At+Oe,Ct+nt,b)):(t&&rt._rotate(-y.angle),dt+=rt.x,At+=rt.y,Ct=0);const Nt=h.allowVerticalPlacement&&De.placedOrientation===n.bL.vertical?Math.PI/2:0;for(let Lt=0;Lt<Ve;Lt++)n.bO(K,dt,At,Ct,Nt);N&&De.associatedIconIndex>=0&&(Q[De.associatedIconIndex]={x:dt,y:At,z:Ct,angle:Nt})}else zc(Ve,K)}if(N){X.clear();const Se=h.icon.placedSymbolArray;for(let De=0;De<Se.length;De++){const Ee=Se.get(De),{numGlyphs:We}=Ee,Ve=Q[De];if(Ee.hidden||!Ve)zc(We,X);else{const{x:He,y:Ne,z:Oe,angle:nt}=Ve;for(let mt=0;mt<We;mt++)n.bO(X,He,Ne,Oe,nt)}}h.icon.dynamicLayoutVertexBuffer.updateData(X)}h.text.dynamicLayoutVertexBuffer.updateData(K)}function vo(h,t,a,d,y,b,S={}){const I=a.paint.get("icon-translate"),D=a.paint.get("text-translate"),N=a.paint.get("icon-translate-anchor"),V=a.paint.get("text-translate-anchor"),K=a.layout.get("icon-rotation-alignment"),X=a.layout.get("text-rotation-alignment"),Q=a.layout.get("icon-pitch-alignment"),ae=a.layout.get("text-pitch-alignment"),ie=a.layout.get("icon-keep-upright"),ge=a.layout.get("text-keep-upright"),me=a.paint.get("icon-color-saturation"),Se=a.paint.get("icon-color-contrast"),De=a.paint.get("icon-color-brightness-min"),Ee=a.paint.get("icon-color-brightness-max"),We=a.layout.get("symbol-elevation-reference")==="sea",Ve=a.layout.get("icon-image-use-theme")==="none",He=h.context,Ne=He.gl,Oe=h.transform,nt=K==="map",mt=X==="map",dt=Q==="map",At=ae==="map",Ct=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Dt=!1;const Kt=h.depthModeForSublayer(0,yn.ReadOnly),vt=new yn(h.context.gl.LEQUAL,yn.ReadOnly,h.depthRangeFor3D),rt=[n.aF(Oe.center.lng),n.aJ(Oe.center.lat)],Nt=a.layout.get("text-variable-anchor"),Lt=Oe.projection.name==="globe",li=[],Mi=[0,-1,0];for(const ki of d){const Ei=t.getTile(ki),_i=Ei.getBucket(a);if(!_i||_i.projection.name==="mercator"&&Lt||_i.fullyClipped)continue;const fn=_i.projection.name==="globe",nn=fn?n.aj(Oe.zoom):0,$i=zl(ki,_i.getProjection(),Oe),en=Oe.calculatePixelsToTileUnitsMatrix(Ei),bn=Nt&&_i.hasTextData(),ar=_i.hasIconTextFit()&&bn&&_i.hasIconData(),jr=_i.getProjection().createInversionMatrix(Oe,ki.canonical),Ea=(1<<Ei.tileID.canonical.z)*n.al/h.transform.worldSize,_n=ba=>{let zr=[0,0,0];if(ba){const yr=h.style.directionalLight,ga=h.style.ambientLight;yr&&ga&&(zr=Pc(h.style,yr,ga))}return zr},ca=ba=>{Oe.depthOcclusionForSymbolsAndCircles&&(a.hasOcclusionOpacityProperties||h.terrain)&&(ba.push("DEPTH_D24"),ba.push("DEPTH_OCCLUSION"))},Jn=ba=>{a.lut&&!Ve&&(a.lut.texture||(a.lut.texture=new n.d$(h.context,a.lut.image,[a.lut.image.height,a.lut.image.height,a.lut.image.height],He.gl.RGBA8)),He.activeTexture.set(He.gl.TEXTURE0+_s.LUT),a.lut.texture&&a.lut.texture.bind(He.gl.LINEAR,He.gl.CLAMP_TO_EDGE),ba.push("APPLY_LUT_ON_GPU"))},xr=()=>{const ba=nt&&a.layout.get("symbol-placement")!=="point",zr=[];ca(zr),Jn(zr);const yr=ba||ar,ga=_i.elevationType==="road",As=h.shadowRenderer,Ms=ga&&dt&&!!As&&As.enabled,Wa=_n(Ms),No=ga&&dt&&!h.terrain?vt:Kt,el=a.paint.get("icon-image-cross-fade");h.terrainRenderModeElevated()&&dt&&zr.push("PITCH_WITH_MAP_TERRAIN"),fn&&(zr.push("PROJECTION_GLOBE_VIEW"),yr&&zr.push("PROJECTED_POS_ON_VIEWPORT")),el>0&&_i.hasAnySecondaryIcon&&zr.push("ICON_TRANSITION"),!_i.icon.zOffsetVertexBuffer||ga&&h.terrain||zr.push("Z_OFFSET"),me===0&&Se===0&&De===0&&Ee===1||zr.push("COLOR_ADJUSTMENT"),_i.sdfIcons&&zr.push("RENDER_SDF"),Ms&&zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ga&&dt&&!h.terrain&&_i.icon.orientationVertexBuffer&&zr.push("ELEVATED_ROADS");const ho=_i.icon.programConfigurations.get(a.id),$o=h.getOrCreateProgram("symbol",{config:ho,defines:zr}),Vl=Ei.imageAtlasTexture?Ei.imageAtlasTexture.size:[0,0],dl=_i.iconSizeData,Qc=n.bK(dl,Oe.zoom),Xu=dt||!Oe.isOrthographic,tc=Rl($i,Ei.tileID.canonical,dt,nt,Oe,_i.getProjection(),en),qs=Ad($i,Ei.tileID.canonical,dt,nt,Oe,_i.getProjection(),en),fo=h.translatePosMatrix(qs,Ei,I,N,!0),Ua=h.translatePosMatrix($i,Ei,I,N),$s=yr?Na:tc,Os=nt&&!dt&&!ba;let Is=Mi;!Lt&&!Oe.mercatorFromTransition||nt||(Is=gs(Oe));const ic=fn?Is:Mi,jd=a.getColorAdjustmentMatrix(me,Se,De,Ee),Yu=pc(dl.kind,Qc,Os,dt,h,Ua,$s,fo,We,!1,Vl,[0,0],0,ki,nn,rt,jr,ic,_i.getProjection(),Wa,Ea,jd,el,null),vf=Ei.imageAtlasTexture?Ei.imageAtlasTexture:null,Zh=a.layout.get("icon-size").constantOr(0)!==1||_i.iconsNeedLinear,vh=_i.sdfIcons||h.options.rotating||h.options.zooming||Zh||Xu?Ne.LINEAR:Ne.NEAREST,xh=_i.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,xf=h.terrain&&dt&&ba?n.bl(n.bC(),tc):Na;if(ba&&_i.icon){const tl=n.bV.getAtTileOffsetFunc(ki,Oe.center.lat,Oe.worldSize,_i.getProjection()),Au=Ed($i,Ei.tileID.canonical,dt,nt,Oe,_i.getProjection(),en),Ku=a.layout.get("icon-size-scale-range"),ds=n.aA(h.scaleFactor,Ku[0],Ku[1]);Ip(_i,$i,h,!1,Au,qs,dt,ie,tl,ki,ds)}return{program:$o,buffers:_i.icon,uniformValues:Yu,atlasTexture:vf,atlasTextureIcon:null,atlasInterpolation:vh,atlasInterpolationIcon:null,isSDF:_i.sdfIcons,hasHalo:xh,depthMode:No,tile:Ei,renderWithShadows:Ms,labelPlaneMatrixInv:xf}},Zr=()=>{const ba=mt&&a.layout.get("symbol-placement")!=="point",zr=[],yr=ba||Nt||ar,ga=_i.elevationType==="road",As=h.shadowRenderer,Ms=ga&&At&&!!As&&As.enabled,Wa=_n(Ms),No=ga&&At&&!h.terrain?vt:Kt;h.terrainRenderModeElevated()&&At&&zr.push("PITCH_WITH_MAP_TERRAIN"),fn&&(zr.push("PROJECTION_GLOBE_VIEW"),yr&&zr.push("PROJECTED_POS_ON_VIEWPORT")),!_i.text.zOffsetVertexBuffer||ga&&h.terrain||zr.push("Z_OFFSET"),_i.iconsInText&&zr.push("RENDER_TEXT_AND_SYMBOL"),zr.push("RENDER_SDF"),Ms&&zr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ga&&At&&!h.terrain&&_i.text.orientationVertexBuffer&&zr.push("ELEVATED_ROADS"),ca(zr);const el=_i.text.programConfigurations.get(a.id),ho=h.getOrCreateProgram("symbol",{config:el,defines:zr});let $o,Vl=[0,0],dl=null;const Qc=_i.textSizeData;_i.iconsInText&&(Vl=Ei.imageAtlasTexture?Ei.imageAtlasTexture.size:[0,0],dl=Ei.imageAtlasTexture?Ei.imageAtlasTexture:null,$o=At||!Oe.isOrthographic||h.options.rotating||h.options.zooming||Qc.kind==="composite"||Qc.kind==="camera"?Ne.LINEAR:Ne.NEAREST);const Xu=Ei.glyphAtlasTexture?Ei.glyphAtlasTexture.size:[0,0],tc=a.layout.get("text-size-scale-range"),qs=n.aA(h.scaleFactor,tc[0],tc[1]),fo=n.bK(Qc,Oe.zoom,qs),Ua=Rl($i,Ei.tileID.canonical,At,mt,Oe,_i.getProjection(),en),$s=Ad($i,Ei.tileID.canonical,At,mt,Oe,_i.getProjection(),en),Os=h.translatePosMatrix($s,Ei,D,V,!0),Is=h.translatePosMatrix($i,Ei,D,V),ic=yr?Na:Ua,jd=mt&&!At&&!ba;let Yu=Mi;!Lt&&!Oe.mercatorFromTransition||mt||(Yu=gs(Oe));const vf=pc(Qc.kind,fo,jd,At,h,Is,ic,Os,We,!0,Xu,Vl,0,ki,nn,rt,jr,fn?Yu:Mi,_i.getProjection(),Wa,Ea,null,null,qs),Zh=Ei.glyphAtlasTexture?Ei.glyphAtlasTexture:null,vh=Ne.LINEAR,xh=a.paint.get("text-halo-width").constantOr(1)!==0,xf=h.terrain&&At&&ba?n.bl(n.bC(),Ua):Na;if(ba&&_i.text){const tl=n.bV.getAtTileOffsetFunc(ki,Oe.center.lat,Oe.worldSize,_i.getProjection()),Au=Ed($i,Ei.tileID.canonical,At,mt,Oe,_i.getProjection(),en);Ip(_i,$i,h,!0,Au,$s,At,ge,tl,ki,qs)}return{program:ho,buffers:_i.text,uniformValues:vf,atlasTexture:Zh,atlasTextureIcon:dl,atlasInterpolation:vh,atlasInterpolationIcon:$o,isSDF:!0,hasHalo:xh,depthMode:No,tile:Ei,renderWithShadows:Ms,labelPlaneMatrixInv:xf}},ta=_i.icon.segments.get().length,Wr=_i.text.segments.get().length,_r=ta&&!S.onlyText?xr():null,Aa=Wr&&!S.onlyIcons?Zr():null,Hs=a.paint.get("icon-opacity").constantOr(1),Za=a.paint.get("text-opacity").constantOr(1);if(Ct&&_i.canOverlap){Dt=!0;const ba=Hs&&!S.onlyText?_i.icon.segments.get():[],zr=Za&&!S.onlyIcons?_i.text.segments.get():[];for(const yr of ba)li.push({segments:new n.bg([yr]),sortKey:yr.sortKey,state:_r});for(const yr of zr)li.push({segments:new n.bg([yr]),sortKey:yr.sortKey,state:Aa})}else S.onlyText||li.push({segments:Hs?_i.icon.segments:new n.bg([]),sortKey:0,state:_r}),S.onlyIcons||li.push({segments:Za?_i.text.segments:new n.bg([]),sortKey:0,state:Aa})}Dt&&li.sort(((ki,Ei)=>ki.sortKey-Ei.sortKey));for(const ki of li){const Ei=ki.state;if(Ei)if(h.terrain?h.terrain.setupElevationDraw(Ei.tile,Ei.program,{useDepthForOcclusion:Oe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ei.labelPlaneMatrixInv}):h.setupDepthForOcclusion(Oe.depthOcclusionForSymbolsAndCircles,Ei.program),He.activeTexture.set(Ne.TEXTURE0),Ei.atlasTexture&&Ei.atlasTexture.bind(Ei.atlasInterpolation,Ne.CLAMP_TO_EDGE,!0),Ei.atlasTextureIcon&&(He.activeTexture.set(Ne.TEXTURE1),Ei.atlasTextureIcon&&Ei.atlasTextureIcon.bind(Ei.atlasInterpolationIcon,Ne.CLAMP_TO_EDGE,!0)),Ei.renderWithShadows&&h.shadowRenderer.setupShadows(Ei.tile.tileID.toUnwrapped(),Ei.program,"vector-tile"),h.uploadCommonLightUniforms(h.context,Ei.program),Ei.hasHalo){const _i=Ei.uniformValues;_i.u_is_halo=1,xl(Ei.buffers,ki.segments,a,h,Ei.program,Ei.depthMode,y,b,_i,2),_i.u_is_halo=0}else{if(Ei.isSDF){const _i=Ei.uniformValues;Ei.hasHalo&&(_i.u_is_halo=1,xl(Ei.buffers,ki.segments,a,h,Ei.program,Ei.depthMode,y,b,_i,1)),_i.u_is_halo=0}xl(Ei.buffers,ki.segments,a,h,Ei.program,Ei.depthMode,y,b,Ei.uniformValues,1)}}}function xl(h,t,a,d,y,b,S,I,D,N){const V=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer,h.orientationVertexBuffer];y.draw(d,d.context.gl.TRIANGLES,b,S,I,Vn.disabled,D,a.id,h.layoutVertexBuffer,h.indexBuffer,t,a.paint,d.transform.zoom,h.programConfigurations.get(a.id),V,N)}function ja(h,t){const a=1<<h.canonical.z,d=(t.x*a-h.canonical.x-h.wrap*a)*n.al,y=(t.y*a-h.canonical.y)*n.al,b=n.e8(t.z,t.y);return n.d5(d,y,b)}function _c(h,t,a,d,y){if(!a.layout||a.layout.get("fill-elevation-reference")==="none"||a.paint.get("fill-opacity").constantOr(1)===0)return;const b=h.context.gl,S=new yn(h.context.gl.LEQUAL,yn.ReadWrite,h.depthRangeFor3D),I=new yn(h.context.gl.GREATER,yn.ReadWrite,h.depthRangeFor3D),D=(function(Q){let ae=.01;return Q.isOrthographic&&(ae=n.ak(1e-4,ae,n.d0(Q.pitch>=cc?1:Q.pitch/cc))),2*ae})(h.transform),N=h.transform.getFreeCameraOptions().position,V="elevatedStructuresDepthReconstruct",K=h.getOrCreateProgram(V,{defines:["DEPTH_RECONSTRUCTION"]}),X=h.getOrCreateProgram(V);for(const Q of d){const ae=t.getTile(Q),ie=ae.getBucket(a);if(!ie)continue;const ge=ie.elevatedStructures;if(!ge)continue;const me=ie.elevationBufferData.heightRange,Se=ja(Q.toUnwrapped(),N),De=h.translatePosMatrix(Q.projMatrix,ae,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let Ee,We,Ve,He;if(y==="initialize"){if(!me||me.min>=1||ge.depthSegments.segments[0].primitiveLength===0)continue;Ee=oi(De,Se,D,1,0),We=S,Ve=ge.depthSegments,He=K}else if(y==="reset"){if(!me||me.min>=0||ge.maskSegments.segments[0].primitiveLength===0)continue;Ee=oi(De,Se,0,0,1),We=I,Ve=ge.maskSegments,He=K}else if(y==="geometry"){if(ge.depthSegments.segments[0].primitiveLength===0)continue;Ee=oi(De,Se,D,1,0),We=S,Ve=ge.depthSegments,He=X}He.draw(h,b.TRIANGLES,We,jn.disabled,hr.disabled,Vn.disabled,Ee,a.id,ge.vertexBuffer,ge.indexBuffer,Ve,a.paint,h.transform.zoom)}}function jh(h,t,a,d){const{painter:y,sourceCache:b,layer:S,coords:I,colorMode:D,elevationType:N,terrainEnabled:V,pass:K}=h,X=y.context.gl,Q=S.paint.get("fill-pattern"),ae=S.paint.get("fill-pattern-cross-fade"),ie=Q.constantOr(null);let ge=N;N!=="road"||t&&!V||(ge="none");const me=ge==="road",Se=h.painter.shadowRenderer,De=me&&!!Se&&Se.enabled,Ee=new yn(y.context.gl.LEQUAL,yn.ReadOnly,y.depthRangeFor3D);let We=[0,0,0];if(De){const Oe=y.style.directionalLight,nt=y.style.ambientLight;Oe&&nt&&(We=Pc(y.style,Oe,nt))}const Ve=Q&&Q.constantOr(1),He=y.terrain&&y.terrain.renderingToTexture,Ne=(Oe,nt)=>{let mt,dt,At,Ct,Dt;nt?(mt=Ve&&!S.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",At=X.LINES):(mt=Ve?"fillPattern":"fill",At=X.TRIANGLES);for(const Kt of I){const vt=b.getTile(Kt);if(Ve&&!vt.patternsLoaded())continue;const rt=vt.getBucket(S);if(!rt)continue;const Nt=t?rt.elevationBufferData:rt.bufferData;if(Nt.isEmpty())continue;y.prepareDrawTile();const Lt=Nt.programConfigurations.get(S.id),li=y.isTileAffectedByFog(Kt),Mi=[],ki=[];me&&(Mi.push("ELEVATED_ROADS"),ki.push(Nt.elevatedLayoutVertexBuffer)),De&&Mi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),He&&a&&Mi.push("USE_MRT1"),Ve&&(y.context.activeTexture.set(X.TEXTURE0),vt.imageAtlasTexture&&vt.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Lt.updatePaintBuffers());let Ei=!1;if(ie&&vt.imageAtlas){const en=vt.imageAtlas,bn=n.e3.from(ie),ar=bn.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),jr=bn.getSecondary(),Ea=en.patternPositions.get(ar),_n=jr?en.patternPositions.get(jr.scaleSelf(n.o.devicePixelRatio).toString()):null;Ei=!!Ea&&!!_n,Ea&&Lt.setConstantPatternPositions(Ea,_n)}ae>0&&(Ei||Lt.getPatternTransitionVertexBuffer("fill-pattern"))&&Mi.push("FILL_PATTERN_TRANSITION");const _i=y.getOrCreateProgram(mt,{config:Lt,overrideFog:li,defines:Mi}),fn=y.translatePosMatrix(Kt.projMatrix,vt,S.paint.get("fill-translate"),S.paint.get("fill-translate-anchor"));De&&Se.setupShadows(vt.tileID.toUnwrapped(),_i,"vector-tile");const nn=S.paint.get("fill-emissive-strength");if(nt){Ct=Nt.lineIndexBuffer,Dt=Nt.lineSegments;const en=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[X.drawingBufferWidth,X.drawingBufferHeight];dt=mt==="fillOutlinePattern"&&Ve?Ht(fn,nn,y,vt,en,We,ae):yt(fn,nn,en,We)}else Ct=Nt.indexBuffer,Dt=Nt.triangleSegments,dt=Ve?Ft(fn,nn,y,vt,We,ae):Rt(fn,nn,We);y.uploadCommonUniforms(y.context,_i,Kt.toUnwrapped());let $i=Oe;(N==="road"&&!V||N==="offset")&&($i=Ee),_i.draw(y,At,$i,d||y.stencilModeForClipping(Kt),D,Vn.disabled,dt,S.id,Nt.layoutVertexBuffer,Ct,Dt,S.paint,y.transform.zoom,Lt,ki)}};y.renderPass===K&&Ne(y.depthModeForSublayer(1,y.renderPass==="opaque"?yn.ReadWrite:yn.ReadOnly),!1),ge==="none"&&y.renderPass==="translucent"&&S.paint.get("fill-antialias")&&Ne(y.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,yn.ReadOnly),!0)}function Ys(h,t,a,d,y,b,S,I){a.resetLayerRenderingStats(h);const D=h.context,N=D.gl,V=h.transform,K=a.paint.get("fill-extrusion-pattern"),X=a.paint.get("fill-extrusion-pattern-cross-fade"),Q=K.constantOr(null),ae=K.constantOr(1),ie=a.paint.get("fill-extrusion-opacity"),ge=h.style.enable3dLights(),me=a.paint.get(ge&&!ae?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Se=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),me],De=a.layout.get("fill-extrusion-edge-radius"),Ee=De>0&&!a.paint.get("fill-extrusion-rounded-roof"),We=Ee?0:De,Ve=V.projection.name==="globe"?n.eb():0,He=V.projection.name==="globe",Ne=He?n.aj(V.zoom):0,Oe=[n.aF(V.center.lng),n.aJ(V.center.lat)],nt=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",mt=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(nt?null:a.lut).toArray01().slice(0,3),dt=a.paint.get("fill-extrusion-flood-light-intensity"),At=a.paint.get("fill-extrusion-vertical-scale"),Ct=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Dt=a.paint.get("fill-extrusion-height-alignment"),Kt=a.paint.get("fill-extrusion-base-alignment"),vt=ah(h,a.paint.get("fill-extrusion-cutoff-fade-range")),rt=[];let Nt;He&&rt.push("PROJECTION_GLOBE_VIEW"),Se[0]>0&&rt.push("FAUX_AO"),Ee&&rt.push("ZERO_ROOF_RADIUS"),I&&rt.push("HAS_CENTROID"),dt>0&&rt.push("FLOOD_LIGHT"),vt.shouldRenderCutoff&&rt.push("RENDER_CUTOFF"),Ct&&rt.push("RENDER_WALL_MODE");const Lt=h.renderPass==="shadow",li=h.shadowRenderer,Mi=Lt&&!!li,ki=Lt?Vn.disabled:Vn.backCCW;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let Ei=[0,0,0];if(li){const nn=h.style.directionalLight,$i=h.style.ambientLight;nn&&$i&&(Ei=Pc(h.style,nn,$i)),Lt||(rt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),li.useNormalOffset&&rt.push("NORMAL_OFFSET")),Nt=rt.concat(["SHADOWS_SINGLE_CASCADE"])}const _i=Mi?"fillExtrusionDepth":ae?"fillExtrusionPattern":"fillExtrusion",fn=a.getLayerRenderingStats();for(const nn of d){const $i=t.getTile(nn),en=$i.getBucket(a);if(!en||en.projection.name!==V.projection.name)continue;let bn=!1;li&&(bn=li.getMaxCascadeForTile(nn.toUnwrapped())===0);const ar=h.isTileAffectedByFog(nn),jr=en.programConfigurations.get(a.id);let Ea=!1;if(Q&&$i.imageAtlas){const Wr=$i.imageAtlas,_r=n.e3.from(Q),Aa=_r.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),Hs=_r.getSecondary(),Za=Wr.patternPositions.get(Aa),ba=Hs?Wr.patternPositions.get(Hs.scaleSelf(n.o.devicePixelRatio).toString()):null;Ea=!!Za&&!!ba,Za&&jr.setConstantPatternPositions(Za,ba)}X>0&&(Ea||jr.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&rt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const _n=h.getOrCreateProgram(_i,{config:jr,defines:bn?Nt:rt,overrideFog:ar});if(h.terrain&&h.terrain.setupElevationDraw($i,_n,{useMeterToDem:!0}),!en.centroidVertexBuffer){const Wr=_n.getAttributeLocation(N,"a_centroid_pos");Wr!==-1&&N.vertexAttrib2f(Wr,0,0)}!Lt&&li&&li.setupShadows($i.tileID.toUnwrapped(),_n,"vector-tile"),ae&&(h.context.activeTexture.set(N.TEXTURE0),$i.imageAtlasTexture&&$i.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),jr.updatePaintBuffers());const ca=a.paint.get("fill-extrusion-vertical-gradient"),Jn=1/en.tileToMeter;let xr;if(Lt&&li){if(gc($i.tileID,en.maxHeight,h))continue;const Wr=li.calculateShadowPassMatrixFromTile($i.tileID.toUnwrapped());xr=ot(Wr,We,Jn,At,Dt,Kt)}else{const Wr=h.translatePosMatrix(nn.expandedProjMatrix,$i,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),_r=V.projection.createInversionMatrix(V,nn.canonical);xr=ae?wt(Wr,h,ca,ie,Se,We,Jn,nn,$i,Ve,Dt,Kt,Ne,Oe,_r,mt,At,X):Ke(Wr,h,ca,ie,Se,We,Jn,nn,Ve,Dt,Kt,Ne,Oe,_r,mt,At,dt,Ei)}h.uploadCommonUniforms(D,_n,nn.toUnwrapped(),null,vt);let Zr=en.segments;if(V.projection.name==="mercator"&&!Lt&&(Zr=en.getVisibleSegments($i.tileID,h.terrain,h.transform.getFrustum(0)),!Zr.get().length))continue;if(fn)if(Lt)for(const Wr of Zr.get())fn.numRenderedVerticesInShadowPass+=Wr.primitiveLength;else for(const Wr of Zr.get())fn.numRenderedVerticesInTransparentPass+=Wr.primitiveLength;const ta=[];(h.terrain||I)&&ta.push(en.centroidVertexBuffer),He&&ta.push(en.layoutVertexExtBuffer),Ct&&ta.push(en.wallVertexBuffer),_n.draw(h,D.gl.TRIANGLES,y,b,S,ki,xr,a.id,en.layoutVertexBuffer,en.indexBuffer,Zr,a.paint,h.transform.zoom,jr,ta)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}class rf{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Uu(h,t,a,d,y,b,S,I,D,N,V,K,X,Q,ae,ie,ge,me,Se,De){const Ee=t.context,We=Ee.gl,Ve=t.transform,He=t.transform.zoom,Ne=[],Oe=h.translate,nt=h.translateAnchor,mt=h.edgeRadius,dt=ah(t,h.cutoffFadeRange);V==="clear"?(Ne.push("CLEAR_SUBPASS"),De&&(Ne.push("CLEAR_FROM_TEXTURE"),Ee.activeTexture.set(We.TEXTURE0),De.bind(We.LINEAR,We.CLAMP_TO_EDGE))):V==="sdf"?Ne.push("SDF_SUBPASS"):V==="emissive"&&(Ne.push("USE_MRT1"),Ee.activeTexture.set(We.TEXTURE0),De.bind(We.LINEAR,We.CLAMP_TO_EDGE)),me&&Ne.push("HAS_CENTROID"),dt.shouldRenderCutoff&&Ne.push("RENDER_CUTOFF");const At=(Ct,Dt,Kt,vt,rt)=>{let Nt=Ne;Dt.groundRadiusBuffer!=null&&(Nt=Ne.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Lt=Dt.programConfigurations.get(d.id),li=t.isTileAffectedByFog(Ct),Mi=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Lt,defines:Nt,overrideFog:li}),ki=Mt(t,vt,K,N,rt,[X,Q*rt],ae,ie,ge,He>=17?0:mt*rt,De?De.size[0]:0),Ei=[];me&&Ei.push(Dt.hiddenByLandmarkVertexBuffer),Dt.groundRadiusBuffer!=null&&Ei.push(Dt.groundRadiusBuffer),t.uploadCommonUniforms(Ee,Mi,Ct.toUnwrapped(),null,dt),Mi.draw(t,Ee.gl.TRIANGLES,b,S,I,D,ki,d.id,Dt.vertexBuffer,Dt.indexBuffer,Kt,d.paint,He,Lt,Ei)};for(const Ct of y){const Dt=a.getTile(Ct),Kt=Dt.getBucket(d);if(!Kt||Kt.projection.name!==Ve.projection.name||!Kt.groundEffect||Kt.groundEffect&&!Kt.groundEffect.hasData())continue;const vt=Kt.groundEffect,rt=1/Kt.tileToMeter;{const Nt=t.translatePosMatrix(Ct.projMatrix,Dt,Oe,nt),Lt=vt.getDefaultSegment();At(Ct,vt,Lt,Nt,rt)}if(Se)for(let Nt=0;Nt<4;Nt++){const Lt=n.e9[Nt](Ct),li=a.getTile(Lt);if(!li)continue;const Mi=li.getBucket(d);if(!Mi||Mi.projection.name!==Ve.projection.name||!Mi.groundEffect||Mi.groundEffect&&!Mi.groundEffect.hasData())continue;const ki=Mi.groundEffect;let Ei,_i;Nt===0?(Ei=[-n.al,0,0],_i=1):Nt===1?(Ei=[n.al,0,0],_i=0):Nt===2?(Ei=[0,-n.al,0],_i=3):(Ei=[0,n.al,0],_i=2);const fn=ki.regionSegments[_i];if(!fn)continue;const nn=new Float32Array(16);n.br(nn,Ct.projMatrix,Ei),At(Ct,ki,fn,t.translatePosMatrix(nn,Dt,Oe,nt),rt)}}}function Dp(h,t,a,d,y,b,S){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const I=b?b.findDEMTileFor(a):null;if(!(I&&I.dem||S))return;b&&I&&I.dem&&d.selfDEMTileTimestamp!==I.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=I.dem._timestamp);const D=me=>new n.P(Math.ceil((me+n.ed)*n.ee),0),N=me=>{const Se=t.getSource().minzoom,De=We=>{const Ve=t.getTileByID(We);if(Ve&&Ve.hasData())return Ve.getBucket(y)},Ee=[0,-1,1];for(const We of Ee){if(me.overscaledZ+We<Se)continue;const Ve=De(me.calculateScaledKey(me.overscaledZ+We));if(Ve)return Ve}},V=[0,0,0],K=(me,Se)=>(V[0]=Math.min(me.min.y,Se.min.y),V[1]=Math.max(me.max.y,Se.max.y),V[2]=n.al-Se.min.x>me.max.x?Se.min.x-n.al:me.max.x,V),X=(me,Se)=>(V[0]=Math.min(me.min.x,Se.min.x),V[1]=Math.max(me.max.x,Se.max.x),V[2]=n.al-Se.min.y>me.max.y?Se.min.y-n.al:me.max.y,V),Q=[(me,Se)=>K(me,Se),(me,Se)=>K(Se,me),(me,Se)=>X(me,Se),(me,Se)=>X(Se,me)],ae=(me,Se,De,Ee,We,Ve,He)=>{if(!b)return 0;const Ne=[[Ve?De:me,Ve?me:De,0],[Ve?De:Se,Ve?Se:De,0]],Oe=He<0?n.al+He:He,nt=[Ve?Oe:(me+Se)/2,Ve?(me+Se)/2:Oe,0];return De===0&&He<0||De!==0&&He>0?b.getForTilePoints(We,[nt],!0,Ee):Ne.push(nt),b.getForTilePoints(a,Ne,!0,I),Math.max(Ne[0][2],Ne[1][2],nt[2])/b.exaggeration()};for(let me=0;me<4;me++){const Se=d.borderFeatureIndices[me];if(Se.length===0)continue;const De=n.e9[me](a),Ee=N(De);if(!(Ee&&Ee instanceof n.ea))continue;const We=b?b.findDEMTileFor(De):null;if(!(We&&We.dem||S)||(b&&We&&We.dem&&d.borderDEMTileTimestamp[me]!==We.dem._timestamp&&(d.borderDoneWithNeighborZ[me]=-1,d.borderDEMTileTimestamp[me]=We.dem._timestamp),d.borderDoneWithNeighborZ[me]===Ee.canonical.z))continue;Ee.centroidVertexArray.length===0&&Ee.createCentroidsBuffer();const Ve=(me<2?1:5)-me,He=Ee.borderDoneWithNeighborZ[Ve]!==d.canonical.z,Ne=Ee.borderFeatureIndices[Ve];let Oe=0;if(d.canonical.z!==Ee.canonical.z){for(const nt of Se)d.showCentroid(d.featuresOnBorder[nt]);if(He)for(const nt of Ne)Ee.showCentroid(Ee.featuresOnBorder[nt]);d.borderDoneWithNeighborZ[me]=Ee.canonical.z,Ee.borderDoneWithNeighborZ[Ve]=d.canonical.z}for(const nt of Se){const mt=d.featuresOnBorder[nt],dt=d.centroidData[mt.centroidDataIndex],At=mt.borders[me];let Ct;for(;Oe<Ne.length;){Ct=Ee.featuresOnBorder[Ne[Oe]];const Dt=Ct.borders[Ve];if(Dt[1]>At[0]+3||Dt[0]>At[0]-3)break;Ee.showCentroid(Ct),Oe++}if(Ct&&Oe<Ne.length){const Dt=Oe;let Kt=0;for(;!(Ct.borders[Ve][0]>At[1]-3)&&(Kt++,++Oe!==Ne.length);)Ct=Ee.featuresOnBorder[Ne[Oe]];Ct=Ee.featuresOnBorder[Ne[Dt]];let vt=!1;if(Kt>=1){const Lt=Ct.borders[Ve];Math.abs(At[0]-Lt[0])<3&&Math.abs(At[1]-Lt[1])<3&&(Kt=1,vt=!0,Oe=Dt+1)}else if(Kt===0){d.showCentroid(mt);continue}const rt=Ee.centroidData[Ct.centroidDataIndex];S&&vt&&(((ie=dt).flags|(ge=rt).flags)&n.ec?(ie.flags|=n.ec,ge.flags|=n.ec):(ie.flags&=~n.ec,ge.flags&=~n.ec));const Nt=mt.intersectsCount()>1||Ct.intersectsCount()>1;if(Kt>1)Oe=Dt,dt.centroidXY=rt.centroidXY=new n.P(0,0);else if(We&&We.dem&&!Nt){const Lt=Q[me](dt,rt),li=me%2?n.al-1:0,Mi=ae(Lt[0],Math.min(n.al-1,Lt[1]),li,We,De,me<2,Lt[2]);dt.centroidXY=rt.centroidXY=D(Mi)}else Nt?dt.centroidXY=rt.centroidXY=new n.P(0,0):(dt.centroidXY=d.encodeBorderCentroid(mt),rt.centroidXY=Ee.encodeBorderCentroid(Ct));d.writeCentroidToBuffer(dt),Ee.writeCentroidToBuffer(rt)}else d.showCentroid(mt)}d.borderDoneWithNeighborZ[me]=Ee.canonical.z,Ee.borderDoneWithNeighborZ[Ve]=d.canonical.z}var ie,ge;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const qo=[1,0,0],rp=[0,1,0],Jo=[0,0,1];function gc(h,t,a){const d=a.transform,y=a.shadowRenderer;if(!y)return!0;const b=h.toUnwrapped(),S=d.tileSize*y._cascades[a.currentShadowCascade].scale;let I=t;if(d.elevation){const ie=d.elevation.getMinMaxForTile(h);ie&&(I+=ie.max)}const D=[...y.shadowDirection];D[2]=-D[2];const N=y.computeSimplifiedTileShadowVolume(b,I,S,D);if(!N)return!1;const V=[qo,rp,Jo,D,[D[0],0,D[2]],[0,D[1],D[2]]],K=d.projection.name==="globe",X=d.scaleZoom(S),Q=n.cB.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,X,!K),ae=y.getCurrentCascadeFrustum();return Q.intersectsPrecise(N.vertices,N.planes,V)===0||ae.intersectsPrecise(N.vertices,N.planes,V)===0}function hh(h){const{painter:t,source:a,layer:d,coords:y}=h;let b=h.defines;const S=t.context,I=t.renderPass==="shadow",D=t.renderPass==="light-beam",N=t.shadowRenderer,V=n.ef(t.transform.center.lat,t.transform.zoom),K=ah(t,d.paint.get("building-cutoff-fade-range"));K.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),h.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const X of y){const Q=a.getTile(X),ae=Q.getBucket(d);if(!ae)continue;N&&N.getMaxCascadeForTile(X.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const ie=ae.programConfigurations.get(d.id);let ge,me,Se,De=t.translatePosMatrix(X.expandedProjMatrix,Q,[0,0],"map");if(De=n.cS(n.bC(),De,[1,1,h.verticalScale]),I&&N){if(gc(Q.tileID,ae.maxHeight*V,t))continue;let We=N.calculateShadowPassMatrixFromTile(Q.tileID.toUnwrapped());We=n.cS(n.bC(),We,[1,1,h.verticalScale]),Se=Cn(We),ge=me=t.getOrCreateProgram("buildingDepth",{config:ie,defines:b,overrideFog:!1})}else if(D)ge=me=t.getOrCreateProgram("buildingBloom",{config:ie,defines:b,overrideFog:!1}),Se=An(De);else{const We=t.transform.calculatePosMatrix(X.toUnwrapped(),t.transform.worldSize);n.cS(We,We,[1,1,h.verticalScale]);const Ve=n.bC();n.cS(Ve,We,[1,-1,1/V]),n.bl(Ve,Ve),n.eg(Ve,Ve);const He=t.transform.getFreeCameraOptions().position,Ne=1<<X.canonical.z;if(Se=Xi(De,Ve,h.opacity,h.facadeAOIntensity,[((He.x-X.wrap)*Ne-X.canonical.x)*n.al,(He.y*Ne-X.canonical.y)*n.al,He.z*Ne*n.al],ae.tileToMeter,h.facadeEmissiveChance,h.floodLightColor,h.floodLightIntensity),me=t.getOrCreateProgram("building",{config:ie,defines:b,overrideFog:!1}),h.depthOnly===!0)ge=me;else{const Oe=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);ge=t.getOrCreateProgram("building",{config:ie,defines:Oe,overrideFog:!1})}N&&(N.setupShadowsFromMatrix(We,me,!0),ge!==me&&N.setupShadowsFromMatrix(We,ge,!0))}const Ee=(We,Ve)=>{if(D){const He=We.entranceBloom;Ve.draw(t,S.gl.TRIANGLES,h.depthMode,jn.disabled,h.blendMode,Vn.disabled,Se,d.id,He.layoutVertexBuffer,He.indexBuffer,He.segmentsBucket,d.paint,t.transform.zoom,ie,[He.layoutAttenuationBuffer,He.layoutColorBuffer])}else{const He=We.segmentsBucket;let Ne=[We.layoutNormalBuffer,We.layoutCentroidBuffer,We.layoutColorBuffer,We.layoutFloodLightDataBuffer];We.layoutFacadePaintBuffer&&(Ne=Ne.concat([We.layoutFacadeDataBuffer,We.layoutFacadeVerticalRangeBuffer,We.layoutFacadePaintBuffer])),Ve.draw(t,S.gl.TRIANGLES,h.depthMode,jn.disabled,h.blendMode,I?Vn.disabled:Vn.backCW,Se,d.id,We.layoutVertexBuffer,We.indexBuffer,He,d.paint,t.transform.zoom,ie,Ne)}};t.uploadCommonUniforms(S,me,X.toUnwrapped(),null,K),ae.buildingWithoutFacade&&Ee(ae.buildingWithoutFacade,me),ae.buildingWithFacade&&(ge!==me&&t.uploadCommonUniforms(S,ge,X.toUnwrapped(),null,K),Ee(ae.buildingWithFacade,ge))}}function Qo(h,t,a,d,y,b,S,I,D,N,V,K,X){const Q=h.context.gl,ae=h.depthModeForSublayer(1,yn.ReadOnly,Q.LEQUAL,!0),ie=.1*(1-(ge=V))+3*ge;var ge;const me=h._showOverdrawInspector,Se=K,De=new rf;me||Uu(De,h,t,a,d,ae,new jn({func:Q.ALWAYS,mask:255},255,255,Q.KEEP,Q.KEEP,Q.REPLACE),new hr([Q.ONE,Q.ONE,Q.ONE,Q.ONE],n.ao.transparent,[!1,!1,!1,!0],Q.MIN),Vn.disabled,y,"sdf",b,S,I,D,N,ie,Se,!1);{const Ee=me?jn.disabled:new jn({func:Q.EQUAL,mask:255},255,255,Q.KEEP,Q.DECR,Q.DECR),We=me?h.colorModeForRenderPass():new hr([Q.ONE_MINUS_DST_ALPHA,Q.DST_ALPHA,Q.ONE,Q.ONE],n.ao.transparent,[!0,!0,!0,!0]);Uu(De,h,t,a,d,ae,Ee,We,Vn.disabled,y,"color",b,S,I,D,N,ie,Se,!1)}}function no(h){return[h[0]*n.eh,h[1]*n.eh,h[2]*n.eh,0]}function bu(h,t,a,d,y,b,S,I,D){const N=d.getSource(),V=a.globeSharedBuffers;if(!V)return;let K,X,Q;if(t&&(K=d.getTile(t)),N instanceof n.aU?(X=N.texture,Q=n.dK(0,0,a.transform)):K&&t&&(X=K.texture,Q=n.dK(t.canonical.z,t.canonical.x,a.transform)),!X||!Q)return;h||(Q=n.cS(n.bC(),Q,[1,-1,1]));const ae=a.context,ie=ae.gl,ge=y.paint.get("raster-resampling")==="nearest"?ie.NEAREST:ie.LINEAR,me=a.colorModeForDrapableLayerRenderPass(b),Se=S.defines;Se.push("GLOBE_POLES");const De=new yn(ie.LEQUAL,yn.ReadWrite,a.depthRangeFor3D),Ee=Float32Array.from(a.transform.expandedFarZProjMatrix),We=Float32Array.from(n.bk(n.dJ(new n.cD(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),ae.activeTexture.set(ie.TEXTURE0),X.bind(ge,ie.CLAMP_TO_EDGE),ae.activeTexture.set(ie.TEXTURE1),X.bind(ge,ie.CLAMP_TO_EDGE),"useMipmap"in X&&ae.extTextureFilterAnisotropic&&a.transform.pitch>20&&ie.texParameterf(ie.TEXTURE_2D,ae.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ae.extTextureFilterAnisotropicMax);const[Ve,He,Ne,Oe]=t?V.getPoleBuffers(t.canonical.z,!1):V.getPoleBuffers(0,!0),nt=y.paint.get("raster-elevation");let mt;h?(mt=Ve,a.renderDefaultNorthPole=nt!==0):(mt=He,a.renderDefaultSouthPole=nt!==0);const dt=no(S.mix),At=((Dt,Kt,vt,rt,Nt,Lt,li,Mi,ki,Ei,_i,fn,nn)=>qn(Dt,Kt,vt,new Float32Array(16),new Float32Array(9),[0,0],rt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Lt,[0,0],Mi,2,Ei,_i,fn,1,0,nn))(Ee,We,Q,n.aj(a.transform.zoom),0,y,0,nt,0,dt,S.offset,S.range,b),Ct=a.getOrCreateProgram("raster",{defines:Se});a.uploadCommonUniforms(ae,Ct,null),Ct.draw(a,ie.TRIANGLES,De,D,me,I,At,y.id,mt,Ne,Oe)}function zd(h){const t=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-t,y=.2*h.height,b=t+y;return[t,a,(b-y-t)/d,(b-t)/d]}function Gu(h,t,a,d){if(h)return t instanceof va&&h instanceof Mh?t.getTextureDescriptor(h,a,!0):{texture:h.texture,mix:no(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Ka=n.ei([{name:"a_index",type:"Int16",components:1}]);class dh{constructor(t,a,d,y){const b={width:d[0],height:d[1],data:null},S=t.gl;this.targetColorTexture=new n.T(t,b,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,b,S.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,y),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,y=a.width*a.height;this.particleTexture0=new n.T(this.context,a,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,a,d.RGBA8,{premultiply:!1,useMipmap:!1});const b=new n.ej;b.reserve(y);for(let S=0;S<y;S++)b.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(b,Ka.members,!0),this.particleSegment=n.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function af(h,t,a){if(!h)return null;const d=t.getTextureDescriptor(h,a,!0);if(!d)return null;let{texture:y,mix:b,offset:S,tileSize:I,buffer:D,format:N}=d;if(!y||!N)return null;let V=!1;return N==="uint32"&&(V=!0,b[3]=0,b=Xr(n.ek,b,[0,a.paint.get("raster-particle-max-speed")]),S=Fn(n.ek,S,[0,a.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[D/(I+2*D),I/(I+2*D)],tileSize:I,scalarData:V,scale:b,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function sf(h){const t=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-t,y=.2*h.height,b=t+y;return[t,a,(b-y-t)/d,(b-t)/d]}const Rd=new n.ao(1,0,0,1),Vh=new n.ao(0,1,0,1),Hu=new n.ao(0,0,1,1),Jc=new n.ao(1,0,1,1),Dd=new n.ao(0,1,1,1);function bi(h,t,a,d,y,b){for(let S=0;S<a.length;S++)if(y){const N=new n.ao(d.r*.8,d.g*.8,d.b*.8,1);Gi(h,t,a[S],d,-1,-1,b),Gi(h,t,a[S],d,-1,1,b),Gi(h,t,a[S],d,1,1,b),Gi(h,t,a[S],d,1,-1,b),Gi(h,t,a[S],N,0,0,b)}else Gi(h,t,a[S],d,0,0,b)}function Gi(h,t,a,d,y,b,S){const I=h.context,D=h.transform,N=I.gl,V=D.projection.name==="globe",K=V?["PROJECTION_GLOBE_VIEW"]:[];let X=n.bz(a.projMatrix);if(V&&n.aj(D.zoom)>0){const dt=n.bj(a.canonical,D),At=n.el(dt);X=n.aB(new Float32Array(16),D.globeMatrix,At),n.aB(X,D.projMatrix,X)}const Q=n.bC();Q[12]+=2*y/(n.o.devicePixelRatio*D.width),Q[13]+=2*b/(n.o.devicePixelRatio*D.height),n.aB(X,Q,X);const ae=h.getOrCreateProgram("debug",{defines:K}),ie=t.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(ie,ae);const ge=yn.disabled,me=jn.disabled,Se=h.colorModeForRenderPass(),De="$debug";I.activeTexture.set(N.TEXTURE0),h.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),V?ie._makeGlobeTileDebugBuffers(h.context,D):ie._makeDebugTileBoundsBuffers(h.context,D.projection);const Ee=ie._tileDebugBuffer||h.debugBuffer,We=ie._tileDebugIndexBuffer||h.debugIndexBuffer,Ve=ie._tileDebugSegments||h.debugSegments;if(ae.draw(h,N.LINE_STRIP,ge,me,Se,Vn.disabled,Ln(X,d.toPremultipliedRenderColor(null)),De,Ee,We,Ve,null,null,null,[ie._globeTileDebugBorderBuffer]),S){const dt=ie.latestRawTileData,At=Math.floor((dt&&dt.byteLength||0)/1024);let Ct=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(Ct+=` => ${a.overscaledZ}`),Ct+=` ${ie.state}`,Ct+=` ${At}kb`,(function(Dt,Kt){Dt.initDebugOverlayCanvas();const vt=Dt.debugOverlayCanvas,rt=Dt.context.gl,Nt=Dt.debugOverlayCanvas.getContext("2d");Nt.clearRect(0,0,vt.width,vt.height),Nt.shadowColor="white",Nt.shadowBlur=2,Nt.lineWidth=1.5,Nt.strokeStyle="white",Nt.textBaseline="top",Nt.font="bold 36px Open Sans, sans-serif",Nt.fillText(Kt,5,5),Nt.strokeText(Kt,5,5),Dt.debugOverlayTexture.update(vt),Dt.debugOverlayTexture.bind(rt.LINEAR,rt.CLAMP_TO_EDGE)})(h,Ct)}const He=t.getTile(a).tileSize,Ne=512/Math.min(He,512)*(a.overscaledZ/D.zoom)*.5,Oe=ie._tileDebugTextBuffer||h.debugBuffer,nt=ie._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,mt=ie._tileDebugTextSegments||h.debugSegments;ae.draw(h,N.TRIANGLES,ge,me,hr.alphaBlended,Vn.disabled,Ln(X,n.ao.transparent.toPremultipliedRenderColor(null),Ne),De,Oe,nt,mt,null,null,null,[ie._globeTileDebugTextBuffer])}function _d(h,t,a,d){bt(h,0,t+a/2,h.transform.width,a,d)}function da(h,t,a,d){bt(h,t-a/2,0,a,h.transform.height,d)}function bt(h,t,a,d,y,b){const S=h.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(t*n.o.devicePixelRatio,a*n.o.devicePixelRatio,d*n.o.devicePixelRatio,y*n.o.devicePixelRatio),S.clear({color:b}),I.disable(I.SCISSOR_TEST)}const dm=n.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Uh}=dm;function yc(h,t,a,d){h.emplaceBack(t,a,d)}class Pd{constructor(t){this.vertexArray=new n.em,this.indices=new n.b0,yc(this.vertexArray,-1,-1,1),yc(this.vertexArray,1,-1,1),yc(this.vertexArray,-1,1,1),yc(this.vertexArray,1,1,1),yc(this.vertexArray,-1,-1,-1),yc(this.vertexArray,1,-1,-1),yc(this.vertexArray,-1,1,-1),yc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Uh),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.bg.simpleSegment(0,0,36,12)}}function gd(h,t,a,d,y,b){const S=h.context.gl,I=t.paint.get("sky-atmosphere-color"),D=t.paint.get("sky-atmosphere-halo-color"),N=t.paint.get("sky-atmosphere-sun-intensity"),V=((K,X,Q,ae,ie)=>({u_matrix_3f:K,u_sun_direction:X,u_sun_intensity:Q,u_color_tint_r:[ae.r,ae.g,ae.b,ae.a],u_color_tint_m:[ie.r,ie.g,ie.b,ie.a],u_luminance:5e-5}))(n.eo(n.dO(),d),y,N,I.toPremultipliedRenderColor(null),D.toPremultipliedRenderColor(null));S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,t.skyboxTexture,0),a.draw(h,S.TRIANGLES,yn.disabled,jn.disabled,hr.unblended,Vn.frontCW,V,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const fm=n.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Pf{constructor(t){const a=new n.ep;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new n.b0;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,fm.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=n.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Om=n.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class u_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class pm{constructor(t){this.colorModeAlphaBlendedWriteRGB=new hr([1,zo,1,zo],n.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new hr([1,0,1,0],n.ao.transparent,[!1,!1,!1,!0]),this.params=new u_,this.updateNeeded=!0}update(t){const a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Pf(a);const d=this.params.sizeRange,y=this.params.intensityRange,b=(function(V){const K=n.eq(30),X=[];for(let Q=0;Q<V;++Q){const ae=2*Math.PI*K(),ie=Math.acos(1-2*K())-.5*Math.PI;X.push(n.d5(Math.cos(ie)*Math.cos(ae),Math.cos(ie)*Math.sin(ae),Math.sin(ie)))}return X})(this.params.starsCount),S=n.eq(300),I=new n.er,D=new n.b0;let N=0;for(let V=0;V<b.length;++V){const K=n.c5([],b[V],200),X=Math.max(0,1+.01*d*(1*S()-.5)),Q=Math.max(0,1+.01*y*(1*S()-.5));I.emplaceBack(K[0],K[1],K[2],-1,-1,X,Q),I.emplaceBack(K[0],K[1],K[2],1,-1,X,Q),I.emplaceBack(K[0],K[1],K[2],1,1,X,Q),I.emplaceBack(K[0],K[1],K[2],-1,1,X,Q),D.emplaceBack(N+0,N+1,N+2),D.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=a.createVertexBuffer(I,Om.members),this.starsIdx=a.createIndexBuffer(D),this.starsSegments=n.bg.simpleSegment(0,0,I.length,D.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){const d=t.context,y=d.gl,b=t.transform,S=new yn(y.LEQUAL,yn.ReadOnly,[0,1]),I=n.aj(b.zoom),D=t.style.getLut(a.scope),N=a.properties.get("color-use-theme")==="none",V=a.properties.get("color").toNonPremultipliedRenderColor(N?null:D),K=a.properties.get("high-color-use-theme")==="none",X=a.properties.get("high-color").toNonPremultipliedRenderColor(K?null:D),Q=a.properties.get("space-color-use-theme")==="none",ae=a.properties.get("space-color").toNonPremultipliedRenderColor(Q?null:D),ie=5e-4,ge=n.es(a.properties.get("horizon-blend"),0,1,ie,.25),me=n.dE(t,d,b)&&ge===ie?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,Se=t.frameCounter/1e3%1,De=n.ag(b.globeCenterInViewSpace),Ee=Math.sqrt(Math.pow(De,2)-Math.pow(me,2)),We=Math.acos(Ee/De),Ve=He=>{const Ne=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];He&&Ne.push("ALPHA_PASS");const Oe=t.getOrCreateProgram("globeAtmosphere",{defines:Ne}),nt=((dt,At,Ct,Dt,Kt,vt,rt,Nt,Lt,li,Mi,ki)=>({u_frustum_tl:dt,u_frustum_tr:At,u_frustum_br:Ct,u_frustum_bl:Dt,u_horizon:Kt,u_transition:vt,u_fadeout_range:rt,u_atmosphere_fog_color:Nt.toArray01(),u_high_color:Lt.toArray01(),u_space_color:li.toArray01(),u_temporal_offset:Mi,u_horizon_angle:ki}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,I,ge,V,X,ae,Se,We);t.uploadCommonUniforms(d,Oe);const mt=this.atmosphereBuffer;mt&&Oe.draw(t,y.TRIANGLES,S,jn.disabled,He?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Vn.backCW,nt,He?"atmosphere_glow_alpha":"atmosphere_glow",mt.vertexBuffer,mt.indexBuffer,mt.segments)};Ve(!1),Ve(!0)}drawStars(t,a){const d=n.aA(a.properties.get("star-intensity"),0,1);if(d===0)return;const y=t.context,b=y.gl,S=t.transform,I=t.getOrCreateProgram("stars"),D=n.c7([]);n.c9(D,D,-S._pitch),n.c8(D,D,-S.angle),n.c9(D,D,n.an(S._center.lat)),n.et(D,D,-n.an(S._center.lng));const N=n.cc(new Float32Array(16),D),V=n.aB([],S.starsProjMatrix,N),K=n.eo([],N),X=n.eu([],K),Q=[0,1,0];n.dQ(Q,Q,X),n.c5(Q,Q,this.params.sizeMultiplier);const ae=[1,0,0];n.dQ(ae,ae,X),n.c5(ae,ae,this.params.sizeMultiplier);const ie=(ge=Q,me=ae,Se=d,{u_matrix:Float32Array.from(V),u_up:ge,u_right:me,u_intensity_multiplier:Se});var ge,me,Se;t.uploadCommonUniforms(y,I),this.starsVx&&this.starsIdx&&I.draw(t,b.TRIANGLES,yn.disabled,jn.disabled,this.colorModeAlphaBlendedWriteRGB,Vn.disabled,ie,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Pp{constructor(){this.visibleTiles=[]}updateBorders(t,a){const d=[],y=[],b=t._getRenderableCoordinates(!1,!0);for(const D of b){const N=t.getTile(D);if(!N.hasData())continue;const V=N.getBucket(a);V&&(V.isEmpty()||(d.push(D.key),y.push({bucket:V,tileID:D.canonical})))}let S=d.length!==this.visibleTiles.length;if(!S){d.sort();for(let D=0;D<d.length;D++)if(d[D]!==this.visibleTiles[D]){S=!0;break}}if(!S)return;const I=new Set;this.visibleTiles=d,y.sort(((D,N)=>D.tileID.z-N.tileID.z||D.tileID.x-N.tileID.x||D.tileID.y-N.tileID.y));for(const D of y){const N=new Array,V=new Array,K=D.bucket;for(const X of K.featuresOnBorder)I.has(X.featureId)?V.push(X.footprintIndex):(I.add(X.featureId),N.push(X.footprintIndex));K.updateFootprintHiddenFlags(N,n.ev,!1),K.updateFootprintHiddenFlags(V,n.ev,!0)}}}function Gh(h,t){const a=[...h],d=t.cameraWorldSizeForFog/t.worldSize,y=n.bA([]);return n.cS(y,y,[d,d,1]),n.aB(a,y,a),n.aB(a,t.worldToFogMatrix,a),a}function ap(h,t,a,d,y){const b=a.material,S=d.context,{baseColorTexture:I,metallicRoughnessTexture:D}=b.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:V,emissionTexture:K}=b;function X(ae,ie,ge){if(ae&&(h.push(ie),S.activeTexture.set(S.gl.TEXTURE0+ge),ae.gfxTexture)){const{minFilter:me,magFilter:Se,wrapS:De,wrapT:Ee}=ae.sampler;ae.gfxTexture.bindExtraParam(me,Se,De,Ee)}}X(I,"HAS_TEXTURE_u_baseColorTexture",_s.BaseColor),X(D,"HAS_TEXTURE_u_metallicRoughnessTexture",_s.MetallicRoughness),X(N,"HAS_TEXTURE_u_normalTexture",_s.Normal),X(V,"HAS_TEXTURE_u_occlusionTexture",_s.Occlusion),X(K,"HAS_TEXTURE_u_emissionTexture",_s.Emission),y&&(y.texture||(y.texture=new n.d$(d.context,y.image,[y.image.height,y.image.height,y.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+_s.LUT),y.texture&&y.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(h.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||h.push("DIFFUSE_SHADED");const Q=d.shadowRenderer;Q&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&h.push("NORMAL_OFFSET"))}function of(h,t,a,d,y,b){const S=h.modelOpacity,I=t.context,D=new yn(t.context.gl.LEQUAL,h.isLightMesh?yn.ReadOnly:yn.ReadWrite,t.depthRangeFor3D),N=t.transform,V=h.mesh,K=V.material,X=K.pbrMetallicRoughness,Q=t.style.fog;let ae;ae=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:n.aB([],d.zScaleMatrix,h.nodeModelMatrix),n.aB(ae,d.negCameraPosMatrix,ae);const ie=n.bl([],ae);n.eg(ie,ie);const ge=a.paint.get("model-color-use-theme").constantOr("default")==="none",me=a.paint.get("model-emissive-strength").constantOr(0),Se=ks(new Float32Array(h.worldViewProjection),new Float32Array(ae),new Float32Array(ie),null,t,S,X.baseColorFactor,K.emissiveFactor,X.metallicFactor,X.roughnessFactor,K,me,a,void 0,void 0,h.materialOverride,h.modelColor),De={defines:[]},Ee=[],We=t.shadowRenderer;We&&(We.useNormalOffset=!1),ap(De.defines,Ee,V,t,ge?null:a.lut);let Ve=null;if(Q){const Oe=Gh(h.nodeModelMatrix,t.transform);if(Ve=new Float32Array(Oe),N.projection.name!=="globe"){const nt=V.aabb.min,mt=V.aabb.max,[dt,At]=Q.getOpacityForBounds(Oe,nt[0],nt[1],mt[0],mt[1]);De.overrideFog=dt>=Gt||At>=Gt}}const He=ah(t,a.paint.get("model-cutoff-fade-range"));He.shouldRenderCutoff&&De.defines.push("RENDER_CUTOFF");const Ne=t.getOrCreateProgram("model",De);t.uploadCommonUniforms(I,Ne,null,Ve,He),t.renderPass!=="shadow"&&We&&We.setupShadowsFromMatrix(h.nodeModelMatrix,Ne),Ne.draw(t,I.gl.TRIANGLES,D,y,b,V.material.doubleSided?Vn.disabled:Vn.backCCW,Se,a.id,V.vertexBuffer,V.indexBuffer,V.segments,a.paint,t.transform.zoom,void 0,Ee)}function qu(h,t){return h.style._importedAsBasemap?"basemap":t.scope}function lf(h,t,a,d,y,b,S,I,D,N){const V=h.transform,K=!!t.isGeometryBloom&&t.isGeometryBloom;if(K&&h.renderPass==="shadow")return;const X=V.projection.name==="globe"?n.eD(a,V):[...a];n.aB(X,X,t.globalMatrix);const Q=n.aB([],d,X);if(t.meshes)for(const ae of t.meshes){const ie=I.get(ae.material.name);if(ie&&ie.opacity<=0)continue;if(ae.material.alphaMode!=="BLEND"){S.push({mesh:ae,depth:0,modelIndex:y,worldViewProjection:Q,nodeModelMatrix:X,isLightMesh:K,materialOverride:ie,modelOpacity:D,modelColor:N});continue}const ge=n.af([],ae.centroid,Q);!V.isOrthographic&&ge[2]<=0||b.push({mesh:ae,depth:ge[2],modelIndex:y,worldViewProjection:Q,nodeModelMatrix:X,isLightMesh:K,materialOverride:ie,modelOpacity:D,modelColor:N})}if(t.children)for(const ae of t.children)lf(h,ae,a,d,y,b,S,I,D,N)}function vc(h,t,a,d){const y=a.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),S=y.getShadowPassColorMode(),I=y.calculateShadowPassMatrixFromMatrix(t),D=Ro(I);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,b,jn.disabled,S,Vn.disabled,D,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,a.transform.zoom,void 0,void 0)}function Lp(h,t,a,d,y,b){for(const S of y){const I=Object.assign({},d);I.part=S;const D={type:"Unknown",id:t,properties:I},N={orientation:h.paint.get("model-rotation").evaluate(D,a)};b.set(S,N)}}function sp(h,t,a,d,y,b){for(const S of y){const I=Object.assign({},d);I.part=S;const D={type:"Unknown",id:t,properties:I},N={color:h.paint.get("model-color").evaluate(D,a),colorMix:h.paint.get("model-color-mix-intensity").evaluate(D,a),opacity:h.paint.get("model-opacity").evaluate(D,a),emissionStrength:h.paint.get("model-emissive-strength").evaluate(D,a)};b.set(S,N)}}function mm(h,t,a,d,y){let b=!1;for(const I of d)I.modelOpacity!==1&&(of(I,h,t,y[I.modelIndex],jn.disabled,hr.disabled),b=!0);for(const I of d)of(I,h,t,y[I.modelIndex],I.modelOpacity!==1?h.stencilModeFor3D():jn.disabled,h.colorModeForRenderPass());b&&h.resetStencilClippingMasks();const S=hr.additive;for(const I of a)of(I,h,t,y[I.modelIndex],jn.disabled,I.isLightMesh?S:h.colorModeForRenderPass())}function _m(h,t,a){const d=t.updateZoomBasedPaintProperties(),y=(function(b,S,I){let D,N,V,K=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&K>0){const X=b.terrain,Q=X.findDEMTileFor(I);Q&&Q.dem?D=n.eF.create(X,I,Q):K=0}if(K===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),K===S.validForExaggeration&&(K===0||D&&D._demTile&&D._demTile.tileID===S.validForDEMTile.id&&D._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const X in S.instancesPerModel){const Q=S.instancesPerModel[X];for(let ae=0;ae<Q.instancedDataArray.length;++ae){const ie=(D?K*D.getElevationAt(0|Q.instancedDataArray.float32[16*ae],0|Q.instancedDataArray.float32[16*ae+1],!0,!0):0)+Q.instancesEvaluatedElevation[ae];Q.instancedDataArray.float32[16*ae+6]=ie,N=N?Math.min(S.terrainElevationMin,ie):ie,V=V?Math.max(S.terrainElevationMax,ie):ie}}return S.terrainElevationMin=N||0,S.terrainElevationMax=V||0,S.validForExaggeration=K,S.validForDEMTile=D&&D._demTile?{id:D._demTile.tileID,timestamp:D._dem._timestamp}:{id:void 0,timestamp:0},!0})(h,t,a);(d||y)&&(t.uploaded=!1,t.upload(h.context))}const Hh={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.d9([0,0,0],[n.al,n.al,0])};function Ks(h,t){const a=1<<h.canonical.z,d=t.getFreeCameraOptions().position,y=t.elevation,b=h.canonical.x/a,S=(h.canonical.x+1)/a,I=h.canonical.y/a,D=(h.canonical.y+1)/a;let N=t._centerAltitude;if(y){const Q=y.getMinMaxForTile(h);Q&&Q.max>N&&(N=Q.max)}const V=n.aA(d.x,b,S)-d.x,K=n.aA(d.y,I,D)-d.y,X=n.cf(N,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(V*V+K*K+X*X))}function Ld(h,t,a,d,y,b,S){const I=h.context,D=h.renderPass==="shadow",N=h.shadowRenderer,V=D&&N?N.getShadowPassDepthMode():new yn(I.gl.LEQUAL,yn.ReadWrite,h.depthRangeFor3D),K=h.isTileAffectedByFog(b),X=h.transform.projection.name==="globe";if(a.meshes)for(const Q of a.meshes){const ae=X?[]:["MODEL_POSITION_ON_GPU"],ie=[];let ge,me,Se;const De=!X&&d.instancedDataArray.length>20;De&&ae.push("INSTANCED_ARRAYS");const Ee=ah(h,t.paint.get("model-cutoff-fade-range"));if(Ee.shouldRenderCutoff&&ae.push("RENDER_CUTOFF"),D&&N)ge=h.getOrCreateProgram("modelDepth",{defines:ae}),me=Ro(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(a.globalMatrix)),Se=N.getShadowPassColorMode();else{ap(ae,ie,Q,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),ge=h.getOrCreateProgram("model",{defines:ae,overrideFog:K});const Ve=Q.material,He=Ve.pbrMetallicRoughness,Ne=t.paint.get("model-opacity").constantOr(1),Oe=t.paint.get("model-emissive-strength").constantOr(0);me=ks(b.expandedProjMatrix,Float32Array.from(a.globalMatrix),new Float32Array(16),null,h,Ne,He.baseColorFactor,Ve.emissiveFactor,He.metallicFactor,He.roughnessFactor,Ve,Oe,t,y),N&&(S.shadowUniformsInitialized?ge.setShadowUniformValues(I,N.getShadowUniformValues()):(N.setupShadows(b.toUnwrapped(),ge,"model-tile"),S.shadowUniformsInitialized=!0)),Se=Ee.shouldRenderCutoff||Ne<1||Ve.alphaMode!=="OPAQUE"?hr.alphaBlended:hr.unblended}h.uploadCommonUniforms(I,ge,b.toUnwrapped(),null,Ee);const We=Q.material.doubleSided?Vn.disabled:Vn.backCCW;if(De)ie.push(d.instancedDataBuffer),ge.draw(h,I.gl.TRIANGLES,V,jn.disabled,Se,We,me,t.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,t.paint,h.transform.zoom,void 0,ie,d.instancedDataArray.length);else{const Ve=D?"u_instance":"u_normal_matrix";for(let He=0;He<d.instancedDataArray.length;++He)me[Ve]=new Float32Array(d.instancedDataArray.arrayBuffer,64*He,16),ge.draw(h,I.gl.TRIANGLES,V,jn.disabled,Se,We,me,t.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,t.paint,h.transform.zoom,void 0,ie)}}if(a.children)for(const Q of a.children)Ld(h,t,Q,d,y,b,S)}const cf=[1,-1,1];function Bm(h,t,a,d){if(!a.modelManager)return!0;const y=a.modelManager;if(!a.shadowRenderer)return!0;const b=a.shadowRenderer,S=t.aabb;let I=!0,D=h.maxHeight;if(D===0){let V=0;for(const K in h.instancesPerModel){const X=y.getModel(K,d);X?V=Math.max(V,Math.max(Math.max(X.aabb.max[0],X.aabb.max[1]),X.aabb.max[2])):I=!1}D=h.maxScale*V*1.41+h.maxVerticalOffset,I&&(h.maxHeight=D)}S.max[2]=D,S.min[2]+=h.terrainElevationMin,S.max[2]+=h.terrainElevationMax,n.af(S.min,S.min,t.tileMatrix),n.af(S.max,S.max,t.tileMatrix);const N=S.intersects(b.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=N===2),N===0}function Ja(h,t){const a=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],y=h.uniformValues.u_cutoff_params[2],b=h.uniformValues.u_cutoff_params[3];return d===a||b===y?1:n.aA(((t-a)/(d-a)-y)/(b-y),0,1)}function Yr(h,t,a,d){if(t.pitch<20)return 1;const y=t.getWorldToCameraMatrix();n.aB(y,y,h);const b=n.bU(a.min[0],a.min[1],a.min[2],1);let S=n.aC(n.eG(),b,y),I=S,D=S;b[1]=a.max[1],S=n.aC(n.eG(),b,y),I=S[1]<I[1]?S:I,D=S[1]>D[1]?S:D,b[0]=a.max[0],S=n.aC(n.eG(),b,y),I=S[1]<I[1]?S:I,D=S[1]>D[1]?S:D,b[1]=a.min[1],S=n.aC(n.eG(),b,y),I=S[1]<I[1]?S:I,D=S[1]>D[1]?S:D;const N=n.aA(d[0],0,1),V=100*t.pixelsPerMeter*n.aA(d[1],0,1),K=n.aA(d[2],0,1),X=n.eH(n.eG(),I,D,N),Q=Math.tan(.5*t.fovX),ae=-X[2]*Q;if(V===0)return X[1]<-Math.abs(ae)?K:1;const ie=(-Math.abs(ae)-X[1])/V,ge=(Se,De,Ee)=>(1-Ee)*Se+Ee*De,me=n.aA(ge(1,K,ie),K,1);return ge(1,me,n.aA((t.pitch-20)/20,0,1))}class op{}class uf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,d){{const K=this._storage.get(a.id);if(K)return K.lastUsedFrameIdx=t,K.buf}const y=d.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),S=new ArrayBuffer(b),I=new Int16Array(S);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const D=new n.eJ;for(let K=0;K<b/2;K+=3){const X=I[K],Q=I[K+1],ae=I[K+2];D.emplaceBack(X,Q),D.emplaceBack(Q,ae),D.emplaceBack(ae,X)}const N=d.bindVertexArrayOES.current,V=new op;return V.buf=new Bl(d,D),V.lastUsedFrameIdx=t,this._storage.set(a.id,V),d.bindVertexArrayOES.set(N),V.buf}update(t){for(const[a,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(a))}destroy(){for(const[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class kd{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const hf=n.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class qh{constructor(t){this.revealStart=11,this.revealRange=2}}const kp=n.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class lp{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,a){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new n.eK,I=new n.b0;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(S,kp.members),this.vignetteIdx=t.context.createIndexBuffer(I)}const y=n.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const S={u_vignetteShape:(b={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,yn.disabled,jn.disabled,hr.alphaBlended,Vn.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class Fp{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,a){const d=t.getFreeCameraOptions().position,y=d.toAltitude(),b=d.toLngLat(),S=n.an(b.lng),I=n.an(b.lat),D=t.pixelsPerMeter/a,N=S*n.eM,V=n.eM*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const K=-this._offsetYPrev+V,X=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*D,this._accumulatedOffsetY+=K*D,this._accumulatedElevation+=X*D,this._offsetXPrev=N,this._offsetYPrev=V,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function cp(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function xc(h){const t=n.eq(1323123451230),a=[];for(let d=0;d<h;++d){const y=2*t()-1,b=2*t()-1,S=2*t()-1;a.push(n.d5(y,b,S))}return a}function xo(h,t,a,d,y){const b=n.aA((y-a)/(d-a),0,1);return(1-b)*h+b*t}class fh{constructor(t){this._movement=new Fp,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new lp,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,a){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const y=d.starsProjMatrix,b=n.c7([]);n.c9(b,b,n.an(90)-d._pitch),n.c8(b,b,-d.angle);const S=n.cc(new Float32Array(16),b),I=n.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),D=n.eg([],I),N=n.aB([],D,S),V=Date.now()/1e3;return this._accumulatedTimeFromStart+=(V-this._prevTime)*a,this._prevTime=V,{projectionMatrix:y,modelviewMatrix:N}}}class df extends fh{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new qh("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const d=xc(this.particlesCount),y=new n.eN,b=new n.b0;let S=0;const I=n.eq(1323123451230);for(let D=0;D<d.length;++D){const N=d[D],V=[2*I()-1,I(),I(),I()];y.emplaceBack(N[0],N[1],N[2],-1,-1,...V),y.emplaceBack(N[0],N[1],N[2],1,-1,...V),y.emplaceBack(N[0],N[1],N[2],1,1,...V),y.emplaceBack(N[0],N[1],N[2],-1,1,...V),b.emplaceBack(S+0,S+1,S+2),b.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=a.createVertexBuffer(y,hf.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(a.revealStart>d)return;const y=xo(0,1,a.revealStart,a.revealStart+a.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let S=[-b.direction.x,b.direction.y,-100];n.aw(S,S);const I=structuredClone(this._vignetteParams);I.strength*=y,b.overrideStyleParameters||(b.intensity=t.style.rain.state.density,b.timeFactor=t.style.rain.state.intensity,b.color=structuredClone(t.style.rain.state.color),S=structuredClone(t.style.rain.state.direction),b.screenThinning.intensity=t.style.rain.state.centerThinning,b.dropletSizeX=t.style.rain.state.dropletSize[0],b.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],b.distortionStrength=100*t.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(t.style.rain.state.vignetteColor));const D=this.updateOnRender(t,b.timeFactor),N=t.context,V=N.gl,K=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new n.T(N,{width:t.width,height:t.height,data:null},V.RGBA8)),b.distortionStrength>0&&(N.activeTexture.set(V.TEXTURE0),this.screenTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),V.copyTexSubImage2D(V.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const X=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(N,X),N.activeTexture.set(V.TEXTURE0),this.screenTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const Q=[b.color.r,b.color.g,b.color.b,b.color.a],ae=(ie,ge)=>{const me=cp(this._movement.getPosition(),ie),Se=b.dropletSizeX,De=b.dropletSizeX*b.dropletSizeYScale,Ee=t.width/2,We=t.height/2,Ve=xo(0,b.screenThinning.start,0,1,b.screenThinning.intensity),He=xo(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Ne=xo(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Oe=(nt={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:me,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:ie,rainDropletSize:[Se,De],distortionStrength:b.distortionStrength,rainDirection:S,color:Q,screenSize:[K.width,K.height],thinningCenterPos:[Ee,We],thinningShape:[Ve,He,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Ne,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:ge?0:1},{u_modelview:Float32Array.from(nt.modelview),u_projection:Float32Array.from(nt.projection),u_time:nt.time,u_cam_pos:nt.camPos,u_texScreen:0,u_velocityConeAperture:nt.velocityConeAperture,u_velocity:nt.velocity,u_boxSize:nt.boxSize,u_rainDropletSize:nt.rainDropletSize,u_distortionStrength:nt.distortionStrength,u_rainDirection:nt.rainDirection,u_color:nt.color,u_screenSize:nt.screenSize,u_thinningCenterPos:nt.thinningCenterPos,u_thinningShape:nt.thinningShape,u_thinningAffectedRatio:nt.thinningAffectedRatio,u_thinningParticleOffset:nt.thinningParticleOffset,u_shapeDirectionalPower:nt.shapeDirectionalPower,u_shapeNormalPower:nt.shapeNormalPower,u_mode:nt.mode});var nt;const mt=Math.round(b.intensity*this.particlesCount),dt=n.bg.simpleSegment(0,0,4*mt,2*mt);X.draw(t,V.TRIANGLES,yn.disabled,jn.disabled,hr.alphaBlended,Vn.disabled,Oe,"rain_particles",this.particlesVx,this.particlesIdx,dt)};b.distortionStrength>0&&ae(b.boxSize,!0),ae(b.boxSize,!1),this._vignette.draw(t,I)}}const up=n.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Op extends fh{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new qh("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const d=xc(this.particlesCount),y=new n.eO,b=new n.b0;let S=0;const I=n.eq(1323123451230);for(let D=0;D<d.length;++D){const N=d[D],V=I(),K=I(),X=I(),Q=[D/d.length,V,K,X],ae=[I(),I()];y.emplaceBack(N[0],N[1],N[2],-1,-1,...Q,...ae),y.emplaceBack(N[0],N[1],N[2],1,-1,...Q,...ae),y.emplaceBack(N[0],N[1],N[2],1,1,...Q,...ae),y.emplaceBack(N[0],N[1],N[2],-1,1,...Q,...ae),b.emplaceBack(S+0,S+1,S+2),b.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=a.createVertexBuffer(y,up.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const a=structuredClone(this._params);let d=[-a.direction.x,a.direction.y,-100];n.aw(d,d);const y=structuredClone(this._vignetteParams),b=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=t.transform.zoom;if(b.revealStart>S)return;const I=xo(0,1,b.revealStart,b.revealStart+b.revealRange,S);y.strength*=I,a.overrideStyleParameters||(a.intensity=t.style.snow.state.density,a.timeFactor=t.style.snow.state.intensity,a.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),a.screenThinning.intensity=t.style.snow.state.centerThinning,a.billboardSize=2.79*t.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(t.style.snow.state.vignetteColor));const D=this.updateOnRender(t,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const N=t.context,V=N.gl,K=t.transform,X=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(N,X),((Q,ae,ie)=>{const ge=cp(this._movement.getPosition(),Q),me=K.width/2,Se=K.height/2,De=xo(0,ie.screenThinning.start,0,1,ie.screenThinning.intensity),Ee=xo(.001,ie.screenThinning.range,0,1,ie.screenThinning.intensity),We=xo(0,ie.screenThinning.particleOffset,0,1,ie.screenThinning.intensity),Ve=(He={modelview:D.modelviewMatrix,projection:D.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ge,velocityConeAperture:ie.velocityConeAperture,velocity:ie.velocity,horizontalOscillationRadius:ie.horizontalOscillationRadius,horizontalOscillationRate:ie.horizontalOscillationRate,boxSize:Q,billboardSize:1*ie.billboardSize,simpleShapeParameters:[ie.shapeFadeStart,ie.shapeFadePower],screenSize:[K.width,K.height],thinningCenterPos:[me,Se],thinningShape:[De,Ee,Math.pow(10,ie.screenThinning.fadePower)],thinningAffectedRatio:ie.screenThinning.affectedRatio,thinningParticleOffset:We,color:[ie.color.r,ie.color.g,ie.color.b,ie.color.a],direction:d},{u_modelview:Float32Array.from(He.modelview),u_projection:Float32Array.from(He.projection),u_time:He.time,u_cam_pos:He.camPos,u_velocityConeAperture:He.velocityConeAperture,u_velocity:He.velocity,u_horizontalOscillationRadius:He.horizontalOscillationRadius,u_horizontalOscillationRate:He.horizontalOscillationRate,u_boxSize:He.boxSize,u_billboardSize:He.billboardSize,u_simpleShapeParameters:He.simpleShapeParameters,u_screenSize:He.screenSize,u_thinningCenterPos:He.thinningCenterPos,u_thinningShape:He.thinningShape,u_thinningAffectedRatio:He.thinningAffectedRatio,u_thinningParticleOffset:He.thinningParticleOffset,u_particleColor:He.color,u_direction:He.direction});var He;const Ne=Math.round(ie.intensity*this.particlesCount),Oe=n.bg.simpleSegment(0,0,4*Ne,2*Ne);this.particlesVx&&this.particlesIdx&&X.draw(t,V.TRIANGLES,yn.disabled,jn.disabled,hr.alphaBlended,Vn.disabled,Ve,"snow_particles",this.particlesVx,this.particlesIdx,Oe)})(a.boxSize,0,a),this._vignette.draw(t,y)}}const Fd={symbol:function(h,t,a,d,y){if(h.renderPass!=="translucent")return;const b=jn.disabled,S=h.colorModeForRenderPass(),I=a.layout.get("text-variable-anchor"),D=a.layout.get("text-size-scale-range"),N=n.aA(h.scaleFactor,D[0],D[1]);I&&(function(X,Q,ae,ie,ge,me,Se,De){const Ee=Q.transform,We=ge==="map",Ve=me==="map";for(const He of X){const Ne=ie.getTile(He),Oe=Ne.getBucket(ae);if(!Oe||!Oe.text||!Oe.text.segments.get().length)continue;const nt=n.bK(Oe.textSizeData,Ee.zoom,De),mt=zl(He,Oe.getProjection(),Ee),dt=Ee.calculatePixelsToTileUnitsMatrix(Ne),At=Rl(mt,Ne.tileID.canonical,Ve,We,Ee,Oe.getProjection(),dt),Ct=Oe.hasIconTextFit()&&Oe.hasIconData();nt&&pn(Oe,We,Ve,Se,Ee,At,He,Math.pow(2,Ee.zoom-Ne.tileID.overscaledZ),nt,Ct)}})(d,h,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),y,N);const V=a.paint.get("icon-opacity").constantOr(1)!==0,K=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(V||K)?vo(h,t,a,d,b,S):(V&&vo(h,t,a,d,b,S,{onlyIcons:!0}),K&&vo(h,t,a,d,b,S,{onlyText:!0})),t.map.showCollisionBoxes&&(hi(h,t,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),hi(h,t,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,a,d){if(h.renderPass!=="translucent")return;const y=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),S=a.paint.get("circle-stroke-opacity"),I=a.layout.get("circle-sort-key").constantOr(1)!==void 0,D=a.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||S.constantOr(1)===0))return;const N=h.context,V=N.gl,K=h.transform,X=!(!h.terrain||!h.terrain.enabled),Q=a.layout.get("circle-elevation-reference"),ae=h.depthModeForSublayer(0,yn.ReadOnly),ie=new yn(h.context.gl.LEQUAL,yn.ReadOnly,h.depthRangeFor3D),ge=Q==="none"||X?ae:ie,me=jn.disabled,Se=h.colorModeForDrapableLayerRenderPass(D),De=K.projection.name==="globe",Ee=[n.aF(K.center.lng),n.aJ(K.center.lat)],We=[];for(let He=0;He<d.length;He++){const Ne=d[He],Oe=t.getTile(Ne),nt=Oe.getBucket(a);if(!nt||nt.projection.name!==K.projection.name)continue;const mt=nt.programConfigurations.get(a.id),dt=nt.layoutVertexBuffer,At=nt.globeExtVertexBuffer,Ct=nt.indexBuffer,Dt=n.e0(a),Kt=[At],vt=h.isTileAffectedByFog(Ne);De&&Dt.push("PROJECTION_GLOBE_VIEW"),Dt.push("DEPTH_D24"),h.terrain&&K.depthOcclusionForSymbolsAndCircles&&Dt.push("DEPTH_OCCLUSION"),nt.hasElevation&&!h.terrain&&(Dt.push("ELEVATED_ROADS"),Kt.push(nt.elevatedLayoutVertexBuffer));const rt=h.getOrCreateProgram("circle",{config:mt,defines:Dt,overrideFog:vt}),Nt=K.projection.createInversionMatrix(K,Ne.canonical),Lt={programConfiguration:mt,program:rt,layoutVertexBuffer:dt,dynamicBuffers:Kt,indexBuffer:Ct,uniformValues:n.e1(h,Ne,Oe,Nt,Ee,a),tile:Oe};if(I){const li=nt.segments.get();for(const Mi of li)We.push({segments:new n.bg([Mi]),sortKey:Mi.sortKey,state:Lt})}else We.push({segments:nt.segments,sortKey:0,state:Lt})}I&&We.sort(((He,Ne)=>He.sortKey-Ne.sortKey));const Ve={useDepthForOcclusion:K.depthOcclusionForSymbolsAndCircles};for(const He of We){const{programConfiguration:Ne,program:Oe,layoutVertexBuffer:nt,dynamicBuffers:mt,indexBuffer:dt,uniformValues:At,tile:Ct}=He.state,Dt=He.segments;h.terrain&&h.terrain.setupElevationDraw(Ct,Oe,Ve),h.uploadCommonUniforms(N,Oe,Ct.tileID.toUnwrapped()),Oe.draw(h,V.TRIANGLES,ge,me,Se,Vn.disabled,At,a.id,nt,dt,Dt,a.paint,K.zoom,Ne,mt)}},heatmap:function(h,t,a,d){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const y=h.context,b=y.gl,S=jn.disabled,I=new hr([b.ONE,b.ONE,b.ONE,b.ONE],n.ao.transparent,[!0,!0,!0,!0]);(function(Q,ae,ie,ge){const me=Q.gl,Se=ae.width*ge,De=ae.height*ge;Q.activeTexture.set(me.TEXTURE1),Q.viewport.set([0,0,Se,De]);let Ee=ie.heatmapFbo;if(!Ee||Ee&&(Ee.width!==Se||Ee.height!==De)){Ee&&Ee.destroy();const We=me.createTexture();me.bindTexture(me.TEXTURE_2D,We),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_S,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_WRAP_T,me.CLAMP_TO_EDGE),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MIN_FILTER,me.LINEAR),me.texParameteri(me.TEXTURE_2D,me.TEXTURE_MAG_FILTER,me.LINEAR),Ee=ie.heatmapFbo=Q.createFramebuffer(Se,De,1,null),(function(Ve,He,Ne,Oe,nt,mt){const dt=Ve.gl;dt.texImage2D(dt.TEXTURE_2D,0,Ve.extRenderToTextureHalfFloat?dt.RGBA16F:dt.RGBA,nt,mt,0,dt.RGBA,Ve.extRenderToTextureHalfFloat?dt.HALF_FLOAT:dt.UNSIGNED_BYTE,null),Oe.colorAttachment0.set(Ne)})(Q,0,We,Ee,Se,De)}else me.bindTexture(me.TEXTURE_2D,Ee.colorAttachment0.get()),Q.bindFramebuffer.set(Ee.framebuffer)})(y,h,a,h.transform.projection.name==="globe"?.5:.25),y.clear({color:n.ao.transparent});const D=h.transform,N=D.projection.name==="globe",V=N?["PROJECTION_GLOBE_VIEW"]:[],K=N?Vn.frontCCW:Vn.disabled,X=[n.aF(D.center.lng),n.aJ(D.center.lat)];for(let Q=0;Q<d.length;Q++){const ae=d[Q];if(t.hasRenderableParent(ae))continue;const ie=t.getTile(ae),ge=ie.getBucket(a);if(!ge||ge.projection.name!==D.projection.name)continue;const me=h.isTileAffectedByFog(ae),Se=ge.programConfigurations.get(a.id),De=h.getOrCreateProgram("heatmap",{config:Se,defines:V,overrideFog:me}),{zoom:Ee}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ie,De),h.uploadCommonUniforms(y,De,ae.toUnwrapped());const We=D.projection.createInversionMatrix(D,ae.canonical);De.draw(h,b.TRIANGLES,yn.disabled,S,I,K,ir(h,ae,ie,We,X,Ee,a.paint.get("heatmap-intensity")),a.id,ge.layoutVertexBuffer,ge.indexBuffer,ge.segments,a.paint,h.transform.zoom,Se,N?[ge.globeExtVertexBuffer]:null)}y.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),(function(y,b){const S=y.context,I=S.gl,D=b.heatmapFbo;if(!D)return;S.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,D.colorAttachment0.get()),S.activeTexture.set(I.TEXTURE1);let N=b.colorRampTexture;N||(N=b.colorRampTexture=new n.T(S,b.colorRamp,I.RGBA8)),N.bind(I.LINEAR,I.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,I.TRIANGLES,yn.disabled,jn.disabled,y.colorModeForRenderPass(),Vn.disabled,((V,K,X,Q)=>({u_image:0,u_color_ramp:1,u_opacity:K.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)})(h,a))},line:function(h,t,a,d){if(h.renderPass!=="translucent")return;const y=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const S=a.paint.get("line-emissive-strength").isConstant(),I=a.paint.get("line-emissive-strength").constantOr(0),D=a.paint.get("line-occlusion-opacity"),N=a.layout.get("line-elevation-reference"),V=a.layout.get("line-width-unit")==="meters",K=N==="sea",X=!(!h.terrain||!h.terrain.enabled),Q=h.context,ae=Q.gl;if(a.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const ie=a.layout.get("line-cross-slope"),ge=ie!==void 0,me=ie<1,Se=h.colorModeForDrapableLayerRenderPass(S?I:null),De=h.terrain&&h.terrain.renderingToTexture,Ee=De?1:n.o.devicePixelRatio,We=a.paint.get("line-dasharray"),Ve=We.constantOr(1),He=a.layout.get("line-cap"),Ne=We.constantOr(null),Oe=He.constantOr(null),nt=a.paint.get("line-pattern"),mt=nt.constantOr(1),dt=a.paint.get("line-pattern-cross-fade"),At=nt.constantOr(null),Ct=a.paint.get("line-opacity").constantOr(1);let Dt=!mt&&Ct!==1||h.depthOcclusion&&D>0&&D<1;const Kt=a.paint.get("line-gradient"),vt=mt?"linePattern":"line",rt=n.e2(a);let Nt;if(De&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Dt=!1),D!==0&&h.depthOcclusion){const ki=a.paint._values["line-opacity"];ki&&ki.value&&ki.value.kind==="constant"?Nt=ki.value:n.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&rt.push("VARIABLE_LINE_WIDTH"),De&&(h.emissiveMode!=="dual-source-blending"||S?h.emissiveMode==="mrt-fallback"&&rt.push("USE_MRT1"):rt.push("DUAL_SOURCE_BLENDING"));const Lt=(ki,Ei,_i,fn,nn,$i)=>{for(const en of ki){const bn=t.getTile(en);if(mt&&!bn.patternsLoaded())continue;const ar=bn.getBucket(a);if(!ar||ar.elevationType!=="none"&&!nn||ar.elevationType==="none"&&nn)continue;h.prepareDrawTile();const jr=[...Ei],Ea=h.shadowRenderer,_n=ar.elevationType==="road"&&!!Ea&&Ea.enabled;let ca=[0,0,0];if(_n){const yr=h.style.directionalLight,ga=h.style.ambientLight;yr&&ga&&(ca=Pc(h.style,yr,ga)),jr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Jn=ar.programConfigurations.get(a.id);let xr=!1;if(At&&bn.imageAtlas){const yr=n.e3.from(At),ga=yr.getPrimary().scaleSelf(Ee).toString(),As=bn.imageAtlas.patternPositions.get(ga),Ms=yr.getSecondary(),Wa=Ms?bn.imageAtlas.patternPositions.get(Ms.scaleSelf(Ee).toString()):null;xr=!!As&&!!Wa,As&&Jn.setConstantPatternPositions(As,Wa)}dt>0&&(xr||Jn.getPatternTransitionVertexBuffer("line-pattern"))&&jr.push("LINE_PATTERN_TRANSITION");const Zr=h.isTileAffectedByFog(en),ta=h.getOrCreateProgram(vt,{config:Jn,defines:jr,overrideFog:Zr});if(!mt&&Ne&&Oe&&bn.lineAtlas){const yr=bn.lineAtlas.getDash(Ne,Oe);yr&&Jn.setConstantPatternPositions(yr)}_n&&Ea.setupShadows(bn.tileID.toUnwrapped(),ta,"vector-tile");let[Wr,_r]=a.paint.get("line-trim-offset");(Oe==="round"||Oe==="square")&&Wr!==_r&&(Wr===0&&(Wr-=1),_r===1&&(_r+=1));const Aa=De?en.projMatrix:null,Hs=V?1/ar.tileToMeter/n.ay(bn,1,h.transform.zoom):1,Za=V?1/ar.tileToMeter/n.ay(bn,1,Math.floor(h.transform.zoom)):1,ba=mt?n.e4(h,bn,a,Aa,Ee,Hs,Za,[Wr,_r],ca,dt):n.e5(h,bn,a,Aa,ar.lineClipsArray.length,Ee,Hs,Za,[Wr,_r],ca);if(Kt){const yr=ar.gradients[a.id];let ga=yr.texture;if(a.gradientVersion!==yr.version){let As=256;if(a.stepInterpolant){const Ms=t.getSource().maxzoom,Wa=en.canonical.z===Ms?Math.ceil(1<<h.transform.maxZoom-en.canonical.z):1;As=n.aA(n.e6(ar.maxLineLength/n.al*1024*Wa),256,Q.maxTextureSize)}yr.gradient=n.e7({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:As,image:yr.gradient||void 0,clips:ar.lineClipsArray}),yr.texture?yr.texture.update(yr.gradient):yr.texture=new n.T(Q,yr.gradient,ae.RGBA8),yr.version=a.gradientVersion,ga=yr.texture}Q.activeTexture.set(ae.TEXTURE1),ga.bind(a.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Ve&&(Q.activeTexture.set(ae.TEXTURE0),bn.lineAtlasTexture&&bn.lineAtlasTexture.bind(ae.LINEAR,ae.REPEAT),Jn.updatePaintBuffers()),mt&&(Q.activeTexture.set(ae.TEXTURE0),bn.imageAtlasTexture&&bn.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Jn.updatePaintBuffers()),nn&&!K&&h.terrain.setupElevationDraw(bn,ta),h.uploadCommonUniforms(Q,ta,en.toUnwrapped());const zr=yr=>{Nt!=null&&(Nt.value=Ct*D),ta.draw(h,ae.TRIANGLES,_i,yr,Se,Vn.disabled,ba,a.id,ar.layoutVertexBuffer,ar.indexBuffer,ar.segments,a.paint,h.transform.zoom,Jn,[ar.layoutVertexBuffer2,ar.patternVertexBuffer,ar.zOffsetVertexBuffer]),Nt!=null&&(Nt.value=Ct)};if(Dt&&!nn){const yr=h.stencilModeForClipping(en).ref;yr===0&&De&&Q.clear({stencil:0});const ga={func:ae.EQUAL,mask:255};ba.u_alpha_discard_threshold=.8,zr(new jn(ga,yr,255,ae.KEEP,ae.KEEP,ae.INVERT)),ba.u_alpha_discard_threshold=0,zr(new jn(ga,yr,255,ae.KEEP,ae.KEEP,ae.KEEP))}else ba.u_alpha_discard_threshold=Dt&&nn&&$i?.8:0,zr(nn?fn:h.stencilModeForClipping(en))}};let li=h.depthModeForSublayer(0,yn.ReadOnly);const Mi=new yn(h.depthOcclusion?ae.GREATER:ae.LEQUAL,yn.ReadOnly,h.depthRangeFor3D);if(a.hasNonElevatedBuckets){const ki=!De&&h.terrain;D!==0&&ki?n.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):ki?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):Lt(d,rt,li,jn.disabled,!1,!0)}if(a.hasElevatedBuckets){N==="hd-road-markup"?X||(li=Mi,rt.push("ELEVATED_ROADS")):(rt.push("ELEVATED"),li=Mi,ge&&rt.push(me?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),K&&rt.push("ELEVATION_REFERENCE_SEA"));const ki=Dt?h.stencilModeFor3D():jn.disabled;h.forceTerrainMode=!0,Lt(d,rt,li,ki,!0,!0),Dt&&Lt(d,rt,li,ki,!0,!1),h.forceTerrainMode=!1}Dt&&(h.resetStencilClippingMasks(),De&&Q.clear({stencil:0})),D===0||h.depthOcclusion||De||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,a,d){const y=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const S=a.paint.get("fill-emissive-strength"),I=h.colorModeForDrapableLayerRenderPass(S),D=a.paint.get("fill-pattern"),N=h.opaquePassEnabledForLayer()&&!D.constantOr(1)&&y.constantOr(n.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let V="none";a.layout.get("fill-elevation-reference")!=="none"?V="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(V="offset");const K=!(!h.terrain||!h.terrain.enabled),X={painter:h,sourceCache:t,layer:a,coords:d,colorMode:I,elevationType:V,terrainEnabled:K,pass:N};if(h.renderPass==="shadow")return void(h.shadowRenderer&&V==="road"&&!K&&(function(ae){const{painter:ie,sourceCache:ge,layer:me,coords:Se}=ae,De=ie.context.gl,Ee=ae.painter.shadowRenderer;for(const We of Se){const Ve=ge.getTile(We),He=Ve.getBucket(me);if(!He)continue;const Ne=He.elevatedStructures;if(!Ne||!Ne.shadowCasterSegments||Ne.shadowCasterSegments.segments[0].primitiveLength===0)continue;ie.prepareDrawTile();const Oe=He.bufferData.programConfigurations.get(me.id),nt=ie.isTileAffectedByFog(We),mt=ie.getOrCreateProgram("elevatedStructuresDepth",{config:Oe,overrideFog:nt}),dt=Ee.calculateShadowPassMatrixFromTile(Ve.tileID.toUnwrapped());ie.uploadCommonUniforms(ie.context,mt,We.toUnwrapped());const At={u_matrix:dt,u_depth_bias:0};mt.draw(ie,De.TRIANGLES,Ee.getShadowPassDepthMode(),jn.disabled,Ee.getShadowPassColorMode(),Vn.disabled,At,me.id,Ne.vertexBuffer,Ne.indexBuffer,Ne.shadowCasterSegments,me.paint,ie.transform.zoom,Oe)}})(X));const Q=h.emissiveMode==="mrt-fallback";if(V!=="offset"){if(jh(X,!1,Q),V==="road"){const ae=!K&&h.renderPass==="translucent";ae&&_c(h,t,a,d,"geometry"),jh(X,!0,Q,jn.disabled),ae&&(function(ie){const{painter:ge,sourceCache:me,layer:Se,coords:De,colorMode:Ee}=ie,We=ge.context.gl,Ve=ie.painter.shadowRenderer,He=!!Ve&&Ve.enabled,Ne=new yn(ge.context.gl.LEQUAL,yn.ReadOnly,ge.depthRangeFor3D);let Oe=[0,0,0];if(He){const mt=ge.style.directionalLight,dt=ge.style.ambientLight;mt&&dt&&(Oe=Pc(ge.style,mt,dt))}const nt=mt=>{for(const dt of De){const At=me.getTile(dt),Ct=At.getBucket(Se);if(!Ct)continue;const Dt=Ct.elevatedStructures;if(!Dt)continue;let Kt,vt;if(mt?(Kt=Dt.renderableBridgeSegments,vt=Dt.bridgeProgramConfigurations.get(Se.id)):(Kt=Dt.renderableTunnelSegments,vt=Dt.tunnelProgramConfigurations.get(Se.id)),!Kt||Kt.segments[0].primitiveLength===0)continue;vt.updatePaintBuffers(),ge.prepareDrawTile();const rt=ge.isTileAffectedByFog(dt),Nt=[];He&&Nt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Lt=ge.getOrCreateProgram("elevatedStructures",{config:vt,overrideFog:rt,defines:Nt}),li=ge.translatePosMatrix(dt.projMatrix,At,Se.paint.get("fill-translate"),Se.paint.get("fill-translate-anchor"));He&&Ve.setupShadows(At.tileID.toUnwrapped(),Lt,"vector-tile");const Mi=Jt(li,Oe);ge.uploadCommonUniforms(ge.context,Lt,dt.toUnwrapped()),Lt.draw(ge,We.TRIANGLES,Ne,jn.disabled,Ee,Vn.backCCW,Mi,Se.id,Dt.vertexBuffer,Dt.indexBuffer,Kt,Se.paint,ge.transform.zoom,vt,[Dt.vertexBufferNormal])}};nt(!0),nt(!1)})(X)}}else jh(X,!1,Q,h.stencilModeFor3D())},"fill-extrusion":function(h,t,a,d){const y=a.paint.get("fill-extrusion-opacity"),b=h.context,S=b.gl,I=h.terrain,D=I&&I.renderingToTexture;if(y===0)return;const N=h.emissiveMode==="mrt-fallback",V=h.conflationActive&&h.style.isLayerClipped(a,t.getSource()),K=h.style.order.indexOf(a.fqid);if(V&&(function(X,Q,ae,ie,ge){for(const me of ie){const Se=Q.getTile(me).getBucket(ae);Se&&(Se.updateReplacement(me,X.replacementSource,ge),Se.uploadCentroid(X.context))}})(h,t,a,d,K),I||V)for(const X of d){const Q=t.getTile(X).getBucket(a);Q&&Dp(h.context,t,X,Q,a,I,V)}if(h.renderPass==="shadow"&&h.shadowRenderer){const X=h.shadowRenderer;if(I&&y<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.ad)return;const Q=X.getShadowPassDepthMode(),ae=X.getShadowPassColorMode();Ys(h,t,a,d,Q,jn.disabled,ae,V)}else if(h.renderPass==="translucent"){const X=!a.paint.get("fill-extrusion-pattern").constantOr(1),Q=a.paint.get("fill-extrusion-color").constantOr(n.ao.white);if(!D&&Q.a!==0){const ae=new yn(h.context.gl.LEQUAL,yn.ReadWrite,h.depthRangeFor3D);y===1&&X?Ys(h,t,a,d,ae,jn.disabled,hr.unblended,V):(Ys(h,t,a,d,ae,jn.disabled,hr.disabled,V),Ys(h,t,a,d,ae,h.stencilModeFor3D(),h.colorModeForRenderPass(),V),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&X&&(!I&&h.transform.projection.name!=="globe"||D)){const ae=a.paint.get("fill-extrusion-opacity"),ie=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),ge=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),me=a.paint.get("fill-extrusion-flood-light-intensity"),Se=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",De=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Se?null:a.lut).toArray01().slice(0,3),Ee=ie>0&&ge>0,We=me>0,Ve=(Oe,nt,mt)=>(1-mt)*Oe+mt*nt,He=new rf;He.translate=a.paint.get("fill-extrusion-translate"),He.translateAnchor=a.paint.get("fill-extrusion-translate-anchor"),He.edgeRadius=a.layout.get("fill-extrusion-edge-radius"),He.cutoffFadeRange=a.paint.get("fill-extrusion-cutoff-fade-range");const Ne=Oe=>{const nt=h.depthModeForSublayer(1,yn.ReadOnly,S.LEQUAL,!0),mt=a.paint.get(Oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),dt=Ve(.1,3,mt),At=h._showOverdrawInspector;if(!At){const Ct=new jn({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),Dt=new hr([S.ONE,S.ONE,S.ONE,S.ONE],n.ao.transparent,[!1,!1,!1,!0],S.MIN);Uu(He,h,t,a,d,nt,Ct,Dt,Vn.disabled,Oe,"sdf",ae,ie,ge,me,De,dt,V,!1)}{const Ct=At?jn.disabled:new jn({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Dt=At?h.colorModeForRenderPass():new hr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],n.ao.transparent,[!0,!0,!0,!0]);Uu(He,h,t,a,d,nt,Ct,Dt,Vn.disabled,Oe,"color",ae,ie,ge,me,De,dt,V,!1)}};if(D){const Oe=()=>{const mt=I.drapeBufferSize[0],dt=I.drapeBufferSize[1];let At=I.framebufferCopyTexture;return At&&(!At||At.size[0]===mt&&At.size[1]===dt)||(At&&At.destroy(),At=I.framebufferCopyTexture=new n.T(b,new n.q({width:mt,height:dt}),S.RGBA8)),At.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,mt,dt),At},nt=(mt,dt,At)=>{const Ct=h.depthModeForSublayer(1,yn.ReadOnly,S.LEQUAL,!1),Dt=a.paint.get(mt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Kt=Ve(.1,3,Dt);{const vt=new hr([S.ONE,S.ONE,S.ONE,S.ONE],n.ao.transparent,[!1,!1,!1,!0]);Uu(He,h,t,a,d,Ct,jn.disabled,vt,Vn.disabled,mt,"clear",ae,ie,ge,me,De,Kt,V,dt)}{const vt=new jn({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),rt=new hr([S.ONE,S.ONE,S.ONE,S.ONE],n.ao.transparent,[!1,!1,!1,!0],S.MIN);Uu(He,h,t,a,d,Ct,vt,rt,Vn.disabled,mt,"sdf",ae,ie,ge,me,De,Kt,V,dt)}N&&!mt&&(At=Oe());{const vt=mt?S.ZERO:S.ONE_MINUS_DST_ALPHA,rt=new jn({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Nt=new hr([vt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],n.ao.transparent,[!0,!0,!0,!0]);Uu(He,h,t,a,d,Ct,rt,Nt,Vn.disabled,mt,"color",ae,ie,ge,me,De,Kt,V,dt)}if(!N||mt){const vt=new hr([S.ONE,S.ONE,S.ONE,mt?S.ZERO:S.ONE],n.ao.transparent,[!1,!1,!1,!0],mt?S.FUNC_ADD:S.MAX);Uu(He,h,t,a,d,Ct,jn.disabled,vt,Vn.disabled,mt,"clear",ae,ie,ge,me,De,Kt,V,dt,At)}else{S.drawBuffers([S.NONE,S.COLOR_ATTACHMENT1]);const vt=new jn({func:S.EQUAL,mask:255},254,255,S.KEEP,S.DECR,S.DECR),rt=new hr([S.ONE,S.ONE,S.ONE,S.ONE],n.ao.transparent,[!0,!1,!1,!1],S.MAX);Uu(He,h,t,a,d,Ct,vt,rt,Vn.disabled,mt,"emissive",ae,ie,ge,me,De,Kt,V,dt,At),S.drawBuffers([S.COLOR_ATTACHMENT0])}};if(Ee||We){let mt;h.prepareDrawTile(),N&&!Ee||(mt=Oe()),Ee&&nt(!0,!1,mt),We&&nt(!1,!0,mt)}}else Ee&&Ne(!0),We&&Ne(!1),(Ee||We)&&h.resetStencilClippingMasks()}}},building:function(h,t,a,d){h.currentLayer<h.firstLightBeamLayer&&(h.firstLightBeamLayer=h.currentLayer);const y=a.paint.get("building-ambient-occlusion-ground-intensity"),b=a.paint.get("building-ambient-occlusion-ground-radius"),S=a.paint.get("building-ambient-occlusion-ground-attenuation"),I=a.paint.get("building-opacity");if(I<=0)return;let D=y>0&&b>0,N=!0;const V=a.paint.get("building-vertical-scale");if(V<=0)return;h.shadowRenderer||(N=!1);const K=h.conflationActive&&h.style.isLayerClipped(a,t.getSource()),X=h.style.order.indexOf(a.fqid);if((function(Q,ae,ie,ge,me,Se){for(const De of Se){const Ee=ae.getTile(De).getBucket(ie);Ee&&(me&&Ee.updateReplacement(De,Q.replacementSource,ge),Ee.uploadUpdatedIndexBuffer(Q.context))}})(h,t,a,X,K,d),(function(Q,ae,ie,ge){for(const me of ge){const Se=ae.getTile(me).getBucket(ie);Se&&Se.needsEvaluation()&&Se.uploadUpdatedColorBuffer(Q.context)}})(h,t,a,d),a.resetLayerRenderingStats(h),h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0),h.renderPass==="shadow"&&h.shadowRenderer){const Q=h.shadowRenderer,ae=[],ie=Q.getShadowPassDepthMode();hh({painter:h,source:t,layer:a,coords:d,defines:ae,blendMode:Q.getShadowPassColorMode(),depthMode:ie,opacity:I,verticalScale:V,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(h.renderPass==="translucent"){let Q=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];N&&(Q=Q.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),h.shadowRenderer&&h.shadowRenderer.useNormalOffset&&(Q=Q.concat("NORMAL_OFFSET"));const ae=a.paint.get("building-facade-emissive-chance"),ie=a.paint.get("building-ambient-occlusion-intensity"),ge=a.paint.get("building-flood-light-intensity"),me=a.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Se=a.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(me?null:a.lut).toArray01().slice(0,3),De=a.paint.get("building-flood-light-ground-attenuation"),Ee=ge>0,We=new yn(h.context.gl.LEQUAL,yn.ReadWrite,h.depthRangeFor3D);I<1&&hh({painter:h,source:t,layer:a,coords:d,defines:Q,blendMode:hr.disabled,depthMode:We,opacity:I,verticalScale:V,facadeEmissiveChance:ae,facadeAOIntensity:ie,floodLightIntensity:ge,floodLightColor:Se,depthOnly:!0});const Ve=h.colorModeForRenderPass();hh({painter:h,source:t,layer:a,coords:d,defines:Q,blendMode:Ve,depthMode:We,opacity:I,verticalScale:V,facadeEmissiveChance:ae,facadeAOIntensity:ie,floodLightIntensity:ge,floodLightColor:Se}),D&&Qo(h,t,a,d,!0,I,y,b,ge,Se,S,K),Ee&&Qo(h,t,a,d,!1,I,y,b,ge,Se,De,K)}else if(h.renderPass==="light-beam"){const Q=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],ae=new yn(h.context.gl.LEQUAL,yn.ReadOnly,h.depthRangeFor3D);hh({painter:h,source:t,layer:a,coords:d,defines:Q,blendMode:hr.alphaBlended,depthMode:ae,opacity:I,verticalScale:V,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1),h.resetStencilClippingMasks()},hillshade:function(h,t,a,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const y=h.context,b=h.terrain&&h.terrain.renderingToTexture,[S,I]=h.renderPass!=="translucent"||b?[{},d]:h.stencilConfigForOverlap(d);for(const D of I){const N=t.getTile(D);if(N.needsHillshadePrepare&&h.renderPass==="offscreen")Xo(h,N,a);else if(h.renderPass==="translucent"){const V=h.depthModeForSublayer(0,yn.ReadOnly),K=a.paint.get("hillshade-emissive-strength"),X=h.colorModeForDrapableLayerRenderPass(K),Q=b&&h.terrain?h.terrain.stencilModeForRTTOverlap(D):S[D.overscaledZ];Kd(h,D,N,a,V,Q,X)}}y.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,a,d,y,b){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const S=h.transform.projection.name==="globe",I=a.paint.get("raster-elevation")!==0,D=I&&S;if(h.renderElevatedRasterBackface&&!D)return;const N=h.context,V=N.gl,K=t.getSource(),X=(function(Ve,He,Ne,Oe,nt){const mt=He.paint.get("raster-color"),dt=Ve.type==="raster-array",At=[],Ct=He.paint.get("raster-resampling"),Dt=He.paint.get("raster-color-mix");let Kt=He.paint.get("raster-color-range");const vt=[Dt[0],Dt[1],Dt[2],0],rt=Dt[3];let Nt=Ct==="nearest"?Oe.NEAREST:Oe.LINEAR;if(dt&&(At.push("RASTER_ARRAY"),mt||At.push("RASTER_COLOR"),Ct==="linear"&&At.push("RASTER_ARRAY_LINEAR"),Nt=Oe.NEAREST,!Kt&&Ve.rasterLayers)){const Lt=Ve.rasterLayers.find((({id:li})=>li===He.sourceLayer));Lt&&Lt.fields&&Lt.fields.range&&(Kt=Lt.fields.range)}if(Kt=Kt||[0,1],mt){At.push("RASTER_COLOR"),Ne.activeTexture.set(Oe.TEXTURE2),He.updateColorRamp(Kt);let Lt=He.colorRampTexture;Lt||(Lt=He.colorRampTexture=new n.T(Ne,He.colorRamp,Oe.RGBA8)),Lt.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}return nt&&At.push("USE_MRT1"),{mix:vt,range:Kt,offset:rt,defines:At,resampling:Nt}})(K,a,N,V,h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback");if(K instanceof n.aU&&!d.length&&!S)return;const Q=a.paint.get("raster-emissive-strength"),ae=h.colorModeForDrapableLayerRenderPass(Q),ie=h.terrain&&h.terrain.renderingToTexture,ge=!h.options.moving,me=a.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR;if(K instanceof n.aU&&!d.length&&(K.onNorthPole||K.onSouthPole)){const Ve=I?h.stencilModeFor3D():jn.disabled;return void bu(!!K.onNorthPole,null,h,t,a,Q,X,Vn.disabled,Ve)}if(!d.length)return;const[Se,De]=K instanceof n.aU||ie?[{},d]:h.stencilConfigForOverlap(d),Ee=De[De.length-1].overscaledZ;D&&X.defines.push("PROJECTION_GLOBE_VIEW"),I&&X.defines.push("RENDER_CUTOFF");const We=(Ve,He,Ne)=>{for(const Oe of Ve){const nt=Oe.toUnwrapped(),mt=t.getTile(Oe);if(ie&&(!mt||!mt.hasData()))continue;N.activeTexture.set(V.TEXTURE0);const dt=Gu(mt,K,a,X);if(!dt||!dt.texture)continue;const{texture:At,mix:Ct,offset:Dt,tileSize:Kt,buffer:vt}=dt;let rt,Nt;ie?(rt=yn.disabled,Nt=Oe.projMatrix):I?(rt=new yn(V.LEQUAL,yn.ReadWrite,h.depthRangeFor3D),Nt=S?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(nt,ge)):(rt=h.depthModeForSublayer(Oe.overscaledZ-Ee,a.paint.get("raster-opacity")===1?yn.ReadWrite:yn.ReadOnly,V.LESS),Nt=h.transform.calculateProjMatrix(nt,ge));const Lt=h.terrain&&ie?h.terrain.stencilModeForRTTOverlap(Oe):Se[Oe.overscaledZ],li=b?0:a.paint.get("raster-fade-duration");mt.registerFadeDuration(li);const Mi=t.findLoadedParent(Oe,0),ki=o(mt,Mi,t,h.transform,li);let Ei,_i;!ki.isFading&&mt.refreshedUponExpiration&&(mt.refreshedUponExpiration=!1),h.terrain&&h.terrain.prepareDrawTile(),N.activeTexture.set(V.TEXTURE0),At.bind(me,V.CLAMP_TO_EDGE),N.activeTexture.set(V.TEXTURE1),Mi?(Mi.texture&&Mi.texture.bind(me,V.CLAMP_TO_EDGE),Ei=Math.pow(2,Mi.tileID.overscaledZ-mt.tileID.overscaledZ),_i=[mt.tileID.canonical.x*Ei%1,mt.tileID.canonical.y*Ei%1]):At.bind(me,V.CLAMP_TO_EDGE),"useMipmap"in At&&N.extTextureFilterAnisotropic&&h.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const fn=h.transform;let nn;const $i=I?zd(fn):[0,0,0,0];let en,bn,ar,jr,Ea,_n=0;if(D&&K instanceof n.aU&&K.coordinates.length>3)en=Float32Array.from(n.bk(n.dJ(new n.cD(0,0,0)))),bn=Float32Array.from(fn.globeMatrix),ar=Float32Array.from(n.dF(fn)),jr=[n.aF(fn.center.lng),n.aJ(fn.center.lat)],nn=K.elevatedGlobePerspectiveTransform,Ea=K.elevatedGlobeGridMatrix||new Float32Array(9);else if(D){const Zr=n.dG(Oe.canonical);_n=n.dH(Zr.getCenter().lat),en=Float32Array.from(n.bk(n.dJ(Oe.canonical))),bn=Float32Array.from(fn.globeMatrix),ar=Float32Array.from(n.dF(fn)),jr=[n.aF(fn.center.lng),n.aJ(fn.center.lat)],nn=[0,0],Ea=Float32Array.from(n.dI(Oe.canonical,Zr,_n,fn.worldSize/fn._pixelsPerMercatorPixel))}else nn=K instanceof n.aU?K.perspectiveTransform:[0,0],en=new Float32Array(16),bn=new Float32Array(9),ar=new Float32Array(16),jr=[0,0],Ea=new Float32Array(9);const ca=qn(Nt,en,bn,ar,Ea,_i||[0,0],n.aj(h.transform.zoom),jr,$i,Ei||1,ki,a,nn,I?a.paint.get("raster-elevation"):0,2,Ct,Dt,X.range,Kt,vt,Q),Jn=h.isTileAffectedByFog(Oe),xr=h.getOrCreateProgram("raster",{defines:X.defines,overrideFog:Jn});if(h.uploadCommonUniforms(N,xr,nt),K instanceof n.aU){const Zr=K.elevatedGlobeVertexBuffer,ta=K.elevatedGlobeIndexBuffer;if(ie||!S)K.boundsBuffer&&K.boundsSegments&&xr.draw(h,V.TRIANGLES,rt,jn.disabled,ae,Vn.disabled,ca,a.id,K.boundsBuffer,h.quadTriangleIndexBuffer,K.boundsSegments);else if(Zr&&ta){const Wr=fn.zoom<=n.c_?K.elevatedGlobeSegments:K.getSegmentsForLongitude(fn.center.lng);Wr&&xr.draw(h,V.TRIANGLES,rt,jn.disabled,ae,He,ca,a.id,Zr,ta,Wr)}}else if(D){rt=new yn(V.LEQUAL,yn.ReadOnly,h.depthRangeFor3D);const Zr=h.globeSharedBuffers;if(Zr){const[ta,Wr,_r]=Zr.getGridBuffers(_n,!1);xr.draw(h,V.TRIANGLES,rt,Ne||Lt,h.colorModeForRenderPass(),He,ca,a.id,ta,Wr,_r)}}else{const{tileBoundsBuffer:Zr,tileBoundsIndexBuffer:ta,tileBoundsSegments:Wr}=h.getTileBoundsBuffers(mt);xr.draw(h,V.TRIANGLES,rt,Lt,ae,Vn.disabled,ca,a.id,Zr,ta,Wr)}}if(!(K instanceof n.aU)&&D)for(const Oe of Ve){const nt=Oe.canonical.y===(1<<Oe.canonical.z)-1;Oe.canonical.y===0&&bu(!0,Oe,h,t,a,Q,X,He,Ne||jn.disabled),nt&&bu(!1,Oe,h,t,a,Q,X,He===Vn.frontCW?Vn.backCW:Vn.frontCW,Ne||jn.disabled)}};D?We(De,h.renderElevatedRasterBackface?Vn.backCW:Vn.frontCW,h.stencilModeFor3D()):We(De,Vn.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,a,d,y,b){h.renderPass==="offscreen"&&(function(S,I,D,N){if(!N.length)return;const V=S.context,K=V.gl,X=I.getSource();if(!(X instanceof va))return;const Q=Math.ceil(Math.sqrt(D.paint.get("raster-particle-count")));let ae=D.particlePositionRGBAImage;if(!ae||ae.width!==Q){const De=(function(Ee){const We=Ee*Ee,Ve=new Uint8Array(4*We),He=function(Oe){return Oe|=0,Oe=Math.imul(2747636419^Oe,2654435769),Oe=Math.imul(Oe^Oe>>>16,2654435769),((Oe=Math.imul(Oe^Oe>>>16,2654435769))>>>0)/4294967296},Ne=1/1.1;for(let Oe=0;Oe<We;Oe++){const nt=Ne*(He(2*Oe+0)+is),mt=Ne*(He(2*Oe+1)+is),dt=255*nt%1,At=255*mt%1,Ct=dt,Dt=mt-At/255,Kt=At;Ve[4*Oe+0]=255*(nt-dt/255),Ve[4*Oe+1]=255*Ct,Ve[4*Oe+2]=255*Dt,Ve[4*Oe+3]=255*Kt}return Ve})(Q);ae=D.particlePositionRGBAImage=new n.q({width:Q,height:Q},De)}let ie=D.particleFramebuffer;ie?ie.width!==Q&&(ie.destroy(),ie=D.particleFramebuffer=V.createFramebuffer(Q,Q,1,null)):ie=D.particleFramebuffer=V.createFramebuffer(Q,Q,1,null);const ge=[];for(const De of N){const Ee=I.getTile(De);if(!(Ee instanceof Mh))continue;const We=af(Ee,X,D);if(!We)continue;const Ve=[Ee.tileSize,Ee.tileSize];let He=D.tileFramebuffer;He||(He=D.tileFramebuffer=V.createFramebuffer(Ve[0],Ve[1],1,null));let Ne=Ee.rasterParticleState;Ne||(Ne=Ee.rasterParticleState=new dh(V,De,Ve,ae));const Oe=Ne.update(D.lastInvalidatedAt);Ne.particleTextureDimension!==Q&&Ne.updateParticleTexture(De,ae);const nt=Ne.targetColorTexture;Ne.targetColorTexture=Ne.backgroundColorTexture,Ne.backgroundColorTexture=nt;const mt=Ne.particleTexture0;Ne.particleTexture0=Ne.particleTexture1,Ne.particleTexture1=mt,ge.push([De,We,Ne,Oe])}if(ge.length===0)return;const me=n.o.now(),Se=D.previousDrawTimestamp?.001*(me-D.previousDrawTimestamp):.0167;if(D.previousDrawTimestamp=me,D.hasColorMap()){V.activeTexture.set(K.TEXTURE0+2);let De=D.colorRampTexture;De||(De=D.colorRampTexture=new n.T(V,D.colorRamp,K.RGBA8)),De.bind(K.LINEAR,K.CLAMP_TO_EDGE)}V.bindFramebuffer.set(D.tileFramebuffer.framebuffer),(function(De,Ee,We){const Ve=De.context,He=Ve.gl,Ne=Ee.tileFramebuffer;Ve.activeTexture.set(He.TEXTURE0);const Oe={u_texture:0,u_opacity:1.05*(mt=Ee.paint.get("raster-particle-fade-opacity-factor"))/(mt+.05)},nt=De.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var mt;for(const dt of We){const[,,At,Ct]=dt;Ne.colorAttachment0.set(At.targetColorTexture.texture),Ve.viewport.set([0,0,Ne.width,Ne.height]),Ve.clear({color:n.ao.transparent}),Ct&&(At.backgroundColorTexture.bind(He.NEAREST,He.CLAMP_TO_EDGE),nt.draw(De,He.TRIANGLES,yn.disabled,jn.disabled,hr.alphaBlended,Vn.disabled,Oe,Ee.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments))}})(S,D,ge),(function(De,Ee,We,Ve){const He=De.context,Ne=He.gl,Oe=We.tileFramebuffer,nt=De.transform.projection.name==="globe",mt=We.paint.get("raster-particle-max-speed");for(const dt of Ve){const[At,Ct,Dt]=dt;He.activeTexture.set(Ne.TEXTURE0+0),Ct.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),Oe.colorAttachment0.set(Dt.targetColorTexture.texture);const Kt=De.getOrCreateProgram("rasterParticleDraw",{defines:Ct.defines,overrideFog:!1});He.activeTexture.set(Ne.TEXTURE0+1);const vt=Ct.scalarData?[]:[0,1,2,3].map((Lt=>n.e9[Lt](At)));vt.push(At);const rt=At.canonical.x,Nt=At.canonical.y;for(const Lt of vt){const li=Ee.getTile(nt?Lt.wrapped():Lt);if(!li)continue;const Mi=li.rasterParticleState;if(!Mi)continue;const ki=Lt.canonical.x+(1<<Lt.canonical.z)*(Lt.wrap-At.wrap),Ei=Lt.canonical.y;Mi.particleTexture0.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const _i=Ya(1,Mi.particleTexture0.size[0],[ki-rt,Ei-Nt],0,Ct.texture.size,2,mt,Ct.textureOffset,Ct.scale,Ct.offset);Kt.draw(De,Ne.POINTS,yn.disabled,jn.disabled,hr.alphaBlended,Vn.disabled,_i,We.id,Mi.particleIndexBuffer,void 0,Mi.particleSegment)}}})(S,I,D,ge),V.bindFramebuffer.set(D.particleFramebuffer.framebuffer),(function(De,Ee,We,Ve){const He=De.context,Ne=He.gl,Oe=Ee.paint.get("raster-particle-max-speed"),nt=Ve*Ee.paint.get("raster-particle-speed-factor")*.15,mt=(function(At){return Math.pow(At,6)})(.01+1*Ee.paint.get("raster-particle-reset-rate-factor")),dt=Ee.particleFramebuffer;He.viewport.set([0,0,dt.width,dt.height]);for(const At of We){const[,Ct,Dt]=At;He.activeTexture.set(Ne.TEXTURE0+0),Ct.texture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),He.activeTexture.set(Ne.TEXTURE0+1);const Kt=Dt.particleTexture0;Kt.bind(Ne.NEAREST,Ne.CLAMP_TO_EDGE);const vt=Vs(1,Kt.size[0],0,Ct.texture.size,Oe,nt,mt,Ct.textureOffset,Ct.scale,Ct.offset);dt.colorAttachment0.set(Dt.particleTexture1.texture),He.clear({color:n.ao.transparent}),De.getOrCreateProgram("rasterParticleUpdate",{defines:Ct.defines}).draw(De,Ne.TRIANGLES,yn.disabled,jn.disabled,hr.unblended,Vn.disabled,vt,Ee.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments)}})(S,D,ge,Se)})(h,t,a,d),h.renderPass==="translucent"&&((function(S,I,D,N,V){const K=S.context,X=K.gl,Q=I.getSource().tileSize,ae=5*(1-n.ah(n.cL,n.cL+1,S.transform.zoom))*Q+D.paint.get("raster-particle-elevation"),ie=!S.options.moving,ge=S.transform.projection.name==="globe";if(!N.length)return;const[me,Se]=S.stencilConfigForOverlap(N),De=[];ge&&De.push("PROJECTION_GLOBE_VIEW");const Ee=S.stencilModeFor3D();for(const We of Se){const Ve=We.toUnwrapped(),He=I.getTile(We);if(!He.rasterParticleState)continue;const Ne=He.rasterParticleState,Oe=100;He.registerFadeDuration(Oe);const nt=I.findLoadedParent(We,0),mt=o(He,nt,I,S.transform,Oe);let dt,At;S.terrain&&S.terrain.prepareDrawTile(),K.activeTexture.set(X.TEXTURE0),Ne.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),K.activeTexture.set(X.TEXTURE1),nt&&nt.rasterParticleState?(nt.rasterParticleState.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),dt=Math.pow(2,nt.tileID.overscaledZ-He.tileID.overscaledZ),At=[He.tileID.canonical.x*dt%1,He.tileID.canonical.y*dt%1]):Ne.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const Ct=ge?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Ve,ie),Dt=S.transform,Kt=sf(Dt),vt=n.dG(We.canonical),rt=n.dH(vt.getCenter().lat);let Nt,Lt,li,Mi,ki;ge?(Nt=Float32Array.from(n.bk(n.dJ(We.canonical))),Lt=Float32Array.from(Dt.globeMatrix),li=Float32Array.from(n.dF(Dt)),Mi=[n.aF(Dt.center.lng),n.aJ(Dt.center.lat)],ki=Float32Array.from(n.dI(We.canonical,vt,rt,Dt.worldSize/Dt._pixelsPerMercatorPixel))):(Nt=new Float32Array(16),Lt=new Float32Array(9),li=new Float32Array(16),Mi=[0,0],ki=new Float32Array(9));const Ei=Da(Ct,Nt,Lt,li,ki,At||[0,0],n.aj(S.transform.zoom),Mi,Kt,dt||1,mt,ae),_i=S.isTileAffectedByFog(We),fn=S.getOrCreateProgram("rasterParticle",{defines:De,overrideFog:_i});if(S.uploadCommonUniforms(K,fn,Ve),ge){const nn=new yn(X.LEQUAL,yn.ReadOnly,S.depthRangeFor3D),$i=0,en=S.globeSharedBuffers;if(en){const[bn,ar,jr]=en.getGridBuffers(rt,$i!==0);fn.draw(S,X.TRIANGLES,nn,Ee,hr.alphaBlended,S.renderElevatedRasterBackface?Vn.frontCCW:Vn.backCCW,Ei,D.id,bn,ar,jr)}}else{const nn=S.depthModeForSublayer(0,yn.ReadOnly),$i=me[We.overscaledZ],{tileBoundsBuffer:en,tileBoundsIndexBuffer:bn,tileBoundsSegments:ar}=S.getTileBoundsBuffers(He);fn.draw(S,X.TRIANGLES,nn,$i,hr.alphaBlended,Vn.disabled,Ei,D.id,en,bn,ar)}}S.resetStencilClippingMasks()})(h,t,a,d),h.style.map.triggerRepaint())},background:function(h,t,a,d){const y=a.paint.get("background-color"),b=a.paint.get("background-color-use-theme").constantOr("default")==="none",S=a.paint.get("background-opacity"),I=a.paint.get("background-emissive-strength"),D=a.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const N=h.context,V=N.gl,K=h.transform,X=K.tileSize,Q=a.paint.get("background-pattern");let ae;if(Q!==void 0&&(Q===null||(ae=h.imageManager.getPattern(n.I.from(Q.toString()),a.scope,h.style.getLut(a.scope)),!ae)))return;const ie=!Q&&y.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==ie)return;const ge=jn.disabled,me=h.depthModeForSublayer(0,ie==="opaque"?yn.ReadWrite:yn.ReadOnly),Se=h.colorModeForDrapableLayerRenderPass(I),De=Q?"backgroundPattern":"background";let Ee,We=d;We||(Ee=h.getBackgroundTiles(),We=Object.values(Ee).map((He=>He.tileID))),Q&&(N.activeTexture.set(V.TEXTURE0),h.imageManager.bind(h.context,a.scope));const Ve=[];if(h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&Ve.push("USE_MRT1"),D){const He=h.getOrCreateProgram(De,{overrideFog:!1,overrideRtt:!0,defines:Ve}),Ne=new Float32Array(n.bA([])),Oe=new n.aQ(0,0,0,0,0),nt=Q?Fo(Ne,I,S,h,0,a.scope,ae,D,{tileID:Oe,tileSize:X}):Us(Ne,I,S,y.toPremultipliedRenderColor(b?null:a.lut));He.draw(h,V.TRIANGLES,me,ge,Se,Vn.disabled,nt,a.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const He of We){const Ne=h.isTileAffectedByFog(He),Oe=h.getOrCreateProgram(De,{overrideFog:Ne,defines:Ve}),nt=He.toUnwrapped(),mt=d?He.projMatrix:h.transform.calculateProjMatrix(nt);h.prepareDrawTile();const dt=t?t.getTile(He):Ee?Ee[He.key]:new Iu(He,X,K.zoom,h),At=Q?Fo(mt,I,S,h,0,a.scope,ae,D,{tileID:He,tileSize:X}):Us(mt,I,S,y.toPremultipliedRenderColor(b?null:a.lut));h.uploadCommonUniforms(N,Oe,nt);const{tileBoundsBuffer:Ct,tileBoundsIndexBuffer:Dt,tileBoundsSegments:Kt}=h.getTileBoundsBuffers(dt);Oe.draw(h,V.TRIANGLES,me,ge,Se,Vn.disabled,At,a.id,Ct,Dt,Kt)}},sky:function(h,t,a){const d=h._atmosphere?n.aj(h.transform.zoom):1,y=a.paint.get("sky-opacity")*d;if(y===0)return;const b=h.context,S=a.paint.get("sky-type"),I=new yn(b.gl.LEQUAL,yn.ReadOnly,[0,1]),D=h.frameCounter/1e3%1;S==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&((function(N,V,K,X){const Q=N.context,ae=Q.gl;let ie=V.skyboxFbo;if(!ie){ie=V.skyboxFbo=Q.createFramebuffer(32,32,1,null),V.skyboxGeometry=new Pd(Q),V.skyboxTexture=Q.gl.createTexture(),ae.bindTexture(ae.TEXTURE_CUBE_MAP,V.skyboxTexture),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MAG_FILTER,ae.LINEAR);for(let De=0;De<6;++De)ae.texImage2D(ae.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,ae.RGBA,32,32,0,ae.RGBA,ae.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ie.framebuffer),Q.viewport.set([0,0,32,32]);const ge=V.getCenter(N,!0),me=N.getOrCreateProgram("skyboxCapture"),Se=new Float64Array(16);n.bA(Se),n.en(Se,Se,.5*-Math.PI),gd(N,V,me,Se,ge,0),n.bA(Se),n.en(Se,Se,.5*Math.PI),gd(N,V,me,Se,ge,1),n.bA(Se),n.cU(Se,Se,.5*-Math.PI),gd(N,V,me,Se,ge,2),n.bA(Se),n.cU(Se,Se,.5*Math.PI),gd(N,V,me,Se,ge,3),n.bA(Se),gd(N,V,me,Se,ge,4),n.bA(Se),n.en(Se,Se,Math.PI),gd(N,V,me,Se,ge,5),Q.viewport.set([0,0,N.width,N.height])})(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&(function(N,V,K,X,Q){const ae=N.context,ie=ae.gl,ge=N.transform,me=N.getOrCreateProgram("skybox");ae.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,V.skyboxTexture);const Se=((De,Ee,We,Ve,He)=>({u_matrix:De,u_sun_direction:Ee,u_cubemap:0,u_opacity:Ve,u_temporal_offset:He}))(ge.skyboxMatrix,V.getCenter(N,!1),0,X,Q);N.uploadCommonUniforms(ae,me),me.draw(N,ie.TRIANGLES,K,jn.disabled,N.colorModeForRenderPass(),Vn.backCW,Se,"skybox",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)})(h,a,I,y,D):S==="gradient"&&h.renderPass==="sky"&&(function(N,V,K,X,Q){const ae=N.context,ie=ae.gl,ge=N.transform,me=N.getOrCreateProgram("skyboxGradient");V.skyboxGeometry||(V.skyboxGeometry=new Pd(ae)),ae.activeTexture.set(ie.TEXTURE0);let Se=V.colorRampTexture;Se||(Se=V.colorRampTexture=new n.T(ae,V.colorRamp,ie.RGBA8)),Se.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const De=((Ee,We,Ve,He,Ne)=>({u_matrix:Ee,u_color_ramp:0,u_center_direction:We,u_radius:n.an(Ve),u_opacity:He,u_temporal_offset:Ne}))(ge.skyboxMatrix,V.getCenter(N,!1),V.paint.get("sky-gradient-radius"),X,Q);N.uploadCommonUniforms(ae,me),me.draw(N,ie.TRIANGLES,K,jn.disabled,N.colorModeForRenderPass(),Vn.backCW,De,"skyboxGradient",V.skyboxGeometry.vertexBuffer,V.skyboxGeometry.indexBuffer,V.skyboxGeometry.segment)})(h,a,I,y,D)},custom:function(h,t,a,d){const y=h.context,b=a.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&a.isDraped(t)){if(h.renderPass==="offscreen"){const S=b.prerender;if(S){if(h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const I=h.transform.pointMerc;S.call(b,y.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.aj(h.transform.zoom),[I.x,I.y],h.transform.pixelsPerMeterRatio)}else S.call(b,y.gl,h.transform.customLayerMatrix());y.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const I=b.renderToTile;if(I){const D=d[0].canonical,N={x:D.x+d[0].wrap*(b.wrapTileId?0:1<<D.z),y:D.y,z:D.z};y.setDepthMode(yn.disabled),y.setStencilMode(jn.disabled),y.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),I.call(b,y.gl,N),y.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),y.setStencilMode(jn.disabled);const S=b.renderingMode==="3d"?new yn(h.context.gl.LEQUAL,yn.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,yn.ReadOnly);if(y.setDepthMode(S),h.transform.projection.name==="globe"){const I=h.transform.pointMerc;b.render(y.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.aj(h.transform.zoom),[I.x,I.y],h.transform.pixelsPerMeterRatio)}else b.render(y.gl,h.transform.customLayerMatrix());y.setDirty(),h.setBaseState(),y.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,a,d){if(h.renderPass==="opaque")return;const y=a.paint.get("model-opacity").constantOr(1),b=a.paint.get("model-elevation-reference"),S=b==="ground",I=b==="ground";if(y===0)return;const D=a.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!D||h.terrain&&y<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof n.ad))return;const N=h.shadowRenderer,V=a.paint.get("model-receive-shadows");N&&(N.useNormalOffset=!0,V||(N.enabled=!1));const K=()=>{N&&(N.useNormalOffset=!0,V||(N.enabled=!0))},X=t.getSource();if(h.renderPass==="light-beam"&&X.type!=="batched-model")return;if(X.type==="vector"||X.type==="geojson")return(function(Ee,We,Ve,He,Ne){const Oe=Ee.transform,nt=Oe.projection.name==="globe",mt=Oe.getFreeCameraOptions().position;if(!Ee.modelManager)return;const dt=Ee.modelManager;Ve.modelManager=dt;const At=Ee.shadowRenderer;if(!Ve._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ct=Ve._unevaluatedLayout._values["model-id"],Dt=Object.assign({},Ve.layout.get("model-id").parameters),Kt=Ee.style.order.indexOf(Ve.fqid),vt=Ve.paint.get("model-opacity").constantOr(1);for(const rt of He){const Nt=We.getTile(rt).getBucket(Ve);if(!Nt||Nt.projection.name!==Oe.projection.name)continue;const Lt=Nt.getModelUris();if(Lt&&!Nt.modelsRequested&&(dt.addModelsFromBucket(Lt,Ne),Nt.modelsRequested=!0),nt)Dt.zoom=rt.overscaledZ;else{const $i=Ks(rt,Oe);Dt.zoom=$i}const li=Ct.possiblyEvaluate(Dt);if(_m(Ee,Nt,rt),Hh.shadowUniformsInitialized=!1,Hh.useSingleShadowCascade=!!At&&At.getMaxCascadeForTile(rt.toUnwrapped())===0,Ee.renderPass==="shadow"&&At){if(Ee.currentShadowCascade===1&&Nt.isInsideFirstShadowMapFrustum)continue;const $i=Oe.calculatePosMatrix(rt.toUnwrapped(),Oe.worldSize);if(Hh.tileMatrix.set($i),Hh.shadowTileMatrix=Float32Array.from(At.calculateShadowPassMatrixFromMatrix($i)),Hh.aabb.min=[0,0,0],Hh.aabb.max[0]=Hh.aabb.max[1]=n.al,Hh.aabb.max[2]=0,Bm(Nt,Hh,Ee,Ve.scope))continue}const Mi=1<<rt.canonical.z,ki=[((mt.x-rt.wrap)*Mi-rt.canonical.x)*n.al,(mt.y*Mi-rt.canonical.y)*n.al,mt.z*Mi*n.al];Ee.conflationActive&&Object.keys(Nt.instancesPerModel).length>0&&Ee.style.isLayerClipped(Ve,We.getSource())&&Nt.updateReplacement(rt,Ee.replacementSource,Kt,Ve.scope)&&(Nt.uploaded=!1,Nt.upload(Ee.context));let Ei=0;const _i=new Array,fn=new Array,nn=new Array;for(let $i in Nt.instancesPerModel){const en=Nt.instancesPerModel[$i];en.features.length>0&&!nt&&($i=li.evaluate(en.features[0].feature,{}));const bn=dt.getModel($i,Ne);if(bn||dt.hasURLBeenRequested($i)||Nt.modelUris.includes($i)||(Nt.modelUris.push($i),Nt.modelsRequested=!1),bn&&bn.uploaded)if(nt){const ar=n.c5([],[mt.x,mt.y,mt.z],Ee.transform.worldSize);n.ew(ar,ar);for(let jr=0;jr<en.instancedDataArray.length;++jr){const Ea=[0,0,0],_n=[1,1,1],ca=n.ex(),Jn=en.tileCoordinatesForInstance(jr),xr=en.transformForInstance(jr);n.ey(_n,xr),n.ez(ca,xr),n.eA(Ea,ca);const Zr=en.translationForInstance(jr),ta=new n.aT(0,0);n.eB(Nt.canonical,ta,Jn.x,Jn.y);const Wr=n.bC();n.eC(Wr,bn,Ee.transform,ta,Ea,_n,Zr,!0,!1,!1);const _r=en.colorForInstance(jr),Aa=n.bA([]),Hs=n.ef(ta.lat,Ee.transform.zoom),Za=n.bq([],[1,1,1/Hs]);n.br(Aa,Aa,ar),nn.push({zScaleMatrix:Za,negCameraPosMatrix:Aa});for(const ba of bn.nodes)lf(Ee,ba,Wr,Ee.transform.expandedFarZProjMatrix,Ei,_i,fn,bn.materialOverrides,vt,_r);++Ei}}else for(const ar of bn.nodes)Ld(Ee,Ve,ar,en,ki,rt,Hh)}if(nt)if(Ee.renderPass==="shadow"){for(const $i of fn)vc($i.mesh,$i.nodeModelMatrix,Ee,Ve);for(const $i of _i)vc($i.mesh,$i.nodeModelMatrix,Ee,Ve)}else mm(Ee,Ve,_i,fn,nn)}})(h,t,a,d,qu(h,a)),void K();if(!X.loaded())return;if(X.type==="batched-model")return(function(Ee,We,Ve,He){Ve.resetLayerRenderingStats(Ee);const Ne=Ee.context,Oe=Ee.transform,nt=Ee.style.fog,mt=Ee.shadowRenderer;if(Oe.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${Oe.projection.name} projection is not yet implemented`);const dt=Ee.transform.getFreeCameraOptions().position,At=n.c5([],[dt.x,dt.y,dt.z],Ee.transform.worldSize),Ct=n.ew([],At),Dt=n.bA([]),Kt=n.ef(Oe.center.lat,Oe.zoom),vt=n.bq([],[1,1,1/Kt]);n.br(Dt,Dt,Ct);const rt=Ve.paint.get("model-opacity").constantOr(1),Nt=new yn(Ne.gl.LEQUAL,yn.ReadWrite,Ee.depthRangeFor3D),Lt=new yn(Ne.gl.LEQUAL,yn.ReadOnly,Ee.depthRangeFor3D),li=new n.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Mi=Ee.renderPass==="shadow",ki=Mi&&mt?mt.getCurrentCascadeFrustum():Oe.getFrustum(Oe.scaleZoom(Oe.worldSize)),Ei=Ve.paint.get("model-front-cutoff"),_i=Ei[2]<1,fn=ah(Ee,Ve.paint.get("model-cutoff-fade-range")),nn=Ve.getLayerRenderingStats();(function($i,en,bn,ar){const jr=$i.terrain?$i.terrain.exaggeration():0,Ea=$i.transform.zoom;for(const _n of ar){const ca=en.getTile(_n).getBucket(bn);ca&&(ca.setFilter(bn.filter),$i.conflationActive&&ca.updateReplacement(_n,$i.replacementSource),ca.evaluateTransform($i,bn),$i.terrain&&jr>0&&ca.elevationUpdate($i.terrain,jr,_n,bn.source),ca.needsReEvaluation($i,Ea,bn)&&ca.evaluate(bn))}})(Ee,We,Ve,He),(function(){let $i,en,bn;_i?($i=He.length-1,en=-1,bn=-1):($i=0,en=He.length,bn=1);const ar=new Float64Array(16),jr=n.cA(),Ea=new n.P(0,0);for(let _n=$i;_n!==en;_n+=bn){const ca=He[_n],Jn=We.getTile(ca).getBucket(Ve);if(!Jn||!Jn.uploaded)continue;let xr=!1;mt&&(xr=mt.getMaxCascadeForTile(ca.toUnwrapped())===0);const Zr=Oe.calculatePosMatrix(ca.toUnwrapped(),Oe.worldSize),ta=Jn.modelTraits;!Mi&&_i&&(n.bl(ar,Zr),n.af(jr,At,ar),Ea.x=jr[0],Ea.y=jr[1]);const Wr=[];Jn.setFilter(Ve.filter);for(const _r of Jn.getNodesInfo()){if(_r.hiddenByReplacement||!_r.node.meshes)continue;const Aa=_r.node;let Hs=0;Ee.terrain&&Aa.elevation&&(Hs=Aa.elevation*Ee.terrain.exaggeration());const Za=(()=>{const $o=_r.aabb;return li.min=[...$o.min],li.max=[...$o.max],li.min[2]+=Hs,li.max[2]+=Hs,n.af(li.min,li.min,Zr),n.af(li.max,li.max,Zr),li})(),ba=_r.evaluatedScale;if(ba[0]<=1&&ba[1]<=1&&ba[2]<=1&&Za.intersects(ki)===0)continue;if(!Mi&&_i){const $o=.16666666666666666;_r.cameraCollisionOpacity=At[0]>Za.min[0]&&At[0]<Za.max[0]&&At[1]>Za.min[1]&&At[1]<Za.max[1]&&At[2]*Kt<Za.max[2]&&Aa.footprint&&n.c0(Ea,Aa.footprint)?Math.max(_r.cameraCollisionOpacity-$o,0):Math.min(1,_r.cameraCollisionOpacity+$o)}const zr=[...Zr],yr=1/n.d7(ca.canonical),ga=Aa.anchor?Aa.anchor[0]:0,As=Aa.anchor?Aa.anchor[1]:0;n.br(zr,zr,[ga*(ba[0]-1)+_r.evaluatedTranslation[0]*yr,As*(ba[1]-1)+_r.evaluatedTranslation[1]*yr,Hs+_r.evaluatedTranslation[2]]),n.cq(ba,n.eE)||n.cS(zr,zr,ba);const Ms=n.aB([],zr,Aa.globalMatrix),Wa=n.aB([],Oe.expandedFarZProjMatrix,Ms),No=n.aB([],Oe.expandedFarZProjMatrix,zr),el=n.aC([],[ga,As,Hs,1],Wa)[2];Aa.hidden=!1;let ho=rt;Mi||(_i&&(ho*=_r.cameraCollisionOpacity,ho*=Yr(zr,Oe,_r.aabb,Ei)),ho*=Ja(fn,el)),ho!==0?Wr.push({nodeInfo:_r,depth:el,opacity:ho,wvpForNode:Wa,wvpForTile:No,nodeModelMatrix:Ms,tileModelMatrix:zr}):Aa.hidden=!0}Mi||Wr.sort(((_r,Aa)=>!_i||_r.opacity===1&&Aa.opacity===1?_r.depth<Aa.depth?-1:1:_r.opacity===1?-1:Aa.opacity===1?1:_r.depth>Aa.depth?-1:1));for(const _r of Wr){const Aa=_r.nodeInfo,Hs=Aa.node;let Za=n.aB([],vt,_r.tileModelMatrix);n.aB(Za,Dt,Za);const ba=n.bl([],Za);n.eg(ba,ba),n.cS(ba,ba,cf),Za=n.aB(Za,Za,Hs.globalMatrix);const zr=Ee.renderPass==="light-beam",yr=Ve.paint.get("model-color-use-theme").constantOr("default")==="none",ga=ta&n.eI.HasMapboxMeshFeatures,As=ga?0:Aa.evaluatedRMEA[0][2];for(let Ms=0;Ms<Hs.meshes.length;++Ms){const Wa=Hs.meshes[Ms],No=Ms===Hs.lightMeshIndex;let el=_r.wvpForNode;if(No){if(!zr&&!Ee.terrain&&Ee.shadowRenderer){Ee.currentLayer<Ee.firstLightBeamLayer&&(Ee.firstLightBeamLayer=Ee.currentLayer);continue}el=_r.wvpForTile}else if(zr)continue;const ho={defines:[]},$o=[];if(!Mi&&mt&&(mt.useNormalOffset=!!Wa.normalBuffer),ap(ho.defines,$o,Wa,Ee,yr?null:Ve.lut),ga||ho.defines.push("DIFFUSE_SHADED"),xr&&ho.defines.push("SHADOWS_SINGLE_CASCADE"),nn&&(Mi?nn.numRenderedVerticesInShadowPass+=Wa.vertexArray.length:nn.numRenderedVerticesInTransparentPass+=Wa.vertexArray.length),Mi){vc(Wa,_r.nodeModelMatrix,Ee,Ve);continue}let Vl=null;if(nt){const fo=Gh(_r.nodeModelMatrix,Ee.transform);if(Vl=new Float32Array(fo),Oe.projection.name!=="globe"){const Ua=Wa.aabb.min,$s=Wa.aabb.max,[Os,Is]=nt.getOpacityForBounds(fo,Ua[0],Ua[1],$s[0],$s[1]);ho.overrideFog=Os>=Gt||Is>=Gt}}const dl=Wa.material;let Qc;dl.occlusionTexture&&dl.occlusionTexture.offsetScale&&(Qc=dl.occlusionTexture.offsetScale,ho.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Xu=Ee.getOrCreateProgram("model",ho);!Mi&&mt&&mt.setupShadowsFromMatrix(_r.tileModelMatrix,Xu,mt.useNormalOffset),Ee.uploadCommonUniforms(Ne,Xu,null,Vl);const tc=dl.pbrMetallicRoughness;tc.metallicFactor=.9,tc.roughnessFactor=.5;const qs=ks(new Float32Array(el),new Float32Array(Za),new Float32Array(ba),new Float32Array(Hs.globalMatrix),Ee,_r.opacity,tc.baseColorFactor,dl.emissiveFactor,tc.metallicFactor,tc.roughnessFactor,dl,As,Ve,[0,0,0],Qc);!No&&(Aa.hasTranslucentParts||_r.opacity<1)&&Xu.draw(Ee,Ne.gl.TRIANGLES,Nt,jn.disabled,hr.disabled,Vn.backCCW,qs,Ve.id,Wa.vertexBuffer,Wa.indexBuffer,Wa.segments,Ve.paint,Ee.transform.zoom,void 0,$o),Xu.draw(Ee,Ne.gl.TRIANGLES,No?Lt:Nt,jn.disabled,No||_r.opacity<1||Aa.hasTranslucentParts?hr.alphaBlended:hr.unblended,Vn.backCCW,qs,Ve.id,Wa.vertexBuffer,Wa.indexBuffer,Wa.segments,Ve.paint,Ee.transform.zoom,void 0,$o)}}}})()})(h,t,a,d),void K();if(X.type!=="model")return;const Q=X.getModels(),ae=[],ie=h.transform.getFreeCameraOptions().position,ge=n.c5([],[ie.x,ie.y,ie.z],h.transform.worldSize);n.ew(ge,ge);const me=[],Se=[];let De=0;for(const Ee of Q){const We=t.getFeatureState("",Ee.id),Ve={type:"Unknown",id:Ee.id,properties:Ee.featureProperties},He=a.paint.get("model-rotation").evaluate(Ve,We),Ne=a.paint.get("model-scale").evaluate(Ve,We),Oe=a.paint.get("model-translation").evaluate(Ve,We),nt=a.paint.get("model-opacity").evaluate(Ve,We);Lp(a,Ee.id,We,Ee.featureProperties,Ee.nodeOverrideNames,Ee.nodeOverrides),sp(a,Ee.id,We,Ee.featureProperties,Ee.materialOverrideNames,Ee.materialOverrides),Ee.nodeOverrides.size>0&&Ee.computeBoundsAndApplyParent(),Ee.computeModelMatrix(h,He,Ne,Oe,I,S,!1);const mt=n.bA([]),dt=n.ef(Ee.position.lat,h.transform.zoom),At=n.bq([],[1,1,1/dt]);n.br(mt,mt,ge),ae.push({zScaleMatrix:At,negCameraPosMatrix:mt});for(const Ct of Ee.nodes)lf(h,Ct,Ee.matrix,h.transform.expandedFarZProjMatrix,De,me,Se,Ee.materialOverrides,nt);De++}if(me.sort(((Ee,We)=>We.depth-Ee.depth)),h.renderPass!=="shadow")mm(h,a,me,Se,ae),K();else{for(const Ee of Se)vc(Ee.mesh,Ee.nodeModelMatrix,h,a);for(const Ee of me)vc(Ee.mesh,Ee.nodeModelMatrix,h,a);K()}}},ff={line:function(h,t,a){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const y of d){const b=t.getTile(y).getBucket(h);if(b&&(b.elevationType!=="none"?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,a){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,qu(a,h)));if(d.type==="batched-model"||d.type!=="model")return;const y=d.getModels();for(const b of y)b.upload(a.context)},raster:function(h,t,a){const d=t.getSource();if(!(d instanceof va&&d.loaded()))return;const y=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const b=h.paint.get("raster-array-band")||d.getInitialBand(y);if(b==null)return;const S=t.getIds().map((I=>t.getTileByID(I)));for(const I of S)I.updateNeeded(h.id,b)&&d.prepareTile(I,y,h.id,b)},"raster-particle":function(h,t,a){const d=t.getSource();if(!(d instanceof va&&d.loaded()))return;const y=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const b=h.paint.get("raster-particle-array-band")||d.getInitialBand(y);if(b==null)return;const S=t.getIds().map((I=>t.getTileByID(I)));for(const I of S)I.updateNeeded(h.id,b)&&d.prepareTile(I,y,h.id,b)}},wu={fill:_c},hp={fill:function(h,t,a,d){if(!a.layout||a.layout.get("fill-elevation-reference")==="none"||a.paint.get("fill-opacity").constantOr(1)===0)return;const y=h.context.gl,b=new yn(y.LEQUAL,yn.ReadOnly,h.depthRangeFor3D),S=new jn({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),I=h.transform.getFreeCameraOptions().position,D=h.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const N of d){const V=t.getTile(N),K=V.getBucket(a);if(!K)continue;const X=K.elevatedStructures;if(!X||X.depthSegments.segments[0].primitiveLength===0)continue;const Q=ja(N.toUnwrapped(),I),ae=h.translatePosMatrix(N.projMatrix,V,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),ie=oi(ae,Q,0,1,0);D.draw(h,y.TRIANGLES,b,S,hr.disabled,Vn.disabled,ie,a.id,X.vertexBuffer,X.indexBuffer,X.depthSegments,a.paint,h.transform.zoom)}}};class dp{constructor(t,a,d,y,b){this.context=new xu(t,a),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=n.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const D of S)this._debugParams.enabledLayers[D]=!0;for(const D of S);this.occlusionParams=new kd,this.setup(),this.numSublayers=Ho.maxUnderzooming+Ho.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new hu(this),this._wireframeDebugCache=new uf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const I=new n.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,I,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=b,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,a){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new P(this,t));const y=this._terrain;this.transform.elevation=d?y:null,y.update(t,this.transform,a),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,y]=a.getFovAdjustedRange(this.transform._fov);if(d>y)return void(this.transform.fogCullDistSq=null);const b=d+.78*(y-d);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new P(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*n.o.devicePixelRatio,this.height=a*n.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,a=new n.bd;a.emplaceBack(0,0),a.emplaceBack(n.al,0),a.emplaceBack(0,n.al),a.emplaceBack(n.al,n.al),this.tileExtentBuffer=t.createVertexBuffer(a,n.bf.members),this.tileExtentSegments=n.bg.simpleSegment(0,0,4,2);const d=new n.bd;d.emplaceBack(0,0),d.emplaceBack(n.al,0),d.emplaceBack(0,n.al),d.emplaceBack(n.al,n.al),this.debugBuffer=t.createVertexBuffer(d,n.bf.members),this.debugSegments=n.bg.simpleSegment(0,0,4,5);const y=new n.bd;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,n.bf.members),this.viewportSegments=n.bg.simpleSegment(0,0,4,2);const b=new n.b1;b.emplaceBack(0,0,0,0),b.emplaceBack(n.al,0,n.al,0),b.emplaceBack(0,n.al,0,n.al),b.emplaceBack(n.al,n.al,n.al,n.al),this.mercatorBoundsBuffer=t.createVertexBuffer(b,n.bi.members),this.mercatorBoundsSegments=n.bg.simpleSegment(0,0,4,2);const S=new n.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const I=new n.be;for(const N of[0,1,3,2,0])I.emplaceBack(N);this.debugIndexBuffer=t.createIndexBuffer(I),this.emptyTexture=new n.T(t,new n.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.bC();const D=this.context.gl;this.stencilClearMode=new jn({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,yn.disabled,this.stencilClearMode,hr.disabled,Vn.disabled,L(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,d){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const D of d)if(this._tileClippingMaskIDs[D.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=a.id;const y=this.context,b=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(hr.disabled),y.setDepthMode(yn.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of d){const D=a.getTile(I),N=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:V,tileBoundsIndexBuffer:K,tileBoundsSegments:X}=this.getTileBoundsBuffers(D);S.draw(this,b.TRIANGLES,yn.disabled,new jn({func:b.ALWAYS,mask:0},N,255,b.KEEP,b.KEEP,b.REPLACE),hr.disabled,Vn.disabled,L(I.projMatrix),"$clipping",V,K,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new jn({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new jn({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,d=t.sort(((S,I)=>I.overscaledZ-S.overscaledZ)),y=d[d.length-1].overscaledZ,b=d[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let I=0;I<b;I++)S[I+y]=new jn({func:a.GEQUAL,mask:255},I+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[S,d]}return[{[y]:jn.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new hr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hr.unblended:hr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new hr([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new n.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new hr([a.ONE,a.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,a.ONE_MINUS_SRC_ALPHA],n.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,a,d,y=!1){if(this.depthOcclusion)return new yn(this.context.gl.GREATER,yn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return yn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new yn(d||this.context.gl.LEQUAL,a,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,a=Math.ceil(this.width),d=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&d!==0&&(this.depthFBO=new Fs(this.context,a,d,0,"texture"),this.depthTexture=new n.T(this.context,{width:a,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),t.bindTexture(t.TEXTURE_2D,b),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,d,0,0,a,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,a)=>t+a/this._fpsHistory.length),0))}render(t,a){const d=n.o.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(b).filter((vt=>{const rt=y[vt];return!(rt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[rt.type]}));let I=S(),D=!1,N=!1,V=null,K=0,X=!1;for(const vt of I){const rt=y[vt];rt.visibility!=="none"&&(rt.type==="circle"?D=!0:rt.type==="building"?(V=rt,++K):rt.type==="symbol"&&(rt.hasOcclusionOpacityProperties?N=!0:D=!0))}this.updateEmissiveMode();let Q=I.map((vt=>y[vt]));const ae=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.o.now()),this.imageManager.beginFrame();for(const vt in ae){const rt=ae[vt];rt.used&&(rt.prepare(this.context),rt.getSource().usedInConflation&&++K)}let ie=!1;for(const vt of Q)vt.isHidden(this.transform.zoom)||(vt.type==="clip"&&(ie=!0),this.prepareLayer(vt));const ge={},me={},Se={},De={},Ee={};for(const vt in ae){const rt=ae[vt];ge[vt]=rt.getVisibleCoordinates(),me[vt]=ge[vt].slice().reverse(),Se[vt]=rt.getVisibleCoordinates(!0).reverse(),De[vt]=rt.getShadowCasterCoordinates(),Ee[vt]=rt.sortCoordinatesByDistance(ge[vt])}const We=vt=>{const rt=this.style.getLayerSourceCache(vt);return rt&&rt.used?rt.getSource():null};if(K||ie||this._clippingActiveLastFrame){const vt=[],rt=[];let Nt=0;for(const Lt of Q)this.isSourceForClippingOrConflation(Lt,We(Lt))&&(vt.push(Lt),rt.push(Nt)),Nt++;if(vt&&(ie||vt.length>1)||this._clippingActiveLastFrame){ie=!1;const Lt=[];for(let li=0;li<vt.length;li++){const Mi=vt[li],ki=rt[li],Ei=this.style.getLayerSourceCache(Mi);if(!Ei||!Ei.used||!Ei.getSource().usedInConflation&&Mi.type!=="clip"&&Mi.type!=="building")continue;let _i=n.eQ,fn=n.b_.None;const nn=[];let $i=!0;if(Mi.type==="building")_i=n.eS;else if(Mi.type==="clip"){_i=ki;for(const en of Mi.layout.get("clip-layer-types"))fn|=en==="model"?n.b_.Model:en==="symbol"?n.b_.Symbol:n.b_.FillExtrusion;for(const en of Mi.layout.get("clip-layer-scope"))nn.push(en);Mi.isHidden(this.transform.zoom)?$i=!1:ie=!0}$i&&Lt.push({layer:Mi.fqid,cache:Ei,order:_i,clipMask:fn,clipScope:nn})}this.replacementSource.setSources(Lt),X=!0}}this._clippingActiveLastFrame=ie,X||this.replacementSource.clear(),this.conflationActive=X,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let vt=0;vt<Q.length;vt++){const rt=Q[vt];if(rt.visibility==="none")continue;const Nt=rt.cutoffRange();if(this.longestCutoffRange=Math.max(Nt,this.longestCutoffRange),Nt>0){const Lt=We(rt);Lt&&(this.minCutoffZoom=Math.max(Lt.minzoom,this.minCutoffZoom)),rt.minzoom&&(this.minCutoffZoom=Math.max(rt.minzoom,this.minCutoffZoom))}rt.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=vt),this._lastOcclusionLayer=vt)}const Ve=this.style&&this.style.fog;Ve?(this._fogVisible=Ve.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ve.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Se),this.opaquePassCutoff=0,I=S(),Q=I.map((vt=>y[vt])));const He=this._shadowRenderer;if(He){He.updateShadowParameters(this.transform,this.style.directionalLight);for(const vt in ae)for(const rt of ge[vt]){let Nt={min:0,max:0};this.terrain&&(Nt=this.terrain.getMinMaxForTile(rt)||Nt),He.addShadowReceiver(rt.toUnwrapped(),Nt.min,Nt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new pm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Ne=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Oe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Ne&&!this._snow&&(this._snow=new Op(this)),!Ne&&this._snow&&(this._snow.destroy(),delete this._snow),Oe&&!this._rain&&(this._rain=new df(this)),!Oe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),V){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Pp);const vt=this.style.getLayerSourceCache(V);this.buildingTileBorderManager.updateBorders(vt,V)}if(!$t.has(this.context.gl))return;this.renderPass="offscreen";for(const vt of Q){const rt=t.getLayerSourceCache(vt);if(!vt.hasOffscreenPass()||vt.isHidden(this.transform.zoom))continue;const Nt=rt?me[rt.id]:void 0;(vt.type==="custom"||vt.type==="raster"||vt.type==="raster-particle"||vt.isSky()||Nt&&Nt.length)&&this.renderLayer(this,rt,vt,Nt)}this.depthRangeFor3D=[0,1-(Q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,De)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const nt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),mt=(()=>{if(a.showOverdrawInspector)return n.ao.black;const vt=this.style.fog;if(vt&&this.transform.projection.supportsFog){const rt=this.style.getLut(vt.scope);if(!nt){const Nt=vt.properties.get("color-use-theme")==="none",Lt=vt.properties.get("color").toNonPremultipliedRenderColor(Nt?null:rt).toArray01();return new n.ao(...Lt)}if(nt){const Nt=vt.properties.get("space-color-use-theme")==="none",Lt=vt.properties.get("space-color").toNonPremultipliedRenderColor(Nt?null:rt).toArray01();return new n.ao(...Lt)}}return n.ao.transparent})();if(this.context.clear({color:mt,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&nt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const vt=Q[this.currentLayer],rt=t.getLayerSourceCache(vt);if(vt.isSky())continue;const Nt=rt?(vt.is3D(b)?Ee:me)[rt.id]:void 0;this._renderTileClippingMasks(vt,rt,Nt),this.renderLayer(this,rt,vt,Nt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&nt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const vt=Q[this.currentLayer],rt=t.getLayerSourceCache(vt);vt.isSky()&&this.renderLayer(this,rt,vt,rt?me[rt.id]:void 0)}function dt(vt,rt){let Nt;return rt&&(Nt=(vt.type==="symbol"?Se:vt.is3D(b)?Ee:me)[rt.id]),Nt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const vt=Q[this.currentLayer];if(vt.type==="raster"||vt.type==="raster-particle"){const rt=t.getLayerSourceCache(vt);this.renderLayer(this,rt,vt,dt(vt,rt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let At=0;He&&(At=He.getShadowCastingLayerCount());let Ct=!1,Dt=-1;for(let vt=0;vt<I.length;++vt){const rt=Q[vt];rt.isHidden(this.transform.zoom)||rt.is3D(b)&&(Dt=vt)}N&&Dt===-1&&(D=!0);let Kt=!1;for(;this.currentLayer<I.length;){const vt=Q[this.currentLayer],rt=t.getLayerSourceCache(vt);if(vt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(vt)){if(vt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Kt&&vt.is3D(b)&&!b){const Nt=this.currentLayer,Lt=li=>{for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const Mi=Q[this.currentLayer];if(wu[Mi.type]){const ki=this.style.getLayerSourceCache(Mi);wu[Mi.type](this,ki,Mi,dt(Mi,ki),li)}}};Lt("initialize"),Lt("reset"),this.currentLayer=Nt,Kt=!0}if(D&&!Ct&&this.terrain&&!this.transform.isOrthographic&&(Ct=!0,this.blitDepth()),N&&Dt!==-1&&this.currentLayer===Dt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(vt,rt,rt?ge[rt.id]:void 0),this.renderLayer(this,rt,vt,dt(vt,rt)),!this.terrain&&He&&At>0&&vt.hasShadowPass()&&--At==0){{this.clearStencil(),this.resetStencilClippingMasks();const Nt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const Lt=Q[this.currentLayer];if(hp[Lt.type]){const li=this.style.getLayerSourceCache(Lt);hp[Lt.type](this,li,Lt,dt(Lt,li))}}this.currentLayer=Nt}if(He.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Nt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Nt;this.currentLayer++){const Lt=Q[this.currentLayer];if(!Lt.hasLightBeamPass())continue;const li=t.getLayerSourceCache(Lt);this.renderLayer(this,li,Lt,li?me[li.id]:void 0)}this.currentLayer=Nt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Nt=this.currentLayer;this.depthOcclusion=!0;for(const Lt of this.layersWithOcclusionOpacity){this.currentLayer=Lt;const li=Q[this.currentLayer],Mi=t.getLayerSourceCache(li),ki=Mi?me[Mi.id]:void 0;this.terrain||this._renderTileClippingMasks(li,Mi,Mi?ge[Mi.id]:void 0),this.renderLayer(this,Mi,li,ki)}this.depthOcclusion=!1,this.currentLayer=Nt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let vt=null;Q.forEach((rt=>{const Nt=t.getLayerSourceCache(rt);Nt&&!rt.isHidden(this.transform.zoom)&&Nt.getVisibleCoordinates().length&&(!vt||vt.getSource().maxzoom<Nt.getSource().maxzoom)&&(vt=Nt)})),vt&&this.options.showTileBoundaries&&bi(this,vt,vt.getVisibleCoordinates(),n.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&bi(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(vt){const rt=vt.transform.padding;_d(vt,vt.transform.height-(rt.top||0),3,Rd),_d(vt,rt.bottom||0,3,Vh),da(vt,rt.left||0,3,Hu),da(vt,vt.transform.width-(rt.right||0),3,Jc);const Nt=vt.transform.centerPoint;(function(Lt,li,Mi,ki){bt(Lt,li-1,Mi-10,2,20,ki),bt(Lt,li-10,Mi-1,20,2,ki)})(vt,Nt.x,vt.transform.height-Nt.y,Dd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),X||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:a}=this.transform.projection,d=!a||!a.includes(t.type);if(ff[t.type]&&(d||this.terrain&&t.type==="custom")){const y=this.style.getLayerSourceCache(t);ff[t.type](t,y,this)}this.gpuTimingEnd()}renderLayer(t,a,d,y){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||y&&y.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Fd[d.type](t,a,d,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,d=this.context.gl;let y=this.gpuTimers[t.id];y||(y=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),y.calls++,d.beginQuery(a.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=this.context.gl,d=a.createQuery();this.deferredRenderGpuTimeQueries.push(d),a.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const d in t){const y=t[d],b=this.context.extTimerQuery,S=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),a[d]=S}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let d=0;for(const y of t)d+=a.getQueryParameter(y,a.QUERY_RESULT)/1e6,a.deleteQuery(y);return d}translatePosMatrix(t,a,d,y,b){if(!d[0]&&!d[1])return t;const S=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(S){const N=Math.sin(S),V=Math.cos(S);d=[d[0]*V-d[1]*N,d[0]*N+d[1]*V]}const I=[b?d[0]:n.ay(a,d[0],this.transform.zoom),b?d[1]:n.ay(a,d[1],this.transform.zoom),0],D=new Float32Array(16);return n.br(D,t,I),D}saveTileTexture(t){if(t.context!==this.context)return;const a=t.size[0],d=this._tileTextures[a];d?d.push(t):this._tileTextures[a]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,d){const y=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,b=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||a!==void 0&&!a||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(t,a){this.cache=this.cache||{};const d=a&&a.defines||[],y=a&&a.config,b=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(d),S=fe.cacheKey(Yd[t],t,b,y);return this.cache[S]||(this.cache[S]=new fe(this.context,t,Yd[t],y,mc[t],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){const d=this.style.directionalLight,y=this.style.ambientLight;if(d&&y){const b=((S,I,D)=>{const N=S.properties.get("direction"),V=S.properties.get("color-use-theme")==="none",K=S.properties.get("color").toNonPremultipliedRenderColor(V?null:D.getLut(S.scope)).toArray01(),X=S.properties.get("intensity"),Q=I.properties.get("color-use-theme")==="none",ae=I.properties.get("color").toNonPremultipliedRenderColor(Q?null:D.getLut(I.scope)).toArray01(),ie=I.properties.get("intensity"),ge=[N.x,N.y,N.z],me=n.dN(ae,ie),Se=n.dN(K,X);return{u_lighting_ambient_color:me,u_lighting_directional_dir:ge,u_lighting_directional_color:Se,u_ground_radiance:q(ge,Se,me)}})(d,y,this.style);a.setLightsUniformValues(t,b)}}}uploadCommonUniforms(t,a,d,y,b){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const I=S.getOpacity(this.transform.pitch),D=((N,V,K,X,Q,ae,ie,ge,me,Se,De,Ee)=>{const We=N.transform,Ve=V.properties.get("color-use-theme")==="none",He=V.properties.get("color").toNonPremultipliedRenderColor(Ve?null:N.style.getLut(V.scope)).toArray01();He[3]=X;const Ne=N.frameCounter/1e3%1,[Oe,nt]=V.properties.get("vertical-range");return{u_fog_matrix:K?We.calculateFogTileMatrix(K):Ee||N.identityMat,u_fog_range:V.getFovAdjustedRange(We._fov),u_fog_color:He,u_fog_horizon_blend:V.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Oe,nt),nt],u_fog_temporal_offset:Ne,u_frustum_tl:Q,u_frustum_tr:ae,u_frustum_br:ie,u_frustum_bl:ge,u_globe_pos:me,u_globe_radius:Se,u_viewport:De,u_globe_transition:n.aj(We.zoom),u_is_globe:+(We.projection.name==="globe")}})(this,S,d,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.o.devicePixelRatio,this.transform.height*n.o.devicePixelRatio],y);a.setFogUniformValues(t,D)}b&&a.setCutoffUniformValues(t,b.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const y of d)a[y.key]=t[y.key]||new Iu(y,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=Gt||a[1]>=Gt}setupDepthForOcclusion(t,a,d){const y=this.context,b=y.gl,S=!!d;var I;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),S||a.setTerrainUniformValues(y,d)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Lf(h,t){let a=!1,d=null;const y=()=>{d=null,a&&(h(),d=setTimeout(y,t),a=!1)};return()=>(a=!0,d||y(),d)}class $h{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Lf(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=co(t);if(this._hashName){const d=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map((S=>{const I=S.split("=")[0];return I===d?(y=!0,`${I}=${a}`):S})).filter((S=>S));return y||b.push(`${d}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(a=d)})),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some((d=>isNaN(Number(d))))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function co(h,t){const a=h.getCenter(),d=Math.round(100*h.getZoom())/100,y=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),S=Math.round(a.lng*b)/b,I=Math.round(a.lat*b)/b,D=h.getBearing(),N=h.getPitch();let V=t?`/${S}/${I}/${d}`:`${d}/${I}/${S}`;return(D||N)&&(V+="/"+Math.round(10*D)/10),N&&(V+=`/${Math.round(N)}`),V}const kf={linearity:.3,easing:n.eT(0,0,.3,1)},Od=Object.assign({deceleration:2500,maxSpeed:1400},kf),gm=Object.assign({deceleration:20,maxSpeed:1400},kf),pf=Object.assign({deceleration:1e3,maxSpeed:360},kf),ym=Object.assign({deceleration:1e3,maxSpeed:90},kf);class fp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=n.o.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(a.pan.mag()){const b=Tu(a.pan.mag(),d,Object.assign({},Od,t||{}));y.offset=a.pan.mult(b.amount/a.pan.mag()),y.center=this._map.transform.center,Ff(y,b)}if(a.zoom){const b=Tu(a.zoom,d,gm);y.zoom=this._map.transform.zoom+b.amount,Ff(y,b)}if(a.bearing){const b=Tu(a.bearing,d,pf);y.bearing=this._map.transform.bearing+n.aA(b.amount,-179,179),Ff(y,b)}if(a.pitch){const b=Tu(a.pitch,d,ym);y.pitch=this._map.transform.pitch+b.amount,Ff(y,b)}if(y.zoom||y.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Ff(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Tu(h,t,a){const{maxSpeed:d,linearity:y,deceleration:b}=a,S=n.aA(h*y/(t/1e3),-d,d),I=Math.abs(S)/(b*y);return{easing:a.easing,duration:1e3*I,amount:S*(I/2)}}class Fc extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d,y={}){const b=Pt(a.getCanvasContainer(),d),S=a.unproject(b);super(t,Object.assign({point:b,lngLat:S,originalEvent:d},y)),this._defaultPrevented=!1,this.target=a}}class Su extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){const y=t==="touchend"?d.changedTouches:d.touches,b=Bt(a.getCanvasContainer(),y),S=b.map((D=>a.unproject(D))),I=b.reduce(((D,N,V,K)=>D.add(N.div(K.length))),new n.P(0,0));super(t,{points:b,point:I,lngLats:S,lngLat:a.unproject(I),originalEvent:d}),this._defaultPrevented=!1}}class Nm extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class bo{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Nm(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Fc(t.type,this._map,t))}mouseup(t){this._map.fire(new Fc(t.type,this._map,t))}preclick(t){const a=new MouseEvent("preclick",t);this._map.fire(new Fc(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Fc(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Fc(t.type,this._map,t))}mouseover(t){this._map.fire(new Fc(t.type,this._map,t))}mouseout(t){this._map.fire(new Fc(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Su(t.type,this._map,t))}touchmove(t){this._map.fire(new Su(t.type,this._map,t))}touchend(t){this._map.fire(new Su(t.type,this._map,t))}touchcancel(t){this._map.fire(new Su(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Oo{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Fc(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Fc("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Fc(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class hl{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Un(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const d=a,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(d)||!this._box&&d.dist(y)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=Vi("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(y.x,d.x),I=Math.max(y.x,d.x),D=Math.min(y.y,d.y),N=Math.max(y.y,d.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${S}px,${D}px)`,this._box.style.width=I-S+"px",this._box.style.height=N-D+"px")}))}mouseupWindow(t,a){if(!this._active)return;const d=this._startPos,y=a;if(d&&t.button===0){if(this.reset(),mn(),d.x!==y.x||d.y!==y.y)return this._map.fire(new n.z("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(d,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),rr(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new n.z(t,{originalEvent:a}))}}function mf(h,t){const a={};for(let d=0;d<h.length;d++)a[h[d].identifier]=t[d];return a}class pp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=(function(y){const b=new n.P(0,0);for(const S of y)b._add(S);return b.div(y.length)})(a),this.touches=mf(d,a)))}touchmove(t,a,d){if(this.aborted||!this.centroid)return;const y=mf(d,a);for(const b in this.touches){const S=y[b];(!S||S.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,a,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Bd{constructor(t){this.singleTap=new pp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,d){this.singleTap.touchstart(t,a,d)}touchmove(t,a,d){this.singleTap.touchmove(t,a,d)}touchend(t,a,d){const y=this.singleTap.touchend(t,a,d);if(y){const b=t.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(b&&S||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class vm{constructor(){this._zoomIn=new Bd({numTouches:1,numTaps:2}),this._zoomOut=new Bd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,d){this._zoomIn.touchstart(t,a,d),this._zoomOut.touchstart(t,a,d)}touchmove(t,a,d){this._zoomIn.touchmove(t,a,d),this._zoomOut.touchmove(t,a,d)}touchend(t,a,d){const y=this._zoomIn.touchend(t,a,d),b=this._zoomOut.touchend(t,a,d);return y?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Of={0:1,2:2},_f={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Nd{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const d=Ni(t);this._correctButton(t,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(t,a){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&(function(y,b){const S=Of[b];return y.buttons===void 0||(y.buttons&S)!==S})(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(t){this._lastPoint&&Ni(t)===this._eventButton&&(this._moved&&mn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bp extends Nd{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Np extends Nd{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?_f[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const d=.8*(a.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class gf extends Nd{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?_f[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const d=-.5*(a.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class jp{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),n.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,a,d){return this._calculateTransform(t,a,d)}touchmove(t,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!n.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,d)}}touchend(t,a,d){this._calculateTransform(t,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,d){d.length>0&&(this._active=!0);const y=mf(d,a),b=new n.P(0,0),S=new n.P(0,0);let I=0;for(const N in y){const V=y[N],K=this._touches[N];K&&(b._add(V),S._add(V.sub(K)),I++,y[N]=V)}if(this._touches=y,I<this._minTouches||!S.mag())return;const D=S.div(I);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(I),panDelta:D}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Vi("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class mp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,d){return{}}touchstart(t,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,d){const y=this._firstTwoTouches;if(!y)return;t.preventDefault();const[b,S]=y,I=_p(d,a,b),D=_p(d,a,S);if(!I||!D)return;const N=this._aroundCenter?null:I.add(D).div(2);return this._move([I,D],N,t)}touchend(t,a,d){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,S=_p(d,a,y),I=_p(d,a,b);S&&I||(this._active&&mn(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _p(h,t,a){for(let d=0;d<h.length;d++)if(h[d].identifier===a)return t[d]}function jm(h,t){return Math.log2(h/t)}class Vm extends mp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(jm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:jm(this._distance,d),pinchAround:a}}}function xm(h,t){return 180*h.angleWith(t)/Math.PI}class Ss extends mp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xm(this._vector,d),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const y=xm(t,d);return Math.abs(y)<a}}function ph(h){return Math.abs(h.y)>Math.abs(h.x)}class Um extends mp{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,ph(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,d){const y=this._lastPoints;if(!y)return;const b=t[0].sub(y[0]),S=t[1].sub(y[1]);return this._map._cooperativeGestures&&!n.eU()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(t,a,d){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,b=a.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const S=t.y>0==a.y>0;return ph(t)&&ph(a)&&S}}const Vp={panStep:100,bearingStep:15,pitchStep:10};class yf{constructor(){const t=Vp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,d=0,y=0,b=0,S=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),S=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,y=0),{cameraAnimation:I=>{const D=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:gp,zoom:a?Math.round(D)+a*(t.shiftKey?2:1):D,bearing:I.getBearing()+d*this._bearingStep,pitch:I.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:I.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function gp(h){return h*(2-h)}const Up=4.000244140625,bm=1/450;class $u{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=bm,n.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=n.o.now(),y=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Up==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Pt(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>Up?this._wheelZoomRate:this._defaultZoomRate;let V=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&V!==0&&(V=1/V);const K=a(),X=Math.pow(2,K),Q=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):X;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(Q*V))),this._type==="wheel"&&(this._startZoom=K,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),y=this._startZoom,b=this._easing;let S,I=!1;if(this._type==="wheel"&&y&&b){const N=Math.min((n.o.now()-this._lastWheelEventTime)/200,1),V=b(N);S=n.ak(y,d,V),N<1?this._frameId||(this._frameId=!0):I=!0}else S=d,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let D=S-a();return D*this._lastDelta<0&&(D=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:D,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=n.eV;if(this._prevEase){const d=this._prevEase,y=(n.o.now()-d.start)/d.duration,b=d.easing(y+.01)-d.easing(y),S=.27/Math.sqrt(b*b+1e-4)*.01,I=Math.sqrt(.0729-S*S);a=n.eT(S,I,.25,1)}return this._prevEase={start:n.o.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Vi("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class mh{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class wm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bo{constructor(){this._tap=new Bd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,a,d))}touchmove(t,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const y=a[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,d)}touchend(t,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,a,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ql{constructor(t,a,d){this._el=t,this._mousePan=a,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Bf{constructor(t,a,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nf{constructor(t,a,d,y){this._el=t,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _h=h=>h.zoom||h.drag||h.pitch||h.rotate;class jf extends n.z{}class uo{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const d=n.av([],a,t);this.radius=n.ag(d[2]<0?n.eX([],d,this.constants):[d[0],d[1],0])}projectRay(t){n.eX(t,t,this.constants),n.aw(t,t),n.eY(t,t,this.constants);const a=n.c5([],t,this.radius);if(a[2]>0){const d=n.c5([],[0,0,1],n.bJ(a,[0,0,1])),y=n.c5([],n.aw([],[a[0],a[1],0]),this.radius),b=n.d8([],a,n.c5([],n.av([],n.d8([],y,d),a),2));a[0]=b[0],a[1]=b[1]}return a}}function Tm(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class h_{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fp(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new uo,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),n.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,S]of this._listeners){const I=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,I,S)}}destroy(){for(const[t,a,d]of this._listeners){const y=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,y,d)}}_addDefaultHandlers(t){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new bo(a,t));const y=a.boxZoom=new hl(a,t);this._add("boxZoom",y);const b=new vm,S=new wm;a.doubleClickZoom=new mh(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const I=new Bo;this._add("tapDragZoom",I);const D=a.touchPitch=new Um(a);this._add("touchPitch",D);const N=new Np(t),V=new gf(t);a.dragRotate=new Bf(t,N,V),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const K=new Bp(t),X=new jp(a,t);a.dragPan=new Ql(d,K,X),this._add("mousePan",K),this._add("touchPan",X,["touchZoom","touchRotate"]);const Q=new Ss,ae=new Vm;a.touchZoomRotate=new Nf(d,ae,Q,I),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Oo(a));const ie=a.scrollZoom=new $u(a,this);this._add("scrollZoom",ie,["mousePan"]);const ge=a.keyboard=new yf;this._add("keyboard",ge);for(const me of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[me]&&a[me].enable(t[me])}_add(t,a,d){this._handlers.push({handlerName:t,handler:a,allowed:d}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_h(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,d){for(const y in t)if(y!==d&&(!a||a.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const d of t)this._el.contains(d.target)&&a.push(d);return a}handleEvent(t,a){this._updatingCamera=!0;const d=t.type==="renderFrame",y=d?void 0:t,b={needsRenderFrame:!1},S={},I={},D=t.touches?this._getMapTouches(t.touches):void 0,N=D?Bt(this._el,D):d?void 0:Pt(this._el,t);for(const{handlerName:X,handler:Q,allowed:ae}of this._handlers){if(!Q.isEnabled())continue;let ie;this._blockedByActive(I,ae,X)?Q.reset():Q[a||t.type]&&(ie=Q[a||t.type](t,N,D),this.mergeHandlerResult(b,S,ie,X,y),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||Q.isActive())&&(I[X]=Q)}const V={};for(const X in this._previousActiveHandlers)I[X]||(V[X]=y);this._previousActiveHandlers=I,(Object.keys(V).length||Tm(b))&&(this._changes.push([b,S,V]),this._triggerRenderFrame()),(Object.keys(I).length||Tm(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=b;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))}mergeHandlerResult(t,a,d,y,b){if(!d)return;Object.assign(t,d);const S={handlerName:y,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(a.zoom=S),d.panDelta!==void 0&&(a.drag=S),d.pitchDelta!==void 0&&(a.pitch=S),d.bearingDelta!==void 0&&(a.rotate=S)}_applyChanges(){const t={},a={},d={};for(const[y,b,S]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.aroundCoord!==void 0&&(t.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),Object.assign(a,b),Object.assign(d,S);this._updateMapTransform(t,a,d),this._changes=[]}_updateMapTransform(t,a,d){const y=this._map,b=y.transform,S=Se=>[Se.x,Se.y,Se.z];if((Se=>{const De=this._eventsInProgress.drag;return De&&!this._handlersById[De.handlerName].isActive()})()&&!Tm(t)){const Se=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Se!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!Tm(t))return void this._fireEvents(a,d,!0);let{panDelta:I,zoomDelta:D,bearingDelta:N,pitchDelta:V,around:K,aroundCoord:X,pinchAround:Q}=t;b._isCameraConstrained&&(D>0&&(D=0),b._isCameraConstrained=!1),Q!==void 0&&(K=Q),(D||(Se=>a[Se]&&!this._eventsInProgress[Se])("drag"))&&K&&(this._dragOrigin=S(b.pointCoordinate3D(K)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),K=K||y.transform.centerPoint,N&&(b.bearing+=N),V&&(b.pitch+=V),b._updateCameraState();const ae=[0,0,0];if(I)if(b.projection.name==="mercator"){const Se=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(K).dir),De=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(K.sub(I)).dir);ae[0]=De[0]-Se[0],ae[1]=De[1]-Se[1]}else{const Se=b.pointCoordinate(K);if(b.projection.name==="globe"){I=I.rotate(-b.angle);const De=b._pixelsPerMercatorPixel/b.worldSize;ae[0]=-I.x*n.eW(n.a$(Se.y))*De,ae[1]=-I.y*n.eW(b.center.lat)*De}else{const De=b.pointCoordinate(K.sub(I));Se&&De&&(ae[0]=De.x-Se.x,ae[1]=De.y-Se.y)}}const ie=b.zoom,ge=[0,0,0];if(D){const Se=S(X||b.pointCoordinate3D(K)),De={dir:n.aw([],n.av([],Se,b._camera.position))};if(De.dir[2]<0){const Ee=b.zoomDeltaToMovement(Se,D);n.c5(ge,De.dir,Ee)}}const me=n.d8(ae,ae,ge);b._translateCameraConstrained(me),D&&Math.abs(b.zoom-ie)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,d,!0)}_fireEvents(t,a,d){const y=_h(this._eventsInProgress),b=_h(t),S={};for(const V in t){const{originalEvent:K}=t[V];this._eventsInProgress[V]||(S[`${V}start`]=K),this._eventsInProgress[V]=t[V]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const V in S)this._fireEvent(V,S[V]);b&&this._fireEvent("move",b.originalEvent);for(const V in t){const{originalEvent:K}=t[V];this._fireEvent(V,K)}const I={};let D;for(const V in this._eventsInProgress){const{handlerName:K,originalEvent:X}=this._eventsInProgress[V];this._handlersById[K].isActive()||(delete this._eventsInProgress[V],D=a[K]||X,I[`${V}end`]=D)}for(const V in I)this._fireEvent(V,I[V]);const N=_h(this._eventsInProgress);if(d&&(y||b)&&!N){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),K=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;V?(K(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:D})):(this._map.fire(new n.z("moveend",{originalEvent:D})),K(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new n.z(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new jf("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Gp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Vf extends n.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,n.aY(["_renderFrameCallback"],this)}getCenter(){return new n.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,d){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},a),d)}panTo(t,a,d){return this.easeTo(Object.assign({center:t},a),d)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,d){return this.easeTo(Object.assign({zoom:t},a),d)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,d){return this.easeTo(Object.assign({bearing:t},a),d)}resetNorth(t,a){return this.rotateTo(0,Object.assign({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=n.aI.convert(t);const d=a&&a.bearing||0,y=a&&a.pitch||0,b=t.getNorthWest(),S=t.getSouthEast();return this._cameraForBounds(this.transform,b,S,d,y,a)}_extendPadding(t){const a={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},a,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){const d=a.max[0]-a.min[0],y=a.max[1]-a.min[1];return d/y>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):y/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,d,y,b,S){const I=t.clone(),D=this._extendCameraOptions(S);I.bearing=y,I.pitch=b;const N=n.aT.convert(a),V=n.aT.convert(d),K=.5*(N.lat+V.lat),X=.5*(N.lng+V.lng),Q=n.eZ(K,X),ae=n.aw([],Q),ie=n.aw([],n.bI([],ae,[0,1,0])),ge=n.bI([],ie,ae),me=[ie[0],ie[1],ie[2],0,ge[0],ge[1],ge[2],0,ae[0],ae[1],ae[2],0,0,0,0,1],Se=[Q,n.eZ(N.lat,N.lng),n.eZ(V.lat,N.lng),n.eZ(V.lat,V.lng),n.eZ(N.lat,V.lng),n.eZ(K,N.lng),n.eZ(K,V.lng),n.eZ(N.lat,X),n.eZ(V.lat,X)];let De=n.d9.fromPoints(Se.map((Lt=>[n.bJ(ie,Lt),n.bJ(ge,Lt),n.bJ(ae,Lt)])));const Ee=n.af([],De.center,me);n.e_(Ee)===0&&n.e$(Ee,0,0,1),n.aw(Ee,Ee),n.c5(Ee,Ee,n.aD),I.center=n.f0(Ee);const We=I.getWorldToCameraMatrix(),Ve=n.bl(new Float64Array(16),We);De=n.d9.applyTransform(De,n.aB([],We,me));const He=this._extendAABB(De,I,D,y);if(!He)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");De=He,n.af(Ee,Ee,We);const Ne=.5*(De.max[2]-De.min[2]),Oe=this._minimumAABBFrustumDistance(I,De),nt=n.c5([],[0,0,1],Ne),mt=n.d8(nt,Ee,nt),dt=Oe+(I.pitch===0?0:n.bG(Ee,mt)),At=I.globeCenterInViewSpace,Ct=n.av([],Ee,[At[0],At[1],At[2]]);n.aw(Ct,Ct),n.c5(Ct,Ct,dt);const Dt=n.d8([],Ee,Ct);n.af(Dt,Dt,Ve);const Kt=n.eM/n.aD,vt=n.ag(Dt),rt=n.cf(Math.max(vt*Kt-n.eM,Number.EPSILON),0),Nt=Math.min(I.zoomFromMercatorZAdjusted(rt),D.maxZoom);return Nt>.5*(n.c_+n.cL)?(I.setProjection({name:"mercator"}),I.zoom=Nt,this._cameraForBounds(I,a,d,y,b,S)):{center:I.center,zoom:Nt,bearing:y,pitch:b}}_extendAABB(t,a,d,y){const b=.5*((d.padding.left||0)+(d.padding.right||0)),S=.5*((d.padding.top||0)+(d.padding.bottom||0)),I=S,D=b,N=b,V=S,K=a.width-(D+N),X=a.height-(I+V),Q=n.av([],t.max,t.min),ae=Math.min(K/Q[0],X/Q[1]),ie=Math.min(a.scaleZoom(a.scale*ae),d.maxZoom);if(isNaN(ie))return null;const ge=a.scale/a.zoomScale(ie),me=new n.d9([t.min[0]-D*ge,t.min[1]-V*ge,t.min[2]],[t.max[0]+N*ge,t.max[1]+I*ge,t.max[2]]),Se=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new n.P(d.offset.x,d.offset.y):n.P.convert(d.offset)).rotate(-n.an(y));return me.center[0]-=Se.x*ge,me.center[1]+=Se.y*ge,me}queryTerrainElevation(t,a){const d=this.transform.elevation;return d?(a=Object.assign({},{exaggerated:!0},a),d.getAtPoint(n.ae.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,d,y,b,S){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,d,y,b,S);const I=t.clone(),D=this._extendCameraOptions(S);I.bearing=y,I.pitch=b;const N=n.aT.convert(a),V=n.aT.convert(d),K=new n.aT(N.lng,V.lat),X=new n.aT(V.lng,N.lat),Q=I.project(N),ae=I.project(V),ie=this.queryTerrainElevation(N),ge=this.queryTerrainElevation(V),me=this.queryTerrainElevation(K),Se=this.queryTerrainElevation(X),De=[[Q.x,Q.y,Math.min(ie||0,ge||0,me||0,Se||0)],[ae.x,ae.y,Math.max(ie||0,ge||0,me||0,Se||0)]];let Ee=n.d9.fromPoints(De);const We=I.getWorldToCameraMatrix(),Ve=n.bl(new Float64Array(16),We);Ee=n.d9.applyTransform(Ee,We);const He=this._extendAABB(Ee,I,D,y);if(!He)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Ee=He;const Ne=.5*n.av([],Ee.max,Ee.min)[2],Oe=this._minimumAABBFrustumDistance(I,Ee),nt=[0,0,1,0];n.aC(nt,nt,We),n.f1(nt,nt);const mt=n.c5([],nt,Oe+Ne),dt=n.d8([],Ee.center,mt);n.af(Ee.center,Ee.center,Ve),n.af(dt,dt,Ve);const At=I.unproject(new n.P(Ee.center[0],Ee.center[1])),Ct=n.f2(I.projection,At),Dt=Math.pow(2,Ct),Kt=Math.min(I._zoomFromMercatorZ(dt[2]*I.pixelsPerMeter*Dt/I.worldSize),D.maxZoom);return I.mercatorFromTransition&&Kt<.5*(n.c_+n.cL)?(I.setProjection({name:"globe"}),I.zoom=Kt,this._cameraForBounds(I,a,d,y,b,S)):{center:At,zoom:Kt,bearing:y,pitch:b}}fitBounds(t,a,d){const y=this.cameraForBounds(t,a);return this._fitInternal(y,a,d)}fitScreenCoordinates(t,a,d,y,b){const S=n.P.convert(t),I=n.P.convert(a),D=new n.P(Math.min(S.x,I.x),Math.min(S.y,I.y)),N=new n.P(Math.max(S.x,I.x),Math.max(S.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,I))return this;const V=this.transform.pointLocation3D(D),K=this.transform.pointLocation3D(N),X=this.transform.pointLocation3D(new n.P(D.x,N.y)),Q=this.transform.pointLocation3D(new n.P(N.x,D.y)),ae=[Math.min(V.lng,K.lng,X.lng,Q.lng),Math.min(V.lat,K.lat,X.lat,Q.lat)],ie=[Math.max(V.lng,K.lng,X.lng,Q.lng),Math.max(V.lat,K.lat,X.lat,Q.lat)],ge=y&&y.pitch?y.pitch:this.getPitch(),me=this._cameraForBounds(this.transform,ae,ie,d,ge,y);return this._fitInternal(me,y,b)}_fitInternal(t,a,d){return t?(a=Object.assign(t,a)).linear?this.easeTo(a,d):this.flyTo(a,d):this}jumpTo(t,a){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,S=!1;"zoom"in t&&d.zoom!==+t.zoom&&(y=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=n.aT.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(b=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(S=!0,d.pitch=+t.pitch);const I=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(I))if(t.retainPadding===!1){const D=d.clone();D.padding=I,d.setLocationAtPoint(d.center,D.centerPoint)}else d.padding=I;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new n.z("movestart",a)).fire(new n.z("move",a)),y&&this.fire(new n.z("zoomstart",a)).fire(new n.z("zoom",a)).fire(new n.z("zoomend",a)),b&&this.fire(new n.z("rotatestart",a)).fire(new n.z("rotate",a)).fire(new n.z("rotateend",a)),S&&this.fire(new n.z("pitchstart",a)).fire(new n.z("pitch",a)).fire(new n.z("pitchend",a)),this.fire(new n.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Gp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return n.w(Gp),this;this.stop();const y=d.zoom,b=d.pitch,S=d.bearing;d.setFreeCameraOptions(t);const I=y!==d.zoom,D=b!==d.pitch,N=S!==d.bearing;return this.fire(new n.z("movestart",a)).fire(new n.z("move",a)),I&&this.fire(new n.z("zoomstart",a)).fire(new n.z("zoom",a)).fire(new n.z("zoomend",a)),N&&this.fire(new n.z("rotatestart",a)).fire(new n.z("rotate",a)).fire(new n.z("rotateend",a)),D&&this.fire(new n.z("pitchstart",a)).fire(new n.z("pitch",a)).fire(new n.z("pitchend",a)),this.fire(new n.z("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:n.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),I=this.getPadding(),D="zoom"in t?+t.zoom:y,N="bearing"in t?this._normalizeBearing(t.bearing,b):b,V="pitch"in t?+t.pitch:S,K=this._extendPadding(t.padding),X=n.P.convert(t.offset);let Q,ae,ie;if(d.projection.name==="globe"){const nt=n.ae.fromLngLat(d.center),mt=X.rotate(-d.angle);nt.x+=mt.x/d.worldSize,nt.y+=mt.y/d.worldSize;const dt=nt.toLngLat(),At=n.aT.convert(t.center||dt);this._normalizeCenter(At),Q=d.centerPoint.add(mt),ae=new n.P(nt.x,nt.y).mult(d.worldSize),ie=new n.P(n.aF(At.lng),n.aJ(At.lat)).mult(d.worldSize).sub(ae)}else{Q=d.centerPoint.add(X);const nt=d.pointLocation(Q),mt=n.aT.convert(t.center||nt);this._normalizeCenter(mt),ae=d.project(nt),ie=d.project(mt).sub(ae)}const ge=d.zoomScale(D-y);let me,Se;t.around&&(me=n.aT.convert(t.around),Se=d.locationPoint(me));const De=this._zooming||D!==y,Ee=this._rotating||b!==N,We=this._pitching||V!==S,Ve=!d.isPaddingEqual(K),He=t.retainPadding===!1?d.clone():d,Ne=nt=>mt=>{if(De&&(nt.zoom=n.ak(y,D,mt)),Ee&&(nt.bearing=n.ak(b,N,mt)),We&&(nt.pitch=n.ak(S,V,mt)),Ve&&(He.interpolatePadding(I,K,mt),Q=He.centerPoint.add(X)),me)nt.setLocationAtPoint(me,Se);else{const dt=nt.zoomScale(nt.zoom-y),At=D>y?Math.min(2,ge):Math.max(.5,ge),Ct=Math.pow(At,1-mt),Dt=nt.unproject(ae.add(ie.mult(mt*Ct)).mult(dt));nt.setLocationAtPoint(nt.renderWorldCopies?Dt.wrap():Dt,Q)}return t.preloadOnly||this._fireMoveEvents(a),nt};if(t.preloadOnly){const nt=this._emulate(Ne,t.duration,d);return this._preloadTiles(nt),this}const Oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=De,this._rotating=Ee,this._pitching=We,this._padding=Ve,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Oe),this._ease(Ne(d),(nt=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(a,nt)}),t),this}_prepareEase(t,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||d.moving||this.fire(new n.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new n.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new n.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new n.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.z("move",t)),this._zooming&&this.fire(new n.z("zoom",t)),this._rotating&&this.fire(new n.z("rotate",t)),this._pitching&&this.fire(new n.z("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new n.z("zoomend",t)),y&&this.fire(new n.z("rotateend",t)),b&&this.fire(new n.z("pitchend",t)),this.fire(new n.z("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const Lt=n.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Lt,a)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:n.eV},t);const d=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),I=this.getPadding(),D="zoom"in t?n.aA(+t.zoom,d.minZoom,d.maxZoom):y,N="bearing"in t?this._normalizeBearing(t.bearing,b):b,V="pitch"in t?+t.pitch:S,K=this._extendPadding(t.padding),X=d.zoomScale(D-y),Q=n.P.convert(t.offset);let ae=d.centerPoint.add(Q);const ie=d.pointLocation(ae),ge=n.aT.convert(t.center||ie);this._normalizeCenter(ge);const me=d.project(ie),Se=d.project(ge).sub(me);let De=t.curve;const Ee=Math.max(d.width,d.height),We=Ee/X,Ve=Se.mag();if("minZoom"in t){const Lt=n.aA(Math.min(t.minZoom,y,D),d.minZoom,d.maxZoom),li=Ee/d.zoomScale(Lt-y);De=Math.sqrt(li/Ve*2)}const He=De*De;function Ne(Lt){const li=(We*We-Ee*Ee+(Lt?-1:1)*He*He*Ve*Ve)/(2*(Lt?We:Ee)*He*Ve);return Math.log(Math.sqrt(li*li+1)-li)}function Oe(Lt){return(Math.exp(Lt)-Math.exp(-Lt))/2}function nt(Lt){return(Math.exp(Lt)+Math.exp(-Lt))/2}const mt=Ne(0);let dt=function(Lt){return nt(mt)/nt(mt+De*Lt)},At=function(Lt){return Ee*((nt(mt)*(Oe(li=mt+De*Lt)/nt(li))-Oe(mt))/He)/Ve;var li},Ct=(Ne(1)-mt)/De;if(Math.abs(Ve)<1e-6||!isFinite(Ct)){if(Math.abs(Ee-We)<1e-6)return this.easeTo(t,a);const Lt=We<Ee?-1:1;Ct=Math.abs(Math.log(We/Ee))/De,At=function(){return 0},dt=function(li){return Math.exp(Lt*De*li)}}t.duration="duration"in t?+t.duration:1e3*Ct/("screenSpeed"in t?+t.screenSpeed/De:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Dt=b!==N,Kt=V!==S,vt=!d.isPaddingEqual(K),rt=t.retainPadding===!1?d.clone():d,Nt=Lt=>li=>{const Mi=li*Ct,ki=1/dt(Mi);Lt.zoom=li===1?D:y+Lt.scaleZoom(ki),Dt&&(Lt.bearing=n.ak(b,N,li)),Kt&&(Lt.pitch=n.ak(S,V,li)),vt&&(rt.interpolatePadding(I,K,li),ae=rt.centerPoint.add(Q));const Ei=li===1?ge:Lt.unproject(me.add(Se.mult(At(Mi))).mult(ki));return Lt.setLocationAtPoint(Lt.renderWorldCopies?Ei.wrap():Ei,ae),Lt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),Lt};if(t.preloadOnly){const Lt=this._emulate(Nt,t.duration,d);return this._preloadTiles(Lt),this}return this._zooming=!0,this._rotating=Dt,this._pitching=Kt,this._padding=vt,this._prepareEase(a,!1),this._ease(Nt(d),(()=>this._afterEase(a)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,a,d){d.animate===!1||d.duration===0?(t(1),a()):(this._easeStart=n.o.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.o.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=n.bT(t,-180,180);const d=Math.abs(t-a);return Math.abs(t-360-a)<d&&(t-=360),Math.abs(t+360-a)<d&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const d=t.lng-a.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,d){const y=Math.ceil(15*a/1e3),b=[],S=t(d.clone());for(let I=0;I<=y;I++){const D=S(I/y);b.push(D.clone())}return b}_preloadTiles(t,a){}}class Oc{constructor(t={}){this.options=t,n.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Vi("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const y=Vi("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",d),this._innerContainer=Vi("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){const d=a.reduce(((y,b,S)=>(b.value&&(y+=`${b.key}=${b.value}${S<a.length-1?"&":""}`),y)),"?");t.href=`${n.e.FEEDBACK_URL}/${d}#${co(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const a=this._map.style._mergedSourceCaches;for(const y in a){const b=a[y];if(b.used){const S=b.getSource();S.attribution&&t.indexOf(S.attribution)<0&&t.push(S.attribution)}}t.sort(((y,b)=>y.length-b.length)),t=t.filter(((y,b)=>{for(let S=b+1;S<t.length;S++)if(t[S].indexOf(y)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.map((y=>(function(b){const S=new DOMParser().parseFromString(b,"text/html");return Array.from(S.body.querySelectorAll("*")).forEach((I=>{const D=I.textContent||"";if(I.tagName!=="A")return void I.replaceWith(S.createTextNode(D));const N=I.getAttribute("href");if(!N||!/^(https?:|mailto:)/i.test(N))return void I.replaceWith(S.createTextNode(D));const V=S.createElement("a");V.href=N,V.textContent=D,V.rel="noopener nofollow";const K=I.getAttribute("class");K&&(V.className=K),I.replaceWith(V)})),S.body.innerHTML})(y))).join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Uf{constructor(){n.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Vi("div","mapboxgl-ctrl");const a=Vi("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const d=t[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Gf{constructor(){n.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(a=>this._onIndoorUpdate(a))),this._container}_createButton(t,a){const d=Vi("button",t,this._container);return d.type="button",d.addEventListener("click",a),d}_createSeparator(){return Vi("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,a){this._map&&(t.setAttribute("aria-label",a),t.textContent=a)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const a=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",a&&Array.from(this._container.children).forEach((d=>d.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const a=this._map;this._model&&a&&a._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));Vi("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,a){for(let d=0;d<t.length;d++){const y=t[d],b=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(y.id)}));this._setButtonTitle(b,y.zIndex.toString()),this._model&&y.id===this._model.selectedFloorId&&a&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),d<t.length-1&&this._createSeparator()}}}class Zu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const y of d)if(y.id===t)return void(y.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ec{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=n.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,d){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+d}}const yd={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class vd extends n.z{constructor(t,a,d,y){const{point:b,lngLat:S,originalEvent:I,target:D}=t;super(t.type,{point:b,lngLat:S,originalEvent:I,target:D}),this.preventDefault=()=>{t.preventDefault()},this.id=a,this.interaction=d,this.feature=y}}class gh{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=a.filter;let y=a.type;d&&this.filters.set(t,n.b6(d)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,a)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(t,a),this.typeById.set(t,y)}get(t){const a=this.typeById.get(t);if(!a)return;const d=this.interactionsByType.get(a);return d?d.get(t):void 0}remove(t){const a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(a);d&&(d.delete(t),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(a,this.handleType))}queryTargets(t,a){const d=[];for(const[y,b]of a)b.target&&d.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());a.length&&(t.type="mouseenter",this.handleType(t,a));const d=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||d.set(b.id,b);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const a=Array.from(this.hoveredFeatures.values()).map((({feature:d})=>d));a.length&&(t.type="mouseleave",this.handleType(t,a)),this.hoveredFeatures.clear()}handleType(t,a){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void n.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(t.type)).reverse(),b=!!a;a=a||this.queryTargets(t.point,y);let S=!1;const I=new Set;for(const D of a){for(const[N,V]of y){if(!V.target)continue;const K=D.variants?D.variants[N]:null;if(K){for(const X of K){if(Ah(X,D,I,N))continue;const Q=new n.dx(D,X),ae=Vc(X,D,N);b&&Q.id!==void 0&&(Q.state=this.map.getFeatureState(Q));const ie=d?this.prevHoveredFeatures.get(ae):null,ge=new vd(t,N,V,Q),me=ie?ie.stop:V.handler(ge);if(d&&this.hoveredFeatures.set(ae,{feature:D,stop:me}),me!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[D,N]of y){const{handler:V,target:K}=N;if(!K&&V(new vd(t,D,N,null))!==!1)break}}}function Sm(h,t){if(Array.isArray(h)&&Array.isArray(t)){const a=new Set(h),d=new Set(t);return a.size===d.size&&h.every((y=>d.has(y)))}return n.by(h,t)}const Hp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},qp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Gm{constructor(t,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Np({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new gf({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),Un()}move(t,a){const d=this.map,y=this.mouseRotate.mousemoveWindow(t,a),b=y&&y.bearingDelta;if(b&&d.setBearing(d.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(t,a),I=S&&S.pitchDelta;I&&d.setPitch(d.getPitch()+I)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){rr(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Pt(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Pt(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Bt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Bt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function yh(h,t,a){if(h=new n.aT(h.lng,h.lat),t){const d=new n.aT(h.lng-360,h.lat),y=new n.aT(h.lng+360,h.lat),b=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),S=a.locationPoint3D(h).distSqr(t),I=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint3D(d).distSqr(t)<S&&(I||Math.abs(d.lng-a.center.lng)<b)?h=d:a.locationPoint3D(y).distSqr(t)<S&&(I||Math.abs(y.lng-a.center.lng)<b)&&(h=y)}for(;Math.abs(h.lng-a.center.lng)>180;){const d=a.locationPoint3D(h);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const ys={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},bc={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class $p extends n.E{constructor(t,a){super(),(t instanceof HTMLElement||a)&&(t=Object.assign({element:t},a)),n.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:y="#3FB1CE",scale:b=1,draggable:S=!1,clickTolerance:I=0,rotation:D=bc.rotation,rotationAlignment:N=bc.rotationAlignment,pitchAlignment:V=bc.pitchAlignment,occludedOpacity:K=bc.occludedOpacity,altitude:X=bc.altitude}=t||{};this._anchor=d,this._color=y,this._scale=b,this._draggable=S,this._clickTolerance=I,this._rotation=D,this._rotationAlignment=N,this._pitchAlignment=V,this._occludedOpacity=K,this._altitude=X,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=n.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(ie=>{ie.preventDefault()})),this._element.addEventListener("mousedown",(ie=>{ie.preventDefault()}));const Q=this._element.classList;for(const ie in ys)Q.remove(`mapboxgl-marker-anchor-${ie}`);Q.add(`mapboxgl-marker-anchor-${this._anchor}`);const ae=t&&t.className?t.className.trim().split(/\s+/):[];Q.add(...ae),this._popup=null}_createDefaultMarker(){const t=Vi("div"),a=qi("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=qi("radialGradient",{id:"shadowGradient"},qi("defs",{},a));qi("stop",{offset:"10%","stop-opacity":.4},d),qi("stop",{offset:"100%","stop-opacity":.05},d),qi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return qi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),qi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),qi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||bc.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,d=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const d=t.unproject(a,this._altitude),y=t.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(d)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(a,this._altitude);let y;t._showingGlobe()&&n.f5(t.transform,this._lngLat)?y=0:(y=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ys[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!t||d!=="map")return"";if(!a._showingGlobe()){const D=a.getPitch();return D?`rotateX(${D}deg)`:""}const y=n.cX(n.f6(a.transform,this._lngLat)),b=t.sub(n.f7(a.transform)),S=Math.abs(b.x)+Math.abs(b.y);if(S===0)return"";const I=y/S;return`rotateX(${-b.y*I}deg) rotateY(${b.x*I}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let d=0;const y=this.getRotationAlignment();if(y==="map")if(a._showingGlobe()){const b=a.project(new n.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=a.project(new n.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);d=n.cX(Math.atan2(S.y,S.x))-90}else d=-a.getBearing();else if(y==="horizon"){const b=n.ah(4,6,a.getZoom()),S=n.f7(a.transform);S.y+=b*a.transform.height;const I=t.sub(S),D=n.cX(Math.atan2(I.y,I.x));d=(D>90?D-270:D+90)*(1-b)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=yh(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),a._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const a=this._map;if(!a)return;const d=this._pointerdownPos,y=this._positionDelta;if(d&&y){if(!this._isDragging){const b=this._clickTolerance||a._clickTolerance;if(t.point.dist(d)<b)return;this._isDragging=!0}this._pos=t.point.sub(y),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.z("dragstart"))),this.fire(new n.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.z("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,d=this._pos;a&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||bc.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||bc.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||bc.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||bc.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const jl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},yp={maxWidth:100,unit:"metric"},Em={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Wu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Es=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function bl(h=new n.P(0,0),t="bottom"){if(typeof h=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new n.P(0,h);case"top-left":return new n.P(a,a);case"top-right":return new n.P(-a,a);case"bottom":return new n.P(0,-h);case"bottom-left":return new n.P(a,-a);case"bottom-right":return new n.P(-a,-a);case"left":return new n.P(h,0);case"right":return new n.P(-h,0)}return new n.P(0,0)}return h instanceof n.P||Array.isArray(h)?n.P.convert(h):n.P.convert(h[t]||[0,0])}return{version:ke,supported:Ui.supported,setRTLTextPlugin:n.fb,getRTLTextPluginStatus:n.fa,Map:class extends Vf{constructor(h){pt.mark(Fe.create);const t=h;if((h=Object.assign({},Hp,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&n.f3(window)&&(h.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ep(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Zu,this._domRenderTaskQueue=new Zu,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.b2(),this._locale=Object.assign({},yd,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ec(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new cr(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const a=document.getElementById(h.container);if(!a)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=a}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,n.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new h_(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||n.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new $h(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const a=h.bounds;a&&(this.resize(),this.fitBounds(a,Object.assign({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Oc({customAttribution:h.customAttribution})),this._logoControl=new Uf,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new n.z(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new n.z(`${a.dataType}dataloading`,a))})),this._interactions=new gh(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new n.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new n.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new n.z("movestart",h)).fire(new n.z("move",h)),this.fire(new n.z("resize",h)),t&&this.fire(new n.z("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(n.aI.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map((t=>t==="auto"?navigator.language:t)):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let a;t==="globe"&&h.zoom>=n.cL?(h.setMercatorFromTransition(),a=!0):t==="mercator"&&h.zoom<n.cL&&(h.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;const a=this.transform.mercatorFromTransition;t=h.name==="globe"&&this.transform.zoom>=n.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate();const d=this.transform.getProjection().name==="mercator"&&a!==this.transform.mercatorFromTransition;return(t||d)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(n.aT.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(n.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,a){const d=y=>{let b=[];if(Array.isArray(t)){const S=t.filter((I=>this.getLayer(I)));b=S.length?this.queryRenderedFeatures(y,{layers:S}):[]}else b=this.queryRenderedFeatures(y,{target:t});return b};if(h==="mouseenter"||h==="mouseover"){let y=!1;return{listener:a,targets:t,delegates:{mousemove:S=>{const I=d(S.point);I.length?y||(y=!0,a.call(this,new Fc(h,this,S.originalEvent,{features:I}))):y=!1},mouseout:()=>{y=!1}}}}if(h==="mouseleave"||h==="mouseout"){let y=!1;return{listener:a,targets:t,delegates:{mousemove:I=>{d(I.point).length?y=!0:y&&(y=!1,a.call(this,new Fc(h,this,I.originalEvent)))},mouseout:I=>{y&&(y=!1,a.call(this,new Fc(h,this,I.originalEvent)))}}}}{const y=b=>{const S=d(b.point);S.length&&(b.features=S,a.call(this,b),delete b.features)};return{listener:a,targets:t,delegates:{[h]:y}}}}on(h,t,a){if(typeof t=="function"||a===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const y in d.delegates)this.on(y,d.delegates[y]);return this}once(h,t,a){if(typeof t=="function"||a===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,a);for(const y in d.delegates)this.once(y,d.delegates[y]);return this}off(h,t,a){if(typeof t=="function"||a===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(y=>{for(let b=0;b<y.length;b++){const S=y[b];if(S.listener===a&&Sm(S.targets,t)){for(const I in S.delegates)this.off(I,S.delegates[I]);return y.splice(b,1),this}}})(d),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof n.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const b=this.style.queryRenderedFeatures(h,void 0,this.transform),S=this.style.queryRenderedFeatureset(h,void 0,this.transform);return b.concat(S)}let a=!0;if(t.target&&(a=this._isTargetValid(t.target),a&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const b of t.layers)if(!this._isValidId(b)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let y=[];return d&&(y=y.concat(this.style.queryRenderedFeatures(h,t,this.transform))),a&&(y=y.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),y}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}queryRasterValue(h,t,a){return this._isValidId(h)?this.style.queryRasterValue(h,t,a):Promise.resolve(null)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,((a,d)=>{if(a){const y=typeof a=="string"?a:a instanceof Error?a.message:a.error;n.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(h,t)}else d&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const a=Object.assign({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new Ll(this,a).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ll(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new n.y(new Error("IDs can't be empty."))),!1):!n.dr(h)||(this.fire(new n.y(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,a)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:a=1,sdf:d=!1,stretchX:y,stretchY:b,content:S}={}){this._lazyInitEmptyStyle();const I=n.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:D,height:N,data:V}=n.o.getImageData(t);this.style.addImage(I,{data:new n.q({width:D,height:N},V),pixelRatio:a,stretchX:y,stretchY:b,content:S,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new n.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:N}=t,V=t;this.style.addImage(I,{data:new n.q({width:D,height:N},new Uint8Array(V.data)),pixelRatio:a,stretchX:y,stretchY:b,content:S,sdf:d,usvg:!1,version:0,userImage:V}),V.onAdd&&V.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const a=n.I.from(h),d=this.style.getImage(a);if(!d)return void this.fire(new n.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.o.getImageData(t):t,{width:b,height:S,data:I}=y;if(b===void 0||S===void 0)return void this.fire(new n.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||S!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new n.y(new Error(`The width and height of the updated image (${b}, ${S})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const D=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let N=!1;d.usvg?(d.data=new n.q({width:b,height:S},new Uint8Array(I)),d.usvg=!1,d.icon=void 0,N=!0):d.data.replace(I,D),this.style.updateImage(a,d,N)}hasImage(h){return h?!!this.style&&!!this.style.getImage(n.I.from(h)):(this.fire(new n.y(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(n.I.from(h))}loadImage(h,t){n.n(this._requestManager.transformRequest(h,n.R.Image),((a,d)=>{t(a,d instanceof HTMLImageElement?n.o.getImageData(d):d)}))}listImages(){return this.style.listImages().map((h=>h.name))}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new n.y(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t).catch((a=>this.fire(new n.y(new Error("Failed to add import",a))))),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,a){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,a),this._update(!0)):this}setFilter(h,t,a={}){return this._isValidId(h)?(this.style.setFilter(h,t,a),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,a,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,a,d),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,a,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,a,d),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}setLayerProperty(h,t,a,d={}){return this._isValidId(h)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(h,t,a,d),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,a){return this.style.setConfigProperty(h,t,a),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.aT.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_selectIndoorFloor(h){this.indoor.selectFloor(h)}_setIndoorActiveFloorsVisibility(h){this.indoor.setActiveFloorsVisibility(h)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Gf),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,d,y,b=this._container;for(;b&&(!d||!y);){const S=window.getComputedStyle(b).transform;S&&S!=="none"&&(a=S.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(y=a[3])),b=b.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=y?Math.abs(t/y):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new cd(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Vi("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Vi("div","mapboxgl-canvas-container",h);this._canvas=Vi("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=Vi("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((y=>{d[y]=Vi("div",`mapboxgl-ctrl-${y}`,a)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const a=n.o.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=Object.assign({},Ui.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(Va(t,!0),this.painter=new dp(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",(a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),n.k.testSupport(t)):this.fire(new n.y(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.z("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new n.z("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new n.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,d=n.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=y.createQuery(),y.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,V=this.transform.pitch,K=n.o.now(),X=new n.ac(N,{now:K,fadeDuration:b,pitch:V,transition:this.style.transition,worldview:this._worldview});this.style.update(X)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(d);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,pt.mark(Fe.load),this.fire(new n.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const N=n.o.now()-d;y.endQuery(a.TIME_ELAPSED_EXT),setTimeout((()=>{const V=y.getQueryParameter(t,y.QUERY_RESULT)/1e6;y.deleteQuery(t),this.fire(new n.z("gpu-timing-frame",{cpuTime:N,gpuTime:V}))}),50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout((()=>{const V=this.painter.queryGpuTimers(N);this.fire(new n.z("gpu-timing-layer",{layerTimes:V}))}),50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const V=this.painter.queryGpuTimeDeferredRender(N);this.fire(new n.z("gpu-timing-deferred-render",{gpuTime:V}))}),50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(D||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(S=this._updateAverageElevation(d,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new n.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const V=this._calculateSpeedIndex();this.fire(new n.z("speedindexcompleted",{speedIndex:V})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,pt.mark(Fe.fullLoad),this._performanceMetricsCollection&&Kr(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const a=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=h;const S=Math.abs(y-b);if(S>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(b),a(b);this._averageElevation.easeTo(b,h,300)}else if(S>1e-4)return this._averageElevation.jumpTo(b),a(b)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){Ma(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(h=>{if(h&&(h.message===Wi||h.status===401)){const t=this.painter.context.gl;Va(t,!1),this._logoControl instanceof Uf&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),tr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Gr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&In(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){br(this._requestManager._customAccessToken)}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function y(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const S=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,S),S}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(y(h),t.canvasCopies.map(y),t.timeStamps)}_canvasPixelComparison(h,t,a){let d=a[1]-a[0];const y=h.length/4;for(let b=0;b<t.length;b++){const S=t[b];let I=0;for(let D=0;D<S.length;D+=4)S[D]===h[D]&&S[D+1]===h[D+1]&&S[D+2]===h[D+2]&&S[D+3]===h[D+3]&&(I+=1);d+=(a[b+2]-a[b+1])*(1-I/y)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),$t.delete(this.painter.context.gl),oa.remove(),vn.remove(),this._removed=!0,this.fire(new n.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=n.o.frame((t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)})))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return n.bw(t,((a,d)=>a._preloadTiles(h,d)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this.style&&h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,t){n.f4(h,t)}get version(){return ke}},NavigationControl:class{constructor(h={}){this.options=Object.assign({},qp,h),this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(n.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),Vi("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),Vi("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))})),this._compassIcon=Vi("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),a=t===h.getMaxZoom(),d=t===h.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Gm(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const a=Vi("button",h,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(h,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends n.E{constructor(h={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},jl,h),n.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Lf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,h(a)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((a=>t(a.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),a=h.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.z("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("geolocate",Object.assign({coords:h.coords,timestamp:h.timestamp},h.toJSON?{toJSON:h.toJSON.bind(h)}:{}))),this._finish()}}_updateCamera(h){const t=new n.aT(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,d=this._map.getBearing(),y=Object.assign({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),y,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new n.aT(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=n.cf(1,h._center.lat)*h.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Vi("button","mapboxgl-ctrl-geolocate",this._container),Vi("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Vi("div","mapboxgl-user-location"),this._dotElement.appendChild(Vi("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Vi("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $p({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Vi("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $p({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.z("trackuserlocationend")))}))}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&h()})).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Oc,ScaleControl:class{constructor(h={}){this.options=Object.assign({},yp,h),n.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,d=t._containerWidth/2-h/2,y=t.unproject([d,a]),b=t.unproject([d+h,a]),S=y.distanceTo(b);if(this.options.unit==="imperial"){const I=3.2808*S;I>5280?this._setScale(h,I/5280,"mile"):this._setScale(h,I,"foot")}else this.options.unit==="nautical"?this._setScale(h,S/1852,"nautical-mile"):S>=1e3?this._setScale(h,S/1e3,"kilometer"):this._setScale(h,S,"meter")}_setScale(h,t,a){this._map._requestDomTask((()=>{const d=(function(b){const S=Math.pow(10,`${Math.floor(b)}`.length-1);let I=b/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:(function(D){const N=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*N)/N})(I),S*I})(t),y=d/t;this._container.innerHTML=a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(d):`${d}&nbsp;${Em[a]}`,this._container.style.width=h*y+"px"}))}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:n.w("Full screen control 'container' must be a DOM element.")),n.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Vi("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Vi("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Gf,Popup:class extends n.E{constructor(h){super(),this.options=Object.assign(Object.create(Wu),h),this._altitude=this.options.altitude,n.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new n.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new n.z("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=n.aT.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),a=document.createElement("body");let d;for(a.innerHTML=h;d=a.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Vi("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const a=this._closeButton=Vi("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,d=this._pos;if(!t||!a||!d)return"bottom";const y=a.offsetWidth,b=a.offsetHeight,S=d.x<y/2,I=d.x>t.transform.width-y/2;if(d.y+h<b)return S?"top-left":I?"top-right":"top";if(d.y>t.transform.height-b){if(S)return"bottom-left";if(I)return"bottom-right"}return S?"left":I?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=Vi("div","mapboxgl-popup",t.getContainer()),this._tip=Vi("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=yh(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const y=this._pos=this._trackPointer&&h instanceof n.P?h:t.project(this._lngLat,this._altitude),b=bl(this.options.offset),S=this._anchor=this._getAnchor(b.y),I=bl(this.options.offset,S),D=y.add(I).round();t._requestDomTask((()=>{this._container&&S&&(this._container.style.transform=`${ys[S]} translate(${D.x}px,${D.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const y=n.f5(t.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Es);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:$p,Style:Ll,LngLat:n.aT,LngLatBounds:n.aI,Point:n.P,MercatorCoordinate:n.ae,FreeCameraOptions:Zo,Evented:n.E,config:n.e,prewarm:n.f9,clearPrewarmedResources:n.f8,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(h){n.e.ACCESS_TOKEN=h},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(h){n.e.API_URL=h},get workerCount(){return n.fi.workerCount},set workerCount(h){n.fi.workerCount=h},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){n.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){n.fh(h)},get workerUrl(){return n.fg.workerUrl},set workerUrl(h){n.fg.workerUrl=h},get workerClass(){return n.fg.workerClass},set workerClass(h){n.fg.workerClass=h},get workerParams(){return n.fg.workerParams},set workerParams(h){n.fg.workerParams=h},get dracoUrl(){return n.ff()},set dracoUrl(h){n.fe(h)},get meshoptUrl(){return n.fd()},set meshoptUrl(h){n.fc(h)},setNow:n.o.setNow,restoreNow:n.o.restoreNow}}));var se=Ae;return se}))})(Xy)),Xy.exports}var fw=z4();const pw=iy(fw),R4=Bb({__proto__:null,default:pw},[fw]),D4="/mad-transit/assets/busstop-5_Cm25Sp.svg",P4="/mad-transit/assets/brtstop-CDNLqygK.svg",L4="/mad-transit/assets/flamingo-C0GlxpRz.svg",k4="data:text/csv;base64,cG9pX2NvZGUsc3RvcF9uYW1lLHBvaV9sYXQscG9pX2xvbg0KMTIzNDUsRmxhbWluZ29zLDQzLjA3NTA4MywtODkuNDAxMTcz";function Mb(Z){const ce=String(Z);return ce.length===1?`000${ce}`:ce.length===2?`00${ce}`:ce.length===3?`0${ce}`:ce}async function lv(Z,ce,de){Z.hasImage(ce)||await new Promise((ue,Ae)=>{const Ce=new Image;Ce.crossOrigin="anonymous",Ce.onload=()=>{try{Z.hasImage(ce)||Z.addImage(ce,Ce,{pixelRatio:2}),ue()}catch(se){Ae(se)}},Ce.onerror=se=>{Ae(se||new Error(`Failed to load icon: ${ce}`))},Ce.src=de})}async function F4(){const Z=await fetch(k4);if(!Z.ok)throw new Error(`Failed to load POI CSV: ${Z.status} ${Z.statusText}`);const de=(await Z.text()).trim().split(/\r?\n/);if(de.length<2)return[];const[ue,...Ae]=de,Ce=ue.split(",");return Ae.map(n=>n.trim()).filter(Boolean).map(n=>{const ke=n.split(","),Fe={};return Ce.forEach((pt,it)=>{Fe[pt]=ke[it]}),Fe})}function O4(Z){let ce=0;for(let de=0;de<Z.length;de++){const ue=Z.charCodeAt(de);ce=(ce<<5)-ce+ue,ce=ce&ce}return Math.abs(ce)}function B4({stops:Z=[],onStopClick:ce,selectMode:de=!1}){const ue=A4(),[Ae,Ce]=Tt.useState(null);return Tt.useEffect(()=>{let se=!0,n=null;const ke=ue?.current?.getMap?.()??ue?.current??ue;if(!ke)return;const Fe="stops-source",pt="stops-layer",it="busstop-icon",ht="brtstop-icon",Ci="flamingo-icon",Ui=()=>{Ce(ke.getZoom())},Vi=async()=>{try{if(await Promise.all([lv(ke,it,D4),lv(ke,ht,P4),lv(ke,Ci,L4)]),!se)return;const qi=(Z||[]).map(ln=>{const mn=ln.stop_id??ln.stop_code??"",Pt=String(mn),Bt=Mb(Pt),Ni=Pt.length===5?ht:it,tn=O4(Pt)%100;return{type:"Feature",geometry:{type:"Point",coordinates:[Number(ln.stop_lon),Number(ln.stop_lat)]},properties:{id:Bt,name:ln.stop_name,code:ln.stop_code,icon:Ni,priority:tn}}}),on=await F4();if(!se)return;const an=on.filter(ln=>ln.poi_code==="123456").map(ln=>({type:"Feature",geometry:{type:"Point",coordinates:[Number(ln.poi_lon),Number(ln.poi_lat)]},properties:{id:ln.poi_code,name:ln.stop_name,code:ln.poi_code,icon:Ci,priority:0}})),Un={type:"FeatureCollection",features:[...qi,...an]};if(!ke.isStyleLoaded()){console.warn("Style not loaded yet, skipping addSource");return}const rr=ke.getSource(Fe);rr&&typeof rr.setData=="function"?rr.setData(Un):ke.getSource(Fe)||ke.addSource(Fe,{type:"geojson",data:Un}),ke.getLayer(pt)?(ke.setLayoutProperty(pt,"icon-size",["interpolate",["linear"],["zoom"],12,de?.4:.3,16,["case",["==",["get","icon"],ht],de?1.2:1,["==",["get","icon"],Ci],de?1.8:1.5,de?.6:.5],19,["case",["==",["get","icon"],ht],de?1.2:1,["==",["get","icon"],Ci],de?1.8:1.5,de?.6:.5]]),ke.setLayoutProperty(pt,"icon-opacity",de?.9:1)):(ke.addLayer({id:pt,type:"symbol",source:Fe,minzoom:12,maxzoom:19,layout:{"icon-image":["get","icon"],"icon-size":["interpolate",["linear"],["zoom"],12,de?.4:.3,16,["case",["==",["get","icon"],ht],de?1.2:1,["==",["get","icon"],Ci],de?1.8:1.5,de?.6:.5],19,["case",["==",["get","icon"],ht],de?1.2:1,["==",["get","icon"],Ci],de?1.8:1.5,de?.6:.5]],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-opacity":de?.9:1},filter:["any",["==",["get","icon"],Ci],["all",[">=",["zoom"],15]],["all",[">=",["zoom"],14],["<",["zoom"],15],["<",["get","priority"],50]],["all",[">=",["zoom"],13],["<",["zoom"],14],["<",["get","priority"],10]],["all",[">=",["zoom"],12],["<",["zoom"],13],["<",["get","priority"],5]]]}),ke.on("click",pt,ln=>{if(!ln.features||!ln.features[0])return;const mn=ln.features[0].geometry.coordinates.slice(),{name:Pt,code:Bt,id:Ni,icon:tn}=ln.features[0].properties;if(n&&(n.remove(),n=null),tn===Ci)return;const Li=Mb(Ni||Bt),Wi=de?"+ Add Stop":"View Arrivals",Pr=`
              <div class="stop-popup-content">
                <h3 class="stop-popup-title">Stop #${Li}</h3>
                <p class="stop-popup-name">${Pt}</p>
                <button 
                  type="button" 
                  class="stop-popup-button ${de?"stop-popup-button-select":"stop-popup-button"}"
                  data-stop-id="${Li}"
                  aria-label="${de?`Add stop ${Li} to group`:`View arrivals at stop ${Li}`}"
                >
                  ${Wi}
                </button>
              </div>
            `;n=new pw.Popup({closeButton:!0,closeOnClick:!1,maxWidth:"280px",className:"stop-popup"}).setLngLat(mn).setHTML(Pr).addTo(ke),setTimeout(()=>{const si=n.getElement()?.querySelector(".stop-popup-button");si&&ce&&si.addEventListener("click",()=>{const xi=si.getAttribute("data-stop-id");ce(xi),n&&(n.remove(),n=null)})},0)}),ke.on("mouseenter",pt,()=>{ke.getCanvas().style.cursor="pointer"}),ke.on("mouseleave",pt,()=>{ke.getCanvas().style.cursor=""}))}catch(qi){console.error("Error loading stop icons / POIs:",qi)}};return Ui(),ke.on("zoom",Ui),ke.on("zoomend",Ui),ke.loaded()&&ke.isStyleLoaded()?Vi():(ke.once("load",Vi),ke.once("styledata",()=>{se&&Vi()})),()=>{if(se=!1,n&&(n.remove(),n=null),!!ke)try{if(ke.off("zoom",Ui),ke.off("zoomend",Ui),!ke.isStyleLoaded())return;ke.getLayer(pt)&&ke.removeLayer(pt),ke.getSource(Fe)&&ke.removeSource(Fe),ke.hasImage(it)&&ke.removeImage(it),ke.hasImage(ht)&&ke.removeImage(ht),ke.hasImage(Ci)&&ke.removeImage(Ci)}catch(qi){console.warn("Cleanup warning:",qi)}}},[ue,Z,ce,de]),Ae!==null?he.jsx("div",{style:{position:"absolute",bottom:"30px",right:"10px",backgroundColor:de?"rgba(139, 92, 246, 0)":"rgba(255, 255, 255, 0)",color:de?"white":"rgba(255, 255, 255, .5)",fontFamily:"monospace",fontSize:"10px",fontWeight:"bold",zIndex:1e3,pointerEvents:"none"},"aria-live":"polite",role:"status",children:de?"SELECT MODE":`Zoom: ${Ae.toFixed(2)}`}):null}function mw(){return ow()}const N4=aw(()=>Promise.resolve().then(()=>U4),void 0);Tt.forwardRef(function(ce,de){return lw(ce,de,N4)});const Ib=cw,Cb=uw;var Yy={exports:{}};var j4=Yy.exports,zb;function V4(){return zb||(zb=1,(function(Z,ce){(function(de,ue){Z.exports=ue()})(j4,(function(){var de={},ue={};function Ae(se,n,ke){if(ue[se]=ke,se==="index"){var Fe="var sharedModule = {}; ("+ue.shared+")(sharedModule); ("+ue.worker+")(sharedModule);",pt={};return ue.shared(pt),ue.index(de,pt),typeof window<"u"&&de.setWorkerUrl(window.URL.createObjectURL(new Blob([Fe],{type:"text/javascript"}))),de}}Ae("shared",["exports"],(function(se){function n(f,l,g,T){return new(g||(g=Promise))((function(z,F){function O(re){try{W(T.next(re))}catch(pe){F(pe)}}function H(re){try{W(T.throw(re))}catch(pe){F(pe)}}function W(re){var pe;re.done?z(re.value):(pe=re.value,pe instanceof g?pe:new g((function(ve){ve(pe)}))).then(O,H)}W((T=T.apply(f,l||[])).next())}))}function ke(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}typeof SuppressedError=="function"&&SuppressedError;var Fe=pt;function pt(f,l){this.x=f,this.y=l}pt.prototype={clone:function(){return new pt(this.x,this.y)},add:function(f){return this.clone()._add(f)},sub:function(f){return this.clone()._sub(f)},multByPoint:function(f){return this.clone()._multByPoint(f)},divByPoint:function(f){return this.clone()._divByPoint(f)},mult:function(f){return this.clone()._mult(f)},div:function(f){return this.clone()._div(f)},rotate:function(f){return this.clone()._rotate(f)},rotateAround:function(f,l){return this.clone()._rotateAround(f,l)},matMult:function(f){return this.clone()._matMult(f)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(f){return this.x===f.x&&this.y===f.y},dist:function(f){return Math.sqrt(this.distSqr(f))},distSqr:function(f){var l=f.x-this.x,g=f.y-this.y;return l*l+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith:function(f){return this.angleWithSep(f.x,f.y)},angleWithSep:function(f,l){return Math.atan2(this.x*l-this.y*f,this.x*f+this.y*l)},_matMult:function(f){var l=f[2]*this.x+f[3]*this.y;return this.x=f[0]*this.x+f[1]*this.y,this.y=l,this},_add:function(f){return this.x+=f.x,this.y+=f.y,this},_sub:function(f){return this.x-=f.x,this.y-=f.y,this},_mult:function(f){return this.x*=f,this.y*=f,this},_div:function(f){return this.x/=f,this.y/=f,this},_multByPoint:function(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint:function(f){return this.x/=f.x,this.y/=f.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var f=this.y;return this.y=this.x,this.x=-f,this},_rotate:function(f){var l=Math.cos(f),g=Math.sin(f),T=g*this.x+l*this.y;return this.x=l*this.x-g*this.y,this.y=T,this},_rotateAround:function(f,l){var g=Math.cos(f),T=Math.sin(f),z=l.y+T*(this.x-l.x)+g*(this.y-l.y);return this.x=l.x+g*(this.x-l.x)-T*(this.y-l.y),this.y=z,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},pt.convert=function(f){return f instanceof pt?f:Array.isArray(f)?new pt(f[0],f[1]):f};var it=ke(Fe),ht=Ci;function Ci(f,l,g,T){this.cx=3*f,this.bx=3*(g-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(T-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=l,this.p2x=g,this.p2y=T}Ci.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,l){if(l===void 0&&(l=1e-6),f<0)return 0;if(f>1)return 1;for(var g=f,T=0;T<8;T++){var z=this.sampleCurveX(g)-f;if(Math.abs(z)<l)return g;var F=this.sampleCurveDerivativeX(g);if(Math.abs(F)<1e-6)break;g-=z/F}var O=0,H=1;for(g=f,T=0;T<20&&(z=this.sampleCurveX(g),!(Math.abs(z-f)<l));T++)f>z?O=g:H=g,g=.5*(H-O)+O;return g},solve:function(f,l){return this.sampleCurveY(this.solveCurveX(f,l))}};var Ui=ke(ht);let Vi,qi;function on(){return Vi==null&&(Vi=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Vi}function Ai(){if(qi==null&&(qi=!1,on())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let T=0;T<25;T++){const z=4*T;l.fillStyle=`rgb(${z},${z+1},${z+2})`,l.fillRect(T%5,Math.floor(T/5),1,1)}const g=l.getImageData(0,0,5,5).data;for(let T=0;T<100;T++)if(T%4!=3&&g[T]!==T){qi=!0;break}}}return qi||!1}function an(f,l,g,T){const z=new Ui(f,l,g,T);return F=>z.solve(F)}const Un=an(.25,.1,.25,1);function rr(f,l,g){return Math.min(g,Math.max(l,f))}function ln(f,l,g){const T=g-l,z=((f-l)%T+T)%T+l;return z===l?g:z}function mn(f,...l){for(const g of l)for(const T in g)f[T]=g[T];return f}let Pt=1;function Bt(f,l,g){const T={};for(const z in f)T[z]=l.call(this,f[z],z,f);return T}function Ni(f,l,g){const T={};for(const z in f)l.call(this,f[z],z,f)&&(T[z]=f[z]);return T}function tn(f){return Array.isArray(f)?f.map(tn):typeof f=="object"&&f?Bt(f,tn):f}const Li={};function Wi(f){Li[f]||(typeof console<"u"&&console.warn(f),Li[f]=!0)}function cr(f,l,g){return(g.y-f.y)*(l.x-f.x)>(l.y-f.y)*(g.x-f.x)}function Pr(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let si=null;function xi(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const Tn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function zn(f,l,g,T,z){return n(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const F=new VideoFrame(f,{timestamp:0});try{const O=F?.format;if(!O||!O.startsWith("BGR")&&!O.startsWith("RGB"))throw new Error(`Unrecognized format ${O}`);const H=O.startsWith("BGR"),W=new Uint8ClampedArray(T*z*4);if(yield F.copyTo(W,(function(re,pe,ve,Me,Le){const qe=4*Math.max(-pe,0),Je=(Math.max(0,ve)-ve)*Me*4+qe,xt=4*Me,zt=Math.max(0,pe),ai=Math.max(0,ve);return{rect:{x:zt,y:ai,width:Math.min(re.width,pe+Me)-zt,height:Math.min(re.height,ve+Le)-ai},layout:[{offset:Je,stride:xt}]}})(f,l,g,T,z)),H)for(let re=0;re<W.length;re+=4){const pe=W[re];W[re]=W[re+2],W[re+2]=pe}return W}finally{F.close()}}))}let Er,Et;const di="AbortError";function mi(){return new Error(di)}const vn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function tr(f){return vn.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}const vr="global-dispatcher";class Gr extends Error{constructor(l,g,T,z){super(`AJAXError: ${g} (${l}): ${T}`),this.status=l,this.statusText=g,this.url=T,this.body=z}}const gr=()=>Pr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,In=function(f,l){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){const T=tr(f.url);if(T)return T(f,l);if(Pr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,targetMapId:vr},l)}if(!(/^file:/.test(g=f.url)||/^file:/.test(gr())&&!/^\w+:/.test(g))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(T,z){return n(this,void 0,void 0,(function*(){const F=new Request(T.url,{method:T.method||"GET",body:T.body,credentials:T.credentials,headers:T.headers,cache:T.cache,referrer:gr(),signal:z.signal});T.type!=="json"||F.headers.has("Accept")||F.headers.set("Accept","application/json");const O=yield fetch(F);if(!O.ok){const re=yield O.blob();throw new Gr(O.status,O.statusText,T.url,re)}let H;H=T.type==="arrayBuffer"||T.type==="image"?O.arrayBuffer():T.type==="json"?O.json():O.text();const W=yield H;if(z.signal.aborted)throw mi();return{data:W,cacheControl:O.headers.get("Cache-Control"),expires:O.headers.get("Expires")}}))})(f,l);if(Pr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,mustQueue:!0,targetMapId:vr},l)}var g;return(function(T,z){return new Promise(((F,O)=>{var H;const W=new XMLHttpRequest;W.open(T.method||"GET",T.url,!0),T.type!=="arrayBuffer"&&T.type!=="image"||(W.responseType="arraybuffer");for(const re in T.headers)W.setRequestHeader(re,T.headers[re]);T.type==="json"&&(W.responseType="text",!((H=T.headers)===null||H===void 0)&&H.Accept||W.setRequestHeader("Accept","application/json")),W.withCredentials=T.credentials==="include",W.onerror=()=>{O(new Error(W.statusText))},W.onload=()=>{if(!z.signal.aborted)if((W.status>=200&&W.status<300||W.status===0)&&W.response!==null){let re=W.response;if(T.type==="json")try{re=JSON.parse(W.response)}catch(pe){return void O(pe)}F({data:re,cacheControl:W.getResponseHeader("Cache-Control"),expires:W.getResponseHeader("Expires")})}else{const re=new Blob([W.response],{type:W.getResponseHeader("Content-Type")});O(new Gr(W.status,W.statusText,T.url,re))}},z.signal.addEventListener("abort",(()=>{W.abort(),O(mi())})),W.send(T.body)}))})(f,l)};function Lr(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const l=new URL(f),g=window.location;return l.protocol===g.protocol&&l.host===g.host}function br(f,l,g){g[f]&&g[f].indexOf(l)!==-1||(g[f]=g[f]||[],g[f].push(l))}function ma(f,l,g){if(g&&g[f]){const T=g[f].indexOf(l);T!==-1&&g[f].splice(T,1)}}class Kr{constructor(l,g={}){mn(this,g),this.type=l}}class oa extends Kr{constructor(l,g={}){super("error",mn({error:l},g))}}class Ma{on(l,g){return this._listeners=this._listeners||{},br(l,g,this._listeners),this}off(l,g){return ma(l,g,this._listeners),ma(l,g,this._oneTimeListeners),this}once(l,g){return g?(this._oneTimeListeners=this._oneTimeListeners||{},br(l,g,this._oneTimeListeners),this):new Promise((T=>this.once(l,T)))}fire(l,g){typeof l=="string"&&(l=new Kr(l,g||{}));const T=l.type;if(this.listens(T)){l.target=this;const z=this._listeners&&this._listeners[T]?this._listeners[T].slice():[];for(const H of z)H.call(this,l);const F=this._oneTimeListeners&&this._oneTimeListeners[T]?this._oneTimeListeners[T].slice():[];for(const H of F)ma(T,H,this._oneTimeListeners),H.call(this,l);const O=this._eventedParent;O&&(mn(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),O.fire(l))}else l instanceof oa&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,g){return this._eventedParent=l,this._eventedParentData=g,this}}var $t={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Va=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ir(f,l){const g={};for(const T in f)T!=="ref"&&(g[T]=f[T]);return Va.forEach((T=>{T in l&&(g[T]=l[T])})),g}function Ar(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let g=0;g<f.length;g++)if(!Ar(f[g],l[g]))return!1;return!0}if(typeof f=="object"&&f!==null&&l!==null){if(typeof l!="object"||Object.keys(f).length!==Object.keys(l).length)return!1;for(const g in f)if(!Ar(f[g],l[g]))return!1;return!0}return f===l}function la(f,l){f.push(l)}function Po(f,l,g){la(g,{command:"addSource",args:[f,l[f]]})}function Qs(f,l,g){la(l,{command:"removeSource",args:[f]}),g[f]=!0}function Io(f,l,g,T){Qs(f,g,T),Po(f,l,g)}function Mr(f,l,g){let T;for(T in f[g])if(Object.prototype.hasOwnProperty.call(f[g],T)&&T!=="data"&&!Ar(f[g][T],l[g][T]))return!1;for(T in l[g])if(Object.prototype.hasOwnProperty.call(l[g],T)&&T!=="data"&&!Ar(f[g][T],l[g][T]))return!1;return!0}function ws(f,l,g,T,z,F){f=f||{},l=l||{};for(const O in f)Object.prototype.hasOwnProperty.call(f,O)&&(Ar(f[O],l[O])||g.push({command:F,args:[T,O,l[O],z]}));for(const O in l)Object.prototype.hasOwnProperty.call(l,O)&&!Object.prototype.hasOwnProperty.call(f,O)&&(Ar(f[O],l[O])||g.push({command:F,args:[T,O,l[O],z]}))}function Ds(f){return f.id}function Ps(f,l){return f[l.id]=l,f}class Qt{constructor(l,g,T,z){this.message=(l?`${l}: `:"")+T,z&&(this.identifier=z),g!=null&&g.__line__&&(this.line=g.__line__)}}function Gn(f,...l){for(const g of l)for(const T in g)f[T]=g[T];return f}class Ta extends Error{constructor(l,g){super(g),this.message=g,this.key=l}}class Ha{constructor(l,g=[]){this.parent=l,this.bindings={};for(const[T,z]of g)this.bindings[T]=z}concat(l){return new Ha(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const ms={kind:"null"},xn={kind:"number"},er={kind:"string"},sr={kind:"boolean"},Xs={kind:"color"},fl={kind:"object"},Jr={kind:"value"},pl={kind:"collator"},Uo={kind:"formatted"},oc={kind:"padding"},cl={kind:"resolvedImage"},ft={kind:"variableAnchorOffsetCollection"};function ze(f,l){return{kind:"array",itemType:f,N:l}}function Pe(f){if(f.kind==="array"){const l=Pe(f.itemType);return typeof f.N=="number"?`array<${l}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${l}>`}return f.kind}const et=[ms,xn,er,sr,Xs,Uo,fl,ze(Jr),oc,cl,ft];function gt(f,l){if(l.kind==="error")return null;if(f.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!gt(f.itemType,l.itemType))&&(typeof f.N!="number"||f.N===l.N))return null}else{if(f.kind===l.kind)return null;if(f.kind==="value"){for(const g of et)if(!gt(g,l))return null}}return`Expected ${Pe(f)} but found ${Pe(l)} instead.`}function jt(f,l){return l.some((g=>g.kind===f.kind))}function Ge(f,l){return l.some((g=>g==="null"?f===null:g==="array"?Array.isArray(f):g==="object"?f&&!Array.isArray(f)&&typeof f=="object":g===typeof f))}function ei(f,l){return f.kind==="array"&&l.kind==="array"?f.itemType.kind===l.itemType.kind&&typeof f.N=="number":f.kind===l.kind}const kt=.96422,Pi=.82521,fi=4/29,ui=6/29,kn=3*ui*ui,fr=ui*ui*ui,Cr=Math.PI/180,ct=180/Math.PI;function te(f){return(f%=360)<0&&(f+=360),f}function _e([f,l,g,T]){let z,F;const O=tt((.2225045*(f=Re(f))+.7168786*(l=Re(l))+.0606169*(g=Re(g)))/1);f===l&&l===g?z=F=O:(z=tt((.4360747*f+.3850649*l+.1430804*g)/kt),F=tt((.0139322*f+.0971045*l+.7141733*g)/Pi));const H=116*O-16;return[H<0?0:H,500*(z-O),200*(O-F),T]}function Re(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function tt(f){return f>fr?Math.pow(f,1/3):f/kn+fi}function Xe([f,l,g,T]){let z=(f+16)/116,F=isNaN(l)?z:z+l/500,O=isNaN(g)?z:z-g/200;return z=1*St(z),F=kt*St(F),O=Pi*St(O),[at(3.1338561*F-1.6168667*z-.4906146*O),at(-.9787684*F+1.9161415*z+.033454*O),at(.0719453*F-.2289914*z+1.4052427*O),T]}function at(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function St(f){return f>ui?f*f*f:kn*(f-fi)}function lt(f){return parseInt(f.padEnd(2,f),16)/255}function It(f,l){return ti(l?f/100:f,0,1)}function ti(f,l,g){return Math.min(Math.max(l,f),g)}function Gt(f){return!f.some(Number.isNaN)}const Ji={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Qi{constructor(l,g,T,z=1,F=!0){this.r=l,this.g=g,this.b=T,this.a=z,F||(this.r*=z,this.g*=z,this.b*=z,z||this.overwriteGetter("rgb",[l,g,T,z]))}static parse(l){if(l instanceof Qi)return l;if(typeof l!="string")return;const g=(function(T){if((T=T.toLowerCase().trim())==="transparent")return[0,0,0,0];const z=Ji[T];if(z){const[O,H,W]=z;return[O/255,H/255,W/255,1]}if(T.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(T)){const O=T.length<6?1:2;let H=1;return[lt(T.slice(H,H+=O)),lt(T.slice(H,H+=O)),lt(T.slice(H,H+=O)),lt(T.slice(H,H+O)||"ff")]}if(T.startsWith("rgb")){const O=T.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(O){const[H,W,re,pe,ve,Me,Le,qe,Je,xt,zt,ai]=O,Vt=[pe||" ",Le||" ",xt].join("");if(Vt==="  "||Vt==="  /"||Vt===",,"||Vt===",,,"){const ii=[re,Me,Je].join(""),Fi=ii==="%%%"?100:ii===""?255:0;if(Fi){const gn=[ti(+W/Fi,0,1),ti(+ve/Fi,0,1),ti(+qe/Fi,0,1),zt?It(+zt,ai):1];if(Gt(gn))return gn}}return}}const F=T.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(F){const[O,H,W,re,pe,ve,Me,Le,qe]=F,Je=[W||" ",pe||" ",Me].join("");if(Je==="  "||Je==="  /"||Je===",,"||Je===",,,"){const xt=[+H,ti(+re,0,100),ti(+ve,0,100),Le?It(+Le,qe):1];if(Gt(xt))return(function([zt,ai,Vt,ii]){function Fi(gn){const Xn=(gn+zt/30)%12,Rr=ai*Math.min(Vt,1-Vt);return Vt-Rr*Math.max(-1,Math.min(Xn-3,9-Xn,1))}return zt=te(zt),ai/=100,Vt/=100,[Fi(0),Fi(8),Fi(4),ii]})(xt)}}})(l);return g?new Qi(...g,!1):void 0}get rgb(){const{r:l,g,b:T,a:z}=this,F=z||1/0;return this.overwriteGetter("rgb",[l/F,g/F,T/F,z])}get hcl(){return this.overwriteGetter("hcl",(function(l){const[g,T,z,F]=_e(l),O=Math.sqrt(T*T+z*z);return[Math.round(1e4*O)?te(Math.atan2(z,T)*ct):NaN,O,g,F]})(this.rgb))}get lab(){return this.overwriteGetter("lab",_e(this.rgb))}overwriteGetter(l,g){return Object.defineProperty(this,l,{value:g}),g}toString(){const[l,g,T,z]=this.rgb;return`rgba(${[l,g,T].map((F=>Math.round(255*F))).join(",")},${z})`}}Qi.black=new Qi(0,0,0,1),Qi.white=new Qi(1,1,1,1),Qi.transparent=new Qi(0,0,0,0),Qi.red=new Qi(1,0,0,1);class ji{constructor(l,g,T){this.sensitivity=l?g?"variant":"case":g?"accent":"base",this.locale=T,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,g){return this.collator.compare(l,g)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pr{constructor(l,g,T,z,F){this.text=l,this.image=g,this.scale=T,this.fontStack=z,this.textColor=F}}class $n{constructor(l){this.sections=l}static fromString(l){return new $n([new pr(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((l=>l.text.length!==0||l.image&&l.image.name.length!==0))}static factory(l){return l instanceof $n?l:$n.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map((l=>l.text)).join("")}}class Nn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Nn)return l;if(typeof l=="number")return new Nn([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const g of l)if(typeof g!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Nn(l)}}toString(){return JSON.stringify(this.values)}}const qr=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Oa{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Oa)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let g=0;g<l.length;g+=2){const T=l[g],z=l[g+1];if(typeof T!="string"||!qr.has(T)||!Array.isArray(z)||z.length!==2||typeof z[0]!="number"||typeof z[1]!="number")return}return new Oa(l)}}toString(){return JSON.stringify(this.values)}}class ts{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new ts({name:l,available:!1}):null}}function cs(f,l,g,T){return typeof f=="number"&&f>=0&&f<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof g=="number"&&g>=0&&g<=255?T===void 0||typeof T=="number"&&T>=0&&T<=1?null:`Invalid rgba value [${[f,l,g,T].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof T=="number"?[f,l,g,T]:[f,l,g]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zs(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof Qi||f instanceof ji||f instanceof $n||f instanceof Nn||f instanceof Oa||f instanceof ts)return!0;if(Array.isArray(f)){for(const l of f)if(!Zs(l))return!1;return!0}if(typeof f=="object"){for(const l in f)if(!Zs(f[l]))return!1;return!0}return!1}function na(f){if(f===null)return ms;if(typeof f=="string")return er;if(typeof f=="boolean")return sr;if(typeof f=="number")return xn;if(f instanceof Qi)return Xs;if(f instanceof ji)return pl;if(f instanceof $n)return Uo;if(f instanceof Nn)return oc;if(f instanceof Oa)return ft;if(f instanceof ts)return cl;if(Array.isArray(f)){const l=f.length;let g;for(const T of f){const z=na(T);if(g){if(g===z)continue;g=Jr;break}g=z}return ze(g||Jr,l)}return fl}function $r(f){const l=typeof f;return f===null?"":l==="string"||l==="number"||l==="boolean"?String(f):f instanceof Qi||f instanceof $n||f instanceof Nn||f instanceof Oa||f instanceof ts?f.toString():JSON.stringify(f)}class _a{constructor(l,g){this.type=l,this.value=g}static parse(l,g){if(l.length!==2)return g.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!Zs(l[1]))return g.error("invalid value");const T=l[1];let z=na(T);const F=g.expectedType;return z.kind!=="array"||z.N!==0||!F||F.kind!=="array"||typeof F.N=="number"&&F.N!==0||(z=F),new _a(z,T)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ur{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const kr={string:er,number:xn,boolean:sr,object:fl};class Xa{constructor(l,g){this.type=l,this.args=g}static parse(l,g){if(l.length<2)return g.error("Expected at least one argument.");let T,z=1;const F=l[0];if(F==="array"){let H,W;if(l.length>2){const re=l[1];if(typeof re!="string"||!(re in kr)||re==="object")return g.error('The item type argument of "array" must be one of string, number, boolean',1);H=kr[re],z++}else H=Jr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return g.error('The length argument to "array" must be a positive integer literal',2);W=l[2],z++}T=ze(H,W)}else{if(!kr[F])throw new Error(`Types doesn't contain name = ${F}`);T=kr[F]}const O=[];for(;z<l.length;z++){const H=g.parse(l[z],z,Jr);if(!H)return null;O.push(H)}return new Xa(T,O)}evaluate(l){for(let g=0;g<this.args.length;g++){const T=this.args[g].evaluate(l);if(!gt(this.type,na(T)))return T;if(g===this.args.length-1)throw new ur(`Expected value to be of type ${Pe(this.type)}, but found ${Pe(na(T))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}const Lo={"to-boolean":sr,"to-color":Xs,"to-number":xn,"to-string":er};class eo{constructor(l,g){this.type=l,this.args=g}static parse(l,g){if(l.length<2)return g.error("Expected at least one argument.");const T=l[0];if(!Lo[T])throw new Error(`Can't parse ${T} as it is not part of the known types`);if((T==="to-boolean"||T==="to-string")&&l.length!==2)return g.error("Expected one argument.");const z=Lo[T],F=[];for(let O=1;O<l.length;O++){const H=g.parse(l[O],O,Jr);if(!H)return null;F.push(H)}return new eo(z,F)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let g,T;for(const z of this.args){if(g=z.evaluate(l),T=null,g instanceof Qi)return g;if(typeof g=="string"){const F=l.parseColor(g);if(F)return F}else if(Array.isArray(g)&&(T=g.length<3||g.length>4?`Invalid rbga value ${JSON.stringify(g)}: expected an array containing either three or four numeric values.`:cs(g[0],g[1],g[2],g[3]),!T))return new Qi(g[0]/255,g[1]/255,g[2]/255,g[3])}throw new ur(T||`Could not parse color from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"padding":{let g;for(const T of this.args){g=T.evaluate(l);const z=Nn.parse(g);if(z)return z}throw new ur(`Could not parse padding from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"variableAnchorOffsetCollection":{let g;for(const T of this.args){g=T.evaluate(l);const z=Oa.parse(g);if(z)return z}throw new ur(`Could not parse variableAnchorOffsetCollection from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"number":{let g=null;for(const T of this.args){if(g=T.evaluate(l),g===null)return 0;const z=Number(g);if(!isNaN(z))return z}throw new ur(`Could not convert ${JSON.stringify(g)} to number.`)}case"formatted":return $n.fromString($r(this.args[0].evaluate(l)));case"resolvedImage":return ts.fromString($r(this.args[0].evaluate(l)));default:return $r(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}const ml=["Unknown","Point","LineString","Polygon"];class ih{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ml[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let g=this._parseColorCache[l];return g||(g=this._parseColorCache[l]=Qi.parse(l)),g}}class ns{constructor(l,g,T=[],z,F=new Ha,O=[]){this.registry=l,this.path=T,this.key=T.map((H=>`[${H}]`)).join(""),this.scope=F,this.errors=O,this.expectedType=z,this._isConstant=g}parse(l,g,T,z,F={}){return g?this.concat(g,T,z)._parse(l,F):this._parse(l,F)}_parse(l,g){function T(z,F,O){return O==="assert"?new Xa(F,[z]):O==="coerce"?new eo(F,[z]):z}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const z=l[0];if(typeof z!="string")return this.error(`Expression name must be a string, but found ${typeof z} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const F=this.registry[z];if(F){let O=F.parse(l,this);if(!O)return null;if(this.expectedType){const H=this.expectedType,W=O.type;if(H.kind!=="string"&&H.kind!=="number"&&H.kind!=="boolean"&&H.kind!=="object"&&H.kind!=="array"||W.kind!=="value")if(H.kind!=="color"&&H.kind!=="formatted"&&H.kind!=="resolvedImage"||W.kind!=="value"&&W.kind!=="string")if(H.kind!=="padding"||W.kind!=="value"&&W.kind!=="number"&&W.kind!=="array")if(H.kind!=="variableAnchorOffsetCollection"||W.kind!=="value"&&W.kind!=="array"){if(this.checkSubtype(H,W))return null}else O=T(O,H,g.typeAnnotation||"coerce");else O=T(O,H,g.typeAnnotation||"coerce");else O=T(O,H,g.typeAnnotation||"coerce");else O=T(O,H,g.typeAnnotation||"assert")}if(!(O instanceof _a)&&O.type.kind!=="resolvedImage"&&this._isConstant(O)){const H=new ih;try{O=new _a(O.type,O.evaluate(H))}catch(W){return this.error(W.message),null}}return O}return this.error(`Unknown expression "${z}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,g,T){const z=typeof l=="number"?this.path.concat(l):this.path,F=T?this.scope.concat(T):this.scope;return new ns(this.registry,this._isConstant,z,g||null,F,this.errors)}error(l,...g){const T=`${this.key}${g.map((z=>`[${z}]`)).join("")}`;this.errors.push(new Ta(T,l))}checkSubtype(l,g){const T=gt(l,g);return T&&this.error(T),T}}class Go{constructor(l,g){this.type=g.type,this.bindings=[].concat(l),this.result=g}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const g of this.bindings)l(g[1]);l(this.result)}static parse(l,g){if(l.length<4)return g.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const T=[];for(let F=1;F<l.length-1;F+=2){const O=l[F];if(typeof O!="string")return g.error(`Expected string, but found ${typeof O} instead.`,F);if(/[^a-zA-Z0-9_]/.test(O))return g.error("Variable names must contain only alphanumeric characters or '_'.",F);const H=g.parse(l[F+1],F+1);if(!H)return null;T.push([O,H])}const z=g.parse(l[l.length-1],l.length-1,g.expectedType,T);return z?new Go(T,z):null}outputDefined(){return this.result.outputDefined()}}class va{constructor(l,g){this.type=g.type,this.name=l,this.boundExpression=g}static parse(l,g){if(l.length!==2||typeof l[1]!="string")return g.error("'var' expression requires exactly one string literal argument.");const T=l[1];return g.scope.has(T)?new va(T,g.scope.get(T)):g.error(`Unknown variable "${T}". Make sure "${T}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class Mc{constructor(l,g,T){this.type=l,this.index=g,this.input=T}static parse(l,g){if(l.length!==3)return g.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const T=g.parse(l[1],1,xn),z=g.parse(l[2],2,ze(g.expectedType||Jr));return T&&z?new Mc(z.type.itemType,T,z):null}evaluate(l){const g=this.index.evaluate(l),T=this.input.evaluate(l);if(g<0)throw new ur(`Array index out of bounds: ${g} < 0.`);if(g>=T.length)throw new ur(`Array index out of bounds: ${g} > ${T.length-1}.`);if(g!==Math.floor(g))throw new ur(`Array index must be an integer, but found ${g} instead.`);return T[g]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class to{constructor(l,g){this.type=sr,this.needle=l,this.haystack=g}static parse(l,g){if(l.length!==3)return g.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const T=g.parse(l[1],1,Jr),z=g.parse(l[2],2,Jr);return T&&z?jt(T.type,[sr,er,xn,ms,Jr])?new to(T,z):g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pe(T.type)} instead`):null}evaluate(l){const g=this.needle.evaluate(l),T=this.haystack.evaluate(l);if(!T)return!1;if(!Ge(g,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${Pe(na(g))} instead.`);if(!Ge(T,["string","array"]))throw new ur(`Expected second argument to be of type array or string, but found ${Pe(na(T))} instead.`);return T.indexOf(g)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class Vc{constructor(l,g,T){this.type=xn,this.needle=l,this.haystack=g,this.fromIndex=T}static parse(l,g){if(l.length<=2||l.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const T=g.parse(l[1],1,Jr),z=g.parse(l[2],2,Jr);if(!T||!z)return null;if(!jt(T.type,[sr,er,xn,ms,Jr]))return g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Pe(T.type)} instead`);if(l.length===4){const F=g.parse(l[3],3,xn);return F?new Vc(T,z,F):null}return new Vc(T,z)}evaluate(l){const g=this.needle.evaluate(l),T=this.haystack.evaluate(l);if(!Ge(g,["boolean","string","number","null"]))throw new ur(`Expected first argument to be of type boolean, string, number or null, but found ${Pe(na(g))} instead.`);let z;if(this.fromIndex&&(z=this.fromIndex.evaluate(l)),Ge(T,["string"])){const F=T.indexOf(g,z);return F===-1?-1:[...T.slice(0,F)].length}if(Ge(T,["array"]))return T.indexOf(g,z);throw new ur(`Expected second argument to be of type array or string, but found ${Pe(na(T))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class Ah{constructor(l,g,T,z,F,O){this.inputType=l,this.type=g,this.input=T,this.cases=z,this.outputs=F,this.otherwise=O}static parse(l,g){if(l.length<5)return g.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return g.error("Expected an even number of arguments.");let T,z;g.expectedType&&g.expectedType.kind!=="value"&&(z=g.expectedType);const F={},O=[];for(let re=2;re<l.length-1;re+=2){let pe=l[re];const ve=l[re+1];Array.isArray(pe)||(pe=[pe]);const Me=g.concat(re);if(pe.length===0)return Me.error("Expected at least one branch label.");for(const qe of pe){if(typeof qe!="number"&&typeof qe!="string")return Me.error("Branch labels must be numbers or strings.");if(typeof qe=="number"&&Math.abs(qe)>Number.MAX_SAFE_INTEGER)return Me.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof qe=="number"&&Math.floor(qe)!==qe)return Me.error("Numeric branch labels must be integer values.");if(T){if(Me.checkSubtype(T,na(qe)))return null}else T=na(qe);if(F[String(qe)]!==void 0)return Me.error("Branch labels must be unique.");F[String(qe)]=O.length}const Le=g.parse(ve,re,z);if(!Le)return null;z=z||Le.type,O.push(Le)}const H=g.parse(l[1],1,Jr);if(!H)return null;const W=g.parse(l[l.length-1],l.length-1,z);return W?H.type.kind!=="value"&&g.concat(1).checkSubtype(T,H.type)?null:new Ah(T,z,H,F,O,W):null}evaluate(l){const g=this.input.evaluate(l);return(na(g)===this.inputType&&this.outputs[this.cases[g]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))&&this.otherwise.outputDefined()}}class su{constructor(l,g,T){this.type=l,this.branches=g,this.otherwise=T}static parse(l,g){if(l.length<4)return g.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return g.error("Expected an odd number of arguments.");let T;g.expectedType&&g.expectedType.kind!=="value"&&(T=g.expectedType);const z=[];for(let O=1;O<l.length-1;O+=2){const H=g.parse(l[O],O,sr);if(!H)return null;const W=g.parse(l[O+1],O+1,T);if(!W)return null;z.push([H,W]),T=T||W.type}const F=g.parse(l[l.length-1],l.length-1,T);if(!F)return null;if(!T)throw new Error("Can't infer output type");return new su(T,z,F)}evaluate(l){for(const[g,T]of this.branches)if(g.evaluate(l))return T.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[g,T]of this.branches)l(g),l(T);l(this.otherwise)}outputDefined(){return this.branches.every((([l,g])=>g.outputDefined()))&&this.otherwise.outputDefined()}}class Kh{constructor(l,g,T,z){this.type=l,this.input=g,this.beginIndex=T,this.endIndex=z}static parse(l,g){if(l.length<=2||l.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const T=g.parse(l[1],1,Jr),z=g.parse(l[2],2,xn);if(!T||!z)return null;if(!jt(T.type,[ze(Jr),er,Jr]))return g.error(`Expected first argument to be of type array or string, but found ${Pe(T.type)} instead`);if(l.length===4){const F=g.parse(l[3],3,xn);return F?new Kh(T.type,T,z,F):null}return new Kh(T.type,T,z)}evaluate(l){const g=this.input.evaluate(l),T=this.beginIndex.evaluate(l);let z;if(this.endIndex&&(z=this.endIndex.evaluate(l)),Ge(g,["string"]))return[...g].slice(T,z).join("");if(Ge(g,["array"]))return g.slice(T,z);throw new ur(`Expected first argument to be of type array or string, but found ${Pe(na(g))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Jh(f,l){const g=f.length-1;let T,z,F=0,O=g,H=0;for(;F<=O;)if(H=Math.floor((F+O)/2),T=f[H],z=f[H+1],T<=l){if(H===g||l<z)return H;F=H+1}else{if(!(T>l))throw new ur("Input is not a number.");O=H-1}return 0}class Mu{constructor(l,g,T){this.type=l,this.input=g,this.labels=[],this.outputs=[];for(const[z,F]of T)this.labels.push(z),this.outputs.push(F)}static parse(l,g){if(l.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return g.error("Expected an even number of arguments.");const T=g.parse(l[1],1,xn);if(!T)return null;const z=[];let F=null;g.expectedType&&g.expectedType.kind!=="value"&&(F=g.expectedType);for(let O=1;O<l.length;O+=2){const H=O===1?-1/0:l[O],W=l[O+1],re=O,pe=O+1;if(typeof H!="number")return g.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(z.length&&z[z.length-1][0]>=H)return g.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',re);const ve=g.parse(W,pe,F);if(!ve)return null;F=F||ve.type,z.push([H,ve])}return new Mu(F,T,z)}evaluate(l){const g=this.labels,T=this.outputs;if(g.length===1)return T[0].evaluate(l);const z=this.input.evaluate(l);if(z<=g[0])return T[0].evaluate(l);const F=g.length;return z>=g[F-1]?T[F-1].evaluate(l):T[Jh(g,z)].evaluate(l)}eachChild(l){l(this.input);for(const g of this.outputs)l(g)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))}}function Uc(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var lc=ou;function ou(f,l,g,T){this.cx=3*f,this.bx=3*(g-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(T-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=l,this.p2x=g,this.p2y=T}ou.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,l){if(l===void 0&&(l=1e-6),f<0)return 0;if(f>1)return 1;for(var g=f,T=0;T<8;T++){var z=this.sampleCurveX(g)-f;if(Math.abs(z)<l)return g;var F=this.sampleCurveDerivativeX(g);if(Math.abs(F)<1e-6)break;g-=z/F}var O=0,H=1;for(g=f,T=0;T<20&&(z=this.sampleCurveX(g),!(Math.abs(z-f)<l));T++)f>z?O=g:H=g,g=.5*(H-O)+O;return g},solve:function(f,l){return this.sampleCurveY(this.solveCurveX(f,l))}};var Ic=Uc(lc);function _o(f,l,g){return f+g*(l-f)}function Zl(f,l,g){return f.map(((T,z)=>_o(T,l[z],g)))}const ko={number:_o,color:function(f,l,g,T="rgb"){switch(T){case"rgb":{const[z,F,O,H]=Zl(f.rgb,l.rgb,g);return new Qi(z,F,O,H,!1)}case"hcl":{const[z,F,O,H]=f.hcl,[W,re,pe,ve]=l.hcl;let Me,Le;if(isNaN(z)||isNaN(W))isNaN(z)?isNaN(W)?Me=NaN:(Me=W,O!==1&&O!==0||(Le=re)):(Me=z,pe!==1&&pe!==0||(Le=F));else{let ai=W-z;W>z&&ai>180?ai-=360:W<z&&z-W>180&&(ai+=360),Me=z+g*ai}const[qe,Je,xt,zt]=(function([ai,Vt,ii,Fi]){return ai=isNaN(ai)?0:ai*Cr,Xe([ii,Math.cos(ai)*Vt,Math.sin(ai)*Vt,Fi])})([Me,Le??_o(F,re,g),_o(O,pe,g),_o(H,ve,g)]);return new Qi(qe,Je,xt,zt,!1)}case"lab":{const[z,F,O,H]=Xe(Zl(f.lab,l.lab,g));return new Qi(z,F,O,H,!1)}}},array:Zl,padding:function(f,l,g){return new Nn(Zl(f.values,l.values,g))},variableAnchorOffsetCollection:function(f,l,g){const T=f.values,z=l.values;if(T.length!==z.length)throw new ur(`Cannot interpolate values of different length. from: ${f.toString()}, to: ${l.toString()}`);const F=[];for(let O=0;O<T.length;O+=2){if(T[O]!==z[O])throw new ur(`Cannot interpolate values containing mismatched anchors. from[${O}]: ${T[O]}, to[${O}]: ${z[O]}`);F.push(T[O]);const[H,W]=T[O+1],[re,pe]=z[O+1];F.push([_o(H,re,g),_o(W,pe,g)])}return new Oa(F)}};class Ao{constructor(l,g,T,z,F){this.type=l,this.operator=g,this.interpolation=T,this.input=z,this.labels=[],this.outputs=[];for(const[O,H]of F)this.labels.push(O),this.outputs.push(H)}static interpolationFactor(l,g,T,z){let F=0;if(l.name==="exponential")F=lu(g,l.base,T,z);else if(l.name==="linear")F=lu(g,1,T,z);else if(l.name==="cubic-bezier"){const O=l.controlPoints;F=new Ic(O[0],O[1],O[2],O[3]).solve(lu(g,1,T,z))}return F}static parse(l,g){let[T,z,F,...O]=l;if(!Array.isArray(z)||z.length===0)return g.error("Expected an interpolation type expression.",1);if(z[0]==="linear")z={name:"linear"};else if(z[0]==="exponential"){const re=z[1];if(typeof re!="number")return g.error("Exponential interpolation requires a numeric base.",1,1);z={name:"exponential",base:re}}else{if(z[0]!=="cubic-bezier")return g.error(`Unknown interpolation type ${String(z[0])}`,1,0);{const re=z.slice(1);if(re.length!==4||re.some((pe=>typeof pe!="number"||pe<0||pe>1)))return g.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);z={name:"cubic-bezier",controlPoints:re}}}if(l.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return g.error("Expected an even number of arguments.");if(F=g.parse(F,2,xn),!F)return null;const H=[];let W=null;T==="interpolate-hcl"||T==="interpolate-lab"?W=Xs:g.expectedType&&g.expectedType.kind!=="value"&&(W=g.expectedType);for(let re=0;re<O.length;re+=2){const pe=O[re],ve=O[re+1],Me=re+3,Le=re+4;if(typeof pe!="number")return g.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Me);if(H.length&&H[H.length-1][0]>=pe)return g.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Me);const qe=g.parse(ve,Le,W);if(!qe)return null;W=W||qe.type,H.push([pe,qe])}return ei(W,xn)||ei(W,Xs)||ei(W,oc)||ei(W,ft)||ei(W,ze(xn))?new Ao(W,T,z,F,H):g.error(`Type ${Pe(W)} is not interpolatable.`)}evaluate(l){const g=this.labels,T=this.outputs;if(g.length===1)return T[0].evaluate(l);const z=this.input.evaluate(l);if(z<=g[0])return T[0].evaluate(l);const F=g.length;if(z>=g[F-1])return T[F-1].evaluate(l);const O=Jh(g,z),H=Ao.interpolationFactor(this.interpolation,z,g[O],g[O+1]),W=T[O].evaluate(l),re=T[O+1].evaluate(l);switch(this.operator){case"interpolate":return ko[this.type.kind](W,re,H);case"interpolate-hcl":return ko.color(W,re,H,"hcl");case"interpolate-lab":return ko.color(W,re,H,"lab")}}eachChild(l){l(this.input);for(const g of this.outputs)l(g)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))}}function lu(f,l,g,T){const z=T-g,F=f-g;return z===0?0:l===1?F/z:(Math.pow(l,F)-1)/(Math.pow(l,z)-1)}class Iu{constructor(l,g){this.type=l,this.args=g}static parse(l,g){if(l.length<2)return g.error("Expectected at least one argument.");let T=null;const z=g.expectedType;z&&z.kind!=="value"&&(T=z);const F=[];for(const H of l.slice(1)){const W=g.parse(H,1+F.length,T,void 0,{typeAnnotation:"omit"});if(!W)return null;T=T||W.type,F.push(W)}if(!T)throw new Error("No output type");const O=z&&F.some((H=>gt(z,H.type)));return new Iu(O?Jr:T,F)}evaluate(l){let g,T=null,z=0;for(const F of this.args)if(z++,T=F.evaluate(l),T&&T instanceof ts&&!T.available&&(g||(g=T.name),T=null,z===this.args.length&&(T=g)),T!==null)break;return T}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}function Mh(f,l){return f==="=="||f==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Jf(f,l,g,T){return T.compare(l,g)===0}function Cc(f,l,g){const T=f!=="=="&&f!=="!=";return class _w{constructor(F,O,H){this.type=sr,this.lhs=F,this.rhs=O,this.collator=H,this.hasUntypedArgument=F.type.kind==="value"||O.type.kind==="value"}static parse(F,O){if(F.length!==3&&F.length!==4)return O.error("Expected two or three arguments.");const H=F[0];let W=O.parse(F[1],1,Jr);if(!W)return null;if(!Mh(H,W.type))return O.concat(1).error(`"${H}" comparisons are not supported for type '${Pe(W.type)}'.`);let re=O.parse(F[2],2,Jr);if(!re)return null;if(!Mh(H,re.type))return O.concat(2).error(`"${H}" comparisons are not supported for type '${Pe(re.type)}'.`);if(W.type.kind!==re.type.kind&&W.type.kind!=="value"&&re.type.kind!=="value")return O.error(`Cannot compare types '${Pe(W.type)}' and '${Pe(re.type)}'.`);T&&(W.type.kind==="value"&&re.type.kind!=="value"?W=new Xa(re.type,[W]):W.type.kind!=="value"&&re.type.kind==="value"&&(re=new Xa(W.type,[re])));let pe=null;if(F.length===4){if(W.type.kind!=="string"&&re.type.kind!=="string"&&W.type.kind!=="value"&&re.type.kind!=="value")return O.error("Cannot use collator to compare non-string types.");if(pe=O.parse(F[3],3,pl),!pe)return null}return new _w(W,re,pe)}evaluate(F){const O=this.lhs.evaluate(F),H=this.rhs.evaluate(F);if(T&&this.hasUntypedArgument){const W=na(O),re=na(H);if(W.kind!==re.kind||W.kind!=="string"&&W.kind!=="number")throw new ur(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${W.kind}, ${re.kind}) instead.`)}if(this.collator&&!T&&this.hasUntypedArgument){const W=na(O),re=na(H);if(W.kind!=="string"||re.kind!=="string")return l(F,O,H)}return this.collator?g(F,O,H,this.collator.evaluate(F)):l(F,O,H)}eachChild(F){F(this.lhs),F(this.rhs),this.collator&&F(this.collator)}outputDefined(){return!0}}}const Ho=Cc("==",(function(f,l,g){return l===g}),Jf),Sd=Cc("!=",(function(f,l,g){return l!==g}),(function(f,l,g,T){return!Jf(0,l,g,T)})),cu=Cc("<",(function(f,l,g){return l<g}),(function(f,l,g,T){return T.compare(l,g)<0})),Wl=Cc(">",(function(f,l,g){return l>g}),(function(f,l,g,T){return T.compare(l,g)>0})),Ap=Cc("<=",(function(f,l,g){return l<=g}),(function(f,l,g,T){return T.compare(l,g)<=0})),Hd=Cc(">=",(function(f,l,g){return l>=g}),(function(f,l,g,T){return T.compare(l,g)>=0}));class nh{constructor(l,g,T){this.type=pl,this.locale=T,this.caseSensitive=l,this.diacriticSensitive=g}static parse(l,g){if(l.length!==2)return g.error("Expected one argument.");const T=l[1];if(typeof T!="object"||Array.isArray(T))return g.error("Collator options argument must be an object.");const z=g.parse(T["case-sensitive"]!==void 0&&T["case-sensitive"],1,sr);if(!z)return null;const F=g.parse(T["diacritic-sensitive"]!==void 0&&T["diacritic-sensitive"],1,sr);if(!F)return null;let O=null;return T.locale&&(O=g.parse(T.locale,1,er),!O)?null:new nh(z,F,O)}evaluate(l){return new ji(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class Qr{constructor(l,g,T,z,F){this.type=er,this.number=l,this.locale=g,this.currency=T,this.minFractionDigits=z,this.maxFractionDigits=F}static parse(l,g){if(l.length!==3)return g.error("Expected two arguments.");const T=g.parse(l[1],1,xn);if(!T)return null;const z=l[2];if(typeof z!="object"||Array.isArray(z))return g.error("NumberFormat options argument must be an object.");let F=null;if(z.locale&&(F=g.parse(z.locale,1,er),!F))return null;let O=null;if(z.currency&&(O=g.parse(z.currency,1,er),!O))return null;let H=null;if(z["min-fraction-digits"]&&(H=g.parse(z["min-fraction-digits"],1,xn),!H))return null;let W=null;return z["max-fraction-digits"]&&(W=g.parse(z["max-fraction-digits"],1,xn),!W)?null:new Qr(T,F,O,H,W)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class rh{constructor(l){this.type=Uo,this.sections=l}static parse(l,g){if(l.length<2)return g.error("Expected at least one argument.");const T=l[1];if(!Array.isArray(T)&&typeof T=="object")return g.error("First argument must be an image or text section.");const z=[];let F=!1;for(let O=1;O<=l.length-1;++O){const H=l[O];if(F&&typeof H=="object"&&!Array.isArray(H)){F=!1;let W=null;if(H["font-scale"]&&(W=g.parse(H["font-scale"],1,xn),!W))return null;let re=null;if(H["text-font"]&&(re=g.parse(H["text-font"],1,ze(er)),!re))return null;let pe=null;if(H["text-color"]&&(pe=g.parse(H["text-color"],1,Xs),!pe))return null;const ve=z[z.length-1];ve.scale=W,ve.font=re,ve.textColor=pe}else{const W=g.parse(l[O],1,Jr);if(!W)return null;const re=W.type.kind;if(re!=="string"&&re!=="value"&&re!=="null"&&re!=="resolvedImage")return g.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");F=!0,z.push({content:W,scale:null,font:null,textColor:null})}}return new rh(z)}evaluate(l){return new $n(this.sections.map((g=>{const T=g.content.evaluate(l);return na(T)===cl?new pr("",T,null,null,null):new pr($r(T),null,g.scale?g.scale.evaluate(l):null,g.font?g.font.evaluate(l).join(","):null,g.textColor?g.textColor.evaluate(l):null)})))}eachChild(l){for(const g of this.sections)l(g.content),g.scale&&l(g.scale),g.font&&l(g.font),g.textColor&&l(g.textColor)}outputDefined(){return!1}}class qd{constructor(l){this.type=cl,this.input=l}static parse(l,g){if(l.length!==2)return g.error("Expected two arguments.");const T=g.parse(l[1],1,er);return T?new qd(T):g.error("No image name provided.")}evaluate(l){const g=this.input.evaluate(l),T=ts.fromString(g);return T&&l.availableImages&&(T.available=l.availableImages.indexOf(g)>-1),T}eachChild(l){l(this.input)}outputDefined(){return!1}}class Il{constructor(l){this.type=xn,this.input=l}static parse(l,g){if(l.length!==2)return g.error(`Expected 1 argument, but found ${l.length-1} instead.`);const T=g.parse(l[1],1);return T?T.type.kind!=="array"&&T.type.kind!=="string"&&T.type.kind!=="value"?g.error(`Expected argument of type string or array, but found ${Pe(T.type)} instead.`):new Il(T):null}evaluate(l){const g=this.input.evaluate(l);if(typeof g=="string")return[...g].length;if(Array.isArray(g))return g.length;throw new ur(`Expected value to be of type string or array, but found ${Pe(na(g))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const Cl=8192;function Cu(f,l){const g=(180+f[0])/360,T=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,z=Math.pow(2,l.z);return[Math.round(g*z*Cl),Math.round(T*z*Cl)]}function zu(f,l){const g=Math.pow(2,l.z);return[(z=(f[0]/Cl+l.x)/g,360*z-180),(T=(f[1]/Cl+l.y)/g,360/Math.PI*Math.atan(Math.exp((180-360*T)*Math.PI/180))-90)];var T,z}function Ru(f,l){f[0]=Math.min(f[0],l[0]),f[1]=Math.min(f[1],l[1]),f[2]=Math.max(f[2],l[0]),f[3]=Math.max(f[3],l[1])}function uu(f,l){return!(f[0]<=l[0]||f[2]>=l[2]||f[1]<=l[1]||f[3]>=l[3])}function ss(f,l,g){const T=f[0]-l[0],z=f[1]-l[1],F=f[0]-g[0],O=f[1]-g[1];return T*O-F*z==0&&T*F<=0&&z*O<=0}function zl(f,l,g,T){return(z=[T[0]-g[0],T[1]-g[1]])[0]*(F=[l[0]-f[0],l[1]-f[1]])[1]-z[1]*F[0]!=0&&!(!Ed(f,l,g,T)||!Ed(g,T,f,l));var z,F}function Qh(f,l,g){for(const T of g)for(let z=0;z<T.length-1;++z)if(zl(f,l,T[z],T[z+1]))return!0;return!1}function Ih(f,l,g=!1){let T=!1;for(const H of l)for(let W=0;W<H.length-1;W++){if(ss(f,H[W],H[W+1]))return g;(F=H[W])[1]>(z=f)[1]!=(O=H[W+1])[1]>z[1]&&z[0]<(O[0]-F[0])*(z[1]-F[1])/(O[1]-F[1])+F[0]&&(T=!T)}var z,F,O;return T}function ed(f,l){for(const g of l)if(Ih(f,g))return!0;return!1}function td(f,l){for(const g of f)if(!Ih(g,l))return!1;for(let g=0;g<f.length-1;++g)if(Qh(f[g],f[g+1],l))return!1;return!0}function Rl(f,l){for(const g of l)if(td(f,g))return!0;return!1}function Ed(f,l,g,T){const z=T[0]-g[0],F=T[1]-g[1],O=(f[0]-g[0])*F-z*(f[1]-g[1]),H=(l[0]-g[0])*F-z*(l[1]-g[1]);return O>0&&H<0||O<0&&H>0}function Ad(f,l,g){const T=[];for(let z=0;z<f.length;z++){const F=[];for(let O=0;O<f[z].length;O++){const H=Cu(f[z][O],g);Ru(l,H),F.push(H)}T.push(F)}return T}function Gc(f,l,g){const T=[];for(let z=0;z<f.length;z++){const F=Ad(f[z],l,g);T.push(F)}return T}function Ia(f,l,g,T){if(f[0]<g[0]||f[0]>g[2]){const z=.5*T;let F=f[0]-g[0]>z?-T:g[0]-f[0]>z?T:0;F===0&&(F=f[0]-g[2]>z?-T:g[2]-f[0]>z?T:0),f[0]+=F}Ru(l,f)}function Mp(f,l,g,T){const z=Math.pow(2,T.z)*Cl,F=[T.x*Cl,T.y*Cl],O=[];for(const H of f)for(const W of H){const re=[W.x+F[0],W.y+F[1]];Ia(re,l,g,z),O.push(re)}return O}function Ip(f,l,g,T){const z=Math.pow(2,T.z)*Cl,F=[T.x*Cl,T.y*Cl],O=[];for(const W of f){const re=[];for(const pe of W){const ve=[pe.x+F[0],pe.y+F[1]];Ru(l,ve),re.push(ve)}O.push(re)}if(l[2]-l[0]<=z/2){(H=l)[0]=H[1]=1/0,H[2]=H[3]=-1/0;for(const W of O)for(const re of W)Ia(re,l,g,z)}var H;return O}class Ch{constructor(l,g){this.type=sr,this.geojson=l,this.geometries=g}static parse(l,g){if(l.length!==2)return g.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Zs(l[1])){const T=l[1];if(T.type==="FeatureCollection"){const z=[];for(const F of T.features){const{type:O,coordinates:H}=F.geometry;O==="Polygon"&&z.push(H),O==="MultiPolygon"&&z.push(...H)}if(z.length)return new Ch(T,{type:"MultiPolygon",coordinates:z})}else if(T.type==="Feature"){const z=T.geometry.type;if(z==="Polygon"||z==="MultiPolygon")return new Ch(T,T.geometry)}else if(T.type==="Polygon"||T.type==="MultiPolygon")return new Ch(T,T)}return g.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return(function(g,T){const z=[1/0,1/0,-1/0,-1/0],F=[1/0,1/0,-1/0,-1/0],O=g.canonicalID();if(T.type==="Polygon"){const H=Ad(T.coordinates,F,O),W=Mp(g.geometry(),z,F,O);if(!uu(z,F))return!1;for(const re of W)if(!Ih(re,H))return!1}if(T.type==="MultiPolygon"){const H=Gc(T.coordinates,F,O),W=Mp(g.geometry(),z,F,O);if(!uu(z,F))return!1;for(const re of W)if(!ed(re,H))return!1}return!0})(l,this.geometries);if(l.geometryType()==="LineString")return(function(g,T){const z=[1/0,1/0,-1/0,-1/0],F=[1/0,1/0,-1/0,-1/0],O=g.canonicalID();if(T.type==="Polygon"){const H=Ad(T.coordinates,F,O),W=Ip(g.geometry(),z,F,O);if(!uu(z,F))return!1;for(const re of W)if(!td(re,H))return!1}if(T.type==="MultiPolygon"){const H=Gc(T.coordinates,F,O),W=Ip(g.geometry(),z,F,O);if(!uu(z,F))return!1;for(const re of W)if(!Rl(re,H))return!1}return!0})(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Hn=class{constructor(f=[],l=((g,T)=>g<T?-1:g>T?1:0)){if(this.data=f,this.length=this.data.length,this.compare=l,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(f){this.data.push(f),this._up(this.length++)}pop(){if(this.length===0)return;const f=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:l,compare:g}=this,T=l[f];for(;f>0;){const z=f-1>>1,F=l[z];if(g(T,F)>=0)break;l[f]=F,f=z}l[f]=T}_down(f){const{data:l,compare:g}=this,T=this.length>>1,z=l[f];for(;f<T;){let F=1+(f<<1);const O=F+1;if(O<this.length&&g(l[O],l[F])<0&&(F=O),g(l[F],z)>=0)break;l[f]=l[F],f=F}l[f]=z}};function Cp(f,l,g,T,z){$d(f,l,g,T||f.length-1,z||id)}function $d(f,l,g,T,z){for(;T>g;){if(T-g>600){var F=T-g+1,O=l-g+1,H=Math.log(F),W=.5*Math.exp(2*H/3),re=.5*Math.sqrt(H*W*(F-W)/F)*(O-F/2<0?-1:1);$d(f,l,Math.max(g,Math.floor(l-O*W/F+re)),Math.min(T,Math.floor(l+(F-O)*W/F+re)),z)}var pe=f[l],ve=g,Me=T;for(Xl(f,g,l),z(f[T],pe)>0&&Xl(f,g,T);ve<Me;){for(Xl(f,ve,Me),ve++,Me--;z(f[ve],pe)<0;)ve++;for(;z(f[Me],pe)>0;)Me--}z(f[g],pe)===0?Xl(f,g,Me):Xl(f,++Me,T),Me<=l&&(g=Me+1),l<=Me&&(T=Me-1)}}function Xl(f,l,g){var T=f[l];f[l]=f[g],f[g]=T}function id(f,l){return f<l?-1:f>l?1:0}function zc(f,l){if(f.length<=1)return[f];const g=[];let T,z;for(const F of f){const O=ra(F);O!==0&&(F.area=Math.abs(O),z===void 0&&(z=O<0),z===O<0?(T&&g.push(T),T=[F]):T.push(F))}if(T&&g.push(T),l>1)for(let F=0;F<g.length;F++)g[F].length<=l||(Cp(g[F],l,1,g[F].length-1,En),g[F]=g[F].slice(0,l));return g}function En(f,l){return l.area-f.area}function ra(f){let l=0;for(let g,T,z=0,F=f.length,O=F-1;z<F;O=z++)g=f[z],T=f[O],l+=(T.x-g.x)*(g.y+T.y);return l}const Ca=1/298.257223563,Yl=Ca*(2-Ca),Du=Math.PI/180;class Sa{constructor(l){const g=6378.137*Du*1e3,T=Math.cos(l*Du),z=1/(1-Yl*(1-T*T)),F=Math.sqrt(z);this.kx=g*F*T,this.ky=g*F*z*(1-Yl)}distance(l,g){const T=this.wrap(l[0]-g[0])*this.kx,z=(l[1]-g[1])*this.ky;return Math.sqrt(T*T+z*z)}pointOnLine(l,g){let T,z,F,O,H=1/0;for(let W=0;W<l.length-1;W++){let re=l[W][0],pe=l[W][1],ve=this.wrap(l[W+1][0]-re)*this.kx,Me=(l[W+1][1]-pe)*this.ky,Le=0;ve===0&&Me===0||(Le=(this.wrap(g[0]-re)*this.kx*ve+(g[1]-pe)*this.ky*Me)/(ve*ve+Me*Me),Le>1?(re=l[W+1][0],pe=l[W+1][1]):Le>0&&(re+=ve/this.kx*Le,pe+=Me/this.ky*Le)),ve=this.wrap(g[0]-re)*this.kx,Me=(g[1]-pe)*this.ky;const qe=ve*ve+Me*Me;qe<H&&(H=qe,T=re,z=pe,F=W,O=Le)}return{point:[T,z],index:F,t:Math.max(0,Math.min(1,O))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function Mf(f,l){return l[0]-f[0]}function nd(f){return f[1]-f[0]+1}function Hc(f,l){return f[1]>=f[0]&&f[1]<l}function rl(f,l){if(f[0]>f[1])return[null,null];const g=nd(f);if(l){if(g===2)return[f,null];const z=Math.floor(g/2);return[[f[0],f[0]+z],[f[0]+z,f[1]]]}if(g===1)return[f,null];const T=Math.floor(g/2)-1;return[[f[0],f[0]+T],[f[0]+T+1,f[1]]]}function so(f,l){if(!Hc(l,f.length))return[1/0,1/0,-1/0,-1/0];const g=[1/0,1/0,-1/0,-1/0];for(let T=l[0];T<=l[1];++T)Ru(g,f[T]);return g}function zp(f){const l=[1/0,1/0,-1/0,-1/0];for(const g of f)for(const T of g)Ru(l,T);return l}function qc(f){return f[0]!==-1/0&&f[1]!==-1/0&&f[2]!==1/0&&f[3]!==1/0}function zh(f,l,g){if(!qc(f)||!qc(l))return NaN;let T=0,z=0;return f[2]<l[0]&&(T=l[0]-f[2]),f[0]>l[2]&&(T=f[0]-l[2]),f[1]>l[3]&&(z=f[1]-l[3]),f[3]<l[1]&&(z=l[1]-f[3]),g.distance([0,0],[T,z])}function Pu(f,l,g){const T=g.pointOnLine(l,f);return g.distance(f,T.point)}function Md(f,l,g,T,z){const F=Math.min(Pu(f,[g,T],z),Pu(l,[g,T],z)),O=Math.min(Pu(g,[f,l],z),Pu(T,[f,l],z));return Math.min(F,O)}function Qf(f,l,g,T,z){if(!Hc(l,f.length)||!Hc(T,g.length))return 1/0;let F=1/0;for(let O=l[0];O<l[1];++O){const H=f[O],W=f[O+1];for(let re=T[0];re<T[1];++re){const pe=g[re],ve=g[re+1];if(zl(H,W,pe,ve))return 0;F=Math.min(F,Md(H,W,pe,ve,z))}}return F}function go(f,l,g,T,z){if(!Hc(l,f.length)||!Hc(T,g.length))return NaN;let F=1/0;for(let O=l[0];O<=l[1];++O)for(let H=T[0];H<=T[1];++H)if(F=Math.min(F,z.distance(f[O],g[H])),F===0)return F;return F}function Dl(f,l,g){if(Ih(f,l,!0))return 0;let T=1/0;for(const z of l){const F=z[0],O=z[z.length-1];if(F!==O&&(T=Math.min(T,Pu(f,[O,F],g)),T===0))return T;const H=g.pointOnLine(z,f);if(T=Math.min(T,g.distance(f,H.point)),T===0)return T}return T}function xa(f,l,g,T){if(!Hc(l,f.length))return NaN;for(let F=l[0];F<=l[1];++F)if(Ih(f[F],g,!0))return 0;let z=1/0;for(let F=l[0];F<l[1];++F){const O=f[F],H=f[F+1];for(const W of g)for(let re=0,pe=W.length,ve=pe-1;re<pe;ve=re++){const Me=W[ve],Le=W[re];if(zl(O,H,Me,Le))return 0;z=Math.min(z,Md(O,H,Me,Le,T))}}return z}function Co(f,l){for(const g of f)for(const T of g)if(Ih(T,l,!0))return!0;return!1}function Ls(f,l,g,T=1/0){const z=zp(f),F=zp(l);if(T!==1/0&&zh(z,F,g)>=T)return T;if(uu(z,F)){if(Co(f,l))return 0}else if(Co(l,f))return 0;let O=1/0;for(const H of f)for(let W=0,re=H.length,pe=re-1;W<re;pe=W++){const ve=H[pe],Me=H[W];for(const Le of l)for(let qe=0,Je=Le.length,xt=Je-1;qe<Je;xt=qe++){const zt=Le[xt],ai=Le[qe];if(zl(ve,Me,zt,ai))return 0;O=Math.min(O,Md(ve,Me,zt,ai,g))}}return O}function Ts(f,l,g,T,z,F){if(!F)return;const O=zh(so(T,F),z,g);O<l&&f.push([O,F,[0,0]])}function oo(f,l,g,T,z,F,O){if(!F||!O)return;const H=zh(so(T,F),so(z,O),g);H<l&&f.push([H,F,O])}function Pl(f,l,g,T,z=1/0){let F=Math.min(T.distance(f[0],g[0][0]),z);if(F===0)return F;const O=new Hn([[0,[0,f.length-1],[0,0]]],Mf),H=zp(g);for(;O.length>0;){const W=O.pop();if(W[0]>=F)continue;const re=W[1],pe=l?50:100;if(nd(re)<=pe){if(!Hc(re,f.length))return NaN;if(l){const ve=xa(f,re,g,T);if(isNaN(ve)||ve===0)return ve;F=Math.min(F,ve)}else for(let ve=re[0];ve<=re[1];++ve){const Me=Dl(f[ve],g,T);if(F=Math.min(F,Me),F===0)return 0}}else{const ve=rl(re,l);Ts(O,F,T,f,H,ve[0]),Ts(O,F,T,f,H,ve[1])}}return F}function Rc(f,l,g,T,z,F=1/0){let O=Math.min(F,z.distance(f[0],g[0]));if(O===0)return O;const H=new Hn([[0,[0,f.length-1],[0,g.length-1]]],Mf);for(;H.length>0;){const W=H.pop();if(W[0]>=O)continue;const re=W[1],pe=W[2],ve=l?50:100,Me=T?50:100;if(nd(re)<=ve&&nd(pe)<=Me){if(!Hc(re,f.length)&&Hc(pe,g.length))return NaN;let Le;if(l&&T)Le=Qf(f,re,g,pe,z),O=Math.min(O,Le);else if(l&&!T){const qe=f.slice(re[0],re[1]+1);for(let Je=pe[0];Je<=pe[1];++Je)if(Le=Pu(g[Je],qe,z),O=Math.min(O,Le),O===0)return O}else if(!l&&T){const qe=g.slice(pe[0],pe[1]+1);for(let Je=re[0];Je<=re[1];++Je)if(Le=Pu(f[Je],qe,z),O=Math.min(O,Le),O===0)return O}else Le=go(f,re,g,pe,z),O=Math.min(O,Le)}else{const Le=rl(re,l),qe=rl(pe,T);oo(H,O,z,f,g,Le[0],qe[0]),oo(H,O,z,f,g,Le[0],qe[1]),oo(H,O,z,f,g,Le[1],qe[0]),oo(H,O,z,f,g,Le[1],qe[1])}}return O}function io(f){return f.type==="MultiPolygon"?f.coordinates.map((l=>({type:"Polygon",coordinates:l}))):f.type==="MultiLineString"?f.coordinates.map((l=>({type:"LineString",coordinates:l}))):f.type==="MultiPoint"?f.coordinates.map((l=>({type:"Point",coordinates:l}))):[f]}class $c{constructor(l,g){this.type=xn,this.geojson=l,this.geometries=g}static parse(l,g){if(l.length!==2)return g.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(Zs(l[1])){const T=l[1];if(T.type==="FeatureCollection")return new $c(T,T.features.map((z=>io(z.geometry))).flat());if(T.type==="Feature")return new $c(T,io(T.geometry));if("type"in T&&"coordinates"in T)return new $c(T,io(T))}return g.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return(function(g,T){const z=g.geometry(),F=z.flat().map((W=>zu([W.x,W.y],g.canonical)));if(z.length===0)return NaN;const O=new Sa(F[0][1]);let H=1/0;for(const W of T){switch(W.type){case"Point":H=Math.min(H,Rc(F,!1,[W.coordinates],!1,O,H));break;case"LineString":H=Math.min(H,Rc(F,!1,W.coordinates,!0,O,H));break;case"Polygon":H=Math.min(H,Pl(F,!1,W.coordinates,O,H))}if(H===0)return H}return H})(l,this.geometries);if(l.geometryType()==="LineString")return(function(g,T){const z=g.geometry(),F=z.flat().map((W=>zu([W.x,W.y],g.canonical)));if(z.length===0)return NaN;const O=new Sa(F[0][1]);let H=1/0;for(const W of T){switch(W.type){case"Point":H=Math.min(H,Rc(F,!0,[W.coordinates],!1,O,H));break;case"LineString":H=Math.min(H,Rc(F,!0,W.coordinates,!0,O,H));break;case"Polygon":H=Math.min(H,Pl(F,!0,W.coordinates,O,H))}if(H===0)return H}return H})(l,this.geometries);if(l.geometryType()==="Polygon")return(function(g,T){const z=g.geometry();if(z.length===0||z[0].length===0)return NaN;const F=zc(z,0).map((W=>W.map((re=>re.map((pe=>zu([pe.x,pe.y],g.canonical))))))),O=new Sa(F[0][0][0][1]);let H=1/0;for(const W of T)for(const re of F){switch(W.type){case"Point":H=Math.min(H,Pl([W.coordinates],!1,re,O,H));break;case"LineString":H=Math.min(H,Pl(W.coordinates,!0,re,O,H));break;case"Polygon":H=Math.min(H,Ls(re,W.coordinates,O,H))}if(H===0)return H}return H})(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Kl={"==":Ho,"!=":Sd,">":Wl,"<":cu,">=":Hd,"<=":Ap,array:Xa,at:Mc,boolean:Xa,case:su,coalesce:Iu,collator:nh,format:rh,image:qd,in:to,"index-of":Vc,interpolate:Ao,"interpolate-hcl":Ao,"interpolate-lab":Ao,length:Il,let:Go,literal:_a,match:Ah,number:Xa,"number-format":Qr,object:Xa,slice:Kh,step:Mu,string:Xa,"to-boolean":eo,"to-color":eo,"to-number":eo,"to-string":eo,var:va,within:Ch,distance:$c};class zo{constructor(l,g,T,z){this.name=l,this.type=g,this._evaluate=T,this.args=z}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,g){const T=l[0],z=zo.definitions[T];if(!z)return g.error(`Unknown expression "${T}". If you wanted a literal array, use ["literal", [...]].`,0);const F=Array.isArray(z)?z[0]:z.type,O=Array.isArray(z)?[[z[1],z[2]]]:z.overloads,H=O.filter((([re])=>!Array.isArray(re)||re.length===l.length-1));let W=null;for(const[re,pe]of H){W=new ns(g.registry,Lu,g.path,null,g.scope);const ve=[];let Me=!1;for(let Le=1;Le<l.length;Le++){const qe=l[Le],Je=Array.isArray(re)?re[Le-1]:re.type,xt=W.parse(qe,1+ve.length,Je);if(!xt){Me=!0;break}ve.push(xt)}if(!Me)if(Array.isArray(re)&&re.length!==ve.length)W.error(`Expected ${re.length} arguments, but found ${ve.length} instead.`);else{for(let Le=0;Le<ve.length;Le++){const qe=Array.isArray(re)?re[Le]:re.type,Je=ve[Le];W.concat(Le+1).checkSubtype(qe,Je.type)}if(W.errors.length===0)return new zo(T,F,pe,ve)}}if(H.length===1)g.errors.push(...W.errors);else{const re=(H.length?H:O).map((([ve])=>{return Me=ve,Array.isArray(Me)?`(${Me.map(Pe).join(", ")})`:`(${Pe(Me.type)}...)`;var Me})).join(" | "),pe=[];for(let ve=1;ve<l.length;ve++){const Me=g.parse(l[ve],1+pe.length);if(!Me)return null;pe.push(Pe(Me.type))}g.error(`Expected arguments of type ${re}, but found (${pe.join(", ")}) instead.`)}return null}static register(l,g){zo.definitions=g;for(const T in g)l[T]=zo}}function hr(f,[l,g,T,z]){l=l.evaluate(f),g=g.evaluate(f),T=T.evaluate(f);const F=z?z.evaluate(f):1,O=cs(l,g,T,F);if(O)throw new ur(O);return new Qi(l/255,g/255,T/255,F,!1)}function yn(f,l){return f in l}function rd(f,l){const g=l[f];return g===void 0?null:g}function jn(f){return{type:f}}function Lu(f){if(f instanceof va)return Lu(f.boundExpression);if(f instanceof zo&&f.name==="error"||f instanceof nh||f instanceof Ch||f instanceof $c)return!1;const l=f instanceof eo||f instanceof Xa;let g=!0;return f.eachChild((T=>{g=l?g&&Lu(T):g&&T instanceof _a})),!!g&&Rh(f)&&Dc(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Rh(f){if(f instanceof zo&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof Ch||f instanceof $c)return!1;let l=!0;return f.eachChild((g=>{l&&!Rh(g)&&(l=!1)})),l}function Vn(f){if(f instanceof zo&&f.name==="feature-state")return!1;let l=!0;return f.eachChild((g=>{l&&!Vn(g)&&(l=!1)})),l}function Dc(f,l){if(f instanceof zo&&l.indexOf(f.name)>=0)return!1;let g=!0;return f.eachChild((T=>{g&&!Dc(T,l)&&(g=!1)})),g}function Zd(f){return{result:"success",value:f}}function Dh(f){return{result:"error",value:f}}function Zo(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function If(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function _s(f){return!!f.expression&&f.expression.interpolated}function qa(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function cc(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function ep(f){return f}function ah(f,l){const g=l.type==="color",T=f.stops&&typeof f.stops[0][0]=="object",z=T||!(T||f.property!==void 0),F=f.type||(_s(l)?"exponential":"interval");if(g||l.type==="padding"){const pe=g?Qi.parse:Nn.parse;(f=Gn({},f)).stops&&(f.stops=f.stops.map((ve=>[ve[0],pe(ve[1])]))),f.default=pe(f.default?f.default:l.default)}if(f.colorSpace&&(O=f.colorSpace)!=="rgb"&&O!=="hcl"&&O!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var O;let H,W,re;if(F==="exponential")H=hu;else if(F==="interval")H=tp;else if(F==="categorical"){H=ad,W=Object.create(null);for(const pe of f.stops)W[pe[0]]=pe[1];re=typeof f.stops[0][0]}else{if(F!=="identity")throw new Error(`Unknown function type "${F}"`);H=sd}if(T){const pe={},ve=[];for(let qe=0;qe<f.stops.length;qe++){const Je=f.stops[qe],xt=Je[0].zoom;pe[xt]===void 0&&(pe[xt]={zoom:xt,type:f.type,property:f.property,default:f.default,stops:[]},ve.push(xt)),pe[xt].stops.push([Je[0].value,Je[1]])}const Me=[];for(const qe of ve)Me.push([pe[qe].zoom,ah(pe[qe],l)]);const Le={name:"linear"};return{kind:"composite",interpolationType:Le,interpolationFactor:Ao.interpolationFactor.bind(void 0,Le),zoomStops:Me.map((qe=>qe[0])),evaluate:({zoom:qe},Je)=>hu({stops:Me,base:f.base},l,qe).evaluate(qe,Je)}}if(z){const pe=F==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:pe,interpolationFactor:Ao.interpolationFactor.bind(void 0,pe),zoomStops:f.stops.map((ve=>ve[0])),evaluate:({zoom:ve})=>H(f,l,ve,W,re)}}return{kind:"source",evaluate(pe,ve){const Me=ve&&ve.properties?ve.properties[f.property]:void 0;return Me===void 0?_l(f.default,l.default):H(f,l,Me,W,re)}}}function _l(f,l,g){return f!==void 0?f:l!==void 0?l:g!==void 0?g:void 0}function ad(f,l,g,T,z){return _l(typeof g===z?T[g]:void 0,f.default,l.default)}function tp(f,l,g){if(qa(g)!=="number")return _l(f.default,l.default);const T=f.stops.length;if(T===1||g<=f.stops[0][0])return f.stops[0][1];if(g>=f.stops[T-1][0])return f.stops[T-1][1];const z=Jh(f.stops.map((F=>F[0])),g);return f.stops[z][1]}function hu(f,l,g){const T=f.base!==void 0?f.base:1;if(qa(g)!=="number")return _l(f.default,l.default);const z=f.stops.length;if(z===1||g<=f.stops[0][0])return f.stops[0][1];if(g>=f.stops[z-1][0])return f.stops[z-1][1];const F=Jh(f.stops.map((pe=>pe[0])),g),O=(function(pe,ve,Me,Le){const qe=Le-Me,Je=pe-Me;return qe===0?0:ve===1?Je/qe:(Math.pow(ve,Je)-1)/(Math.pow(ve,qe)-1)})(g,T,f.stops[F][0],f.stops[F+1][0]),H=f.stops[F][1],W=f.stops[F+1][1],re=ko[l.type]||ep;return typeof H.evaluate=="function"?{evaluate(...pe){const ve=H.evaluate.apply(void 0,pe),Me=W.evaluate.apply(void 0,pe);if(ve!==void 0&&Me!==void 0)return re(ve,Me,O,f.colorSpace)}}:re(H,W,O,f.colorSpace)}function sd(f,l,g){switch(l.type){case"color":g=Qi.parse(g);break;case"formatted":g=$n.fromString(g.toString());break;case"resolvedImage":g=ts.fromString(g.toString());break;case"padding":g=Nn.parse(g);break;default:qa(g)===l.type||l.type==="enum"&&l.values[g]||(g=void 0)}return _l(g,f.default,l.default)}zo.register(Kl,{error:[{kind:"error"},[er],(f,[l])=>{throw new ur(l.evaluate(f))}],typeof:[er,[Jr],(f,[l])=>Pe(na(l.evaluate(f)))],"to-rgba":[ze(xn,4),[Xs],(f,[l])=>{const[g,T,z,F]=l.evaluate(f).rgb;return[255*g,255*T,255*z,F]}],rgb:[Xs,[xn,xn,xn],hr],rgba:[Xs,[xn,xn,xn,xn],hr],has:{type:sr,overloads:[[[er],(f,[l])=>yn(l.evaluate(f),f.properties())],[[er,fl],(f,[l,g])=>yn(l.evaluate(f),g.evaluate(f))]]},get:{type:Jr,overloads:[[[er],(f,[l])=>rd(l.evaluate(f),f.properties())],[[er,fl],(f,[l,g])=>rd(l.evaluate(f),g.evaluate(f))]]},"feature-state":[Jr,[er],(f,[l])=>rd(l.evaluate(f),f.featureState||{})],properties:[fl,[],f=>f.properties()],"geometry-type":[er,[],f=>f.geometryType()],id:[Jr,[],f=>f.id()],zoom:[xn,[],f=>f.globals.zoom],"heatmap-density":[xn,[],f=>f.globals.heatmapDensity||0],"line-progress":[xn,[],f=>f.globals.lineProgress||0],accumulated:[Jr,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[xn,jn(xn),(f,l)=>{let g=0;for(const T of l)g+=T.evaluate(f);return g}],"*":[xn,jn(xn),(f,l)=>{let g=1;for(const T of l)g*=T.evaluate(f);return g}],"-":{type:xn,overloads:[[[xn,xn],(f,[l,g])=>l.evaluate(f)-g.evaluate(f)],[[xn],(f,[l])=>-l.evaluate(f)]]},"/":[xn,[xn,xn],(f,[l,g])=>l.evaluate(f)/g.evaluate(f)],"%":[xn,[xn,xn],(f,[l,g])=>l.evaluate(f)%g.evaluate(f)],ln2:[xn,[],()=>Math.LN2],pi:[xn,[],()=>Math.PI],e:[xn,[],()=>Math.E],"^":[xn,[xn,xn],(f,[l,g])=>Math.pow(l.evaluate(f),g.evaluate(f))],sqrt:[xn,[xn],(f,[l])=>Math.sqrt(l.evaluate(f))],log10:[xn,[xn],(f,[l])=>Math.log(l.evaluate(f))/Math.LN10],ln:[xn,[xn],(f,[l])=>Math.log(l.evaluate(f))],log2:[xn,[xn],(f,[l])=>Math.log(l.evaluate(f))/Math.LN2],sin:[xn,[xn],(f,[l])=>Math.sin(l.evaluate(f))],cos:[xn,[xn],(f,[l])=>Math.cos(l.evaluate(f))],tan:[xn,[xn],(f,[l])=>Math.tan(l.evaluate(f))],asin:[xn,[xn],(f,[l])=>Math.asin(l.evaluate(f))],acos:[xn,[xn],(f,[l])=>Math.acos(l.evaluate(f))],atan:[xn,[xn],(f,[l])=>Math.atan(l.evaluate(f))],min:[xn,jn(xn),(f,l)=>Math.min(...l.map((g=>g.evaluate(f))))],max:[xn,jn(xn),(f,l)=>Math.max(...l.map((g=>g.evaluate(f))))],abs:[xn,[xn],(f,[l])=>Math.abs(l.evaluate(f))],round:[xn,[xn],(f,[l])=>{const g=l.evaluate(f);return g<0?-Math.round(-g):Math.round(g)}],floor:[xn,[xn],(f,[l])=>Math.floor(l.evaluate(f))],ceil:[xn,[xn],(f,[l])=>Math.ceil(l.evaluate(f))],"filter-==":[sr,[er,Jr],(f,[l,g])=>f.properties()[l.value]===g.value],"filter-id-==":[sr,[Jr],(f,[l])=>f.id()===l.value],"filter-type-==":[sr,[er],(f,[l])=>f.geometryType()===l.value],"filter-<":[sr,[er,Jr],(f,[l,g])=>{const T=f.properties()[l.value],z=g.value;return typeof T==typeof z&&T<z}],"filter-id-<":[sr,[Jr],(f,[l])=>{const g=f.id(),T=l.value;return typeof g==typeof T&&g<T}],"filter->":[sr,[er,Jr],(f,[l,g])=>{const T=f.properties()[l.value],z=g.value;return typeof T==typeof z&&T>z}],"filter-id->":[sr,[Jr],(f,[l])=>{const g=f.id(),T=l.value;return typeof g==typeof T&&g>T}],"filter-<=":[sr,[er,Jr],(f,[l,g])=>{const T=f.properties()[l.value],z=g.value;return typeof T==typeof z&&T<=z}],"filter-id-<=":[sr,[Jr],(f,[l])=>{const g=f.id(),T=l.value;return typeof g==typeof T&&g<=T}],"filter->=":[sr,[er,Jr],(f,[l,g])=>{const T=f.properties()[l.value],z=g.value;return typeof T==typeof z&&T>=z}],"filter-id->=":[sr,[Jr],(f,[l])=>{const g=f.id(),T=l.value;return typeof g==typeof T&&g>=T}],"filter-has":[sr,[Jr],(f,[l])=>l.value in f.properties()],"filter-has-id":[sr,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[sr,[ze(er)],(f,[l])=>l.value.indexOf(f.geometryType())>=0],"filter-id-in":[sr,[ze(Jr)],(f,[l])=>l.value.indexOf(f.id())>=0],"filter-in-small":[sr,[er,ze(Jr)],(f,[l,g])=>g.value.indexOf(f.properties()[l.value])>=0],"filter-in-large":[sr,[er,ze(Jr)],(f,[l,g])=>(function(T,z,F,O){for(;F<=O;){const H=F+O>>1;if(z[H]===T)return!0;z[H]>T?O=H-1:F=H+1}return!1})(f.properties()[l.value],g.value,0,g.value.length-1)],all:{type:sr,overloads:[[[sr,sr],(f,[l,g])=>l.evaluate(f)&&g.evaluate(f)],[jn(sr),(f,l)=>{for(const g of l)if(!g.evaluate(f))return!1;return!0}]]},any:{type:sr,overloads:[[[sr,sr],(f,[l,g])=>l.evaluate(f)||g.evaluate(f)],[jn(sr),(f,l)=>{for(const g of l)if(g.evaluate(f))return!0;return!1}]]},"!":[sr,[sr],(f,[l])=>!l.evaluate(f)],"is-supported-script":[sr,[er],(f,[l])=>{const g=f.globals&&f.globals.isSupportedScript;return!g||g(l.evaluate(f))}],upcase:[er,[er],(f,[l])=>l.evaluate(f).toUpperCase()],downcase:[er,[er],(f,[l])=>l.evaluate(f).toLowerCase()],concat:[er,jn(Jr),(f,l)=>l.map((g=>$r(g.evaluate(f)))).join("")],"resolved-locale":[er,[pl],(f,[l])=>l.evaluate(f).resolvedLocale()]});class du{constructor(l,g){var T;this.expression=l,this._warningHistory={},this._evaluator=new ih,this._defaultValue=g?(T=g).type==="color"&&cc(T.default)?new Qi(0,0,0,0):T.type==="color"?Qi.parse(T.default)||null:T.type==="padding"?Nn.parse(T.default)||null:T.type==="variableAnchorOffsetCollection"?Oa.parse(T.default)||null:T.default===void 0?null:T.default:null,this._enumValues=g&&g.type==="enum"?g.values:null}evaluateWithoutErrorHandling(l,g,T,z,F,O){return this._evaluator.globals=l,this._evaluator.feature=g,this._evaluator.featureState=T,this._evaluator.canonical=z,this._evaluator.availableImages=F||null,this._evaluator.formattedSection=O,this.expression.evaluate(this._evaluator)}evaluate(l,g,T,z,F,O){this._evaluator.globals=l,this._evaluator.feature=g||null,this._evaluator.featureState=T||null,this._evaluator.canonical=z,this._evaluator.availableImages=F||null,this._evaluator.formattedSection=O||null;try{const H=this.expression.evaluate(this._evaluator);if(H==null||typeof H=="number"&&H!=H)return this._defaultValue;if(this._enumValues&&!(H in this._enumValues))throw new ur(`Expected value to be one of ${Object.keys(this._enumValues).map((W=>JSON.stringify(W))).join(", ")}, but found ${JSON.stringify(H)} instead.`);return H}catch(H){return this._warningHistory[H.message]||(this._warningHistory[H.message]=!0,typeof console<"u"&&console.warn(H.message)),this._defaultValue}}}function Pc(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in Kl}function Lc(f,l){const g=new ns(Kl,Lu,[],l?(function(z){const F={color:Xs,string:er,number:xn,enum:er,boolean:sr,formatted:Uo,padding:oc,resolvedImage:cl,variableAnchorOffsetCollection:ft};return z.type==="array"?ze(F[z.value]||Jr,z.length):F[z.type]})(l):void 0),T=g.parse(f,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return T?Zd(new du(T,l)):Dh(g.errors)}class fu{constructor(l,g){this.kind=l,this._styleExpression=g,this.isStateDependent=l!=="constant"&&!Vn(g.expression)}evaluateWithoutErrorHandling(l,g,T,z,F,O){return this._styleExpression.evaluateWithoutErrorHandling(l,g,T,z,F,O)}evaluate(l,g,T,z,F,O){return this._styleExpression.evaluate(l,g,T,z,F,O)}}class Zc{constructor(l,g,T,z){this.kind=l,this.zoomStops=T,this._styleExpression=g,this.isStateDependent=l!=="camera"&&!Vn(g.expression),this.interpolationType=z}evaluateWithoutErrorHandling(l,g,T,z,F,O){return this._styleExpression.evaluateWithoutErrorHandling(l,g,T,z,F,O)}evaluate(l,g,T,z,F,O){return this._styleExpression.evaluate(l,g,T,z,F,O)}interpolationFactor(l,g,T){return this.interpolationType?Ao.interpolationFactor(this.interpolationType,l,g,T):0}}function Cf(f,l){const g=Lc(f,l);if(g.result==="error")return g;const T=g.value.expression,z=Rh(T);if(!z&&!Zo(l))return Dh([new Ta("","data expressions not supported")]);const F=Dc(T,["zoom"]);if(!F&&!If(l))return Dh([new Ta("","zoom expressions not supported")]);const O=pu(T);return O||F?O instanceof Ta?Dh([O]):O instanceof Ao&&!_s(l)?Dh([new Ta("",'"interpolate" expressions cannot be used with this property')]):Zd(O?new Zc(z?"camera":"composite",g.value,O.labels,O instanceof Ao?O.interpolation:void 0):new fu(z?"constant":"source",g.value)):Dh([new Ta("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class od{constructor(l,g){this._parameters=l,this._specification=g,Gn(this,ah(this._parameters,this._specification))}static deserialize(l){return new od(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function pu(f){let l=null;if(f instanceof Go)l=pu(f.result);else if(f instanceof Iu){for(const g of f.args)if(l=pu(g),l)break}else(f instanceof Mu||f instanceof Ao)&&f.input instanceof zo&&f.input.name==="zoom"&&(l=f);return l instanceof Ta||f.eachChild((g=>{const T=pu(g);T instanceof Ta?l=T:!l&&T?l=new Ta("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&T&&l!==T&&(l=new Ta("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),l}function Id(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const l of f.slice(1))if(!Id(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const mu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zf(f){if(f==null)return{filter:()=>!0,needGeometry:!1};Id(f)||(f=ku(f));const l=Lc(f,mu);if(l.result==="error")throw new Error(l.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return{filter:(g,T,z)=>l.value.evaluate(g,T,{},z),needGeometry:Rf(f)}}function hm(f,l){return f<l?-1:f>l?1:0}function Rf(f){if(!Array.isArray(f))return!1;if(f[0]==="within"||f[0]==="distance")return!0;for(let l=1;l<f.length;l++)if(Rf(f[l]))return!0;return!1}function ku(f){if(!f)return!0;const l=f[0];return f.length<=1?l!=="any":l==="=="?ld(f[1],f[2],"=="):l==="!="?Ws(ld(f[1],f[2],"==")):l==="<"||l===">"||l==="<="||l===">="?ld(f[1],f[2],l):l==="any"?(g=f.slice(1),["any"].concat(g.map(ku))):l==="all"?["all"].concat(f.slice(1).map(ku)):l==="none"?["all"].concat(f.slice(1).map(ku).map(Ws)):l==="in"?Ll(f[1],f.slice(2)):l==="!in"?Ws(Ll(f[1],f.slice(2))):l==="has"?cd(f[1]):l!=="!has"||Ws(cd(f[1]));var g}function ld(f,l,g){switch(f){case"$type":return[`filter-type-${g}`,l];case"$id":return[`filter-id-${g}`,l];default:return[`filter-${g}`,f,l]}}function Ll(f,l){if(l.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some((g=>typeof g!=typeof l[0]))?["filter-in-large",f,["literal",l.sort(hm)]]:["filter-in-small",f,["literal",l]]}}function cd(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function Ws(f){return["!",f]}function uc(f){const l=typeof f;if(l==="number"||l==="boolean"||l==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let z="[";for(const F of f)z+=`${uc(F)},`;return`${z}]`}const g=Object.keys(f).sort();let T="{";for(let z=0;z<g.length;z++)T+=`${JSON.stringify(g[z])}:${uc(f[g[z]])},`;return`${T}}`}function hc(f){let l="";for(const g of Va)l+=`/${uc(f[g])}`;return l}function sh(f){const l=f.value;return l?[new Qt(f.key,l,"constants have been deprecated as of v8")]:[]}function us(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function kl(f){if(Array.isArray(f))return f.map(kl);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const l={};for(const g in f)l[g]=kl(f[g]);return l}return us(f)}function pi(f){const l=f.key,g=f.value,T=f.valueSpec||{},z=f.objectElementValidators||{},F=f.style,O=f.styleSpec,H=f.validateSpec;let W=[];const re=qa(g);if(re!=="object")return[new Qt(l,g,`object expected, ${re} found`)];for(const pe in g){const ve=pe.split(".")[0],Me=T[ve]||T["*"];let Le;if(z[ve])Le=z[ve];else if(T[ve])Le=H;else if(z["*"])Le=z["*"];else{if(!T["*"]){W.push(new Qt(l,g[pe],`unknown property "${pe}"`));continue}Le=H}W=W.concat(Le({key:(l&&`${l}.`)+pe,value:g[pe],valueSpec:Me,style:F,styleSpec:O,object:g,objectKey:pe,validateSpec:H},g))}for(const pe in T)z[pe]||T[pe].required&&T[pe].default===void 0&&g[pe]===void 0&&W.push(new Qt(l,g,`missing required property "${pe}"`));return W}function Ph(f){const l=f.value,g=f.valueSpec,T=f.style,z=f.styleSpec,F=f.key,O=f.arrayElementValidator||f.validateSpec;if(qa(l)!=="array")return[new Qt(F,l,`array expected, ${qa(l)} found`)];if(g.length&&l.length!==g.length)return[new Qt(F,l,`array length ${g.length} expected, length ${l.length} found`)];if(g["min-length"]&&l.length<g["min-length"])return[new Qt(F,l,`array length at least ${g["min-length"]} expected, length ${l.length} found`)];let H={type:g.value,values:g.values};z.$version<7&&(H.function=g.function),qa(g.value)==="object"&&(H=g.value);let W=[];for(let re=0;re<l.length;re++)W=W.concat(O({array:l,arrayIndex:re,value:l[re],valueSpec:H,validateSpec:f.validateSpec,style:T,styleSpec:z,key:`${F}[${re}]`}));return W}function _u(f){const l=f.key,g=f.value,T=f.valueSpec;let z=qa(g);return z==="number"&&g!=g&&(z="NaN"),z!=="number"?[new Qt(l,g,`number expected, ${z} found`)]:"minimum"in T&&g<T.minimum?[new Qt(l,g,`${g} is less than the minimum value ${T.minimum}`)]:"maximum"in T&&g>T.maximum?[new Qt(l,g,`${g} is greater than the maximum value ${T.maximum}`)]:[]}function ud(f){const l=f.valueSpec,g=us(f.value.type);let T,z,F,O={};const H=g!=="categorical"&&f.value.property===void 0,W=!H,re=qa(f.value.stops)==="array"&&qa(f.value.stops[0])==="array"&&qa(f.value.stops[0][0])==="object",pe=pi({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Le){if(g==="identity")return[new Qt(Le.key,Le.value,'identity function may not have a "stops" property')];let qe=[];const Je=Le.value;return qe=qe.concat(Ph({key:Le.key,value:Je,valueSpec:Le.valueSpec,validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec,arrayElementValidator:ve})),qa(Je)==="array"&&Je.length===0&&qe.push(new Qt(Le.key,Je,"array must have at least one stop")),qe},default:function(Le){return Le.validateSpec({key:Le.key,value:Le.value,valueSpec:l,validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec})}}});return g==="identity"&&H&&pe.push(new Qt(f.key,f.value,'missing required property "property"')),g==="identity"||f.value.stops||pe.push(new Qt(f.key,f.value,'missing required property "stops"')),g==="exponential"&&f.valueSpec.expression&&!_s(f.valueSpec)&&pe.push(new Qt(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(W&&!Zo(f.valueSpec)?pe.push(new Qt(f.key,f.value,"property functions not supported")):H&&!If(f.valueSpec)&&pe.push(new Qt(f.key,f.value,"zoom functions not supported"))),g!=="categorical"&&!re||f.value.property!==void 0||pe.push(new Qt(f.key,f.value,'"property" property is required')),pe;function ve(Le){let qe=[];const Je=Le.value,xt=Le.key;if(qa(Je)!=="array")return[new Qt(xt,Je,`array expected, ${qa(Je)} found`)];if(Je.length!==2)return[new Qt(xt,Je,`array length 2 expected, length ${Je.length} found`)];if(re){if(qa(Je[0])!=="object")return[new Qt(xt,Je,`object expected, ${qa(Je[0])} found`)];if(Je[0].zoom===void 0)return[new Qt(xt,Je,"object stop key must have zoom")];if(Je[0].value===void 0)return[new Qt(xt,Je,"object stop key must have value")];if(F&&F>us(Je[0].zoom))return[new Qt(xt,Je[0].zoom,"stop zoom values must appear in ascending order")];us(Je[0].zoom)!==F&&(F=us(Je[0].zoom),z=void 0,O={}),qe=qe.concat(pi({key:`${xt}[0]`,value:Je[0],valueSpec:{zoom:{}},validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec,objectElementValidators:{zoom:_u,value:Me}}))}else qe=qe.concat(Me({key:`${xt}[0]`,value:Je[0],validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec},Je));return Pc(kl(Je[1]))?qe.concat([new Qt(`${xt}[1]`,Je[1],"expressions are not allowed in function stops.")]):qe.concat(Le.validateSpec({key:`${xt}[1]`,value:Je[1],valueSpec:l,validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec}))}function Me(Le,qe){const Je=qa(Le.value),xt=us(Le.value),zt=Le.value!==null?Le.value:qe;if(T){if(Je!==T)return[new Qt(Le.key,zt,`${Je} stop domain type must match previous stop domain type ${T}`)]}else T=Je;if(Je!=="number"&&Je!=="string"&&Je!=="boolean")return[new Qt(Le.key,zt,"stop domain value must be a number, string, or boolean")];if(Je!=="number"&&g!=="categorical"){let ai=`number expected, ${Je} found`;return Zo(l)&&g===void 0&&(ai+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Qt(Le.key,zt,ai)]}return g!=="categorical"||Je!=="number"||isFinite(xt)&&Math.floor(xt)===xt?g!=="categorical"&&Je==="number"&&z!==void 0&&xt<z?[new Qt(Le.key,zt,"stop domain values must appear in ascending order")]:(z=xt,g==="categorical"&&xt in O?[new Qt(Le.key,zt,"stop domain values must be unique")]:(O[xt]=!0,[])):[new Qt(Le.key,zt,`integer expected, found ${xt}`)]}}function Fu(f){const l=(f.expressionContext==="property"?Cf:Lc)(kl(f.value),f.valueSpec);if(l.result==="error")return l.value.map((T=>new Qt(`${f.key}${T.key}`,f.value,T.message)));const g=l.value.expression||l.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!g.outputDefined())return[new Qt(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!Vn(g))return[new Qt(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!Vn(g))return[new Qt(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!Dc(g,["zoom","feature-state"]))return[new Qt(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!Rh(g))return[new Qt(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gl(f){const l=f.key,g=f.value,T=f.valueSpec,z=[];return Array.isArray(T.values)?T.values.indexOf(us(g))===-1&&z.push(new Qt(l,g,`expected one of [${T.values.join(", ")}], ${JSON.stringify(g)} found`)):Object.keys(T.values).indexOf(us(g))===-1&&z.push(new Qt(l,g,`expected one of [${Object.keys(T.values).join(", ")}], ${JSON.stringify(g)} found`)),z}function gu(f){return Id(kl(f.value))?Fu(Gn({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):yl(f)}function yl(f){const l=f.value,g=f.key;if(qa(l)!=="array")return[new Qt(g,l,`array expected, ${qa(l)} found`)];const T=f.styleSpec;let z,F=[];if(l.length<1)return[new Qt(g,l,"filter array must have at least 1 element")];switch(F=F.concat(gl({key:`${g}[0]`,value:l[0],valueSpec:T.filter_operator,style:f.style,styleSpec:f.styleSpec})),us(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&us(l[1])==="$type"&&F.push(new Qt(g,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&F.push(new Qt(g,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(z=qa(l[1]),z!=="string"&&F.push(new Qt(`${g}[1]`,l[1],`string expected, ${z} found`)));for(let O=2;O<l.length;O++)z=qa(l[O]),us(l[1])==="$type"?F=F.concat(gl({key:`${g}[${O}]`,value:l[O],valueSpec:T.geometry_type,style:f.style,styleSpec:f.styleSpec})):z!=="string"&&z!=="number"&&z!=="boolean"&&F.push(new Qt(`${g}[${O}]`,l[O],`string, number, or boolean expected, ${z} found`));break;case"any":case"all":case"none":for(let O=1;O<l.length;O++)F=F.concat(yl({key:`${g}[${O}]`,value:l[O],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":z=qa(l[1]),l.length!==2?F.push(new Qt(g,l,`filter array for "${l[0]}" operator must have 2 elements`)):z!=="string"&&F.push(new Qt(`${g}[1]`,l[1],`string expected, ${z} found`))}return F}function Ou(f,l){const g=f.key,T=f.validateSpec,z=f.style,F=f.styleSpec,O=f.value,H=f.objectKey,W=F[`${l}_${f.layerType}`];if(!W)return[];const re=H.match(/^(.*)-transition$/);if(l==="paint"&&re&&W[re[1]]&&W[re[1]].transition)return T({key:g,value:O,valueSpec:F.transition,style:z,styleSpec:F});const pe=f.valueSpec||W[H];if(!pe)return[new Qt(g,O,`unknown property "${H}"`)];let ve;if(qa(O)==="string"&&Zo(pe)&&!pe.tokens&&(ve=/^{([^}]+)}$/.exec(O)))return[new Qt(g,O,`"${H}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ve[1])} }\`.`)];const Me=[];return f.layerType==="symbol"&&(H==="text-field"&&z&&!z.glyphs&&Me.push(new Qt(g,O,'use of "text-field" requires a style "glyphs" property')),H==="text-font"&&cc(kl(O))&&us(O.type)==="identity"&&Me.push(new Qt(g,O,'"text-font" does not support identity functions'))),Me.concat(T({key:f.key,value:O,valueSpec:pe,style:z,styleSpec:F,expressionContext:"property",propertyType:l,propertyKey:H}))}function vl(f){return Ou(f,"paint")}function Bu(f){return Ou(f,"layout")}function Lh(f){let l=[];const g=f.value,T=f.key,z=f.style,F=f.styleSpec;g.type||g.ref||l.push(new Qt(T,g,'either "type" or "ref" is required'));let O=us(g.type);const H=us(g.ref);if(g.id){const W=us(g.id);for(let re=0;re<f.arrayIndex;re++){const pe=z.layers[re];us(pe.id)===W&&l.push(new Qt(T,g.id,`duplicate layer id "${g.id}", previously used at line ${pe.id.__line__}`))}}if("ref"in g){let W;["type","source","source-layer","filter","layout"].forEach((re=>{re in g&&l.push(new Qt(T,g[re],`"${re}" is prohibited for ref layers`))})),z.layers.forEach((re=>{us(re.id)===H&&(W=re)})),W?W.ref?l.push(new Qt(T,g.ref,"ref cannot reference another ref layer")):O=us(W.type):l.push(new Qt(T,g.ref,`ref layer "${H}" not found`))}else if(O!=="background")if(g.source){const W=z.sources&&z.sources[g.source],re=W&&us(W.type);W?re==="vector"&&O==="raster"?l.push(new Qt(T,g.source,`layer "${g.id}" requires a raster source`)):re!=="raster-dem"&&O==="hillshade"?l.push(new Qt(T,g.source,`layer "${g.id}" requires a raster-dem source`)):re==="raster"&&O!=="raster"?l.push(new Qt(T,g.source,`layer "${g.id}" requires a vector source`)):re!=="vector"||g["source-layer"]?re==="raster-dem"&&O!=="hillshade"?l.push(new Qt(T,g.source,"raster-dem source can only be used with layer type 'hillshade'.")):O!=="line"||!g.paint||!g.paint["line-gradient"]||re==="geojson"&&W.lineMetrics||l.push(new Qt(T,g,`layer "${g.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new Qt(T,g,`layer "${g.id}" must specify a "source-layer"`)):l.push(new Qt(T,g.source,`source "${g.source}" not found`))}else l.push(new Qt(T,g,'missing required property "source"'));return l=l.concat(pi({key:T,value:g,valueSpec:F.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${T}.type`,value:g.type,valueSpec:F.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:g,objectKey:"type"}),filter:gu,layout:W=>pi({layer:g,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*":re=>Bu(Gn({layerType:O},re))}}),paint:W=>pi({layer:g,key:W.key,value:W.value,style:W.style,styleSpec:W.styleSpec,validateSpec:W.validateSpec,objectElementValidators:{"*":re=>vl(Gn({layerType:O},re))}})}})),l}function kc(f){const l=f.value,g=f.key,T=qa(l);return T!=="string"?[new Qt(g,l,`string expected, ${T} found`)]:[]}const kh={promoteId:function({key:f,value:l}){if(qa(l)==="string")return kc({key:f,value:l});{const g=[];for(const T in l)g.push(...kc({key:`${f}.${T}`,value:l[T]}));return g}}};function Wd(f){const l=f.value,g=f.key,T=f.styleSpec,z=f.style,F=f.validateSpec;if(!l.type)return[new Qt(g,l,'"type" is required')];const O=us(l.type);let H;switch(O){case"vector":case"raster":return H=pi({key:g,value:l,valueSpec:T[`source_${O.replace("-","_")}`],style:f.style,styleSpec:T,objectElementValidators:kh,validateSpec:F}),H;case"raster-dem":return H=(function(W){var re;const pe=(re=W.sourceName)!==null&&re!==void 0?re:"",ve=W.value,Me=W.styleSpec,Le=Me.source_raster_dem,qe=W.style;let Je=[];const xt=qa(ve);if(ve===void 0)return Je;if(xt!=="object")return Je.push(new Qt("source_raster_dem",ve,`object expected, ${xt} found`)),Je;const zt=us(ve.encoding)==="custom",ai=["redFactor","greenFactor","blueFactor","baseShift"],Vt=W.value.encoding?`"${W.value.encoding}"`:"Default";for(const ii in ve)!zt&&ai.includes(ii)?Je.push(new Qt(ii,ve[ii],`In "${pe}": "${ii}" is only valid when "encoding" is set to "custom". ${Vt} encoding found`)):Le[ii]?Je=Je.concat(W.validateSpec({key:ii,value:ve[ii],valueSpec:Le[ii],validateSpec:W.validateSpec,style:qe,styleSpec:Me})):Je.push(new Qt(ii,ve[ii],`unknown property "${ii}"`));return Je})({sourceName:g,value:l,style:f.style,styleSpec:T,validateSpec:F}),H;case"geojson":if(H=pi({key:g,value:l,valueSpec:T.source_geojson,style:z,styleSpec:T,validateSpec:F,objectElementValidators:kh}),l.cluster)for(const W in l.clusterProperties){const[re,pe]=l.clusterProperties[W],ve=typeof re=="string"?[re,["accumulated"],["get",W]]:re;H.push(...Fu({key:`${g}.${W}.map`,value:pe,expressionContext:"cluster-map"})),H.push(...Fu({key:`${g}.${W}.reduce`,value:ve,expressionContext:"cluster-reduce"}))}return H;case"video":return pi({key:g,value:l,valueSpec:T.source_video,style:z,validateSpec:F,styleSpec:T});case"image":return pi({key:g,value:l,valueSpec:T.source_image,style:z,validateSpec:F,styleSpec:T});case"canvas":return[new Qt(g,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gl({key:`${g}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Xd(f){const l=f.value,g=f.styleSpec,T=g.light,z=f.style;let F=[];const O=qa(l);if(l===void 0)return F;if(O!=="object")return F=F.concat([new Qt("light",l,`object expected, ${O} found`)]),F;for(const H in l){const W=H.match(/^(.*)-transition$/);F=F.concat(W&&T[W[1]]&&T[W[1]].transition?f.validateSpec({key:H,value:l[H],valueSpec:g.transition,validateSpec:f.validateSpec,style:z,styleSpec:g}):T[H]?f.validateSpec({key:H,value:l[H],valueSpec:T[H],validateSpec:f.validateSpec,style:z,styleSpec:g}):[new Qt(H,l[H],`unknown property "${H}"`)])}return F}function Yd(f){const l=f.value,g=f.styleSpec,T=g.sky,z=f.style,F=qa(l);if(l===void 0)return[];if(F!=="object")return[new Qt("sky",l,`object expected, ${F} found`)];let O=[];for(const H in l)O=O.concat(T[H]?f.validateSpec({key:H,value:l[H],valueSpec:T[H],style:z,styleSpec:g}):[new Qt(H,l[H],`unknown property "${H}"`)]);return O}function Wo(f){const l=f.value,g=f.styleSpec,T=g.terrain,z=f.style;let F=[];const O=qa(l);if(l===void 0)return F;if(O!=="object")return F=F.concat([new Qt("terrain",l,`object expected, ${O} found`)]),F;for(const H in l)F=F.concat(T[H]?f.validateSpec({key:H,value:l[H],valueSpec:T[H],validateSpec:f.validateSpec,style:z,styleSpec:g}):[new Qt(H,l[H],`unknown property "${H}"`)]);return F}function Nr(f){let l=[];const g=f.value,T=f.key;if(Array.isArray(g)){const z=[],F=[];for(const O in g)g[O].id&&z.includes(g[O].id)&&l.push(new Qt(T,g,`all the sprites' ids must be unique, but ${g[O].id} is duplicated`)),z.push(g[O].id),g[O].url&&F.includes(g[O].url)&&l.push(new Qt(T,g,`all the sprites' URLs must be unique, but ${g[O].url} is duplicated`)),F.push(g[O].url),l=l.concat(pi({key:`${T}[${O}]`,value:g[O],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return l}return kc({key:T,value:g})}const Fh={"*":()=>[],array:Ph,boolean:function(f){const l=f.value,g=f.key,T=qa(l);return T!=="boolean"?[new Qt(g,l,`boolean expected, ${T} found`)]:[]},number:_u,color:function(f){const l=f.key,g=f.value,T=qa(g);return T!=="string"?[new Qt(l,g,`color expected, ${T} found`)]:Qi.parse(String(g))?[]:[new Qt(l,g,`color expected, "${g}" found`)]},constants:sh,enum:gl,filter:gu,function:ud,layer:Lh,object:pi,source:Wd,light:Xd,sky:Yd,terrain:Wo,projection:function(f){const l=f.value,g=f.styleSpec,T=g.projection,z=f.style,F=qa(l);if(l===void 0)return[];if(F!=="object")return[new Qt("projection",l,`object expected, ${F} found`)];let O=[];for(const H in l)O=O.concat(T[H]?f.validateSpec({key:H,value:l[H],valueSpec:T[H],style:z,styleSpec:g}):[new Qt(H,l[H],`unknown property "${H}"`)]);return O},string:kc,formatted:function(f){return kc(f).length===0?[]:Fu(f)},resolvedImage:function(f){return kc(f).length===0?[]:Fu(f)},padding:function(f){const l=f.key,g=f.value;if(qa(g)==="array"){if(g.length<1||g.length>4)return[new Qt(l,g,`padding requires 1 to 4 values; ${g.length} values found`)];const T={type:"number"};let z=[];for(let F=0;F<g.length;F++)z=z.concat(f.validateSpec({key:`${l}[${F}]`,value:g[F],validateSpec:f.validateSpec,valueSpec:T}));return z}return _u({key:l,value:g,valueSpec:{}})},variableAnchorOffsetCollection:function(f){const l=f.key,g=f.value,T=qa(g),z=f.styleSpec;if(T!=="array"||g.length<1||g.length%2!=0)return[new Qt(l,g,"variableAnchorOffsetCollection requires a non-empty array of even length")];let F=[];for(let O=0;O<g.length;O+=2)F=F.concat(gl({key:`${l}[${O}]`,value:g[O],valueSpec:z.layout_symbol["text-anchor"]})),F=F.concat(Ph({key:`${l}[${O+1}]`,value:g[O+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:z}));return F},sprite:Nr};function hd(f){const l=f.value,g=f.valueSpec,T=f.styleSpec;return f.validateSpec=hd,g.expression&&cc(us(l))?ud(f):g.expression&&Pc(kl(l))?Fu(f):g.type&&Fh[g.type]?Fh[g.type](f):pi(Gn({},f,{valueSpec:g.type?T[g.type]:g}))}function Kd(f){const l=f.value,g=f.key,T=kc(f);return T.length||(l.indexOf("{fontstack}")===-1&&T.push(new Qt(g,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&T.push(new Qt(g,l,'"glyphs" url must include a "{range}" token'))),T}function Mo(f,l=$t){let g=[];return g=g.concat(hd({key:"",value:f,valueSpec:l.$root,styleSpec:l,style:f,validateSpec:hd,objectElementValidators:{glyphs:Kd,"*":()=>[]}})),f.constants&&(g=g.concat(sh({key:"constants",value:f.constants}))),ka(g)}function Xo(f){return function(l){return f({...l,validateSpec:hd})}}function ka(f){return[].concat(f).sort(((l,g)=>l.line-g.line))}function al(f){return function(...l){return ka(f.apply(this,l))}}Mo.source=al(Xo(Wd)),Mo.sprite=al(Xo(Nr)),Mo.glyphs=al(Xo(Kd)),Mo.light=al(Xo(Xd)),Mo.sky=al(Xo(Yd)),Mo.terrain=al(Xo(Wo)),Mo.layer=al(Xo(Lh)),Mo.filter=al(Xo(gu)),Mo.paintProperty=al(Xo(vl)),Mo.layoutProperty=al(Xo(Bu));const Fl=Mo,Nu=Fl.light,Df=Fl.sky,Jd=Fl.paintProperty,oh=Fl.layoutProperty;function Oh(f,l){let g=!1;if(l&&l.length)for(const T of l)f.fire(new oa(new Error(T.message))),g=!0;return g}class yo{constructor(l,g,T){const z=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const O=new Int32Array(this.arrayBuffer);l=O[0],this.d=(g=O[1])+2*(T=O[2]);for(let W=0;W<this.d*this.d;W++){const re=O[3+W],pe=O[3+W+1];z.push(re===pe?null:O.subarray(re,pe))}const H=O[3+z.length+1];this.keys=O.subarray(O[3+z.length],H),this.bboxes=O.subarray(H),this.insert=this._insertReadonly}else{this.d=g+2*T;for(let O=0;O<this.d*this.d;O++)z.push([]);this.keys=[],this.bboxes=[]}this.n=g,this.extent=l,this.padding=T,this.scale=g/l,this.uid=0;const F=T/g*l;this.min=-F,this.max=l+F}insert(l,g,T,z,F){this._forEachCell(g,T,z,F,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(g),this.bboxes.push(T),this.bboxes.push(z),this.bboxes.push(F)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,g,T,z,F,O){this.cells[F].push(O)}query(l,g,T,z,F){const O=this.min,H=this.max;if(l<=O&&g<=O&&H<=T&&H<=z&&!F)return Array.prototype.slice.call(this.keys);{const W=[];return this._forEachCell(l,g,T,z,this._queryCell,W,{},F),W}}_queryCell(l,g,T,z,F,O,H,W){const re=this.cells[F];if(re!==null){const pe=this.keys,ve=this.bboxes;for(let Me=0;Me<re.length;Me++){const Le=re[Me];if(H[Le]===void 0){const qe=4*Le;(W?W(ve[qe+0],ve[qe+1],ve[qe+2],ve[qe+3]):l<=ve[qe+2]&&g<=ve[qe+3]&&T>=ve[qe+0]&&z>=ve[qe+1])?(H[Le]=!0,O.push(pe[Le])):H[Le]=!1}}}}_forEachCell(l,g,T,z,F,O,H,W){const re=this._convertToCellCoord(l),pe=this._convertToCellCoord(g),ve=this._convertToCellCoord(T),Me=this._convertToCellCoord(z);for(let Le=re;Le<=ve;Le++)for(let qe=pe;qe<=Me;qe++){const Je=this.d*qe+Le;if((!W||W(this._convertFromCellCoord(Le),this._convertFromCellCoord(qe),this._convertFromCellCoord(Le+1),this._convertFromCellCoord(qe+1)))&&F.call(this,l,g,T,z,Je,O,H,W))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,g=3+this.cells.length+1+1;let T=0;for(let O=0;O<this.cells.length;O++)T+=this.cells[O].length;const z=new Int32Array(g+T+this.keys.length+this.bboxes.length);z[0]=this.extent,z[1]=this.n,z[2]=this.padding;let F=g;for(let O=0;O<l.length;O++){const H=l[O];z[3+O]=F,z.set(H,F),F+=H.length}return z[3+l.length]=F,z.set(this.keys,F),F+=this.keys.length,z[3+l.length+1]=F,z.set(this.bboxes,F),F+=this.bboxes.length,z.buffer}static serialize(l,g){const T=l.toArrayBuffer();return g&&g.push(T),{buffer:T}}static deserialize(l){return new yo(l.buffer)}}const $a={};function dn(f,l,g={}){if($a[f])throw new Error(`${f} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:f,writeable:!1}),$a[f]={klass:l,omit:g.omit||[],shallow:g.shallow||[]}}dn("Object",Object),dn("TransferableGridIndex",yo),dn("Color",Qi),dn("Error",Error),dn("AJAXError",Gr),dn("ResolvedImage",ts),dn("StylePropertyFunction",od),dn("StyleExpression",du,{omit:["_evaluator"]}),dn("ZoomDependentExpression",Zc),dn("ZoomConstantExpression",fu),dn("CompoundExpression",zo,{omit:["_evaluate"]});for(const f in Kl)Kl[f]._classRegistryKey||dn(`Expression_${f}`,Kl[f]);function Wc(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function dc(f){return f.$name||f.constructor._classRegistryKey}function Bh(f){return!(function(l){if(l===null||typeof l!="object")return!1;const g=dc(l);return!(!g||g==="Object")})(f)&&(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||Wc(f)||xi(f)||ArrayBuffer.isView(f)||f instanceof ImageData)}function Jl(f,l){if(Bh(f))return(Wc(f)||xi(f))&&l&&l.push(f),ArrayBuffer.isView(f)&&l&&l.push(f.buffer),f instanceof ImageData&&l&&l.push(f.data.buffer),f;if(Array.isArray(f)){const F=[];for(const O of f)F.push(Jl(O,l));return F}if(typeof f!="object")throw new Error("can't serialize object of type "+typeof f);const g=dc(f);if(!g)throw new Error(`can't serialize object of unregistered class ${f.constructor.name}`);if(!$a[g])throw new Error(`${g} is not registered.`);const{klass:T}=$a[g],z=T.serialize?T.serialize(f,l):{};if(T.serialize){if(l&&z===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const F in f){if(!f.hasOwnProperty(F)||$a[g].omit.indexOf(F)>=0)continue;const O=f[F];z[F]=$a[g].shallow.indexOf(F)>=0?O:Jl(O,l)}f instanceof Error&&(z.message=f.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return g!=="Object"&&(z.$name=g),z}function lh(f){if(Bh(f))return f;if(Array.isArray(f))return f.map(lh);if(typeof f!="object")throw new Error("can't deserialize object of type "+typeof f);const l=dc(f)||"Object";if(!$a[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:g}=$a[l];if(!g)throw new Error(`can't deserialize unregistered class ${l}`);if(g.deserialize)return g.deserialize(f);const T=Object.create(g.prototype);for(const z of Object.keys(f)){if(z==="$name")continue;const F=f[z];T[z]=$a[l].shallow.indexOf(z)>=0?F:lh(F)}return T}class Qd{constructor(){this.first=!0}update(l,g){const T=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=T,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=T,!0):(this.lastFloorZoom>T?(this.lastIntegerZoom=T+1,this.lastIntegerZoomTime=g):this.lastFloorZoom<T&&(this.lastIntegerZoom=T,this.lastIntegerZoomTime=g),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=T,!0))}}const Ra={"Latin-1 Supplement":f=>f>=128&&f<=255,"Hangul Jamo":f=>f>=4352&&f<=4607,Khmer:f=>f>=6016&&f<=6143,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Katakana:f=>f>=12448&&f<=12543,Kanbun:f=>f>=12688&&f<=12703,"CJK Strokes":f=>f>=12736&&f<=12783,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"Private Use Area":f=>f>=57344&&f<=63743,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function Xc(f){for(const l of f)if(ch(l.charCodeAt(0)))return!0;return!1}function ip(f){for(const l of f)if(!Ol(l.charCodeAt(0)))return!1;return!0}function dd(f){const l=f.map((g=>{try{return new RegExp(`\\p{sc=${g}}`,"u").source}catch{return null}})).filter((g=>g));return new RegExp(l.join("|"),"u")}const np=dd(["Arab","Dupl","Mong","Ougr","Syrc"]);function Ol(f){return!np.test(String.fromCodePoint(f))}const ju=dd(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ch(f){return!(f!==746&&f!==747&&(f<4352||!(Ra["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||Ra["CJK Compatibility"](f)||Ra["CJK Strokes"](f)||!(!Ra["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||Ra["Enclosed CJK Letters and Months"](f)||Ra["Ideographic Description Characters"](f)||Ra.Kanbun(f)||Ra.Katakana(f)&&f!==12540||!(!Ra["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!Ra["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||Ra["Vertical Forms"](f)||Ra["Yijing Hexagram Symbols"](f)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(f))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(f))||ju.test(String.fromCodePoint(f)))))}function uh(f){return!(ch(f)||(function(l){return!!(Ra["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Ra["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Ra["Letterlike Symbols"](l)||Ra["Number Forms"](l)||Ra["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Ra["Control Pictures"](l)&&l!==9251||Ra["Optical Character Recognition"](l)||Ra["Enclosed Alphanumerics"](l)||Ra["Geometric Shapes"](l)||Ra["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Ra["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Ra["CJK Symbols and Punctuation"](l)||Ra.Katakana(l)||Ra["Private Use Area"](l)||Ra["CJK Compatibility Forms"](l)||Ra["Small Form Variants"](l)||Ra["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)})(f))}const Rp=dd(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Cd(f){return Rp.test(String.fromCodePoint(f))}function fd(f,l){return!(!l&&Cd(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||Ra.Khmer(f))}function ef(f){for(const l of f)if(Cd(l.charCodeAt(0)))return!0;return!1}const Yo=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Ba{constructor(l,g){this.zoom=l,g?(this.now=g.now,this.fadeDuration=g.fadeDuration,this.zoomHistory=g.zoomHistory,this.transition=g.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Qd,this.transition={})}isSupportedScript(l){return(function(g,T){for(const z of g)if(!fd(z.charCodeAt(0),T))return!1;return!0})(l,Yo.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,g=l-Math.floor(l),T=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:g+(1-g)*T}:{fromScale:.5,toScale:1,t:1-(1-T)*g}}}class yu{constructor(l,g){this.property=l,this.value=g,this.expression=(function(T,z){if(cc(T))return new od(T,z);if(Pc(T)){const F=Cf(T,z);if(F.result==="error")throw new Error(F.value.map((O=>`${O.key}: ${O.message}`)).join(", "));return F.value}{let F=T;return z.type==="color"&&typeof T=="string"?F=Qi.parse(T):z.type!=="padding"||typeof T!="number"&&!Array.isArray(T)?z.type==="variableAnchorOffsetCollection"&&Array.isArray(T)&&(F=Oa.parse(T)):F=Nn.parse(T),{kind:"constant",evaluate:()=>F}}})(g===void 0?l.specification.default:g,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,g,T){return this.property.possiblyEvaluate(this,l,g,T)}}class pd{constructor(l){this.property=l,this.value=new yu(l,void 0)}transitioned(l,g){return new tf(this.property,this.value,g,mn({},l.transition,this.transition),l.now)}untransitioned(){return new tf(this.property,this.value,null,{},0)}}class Nh{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return tn(this._values[l].value.value)}setValue(l,g){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new pd(this._values[l].property)),this._values[l].value=new yu(this._values[l].property,g===null?void 0:tn(g))}getTransition(l){return tn(this._values[l].transition)}setTransition(l,g){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new pd(this._values[l].property)),this._values[l].transition=tn(g)||void 0}serialize(){const l={};for(const g of Object.keys(this._values)){const T=this.getValue(g);T!==void 0&&(l[g]=T);const z=this.getTransition(g);z!==void 0&&(l[`${g}-transition`]=z)}return l}transitioned(l,g){const T=new nf(this._properties);for(const z of Object.keys(this._values))T._values[z]=this._values[z].transitioned(l,g._values[z]);return T}untransitioned(){const l=new nf(this._properties);for(const g of Object.keys(this._values))l._values[g]=this._values[g].untransitioned();return l}}class tf{constructor(l,g,T,z,F){this.property=l,this.value=g,this.begin=F+z.delay||0,this.end=this.begin+z.duration||0,l.specification.transition&&(z.delay||z.duration)&&(this.prior=T)}possiblyEvaluate(l,g,T){const z=l.now||0,F=this.value.possiblyEvaluate(l,g,T),O=this.prior;if(O){if(z>this.end)return this.prior=null,F;if(this.value.isDataDriven())return this.prior=null,F;if(z<this.begin)return O.possiblyEvaluate(l,g,T);{const H=(z-this.begin)/(this.end-this.begin);return this.property.interpolate(O.possiblyEvaluate(l,g,T),F,(function(W){if(W<=0)return 0;if(W>=1)return 1;const re=W*W,pe=re*W;return 4*(W<.5?pe:3*(W-re)+pe-.75)})(H))}}return F}}class nf{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,g,T){const z=new Yc(this._properties);for(const F of Object.keys(this._values))z._values[F]=this._values[F].possiblyEvaluate(l,g,T);return z}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class hs{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return tn(this._values[l].value)}setValue(l,g){this._values[l]=new yu(this._values[l].property,g===null?void 0:tn(g))}serialize(){const l={};for(const g of Object.keys(this._values)){const T=this.getValue(g);T!==void 0&&(l[g]=T)}return l}possiblyEvaluate(l,g,T){const z=new Yc(this._properties);for(const F of Object.keys(this._values))z._values[F]=this._values[F].possiblyEvaluate(l,g,T);return z}}class fc{constructor(l,g,T){this.property=l,this.value=g,this.parameters=T}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,g,T,z){return this.property.evaluate(this.value,this.parameters,l,g,T,z)}}class Yc{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Wn{constructor(l){this.specification=l}possiblyEvaluate(l,g){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(g)}interpolate(l,g,T){const z=ko[this.specification.type];return z?z(l,g,T):l}}class Fr{constructor(l,g){this.specification=l,this.overrides=g}possiblyEvaluate(l,g,T,z){return new fc(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(g,null,{},T,z)}:l.expression,g)}interpolate(l,g,T){if(l.value.kind!=="constant"||g.value.kind!=="constant")return l;if(l.value.value===void 0||g.value.value===void 0)return new fc(this,{kind:"constant",value:void 0},l.parameters);const z=ko[this.specification.type];if(z){const F=z(l.value.value,g.value.value,T);return new fc(this,{kind:"constant",value:F},l.parameters)}return l}evaluate(l,g,T,z,F,O){return l.kind==="constant"?l.value:l.evaluate(g,T,z,F,O)}}class vu extends Fr{possiblyEvaluate(l,g,T,z){if(l.value===void 0)return new fc(this,{kind:"constant",value:void 0},g);if(l.expression.kind==="constant"){const F=l.expression.evaluate(g,null,{},T,z),O=l.property.specification.type==="resolvedImage"&&typeof F!="string"?F.name:F,H=this._calculate(O,O,O,g);return new fc(this,{kind:"constant",value:H},g)}if(l.expression.kind==="camera"){const F=this._calculate(l.expression.evaluate({zoom:g.zoom-1}),l.expression.evaluate({zoom:g.zoom}),l.expression.evaluate({zoom:g.zoom+1}),g);return new fc(this,{kind:"constant",value:F},g)}return new fc(this,l.expression,g)}evaluate(l,g,T,z,F,O){if(l.kind==="source"){const H=l.evaluate(g,T,z,F,O);return this._calculate(H,H,H,g)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(g.zoom)-1},T,z),l.evaluate({zoom:Math.floor(g.zoom)},T,z),l.evaluate({zoom:Math.floor(g.zoom)+1},T,z),g):l.value}_calculate(l,g,T,z){return z.zoom>z.zoomHistory.lastIntegerZoom?{from:l,to:g}:{from:T,to:g}}interpolate(l){return l}}class Vu{constructor(l){this.specification=l}possiblyEvaluate(l,g,T,z){if(l.value!==void 0){if(l.expression.kind==="constant"){const F=l.expression.evaluate(g,null,{},T,z);return this._calculate(F,F,F,g)}return this._calculate(l.expression.evaluate(new Ba(Math.floor(g.zoom-1),g)),l.expression.evaluate(new Ba(Math.floor(g.zoom),g)),l.expression.evaluate(new Ba(Math.floor(g.zoom+1),g)),g)}}_calculate(l,g,T,z){return z.zoom>z.zoomHistory.lastIntegerZoom?{from:l,to:g}:{from:T,to:g}}interpolate(l){return l}}class md{constructor(l){this.specification=l}possiblyEvaluate(l,g,T,z){return!!l.expression.evaluate(g,null,{},T,z)}interpolate(){return!1}}class L{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const g in l){const T=l[g];T.specification.overridable&&this.overridableProperties.push(g);const z=this.defaultPropertyValues[g]=new yu(T,void 0),F=this.defaultTransitionablePropertyValues[g]=new pd(T);this.defaultTransitioningPropertyValues[g]=F.untransitioned(),this.defaultPossiblyEvaluatedValues[g]=z.possiblyEvaluate({})}}}dn("DataDrivenProperty",Fr),dn("DataConstantProperty",Wn),dn("CrossFadedDataDrivenProperty",vu),dn("CrossFadedProperty",Vu),dn("ColorRampProperty",md);const o="-transition";class v extends Ma{constructor(l,g){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),g.layout&&(this._unevaluatedLayout=new hs(g.layout)),g.paint)){this._transitionablePaint=new Nh(g.paint);for(const T in l.paint)this.setPaintProperty(T,l.paint[T],{validate:!1});for(const T in l.layout)this.setLayoutProperty(T,l.layout[T],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yc(g.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,g,T={}){g!=null&&this._validate(oh,`layers.${this.id}.layout.${l}`,l,g,T)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,g):this.visibility=g)}getPaintProperty(l){return l.endsWith(o)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,g,T={}){if(g!=null&&this._validate(Jd,`layers.${this.id}.paint.${l}`,l,g,T))return!1;if(l.endsWith(o))return this._transitionablePaint.setTransition(l.slice(0,-11),g||void 0),!1;{const z=this._transitionablePaint._values[l],F=z.property.specification["property-type"]==="cross-faded-data-driven",O=z.value.isDataDriven(),H=z.value;this._transitionablePaint.setValue(l,g),this._handleSpecialPaintPropertyUpdate(l);const W=this._transitionablePaint._values[l].value;return W.isDataDriven()||O||F||this._handleOverridablePaintPropertyUpdate(l,H,W)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,g,T){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,g){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,g)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Ni(l,((g,T)=>!(g===void 0||T==="layout"&&!Object.keys(g).length||T==="paint"&&!Object.keys(g).length)))}_validate(l,g,T,z,F={}){return(!F||F.validate!==!1)&&Oh(this,l.call(Fl,{key:g,layerType:this.type,objectKey:T,value:z,styleSpec:$t,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const g=this.paint.get(l);if(g instanceof fc&&Zo(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1}}const A={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class M{constructor(l,g){this._structArray=l,this._pos1=g*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class P{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,g){return l._trim(),g&&(l.isTransferred=!0,g.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const g=Object.create(this.prototype);return g.arrayBuffer=l.arrayBuffer,g.length=l.length,g.capacity=l.arrayBuffer.byteLength/g.bytesPerElement,g._refreshViews(),g}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const g=this.uint8;this._refreshViews(),g&&this.uint8.set(g)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function q(f,l=1){let g=0,T=0;return{members:f.map((z=>{const F=A[z.type].BYTES_PER_ELEMENT,O=g=J(g,Math.max(l,F)),H=z.components||1;return T=Math.max(T,F),g+=F*H,{name:z.name,type:z.type,components:H,offset:O}})),size:J(g,Math.max(T,l)),alignment:l}}function J(f,l){return Math.ceil(f/l)*l}class ne extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g){const T=this.length;return this.resize(T+1),this.emplace(T,l,g)}emplace(l,g,T){const z=2*l;return this.int16[z+0]=g,this.int16[z+1]=T,l}}ne.prototype.bytesPerElement=4,dn("StructArrayLayout2i4",ne);class fe extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const F=3*l;return this.int16[F+0]=g,this.int16[F+1]=T,this.int16[F+2]=z,l}}fe.prototype.bytesPerElement=6,dn("StructArrayLayout3i6",fe);class we extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z){const F=this.length;return this.resize(F+1),this.emplace(F,l,g,T,z)}emplace(l,g,T,z,F){const O=4*l;return this.int16[O+0]=g,this.int16[O+1]=T,this.int16[O+2]=z,this.int16[O+3]=F,l}}we.prototype.bytesPerElement=8,dn("StructArrayLayout4i8",we);class Te extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O){const H=this.length;return this.resize(H+1),this.emplace(H,l,g,T,z,F,O)}emplace(l,g,T,z,F,O,H){const W=6*l;return this.int16[W+0]=g,this.int16[W+1]=T,this.int16[W+2]=z,this.int16[W+3]=F,this.int16[W+4]=O,this.int16[W+5]=H,l}}Te.prototype.bytesPerElement=12,dn("StructArrayLayout2i4i12",Te);class Be extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O){const H=this.length;return this.resize(H+1),this.emplace(H,l,g,T,z,F,O)}emplace(l,g,T,z,F,O,H){const W=4*l,re=8*l;return this.int16[W+0]=g,this.int16[W+1]=T,this.uint8[re+4]=z,this.uint8[re+5]=F,this.uint8[re+6]=O,this.uint8[re+7]=H,l}}Be.prototype.bytesPerElement=8,dn("StructArrayLayout2i4ub8",Be);class Ke extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g){const T=this.length;return this.resize(T+1),this.emplace(T,l,g)}emplace(l,g,T){const z=2*l;return this.float32[z+0]=g,this.float32[z+1]=T,l}}Ke.prototype.bytesPerElement=8,dn("StructArrayLayout2f8",Ke);class ot extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O,H,W,re,pe){const ve=this.length;return this.resize(ve+1),this.emplace(ve,l,g,T,z,F,O,H,W,re,pe)}emplace(l,g,T,z,F,O,H,W,re,pe,ve){const Me=10*l;return this.uint16[Me+0]=g,this.uint16[Me+1]=T,this.uint16[Me+2]=z,this.uint16[Me+3]=F,this.uint16[Me+4]=O,this.uint16[Me+5]=H,this.uint16[Me+6]=W,this.uint16[Me+7]=re,this.uint16[Me+8]=pe,this.uint16[Me+9]=ve,l}}ot.prototype.bytesPerElement=20,dn("StructArrayLayout10ui20",ot);class wt extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O,H,W,re,pe,ve,Me){const Le=this.length;return this.resize(Le+1),this.emplace(Le,l,g,T,z,F,O,H,W,re,pe,ve,Me)}emplace(l,g,T,z,F,O,H,W,re,pe,ve,Me,Le){const qe=12*l;return this.int16[qe+0]=g,this.int16[qe+1]=T,this.int16[qe+2]=z,this.int16[qe+3]=F,this.uint16[qe+4]=O,this.uint16[qe+5]=H,this.uint16[qe+6]=W,this.uint16[qe+7]=re,this.int16[qe+8]=pe,this.int16[qe+9]=ve,this.int16[qe+10]=Me,this.int16[qe+11]=Le,l}}wt.prototype.bytesPerElement=24,dn("StructArrayLayout4i4ui4i24",wt);class Mt extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const F=3*l;return this.float32[F+0]=g,this.float32[F+1]=T,this.float32[F+2]=z,l}}Mt.prototype.bytesPerElement=12,dn("StructArrayLayout3f12",Mt);class Rt extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const g=this.length;return this.resize(g+1),this.emplace(g,l)}emplace(l,g){return this.uint32[1*l+0]=g,l}}Rt.prototype.bytesPerElement=4,dn("StructArrayLayout1ul4",Rt);class Ft extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O,H,W,re){const pe=this.length;return this.resize(pe+1),this.emplace(pe,l,g,T,z,F,O,H,W,re)}emplace(l,g,T,z,F,O,H,W,re,pe){const ve=10*l,Me=5*l;return this.int16[ve+0]=g,this.int16[ve+1]=T,this.int16[ve+2]=z,this.int16[ve+3]=F,this.int16[ve+4]=O,this.int16[ve+5]=H,this.uint32[Me+3]=W,this.uint16[ve+8]=re,this.uint16[ve+9]=pe,l}}Ft.prototype.bytesPerElement=20,dn("StructArrayLayout6i1ul2ui20",Ft);class yt extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O){const H=this.length;return this.resize(H+1),this.emplace(H,l,g,T,z,F,O)}emplace(l,g,T,z,F,O,H){const W=6*l;return this.int16[W+0]=g,this.int16[W+1]=T,this.int16[W+2]=z,this.int16[W+3]=F,this.int16[W+4]=O,this.int16[W+5]=H,l}}yt.prototype.bytesPerElement=12,dn("StructArrayLayout2i2i2i12",yt);class Ht extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F){const O=this.length;return this.resize(O+1),this.emplace(O,l,g,T,z,F)}emplace(l,g,T,z,F,O){const H=4*l,W=8*l;return this.float32[H+0]=g,this.float32[H+1]=T,this.float32[H+2]=z,this.int16[W+6]=F,this.int16[W+7]=O,l}}Ht.prototype.bytesPerElement=16,dn("StructArrayLayout2f1f2i16",Ht);class Jt extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O){const H=this.length;return this.resize(H+1),this.emplace(H,l,g,T,z,F,O)}emplace(l,g,T,z,F,O,H){const W=16*l,re=4*l,pe=8*l;return this.uint8[W+0]=g,this.uint8[W+1]=T,this.float32[re+1]=z,this.float32[re+2]=F,this.int16[pe+6]=O,this.int16[pe+7]=H,l}}Jt.prototype.bytesPerElement=16,dn("StructArrayLayout2ub2f2i16",Jt);class oi extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const F=3*l;return this.uint16[F+0]=g,this.uint16[F+1]=T,this.uint16[F+2]=z,l}}oi.prototype.bytesPerElement=6,dn("StructArrayLayout3ui6",oi);class Xi extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O,H,W,re,pe,ve,Me,Le,qe,Je,xt,zt){const ai=this.length;return this.resize(ai+1),this.emplace(ai,l,g,T,z,F,O,H,W,re,pe,ve,Me,Le,qe,Je,xt,zt)}emplace(l,g,T,z,F,O,H,W,re,pe,ve,Me,Le,qe,Je,xt,zt,ai){const Vt=24*l,ii=12*l,Fi=48*l;return this.int16[Vt+0]=g,this.int16[Vt+1]=T,this.uint16[Vt+2]=z,this.uint16[Vt+3]=F,this.uint32[ii+2]=O,this.uint32[ii+3]=H,this.uint32[ii+4]=W,this.uint16[Vt+10]=re,this.uint16[Vt+11]=pe,this.uint16[Vt+12]=ve,this.float32[ii+7]=Me,this.float32[ii+8]=Le,this.uint8[Fi+36]=qe,this.uint8[Fi+37]=Je,this.uint8[Fi+38]=xt,this.uint32[ii+10]=zt,this.int16[Vt+22]=ai,l}}Xi.prototype.bytesPerElement=48,dn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xi);class An extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T,z,F,O,H,W,re,pe,ve,Me,Le,qe,Je,xt,zt,ai,Vt,ii,Fi,gn,Xn,Rr,Bn,Mn,wr,lr){const nr=this.length;return this.resize(nr+1),this.emplace(nr,l,g,T,z,F,O,H,W,re,pe,ve,Me,Le,qe,Je,xt,zt,ai,Vt,ii,Fi,gn,Xn,Rr,Bn,Mn,wr,lr)}emplace(l,g,T,z,F,O,H,W,re,pe,ve,Me,Le,qe,Je,xt,zt,ai,Vt,ii,Fi,gn,Xn,Rr,Bn,Mn,wr,lr,nr){const Zi=32*l,or=16*l;return this.int16[Zi+0]=g,this.int16[Zi+1]=T,this.int16[Zi+2]=z,this.int16[Zi+3]=F,this.int16[Zi+4]=O,this.int16[Zi+5]=H,this.int16[Zi+6]=W,this.int16[Zi+7]=re,this.uint16[Zi+8]=pe,this.uint16[Zi+9]=ve,this.uint16[Zi+10]=Me,this.uint16[Zi+11]=Le,this.uint16[Zi+12]=qe,this.uint16[Zi+13]=Je,this.uint16[Zi+14]=xt,this.uint16[Zi+15]=zt,this.uint16[Zi+16]=ai,this.uint16[Zi+17]=Vt,this.uint16[Zi+18]=ii,this.uint16[Zi+19]=Fi,this.uint16[Zi+20]=gn,this.uint16[Zi+21]=Xn,this.uint16[Zi+22]=Rr,this.uint32[or+12]=Bn,this.float32[or+13]=Mn,this.float32[or+14]=wr,this.uint16[Zi+30]=lr,this.uint16[Zi+31]=nr,l}}An.prototype.bytesPerElement=64,dn("StructArrayLayout8i15ui1ul2f2ui64",An);class Cn extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const g=this.length;return this.resize(g+1),this.emplace(g,l)}emplace(l,g){return this.float32[1*l+0]=g,l}}Cn.prototype.bytesPerElement=4,dn("StructArrayLayout1f4",Cn);class Zn extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const F=3*l;return this.uint16[6*l+0]=g,this.float32[F+1]=T,this.float32[F+2]=z,l}}Zn.prototype.bytesPerElement=12,dn("StructArrayLayout1ui2f12",Zn);class Ln extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const F=4*l;return this.uint32[2*l+0]=g,this.uint16[F+2]=T,this.uint16[F+3]=z,l}}Ln.prototype.bytesPerElement=8,dn("StructArrayLayout1ul2ui8",Ln);class Rn extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g){const T=this.length;return this.resize(T+1),this.emplace(T,l,g)}emplace(l,g,T){const z=2*l;return this.uint16[z+0]=g,this.uint16[z+1]=T,l}}Rn.prototype.bytesPerElement=4,dn("StructArrayLayout2ui4",Rn);class ir extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const g=this.length;return this.resize(g+1),this.emplace(g,l)}emplace(l,g){return this.uint16[1*l+0]=g,l}}ir.prototype.bytesPerElement=2,dn("StructArrayLayout1ui2",ir);class Xr extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T,z){const F=this.length;return this.resize(F+1),this.emplace(F,l,g,T,z)}emplace(l,g,T,z,F){const O=4*l;return this.float32[O+0]=g,this.float32[O+1]=T,this.float32[O+2]=z,this.float32[O+3]=F,l}}Xr.prototype.bytesPerElement=16,dn("StructArrayLayout4f16",Xr);class Fn extends M{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new it(this.anchorPointX,this.anchorPointY)}}Fn.prototype.size=20;class qn extends Ft{get(l){return new Fn(this,l)}}dn("CollisionBoxArray",qn);class ea extends M{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ea.prototype.size=48;class is extends Xi{get(l){return new ea(this,l)}}dn("PlacedSymbolArray",is);class Da extends M{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Da.prototype.size=64;class Ya extends An{get(l){return new Da(this,l)}}dn("SymbolInstanceArray",Ya);class Vs extends Cn{getoffsetX(l){return this.float32[1*l+0]}}dn("GlyphOffsetArray",Vs);class sl extends fe{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}dn("SymbolLineVertexArray",sl);class pc extends M{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}pc.prototype.size=12;class Us extends Zn{get(l){return new pc(this,l)}}dn("TextAnchorOffsetArray",Us);class Fo extends M{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Fo.prototype.size=8;class Gs extends Ln{get(l){return new Fo(this,l)}}dn("FeatureIndexArray",Gs);class ks extends ne{}class Ro extends ne{}class mc extends ne{}class Bl extends Te{}class Kc extends Be{}class ul extends Ke{}class Fs extends ot{}class xu extends wt{}class Nl extends Mt{}class hi extends Rt{}class Na extends yt{}class gs extends Jt{}class Ko extends oi{}class pn extends Rn{}const vo=q([{name:"a_pos",components:2,type:"Int16"}],4),{members:xl}=vo;class ja{constructor(l=[]){this.segments=l}prepareSegment(l,g,T,z){let F=this.segments[this.segments.length-1];return l>ja.MAX_VERTEX_ARRAY_LENGTH&&Wi(`Max vertices per segment is ${ja.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!F||F.vertexLength+l>ja.MAX_VERTEX_ARRAY_LENGTH||F.sortKey!==z)&&(F={vertexOffset:g.length,primitiveOffset:T.length,vertexLength:0,primitiveLength:0},z!==void 0&&(F.sortKey=z),this.segments.push(F)),F}get(){return this.segments}destroy(){for(const l of this.segments)for(const g in l.vaos)l.vaos[g].destroy()}static simpleSegment(l,g,T,z){return new ja([{vertexOffset:l,primitiveOffset:g,vertexLength:T,primitiveLength:z,vaos:{},sortKey:0}])}}function _c(f,l){return 256*(f=rr(Math.floor(f),0,255))+rr(Math.floor(l),0,255)}ja.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,dn("SegmentVector",ja);const jh=q([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ys={exports:{}},rf={exports:{}};rf.exports=function(f,l){var g,T,z,F,O,H,W,re;for(T=f.length-(g=3&f.length),z=l,O=3432918353,H=461845907,re=0;re<T;)W=255&f.charCodeAt(re)|(255&f.charCodeAt(++re))<<8|(255&f.charCodeAt(++re))<<16|(255&f.charCodeAt(++re))<<24,++re,z=27492+(65535&(F=5*(65535&(z=(z^=W=(65535&(W=(W=(65535&W)*O+(((W>>>16)*O&65535)<<16)&4294967295)<<15|W>>>17))*H+(((W>>>16)*H&65535)<<16)&4294967295)<<13|z>>>19))+((5*(z>>>16)&65535)<<16)&4294967295))+((58964+(F>>>16)&65535)<<16);switch(W=0,g){case 3:W^=(255&f.charCodeAt(re+2))<<16;case 2:W^=(255&f.charCodeAt(re+1))<<8;case 1:z^=W=(65535&(W=(W=(65535&(W^=255&f.charCodeAt(re)))*O+(((W>>>16)*O&65535)<<16)&4294967295)<<15|W>>>17))*H+(((W>>>16)*H&65535)<<16)&4294967295}return z^=f.length,z=2246822507*(65535&(z^=z>>>16))+((2246822507*(z>>>16)&65535)<<16)&4294967295,z=3266489909*(65535&(z^=z>>>13))+((3266489909*(z>>>16)&65535)<<16)&4294967295,(z^=z>>>16)>>>0};var Uu=rf.exports,Dp={exports:{}};Dp.exports=function(f,l){for(var g,T=f.length,z=l^T,F=0;T>=4;)g=1540483477*(65535&(g=255&f.charCodeAt(F)|(255&f.charCodeAt(++F))<<8|(255&f.charCodeAt(++F))<<16|(255&f.charCodeAt(++F))<<24))+((1540483477*(g>>>16)&65535)<<16),z=1540483477*(65535&z)+((1540483477*(z>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),T-=4,++F;switch(T){case 3:z^=(255&f.charCodeAt(F+2))<<16;case 2:z^=(255&f.charCodeAt(F+1))<<8;case 1:z=1540483477*(65535&(z^=255&f.charCodeAt(F)))+((1540483477*(z>>>16)&65535)<<16)}return z=1540483477*(65535&(z^=z>>>13))+((1540483477*(z>>>16)&65535)<<16),(z^=z>>>15)>>>0};var qo=Uu,rp=Dp.exports;Ys.exports=qo,Ys.exports.murmur3=qo,Ys.exports.murmur2=rp;var Jo=ke(Ys.exports);class gc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,g,T,z){this.ids.push(hh(l)),this.positions.push(g,T,z)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const g=hh(l);let T=0,z=this.ids.length-1;for(;T<z;){const O=T+z>>1;this.ids[O]>=g?z=O:T=O+1}const F=[];for(;this.ids[T]===g;)F.push({index:this.positions[3*T],start:this.positions[3*T+1],end:this.positions[3*T+2]}),T++;return F}static serialize(l,g){const T=new Float64Array(l.ids),z=new Uint32Array(l.positions);return Qo(T,z,0,T.length-1),g&&g.push(T.buffer,z.buffer),{ids:T,positions:z}}static deserialize(l){const g=new gc;return g.ids=l.ids,g.positions=l.positions,g.indexed=!0,g}}function hh(f){const l=+f;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:Jo(String(f))}function Qo(f,l,g,T){for(;g<T;){const z=f[g+T>>1];let F=g-1,O=T+1;for(;;){do F++;while(f[F]<z);do O--;while(f[O]>z);if(F>=O)break;no(f,F,O),no(l,3*F,3*O),no(l,3*F+1,3*O+1),no(l,3*F+2,3*O+2)}O-g<T-O?(Qo(f,l,g,O),g=O+1):(Qo(f,l,O+1,T),T=O)}}function no(f,l,g){const T=f[l];f[l]=f[g],f[g]=T}dn("FeaturePositionMap",gc);class bu{constructor(l,g){this.gl=l.gl,this.location=g}}class zd extends bu{constructor(l,g){super(l,g),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Gu extends bu{constructor(l,g){super(l,g),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class Ka extends bu{constructor(l,g){super(l,g),this.current=Qi.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const dh=new Float32Array(16);function af(f){return[_c(255*f.r,255*f.g),_c(255*f.b,255*f.a)]}class sf{constructor(l,g,T){this.value=l,this.uniformNames=g.map((z=>`u_${z}`)),this.type=T}setUniform(l,g,T){l.set(T.constantOr(this.value))}getBinding(l,g,T){return this.type==="color"?new Ka(l,g):new zd(l,g)}}class Rd{constructor(l,g){this.uniformNames=g.map((T=>`u_${T}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,g){this.pixelRatioFrom=g.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=g.tlbr,this.patternTo=l.tlbr}setUniform(l,g,T,z){const F=z==="u_pattern_to"?this.patternTo:z==="u_pattern_from"?this.patternFrom:z==="u_pixel_ratio_to"?this.pixelRatioTo:z==="u_pixel_ratio_from"?this.pixelRatioFrom:null;F&&l.set(F)}getBinding(l,g,T){return T.substr(0,9)==="u_pattern"?new Gu(l,g):new zd(l,g)}}class Vh{constructor(l,g,T,z){this.expression=l,this.type=T,this.maxValue=0,this.paintVertexAttributes=g.map((F=>({name:`a_${F}`,type:"Float32",components:T==="color"?2:1,offset:0}))),this.paintVertexArray=new z}populatePaintArray(l,g,T,z,F){const O=this.paintVertexArray.length,H=this.expression.evaluate(new Ba(0),g,{},z,[],F);this.paintVertexArray.resize(l),this._setPaintValue(O,l,H)}updatePaintArray(l,g,T,z){const F=this.expression.evaluate({zoom:0},T,z);this._setPaintValue(l,g,F)}_setPaintValue(l,g,T){if(this.type==="color"){const z=af(T);for(let F=l;F<g;F++)this.paintVertexArray.emplace(F,z[0],z[1])}else{for(let z=l;z<g;z++)this.paintVertexArray.emplace(z,T);this.maxValue=Math.max(this.maxValue,Math.abs(T))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hu{constructor(l,g,T,z,F,O){this.expression=l,this.uniformNames=g.map((H=>`u_${H}_t`)),this.type=T,this.useIntegerZoom=z,this.zoom=F,this.maxValue=0,this.paintVertexAttributes=g.map((H=>({name:`a_${H}`,type:"Float32",components:T==="color"?4:2,offset:0}))),this.paintVertexArray=new O}populatePaintArray(l,g,T,z,F){const O=this.expression.evaluate(new Ba(this.zoom),g,{},z,[],F),H=this.expression.evaluate(new Ba(this.zoom+1),g,{},z,[],F),W=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(W,l,O,H)}updatePaintArray(l,g,T,z){const F=this.expression.evaluate({zoom:this.zoom},T,z),O=this.expression.evaluate({zoom:this.zoom+1},T,z);this._setPaintValue(l,g,F,O)}_setPaintValue(l,g,T,z){if(this.type==="color"){const F=af(T),O=af(z);for(let H=l;H<g;H++)this.paintVertexArray.emplace(H,F[0],F[1],O[0],O[1])}else{for(let F=l;F<g;F++)this.paintVertexArray.emplace(F,T,z);this.maxValue=Math.max(this.maxValue,Math.abs(T),Math.abs(z))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,g){const T=this.useIntegerZoom?Math.floor(g.zoom):g.zoom,z=rr(this.expression.interpolationFactor(T,this.zoom,this.zoom+1),0,1);l.set(z)}getBinding(l,g,T){return new zd(l,g)}}class Jc{constructor(l,g,T,z,F,O){this.expression=l,this.type=g,this.useIntegerZoom=T,this.zoom=z,this.layerId=O,this.zoomInPaintVertexArray=new F,this.zoomOutPaintVertexArray=new F}populatePaintArray(l,g,T){const z=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(z,l,g.patterns&&g.patterns[this.layerId],T)}updatePaintArray(l,g,T,z,F){this._setPaintValues(l,g,T.patterns&&T.patterns[this.layerId],F)}_setPaintValues(l,g,T,z){if(!z||!T)return;const{min:F,mid:O,max:H}=T,W=z[F],re=z[O],pe=z[H];if(W&&re&&pe)for(let ve=l;ve<g;ve++)this.zoomInPaintVertexArray.emplace(ve,re.tl[0],re.tl[1],re.br[0],re.br[1],W.tl[0],W.tl[1],W.br[0],W.br[1],re.pixelRatio,W.pixelRatio),this.zoomOutPaintVertexArray.emplace(ve,re.tl[0],re.tl[1],re.br[0],re.br[1],pe.tl[0],pe.tl[1],pe.br[0],pe.br[1],re.pixelRatio,pe.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,jh.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,jh.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Dd{constructor(l,g,T){this.binders={},this._buffers=[];const z=[];for(const F in l.paint._values){if(!T(F))continue;const O=l.paint.get(F);if(!(O instanceof fc&&Zo(O.property.specification)))continue;const H=Gi(F,l.type),W=O.value,re=O.property.specification.type,pe=O.property.useIntegerZoom,ve=O.property.specification["property-type"],Me=ve==="cross-faded"||ve==="cross-faded-data-driven";if(W.kind==="constant")this.binders[F]=Me?new Rd(W.value,H):new sf(W.value,H,re),z.push(`/u_${F}`);else if(W.kind==="source"||Me){const Le=_d(F,re,"source");this.binders[F]=Me?new Jc(W,re,pe,g,Le,l.id):new Vh(W,H,re,Le),z.push(`/a_${F}`)}else{const Le=_d(F,re,"composite");this.binders[F]=new Hu(W,H,re,pe,g,Le),z.push(`/z_${F}`)}}this.cacheKey=z.sort().join("")}getMaxValue(l){const g=this.binders[l];return g instanceof Vh||g instanceof Hu?g.maxValue:0}populatePaintArrays(l,g,T,z,F){for(const O in this.binders){const H=this.binders[O];(H instanceof Vh||H instanceof Hu||H instanceof Jc)&&H.populatePaintArray(l,g,T,z,F)}}setConstantPatternPositions(l,g){for(const T in this.binders){const z=this.binders[T];z instanceof Rd&&z.setConstantPatternPositions(l,g)}}updatePaintArrays(l,g,T,z,F){let O=!1;for(const H in l){const W=g.getPositions(H);for(const re of W){const pe=T.feature(re.index);for(const ve in this.binders){const Me=this.binders[ve];if((Me instanceof Vh||Me instanceof Hu||Me instanceof Jc)&&Me.expression.isStateDependent===!0){const Le=z.paint.get(ve);Me.expression=Le.value,Me.updatePaintArray(re.start,re.end,pe,l[H],F),O=!0}}}}return O}defines(){const l=[];for(const g in this.binders){const T=this.binders[g];(T instanceof sf||T instanceof Rd)&&l.push(...T.uniformNames.map((z=>`#define HAS_UNIFORM_${z}`)))}return l}getBinderAttributes(){const l=[];for(const g in this.binders){const T=this.binders[g];if(T instanceof Vh||T instanceof Hu)for(let z=0;z<T.paintVertexAttributes.length;z++)l.push(T.paintVertexAttributes[z].name);else if(T instanceof Jc)for(let z=0;z<jh.members.length;z++)l.push(jh.members[z].name)}return l}getBinderUniforms(){const l=[];for(const g in this.binders){const T=this.binders[g];if(T instanceof sf||T instanceof Rd||T instanceof Hu)for(const z of T.uniformNames)l.push(z)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,g){const T=[];for(const z in this.binders){const F=this.binders[z];if(F instanceof sf||F instanceof Rd||F instanceof Hu){for(const O of F.uniformNames)if(g[O]){const H=F.getBinding(l,g[O],O);T.push({name:O,property:z,binding:H})}}}return T}setUniforms(l,g,T,z){for(const{name:F,property:O,binding:H}of g)this.binders[O].setUniform(H,z,T.get(O),F)}updatePaintBuffers(l){this._buffers=[];for(const g in this.binders){const T=this.binders[g];if(l&&T instanceof Jc){const z=l.fromScale===2?T.zoomInPaintVertexBuffer:T.zoomOutPaintVertexBuffer;z&&this._buffers.push(z)}else(T instanceof Vh||T instanceof Hu)&&T.paintVertexBuffer&&this._buffers.push(T.paintVertexBuffer)}}upload(l){for(const g in this.binders){const T=this.binders[g];(T instanceof Vh||T instanceof Hu||T instanceof Jc)&&T.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const g=this.binders[l];(g instanceof Vh||g instanceof Hu||g instanceof Jc)&&g.destroy()}}}class bi{constructor(l,g,T=(()=>!0)){this.programConfigurations={};for(const z of l)this.programConfigurations[z.id]=new Dd(z,g,T);this.needsUpload=!1,this._featureMap=new gc,this._bufferOffset=0}populatePaintArrays(l,g,T,z,F,O){for(const H in this.programConfigurations)this.programConfigurations[H].populatePaintArrays(l,g,z,F,O);g.id!==void 0&&this._featureMap.add(g.id,T,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,g,T,z){for(const F of T)this.needsUpload=this.programConfigurations[F.id].updatePaintArrays(l,this._featureMap,g,F,z)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const g in this.programConfigurations)this.programConfigurations[g].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function Gi(f,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${l}-`,"").replace(/-/g,"_")]}function _d(f,l,g){const T={color:{source:Ke,composite:Xr},number:{source:Cn,composite:Ke}},z=(function(F){return{"line-pattern":{source:Fs,composite:Fs},"fill-pattern":{source:Fs,composite:Fs},"fill-extrusion-pattern":{source:Fs,composite:Fs}}[F]})(f);return z&&z[g]||T[l][g]}dn("ConstantBinder",sf),dn("CrossFadedConstantBinder",Rd),dn("SourceExpressionBinder",Vh),dn("CrossFadedCompositeBinder",Jc),dn("CompositeExpressionBinder",Hu),dn("ProgramConfiguration",Dd,{omit:["_buffers"]}),dn("ProgramConfigurationSet",bi);const da=8192,bt=Math.pow(2,14)-1,dm=-bt-1;function Uh(f){const l=da/f.extent,g=f.loadGeometry();for(let T=0;T<g.length;T++){const z=g[T];for(let F=0;F<z.length;F++){const O=z[F],H=Math.round(O.x*l),W=Math.round(O.y*l);O.x=rr(H,dm,bt),O.y=rr(W,dm,bt),(H<O.x||H>O.x+1||W<O.y||W>O.y+1)&&Wi("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return g}function yc(f,l){return{type:f.type,id:f.id,properties:f.properties,geometry:l?Uh(f):[]}}function Pd(f,l,g,T,z){f.emplaceBack(2*l+(T+1)/2,2*g+(z+1)/2)}class gd{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Ro,this.indexArray=new Ko,this.segments=new ja,this.programConfigurations=new bi(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(l,g,T){const z=this.layers[0],F=[];let O=null,H=!1;z.type==="circle"&&(O=z.layout.get("circle-sort-key"),H=!O.isConstant());for(const{feature:W,id:re,index:pe,sourceLayerIndex:ve}of l){const Me=this.layers[0]._featureFilter.needGeometry,Le=yc(W,Me);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom),Le,T))continue;const qe=H?O.evaluate(Le,{},T):void 0,Je={id:re,properties:W.properties,type:W.type,sourceLayerIndex:ve,index:pe,geometry:Me?Le.geometry:Uh(W),patterns:{},sortKey:qe};F.push(Je)}H&&F.sort(((W,re)=>W.sortKey-re.sortKey));for(const W of F){const{geometry:re,index:pe,sourceLayerIndex:ve}=W,Me=l[pe].feature;this.addFeature(W,re,pe,T),g.featureIndex.insert(Me,re,pe,ve,this.index)}}update(l,g,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,g,this.stateDependentLayers,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,xl),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,g,T,z){for(const F of g)for(const O of F){const H=O.x,W=O.y;if(H<0||H>=da||W<0||W>=da)continue;const re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),pe=re.vertexLength;Pd(this.layoutVertexArray,H,W,-1,-1),Pd(this.layoutVertexArray,H,W,1,-1),Pd(this.layoutVertexArray,H,W,1,1),Pd(this.layoutVertexArray,H,W,-1,1),this.indexArray.emplaceBack(pe,pe+1,pe+2),this.indexArray.emplaceBack(pe,pe+3,pe+2),re.vertexLength+=4,re.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,{},z)}}function fm(f,l){for(let g=0;g<f.length;g++)if(qu(l,f[g]))return!0;for(let g=0;g<l.length;g++)if(qu(f,l[g]))return!0;return!!pm(f,l)}function Pf(f,l,g){return!!qu(f,l)||!!Gh(l,f,g)}function Om(f,l){if(f.length===1)return of(l,f[0]);for(let g=0;g<l.length;g++){const T=l[g];for(let z=0;z<T.length;z++)if(qu(f,T[z]))return!0}for(let g=0;g<f.length;g++)if(of(l,f[g]))return!0;for(let g=0;g<l.length;g++)if(pm(f,l[g]))return!0;return!1}function u_(f,l,g){if(f.length>1){if(pm(f,l))return!0;for(let T=0;T<l.length;T++)if(Gh(l[T],f,g))return!0}for(let T=0;T<f.length;T++)if(Gh(f[T],l,g))return!0;return!1}function pm(f,l){if(f.length===0||l.length===0)return!1;for(let g=0;g<f.length-1;g++){const T=f[g],z=f[g+1];for(let F=0;F<l.length-1;F++)if(Pp(T,z,l[F],l[F+1]))return!0}return!1}function Pp(f,l,g,T){return cr(f,g,T)!==cr(l,g,T)&&cr(f,l,g)!==cr(f,l,T)}function Gh(f,l,g){const T=g*g;if(l.length===1)return f.distSqr(l[0])<T;for(let z=1;z<l.length;z++)if(ap(f,l[z-1],l[z])<T)return!0;return!1}function ap(f,l,g){const T=l.distSqr(g);if(T===0)return f.distSqr(l);const z=((f.x-l.x)*(g.x-l.x)+(f.y-l.y)*(g.y-l.y))/T;return f.distSqr(z<0?l:z>1?g:g.sub(l)._mult(z)._add(l))}function of(f,l){let g,T,z,F=!1;for(let O=0;O<f.length;O++){g=f[O];for(let H=0,W=g.length-1;H<g.length;W=H++)T=g[H],z=g[W],T.y>l.y!=z.y>l.y&&l.x<(z.x-T.x)*(l.y-T.y)/(z.y-T.y)+T.x&&(F=!F)}return F}function qu(f,l){let g=!1;for(let T=0,z=f.length-1;T<f.length;z=T++){const F=f[T],O=f[z];F.y>l.y!=O.y>l.y&&l.x<(O.x-F.x)*(l.y-F.y)/(O.y-F.y)+F.x&&(g=!g)}return g}function lf(f,l,g){const T=g[0],z=g[2];if(f.x<T.x&&l.x<T.x||f.x>z.x&&l.x>z.x||f.y<T.y&&l.y<T.y||f.y>z.y&&l.y>z.y)return!1;const F=cr(f,l,g[0]);return F!==cr(f,l,g[1])||F!==cr(f,l,g[2])||F!==cr(f,l,g[3])}function vc(f,l,g){const T=l.paint.get(f).value;return T.kind==="constant"?T.value:g.programConfigurations.get(l.id).getMaxValue(f)}function Lp(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function sp(f,l,g,T,z){if(!l[0]&&!l[1])return f;const F=it.convert(l)._mult(z);g==="viewport"&&F._rotate(-T);const O=[];for(let H=0;H<f.length;H++)O.push(f[H].sub(F));return O}let mm,_m;dn("CircleBucket",gd,{omit:["layers"]});var Hh={get paint(){return _m=_m||new L({"circle-radius":new Fr($t.paint_circle["circle-radius"]),"circle-color":new Fr($t.paint_circle["circle-color"]),"circle-blur":new Fr($t.paint_circle["circle-blur"]),"circle-opacity":new Fr($t.paint_circle["circle-opacity"]),"circle-translate":new Wn($t.paint_circle["circle-translate"]),"circle-translate-anchor":new Wn($t.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Wn($t.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Wn($t.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fr($t.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fr($t.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fr($t.paint_circle["circle-stroke-opacity"])})},get layout(){return mm=mm||new L({"circle-sort-key":new Fr($t.layout_circle["circle-sort-key"])})}},Ks=1e-6,Ld=typeof Float32Array<"u"?Float32Array:Array;function cf(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Bm(f,l,g){var T=l[0],z=l[1],F=l[2],O=l[3],H=l[4],W=l[5],re=l[6],pe=l[7],ve=l[8],Me=l[9],Le=l[10],qe=l[11],Je=l[12],xt=l[13],zt=l[14],ai=l[15],Vt=g[0],ii=g[1],Fi=g[2],gn=g[3];return f[0]=Vt*T+ii*H+Fi*ve+gn*Je,f[1]=Vt*z+ii*W+Fi*Me+gn*xt,f[2]=Vt*F+ii*re+Fi*Le+gn*zt,f[3]=Vt*O+ii*pe+Fi*qe+gn*ai,f[4]=(Vt=g[4])*T+(ii=g[5])*H+(Fi=g[6])*ve+(gn=g[7])*Je,f[5]=Vt*z+ii*W+Fi*Me+gn*xt,f[6]=Vt*F+ii*re+Fi*Le+gn*zt,f[7]=Vt*O+ii*pe+Fi*qe+gn*ai,f[8]=(Vt=g[8])*T+(ii=g[9])*H+(Fi=g[10])*ve+(gn=g[11])*Je,f[9]=Vt*z+ii*W+Fi*Me+gn*xt,f[10]=Vt*F+ii*re+Fi*Le+gn*zt,f[11]=Vt*O+ii*pe+Fi*qe+gn*ai,f[12]=(Vt=g[12])*T+(ii=g[13])*H+(Fi=g[14])*ve+(gn=g[15])*Je,f[13]=Vt*z+ii*W+Fi*Me+gn*xt,f[14]=Vt*F+ii*re+Fi*Le+gn*zt,f[15]=Vt*O+ii*pe+Fi*qe+gn*ai,f}Math.hypot||(Math.hypot=function(){for(var f=0,l=arguments.length;l--;)f+=arguments[l]*arguments[l];return Math.sqrt(f)});var Ja,Yr=Bm;function op(f,l,g){var T=l[0],z=l[1],F=l[2],O=l[3];return f[0]=g[0]*T+g[4]*z+g[8]*F+g[12]*O,f[1]=g[1]*T+g[5]*z+g[9]*F+g[13]*O,f[2]=g[2]*T+g[6]*z+g[10]*F+g[14]*O,f[3]=g[3]*T+g[7]*z+g[11]*F+g[15]*O,f}Ja=new Ld(4),Ld!=Float32Array&&(Ja[0]=0,Ja[1]=0,Ja[2]=0,Ja[3]=0);class uf extends v{constructor(l){super(l,Hh)}createBucket(l){return new gd(l)}queryRadius(l){const g=l;return vc("circle-radius",this,g)+vc("circle-stroke-width",this,g)+Lp(this.paint.get("circle-translate"))}queryIntersectsFeature(l,g,T,z,F,O,H,W){const re=sp(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),O.angle,H),pe=this.paint.get("circle-radius").evaluate(g,T)+this.paint.get("circle-stroke-width").evaluate(g,T),ve=this.paint.get("circle-pitch-alignment")==="map",Me=ve?re:(function(qe,Je){return qe.map((xt=>kd(xt,Je)))})(re,W),Le=ve?pe*H:pe;for(const qe of z)for(const Je of qe){const xt=ve?Je:kd(Je,W);let zt=Le;const ai=op([],[Je.x,Je.y,0,1],W);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?zt*=ai[3]/O.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(zt*=O.cameraToCenterDistance/ai[3]),Pf(Me,xt,zt))return!0}return!1}}function kd(f,l){const g=op([],[f.x,f.y,0,1],l);return new it(g[0]/g[3],g[1]/g[3])}class hf extends gd{}let qh;dn("HeatmapBucket",hf,{omit:["layers"]});var kp={get paint(){return qh=qh||new L({"heatmap-radius":new Fr($t.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fr($t.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Wn($t.paint_heatmap["heatmap-intensity"]),"heatmap-color":new md($t.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Wn($t.paint_heatmap["heatmap-opacity"])})}};function lp(f,{width:l,height:g},T,z){if(z){if(z instanceof Uint8ClampedArray)z=new Uint8Array(z.buffer);else if(z.length!==l*g*T)throw new RangeError(`mismatched image size. expected: ${z.length} but got: ${l*g*T}`)}else z=new Uint8Array(l*g*T);return f.width=l,f.height=g,f.data=z,f}function Fp(f,{width:l,height:g},T){if(l===f.width&&g===f.height)return;const z=lp({},{width:l,height:g},T);cp(f,z,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,l),height:Math.min(f.height,g)},T),f.width=l,f.height=g,f.data=z.data}function cp(f,l,g,T,z,F){if(z.width===0||z.height===0)return l;if(z.width>f.width||z.height>f.height||g.x>f.width-z.width||g.y>f.height-z.height)throw new RangeError("out of range source coordinates for image copy");if(z.width>l.width||z.height>l.height||T.x>l.width-z.width||T.y>l.height-z.height)throw new RangeError("out of range destination coordinates for image copy");const O=f.data,H=l.data;if(O===H)throw new Error("srcData equals dstData, so image is already copied");for(let W=0;W<z.height;W++){const re=((g.y+W)*f.width+g.x)*F,pe=((T.y+W)*l.width+T.x)*F;for(let ve=0;ve<z.width*F;ve++)H[pe+ve]=O[re+ve]}return l}class xc{constructor(l,g){lp(this,l,1,g)}resize(l){Fp(this,l,1)}clone(){return new xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,g,T,z,F){cp(l,g,T,z,F,1)}}class xo{constructor(l,g){lp(this,l,4,g)}resize(l){Fp(this,l,4)}replace(l,g){g?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,g,T,z,F){cp(l,g,T,z,F,4)}}function fh(f){const l={},g=f.resolution||256,T=f.clips?f.clips.length:1,z=f.image||new xo({width:g,height:T});if(Math.log(g)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${g}`);const F=(O,H,W)=>{l[f.evaluationKey]=W;const re=f.expression.evaluate(l);z.data[O+H+0]=Math.floor(255*re.r/re.a),z.data[O+H+1]=Math.floor(255*re.g/re.a),z.data[O+H+2]=Math.floor(255*re.b/re.a),z.data[O+H+3]=Math.floor(255*re.a)};if(f.clips)for(let O=0,H=0;O<T;++O,H+=4*g)for(let W=0,re=0;W<g;W++,re+=4){const pe=W/(g-1),{start:ve,end:Me}=f.clips[O];F(H,re,ve*(1-pe)+Me*pe)}else for(let O=0,H=0;O<g;O++,H+=4)F(0,H,O/(g-1));return z}dn("AlphaImage",xc),dn("RGBAImage",xo);const df="big-fb";class up extends v{createBucket(l){return new hf(l)}constructor(l){super(l,kp),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=fh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(df)&&this.heatmapFbos.delete(df)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Op;var Fd={get paint(){return Op=Op||new L({"hillshade-illumination-direction":new Wn($t.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Wn($t.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Wn($t.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Wn($t.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Wn($t.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Wn($t.paint_hillshade["hillshade-accent-color"])})}};class ff extends v{constructor(l){super(l,Fd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const wu=q([{name:"a_pos",components:2,type:"Int16"}],4),{members:hp}=wu;function dp(f,l,g=2){const T=l&&l.length,z=T?l[0]*g:f.length;let F=Lf(f,0,z,g,!0);const O=[];if(!F||F.next===F.prev)return O;let H,W,re;if(T&&(F=(function(pe,ve,Me,Le){const qe=[];for(let Je=0,xt=ve.length;Je<xt;Je++){const zt=Lf(pe,ve[Je]*Le,Je<xt-1?ve[Je+1]*Le:pe.length,Le,!1);zt===zt.next&&(zt.steiner=!0),qe.push(Fc(zt))}qe.sort(ym);for(let Je=0;Je<qe.length;Je++)Me=fp(qe[Je],Me);return Me})(f,l,F,g)),f.length>80*g){H=1/0,W=1/0;let pe=-1/0,ve=-1/0;for(let Me=g;Me<z;Me+=g){const Le=f[Me],qe=f[Me+1];Le<H&&(H=Le),qe<W&&(W=qe),Le>pe&&(pe=Le),qe>ve&&(ve=qe)}re=Math.max(pe-H,ve-W),re=re!==0?32767/re:0}return co(F,O,g,H,W,re,0),O}function Lf(f,l,g,T,z){let F;if(z===(function(O,H,W,re){let pe=0;for(let ve=H,Me=W-re;ve<W;ve+=re)pe+=(O[Me]-O[ve])*(O[ve+1]+O[Me+1]),Me=ve;return pe})(f,l,g,T)>0)for(let O=l;O<g;O+=T)F=Of(O/T|0,f[O],f[O+1],F);else for(let O=g-T;O>=l;O-=T)F=Of(O/T|0,f[O],f[O+1],F);return F&&Oo(F,F.next)&&(_f(F),F=F.next),F}function $h(f,l){if(!f)return f;l||(l=f);let g,T=f;do if(g=!1,T.steiner||!Oo(T,T.next)&&bo(T.prev,T,T.next)!==0)T=T.next;else{if(_f(T),T=l=T.prev,T===T.next)break;g=!0}while(g||T!==l);return l}function co(f,l,g,T,z,F,O){if(!f)return;!O&&F&&(function(W,re,pe,ve){let Me=W;do Me.z===0&&(Me.z=Tu(Me.x,Me.y,re,pe,ve)),Me.prevZ=Me.prev,Me.nextZ=Me.next,Me=Me.next;while(Me!==W);Me.prevZ.nextZ=null,Me.prevZ=null,(function(Le){let qe,Je=1;do{let xt,zt=Le;Le=null;let ai=null;for(qe=0;zt;){qe++;let Vt=zt,ii=0;for(let gn=0;gn<Je&&(ii++,Vt=Vt.nextZ,Vt);gn++);let Fi=Je;for(;ii>0||Fi>0&&Vt;)ii!==0&&(Fi===0||!Vt||zt.z<=Vt.z)?(xt=zt,zt=zt.nextZ,ii--):(xt=Vt,Vt=Vt.nextZ,Fi--),ai?ai.nextZ=xt:Le=xt,xt.prevZ=ai,ai=xt;zt=Vt}ai.nextZ=null,Je*=2}while(qe>1)})(Me)})(f,T,z,F);let H=f;for(;f.prev!==f.next;){const W=f.prev,re=f.next;if(F?Od(f,T,z,F):kf(f))l.push(W.i,f.i,re.i),_f(f),f=re.next,H=re.next;else if((f=re)===H){O?O===1?co(f=gm($h(f),l),l,g,T,z,F,2):O===2&&pf(f,l,g,T,z,F):co($h(f),l,g,T,z,F,1);break}}}function kf(f){const l=f.prev,g=f,T=f.next;if(bo(l,g,T)>=0)return!1;const z=l.x,F=g.x,O=T.x,H=l.y,W=g.y,re=T.y,pe=z<F?z<O?z:O:F<O?F:O,ve=H<W?H<re?H:re:W<re?W:re,Me=z>F?z>O?z:O:F>O?F:O,Le=H>W?H>re?H:re:W>re?W:re;let qe=T.next;for(;qe!==l;){if(qe.x>=pe&&qe.x<=Me&&qe.y>=ve&&qe.y<=Le&&Su(z,H,F,W,O,re,qe.x,qe.y)&&bo(qe.prev,qe,qe.next)>=0)return!1;qe=qe.next}return!0}function Od(f,l,g,T){const z=f.prev,F=f,O=f.next;if(bo(z,F,O)>=0)return!1;const H=z.x,W=F.x,re=O.x,pe=z.y,ve=F.y,Me=O.y,Le=H<W?H<re?H:re:W<re?W:re,qe=pe<ve?pe<Me?pe:Me:ve<Me?ve:Me,Je=H>W?H>re?H:re:W>re?W:re,xt=pe>ve?pe>Me?pe:Me:ve>Me?ve:Me,zt=Tu(Le,qe,l,g,T),ai=Tu(Je,xt,l,g,T);let Vt=f.prevZ,ii=f.nextZ;for(;Vt&&Vt.z>=zt&&ii&&ii.z<=ai;){if(Vt.x>=Le&&Vt.x<=Je&&Vt.y>=qe&&Vt.y<=xt&&Vt!==z&&Vt!==O&&Su(H,pe,W,ve,re,Me,Vt.x,Vt.y)&&bo(Vt.prev,Vt,Vt.next)>=0||(Vt=Vt.prevZ,ii.x>=Le&&ii.x<=Je&&ii.y>=qe&&ii.y<=xt&&ii!==z&&ii!==O&&Su(H,pe,W,ve,re,Me,ii.x,ii.y)&&bo(ii.prev,ii,ii.next)>=0))return!1;ii=ii.nextZ}for(;Vt&&Vt.z>=zt;){if(Vt.x>=Le&&Vt.x<=Je&&Vt.y>=qe&&Vt.y<=xt&&Vt!==z&&Vt!==O&&Su(H,pe,W,ve,re,Me,Vt.x,Vt.y)&&bo(Vt.prev,Vt,Vt.next)>=0)return!1;Vt=Vt.prevZ}for(;ii&&ii.z<=ai;){if(ii.x>=Le&&ii.x<=Je&&ii.y>=qe&&ii.y<=xt&&ii!==z&&ii!==O&&Su(H,pe,W,ve,re,Me,ii.x,ii.y)&&bo(ii.prev,ii,ii.next)>=0)return!1;ii=ii.nextZ}return!0}function gm(f,l){let g=f;do{const T=g.prev,z=g.next.next;!Oo(T,z)&&hl(T,g,g.next,z)&&Bd(T,z)&&Bd(z,T)&&(l.push(T.i,g.i,z.i),_f(g),_f(g.next),g=f=z),g=g.next}while(g!==f);return $h(g)}function pf(f,l,g,T,z,F){let O=f;do{let H=O.next.next;for(;H!==O.prev;){if(O.i!==H.i&&Nm(O,H)){let W=vm(O,H);return O=$h(O,O.next),W=$h(W,W.next),co(O,l,g,T,z,F,0),void co(W,l,g,T,z,F,0)}H=H.next}O=O.next}while(O!==f)}function ym(f,l){return f.x-l.x}function fp(f,l){const g=(function(z,F){let O=F;const H=z.x,W=z.y;let re,pe=-1/0;do{if(W<=O.y&&W>=O.next.y&&O.next.y!==O.y){const Je=O.x+(W-O.y)*(O.next.x-O.x)/(O.next.y-O.y);if(Je<=H&&Je>pe&&(pe=Je,re=O.x<O.next.x?O:O.next,Je===H))return re}O=O.next}while(O!==F);if(!re)return null;const ve=re,Me=re.x,Le=re.y;let qe=1/0;O=re;do{if(H>=O.x&&O.x>=Me&&H!==O.x&&Su(W<Le?H:pe,W,Me,Le,W<Le?pe:H,W,O.x,O.y)){const Je=Math.abs(W-O.y)/(H-O.x);Bd(O,z)&&(Je<qe||Je===qe&&(O.x>re.x||O.x===re.x&&Ff(re,O)))&&(re=O,qe=Je)}O=O.next}while(O!==ve);return re})(f,l);if(!g)return l;const T=vm(g,f);return $h(T,T.next),$h(g,g.next)}function Ff(f,l){return bo(f.prev,f,l.prev)<0&&bo(l.next,f,f.next)<0}function Tu(f,l,g,T,z){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-g)*z|0)|f<<8))|f<<4))|f<<2))|f<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-T)*z|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function Fc(f){let l=f,g=f;do(l.x<g.x||l.x===g.x&&l.y<g.y)&&(g=l),l=l.next;while(l!==f);return g}function Su(f,l,g,T,z,F,O,H){return(z-O)*(l-H)>=(f-O)*(F-H)&&(f-O)*(T-H)>=(g-O)*(l-H)&&(g-O)*(F-H)>=(z-O)*(T-H)}function Nm(f,l){return f.next.i!==l.i&&f.prev.i!==l.i&&!(function(g,T){let z=g;do{if(z.i!==g.i&&z.next.i!==g.i&&z.i!==T.i&&z.next.i!==T.i&&hl(z,z.next,g,T))return!0;z=z.next}while(z!==g);return!1})(f,l)&&(Bd(f,l)&&Bd(l,f)&&(function(g,T){let z=g,F=!1;const O=(g.x+T.x)/2,H=(g.y+T.y)/2;do z.y>H!=z.next.y>H&&z.next.y!==z.y&&O<(z.next.x-z.x)*(H-z.y)/(z.next.y-z.y)+z.x&&(F=!F),z=z.next;while(z!==g);return F})(f,l)&&(bo(f.prev,f,l.prev)||bo(f,l.prev,l))||Oo(f,l)&&bo(f.prev,f,f.next)>0&&bo(l.prev,l,l.next)>0)}function bo(f,l,g){return(l.y-f.y)*(g.x-l.x)-(l.x-f.x)*(g.y-l.y)}function Oo(f,l){return f.x===l.x&&f.y===l.y}function hl(f,l,g,T){const z=pp(bo(f,l,g)),F=pp(bo(f,l,T)),O=pp(bo(g,T,f)),H=pp(bo(g,T,l));return z!==F&&O!==H||!(z!==0||!mf(f,g,l))||!(F!==0||!mf(f,T,l))||!(O!==0||!mf(g,f,T))||!(H!==0||!mf(g,l,T))}function mf(f,l,g){return l.x<=Math.max(f.x,g.x)&&l.x>=Math.min(f.x,g.x)&&l.y<=Math.max(f.y,g.y)&&l.y>=Math.min(f.y,g.y)}function pp(f){return f>0?1:f<0?-1:0}function Bd(f,l){return bo(f.prev,f,f.next)<0?bo(f,l,f.next)>=0&&bo(f,f.prev,l)>=0:bo(f,l,f.prev)<0||bo(f,f.next,l)<0}function vm(f,l){const g=Nd(f.i,f.x,f.y),T=Nd(l.i,l.x,l.y),z=f.next,F=l.prev;return f.next=l,l.prev=f,g.next=z,z.prev=g,T.next=g,g.prev=T,F.next=T,T.prev=F,T}function Of(f,l,g,T){const z=Nd(f,l,g);return T?(z.next=T.next,z.prev=T,T.next.prev=z,T.next=z):(z.prev=z,z.next=z),z}function _f(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function Nd(f,l,g){return{i:f,x:l,y:g,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Bp(f,l,g){const T=g.patternDependencies;let z=!1;for(const F of l){const O=F.paint.get(`${f}-pattern`);O.isConstant()||(z=!0);const H=O.constantOr(null);H&&(z=!0,T[H.to]=!0,T[H.from]=!0)}return z}function Np(f,l,g,T,z){const F=z.patternDependencies;for(const O of l){const H=O.paint.get(`${f}-pattern`).value;if(H.kind!=="constant"){let W=H.evaluate({zoom:T-1},g,{},z.availableImages),re=H.evaluate({zoom:T},g,{},z.availableImages),pe=H.evaluate({zoom:T+1},g,{},z.availableImages);W=W&&W.name?W.name:W,re=re&&re.name?re.name:re,pe=pe&&pe.name?pe.name:pe,F[W]=!0,F[re]=!0,F[pe]=!0,g.patterns[O.id]={min:W,mid:re,max:pe}}}return g}class gf{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mc,this.indexArray=new Ko,this.indexArray2=new pn,this.programConfigurations=new bi(l.layers,l.zoom),this.segments=new ja,this.segments2=new ja,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(l,g,T){this.hasPattern=Bp("fill",this.layers,g);const z=this.layers[0].layout.get("fill-sort-key"),F=!z.isConstant(),O=[];for(const{feature:H,id:W,index:re,sourceLayerIndex:pe}of l){const ve=this.layers[0]._featureFilter.needGeometry,Me=yc(H,ve);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom),Me,T))continue;const Le=F?z.evaluate(Me,{},T,g.availableImages):void 0,qe={id:W,properties:H.properties,type:H.type,sourceLayerIndex:pe,index:re,geometry:ve?Me.geometry:Uh(H),patterns:{},sortKey:Le};O.push(qe)}F&&O.sort(((H,W)=>H.sortKey-W.sortKey));for(const H of O){const{geometry:W,index:re,sourceLayerIndex:pe}=H;if(this.hasPattern){const ve=Np("fill",this.layers,H,this.zoom,g);this.patternFeatures.push(ve)}else this.addFeature(H,W,re,T,{});g.featureIndex.insert(l[re].feature,W,re,pe,this.index)}}update(l,g,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,g,this.stateDependentLayers,T)}addFeatures(l,g,T){for(const z of this.patternFeatures)this.addFeature(z,z.geometry,z.index,g,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,hp),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,g,T,z,F){for(const O of zc(g,500)){let H=0;for(const Le of O)H+=Le.length;const W=this.segments.prepareSegment(H,this.layoutVertexArray,this.indexArray),re=W.vertexLength,pe=[],ve=[];for(const Le of O){if(Le.length===0)continue;Le!==O[0]&&ve.push(pe.length/2);const qe=this.segments2.prepareSegment(Le.length,this.layoutVertexArray,this.indexArray2),Je=qe.vertexLength;this.layoutVertexArray.emplaceBack(Le[0].x,Le[0].y),this.indexArray2.emplaceBack(Je+Le.length-1,Je),pe.push(Le[0].x),pe.push(Le[0].y);for(let xt=1;xt<Le.length;xt++)this.layoutVertexArray.emplaceBack(Le[xt].x,Le[xt].y),this.indexArray2.emplaceBack(Je+xt-1,Je+xt),pe.push(Le[xt].x),pe.push(Le[xt].y);qe.vertexLength+=Le.length,qe.primitiveLength+=Le.length}const Me=dp(pe,ve);for(let Le=0;Le<Me.length;Le+=3)this.indexArray.emplaceBack(re+Me[Le],re+Me[Le+1],re+Me[Le+2]);W.vertexLength+=H,W.primitiveLength+=Me.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,F,z)}}let jp,mp;dn("FillBucket",gf,{omit:["layers","patternFeatures"]});var _p={get paint(){return mp=mp||new L({"fill-antialias":new Wn($t.paint_fill["fill-antialias"]),"fill-opacity":new Fr($t.paint_fill["fill-opacity"]),"fill-color":new Fr($t.paint_fill["fill-color"]),"fill-outline-color":new Fr($t.paint_fill["fill-outline-color"]),"fill-translate":new Wn($t.paint_fill["fill-translate"]),"fill-translate-anchor":new Wn($t.paint_fill["fill-translate-anchor"]),"fill-pattern":new vu($t.paint_fill["fill-pattern"])})},get layout(){return jp=jp||new L({"fill-sort-key":new Fr($t.layout_fill["fill-sort-key"])})}};class jm extends v{constructor(l){super(l,_p)}recalculate(l,g){super.recalculate(l,g);const T=this.paint._values["fill-outline-color"];T.value.kind==="constant"&&T.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new gf(l)}queryRadius(){return Lp(this.paint.get("fill-translate"))}queryIntersectsFeature(l,g,T,z,F,O,H){return Om(sp(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),O.angle,H),z)}isTileClipped(){return!0}}const Vm=q([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xm=q([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ss}=Vm;var ph={},Um=Fe,Vp=yf;function yf(f,l,g,T,z){this.properties={},this.extent=g,this.type=0,this._pbf=f,this._geometry=-1,this._keys=T,this._values=z,f.readFields(gp,this,l)}function gp(f,l,g){f==1?l.id=g.readVarint():f==2?(function(T,z){for(var F=T.readVarint()+T.pos;T.pos<F;){var O=z._keys[T.readVarint()],H=z._values[T.readVarint()];z.properties[O]=H}})(g,l):f==3?l.type=g.readVarint():f==4&&(l._geometry=g.pos)}function Up(f){for(var l,g,T=0,z=0,F=f.length,O=F-1;z<F;O=z++)T+=((g=f[O]).x-(l=f[z]).x)*(l.y+g.y);return T}yf.types=["Unknown","Point","LineString","Polygon"],yf.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var l,g=f.readVarint()+f.pos,T=1,z=0,F=0,O=0,H=[];f.pos<g;){if(z<=0){var W=f.readVarint();T=7&W,z=W>>3}if(z--,T===1||T===2)F+=f.readSVarint(),O+=f.readSVarint(),T===1&&(l&&H.push(l),l=[]),l.push(new Um(F,O));else{if(T!==7)throw new Error("unknown command "+T);l&&l.push(l[0].clone())}}return l&&H.push(l),H},yf.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var l=f.readVarint()+f.pos,g=1,T=0,z=0,F=0,O=1/0,H=-1/0,W=1/0,re=-1/0;f.pos<l;){if(T<=0){var pe=f.readVarint();g=7&pe,T=pe>>3}if(T--,g===1||g===2)(z+=f.readSVarint())<O&&(O=z),z>H&&(H=z),(F+=f.readSVarint())<W&&(W=F),F>re&&(re=F);else if(g!==7)throw new Error("unknown command "+g)}return[O,W,H,re]},yf.prototype.toGeoJSON=function(f,l,g){var T,z,F=this.extent*Math.pow(2,g),O=this.extent*f,H=this.extent*l,W=this.loadGeometry(),re=yf.types[this.type];function pe(Le){for(var qe=0;qe<Le.length;qe++){var Je=Le[qe];Le[qe]=[360*(Je.x+O)/F-180,360/Math.PI*Math.atan(Math.exp((180-360*(Je.y+H)/F)*Math.PI/180))-90]}}switch(this.type){case 1:var ve=[];for(T=0;T<W.length;T++)ve[T]=W[T][0];pe(W=ve);break;case 2:for(T=0;T<W.length;T++)pe(W[T]);break;case 3:for(W=(function(Le){var qe=Le.length;if(qe<=1)return[Le];for(var Je,xt,zt=[],ai=0;ai<qe;ai++){var Vt=Up(Le[ai]);Vt!==0&&(xt===void 0&&(xt=Vt<0),xt===Vt<0?(Je&&zt.push(Je),Je=[Le[ai]]):Je.push(Le[ai]))}return Je&&zt.push(Je),zt})(W),T=0;T<W.length;T++)for(z=0;z<W[T].length;z++)pe(W[T][z])}W.length===1?W=W[0]:re="Multi"+re;var Me={type:"Feature",geometry:{type:re,coordinates:W},properties:this.properties};return"id"in this&&(Me.id=this.id),Me};var bm=Vp,$u=mh;function mh(f,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=f,this._keys=[],this._values=[],this._features=[],f.readFields(wm,this,l),this.length=this._features.length}function wm(f,l,g){f===15?l.version=g.readVarint():f===1?l.name=g.readString():f===5?l.extent=g.readVarint():f===2?l._features.push(g.pos):f===3?l._keys.push(g.readString()):f===4&&l._values.push((function(T){for(var z=null,F=T.readVarint()+T.pos;T.pos<F;){var O=T.readVarint()>>3;z=O===1?T.readString():O===2?T.readFloat():O===3?T.readDouble():O===4?T.readVarint64():O===5?T.readVarint():O===6?T.readSVarint():O===7?T.readBoolean():null}return z})(g))}mh.prototype.feature=function(f){if(f<0||f>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[f];var l=this._pbf.readVarint()+this._pbf.pos;return new bm(this._pbf,l,this.extent,this._keys,this._values)};var Bo=$u;function Ql(f,l,g){if(f===3){var T=new Bo(g,g.readVarint()+g.pos);T.length&&(l[T.name]=T)}}ph.VectorTile=function(f,l){this.layers=f.readFields(Ql,{},l)},ph.VectorTileFeature=Vp,ph.VectorTileLayer=$u;const Bf=ph.VectorTileFeature.types,Nf=Math.pow(2,13);function _h(f,l,g,T,z,F,O,H){f.emplaceBack(l,g,2*Math.floor(T*Nf)+O,z*Nf*2,F*Nf*2,Math.round(H))}class jf{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Bl,this.centroidVertexArray=new ks,this.indexArray=new Ko,this.programConfigurations=new bi(l.layers,l.zoom),this.segments=new ja,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(l,g,T){this.features=[],this.hasPattern=Bp("fill-extrusion",this.layers,g);for(const{feature:z,id:F,index:O,sourceLayerIndex:H}of l){const W=this.layers[0]._featureFilter.needGeometry,re=yc(z,W);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom),re,T))continue;const pe={id:F,sourceLayerIndex:H,index:O,geometry:W?re.geometry:Uh(z),properties:z.properties,type:z.type,patterns:{}};this.hasPattern?this.features.push(Np("fill-extrusion",this.layers,pe,this.zoom,g)):this.addFeature(pe,pe.geometry,O,T,{}),g.featureIndex.insert(z,pe.geometry,O,H,this.index,!0)}}addFeatures(l,g,T){for(const z of this.features){const{geometry:F}=z;this.addFeature(z,F,z.index,g,T)}}update(l,g,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,g,this.stateDependentLayers,T)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Ss),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,xm.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,g,T,z,F){for(const O of zc(g,500)){const H={x:0,y:0,vertexCount:0};let W=0;for(const qe of O)W+=qe.length;let re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const qe of O){if(qe.length===0||Tm(qe))continue;let Je=0;for(let xt=0;xt<qe.length;xt++){const zt=qe[xt];if(xt>=1){const ai=qe[xt-1];if(!uo(zt,ai)){re.vertexLength+4>ja.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Vt=zt.sub(ai)._perp()._unit(),ii=ai.dist(zt);Je+ii>32768&&(Je=0),_h(this.layoutVertexArray,zt.x,zt.y,Vt.x,Vt.y,0,0,Je),_h(this.layoutVertexArray,zt.x,zt.y,Vt.x,Vt.y,0,1,Je),H.x+=2*zt.x,H.y+=2*zt.y,H.vertexCount+=2,Je+=ii,_h(this.layoutVertexArray,ai.x,ai.y,Vt.x,Vt.y,0,0,Je),_h(this.layoutVertexArray,ai.x,ai.y,Vt.x,Vt.y,0,1,Je),H.x+=2*ai.x,H.y+=2*ai.y,H.vertexCount+=2;const Fi=re.vertexLength;this.indexArray.emplaceBack(Fi,Fi+2,Fi+1),this.indexArray.emplaceBack(Fi+1,Fi+2,Fi+3),re.vertexLength+=4,re.primitiveLength+=2}}}}if(re.vertexLength+W>ja.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(W,this.layoutVertexArray,this.indexArray)),Bf[l.type]!=="Polygon")continue;const pe=[],ve=[],Me=re.vertexLength;for(const qe of O)if(qe.length!==0){qe!==O[0]&&ve.push(pe.length/2);for(let Je=0;Je<qe.length;Je++){const xt=qe[Je];_h(this.layoutVertexArray,xt.x,xt.y,0,0,1,1,0),H.x+=xt.x,H.y+=xt.y,H.vertexCount+=1,pe.push(xt.x),pe.push(xt.y)}}const Le=dp(pe,ve);for(let qe=0;qe<Le.length;qe+=3)this.indexArray.emplaceBack(Me+Le[qe],Me+Le[qe+2],Me+Le[qe+1]);re.primitiveLength+=Le.length/3,re.vertexLength+=W;for(let qe=0;qe<H.vertexCount;qe++){const Je=Math.floor(H.x/H.vertexCount),xt=Math.floor(H.y/H.vertexCount);this.centroidVertexArray.emplaceBack(Je,xt)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,F,z)}}function uo(f,l){return f.x===l.x&&(f.x<0||f.x>da)||f.y===l.y&&(f.y<0||f.y>da)}function Tm(f){return f.every((l=>l.x<0))||f.every((l=>l.x>da))||f.every((l=>l.y<0))||f.every((l=>l.y>da))}let h_;dn("FillExtrusionBucket",jf,{omit:["layers","features"]});var Gp={get paint(){return h_=h_||new L({"fill-extrusion-opacity":new Wn($t["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fr($t["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Wn($t["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Wn($t["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vu($t["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Fr($t["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fr($t["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Wn($t["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Vf extends v{constructor(l){super(l,Gp)}createBucket(l){return new jf(l)}queryRadius(){return Lp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,g,T,z,F,O,H,W){const re=sp(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),O.angle,H),pe=this.paint.get("fill-extrusion-height").evaluate(g,T),ve=this.paint.get("fill-extrusion-base").evaluate(g,T),Me=(function(qe,Je,xt,zt){const ai=[];for(const Vt of qe){const ii=[Vt.x,Vt.y,0,1];op(ii,ii,Je),ai.push(new it(ii[0]/ii[3],ii[1]/ii[3]))}return ai})(re,W),Le=(function(qe,Je,xt,zt){const ai=[],Vt=[],ii=zt[8]*Je,Fi=zt[9]*Je,gn=zt[10]*Je,Xn=zt[11]*Je,Rr=zt[8]*xt,Bn=zt[9]*xt,Mn=zt[10]*xt,wr=zt[11]*xt;for(const lr of qe){const nr=[],Zi=[];for(const or of lr){const Tr=or.x,aa=or.y,vs=zt[0]*Tr+zt[4]*aa+zt[12],ro=zt[1]*Tr+zt[5]*aa+zt[13],Tl=zt[2]*Tr+zt[6]*aa+zt[14],Bc=zt[3]*Tr+zt[7]*aa+zt[15],nc=Tl+gn,Gl=Bc+Xn,tu=vs+Rr,Tc=ro+Bn,il=Tl+Mn,nl=Bc+wr,rc=new it((vs+ii)/Gl,(ro+Fi)/Gl);rc.z=nc/Gl,nr.push(rc);const iu=new it(tu/nl,Tc/nl);iu.z=il/nl,Zi.push(iu)}ai.push(nr),Vt.push(Zi)}return[ai,Vt]})(z,ve,pe,W);return(function(qe,Je,xt){let zt=1/0;Om(xt,Je)&&(zt=Uf(xt,Je[0]));for(let ai=0;ai<Je.length;ai++){const Vt=Je[ai],ii=qe[ai];for(let Fi=0;Fi<Vt.length-1;Fi++){const gn=Vt[Fi],Xn=[gn,Vt[Fi+1],ii[Fi+1],ii[Fi],gn];fm(xt,Xn)&&(zt=Math.min(zt,Uf(xt,Xn)))}}return zt!==1/0&&zt})(Le[0],Le[1],Me)}}function Oc(f,l){return f.x*l.x+f.y*l.y}function Uf(f,l){if(f.length===1){let g=0;const T=l[g++];let z;for(;!z||T.equals(z);)if(z=l[g++],!z)return 1/0;for(;g<l.length;g++){const F=l[g],O=f[0],H=z.sub(T),W=F.sub(T),re=O.sub(T),pe=Oc(H,H),ve=Oc(H,W),Me=Oc(W,W),Le=Oc(re,H),qe=Oc(re,W),Je=pe*Me-ve*ve,xt=(Me*Le-ve*qe)/Je,zt=(pe*qe-ve*Le)/Je,ai=T.z*(1-xt-zt)+z.z*xt+F.z*zt;if(isFinite(ai))return ai}return 1/0}{let g=1/0;for(const T of l)g=Math.min(g,T.z);return g}}const Gf=q([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Zu}=Gf,ec=q([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:yd}=ec,vd=ph.VectorTileFeature.types,gh=Math.cos(Math.PI/180*37.5),Sm=Math.pow(2,14)/.5;class Hp{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((g=>{this.gradients[g.id]={}})),this.layoutVertexArray=new Kc,this.layoutVertexArray2=new ul,this.indexArray=new Ko,this.programConfigurations=new bi(l.layers,l.zoom),this.segments=new ja,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(l,g,T){this.hasPattern=Bp("line",this.layers,g);const z=this.layers[0].layout.get("line-sort-key"),F=!z.isConstant(),O=[];for(const{feature:H,id:W,index:re,sourceLayerIndex:pe}of l){const ve=this.layers[0]._featureFilter.needGeometry,Me=yc(H,ve);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom),Me,T))continue;const Le=F?z.evaluate(Me,{},T):void 0,qe={id:W,properties:H.properties,type:H.type,sourceLayerIndex:pe,index:re,geometry:ve?Me.geometry:Uh(H),patterns:{},sortKey:Le};O.push(qe)}F&&O.sort(((H,W)=>H.sortKey-W.sortKey));for(const H of O){const{geometry:W,index:re,sourceLayerIndex:pe}=H;if(this.hasPattern){const ve=Np("line",this.layers,H,this.zoom,g);this.patternFeatures.push(ve)}else this.addFeature(H,W,re,T,{});g.featureIndex.insert(l[re].feature,W,re,pe,this.index)}}update(l,g,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,g,this.stateDependentLayers,T)}addFeatures(l,g,T){for(const z of this.patternFeatures)this.addFeature(z,z.geometry,z.index,g,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,yd)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Zu),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,g,T,z,F){const O=this.layers[0].layout,H=O.get("line-join").evaluate(l,{}),W=O.get("line-cap"),re=O.get("line-miter-limit"),pe=O.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const ve of g)this.addLine(ve,l,H,W,re,pe);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,F,z)}addLine(l,g,T,z,F,O){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let zt=0;zt<l.length-1;zt++)this.totalDistance+=l[zt].dist(l[zt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const H=vd[g.type]==="Polygon";let W=l.length;for(;W>=2&&l[W-1].equals(l[W-2]);)W--;let re=0;for(;re<W-1&&l[re].equals(l[re+1]);)re++;if(W<(H?3:2))return;T==="bevel"&&(F=1.05);const pe=this.overscaling<=16?15*da/(512*this.overscaling):0,ve=this.segments.prepareSegment(10*W,this.layoutVertexArray,this.indexArray);let Me,Le,qe,Je,xt;this.e1=this.e2=-1,H&&(Me=l[W-2],xt=l[re].sub(Me)._unit()._perp());for(let zt=re;zt<W;zt++){if(qe=zt===W-1?H?l[re+1]:void 0:l[zt+1],qe&&l[zt].equals(qe))continue;xt&&(Je=xt),Me&&(Le=Me),Me=l[zt],xt=qe?qe.sub(Me)._unit()._perp():Je,Je=Je||xt;let ai=Je.add(xt);ai.x===0&&ai.y===0||ai._unit();const Vt=Je.x*xt.x+Je.y*xt.y,ii=ai.x*xt.x+ai.y*xt.y,Fi=ii!==0?1/ii:1/0,gn=2*Math.sqrt(2-2*ii),Xn=ii<gh&&Le&&qe,Rr=Je.x*xt.y-Je.y*xt.x>0;if(Xn&&zt>re){const wr=Me.dist(Le);if(wr>2*pe){const lr=Me.sub(Me.sub(Le)._mult(pe/wr)._round());this.updateDistance(Le,lr),this.addCurrentVertex(lr,Je,0,0,ve),Le=lr}}const Bn=Le&&qe;let Mn=Bn?T:H?"butt":z;if(Bn&&Mn==="round"&&(Fi<O?Mn="miter":Fi<=2&&(Mn="fakeround")),Mn==="miter"&&Fi>F&&(Mn="bevel"),Mn==="bevel"&&(Fi>2&&(Mn="flipbevel"),Fi<F&&(Mn="miter")),Le&&this.updateDistance(Le,Me),Mn==="miter")ai._mult(Fi),this.addCurrentVertex(Me,ai,0,0,ve);else if(Mn==="flipbevel"){if(Fi>100)ai=xt.mult(-1);else{const wr=Fi*Je.add(xt).mag()/Je.sub(xt).mag();ai._perp()._mult(wr*(Rr?-1:1))}this.addCurrentVertex(Me,ai,0,0,ve),this.addCurrentVertex(Me,ai.mult(-1),0,0,ve)}else if(Mn==="bevel"||Mn==="fakeround"){const wr=-Math.sqrt(Fi*Fi-1),lr=Rr?wr:0,nr=Rr?0:wr;if(Le&&this.addCurrentVertex(Me,Je,lr,nr,ve),Mn==="fakeround"){const Zi=Math.round(180*gn/Math.PI/20);for(let or=1;or<Zi;or++){let Tr=or/Zi;if(Tr!==.5){const vs=Tr-.5;Tr+=Tr*vs*(Tr-1)*((1.0904+Vt*(Vt*(3.55645-1.43519*Vt)-3.2452))*vs*vs+(.848013+Vt*(.215638*Vt-1.06021)))}const aa=xt.sub(Je)._mult(Tr)._add(Je)._unit()._mult(Rr?-1:1);this.addHalfVertex(Me,aa.x,aa.y,!1,Rr,0,ve)}}qe&&this.addCurrentVertex(Me,xt,-lr,-nr,ve)}else if(Mn==="butt")this.addCurrentVertex(Me,ai,0,0,ve);else if(Mn==="square"){const wr=Le?1:-1;this.addCurrentVertex(Me,ai,wr,wr,ve)}else Mn==="round"&&(Le&&(this.addCurrentVertex(Me,Je,0,0,ve),this.addCurrentVertex(Me,Je,1,1,ve,!0)),qe&&(this.addCurrentVertex(Me,xt,-1,-1,ve,!0),this.addCurrentVertex(Me,xt,0,0,ve)));if(Xn&&zt<W-1){const wr=Me.dist(qe);if(wr>2*pe){const lr=Me.add(qe.sub(Me)._mult(pe/wr)._round());this.updateDistance(Me,lr),this.addCurrentVertex(lr,xt,0,0,ve),Me=lr}}}}addCurrentVertex(l,g,T,z,F,O=!1){const H=g.y*z-g.x,W=-g.y-g.x*z;this.addHalfVertex(l,g.x+g.y*T,g.y-g.x*T,O,!1,T,F),this.addHalfVertex(l,H,W,O,!0,-z,F),this.distance>Sm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,g,T,z,F,O))}addHalfVertex({x:l,y:g},T,z,F,O,H,W){const re=.5*(this.lineClips?this.scaledDistance*(Sm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(F?1:0),(g<<1)+(O?1:0),Math.round(63*T)+128,Math.round(63*z)+128,1+(H===0?0:H<0?-1:1)|(63&re)<<2,re>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const pe=W.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,pe),W.primitiveLength++),O?this.e2=pe:this.e1=pe}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,g){this.distance+=l.dist(g),this.updateScaledDistance()}}let qp,Gm;dn("LineBucket",Hp,{omit:["layers","patternFeatures"]});var yh={get paint(){return Gm=Gm||new L({"line-opacity":new Fr($t.paint_line["line-opacity"]),"line-color":new Fr($t.paint_line["line-color"]),"line-translate":new Wn($t.paint_line["line-translate"]),"line-translate-anchor":new Wn($t.paint_line["line-translate-anchor"]),"line-width":new Fr($t.paint_line["line-width"]),"line-gap-width":new Fr($t.paint_line["line-gap-width"]),"line-offset":new Fr($t.paint_line["line-offset"]),"line-blur":new Fr($t.paint_line["line-blur"]),"line-dasharray":new Vu($t.paint_line["line-dasharray"]),"line-pattern":new vu($t.paint_line["line-pattern"]),"line-gradient":new md($t.paint_line["line-gradient"])})},get layout(){return qp=qp||new L({"line-cap":new Wn($t.layout_line["line-cap"]),"line-join":new Fr($t.layout_line["line-join"]),"line-miter-limit":new Wn($t.layout_line["line-miter-limit"]),"line-round-limit":new Wn($t.layout_line["line-round-limit"]),"line-sort-key":new Fr($t.layout_line["line-sort-key"])})}};class ys extends Fr{possiblyEvaluate(l,g){return g=new Ba(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),super.possiblyEvaluate(l,g)}evaluate(l,g,T,z){return g=mn({},g,{zoom:Math.floor(g.zoom)}),super.evaluate(l,g,T,z)}}let bc;class $p extends v{constructor(l){super(l,yh),this.gradientVersion=0,bc||(bc=new ys(yh.paint.properties["line-width"].specification),bc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const g=this.gradientExpression();this.stepInterpolant=!!(function(T){return T._styleExpression!==void 0})(g)&&g._styleExpression.expression instanceof Mu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,g){super.recalculate(l,g),this.paint._values["line-floorwidth"]=bc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Hp(l)}queryRadius(l){const g=l,T=jl(vc("line-width",this,g),vc("line-gap-width",this,g)),z=vc("line-offset",this,g);return T/2+Math.abs(z)+Lp(this.paint.get("line-translate"))}queryIntersectsFeature(l,g,T,z,F,O,H){const W=sp(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),O.angle,H),re=H/2*jl(this.paint.get("line-width").evaluate(g,T),this.paint.get("line-gap-width").evaluate(g,T)),pe=this.paint.get("line-offset").evaluate(g,T);return pe&&(z=(function(ve,Me){const Le=[];for(let qe=0;qe<ve.length;qe++){const Je=ve[qe],xt=[];for(let zt=0;zt<Je.length;zt++){const ai=Je[zt-1],Vt=Je[zt],ii=Je[zt+1],Fi=zt===0?new it(0,0):Vt.sub(ai)._unit()._perp(),gn=zt===Je.length-1?new it(0,0):ii.sub(Vt)._unit()._perp(),Xn=Fi._add(gn)._unit(),Rr=Xn.x*gn.x+Xn.y*gn.y;Rr!==0&&Xn._mult(1/Rr),xt.push(Xn._mult(Me)._add(Vt))}Le.push(xt)}return Le})(z,pe*H)),(function(ve,Me,Le){for(let qe=0;qe<Me.length;qe++){const Je=Me[qe];if(ve.length>=3){for(let xt=0;xt<Je.length;xt++)if(qu(ve,Je[xt]))return!0}if(u_(ve,Je,Le))return!0}return!1})(W,z,re)}isTileClipped(){return!0}}function jl(f,l){return l>0?l+2*f:f}const yp=q([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Em=q([{name:"a_projected_pos",components:3,type:"Float32"}],4);q([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wu=q([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);q([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Es=q([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),bl=q([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Eu(f,l,g){return f.sections.forEach((T=>{T.text=(function(z,F,O){const H=F.layout.get("text-transform").evaluate(O,{});return H==="uppercase"?z=z.toLocaleUpperCase():H==="lowercase"&&(z=z.toLocaleLowerCase()),Yo.applyArabicShaping&&(z=Yo.applyArabicShaping(z)),z})(T.text,l,g)})),f}q([{name:"triangle",components:3,type:"Uint16"}]),q([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),q([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),q([{type:"Float32",name:"offsetX"}]),q([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),q([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const h={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var t=24,a=b,d=function(f,l,g,T,z){var F,O,H=8*z-T-1,W=(1<<H)-1,re=W>>1,pe=-7,ve=z-1,Me=-1,Le=f[l+ve];for(ve+=Me,F=Le&(1<<-pe)-1,Le>>=-pe,pe+=H;pe>0;F=256*F+f[l+ve],ve+=Me,pe-=8);for(O=F&(1<<-pe)-1,F>>=-pe,pe+=T;pe>0;O=256*O+f[l+ve],ve+=Me,pe-=8);if(F===0)F=1-re;else{if(F===W)return O?NaN:1/0*(Le?-1:1);O+=Math.pow(2,T),F-=re}return(Le?-1:1)*O*Math.pow(2,F-T)},y=function(f,l,g,T,z,F){var O,H,W,re=8*F-z-1,pe=(1<<re)-1,ve=pe>>1,Me=z===23?Math.pow(2,-24)-Math.pow(2,-77):0,Le=0,qe=1,Je=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(H=isNaN(l)?1:0,O=pe):(O=Math.floor(Math.log(l)/Math.LN2),l*(W=Math.pow(2,-O))<1&&(O--,W*=2),(l+=O+ve>=1?Me/W:Me*Math.pow(2,1-ve))*W>=2&&(O++,W/=2),O+ve>=pe?(H=0,O=pe):O+ve>=1?(H=(l*W-1)*Math.pow(2,z),O+=ve):(H=l*Math.pow(2,ve-1)*Math.pow(2,z),O=0));z>=8;f[g+Le]=255&H,Le+=qe,H/=256,z-=8);for(O=O<<z|H,re+=z;re>0;f[g+Le]=255&O,Le+=qe,O/=256,re-=8);f[g+Le-qe]|=128*Je};function b(f){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(f)?f:new Uint8Array(f||0),this.pos=0,this.type=0,this.length=this.buf.length}b.Varint=0,b.Fixed64=1,b.Bytes=2,b.Fixed32=5;var S=4294967296,I=1/S,D=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function N(f){return f.type===b.Bytes?f.readVarint()+f.pos:f.pos+1}function V(f,l,g){return g?4294967296*l+(f>>>0):4294967296*(l>>>0)+(f>>>0)}function K(f,l,g){var T=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));g.realloc(T);for(var z=g.pos-1;z>=f;z--)g.buf[z+T]=g.buf[z]}function X(f,l){for(var g=0;g<f.length;g++)l.writeVarint(f[g])}function Q(f,l){for(var g=0;g<f.length;g++)l.writeSVarint(f[g])}function ae(f,l){for(var g=0;g<f.length;g++)l.writeFloat(f[g])}function ie(f,l){for(var g=0;g<f.length;g++)l.writeDouble(f[g])}function ge(f,l){for(var g=0;g<f.length;g++)l.writeBoolean(f[g])}function me(f,l){for(var g=0;g<f.length;g++)l.writeFixed32(f[g])}function Se(f,l){for(var g=0;g<f.length;g++)l.writeSFixed32(f[g])}function De(f,l){for(var g=0;g<f.length;g++)l.writeFixed64(f[g])}function Ee(f,l){for(var g=0;g<f.length;g++)l.writeSFixed64(f[g])}function We(f,l){return(f[l]|f[l+1]<<8|f[l+2]<<16)+16777216*f[l+3]}function Ve(f,l,g){f[g]=l,f[g+1]=l>>>8,f[g+2]=l>>>16,f[g+3]=l>>>24}function He(f,l){return(f[l]|f[l+1]<<8|f[l+2]<<16)+(f[l+3]<<24)}b.prototype={destroy:function(){this.buf=null},readFields:function(f,l,g){for(g=g||this.length;this.pos<g;){var T=this.readVarint(),z=T>>3,F=this.pos;this.type=7&T,f(z,l,this),this.pos===F&&this.skip(T)}return l},readMessage:function(f,l){return this.readFields(f,l,this.readVarint()+this.pos)},readFixed32:function(){var f=We(this.buf,this.pos);return this.pos+=4,f},readSFixed32:function(){var f=He(this.buf,this.pos);return this.pos+=4,f},readFixed64:function(){var f=We(this.buf,this.pos)+We(this.buf,this.pos+4)*S;return this.pos+=8,f},readSFixed64:function(){var f=We(this.buf,this.pos)+He(this.buf,this.pos+4)*S;return this.pos+=8,f},readFloat:function(){var f=d(this.buf,this.pos,!0,23,4);return this.pos+=4,f},readDouble:function(){var f=d(this.buf,this.pos,!0,52,8);return this.pos+=8,f},readVarint:function(f){var l,g,T=this.buf;return l=127&(g=T[this.pos++]),g<128?l:(l|=(127&(g=T[this.pos++]))<<7,g<128?l:(l|=(127&(g=T[this.pos++]))<<14,g<128?l:(l|=(127&(g=T[this.pos++]))<<21,g<128?l:(function(z,F,O){var H,W,re=O.buf;if(H=(112&(W=re[O.pos++]))>>4,W<128||(H|=(127&(W=re[O.pos++]))<<3,W<128)||(H|=(127&(W=re[O.pos++]))<<10,W<128)||(H|=(127&(W=re[O.pos++]))<<17,W<128)||(H|=(127&(W=re[O.pos++]))<<24,W<128)||(H|=(1&(W=re[O.pos++]))<<31,W<128))return V(z,H,F);throw new Error("Expected varint not more than 10 bytes")})(l|=(15&(g=T[this.pos]))<<28,f,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var f=this.readVarint();return f%2==1?(f+1)/-2:f/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var f=this.readVarint()+this.pos,l=this.pos;return this.pos=f,f-l>=12&&D?(function(g,T,z){return D.decode(g.subarray(T,z))})(this.buf,l,f):(function(g,T,z){for(var F="",O=T;O<z;){var H,W,re,pe=g[O],ve=null,Me=pe>239?4:pe>223?3:pe>191?2:1;if(O+Me>z)break;Me===1?pe<128&&(ve=pe):Me===2?(192&(H=g[O+1]))==128&&(ve=(31&pe)<<6|63&H)<=127&&(ve=null):Me===3?(W=g[O+2],(192&(H=g[O+1]))==128&&(192&W)==128&&((ve=(15&pe)<<12|(63&H)<<6|63&W)<=2047||ve>=55296&&ve<=57343)&&(ve=null)):Me===4&&(W=g[O+2],re=g[O+3],(192&(H=g[O+1]))==128&&(192&W)==128&&(192&re)==128&&((ve=(15&pe)<<18|(63&H)<<12|(63&W)<<6|63&re)<=65535||ve>=1114112)&&(ve=null)),ve===null?(ve=65533,Me=1):ve>65535&&(ve-=65536,F+=String.fromCharCode(ve>>>10&1023|55296),ve=56320|1023&ve),F+=String.fromCharCode(ve),O+=Me}return F})(this.buf,l,f)},readBytes:function(){var f=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,f);return this.pos=f,l},readPackedVarint:function(f,l){if(this.type!==b.Bytes)return f.push(this.readVarint(l));var g=N(this);for(f=f||[];this.pos<g;)f.push(this.readVarint(l));return f},readPackedSVarint:function(f){if(this.type!==b.Bytes)return f.push(this.readSVarint());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readSVarint());return f},readPackedBoolean:function(f){if(this.type!==b.Bytes)return f.push(this.readBoolean());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readBoolean());return f},readPackedFloat:function(f){if(this.type!==b.Bytes)return f.push(this.readFloat());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readFloat());return f},readPackedDouble:function(f){if(this.type!==b.Bytes)return f.push(this.readDouble());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readDouble());return f},readPackedFixed32:function(f){if(this.type!==b.Bytes)return f.push(this.readFixed32());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readFixed32());return f},readPackedSFixed32:function(f){if(this.type!==b.Bytes)return f.push(this.readSFixed32());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readSFixed32());return f},readPackedFixed64:function(f){if(this.type!==b.Bytes)return f.push(this.readFixed64());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readFixed64());return f},readPackedSFixed64:function(f){if(this.type!==b.Bytes)return f.push(this.readSFixed64());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readSFixed64());return f},skip:function(f){var l=7&f;if(l===b.Varint)for(;this.buf[this.pos++]>127;);else if(l===b.Bytes)this.pos=this.readVarint()+this.pos;else if(l===b.Fixed32)this.pos+=4;else{if(l!==b.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(f,l){this.writeVarint(f<<3|l)},realloc:function(f){for(var l=this.length||16;l<this.pos+f;)l*=2;if(l!==this.length){var g=new Uint8Array(l);g.set(this.buf),this.buf=g,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(f){this.realloc(4),Ve(this.buf,f,this.pos),this.pos+=4},writeSFixed32:function(f){this.realloc(4),Ve(this.buf,f,this.pos),this.pos+=4},writeFixed64:function(f){this.realloc(8),Ve(this.buf,-1&f,this.pos),Ve(this.buf,Math.floor(f*I),this.pos+4),this.pos+=8},writeSFixed64:function(f){this.realloc(8),Ve(this.buf,-1&f,this.pos),Ve(this.buf,Math.floor(f*I),this.pos+4),this.pos+=8},writeVarint:function(f){(f=+f||0)>268435455||f<0?(function(l,g){var T,z;if(l>=0?(T=l%4294967296|0,z=l/4294967296|0):(z=~(-l/4294967296),4294967295^(T=~(-l%4294967296))?T=T+1|0:(T=0,z=z+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),(function(F,O,H){H.buf[H.pos++]=127&F|128,F>>>=7,H.buf[H.pos++]=127&F|128,F>>>=7,H.buf[H.pos++]=127&F|128,F>>>=7,H.buf[H.pos++]=127&F|128,H.buf[H.pos]=127&(F>>>=7)})(T,0,g),(function(F,O){var H=(7&F)<<4;O.buf[O.pos++]|=H|((F>>>=3)?128:0),F&&(O.buf[O.pos++]=127&F|((F>>>=7)?128:0),F&&(O.buf[O.pos++]=127&F|((F>>>=7)?128:0),F&&(O.buf[O.pos++]=127&F|((F>>>=7)?128:0),F&&(O.buf[O.pos++]=127&F|((F>>>=7)?128:0),F&&(O.buf[O.pos++]=127&F)))))})(z,g)})(f,this):(this.realloc(4),this.buf[this.pos++]=127&f|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=f>>>7&127))))},writeSVarint:function(f){this.writeVarint(f<0?2*-f-1:2*f)},writeBoolean:function(f){this.writeVarint(!!f)},writeString:function(f){f=String(f),this.realloc(4*f.length),this.pos++;var l=this.pos;this.pos=(function(T,z,F){for(var O,H,W=0;W<z.length;W++){if((O=z.charCodeAt(W))>55295&&O<57344){if(!H){O>56319||W+1===z.length?(T[F++]=239,T[F++]=191,T[F++]=189):H=O;continue}if(O<56320){T[F++]=239,T[F++]=191,T[F++]=189,H=O;continue}O=H-55296<<10|O-56320|65536,H=null}else H&&(T[F++]=239,T[F++]=191,T[F++]=189,H=null);O<128?T[F++]=O:(O<2048?T[F++]=O>>6|192:(O<65536?T[F++]=O>>12|224:(T[F++]=O>>18|240,T[F++]=O>>12&63|128),T[F++]=O>>6&63|128),T[F++]=63&O|128)}return F})(this.buf,f,this.pos);var g=this.pos-l;g>=128&&K(l,g,this),this.pos=l-1,this.writeVarint(g),this.pos+=g},writeFloat:function(f){this.realloc(4),y(this.buf,f,this.pos,!0,23,4),this.pos+=4},writeDouble:function(f){this.realloc(8),y(this.buf,f,this.pos,!0,52,8),this.pos+=8},writeBytes:function(f){var l=f.length;this.writeVarint(l),this.realloc(l);for(var g=0;g<l;g++)this.buf[this.pos++]=f[g]},writeRawMessage:function(f,l){this.pos++;var g=this.pos;f(l,this);var T=this.pos-g;T>=128&&K(g,T,this),this.pos=g-1,this.writeVarint(T),this.pos+=T},writeMessage:function(f,l,g){this.writeTag(f,b.Bytes),this.writeRawMessage(l,g)},writePackedVarint:function(f,l){l.length&&this.writeMessage(f,X,l)},writePackedSVarint:function(f,l){l.length&&this.writeMessage(f,Q,l)},writePackedBoolean:function(f,l){l.length&&this.writeMessage(f,ge,l)},writePackedFloat:function(f,l){l.length&&this.writeMessage(f,ae,l)},writePackedDouble:function(f,l){l.length&&this.writeMessage(f,ie,l)},writePackedFixed32:function(f,l){l.length&&this.writeMessage(f,me,l)},writePackedSFixed32:function(f,l){l.length&&this.writeMessage(f,Se,l)},writePackedFixed64:function(f,l){l.length&&this.writeMessage(f,De,l)},writePackedSFixed64:function(f,l){l.length&&this.writeMessage(f,Ee,l)},writeBytesField:function(f,l){this.writeTag(f,b.Bytes),this.writeBytes(l)},writeFixed32Field:function(f,l){this.writeTag(f,b.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(f,l){this.writeTag(f,b.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(f,l){this.writeTag(f,b.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(f,l){this.writeTag(f,b.Fixed64),this.writeSFixed64(l)},writeVarintField:function(f,l){this.writeTag(f,b.Varint),this.writeVarint(l)},writeSVarintField:function(f,l){this.writeTag(f,b.Varint),this.writeSVarint(l)},writeStringField:function(f,l){this.writeTag(f,b.Bytes),this.writeString(l)},writeFloatField:function(f,l){this.writeTag(f,b.Fixed32),this.writeFloat(l)},writeDoubleField:function(f,l){this.writeTag(f,b.Fixed64),this.writeDouble(l)},writeBooleanField:function(f,l){this.writeVarintField(f,!!l)}};var Ne=ke(a);const Oe=3;function nt(f,l,g){f===1&&g.readMessage(mt,l)}function mt(f,l,g){if(f===3){const{id:T,bitmap:z,width:F,height:O,left:H,top:W,advance:re}=g.readMessage(dt,{});l.push({id:T,bitmap:new xc({width:F+2*Oe,height:O+2*Oe},z),metrics:{width:F,height:O,left:H,top:W,advance:re}})}}function dt(f,l,g){f===1?l.id=g.readVarint():f===2?l.bitmap=g.readBytes():f===3?l.width=g.readVarint():f===4?l.height=g.readVarint():f===5?l.left=g.readSVarint():f===6?l.top=g.readSVarint():f===7&&(l.advance=g.readVarint())}const At=Oe;function Ct(f){let l=0,g=0;for(const O of f)l+=O.w*O.h,g=Math.max(g,O.w);f.sort(((O,H)=>H.h-O.h));const T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),g),h:1/0}];let z=0,F=0;for(const O of f)for(let H=T.length-1;H>=0;H--){const W=T[H];if(!(O.w>W.w||O.h>W.h)){if(O.x=W.x,O.y=W.y,F=Math.max(F,O.y+O.h),z=Math.max(z,O.x+O.w),O.w===W.w&&O.h===W.h){const re=T.pop();H<T.length&&(T[H]=re)}else O.h===W.h?(W.x+=O.w,W.w-=O.w):O.w===W.w?(W.y+=O.h,W.h-=O.h):(T.push({x:W.x+O.w,y:W.y,w:W.w-O.w,h:O.h}),W.y+=O.h,W.h-=O.h);break}}return{w:z,h:F,fill:l/(z*F)||0}}const Dt=1;class Kt{constructor(l,{pixelRatio:g,version:T,stretchX:z,stretchY:F,content:O,textFitWidth:H,textFitHeight:W}){this.paddedRect=l,this.pixelRatio=g,this.stretchX=z,this.stretchY=F,this.content=O,this.version=T,this.textFitWidth=H,this.textFitHeight=W}get tl(){return[this.paddedRect.x+Dt,this.paddedRect.y+Dt]}get br(){return[this.paddedRect.x+this.paddedRect.w-Dt,this.paddedRect.y+this.paddedRect.h-Dt]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Dt)/this.pixelRatio,(this.paddedRect.h-2*Dt)/this.pixelRatio]}}class vt{constructor(l,g){const T={},z={};this.haveRenderCallbacks=[];const F=[];this.addImages(l,T,F),this.addImages(g,z,F);const{w:O,h:H}=Ct(F),W=new xo({width:O||1,height:H||1});for(const re in l){const pe=l[re],ve=T[re].paddedRect;xo.copy(pe.data,W,{x:0,y:0},{x:ve.x+Dt,y:ve.y+Dt},pe.data)}for(const re in g){const pe=g[re],ve=z[re].paddedRect,Me=ve.x+Dt,Le=ve.y+Dt,qe=pe.data.width,Je=pe.data.height;xo.copy(pe.data,W,{x:0,y:0},{x:Me,y:Le},pe.data),xo.copy(pe.data,W,{x:0,y:Je-1},{x:Me,y:Le-1},{width:qe,height:1}),xo.copy(pe.data,W,{x:0,y:0},{x:Me,y:Le+Je},{width:qe,height:1}),xo.copy(pe.data,W,{x:qe-1,y:0},{x:Me-1,y:Le},{width:1,height:Je}),xo.copy(pe.data,W,{x:0,y:0},{x:Me+qe,y:Le},{width:1,height:Je})}this.image=W,this.iconPositions=T,this.patternPositions=z}addImages(l,g,T){for(const z in l){const F=l[z],O={x:0,y:0,w:F.data.width+2*Dt,h:F.data.height+2*Dt};T.push(O),g[z]=new Kt(O,F),F.hasRenderCallback&&this.haveRenderCallbacks.push(z)}}patchUpdatedImages(l,g){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const T in l.updatedImages)this.patchUpdatedImage(this.iconPositions[T],l.getImage(T),g),this.patchUpdatedImage(this.patternPositions[T],l.getImage(T),g)}patchUpdatedImage(l,g,T){if(!l||!g||l.version===g.version)return;l.version=g.version;const[z,F]=l.tl;T.update(g.data,void 0,{x:z,y:F})}}var rt;dn("ImagePosition",Kt),dn("ImageAtlas",vt),se.ah=void 0,(rt=se.ah||(se.ah={}))[rt.none=0]="none",rt[rt.horizontal=1]="horizontal",rt[rt.vertical=2]="vertical",rt[rt.horizontalOnly=3]="horizontalOnly";const Nt=-17;class Lt{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,g){const T=new Lt;return T.scale=l||1,T.fontStack=g,T}static forImage(l){const g=new Lt;return g.imageName=l,g}}class li{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,g){const T=new li;for(let z=0;z<l.sections.length;z++){const F=l.sections[z];F.image?T.addImageSection(F):T.addTextSection(F,g)}return T}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=(function(l){let g="";for(let T=0;T<l.length;T++){const z=l.charCodeAt(T+1)||null,F=l.charCodeAt(T-1)||null;g+=z&&uh(z)&&!h[l[T+1]]||F&&uh(F)&&!h[l[T-1]]||!h[l[T]]?l[T]:h[l[T]]}return g})(this.text)}trim(){let l=0;for(let T=0;T<this.text.length&&ki[this.text.charCodeAt(T)];T++)l++;let g=this.text.length;for(let T=this.text.length-1;T>=0&&T>=l&&ki[this.text.charCodeAt(T)];T--)g--;this.text=this.text.substring(l,g),this.sectionIndex=this.sectionIndex.slice(l,g)}substring(l,g){const T=new li;return T.text=this.text.substring(l,g),T.sectionIndex=this.sectionIndex.slice(l,g),T.sections=this.sections,T}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((l,g)=>Math.max(l,this.sections[g].scale)),0)}addTextSection(l,g){this.text+=l.text,this.sections.push(Lt.forText(l.scale,l.fontStack||g));const T=this.sections.length-1;for(let z=0;z<l.text.length;++z)this.sectionIndex.push(T)}addImageSection(l){const g=l.image?l.image.name:"";if(g.length===0)return void Wi("Can't add FormattedSection with an empty image.");const T=this.getNextImageSectionCharCode();T?(this.text+=String.fromCharCode(T),this.sections.push(Lt.forImage(g)),this.sectionIndex.push(this.sections.length-1)):Wi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Mi(f,l,g,T,z,F,O,H,W,re,pe,ve,Me,Le,qe){const Je=li.fromFeature(f,z);let xt;ve===se.ah.vertical&&Je.verticalizePunctuation();const{processBidirectionalText:zt,processStyledBidirectionalText:ai}=Yo;if(zt&&Je.sections.length===1){xt=[];const Fi=zt(Je.toString(),ar(Je,re,F,l,T,Le));for(const gn of Fi){const Xn=new li;Xn.text=gn,Xn.sections=Je.sections;for(let Rr=0;Rr<gn.length;Rr++)Xn.sectionIndex.push(0);xt.push(Xn)}}else if(ai){xt=[];const Fi=ai(Je.text,Je.sectionIndex,ar(Je,re,F,l,T,Le));for(const gn of Fi){const Xn=new li;Xn.text=gn[0],Xn.sectionIndex=gn[1],Xn.sections=Je.sections,xt.push(Xn)}}else xt=(function(Fi,gn){const Xn=[],Rr=Fi.text;let Bn=0;for(const Mn of gn)Xn.push(Fi.substring(Bn,Mn)),Bn=Mn;return Bn<Rr.length&&Xn.push(Fi.substring(Bn,Rr.length)),Xn})(Je,ar(Je,re,F,l,T,Le));const Vt=[],ii={positionedLines:Vt,text:Je.toString(),top:pe[1],bottom:pe[1],left:pe[0],right:pe[0],writingMode:ve,iconsInText:!1,verticalizable:!1};return(function(Fi,gn,Xn,Rr,Bn,Mn,wr,lr,nr,Zi,or,Tr){let aa=0,vs=Nt,ro=0,Tl=0;const Bc=lr==="right"?1:lr==="left"?0:.5;let nc=0;for(const nl of Bn){nl.trim();const rc=nl.getMaxScale(),iu=(rc-1)*t,Sc={positionedGlyphs:[],lineOffset:0};Fi.positionedLines[nc]=Sc;const Hl=Sc.positionedGlyphs;let Sl=0;if(!nl.length()){vs+=Mn,++nc;continue}for(let Ju=0;Ju<nl.length();Ju++){const os=nl.getSection(Ju),Bs=nl.getSectionIndex(Ju),To=nl.getCharCode(Ju);let Nc=0,So=null,Zf=null,Qu=null,wh=t;const Th=!(nr===se.ah.horizontal||!or&&!ch(To)||or&&(ki[To]||(Gl=To,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(Gl)))));if(os.imageName){const Wh=Rr[os.imageName];if(!Wh)continue;Qu=os.imageName,Fi.iconsInText=Fi.iconsInText||!0,Zf=Wh.paddedRect;const El=Wh.displaySize;os.scale=os.scale*t/Tr,So={width:El[0],height:El[1],left:Dt,top:-At,advance:Th?El[1]:El[0]},Nc=iu+(t-El[1]*os.scale),wh=So.advance;const Tf=Th?El[0]*os.scale-t*rc:El[1]*os.scale-t*rc;Tf>0&&Tf>Sl&&(Sl=Tf)}else{const Wh=Xn[os.fontStack],El=Wh&&Wh[To];if(El&&El.rect)Zf=El.rect,So=El.metrics;else{const Tf=gn[os.fontStack],bp=Tf&&Tf[To];if(!bp)continue;So=bp.metrics}Nc=(rc-os.scale)*t}Th?(Fi.verticalizable=!0,Hl.push({glyph:To,imageName:Qu,x:aa,y:vs+Nc,vertical:Th,scale:os.scale,fontStack:os.fontStack,sectionIndex:Bs,metrics:So,rect:Zf}),aa+=wh*os.scale+Zi):(Hl.push({glyph:To,imageName:Qu,x:aa,y:vs+Nc,vertical:Th,scale:os.scale,fontStack:os.fontStack,sectionIndex:Bs,metrics:So,rect:Zf}),aa+=So.advance*os.scale+Zi)}Hl.length!==0&&(ro=Math.max(aa-Zi,ro),Ea(Hl,0,Hl.length-1,Bc,Sl)),aa=0;const bh=Mn*rc+Sl;Sc.lineOffset=Math.max(Sl,iu),vs+=bh,Tl=Math.max(bh,Tl),++nc}var Gl;const tu=vs-Nt,{horizontalAlign:Tc,verticalAlign:il}=jr(wr);(function(nl,rc,iu,Sc,Hl,Sl,bh,Ju,os){const Bs=(rc-iu)*Hl;let To=0;To=Sl!==bh?-Ju*Sc-Nt:(-Sc*os+.5)*bh;for(const Nc of nl)for(const So of Nc.positionedGlyphs)So.x+=Bs,So.y+=To})(Fi.positionedLines,Bc,Tc,il,ro,Tl,Mn,tu,Bn.length),Fi.top+=-il*tu,Fi.bottom=Fi.top+tu,Fi.left+=-Tc*ro,Fi.right=Fi.left+ro})(ii,l,g,T,xt,O,H,W,ve,re,Me,qe),!(function(Fi){for(const gn of Fi)if(gn.positionedGlyphs.length!==0)return!1;return!0})(Vt)&&ii}const ki={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ei={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},_i={40:!0};function fn(f,l,g,T,z,F){if(l.imageName){const O=T[l.imageName];return O?O.displaySize[0]*l.scale*t/F+z:0}{const O=g[l.fontStack],H=O&&O[f];return H?H.metrics.advance*l.scale+z:0}}function nn(f,l,g,T){const z=Math.pow(f-l,2);return T?f<l?z/2:2*z:z+Math.abs(g)*g}function $i(f,l,g){let T=0;return f===10&&(T-=1e4),g&&(T+=150),f!==40&&f!==65288||(T+=50),l!==41&&l!==65289||(T+=50),T}function en(f,l,g,T,z,F){let O=null,H=nn(l,g,z,F);for(const W of T){const re=nn(l-W.x,g,z,F)+W.badness;re<=H&&(O=W,H=re)}return{index:f,x:l,priorBreak:O,badness:H}}function bn(f){return f?bn(f.priorBreak).concat(f.index):[]}function ar(f,l,g,T,z,F){if(!f)return[];const O=[],H=(function(ve,Me,Le,qe,Je,xt){let zt=0;for(let ai=0;ai<ve.length();ai++){const Vt=ve.getSection(ai);zt+=fn(ve.getCharCode(ai),Vt,qe,Je,Me,xt)}return zt/Math.max(1,Math.ceil(zt/Le))})(f,l,g,T,z,F),W=f.text.indexOf("")>=0;let re=0;for(let ve=0;ve<f.length();ve++){const Me=f.getSection(ve),Le=f.getCharCode(ve);if(ki[Le]||(re+=fn(Le,Me,T,z,l,F)),ve<f.length()-1){const qe=!((pe=Le)<11904)&&(!!Ra["CJK Compatibility Forms"](pe)||!!Ra["CJK Compatibility"](pe)||!!Ra["CJK Strokes"](pe)||!!Ra["CJK Symbols and Punctuation"](pe)||!!Ra["Enclosed CJK Letters and Months"](pe)||!!Ra["Halfwidth and Fullwidth Forms"](pe)||!!Ra["Ideographic Description Characters"](pe)||!!Ra["Vertical Forms"](pe)||ju.test(String.fromCodePoint(pe)));(Ei[Le]||qe||Me.imageName||ve!==f.length()-2&&_i[f.getCharCode(ve+1)])&&O.push(en(ve+1,re,H,O,$i(Le,f.getCharCode(ve+1),qe&&W),!1))}}var pe;return bn(en(f.length(),re,H,O,0,!0))}function jr(f){let l=.5,g=.5;switch(f){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:l,verticalAlign:g}}function Ea(f,l,g,T,z){if(!T&&!z)return;const F=f[g],O=(f[g].x+F.metrics.advance*F.scale)*T;for(let H=l;H<=g;H++)f[H].x-=O,f[H].y+=z}function _n(f,l,g){const{horizontalAlign:T,verticalAlign:z}=jr(g),F=l[0]-f.displaySize[0]*T,O=l[1]-f.displaySize[1]*z;return{image:f,top:O,bottom:O+f.displaySize[1],left:F,right:F+f.displaySize[0]}}function ca(f){var l,g;let T=f.left,z=f.top,F=f.right-T,O=f.bottom-z;const H=(l=f.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",W=(g=f.image.textFitHeight)!==null&&g!==void 0?g:"stretchOrShrink",re=(f.image.content[2]-f.image.content[0])/(f.image.content[3]-f.image.content[1]);if(W==="proportional"){if(H==="stretchOnly"&&F/O<re||H==="proportional"){const pe=Math.ceil(O*re);T*=pe/F,F=pe}}else if(H==="proportional"&&W==="stretchOnly"&&re!==0&&F/O>re){const pe=Math.ceil(F/re);z*=pe/O,O=pe}return{x1:T,y1:z,x2:T+F,y2:z+O}}function Jn(f,l,g,T,z,F){const O=f.image;let H;if(O.content){const xt=O.content,zt=O.pixelRatio||1;H=[xt[0]/zt,xt[1]/zt,O.displaySize[0]-xt[2]/zt,O.displaySize[1]-xt[3]/zt]}const W=l.left*F,re=l.right*F;let pe,ve,Me,Le;g==="width"||g==="both"?(Le=z[0]+W-T[3],ve=z[0]+re+T[1]):(Le=z[0]+(W+re-O.displaySize[0])/2,ve=Le+O.displaySize[0]);const qe=l.top*F,Je=l.bottom*F;return g==="height"||g==="both"?(pe=z[1]+qe-T[0],Me=z[1]+Je+T[2]):(pe=z[1]+(qe+Je-O.displaySize[1])/2,Me=pe+O.displaySize[1]),{image:O,top:pe,right:ve,bottom:Me,left:Le,collisionPadding:H}}const xr=255,Zr=128,ta=xr*Zr;function Wr(f,l){const{expression:g}=l;if(g.kind==="constant")return{kind:"constant",layoutSize:g.evaluate(new Ba(f+1))};if(g.kind==="source")return{kind:"source"};{const{zoomStops:T,interpolationType:z}=g;let F=0;for(;F<T.length&&T[F]<=f;)F++;F=Math.max(0,F-1);let O=F;for(;O<T.length&&T[O]<f+1;)O++;O=Math.min(T.length-1,O);const H=T[F],W=T[O];return g.kind==="composite"?{kind:"composite",minZoom:H,maxZoom:W,interpolationType:z}:{kind:"camera",minZoom:H,maxZoom:W,minSize:g.evaluate(new Ba(H)),maxSize:g.evaluate(new Ba(W)),interpolationType:z}}}function _r(f,l,g){let T="never";const z=f.get(l);return z?T=z:f.get(g)&&(T="always"),T}const Aa=ph.VectorTileFeature.types,Hs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Za(f,l,g,T,z,F,O,H,W,re,pe,ve,Me){const Le=H?Math.min(ta,Math.round(H[0])):0,qe=H?Math.min(ta,Math.round(H[1])):0;f.emplaceBack(l,g,Math.round(32*T),Math.round(32*z),F,O,(Le<<1)+(W?1:0),qe,16*re,16*pe,256*ve,256*Me)}function ba(f,l,g){f.emplaceBack(l.x,l.y,g),f.emplaceBack(l.x,l.y,g),f.emplaceBack(l.x,l.y,g),f.emplaceBack(l.x,l.y,g)}function zr(f){for(const l of f.sections)if(ef(l.text))return!0;return!1}class yr{constructor(l){this.layoutVertexArray=new xu,this.indexArray=new Ko,this.programConfigurations=l,this.segments=new ja,this.dynamicLayoutVertexArray=new Nl,this.opacityVertexArray=new hi,this.hasVisibleVertices=!1,this.placedSymbolArray=new is}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,g,T,z){this.isEmpty()||(T&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,yp.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,g),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,Em.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,Hs,!0),this.opacityVertexBuffer.itemSize=1),(T||z)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}dn("SymbolBuffers",yr);class ga{constructor(l,g,T){this.layoutVertexArray=new l,this.layoutAttributes=g,this.indexArray=new T,this.segments=new ja,this.collisionVertexArray=new gs}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,Wu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}dn("CollisionBuffers",ga);class As{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((O=>O.id)),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=cf([]),this.placementViewportMatrix=cf([]);const g=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Wr(this.zoom,g["text-size"]),this.iconSizeData=Wr(this.zoom,g["icon-size"]);const T=this.layers[0].layout,z=T.get("symbol-sort-key"),F=T.get("symbol-z-order");this.canOverlap=_r(T,"text-overlap","text-allow-overlap")!=="never"||_r(T,"icon-overlap","icon-allow-overlap")!=="never"||T.get("text-ignore-placement")||T.get("icon-ignore-placement"),this.sortFeaturesByKey=F!=="viewport-y"&&!z.isConstant(),this.sortFeaturesByY=(F==="viewport-y"||F==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,T.get("symbol-placement")==="point"&&(this.writingModes=T.get("text-writing-mode").map((O=>se.ah[O]))),this.stateDependentLayerIds=this.layers.filter((O=>O.isStateDependent())).map((O=>O.id)),this.sourceID=l.sourceID}createArrays(){this.text=new yr(new bi(this.layers,this.zoom,(l=>/^text/.test(l)))),this.icon=new yr(new bi(this.layers,this.zoom,(l=>/^icon/.test(l)))),this.glyphOffsetArray=new Vs,this.lineVertexArray=new sl,this.symbolInstances=new Ya,this.textAnchorOffsets=new Us}calculateGlyphDependencies(l,g,T,z,F){for(let O=0;O<l.length;O++)if(g[l.charCodeAt(O)]=!0,(T||z)&&F){const H=h[l.charAt(O)];H&&(g[H.charCodeAt(0)]=!0)}}populate(l,g,T){const z=this.layers[0],F=z.layout,O=F.get("text-font"),H=F.get("text-field"),W=F.get("icon-image"),re=(H.value.kind!=="constant"||H.value.value instanceof $n&&!H.value.value.isEmpty()||H.value.value.toString().length>0)&&(O.value.kind!=="constant"||O.value.value.length>0),pe=W.value.kind!=="constant"||!!W.value.value||Object.keys(W.parameters).length>0,ve=F.get("symbol-sort-key");if(this.features=[],!re&&!pe)return;const Me=g.iconDependencies,Le=g.glyphDependencies,qe=g.availableImages,Je=new Ba(this.zoom);for(const{feature:xt,id:zt,index:ai,sourceLayerIndex:Vt}of l){const ii=z._featureFilter.needGeometry,Fi=yc(xt,ii);if(!z._featureFilter.filter(Je,Fi,T))continue;let gn,Xn;if(ii||(Fi.geometry=Uh(xt)),re){const Bn=z.getValueAndResolveTokens("text-field",Fi,T,qe),Mn=$n.factory(Bn),wr=this.hasRTLText=this.hasRTLText||zr(Mn);(!wr||Yo.getRTLTextPluginStatus()==="unavailable"||wr&&Yo.isParsed())&&(gn=Eu(Mn,z,Fi))}if(pe){const Bn=z.getValueAndResolveTokens("icon-image",Fi,T,qe);Xn=Bn instanceof ts?Bn:ts.fromString(Bn)}if(!gn&&!Xn)continue;const Rr=this.sortFeaturesByKey?ve.evaluate(Fi,{},T):void 0;if(this.features.push({id:zt,text:gn,icon:Xn,index:ai,sourceLayerIndex:Vt,geometry:Fi.geometry,properties:xt.properties,type:Aa[xt.type],sortKey:Rr}),Xn&&(Me[Xn.name]=!0),gn){const Bn=O.evaluate(Fi,{},T).join(","),Mn=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(se.ah.vertical)>=0;for(const wr of gn.sections)if(wr.image)Me[wr.image.name]=!0;else{const lr=Xc(gn.toString()),nr=wr.fontStack||Bn,Zi=Le[nr]=Le[nr]||{};this.calculateGlyphDependencies(wr.text,Zi,Mn,this.allowVerticalPlacement,lr)}}}F.get("symbol-placement")==="line"&&(this.features=(function(xt){const zt={},ai={},Vt=[];let ii=0;function Fi(Bn){Vt.push(xt[Bn]),ii++}function gn(Bn,Mn,wr){const lr=ai[Bn];return delete ai[Bn],ai[Mn]=lr,Vt[lr].geometry[0].pop(),Vt[lr].geometry[0]=Vt[lr].geometry[0].concat(wr[0]),lr}function Xn(Bn,Mn,wr){const lr=zt[Mn];return delete zt[Mn],zt[Bn]=lr,Vt[lr].geometry[0].shift(),Vt[lr].geometry[0]=wr[0].concat(Vt[lr].geometry[0]),lr}function Rr(Bn,Mn,wr){const lr=wr?Mn[0][Mn[0].length-1]:Mn[0][0];return`${Bn}:${lr.x}:${lr.y}`}for(let Bn=0;Bn<xt.length;Bn++){const Mn=xt[Bn],wr=Mn.geometry,lr=Mn.text?Mn.text.toString():null;if(!lr){Fi(Bn);continue}const nr=Rr(lr,wr),Zi=Rr(lr,wr,!0);if(nr in ai&&Zi in zt&&ai[nr]!==zt[Zi]){const or=Xn(nr,Zi,wr),Tr=gn(nr,Zi,Vt[or].geometry);delete zt[nr],delete ai[Zi],ai[Rr(lr,Vt[Tr].geometry,!0)]=Tr,Vt[or].geometry=null}else nr in ai?gn(nr,Zi,wr):Zi in zt?Xn(nr,Zi,wr):(Fi(Bn),zt[nr]=ii-1,ai[Zi]=ii-1)}return Vt.filter((Bn=>Bn.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((xt,zt)=>xt.sortKey-zt.sortKey))}update(l,g,T){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,g,this.layers,T),this.icon.programConfigurations.updatePaintArrays(l,g,this.layers,T))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,g){const T=this.lineVertexArray.length;if(l.segment!==void 0){let z=l.dist(g[l.segment+1]),F=l.dist(g[l.segment]);const O={};for(let H=l.segment+1;H<g.length;H++)O[H]={x:g[H].x,y:g[H].y,tileUnitDistanceFromAnchor:z},H<g.length-1&&(z+=g[H+1].dist(g[H]));for(let H=l.segment||0;H>=0;H--)O[H]={x:g[H].x,y:g[H].y,tileUnitDistanceFromAnchor:F},H>0&&(F+=g[H-1].dist(g[H]));for(let H=0;H<g.length;H++){const W=O[H];this.lineVertexArray.emplaceBack(W.x,W.y,W.tileUnitDistanceFromAnchor)}}return{lineStartIndex:T,lineLength:this.lineVertexArray.length-T}}addSymbols(l,g,T,z,F,O,H,W,re,pe,ve,Me){const Le=l.indexArray,qe=l.layoutVertexArray,Je=l.segments.prepareSegment(4*g.length,qe,Le,this.canOverlap?O.sortKey:void 0),xt=this.glyphOffsetArray.length,zt=Je.vertexLength,ai=this.allowVerticalPlacement&&H===se.ah.vertical?Math.PI/2:0,Vt=O.text&&O.text.sections;for(let ii=0;ii<g.length;ii++){const{tl:Fi,tr:gn,bl:Xn,br:Rr,tex:Bn,pixelOffsetTL:Mn,pixelOffsetBR:wr,minFontScaleX:lr,minFontScaleY:nr,glyphOffset:Zi,isSDF:or,sectionIndex:Tr}=g[ii],aa=Je.vertexLength,vs=Zi[1];Za(qe,W.x,W.y,Fi.x,vs+Fi.y,Bn.x,Bn.y,T,or,Mn.x,Mn.y,lr,nr),Za(qe,W.x,W.y,gn.x,vs+gn.y,Bn.x+Bn.w,Bn.y,T,or,wr.x,Mn.y,lr,nr),Za(qe,W.x,W.y,Xn.x,vs+Xn.y,Bn.x,Bn.y+Bn.h,T,or,Mn.x,wr.y,lr,nr),Za(qe,W.x,W.y,Rr.x,vs+Rr.y,Bn.x+Bn.w,Bn.y+Bn.h,T,or,wr.x,wr.y,lr,nr),ba(l.dynamicLayoutVertexArray,W,ai),Le.emplaceBack(aa,aa+1,aa+2),Le.emplaceBack(aa+1,aa+2,aa+3),Je.vertexLength+=4,Je.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zi[0]),ii!==g.length-1&&Tr===g[ii+1].sectionIndex||l.programConfigurations.populatePaintArrays(qe.length,O,O.index,{},Me,Vt&&Vt[Tr])}l.placedSymbolArray.emplaceBack(W.x,W.y,xt,this.glyphOffsetArray.length-xt,zt,re,pe,W.segment,T?T[0]:0,T?T[1]:0,z[0],z[1],H,0,!1,0,ve)}_addCollisionDebugVertex(l,g,T,z,F,O){return g.emplaceBack(0,0),l.emplaceBack(T.x,T.y,z,F,Math.round(O.x),Math.round(O.y))}addCollisionDebugVertices(l,g,T,z,F,O,H){const W=F.segments.prepareSegment(4,F.layoutVertexArray,F.indexArray),re=W.vertexLength,pe=F.layoutVertexArray,ve=F.collisionVertexArray,Me=H.anchorX,Le=H.anchorY;this._addCollisionDebugVertex(pe,ve,O,Me,Le,new it(l,g)),this._addCollisionDebugVertex(pe,ve,O,Me,Le,new it(T,g)),this._addCollisionDebugVertex(pe,ve,O,Me,Le,new it(T,z)),this._addCollisionDebugVertex(pe,ve,O,Me,Le,new it(l,z)),W.vertexLength+=4;const qe=F.indexArray;qe.emplaceBack(re,re+1),qe.emplaceBack(re+1,re+2),qe.emplaceBack(re+2,re+3),qe.emplaceBack(re+3,re),W.primitiveLength+=4}addDebugCollisionBoxes(l,g,T,z){for(let F=l;F<g;F++){const O=this.collisionBoxArray.get(F);this.addCollisionDebugVertices(O.x1,O.y1,O.x2,O.y2,z?this.textCollisionBox:this.iconCollisionBox,O.anchorPoint,T)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ga(Na,Es.members,pn),this.iconCollisionBox=new ga(Na,Es.members,pn);for(let l=0;l<this.symbolInstances.length;l++){const g=this.symbolInstances.get(l);this.addDebugCollisionBoxes(g.textBoxStartIndex,g.textBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.iconBoxStartIndex,g.iconBoxEndIndex,g,!1),this.addDebugCollisionBoxes(g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g,!1)}}_deserializeCollisionBoxesForSymbol(l,g,T,z,F,O,H,W,re){const pe={};for(let ve=g;ve<T;ve++){const Me=l.get(ve);pe.textBox={x1:Me.x1,y1:Me.y1,x2:Me.x2,y2:Me.y2,anchorPointX:Me.anchorPointX,anchorPointY:Me.anchorPointY},pe.textFeatureIndex=Me.featureIndex;break}for(let ve=z;ve<F;ve++){const Me=l.get(ve);pe.verticalTextBox={x1:Me.x1,y1:Me.y1,x2:Me.x2,y2:Me.y2,anchorPointX:Me.anchorPointX,anchorPointY:Me.anchorPointY},pe.verticalTextFeatureIndex=Me.featureIndex;break}for(let ve=O;ve<H;ve++){const Me=l.get(ve);pe.iconBox={x1:Me.x1,y1:Me.y1,x2:Me.x2,y2:Me.y2,anchorPointX:Me.anchorPointX,anchorPointY:Me.anchorPointY},pe.iconFeatureIndex=Me.featureIndex;break}for(let ve=W;ve<re;ve++){const Me=l.get(ve);pe.verticalIconBox={x1:Me.x1,y1:Me.y1,x2:Me.x2,y2:Me.y2,anchorPointX:Me.anchorPointX,anchorPointY:Me.anchorPointY},pe.verticalIconFeatureIndex=Me.featureIndex;break}return pe}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let g=0;g<this.symbolInstances.length;g++){const T=this.symbolInstances.get(g);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,T.textBoxStartIndex,T.textBoxEndIndex,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T.iconBoxStartIndex,T.iconBoxEndIndex,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,g){const T=l.placedSymbolArray.get(g),z=T.vertexStartIndex+4*T.numGlyphs;for(let F=T.vertexStartIndex;F<z;F+=4)l.indexArray.emplaceBack(F,F+1,F+2),l.indexArray.emplaceBack(F+1,F+2,F+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const g=Math.sin(l),T=Math.cos(l),z=[],F=[],O=[];for(let H=0;H<this.symbolInstances.length;++H){O.push(H);const W=this.symbolInstances.get(H);z.push(0|Math.round(g*W.anchorX+T*W.anchorY)),F.push(W.featureIndex)}return O.sort(((H,W)=>z[H]-z[W]||F[W]-F[H])),O}addToSortKeyRanges(l,g){const T=this.sortKeyRanges[this.sortKeyRanges.length-1];T&&T.sortKey===g?T.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:g,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const g of this.symbolInstanceIndexes){const T=this.symbolInstances.get(g);this.featureSortOrder.push(T.featureIndex),[T.rightJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.leftJustifiedTextSymbolIndex].forEach(((z,F,O)=>{z>=0&&O.indexOf(z)===F&&this.addIndicesForPlacedSymbol(this.text,z)})),T.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,T.verticalPlacedTextSymbolIndex),T.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.placedIconSymbolIndex),T.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Ms,Wa;dn("SymbolBucket",As,{omit:["layers","collisionBoxArray","features","compareText"]}),As.MAX_GLYPHS=65535,As.addDynamicAttributes=ba;var No={get paint(){return Wa=Wa||new L({"icon-opacity":new Fr($t.paint_symbol["icon-opacity"]),"icon-color":new Fr($t.paint_symbol["icon-color"]),"icon-halo-color":new Fr($t.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fr($t.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fr($t.paint_symbol["icon-halo-blur"]),"icon-translate":new Wn($t.paint_symbol["icon-translate"]),"icon-translate-anchor":new Wn($t.paint_symbol["icon-translate-anchor"]),"text-opacity":new Fr($t.paint_symbol["text-opacity"]),"text-color":new Fr($t.paint_symbol["text-color"],{runtimeType:Xs,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new Fr($t.paint_symbol["text-halo-color"]),"text-halo-width":new Fr($t.paint_symbol["text-halo-width"]),"text-halo-blur":new Fr($t.paint_symbol["text-halo-blur"]),"text-translate":new Wn($t.paint_symbol["text-translate"]),"text-translate-anchor":new Wn($t.paint_symbol["text-translate-anchor"])})},get layout(){return Ms=Ms||new L({"symbol-placement":new Wn($t.layout_symbol["symbol-placement"]),"symbol-spacing":new Wn($t.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Wn($t.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fr($t.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Wn($t.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Wn($t.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Wn($t.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Wn($t.layout_symbol["icon-ignore-placement"]),"icon-optional":new Wn($t.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Wn($t.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fr($t.layout_symbol["icon-size"]),"icon-text-fit":new Wn($t.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Wn($t.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fr($t.layout_symbol["icon-image"]),"icon-rotate":new Fr($t.layout_symbol["icon-rotate"]),"icon-padding":new Fr($t.layout_symbol["icon-padding"]),"icon-keep-upright":new Wn($t.layout_symbol["icon-keep-upright"]),"icon-offset":new Fr($t.layout_symbol["icon-offset"]),"icon-anchor":new Fr($t.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Wn($t.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Wn($t.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Wn($t.layout_symbol["text-rotation-alignment"]),"text-field":new Fr($t.layout_symbol["text-field"]),"text-font":new Fr($t.layout_symbol["text-font"]),"text-size":new Fr($t.layout_symbol["text-size"]),"text-max-width":new Fr($t.layout_symbol["text-max-width"]),"text-line-height":new Wn($t.layout_symbol["text-line-height"]),"text-letter-spacing":new Fr($t.layout_symbol["text-letter-spacing"]),"text-justify":new Fr($t.layout_symbol["text-justify"]),"text-radial-offset":new Fr($t.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Wn($t.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Fr($t.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Fr($t.layout_symbol["text-anchor"]),"text-max-angle":new Wn($t.layout_symbol["text-max-angle"]),"text-writing-mode":new Wn($t.layout_symbol["text-writing-mode"]),"text-rotate":new Fr($t.layout_symbol["text-rotate"]),"text-padding":new Wn($t.layout_symbol["text-padding"]),"text-keep-upright":new Wn($t.layout_symbol["text-keep-upright"]),"text-transform":new Fr($t.layout_symbol["text-transform"]),"text-offset":new Fr($t.layout_symbol["text-offset"]),"text-allow-overlap":new Wn($t.layout_symbol["text-allow-overlap"]),"text-overlap":new Wn($t.layout_symbol["text-overlap"]),"text-ignore-placement":new Wn($t.layout_symbol["text-ignore-placement"]),"text-optional":new Wn($t.layout_symbol["text-optional"])})}};class el{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:ms,this.defaultValue=l}evaluate(l){if(l.formattedSection){const g=this.defaultValue.property.overrides;if(g&&g.hasOverride(l.formattedSection))return g.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}dn("FormatSectionOverride",el,{omit:["defaultValue"]});class ho extends v{constructor(l){super(l,No)}recalculate(l,g){if(super.recalculate(l,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const T=this.layout.get("text-writing-mode");if(T){const z=[];for(const F of T)z.indexOf(F)<0&&z.push(F);this.layout._values["text-writing-mode"]=z}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,g,T,z){const F=this.layout.get(l).evaluate(g,{},T,z),O=this._unevaluatedLayout._values[l];return O.isDataDriven()||Pc(O.value)||!F?F:(function(H,W){return W.replace(/{([^{}]+)}/g,((re,pe)=>H&&pe in H?String(H[pe]):""))})(g.properties,F)}createBucket(l){return new As(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of No.paint.overridableProperties){if(!ho.hasPaintOverride(this.layout,l))continue;const g=this.paint.get(l),T=new el(g),z=new du(T,g.property.specification);let F=null;F=g.value.kind==="constant"||g.value.kind==="source"?new fu("source",z):new Zc("composite",z,g.value.zoomStops),this.paint._values[l]=new fc(g.property,F,g.parameters)}}_handleOverridablePaintPropertyUpdate(l,g,T){return!(!this.layout||g.isDataDriven()||T.isDataDriven())&&ho.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,g){const T=l.get("text-field"),z=No.paint.properties[g];let F=!1;const O=H=>{for(const W of H)if(z.overrides&&z.overrides.hasOverride(W))return void(F=!0)};if(T.value.kind==="constant"&&T.value.value instanceof $n)O(T.value.value.sections);else if(T.value.kind==="source"){const H=re=>{F||(re instanceof _a&&na(re.value)===Uo?O(re.value.sections):re instanceof rh?O(re.sections):re.eachChild(H))},W=T.value;W._styleExpression&&H(W._styleExpression.expression)}return F}}let $o;var Vl={get paint(){return $o=$o||new L({"background-color":new Wn($t.paint_background["background-color"]),"background-pattern":new Vu($t.paint_background["background-pattern"]),"background-opacity":new Wn($t.paint_background["background-opacity"])})}};class dl extends v{constructor(l){super(l,Vl)}}let Qc;var Xu={get paint(){return Qc=Qc||new L({"raster-opacity":new Wn($t.paint_raster["raster-opacity"]),"raster-hue-rotate":new Wn($t.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Wn($t.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Wn($t.paint_raster["raster-brightness-max"]),"raster-saturation":new Wn($t.paint_raster["raster-saturation"]),"raster-contrast":new Wn($t.paint_raster["raster-contrast"]),"raster-resampling":new Wn($t.paint_raster["raster-resampling"]),"raster-fade-duration":new Wn($t.paint_raster["raster-fade-duration"])})}};class tc extends v{constructor(l){super(l,Xu)}}class qs extends v{constructor(l){super(l,{}),this.onAdd=g=>{this.implementation.onAdd&&this.implementation.onAdd(g,g.painter.context.gl)},this.onRemove=g=>{this.implementation.onRemove&&this.implementation.onRemove(g,g.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class fo{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Ua=63710088e-1;class $s{constructor(l,g){if(isNaN(l)||isNaN(g))throw new Error(`Invalid LngLat object: (${l}, ${g})`);if(this.lng=+l,this.lat=+g,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new $s(ln(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const g=Math.PI/180,T=this.lat*g,z=l.lat*g,F=Math.sin(T)*Math.sin(z)+Math.cos(T)*Math.cos(z)*Math.cos((l.lng-this.lng)*g);return Ua*Math.acos(Math.min(F,1))}static convert(l){if(l instanceof $s)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new $s(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new $s(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Os=2*Math.PI*Ua;function Is(f){return Os*Math.cos(f*Math.PI/180)}function ic(f){return(180+f)/360}function jd(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function Yu(f,l){return f/Is(l)}function vf(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}class Zh{constructor(l,g,T=0){this.x=+l,this.y=+g,this.z=+T}static fromLngLat(l,g=0){const T=$s.convert(l);return new Zh(ic(T.lng),jd(T.lat),Yu(g,T.lat))}toLngLat(){return new $s(360*this.x-180,vf(this.y))}toAltitude(){return this.z*Is(vf(this.y))}meterInMercatorCoordinateUnits(){return 1/Os*(l=vf(this.y),1/Math.cos(l*Math.PI/180));var l}}function vh(f,l,g){var T=2*Math.PI*6378137/256/Math.pow(2,g);return[f*T-2*Math.PI*6378137/2,l*T-2*Math.PI*6378137/2]}class xh{constructor(l,g,T){if(!(function(z,F,O){return!(z<0||z>25||O<0||O>=Math.pow(2,z)||F<0||F>=Math.pow(2,z))})(l,g,T))throw new Error(`x=${g}, y=${T}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=g,this.y=T,this.key=Au(0,l,l,g,T)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,g,T){const z=(O=this.y,H=this.z,W=vh(256*(F=this.x),256*(O=Math.pow(2,H)-O-1),H),re=vh(256*(F+1),256*(O+1),H),W[0]+","+W[1]+","+re[0]+","+re[1]);var F,O,H,W,re;const pe=(function(ve,Me,Le){let qe,Je="";for(let xt=ve;xt>0;xt--)qe=1<<xt-1,Je+=(Me&qe?1:0)+(Le&qe?2:0);return Je})(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(T==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,g>1?"@2x":"").replace(/{quadkey}/g,pe).replace(/{bbox-epsg-3857}/g,z)}isChildOf(l){const g=this.z-l.z;return g>0&&l.x===this.x>>g&&l.y===this.y>>g}getTilePoint(l){const g=Math.pow(2,this.z);return new it((l.x*g-this.x)*da,(l.y*g-this.y)*da)}toString(){return`${this.z}/${this.x}/${this.y}`}}class xf{constructor(l,g){this.wrap=l,this.canonical=g,this.key=Au(l,g.z,g.z,g.x,g.y)}}class tl{constructor(l,g,T,z,F){if(l<T)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${T}`);this.overscaledZ=l,this.wrap=g,this.canonical=new xh(T,+z,+F),this.key=Au(g,l,T,z,F)}clone(){return new tl(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-l;return l>this.canonical.z?new tl(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new tl(l,this.wrap,l,this.canonical.x>>g,this.canonical.y>>g)}calculateScaledKey(l,g){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const T=this.canonical.z-l;return l>this.canonical.z?Au(this.wrap*+g,l,this.canonical.z,this.canonical.x,this.canonical.y):Au(this.wrap*+g,l,l,this.canonical.x>>T,this.canonical.y>>T)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const g=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>g&&l.canonical.y===this.canonical.y>>g}children(l){if(this.overscaledZ>=l)return[new tl(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const g=this.canonical.z+1,T=2*this.canonical.x,z=2*this.canonical.y;return[new tl(g,this.wrap,g,T,z),new tl(g,this.wrap,g,T+1,z),new tl(g,this.wrap,g,T,z+1),new tl(g,this.wrap,g,T+1,z+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new tl(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new tl(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new xf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new Zh(l.x-this.wrap,l.y))}}function Au(f,l,g,T,z){(f*=2)<0&&(f=-1*f-1);const F=1<<g;return(F*F*f+F*z+T).toString(36)+g.toString(36)+l.toString(36)}dn("CanonicalTileID",xh),dn("OverscaledTileID",tl,{omit:["posMatrix"]});class Ku{constructor(l,g,T,z=1,F=1,O=1,H=0){if(this.uid=l,g.height!==g.width)throw new RangeError("DEM tiles must be square");if(T&&!["mapbox","terrarium","custom"].includes(T))return void Wi(`"${T}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=g.height;const W=this.dim=g.height-2;switch(this.data=new Uint32Array(g.data.buffer),T){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=z,this.greenFactor=F,this.blueFactor=O,this.baseShift=H;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let re=0;re<W;re++)this.data[this._idx(-1,re)]=this.data[this._idx(0,re)],this.data[this._idx(W,re)]=this.data[this._idx(W-1,re)],this.data[this._idx(re,-1)]=this.data[this._idx(re,0)],this.data[this._idx(re,W)]=this.data[this._idx(re,W-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(W,-1)]=this.data[this._idx(W-1,0)],this.data[this._idx(-1,W)]=this.data[this._idx(0,W-1)],this.data[this._idx(W,W)]=this.data[this._idx(W-1,W-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let re=0;re<W;re++)for(let pe=0;pe<W;pe++){const ve=this.get(re,pe);ve>this.max&&(this.max=ve),ve<this.min&&(this.min=ve)}}get(l,g){const T=new Uint8Array(this.data.buffer),z=4*this._idx(l,g);return this.unpack(T[z],T[z+1],T[z+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,g){if(l<-1||l>=this.dim+1||g<-1||g>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(g+1)*this.stride+(l+1)}unpack(l,g,T){return l*this.redFactor+g*this.greenFactor+T*this.blueFactor-this.baseShift}getPixels(){return new xo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,g,T){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let z=g*this.dim,F=g*this.dim+this.dim,O=T*this.dim,H=T*this.dim+this.dim;switch(g){case-1:z=F-1;break;case 1:F=z+1}switch(T){case-1:O=H-1;break;case 1:H=O+1}const W=-g*this.dim,re=-T*this.dim;for(let pe=O;pe<H;pe++)for(let ve=z;ve<F;ve++)this.data[this._idx(ve,pe)]=l.data[this._idx(ve+W,pe+re)]}}dn("DEMData",Ku);class ds{constructor(l){this._stringToNumber={},this._numberToString=[];for(let g=0;g<l.length;g++){const T=l[g];this._stringToNumber[T]=g,this._numberToString[g]=T}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class Hm{constructor(l,g,T,z,F){this.type="Feature",this._vectorTileFeature=l,l._z=g,l._x=T,l._y=z,this.properties=l.properties,this.id=F}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const g in this)g!=="_geometry"&&g!=="_vectorTileFeature"&&(l[g]=this[g]);return l}}class I_{constructor(l,g){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new yo(da,16,0),this.grid3D=new yo(da,16,0),this.featureIndexArray=new Gs,this.promoteId=g}insert(l,g,T,z,F,O){const H=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(T,z,F);const W=O?this.grid3D:this.grid;for(let re=0;re<g.length;re++){const pe=g[re],ve=[1/0,1/0,-1/0,-1/0];for(let Me=0;Me<pe.length;Me++){const Le=pe[Me];ve[0]=Math.min(ve[0],Le.x),ve[1]=Math.min(ve[1],Le.y),ve[2]=Math.max(ve[2],Le.x),ve[3]=Math.max(ve[3],Le.y)}ve[0]<da&&ve[1]<da&&ve[2]>=0&&ve[3]>=0&&W.insert(H,ve[0],ve[1],ve[2],ve[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ph.VectorTile(new Ne(this.rawTileData)).layers,this.sourceLayerCoder=new ds(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,g,T,z){this.loadVTLayers();const F=l.params||{},O=da/l.tileSize/l.scale,H=zf(F.filter),W=l.queryGeometry,re=l.queryPadding*O,pe=d_(W),ve=this.grid.query(pe.minX-re,pe.minY-re,pe.maxX+re,pe.maxY+re),Me=d_(l.cameraQueryGeometry),Le=this.grid3D.query(Me.minX-re,Me.minY-re,Me.maxX+re,Me.maxY+re,((xt,zt,ai,Vt)=>(function(ii,Fi,gn,Xn,Rr){for(const Mn of ii)if(Fi<=Mn.x&&gn<=Mn.y&&Xn>=Mn.x&&Rr>=Mn.y)return!0;const Bn=[new it(Fi,gn),new it(Fi,Rr),new it(Xn,Rr),new it(Xn,gn)];if(ii.length>2){for(const Mn of Bn)if(qu(ii,Mn))return!0}for(let Mn=0;Mn<ii.length-1;Mn++)if(lf(ii[Mn],ii[Mn+1],Bn))return!0;return!1})(l.cameraQueryGeometry,xt-re,zt-re,ai+re,Vt+re)));for(const xt of Le)ve.push(xt);ve.sort(qm);const qe={};let Je;for(let xt=0;xt<ve.length;xt++){const zt=ve[xt];if(zt===Je)continue;Je=zt;const ai=this.featureIndexArray.get(zt);let Vt=null;this.loadMatchingFeature(qe,ai.bucketIndex,ai.sourceLayerIndex,ai.featureIndex,H,F.layers,F.availableImages,g,T,z,((ii,Fi,gn)=>(Vt||(Vt=Uh(ii)),Fi.queryIntersectsFeature(W,ii,gn,Vt,this.z,l.transform,O,l.pixelPosMatrix))))}return qe}loadMatchingFeature(l,g,T,z,F,O,H,W,re,pe,ve){const Me=this.bucketLayerIDs[g];if(O&&!(function(xt,zt){for(let ai=0;ai<xt.length;ai++)if(zt.indexOf(xt[ai])>=0)return!0;return!1})(O,Me))return;const Le=this.sourceLayerCoder.decode(T),qe=this.vtLayers[Le].feature(z);if(F.needGeometry){const xt=yc(qe,!0);if(!F.filter(new Ba(this.tileID.overscaledZ),xt,this.tileID.canonical))return}else if(!F.filter(new Ba(this.tileID.overscaledZ),qe))return;const Je=this.getId(qe,Le);for(let xt=0;xt<Me.length;xt++){const zt=Me[xt];if(O&&O.indexOf(zt)<0)continue;const ai=W[zt];if(!ai)continue;let Vt={};Je&&pe&&(Vt=pe.getState(ai.sourceLayer||"_geojsonTileLayer",Je));const ii=mn({},re[zt]);ii.paint=Am(ii.paint,ai.paint,qe,Vt,H),ii.layout=Am(ii.layout,ai.layout,qe,Vt,H);const Fi=!ve||ve(qe,ai,Vt);if(!Fi)continue;const gn=new Hm(qe,this.z,this.x,this.y,Je);gn.layer=ii;let Xn=l[zt];Xn===void 0&&(Xn=l[zt]=[]),Xn.push({featureIndex:z,feature:gn,intersectionZ:Fi})}}lookupSymbolFeatures(l,g,T,z,F,O,H,W){const re={};this.loadVTLayers();const pe=zf(F);for(const ve of l)this.loadMatchingFeature(re,T,z,ve,pe,O,H,W,g);return re}hasLayer(l){for(const g of this.bucketLayerIDs)for(const T of g)if(l===T)return!0;return!1}getId(l,g){let T=l.id;return this.promoteId&&(T=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[g]],typeof T=="boolean"&&(T=Number(T))),T}}function Am(f,l,g,T,z){return Bt(f,((F,O)=>{const H=l instanceof Yc?l.get(O):null;return H&&H.evaluate?H.evaluate(g,T,z):H}))}function d_(f){let l=1/0,g=1/0,T=-1/0,z=-1/0;for(const F of f)l=Math.min(l,F.x),g=Math.min(g,F.y),T=Math.max(T,F.x),z=Math.max(z,F.y);return{minX:l,minY:g,maxX:T,maxY:z}}function qm(f,l){return l-f}function $m(f,l,g,T,z){const F=[];for(let O=0;O<f.length;O++){const H=f[O];let W;for(let re=0;re<H.length-1;re++){let pe=H[re],ve=H[re+1];pe.x<l&&ve.x<l||(pe.x<l?pe=new it(l,pe.y+(l-pe.x)/(ve.x-pe.x)*(ve.y-pe.y))._round():ve.x<l&&(ve=new it(l,pe.y+(l-pe.x)/(ve.x-pe.x)*(ve.y-pe.y))._round()),pe.y<g&&ve.y<g||(pe.y<g?pe=new it(pe.x+(g-pe.y)/(ve.y-pe.y)*(ve.x-pe.x),g)._round():ve.y<g&&(ve=new it(pe.x+(g-pe.y)/(ve.y-pe.y)*(ve.x-pe.x),g)._round()),pe.x>=T&&ve.x>=T||(pe.x>=T?pe=new it(T,pe.y+(T-pe.x)/(ve.x-pe.x)*(ve.y-pe.y))._round():ve.x>=T&&(ve=new it(T,pe.y+(T-pe.x)/(ve.x-pe.x)*(ve.y-pe.y))._round()),pe.y>=z&&ve.y>=z||(pe.y>=z?pe=new it(pe.x+(z-pe.y)/(ve.y-pe.y)*(ve.x-pe.x),z)._round():ve.y>=z&&(ve=new it(pe.x+(z-pe.y)/(ve.y-pe.y)*(ve.x-pe.x),z)._round()),W&&pe.equals(W[W.length-1])||(W=[pe],F.push(W)),W.push(ve)))))}}return F}dn("FeatureIndex",I_,{omit:["rawTileData","sourceLayerCoder"]});class xd extends it{constructor(l,g,T,z){super(l,g),this.angle=T,z!==void 0&&(this.segment=z)}clone(){return new xd(this.x,this.y,this.angle,this.segment)}}function bf(f,l,g,T,z){if(l.segment===void 0||g===0)return!0;let F=l,O=l.segment+1,H=0;for(;H>-g/2;){if(O--,O<0)return!1;H-=f[O].dist(F),F=f[O]}H+=f[O].dist(f[O+1]),O++;const W=[];let re=0;for(;H<g/2;){const pe=f[O],ve=f[O+1];if(!ve)return!1;let Me=f[O-1].angleTo(pe)-pe.angleTo(ve);for(Me=Math.abs((Me+3*Math.PI)%(2*Math.PI)-Math.PI),W.push({distance:H,angleDelta:Me}),re+=Me;H-W[0].distance>T;)re-=W.shift().angleDelta;if(re>z)return!1;O++,H+=pe.dist(ve)}return!0}function Mm(f){let l=0;for(let g=0;g<f.length-1;g++)l+=f[g].dist(f[g+1]);return l}function Zp(f,l,g){return f?.6*l*g:0}function Zm(f,l){return Math.max(f?f.right-f.left:0,l?l.right-l.left:0)}function Hf(f,l,g,T,z,F){const O=Zp(g,z,F),H=Zm(g,T)*F;let W=0;const re=Mm(f)/2;for(let pe=0;pe<f.length-1;pe++){const ve=f[pe],Me=f[pe+1],Le=ve.dist(Me);if(W+Le>re){const qe=(re-W)/Le,Je=ko.number(ve.x,Me.x,qe),xt=ko.number(ve.y,Me.y,qe),zt=new xd(Je,xt,Me.angleTo(ve),pe);return zt._round(),!O||bf(f,zt,H,O,l)?zt:void 0}W+=Le}}function eu(f,l,g,T,z,F,O,H,W){const re=Zp(T,F,O),pe=Zm(T,z),ve=pe*O,Me=f[0].x===0||f[0].x===W||f[0].y===0||f[0].y===W;return l-ve<l/4&&(l=ve+l/4),Wp(f,Me?l/2*H%l:(pe/2+2*F)*O*H%l,l,re,g,ve,Me,!1,W)}function Wp(f,l,g,T,z,F,O,H,W){const re=F/2,pe=Mm(f);let ve=0,Me=l-g,Le=[];for(let qe=0;qe<f.length-1;qe++){const Je=f[qe],xt=f[qe+1],zt=Je.dist(xt),ai=xt.angleTo(Je);for(;Me+g<ve+zt;){Me+=g;const Vt=(Me-ve)/zt,ii=ko.number(Je.x,xt.x,Vt),Fi=ko.number(Je.y,xt.y,Vt);if(ii>=0&&ii<W&&Fi>=0&&Fi<W&&Me-re>=0&&Me+re<=pe){const gn=new xd(ii,Fi,ai,qe);gn._round(),T&&!bf(f,gn,F,T,z)||Le.push(gn)}}ve+=zt}return H||Le.length||O||(Le=Wp(f,ve/2,g,T,z,F,O,!0,W)),Le}dn("Anchor",xd);const vp=Dt;function f_(f,l,g,T){const z=[],F=f.image,O=F.pixelRatio,H=F.paddedRect.w-2*vp,W=F.paddedRect.h-2*vp;let re={x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};const pe=F.stretchX||[[0,H]],ve=F.stretchY||[[0,W]],Me=(Zi,or)=>Zi+or[1]-or[0],Le=pe.reduce(Me,0),qe=ve.reduce(Me,0),Je=H-Le,xt=W-qe;let zt=0,ai=Le,Vt=0,ii=qe,Fi=0,gn=Je,Xn=0,Rr=xt;if(F.content&&T){const Zi=F.content,or=Zi[2]-Zi[0],Tr=Zi[3]-Zi[1];(F.textFitWidth||F.textFitHeight)&&(re=ca(f)),zt=Wm(pe,0,Zi[0]),Vt=Wm(ve,0,Zi[1]),ai=Wm(pe,Zi[0],Zi[2]),ii=Wm(ve,Zi[1],Zi[3]),Fi=Zi[0]-zt,Xn=Zi[1]-Vt,gn=or-ai,Rr=Tr-ii}const Bn=re.x1,Mn=re.y1,wr=re.x2-Bn,lr=re.y2-Mn,nr=(Zi,or,Tr,aa)=>{const vs=Xm(Zi.stretch-zt,ai,wr,Bn),ro=Ym(Zi.fixed-Fi,gn,Zi.stretch,Le),Tl=Xm(or.stretch-Vt,ii,lr,Mn),Bc=Ym(or.fixed-Xn,Rr,or.stretch,qe),nc=Xm(Tr.stretch-zt,ai,wr,Bn),Gl=Ym(Tr.fixed-Fi,gn,Tr.stretch,Le),tu=Xm(aa.stretch-Vt,ii,lr,Mn),Tc=Ym(aa.fixed-Xn,Rr,aa.stretch,qe),il=new it(vs,Tl),nl=new it(nc,Tl),rc=new it(nc,tu),iu=new it(vs,tu),Sc=new it(ro/O,Bc/O),Hl=new it(Gl/O,Tc/O),Sl=l*Math.PI/180;if(Sl){const os=Math.sin(Sl),Bs=Math.cos(Sl),To=[Bs,-os,os,Bs];il._matMult(To),nl._matMult(To),iu._matMult(To),rc._matMult(To)}const bh=Zi.stretch+Zi.fixed,Ju=or.stretch+or.fixed;return{tl:il,tr:nl,bl:iu,br:rc,tex:{x:F.paddedRect.x+vp+bh,y:F.paddedRect.y+vp+Ju,w:Tr.stretch+Tr.fixed-bh,h:aa.stretch+aa.fixed-Ju},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sc,pixelOffsetBR:Hl,minFontScaleX:gn/O/wr,minFontScaleY:Rr/O/lr,isSDF:g}};if(T&&(F.stretchX||F.stretchY)){const Zi=C_(pe,Je,Le),or=C_(ve,xt,qe);for(let Tr=0;Tr<Zi.length-1;Tr++){const aa=Zi[Tr],vs=Zi[Tr+1];for(let ro=0;ro<or.length-1;ro++)z.push(nr(aa,or[ro],vs,or[ro+1]))}}else z.push(nr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:H+1},{fixed:0,stretch:W+1}));return z}function Wm(f,l,g){let T=0;for(const z of f)T+=Math.max(l,Math.min(g,z[1]))-Math.max(l,Math.min(g,z[0]));return T}function C_(f,l,g){const T=[{fixed:-vp,stretch:0}];for(const[z,F]of f){const O=T[T.length-1];T.push({fixed:z-O.stretch,stretch:O.stretch}),T.push({fixed:z-O.stretch,stretch:O.stretch+(F-z)})}return T.push({fixed:l+vp,stretch:g}),T}function Xm(f,l,g,T){return f/l*g+T}function Ym(f,l,g,T){return f-l*g/T}class Xp{constructor(l,g,T,z,F,O,H,W,re,pe){var ve;if(this.boxStartIndex=l.length,re){let Me=O.top,Le=O.bottom;const qe=O.collisionPadding;qe&&(Me-=qe[1],Le+=qe[3]);let Je=Le-Me;Je>0&&(Je=Math.max(10,Je),this.circleDiameter=Je)}else{const Me=!((ve=O.image)===null||ve===void 0)&&ve.content&&(O.image.textFitWidth||O.image.textFitHeight)?ca(O):{x1:O.left,y1:O.top,x2:O.right,y2:O.bottom};Me.y1=Me.y1*H-W[0],Me.y2=Me.y2*H+W[2],Me.x1=Me.x1*H-W[3],Me.x2=Me.x2*H+W[1];const Le=O.collisionPadding;if(Le&&(Me.x1-=Le[0]*H,Me.y1-=Le[1]*H,Me.x2+=Le[2]*H,Me.y2+=Le[3]*H),pe){const qe=new it(Me.x1,Me.y1),Je=new it(Me.x2,Me.y1),xt=new it(Me.x1,Me.y2),zt=new it(Me.x2,Me.y2),ai=pe*Math.PI/180;qe._rotate(ai),Je._rotate(ai),xt._rotate(ai),zt._rotate(ai),Me.x1=Math.min(qe.x,Je.x,xt.x,zt.x),Me.x2=Math.max(qe.x,Je.x,xt.x,zt.x),Me.y1=Math.min(qe.y,Je.y,xt.y,zt.y),Me.y2=Math.max(qe.y,Je.y,xt.y,zt.y)}l.emplaceBack(g.x,g.y,Me.x1,Me.y1,Me.x2,Me.y2,T,z,F)}this.boxEndIndex=l.length}}class X_{constructor(l=[],g=((T,z)=>T<z?-1:T>z?1:0)){if(this.data=l,this.length=this.data.length,this.compare=g,this.length>0)for(let T=(this.length>>1)-1;T>=0;T--)this._down(T)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],g=this.data.pop();return--this.length>0&&(this.data[0]=g,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:g,compare:T}=this,z=g[l];for(;l>0;){const F=l-1>>1,O=g[F];if(T(z,O)>=0)break;g[l]=O,l=F}g[l]=z}_down(l){const{data:g,compare:T}=this,z=this.length>>1,F=g[l];for(;l<z;){let O=1+(l<<1);const H=O+1;if(H<this.length&&T(g[H],g[O])<0&&(O=H),T(g[O],F)>=0)break;g[l]=g[O],l=O}g[l]=F}}function z_(f,l=1,g=!1){let T=1/0,z=1/0,F=-1/0,O=-1/0;const H=f[0];for(let Le=0;Le<H.length;Le++){const qe=H[Le];(!Le||qe.x<T)&&(T=qe.x),(!Le||qe.y<z)&&(z=qe.y),(!Le||qe.x>F)&&(F=qe.x),(!Le||qe.y>O)&&(O=qe.y)}const W=Math.min(F-T,O-z);let re=W/2;const pe=new X_([],vg);if(W===0)return new it(T,z);for(let Le=T;Le<F;Le+=W)for(let qe=z;qe<O;qe+=W)pe.push(new xp(Le+re,qe+re,re,f));let ve=(function(Le){let qe=0,Je=0,xt=0;const zt=Le[0];for(let ai=0,Vt=zt.length,ii=Vt-1;ai<Vt;ii=ai++){const Fi=zt[ai],gn=zt[ii],Xn=Fi.x*gn.y-gn.x*Fi.y;Je+=(Fi.x+gn.x)*Xn,xt+=(Fi.y+gn.y)*Xn,qe+=3*Xn}return new xp(Je/qe,xt/qe,0,Le)})(f),Me=pe.length;for(;pe.length;){const Le=pe.pop();(Le.d>ve.d||!ve.d)&&(ve=Le,g&&console.log("found best %d after %d probes",Math.round(1e4*Le.d)/1e4,Me)),Le.max-ve.d<=l||(re=Le.h/2,pe.push(new xp(Le.p.x-re,Le.p.y-re,re,f)),pe.push(new xp(Le.p.x+re,Le.p.y-re,re,f)),pe.push(new xp(Le.p.x-re,Le.p.y+re,re,f)),pe.push(new xp(Le.p.x+re,Le.p.y+re,re,f)),Me+=4)}return g&&(console.log(`num probes: ${Me}`),console.log(`best distance: ${ve.d}`)),ve.p}function vg(f,l){return l.max-f.max}function xp(f,l,g,T){this.p=new it(f,l),this.h=g,this.d=(function(z,F){let O=!1,H=1/0;for(let W=0;W<F.length;W++){const re=F[W];for(let pe=0,ve=re.length,Me=ve-1;pe<ve;Me=pe++){const Le=re[pe],qe=re[Me];Le.y>z.y!=qe.y>z.y&&z.x<(qe.x-Le.x)*(z.y-Le.y)/(qe.y-Le.y)+Le.x&&(O=!O),H=Math.min(H,ap(z,Le,qe))}}return(O?1:-1)*Math.sqrt(H)})(this.p,T),this.max=this.d+this.h*Math.SQRT2}var Ul;se.aq=void 0,(Ul=se.aq||(se.aq={}))[Ul.center=1]="center",Ul[Ul.left=2]="left",Ul[Ul.right=3]="right",Ul[Ul.top=4]="top",Ul[Ul.bottom=5]="bottom",Ul[Ul["top-left"]=6]="top-left",Ul[Ul["top-right"]=7]="top-right",Ul[Ul["bottom-left"]=8]="bottom-left",Ul[Ul["bottom-right"]=9]="bottom-right";const qf=7,p_=Number.POSITIVE_INFINITY;function Yp(f,l){return l[1]!==p_?(function(g,T,z){let F=0,O=0;switch(T=Math.abs(T),z=Math.abs(z),g){case"top-right":case"top-left":case"top":O=z-qf;break;case"bottom-right":case"bottom-left":case"bottom":O=-z+qf}switch(g){case"top-right":case"bottom-right":case"right":F=-T;break;case"top-left":case"bottom-left":case"left":F=T}return[F,O]})(f,l[0],l[1]):(function(g,T){let z=0,F=0;T<0&&(T=0);const O=T/Math.SQRT2;switch(g){case"top-right":case"top-left":F=O-qf;break;case"bottom-right":case"bottom-left":F=-O+qf;break;case"bottom":F=-T+qf;break;case"top":F=T-qf}switch(g){case"top-right":case"bottom-right":z=-O;break;case"top-left":case"bottom-left":z=O;break;case"left":z=T;break;case"right":z=-T}return[z,F]})(f,l[0])}function R_(f,l,g){var T;const z=f.layout,F=(T=z.get("text-variable-anchor-offset"))===null||T===void 0?void 0:T.evaluate(l,{},g);if(F){const H=F.values,W=[];for(let re=0;re<H.length;re+=2){const pe=W[re]=H[re],ve=H[re+1].map((Me=>Me*t));pe.startsWith("top")?ve[1]-=qf:pe.startsWith("bottom")&&(ve[1]+=qf),W[re+1]=ve}return new Oa(W)}const O=z.get("text-variable-anchor");if(O){let H;H=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[z.get("text-radial-offset").evaluate(l,{},g)*t,p_]:z.get("text-offset").evaluate(l,{},g).map((re=>re*t));const W=[];for(const re of O)W.push(re,Yp(re,H));return new Oa(W)}return null}function Km(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Cs(f,l,g,T,z,F,O,H,W,re,pe){let ve=F.textMaxSize.evaluate(l,{});ve===void 0&&(ve=O);const Me=f.layers[0].layout,Le=Me.get("icon-offset").evaluate(l,{},pe),qe=bd(g.horizontal),Je=O/24,xt=f.tilePixelRatio*Je,zt=f.tilePixelRatio*ve/24,ai=f.tilePixelRatio*H,Vt=f.tilePixelRatio*Me.get("symbol-spacing"),ii=Me.get("text-padding")*f.tilePixelRatio,Fi=(function(Zi,or,Tr,aa=1){const vs=Zi.get("icon-padding").evaluate(or,{},Tr),ro=vs&&vs.values;return[ro[0]*aa,ro[1]*aa,ro[2]*aa,ro[3]*aa]})(Me,l,pe,f.tilePixelRatio),gn=Me.get("text-max-angle")/180*Math.PI,Xn=Me.get("text-rotation-alignment")!=="viewport"&&Me.get("symbol-placement")!=="point",Rr=Me.get("icon-rotation-alignment")==="map"&&Me.get("symbol-placement")!=="point",Bn=Me.get("symbol-placement"),Mn=Vt/2,wr=Me.get("icon-text-fit");let lr;T&&wr!=="none"&&(f.allowVerticalPlacement&&g.vertical&&(lr=Jn(T,g.vertical,wr,Me.get("icon-text-fit-padding"),Le,Je)),qe&&(T=Jn(T,qe,wr,Me.get("icon-text-fit-padding"),Le,Je)));const nr=(Zi,or)=>{or.x<0||or.x>=da||or.y<0||or.y>=da||(function(Tr,aa,vs,ro,Tl,Bc,nc,Gl,tu,Tc,il,nl,rc,iu,Sc,Hl,Sl,bh,Ju,os,Bs,To,Nc,So,Zf){const Qu=Tr.addToLineVertexArray(aa,vs);let wh,Th,Wh,El,Tf=0,bp=0,D_=0,Qp=0,em=-1,wp=-1;const Wf={};let Cm=Jo("");if(Tr.allowVerticalPlacement&&ro.vertical){const jc=Gl.layout.get("text-rotate").evaluate(Bs,{},So)+90;Wh=new Xp(tu,aa,Tc,il,nl,ro.vertical,rc,iu,Sc,jc),nc&&(El=new Xp(tu,aa,Tc,il,nl,nc,Sl,bh,Sc,jc))}if(Tl){const jc=Gl.layout.get("icon-rotate").evaluate(Bs,{}),nu=Gl.layout.get("icon-text-fit")!=="none",ru=f_(Tl,jc,Nc,nu),Ec=nc?f_(nc,jc,Nc,nu):void 0;Th=new Xp(tu,aa,Tc,il,nl,Tl,Sl,bh,!1,jc),Tf=4*ru.length;const Sh=Tr.iconSizeData;let th=null;Sh.kind==="source"?(th=[Zr*Gl.layout.get("icon-size").evaluate(Bs,{})],th[0]>ta&&Wi(`${Tr.layerIds[0]}: Value for "icon-size" is >= ${xr}. Reduce your "icon-size".`)):Sh.kind==="composite"&&(th=[Zr*To.compositeIconSizes[0].evaluate(Bs,{},So),Zr*To.compositeIconSizes[1].evaluate(Bs,{},So)],(th[0]>ta||th[1]>ta)&&Wi(`${Tr.layerIds[0]}: Value for "icon-size" is >= ${xr}. Reduce your "icon-size".`)),Tr.addSymbols(Tr.icon,ru,th,os,Ju,Bs,se.ah.none,aa,Qu.lineStartIndex,Qu.lineLength,-1,So),em=Tr.icon.placedSymbolArray.length-1,Ec&&(bp=4*Ec.length,Tr.addSymbols(Tr.icon,Ec,th,os,Ju,Bs,se.ah.vertical,aa,Qu.lineStartIndex,Qu.lineLength,-1,So),wp=Tr.icon.placedSymbolArray.length-1)}const Y_=Object.keys(ro.horizontal);for(const jc of Y_){const nu=ro.horizontal[jc];if(!wh){Cm=Jo(nu.text);const Ec=Gl.layout.get("text-rotate").evaluate(Bs,{},So);wh=new Xp(tu,aa,Tc,il,nl,nu,rc,iu,Sc,Ec)}const ru=nu.positionedLines.length===1;if(D_+=Im(Tr,aa,nu,Bc,Gl,Sc,Bs,Hl,Qu,ro.vertical?se.ah.horizontal:se.ah.horizontalOnly,ru?Y_:[jc],Wf,em,To,So),ru)break}ro.vertical&&(Qp+=Im(Tr,aa,ro.vertical,Bc,Gl,Sc,Bs,Hl,Qu,se.ah.vertical,["vertical"],Wf,wp,To,So));const K_=wh?wh.boxStartIndex:Tr.collisionBoxArray.length,P_=wh?wh.boxEndIndex:Tr.collisionBoxArray.length,Sf=Wh?Wh.boxStartIndex:Tr.collisionBoxArray.length,L_=Wh?Wh.boxEndIndex:Tr.collisionBoxArray.length,y_=Th?Th.boxStartIndex:Tr.collisionBoxArray.length,zm=Th?Th.boxEndIndex:Tr.collisionBoxArray.length,Rm=El?El.boxStartIndex:Tr.collisionBoxArray.length,tm=El?El.boxEndIndex:Tr.collisionBoxArray.length;let eh=-1;const t_=(jc,nu)=>jc&&jc.circleDiameter?Math.max(jc.circleDiameter,nu):nu;eh=t_(wh,eh),eh=t_(Wh,eh),eh=t_(Th,eh),eh=t_(El,eh);const i_=eh>-1?1:0;i_&&(eh*=Zf/t),Tr.glyphOffsetArray.length>=As.MAX_GLYPHS&&Wi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Bs.sortKey!==void 0&&Tr.addToSortKeyRanges(Tr.symbolInstances.length,Bs.sortKey);const v_=R_(Gl,Bs,So),[n_,k_]=(function(jc,nu){const ru=jc.length,Ec=nu?.values;if(Ec?.length>0)for(let Sh=0;Sh<Ec.length;Sh+=2){const th=Ec[Sh+1];jc.emplaceBack(se.aq[Ec[Sh]],th[0],th[1])}return[ru,jc.length]})(Tr.textAnchorOffsets,v_);Tr.symbolInstances.emplaceBack(aa.x,aa.y,Wf.right>=0?Wf.right:-1,Wf.center>=0?Wf.center:-1,Wf.left>=0?Wf.left:-1,Wf.vertical||-1,em,wp,Cm,K_,P_,Sf,L_,y_,zm,Rm,tm,Tc,D_,Qp,Tf,bp,i_,0,rc,eh,n_,k_)})(f,or,Zi,g,T,z,lr,f.layers[0],f.collisionBoxArray,l.index,l.sourceLayerIndex,f.index,xt,[ii,ii,ii,ii],Xn,W,ai,Fi,Rr,Le,l,F,re,pe,O)};if(Bn==="line")for(const Zi of $m(l.geometry,0,0,da,da)){const or=eu(Zi,Vt,gn,g.vertical||qe,T,24,zt,f.overscaling,da);for(const Tr of or)qe&&wl(f,qe.text,Mn,Tr)||nr(Zi,Tr)}else if(Bn==="line-center"){for(const Zi of l.geometry)if(Zi.length>1){const or=Hf(Zi,gn,g.vertical||qe,T,24,zt);or&&nr(Zi,or)}}else if(l.type==="Polygon")for(const Zi of zc(l.geometry,0)){const or=z_(Zi,16);nr(Zi[0],new xd(or.x,or.y,0))}else if(l.type==="LineString")for(const Zi of l.geometry)nr(Zi,new xd(Zi[0].x,Zi[0].y,0));else if(l.type==="Point")for(const Zi of l.geometry)for(const or of Zi)nr([or],new xd(or.x,or.y,0))}function Im(f,l,g,T,z,F,O,H,W,re,pe,ve,Me,Le,qe){const Je=(function(ai,Vt,ii,Fi,gn,Xn,Rr,Bn){const Mn=Fi.layout.get("text-rotate").evaluate(Xn,{})*Math.PI/180,wr=[];for(const lr of Vt.positionedLines)for(const nr of lr.positionedGlyphs){if(!nr.rect)continue;const Zi=nr.rect||{};let or=At+1,Tr=!0,aa=1,vs=0;const ro=(gn||Bn)&&nr.vertical,Tl=nr.metrics.advance*nr.scale/2;if(Bn&&Vt.verticalizable&&(vs=lr.lineOffset/2-(nr.imageName?-(t-nr.metrics.width*nr.scale)/2:(nr.scale-1)*t)),nr.imageName){const os=Rr[nr.imageName];Tr=os.sdf,aa=os.pixelRatio,or=Dt/aa}const Bc=gn?[nr.x+Tl,nr.y]:[0,0];let nc=gn?[0,0]:[nr.x+Tl+ii[0],nr.y+ii[1]-vs],Gl=[0,0];ro&&(Gl=nc,nc=[0,0]);const tu=nr.metrics.isDoubleResolution?2:1,Tc=(nr.metrics.left-or)*nr.scale-Tl+nc[0],il=(-nr.metrics.top-or)*nr.scale+nc[1],nl=Tc+Zi.w/tu*nr.scale/aa,rc=il+Zi.h/tu*nr.scale/aa,iu=new it(Tc,il),Sc=new it(nl,il),Hl=new it(Tc,rc),Sl=new it(nl,rc);if(ro){const os=new it(-Tl,Tl-Nt),Bs=-Math.PI/2,To=t/2-Tl,Nc=new it(5-Nt-To,-(nr.imageName?To:0)),So=new it(...Gl);iu._rotateAround(Bs,os)._add(Nc)._add(So),Sc._rotateAround(Bs,os)._add(Nc)._add(So),Hl._rotateAround(Bs,os)._add(Nc)._add(So),Sl._rotateAround(Bs,os)._add(Nc)._add(So)}if(Mn){const os=Math.sin(Mn),Bs=Math.cos(Mn),To=[Bs,-os,os,Bs];iu._matMult(To),Sc._matMult(To),Hl._matMult(To),Sl._matMult(To)}const bh=new it(0,0),Ju=new it(0,0);wr.push({tl:iu,tr:Sc,bl:Hl,br:Sl,tex:Zi,writingMode:Vt.writingMode,glyphOffset:Bc,sectionIndex:nr.sectionIndex,isSDF:Tr,pixelOffsetTL:bh,pixelOffsetBR:Ju,minFontScaleX:0,minFontScaleY:0})}return wr})(0,g,H,z,F,O,T,f.allowVerticalPlacement),xt=f.textSizeData;let zt=null;xt.kind==="source"?(zt=[Zr*z.layout.get("text-size").evaluate(O,{})],zt[0]>ta&&Wi(`${f.layerIds[0]}: Value for "text-size" is >= ${xr}. Reduce your "text-size".`)):xt.kind==="composite"&&(zt=[Zr*Le.compositeTextSizes[0].evaluate(O,{},qe),Zr*Le.compositeTextSizes[1].evaluate(O,{},qe)],(zt[0]>ta||zt[1]>ta)&&Wi(`${f.layerIds[0]}: Value for "text-size" is >= ${xr}. Reduce your "text-size".`)),f.addSymbols(f.text,Je,zt,H,F,O,re,l,W.lineStartIndex,W.lineLength,Me,qe);for(const ai of pe)ve[ai]=f.text.placedSymbolArray.length-1;return 4*Je.length}function bd(f){for(const l in f)return f[l];return null}function wl(f,l,g,T){const z=f.compareText;if(l in z){const F=z[l];for(let O=F.length-1;O>=0;O--)if(T.dist(F[O])<g)return!0}else z[l]=[];return z[l].push(T),!1}const m_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $f{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[g,T]=new Uint8Array(l,0,2);if(g!==219)throw new Error("Data does not appear to be in a KDBush format.");const z=T>>4;if(z!==1)throw new Error(`Got v${z} data when expected v1.`);const F=m_[15&T];if(!F)throw new Error("Unrecognized array type.");const[O]=new Uint16Array(l,2,1),[H]=new Uint32Array(l,4,1);return new $f(H,O,F,l)}constructor(l,g=64,T=Float64Array,z){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+g,2),65535),this.ArrayType=T,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const F=m_.indexOf(this.ArrayType),O=2*l*this.ArrayType.BYTES_PER_ELEMENT,H=l*this.IndexArrayType.BYTES_PER_ELEMENT,W=(8-H%8)%8;if(F<0)throw new Error(`Unexpected typed array class: ${T}.`);z&&z instanceof ArrayBuffer?(this.data=z,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+H+W,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+O+H+W),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+H+W,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+F]),new Uint16Array(this.data,2,1)[0]=g,new Uint32Array(this.data,4,1)[0]=l)}add(l,g){const T=this._pos>>1;return this.ids[T]=T,this.coords[this._pos++]=l,this.coords[this._pos++]=g,T}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return Kp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,g,T,z){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:F,coords:O,nodeSize:H}=this,W=[0,F.length-1,0],re=[];for(;W.length;){const pe=W.pop()||0,ve=W.pop()||0,Me=W.pop()||0;if(ve-Me<=H){for(let xt=Me;xt<=ve;xt++){const zt=O[2*xt],ai=O[2*xt+1];zt>=l&&zt<=T&&ai>=g&&ai<=z&&re.push(F[xt])}continue}const Le=Me+ve>>1,qe=O[2*Le],Je=O[2*Le+1];qe>=l&&qe<=T&&Je>=g&&Je<=z&&re.push(F[Le]),(pe===0?l<=qe:g<=Je)&&(W.push(Me),W.push(Le-1),W.push(1-pe)),(pe===0?T>=qe:z>=Je)&&(W.push(Le+1),W.push(ve),W.push(1-pe))}return re}within(l,g,T){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:z,coords:F,nodeSize:O}=this,H=[0,z.length-1,0],W=[],re=T*T;for(;H.length;){const pe=H.pop()||0,ve=H.pop()||0,Me=H.pop()||0;if(ve-Me<=O){for(let xt=Me;xt<=ve;xt++)Jp(F[2*xt],F[2*xt+1],l,g)<=re&&W.push(z[xt]);continue}const Le=Me+ve>>1,qe=F[2*Le],Je=F[2*Le+1];Jp(qe,Je,l,g)<=re&&W.push(z[Le]),(pe===0?l-T<=qe:g-T<=Je)&&(H.push(Me),H.push(Le-1),H.push(1-pe)),(pe===0?l+T>=qe:g+T>=Je)&&(H.push(Le+1),H.push(ve),H.push(1-pe))}return W}}function Kp(f,l,g,T,z,F){if(z-T<=g)return;const O=T+z>>1;Jm(f,l,O,T,z,F),Kp(f,l,g,T,O-1,1-F),Kp(f,l,g,O+1,z,1-F)}function Jm(f,l,g,T,z,F){for(;z>T;){if(z-T>600){const re=z-T+1,pe=g-T+1,ve=Math.log(re),Me=.5*Math.exp(2*ve/3),Le=.5*Math.sqrt(ve*Me*(re-Me)/re)*(pe-re/2<0?-1:1);Jm(f,l,g,Math.max(T,Math.floor(g-pe*Me/re+Le)),Math.min(z,Math.floor(g+(re-pe)*Me/re+Le)),F)}const O=l[2*g+F];let H=T,W=z;for(Qm(f,l,T,g),l[2*z+F]>O&&Qm(f,l,T,z);H<W;){for(Qm(f,l,H,W),H++,W--;l[2*H+F]<O;)H++;for(;l[2*W+F]>O;)W--}l[2*T+F]===O?Qm(f,l,T,W):(W++,Qm(f,l,W,z)),W<=g&&(T=W+1),g<=W&&(z=W-1)}}function Qm(f,l,g,T){__(f,g,T),__(l,2*g,2*T),__(l,2*g+1,2*T+1)}function __(f,l,g){const T=f[l];f[l]=f[g],f[g]=T}function Jp(f,l,g,T){const z=f-g,F=l-T;return z*z+F*F}var g_;se.bg=void 0,(g_=se.bg||(se.bg={})).create="create",g_.load="load",g_.fullLoad="fullLoad";let Vd=null,wf=[];const wo=1e3/60,e_="loadTime",wc="fullLoadTime",xg={mark(f){performance.mark(f)},frame(f){const l=f;Vd!=null&&wf.push(l-Vd),Vd=l},clearMetrics(){Vd=null,wf=[],performance.clearMeasures(e_),performance.clearMeasures(wc);for(const f in se.bg)performance.clearMarks(se.bg[f])},getPerformanceMetrics(){performance.measure(e_,se.bg.create,se.bg.load),performance.measure(wc,se.bg.create,se.bg.fullLoad);const f=performance.getEntriesByName(e_)[0].duration,l=performance.getEntriesByName(wc)[0].duration,g=wf.length,T=1/(wf.reduce(((F,O)=>F+O),0)/g/1e3),z=wf.filter((F=>F>wo)).reduce(((F,O)=>F+(O-wo)/wo),0);return{loadTime:f,fullLoadTime:l,fps:T,percentDroppedFrames:z/(g+z)*100,totalFrames:g}}};se.$=class extends we{},se.A=Ld,se.B=Df,se.C=function(f){if(si==null){const l=f.navigator?f.navigator.userAgent:null;si=!!f.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return si},se.D=Wn,se.E=Ma,se.F=class{constructor(f,l){this.target=f,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new fo((()=>this.process())),this.subscription=(function(g,T,z,F){return g.addEventListener(T,z,!1),{unsubscribe:()=>{g.removeEventListener(T,z,!1)}}})(this.target,"message",(g=>this.receive(g))),this.globalScope=Pr(self)?f:window}registerMessageHandler(f,l){this.messageHandlers[f]=l}sendAsync(f,l){return new Promise(((g,T)=>{const z=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[z]={resolve:g,reject:T},l&&l.signal.addEventListener("abort",(()=>{delete this.resolveRejects[z];const H={id:z,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(H)}),{once:!0});const F=[],O=Object.assign(Object.assign({},f),{id:z,sourceMapId:this.mapId,origin:location.origin,data:Jl(f.data,F)});this.target.postMessage(O,{transfer:F})}))}receive(f){const l=f.data,g=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[g];const T=this.abortControllers[g];return delete this.abortControllers[g],void(T&&T.abort())}if(Pr(self)||l.mustQueue)return this.tasks[g]=l,this.taskQueue.push(g),void this.invoker.trigger();this.processTask(g,l)}}process(){if(this.taskQueue.length===0)return;const f=this.taskQueue.shift(),l=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(f,l)}processTask(f,l){return n(this,void 0,void 0,(function*(){if(l.type==="<response>"){const z=this.resolveRejects[f];return delete this.resolveRejects[f],z?void(l.error?z.reject(lh(l.error)):z.resolve(lh(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const g=lh(l.data),T=new AbortController;this.abortControllers[f]=T;try{const z=yield this.messageHandlers[l.type](l.sourceMapId,g,T);this.completeTask(f,null,z)}catch(z){this.completeTask(f,z)}}))}completeTask(f,l,g){const T=[];delete this.abortControllers[f];const z={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?Jl(l):null,data:Jl(g,T)};this.target.postMessage(z,{transfer:T})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},se.G=vr,se.H=function(){var f=new Ld(16);return Ld!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},se.I=Kt,se.J=function(f,l,g){var T,z,F,O,H,W,re,pe,ve,Me,Le,qe,Je=g[0],xt=g[1],zt=g[2];return l===f?(f[12]=l[0]*Je+l[4]*xt+l[8]*zt+l[12],f[13]=l[1]*Je+l[5]*xt+l[9]*zt+l[13],f[14]=l[2]*Je+l[6]*xt+l[10]*zt+l[14],f[15]=l[3]*Je+l[7]*xt+l[11]*zt+l[15]):(z=l[1],F=l[2],O=l[3],H=l[4],W=l[5],re=l[6],pe=l[7],ve=l[8],Me=l[9],Le=l[10],qe=l[11],f[0]=T=l[0],f[1]=z,f[2]=F,f[3]=O,f[4]=H,f[5]=W,f[6]=re,f[7]=pe,f[8]=ve,f[9]=Me,f[10]=Le,f[11]=qe,f[12]=T*Je+H*xt+ve*zt+l[12],f[13]=z*Je+W*xt+Me*zt+l[13],f[14]=F*Je+re*xt+Le*zt+l[14],f[15]=O*Je+pe*xt+qe*zt+l[15]),f},se.K=function(f,l,g){var T=g[0],z=g[1],F=g[2];return f[0]=l[0]*T,f[1]=l[1]*T,f[2]=l[2]*T,f[3]=l[3]*T,f[4]=l[4]*z,f[5]=l[5]*z,f[6]=l[6]*z,f[7]=l[7]*z,f[8]=l[8]*F,f[9]=l[9]*F,f[10]=l[10]*F,f[11]=l[11]*F,f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},se.L=Bm,se.M=function(f,l){const g={};for(let T=0;T<l.length;T++){const z=l[T];z in f&&(g[z]=f[z])}return g},se.N=$s,se.O=ic,se.P=it,se.Q=jd,se.R=xo,se.S=tl,se.T=Nh,se.U=on,se.V=Ai,se.W=zn,se.X=da,se.Y=q,se.Z=Zh,se._=n,se.a=vn,se.a$=function(f,l){var g=f[0],T=f[1],z=f[2],F=f[3],O=f[4],H=f[5],W=f[6],re=f[7],pe=f[8],ve=f[9],Me=f[10],Le=f[11],qe=f[12],Je=f[13],xt=f[14],zt=f[15],ai=l[0],Vt=l[1],ii=l[2],Fi=l[3],gn=l[4],Xn=l[5],Rr=l[6],Bn=l[7],Mn=l[8],wr=l[9],lr=l[10],nr=l[11],Zi=l[12],or=l[13],Tr=l[14],aa=l[15];return Math.abs(g-ai)<=Ks*Math.max(1,Math.abs(g),Math.abs(ai))&&Math.abs(T-Vt)<=Ks*Math.max(1,Math.abs(T),Math.abs(Vt))&&Math.abs(z-ii)<=Ks*Math.max(1,Math.abs(z),Math.abs(ii))&&Math.abs(F-Fi)<=Ks*Math.max(1,Math.abs(F),Math.abs(Fi))&&Math.abs(O-gn)<=Ks*Math.max(1,Math.abs(O),Math.abs(gn))&&Math.abs(H-Xn)<=Ks*Math.max(1,Math.abs(H),Math.abs(Xn))&&Math.abs(W-Rr)<=Ks*Math.max(1,Math.abs(W),Math.abs(Rr))&&Math.abs(re-Bn)<=Ks*Math.max(1,Math.abs(re),Math.abs(Bn))&&Math.abs(pe-Mn)<=Ks*Math.max(1,Math.abs(pe),Math.abs(Mn))&&Math.abs(ve-wr)<=Ks*Math.max(1,Math.abs(ve),Math.abs(wr))&&Math.abs(Me-lr)<=Ks*Math.max(1,Math.abs(Me),Math.abs(lr))&&Math.abs(Le-nr)<=Ks*Math.max(1,Math.abs(Le),Math.abs(nr))&&Math.abs(qe-Zi)<=Ks*Math.max(1,Math.abs(qe),Math.abs(Zi))&&Math.abs(Je-or)<=Ks*Math.max(1,Math.abs(Je),Math.abs(or))&&Math.abs(xt-Tr)<=Ks*Math.max(1,Math.abs(xt),Math.abs(Tr))&&Math.abs(zt-aa)<=Ks*Math.max(1,Math.abs(zt),Math.abs(aa))},se.a0=ja,se.a1=xh,se.a2=Qt,se.a3=f=>{const l=window.document.createElement("video");return l.muted=!0,new Promise((g=>{l.onloadstart=()=>{g(l)};for(const T of f){const z=window.document.createElement("source");Lr(T)||(l.crossOrigin="Anonymous"),z.src=T,l.appendChild(z)}}))},se.a4=function(){return Pt++},se.a5=qn,se.a6=As,se.a7=zf,se.a8=yc,se.a9=Hm,se.aA=function(f){if(f.type==="custom")return new qs(f);switch(f.type){case"background":return new dl(f);case"circle":return new uf(f);case"fill":return new jm(f);case"fill-extrusion":return new Vf(f);case"heatmap":return new up(f);case"hillshade":return new ff(f);case"line":return new $p(f);case"raster":return new tc(f);case"symbol":return new ho(f)}},se.aB=tn,se.aC=function(f,l){if(!f)return[{command:"setStyle",args:[l]}];let g=[];try{if(!Ar(f.version,l.version))return[{command:"setStyle",args:[l]}];Ar(f.center,l.center)||g.push({command:"setCenter",args:[l.center]}),Ar(f.zoom,l.zoom)||g.push({command:"setZoom",args:[l.zoom]}),Ar(f.bearing,l.bearing)||g.push({command:"setBearing",args:[l.bearing]}),Ar(f.pitch,l.pitch)||g.push({command:"setPitch",args:[l.pitch]}),Ar(f.sprite,l.sprite)||g.push({command:"setSprite",args:[l.sprite]}),Ar(f.glyphs,l.glyphs)||g.push({command:"setGlyphs",args:[l.glyphs]}),Ar(f.transition,l.transition)||g.push({command:"setTransition",args:[l.transition]}),Ar(f.light,l.light)||g.push({command:"setLight",args:[l.light]}),Ar(f.terrain,l.terrain)||g.push({command:"setTerrain",args:[l.terrain]}),Ar(f.sky,l.sky)||g.push({command:"setSky",args:[l.sky]}),Ar(f.projection,l.projection)||g.push({command:"setProjection",args:[l.projection]});const T={},z=[];(function(O,H,W,re){let pe;for(pe in H=H||{},O=O||{})Object.prototype.hasOwnProperty.call(O,pe)&&(Object.prototype.hasOwnProperty.call(H,pe)||Qs(pe,W,re));for(pe in H)Object.prototype.hasOwnProperty.call(H,pe)&&(Object.prototype.hasOwnProperty.call(O,pe)?Ar(O[pe],H[pe])||(O[pe].type==="geojson"&&H[pe].type==="geojson"&&Mr(O,H,pe)?la(W,{command:"setGeoJSONSourceData",args:[pe,H[pe].data]}):Io(pe,H,W,re)):Po(pe,H,W))})(f.sources,l.sources,z,T);const F=[];f.layers&&f.layers.forEach((O=>{"source"in O&&T[O.source]?g.push({command:"removeLayer",args:[O.id]}):F.push(O)})),g=g.concat(z),(function(O,H,W){H=H||[];const re=(O=O||[]).map(Ds),pe=H.map(Ds),ve=O.reduce(Ps,{}),Me=H.reduce(Ps,{}),Le=re.slice(),qe=Object.create(null);let Je,xt,zt,ai,Vt;for(let ii=0,Fi=0;ii<re.length;ii++)Je=re[ii],Object.prototype.hasOwnProperty.call(Me,Je)?Fi++:(la(W,{command:"removeLayer",args:[Je]}),Le.splice(Le.indexOf(Je,Fi),1));for(let ii=0,Fi=0;ii<pe.length;ii++)Je=pe[pe.length-1-ii],Le[Le.length-1-ii]!==Je&&(Object.prototype.hasOwnProperty.call(ve,Je)?(la(W,{command:"removeLayer",args:[Je]}),Le.splice(Le.lastIndexOf(Je,Le.length-Fi),1)):Fi++,ai=Le[Le.length-ii],la(W,{command:"addLayer",args:[Me[Je],ai]}),Le.splice(Le.length-ii,0,Je),qe[Je]=!0);for(let ii=0;ii<pe.length;ii++)if(Je=pe[ii],xt=ve[Je],zt=Me[Je],!qe[Je]&&!Ar(xt,zt))if(Ar(xt.source,zt.source)&&Ar(xt["source-layer"],zt["source-layer"])&&Ar(xt.type,zt.type)){for(Vt in ws(xt.layout,zt.layout,W,Je,null,"setLayoutProperty"),ws(xt.paint,zt.paint,W,Je,null,"setPaintProperty"),Ar(xt.filter,zt.filter)||la(W,{command:"setFilter",args:[Je,zt.filter]}),Ar(xt.minzoom,zt.minzoom)&&Ar(xt.maxzoom,zt.maxzoom)||la(W,{command:"setLayerZoomRange",args:[Je,zt.minzoom,zt.maxzoom]}),xt)Object.prototype.hasOwnProperty.call(xt,Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?ws(xt[Vt],zt[Vt],W,Je,Vt.slice(6),"setPaintProperty"):Ar(xt[Vt],zt[Vt])||la(W,{command:"setLayerProperty",args:[Je,Vt,zt[Vt]]}));for(Vt in zt)Object.prototype.hasOwnProperty.call(zt,Vt)&&!Object.prototype.hasOwnProperty.call(xt,Vt)&&Vt!=="layout"&&Vt!=="paint"&&Vt!=="filter"&&Vt!=="metadata"&&Vt!=="minzoom"&&Vt!=="maxzoom"&&(Vt.indexOf("paint.")===0?ws(xt[Vt],zt[Vt],W,Je,Vt.slice(6),"setPaintProperty"):Ar(xt[Vt],zt[Vt])||la(W,{command:"setLayerProperty",args:[Je,Vt,zt[Vt]]}))}else la(W,{command:"removeLayer",args:[Je]}),ai=Le[Le.lastIndexOf(Je)+1],la(W,{command:"addLayer",args:[zt,ai]})})(F,l.layers,g)}catch(T){console.warn("Unable to compute style diff:",T),g=[{command:"setStyle",args:[l]}]}return g},se.aD=function(f){const l=[],g=f.id;return g===void 0&&l.push({message:`layers.${g}: missing required property "id"`}),f.render===void 0&&l.push({message:`layers.${g}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&l.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),l},se.aE=function f(l,g){if(Array.isArray(l)){if(!Array.isArray(g)||l.length!==g.length)return!1;for(let T=0;T<l.length;T++)if(!f(l[T],g[T]))return!1;return!0}if(typeof l=="object"&&l!==null&&g!==null){if(typeof g!="object"||Object.keys(l).length!==Object.keys(g).length)return!1;for(const T in l)if(!f(l[T],g[T]))return!1;return!0}return l===g},se.aF=Bt,se.aG=Ni,se.aH=class extends bu{constructor(f,l){super(f,l),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},se.aI=zd,se.aJ=class extends bu{constructor(f,l){super(f,l),this.current=dh}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let l=1;l<16;l++)if(f[l]!==this.current[l]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},se.aK=Gu,se.aL=Ka,se.aM=Qi,se.aN=class extends bu{constructor(f,l){super(f,l),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},se.aO=class extends bu{constructor(f,l){super(f,l),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},se.aP=function(f,l,g,T,z,F,O){var H=1/(l-g),W=1/(T-z),re=1/(F-O);return f[0]=-2*H,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*W,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*re,f[11]=0,f[12]=(l+g)*H,f[13]=(z+T)*W,f[14]=(O+F)*re,f[15]=1,f},se.aQ=Yr,se.aR=class extends Ht{},se.aS=bl,se.aT=class extends oi{},se.aU=df,se.aV=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},se.aW=fh,se.aX=ks,se.aY=Ko,se.aZ=class extends ir{},se.a_=function(f,l){return f[0]===l[0]&&f[1]===l[1]&&f[2]===l[2]&&f[3]===l[3]&&f[4]===l[4]&&f[5]===l[5]&&f[6]===l[6]&&f[7]===l[7]&&f[8]===l[8]&&f[9]===l[9]&&f[10]===l[10]&&f[11]===l[11]&&f[12]===l[12]&&f[13]===l[13]&&f[14]===l[14]&&f[15]===l[15]},se.aa=function(f){const l={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((g,T,z,F)=>{const O=z||F;return l[T]=!O||O.toLowerCase(),""})),l["max-age"]){const g=parseInt(l["max-age"],10);isNaN(g)?delete l["max-age"]:l["max-age"]=g}return l},se.ab=function(f,l){const g=[];for(const T in f)T in l||g.push(T);return g},se.ac=rr,se.ad=function(f,l,g){var T=Math.sin(g),z=Math.cos(g),F=l[0],O=l[1],H=l[2],W=l[3],re=l[4],pe=l[5],ve=l[6],Me=l[7];return l!==f&&(f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=F*z+re*T,f[1]=O*z+pe*T,f[2]=H*z+ve*T,f[3]=W*z+Me*T,f[4]=re*z-F*T,f[5]=pe*z-O*T,f[6]=ve*z-H*T,f[7]=Me*z-W*T,f},se.ae=function(f){var l=new Ld(16);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l[9]=f[9],l[10]=f[10],l[11]=f[11],l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],l},se.af=op,se.ag=function(f,l){let g=0,T=0;if(f.kind==="constant")T=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:z,minZoom:F,maxZoom:O}=f,H=z?rr(Ao.interpolationFactor(z,l,F,O),0,1):0;f.kind==="camera"?T=ko.number(f.minSize,f.maxSize,H):g=H}return{uSizeT:g,uSize:T}},se.ai=function(f,{uSize:l,uSizeT:g},{lowerSize:T,upperSize:z}){return f.kind==="source"?T/Zr:f.kind==="composite"?ko.number(T/Zr,z/Zr,g):l},se.aj=ba,se.ak=function(f,l,g,T){const z=l.y-f.y,F=l.x-f.x,O=T.y-g.y,H=T.x-g.x,W=O*F-H*z;if(W===0)return null;const re=(H*(f.y-g.y)-O*(f.x-g.x))/W;return new it(f.x+re*F,f.y+re*z)},se.al=$m,se.am=fm,se.an=cf,se.ao=function(f){let l=1/0,g=1/0,T=-1/0,z=-1/0;for(const F of f)l=Math.min(l,F.x),g=Math.min(g,F.y),T=Math.max(T,F.x),z=Math.max(z,F.y);return[l,g,T,z]},se.ap=t,se.ar=_r,se.as=function(f,l){var g=l[0],T=l[1],z=l[2],F=l[3],O=l[4],H=l[5],W=l[6],re=l[7],pe=l[8],ve=l[9],Me=l[10],Le=l[11],qe=l[12],Je=l[13],xt=l[14],zt=l[15],ai=g*H-T*O,Vt=g*W-z*O,ii=g*re-F*O,Fi=T*W-z*H,gn=T*re-F*H,Xn=z*re-F*W,Rr=pe*Je-ve*qe,Bn=pe*xt-Me*qe,Mn=pe*zt-Le*qe,wr=ve*xt-Me*Je,lr=ve*zt-Le*Je,nr=Me*zt-Le*xt,Zi=ai*nr-Vt*lr+ii*wr+Fi*Mn-gn*Bn+Xn*Rr;return Zi?(f[0]=(H*nr-W*lr+re*wr)*(Zi=1/Zi),f[1]=(z*lr-T*nr-F*wr)*Zi,f[2]=(Je*Xn-xt*gn+zt*Fi)*Zi,f[3]=(Me*gn-ve*Xn-Le*Fi)*Zi,f[4]=(W*Mn-O*nr-re*Bn)*Zi,f[5]=(g*nr-z*Mn+F*Bn)*Zi,f[6]=(xt*ii-qe*Xn-zt*Vt)*Zi,f[7]=(pe*Xn-Me*ii+Le*Vt)*Zi,f[8]=(O*lr-H*Mn+re*Rr)*Zi,f[9]=(T*Mn-g*lr-F*Rr)*Zi,f[10]=(qe*gn-Je*ii+zt*ai)*Zi,f[11]=(ve*ii-pe*gn-Le*ai)*Zi,f[12]=(H*Bn-O*wr-W*Rr)*Zi,f[13]=(g*wr-T*Bn+z*Rr)*Zi,f[14]=(Je*Vt-qe*Fi-xt*ai)*Zi,f[15]=(pe*Fi-ve*Vt+Me*ai)*Zi,f):null},se.at=Km,se.au=jr,se.av=$f,se.aw=function(){const f={},l=$t.$version;for(const g in $t.$root){const T=$t.$root[g];if(T.required){let z=null;z=g==="version"?l:T.type==="array"?[]:{},z!=null&&(f[g]=z)}}return f},se.ax=Qd,se.ay=gr,se.az=function(f){f=f.slice();const l=Object.create(null);for(let g=0;g<f.length;g++)l[f[g].id]=f[g];for(let g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=Ir(f[g],l[f[g].ref]));return f},se.b=xi,se.b0=function(f,l){return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},se.b1=function(f,l,g){return f[0]=l[0]*g[0],f[1]=l[1]*g[1],f[2]=l[2]*g[2],f[3]=l[3]*g[3],f},se.b2=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]*l[3]},se.b3=ln,se.b4=xf,se.b5=Yu,se.b6=function(f,l,g,T,z){var F,O=1/Math.tan(l/2);return f[0]=O/g,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=O,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,z!=null&&z!==1/0?(f[10]=(z+T)*(F=1/(T-z)),f[14]=2*z*T*F):(f[10]=-1,f[14]=-2*T),f},se.b7=function(f,l,g){var T=Math.sin(g),z=Math.cos(g),F=l[4],O=l[5],H=l[6],W=l[7],re=l[8],pe=l[9],ve=l[10],Me=l[11];return l!==f&&(f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[4]=F*z+re*T,f[5]=O*z+pe*T,f[6]=H*z+ve*T,f[7]=W*z+Me*T,f[8]=re*z-F*T,f[9]=pe*z-O*T,f[10]=ve*z-H*T,f[11]=Me*z-W*T,f},se.b8=an,se.b9=Un,se.bA=a,se.bB=function(f){return f.message===di},se.bC=Lc,se.bD=Yo,se.ba=function(f){return f*Math.PI/180},se.bb=function(f,l){const{x:g,y:T}=Zh.fromLngLat(l);return!(f<0||f>25||T<0||T>=1||g<0||g>=1)},se.bc=function(f,l){return f[0]=l[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=l[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=l[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},se.bd=class extends fe{},se.be=Ua,se.bf=xg,se.bh=Gr,se.bi=function(f,l){vn.REGISTERED_PROTOCOLS[f]=l},se.bj=function(f){delete vn.REGISTERED_PROTOCOLS[f]},se.bk=function(f,l){const g={};for(let z=0;z<f.length;z++){const F=l&&l[f[z].id]||hc(f[z]);l&&(l[f[z].id]=F);let O=g[F];O||(O=g[F]=[]),O.push(f[z])}const T=[];for(const z in g)T.push(g[z]);return T},se.bl=dn,se.bm=ds,se.bn=I_,se.bo=vt,se.bp=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=da/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const l=f.bucket.layers[0],g=l.layout,T=l._unevaluatedLayout._values,z={layoutIconSize:T["icon-size"].possiblyEvaluate(new Ba(f.bucket.zoom+1),f.canonical),layoutTextSize:T["text-size"].possiblyEvaluate(new Ba(f.bucket.zoom+1),f.canonical),textMaxSize:T["text-size"].possiblyEvaluate(new Ba(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:re,maxZoom:pe}=f.bucket.textSizeData;z.compositeTextSizes=[T["text-size"].possiblyEvaluate(new Ba(re),f.canonical),T["text-size"].possiblyEvaluate(new Ba(pe),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:re,maxZoom:pe}=f.bucket.iconSizeData;z.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new Ba(re),f.canonical),T["icon-size"].possiblyEvaluate(new Ba(pe),f.canonical)]}const F=g.get("text-line-height")*t,O=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point",H=g.get("text-keep-upright"),W=g.get("text-size");for(const re of f.bucket.features){const pe=g.get("text-font").evaluate(re,{},f.canonical).join(","),ve=W.evaluate(re,{},f.canonical),Me=z.layoutTextSize.evaluate(re,{},f.canonical),Le=z.layoutIconSize.evaluate(re,{},f.canonical),qe={horizontal:{},vertical:void 0},Je=re.text;let xt,zt=[0,0];if(Je){const ii=Je.toString(),Fi=g.get("text-letter-spacing").evaluate(re,{},f.canonical)*t,gn=ip(ii)?Fi:0,Xn=g.get("text-anchor").evaluate(re,{},f.canonical),Rr=R_(l,re,f.canonical);if(!Rr){const lr=g.get("text-radial-offset").evaluate(re,{},f.canonical);zt=lr?Yp(Xn,[lr*t,p_]):g.get("text-offset").evaluate(re,{},f.canonical).map((nr=>nr*t))}let Bn=O?"center":g.get("text-justify").evaluate(re,{},f.canonical);const Mn=g.get("symbol-placement")==="point"?g.get("text-max-width").evaluate(re,{},f.canonical)*t:1/0,wr=()=>{f.bucket.allowVerticalPlacement&&Xc(ii)&&(qe.vertical=Mi(Je,f.glyphMap,f.glyphPositions,f.imagePositions,pe,Mn,F,Xn,"left",gn,zt,se.ah.vertical,!0,Me,ve))};if(!O&&Rr){const lr=new Set;if(Bn==="auto")for(let Zi=0;Zi<Rr.values.length;Zi+=2)lr.add(Km(Rr.values[Zi]));else lr.add(Bn);let nr=!1;for(const Zi of lr)if(!qe.horizontal[Zi])if(nr)qe.horizontal[Zi]=qe.horizontal[0];else{const or=Mi(Je,f.glyphMap,f.glyphPositions,f.imagePositions,pe,Mn,F,"center",Zi,gn,zt,se.ah.horizontal,!1,Me,ve);or&&(qe.horizontal[Zi]=or,nr=or.positionedLines.length===1)}wr()}else{Bn==="auto"&&(Bn=Km(Xn));const lr=Mi(Je,f.glyphMap,f.glyphPositions,f.imagePositions,pe,Mn,F,Xn,Bn,gn,zt,se.ah.horizontal,!1,Me,ve);lr&&(qe.horizontal[Bn]=lr),wr(),Xc(ii)&&O&&H&&(qe.vertical=Mi(Je,f.glyphMap,f.glyphPositions,f.imagePositions,pe,Mn,F,Xn,Bn,gn,zt,se.ah.vertical,!1,Me,ve))}}let ai=!1;if(re.icon&&re.icon.name){const ii=f.imageMap[re.icon.name];ii&&(xt=_n(f.imagePositions[re.icon.name],g.get("icon-offset").evaluate(re,{},f.canonical),g.get("icon-anchor").evaluate(re,{},f.canonical)),ai=!!ii.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=ai:f.bucket.sdfIcons!==ai&&Wi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ii.pixelRatio!==f.bucket.pixelRatio||g.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const Vt=bd(qe.horizontal)||qe.vertical;f.bucket.iconsInText=!!Vt&&Vt.iconsInText,(Vt||xt)&&Cs(f.bucket,re,qe,xt,f.imageMap,z,Me,Le,zt,ai,f.canonical)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},se.bq=Hp,se.br=gf,se.bs=jf,se.bt=ph,se.bu=Ne,se.bv=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},se.bw=function(f,l,g,T,z){return n(this,void 0,void 0,(function*(){if(Ai())try{return yield zn(f,l,g,T,z)}catch{}return(function(F,O,H,W,re){const pe=F.width,ve=F.height;Er&&Et||(Er=new OffscreenCanvas(pe,ve),Et=Er.getContext("2d",{willReadFrequently:!0})),Er.width=pe,Er.height=ve,Et.drawImage(F,0,0,pe,ve);const Me=Et.getImageData(O,H,W,re);return Et.clearRect(0,0,pe,ve),Me.data})(f,l,g,T,z)}))},se.bx=Ku,se.by=ke,se.bz=Fe,se.c=mi,se.d=f=>n(void 0,void 0,void 0,(function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(l)}catch(g){throw new Error(`Could not load image because of ${g.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),se.e=mn,se.f=f=>new Promise(((l,g)=>{const T=new Image;T.onload=()=>{l(T),URL.revokeObjectURL(T.src),T.onload=null,window.requestAnimationFrame((()=>{T.src=Tn}))},T.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Blob([new Uint8Array(f)],{type:"image/png"});T.src=f.byteLength?URL.createObjectURL(z):Tn})),se.g=tr,se.h=(f,l)=>In(mn(f,{type:"json"}),l),se.i=Pr,se.j=oa,se.k=Kr,se.l=(f,l)=>In(mn(f,{type:"arrayBuffer"}),l),se.m=In,se.n=function(f){return new Ne(f).readFields(nt,[])},se.o=xc,se.p=Ct,se.q=L,se.r=Nu,se.s=Lr,se.t=Oh,se.u=Fl,se.v=$t,se.w=Wi,se.x=function([f,l,g]){return l+=90,l*=Math.PI/180,g*=Math.PI/180,{x:f*Math.cos(l)*Math.sin(g),y:f*Math.sin(l)*Math.sin(g),z:f*Math.cos(g)}},se.y=ko,se.z=Ba})),Ae("worker",["./shared"],(function(se){class n{constructor(ze){this.keyCache={},ze&&this.replace(ze)}replace(ze){this._layerConfigs={},this._layers={},this.update(ze,[])}update(ze,Pe){for(const gt of ze){this._layerConfigs[gt.id]=gt;const jt=this._layers[gt.id]=se.aA(gt);jt._featureFilter=se.a7(jt.filter),this.keyCache[gt.id]&&delete this.keyCache[gt.id]}for(const gt of Pe)delete this.keyCache[gt],delete this._layerConfigs[gt],delete this._layers[gt];this.familiesBySource={};const et=se.bk(Object.values(this._layerConfigs),this.keyCache);for(const gt of et){const jt=gt.map((ui=>this._layers[ui.id])),Ge=jt[0];if(Ge.visibility==="none")continue;const ei=Ge.source||"";let kt=this.familiesBySource[ei];kt||(kt=this.familiesBySource[ei]={});const Pi=Ge.sourceLayer||"_geojsonTileLayer";let fi=kt[Pi];fi||(fi=kt[Pi]=[]),fi.push(jt)}}}class ke{constructor(ze){const Pe={},et=[];for(const ei in ze){const kt=ze[ei],Pi=Pe[ei]={};for(const fi in kt){const ui=kt[+fi];if(!ui||ui.bitmap.width===0||ui.bitmap.height===0)continue;const kn={x:0,y:0,w:ui.bitmap.width+2,h:ui.bitmap.height+2};et.push(kn),Pi[fi]={rect:kn,metrics:ui.metrics}}}const{w:gt,h:jt}=se.p(et),Ge=new se.o({width:gt||1,height:jt||1});for(const ei in ze){const kt=ze[ei];for(const Pi in kt){const fi=kt[+Pi];if(!fi||fi.bitmap.width===0||fi.bitmap.height===0)continue;const ui=Pe[ei][Pi].rect;se.o.copy(fi.bitmap,Ge,{x:0,y:0},{x:ui.x+1,y:ui.y+1},fi.bitmap)}}this.image=Ge,this.positions=Pe}}se.bl("GlyphAtlas",ke);class Fe{constructor(ze){this.tileID=new se.S(ze.tileID.overscaledZ,ze.tileID.wrap,ze.tileID.canonical.z,ze.tileID.canonical.x,ze.tileID.canonical.y),this.uid=ze.uid,this.zoom=ze.zoom,this.pixelRatio=ze.pixelRatio,this.tileSize=ze.tileSize,this.source=ze.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ze.showCollisionBoxes,this.collectResourceTiming=!!ze.collectResourceTiming,this.returnDependencies=!!ze.returnDependencies,this.promoteId=ze.promoteId,this.inFlightDependencies=[]}parse(ze,Pe,et,gt){return se._(this,void 0,void 0,(function*(){this.status="parsing",this.data=ze,this.collisionBoxArray=new se.a5;const jt=new se.bm(Object.keys(ze.layers).sort()),Ge=new se.bn(this.tileID,this.promoteId);Ge.bucketLayerIDs=[];const ei={},kt={featureIndex:Ge,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:et},Pi=Pe.familiesBySource[this.source];for(const at in Pi){const St=ze.layers[at];if(!St)continue;St.version===1&&se.w(`Vector tile source "${this.source}" layer "${at}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const lt=jt.encode(at),It=[];for(let ti=0;ti<St.length;ti++){const Gt=St.feature(ti),Ji=Ge.getId(Gt,at);It.push({feature:Gt,id:Ji,index:ti,sourceLayerIndex:lt})}for(const ti of Pi[at]){const Gt=ti[0];Gt.source!==this.source&&se.w(`layer.source = ${Gt.source} does not equal this.source = ${this.source}`),Gt.minzoom&&this.zoom<Math.floor(Gt.minzoom)||Gt.maxzoom&&this.zoom>=Gt.maxzoom||Gt.visibility!=="none"&&(pt(ti,this.zoom,et),(ei[Gt.id]=Gt.createBucket({index:Ge.bucketLayerIDs.length,layers:ti,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:lt,sourceID:this.source})).populate(It,kt,this.tileID.canonical),Ge.bucketLayerIDs.push(ti.map((Ji=>Ji.id))))}}const fi=se.aF(kt.glyphDependencies,(at=>Object.keys(at).map(Number)));this.inFlightDependencies.forEach((at=>at?.abort())),this.inFlightDependencies=[];let ui=Promise.resolve({});if(Object.keys(fi).length){const at=new AbortController;this.inFlightDependencies.push(at),ui=gt.sendAsync({type:"GG",data:{stacks:fi,source:this.source,tileID:this.tileID,type:"glyphs"}},at)}const kn=Object.keys(kt.iconDependencies);let fr=Promise.resolve({});if(kn.length){const at=new AbortController;this.inFlightDependencies.push(at),fr=gt.sendAsync({type:"GI",data:{icons:kn,source:this.source,tileID:this.tileID,type:"icons"}},at)}const Cr=Object.keys(kt.patternDependencies);let ct=Promise.resolve({});if(Cr.length){const at=new AbortController;this.inFlightDependencies.push(at),ct=gt.sendAsync({type:"GI",data:{icons:Cr,source:this.source,tileID:this.tileID,type:"patterns"}},at)}const[te,_e,Re]=yield Promise.all([ui,fr,ct]),tt=new ke(te),Xe=new se.bo(_e,Re);for(const at in ei){const St=ei[at];St instanceof se.a6?(pt(St.layers,this.zoom,et),se.bp({bucket:St,glyphMap:te,glyphPositions:tt.positions,imageMap:_e,imagePositions:Xe.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):St.hasPattern&&(St instanceof se.bq||St instanceof se.br||St instanceof se.bs)&&(pt(St.layers,this.zoom,et),St.addFeatures(kt,this.tileID.canonical,Xe.patternPositions))}return this.status="done",{buckets:Object.values(ei).filter((at=>!at.isEmpty())),featureIndex:Ge,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:tt.image,imageAtlas:Xe,glyphMap:this.returnDependencies?te:null,iconMap:this.returnDependencies?_e:null,glyphPositions:this.returnDependencies?tt.positions:null}}))}}function pt(ft,ze,Pe){const et=new se.z(ze);for(const gt of ft)gt.recalculate(et,Pe)}class it{constructor(ze,Pe,et){this.actor=ze,this.layerIndex=Pe,this.availableImages=et,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(ze,Pe){return se._(this,void 0,void 0,(function*(){const et=yield se.l(ze.request,Pe);try{return{vectorTile:new se.bt.VectorTile(new se.bu(et.data)),rawData:et.data,cacheControl:et.cacheControl,expires:et.expires}}catch(gt){const jt=new Uint8Array(et.data);let Ge=`Unable to parse the tile at ${ze.request.url}, `;throw Ge+=jt[0]===31&&jt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${gt.message}`,new Error(Ge)}}))}loadTile(ze){return se._(this,void 0,void 0,(function*(){const Pe=ze.uid,et=!!(ze&&ze.request&&ze.request.collectResourceTiming)&&new se.bv(ze.request),gt=new Fe(ze);this.loading[Pe]=gt;const jt=new AbortController;gt.abort=jt;try{const Ge=yield this.loadVectorTile(ze,jt);if(delete this.loading[Pe],!Ge)return null;const ei=Ge.rawData,kt={};Ge.expires&&(kt.expires=Ge.expires),Ge.cacheControl&&(kt.cacheControl=Ge.cacheControl);const Pi={};if(et){const ui=et.finish();ui&&(Pi.resourceTiming=JSON.parse(JSON.stringify(ui)))}gt.vectorTile=Ge.vectorTile;const fi=gt.parse(Ge.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Pe]=gt,this.fetching[Pe]={rawTileData:ei,cacheControl:kt,resourceTiming:Pi};try{const ui=yield fi;return se.e({rawTileData:ei.slice(0)},ui,kt,Pi)}finally{delete this.fetching[Pe]}}catch(Ge){throw delete this.loading[Pe],gt.status="done",this.loaded[Pe]=gt,Ge}}))}reloadTile(ze){return se._(this,void 0,void 0,(function*(){const Pe=ze.uid;if(!this.loaded||!this.loaded[Pe])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const et=this.loaded[Pe];if(et.showCollisionBoxes=ze.showCollisionBoxes,et.status==="parsing"){const gt=yield et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor);let jt;if(this.fetching[Pe]){const{rawTileData:Ge,cacheControl:ei,resourceTiming:kt}=this.fetching[Pe];delete this.fetching[Pe],jt=se.e({rawTileData:Ge.slice(0)},gt,ei,kt)}else jt=gt;return jt}if(et.status==="done"&&et.vectorTile)return et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(ze){return se._(this,void 0,void 0,(function*(){const Pe=this.loading,et=ze.uid;Pe&&Pe[et]&&Pe[et].abort&&(Pe[et].abort.abort(),delete Pe[et])}))}removeTile(ze){return se._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[ze.uid]&&delete this.loaded[ze.uid]}))}}class ht{constructor(){this.loaded={}}loadTile(ze){return se._(this,void 0,void 0,(function*(){const{uid:Pe,encoding:et,rawImageData:gt,redFactor:jt,greenFactor:Ge,blueFactor:ei,baseShift:kt}=ze,Pi=gt.width+2,fi=gt.height+2,ui=se.b(gt)?new se.R({width:Pi,height:fi},yield se.bw(gt,-1,-1,Pi,fi)):gt,kn=new se.bx(Pe,ui,et,jt,Ge,ei,kt);return this.loaded=this.loaded||{},this.loaded[Pe]=kn,kn}))}removeTile(ze){const Pe=this.loaded,et=ze.uid;Pe&&Pe[et]&&delete Pe[et]}}function Ci(ft,ze){if(ft.length!==0){Ui(ft[0],ze);for(var Pe=1;Pe<ft.length;Pe++)Ui(ft[Pe],!ze)}}function Ui(ft,ze){for(var Pe=0,et=0,gt=0,jt=ft.length,Ge=jt-1;gt<jt;Ge=gt++){var ei=(ft[gt][0]-ft[Ge][0])*(ft[Ge][1]+ft[gt][1]),kt=Pe+ei;et+=Math.abs(Pe)>=Math.abs(ei)?Pe-kt+ei:ei-kt+Pe,Pe=kt}Pe+et>=0!=!!ze&&ft.reverse()}var Vi=se.by((function ft(ze,Pe){var et,gt=ze&&ze.type;if(gt==="FeatureCollection")for(et=0;et<ze.features.length;et++)ft(ze.features[et],Pe);else if(gt==="GeometryCollection")for(et=0;et<ze.geometries.length;et++)ft(ze.geometries[et],Pe);else if(gt==="Feature")ft(ze.geometry,Pe);else if(gt==="Polygon")Ci(ze.coordinates,Pe);else if(gt==="MultiPolygon")for(et=0;et<ze.coordinates.length;et++)Ci(ze.coordinates[et],Pe);return ze}));const qi=se.bt.VectorTileFeature.prototype.toGeoJSON;var on={exports:{}},Ai=se.bz,an=se.bt.VectorTileFeature,Un=rr;function rr(ft,ze){this.options=ze||{},this.features=ft,this.length=ft.length}function ln(ft,ze){this.id=typeof ft.id=="number"?ft.id:void 0,this.type=ft.type,this.rawGeometry=ft.type===1?[ft.geometry]:ft.geometry,this.properties=ft.tags,this.extent=ze||4096}rr.prototype.feature=function(ft){return new ln(this.features[ft],this.options.extent)},ln.prototype.loadGeometry=function(){var ft=this.rawGeometry;this.geometry=[];for(var ze=0;ze<ft.length;ze++){for(var Pe=ft[ze],et=[],gt=0;gt<Pe.length;gt++)et.push(new Ai(Pe[gt][0],Pe[gt][1]));this.geometry.push(et)}return this.geometry},ln.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ft=this.geometry,ze=1/0,Pe=-1/0,et=1/0,gt=-1/0,jt=0;jt<ft.length;jt++)for(var Ge=ft[jt],ei=0;ei<Ge.length;ei++){var kt=Ge[ei];ze=Math.min(ze,kt.x),Pe=Math.max(Pe,kt.x),et=Math.min(et,kt.y),gt=Math.max(gt,kt.y)}return[ze,et,Pe,gt]},ln.prototype.toGeoJSON=an.prototype.toGeoJSON;var mn=se.bA,Pt=Un;function Bt(ft){var ze=new mn;return(function(Pe,et){for(var gt in Pe.layers)et.writeMessage(3,Ni,Pe.layers[gt])})(ft,ze),ze.finish()}function Ni(ft,ze){var Pe;ze.writeVarintField(15,ft.version||1),ze.writeStringField(1,ft.name||""),ze.writeVarintField(5,ft.extent||4096);var et={keys:[],values:[],keycache:{},valuecache:{}};for(Pe=0;Pe<ft.length;Pe++)et.feature=ft.feature(Pe),ze.writeMessage(2,tn,et);var gt=et.keys;for(Pe=0;Pe<gt.length;Pe++)ze.writeStringField(3,gt[Pe]);var jt=et.values;for(Pe=0;Pe<jt.length;Pe++)ze.writeMessage(4,si,jt[Pe])}function tn(ft,ze){var Pe=ft.feature;Pe.id!==void 0&&ze.writeVarintField(1,Pe.id),ze.writeMessage(2,Li,ft),ze.writeVarintField(3,Pe.type),ze.writeMessage(4,Pr,Pe)}function Li(ft,ze){var Pe=ft.feature,et=ft.keys,gt=ft.values,jt=ft.keycache,Ge=ft.valuecache;for(var ei in Pe.properties){var kt=Pe.properties[ei],Pi=jt[ei];if(kt!==null){Pi===void 0&&(et.push(ei),jt[ei]=Pi=et.length-1),ze.writeVarint(Pi);var fi=typeof kt;fi!=="string"&&fi!=="boolean"&&fi!=="number"&&(kt=JSON.stringify(kt));var ui=fi+":"+kt,kn=Ge[ui];kn===void 0&&(gt.push(kt),Ge[ui]=kn=gt.length-1),ze.writeVarint(kn)}}}function Wi(ft,ze){return(ze<<3)+(7&ft)}function cr(ft){return ft<<1^ft>>31}function Pr(ft,ze){for(var Pe=ft.loadGeometry(),et=ft.type,gt=0,jt=0,Ge=Pe.length,ei=0;ei<Ge;ei++){var kt=Pe[ei],Pi=1;et===1&&(Pi=kt.length),ze.writeVarint(Wi(1,Pi));for(var fi=et===3?kt.length-1:kt.length,ui=0;ui<fi;ui++){ui===1&&et!==1&&ze.writeVarint(Wi(2,fi-1));var kn=kt[ui].x-gt,fr=kt[ui].y-jt;ze.writeVarint(cr(kn)),ze.writeVarint(cr(fr)),gt+=kn,jt+=fr}et===3&&ze.writeVarint(Wi(7,1))}}function si(ft,ze){var Pe=typeof ft;Pe==="string"?ze.writeStringField(1,ft):Pe==="boolean"?ze.writeBooleanField(7,ft):Pe==="number"&&(ft%1!=0?ze.writeDoubleField(3,ft):ft<0?ze.writeSVarintField(6,ft):ze.writeVarintField(5,ft))}on.exports=Bt,on.exports.fromVectorTileJs=Bt,on.exports.fromGeojsonVt=function(ft,ze){ze=ze||{};var Pe={};for(var et in ft)Pe[et]=new Pt(ft[et].features,ze),Pe[et].name=et,Pe[et].version=ze.version,Pe[et].extent=ze.extent;return Bt({layers:Pe})},on.exports.GeoJSONWrapper=Pt;var xi=se.by(on.exports);const Tn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ft=>ft},zn=Math.fround||(Er=new Float32Array(1),ft=>(Er[0]=+ft,Er[0]));var Er;const Et=3,di=5,mi=6;class vn{constructor(ze){this.options=Object.assign(Object.create(Tn),ze),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ze){const{log:Pe,minZoom:et,maxZoom:gt}=this.options;Pe&&console.time("total time");const jt=`prepare ${ze.length} points`;Pe&&console.time(jt),this.points=ze;const Ge=[];for(let kt=0;kt<ze.length;kt++){const Pi=ze[kt];if(!Pi.geometry)continue;const[fi,ui]=Pi.geometry.coordinates,kn=zn(Gr(fi)),fr=zn(gr(ui));Ge.push(kn,fr,1/0,kt,-1,1),this.options.reduce&&Ge.push(0)}let ei=this.trees[gt+1]=this._createTree(Ge);Pe&&console.timeEnd(jt);for(let kt=gt;kt>=et;kt--){const Pi=+Date.now();ei=this.trees[kt]=this._createTree(this._cluster(ei,kt)),Pe&&console.log("z%d: %d clusters in %dms",kt,ei.numItems,+Date.now()-Pi)}return Pe&&console.timeEnd("total time"),this}getClusters(ze,Pe){let et=((ze[0]+180)%360+360)%360-180;const gt=Math.max(-90,Math.min(90,ze[1]));let jt=ze[2]===180?180:((ze[2]+180)%360+360)%360-180;const Ge=Math.max(-90,Math.min(90,ze[3]));if(ze[2]-ze[0]>=360)et=-180,jt=180;else if(et>jt){const ui=this.getClusters([et,gt,180,Ge],Pe),kn=this.getClusters([-180,gt,jt,Ge],Pe);return ui.concat(kn)}const ei=this.trees[this._limitZoom(Pe)],kt=ei.range(Gr(et),gr(Ge),Gr(jt),gr(gt)),Pi=ei.data,fi=[];for(const ui of kt){const kn=this.stride*ui;fi.push(Pi[kn+di]>1?tr(Pi,kn,this.clusterProps):this.points[Pi[kn+Et]])}return fi}getChildren(ze){const Pe=this._getOriginId(ze),et=this._getOriginZoom(ze),gt="No cluster with the specified id.",jt=this.trees[et];if(!jt)throw new Error(gt);const Ge=jt.data;if(Pe*this.stride>=Ge.length)throw new Error(gt);const ei=this.options.radius/(this.options.extent*Math.pow(2,et-1)),kt=jt.within(Ge[Pe*this.stride],Ge[Pe*this.stride+1],ei),Pi=[];for(const fi of kt){const ui=fi*this.stride;Ge[ui+4]===ze&&Pi.push(Ge[ui+di]>1?tr(Ge,ui,this.clusterProps):this.points[Ge[ui+Et]])}if(Pi.length===0)throw new Error(gt);return Pi}getLeaves(ze,Pe,et){const gt=[];return this._appendLeaves(gt,ze,Pe=Pe||10,et=et||0,0),gt}getTile(ze,Pe,et){const gt=this.trees[this._limitZoom(ze)],jt=Math.pow(2,ze),{extent:Ge,radius:ei}=this.options,kt=ei/Ge,Pi=(et-kt)/jt,fi=(et+1+kt)/jt,ui={features:[]};return this._addTileFeatures(gt.range((Pe-kt)/jt,Pi,(Pe+1+kt)/jt,fi),gt.data,Pe,et,jt,ui),Pe===0&&this._addTileFeatures(gt.range(1-kt/jt,Pi,1,fi),gt.data,jt,et,jt,ui),Pe===jt-1&&this._addTileFeatures(gt.range(0,Pi,kt/jt,fi),gt.data,-1,et,jt,ui),ui.features.length?ui:null}getClusterExpansionZoom(ze){let Pe=this._getOriginZoom(ze)-1;for(;Pe<=this.options.maxZoom;){const et=this.getChildren(ze);if(Pe++,et.length!==1)break;ze=et[0].properties.cluster_id}return Pe}_appendLeaves(ze,Pe,et,gt,jt){const Ge=this.getChildren(Pe);for(const ei of Ge){const kt=ei.properties;if(kt&&kt.cluster?jt+kt.point_count<=gt?jt+=kt.point_count:jt=this._appendLeaves(ze,kt.cluster_id,et,gt,jt):jt<gt?jt++:ze.push(ei),ze.length===et)break}return jt}_createTree(ze){const Pe=new se.av(ze.length/this.stride|0,this.options.nodeSize,Float32Array);for(let et=0;et<ze.length;et+=this.stride)Pe.add(ze[et],ze[et+1]);return Pe.finish(),Pe.data=ze,Pe}_addTileFeatures(ze,Pe,et,gt,jt,Ge){for(const ei of ze){const kt=ei*this.stride,Pi=Pe[kt+di]>1;let fi,ui,kn;if(Pi)fi=vr(Pe,kt,this.clusterProps),ui=Pe[kt],kn=Pe[kt+1];else{const ct=this.points[Pe[kt+Et]];fi=ct.properties;const[te,_e]=ct.geometry.coordinates;ui=Gr(te),kn=gr(_e)}const fr={type:1,geometry:[[Math.round(this.options.extent*(ui*jt-et)),Math.round(this.options.extent*(kn*jt-gt))]],tags:fi};let Cr;Cr=Pi||this.options.generateId?Pe[kt+Et]:this.points[Pe[kt+Et]].id,Cr!==void 0&&(fr.id=Cr),Ge.features.push(fr)}}_limitZoom(ze){return Math.max(this.options.minZoom,Math.min(Math.floor(+ze),this.options.maxZoom+1))}_cluster(ze,Pe){const{radius:et,extent:gt,reduce:jt,minPoints:Ge}=this.options,ei=et/(gt*Math.pow(2,Pe)),kt=ze.data,Pi=[],fi=this.stride;for(let ui=0;ui<kt.length;ui+=fi){if(kt[ui+2]<=Pe)continue;kt[ui+2]=Pe;const kn=kt[ui],fr=kt[ui+1],Cr=ze.within(kt[ui],kt[ui+1],ei),ct=kt[ui+di];let te=ct;for(const _e of Cr){const Re=_e*fi;kt[Re+2]>Pe&&(te+=kt[Re+di])}if(te>ct&&te>=Ge){let _e,Re=kn*ct,tt=fr*ct,Xe=-1;const at=((ui/fi|0)<<5)+(Pe+1)+this.points.length;for(const St of Cr){const lt=St*fi;if(kt[lt+2]<=Pe)continue;kt[lt+2]=Pe;const It=kt[lt+di];Re+=kt[lt]*It,tt+=kt[lt+1]*It,kt[lt+4]=at,jt&&(_e||(_e=this._map(kt,ui,!0),Xe=this.clusterProps.length,this.clusterProps.push(_e)),jt(_e,this._map(kt,lt)))}kt[ui+4]=at,Pi.push(Re/te,tt/te,1/0,at,-1,te),jt&&Pi.push(Xe)}else{for(let _e=0;_e<fi;_e++)Pi.push(kt[ui+_e]);if(te>1)for(const _e of Cr){const Re=_e*fi;if(!(kt[Re+2]<=Pe)){kt[Re+2]=Pe;for(let tt=0;tt<fi;tt++)Pi.push(kt[Re+tt])}}}}return Pi}_getOriginId(ze){return ze-this.points.length>>5}_getOriginZoom(ze){return(ze-this.points.length)%32}_map(ze,Pe,et){if(ze[Pe+di]>1){const Ge=this.clusterProps[ze[Pe+mi]];return et?Object.assign({},Ge):Ge}const gt=this.points[ze[Pe+Et]].properties,jt=this.options.map(gt);return et&&jt===gt?Object.assign({},jt):jt}}function tr(ft,ze,Pe){return{type:"Feature",id:ft[ze+Et],properties:vr(ft,ze,Pe),geometry:{type:"Point",coordinates:[(et=ft[ze],360*(et-.5)),In(ft[ze+1])]}};var et}function vr(ft,ze,Pe){const et=ft[ze+di],gt=et>=1e4?`${Math.round(et/1e3)}k`:et>=1e3?Math.round(et/100)/10+"k":et,jt=ft[ze+mi],Ge=jt===-1?{}:Object.assign({},Pe[jt]);return Object.assign(Ge,{cluster:!0,cluster_id:ft[ze+Et],point_count:et,point_count_abbreviated:gt})}function Gr(ft){return ft/360+.5}function gr(ft){const ze=Math.sin(ft*Math.PI/180),Pe=.5-.25*Math.log((1+ze)/(1-ze))/Math.PI;return Pe<0?0:Pe>1?1:Pe}function In(ft){const ze=(180-360*ft)*Math.PI/180;return 360*Math.atan(Math.exp(ze))/Math.PI-90}function Lr(ft,ze,Pe,et){let gt=et;const jt=ze+(Pe-ze>>1);let Ge,ei=Pe-ze;const kt=ft[ze],Pi=ft[ze+1],fi=ft[Pe],ui=ft[Pe+1];for(let kn=ze+3;kn<Pe;kn+=3){const fr=br(ft[kn],ft[kn+1],kt,Pi,fi,ui);if(fr>gt)Ge=kn,gt=fr;else if(fr===gt){const Cr=Math.abs(kn-jt);Cr<ei&&(Ge=kn,ei=Cr)}}gt>et&&(Ge-ze>3&&Lr(ft,ze,Ge,et),ft[Ge+2]=gt,Pe-Ge>3&&Lr(ft,Ge,Pe,et))}function br(ft,ze,Pe,et,gt,jt){let Ge=gt-Pe,ei=jt-et;if(Ge!==0||ei!==0){const kt=((ft-Pe)*Ge+(ze-et)*ei)/(Ge*Ge+ei*ei);kt>1?(Pe=gt,et=jt):kt>0&&(Pe+=Ge*kt,et+=ei*kt)}return Ge=ft-Pe,ei=ze-et,Ge*Ge+ei*ei}function ma(ft,ze,Pe,et){const gt={id:ft??null,type:ze,geometry:Pe,tags:et,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ze==="Point"||ze==="MultiPoint"||ze==="LineString")Kr(gt,Pe);else if(ze==="Polygon")Kr(gt,Pe[0]);else if(ze==="MultiLineString")for(const jt of Pe)Kr(gt,jt);else if(ze==="MultiPolygon")for(const jt of Pe)Kr(gt,jt[0]);return gt}function Kr(ft,ze){for(let Pe=0;Pe<ze.length;Pe+=3)ft.minX=Math.min(ft.minX,ze[Pe]),ft.minY=Math.min(ft.minY,ze[Pe+1]),ft.maxX=Math.max(ft.maxX,ze[Pe]),ft.maxY=Math.max(ft.maxY,ze[Pe+1])}function oa(ft,ze,Pe,et){if(!ze.geometry)return;const gt=ze.geometry.coordinates;if(gt&&gt.length===0)return;const jt=ze.geometry.type,Ge=Math.pow(Pe.tolerance/((1<<Pe.maxZoom)*Pe.extent),2);let ei=[],kt=ze.id;if(Pe.promoteId?kt=ze.properties[Pe.promoteId]:Pe.generateId&&(kt=et||0),jt==="Point")Ma(gt,ei);else if(jt==="MultiPoint")for(const Pi of gt)Ma(Pi,ei);else if(jt==="LineString")$t(gt,ei,Ge,!1);else if(jt==="MultiLineString"){if(Pe.lineMetrics){for(const Pi of gt)ei=[],$t(Pi,ei,Ge,!1),ft.push(ma(kt,"LineString",ei,ze.properties));return}Va(gt,ei,Ge,!1)}else if(jt==="Polygon")Va(gt,ei,Ge,!0);else{if(jt!=="MultiPolygon"){if(jt==="GeometryCollection"){for(const Pi of ze.geometry.geometries)oa(ft,{id:kt,geometry:Pi,properties:ze.properties},Pe,et);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Pi of gt){const fi=[];Va(Pi,fi,Ge,!0),ei.push(fi)}}ft.push(ma(kt,jt,ei,ze.properties))}function Ma(ft,ze){ze.push(Ir(ft[0]),Ar(ft[1]),0)}function $t(ft,ze,Pe,et){let gt,jt,Ge=0;for(let kt=0;kt<ft.length;kt++){const Pi=Ir(ft[kt][0]),fi=Ar(ft[kt][1]);ze.push(Pi,fi,0),kt>0&&(Ge+=et?(gt*fi-Pi*jt)/2:Math.sqrt(Math.pow(Pi-gt,2)+Math.pow(fi-jt,2))),gt=Pi,jt=fi}const ei=ze.length-3;ze[2]=1,Lr(ze,0,ei,Pe),ze[ei+2]=1,ze.size=Math.abs(Ge),ze.start=0,ze.end=ze.size}function Va(ft,ze,Pe,et){for(let gt=0;gt<ft.length;gt++){const jt=[];$t(ft[gt],jt,Pe,et),ze.push(jt)}}function Ir(ft){return ft/360+.5}function Ar(ft){const ze=Math.sin(ft*Math.PI/180),Pe=.5-.25*Math.log((1+ze)/(1-ze))/Math.PI;return Pe<0?0:Pe>1?1:Pe}function la(ft,ze,Pe,et,gt,jt,Ge,ei){if(et/=ze,jt>=(Pe/=ze)&&Ge<et)return ft;if(Ge<Pe||jt>=et)return null;const kt=[];for(const Pi of ft){const fi=Pi.geometry;let ui=Pi.type;const kn=gt===0?Pi.minX:Pi.minY,fr=gt===0?Pi.maxX:Pi.maxY;if(kn>=Pe&&fr<et){kt.push(Pi);continue}if(fr<Pe||kn>=et)continue;let Cr=[];if(ui==="Point"||ui==="MultiPoint")Po(fi,Cr,Pe,et,gt);else if(ui==="LineString")Qs(fi,Cr,Pe,et,gt,!1,ei.lineMetrics);else if(ui==="MultiLineString")Mr(fi,Cr,Pe,et,gt,!1);else if(ui==="Polygon")Mr(fi,Cr,Pe,et,gt,!0);else if(ui==="MultiPolygon")for(const ct of fi){const te=[];Mr(ct,te,Pe,et,gt,!0),te.length&&Cr.push(te)}if(Cr.length){if(ei.lineMetrics&&ui==="LineString"){for(const ct of Cr)kt.push(ma(Pi.id,ui,ct,Pi.tags));continue}ui!=="LineString"&&ui!=="MultiLineString"||(Cr.length===1?(ui="LineString",Cr=Cr[0]):ui="MultiLineString"),ui!=="Point"&&ui!=="MultiPoint"||(ui=Cr.length===3?"Point":"MultiPoint"),kt.push(ma(Pi.id,ui,Cr,Pi.tags))}}return kt.length?kt:null}function Po(ft,ze,Pe,et,gt){for(let jt=0;jt<ft.length;jt+=3){const Ge=ft[jt+gt];Ge>=Pe&&Ge<=et&&ws(ze,ft[jt],ft[jt+1],ft[jt+2])}}function Qs(ft,ze,Pe,et,gt,jt,Ge){let ei=Io(ft);const kt=gt===0?Ds:Ps;let Pi,fi,ui=ft.start;for(let te=0;te<ft.length-3;te+=3){const _e=ft[te],Re=ft[te+1],tt=ft[te+2],Xe=ft[te+3],at=ft[te+4],St=gt===0?_e:Re,lt=gt===0?Xe:at;let It=!1;Ge&&(Pi=Math.sqrt(Math.pow(_e-Xe,2)+Math.pow(Re-at,2))),St<Pe?lt>Pe&&(fi=kt(ei,_e,Re,Xe,at,Pe),Ge&&(ei.start=ui+Pi*fi)):St>et?lt<et&&(fi=kt(ei,_e,Re,Xe,at,et),Ge&&(ei.start=ui+Pi*fi)):ws(ei,_e,Re,tt),lt<Pe&&St>=Pe&&(fi=kt(ei,_e,Re,Xe,at,Pe),It=!0),lt>et&&St<=et&&(fi=kt(ei,_e,Re,Xe,at,et),It=!0),!jt&&It&&(Ge&&(ei.end=ui+Pi*fi),ze.push(ei),ei=Io(ft)),Ge&&(ui+=Pi)}let kn=ft.length-3;const fr=ft[kn],Cr=ft[kn+1],ct=gt===0?fr:Cr;ct>=Pe&&ct<=et&&ws(ei,fr,Cr,ft[kn+2]),kn=ei.length-3,jt&&kn>=3&&(ei[kn]!==ei[0]||ei[kn+1]!==ei[1])&&ws(ei,ei[0],ei[1],ei[2]),ei.length&&ze.push(ei)}function Io(ft){const ze=[];return ze.size=ft.size,ze.start=ft.start,ze.end=ft.end,ze}function Mr(ft,ze,Pe,et,gt,jt){for(const Ge of ft)Qs(Ge,ze,Pe,et,gt,jt,!1)}function ws(ft,ze,Pe,et){ft.push(ze,Pe,et)}function Ds(ft,ze,Pe,et,gt,jt){const Ge=(jt-ze)/(et-ze);return ws(ft,jt,Pe+(gt-Pe)*Ge,1),Ge}function Ps(ft,ze,Pe,et,gt,jt){const Ge=(jt-Pe)/(gt-Pe);return ws(ft,ze+(et-ze)*Ge,jt,1),Ge}function Qt(ft,ze){const Pe=[];for(let et=0;et<ft.length;et++){const gt=ft[et],jt=gt.type;let Ge;if(jt==="Point"||jt==="MultiPoint"||jt==="LineString")Ge=Gn(gt.geometry,ze);else if(jt==="MultiLineString"||jt==="Polygon"){Ge=[];for(const ei of gt.geometry)Ge.push(Gn(ei,ze))}else if(jt==="MultiPolygon"){Ge=[];for(const ei of gt.geometry){const kt=[];for(const Pi of ei)kt.push(Gn(Pi,ze));Ge.push(kt)}}Pe.push(ma(gt.id,jt,Ge,gt.tags))}return Pe}function Gn(ft,ze){const Pe=[];Pe.size=ft.size,ft.start!==void 0&&(Pe.start=ft.start,Pe.end=ft.end);for(let et=0;et<ft.length;et+=3)Pe.push(ft[et]+ze,ft[et+1],ft[et+2]);return Pe}function Ta(ft,ze){if(ft.transformed)return ft;const Pe=1<<ft.z,et=ft.x,gt=ft.y;for(const jt of ft.features){const Ge=jt.geometry,ei=jt.type;if(jt.geometry=[],ei===1)for(let kt=0;kt<Ge.length;kt+=2)jt.geometry.push(Ha(Ge[kt],Ge[kt+1],ze,Pe,et,gt));else for(let kt=0;kt<Ge.length;kt++){const Pi=[];for(let fi=0;fi<Ge[kt].length;fi+=2)Pi.push(Ha(Ge[kt][fi],Ge[kt][fi+1],ze,Pe,et,gt));jt.geometry.push(Pi)}}return ft.transformed=!0,ft}function Ha(ft,ze,Pe,et,gt,jt){return[Math.round(Pe*(ft*et-gt)),Math.round(Pe*(ze*et-jt))]}function ms(ft,ze,Pe,et,gt){const jt=ze===gt.maxZoom?0:gt.tolerance/((1<<ze)*gt.extent),Ge={features:[],numPoints:0,numSimplified:0,numFeatures:ft.length,source:null,x:Pe,y:et,z:ze,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ei of ft)xn(Ge,ei,jt,gt);return Ge}function xn(ft,ze,Pe,et){const gt=ze.geometry,jt=ze.type,Ge=[];if(ft.minX=Math.min(ft.minX,ze.minX),ft.minY=Math.min(ft.minY,ze.minY),ft.maxX=Math.max(ft.maxX,ze.maxX),ft.maxY=Math.max(ft.maxY,ze.maxY),jt==="Point"||jt==="MultiPoint")for(let ei=0;ei<gt.length;ei+=3)Ge.push(gt[ei],gt[ei+1]),ft.numPoints++,ft.numSimplified++;else if(jt==="LineString")er(Ge,gt,ft,Pe,!1,!1);else if(jt==="MultiLineString"||jt==="Polygon")for(let ei=0;ei<gt.length;ei++)er(Ge,gt[ei],ft,Pe,jt==="Polygon",ei===0);else if(jt==="MultiPolygon")for(let ei=0;ei<gt.length;ei++){const kt=gt[ei];for(let Pi=0;Pi<kt.length;Pi++)er(Ge,kt[Pi],ft,Pe,!0,Pi===0)}if(Ge.length){let ei=ze.tags||null;if(jt==="LineString"&&et.lineMetrics){ei={};for(const Pi in ze.tags)ei[Pi]=ze.tags[Pi];ei.mapbox_clip_start=gt.start/gt.size,ei.mapbox_clip_end=gt.end/gt.size}const kt={geometry:Ge,type:jt==="Polygon"||jt==="MultiPolygon"?3:jt==="LineString"||jt==="MultiLineString"?2:1,tags:ei};ze.id!==null&&(kt.id=ze.id),ft.features.push(kt)}}function er(ft,ze,Pe,et,gt,jt){const Ge=et*et;if(et>0&&ze.size<(gt?Ge:et))return void(Pe.numPoints+=ze.length/3);const ei=[];for(let kt=0;kt<ze.length;kt+=3)(et===0||ze[kt+2]>Ge)&&(Pe.numSimplified++,ei.push(ze[kt],ze[kt+1])),Pe.numPoints++;gt&&(function(kt,Pi){let fi=0;for(let ui=0,kn=kt.length,fr=kn-2;ui<kn;fr=ui,ui+=2)fi+=(kt[ui]-kt[fr])*(kt[ui+1]+kt[fr+1]);if(fi>0===Pi)for(let ui=0,kn=kt.length;ui<kn/2;ui+=2){const fr=kt[ui],Cr=kt[ui+1];kt[ui]=kt[kn-2-ui],kt[ui+1]=kt[kn-1-ui],kt[kn-2-ui]=fr,kt[kn-1-ui]=Cr}})(ei,jt),ft.push(ei)}const sr={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Xs{constructor(ze,Pe){const et=(Pe=this.options=(function(jt,Ge){for(const ei in Ge)jt[ei]=Ge[ei];return jt})(Object.create(sr),Pe)).debug;if(et&&console.time("preprocess data"),Pe.maxZoom<0||Pe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Pe.promoteId&&Pe.generateId)throw new Error("promoteId and generateId cannot be used together.");let gt=(function(jt,Ge){const ei=[];if(jt.type==="FeatureCollection")for(let kt=0;kt<jt.features.length;kt++)oa(ei,jt.features[kt],Ge,kt);else oa(ei,jt.type==="Feature"?jt:{geometry:jt},Ge);return ei})(ze,Pe);this.tiles={},this.tileCoords=[],et&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Pe.indexMaxZoom,Pe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),gt=(function(jt,Ge){const ei=Ge.buffer/Ge.extent;let kt=jt;const Pi=la(jt,1,-1-ei,ei,0,-1,2,Ge),fi=la(jt,1,1-ei,2+ei,0,-1,2,Ge);return(Pi||fi)&&(kt=la(jt,1,-ei,1+ei,0,-1,2,Ge)||[],Pi&&(kt=Qt(Pi,1).concat(kt)),fi&&(kt=kt.concat(Qt(fi,-1)))),kt})(gt,Pe),gt.length&&this.splitTile(gt,0,0,0),et&&(gt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ze,Pe,et,gt,jt,Ge,ei){const kt=[ze,Pe,et,gt],Pi=this.options,fi=Pi.debug;for(;kt.length;){gt=kt.pop(),et=kt.pop(),Pe=kt.pop(),ze=kt.pop();const ui=1<<Pe,kn=fl(Pe,et,gt);let fr=this.tiles[kn];if(!fr&&(fi>1&&console.time("creation"),fr=this.tiles[kn]=ms(ze,Pe,et,gt,Pi),this.tileCoords.push({z:Pe,x:et,y:gt}),fi)){fi>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Pe,et,gt,fr.numFeatures,fr.numPoints,fr.numSimplified),console.timeEnd("creation"));const It=`z${Pe}`;this.stats[It]=(this.stats[It]||0)+1,this.total++}if(fr.source=ze,jt==null){if(Pe===Pi.indexMaxZoom||fr.numPoints<=Pi.indexMaxPoints)continue}else{if(Pe===Pi.maxZoom||Pe===jt)continue;if(jt!=null){const It=jt-Pe;if(et!==Ge>>It||gt!==ei>>It)continue}}if(fr.source=null,ze.length===0)continue;fi>1&&console.time("clipping");const Cr=.5*Pi.buffer/Pi.extent,ct=.5-Cr,te=.5+Cr,_e=1+Cr;let Re=null,tt=null,Xe=null,at=null,St=la(ze,ui,et-Cr,et+te,0,fr.minX,fr.maxX,Pi),lt=la(ze,ui,et+ct,et+_e,0,fr.minX,fr.maxX,Pi);ze=null,St&&(Re=la(St,ui,gt-Cr,gt+te,1,fr.minY,fr.maxY,Pi),tt=la(St,ui,gt+ct,gt+_e,1,fr.minY,fr.maxY,Pi),St=null),lt&&(Xe=la(lt,ui,gt-Cr,gt+te,1,fr.minY,fr.maxY,Pi),at=la(lt,ui,gt+ct,gt+_e,1,fr.minY,fr.maxY,Pi),lt=null),fi>1&&console.timeEnd("clipping"),kt.push(Re||[],Pe+1,2*et,2*gt),kt.push(tt||[],Pe+1,2*et,2*gt+1),kt.push(Xe||[],Pe+1,2*et+1,2*gt),kt.push(at||[],Pe+1,2*et+1,2*gt+1)}}getTile(ze,Pe,et){ze=+ze,Pe=+Pe,et=+et;const gt=this.options,{extent:jt,debug:Ge}=gt;if(ze<0||ze>24)return null;const ei=1<<ze,kt=fl(ze,Pe=Pe+ei&ei-1,et);if(this.tiles[kt])return Ta(this.tiles[kt],jt);Ge>1&&console.log("drilling down to z%d-%d-%d",ze,Pe,et);let Pi,fi=ze,ui=Pe,kn=et;for(;!Pi&&fi>0;)fi--,ui>>=1,kn>>=1,Pi=this.tiles[fl(fi,ui,kn)];return Pi&&Pi.source?(Ge>1&&(console.log("found parent tile z%d-%d-%d",fi,ui,kn),console.time("drilling down")),this.splitTile(Pi.source,fi,ui,kn,ze,Pe,et),Ge>1&&console.timeEnd("drilling down"),this.tiles[kt]?Ta(this.tiles[kt],jt):null):null}}function fl(ft,ze,Pe){return 32*((1<<ft)*Pe+ze)+ft}function Jr(ft,ze){return ze?ft.properties[ze]:ft.id}function pl(ft,ze){if(ft==null)return!0;if(ft.type==="Feature")return Jr(ft,ze)!=null;if(ft.type==="FeatureCollection"){const Pe=new Set;for(const et of ft.features){const gt=Jr(et,ze);if(gt==null||Pe.has(gt))return!1;Pe.add(gt)}return!0}return!1}function Uo(ft,ze){const Pe=new Map;if(ft!=null)if(ft.type==="Feature")Pe.set(Jr(ft,ze),ft);else for(const et of ft.features)Pe.set(Jr(et,ze),et);return Pe}class oc extends it{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(ze,Pe){return se._(this,void 0,void 0,(function*(){const et=ze.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const gt=this._geoJSONIndex.getTile(et.z,et.x,et.y);if(!gt)return null;const jt=new class{constructor(ei){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=se.X,this.length=ei.length,this._features=ei}feature(ei){return new class{constructor(kt){this._feature=kt,this.extent=se.X,this.type=kt.type,this.properties=kt.tags,"id"in kt&&!isNaN(kt.id)&&(this.id=parseInt(kt.id,10))}loadGeometry(){if(this._feature.type===1){const kt=[];for(const Pi of this._feature.geometry)kt.push([new se.P(Pi[0],Pi[1])]);return kt}{const kt=[];for(const Pi of this._feature.geometry){const fi=[];for(const ui of Pi)fi.push(new se.P(ui[0],ui[1]));kt.push(fi)}return kt}}toGeoJSON(kt,Pi,fi){return qi.call(this,kt,Pi,fi)}}(this._features[ei])}}(gt.features);let Ge=xi(jt);return Ge.byteOffset===0&&Ge.byteLength===Ge.buffer.byteLength||(Ge=new Uint8Array(Ge)),{vectorTile:jt,rawData:Ge.buffer}}))}loadData(ze){return se._(this,void 0,void 0,(function*(){var Pe;(Pe=this._pendingRequest)===null||Pe===void 0||Pe.abort();const et=!!(ze&&ze.request&&ze.request.collectResourceTiming)&&new se.bv(ze.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(ze,this._pendingRequest),this._geoJSONIndex=ze.cluster?new vn((function({superclusterOptions:Ge,clusterProperties:ei}){if(!ei||!Ge)return Ge;const kt={},Pi={},fi={accumulated:null,zoom:0},ui={properties:null},kn=Object.keys(ei);for(const fr of kn){const[Cr,ct]=ei[fr],te=se.bC(ct),_e=se.bC(typeof Cr=="string"?[Cr,["accumulated"],["get",fr]]:Cr);kt[fr]=te.value,Pi[fr]=_e.value}return Ge.map=fr=>{ui.properties=fr;const Cr={};for(const ct of kn)Cr[ct]=kt[ct].evaluate(fi,ui);return Cr},Ge.reduce=(fr,Cr)=>{ui.properties=Cr;for(const ct of kn)fi.accumulated=fr[ct],fr[ct]=Pi[ct].evaluate(fi,ui)},Ge})(ze)).load((yield this._pendingData).features):(gt=yield this._pendingData,new Xs(gt,ze.geojsonVtOptions)),this.loaded={};const jt={};if(et){const Ge=et.finish();Ge&&(jt.resourceTiming={},jt.resourceTiming[ze.source]=JSON.parse(JSON.stringify(Ge)))}return jt}catch(jt){if(delete this._pendingRequest,se.bB(jt))return{abandoned:!0};throw jt}var gt}))}getData(){return se._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(ze){const Pe=this.loaded;return Pe&&Pe[ze.uid]?super.reloadTile(ze):this.loadTile(ze)}loadAndProcessGeoJSON(ze,Pe){return se._(this,void 0,void 0,(function*(){let et=yield this.loadGeoJSON(ze,Pe);if(delete this._pendingRequest,typeof et!="object")throw new Error(`Input data given to '${ze.source}' is not a valid GeoJSON object.`);if(Vi(et,!0),ze.filter){const gt=se.bC(ze.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(gt.result==="error")throw new Error(gt.value.map((Ge=>`${Ge.key}: ${Ge.message}`)).join(", "));et={type:"FeatureCollection",features:et.features.filter((Ge=>gt.value.evaluate({zoom:0},Ge)))}}return et}))}loadGeoJSON(ze,Pe){return se._(this,void 0,void 0,(function*(){const{promoteId:et}=ze;if(ze.request){const gt=yield se.h(ze.request,Pe);return this._dataUpdateable=pl(gt.data,et)?Uo(gt.data,et):void 0,gt.data}if(typeof ze.data=="string")try{const gt=JSON.parse(ze.data);return this._dataUpdateable=pl(gt,et)?Uo(gt,et):void 0,gt}catch{throw new Error(`Input data given to '${ze.source}' is not a valid GeoJSON object.`)}if(!ze.dataDiff)throw new Error(`Input data given to '${ze.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${ze.source}`);return(function(gt,jt,Ge){var ei,kt,Pi,fi;if(jt.removeAll&&gt.clear(),jt.remove)for(const ui of jt.remove)gt.delete(ui);if(jt.add)for(const ui of jt.add){const kn=Jr(ui,Ge);kn!=null&&gt.set(kn,ui)}if(jt.update)for(const ui of jt.update){let kn=gt.get(ui.id);if(kn==null)continue;const fr=!ui.removeAllProperties&&(((ei=ui.removeProperties)===null||ei===void 0?void 0:ei.length)>0||((kt=ui.addOrUpdateProperties)===null||kt===void 0?void 0:kt.length)>0);if((ui.newGeometry||ui.removeAllProperties||fr)&&(kn=Object.assign({},kn),gt.set(ui.id,kn),fr&&(kn.properties=Object.assign({},kn.properties))),ui.newGeometry&&(kn.geometry=ui.newGeometry),ui.removeAllProperties)kn.properties={};else if(((Pi=ui.removeProperties)===null||Pi===void 0?void 0:Pi.length)>0)for(const Cr of ui.removeProperties)Object.prototype.hasOwnProperty.call(kn.properties,Cr)&&delete kn.properties[Cr];if(((fi=ui.addOrUpdateProperties)===null||fi===void 0?void 0:fi.length)>0)for(const{key:Cr,value:ct}of ui.addOrUpdateProperties)kn.properties[Cr]=ct}})(this._dataUpdateable,ze.dataDiff,et),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(ze){return se._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(ze){return this._geoJSONIndex.getClusterExpansionZoom(ze.clusterId)}getClusterChildren(ze){return this._geoJSONIndex.getChildren(ze.clusterId)}getClusterLeaves(ze){return this._geoJSONIndex.getLeaves(ze.clusterId,ze.limit,ze.offset)}}class cl{constructor(ze){this.self=ze,this.actor=new se.F(ze),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Pe,et)=>{if(this.externalWorkerSourceTypes[Pe])throw new Error(`Worker source with name "${Pe}" already registered.`);this.externalWorkerSourceTypes[Pe]=et},this.self.addProtocol=se.bi,this.self.removeProtocol=se.bj,this.self.registerRTLTextPlugin=Pe=>{if(se.bD.isParsed())throw new Error("RTL text plugin already registered.");se.bD.setMethods(Pe)},this.actor.registerMessageHandler("LDT",((Pe,et)=>this._getDEMWorkerSource(Pe,et.source).loadTile(et))),this.actor.registerMessageHandler("RDT",((Pe,et)=>se._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Pe,et.source).removeTile(et)})))),this.actor.registerMessageHandler("GCEZ",((Pe,et)=>se._(this,void 0,void 0,(function*(){return this._getWorkerSource(Pe,et.type,et.source).getClusterExpansionZoom(et)})))),this.actor.registerMessageHandler("GCC",((Pe,et)=>se._(this,void 0,void 0,(function*(){return this._getWorkerSource(Pe,et.type,et.source).getClusterChildren(et)})))),this.actor.registerMessageHandler("GCL",((Pe,et)=>se._(this,void 0,void 0,(function*(){return this._getWorkerSource(Pe,et.type,et.source).getClusterLeaves(et)})))),this.actor.registerMessageHandler("LD",((Pe,et)=>this._getWorkerSource(Pe,et.type,et.source).loadData(et))),this.actor.registerMessageHandler("GD",((Pe,et)=>this._getWorkerSource(Pe,et.type,et.source).getData())),this.actor.registerMessageHandler("LT",((Pe,et)=>this._getWorkerSource(Pe,et.type,et.source).loadTile(et))),this.actor.registerMessageHandler("RT",((Pe,et)=>this._getWorkerSource(Pe,et.type,et.source).reloadTile(et))),this.actor.registerMessageHandler("AT",((Pe,et)=>this._getWorkerSource(Pe,et.type,et.source).abortTile(et))),this.actor.registerMessageHandler("RMT",((Pe,et)=>this._getWorkerSource(Pe,et.type,et.source).removeTile(et))),this.actor.registerMessageHandler("RS",((Pe,et)=>se._(this,void 0,void 0,(function*(){if(!this.workerSources[Pe]||!this.workerSources[Pe][et.type]||!this.workerSources[Pe][et.type][et.source])return;const gt=this.workerSources[Pe][et.type][et.source];delete this.workerSources[Pe][et.type][et.source],gt.removeSource!==void 0&&gt.removeSource(et)})))),this.actor.registerMessageHandler("RM",(Pe=>se._(this,void 0,void 0,(function*(){delete this.layerIndexes[Pe],delete this.availableImages[Pe],delete this.workerSources[Pe],delete this.demWorkerSources[Pe]})))),this.actor.registerMessageHandler("SR",((Pe,et)=>se._(this,void 0,void 0,(function*(){this.referrer=et})))),this.actor.registerMessageHandler("SRPS",((Pe,et)=>this._syncRTLPluginState(Pe,et))),this.actor.registerMessageHandler("IS",((Pe,et)=>se._(this,void 0,void 0,(function*(){this.self.importScripts(et)})))),this.actor.registerMessageHandler("SI",((Pe,et)=>this._setImages(Pe,et))),this.actor.registerMessageHandler("UL",((Pe,et)=>se._(this,void 0,void 0,(function*(){this._getLayerIndex(Pe).update(et.layers,et.removedIds)})))),this.actor.registerMessageHandler("SL",((Pe,et)=>se._(this,void 0,void 0,(function*(){this._getLayerIndex(Pe).replace(et)}))))}_setImages(ze,Pe){return se._(this,void 0,void 0,(function*(){this.availableImages[ze]=Pe;for(const et in this.workerSources[ze]){const gt=this.workerSources[ze][et];for(const jt in gt)gt[jt].availableImages=Pe}}))}_syncRTLPluginState(ze,Pe){return se._(this,void 0,void 0,(function*(){if(se.bD.isParsed())return se.bD.getState();if(Pe.pluginStatus!=="loading")return se.bD.setState(Pe),Pe;const et=Pe.pluginURL;if(this.self.importScripts(et),se.bD.isParsed()){const gt={pluginStatus:"loaded",pluginURL:et};return se.bD.setState(gt),gt}throw se.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${et}`)}))}_getAvailableImages(ze){let Pe=this.availableImages[ze];return Pe||(Pe=[]),Pe}_getLayerIndex(ze){let Pe=this.layerIndexes[ze];return Pe||(Pe=this.layerIndexes[ze]=new n),Pe}_getWorkerSource(ze,Pe,et){if(this.workerSources[ze]||(this.workerSources[ze]={}),this.workerSources[ze][Pe]||(this.workerSources[ze][Pe]={}),!this.workerSources[ze][Pe][et]){const gt={sendAsync:(jt,Ge)=>(jt.targetMapId=ze,this.actor.sendAsync(jt,Ge))};switch(Pe){case"vector":this.workerSources[ze][Pe][et]=new it(gt,this._getLayerIndex(ze),this._getAvailableImages(ze));break;case"geojson":this.workerSources[ze][Pe][et]=new oc(gt,this._getLayerIndex(ze),this._getAvailableImages(ze));break;default:this.workerSources[ze][Pe][et]=new this.externalWorkerSourceTypes[Pe](gt,this._getLayerIndex(ze),this._getAvailableImages(ze))}}return this.workerSources[ze][Pe][et]}_getDEMWorkerSource(ze,Pe){return this.demWorkerSources[ze]||(this.demWorkerSources[ze]={}),this.demWorkerSources[ze][Pe]||(this.demWorkerSources[ze][Pe]=new ht),this.demWorkerSources[ze][Pe]}}return se.i(self)&&(self.worker=new cl(self)),cl})),Ae("index",["exports","./shared"],(function(se,n){var ke="4.7.1";let Fe,pt;const it={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:L=>new Promise(((o,v)=>{const A=requestAnimationFrame(o);L.signal.addEventListener("abort",(()=>{cancelAnimationFrame(A),v(n.c())}))})),getImageData(L,o=0){return this.getImageCanvasContext(L).getImageData(-o,-o,L.width+2*o,L.height+2*o)},getImageCanvasContext(L){const o=window.document.createElement("canvas"),v=o.getContext("2d",{willReadFrequently:!0});if(!v)throw new Error("failed to create canvas 2d context");return o.width=L.width,o.height=L.height,v.drawImage(L,0,0,L.width,L.height),v},resolveURL:L=>(Fe||(Fe=document.createElement("a")),Fe.href=L,Fe.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(pt==null&&(pt=matchMedia("(prefers-reduced-motion: reduce)")),pt.matches)}};class ht{static testProp(o){if(!ht.docStyle)return o[0];for(let v=0;v<o.length;v++)if(o[v]in ht.docStyle)return o[v];return o[0]}static create(o,v,A){const M=window.document.createElement(o);return v!==void 0&&(M.className=v),A&&A.appendChild(M),M}static createNS(o,v){return window.document.createElementNS(o,v)}static disableDrag(){ht.docStyle&&ht.selectProp&&(ht.userSelect=ht.docStyle[ht.selectProp],ht.docStyle[ht.selectProp]="none")}static enableDrag(){ht.docStyle&&ht.selectProp&&(ht.docStyle[ht.selectProp]=ht.userSelect)}static setTransform(o,v){o.style[ht.transformProp]=v}static addEventListener(o,v,A,M={}){o.addEventListener(v,A,"passive"in M?M:M.capture)}static removeEventListener(o,v,A,M={}){o.removeEventListener(v,A,"passive"in M?M:M.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",ht.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",ht.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",ht.suppressClickInternal,!0)}),0)}static getScale(o){const v=o.getBoundingClientRect();return{x:v.width/o.offsetWidth||1,y:v.height/o.offsetHeight||1,boundingClientRect:v}}static getPoint(o,v,A){const M=v.boundingClientRect;return new n.P((A.clientX-M.left)/v.x-o.clientLeft,(A.clientY-M.top)/v.y-o.clientTop)}static mousePos(o,v){const A=ht.getScale(o);return ht.getPoint(o,A,v)}static touchPos(o,v){const A=[],M=ht.getScale(o);for(let P=0;P<v.length;P++)A.push(ht.getPoint(o,M,v[P]));return A}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}ht.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,ht.selectProp=ht.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),ht.transformProp=ht.testProp(["transform","WebkitTransform"]);const Ci={supported:!1,testSupport:function(L){!qi&&Vi&&(on?Ai(L):Ui=L)}};let Ui,Vi,qi=!1,on=!1;function Ai(L){const o=L.createTexture();L.bindTexture(L.TEXTURE_2D,o);try{if(L.texImage2D(L.TEXTURE_2D,0,L.RGBA,L.RGBA,L.UNSIGNED_BYTE,Vi),L.isContextLost())return;Ci.supported=!0}catch{}L.deleteTexture(o),qi=!0}var an;typeof document<"u"&&(Vi=document.createElement("img"),Vi.onload=()=>{Ui&&Ai(Ui),Ui=null,on=!0},Vi.onerror=()=>{qi=!0,Ui=null},Vi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(L){let o,v,A,M;L.resetRequestQueue=()=>{o=[],v=0,A=0,M={}},L.addThrottleControl=ne=>{const fe=A++;return M[fe]=ne,fe},L.removeThrottleControl=ne=>{delete M[ne],q()},L.getImage=(ne,fe,we=!0)=>new Promise(((Te,Be)=>{Ci.supported&&(ne.headers||(ne.headers={}),ne.headers.accept="image/webp,*/*"),n.e(ne,{type:"image"}),o.push({abortController:fe,requestParameters:ne,supportImageRefresh:we,state:"queued",onError:Ke=>{Be(Ke)},onSuccess:Ke=>{Te(Ke)}}),q()}));const P=ne=>n._(this,void 0,void 0,(function*(){ne.state="running";const{requestParameters:fe,supportImageRefresh:we,onError:Te,onSuccess:Be,abortController:Ke}=ne,ot=we===!1&&!n.i(self)&&!n.g(fe.url)&&(!fe.headers||Object.keys(fe.headers).reduce(((Rt,Ft)=>Rt&&Ft==="accept"),!0));v++;const wt=ot?J(fe,Ke):n.m(fe,Ke);try{const Rt=yield wt;delete ne.abortController,ne.state="completed",Rt.data instanceof HTMLImageElement||n.b(Rt.data)?Be(Rt):Rt.data&&Be({data:yield(Mt=Rt.data,typeof createImageBitmap=="function"?n.d(Mt):n.f(Mt)),cacheControl:Rt.cacheControl,expires:Rt.expires})}catch(Rt){delete ne.abortController,Te(Rt)}finally{v--,q()}var Mt})),q=()=>{const ne=(()=>{for(const fe of Object.keys(M))if(M[fe]())return!0;return!1})()?n.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:n.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let fe=v;fe<ne&&o.length>0;fe++){const we=o.shift();we.abortController.signal.aborted?fe--:P(we)}},J=(ne,fe)=>new Promise(((we,Te)=>{const Be=new Image,Ke=ne.url,ot=ne.credentials;ot&&ot==="include"?Be.crossOrigin="use-credentials":(ot&&ot==="same-origin"||!n.s(Ke))&&(Be.crossOrigin="anonymous"),fe.signal.addEventListener("abort",(()=>{Be.src="",Te(n.c())})),Be.fetchPriority="high",Be.onload=()=>{Be.onerror=Be.onload=null,we({data:Be})},Be.onerror=()=>{Be.onerror=Be.onload=null,fe.signal.aborted||Te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Be.src=Ke}))})(an||(an={})),an.resetRequestQueue();class Un{constructor(o){this._transformRequestFn=o}transformRequest(o,v){return this._transformRequestFn&&this._transformRequestFn(o,v)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function rr(L){var o=new n.A(3);return o[0]=L[0],o[1]=L[1],o[2]=L[2],o}var ln,mn=function(L,o,v){return L[0]=o[0]-v[0],L[1]=o[1]-v[1],L[2]=o[2]-v[2],L};ln=new n.A(3),n.A!=Float32Array&&(ln[0]=0,ln[1]=0,ln[2]=0);var Pt=function(L){var o=L[0],v=L[1];return o*o+v*v};function Bt(L){const o=[];if(typeof L=="string")o.push({id:"default",url:L});else if(L&&L.length>0){const v=[];for(const{id:A,url:M}of L){const P=`${A}${M}`;v.indexOf(P)===-1&&(v.push(P),o.push({id:A,url:M}))}}return o}function Ni(L,o,v){const A=L.split("?");return A[0]+=`${o}${v}`,A.join("?")}(function(){var L=new n.A(2);n.A!=Float32Array&&(L[0]=0,L[1]=0)})();class tn{constructor(o,v,A,M){this.context=o,this.format=A,this.texture=o.gl.createTexture(),this.update(v,M)}update(o,v,A){const{width:M,height:P}=o,q=!(this.size&&this.size[0]===M&&this.size[1]===P||A),{context:J}=this,{gl:ne}=J;if(this.useMipmap=!!(v&&v.useMipmap),ne.bindTexture(ne.TEXTURE_2D,this.texture),J.pixelStoreUnpackFlipY.set(!1),J.pixelStoreUnpack.set(1),J.pixelStoreUnpackPremultiplyAlpha.set(this.format===ne.RGBA&&(!v||v.premultiply!==!1)),q)this.size=[M,P],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||n.b(o)?ne.texImage2D(ne.TEXTURE_2D,0,this.format,this.format,ne.UNSIGNED_BYTE,o):ne.texImage2D(ne.TEXTURE_2D,0,this.format,M,P,0,this.format,ne.UNSIGNED_BYTE,o.data);else{const{x:fe,y:we}=A||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||n.b(o)?ne.texSubImage2D(ne.TEXTURE_2D,0,fe,we,ne.RGBA,ne.UNSIGNED_BYTE,o):ne.texSubImage2D(ne.TEXTURE_2D,0,fe,we,M,P,ne.RGBA,ne.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&ne.generateMipmap(ne.TEXTURE_2D)}bind(o,v,A){const{context:M}=this,{gl:P}=M;P.bindTexture(P.TEXTURE_2D,this.texture),A!==P.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(A=P.LINEAR),o!==this.filter&&(P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,o),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,A||o),this.filter=o),v!==this.wrap&&(P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,v),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,v),this.wrap=v)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Li(L){const{userImage:o}=L;return!!(o&&o.render&&o.render())&&(L.data.replace(new Uint8Array(o.data.buffer)),!0)}class Wi extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:v,promiseResolve:A}of this.requestors)A(this._getImagesForIds(v));this.requestors=[]}}getImage(o){const v=this.images[o];if(v&&!v.data&&v.spriteData){const A=v.spriteData;v.data=new n.R({width:A.width,height:A.height},A.context.getImageData(A.x,A.y,A.width,A.height).data),v.spriteData=null}return v}addImage(o,v){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,v)&&(this.images[o]=v)}_validate(o,v){let A=!0;const M=v.data||v.spriteData;return this._validateStretch(v.stretchX,M&&M.width)||(this.fire(new n.j(new Error(`Image "${o}" has invalid "stretchX" value`))),A=!1),this._validateStretch(v.stretchY,M&&M.height)||(this.fire(new n.j(new Error(`Image "${o}" has invalid "stretchY" value`))),A=!1),this._validateContent(v.content,v)||(this.fire(new n.j(new Error(`Image "${o}" has invalid "content" value`))),A=!1),A}_validateStretch(o,v){if(!o)return!0;let A=0;for(const M of o){if(M[0]<A||M[1]<M[0]||v<M[1])return!1;A=M[1]}return!0}_validateContent(o,v){if(!o)return!0;if(o.length!==4)return!1;const A=v.spriteData,M=A&&A.width||v.data.width,P=A&&A.height||v.data.height;return!(o[0]<0||M<o[0]||o[1]<0||P<o[1]||o[2]<0||M<o[2]||o[3]<0||P<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,v,A=!0){const M=this.getImage(o);if(A&&(M.data.width!==v.data.width||M.data.height!==v.data.height))throw new Error(`size mismatch between old image (${M.data.width}x${M.data.height}) and new image (${v.data.width}x${v.data.height}).`);v.version=M.version+1,this.images[o]=v,this.updatedImages[o]=!0}removeImage(o){const v=this.images[o];delete this.images[o],delete this.patterns[o],v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise(((v,A)=>{let M=!0;if(!this.isLoaded())for(const P of o)this.images[P]||(M=!1);this.isLoaded()||M?v(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:v})}))}_getImagesForIds(o){const v={};for(const A of o){let M=this.getImage(A);M||(this.fire(new n.k("styleimagemissing",{id:A})),M=this.getImage(A)),M?v[A]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,textFitWidth:M.textFitWidth,textFitHeight:M.textFitHeight,hasRenderCallback:!!(M.userImage&&M.userImage.render)}:n.w(`Image "${A}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return v}getPixelSize(){const{width:o,height:v}=this.atlasImage;return{width:o,height:v}}getPattern(o){const v=this.patterns[o],A=this.getImage(o);if(!A)return null;if(v&&v.position.version===A.version)return v.position;if(v)v.position.version=A.version;else{const M={w:A.data.width+2,h:A.data.height+2,x:0,y:0},P=new n.I(M,A);this.patterns[o]={bin:M,position:P}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const v=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new tn(o,this.atlasImage,v.RGBA),this.atlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const P in this.patterns)o.push(this.patterns[P].bin);const{w:v,h:A}=n.p(o),M=this.atlasImage;M.resize({width:v||1,height:A||1});for(const P in this.patterns){const{bin:q}=this.patterns[P],J=q.x+1,ne=q.y+1,fe=this.getImage(P).data,we=fe.width,Te=fe.height;n.R.copy(fe,M,{x:0,y:0},{x:J,y:ne},{width:we,height:Te}),n.R.copy(fe,M,{x:0,y:Te-1},{x:J,y:ne-1},{width:we,height:1}),n.R.copy(fe,M,{x:0,y:0},{x:J,y:ne+Te},{width:we,height:1}),n.R.copy(fe,M,{x:we-1,y:0},{x:J-1,y:ne},{width:1,height:Te}),n.R.copy(fe,M,{x:0,y:0},{x:J+we,y:ne},{width:1,height:Te})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const v of o){if(this.callbackDispatchedThisFrame[v])continue;this.callbackDispatchedThisFrame[v]=!0;const A=this.getImage(v);A||n.w(`Image with ID: "${v}" was not found`),Li(A)&&this.updateImage(v,A)}}}const cr=1e20;function Pr(L,o,v,A,M,P,q,J,ne){for(let fe=o;fe<o+A;fe++)si(L,v*P+fe,P,M,q,J,ne);for(let fe=v;fe<v+M;fe++)si(L,fe*P+o,1,A,q,J,ne)}function si(L,o,v,A,M,P,q){P[0]=0,q[0]=-cr,q[1]=cr,M[0]=L[o];for(let J=1,ne=0,fe=0;J<A;J++){M[J]=L[o+J*v];const we=J*J;do{const Te=P[ne];fe=(M[J]-M[Te]+we-Te*Te)/(J-Te)/2}while(fe<=q[ne]&&--ne>-1);ne++,P[ne]=J,q[ne]=fe,q[ne+1]=cr}for(let J=0,ne=0;J<A;J++){for(;q[ne+1]<J;)ne++;const fe=P[ne],we=J-fe;L[o+J*v]=M[fe]+we*we}}class xi{constructor(o,v){this.requestManager=o,this.localIdeographFontFamily=v,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return n._(this,void 0,void 0,(function*(){const v=[];for(const P in o)for(const q of o[P])v.push(this._getAndCacheGlyphsPromise(P,q));const A=yield Promise.all(v),M={};for(const{stack:P,id:q,glyph:J}of A)M[P]||(M[P]={}),M[P][q]=J&&{id:J.id,bitmap:J.bitmap.clone(),metrics:J.metrics};return M}))}_getAndCacheGlyphsPromise(o,v){return n._(this,void 0,void 0,(function*(){let A=this.entries[o];A||(A=this.entries[o]={glyphs:{},requests:{},ranges:{}});let M=A.glyphs[v];if(M!==void 0)return{stack:o,id:v,glyph:M};if(M=this._tinySDF(A,o,v),M)return A.glyphs[v]=M,{stack:o,id:v,glyph:M};const P=Math.floor(v/256);if(256*P>65535)throw new Error("glyphs > 65535 not supported");if(A.ranges[P])return{stack:o,id:v,glyph:M};if(!this.url)throw new Error("glyphsUrl is not set");if(!A.requests[P]){const J=xi.loadGlyphRange(o,P,this.url,this.requestManager);A.requests[P]=J}const q=yield A.requests[P];for(const J in q)this._doesCharSupportLocalGlyph(+J)||(A.glyphs[+J]=q[+J]);return A.ranges[P]=!0,{stack:o,id:v,glyph:q[v]||null}}))}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(o))}_tinySDF(o,v,A){const M=this.localIdeographFontFamily;if(!M||!this._doesCharSupportLocalGlyph(A))return;let P=o.tinySDF;if(!P){let J="400";/bold/i.test(v)?J="900":/medium/i.test(v)?J="500":/light/i.test(v)&&(J="200"),P=o.tinySDF=new xi.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:M,fontWeight:J})}const q=P.draw(String.fromCharCode(A));return{id:A,bitmap:new n.o({width:q.width||60,height:q.height||60},q.data),metrics:{width:q.glyphWidth/2||24,height:q.glyphHeight/2||24,left:q.glyphLeft/2+.5||0,top:q.glyphTop/2-27.5||-8,advance:q.glyphAdvance/2||24,isDoubleResolution:!0}}}}xi.loadGlyphRange=function(L,o,v,A){return n._(this,void 0,void 0,(function*(){const M=256*o,P=M+255,q=A.transformRequest(v.replace("{fontstack}",L).replace("{range}",`${M}-${P}`),"Glyphs"),J=yield n.l(q,new AbortController);if(!J||!J.data)throw new Error(`Could not load glyph range. range: ${o}, ${M}-${P}`);const ne={};for(const fe of n.n(J.data))ne[fe.id]=fe;return ne}))},xi.TinySDF=class{constructor({fontSize:L=24,buffer:o=3,radius:v=8,cutoff:A=.25,fontFamily:M="sans-serif",fontWeight:P="normal",fontStyle:q="normal"}={}){this.buffer=o,this.cutoff=A,this.radius=v;const J=this.size=L+4*o,ne=this._createCanvas(J),fe=this.ctx=ne.getContext("2d",{willReadFrequently:!0});fe.font=`${q} ${P} ${L}px ${M}`,fe.textBaseline="alphabetic",fe.textAlign="left",fe.fillStyle="black",this.gridOuter=new Float64Array(J*J),this.gridInner=new Float64Array(J*J),this.f=new Float64Array(J),this.z=new Float64Array(J+1),this.v=new Uint16Array(J)}_createCanvas(L){const o=document.createElement("canvas");return o.width=o.height=L,o}draw(L){const{width:o,actualBoundingBoxAscent:v,actualBoundingBoxDescent:A,actualBoundingBoxLeft:M,actualBoundingBoxRight:P}=this.ctx.measureText(L),q=Math.ceil(v),J=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(P-M))),ne=Math.min(this.size-this.buffer,q+Math.ceil(A)),fe=J+2*this.buffer,we=ne+2*this.buffer,Te=Math.max(fe*we,0),Be=new Uint8ClampedArray(Te),Ke={data:Be,width:fe,height:we,glyphWidth:J,glyphHeight:ne,glyphTop:q,glyphLeft:0,glyphAdvance:o};if(J===0||ne===0)return Ke;const{ctx:ot,buffer:wt,gridInner:Mt,gridOuter:Rt}=this;ot.clearRect(wt,wt,J,ne),ot.fillText(L,wt,wt+q);const Ft=ot.getImageData(wt,wt,J,ne);Rt.fill(cr,0,Te),Mt.fill(0,0,Te);for(let yt=0;yt<ne;yt++)for(let Ht=0;Ht<J;Ht++){const Jt=Ft.data[4*(yt*J+Ht)+3]/255;if(Jt===0)continue;const oi=(yt+wt)*fe+Ht+wt;if(Jt===1)Rt[oi]=0,Mt[oi]=cr;else{const Xi=.5-Jt;Rt[oi]=Xi>0?Xi*Xi:0,Mt[oi]=Xi<0?Xi*Xi:0}}Pr(Rt,0,0,fe,we,fe,this.f,this.v,this.z),Pr(Mt,wt,wt,J,ne,fe,this.f,this.v,this.z);for(let yt=0;yt<Te;yt++){const Ht=Math.sqrt(Rt[yt])-Math.sqrt(Mt[yt]);Be[yt]=Math.round(255-255*(Ht/this.radius+this.cutoff))}return Ke}};class Tn{constructor(){this.specification=n.v.light.position}possiblyEvaluate(o,v){return n.x(o.expression.evaluate(v))}interpolate(o,v,A){return{x:n.y.number(o.x,v.x,A),y:n.y.number(o.y,v.y,A),z:n.y.number(o.z,v.z,A)}}}let zn;class Er extends n.E{constructor(o){super(),zn=zn||new n.q({anchor:new n.D(n.v.light.anchor),position:new Tn,color:new n.D(n.v.light.color),intensity:new n.D(n.v.light.intensity)}),this._transitionable=new n.T(zn),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,v={}){if(!this._validate(n.r,o,v))for(const A in o){const M=o[A];A.endsWith("-transition")?this._transitionable.setTransition(A.slice(0,-11),M):this._transitionable.setValue(A,M)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,v,A){return(!A||A.validate!==!1)&&n.t(this,o.call(n.u,{value:v,style:{glyphs:!0,sprite:!0},styleSpec:n.v}))}}const Et=new n.q({"sky-color":new n.D(n.v.sky["sky-color"]),"horizon-color":new n.D(n.v.sky["horizon-color"]),"fog-color":new n.D(n.v.sky["fog-color"]),"fog-ground-blend":new n.D(n.v.sky["fog-ground-blend"]),"horizon-fog-blend":new n.D(n.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new n.D(n.v.sky["sky-horizon-blend"]),"atmosphere-blend":new n.D(n.v.sky["atmosphere-blend"])});class di extends n.E{constructor(o){super(),this._transitionable=new n.T(Et),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new n.z(0))}setSky(o,v={}){if(!this._validate(n.B,o,v)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const A in o){const M=o[A];A.endsWith("-transition")?this._transitionable.setTransition(A.slice(0,-11),M):this._transitionable.setValue(A,M)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,v,A={}){return A?.validate!==!1&&n.t(this,o.call(n.u,n.e({value:v,style:{glyphs:!0,sprite:!0},styleSpec:n.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class mi{constructor(o,v){this.width=o,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,v){const A=o.join(",")+String(v);return this.dashEntry[A]||(this.dashEntry[A]=this.addDash(o,v)),this.dashEntry[A]}getDashRanges(o,v,A){const M=[];let P=o.length%2==1?-o[o.length-1]*A:0,q=o[0]*A,J=!0;M.push({left:P,right:q,isDash:J,zeroLength:o[0]===0});let ne=o[0];for(let fe=1;fe<o.length;fe++){J=!J;const we=o[fe];P=ne*A,ne+=we,q=ne*A,M.push({left:P,right:q,isDash:J,zeroLength:we===0})}return M}addRoundDash(o,v,A){const M=v/2;for(let P=-A;P<=A;P++){const q=this.width*(this.nextRow+A+P);let J=0,ne=o[J];for(let fe=0;fe<this.width;fe++){fe/ne.right>1&&(ne=o[++J]);const we=Math.abs(fe-ne.left),Te=Math.abs(fe-ne.right),Be=Math.min(we,Te);let Ke;const ot=P/A*(M+1);if(ne.isDash){const wt=M-Math.abs(ot);Ke=Math.sqrt(Be*Be+wt*wt)}else Ke=M-Math.sqrt(Be*Be+ot*ot);this.data[q+fe]=Math.max(0,Math.min(255,Ke+128))}}}addRegularDash(o){for(let J=o.length-1;J>=0;--J){const ne=o[J],fe=o[J+1];ne.zeroLength?o.splice(J,1):fe&&fe.isDash===ne.isDash&&(fe.left=ne.left,o.splice(J,1))}const v=o[0],A=o[o.length-1];v.isDash===A.isDash&&(v.left=A.left-this.width,A.right=v.right+this.width);const M=this.width*this.nextRow;let P=0,q=o[P];for(let J=0;J<this.width;J++){J/q.right>1&&(q=o[++P]);const ne=Math.abs(J-q.left),fe=Math.abs(J-q.right),we=Math.min(ne,fe);this.data[M+J]=Math.max(0,Math.min(255,(q.isDash?we:-we)+128))}}addDash(o,v){const A=v?7:0,M=2*A+1;if(this.nextRow+M>this.height)return n.w("LineAtlas out of space"),null;let P=0;for(let J=0;J<o.length;J++)P+=o[J];if(P!==0){const J=this.width/P,ne=this.getDashRanges(o,this.width,J);v?this.addRoundDash(ne,J,A):this.addRegularDash(ne)}const q={y:(this.nextRow+A+.5)/this.height,height:2*A/this.height,width:P};return this.nextRow+=M,this.dirty=!0,q}bind(o){const v=o.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))}}const vn="maplibre_preloaded_worker_pool";class tr{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<tr.workerCount;)this.workers.push(new Worker(n.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach((v=>{v.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[vn]}numActive(){return Object.keys(this.active).length}}const vr=Math.floor(it.hardwareConcurrency/2);let Gr,gr;function In(){return Gr||(Gr=new tr),Gr}tr.workerCount=n.C(globalThis)?Math.max(Math.min(vr,3),1):1;class Lr{constructor(o,v){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=v;const A=this.workerPool.acquire(v);for(let M=0;M<A.length;M++){const P=new n.F(A[M],v);P.name=`Worker ${M}`,this.actors.push(P)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,v){const A=[];for(const M of this.actors)A.push(M.sendAsync({type:o,data:v}));return Promise.all(A)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach((v=>{v.remove()})),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,v){for(const A of this.actors)A.registerMessageHandler(o,v)}}function br(){return gr||(gr=new Lr(In(),n.G),gr.registerMessageHandler("GR",((L,o,v)=>n.m(o,v)))),gr}function ma(L,o){const v=n.H();return n.J(v,v,[1,1,0]),n.K(v,v,[.5*L.width,.5*L.height,1]),n.L(v,v,L.calculatePosMatrix(o.toUnwrapped()))}function Kr(L,o,v,A,M,P){const q=(function(Te,Be,Ke){if(Te)for(const ot of Te){const wt=Be[ot];if(wt&&wt.source===Ke&&wt.type==="fill-extrusion")return!0}else for(const ot in Be){const wt=Be[ot];if(wt.source===Ke&&wt.type==="fill-extrusion")return!0}return!1})(M&&M.layers,o,L.id),J=P.maxPitchScaleFactor(),ne=L.tilesIn(A,J,q);ne.sort(oa);const fe=[];for(const Te of ne)fe.push({wrappedTileID:Te.tileID.wrapped().key,queryResults:Te.tile.queryRenderedFeatures(o,v,L._state,Te.queryGeometry,Te.cameraQueryGeometry,Te.scale,M,P,J,ma(L.transform,Te.tileID))});const we=(function(Te){const Be={},Ke={};for(const ot of Te){const wt=ot.queryResults,Mt=ot.wrappedTileID,Rt=Ke[Mt]=Ke[Mt]||{};for(const Ft in wt){const yt=wt[Ft],Ht=Rt[Ft]=Rt[Ft]||{},Jt=Be[Ft]=Be[Ft]||[];for(const oi of yt)Ht[oi.featureIndex]||(Ht[oi.featureIndex]=!0,Jt.push(oi))}}return Be})(fe);for(const Te in we)we[Te].forEach((Be=>{const Ke=Be.feature,ot=L.getFeatureState(Ke.layer["source-layer"],Ke.id);Ke.source=Ke.layer.source,Ke.layer["source-layer"]&&(Ke.sourceLayer=Ke.layer["source-layer"]),Ke.state=ot}));return we}function oa(L,o){const v=L.tileID,A=o.tileID;return v.overscaledZ-A.overscaledZ||v.canonical.y-A.canonical.y||v.wrap-A.wrap||v.canonical.x-A.canonical.x}function Ma(L,o,v){return n._(this,void 0,void 0,(function*(){let A=L;if(L.url?A=(yield n.h(o.transformRequest(L.url,"Source"),v)).data:yield it.frameAsync(v),!A)return null;const M=n.M(n.e(A,L),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in A&&A.vector_layers&&(M.vectorLayerIds=A.vector_layers.map((P=>P.id))),M}))}class $t{constructor(o,v){o&&(v?this.setSouthWest(o).setNorthEast(v):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof n.N?new n.N(o.lng,o.lat):n.N.convert(o),this}setSouthWest(o){return this._sw=o instanceof n.N?new n.N(o.lng,o.lat):n.N.convert(o),this}extend(o){const v=this._sw,A=this._ne;let M,P;if(o instanceof n.N)M=o,P=o;else{if(!(o instanceof $t))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend($t.convert(o)):this.extend(n.N.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(n.N.convert(o)):this;if(M=o._sw,P=o._ne,!M||!P)return this}return v||A?(v.lng=Math.min(M.lng,v.lng),v.lat=Math.min(M.lat,v.lat),A.lng=Math.max(P.lng,A.lng),A.lat=Math.max(P.lat,A.lat)):(this._sw=new n.N(M.lng,M.lat),this._ne=new n.N(P.lng,P.lat)),this}getCenter(){return new n.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new n.N(this.getWest(),this.getNorth())}getSouthEast(){return new n.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:v,lat:A}=n.N.convert(o);let M=this._sw.lng<=v&&v<=this._ne.lng;return this._sw.lng>this._ne.lng&&(M=this._sw.lng>=v&&v>=this._ne.lng),this._sw.lat<=A&&A<=this._ne.lat&&M}static convert(o){return o instanceof $t?o:o&&new $t(o)}static fromLngLat(o,v=0){const A=360*v/40075017,M=A/Math.cos(Math.PI/180*o.lat);return new $t(new n.N(o.lng-M,o.lat-A),new n.N(o.lng+M,o.lat+A))}adjustAntiMeridian(){const o=new n.N(this._sw.lng,this._sw.lat),v=new n.N(this._ne.lng,this._ne.lat);return new $t(o,o.lng>v.lng?new n.N(v.lng+360,v.lat):v)}}class Va{constructor(o,v,A){this.bounds=$t.convert(this.validateBounds(o)),this.minzoom=v||0,this.maxzoom=A||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const v=Math.pow(2,o.z),A=Math.floor(n.O(this.bounds.getWest())*v),M=Math.floor(n.Q(this.bounds.getNorth())*v),P=Math.ceil(n.O(this.bounds.getEast())*v),q=Math.ceil(n.Q(this.bounds.getSouth())*v);return o.x>=A&&o.x<P&&o.y>=M&&o.y<q}}class Ir extends n.E{constructor(o,v,A,M){if(super(),this.id=o,this.dispatcher=A,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.e(this,n.M(v,["url","scheme","tileSize","promoteId"])),this._options=n.e({type:"vector"},v),this._collectResourceTiming=v.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(M)}load(){return n._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new n.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(n.e(this,o),o.bounds&&(this.tileBounds=new Va(o.bounds,this.minzoom,this.maxzoom)),this.fire(new n.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new n.j(o))}}))}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty((()=>{this._options.tiles=o})),this}setUrl(o){return this.setSourceProperty((()=>{this.url=o,this._options.url=o})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return n.e({},this._options)}loadTile(o){return n._(this,void 0,void 0,(function*(){const v=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),A={request:this.map._requestManager.transformRequest(v,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};A.request.collectResourceTiming=this._collectResourceTiming;let M="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise(((P,q)=>{o.reloadPromise={resolve:P,reject:q}}))}else o.actor=this.dispatcher.getActor(),M="LT";o.abortController=new AbortController;try{const P=yield o.actor.sendAsync({type:M,data:A},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,P)}catch(P){if(delete o.abortController,o.aborted)return;if(P&&P.status!==404)throw P;this._afterTileLoadWorkerResponse(o,null)}}))}_afterTileLoadWorkerResponse(o,v){if(v&&v.resourceTiming&&(o.resourceTiming=v.resourceTiming),v&&this.map._refreshExpiredTiles&&o.setExpiryData(v),o.loadVectorData(v,this.map.painter),o.reloadPromise){const A=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(A.resolve).catch(A.reject)}}abortTile(o){return n._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))}))}unloadTile(o){return n._(this,void 0,void 0,(function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Ar extends n.E{constructor(o,v,A,M){super(),this.id=o,this.dispatcher=A,this.setEventedParent(M),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.e({type:"raster"},v),n.e(this,n.M(v,["url","scheme","tileSize"]))}load(){return n._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new n.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Ma(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(n.e(this,o),o.bounds&&(this.tileBounds=new Va(o.bounds,this.minzoom,this.maxzoom)),this.fire(new n.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new n.j(o))}}))}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty((()=>{this._options.tiles=o})),this}setUrl(o){return this.setSourceProperty((()=>{this.url=o,this._options.url=o})),this}serialize(){return n.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return n._(this,void 0,void 0,(function*(){const v=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const A=yield an.getImage(this.map._requestManager.transformRequest(v,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(A&&A.data){this.map._refreshExpiredTiles&&A.cacheControl&&A.expires&&o.setExpiryData({cacheControl:A.cacheControl,expires:A.expires});const M=this.map.painter.context,P=M.gl,q=A.data;o.texture=this.map.painter.getTileTexture(q.width),o.texture?o.texture.update(q,{useMipmap:!0}):(o.texture=new tn(M,q,P.RGBA,{useMipmap:!0}),o.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(A){if(delete o.abortController,o.aborted)o.state="unloaded";else if(A)throw o.state="errored",A}}))}abortTile(o){return n._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)}))}unloadTile(o){return n._(this,void 0,void 0,(function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)}))}hasTransition(){return!1}}class la extends Ar{constructor(o,v,A,M){super(o,v,A,M),this.type="raster-dem",this.maxzoom=22,this._options=n.e({type:"raster-dem"},v),this.encoding=v.encoding||"mapbox",this.redFactor=v.redFactor,this.greenFactor=v.greenFactor,this.blueFactor=v.blueFactor,this.baseShift=v.baseShift}loadTile(o){return n._(this,void 0,void 0,(function*(){const v=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),A=this.map._requestManager.transformRequest(v,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const M=yield an.getImage(A,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(M&&M.data){const P=M.data;this.map._refreshExpiredTiles&&M.cacheControl&&M.expires&&o.setExpiryData({cacheControl:M.cacheControl,expires:M.expires});const q=n.b(P)&&n.U()?P:yield this.readImageNow(P),J={type:this.type,uid:o.uid,source:this.id,rawImageData:q,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const ne=yield o.actor.sendAsync({type:"LDT",data:J});o.dem=ne,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(M){if(delete o.abortController,o.aborted)o.state="unloaded";else if(M)throw o.state="errored",M}}))}readImageNow(o){return n._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&n.V()){const v=o.width+2,A=o.height+2;try{return new n.R({width:v,height:A},yield n.W(o,-1,-1,v,A))}catch{}}return it.getImageData(o,1)}))}_getNeighboringTiles(o){const v=o.canonical,A=Math.pow(2,v.z),M=(v.x-1+A)%A,P=v.x===0?o.wrap-1:o.wrap,q=(v.x+1+A)%A,J=v.x+1===A?o.wrap+1:o.wrap,ne={};return ne[new n.S(o.overscaledZ,P,v.z,M,v.y).key]={backfilled:!1},ne[new n.S(o.overscaledZ,J,v.z,q,v.y).key]={backfilled:!1},v.y>0&&(ne[new n.S(o.overscaledZ,P,v.z,M,v.y-1).key]={backfilled:!1},ne[new n.S(o.overscaledZ,o.wrap,v.z,v.x,v.y-1).key]={backfilled:!1},ne[new n.S(o.overscaledZ,J,v.z,q,v.y-1).key]={backfilled:!1}),v.y+1<A&&(ne[new n.S(o.overscaledZ,P,v.z,M,v.y+1).key]={backfilled:!1},ne[new n.S(o.overscaledZ,o.wrap,v.z,v.x,v.y+1).key]={backfilled:!1},ne[new n.S(o.overscaledZ,J,v.z,q,v.y+1).key]={backfilled:!1}),ne}unloadTile(o){return n._(this,void 0,void 0,(function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))}))}}class Po extends n.E{constructor(o,v,A,M){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=A.getActor(),this.setEventedParent(M),this._data=v.data,this._options=n.e({},v),this._collectResourceTiming=v.collectResourceTiming,v.maxzoom!==void 0&&(this.maxzoom=v.maxzoom),v.type&&(this.type=v.type),v.attribution&&(this.attribution=v.attribution),this.promoteId=v.promoteId;const P=n.X/this.tileSize;v.clusterMaxZoom!==void 0&&this.maxzoom<=v.clusterMaxZoom&&n.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${v.clusterMaxZoom}".`),this.workerOptions=n.e({source:this.id,cluster:v.cluster||!1,geojsonVtOptions:{buffer:(v.buffer!==void 0?v.buffer:128)*P,tolerance:(v.tolerance!==void 0?v.tolerance:.375)*P,extent:n.X,maxZoom:this.maxzoom,lineMetrics:v.lineMetrics||!1,generateId:v.generateId||!1},superclusterOptions:{maxZoom:v.clusterMaxZoom!==void 0?v.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,v.clusterMinPoints||2),extent:n.X,radius:(v.clusterRadius||50)*P,log:!1,generateId:v.generateId||!1},clusterProperties:v.clusterProperties,filter:v.filter},v.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return n._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}getData(){return n._(this,void 0,void 0,(function*(){const o=n.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})}))}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,v,A){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:v,offset:A}})}_updateWorkerData(o){return n._(this,void 0,void 0,(function*(){const v=n.e({type:this.type},this.workerOptions);o?v.dataDiff=o:typeof this._data=="string"?(v.request=this.map._requestManager.transformRequest(it.resolveURL(this._data),"Source"),v.request.collectResourceTiming=this._collectResourceTiming):v.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new n.k("dataloading",{dataType:"source"}));try{const A=yield this.actor.sendAsync({type:"LD",data:v});if(this._pendingLoads--,this._removed||A.abandoned)return void this.fire(new n.k("dataabort",{dataType:"source"}));let M=null;A.resourceTiming&&A.resourceTiming[this.id]&&(M=A.resourceTiming[this.id].slice(0));const P={dataType:"source"};this._collectResourceTiming&&M&&M.length>0&&n.e(P,{resourceTiming:M}),this.fire(new n.k("data",Object.assign(Object.assign({},P),{sourceDataType:"metadata"}))),this.fire(new n.k("data",Object.assign(Object.assign({},P),{sourceDataType:"content"})))}catch(A){if(this._pendingLoads--,this._removed)return void this.fire(new n.k("dataabort",{dataType:"source"}));this.fire(new n.j(A))}}))}loaded(){return this._pendingLoads===0}loadTile(o){return n._(this,void 0,void 0,(function*(){const v=o.actor?"RT":"LT";o.actor=this.actor;const A={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const M=yield this.actor.sendAsync({type:v,data:A},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(M,this.map.painter,v==="RT")}))}abortTile(o){return n._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0}))}unloadTile(o){return n._(this,void 0,void 0,(function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return n.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Qs=n.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Io extends n.E{constructor(o,v,A,M){super(),this.id=o,this.dispatcher=A,this.coordinates=v.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(M),this.options=v}load(o){return n._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new n.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const v=yield an.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,v&&v.data&&(this.image=v.data,o&&(this.coordinates=o),this._finishLoading())}catch(v){this._request=null,this._loaded=!0,this.fire(new n.j(v))}}))}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const v=o.map(n.Z.fromLngLat);this.tileID=(function(M){let P=1/0,q=1/0,J=-1/0,ne=-1/0;for(const Be of M)P=Math.min(P,Be.x),q=Math.min(q,Be.y),J=Math.max(J,Be.x),ne=Math.max(ne,Be.y);const fe=Math.max(J-P,ne-q),we=Math.max(0,Math.floor(-Math.log(fe)/Math.LN2)),Te=Math.pow(2,we);return new n.a1(we,Math.floor((P+J)/2*Te),Math.floor((q+ne)/2*Te))})(v),this.minzoom=this.maxzoom=this.tileID.z;const A=v.map((M=>this.tileID.getTilePoint(M)._round()));return this._boundsArray=new n.$,this._boundsArray.emplaceBack(A[0].x,A[0].y,0,0),this._boundsArray.emplaceBack(A[1].x,A[1].y,n.X,0),this._boundsArray.emplaceBack(A[3].x,A[3].y,0,n.X),this._boundsArray.emplaceBack(A[2].x,A[2].y,n.X,n.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new n.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,v=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Qs.members)),this.boundsSegments||(this.boundsSegments=n.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new tn(o,this.image,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let A=!1;for(const M in this.tiles){const P=this.tiles[M];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,A=!0)}A&&this.fire(new n.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return n._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Mr extends Io{constructor(o,v,A,M){super(o,v,A,M),this.roundZoom=!0,this.type="video",this.options=v}load(){return n._(this,void 0,void 0,(function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const v of o.urls)this.urls.push(this.map._requestManager.transformRequest(v,"Source").url);try{const v=yield n.a3(this.urls);if(this._loaded=!0,!v)return;this.video=v,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(v){this.fire(new n.j(v))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const v=this.video.seekable;o<v.start(0)||o>v.end(0)?this.fire(new n.j(new n.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${v.start(0)} and ${v.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,v=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Qs.members)),this.boundsSegments||(this.boundsSegments=n.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.texSubImage2D(v.TEXTURE_2D,0,0,0,v.RGBA,v.UNSIGNED_BYTE,this.video)):(this.texture=new tn(o,this.video,v.RGBA),this.texture.bind(v.LINEAR,v.CLAMP_TO_EDGE));let A=!1;for(const M in this.tiles){const P=this.tiles[M];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,A=!0)}A&&this.fire(new n.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class ws extends Io{constructor(o,v,A,M){super(o,v,A,M),v.coordinates?Array.isArray(v.coordinates)&&v.coordinates.length===4&&!v.coordinates.some((P=>!Array.isArray(P)||P.length!==2||P.some((q=>typeof q!="number"))))||this.fire(new n.j(new n.a2(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.j(new n.a2(`sources.${o}`,null,'missing required property "coordinates"'))),v.animate&&typeof v.animate!="boolean"&&this.fire(new n.j(new n.a2(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),v.canvas?typeof v.canvas=="string"||v.canvas instanceof HTMLCanvasElement||this.fire(new n.j(new n.a2(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.j(new n.a2(`sources.${o}`,null,'missing required property "canvas"'))),this.options=v,this.animate=v.animate===void 0||v.animate}load(){return n._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const v=this.map.painter.context,A=v.gl;this.boundsBuffer||(this.boundsBuffer=v.createVertexBuffer(this._boundsArray,Qs.members)),this.boundsSegments||(this.boundsSegments=n.a0.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new tn(v,this.canvas,A.RGBA,{premultiply:!0});let M=!1;for(const P in this.tiles){const q=this.tiles[P];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture,M=!0)}M&&this.fire(new n.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Ds={},Ps=L=>{switch(L){case"geojson":return Po;case"image":return Io;case"raster":return Ar;case"raster-dem":return la;case"vector":return Ir;case"video":return Mr;case"canvas":return ws}return Ds[L]},Qt="RTLPluginLoaded";class Gn extends n.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=br()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch((v=>{throw this.status="error",v}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return n._(this,arguments,void 0,(function*(v,A=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=it.resolveURL(v),!this.url)throw new Error(`requested url ${v} is invalid`);if(this.status==="unavailable"){if(!A)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return n._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new n.k(Qt))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ta=null;function Ha(){return Ta||(Ta=new Gn),Ta}class ms{constructor(o,v){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=n.a4(),this.uses=0,this.tileSize=v,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const v=o+this.timeAdded;v<this.fadeEndTime||(this.fadeEndTime=v)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,v,A){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=(function(M,P){const q={};if(!P)return q;for(const J of M){const ne=J.layerIds.map((fe=>P.getLayer(fe))).filter(Boolean);if(ne.length!==0){J.layers=ne,J.stateDependentLayerIds&&(J.stateDependentLayers=J.stateDependentLayerIds.map((fe=>ne.filter((we=>we.id===fe))[0])));for(const fe of ne)q[fe.id]=J}}return q})(o.buckets,v.style),this.hasSymbolBuckets=!1;for(const M in this.buckets){const P=this.buckets[M];if(P instanceof n.a6){if(this.hasSymbolBuckets=!0,!A)break;P.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const M in this.buckets){const P=this.buckets[M];if(P instanceof n.a6&&P.hasRTLText){this.hasRTLText=!0,Ha().lazyLoad();break}}this.queryPadding=0;for(const M in this.buckets){const P=this.buckets[M];this.queryPadding=Math.max(this.queryPadding,v.style.getLayer(M).queryRadius(P))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new n.a5}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const A in this.buckets){const M=this.buckets[A];M.uploadPending()&&M.upload(o)}const v=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new tn(o,this.imageAtlas.image,v.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new tn(o,this.glyphAtlasImage,v.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,v,A,M,P,q,J,ne,fe,we){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:M,cameraQueryGeometry:P,scale:q,tileSize:this.tileSize,pixelPosMatrix:we,transform:ne,params:J,queryPadding:this.queryPadding*fe},o,v,A):{}}querySourceFeatures(o,v){const A=this.latestFeatureIndex;if(!A||!A.rawTileData)return;const M=A.loadVTLayers(),P=v&&v.sourceLayer?v.sourceLayer:"",q=M._geojsonTileLayer||M[P];if(!q)return;const J=n.a7(v&&v.filter),{z:ne,x:fe,y:we}=this.tileID.canonical,Te={z:ne,x:fe,y:we};for(let Be=0;Be<q.length;Be++){const Ke=q.feature(Be);if(J.needGeometry){const Mt=n.a8(Ke,!0);if(!J.filter(new n.z(this.tileID.overscaledZ),Mt,this.tileID.canonical))continue}else if(!J.filter(new n.z(this.tileID.overscaledZ),Ke))continue;const ot=A.getId(Ke,P),wt=new n.a9(Ke,ne,fe,we,ot);wt.tile=Te,o.push(wt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const v=this.expirationTime;if(o.cacheControl){const A=n.aa(o.cacheControl);A["max-age"]&&(this.expirationTime=Date.now()+1e3*A["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const A=Date.now();let M=!1;if(this.expirationTime>A)M=!1;else if(v)if(this.expirationTime<v)M=!0;else{const P=this.expirationTime-v;P?this.expirationTime=A+Math.max(P,3e4):M=!0}else M=!0;M?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const A=this.latestFeatureIndex.loadVTLayers();for(const M in this.buckets){if(!v.style.hasLayer(M))continue;const P=this.buckets[M],q=P.layers[0].sourceLayer||"_geojsonTileLayer",J=A[q],ne=o[q];if(!J||!ne||Object.keys(ne).length===0)continue;P.update(ne,J,this.imageAtlas&&this.imageAtlas.patternPositions||{});const fe=v&&v.style&&v.style.getLayer(M);fe&&(this.queryPadding=Math.max(this.queryPadding,fe.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<it.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=it.now()+o}setDependencies(o,v){const A={};for(const M of v)A[M]=!0;this.dependencies[o]=A}hasDependency(o,v){for(const A of o){const M=this.dependencies[A];if(M){for(const P of v)if(M[P])return!0}}return!1}}class xn{constructor(o,v){this.max=o,this.onRemove=v,this.reset()}reset(){for(const o in this.data)for(const v of this.data[o])v.timeout&&clearTimeout(v.timeout),this.onRemove(v.value);return this.data={},this.order=[],this}add(o,v,A){const M=o.wrapped().key;this.data[M]===void 0&&(this.data[M]=[]);const P={value:v,timeout:void 0};if(A!==void 0&&(P.timeout=setTimeout((()=>{this.remove(o,P)}),A)),this.data[M].push(P),this.order.push(M),this.order.length>this.max){const q=this._getAndRemoveByKey(this.order[0]);q&&this.onRemove(q)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const v=this.data[o].shift();return v.timeout&&clearTimeout(v.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),v.value}getByKey(o){const v=this.data[o];return v?v[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,v){if(!this.has(o))return this;const A=o.wrapped().key,M=v===void 0?0:this.data[A].indexOf(v),P=this.data[A][M];return this.data[A].splice(M,1),P.timeout&&clearTimeout(P.timeout),this.data[A].length===0&&delete this.data[A],this.onRemove(P.value),this.order.splice(this.order.indexOf(A),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}filter(o){const v=[];for(const A in this.data)for(const M of this.data[A])o(M.value)||v.push(M);for(const A of v)this.remove(A.value.tileID,A)}}class er{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,v,A){const M=String(v);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][M]=this.stateChanges[o][M]||{},n.e(this.stateChanges[o][M],A),this.deletedStates[o]===null){this.deletedStates[o]={};for(const P in this.state[o])P!==M&&(this.deletedStates[o][P]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][M]===null){this.deletedStates[o][M]={};for(const P in this.state[o][M])A[P]||(this.deletedStates[o][M][P]=null)}else for(const P in A)this.deletedStates[o]&&this.deletedStates[o][M]&&this.deletedStates[o][M][P]===null&&delete this.deletedStates[o][M][P]}removeFeatureState(o,v,A){if(this.deletedStates[o]===null)return;const M=String(v);if(this.deletedStates[o]=this.deletedStates[o]||{},A&&v!==void 0)this.deletedStates[o][M]!==null&&(this.deletedStates[o][M]=this.deletedStates[o][M]||{},this.deletedStates[o][M][A]=null);else if(v!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][M])for(A in this.deletedStates[o][M]={},this.stateChanges[o][M])this.deletedStates[o][M][A]=null;else this.deletedStates[o][M]=null;else this.deletedStates[o]=null}getState(o,v){const A=String(v),M=n.e({},(this.state[o]||{})[A],(this.stateChanges[o]||{})[A]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const P=this.deletedStates[o][v];if(P===null)return{};for(const q in P)delete M[q]}return M}initializeTileState(o,v){o.setFeatureState(this.state,v)}coalesceChanges(o,v){const A={};for(const M in this.stateChanges){this.state[M]=this.state[M]||{};const P={};for(const q in this.stateChanges[M])this.state[M][q]||(this.state[M][q]={}),n.e(this.state[M][q],this.stateChanges[M][q]),P[q]=this.state[M][q];A[M]=P}for(const M in this.deletedStates){this.state[M]=this.state[M]||{};const P={};if(this.deletedStates[M]===null)for(const q in this.state[M])P[q]={},this.state[M][q]={};else for(const q in this.deletedStates[M]){if(this.deletedStates[M][q]===null)this.state[M][q]={};else for(const J of Object.keys(this.deletedStates[M][q]))delete this.state[M][q][J];P[q]=this.state[M][q]}A[M]=A[M]||{},n.e(A[M],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(A).length!==0)for(const M in o)o[M].setFeatureState(A,v)}}class sr extends n.E{constructor(o,v,A){super(),this.id=o,this.dispatcher=A,this.on("data",(M=>this._dataHandler(M))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((M,P,q,J)=>{const ne=new(Ps(P.type))(M,P,q,J);if(ne.id!==M)throw new Error(`Expected Source id to be ${M} instead of ${ne.id}`);return ne})(o,v,A,this),this._tiles={},this._cache=new xn(0,(M=>this._unloadTile(M))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new er,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const v=this._tiles[o];if(v.state!=="loaded"&&v.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,v,A){return n._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,v,A)}catch(M){o.state="errored",M.status!==404?this._source.fire(new n.j(M,{tile:o})):this.update(this.transform,this.terrain)}}))}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new n.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const v in this._tiles){const A=this._tiles[v];A.upload(o),A.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((o=>o.tileID)).sort(Xs).map((o=>o.key))}getRenderableIds(o){const v=[];for(const A in this._tiles)this._isIdRenderable(A,o)&&v.push(this._tiles[A]);return o?v.sort(((A,M)=>{const P=A.tileID,q=M.tileID,J=new n.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle),ne=new n.P(q.canonical.x,q.canonical.y)._rotate(this.transform.angle);return P.overscaledZ-q.overscaledZ||ne.y-J.y||ne.x-J.x})).map((A=>A.tileID.key)):v.map((A=>A.tileID)).sort(Xs).map((A=>A.key))}hasRenderableParent(o){const v=this.findLoadedParent(o,0);return!!v&&this._isIdRenderable(v.tileID.key)}_isIdRenderable(o,v){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(v||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,v){return n._(this,void 0,void 0,(function*(){const A=this._tiles[o];A&&(A.state!=="loading"&&(A.state=v),yield this._loadTile(A,o,v))}))}_tileLoaded(o,v,A){o.timeAdded=it.now(),A==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(v,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new n.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const v=this.getRenderableIds();for(let M=0;M<v.length;M++){const P=v[M];if(o.neighboringTiles&&o.neighboringTiles[P]){const q=this.getTileByID(P);A(o,q),A(q,o)}}function A(M,P){M.needsHillshadePrepare=!0,M.needsTerrainPrepare=!0;let q=P.tileID.canonical.x-M.tileID.canonical.x;const J=P.tileID.canonical.y-M.tileID.canonical.y,ne=Math.pow(2,M.tileID.canonical.z),fe=P.tileID.key;q===0&&J===0||Math.abs(J)>1||(Math.abs(q)>1&&(Math.abs(q+ne)===1?q+=ne:Math.abs(q-ne)===1&&(q-=ne)),P.dem&&M.dem&&(M.dem.backfillBorder(P.dem,q,J),M.neighboringTiles&&M.neighboringTiles[fe]&&(M.neighboringTiles[fe].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,v,A,M){for(const P in this._tiles){let q=this._tiles[P];if(M[P]||!q.hasData()||q.tileID.overscaledZ<=v||q.tileID.overscaledZ>A)continue;let J=q.tileID;for(;q&&q.tileID.overscaledZ>v+1;){const fe=q.tileID.scaledTo(q.tileID.overscaledZ-1);q=this._tiles[fe.key],q&&q.hasData()&&(J=fe)}let ne=J;for(;ne.overscaledZ>v;)if(ne=ne.scaledTo(ne.overscaledZ-1),o[ne.key]){M[J.key]=J;break}}}findLoadedParent(o,v){if(o.key in this._loadedParentTiles){const A=this._loadedParentTiles[o.key];return A&&A.tileID.overscaledZ>=v?A:null}for(let A=o.overscaledZ-1;A>=v;A--){const M=o.scaledTo(A),P=this._getLoadedTile(M);if(P)return P}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){const v=this._tiles[o.key];return v&&v.hasData()?v:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const v=Math.ceil(o.width/this._source.tileSize)+1,A=Math.ceil(o.height/this._source.tileSize)+1,M=Math.floor(v*A*(this._maxTileCacheZoomLevels===null?n.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,M):M;this._cache.setMaxSize(P)}handleWrapJump(o){const v=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,v){const A={};for(const M in this._tiles){const P=this._tiles[M];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+v),A[P.tileID.key]=P}this._tiles=A;for(const M in this._timers)clearTimeout(this._timers[M]),delete this._timers[M];for(const M in this._tiles)this._setTileReloadTimer(M,this._tiles[M])}}_updateCoveredAndRetainedTiles(o,v,A,M,P,q){const J={},ne={},fe=Object.keys(o),we=it.now();for(const Te of fe){const Be=o[Te],Ke=this._tiles[Te];if(!Ke||Ke.fadeEndTime!==0&&Ke.fadeEndTime<=we)continue;const ot=this.findLoadedParent(Be,v),wt=this.findLoadedSibling(Be),Mt=ot||wt||null;Mt&&(this._addTile(Mt.tileID),J[Mt.tileID.key]=Mt.tileID),ne[Te]=Be}this._retainLoadedChildren(ne,M,A,o);for(const Te in J)o[Te]||(this._coveredTiles[Te]=!0,o[Te]=J[Te]);if(q){const Te={},Be={};for(const Ke of P)this._tiles[Ke.key].hasData()?Te[Ke.key]=Ke:Be[Ke.key]=Ke;for(const Ke in Be){const ot=Be[Ke].children(this._source.maxzoom);this._tiles[ot[0].key]&&this._tiles[ot[1].key]&&this._tiles[ot[2].key]&&this._tiles[ot[3].key]&&(Te[ot[0].key]=o[ot[0].key]=ot[0],Te[ot[1].key]=o[ot[1].key]=ot[1],Te[ot[2].key]=o[ot[2].key]=ot[2],Te[ot[3].key]=o[ot[3].key]=ot[3],delete Be[Ke])}for(const Ke in Be){const ot=Be[Ke],wt=this.findLoadedParent(ot,this._source.minzoom),Mt=this.findLoadedSibling(ot),Rt=wt||Mt||null;if(Rt){Te[Rt.tileID.key]=o[Rt.tileID.key]=Rt.tileID;for(const Ft in Te)Te[Ft].isChildOf(Rt.tileID)&&delete Te[Ft]}}for(const Ke in this._tiles)Te[Ke]||(this._coveredTiles[Ke]=!0)}}update(o,v){if(!this._sourceLoaded||this._paused)return;let A;this.transform=o,this.terrain=v,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?A=o.getVisibleUnwrappedCoordinates(this._source.tileID).map((we=>new n.S(we.canonical.z,we.wrap,we.canonical.z,we.canonical.x,we.canonical.y))):(A=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:v}),this._source.hasTile&&(A=A.filter((we=>this._source.hasTile(we))))):A=[];const M=o.coveringZoomLevel(this._source),P=Math.max(M-sr.maxOverzooming,this._source.minzoom),q=Math.max(M+sr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const we={};for(const Te of A)if(Te.canonical.z>this._source.minzoom){const Be=Te.scaledTo(Te.canonical.z-1);we[Be.key]=Be;const Ke=Te.scaledTo(Math.max(this._source.minzoom,Math.min(Te.canonical.z,5)));we[Ke.key]=Ke}A=A.concat(Object.values(we))}const J=A.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,J&&this.fire(new n.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const ne=this._updateRetainedTiles(A,M);fl(this._source.type)&&this._updateCoveredAndRetainedTiles(ne,P,q,M,A,v);for(const we in ne)this._tiles[we].clearFadeHold();const fe=n.ab(this._tiles,ne);for(const we of fe){const Te=this._tiles[we];Te.hasSymbolBuckets&&!Te.holdingForFade()?Te.setHoldDuration(this.map._fadeDuration):Te.hasSymbolBuckets&&!Te.symbolFadeFinished()||this._removeTile(we)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,v){var A;const M={},P={},q=Math.max(v-sr.maxOverzooming,this._source.minzoom),J=Math.max(v+sr.maxUnderzooming,this._source.minzoom),ne={};for(const fe of o){const we=this._addTile(fe);M[fe.key]=fe,we.hasData()||v<this._source.maxzoom&&(ne[fe.key]=fe)}this._retainLoadedChildren(ne,v,J,M);for(const fe of o){let we=this._tiles[fe.key];if(we.hasData())continue;if(v+1>this._source.maxzoom){const Be=fe.children(this._source.maxzoom)[0],Ke=this.getTile(Be);if(Ke&&Ke.hasData()){M[Be.key]=Be;continue}}else{const Be=fe.children(this._source.maxzoom);if(M[Be[0].key]&&M[Be[1].key]&&M[Be[2].key]&&M[Be[3].key])continue}let Te=we.wasRequested();for(let Be=fe.overscaledZ-1;Be>=q;--Be){const Ke=fe.scaledTo(Be);if(P[Ke.key])break;if(P[Ke.key]=!0,we=this.getTile(Ke),!we&&Te&&(we=this._addTile(Ke)),we){const ot=we.hasData();if((ot||!(!((A=this.map)===null||A===void 0)&&A.cancelPendingTileRequestsWhileZooming)||Te)&&(M[Ke.key]=Ke),Te=we.wasRequested(),ot)break}}}return M}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const v=[];let A,M=this._tiles[o].tileID;for(;M.overscaledZ>0;){if(M.key in this._loadedParentTiles){A=this._loadedParentTiles[M.key];break}v.push(M.key);const P=M.scaledTo(M.overscaledZ-1);if(A=this._getLoadedTile(P),A)break;M=P}for(const P of v)this._loadedParentTiles[P]=A}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const o in this._tiles){const v=this._tiles[o].tileID,A=this._getLoadedTile(v);this._loadedSiblingTiles[v.key]=A}}_addTile(o){let v=this._tiles[o.key];if(v)return v;v=this._cache.getAndRemove(o),v&&(this._setTileReloadTimer(o.key,v),v.tileID=o,this._state.initializeTileState(v,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,v)));const A=v;return v||(v=new ms(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(v,o.key,v.state)),v.uses++,this._tiles[o.key]=v,A||this._source.fire(new n.k("dataloading",{tile:v,coord:v.tileID,dataType:"source"})),v}_setTileReloadTimer(o,v){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const A=v.getExpiryTimeout();A&&(this._timers[o]=setTimeout((()=>{this._reloadTile(o,"expired"),delete this._timers[o]}),A))}_removeTile(o){const v=this._tiles[o];v&&(v.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),v.uses>0||(v.hasData()&&v.state!=="reloading"?this._cache.add(v.tileID,v,v.getExpiryTimeout()):(v.aborted=!0,this._abortTile(v),this._unloadTile(v))))}_dataHandler(o){const v=o.sourceDataType;o.dataType==="source"&&v==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&v==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,v,A){const M=[],P=this.transform;if(!P)return M;const q=A?P.getCameraQueryGeometry(o):o,J=o.map((ot=>P.pointCoordinate(ot,this.terrain))),ne=q.map((ot=>P.pointCoordinate(ot,this.terrain))),fe=this.getIds();let we=1/0,Te=1/0,Be=-1/0,Ke=-1/0;for(const ot of ne)we=Math.min(we,ot.x),Te=Math.min(Te,ot.y),Be=Math.max(Be,ot.x),Ke=Math.max(Ke,ot.y);for(let ot=0;ot<fe.length;ot++){const wt=this._tiles[fe[ot]];if(wt.holdingForFade())continue;const Mt=wt.tileID,Rt=Math.pow(2,P.zoom-wt.tileID.overscaledZ),Ft=v*wt.queryPadding*n.X/wt.tileSize/Rt,yt=[Mt.getTilePoint(new n.Z(we,Te)),Mt.getTilePoint(new n.Z(Be,Ke))];if(yt[0].x-Ft<n.X&&yt[0].y-Ft<n.X&&yt[1].x+Ft>=0&&yt[1].y+Ft>=0){const Ht=J.map((oi=>Mt.getTilePoint(oi))),Jt=ne.map((oi=>Mt.getTilePoint(oi)));M.push({tile:wt,tileID:Mt,queryGeometry:Ht,cameraQueryGeometry:Jt,scale:Rt})}}return M}getVisibleCoordinates(o){const v=this.getRenderableIds(o).map((A=>this._tiles[A].tileID));for(const A of v)A.posMatrix=this.transform.calculatePosMatrix(A.toUnwrapped());return v}hasTransition(){if(this._source.hasTransition())return!0;if(fl(this._source.type)){const o=it.now();for(const v in this._tiles)if(this._tiles[v].fadeEndTime>=o)return!0}return!1}setFeatureState(o,v,A){this._state.updateState(o=o||"_geojsonTileLayer",v,A)}removeFeatureState(o,v,A){this._state.removeFeatureState(o=o||"_geojsonTileLayer",v,A)}getFeatureState(o,v){return this._state.getState(o=o||"_geojsonTileLayer",v)}setDependencies(o,v,A){const M=this._tiles[o];M&&M.setDependencies(v,A)}reloadTilesForDependencies(o,v){for(const A in this._tiles)this._tiles[A].hasDependency(o,v)&&this._reloadTile(A,"reloading");this._cache.filter((A=>!A.hasDependency(o,v)))}}function Xs(L,o){const v=Math.abs(2*L.wrap)-+(L.wrap<0),A=Math.abs(2*o.wrap)-+(o.wrap<0);return L.overscaledZ-o.overscaledZ||A-v||o.canonical.y-L.canonical.y||o.canonical.x-L.canonical.x}function fl(L){return L==="raster"||L==="image"||L==="video"}sr.maxOverzooming=10,sr.maxUnderzooming=3;class Jr{constructor(o,v){this.reset(o,v)}reset(o,v){this.points=o||[],this._distances=[0];for(let A=1;A<this.points.length;A++)this._distances[A]=this._distances[A-1]+this.points[A].dist(this.points[A-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=n.ac(o,0,1);let v=1,A=this._distances[v];const M=o*this.paddedLength+this.padding;for(;A<M&&v<this._distances.length;)A=this._distances[++v];const P=v-1,q=this._distances[P],J=A-q,ne=J>0?(M-q)/J:0;return this.points[P].mult(1-ne).add(this.points[v].mult(ne))}}function pl(L,o){let v=!0;return L==="always"||L!=="never"&&o!=="never"||(v=!1),v}class Uo{constructor(o,v,A){const M=this.boxCells=[],P=this.circleCells=[];this.xCellCount=Math.ceil(o/A),this.yCellCount=Math.ceil(v/A);for(let q=0;q<this.xCellCount*this.yCellCount;q++)M.push([]),P.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=v,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,v,A,M,P){this._forEachCell(v,A,M,P,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(v),this.bboxes.push(A),this.bboxes.push(M),this.bboxes.push(P)}insertCircle(o,v,A,M){this._forEachCell(v-M,A-M,v+M,A+M,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(v),this.circles.push(A),this.circles.push(M)}_insertBoxCell(o,v,A,M,P,q){this.boxCells[P].push(q)}_insertCircleCell(o,v,A,M,P,q){this.circleCells[P].push(q)}_query(o,v,A,M,P,q,J){if(A<0||o>this.width||M<0||v>this.height)return[];const ne=[];if(o<=0&&v<=0&&this.width<=A&&this.height<=M){if(P)return[{key:null,x1:o,y1:v,x2:A,y2:M}];for(let fe=0;fe<this.boxKeys.length;fe++)ne.push({key:this.boxKeys[fe],x1:this.bboxes[4*fe],y1:this.bboxes[4*fe+1],x2:this.bboxes[4*fe+2],y2:this.bboxes[4*fe+3]});for(let fe=0;fe<this.circleKeys.length;fe++){const we=this.circles[3*fe],Te=this.circles[3*fe+1],Be=this.circles[3*fe+2];ne.push({key:this.circleKeys[fe],x1:we-Be,y1:Te-Be,x2:we+Be,y2:Te+Be})}}else this._forEachCell(o,v,A,M,this._queryCell,ne,{hitTest:P,overlapMode:q,seenUids:{box:{},circle:{}}},J);return ne}query(o,v,A,M){return this._query(o,v,A,M,!1,null)}hitTest(o,v,A,M,P,q){return this._query(o,v,A,M,!0,P,q).length>0}hitTestCircle(o,v,A,M,P){const q=o-A,J=o+A,ne=v-A,fe=v+A;if(J<0||q>this.width||fe<0||ne>this.height)return!1;const we=[];return this._forEachCell(q,ne,J,fe,this._queryCellCircle,we,{hitTest:!0,overlapMode:M,circle:{x:o,y:v,radius:A},seenUids:{box:{},circle:{}}},P),we.length>0}_queryCell(o,v,A,M,P,q,J,ne){const{seenUids:fe,hitTest:we,overlapMode:Te}=J,Be=this.boxCells[P];if(Be!==null){const ot=this.bboxes;for(const wt of Be)if(!fe.box[wt]){fe.box[wt]=!0;const Mt=4*wt,Rt=this.boxKeys[wt];if(o<=ot[Mt+2]&&v<=ot[Mt+3]&&A>=ot[Mt+0]&&M>=ot[Mt+1]&&(!ne||ne(Rt))&&(!we||!pl(Te,Rt.overlapMode))&&(q.push({key:Rt,x1:ot[Mt],y1:ot[Mt+1],x2:ot[Mt+2],y2:ot[Mt+3]}),we))return!0}}const Ke=this.circleCells[P];if(Ke!==null){const ot=this.circles;for(const wt of Ke)if(!fe.circle[wt]){fe.circle[wt]=!0;const Mt=3*wt,Rt=this.circleKeys[wt];if(this._circleAndRectCollide(ot[Mt],ot[Mt+1],ot[Mt+2],o,v,A,M)&&(!ne||ne(Rt))&&(!we||!pl(Te,Rt.overlapMode))){const Ft=ot[Mt],yt=ot[Mt+1],Ht=ot[Mt+2];if(q.push({key:Rt,x1:Ft-Ht,y1:yt-Ht,x2:Ft+Ht,y2:yt+Ht}),we)return!0}}}return!1}_queryCellCircle(o,v,A,M,P,q,J,ne){const{circle:fe,seenUids:we,overlapMode:Te}=J,Be=this.boxCells[P];if(Be!==null){const ot=this.bboxes;for(const wt of Be)if(!we.box[wt]){we.box[wt]=!0;const Mt=4*wt,Rt=this.boxKeys[wt];if(this._circleAndRectCollide(fe.x,fe.y,fe.radius,ot[Mt+0],ot[Mt+1],ot[Mt+2],ot[Mt+3])&&(!ne||ne(Rt))&&!pl(Te,Rt.overlapMode))return q.push(!0),!0}}const Ke=this.circleCells[P];if(Ke!==null){const ot=this.circles;for(const wt of Ke)if(!we.circle[wt]){we.circle[wt]=!0;const Mt=3*wt,Rt=this.circleKeys[wt];if(this._circlesCollide(ot[Mt],ot[Mt+1],ot[Mt+2],fe.x,fe.y,fe.radius)&&(!ne||ne(Rt))&&!pl(Te,Rt.overlapMode))return q.push(!0),!0}}}_forEachCell(o,v,A,M,P,q,J,ne){const fe=this._convertToXCellCoord(o),we=this._convertToYCellCoord(v),Te=this._convertToXCellCoord(A),Be=this._convertToYCellCoord(M);for(let Ke=fe;Ke<=Te;Ke++)for(let ot=we;ot<=Be;ot++)if(P.call(this,o,v,A,M,this.xCellCount*ot+Ke,q,J,ne))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,v,A,M,P,q){const J=M-o,ne=P-v,fe=A+q;return fe*fe>J*J+ne*ne}_circleAndRectCollide(o,v,A,M,P,q,J){const ne=(q-M)/2,fe=Math.abs(o-(M+ne));if(fe>ne+A)return!1;const we=(J-P)/2,Te=Math.abs(v-(P+we));if(Te>we+A)return!1;if(fe<=ne||Te<=we)return!0;const Be=fe-ne,Ke=Te-we;return Be*Be+Ke*Ke<=A*A}}function oc(L,o,v,A,M){const P=n.H();return o?(n.K(P,P,[1/M,1/M,1]),v||n.ad(P,P,A.angle)):n.L(P,A.labelPlaneMatrix,L),P}function cl(L,o,v,A,M){if(o){const P=n.ae(L);return n.K(P,P,[M,M,1]),v||n.ad(P,P,-A.angle),P}return A.glCoordMatrix}function ft(L,o,v,A){let M;A?(M=[L,o,A(L,o),1],n.af(M,M,v)):(M=[L,o,0,1],ct(M,M,v));const P=M[3];return{point:new n.P(M[0]/P,M[1]/P),signedDistanceFromCamera:P,isOccluded:!1}}function ze(L,o){return .5+L/o*.5}function Pe(L,o){return L.x>=-o[0]&&L.x<=o[0]&&L.y>=-o[1]&&L.y<=o[1]}function et(L,o,v,A,M,P,q,J,ne,fe,we,Te,Be,Ke,ot){const wt=A?L.textSizeData:L.iconSizeData,Mt=n.ag(wt,v.transform.zoom),Rt=[256/v.width*2+1,256/v.height*2+1],Ft=A?L.text.dynamicLayoutVertexArray:L.icon.dynamicLayoutVertexArray;Ft.clear();const yt=L.lineVertexArray,Ht=A?L.text.placedSymbolArray:L.icon.placedSymbolArray,Jt=v.transform.width/v.transform.height;let oi=!1;for(let Xi=0;Xi<Ht.length;Xi++){const An=Ht.get(Xi);if(An.hidden||An.writingMode===n.ah.vertical&&!oi){Cr(An.numGlyphs,Ft);continue}oi=!1;const Cn=ft(An.anchorX,An.anchorY,o,ot);if(!Pe(Cn.point,Rt)){Cr(An.numGlyphs,Ft);continue}const Zn=ze(v.transform.cameraToCenterDistance,Cn.signedDistanceFromCamera),Ln=n.ai(wt,Mt,An),Rn=q?Ln/Zn:Ln*Zn,ir={getElevation:ot,labelPlaneMatrix:M,lineVertexArray:yt,pitchWithMap:q,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:fe,tileAnchorPoint:new n.P(An.anchorX,An.anchorY),unwrappedTileID:we,width:Te,height:Be,translation:Ke},Xr=Ge(ir,An,Rn,!1,J,o,P,L.glyphOffsetArray,Ft,Jt,ne);oi=Xr.useVertical,(Xr.notEnoughRoom||oi||Xr.needsFlipping&&Ge(ir,An,Rn,!0,J,o,P,L.glyphOffsetArray,Ft,Jt,ne).notEnoughRoom)&&Cr(An.numGlyphs,Ft)}A?L.text.dynamicLayoutVertexBuffer.updateData(Ft):L.icon.dynamicLayoutVertexBuffer.updateData(Ft)}function gt(L,o,v,A,M,P,q,J){const ne=P.glyphStartIndex+P.numGlyphs,fe=P.lineStartIndex,we=P.lineStartIndex+P.lineLength,Te=o.getoffsetX(P.glyphStartIndex),Be=o.getoffsetX(ne-1),Ke=kn(L*Te,v,A,M,P.segment,fe,we,J,q);if(!Ke)return null;const ot=kn(L*Be,v,A,M,P.segment,fe,we,J,q);return ot?J.projectionCache.anyProjectionOccluded?null:{first:Ke,last:ot}:null}function jt(L,o,v,A){return L===n.ah.horizontal&&Math.abs(v.y-o.y)>Math.abs(v.x-o.x)*A?{useVertical:!0}:(L===n.ah.vertical?o.y<v.y:o.x>v.x)?{needsFlipping:!0}:null}function Ge(L,o,v,A,M,P,q,J,ne,fe,we){const Te=v/24,Be=o.lineOffsetX*Te,Ke=o.lineOffsetY*Te;let ot;if(o.numGlyphs>1){const wt=o.glyphStartIndex+o.numGlyphs,Mt=o.lineStartIndex,Rt=o.lineStartIndex+o.lineLength,Ft=gt(Te,J,Be,Ke,A,o,we,L);if(!Ft)return{notEnoughRoom:!0};const yt=ft(Ft.first.point.x,Ft.first.point.y,q,L.getElevation).point,Ht=ft(Ft.last.point.x,Ft.last.point.y,q,L.getElevation).point;if(M&&!A){const Jt=jt(o.writingMode,yt,Ht,fe);if(Jt)return Jt}ot=[Ft.first];for(let Jt=o.glyphStartIndex+1;Jt<wt-1;Jt++)ot.push(kn(Te*J.getoffsetX(Jt),Be,Ke,A,o.segment,Mt,Rt,L,we));ot.push(Ft.last)}else{if(M&&!A){const Mt=ft(L.tileAnchorPoint.x,L.tileAnchorPoint.y,P,L.getElevation).point,Rt=o.lineStartIndex+o.segment+1,Ft=new n.P(L.lineVertexArray.getx(Rt),L.lineVertexArray.gety(Rt)),yt=ft(Ft.x,Ft.y,P,L.getElevation),Ht=yt.signedDistanceFromCamera>0?yt.point:(function(oi,Xi,An,Cn,Zn,Ln){return ei(oi,Xi,An,1,Zn,Ln)})(L.tileAnchorPoint,Ft,Mt,0,P,L),Jt=jt(o.writingMode,Mt,Ht,fe);if(Jt)return Jt}const wt=kn(Te*J.getoffsetX(o.glyphStartIndex),Be,Ke,A,o.segment,o.lineStartIndex,o.lineStartIndex+o.lineLength,L,we);if(!wt||L.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ot=[wt]}for(const wt of ot)n.aj(ne,wt.point,wt.angle);return{}}function ei(L,o,v,A,M,P){const q=L.add(L.sub(o)._unit()),J=M!==void 0?ft(q.x,q.y,M,P.getElevation).point:Pi(q.x,q.y,P).point,ne=v.sub(J);return v.add(ne._mult(A/ne.mag()))}function kt(L,o,v){const A=o.projectionCache;if(A.projections[L])return A.projections[L];const M=new n.P(o.lineVertexArray.getx(L),o.lineVertexArray.gety(L)),P=Pi(M.x,M.y,o);if(P.signedDistanceFromCamera>0)return A.projections[L]=P.point,A.anyProjectionOccluded=A.anyProjectionOccluded||P.isOccluded,P.point;const q=L-v.direction;return(function(J,ne,fe,we,Te){return ei(J,ne,fe,we,void 0,Te)})(v.distanceFromAnchor===0?o.tileAnchorPoint:new n.P(o.lineVertexArray.getx(q),o.lineVertexArray.gety(q)),M,v.previousVertex,v.absOffsetX-v.distanceFromAnchor+1,o)}function Pi(L,o,v){const A=L+v.translation[0],M=o+v.translation[1];let P;return!v.pitchWithMap&&v.projection.useSpecialProjectionForSymbols?(P=v.projection.projectTileCoordinates(A,M,v.unwrappedTileID,v.getElevation),P.point.x=(.5*P.point.x+.5)*v.width,P.point.y=(.5*-P.point.y+.5)*v.height):(P=ft(A,M,v.labelPlaneMatrix,v.getElevation),P.isOccluded=!1),P}function fi(L,o,v){return L._unit()._perp()._mult(o*v)}function ui(L,o,v,A,M,P,q,J,ne){if(J.projectionCache.offsets[L])return J.projectionCache.offsets[L];const fe=v.add(o);if(L+ne.direction<A||L+ne.direction>=M)return J.projectionCache.offsets[L]=fe,fe;const we=kt(L+ne.direction,J,ne),Te=fi(we.sub(v),q,ne.direction),Be=v.add(Te),Ke=we.add(Te);return J.projectionCache.offsets[L]=n.ak(P,fe,Be,Ke)||fe,J.projectionCache.offsets[L]}function kn(L,o,v,A,M,P,q,J,ne){const fe=A?L-o:L+o;let we=fe>0?1:-1,Te=0;A&&(we*=-1,Te=Math.PI),we<0&&(Te+=Math.PI);let Be,Ke=we>0?P+M:P+M+1;J.projectionCache.cachedAnchorPoint?Be=J.projectionCache.cachedAnchorPoint:(Be=Pi(J.tileAnchorPoint.x,J.tileAnchorPoint.y,J).point,J.projectionCache.cachedAnchorPoint=Be);let ot,wt,Mt=Be,Rt=Be,Ft=0,yt=0;const Ht=Math.abs(fe),Jt=[];let oi;for(;Ft+yt<=Ht;){if(Ke+=we,Ke<P||Ke>=q)return null;Ft+=yt,Rt=Mt,wt=ot;const Cn={absOffsetX:Ht,direction:we,distanceFromAnchor:Ft,previousVertex:Rt};if(Mt=kt(Ke,J,Cn),v===0)Jt.push(Rt),oi=Mt.sub(Rt);else{let Zn;const Ln=Mt.sub(Rt);Zn=Ln.mag()===0?fi(kt(Ke+we,J,Cn).sub(Mt),v,we):fi(Ln,v,we),wt||(wt=Rt.add(Zn)),ot=ui(Ke,Zn,Mt,P,q,wt,v,J,Cn),Jt.push(wt),oi=ot.sub(wt)}yt=oi.mag()}const Xi=oi._mult((Ht-Ft)/yt)._add(wt||Rt),An=Te+Math.atan2(Mt.y-Rt.y,Mt.x-Rt.x);return Jt.push(Xi),{point:Xi,angle:ne?An:0,path:Jt}}const fr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Cr(L,o){for(let v=0;v<L;v++){const A=o.length;o.resize(A+4),o.float32.set(fr,3*A)}}function ct(L,o,v){const A=o[0],M=o[1];return L[0]=v[0]*A+v[4]*M+v[12],L[1]=v[1]*A+v[5]*M+v[13],L[3]=v[3]*A+v[7]*M+v[15],L}const te=100;class _e{constructor(o,v,A=new Uo(o.width+200,o.height+200,25),M=new Uo(o.width+200,o.height+200,25)){this.transform=o,this.mapProjection=v,this.grid=A,this.ignoredGrid=M,this.pitchFactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+te,this.screenBottomBoundary=o.height+te,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,v,A,M,P,q,J,ne,fe,we,Te){const Be=o.anchorPointX+ne[0],Ke=o.anchorPointY+ne[1],ot=this.projectAndGetPerspectiveRatio(M,Be,Ke,P,we),wt=A*ot.perspectiveRatio;let Mt;if(q||J)Mt=this._projectCollisionBox(o,wt,M,P,q,J,ne,ot,we,Te);else{const Jt=ot.point.x+(Te?Te.x*wt:0),oi=ot.point.y+(Te?Te.y*wt:0);Mt={allPointsOccluded:!1,box:[Jt+o.x1*wt,oi+o.y1*wt,Jt+o.x2*wt,oi+o.y2*wt]}}const[Rt,Ft,yt,Ht]=Mt.box;return this.mapProjection.useSpecialProjectionForSymbols&&(q?Mt.allPointsOccluded:this.mapProjection.isOccluded(Be,Ke,P))||ot.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Rt,Ft,yt,Ht)||v!=="always"&&this.grid.hitTest(Rt,Ft,yt,Ht,v,fe)?{box:[Rt,Ft,yt,Ht],placeable:!1,offscreen:!1}:{box:[Rt,Ft,yt,Ht],placeable:!0,offscreen:this.isOffscreen(Rt,Ft,yt,Ht)}}placeCollisionCircles(o,v,A,M,P,q,J,ne,fe,we,Te,Be,Ke,ot,wt,Mt){const Rt=[],Ft=new n.P(v.anchorX,v.anchorY),yt=this.getPerspectiveRatio(q,Ft.x,Ft.y,J,Mt),Ht=(Te?P/yt:P*yt)/n.ap,Jt={getElevation:Mt,labelPlaneMatrix:ne,lineVertexArray:A,pitchWithMap:Te,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Ft,unwrappedTileID:J,width:this.transform.width,height:this.transform.height,translation:wt},oi=gt(Ht,M,v.lineOffsetX*Ht,v.lineOffsetY*Ht,!1,v,!1,Jt);let Xi=!1,An=!1,Cn=!0;if(oi){const Zn=.5*Ke*yt+ot,Ln=new n.P(-100,-100),Rn=new n.P(this.screenRightBoundary,this.screenBottomBoundary),ir=new Jr,Xr=oi.first,Fn=oi.last;let qn=[];for(let Da=Xr.path.length-1;Da>=1;Da--)qn.push(Xr.path[Da]);for(let Da=1;Da<Fn.path.length;Da++)qn.push(Fn.path[Da]);const ea=2.5*Zn;if(fe){const Da=this.projectPathToScreenSpace(qn,Jt,fe);qn=Da.some((Ya=>Ya.signedDistanceFromCamera<=0))?[]:Da.map((Ya=>Ya.point))}let is=[];if(qn.length>0){const Da=qn[0].clone(),Ya=qn[0].clone();for(let Vs=1;Vs<qn.length;Vs++)Da.x=Math.min(Da.x,qn[Vs].x),Da.y=Math.min(Da.y,qn[Vs].y),Ya.x=Math.max(Ya.x,qn[Vs].x),Ya.y=Math.max(Ya.y,qn[Vs].y);is=Da.x>=Ln.x&&Ya.x<=Rn.x&&Da.y>=Ln.y&&Ya.y<=Rn.y?[qn]:Ya.x<Ln.x||Da.x>Rn.x||Ya.y<Ln.y||Da.y>Rn.y?[]:n.al([qn],Ln.x,Ln.y,Rn.x,Rn.y)}for(const Da of is){ir.reset(Da,.25*Zn);let Ya=0;Ya=ir.length<=.5*Zn?1:Math.ceil(ir.paddedLength/ea)+1;for(let Vs=0;Vs<Ya;Vs++){const sl=Vs/Math.max(Ya-1,1),pc=ir.lerp(sl),Us=pc.x+te,Fo=pc.y+te;Rt.push(Us,Fo,Zn,0);const Gs=Us-Zn,ks=Fo-Zn,Ro=Us+Zn,mc=Fo+Zn;if(Cn=Cn&&this.isOffscreen(Gs,ks,Ro,mc),An=An||this.isInsideGrid(Gs,ks,Ro,mc),o!=="always"&&this.grid.hitTestCircle(Us,Fo,Zn,o,Be)&&(Xi=!0,!we))return{circles:[],offscreen:!1,collisionDetected:Xi}}}}return{circles:!we&&Xi||!An||yt<this.perspectiveRatioCutoff?[]:Rt,offscreen:Cn,collisionDetected:Xi}}projectPathToScreenSpace(o,v,A){return o.map((M=>ft(M.x,M.y,A,v.getElevation)))}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const v=[];let A=1/0,M=1/0,P=-1/0,q=-1/0;for(const we of o){const Te=new n.P(we.x+te,we.y+te);A=Math.min(A,Te.x),M=Math.min(M,Te.y),P=Math.max(P,Te.x),q=Math.max(q,Te.y),v.push(Te)}const J=this.grid.query(A,M,P,q).concat(this.ignoredGrid.query(A,M,P,q)),ne={},fe={};for(const we of J){const Te=we.key;if(ne[Te.bucketInstanceId]===void 0&&(ne[Te.bucketInstanceId]={}),ne[Te.bucketInstanceId][Te.featureIndex])continue;const Be=[new n.P(we.x1,we.y1),new n.P(we.x2,we.y1),new n.P(we.x2,we.y2),new n.P(we.x1,we.y2)];n.am(v,Be)&&(ne[Te.bucketInstanceId][Te.featureIndex]=!0,fe[Te.bucketInstanceId]===void 0&&(fe[Te.bucketInstanceId]=[]),fe[Te.bucketInstanceId].push(Te.featureIndex))}return fe}insertCollisionBox(o,v,A,M,P,q){(A?this.ignoredGrid:this.grid).insert({bucketInstanceId:M,featureIndex:P,collisionGroupID:q,overlapMode:v},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,v,A,M,P,q){const J=A?this.ignoredGrid:this.grid,ne={bucketInstanceId:M,featureIndex:P,collisionGroupID:q,overlapMode:v};for(let fe=0;fe<o.length;fe+=4)J.insertCircle(ne,o[fe],o[fe+1],o[fe+2])}projectAndGetPerspectiveRatio(o,v,A,M,P){let q;P?(q=[v,A,P(v,A),1],n.af(q,q,o)):(q=[v,A,0,1],ct(q,q,o));const J=q[3];return{point:new n.P((q[0]/J+1)/2*this.transform.width+te,(-q[1]/J+1)/2*this.transform.height+te),perspectiveRatio:.5+this.transform.cameraToCenterDistance/J*.5,isOccluded:!1,signedDistanceFromCamera:J}}getPerspectiveRatio(o,v,A,M,P){const q=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(v,A,M,P):ft(v,A,o,P);return .5+this.transform.cameraToCenterDistance/q.signedDistanceFromCamera*.5}isOffscreen(o,v,A,M){return A<te||o>=this.screenRightBoundary||M<te||v>this.screenBottomBoundary}isInsideGrid(o,v,A,M){return A>=0&&o<this.gridRightBoundary&&M>=0&&v<this.gridBottomBoundary}getViewportMatrix(){const o=n.an([]);return n.J(o,o,[-100,-100,0]),o}_projectCollisionBox(o,v,A,M,P,q,J,ne,fe,we){let Te=new n.P(1,0),Be=new n.P(0,1);const Ke=new n.P(o.anchorPointX+J[0],o.anchorPointY+J[1]);if(q&&!P){const Cn=this.projectAndGetPerspectiveRatio(A,Ke.x+1,Ke.y,M,fe).point.sub(ne.point).unit(),Zn=Math.atan(Cn.y/Cn.x)+(Cn.x<0?Math.PI:0),Ln=Math.sin(Zn),Rn=Math.cos(Zn);Te=new n.P(Rn,Ln),Be=new n.P(-Ln,Rn)}else if(!q&&P){const Cn=-this.transform.angle,Zn=Math.sin(Cn),Ln=Math.cos(Cn);Te=new n.P(Ln,Zn),Be=new n.P(-Zn,Ln)}let ot=ne.point,wt=v;if(P){ot=Ke;const Cn=this.transform.zoom-Math.floor(this.transform.zoom);wt=Math.pow(2,-Cn),wt*=this.mapProjection.getPitchedTextCorrection(this.transform,Ke,M),we||(wt*=n.ac(.5+ne.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}we&&(ot=ot.add(Te.mult(we.x*wt)).add(Be.mult(we.y*wt)));const Mt=o.x1*wt,Rt=o.x2*wt,Ft=(Mt+Rt)/2,yt=o.y1*wt,Ht=o.y2*wt,Jt=(yt+Ht)/2,oi=[{offsetX:Mt,offsetY:yt},{offsetX:Ft,offsetY:yt},{offsetX:Rt,offsetY:yt},{offsetX:Rt,offsetY:Jt},{offsetX:Rt,offsetY:Ht},{offsetX:Ft,offsetY:Ht},{offsetX:Mt,offsetY:Ht},{offsetX:Mt,offsetY:Jt}];let Xi=[];for(const{offsetX:Cn,offsetY:Zn}of oi)Xi.push(new n.P(ot.x+Te.x*Cn+Be.x*Zn,ot.y+Te.y*Cn+Be.y*Zn));let An=!1;if(P){const Cn=Xi.map((Zn=>this.projectAndGetPerspectiveRatio(A,Zn.x,Zn.y,M,fe)));An=Cn.some((Zn=>!Zn.isOccluded)),Xi=Cn.map((Zn=>Zn.point))}else An=!0;return{box:n.ao(Xi),allPointsOccluded:!An}}}function Re(L,o,v){return o*(n.X/(L.tileSize*Math.pow(2,v-L.tileID.overscaledZ)))}class tt{constructor(o,v,A,M){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?v:-v))):M&&A?1:0,this.placed=A}isHidden(){return this.opacity===0&&!this.placed}}class Xe{constructor(o,v,A,M,P){this.text=new tt(o?o.text:null,v,A,P),this.icon=new tt(o?o.icon:null,v,M,P)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class at{constructor(o,v,A){this.text=o,this.icon=v,this.skipFade=A}}class St{constructor(){this.invProjMatrix=n.H(),this.viewportMatrix=n.H(),this.circles=[]}}class lt{constructor(o,v,A,M,P){this.bucketInstanceId=o,this.featureIndex=v,this.sourceLayerIndex=A,this.bucketIndex=M,this.tileID=P}}class It{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const v=++this.maxGroupID;this.collisionGroups[o]={ID:v,predicate:A=>A.collisionGroupID===v}}return this.collisionGroups[o]}}function ti(L,o,v,A,M){const{horizontalAlign:P,verticalAlign:q}=n.au(L);return new n.P(-(P-.5)*o+A[0]*M,-(q-.5)*v+A[1]*M)}class Gt{constructor(o,v,A,M,P,q){this.transform=o.clone(),this.terrain=A,this.collisionIndex=new _e(this.transform,v),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=M,this.retainedQueryData={},this.collisionGroups=new It(P),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=q,q&&(q.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const v=this.terrain;return v?(A,M)=>v.getElevation(o,A,M):null}getBucketParts(o,v,A,M){const P=A.getBucket(v),q=A.latestFeatureIndex;if(!P||!q||v.id!==P.layerIds[0])return;const J=A.collisionBoxArray,ne=P.layers[0].layout,fe=P.layers[0].paint,we=Math.pow(2,this.transform.zoom-A.tileID.overscaledZ),Te=A.tileSize/n.X,Be=A.tileID.toUnwrapped(),Ke=this.transform.calculatePosMatrix(Be),ot=ne.get("text-pitch-alignment")==="map",wt=ne.get("text-rotation-alignment")==="map",Mt=Re(A,1,this.transform.zoom),Rt=this.collisionIndex.mapProjection.translatePosition(this.transform,A,fe.get("text-translate"),fe.get("text-translate-anchor")),Ft=this.collisionIndex.mapProjection.translatePosition(this.transform,A,fe.get("icon-translate"),fe.get("icon-translate-anchor")),yt=oc(Ke,ot,wt,this.transform,Mt);let Ht=null;if(ot){const oi=cl(Ke,ot,wt,this.transform,Mt);Ht=n.L([],this.transform.labelPlaneMatrix,oi)}this.retainedQueryData[P.bucketInstanceId]=new lt(P.bucketInstanceId,q,P.sourceLayerIndex,P.index,A.tileID);const Jt={bucket:P,layout:ne,translationText:Rt,translationIcon:Ft,posMatrix:Ke,unwrappedTileID:Be,textLabelPlaneMatrix:yt,labelToScreenMatrix:Ht,scale:we,textPixelRatio:Te,holdingForFade:A.holdingForFade(),collisionBoxArray:J,partiallyEvaluatedTextSize:n.ag(P.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(P.sourceID)};if(M)for(const oi of P.sortKeyRanges){const{sortKey:Xi,symbolInstanceStart:An,symbolInstanceEnd:Cn}=oi;o.push({sortKey:Xi,symbolInstanceStart:An,symbolInstanceEnd:Cn,parameters:Jt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:P.symbolInstances.length,parameters:Jt})}attemptAnchorPlacement(o,v,A,M,P,q,J,ne,fe,we,Te,Be,Ke,ot,wt,Mt,Rt,Ft,yt){const Ht=n.aq[o.textAnchor],Jt=[o.textOffset0,o.textOffset1],oi=ti(Ht,A,M,Jt,P),Xi=this.collisionIndex.placeCollisionBox(v,Be,ne,fe,we,J,q,Mt,Te.predicate,yt,oi);if((!Ft||this.collisionIndex.placeCollisionBox(Ft,Be,ne,fe,we,J,q,Rt,Te.predicate,yt,oi).placeable)&&Xi.placeable){let An;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke.crossTileID]&&this.prevPlacement.placements[Ke.crossTileID]&&this.prevPlacement.placements[Ke.crossTileID].text&&(An=this.prevPlacement.variableOffsets[Ke.crossTileID].anchor),Ke.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Ke.crossTileID]={textOffset:Jt,width:A,height:M,anchor:Ht,textBoxScale:P,prevAnchor:An},this.markUsedJustification(ot,Ht,Ke,wt),ot.allowVerticalPlacement&&(this.markUsedOrientation(ot,wt,Ke),this.placedOrientations[Ke.crossTileID]=wt),{shift:oi,placedGlyphBoxes:Xi}}}placeLayerBucketPart(o,v,A){const{bucket:M,layout:P,translationText:q,translationIcon:J,posMatrix:ne,unwrappedTileID:fe,textLabelPlaneMatrix:we,labelToScreenMatrix:Te,textPixelRatio:Be,holdingForFade:Ke,collisionBoxArray:ot,partiallyEvaluatedTextSize:wt,collisionGroup:Mt}=o.parameters,Rt=P.get("text-optional"),Ft=P.get("icon-optional"),yt=n.ar(P,"text-overlap","text-allow-overlap"),Ht=yt==="always",Jt=n.ar(P,"icon-overlap","icon-allow-overlap"),oi=Jt==="always",Xi=P.get("text-rotation-alignment")==="map",An=P.get("text-pitch-alignment")==="map",Cn=P.get("icon-text-fit")!=="none",Zn=P.get("symbol-z-order")==="viewport-y",Ln=Ht&&(oi||!M.hasIconData()||Ft),Rn=oi&&(Ht||!M.hasTextData()||Rt);!M.collisionArrays&&ot&&M.deserializeCollisionBoxes(ot);const ir=this._getTerrainElevationFunc(this.retainedQueryData[M.bucketInstanceId].tileID),Xr=(Fn,qn,ea)=>{var is,Da;if(v[Fn.crossTileID])return;if(Ke)return void(this.placements[Fn.crossTileID]=new at(!1,!1,!1));let Ya=!1,Vs=!1,sl=!0,pc=null,Us={box:null,placeable:!1,offscreen:null},Fo={placeable:!1},Gs=null,ks=null,Ro=null,mc=0,Bl=0,Kc=0;qn.textFeatureIndex?mc=qn.textFeatureIndex:Fn.useRuntimeCollisionCircles&&(mc=Fn.featureIndex),qn.verticalTextFeatureIndex&&(Bl=qn.verticalTextFeatureIndex);const ul=qn.textBox;if(ul){const hi=pn=>{let vo=n.ah.horizontal;if(M.allowVerticalPlacement&&!pn&&this.prevPlacement){const xl=this.prevPlacement.placedOrientations[Fn.crossTileID];xl&&(this.placedOrientations[Fn.crossTileID]=xl,vo=xl,this.markUsedOrientation(M,vo,Fn))}return vo},Na=(pn,vo)=>{if(M.allowVerticalPlacement&&Fn.numVerticalGlyphVertices>0&&qn.verticalTextBox){for(const xl of M.writingModes)if(xl===n.ah.vertical?(Us=vo(),Fo=Us):Us=pn(),Us&&Us.placeable)break}else Us=pn()},gs=Fn.textAnchorOffsetStartIndex,Ko=Fn.textAnchorOffsetEndIndex;if(Ko===gs){const pn=(vo,xl)=>{const ja=this.collisionIndex.placeCollisionBox(vo,yt,Be,ne,fe,An,Xi,q,Mt.predicate,ir);return ja&&ja.placeable&&(this.markUsedOrientation(M,xl,Fn),this.placedOrientations[Fn.crossTileID]=xl),ja};Na((()=>pn(ul,n.ah.horizontal)),(()=>{const vo=qn.verticalTextBox;return M.allowVerticalPlacement&&Fn.numVerticalGlyphVertices>0&&vo?pn(vo,n.ah.vertical):{box:null,offscreen:null}})),hi(Us&&Us.placeable)}else{let pn=n.aq[(Da=(is=this.prevPlacement)===null||is===void 0?void 0:is.variableOffsets[Fn.crossTileID])===null||Da===void 0?void 0:Da.anchor];const vo=(ja,_c,jh)=>{const Ys=ja.x2-ja.x1,rf=ja.y2-ja.y1,Uu=Fn.textBoxScale,Dp=Cn&&Jt==="never"?_c:null;let qo=null,rp=yt==="never"?1:2,Jo="never";pn&&rp++;for(let gc=0;gc<rp;gc++){for(let hh=gs;hh<Ko;hh++){const Qo=M.textAnchorOffsets.get(hh);if(pn&&Qo.textAnchor!==pn)continue;const no=this.attemptAnchorPlacement(Qo,ja,Ys,rf,Uu,Xi,An,Be,ne,fe,Mt,Jo,Fn,M,jh,q,J,Dp,ir);if(no&&(qo=no.placedGlyphBoxes,qo&&qo.placeable))return Ya=!0,pc=no.shift,qo}pn?pn=null:Jo=yt}return A&&!qo&&(qo={box:this.collisionIndex.placeCollisionBox(ul,"always",Be,ne,fe,An,Xi,q,Mt.predicate,ir,new n.P(0,0)).box,offscreen:!1,placeable:!1}),qo};Na((()=>vo(ul,qn.iconBox,n.ah.horizontal)),(()=>{const ja=qn.verticalTextBox;return M.allowVerticalPlacement&&(!Us||!Us.placeable)&&Fn.numVerticalGlyphVertices>0&&ja?vo(ja,qn.verticalIconBox,n.ah.vertical):{box:null,occluded:!0,offscreen:null}})),Us&&(Ya=Us.placeable,sl=Us.offscreen);const xl=hi(Us&&Us.placeable);if(!Ya&&this.prevPlacement){const ja=this.prevPlacement.variableOffsets[Fn.crossTileID];ja&&(this.variableOffsets[Fn.crossTileID]=ja,this.markUsedJustification(M,ja.anchor,Fn,xl))}}}if(Gs=Us,Ya=Gs&&Gs.placeable,sl=Gs&&Gs.offscreen,Fn.useRuntimeCollisionCircles){const hi=M.text.placedSymbolArray.get(Fn.centerJustifiedTextSymbolIndex),Na=n.ai(M.textSizeData,wt,hi),gs=P.get("text-padding");ks=this.collisionIndex.placeCollisionCircles(yt,hi,M.lineVertexArray,M.glyphOffsetArray,Na,ne,fe,we,Te,A,An,Mt.predicate,Fn.collisionCircleDiameter,gs,q,ir),ks.circles.length&&ks.collisionDetected&&!A&&n.w("Collisions detected, but collision boxes are not shown"),Ya=Ht||ks.circles.length>0&&!ks.collisionDetected,sl=sl&&ks.offscreen}if(qn.iconFeatureIndex&&(Kc=qn.iconFeatureIndex),qn.iconBox){const hi=Na=>this.collisionIndex.placeCollisionBox(Na,Jt,Be,ne,fe,An,Xi,J,Mt.predicate,ir,Cn&&pc?pc:void 0);Fo&&Fo.placeable&&qn.verticalIconBox?(Ro=hi(qn.verticalIconBox),Vs=Ro.placeable):(Ro=hi(qn.iconBox),Vs=Ro.placeable),sl=sl&&Ro.offscreen}const Fs=Rt||Fn.numHorizontalGlyphVertices===0&&Fn.numVerticalGlyphVertices===0,xu=Ft||Fn.numIconVertices===0;Fs||xu?xu?Fs||(Vs=Vs&&Ya):Ya=Vs&&Ya:Vs=Ya=Vs&&Ya;const Nl=Vs&&Ro.placeable;if(Ya&&Gs.placeable&&this.collisionIndex.insertCollisionBox(Gs.box,yt,P.get("text-ignore-placement"),M.bucketInstanceId,Fo&&Fo.placeable&&Bl?Bl:mc,Mt.ID),Nl&&this.collisionIndex.insertCollisionBox(Ro.box,Jt,P.get("icon-ignore-placement"),M.bucketInstanceId,Kc,Mt.ID),ks&&Ya&&this.collisionIndex.insertCollisionCircles(ks.circles,yt,P.get("text-ignore-placement"),M.bucketInstanceId,mc,Mt.ID),A&&this.storeCollisionData(M.bucketInstanceId,ea,qn,Gs,Ro,ks),Fn.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(M.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Fn.crossTileID]=new at(Ya||Ln,Vs||Rn,sl||M.justReloaded),v[Fn.crossTileID]=!0};if(Zn){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Fn=M.getSortedSymbolIndexes(this.transform.angle);for(let qn=Fn.length-1;qn>=0;--qn){const ea=Fn[qn];Xr(M.symbolInstances.get(ea),M.collisionArrays[ea],ea)}}else for(let Fn=o.symbolInstanceStart;Fn<o.symbolInstanceEnd;Fn++)Xr(M.symbolInstances.get(Fn),M.collisionArrays[Fn],Fn);if(A&&M.bucketInstanceId in this.collisionCircleArrays){const Fn=this.collisionCircleArrays[M.bucketInstanceId];n.as(Fn.invProjMatrix,ne),Fn.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}storeCollisionData(o,v,A,M,P,q){if(A.textBox||A.iconBox){let J,ne;this.collisionBoxArrays.has(o)?J=this.collisionBoxArrays.get(o):(J=new Map,this.collisionBoxArrays.set(o,J)),J.has(v)?ne=J.get(v):(ne={text:null,icon:null},J.set(v,ne)),A.textBox&&(ne.text=M.box),A.iconBox&&(ne.icon=P.box)}if(q){let J=this.collisionCircleArrays[o];J===void 0&&(J=this.collisionCircleArrays[o]=new St);for(let ne=0;ne<q.circles.length;ne+=4)J.circles.push(q.circles[ne+0]),J.circles.push(q.circles[ne+1]),J.circles.push(q.circles[ne+2]),J.circles.push(q.collisionDetected?1:0)}}markUsedJustification(o,v,A,M){let P;P=M===n.ah.vertical?A.verticalPlacedTextSymbolIndex:{left:A.leftJustifiedTextSymbolIndex,center:A.centerJustifiedTextSymbolIndex,right:A.rightJustifiedTextSymbolIndex}[n.at(v)];const q=[A.leftJustifiedTextSymbolIndex,A.centerJustifiedTextSymbolIndex,A.rightJustifiedTextSymbolIndex,A.verticalPlacedTextSymbolIndex];for(const J of q)J>=0&&(o.text.placedSymbolArray.get(J).crossTileID=P>=0&&J!==P?0:A.crossTileID)}markUsedOrientation(o,v,A){const M=v===n.ah.horizontal||v===n.ah.horizontalOnly?v:0,P=v===n.ah.vertical?v:0,q=[A.leftJustifiedTextSymbolIndex,A.centerJustifiedTextSymbolIndex,A.rightJustifiedTextSymbolIndex];for(const J of q)o.text.placedSymbolArray.get(J).placedOrientation=M;A.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(A.verticalPlacedTextSymbolIndex).placedOrientation=P)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const v=this.prevPlacement;let A=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;const M=v?v.symbolFadeChange(o):1,P=v?v.opacities:{},q=v?v.variableOffsets:{},J=v?v.placedOrientations:{};for(const ne in this.placements){const fe=this.placements[ne],we=P[ne];we?(this.opacities[ne]=new Xe(we,M,fe.text,fe.icon),A=A||fe.text!==we.text.placed||fe.icon!==we.icon.placed):(this.opacities[ne]=new Xe(null,M,fe.text,fe.icon,fe.skipFade),A=A||fe.text||fe.icon)}for(const ne in P){const fe=P[ne];if(!this.opacities[ne]){const we=new Xe(fe,M,!1,!1);we.isHidden()||(this.opacities[ne]=we,A=A||fe.text.placed||fe.icon.placed)}}for(const ne in q)this.variableOffsets[ne]||!this.opacities[ne]||this.opacities[ne].isHidden()||(this.variableOffsets[ne]=q[ne]);for(const ne in J)this.placedOrientations[ne]||!this.opacities[ne]||this.opacities[ne].isHidden()||(this.placedOrientations[ne]=J[ne]);if(v&&v.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");A?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:o)}updateLayerOpacities(o,v){const A={};for(const M of v){const P=M.getBucket(o);P&&M.latestFeatureIndex&&o.id===P.layerIds[0]&&this.updateBucketOpacities(P,M.tileID,A,M.collisionBoxArray)}}updateBucketOpacities(o,v,A,M){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const P=o.layers[0],q=P.layout,J=new Xe(null,0,!1,!1,!0),ne=q.get("text-allow-overlap"),fe=q.get("icon-allow-overlap"),we=P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Te=q.get("text-rotation-alignment")==="map",Be=q.get("text-pitch-alignment")==="map",Ke=q.get("icon-text-fit")!=="none",ot=new Xe(null,0,ne&&(fe||!o.hasIconData()||q.get("icon-optional")),fe&&(ne||!o.hasTextData()||q.get("text-optional")),!0);!o.collisionArrays&&M&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(M);const wt=(Rt,Ft,yt)=>{for(let Ht=0;Ht<Ft/4;Ht++)Rt.opacityVertexArray.emplaceBack(yt);Rt.hasVisibleVertices=Rt.hasVisibleVertices||yt!==cs},Mt=this.collisionBoxArrays.get(o.bucketInstanceId);for(let Rt=0;Rt<o.symbolInstances.length;Rt++){const Ft=o.symbolInstances.get(Rt),{numHorizontalGlyphVertices:yt,numVerticalGlyphVertices:Ht,crossTileID:Jt}=Ft;let oi=this.opacities[Jt];A[Jt]?oi=J:oi||(oi=ot,this.opacities[Jt]=oi),A[Jt]=!0;const Xi=Ft.numIconVertices>0,An=this.placedOrientations[Ft.crossTileID],Cn=An===n.ah.vertical,Zn=An===n.ah.horizontal||An===n.ah.horizontalOnly;if(yt>0||Ht>0){const Rn=ts(oi.text);wt(o.text,yt,Cn?cs:Rn),wt(o.text,Ht,Zn?cs:Rn);const ir=oi.text.isHidden();[Ft.rightJustifiedTextSymbolIndex,Ft.centerJustifiedTextSymbolIndex,Ft.leftJustifiedTextSymbolIndex].forEach((qn=>{qn>=0&&(o.text.placedSymbolArray.get(qn).hidden=ir||Cn?1:0)})),Ft.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Ft.verticalPlacedTextSymbolIndex).hidden=ir||Zn?1:0);const Xr=this.variableOffsets[Ft.crossTileID];Xr&&this.markUsedJustification(o,Xr.anchor,Ft,An);const Fn=this.placedOrientations[Ft.crossTileID];Fn&&(this.markUsedJustification(o,"left",Ft,Fn),this.markUsedOrientation(o,Fn,Ft))}if(Xi){const Rn=ts(oi.icon),ir=!(Ke&&Ft.verticalPlacedIconSymbolIndex&&Cn);Ft.placedIconSymbolIndex>=0&&(wt(o.icon,Ft.numIconVertices,ir?Rn:cs),o.icon.placedSymbolArray.get(Ft.placedIconSymbolIndex).hidden=oi.icon.isHidden()),Ft.verticalPlacedIconSymbolIndex>=0&&(wt(o.icon,Ft.numVerticalIconVertices,ir?cs:Rn),o.icon.placedSymbolArray.get(Ft.verticalPlacedIconSymbolIndex).hidden=oi.icon.isHidden())}const Ln=Mt&&Mt.has(Rt)?Mt.get(Rt):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Rn=o.collisionArrays[Rt];if(Rn){let ir=new n.P(0,0);if(Rn.textBox||Rn.verticalTextBox){let Xr=!0;if(we){const Fn=this.variableOffsets[Jt];Fn?(ir=ti(Fn.anchor,Fn.width,Fn.height,Fn.textOffset,Fn.textBoxScale),Te&&ir._rotate(Be?this.transform.angle:-this.transform.angle)):Xr=!1}if(Rn.textBox||Rn.verticalTextBox){let Fn;Rn.textBox&&(Fn=Cn),Rn.verticalTextBox&&(Fn=Zn),Ji(o.textCollisionBox.collisionVertexArray,oi.text.placed,!Xr||Fn,Ln.text,ir.x,ir.y)}}if(Rn.iconBox||Rn.verticalIconBox){const Xr=!!(!Zn&&Rn.verticalIconBox);let Fn;Rn.iconBox&&(Fn=Xr),Rn.verticalIconBox&&(Fn=!Xr),Ji(o.iconCollisionBox.collisionVertexArray,oi.icon.placed,Fn,Ln.icon,Ke?ir.x:0,Ke?ir.y:0)}}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const Rt=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Rt.invProjMatrix,o.placementViewportMatrix=Rt.viewportMatrix,o.collisionCircleArray=Rt.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,v){const A=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*A>o}setStale(){this.stale=!0}}function Ji(L,o,v,A,M,P){A&&A.length!==0||(A=[0,0,0,0]);const q=A[0]-te,J=A[1]-te,ne=A[2]-te,fe=A[3]-te;L.emplaceBack(o?1:0,v?1:0,M||0,P||0,q,J),L.emplaceBack(o?1:0,v?1:0,M||0,P||0,ne,J),L.emplaceBack(o?1:0,v?1:0,M||0,P||0,ne,fe),L.emplaceBack(o?1:0,v?1:0,M||0,P||0,q,fe)}const Qi=Math.pow(2,25),ji=Math.pow(2,24),pr=Math.pow(2,17),$n=Math.pow(2,16),Nn=Math.pow(2,9),qr=Math.pow(2,8),Oa=Math.pow(2,1);function ts(L){if(L.opacity===0&&!L.placed)return 0;if(L.opacity===1&&L.placed)return 4294967295;const o=L.placed?1:0,v=Math.floor(127*L.opacity);return v*Qi+o*ji+v*pr+o*$n+v*Nn+o*qr+v*Oa+o}const cs=0;function Zs(){return{isOccluded:(L,o,v)=>!1,getPitchedTextCorrection:(L,o,v)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(L,o,v,A){throw new Error("Not implemented.")},translatePosition:(L,o,v,A)=>(function(M,P,q,J,ne=!1){if(!q[0]&&!q[1])return[0,0];const fe=ne?J==="map"?M.angle:0:J==="viewport"?-M.angle:0;if(fe){const we=Math.sin(fe),Te=Math.cos(fe);q=[q[0]*Te-q[1]*we,q[0]*we+q[1]*Te]}return[ne?q[0]:Re(P,q[0],M.zoom),ne?q[1]:Re(P,q[1],M.zoom)]})(L,o,v,A),getCircleRadiusCorrection:L=>1}}class na{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,v,A,M,P){const q=this._bucketParts;for(;this._currentTileIndex<o.length;)if(v.getBucketParts(q,M,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,P())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,q.sort(((J,ne)=>J.sortKey-ne.sortKey)));this._currentPartIndex<q.length;)if(v.placeLayerBucketPart(q[this._currentPartIndex],this._seenCrossTileIDs,A),this._currentPartIndex++,P())return!0;return!1}}class $r{constructor(o,v,A,M,P,q,J,ne){this.placement=new Gt(o,Zs(),v,q,J,ne),this._currentPlacementIndex=A.length-1,this._forceFullPlacement=M,this._showCollisionBoxes=P,this._done=!1}isDone(){return this._done}continuePlacement(o,v,A){const M=it.now(),P=()=>!this._forceFullPlacement&&it.now()-M>2;for(;this._currentPlacementIndex>=0;){const q=v[o[this._currentPlacementIndex]],J=this.placement.collisionIndex.transform.zoom;if(q.type==="symbol"&&(!q.minzoom||q.minzoom<=J)&&(!q.maxzoom||q.maxzoom>J)){if(this._inProgressLayer||(this._inProgressLayer=new na(q)),this._inProgressLayer.continuePlacement(A[q.source],this.placement,this._showCollisionBoxes,q,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const _a=512/n.X/2;class ur{constructor(o,v,A){this.tileID=o,this.bucketInstanceId=A,this._symbolsByKey={};const M=new Map;for(let P=0;P<v.length;P++){const q=v.get(P),J=q.key,ne=M.get(J);ne?ne.push(q):M.set(J,[q])}for(const[P,q]of M){const J={positions:q.map((ne=>({x:Math.floor(ne.anchorX*_a),y:Math.floor(ne.anchorY*_a)}))),crossTileIDs:q.map((ne=>ne.crossTileID))};if(J.positions.length>128){const ne=new n.av(J.positions.length,16,Uint16Array);for(const{x:fe,y:we}of J.positions)ne.add(fe,we);ne.finish(),delete J.positions,J.index=ne}this._symbolsByKey[P]=J}}getScaledCoordinates(o,v){const{x:A,y:M,z:P}=this.tileID.canonical,{x:q,y:J,z:ne}=v.canonical,fe=_a/Math.pow(2,ne-P),we=(J*n.X+o.anchorY)*fe,Te=M*n.X*_a;return{x:Math.floor((q*n.X+o.anchorX)*fe-A*n.X*_a),y:Math.floor(we-Te)}}findMatches(o,v,A){const M=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z);for(let P=0;P<o.length;P++){const q=o.get(P);if(q.crossTileID)continue;const J=this._symbolsByKey[q.key];if(!J)continue;const ne=this.getScaledCoordinates(q,v);if(J.index){const fe=J.index.range(ne.x-M,ne.y-M,ne.x+M,ne.y+M).sort();for(const we of fe){const Te=J.crossTileIDs[we];if(!A[Te]){A[Te]=!0,q.crossTileID=Te;break}}}else if(J.positions)for(let fe=0;fe<J.positions.length;fe++){const we=J.positions[fe],Te=J.crossTileIDs[fe];if(Math.abs(we.x-ne.x)<=M&&Math.abs(we.y-ne.y)<=M&&!A[Te]){A[Te]=!0,q.crossTileID=Te;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:o})=>o))}}class kr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Xa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const v=Math.round((o-this.lng)/360);if(v!==0)for(const A in this.indexes){const M=this.indexes[A],P={};for(const q in M){const J=M[q];J.tileID=J.tileID.unwrapTo(J.tileID.wrap+v),P[J.tileID.key]=J}this.indexes[A]=P}this.lng=o}addBucket(o,v,A){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let P=0;P<v.symbolInstances.length;P++)v.symbolInstances.get(P).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const M=this.usedCrossTileIDs[o.overscaledZ];for(const P in this.indexes){const q=this.indexes[P];if(Number(P)>o.overscaledZ)for(const J in q){const ne=q[J];ne.tileID.isChildOf(o)&&ne.findMatches(v.symbolInstances,o,M)}else{const J=q[o.scaledTo(Number(P)).key];J&&J.findMatches(v.symbolInstances,o,M)}}for(let P=0;P<v.symbolInstances.length;P++){const q=v.symbolInstances.get(P);q.crossTileID||(q.crossTileID=A.generate(),M[q.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new ur(o,v.symbolInstances,v.bucketInstanceId),!0}removeBucketCrossTileIDs(o,v){for(const A of v.getCrossTileIDsLists())for(const M of A)delete this.usedCrossTileIDs[o][M]}removeStaleBuckets(o){let v=!1;for(const A in this.indexes){const M=this.indexes[A];for(const P in M)o[M[P].bucketInstanceId]||(this.removeBucketCrossTileIDs(A,M[P]),delete M[P],v=!0)}return v}}class Lo{constructor(){this.layerIndexes={},this.crossTileIDs=new kr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,v,A){let M=this.layerIndexes[o.id];M===void 0&&(M=this.layerIndexes[o.id]=new Xa);let P=!1;const q={};M.handleWrapJump(A);for(const J of v){const ne=J.getBucket(o);ne&&o.id===ne.layerIds[0]&&(ne.bucketInstanceId||(ne.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(J.tileID,ne,this.crossTileIDs)&&(P=!0),q[ne.bucketInstanceId]=!0)}return M.removeStaleBuckets(q)&&(P=!0),P}pruneUnusedLayers(o){const v={};o.forEach((A=>{v[A]=!0}));for(const A in this.layerIndexes)v[A]||delete this.layerIndexes[A]}}const eo=(L,o)=>n.t(L,o&&o.filter((v=>v.identifier!=="source.canvas"))),ml=n.aw();class ih extends n.E{constructor(o,v={}){super(),this._rtlPluginLoaded=()=>{for(const A in this.sourceCaches){const M=this.sourceCaches[A].getSource().type;M!=="vector"&&M!=="geojson"||this.sourceCaches[A].reload()}},this.map=o,this.dispatcher=new Lr(In(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",((A,M)=>this.getGlyphs(A,M))),this.dispatcher.registerMessageHandler("GI",((A,M)=>this.getImages(A,M))),this.imageManager=new Wi,this.imageManager.setEventedParent(this),this.glyphManager=new xi(o._requestManager,v.localIdeographFontFamily),this.lineAtlas=new mi(256,512),this.crossTileSymbolIndex=new Lo,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new n.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",n.ay()),Ha().on(Qt,this._rtlPluginLoaded),this.on("data",(A=>{if(A.dataType!=="source"||A.sourceDataType!=="metadata")return;const M=this.sourceCaches[A.sourceId];if(!M)return;const P=M.getSource();if(P&&P.vectorLayerIds)for(const q in this._layers){const J=this._layers[q];J.source===P.id&&this._validateLayer(J)}}))}loadURL(o,v={},A){this.fire(new n.k("dataloading",{dataType:"style"})),v.validate=typeof v.validate!="boolean"||v.validate;const M=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const P=this._loadStyleRequest;n.h(M,this._loadStyleRequest).then((q=>{this._loadStyleRequest=null,this._load(q.data,v,A)})).catch((q=>{this._loadStyleRequest=null,q&&!P.signal.aborted&&this.fire(new n.j(q))}))}loadJSON(o,v={},A){this.fire(new n.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,it.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,v.validate=v.validate!==!1,this._load(o,v,A)})).catch((()=>{}))}loadEmpty(){this.fire(new n.k("dataloading",{dataType:"style"})),this._load(ml,{validate:!1})}_load(o,v,A){var M;const P=v.transformStyle?v.transformStyle(A,o):o;if(!v.validate||!eo(this,n.u(P))){this._loaded=!0,this.stylesheet=P;for(const q in P.sources)this.addSource(q,P.sources[q],{validate:!1});P.sprite?this._loadSprite(P.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(P.glyphs),this._createLayers(),this.light=new Er(this.stylesheet.light),this.sky=new di(this.stylesheet.sky),this.map.setTerrain((M=this.stylesheet.terrain)!==null&&M!==void 0?M:null),this.fire(new n.k("data",{dataType:"style"})),this.fire(new n.k("style.load"))}}_createLayers(){const o=n.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map((v=>v.id)),this._layers={},this._serializedLayers=null;for(const v of o){const A=n.aA(v);A.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=A}}_loadSprite(o,v=!1,A=void 0){let M;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(P,q,J,ne){return n._(this,void 0,void 0,(function*(){const fe=Bt(P),we=J>1?"@2x":"",Te={},Be={};for(const{id:Ke,url:ot}of fe){const wt=q.transformRequest(Ni(ot,we,".json"),"SpriteJSON");Te[Ke]=n.h(wt,ne);const Mt=q.transformRequest(Ni(ot,we,".png"),"SpriteImage");Be[Ke]=an.getImage(Mt,ne)}return yield Promise.all([...Object.values(Te),...Object.values(Be)]),(function(Ke,ot){return n._(this,void 0,void 0,(function*(){const wt={};for(const Mt in Ke){wt[Mt]={};const Rt=it.getImageCanvasContext((yield ot[Mt]).data),Ft=(yield Ke[Mt]).data;for(const yt in Ft){const{width:Ht,height:Jt,x:oi,y:Xi,sdf:An,pixelRatio:Cn,stretchX:Zn,stretchY:Ln,content:Rn,textFitWidth:ir,textFitHeight:Xr}=Ft[yt];wt[Mt][yt]={data:null,pixelRatio:Cn,sdf:An,stretchX:Zn,stretchY:Ln,content:Rn,textFitWidth:ir,textFitHeight:Xr,spriteData:{width:Ht,height:Jt,x:oi,y:Xi,context:Rt}}}}return wt}))})(Te,Be)}))})(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((P=>{if(this._spriteRequest=null,P)for(const q in P){this._spritesImagesIds[q]=[];const J=this._spritesImagesIds[q]?this._spritesImagesIds[q].filter((ne=>!(ne in P))):[];for(const ne of J)this.imageManager.removeImage(ne),this._changedImages[ne]=!0;for(const ne in P[q]){const fe=q==="default"?ne:`${q}:${ne}`;this._spritesImagesIds[q].push(fe),fe in this.imageManager.images?this.imageManager.updateImage(fe,P[q][ne],!1):this.imageManager.addImage(fe,P[q][ne]),v&&(this._changedImages[fe]=!0)}}})).catch((P=>{this._spriteRequest=null,M=P,this.fire(new n.j(M))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),v&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new n.k("data",{dataType:"style"})),A&&A(M)}))}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new n.k("data",{dataType:"style"}))}_validateLayer(o){const v=this.sourceCaches[o.source];if(!v)return;const A=o.sourceLayer;if(!A)return;const M=v.getSource();(M.type==="geojson"||M.vectorLayerIds&&M.vectorLayerIds.indexOf(A)===-1)&&this.fire(new n.j(new Error(`Source layer "${A}" does not exist on source "${M.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,v=!1){const A=this._serializedAllLayers();if(!o||o.length===0)return Object.values(v?n.aB(A):A);const M=[];for(const P of o)if(A[P]){const q=v?n.aB(A[P]):A[P];M.push(q)}return M}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const v=Object.keys(this._layers);for(const A of v){const M=this._layers[A];M.type!=="custom"&&(o[A]=M.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const v=this._changed;if(v){const M=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);(M.length||P.length)&&this._updateWorkerLayers(M,P);for(const q in this._updatedSources){const J=this._updatedSources[q];if(J==="reload")this._reloadSource(q);else{if(J!=="clear")throw new Error(`Invalid action ${J}`);this._clearSource(q)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const q in this._updatedPaintProps)this._layers[q].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const A={};for(const M in this.sourceCaches){const P=this.sourceCaches[M];A[M]=P.used,P.used=!1}for(const M of this._order){const P=this._layers[M];P.recalculate(o,this._availableImages),!P.isHidden(o.zoom)&&P.source&&(this.sourceCaches[P.source].used=!0)}for(const M in A){const P=this.sourceCaches[M];!!A[M]!=!!P.used&&P.fire(new n.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:M}))}this.light.recalculate(o),this.sky.recalculate(o),this.z=o.zoom,v&&this.fire(new n.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const v in this.sourceCaches)this.sourceCaches[v].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,v){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:v})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,v={}){var A;this._checkLoaded();const M=this.serialize();if(o=v.transformStyle?v.transformStyle(M,o):o,((A=v.validate)===null||A===void 0||A)&&eo(this,n.u(o)))return!1;(o=n.aB(o)).layers=n.az(o.layers);const P=n.aC(M,o),q=this._getOperationsToPerform(P);if(q.unimplemented.length>0)throw new Error(`Unimplemented: ${q.unimplemented.join(", ")}.`);if(q.operations.length===0)return!1;for(const J of q.operations)J();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const v=[],A=[];for(const M of o)switch(M.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":v.push((()=>this.addLayer.apply(this,M.args)));break;case"removeLayer":v.push((()=>this.removeLayer.apply(this,M.args)));break;case"setPaintProperty":v.push((()=>this.setPaintProperty.apply(this,M.args)));break;case"setLayoutProperty":v.push((()=>this.setLayoutProperty.apply(this,M.args)));break;case"setFilter":v.push((()=>this.setFilter.apply(this,M.args)));break;case"addSource":v.push((()=>this.addSource.apply(this,M.args)));break;case"removeSource":v.push((()=>this.removeSource.apply(this,M.args)));break;case"setLayerZoomRange":v.push((()=>this.setLayerZoomRange.apply(this,M.args)));break;case"setLight":v.push((()=>this.setLight.apply(this,M.args)));break;case"setGeoJSONSourceData":v.push((()=>this.setGeoJSONSourceData.apply(this,M.args)));break;case"setGlyphs":v.push((()=>this.setGlyphs.apply(this,M.args)));break;case"setSprite":v.push((()=>this.setSprite.apply(this,M.args)));break;case"setSky":v.push((()=>this.setSky.apply(this,M.args)));break;case"setTerrain":v.push((()=>this.map.setTerrain.apply(this,M.args)));break;case"setTransition":v.push((()=>{}));break;default:A.push(M.command)}return{operations:v,unimplemented:A}}addImage(o,v){if(this.getImage(o))return this.fire(new n.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,v),this._afterImageUpdated(o)}updateImage(o,v){this.imageManager.updateImage(o,v)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new n.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new n.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,v,A={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!v.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(v).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(v.type)>=0&&this._validate(n.u.source,`sources.${o}`,v,null,A))return;this.map&&this.map._collectResourceTiming&&(v.collectResourceTiming=!0);const M=this.sourceCaches[o]=new sr(o,v,this.dispatcher);M.style=this,M.setEventedParent(this,(()=>({isSourceLoaded:M.loaded(),source:M.serialize(),sourceId:o}))),M.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const A in this._layers)if(this._layers[A].source===o)return this.fire(new n.j(new Error(`Source "${o}" cannot be removed while layer "${A}" is using it.`)));const v=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],v.fire(new n.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),v.setEventedParent(null),v.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,v){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const A=this.sourceCaches[o].getSource();if(A.type!=="geojson")throw new Error(`geojsonSource.type is ${A.type}, which is !== 'geojson`);A.setData(v),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,v,A={}){this._checkLoaded();const M=o.id;if(this.getLayer(M))return void this.fire(new n.j(new Error(`Layer "${M}" already exists on this map.`)));let P;if(o.type==="custom"){if(eo(this,n.aD(o)))return;P=n.aA(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(M,o.source),o=n.aB(o),o=n.e(o,{source:M})),this._validate(n.u.layer,`layers.${M}`,o,{arrayIndex:-1},A))return;P=n.aA(o),this._validateLayer(P),P.setEventedParent(this,{layer:{id:M}})}const q=v?this._order.indexOf(v):this._order.length;if(v&&q===-1)this.fire(new n.j(new Error(`Cannot add layer "${M}" before non-existing layer "${v}".`)));else{if(this._order.splice(q,0,M),this._layerOrderChanged=!0,this._layers[M]=P,this._removedLayers[M]&&P.source&&P.type!=="custom"){const J=this._removedLayers[M];delete this._removedLayers[M],J.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}moveLayer(o,v){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new n.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===v)return;const A=this._order.indexOf(o);this._order.splice(A,1);const M=v?this._order.indexOf(v):this._order.length;v&&M===-1?this.fire(new n.j(new Error(`Cannot move layer "${o}" before non-existing layer "${v}".`))):(this._order.splice(M,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const v=this._layers[o];if(!v)return void this.fire(new n.j(new Error(`Cannot remove non-existing layer "${o}".`)));v.setEventedParent(null);const A=this._order.indexOf(o);this._order.splice(A,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=v,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],v.onRemove&&v.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,v,A){this._checkLoaded();const M=this.getLayer(o);M?M.minzoom===v&&M.maxzoom===A||(v!=null&&(M.minzoom=v),A!=null&&(M.maxzoom=A),this._updateLayer(M)):this.fire(new n.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,v,A={}){this._checkLoaded();const M=this.getLayer(o);if(M){if(!n.aE(M.filter,v))return v==null?(M.filter=void 0,void this._updateLayer(M)):void(this._validate(n.u.filter,`layers.${M.id}.filter`,v,null,A)||(M.filter=n.aB(v),this._updateLayer(M)))}else this.fire(new n.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return n.aB(this.getLayer(o).filter)}setLayoutProperty(o,v,A,M={}){this._checkLoaded();const P=this.getLayer(o);P?n.aE(P.getLayoutProperty(v),A)||(P.setLayoutProperty(v,A,M),this._updateLayer(P)):this.fire(new n.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,v){const A=this.getLayer(o);if(A)return A.getLayoutProperty(v);this.fire(new n.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,v,A,M={}){this._checkLoaded();const P=this.getLayer(o);P?n.aE(P.getPaintProperty(v),A)||(P.setPaintProperty(v,A,M)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new n.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,v){return this.getLayer(o).getPaintProperty(v)}setFeatureState(o,v){this._checkLoaded();const A=o.source,M=o.sourceLayer,P=this.sourceCaches[A];if(P===void 0)return void this.fire(new n.j(new Error(`The source '${A}' does not exist in the map's style.`)));const q=P.getSource().type;q==="geojson"&&M?this.fire(new n.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):q!=="vector"||M?(o.id===void 0&&this.fire(new n.j(new Error("The feature id parameter must be provided."))),P.setFeatureState(M,o.id,v)):this.fire(new n.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,v){this._checkLoaded();const A=o.source,M=this.sourceCaches[A];if(M===void 0)return void this.fire(new n.j(new Error(`The source '${A}' does not exist in the map's style.`)));const P=M.getSource().type,q=P==="vector"?o.sourceLayer:void 0;P!=="vector"||q?v&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new n.j(new Error("A feature id is required to remove its specific state property."))):M.removeFeatureState(q,o.id,v):this.fire(new n.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const v=o.source,A=o.sourceLayer,M=this.sourceCaches[v];if(M!==void 0)return M.getSource().type!=="vector"||A?(o.id===void 0&&this.fire(new n.j(new Error("The feature id parameter must be provided."))),M.getFeatureState(A,o.id)):void this.fire(new n.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new n.j(new Error(`The source '${v}' does not exist in the map's style.`)))}getTransition(){return n.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=n.aF(this.sourceCaches,(P=>P.serialize())),v=this._serializeByIds(this._order,!0),A=this.map.getTerrain()||void 0,M=this.stylesheet;return n.aG({version:M.version,name:M.name,metadata:M.metadata,light:M.light,sky:M.sky,center:M.center,zoom:M.zoom,bearing:M.bearing,pitch:M.pitch,sprite:M.sprite,glyphs:M.glyphs,transition:M.transition,sources:o,layers:v,terrain:A},(P=>P!==void 0))}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const v=q=>this._layers[q].type==="fill-extrusion",A={},M=[];for(let q=this._order.length-1;q>=0;q--){const J=this._order[q];if(v(J)){A[J]=q;for(const ne of o){const fe=ne[J];if(fe)for(const we of fe)M.push(we)}}}M.sort(((q,J)=>J.intersectionZ-q.intersectionZ));const P=[];for(let q=this._order.length-1;q>=0;q--){const J=this._order[q];if(v(J))for(let ne=M.length-1;ne>=0;ne--){const fe=M[ne].feature;if(A[fe.layer.id]<q)break;P.push(fe),M.pop()}else for(const ne of o){const fe=ne[J];if(fe)for(const we of fe)P.push(we.feature)}}return P}queryRenderedFeatures(o,v,A){v&&v.filter&&this._validate(n.u.filter,"queryRenderedFeatures.filter",v.filter,null,v);const M={};if(v&&v.layers){if(!Array.isArray(v.layers))return this.fire(new n.j(new Error("parameters.layers must be an Array."))),[];for(const J of v.layers){const ne=this._layers[J];if(!ne)return this.fire(new n.j(new Error(`The layer '${J}' does not exist in the map's style and cannot be queried for features.`))),[];M[ne.source]=!0}}const P=[];v.availableImages=this._availableImages;const q=this._serializedAllLayers();for(const J in this.sourceCaches)v.layers&&!M[J]||P.push(Kr(this.sourceCaches[J],this._layers,q,o,v,A));return this.placement&&P.push((function(J,ne,fe,we,Te,Be,Ke){const ot={},wt=Be.queryRenderedSymbols(we),Mt=[];for(const Rt of Object.keys(wt).map(Number))Mt.push(Ke[Rt]);Mt.sort(oa);for(const Rt of Mt){const Ft=Rt.featureIndex.lookupSymbolFeatures(wt[Rt.bucketInstanceId],ne,Rt.bucketIndex,Rt.sourceLayerIndex,Te.filter,Te.layers,Te.availableImages,J);for(const yt in Ft){const Ht=ot[yt]=ot[yt]||[],Jt=Ft[yt];Jt.sort(((oi,Xi)=>{const An=Rt.featureSortOrder;if(An){const Cn=An.indexOf(oi.featureIndex);return An.indexOf(Xi.featureIndex)-Cn}return Xi.featureIndex-oi.featureIndex}));for(const oi of Jt)Ht.push(oi)}}for(const Rt in ot)ot[Rt].forEach((Ft=>{const yt=Ft.feature,Ht=fe[J[Rt].source].getFeatureState(yt.layer["source-layer"],yt.id);yt.source=yt.layer.source,yt.layer["source-layer"]&&(yt.sourceLayer=yt.layer["source-layer"]),yt.state=Ht}));return ot})(this._layers,q,this.sourceCaches,o,v,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)}querySourceFeatures(o,v){v&&v.filter&&this._validate(n.u.filter,"querySourceFeatures.filter",v.filter,null,v);const A=this.sourceCaches[o];return A?(function(M,P){const q=M.getRenderableIds().map((fe=>M.getTileByID(fe))),J=[],ne={};for(let fe=0;fe<q.length;fe++){const we=q[fe],Te=we.tileID.canonical.key;ne[Te]||(ne[Te]=!0,we.querySourceFeatures(J,P))}return J})(A,v):[]}getLight(){return this.light.getLight()}setLight(o,v={}){this._checkLoaded();const A=this.light.getLight();let M=!1;for(const q in o)if(!n.aE(o[q],A[q])){M=!0;break}if(!M)return;const P={now:it.now(),transition:n.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,v),this.light.updateTransitions(P)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,v={}){const A=this.getSky();let M=!1;if(!o&&!A)return;if(o&&!A)M=!0;else if(!o&&A)M=!0;else for(const q in o)if(!n.aE(o[q],A[q])){M=!0;break}if(!M)return;const P={now:it.now(),transition:n.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,v),this.sky.updateTransitions(P)}_validate(o,v,A,M,P={}){return(!P||P.validate!==!1)&&eo(this,o.call(n.u,n.e({key:v,style:this.serialize(),value:A,styleSpec:n.v},M)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ha().off(Qt,this._rtlPluginLoaded);for(const v in this._layers)this._layers[v].setEventedParent(null);for(const v in this.sourceCaches){const A=this.sourceCaches[v];A.setEventedParent(null),A.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const v in this.sourceCaches)this.sourceCaches[v].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,v,A,M,P=!1){let q=!1,J=!1;const ne={};for(const fe of this._order){const we=this._layers[fe];if(we.type!=="symbol")continue;if(!ne[we.source]){const Be=this.sourceCaches[we.source];ne[we.source]=Be.getRenderableIds(!0).map((Ke=>Be.getTileByID(Ke))).sort(((Ke,ot)=>ot.tileID.overscaledZ-Ke.tileID.overscaledZ||(Ke.tileID.isLessThan(ot.tileID)?-1:1)))}const Te=this.crossTileSymbolIndex.addLayer(we,ne[we.source],o.center.lng);q=q||Te}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||A===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(it.now(),o.zoom))&&(this.pauseablePlacement=new $r(o,this.map.terrain,this._order,P,v,A,M,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ne),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(it.now()),J=!0),q&&this.pauseablePlacement.placement.setStale()),J||q)for(const fe of this._order){const we=this._layers[fe];we.type==="symbol"&&this.placement.updateLayerOpacities(we,ne[we.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(it.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,v){return n._(this,void 0,void 0,(function*(){const A=yield this.imageManager.getImages(v.icons);this._updateTilesForChangedImages();const M=this.sourceCaches[v.source];return M&&M.setDependencies(v.tileID.key,v.type,v.icons),A}))}getGlyphs(o,v){return n._(this,void 0,void 0,(function*(){const A=yield this.glyphManager.getGlyphs(v.stacks),M=this.sourceCaches[v.source];return M&&M.setDependencies(v.tileID.key,v.type,[""]),A}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,v={}){this._checkLoaded(),o&&this._validate(n.u.glyphs,"glyphs",o,null,v)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,v,A={},M){this._checkLoaded();const P=[{id:o,url:v}],q=[...Bt(this.stylesheet.sprite),...P];this._validate(n.u.sprite,"sprite",q,null,A)||(this.stylesheet.sprite=q,this._loadSprite(P,!0,M))}removeSprite(o){this._checkLoaded();const v=Bt(this.stylesheet.sprite);if(v.find((A=>A.id===o))){if(this._spritesImagesIds[o])for(const A of this._spritesImagesIds[o])this.imageManager.removeImage(A),this._changedImages[A]=!0;v.splice(v.findIndex((A=>A.id===o)),1),this.stylesheet.sprite=v.length>0?v:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new n.k("data",{dataType:"style"}))}else this.fire(new n.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Bt(this.stylesheet.sprite)}setSprite(o,v={},A){this._checkLoaded(),o&&this._validate(n.u.sprite,"sprite",o,null,v)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,A):(this._unloadSprite(),A&&A(null)))}}var ns=n.Y([{name:"a_pos",type:"Int16",components:2}]);const Go={prelude:va(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:va(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:va(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:va(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:va("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:va(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:va(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:va("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:va("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:va("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:va(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:va(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:va(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:va(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:va(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:va(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:va(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:va(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:va(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:va(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:va(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:va(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:va(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:va(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:va(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:va(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:va("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:va("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:va("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:va("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function va(L,o){const v=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,A=o.match(/attribute ([\w]+) ([\w]+)/g),M=L.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),q=P?P.concat(M):M,J={};return{fragmentSource:L=L.replace(v,((ne,fe,we,Te,Be)=>(J[Be]=!0,fe==="define"?`
#ifndef HAS_UNIFORM_u_${Be}
varying ${we} ${Te} ${Be};
#else
uniform ${we} ${Te} u_${Be};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Be}
    ${we} ${Te} ${Be} = u_${Be};
#endif
`))),vertexSource:o=o.replace(v,((ne,fe,we,Te,Be)=>{const Ke=Te==="float"?"vec2":"vec4",ot=Be.match(/color/)?"color":Ke;return J[Be]?fe==="define"?`
#ifndef HAS_UNIFORM_u_${Be}
uniform lowp float u_${Be}_t;
attribute ${we} ${Ke} a_${Be};
varying ${we} ${Te} ${Be};
#else
uniform ${we} ${Te} u_${Be};
#endif
`:ot==="vec4"?`
#ifndef HAS_UNIFORM_u_${Be}
    ${Be} = a_${Be};
#else
    ${we} ${Te} ${Be} = u_${Be};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Be}
    ${Be} = unpack_mix_${ot}(a_${Be}, u_${Be}_t);
#else
    ${we} ${Te} ${Be} = u_${Be};
#endif
`:fe==="define"?`
#ifndef HAS_UNIFORM_u_${Be}
uniform lowp float u_${Be}_t;
attribute ${we} ${Ke} a_${Be};
#else
uniform ${we} ${Te} u_${Be};
#endif
`:ot==="vec4"?`
#ifndef HAS_UNIFORM_u_${Be}
    ${we} ${Te} ${Be} = a_${Be};
#else
    ${we} ${Te} ${Be} = u_${Be};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Be}
    ${we} ${Te} ${Be} = unpack_mix_${ot}(a_${Be}, u_${Be}_t);
#else
    ${we} ${Te} ${Be} = u_${Be};
#endif
`})),staticAttributes:A,staticUniforms:q}}class Mc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,v,A,M,P,q,J,ne,fe){this.context=o;let we=this.boundPaintVertexBuffers.length!==M.length;for(let Te=0;!we&&Te<M.length;Te++)this.boundPaintVertexBuffers[Te]!==M[Te]&&(we=!0);!this.vao||this.boundProgram!==v||this.boundLayoutVertexBuffer!==A||we||this.boundIndexBuffer!==P||this.boundVertexOffset!==q||this.boundDynamicVertexBuffer!==J||this.boundDynamicVertexBuffer2!==ne||this.boundDynamicVertexBuffer3!==fe?this.freshBind(v,A,M,P,q,J,ne,fe):(o.bindVertexArray.set(this.vao),J&&J.bind(),P&&P.dynamicDraw&&P.bind(),ne&&ne.bind(),fe&&fe.bind())}freshBind(o,v,A,M,P,q,J,ne){const fe=o.numAttributes,we=this.context,Te=we.gl;this.vao&&this.destroy(),this.vao=we.createVertexArray(),we.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=A,this.boundIndexBuffer=M,this.boundVertexOffset=P,this.boundDynamicVertexBuffer=q,this.boundDynamicVertexBuffer2=J,this.boundDynamicVertexBuffer3=ne,v.enableAttributes(Te,o);for(const Be of A)Be.enableAttributes(Te,o);q&&q.enableAttributes(Te,o),J&&J.enableAttributes(Te,o),ne&&ne.enableAttributes(Te,o),v.bind(),v.setVertexAttribPointers(Te,o,P);for(const Be of A)Be.bind(),Be.setVertexAttribPointers(Te,o,P);q&&(q.bind(),q.setVertexAttribPointers(Te,o,P)),M&&M.bind(),J&&(J.bind(),J.setVertexAttribPointers(Te,o,P)),ne&&(ne.bind(),ne.setVertexAttribPointers(Te,o,P)),we.currentNumAttributes=fe}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const to=(L,o,v,A,M)=>({u_matrix:L,u_texture:0,u_ele_delta:o,u_fog_matrix:v,u_fog_color:A?A.properties.get("fog-color"):n.aM.white,u_fog_ground_blend:A?A.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:A?A.calculateFogBlendOpacity(M):0,u_horizon_color:A?A.properties.get("horizon-color"):n.aM.white,u_horizon_fog_blend:A?A.properties.get("horizon-fog-blend"):1});function Vc(L){const o=[];for(let v=0;v<L.length;v++){if(L[v]===null)continue;const A=L[v].split(" ");o.push(A.pop())}return o}class Ah{constructor(o,v,A,M,P,q){const J=o.gl;this.program=J.createProgram();const ne=Vc(v.staticAttributes),fe=A?A.getBinderAttributes():[],we=ne.concat(fe),Te=Go.prelude.staticUniforms?Vc(Go.prelude.staticUniforms):[],Be=v.staticUniforms?Vc(v.staticUniforms):[],Ke=A?A.getBinderUniforms():[],ot=Te.concat(Be).concat(Ke),wt=[];for(const oi of ot)wt.indexOf(oi)<0&&wt.push(oi);const Mt=A?A.defines():[];P&&Mt.push("#define OVERDRAW_INSPECTOR;"),q&&Mt.push("#define TERRAIN3D;");const Rt=Mt.concat(Go.prelude.fragmentSource,v.fragmentSource).join(`
`),Ft=Mt.concat(Go.prelude.vertexSource,v.vertexSource).join(`
`),yt=J.createShader(J.FRAGMENT_SHADER);if(J.isContextLost())return void(this.failedToCreate=!0);if(J.shaderSource(yt,Rt),J.compileShader(yt),!J.getShaderParameter(yt,J.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${J.getShaderInfoLog(yt)}`);J.attachShader(this.program,yt);const Ht=J.createShader(J.VERTEX_SHADER);if(J.isContextLost())return void(this.failedToCreate=!0);if(J.shaderSource(Ht,Ft),J.compileShader(Ht),!J.getShaderParameter(Ht,J.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${J.getShaderInfoLog(Ht)}`);J.attachShader(this.program,Ht),this.attributes={};const Jt={};this.numAttributes=we.length;for(let oi=0;oi<this.numAttributes;oi++)we[oi]&&(J.bindAttribLocation(this.program,oi,we[oi]),this.attributes[we[oi]]=oi);if(J.linkProgram(this.program),!J.getProgramParameter(this.program,J.LINK_STATUS))throw new Error(`Program failed to link: ${J.getProgramInfoLog(this.program)}`);J.deleteShader(Ht),J.deleteShader(yt);for(let oi=0;oi<wt.length;oi++){const Xi=wt[oi];if(Xi&&!Jt[Xi]){const An=J.getUniformLocation(this.program,Xi);An&&(Jt[Xi]=An)}}this.fixedUniforms=M(o,Jt),this.terrainUniforms=((oi,Xi)=>({u_depth:new n.aH(oi,Xi.u_depth),u_terrain:new n.aH(oi,Xi.u_terrain),u_terrain_dim:new n.aI(oi,Xi.u_terrain_dim),u_terrain_matrix:new n.aJ(oi,Xi.u_terrain_matrix),u_terrain_unpack:new n.aK(oi,Xi.u_terrain_unpack),u_terrain_exaggeration:new n.aI(oi,Xi.u_terrain_exaggeration)}))(o,Jt),this.binderUniforms=A?A.getUniforms(o,Jt):[]}draw(o,v,A,M,P,q,J,ne,fe,we,Te,Be,Ke,ot,wt,Mt,Rt,Ft){const yt=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(A),o.setStencilMode(M),o.setColorMode(P),o.setCullFace(q),ne){o.activeTexture.set(yt.TEXTURE2),yt.bindTexture(yt.TEXTURE_2D,ne.depthTexture),o.activeTexture.set(yt.TEXTURE3),yt.bindTexture(yt.TEXTURE_2D,ne.texture);for(const Jt in this.terrainUniforms)this.terrainUniforms[Jt].set(ne[Jt])}for(const Jt in this.fixedUniforms)this.fixedUniforms[Jt].set(J[Jt]);wt&&wt.setUniforms(o,this.binderUniforms,Ke,{zoom:ot});let Ht=0;switch(v){case yt.LINES:Ht=2;break;case yt.TRIANGLES:Ht=3;break;case yt.LINE_STRIP:Ht=1}for(const Jt of Be.get()){const oi=Jt.vaos||(Jt.vaos={});(oi[fe]||(oi[fe]=new Mc)).bind(o,this,we,wt?wt.getPaintVertexBuffers():[],Te,Jt.vertexOffset,Mt,Rt,Ft),yt.drawElements(v,Jt.primitiveLength*Ht,yt.UNSIGNED_SHORT,Jt.primitiveOffset*Ht*2)}}}function su(L,o,v){const A=1/Re(v,1,o.transform.tileZoom),M=Math.pow(2,v.tileID.overscaledZ),P=v.tileSize*Math.pow(2,o.transform.tileZoom)/M,q=P*(v.tileID.canonical.x+v.tileID.wrap*M),J=P*v.tileID.canonical.y;return{u_image:0,u_texsize:v.imageAtlasTexture.size,u_scale:[A,L.fromScale,L.toScale],u_fade:L.t,u_pixel_coord_upper:[q>>16,J>>16],u_pixel_coord_lower:[65535&q,65535&J]}}const Kh=(L,o,v,A)=>{const M=o.style.light,P=M.properties.get("position"),q=[P.x,P.y,P.z],J=(function(){var fe=new n.A(9);return n.A!=Float32Array&&(fe[1]=0,fe[2]=0,fe[3]=0,fe[5]=0,fe[6]=0,fe[7]=0),fe[0]=1,fe[4]=1,fe[8]=1,fe})();M.properties.get("anchor")==="viewport"&&(function(fe,we){var Te=Math.sin(we),Be=Math.cos(we);fe[0]=Be,fe[1]=Te,fe[2]=0,fe[3]=-Te,fe[4]=Be,fe[5]=0,fe[6]=0,fe[7]=0,fe[8]=1})(J,-o.transform.angle),(function(fe,we,Te){var Be=we[0],Ke=we[1],ot=we[2];fe[0]=Be*Te[0]+Ke*Te[3]+ot*Te[6],fe[1]=Be*Te[1]+Ke*Te[4]+ot*Te[7],fe[2]=Be*Te[2]+Ke*Te[5]+ot*Te[8]})(q,q,J);const ne=M.properties.get("color");return{u_matrix:L,u_lightpos:q,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+v,u_opacity:A}},Jh=(L,o,v,A,M,P,q)=>n.e(Kh(L,o,v,A),su(P,o,q),{u_height_factor:-Math.pow(2,M.overscaledZ)/q.tileSize/8}),Mu=L=>({u_matrix:L}),Uc=(L,o,v,A)=>n.e(Mu(L),su(v,o,A)),lc=(L,o)=>({u_matrix:L,u_world:o}),ou=(L,o,v,A,M)=>n.e(Uc(L,o,v,A),{u_world:M}),Ic=(L,o,v,A)=>{const M=L.transform;let P,q;if(A.paint.get("circle-pitch-alignment")==="map"){const J=Re(v,1,M.zoom);P=!0,q=[J,J]}else P=!1,q=M.pixelsToGLUnits;return{u_camera_to_center_distance:M.cameraToCenterDistance,u_scale_with_map:+(A.paint.get("circle-pitch-scale")==="map"),u_matrix:L.translatePosMatrix(o.posMatrix,v,A.paint.get("circle-translate"),A.paint.get("circle-translate-anchor")),u_pitch_with_map:+P,u_device_pixel_ratio:L.pixelRatio,u_extrude_scale:q}},_o=(L,o,v)=>({u_matrix:L,u_inv_matrix:o,u_camera_to_center_distance:v.cameraToCenterDistance,u_viewport_size:[v.width,v.height]}),Zl=(L,o,v=1)=>({u_matrix:L,u_color:o,u_overlay:0,u_overlay_scale:v}),ko=L=>({u_matrix:L}),Ao=(L,o,v,A)=>({u_matrix:L,u_extrude_scale:Re(o,1,v),u_intensity:A}),lu=(L,o,v,A)=>{const M=n.H();n.aP(M,0,L.width,L.height,0,0,1);const P=L.context.gl;return{u_matrix:M,u_world:[P.drawingBufferWidth,P.drawingBufferHeight],u_image:v,u_color_ramp:A,u_opacity:o.paint.get("heatmap-opacity")}};function Iu(L,o){const v=Math.pow(2,o.canonical.z),A=o.canonical.y;return[new n.Z(0,A/v).toLngLat().lat,new n.Z(0,(A+1)/v).toLngLat().lat]}const Mh=(L,o,v,A)=>{const M=L.transform;return{u_matrix:cu(L,o,v,A),u_ratio:1/Re(o,1,M.zoom),u_device_pixel_ratio:L.pixelRatio,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]]}},Jf=(L,o,v,A,M)=>n.e(Mh(L,o,v,M),{u_image:0,u_image_height:A}),Cc=(L,o,v,A,M)=>{const P=L.transform,q=Sd(o,P);return{u_matrix:cu(L,o,v,M),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Re(o,1,P.zoom),u_device_pixel_ratio:L.pixelRatio,u_image:0,u_scale:[q,A.fromScale,A.toScale],u_fade:A.t,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]]}},Ho=(L,o,v,A,M,P)=>{const q=L.lineAtlas,J=Sd(o,L.transform),ne=v.layout.get("line-cap")==="round",fe=q.getDash(A.from,ne),we=q.getDash(A.to,ne),Te=fe.width*M.fromScale,Be=we.width*M.toScale;return n.e(Mh(L,o,v,P),{u_patternscale_a:[J/Te,-fe.height/2],u_patternscale_b:[J/Be,-we.height/2],u_sdfgamma:q.width/(256*Math.min(Te,Be)*L.pixelRatio)/2,u_image:0,u_tex_y_a:fe.y,u_tex_y_b:we.y,u_mix:M.t})};function Sd(L,o){return 1/Re(L,1,o.tileZoom)}function cu(L,o,v,A){return L.translatePosMatrix(A?A.posMatrix:o.tileID.posMatrix,o,v.paint.get("line-translate"),v.paint.get("line-translate-anchor"))}const Wl=(L,o,v,A,M)=>{return{u_matrix:L,u_tl_parent:o,u_scale_parent:v,u_buffer_scale:1,u_fade_t:A.mix,u_opacity:A.opacity*M.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:M.paint.get("raster-brightness-min"),u_brightness_high:M.paint.get("raster-brightness-max"),u_saturation_factor:(q=M.paint.get("raster-saturation"),q>0?1-1/(1.001-q):-q),u_contrast_factor:(P=M.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:Ap(M.paint.get("raster-hue-rotate"))};var P,q};function Ap(L){L*=Math.PI/180;const o=Math.sin(L),v=Math.cos(L);return[(2*v+1)/3,(-Math.sqrt(3)*o-v+1)/3,(Math.sqrt(3)*o-v+1)/3]}const Hd=(L,o,v,A,M,P,q,J,ne,fe,we,Te,Be,Ke)=>{const ot=q.transform;return{u_is_size_zoom_constant:+(L==="constant"||L==="source"),u_is_size_feature_constant:+(L==="constant"||L==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ot.cameraToCenterDistance,u_pitch:ot.pitch/360*2*Math.PI,u_rotate_symbol:+v,u_aspect_ratio:ot.width/ot.height,u_fade_change:q.options.fadeDuration?q.symbolFadeChange:1,u_matrix:J,u_label_plane_matrix:ne,u_coord_matrix:fe,u_is_text:+Te,u_pitch_with_map:+A,u_is_along_line:M,u_is_variable_anchor:P,u_texsize:Be,u_texture:0,u_translation:we,u_pitched_scale:Ke}},nh=(L,o,v,A,M,P,q,J,ne,fe,we,Te,Be,Ke,ot)=>{const wt=q.transform;return n.e(Hd(L,o,v,A,M,P,q,J,ne,fe,we,Te,Be,ot),{u_gamma_scale:A?Math.cos(wt._pitch)*wt.cameraToCenterDistance:1,u_device_pixel_ratio:q.pixelRatio,u_is_halo:1})},Qr=(L,o,v,A,M,P,q,J,ne,fe,we,Te,Be,Ke)=>n.e(nh(L,o,v,A,M,P,q,J,ne,fe,we,!0,Te,!0,Ke),{u_texsize_icon:Be,u_texture_icon:1}),rh=(L,o,v)=>({u_matrix:L,u_opacity:o,u_color:v}),qd=(L,o,v,A,M,P)=>n.e((function(q,J,ne,fe){const we=ne.imageManager.getPattern(q.from.toString()),Te=ne.imageManager.getPattern(q.to.toString()),{width:Be,height:Ke}=ne.imageManager.getPixelSize(),ot=Math.pow(2,fe.tileID.overscaledZ),wt=fe.tileSize*Math.pow(2,ne.transform.tileZoom)/ot,Mt=wt*(fe.tileID.canonical.x+fe.tileID.wrap*ot),Rt=wt*fe.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:we.tl,u_pattern_br_a:we.br,u_pattern_tl_b:Te.tl,u_pattern_br_b:Te.br,u_texsize:[Be,Ke],u_mix:J.t,u_pattern_size_a:we.displaySize,u_pattern_size_b:Te.displaySize,u_scale_a:J.fromScale,u_scale_b:J.toScale,u_tile_units_to_pixels:1/Re(fe,1,ne.transform.tileZoom),u_pixel_coord_upper:[Mt>>16,Rt>>16],u_pixel_coord_lower:[65535&Mt,65535&Rt]}})(A,P,v,M),{u_matrix:L,u_opacity:o}),Il={fillExtrusion:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_lightpos:new n.aN(L,o.u_lightpos),u_lightintensity:new n.aI(L,o.u_lightintensity),u_lightcolor:new n.aN(L,o.u_lightcolor),u_vertical_gradient:new n.aI(L,o.u_vertical_gradient),u_opacity:new n.aI(L,o.u_opacity)}),fillExtrusionPattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_lightpos:new n.aN(L,o.u_lightpos),u_lightintensity:new n.aI(L,o.u_lightintensity),u_lightcolor:new n.aN(L,o.u_lightcolor),u_vertical_gradient:new n.aI(L,o.u_vertical_gradient),u_height_factor:new n.aI(L,o.u_height_factor),u_image:new n.aH(L,o.u_image),u_texsize:new n.aO(L,o.u_texsize),u_pixel_coord_upper:new n.aO(L,o.u_pixel_coord_upper),u_pixel_coord_lower:new n.aO(L,o.u_pixel_coord_lower),u_scale:new n.aN(L,o.u_scale),u_fade:new n.aI(L,o.u_fade),u_opacity:new n.aI(L,o.u_opacity)}),fill:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix)}),fillPattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_image:new n.aH(L,o.u_image),u_texsize:new n.aO(L,o.u_texsize),u_pixel_coord_upper:new n.aO(L,o.u_pixel_coord_upper),u_pixel_coord_lower:new n.aO(L,o.u_pixel_coord_lower),u_scale:new n.aN(L,o.u_scale),u_fade:new n.aI(L,o.u_fade)}),fillOutline:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_world:new n.aO(L,o.u_world)}),fillOutlinePattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_world:new n.aO(L,o.u_world),u_image:new n.aH(L,o.u_image),u_texsize:new n.aO(L,o.u_texsize),u_pixel_coord_upper:new n.aO(L,o.u_pixel_coord_upper),u_pixel_coord_lower:new n.aO(L,o.u_pixel_coord_lower),u_scale:new n.aN(L,o.u_scale),u_fade:new n.aI(L,o.u_fade)}),circle:(L,o)=>({u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_scale_with_map:new n.aH(L,o.u_scale_with_map),u_pitch_with_map:new n.aH(L,o.u_pitch_with_map),u_extrude_scale:new n.aO(L,o.u_extrude_scale),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_matrix:new n.aJ(L,o.u_matrix)}),collisionBox:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_pixel_extrude_scale:new n.aO(L,o.u_pixel_extrude_scale)}),collisionCircle:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_inv_matrix:new n.aJ(L,o.u_inv_matrix),u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_viewport_size:new n.aO(L,o.u_viewport_size)}),debug:(L,o)=>({u_color:new n.aL(L,o.u_color),u_matrix:new n.aJ(L,o.u_matrix),u_overlay:new n.aH(L,o.u_overlay),u_overlay_scale:new n.aI(L,o.u_overlay_scale)}),clippingMask:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix)}),heatmap:(L,o)=>({u_extrude_scale:new n.aI(L,o.u_extrude_scale),u_intensity:new n.aI(L,o.u_intensity),u_matrix:new n.aJ(L,o.u_matrix)}),heatmapTexture:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_world:new n.aO(L,o.u_world),u_image:new n.aH(L,o.u_image),u_color_ramp:new n.aH(L,o.u_color_ramp),u_opacity:new n.aI(L,o.u_opacity)}),hillshade:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_image:new n.aH(L,o.u_image),u_latrange:new n.aO(L,o.u_latrange),u_light:new n.aO(L,o.u_light),u_shadow:new n.aL(L,o.u_shadow),u_highlight:new n.aL(L,o.u_highlight),u_accent:new n.aL(L,o.u_accent)}),hillshadePrepare:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_image:new n.aH(L,o.u_image),u_dimension:new n.aO(L,o.u_dimension),u_zoom:new n.aI(L,o.u_zoom),u_unpack:new n.aK(L,o.u_unpack)}),line:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_ratio:new n.aI(L,o.u_ratio),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_units_to_pixels:new n.aO(L,o.u_units_to_pixels)}),lineGradient:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_ratio:new n.aI(L,o.u_ratio),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_units_to_pixels:new n.aO(L,o.u_units_to_pixels),u_image:new n.aH(L,o.u_image),u_image_height:new n.aI(L,o.u_image_height)}),linePattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_texsize:new n.aO(L,o.u_texsize),u_ratio:new n.aI(L,o.u_ratio),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_image:new n.aH(L,o.u_image),u_units_to_pixels:new n.aO(L,o.u_units_to_pixels),u_scale:new n.aN(L,o.u_scale),u_fade:new n.aI(L,o.u_fade)}),lineSDF:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_ratio:new n.aI(L,o.u_ratio),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_units_to_pixels:new n.aO(L,o.u_units_to_pixels),u_patternscale_a:new n.aO(L,o.u_patternscale_a),u_patternscale_b:new n.aO(L,o.u_patternscale_b),u_sdfgamma:new n.aI(L,o.u_sdfgamma),u_image:new n.aH(L,o.u_image),u_tex_y_a:new n.aI(L,o.u_tex_y_a),u_tex_y_b:new n.aI(L,o.u_tex_y_b),u_mix:new n.aI(L,o.u_mix)}),raster:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_tl_parent:new n.aO(L,o.u_tl_parent),u_scale_parent:new n.aI(L,o.u_scale_parent),u_buffer_scale:new n.aI(L,o.u_buffer_scale),u_fade_t:new n.aI(L,o.u_fade_t),u_opacity:new n.aI(L,o.u_opacity),u_image0:new n.aH(L,o.u_image0),u_image1:new n.aH(L,o.u_image1),u_brightness_low:new n.aI(L,o.u_brightness_low),u_brightness_high:new n.aI(L,o.u_brightness_high),u_saturation_factor:new n.aI(L,o.u_saturation_factor),u_contrast_factor:new n.aI(L,o.u_contrast_factor),u_spin_weights:new n.aN(L,o.u_spin_weights)}),symbolIcon:(L,o)=>({u_is_size_zoom_constant:new n.aH(L,o.u_is_size_zoom_constant),u_is_size_feature_constant:new n.aH(L,o.u_is_size_feature_constant),u_size_t:new n.aI(L,o.u_size_t),u_size:new n.aI(L,o.u_size),u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_pitch:new n.aI(L,o.u_pitch),u_rotate_symbol:new n.aH(L,o.u_rotate_symbol),u_aspect_ratio:new n.aI(L,o.u_aspect_ratio),u_fade_change:new n.aI(L,o.u_fade_change),u_matrix:new n.aJ(L,o.u_matrix),u_label_plane_matrix:new n.aJ(L,o.u_label_plane_matrix),u_coord_matrix:new n.aJ(L,o.u_coord_matrix),u_is_text:new n.aH(L,o.u_is_text),u_pitch_with_map:new n.aH(L,o.u_pitch_with_map),u_is_along_line:new n.aH(L,o.u_is_along_line),u_is_variable_anchor:new n.aH(L,o.u_is_variable_anchor),u_texsize:new n.aO(L,o.u_texsize),u_texture:new n.aH(L,o.u_texture),u_translation:new n.aO(L,o.u_translation),u_pitched_scale:new n.aI(L,o.u_pitched_scale)}),symbolSDF:(L,o)=>({u_is_size_zoom_constant:new n.aH(L,o.u_is_size_zoom_constant),u_is_size_feature_constant:new n.aH(L,o.u_is_size_feature_constant),u_size_t:new n.aI(L,o.u_size_t),u_size:new n.aI(L,o.u_size),u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_pitch:new n.aI(L,o.u_pitch),u_rotate_symbol:new n.aH(L,o.u_rotate_symbol),u_aspect_ratio:new n.aI(L,o.u_aspect_ratio),u_fade_change:new n.aI(L,o.u_fade_change),u_matrix:new n.aJ(L,o.u_matrix),u_label_plane_matrix:new n.aJ(L,o.u_label_plane_matrix),u_coord_matrix:new n.aJ(L,o.u_coord_matrix),u_is_text:new n.aH(L,o.u_is_text),u_pitch_with_map:new n.aH(L,o.u_pitch_with_map),u_is_along_line:new n.aH(L,o.u_is_along_line),u_is_variable_anchor:new n.aH(L,o.u_is_variable_anchor),u_texsize:new n.aO(L,o.u_texsize),u_texture:new n.aH(L,o.u_texture),u_gamma_scale:new n.aI(L,o.u_gamma_scale),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_is_halo:new n.aH(L,o.u_is_halo),u_translation:new n.aO(L,o.u_translation),u_pitched_scale:new n.aI(L,o.u_pitched_scale)}),symbolTextAndIcon:(L,o)=>({u_is_size_zoom_constant:new n.aH(L,o.u_is_size_zoom_constant),u_is_size_feature_constant:new n.aH(L,o.u_is_size_feature_constant),u_size_t:new n.aI(L,o.u_size_t),u_size:new n.aI(L,o.u_size),u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_pitch:new n.aI(L,o.u_pitch),u_rotate_symbol:new n.aH(L,o.u_rotate_symbol),u_aspect_ratio:new n.aI(L,o.u_aspect_ratio),u_fade_change:new n.aI(L,o.u_fade_change),u_matrix:new n.aJ(L,o.u_matrix),u_label_plane_matrix:new n.aJ(L,o.u_label_plane_matrix),u_coord_matrix:new n.aJ(L,o.u_coord_matrix),u_is_text:new n.aH(L,o.u_is_text),u_pitch_with_map:new n.aH(L,o.u_pitch_with_map),u_is_along_line:new n.aH(L,o.u_is_along_line),u_is_variable_anchor:new n.aH(L,o.u_is_variable_anchor),u_texsize:new n.aO(L,o.u_texsize),u_texsize_icon:new n.aO(L,o.u_texsize_icon),u_texture:new n.aH(L,o.u_texture),u_texture_icon:new n.aH(L,o.u_texture_icon),u_gamma_scale:new n.aI(L,o.u_gamma_scale),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_is_halo:new n.aH(L,o.u_is_halo),u_translation:new n.aO(L,o.u_translation),u_pitched_scale:new n.aI(L,o.u_pitched_scale)}),background:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_opacity:new n.aI(L,o.u_opacity),u_color:new n.aL(L,o.u_color)}),backgroundPattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_opacity:new n.aI(L,o.u_opacity),u_image:new n.aH(L,o.u_image),u_pattern_tl_a:new n.aO(L,o.u_pattern_tl_a),u_pattern_br_a:new n.aO(L,o.u_pattern_br_a),u_pattern_tl_b:new n.aO(L,o.u_pattern_tl_b),u_pattern_br_b:new n.aO(L,o.u_pattern_br_b),u_texsize:new n.aO(L,o.u_texsize),u_mix:new n.aI(L,o.u_mix),u_pattern_size_a:new n.aO(L,o.u_pattern_size_a),u_pattern_size_b:new n.aO(L,o.u_pattern_size_b),u_scale_a:new n.aI(L,o.u_scale_a),u_scale_b:new n.aI(L,o.u_scale_b),u_pixel_coord_upper:new n.aO(L,o.u_pixel_coord_upper),u_pixel_coord_lower:new n.aO(L,o.u_pixel_coord_lower),u_tile_units_to_pixels:new n.aI(L,o.u_tile_units_to_pixels)}),terrain:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_texture:new n.aH(L,o.u_texture),u_ele_delta:new n.aI(L,o.u_ele_delta),u_fog_matrix:new n.aJ(L,o.u_fog_matrix),u_fog_color:new n.aL(L,o.u_fog_color),u_fog_ground_blend:new n.aI(L,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new n.aI(L,o.u_fog_ground_blend_opacity),u_horizon_color:new n.aL(L,o.u_horizon_color),u_horizon_fog_blend:new n.aI(L,o.u_horizon_fog_blend)}),terrainDepth:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_ele_delta:new n.aI(L,o.u_ele_delta)}),terrainCoords:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_texture:new n.aH(L,o.u_texture),u_terrain_coords_id:new n.aI(L,o.u_terrain_coords_id),u_ele_delta:new n.aI(L,o.u_ele_delta)}),sky:(L,o)=>({u_sky_color:new n.aL(L,o.u_sky_color),u_horizon_color:new n.aL(L,o.u_horizon_color),u_horizon:new n.aI(L,o.u_horizon),u_sky_horizon_blend:new n.aI(L,o.u_sky_horizon_blend)})};class Cl{constructor(o,v,A){this.context=o;const M=o.gl;this.buffer=M.createBuffer(),this.dynamicDraw=!!A,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const v=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Cu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class zu{constructor(o,v,A,M){this.length=v.length,this.attributes=A,this.itemSize=v.bytesPerElement,this.dynamicDraw=M,this.context=o;const P=o.gl;this.buffer=P.createBuffer(),o.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,v){for(let A=0;A<this.attributes.length;A++){const M=v.attributes[this.attributes[A].name];M!==void 0&&o.enableVertexAttribArray(M)}}setVertexAttribPointers(o,v,A){for(let M=0;M<this.attributes.length;M++){const P=this.attributes[M],q=v.attributes[P.name];q!==void 0&&o.vertexAttribPointer(q,P.components,o[Cu[P.type]],!1,this.itemSize,P.offset+this.itemSize*(A||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ru=new WeakMap;function uu(L){var o;if(Ru.has(L))return Ru.get(L);{const v=(o=L.getParameter(L.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return Ru.set(L,v),v}}class ss{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class zl extends ss{getDefault(){return n.aM.transparent}set(o){const v=this.current;(o.r!==v.r||o.g!==v.g||o.b!==v.b||o.a!==v.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Qh extends ss{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class Ih extends ss{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class ed extends ss{getDefault(){return[!0,!0,!0,!0]}set(o){const v=this.current;(o[0]!==v[0]||o[1]!==v[1]||o[2]!==v[2]||o[3]!==v[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class td extends ss{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Rl extends ss{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Ed extends ss{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const v=this.current;(o.func!==v.func||o.ref!==v.ref||o.mask!==v.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Ad extends ss{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const v=this.current;(o[0]!==v[0]||o[1]!==v[1]||o[2]!==v[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class Gc extends ss{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;o?v.enable(v.STENCIL_TEST):v.disable(v.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ia extends ss{getDefault(){return[0,1]}set(o){const v=this.current;(o[0]!==v[0]||o[1]!==v[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Mp extends ss{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;o?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST),this.current=o,this.dirty=!1}}class Ip extends ss{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Ch extends ss{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;o?v.enable(v.BLEND):v.disable(v.BLEND),this.current=o,this.dirty=!1}}class Hn extends ss{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const v=this.current;(o[0]!==v[0]||o[1]!==v[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Cp extends ss{getDefault(){return n.aM.transparent}set(o){const v=this.current;(o.r!==v.r||o.g!==v.g||o.b!==v.b||o.a!==v.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class $d extends ss{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Xl extends ss{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;o?v.enable(v.CULL_FACE):v.disable(v.CULL_FACE),this.current=o,this.dirty=!1}}class id extends ss{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class zc extends ss{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class En extends ss{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class ra extends ss{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Ca extends ss{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const v=this.current;(o[0]!==v[0]||o[1]!==v[1]||o[2]!==v[2]||o[3]!==v[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Yl extends ss{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;v.bindFramebuffer(v.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Du extends ss{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;v.bindRenderbuffer(v.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Sa extends ss{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;v.bindTexture(v.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Mf extends ss{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;v.bindBuffer(v.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class nd extends ss{getDefault(){return null}set(o){const v=this.gl;v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Hc extends ss{getDefault(){return null}set(o){var v;if(o===this.current&&!this.dirty)return;const A=this.gl;uu(A)?A.bindVertexArray(o):(v=A.getExtension("OES_vertex_array_object"))===null||v===void 0||v.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class rl extends ss{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;v.pixelStorei(v.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class so extends ss{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class zp extends ss{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const v=this.gl;v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class qc extends ss{constructor(o,v){super(o),this.context=o,this.parent=v}getDefault(){return null}}class zh extends qc{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const v=this.gl;v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Pu extends qc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const v=this.gl;v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_ATTACHMENT,v.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Md extends qc{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const v=this.gl;v.framebufferRenderbuffer(v.FRAMEBUFFER,v.DEPTH_STENCIL_ATTACHMENT,v.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Qf{constructor(o,v,A,M,P){this.context=o,this.width=v,this.height=A;const q=o.gl,J=this.framebuffer=q.createFramebuffer();if(this.colorAttachment=new zh(o,J),M)this.depthAttachment=P?new Md(o,J):new Pu(o,J);else if(P)throw new Error("Stencil cannot be set without depth");if(q.checkFramebufferStatus(q.FRAMEBUFFER)!==q.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,v=this.colorAttachment.get();if(v&&o.deleteTexture(v),this.depthAttachment){const A=this.depthAttachment.get();A&&o.deleteRenderbuffer(A)}o.deleteFramebuffer(this.framebuffer)}}class go{constructor(o,v,A){this.blendFunction=o,this.blendColor=v,this.mask=A}}go.Replace=[1,0],go.disabled=new go(go.Replace,n.aM.transparent,[!1,!1,!1,!1]),go.unblended=new go(go.Replace,n.aM.transparent,[!0,!0,!0,!0]),go.alphaBlended=new go([1,771],n.aM.transparent,[!0,!0,!0,!0]);class Dl{constructor(o){var v,A;if(this.gl=o,this.clearColor=new zl(this),this.clearDepth=new Qh(this),this.clearStencil=new Ih(this),this.colorMask=new ed(this),this.depthMask=new td(this),this.stencilMask=new Rl(this),this.stencilFunc=new Ed(this),this.stencilOp=new Ad(this),this.stencilTest=new Gc(this),this.depthRange=new Ia(this),this.depthTest=new Mp(this),this.depthFunc=new Ip(this),this.blend=new Ch(this),this.blendFunc=new Hn(this),this.blendColor=new Cp(this),this.blendEquation=new $d(this),this.cullFace=new Xl(this),this.cullFaceSide=new id(this),this.frontFace=new zc(this),this.program=new En(this),this.activeTexture=new ra(this),this.viewport=new Ca(this),this.bindFramebuffer=new Yl(this),this.bindRenderbuffer=new Du(this),this.bindTexture=new Sa(this),this.bindVertexBuffer=new Mf(this),this.bindElementBuffer=new nd(this),this.bindVertexArray=new Hc(this),this.pixelStoreUnpack=new rl(this),this.pixelStoreUnpackPremultiplyAlpha=new so(this),this.pixelStoreUnpackFlipY=new zp(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),uu(o)){this.HALF_FLOAT=o.HALF_FLOAT;const M=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(v=o.RGBA16F)!==null&&v!==void 0?v:M?.RGBA16F_EXT,this.RGB16F=(A=o.RGB16F)!==null&&A!==void 0?A:M?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const M=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=M?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,v){return new Cl(this,o,v)}createVertexBuffer(o,v,A){return new zu(this,o,v,A)}createRenderbuffer(o,v,A){const M=this.gl,P=M.createRenderbuffer();return this.bindRenderbuffer.set(P),M.renderbufferStorage(M.RENDERBUFFER,o,v,A),this.bindRenderbuffer.set(null),P}createFramebuffer(o,v,A,M){return new Qf(this,o,v,A,M)}clear({color:o,depth:v,stencil:A}){const M=this.gl;let P=0;o&&(P|=M.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),v!==void 0&&(P|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(v),this.depthMask.set(!0)),A!==void 0&&(P|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(A),this.stencilMask.set(255)),M.clear(P)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){n.aE(o.blendFunction,go.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return uu(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var v;return uu(this.gl)?this.gl.deleteVertexArray(o):(v=this.gl.getExtension("OES_vertex_array_object"))===null||v===void 0?void 0:v.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class xa{constructor(o,v,A){this.func=o,this.mask=v,this.range=A}}xa.ReadOnly=!1,xa.ReadWrite=!0,xa.disabled=new xa(519,xa.ReadOnly,[0,1]);const Co=7680;class Ls{constructor(o,v,A,M,P,q){this.test=o,this.ref=v,this.mask=A,this.fail=M,this.depthFail=P,this.pass=q}}Ls.disabled=new Ls({func:519,mask:0},0,0,Co,Co,Co);class Ts{constructor(o,v,A){this.enable=o,this.mode=v,this.frontFace=A}}let oo;function Pl(L,o,v,A,M){const P=L.context,q=P.gl,J=L.useProgram("collisionBox"),ne=[];let fe=0,we=0;for(let Rt=0;Rt<A.length;Rt++){const Ft=A[Rt],yt=o.getTile(Ft).getBucket(v);if(!yt)continue;const Ht=M?yt.textCollisionBox:yt.iconCollisionBox,Jt=yt.collisionCircleArray;if(Jt.length>0){const oi=n.H();n.aQ(oi,yt.placementInvProjMatrix,L.transform.glCoordMatrix),n.aQ(oi,oi,yt.placementViewportMatrix),ne.push({circleArray:Jt,circleOffset:we,transform:Ft.posMatrix,invTransform:oi,coord:Ft}),fe+=Jt.length/4,we=fe}Ht&&J.draw(P,q.LINES,xa.disabled,Ls.disabled,L.colorModeForRenderPass(),Ts.disabled,{u_matrix:Ft.posMatrix,u_pixel_extrude_scale:[1/(Te=L.transform).width,1/Te.height]},L.style.map.terrain&&L.style.map.terrain.getTerrainData(Ft),v.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Ht.segments,null,L.transform.zoom,null,null,Ht.collisionVertexBuffer)}var Te;if(!M||!ne.length)return;const Be=L.useProgram("collisionCircle"),Ke=new n.aR;Ke.resize(4*fe),Ke._trim();let ot=0;for(const Rt of ne)for(let Ft=0;Ft<Rt.circleArray.length/4;Ft++){const yt=4*Ft,Ht=Rt.circleArray[yt+0],Jt=Rt.circleArray[yt+1],oi=Rt.circleArray[yt+2],Xi=Rt.circleArray[yt+3];Ke.emplace(ot++,Ht,Jt,oi,Xi,0),Ke.emplace(ot++,Ht,Jt,oi,Xi,1),Ke.emplace(ot++,Ht,Jt,oi,Xi,2),Ke.emplace(ot++,Ht,Jt,oi,Xi,3)}(!oo||oo.length<2*fe)&&(oo=(function(Rt){const Ft=2*Rt,yt=new n.aT;yt.resize(Ft),yt._trim();for(let Ht=0;Ht<Ft;Ht++){const Jt=6*Ht;yt.uint16[Jt+0]=4*Ht+0,yt.uint16[Jt+1]=4*Ht+1,yt.uint16[Jt+2]=4*Ht+2,yt.uint16[Jt+3]=4*Ht+2,yt.uint16[Jt+4]=4*Ht+3,yt.uint16[Jt+5]=4*Ht+0}return yt})(fe));const wt=P.createIndexBuffer(oo,!0),Mt=P.createVertexBuffer(Ke,n.aS.members,!0);for(const Rt of ne){const Ft=_o(Rt.transform,Rt.invTransform,L.transform);Be.draw(P,q.TRIANGLES,xa.disabled,Ls.disabled,L.colorModeForRenderPass(),Ts.disabled,Ft,L.style.map.terrain&&L.style.map.terrain.getTerrainData(Rt.coord),v.id,Mt,wt,n.a0.simpleSegment(0,2*Rt.circleOffset,Rt.circleArray.length,Rt.circleArray.length/2),null,L.transform.zoom,null,null,null)}Mt.destroy(),wt.destroy()}Ts.disabled=new Ts(!1,1029,2305),Ts.backCCW=new Ts(!0,1029,2305);const Rc=n.an(new Float32Array(16));function io(L,o,v,A,M,P){const{horizontalAlign:q,verticalAlign:J}=n.au(L);return new n.P((-(q-.5)*o/M+A[0])*P,(-(J-.5)*v/M+A[1])*P)}function $c(L,o,v,A,M,P){const q=o.tileAnchorPoint.add(new n.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let J=A.mult(P);v||(J=J.rotate(-M));const ne=q.add(J);return ft(ne.x,ne.y,o.labelPlaneMatrix,o.getElevation).point}if(v){const J=Pi(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(L),ne=Math.atan(J.y/J.x)+(J.x<0?Math.PI:0);return L.add(A.rotate(ne))}return L.add(A)}function Kl(L,o,v,A,M,P,q,J,ne,fe,we,Te,Be,Ke){const ot=L.text.placedSymbolArray,wt=L.text.dynamicLayoutVertexArray,Mt=L.icon.dynamicLayoutVertexArray,Rt={};wt.clear();for(let Ft=0;Ft<ot.length;Ft++){const yt=ot.get(Ft),Ht=yt.hidden||!yt.crossTileID||L.allowVerticalPlacement&&!yt.placedOrientation?null:A[yt.crossTileID];if(Ht){const Jt=new n.P(yt.anchorX,yt.anchorY),oi={getElevation:Ke,width:M.width,height:M.height,labelPlaneMatrix:P,pitchWithMap:v,projection:we,tileAnchorPoint:Jt,translation:Te,unwrappedTileID:Be},Xi=v?ft(Jt.x,Jt.y,q,Ke):Pi(Jt.x,Jt.y,oi),An=ze(M.cameraToCenterDistance,Xi.signedDistanceFromCamera);let Cn=n.ai(L.textSizeData,ne,yt)*An/n.ap;v&&(Cn*=L.tilePixelRatio/J);const{width:Zn,height:Ln,anchor:Rn,textOffset:ir,textBoxScale:Xr}=Ht,Fn=io(Rn,Zn,Ln,ir,Xr,Cn),qn=we.getPitchedTextCorrection(M,Jt.add(new n.P(Te[0],Te[1])),Be),ea=$c(Xi.point,oi,o,Fn,M.angle,qn),is=L.allowVerticalPlacement&&yt.placedOrientation===n.ah.vertical?Math.PI/2:0;for(let Da=0;Da<yt.numGlyphs;Da++)n.aj(wt,ea,is);fe&&yt.associatedIconIndex>=0&&(Rt[yt.associatedIconIndex]={shiftedAnchor:ea,angle:is})}else Cr(yt.numGlyphs,wt)}if(fe){Mt.clear();const Ft=L.icon.placedSymbolArray;for(let yt=0;yt<Ft.length;yt++){const Ht=Ft.get(yt);if(Ht.hidden)Cr(Ht.numGlyphs,Mt);else{const Jt=Rt[yt];if(Jt)for(let oi=0;oi<Ht.numGlyphs;oi++)n.aj(Mt,Jt.shiftedAnchor,Jt.angle);else Cr(Ht.numGlyphs,Mt)}}L.icon.dynamicLayoutVertexBuffer.updateData(Mt)}L.text.dynamicLayoutVertexBuffer.updateData(wt)}function zo(L,o,v){return v.iconsInText&&o?"symbolTextAndIcon":L?"symbolSDF":"symbolIcon"}function hr(L,o,v,A,M,P,q,J,ne,fe,we,Te){const Be=L.context,Ke=Be.gl,ot=L.transform,wt=Zs(),Mt=J==="map",Rt=ne==="map",Ft=J!=="viewport"&&v.layout.get("symbol-placement")!=="point",yt=Mt&&!Rt&&!Ft,Ht=!Rt&&Ft,Jt=!v.layout.get("symbol-sort-key").isConstant();let oi=!1;const Xi=L.depthModeForSublayer(0,xa.ReadOnly),An=v._unevaluatedLayout.hasValue("text-variable-anchor")||v._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Cn=[],Zn=wt.getCircleRadiusCorrection(ot);for(const Ln of A){const Rn=o.getTile(Ln),ir=Rn.getBucket(v);if(!ir)continue;const Xr=M?ir.text:ir.icon;if(!Xr||!Xr.segments.get().length||!Xr.hasVisibleVertices)continue;const Fn=Xr.programConfigurations.get(v.id),qn=M||ir.sdfIcons,ea=M?ir.textSizeData:ir.iconSizeData,is=Rt||ot.pitch!==0,Da=L.useProgram(zo(qn,M,ir),Fn),Ya=n.ag(ea,ot.zoom),Vs=L.style.map.terrain&&L.style.map.terrain.getTerrainData(Ln);let sl,pc,Us,Fo,Gs=[0,0],ks=null;if(M)pc=Rn.glyphAtlasTexture,Us=Ke.LINEAR,sl=Rn.glyphAtlasTexture.size,ir.iconsInText&&(Gs=Rn.imageAtlasTexture.size,ks=Rn.imageAtlasTexture,Fo=is||L.options.rotating||L.options.zooming||ea.kind==="composite"||ea.kind==="camera"?Ke.LINEAR:Ke.NEAREST);else{const ja=v.layout.get("icon-size").constantOr(0)!==1||ir.iconsNeedLinear;pc=Rn.imageAtlasTexture,Us=qn||L.options.rotating||L.options.zooming||ja||is?Ke.LINEAR:Ke.NEAREST,sl=Rn.imageAtlasTexture.size}const Ro=Re(Rn,1,L.transform.zoom),mc=Ht?Ln.posMatrix:Rc,Bl=oc(mc,Rt,Mt,L.transform,Ro),Kc=cl(mc,Rt,Mt,L.transform,Ro),ul=cl(Ln.posMatrix,Rt,Mt,L.transform,Ro),Fs=wt.translatePosition(L.transform,Rn,P,q),xu=An&&ir.hasTextData(),Nl=v.layout.get("icon-text-fit")!=="none"&&xu&&ir.hasIconData();if(Ft){const ja=L.style.map.terrain?(jh,Ys)=>L.style.map.terrain.getElevation(Ln,jh,Ys):null,_c=v.layout.get("text-rotation-alignment")==="map";et(ir,Ln.posMatrix,L,M,Bl,ul,Rt,fe,_c,wt,Ln.toUnwrapped(),ot.width,ot.height,Fs,ja)}const hi=Ln.posMatrix,Na=M&&An||Nl,gs=Ft||Na?Rc:Bl,Ko=Kc,pn=qn&&v.paint.get(M?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let vo;vo=qn?ir.iconsInText?Qr(ea.kind,Ya,yt,Rt,Ft,Na,L,hi,gs,Ko,Fs,sl,Gs,Zn):nh(ea.kind,Ya,yt,Rt,Ft,Na,L,hi,gs,Ko,Fs,M,sl,!0,Zn):Hd(ea.kind,Ya,yt,Rt,Ft,Na,L,hi,gs,Ko,Fs,M,sl,Zn);const xl={program:Da,buffers:Xr,uniformValues:vo,atlasTexture:pc,atlasTextureIcon:ks,atlasInterpolation:Us,atlasInterpolationIcon:Fo,isSDF:qn,hasHalo:pn};if(Jt&&ir.canOverlap){oi=!0;const ja=Xr.segments.get();for(const _c of ja)Cn.push({segments:new n.a0([_c]),sortKey:_c.sortKey,state:xl,terrainData:Vs})}else Cn.push({segments:Xr.segments,sortKey:0,state:xl,terrainData:Vs})}oi&&Cn.sort(((Ln,Rn)=>Ln.sortKey-Rn.sortKey));for(const Ln of Cn){const Rn=Ln.state;if(Be.activeTexture.set(Ke.TEXTURE0),Rn.atlasTexture.bind(Rn.atlasInterpolation,Ke.CLAMP_TO_EDGE),Rn.atlasTextureIcon&&(Be.activeTexture.set(Ke.TEXTURE1),Rn.atlasTextureIcon&&Rn.atlasTextureIcon.bind(Rn.atlasInterpolationIcon,Ke.CLAMP_TO_EDGE)),Rn.isSDF){const ir=Rn.uniformValues;Rn.hasHalo&&(ir.u_is_halo=1,yn(Rn.buffers,Ln.segments,v,L,Rn.program,Xi,we,Te,ir,Ln.terrainData)),ir.u_is_halo=0}yn(Rn.buffers,Ln.segments,v,L,Rn.program,Xi,we,Te,Rn.uniformValues,Ln.terrainData)}}function yn(L,o,v,A,M,P,q,J,ne,fe){const we=A.context;M.draw(we,we.gl.TRIANGLES,P,q,J,Ts.disabled,ne,fe,v.id,L.layoutVertexBuffer,L.indexBuffer,o,v.paint,A.transform.zoom,L.programConfigurations.get(v.id),L.dynamicLayoutVertexBuffer,L.opacityVertexBuffer)}function rd(L,o,v,A){const M=L.context,P=M.gl,q=Ls.disabled,J=new go([P.ONE,P.ONE],n.aM.transparent,[!0,!0,!0,!0]),ne=o.getBucket(v);if(!ne)return;const fe=A.key;let we=v.heatmapFbos.get(fe);we||(we=Lu(M,o.tileSize,o.tileSize),v.heatmapFbos.set(fe,we)),M.bindFramebuffer.set(we.framebuffer),M.viewport.set([0,0,o.tileSize,o.tileSize]),M.clear({color:n.aM.transparent});const Te=ne.programConfigurations.get(v.id),Be=L.useProgram("heatmap",Te),Ke=L.style.map.terrain.getTerrainData(A);Be.draw(M,P.TRIANGLES,xa.disabled,q,J,Ts.disabled,Ao(A.posMatrix,o,L.transform.zoom,v.paint.get("heatmap-intensity")),Ke,v.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,v.paint,L.transform.zoom,Te)}function jn(L,o,v){const A=L.context,M=A.gl;A.setColorMode(L.colorModeForRenderPass());const P=Rh(A,o),q=v.key,J=o.heatmapFbos.get(q);J&&(A.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,J.colorAttachment.get()),A.activeTexture.set(M.TEXTURE1),P.bind(M.LINEAR,M.CLAMP_TO_EDGE),L.useProgram("heatmapTexture").draw(A,M.TRIANGLES,xa.disabled,Ls.disabled,L.colorModeForRenderPass(),Ts.disabled,lu(L,o,0,1),null,o.id,L.rasterBoundsBuffer,L.quadTriangleIndexBuffer,L.rasterBoundsSegments,o.paint,L.transform.zoom),J.destroy(),o.heatmapFbos.delete(q))}function Lu(L,o,v){var A,M;const P=L.gl,q=P.createTexture();P.bindTexture(P.TEXTURE_2D,q),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.LINEAR);const J=(A=L.HALF_FLOAT)!==null&&A!==void 0?A:P.UNSIGNED_BYTE,ne=(M=L.RGBA16F)!==null&&M!==void 0?M:P.RGBA;P.texImage2D(P.TEXTURE_2D,0,ne,o,v,0,P.RGBA,J,null);const fe=L.createFramebuffer(o,v,!1,!1);return fe.colorAttachment.set(q),fe}function Rh(L,o){return o.colorRampTexture||(o.colorRampTexture=new tn(L,o.colorRamp,L.gl.RGBA)),o.colorRampTexture}function Vn(L,o,v,A,M){if(!v||!A||!A.imageAtlas)return;const P=A.imageAtlas.patternPositions;let q=P[v.to.toString()],J=P[v.from.toString()];if(!q&&J&&(q=J),!J&&q&&(J=q),!q||!J){const ne=M.getPaintProperty(o);q=P[ne],J=P[ne]}q&&J&&L.setConstantPatternPositions(q,J)}function Dc(L,o,v,A,M,P,q){const J=L.context.gl,ne="fill-pattern",fe=v.paint.get(ne),we=fe&&fe.constantOr(1),Te=v.getCrossfadeParameters();let Be,Ke,ot,wt,Mt;q?(Ke=we&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Be=J.LINES):(Ke=we?"fillPattern":"fill",Be=J.TRIANGLES);const Rt=fe.constantOr(null);for(const Ft of A){const yt=o.getTile(Ft);if(we&&!yt.patternsLoaded())continue;const Ht=yt.getBucket(v);if(!Ht)continue;const Jt=Ht.programConfigurations.get(v.id),oi=L.useProgram(Ke,Jt),Xi=L.style.map.terrain&&L.style.map.terrain.getTerrainData(Ft);we&&(L.context.activeTexture.set(J.TEXTURE0),yt.imageAtlasTexture.bind(J.LINEAR,J.CLAMP_TO_EDGE),Jt.updatePaintBuffers(Te)),Vn(Jt,ne,Rt,yt,v);const An=Xi?Ft:null,Cn=L.translatePosMatrix(An?An.posMatrix:Ft.posMatrix,yt,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor"));if(q){wt=Ht.indexBuffer2,Mt=Ht.segments2;const Zn=[J.drawingBufferWidth,J.drawingBufferHeight];ot=Ke==="fillOutlinePattern"&&we?ou(Cn,L,Te,yt,Zn):lc(Cn,Zn)}else wt=Ht.indexBuffer,Mt=Ht.segments,ot=we?Uc(Cn,L,Te,yt):Mu(Cn);oi.draw(L.context,Be,M,L.stencilModeForClipping(Ft),P,Ts.disabled,ot,Xi,v.id,Ht.layoutVertexBuffer,wt,Mt,v.paint,L.transform.zoom,Jt)}}function Zd(L,o,v,A,M,P,q){const J=L.context,ne=J.gl,fe="fill-extrusion-pattern",we=v.paint.get(fe),Te=we.constantOr(1),Be=v.getCrossfadeParameters(),Ke=v.paint.get("fill-extrusion-opacity"),ot=we.constantOr(null);for(const wt of A){const Mt=o.getTile(wt),Rt=Mt.getBucket(v);if(!Rt)continue;const Ft=L.style.map.terrain&&L.style.map.terrain.getTerrainData(wt),yt=Rt.programConfigurations.get(v.id),Ht=L.useProgram(Te?"fillExtrusionPattern":"fillExtrusion",yt);Te&&(L.context.activeTexture.set(ne.TEXTURE0),Mt.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),yt.updatePaintBuffers(Be)),Vn(yt,fe,ot,Mt,v);const Jt=L.translatePosMatrix(wt.posMatrix,Mt,v.paint.get("fill-extrusion-translate"),v.paint.get("fill-extrusion-translate-anchor")),oi=v.paint.get("fill-extrusion-vertical-gradient"),Xi=Te?Jh(Jt,L,oi,Ke,wt,Be,Mt):Kh(Jt,L,oi,Ke);Ht.draw(J,J.gl.TRIANGLES,M,P,q,Ts.backCCW,Xi,Ft,v.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,v.paint,L.transform.zoom,yt,L.style.map.terrain&&Rt.centroidVertexBuffer)}}function Dh(L,o,v,A,M,P,q){const J=L.context,ne=J.gl,fe=v.fbo;if(!fe)return;const we=L.useProgram("hillshade"),Te=L.style.map.terrain&&L.style.map.terrain.getTerrainData(o);J.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,fe.colorAttachment.get()),we.draw(J,ne.TRIANGLES,M,P,q,Ts.disabled,((Be,Ke,ot,wt)=>{const Mt=ot.paint.get("hillshade-shadow-color"),Rt=ot.paint.get("hillshade-highlight-color"),Ft=ot.paint.get("hillshade-accent-color");let yt=ot.paint.get("hillshade-illumination-direction")*(Math.PI/180);ot.paint.get("hillshade-illumination-anchor")==="viewport"&&(yt-=Be.transform.angle);const Ht=!Be.options.moving;return{u_matrix:wt?wt.posMatrix:Be.transform.calculatePosMatrix(Ke.tileID.toUnwrapped(),Ht),u_image:0,u_latrange:Iu(0,Ke.tileID),u_light:[ot.paint.get("hillshade-exaggeration"),yt],u_shadow:Mt,u_highlight:Rt,u_accent:Ft}})(L,v,A,Te?o:null),Te,A.id,L.rasterBoundsBuffer,L.quadTriangleIndexBuffer,L.rasterBoundsSegments)}function Zo(L,o,v,A,M,P){const q=L.context,J=q.gl,ne=o.dem;if(ne&&ne.data){const fe=ne.dim,we=ne.stride,Te=ne.getPixels();if(q.activeTexture.set(J.TEXTURE1),q.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||L.getTileTexture(we),o.demTexture){const Ke=o.demTexture;Ke.update(Te,{premultiply:!1}),Ke.bind(J.NEAREST,J.CLAMP_TO_EDGE)}else o.demTexture=new tn(q,Te,J.RGBA,{premultiply:!1}),o.demTexture.bind(J.NEAREST,J.CLAMP_TO_EDGE);q.activeTexture.set(J.TEXTURE0);let Be=o.fbo;if(!Be){const Ke=new tn(q,{width:fe,height:fe,data:null},J.RGBA);Ke.bind(J.LINEAR,J.CLAMP_TO_EDGE),Be=o.fbo=q.createFramebuffer(fe,fe,!0,!1),Be.colorAttachment.set(Ke.texture)}q.bindFramebuffer.set(Be.framebuffer),q.viewport.set([0,0,fe,fe]),L.useProgram("hillshadePrepare").draw(q,J.TRIANGLES,A,M,P,Ts.disabled,((Ke,ot)=>{const wt=ot.stride,Mt=n.H();return n.aP(Mt,0,n.X,-n.X,0,0,1),n.J(Mt,Mt,[0,-n.X,0]),{u_matrix:Mt,u_image:1,u_dimension:[wt,wt],u_zoom:Ke.overscaledZ,u_unpack:ot.getUnpackVector()}})(o.tileID,ne),null,v.id,L.rasterBoundsBuffer,L.quadTriangleIndexBuffer,L.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function If(L,o,v,A,M,P){const q=A.paint.get("raster-fade-duration");if(!P&&q>0){const J=it.now(),ne=(J-L.timeAdded)/q,fe=o?(J-o.timeAdded)/q:-1,we=v.getSource(),Te=M.coveringZoomLevel({tileSize:we.tileSize,roundZoom:we.roundZoom}),Be=!o||Math.abs(o.tileID.overscaledZ-Te)>Math.abs(L.tileID.overscaledZ-Te),Ke=Be&&L.refreshedUponExpiration?1:n.ac(Be?ne:1-fe,0,1);return L.refreshedUponExpiration&&ne>=1&&(L.refreshedUponExpiration=!1),o?{opacity:1,mix:1-Ke}:{opacity:Ke,mix:0}}return{opacity:1,mix:0}}const _s=new n.aM(1,0,0,1),qa=new n.aM(0,1,0,1),cc=new n.aM(0,0,1,1),ep=new n.aM(1,0,1,1),ah=new n.aM(0,1,1,1);function _l(L,o,v,A){tp(L,0,o+v/2,L.transform.width,v,A)}function ad(L,o,v,A){tp(L,o-v/2,0,v,L.transform.height,A)}function tp(L,o,v,A,M,P){const q=L.context,J=q.gl;J.enable(J.SCISSOR_TEST),J.scissor(o*L.pixelRatio,v*L.pixelRatio,A*L.pixelRatio,M*L.pixelRatio),q.clear({color:P}),J.disable(J.SCISSOR_TEST)}function hu(L,o,v){const A=L.context,M=A.gl,P=v.posMatrix,q=L.useProgram("debug"),J=xa.disabled,ne=Ls.disabled,fe=L.colorModeForRenderPass(),we="$debug",Te=L.style.map.terrain&&L.style.map.terrain.getTerrainData(v);A.activeTexture.set(M.TEXTURE0);const Be=o.getTileByID(v.key).latestRawTileData,Ke=Math.floor((Be&&Be.byteLength||0)/1024),ot=o.getTile(v).tileSize,wt=512/Math.min(ot,512)*(v.overscaledZ/L.transform.zoom)*.5;let Mt=v.canonical.toString();v.overscaledZ!==v.canonical.z&&(Mt+=` => ${v.overscaledZ}`),(function(Rt,Ft){Rt.initDebugOverlayCanvas();const yt=Rt.debugOverlayCanvas,Ht=Rt.context.gl,Jt=Rt.debugOverlayCanvas.getContext("2d");Jt.clearRect(0,0,yt.width,yt.height),Jt.shadowColor="white",Jt.shadowBlur=2,Jt.lineWidth=1.5,Jt.strokeStyle="white",Jt.textBaseline="top",Jt.font="bold 36px Open Sans, sans-serif",Jt.fillText(Ft,5,5),Jt.strokeText(Ft,5,5),Rt.debugOverlayTexture.update(yt),Rt.debugOverlayTexture.bind(Ht.LINEAR,Ht.CLAMP_TO_EDGE)})(L,`${Mt} ${Ke}kB`),q.draw(A,M.TRIANGLES,J,ne,go.alphaBlended,Ts.disabled,Zl(P,n.aM.transparent,wt),null,we,L.debugBuffer,L.quadTriangleIndexBuffer,L.debugSegments),q.draw(A,M.LINE_STRIP,J,ne,fe,Ts.disabled,Zl(P,n.aM.red),Te,we,L.debugBuffer,L.tileBorderIndexBuffer,L.debugSegments)}function sd(L,o,v){const A=L.context,M=A.gl,P=L.colorModeForRenderPass(),q=new xa(M.LEQUAL,xa.ReadWrite,L.depthRangeFor3D),J=L.useProgram("terrain"),ne=o.getTerrainMesh();A.bindFramebuffer.set(null),A.viewport.set([0,0,L.width,L.height]);for(const fe of v){const we=L.renderToTexture.getTexture(fe),Te=o.getTerrainData(fe.tileID);A.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,we.texture);const Be=L.transform.calculatePosMatrix(fe.tileID.toUnwrapped()),Ke=o.getMeshFrameDelta(L.transform.zoom),ot=L.transform.calculateFogMatrix(fe.tileID.toUnwrapped()),wt=to(Be,Ke,ot,L.style.sky,L.transform.pitch);J.draw(A,M.TRIANGLES,q,Ls.disabled,P,Ts.backCCW,wt,Te,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments)}}class du{constructor(o,v,A){this.vertexBuffer=o,this.indexBuffer=v,this.segments=A}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Pc{constructor(o,v){this.context=new Dl(o),this.transform=v,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:n.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=sr.maxUnderzooming+sr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Lo}resize(o,v,A){if(this.width=Math.floor(o*A),this.height=Math.floor(v*A),this.pixelRatio=A,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const M of this.style._order)this.style._layers[M].resize()}setup(){const o=this.context,v=new n.aX;v.emplaceBack(0,0),v.emplaceBack(n.X,0),v.emplaceBack(0,n.X),v.emplaceBack(n.X,n.X),this.tileExtentBuffer=o.createVertexBuffer(v,ns.members),this.tileExtentSegments=n.a0.simpleSegment(0,0,4,2);const A=new n.aX;A.emplaceBack(0,0),A.emplaceBack(n.X,0),A.emplaceBack(0,n.X),A.emplaceBack(n.X,n.X),this.debugBuffer=o.createVertexBuffer(A,ns.members),this.debugSegments=n.a0.simpleSegment(0,0,4,5);const M=new n.$;M.emplaceBack(0,0,0,0),M.emplaceBack(n.X,0,n.X,0),M.emplaceBack(0,n.X,0,n.X),M.emplaceBack(n.X,n.X,n.X,n.X),this.rasterBoundsBuffer=o.createVertexBuffer(M,Qs.members),this.rasterBoundsSegments=n.a0.simpleSegment(0,0,4,2);const P=new n.aX;P.emplaceBack(0,0),P.emplaceBack(1,0),P.emplaceBack(0,1),P.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(P,ns.members),this.viewportSegments=n.a0.simpleSegment(0,0,4,2);const q=new n.aZ;q.emplaceBack(0),q.emplaceBack(1),q.emplaceBack(3),q.emplaceBack(2),q.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(q);const J=new n.aY;J.emplaceBack(0,1,2),J.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(J);const ne=this.context.gl;this.stencilClearMode=new Ls({func:ne.ALWAYS,mask:0},0,255,ne.ZERO,ne.ZERO,ne.ZERO)}clearStencil(){const o=this.context,v=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const A=n.H();n.aP(A,0,this.width,this.height,0,0,1),n.K(A,A,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,v.TRIANGLES,xa.disabled,this.stencilClearMode,go.disabled,Ts.disabled,ko(A),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,v){if(this.currentStencilSource===o.source||!o.isTileClipped()||!v||!v.length)return;this.currentStencilSource=o.source;const A=this.context,M=A.gl;this.nextStencilID+v.length>256&&this.clearStencil(),A.setColorMode(go.disabled),A.setDepthMode(xa.disabled);const P=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const q of v){const J=this._tileClippingMaskIDs[q.key]=this.nextStencilID++,ne=this.style.map.terrain&&this.style.map.terrain.getTerrainData(q);P.draw(A,M.TRIANGLES,xa.disabled,new Ls({func:M.ALWAYS,mask:0},J,255,M.KEEP,M.KEEP,M.REPLACE),go.disabled,Ts.disabled,ko(q.posMatrix),ne,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,v=this.context.gl;return new Ls({func:v.NOTEQUAL,mask:255},o,255,v.KEEP,v.KEEP,v.REPLACE)}stencilModeForClipping(o){const v=this.context.gl;return new Ls({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,v.KEEP,v.KEEP,v.REPLACE)}stencilConfigForOverlap(o){const v=this.context.gl,A=o.sort(((q,J)=>J.overscaledZ-q.overscaledZ)),M=A[A.length-1].overscaledZ,P=A[0].overscaledZ-M+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();const q={};for(let J=0;J<P;J++)q[J+M]=new Ls({func:v.GEQUAL,mask:255},J+this.nextStencilID,255,v.KEEP,v.KEEP,v.REPLACE);return this.nextStencilID+=P,[q,A]}return[{[M]:Ls.disabled},A]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new go([o.CONSTANT_COLOR,o.ONE],new n.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?go.unblended:go.alphaBlended}depthModeForSublayer(o,v,A){if(!this.opaquePassEnabledForLayer())return xa.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new xa(A||this.context.gl.LEQUAL,v,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,v){this.style=o,this.options=v,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(it.now()),this.imageManager.beginFrame();const A=this.style._order,M=this.style.sourceCaches,P={},q={},J={};for(const ne in M){const fe=M[ne];fe.used&&fe.prepare(this.context),P[ne]=fe.getVisibleCoordinates(),q[ne]=P[ne].slice().reverse(),J[ne]=fe.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ne=0;ne<A.length;ne++)if(this.style._layers[A[ne]].is3D()){this.opaquePassCutoff=ne;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const ne of A){const fe=this.style._layers[ne];if(!fe.hasOffscreenPass()||fe.isHidden(this.transform.zoom))continue;const we=q[fe.source];(fe.type==="custom"||we.length)&&this.renderLayer(this,M[fe.source],fe,we)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?n.aM.black:n.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(ne,fe){const we=ne.context,Te=we.gl,Be=((Rt,Ft,yt)=>({u_sky_color:Rt.properties.get("sky-color"),u_horizon_color:Rt.properties.get("horizon-color"),u_horizon:(Ft.height/2+Ft.getHorizon())*yt,u_sky_horizon_blend:Rt.properties.get("sky-horizon-blend")*Ft.height/2*yt}))(fe,ne.style.map.transform,ne.pixelRatio),Ke=new xa(Te.LEQUAL,xa.ReadWrite,[0,1]),ot=Ls.disabled,wt=ne.colorModeForRenderPass(),Mt=ne.useProgram("sky");if(!fe.mesh){const Rt=new n.aX;Rt.emplaceBack(-1,-1),Rt.emplaceBack(1,-1),Rt.emplaceBack(1,1),Rt.emplaceBack(-1,1);const Ft=new n.aY;Ft.emplaceBack(0,1,2),Ft.emplaceBack(0,2,3),fe.mesh=new du(we.createVertexBuffer(Rt,ns.members),we.createIndexBuffer(Ft),n.a0.simpleSegment(0,0,Rt.length,Ft.length))}Mt.draw(we,Te.TRIANGLES,Ke,ot,wt,Ts.disabled,Be,void 0,"sky",fe.mesh.vertexBuffer,fe.mesh.indexBuffer,fe.mesh.segments)})(this,this.style.sky),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=A.length-1;this.currentLayer>=0;this.currentLayer--){const ne=this.style._layers[A[this.currentLayer]],fe=M[ne.source],we=P[ne.source];this._renderTileClippingMasks(ne,we),this.renderLayer(this,fe,ne,we)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const ne=this.style._layers[A[this.currentLayer]],fe=M[ne.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ne))continue;const we=(ne.type==="symbol"?J:q)[ne.source];this._renderTileClippingMasks(ne,P[ne.source]),this.renderLayer(this,fe,ne,we)}if(this.options.showTileBoundaries){const ne=(function(fe,we){let Te=null;const Be=Object.values(fe._layers).flatMap((Mt=>Mt.source&&!Mt.isHidden(we)?[fe.sourceCaches[Mt.source]]:[])),Ke=Be.filter((Mt=>Mt.getSource().type==="vector")),ot=Be.filter((Mt=>Mt.getSource().type!=="vector")),wt=Mt=>{(!Te||Te.getSource().maxzoom<Mt.getSource().maxzoom)&&(Te=Mt)};return Ke.forEach((Mt=>wt(Mt))),Te||ot.forEach((Mt=>wt(Mt))),Te})(this.style,this.transform.zoom);ne&&(function(fe,we,Te){for(let Be=0;Be<Te.length;Be++)hu(fe,we,Te[Be])})(this,ne,ne.getVisibleCoordinates())}this.options.showPadding&&(function(ne){const fe=ne.transform.padding;_l(ne,ne.transform.height-(fe.top||0),3,_s),_l(ne,fe.bottom||0,3,qa),ad(ne,fe.left||0,3,cc),ad(ne,ne.transform.width-(fe.right||0),3,ep);const we=ne.transform.centerPoint;(function(Te,Be,Ke,ot){tp(Te,Be-1,Ke-10,2,20,ot),tp(Te,Be-10,Ke-1,20,2,ot)})(ne,we.x,ne.transform.height-we.y,ah)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const v=this.terrainFacilitator.matrix,A=this.transform.modelViewProjectionMatrix;let M=this.terrainFacilitator.dirty;M||(M=o?!n.a_(v,A):!n.a$(v,A)),M||(M=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),M&&(n.b0(v,A),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(P,q){const J=P.context,ne=J.gl,fe=go.unblended,we=new xa(ne.LEQUAL,xa.ReadWrite,[0,1]),Te=q.getTerrainMesh(),Be=q.sourceCache.getRenderableTiles(),Ke=P.useProgram("terrainDepth");J.bindFramebuffer.set(q.getFramebuffer("depth").framebuffer),J.viewport.set([0,0,P.width/devicePixelRatio,P.height/devicePixelRatio]),J.clear({color:n.aM.transparent,depth:1});for(const ot of Be){const wt=q.getTerrainData(ot.tileID),Mt={u_matrix:P.transform.calculatePosMatrix(ot.tileID.toUnwrapped()),u_ele_delta:q.getMeshFrameDelta(P.transform.zoom)};Ke.draw(J,ne.TRIANGLES,we,Ls.disabled,fe,Ts.backCCW,Mt,wt,"terrain",Te.vertexBuffer,Te.indexBuffer,Te.segments)}J.bindFramebuffer.set(null),J.viewport.set([0,0,P.width,P.height])})(this,this.style.map.terrain),(function(P,q){const J=P.context,ne=J.gl,fe=go.unblended,we=new xa(ne.LEQUAL,xa.ReadWrite,[0,1]),Te=q.getTerrainMesh(),Be=q.getCoordsTexture(),Ke=q.sourceCache.getRenderableTiles(),ot=P.useProgram("terrainCoords");J.bindFramebuffer.set(q.getFramebuffer("coords").framebuffer),J.viewport.set([0,0,P.width/devicePixelRatio,P.height/devicePixelRatio]),J.clear({color:n.aM.transparent,depth:1}),q.coordsIndex=[];for(const wt of Ke){const Mt=q.getTerrainData(wt.tileID);J.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,Be.texture);const Rt={u_matrix:P.transform.calculatePosMatrix(wt.tileID.toUnwrapped()),u_terrain_coords_id:(255-q.coordsIndex.length)/255,u_texture:0,u_ele_delta:q.getMeshFrameDelta(P.transform.zoom)};ot.draw(J,ne.TRIANGLES,we,Ls.disabled,fe,Ts.backCCW,Rt,Mt,"terrain",Te.vertexBuffer,Te.indexBuffer,Te.segments),q.coordsIndex.push(wt.tileID.key)}J.bindFramebuffer.set(null),J.viewport.set([0,0,P.width,P.height])})(this,this.style.map.terrain))}renderLayer(o,v,A,M){if(!A.isHidden(this.transform.zoom)&&(A.type==="background"||A.type==="custom"||(M||[]).length))switch(this.id=A.id,A.type){case"symbol":(function(P,q,J,ne,fe){if(P.renderPass!=="translucent")return;const we=Ls.disabled,Te=P.colorModeForRenderPass();(J._unevaluatedLayout.hasValue("text-variable-anchor")||J._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Be,Ke,ot,wt,Mt,Rt,Ft,yt,Ht){const Jt=Ke.transform,oi=Zs(),Xi=Mt==="map",An=Rt==="map";for(const Cn of Be){const Zn=wt.getTile(Cn),Ln=Zn.getBucket(ot);if(!Ln||!Ln.text||!Ln.text.segments.get().length)continue;const Rn=n.ag(Ln.textSizeData,Jt.zoom),ir=Re(Zn,1,Ke.transform.zoom),Xr=oc(Cn.posMatrix,An,Xi,Ke.transform,ir),Fn=ot.layout.get("icon-text-fit")!=="none"&&Ln.hasIconData();if(Rn){const qn=Math.pow(2,Jt.zoom-Zn.tileID.overscaledZ),ea=Ke.style.map.terrain?(Da,Ya)=>Ke.style.map.terrain.getElevation(Cn,Da,Ya):null,is=oi.translatePosition(Jt,Zn,Ft,yt);Kl(Ln,Xi,An,Ht,Jt,Xr,Cn.posMatrix,qn,Rn,Fn,oi,is,Cn.toUnwrapped(),ea)}}})(ne,P,J,q,J.layout.get("text-rotation-alignment"),J.layout.get("text-pitch-alignment"),J.paint.get("text-translate"),J.paint.get("text-translate-anchor"),fe),J.paint.get("icon-opacity").constantOr(1)!==0&&hr(P,q,J,ne,!1,J.paint.get("icon-translate"),J.paint.get("icon-translate-anchor"),J.layout.get("icon-rotation-alignment"),J.layout.get("icon-pitch-alignment"),J.layout.get("icon-keep-upright"),we,Te),J.paint.get("text-opacity").constantOr(1)!==0&&hr(P,q,J,ne,!0,J.paint.get("text-translate"),J.paint.get("text-translate-anchor"),J.layout.get("text-rotation-alignment"),J.layout.get("text-pitch-alignment"),J.layout.get("text-keep-upright"),we,Te),q.map.showCollisionBoxes&&(Pl(P,q,J,ne,!0),Pl(P,q,J,ne,!1))})(o,v,A,M,this.style.placement.variableOffsets);break;case"circle":(function(P,q,J,ne){if(P.renderPass!=="translucent")return;const fe=J.paint.get("circle-opacity"),we=J.paint.get("circle-stroke-width"),Te=J.paint.get("circle-stroke-opacity"),Be=!J.layout.get("circle-sort-key").isConstant();if(fe.constantOr(1)===0&&(we.constantOr(1)===0||Te.constantOr(1)===0))return;const Ke=P.context,ot=Ke.gl,wt=P.depthModeForSublayer(0,xa.ReadOnly),Mt=Ls.disabled,Rt=P.colorModeForRenderPass(),Ft=[];for(let yt=0;yt<ne.length;yt++){const Ht=ne[yt],Jt=q.getTile(Ht),oi=Jt.getBucket(J);if(!oi)continue;const Xi=oi.programConfigurations.get(J.id),An=P.useProgram("circle",Xi),Cn=oi.layoutVertexBuffer,Zn=oi.indexBuffer,Ln=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Ht),Rn={programConfiguration:Xi,program:An,layoutVertexBuffer:Cn,indexBuffer:Zn,uniformValues:Ic(P,Ht,Jt,J),terrainData:Ln};if(Be){const ir=oi.segments.get();for(const Xr of ir)Ft.push({segments:new n.a0([Xr]),sortKey:Xr.sortKey,state:Rn})}else Ft.push({segments:oi.segments,sortKey:0,state:Rn})}Be&&Ft.sort(((yt,Ht)=>yt.sortKey-Ht.sortKey));for(const yt of Ft){const{programConfiguration:Ht,program:Jt,layoutVertexBuffer:oi,indexBuffer:Xi,uniformValues:An,terrainData:Cn}=yt.state;Jt.draw(Ke,ot.TRIANGLES,wt,Mt,Rt,Ts.disabled,An,Cn,J.id,oi,Xi,yt.segments,J.paint,P.transform.zoom,Ht)}})(o,v,A,M);break;case"heatmap":(function(P,q,J,ne){if(J.paint.get("heatmap-opacity")===0)return;const fe=P.context;if(P.style.map.terrain){for(const we of ne){const Te=q.getTile(we);q.hasRenderableParent(we)||(P.renderPass==="offscreen"?rd(P,Te,J,we):P.renderPass==="translucent"&&jn(P,J,we))}fe.viewport.set([0,0,P.width,P.height])}else P.renderPass==="offscreen"?(function(we,Te,Be,Ke){const ot=we.context,wt=ot.gl,Mt=Ls.disabled,Rt=new go([wt.ONE,wt.ONE],n.aM.transparent,[!0,!0,!0,!0]);(function(Ft,yt,Ht){const Jt=Ft.gl;Ft.activeTexture.set(Jt.TEXTURE1),Ft.viewport.set([0,0,yt.width/4,yt.height/4]);let oi=Ht.heatmapFbos.get(n.aU);oi?(Jt.bindTexture(Jt.TEXTURE_2D,oi.colorAttachment.get()),Ft.bindFramebuffer.set(oi.framebuffer)):(oi=Lu(Ft,yt.width/4,yt.height/4),Ht.heatmapFbos.set(n.aU,oi))})(ot,we,Be),ot.clear({color:n.aM.transparent});for(let Ft=0;Ft<Ke.length;Ft++){const yt=Ke[Ft];if(Te.hasRenderableParent(yt))continue;const Ht=Te.getTile(yt),Jt=Ht.getBucket(Be);if(!Jt)continue;const oi=Jt.programConfigurations.get(Be.id),Xi=we.useProgram("heatmap",oi),{zoom:An}=we.transform;Xi.draw(ot,wt.TRIANGLES,xa.disabled,Mt,Rt,Ts.disabled,Ao(yt.posMatrix,Ht,An,Be.paint.get("heatmap-intensity")),null,Be.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,Be.paint,we.transform.zoom,oi)}ot.viewport.set([0,0,we.width,we.height])})(P,q,J,ne):P.renderPass==="translucent"&&(function(we,Te){const Be=we.context,Ke=Be.gl;Be.setColorMode(we.colorModeForRenderPass());const ot=Te.heatmapFbos.get(n.aU);ot&&(Be.activeTexture.set(Ke.TEXTURE0),Ke.bindTexture(Ke.TEXTURE_2D,ot.colorAttachment.get()),Be.activeTexture.set(Ke.TEXTURE1),Rh(Be,Te).bind(Ke.LINEAR,Ke.CLAMP_TO_EDGE),we.useProgram("heatmapTexture").draw(Be,Ke.TRIANGLES,xa.disabled,Ls.disabled,we.colorModeForRenderPass(),Ts.disabled,lu(we,Te,0,1),null,Te.id,we.viewportBuffer,we.quadTriangleIndexBuffer,we.viewportSegments,Te.paint,we.transform.zoom))})(P,J)})(o,v,A,M);break;case"line":(function(P,q,J,ne){if(P.renderPass!=="translucent")return;const fe=J.paint.get("line-opacity"),we=J.paint.get("line-width");if(fe.constantOr(1)===0||we.constantOr(1)===0)return;const Te=P.depthModeForSublayer(0,xa.ReadOnly),Be=P.colorModeForRenderPass(),Ke=J.paint.get("line-dasharray"),ot=J.paint.get("line-pattern"),wt=ot.constantOr(1),Mt=J.paint.get("line-gradient"),Rt=J.getCrossfadeParameters(),Ft=wt?"linePattern":Ke?"lineSDF":Mt?"lineGradient":"line",yt=P.context,Ht=yt.gl;let Jt=!0;for(const oi of ne){const Xi=q.getTile(oi);if(wt&&!Xi.patternsLoaded())continue;const An=Xi.getBucket(J);if(!An)continue;const Cn=An.programConfigurations.get(J.id),Zn=P.context.program.get(),Ln=P.useProgram(Ft,Cn),Rn=Jt||Ln.program!==Zn,ir=P.style.map.terrain&&P.style.map.terrain.getTerrainData(oi),Xr=ot.constantOr(null);if(Xr&&Xi.imageAtlas){const ea=Xi.imageAtlas,is=ea.patternPositions[Xr.to.toString()],Da=ea.patternPositions[Xr.from.toString()];is&&Da&&Cn.setConstantPatternPositions(is,Da)}const Fn=ir?oi:null,qn=wt?Cc(P,Xi,J,Rt,Fn):Ke?Ho(P,Xi,J,Ke,Rt,Fn):Mt?Jf(P,Xi,J,An.lineClipsArray.length,Fn):Mh(P,Xi,J,Fn);if(wt)yt.activeTexture.set(Ht.TEXTURE0),Xi.imageAtlasTexture.bind(Ht.LINEAR,Ht.CLAMP_TO_EDGE),Cn.updatePaintBuffers(Rt);else if(Ke&&(Rn||P.lineAtlas.dirty))yt.activeTexture.set(Ht.TEXTURE0),P.lineAtlas.bind(yt);else if(Mt){const ea=An.gradients[J.id];let is=ea.texture;if(J.gradientVersion!==ea.version){let Da=256;if(J.stepInterpolant){const Ya=q.getSource().maxzoom,Vs=oi.canonical.z===Ya?Math.ceil(1<<P.transform.maxZoom-oi.canonical.z):1;Da=n.ac(n.aV(An.maxLineLength/n.X*1024*Vs),256,yt.maxTextureSize)}ea.gradient=n.aW({expression:J.gradientExpression(),evaluationKey:"lineProgress",resolution:Da,image:ea.gradient||void 0,clips:An.lineClipsArray}),ea.texture?ea.texture.update(ea.gradient):ea.texture=new tn(yt,ea.gradient,Ht.RGBA),ea.version=J.gradientVersion,is=ea.texture}yt.activeTexture.set(Ht.TEXTURE0),is.bind(J.stepInterpolant?Ht.NEAREST:Ht.LINEAR,Ht.CLAMP_TO_EDGE)}Ln.draw(yt,Ht.TRIANGLES,Te,P.stencilModeForClipping(oi),Be,Ts.disabled,qn,ir,J.id,An.layoutVertexBuffer,An.indexBuffer,An.segments,J.paint,P.transform.zoom,Cn,An.layoutVertexBuffer2),Jt=!1}})(o,v,A,M);break;case"fill":(function(P,q,J,ne){const fe=J.paint.get("fill-color"),we=J.paint.get("fill-opacity");if(we.constantOr(1)===0)return;const Te=P.colorModeForRenderPass(),Be=J.paint.get("fill-pattern"),Ke=P.opaquePassEnabledForLayer()&&!Be.constantOr(1)&&fe.constantOr(n.aM.transparent).a===1&&we.constantOr(0)===1?"opaque":"translucent";if(P.renderPass===Ke){const ot=P.depthModeForSublayer(1,P.renderPass==="opaque"?xa.ReadWrite:xa.ReadOnly);Dc(P,q,J,ne,ot,Te,!1)}if(P.renderPass==="translucent"&&J.paint.get("fill-antialias")){const ot=P.depthModeForSublayer(J.getPaintProperty("fill-outline-color")?2:0,xa.ReadOnly);Dc(P,q,J,ne,ot,Te,!0)}})(o,v,A,M);break;case"fill-extrusion":(function(P,q,J,ne){const fe=J.paint.get("fill-extrusion-opacity");if(fe!==0&&P.renderPass==="translucent"){const we=new xa(P.context.gl.LEQUAL,xa.ReadWrite,P.depthRangeFor3D);if(fe!==1||J.paint.get("fill-extrusion-pattern").constantOr(1))Zd(P,q,J,ne,we,Ls.disabled,go.disabled),Zd(P,q,J,ne,we,P.stencilModeFor3D(),P.colorModeForRenderPass());else{const Te=P.colorModeForRenderPass();Zd(P,q,J,ne,we,Ls.disabled,Te)}}})(o,v,A,M);break;case"hillshade":(function(P,q,J,ne){if(P.renderPass!=="offscreen"&&P.renderPass!=="translucent")return;const fe=P.context,we=P.depthModeForSublayer(0,xa.ReadOnly),Te=P.colorModeForRenderPass(),[Be,Ke]=P.renderPass==="translucent"?P.stencilConfigForOverlap(ne):[{},ne];for(const ot of Ke){const wt=q.getTile(ot);wt.needsHillshadePrepare!==void 0&&wt.needsHillshadePrepare&&P.renderPass==="offscreen"?Zo(P,wt,J,we,Ls.disabled,Te):P.renderPass==="translucent"&&Dh(P,ot,wt,J,we,Be[ot.overscaledZ],Te)}fe.viewport.set([0,0,P.width,P.height])})(o,v,A,M);break;case"raster":(function(P,q,J,ne){if(P.renderPass!=="translucent"||J.paint.get("raster-opacity")===0||!ne.length)return;const fe=P.context,we=fe.gl,Te=q.getSource(),Be=P.useProgram("raster"),Ke=P.colorModeForRenderPass(),[ot,wt]=Te instanceof Io?[{},ne]:P.stencilConfigForOverlap(ne),Mt=wt[wt.length-1].overscaledZ,Rt=!P.options.moving;for(const Ft of wt){const yt=P.depthModeForSublayer(Ft.overscaledZ-Mt,J.paint.get("raster-opacity")===1?xa.ReadWrite:xa.ReadOnly,we.LESS),Ht=q.getTile(Ft);Ht.registerFadeDuration(J.paint.get("raster-fade-duration"));const Jt=q.findLoadedParent(Ft,0),oi=q.findLoadedSibling(Ft),Xi=If(Ht,Jt||oi||null,q,J,P.transform,P.style.map.terrain);let An,Cn;const Zn=J.paint.get("raster-resampling")==="nearest"?we.NEAREST:we.LINEAR;fe.activeTexture.set(we.TEXTURE0),Ht.texture.bind(Zn,we.CLAMP_TO_EDGE,we.LINEAR_MIPMAP_NEAREST),fe.activeTexture.set(we.TEXTURE1),Jt?(Jt.texture.bind(Zn,we.CLAMP_TO_EDGE,we.LINEAR_MIPMAP_NEAREST),An=Math.pow(2,Jt.tileID.overscaledZ-Ht.tileID.overscaledZ),Cn=[Ht.tileID.canonical.x*An%1,Ht.tileID.canonical.y*An%1]):Ht.texture.bind(Zn,we.CLAMP_TO_EDGE,we.LINEAR_MIPMAP_NEAREST),Ht.texture.useMipmap&&fe.extTextureFilterAnisotropic&&P.transform.pitch>20&&we.texParameterf(we.TEXTURE_2D,fe.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,fe.extTextureFilterAnisotropicMax);const Ln=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Ft),Rn=Ln?Ft:null,ir=Rn?Rn.posMatrix:P.transform.calculatePosMatrix(Ft.toUnwrapped(),Rt),Xr=Wl(ir,Cn||[0,0],An||1,Xi,J);Te instanceof Io?Be.draw(fe,we.TRIANGLES,yt,Ls.disabled,Ke,Ts.disabled,Xr,Ln,J.id,Te.boundsBuffer,P.quadTriangleIndexBuffer,Te.boundsSegments):Be.draw(fe,we.TRIANGLES,yt,ot[Ft.overscaledZ],Ke,Ts.disabled,Xr,Ln,J.id,P.rasterBoundsBuffer,P.quadTriangleIndexBuffer,P.rasterBoundsSegments)}})(o,v,A,M);break;case"background":(function(P,q,J,ne){const fe=J.paint.get("background-color"),we=J.paint.get("background-opacity");if(we===0)return;const Te=P.context,Be=Te.gl,Ke=P.transform,ot=Ke.tileSize,wt=J.paint.get("background-pattern");if(P.isPatternMissing(wt))return;const Mt=!wt&&fe.a===1&&we===1&&P.opaquePassEnabledForLayer()?"opaque":"translucent";if(P.renderPass!==Mt)return;const Rt=Ls.disabled,Ft=P.depthModeForSublayer(0,Mt==="opaque"?xa.ReadWrite:xa.ReadOnly),yt=P.colorModeForRenderPass(),Ht=P.useProgram(wt?"backgroundPattern":"background"),Jt=ne||Ke.coveringTiles({tileSize:ot,terrain:P.style.map.terrain});wt&&(Te.activeTexture.set(Be.TEXTURE0),P.imageManager.bind(P.context));const oi=J.getCrossfadeParameters();for(const Xi of Jt){const An=ne?Xi.posMatrix:P.transform.calculatePosMatrix(Xi.toUnwrapped()),Cn=wt?qd(An,we,P,wt,{tileID:Xi,tileSize:ot},oi):rh(An,we,fe),Zn=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Xi);Ht.draw(Te,Be.TRIANGLES,Ft,Rt,yt,Ts.disabled,Cn,Zn,J.id,P.tileExtentBuffer,P.quadTriangleIndexBuffer,P.tileExtentSegments)}})(o,0,A,M);break;case"custom":(function(P,q,J){const ne=P.context,fe=J.implementation;if(P.renderPass==="offscreen"){const we=fe.prerender;we&&(P.setCustomLayerDefaults(),ne.setColorMode(P.colorModeForRenderPass()),we.call(fe,ne.gl,P.transform.customLayerMatrix()),ne.setDirty(),P.setBaseState())}else if(P.renderPass==="translucent"){P.setCustomLayerDefaults(),ne.setColorMode(P.colorModeForRenderPass()),ne.setStencilMode(Ls.disabled);const we=fe.renderingMode==="3d"?new xa(P.context.gl.LEQUAL,xa.ReadWrite,P.depthRangeFor3D):P.depthModeForSublayer(0,xa.ReadOnly);ne.setDepthMode(we),fe.render(ne.gl,P.transform.customLayerMatrix(),{farZ:P.transform.farZ,nearZ:P.transform.nearZ,fov:P.transform._fov,modelViewProjectionMatrix:P.transform.modelViewProjectionMatrix,projectionMatrix:P.transform.projectionMatrix}),ne.setDirty(),P.setBaseState(),ne.bindFramebuffer.set(null)}})(o,0,A)}}translatePosMatrix(o,v,A,M,P){if(!A[0]&&!A[1])return o;const q=P?M==="map"?this.transform.angle:0:M==="viewport"?-this.transform.angle:0;if(q){const fe=Math.sin(q),we=Math.cos(q);A=[A[0]*we-A[1]*fe,A[0]*fe+A[1]*we]}const J=[P?A[0]:Re(v,A[0],this.transform.zoom),P?A[1]:Re(v,A[1],this.transform.zoom),0],ne=new Float32Array(16);return n.J(ne,o,J),ne}saveTileTexture(o){const v=this._tileTextures[o.size[0]];v?v.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const v=this._tileTextures[o];return v&&v.length>0?v.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const v=this.imageManager.getPattern(o.from.toString()),A=this.imageManager.getPattern(o.to.toString());return!v||!A}useProgram(o,v){this.cache=this.cache||{};const A=o+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[A]||(this.cache[A]=new Ah(this.context,Go[o],v,Il[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new tn(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:v}=this.context.gl;return this.width!==o||this.height!==v}}class Lc{constructor(o,v){this.points=o,this.planes=v}static fromInvProjectionMatrix(o,v,A){const M=Math.pow(2,A),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((J=>{const ne=1/(J=n.af([],J,o))[3]/v*M;return n.b1(J,J,[ne,ne,1/J[3],ne])})),q=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((J=>{const ne=(function(Be,Ke){var ot=Ke[0],wt=Ke[1],Mt=Ke[2],Rt=ot*ot+wt*wt+Mt*Mt;return Rt>0&&(Rt=1/Math.sqrt(Rt)),Be[0]=Ke[0]*Rt,Be[1]=Ke[1]*Rt,Be[2]=Ke[2]*Rt,Be})([],(function(Be,Ke,ot){var wt=Ke[0],Mt=Ke[1],Rt=Ke[2],Ft=ot[0],yt=ot[1],Ht=ot[2];return Be[0]=Mt*Ht-Rt*yt,Be[1]=Rt*Ft-wt*Ht,Be[2]=wt*yt-Mt*Ft,Be})([],mn([],P[J[0]],P[J[1]]),mn([],P[J[2]],P[J[1]]))),fe=-((we=ne)[0]*(Te=P[J[1]])[0]+we[1]*Te[1]+we[2]*Te[2]);var we,Te;return ne.concat(fe)}));return new Lc(P,q)}}class fu{constructor(o,v){this.min=o,this.max=v,this.center=(function(A,M,P){return A[0]=.5*M[0],A[1]=.5*M[1],A[2]=.5*M[2],A})([],(function(A,M,P){return A[0]=M[0]+P[0],A[1]=M[1]+P[1],A[2]=M[2]+P[2],A})([],this.min,this.max))}quadrant(o){const v=[o%2==0,o<2],A=rr(this.min),M=rr(this.max);for(let P=0;P<v.length;P++)A[P]=v[P]?this.min[P]:this.center[P],M[P]=v[P]?this.center[P]:this.max[P];return M[2]=this.max[2],new fu(A,M)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const v=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let A=!0;for(let M=0;M<o.planes.length;M++){const P=o.planes[M];let q=0;for(let J=0;J<v.length;J++)n.b2(P,v[J])>=0&&q++;if(q===0)return 0;q!==v.length&&(A=!1)}if(A)return 2;for(let M=0;M<3;M++){let P=Number.MAX_VALUE,q=-Number.MAX_VALUE;for(let J=0;J<o.points.length;J++){const ne=o.points[J][M]-this.min[M];P=Math.min(P,ne),q=Math.max(q,ne)}if(q<0||P>this.max[M]-this.min[M])return 0}return 1}}class Zc{constructor(o=0,v=0,A=0,M=0){if(isNaN(o)||o<0||isNaN(v)||v<0||isNaN(A)||A<0||isNaN(M)||M<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=v,this.left=A,this.right=M}interpolate(o,v,A){return v.top!=null&&o.top!=null&&(this.top=n.y.number(o.top,v.top,A)),v.bottom!=null&&o.bottom!=null&&(this.bottom=n.y.number(o.bottom,v.bottom,A)),v.left!=null&&o.left!=null&&(this.left=n.y.number(o.left,v.left,A)),v.right!=null&&o.right!=null&&(this.right=n.y.number(o.right,v.right,A)),this}getCenter(o,v){const A=n.ac((this.left+o-this.right)/2,0,o),M=n.ac((this.top+v-this.bottom)/2,0,v);return new n.P(A,M)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Zc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Cf=85.051129;class od{constructor(o,v,A,M,P){this.tileSize=512,this._renderWorldCopies=P===void 0||!!P,this._minZoom=o||0,this._maxZoom=v||22,this._minPitch=A??0,this._maxPitch=M??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new n.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Zc,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new od(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.lngRange=o.lngRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const v=-n.b3(o,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=(function(){var A=new n.A(4);return n.A!=Float32Array&&(A[1]=0,A[2]=0),A[0]=1,A[3]=1,A})(),(function(A,M,P){var q=M[0],J=M[1],ne=M[2],fe=M[3],we=Math.sin(P),Te=Math.cos(P);A[0]=q*Te+ne*we,A[1]=J*Te+fe*we,A[2]=q*-we+ne*Te,A[3]=J*-we+fe*Te})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const v=n.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const v=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.tileZoom=Math.max(0,Math.floor(v)),this.scale=this.zoomScale(v),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,v,A){this._unmodified=!1,this._edgeInsets.interpolate(o,v,A),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const v=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,v)}getVisibleUnwrappedCoordinates(o){const v=[new n.b4(0,o)];if(this._renderWorldCopies){const A=this.pointCoordinate(new n.P(0,0)),M=this.pointCoordinate(new n.P(this.width,0)),P=this.pointCoordinate(new n.P(this.width,this.height)),q=this.pointCoordinate(new n.P(0,this.height)),J=Math.floor(Math.min(A.x,M.x,P.x,q.x)),ne=Math.floor(Math.max(A.x,M.x,P.x,q.x)),fe=1;for(let we=J-fe;we<=ne+fe;we++)we!==0&&v.push(new n.b4(we,o))}return v}coveringTiles(o){var v,A;let M=this.coveringZoomLevel(o);const P=M;if(o.minzoom!==void 0&&M<o.minzoom)return[];o.maxzoom!==void 0&&M>o.maxzoom&&(M=o.maxzoom);const q=this.pointCoordinate(this.getCameraPoint()),J=n.Z.fromLngLat(this.center),ne=Math.pow(2,M),fe=[ne*q.x,ne*q.y,0],we=[ne*J.x,ne*J.y,0],Te=Lc.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,M);let Be=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Be=M);const Ke=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,ot=yt=>({aabb:new fu([yt*ne,0,0],[(yt+1)*ne,ne,0]),zoom:0,x:0,y:0,wrap:yt,fullyVisible:!1}),wt=[],Mt=[],Rt=M,Ft=o.reparseOverscaled?P:M;if(this._renderWorldCopies)for(let yt=1;yt<=3;yt++)wt.push(ot(-yt)),wt.push(ot(yt));for(wt.push(ot(0));wt.length>0;){const yt=wt.pop(),Ht=yt.x,Jt=yt.y;let oi=yt.fullyVisible;if(!oi){const Ln=yt.aabb.intersects(Te);if(Ln===0)continue;oi=Ln===2}const Xi=o.terrain?fe:we,An=yt.aabb.distanceX(Xi),Cn=yt.aabb.distanceY(Xi),Zn=Math.max(Math.abs(An),Math.abs(Cn));if(yt.zoom===Rt||Zn>Ke+(1<<Rt-yt.zoom)-2&&yt.zoom>=Be){const Ln=Rt-yt.zoom,Rn=fe[0]-.5-(Ht<<Ln),ir=fe[1]-.5-(Jt<<Ln);Mt.push({tileID:new n.S(yt.zoom===Rt?Ft:yt.zoom,yt.wrap,yt.zoom,Ht,Jt),distanceSq:Pt([we[0]-.5-Ht,we[1]-.5-Jt]),tileDistanceToCamera:Math.sqrt(Rn*Rn+ir*ir)})}else for(let Ln=0;Ln<4;Ln++){const Rn=(Ht<<1)+Ln%2,ir=(Jt<<1)+(Ln>>1),Xr=yt.zoom+1;let Fn=yt.aabb.quadrant(Ln);if(o.terrain){const qn=new n.S(Xr,yt.wrap,Xr,Rn,ir),ea=o.terrain.getMinMaxElevation(qn),is=(v=ea.minElevation)!==null&&v!==void 0?v:this.elevation,Da=(A=ea.maxElevation)!==null&&A!==void 0?A:this.elevation;Fn=new fu([Fn.min[0],Fn.min[1],is],[Fn.max[0],Fn.max[1],Da])}wt.push({aabb:Fn,zoom:Xr,x:Rn,y:ir,wrap:yt.wrap,fullyVisible:oi})}}return Mt.sort(((yt,Ht)=>yt.distanceSq-Ht.distanceSq)).map((yt=>yt.tileID))}resize(o,v){this.width=o,this.height=v,this.pixelsToGLUnits=[2/o,-2/v],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const v=n.ac(o.lat,-85.051129,Cf);return new n.P(n.O(o.lng)*this.worldSize,n.Q(v)*this.worldSize)}unproject(o){return new n.Z(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const v=this.elevation,A=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,M=this.pointLocation(this.centerPoint,o),P=o.getElevationForLngLatZoom(M,this.tileZoom);if(!(this.elevation-P))return;const q=A+v-P,J=Math.cos(this._pitch)*this.cameraToCenterDistance/q/n.b5(1,M.lat),ne=this.scaleZoom(J/this.tileSize);this._elevation=P,this._center=M,this.zoom=ne}setLocationAtPoint(o,v){const A=this.pointCoordinate(v),M=this.pointCoordinate(this.centerPoint),P=this.locationCoordinate(o),q=new n.Z(P.x-(A.x-M.x),P.y-(A.y-M.y));this.center=this.coordinateLocation(q),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,v){return v?this.coordinatePoint(this.locationCoordinate(o),v.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,v){return this.coordinateLocation(this.pointCoordinate(o,v))}locationCoordinate(o){return n.Z.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,v){if(v){const Be=v.pointCoordinate(o);if(Be!=null)return Be}const A=[o.x,o.y,0,1],M=[o.x,o.y,1,1];n.af(A,A,this.pixelMatrixInverse),n.af(M,M,this.pixelMatrixInverse);const P=A[3],q=M[3],J=A[1]/P,ne=M[1]/q,fe=A[2]/P,we=M[2]/q,Te=fe===we?0:(0-fe)/(we-fe);return new n.Z(n.y.number(A[0]/P,M[0]/q,Te)/this.worldSize,n.y.number(J,ne,Te)/this.worldSize)}coordinatePoint(o,v=0,A=this.pixelMatrix){const M=[o.x*this.worldSize,o.y*this.worldSize,v,1];return n.af(M,M,A),new n.P(M[0]/M[3],M[1]/M[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new $t().extend(this.pointLocation(new n.P(0,o))).extend(this.pointLocation(new n.P(this.width,o))).extend(this.pointLocation(new n.P(this.width,this.height))).extend(this.pointLocation(new n.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new $t([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Cf])}calculateTileMatrix(o){const v=o.canonical,A=this.worldSize/this.zoomScale(v.z),M=v.x+Math.pow(2,v.z)*o.wrap,P=n.an(new Float64Array(16));return n.J(P,P,[M*A,v.y*A,0]),n.K(P,P,[A/n.X,A/n.X,1]),P}calculatePosMatrix(o,v=!1){const A=o.key,M=v?this._alignedPosMatrixCache:this._posMatrixCache;if(M[A])return M[A];const P=this.calculateTileMatrix(o);return n.L(P,v?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,P),M[A]=new Float32Array(P),M[A]}calculateFogMatrix(o){const v=o.key,A=this._fogMatrixCache;if(A[v])return A[v];const M=this.calculateTileMatrix(o);return n.L(M,this.fogMatrix,M),A[v]=new Float32Array(M),A[v]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,v){v=n.ac(+v,this.minZoom,this.maxZoom);const A={center:new n.N(o.lng,o.lat),zoom:v};let M=this.lngRange;if(!this._renderWorldCopies&&M===null){const yt=179.9999999999;M=[-yt,yt]}const P=this.tileSize*this.zoomScale(A.zoom);let q=0,J=P,ne=0,fe=P,we=0,Te=0;const{x:Be,y:Ke}=this.size;if(this.latRange){const yt=this.latRange;q=n.Q(yt[1])*P,J=n.Q(yt[0])*P,J-q<Ke&&(we=Ke/(J-q))}M&&(ne=n.b3(n.O(M[0])*P,0,P),fe=n.b3(n.O(M[1])*P,0,P),fe<ne&&(fe+=P),fe-ne<Be&&(Te=Be/(fe-ne)));const{x:ot,y:wt}=this.project.call({worldSize:P},o);let Mt,Rt;const Ft=Math.max(Te||0,we||0);if(Ft){const yt=new n.P(Te?(fe+ne)/2:ot,we?(J+q)/2:wt);return A.center=this.unproject.call({worldSize:P},yt).wrap(),A.zoom+=this.scaleZoom(Ft),A}if(this.latRange){const yt=Ke/2;wt-yt<q&&(Rt=q+yt),wt+yt>J&&(Rt=J-yt)}if(M){const yt=(ne+fe)/2;let Ht=ot;this._renderWorldCopies&&(Ht=n.b3(ot,yt-P/2,yt+P/2));const Jt=Be/2;Ht-Jt<ne&&(Mt=ne+Jt),Ht+Jt>fe&&(Mt=fe-Jt)}if(Mt!==void 0||Rt!==void 0){const yt=new n.P(Mt??ot,Rt??wt);A.center=this.unproject.call({worldSize:P},yt).wrap()}return A}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:v,zoom:A}=this.getConstrained(this.center,this.zoom);this.center=v,this.zoom=A,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,v=this.point.x,A=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=n.b5(1,this.center.lat)*this.worldSize;let M=n.an(new Float64Array(16));n.K(M,M,[this.width/2,-this.height/2,1]),n.J(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=n.an(new Float64Array(16)),n.K(M,M,[1,-1,1]),n.J(M,M,[-1,-1,0]),n.K(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M;const P=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),q=Math.min(this.elevation,this.minElevationForCurrentTile),J=P-q*this._pixelPerMeter/Math.cos(this._pitch),ne=q<0?J:P,fe=Math.PI/2+this._pitch,we=this._fov*(.5+o.y/this.height),Te=Math.sin(we)*ne/Math.sin(n.ac(Math.PI-fe-we,.01,Math.PI-.01)),Be=this.getHorizon(),Ke=2*Math.atan(Be/this.cameraToCenterDistance)*(.5+o.y/(2*Be)),ot=Math.sin(Ke)*ne/Math.sin(n.ac(Math.PI-fe-Ke,.01,Math.PI-.01)),wt=Math.min(Te,ot);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*wt+ne),this.nearZ=this.height/50,M=new Float64Array(16),n.b6(M,this._fov,this.width/this.height,this.nearZ,this.farZ),M[8]=2*-o.x/this.width,M[9]=2*o.y/this.height,this.projectionMatrix=n.ae(M),n.K(M,M,[1,-1,1]),n.J(M,M,[0,0,-this.cameraToCenterDistance]),n.b7(M,M,this._pitch),n.ad(M,M,this.angle),n.J(M,M,[-v,-A,0]),this.mercatorMatrix=n.K([],M,[this.worldSize,this.worldSize,this.worldSize]),n.K(M,M,[1,1,this._pixelPerMeter]),this.pixelMatrix=n.L(new Float64Array(16),this.labelPlaneMatrix,M),n.J(M,M,[0,0,-this.elevation]),this.modelViewProjectionMatrix=M,this.invModelViewProjectionMatrix=n.as([],M),this.fogMatrix=new Float64Array(16),n.b6(this.fogMatrix,this._fov,this.width/this.height,P,this.farZ),this.fogMatrix[8]=2*-o.x/this.width,this.fogMatrix[9]=2*o.y/this.height,n.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),n.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),n.b7(this.fogMatrix,this.fogMatrix,this._pitch),n.ad(this.fogMatrix,this.fogMatrix,this.angle),n.J(this.fogMatrix,this.fogMatrix,[-v,-A,0]),n.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),n.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=n.L(new Float64Array(16),this.labelPlaneMatrix,M);const Mt=this.width%2/2,Rt=this.height%2/2,Ft=Math.cos(this.angle),yt=Math.sin(this.angle),Ht=v-Math.round(v)+Ft*Mt+yt*Rt,Jt=A-Math.round(A)+Ft*Rt+yt*Mt,oi=new Float64Array(M);if(n.J(oi,oi,[Ht>.5?Ht-1:Ht,Jt>.5?Jt-1:Jt,0]),this.alignedModelViewProjectionMatrix=oi,M=n.as(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");this.pixelMatrixInverse=M,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new n.P(0,0)),v=[o.x*this.worldSize,o.y*this.worldSize,0,1];return n.af(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,o))}getCameraQueryGeometry(o){const v=this.getCameraPoint();if(o.length===1)return[o[0],v];{let A=v.x,M=v.y,P=v.x,q=v.y;for(const J of o)A=Math.min(A,J.x),M=Math.min(M,J.y),P=Math.max(P,J.x),q=Math.max(q,J.y);return[new n.P(A,M),new n.P(P,M),new n.P(P,q),new n.P(A,q),new n.P(A,M)]}}lngLatToCameraDepth(o,v){const A=this.locationCoordinate(o),M=[A.x*this.worldSize,A.y*this.worldSize,v,1];return n.af(M,M,this.modelViewProjectionMatrix),M[2]/M[3]}}function pu(L,o){let v,A=!1,M=null,P=null;const q=()=>{M=null,A&&(L.apply(P,v),M=setTimeout(q,o),A=!1)};return(...J)=>(A=!0,P=this,v=J,M||q(),M)}class Id{constructor(o){this._getCurrentHash=()=>{const v=window.location.hash.replace("#","");if(this._hashName){let A;return v.split("&").map((M=>M.split("="))).forEach((M=>{M[0]===this._hashName&&(A=M)})),(A&&A[1]||"").split("/")}return v.split("/")},this._onHashChange=()=>{const v=this._getCurrentHash();if(v.length>=3&&!v.some((A=>isNaN(A)))){const A=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(v[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+v[2],+v[1]],zoom:+v[0],bearing:A,pitch:+(v[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const v=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,v)},this._removeHash=()=>{const v=this._getCurrentHash();if(v.length===0)return;const A=v.join("/");let M=A;M.split("&").length>0&&(M=M.split("&")[0]),this._hashName&&(M=`${this._hashName}=${A}`);let P=window.location.hash.replace(M,"");P.startsWith("#&")?P=P.slice(0,1)+P.slice(2):P==="#"&&(P="");let q=window.location.href.replace(/(#.+)?$/,P);q=q.replace("&&","&"),window.history.replaceState(window.history.state,null,q)},this._updateHash=pu(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const v=this._map.getCenter(),A=Math.round(100*this._map.getZoom())/100,M=Math.ceil((A*Math.LN2+Math.log(512/360/.5))/Math.LN10),P=Math.pow(10,M),q=Math.round(v.lng*P)/P,J=Math.round(v.lat*P)/P,ne=this._map.getBearing(),fe=this._map.getPitch();let we="";if(we+=o?`/${q}/${J}/${A}`:`${A}/${J}/${q}`,(ne||fe)&&(we+="/"+Math.round(10*ne)/10),fe&&(we+=`/${Math.round(fe)}`),this._hashName){const Te=this._hashName;let Be=!1;const Ke=window.location.hash.slice(1).split("&").map((ot=>{const wt=ot.split("=")[0];return wt===Te?(Be=!0,`${wt}=${we}`):ot})).filter((ot=>ot));return Be||Ke.push(`${Te}=${we}`),`#${Ke.join("&")}`}return`#${we}`}}const mu={linearity:.3,easing:n.b8(0,0,.3,1)},zf=n.e({deceleration:2500,maxSpeed:1400},mu),hm=n.e({deceleration:20,maxSpeed:1400},mu),Rf=n.e({deceleration:1e3,maxSpeed:360},mu),ku=n.e({deceleration:1e3,maxSpeed:90},mu);class ld{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:it.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,v=it.now();for(;o.length>0&&v-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const v={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:P}of this._inertiaBuffer)v.zoom+=P.zoomDelta||0,v.bearing+=P.bearingDelta||0,v.pitch+=P.pitchDelta||0,P.panDelta&&v.pan._add(P.panDelta),P.around&&(v.around=P.around),P.pinchAround&&(v.pinchAround=P.pinchAround);const A=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,M={};if(v.pan.mag()){const P=cd(v.pan.mag(),A,n.e({},zf,o||{}));M.offset=v.pan.mult(P.amount/v.pan.mag()),M.center=this._map.transform.center,Ll(M,P)}if(v.zoom){const P=cd(v.zoom,A,hm);M.zoom=this._map.transform.zoom+P.amount,Ll(M,P)}if(v.bearing){const P=cd(v.bearing,A,Rf);M.bearing=this._map.transform.bearing+n.ac(P.amount,-179,179),Ll(M,P)}if(v.pitch){const P=cd(v.pitch,A,ku);M.pitch=this._map.transform.pitch+P.amount,Ll(M,P)}if(M.zoom||M.bearing){const P=v.pinchAround===void 0?v.around:v.pinchAround;M.around=P?this._map.unproject(P):this._map.getCenter()}return this.clear(),n.e(M,{noMoveStart:!0})}}function Ll(L,o){(!L.duration||L.duration<o.duration)&&(L.duration=o.duration,L.easing=o.easing)}function cd(L,o,v){const{maxSpeed:A,linearity:M,deceleration:P}=v,q=n.ac(L*M/(o/1e3),-A,A),J=Math.abs(q)/(P*M);return{easing:v.easing,duration:1e3*J,amount:q*(J/2)}}class Ws extends n.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,v,A,M={}){const P=ht.mousePos(v.getCanvas(),A),q=v.unproject(P);super(o,n.e({point:P,lngLat:q,originalEvent:A},M)),this._defaultPrevented=!1,this.target=v}}class uc extends n.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,v,A){const M=o==="touchend"?A.changedTouches:A.touches,P=ht.touchPos(v.getCanvasContainer(),M),q=P.map((ne=>v.unproject(ne))),J=P.reduce(((ne,fe,we,Te)=>ne.add(fe.div(Te.length))),new n.P(0,0));super(o,{points:P,point:J,lngLats:q,lngLat:v.unproject(J),originalEvent:A}),this._defaultPrevented=!1}}class hc extends n.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,v,A){super(o,{originalEvent:A}),this._defaultPrevented=!1}}class sh{constructor(o,v){this._map=o,this._clickTolerance=v.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new hc(o.type,this._map,o))}mousedown(o,v){return this._mousedownPos=v,this._firePreventable(new Ws(o.type,this._map,o))}mouseup(o){this._map.fire(new Ws(o.type,this._map,o))}click(o,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new Ws(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Ws(o.type,this._map,o))}mouseover(o){this._map.fire(new Ws(o.type,this._map,o))}mouseout(o){this._map.fire(new Ws(o.type,this._map,o))}touchstart(o){return this._firePreventable(new uc(o.type,this._map,o))}touchmove(o){this._map.fire(new uc(o.type,this._map,o))}touchend(o){this._map.fire(new uc(o.type,this._map,o))}touchcancel(o){this._map.fire(new uc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class us{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Ws(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ws("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Ws(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kl{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(n.P.convert(o),this._map.terrain)}}class pi{constructor(o,v){this._map=o,this._tr=new kl(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=v.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,v){this.isEnabled()&&o.shiftKey&&o.button===0&&(ht.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)}mousemoveWindow(o,v){if(!this._active)return;const A=v;if(this._lastPos.equals(A)||!this._box&&A.dist(this._startPos)<this._clickTolerance)return;const M=this._startPos;this._lastPos=A,this._box||(this._box=ht.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const P=Math.min(M.x,A.x),q=Math.max(M.x,A.x),J=Math.min(M.y,A.y),ne=Math.max(M.y,A.y);ht.setTransform(this._box,`translate(${P}px,${J}px)`),this._box.style.width=q-P+"px",this._box.style.height=ne-J+"px"}mouseupWindow(o,v){if(!this._active||o.button!==0)return;const A=this._startPos,M=v;if(this.reset(),ht.suppressClick(),A.x!==M.x||A.y!==M.y)return this._map.fire(new n.k("boxzoomend",{originalEvent:o})),{cameraAnimation:P=>P.fitScreenCoordinates(A,M,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(ht.remove(this._box),this._box=null),ht.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,v){return this._map.fire(new n.k(o,{originalEvent:v}))}}function Ph(L,o){if(L.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${L.length}, points ${o.length}`);const v={};for(let A=0;A<L.length;A++)v[L[A].identifier]=o[A];return v}class _u{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,v,A){(this.centroid||A.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),A.length===this.numTouches&&(this.centroid=(function(M){const P=new n.P(0,0);for(const q of M)P._add(q);return P.div(M.length)})(v),this.touches=Ph(A,v)))}touchmove(o,v,A){if(this.aborted||!this.centroid)return;const M=Ph(A,v);for(const P in this.touches){const q=M[P];(!q||q.dist(this.touches[P])>30)&&(this.aborted=!0)}}touchend(o,v,A){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),A.length===0){const M=!this.aborted&&this.centroid;if(this.reset(),M)return M}}}class ud{constructor(o){this.singleTap=new _u(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,v,A){this.singleTap.touchstart(o,v,A)}touchmove(o,v,A){this.singleTap.touchmove(o,v,A)}touchend(o,v,A){const M=this.singleTap.touchend(o,v,A);if(M){const P=o.timeStamp-this.lastTime<500,q=!this.lastTap||this.lastTap.dist(M)<30;if(P&&q||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=M,this.count===this.numTaps)return this.reset(),M}}}class Fu{constructor(o){this._tr=new kl(o),this._zoomIn=new ud({numTouches:1,numTaps:2}),this._zoomOut=new ud({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,v,A){this._zoomIn.touchstart(o,v,A),this._zoomOut.touchstart(o,v,A)}touchmove(o,v,A){this._zoomIn.touchmove(o,v,A),this._zoomOut.touchmove(o,v,A)}touchend(o,v,A){const M=this._zoomIn.touchend(o,v,A),P=this._zoomOut.touchend(o,v,A),q=this._tr;return M?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:J=>J.easeTo({duration:300,zoom:q.zoom+1,around:q.unproject(M)},{originalEvent:o})}):P?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:J=>J.easeTo({duration:300,zoom:q.zoom-1,around:q.unproject(P)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gl{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const v=this._moveFunction(...o);if(v.bearingDelta||v.pitchDelta||v.around||v.panDelta)return this._active=!0,v}dragStart(o,v){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=v.length?v[0]:v,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,v){if(!this.isEnabled())return;const A=this._lastPoint;if(!A)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const M=v.length?v[0]:v;return!this._moved&&M.dist(A)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=M,this._move(A,M))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&ht.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const gu={0:1,2:2};class yl{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const v=ht.mouseButton(o);this._eventButton=v}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!(function(v,A){const M=gu[A];return v.buttons===void 0||(v.buttons&M)!==M})(o,this._eventButton)}isValidEndEvent(o){return ht.mouseButton(o)===this._eventButton}}class Ou{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const vl=L=>{L.mousedown=L.dragStart,L.mousemoveWindow=L.dragMove,L.mouseup=L.dragEnd,L.contextmenu=o=>{o.preventDefault()}},Bu=({enable:L,clickTolerance:o,bearingDegreesPerPixelMoved:v=.8})=>{const A=new yl({checkCorrectEvent:M=>ht.mouseButton(M)===0&&M.ctrlKey||ht.mouseButton(M)===2});return new gl({clickTolerance:o,move:(M,P)=>({bearingDelta:(P.x-M.x)*v}),moveStateManager:A,enable:L,assignEvents:vl})},Lh=({enable:L,clickTolerance:o,pitchDegreesPerPixelMoved:v=-.5})=>{const A=new yl({checkCorrectEvent:M=>ht.mouseButton(M)===0&&M.ctrlKey||ht.mouseButton(M)===2});return new gl({clickTolerance:o,move:(M,P)=>({pitchDelta:(P.y-M.y)*v}),moveStateManager:A,enable:L,assignEvents:vl})};class kc{constructor(o,v){this._clickTolerance=o.clickTolerance||1,this._map=v,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,v,A){return this._calculateTransform(o,v,A)}touchmove(o,v,A){if(this._active){if(!this._shouldBePrevented(A.length))return o.preventDefault(),this._calculateTransform(o,v,A);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,v,A){this._calculateTransform(o,v,A),this._active&&this._shouldBePrevented(A.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,v,A){A.length>0&&(this._active=!0);const M=Ph(A,v),P=new n.P(0,0),q=new n.P(0,0);let J=0;for(const fe in M){const we=M[fe],Te=this._touches[fe];Te&&(P._add(we),q._add(we.sub(Te)),J++,M[fe]=we)}if(this._touches=M,this._shouldBePrevented(J)||!q.mag())return;const ne=q.div(J);return this._sum._add(ne),this._sum.mag()<this._clickTolerance?void 0:{around:P.div(J),panDelta:ne}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,v,A){this._firstTwoTouches||A.length<2||(this._firstTwoTouches=[A[0].identifier,A[1].identifier],this._start([v[0],v[1]]))}touchmove(o,v,A){if(!this._firstTwoTouches)return;o.preventDefault();const[M,P]=this._firstTwoTouches,q=Wd(A,v,M),J=Wd(A,v,P);if(!q||!J)return;const ne=this._aroundCenter?null:q.add(J).div(2);return this._move([q,J],ne,o)}touchend(o,v,A){if(!this._firstTwoTouches)return;const[M,P]=this._firstTwoTouches,q=Wd(A,v,M),J=Wd(A,v,P);q&&J||(this._active&&ht.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Wd(L,o,v){for(let A=0;A<L.length;A++)if(L[A].identifier===v)return o[A]}function Xd(L,o){return Math.log(L/o)/Math.LN2}class Yd extends kh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,v){const A=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Xd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Xd(this._distance,A),pinchAround:v}}}function Wo(L,o){return 180*L.angleWith(o)/Math.PI}class Nr extends kh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,v,A){const M=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Wo(this._vector,M),pinchAround:v}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const v=25/(Math.PI*this._minDiameter)*360,A=Wo(o,this._startVector);return Math.abs(A)<v}}function Fh(L){return Math.abs(L.y)>Math.abs(L.x)}class hd extends kh{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,v,A){super.touchstart(o,v,A),this._currentTouchCount=A.length}_start(o){this._lastPoints=o,Fh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,v,A){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const M=o[0].sub(this._lastPoints[0]),P=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(M,P,A.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(M.y+P.y)/2*-.5}):void 0}gestureBeginsVertically(o,v,A){if(this._valid!==void 0)return this._valid;const M=o.mag()>=2,P=v.mag()>=2;if(!M&&!P)return;if(!M||!P)return this._firstMove===void 0&&(this._firstMove=A),A-this._firstMove<100&&void 0;const q=o.y>0==v.y>0;return Fh(o)&&Fh(v)&&q}}const Kd={panStep:100,bearingStep:15,pitchStep:10};class Mo{constructor(o){this._tr=new kl(o);const v=Kd;this._panStep=v.panStep,this._bearingStep=v.bearingStep,this._pitchStep=v.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let v=0,A=0,M=0,P=0,q=0;switch(o.keyCode){case 61:case 107:case 171:case 187:v=1;break;case 189:case 109:case 173:v=-1;break;case 37:o.shiftKey?A=-1:(o.preventDefault(),P=-1);break;case 39:o.shiftKey?A=1:(o.preventDefault(),P=1);break;case 38:o.shiftKey?M=1:(o.preventDefault(),q=-1);break;case 40:o.shiftKey?M=-1:(o.preventDefault(),q=1);break;default:return}return this._rotationDisabled&&(A=0,M=0),{cameraAnimation:J=>{const ne=this._tr;J.easeTo({duration:300,easeId:"keyboardHandler",easing:Xo,zoom:v?Math.round(ne.zoom)+v*(o.shiftKey?2:1):ne.zoom,bearing:ne.bearing+A*this._bearingStep,pitch:ne.pitch+M*this._pitchStep,offset:[-P*this._panStep,-q*this._panStep],center:ne.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xo(L){return L*(2-L)}const ka=4.000244140625;class al{constructor(o,v){this._onTimeout=A=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(A)},this._map=o,this._tr=new kl(o),this._triggerRenderFrame=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let v=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const A=it.now(),M=A-(this._lastWheelEventTime||0);this._lastWheelEventTime=A,v!==0&&v%ka==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":M>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(M*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),o.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=o,this._delta-=v,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const v=ht.mousePos(this._map.getCanvas(),o),A=this._tr;this._around=v.y>A.transform.height/2-A.transform.getHorizon()?n.N.convert(this._aroundCenter?A.center:A.unproject(v)):n.N.convert(A.center),this._aroundPoint=A.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const ne=this._type==="wheel"&&Math.abs(this._delta)>ka?this._wheelZoomRate:this._defaultZoomRate;let fe=2/(1+Math.exp(-Math.abs(this._delta*ne)));this._delta<0&&fe!==0&&(fe=1/fe);const we=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(we*fe))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,A=this._startZoom,M=this._easing;let P,q=!1;const J=it.now()-this._lastWheelEventTime;if(this._type==="wheel"&&A&&M&&J){const ne=Math.min(J/200,1),fe=M(ne);P=n.y.number(A,v,fe),ne<1?this._frameId||(this._frameId=!0):q=!0}else P=v,q=!0;return this._active=!0,q&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!q,zoomDelta:P-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let v=n.b9;if(this._prevEase){const A=this._prevEase,M=(it.now()-A.start)/A.duration,P=A.easing(M+.01)-A.easing(M),q=.27/Math.sqrt(P*P+1e-4)*.01,J=Math.sqrt(.0729-q*q);v=n.b8(q,J,.25,1)}return this._prevEase={start:it.now(),duration:o,easing:v},v}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Fl{constructor(o,v){this._clickZoom=o,this._tapZoom=v}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Nu{constructor(o){this._tr=new kl(o),this.reset()}reset(){this._active=!1}dblclick(o,v){return o.preventDefault(),{cameraAnimation:A=>{A.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(v)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Df{constructor(){this._tap=new ud({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,v,A){if(!this._swipePoint)if(this._tapTime){const M=v[0],P=o.timeStamp-this._tapTime<500,q=this._tapPoint.dist(M)<30;P&&q?A.length>0&&(this._swipePoint=M,this._swipeTouch=A[0].identifier):this.reset()}else this._tap.touchstart(o,v,A)}touchmove(o,v,A){if(this._tapTime){if(this._swipePoint){if(A[0].identifier!==this._swipeTouch)return;const M=v[0],P=M.y-this._swipePoint.y;return this._swipePoint=M,o.preventDefault(),this._active=!0,{zoomDelta:P/128}}}else this._tap.touchmove(o,v,A)}touchend(o,v,A){if(this._tapTime)this._swipePoint&&A.length===0&&this.reset();else{const M=this._tap.touchend(o,v,A);M&&(this._tapTime=o.timeStamp,this._tapPoint=M)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jd{constructor(o,v,A){this._el=o,this._mousePan=v,this._touchPan=A}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class oh{constructor(o,v,A){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=v,this._mousePitch=A}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Oh{constructor(o,v,A,M){this._el=o,this._touchZoom=v,this._touchRotate=A,this._tapDragZoom=M,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class yo{constructor(o,v){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=v,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=ht.create("div","maplibregl-cooperative-gesture-screen",o);let v=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(v=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const A=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),M=document.createElement("div");M.className="maplibregl-desktop-message",M.textContent=v,this._container.appendChild(M);const P=document.createElement("div");P.className="maplibregl-mobile-message",P.textContent=A,this._container.appendChild(P),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(ht.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,v){this._enabled&&(this._map.fire(new n.k("cooperativegestureprevented",{gestureType:o,originalEvent:v})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const $a=L=>L.zoom||L.drag||L.pitch||L.rotate;class dn extends n.k{}function Wc(L){return L.panDelta&&L.panDelta.mag()||L.zoomDelta||L.bearingDelta||L.pitchDelta}class dc{constructor(o,v){this.handleWindowEvent=M=>{this.handleEvent(M,`${M.type}Window`)},this.handleEvent=(M,P)=>{if(M.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const q=M.type==="renderFrame"?void 0:M,J={needsRenderFrame:!1},ne={},fe={},we=M.touches,Te=we?this._getMapTouches(we):void 0,Be=Te?ht.touchPos(this._map.getCanvas(),Te):ht.mousePos(this._map.getCanvas(),M);for(const{handlerName:wt,handler:Mt,allowed:Rt}of this._handlers){if(!Mt.isEnabled())continue;let Ft;this._blockedByActive(fe,Rt,wt)?Mt.reset():Mt[P||M.type]&&(Ft=Mt[P||M.type](M,Be,Te),this.mergeHandlerResult(J,ne,Ft,wt,q),Ft&&Ft.needsRenderFrame&&this._triggerRenderFrame()),(Ft||Mt.isActive())&&(fe[wt]=Mt)}const Ke={};for(const wt in this._previousActiveHandlers)fe[wt]||(Ke[wt]=q);this._previousActiveHandlers=fe,(Object.keys(Ke).length||Wc(J))&&(this._changes.push([J,ne,Ke]),this._triggerRenderFrame()),(Object.keys(fe).length||Wc(J))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ot}=J;ot&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ot(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ld(o),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v);const A=this._el;this._listeners=[[A,"touchstart",{passive:!0}],[A,"touchmove",{passive:!1}],[A,"touchend",void 0],[A,"touchcancel",void 0],[A,"mousedown",void 0],[A,"mousemove",void 0],[A,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[A,"mouseover",void 0],[A,"mouseout",void 0],[A,"dblclick",void 0],[A,"click",void 0],[A,"keydown",{capture:!1}],[A,"keyup",void 0],[A,"wheel",{passive:!1}],[A,"contextmenu",void 0],[window,"blur",void 0]];for(const[M,P,q]of this._listeners)ht.addEventListener(M,P,M===document?this.handleWindowEvent:this.handleEvent,q)}destroy(){for(const[o,v,A]of this._listeners)ht.removeEventListener(o,v,o===document?this.handleWindowEvent:this.handleEvent,A)}_addDefaultHandlers(o){const v=this._map,A=v.getCanvasContainer();this._add("mapEvent",new sh(v,o));const M=v.boxZoom=new pi(v,o);this._add("boxZoom",M),o.interactive&&o.boxZoom&&M.enable();const P=v.cooperativeGestures=new yo(v,o.cooperativeGestures);this._add("cooperativeGestures",P),o.cooperativeGestures&&P.enable();const q=new Fu(v),J=new Nu(v);v.doubleClickZoom=new Fl(J,q),this._add("tapZoom",q),this._add("clickZoom",J),o.interactive&&o.doubleClickZoom&&v.doubleClickZoom.enable();const ne=new Df;this._add("tapDragZoom",ne);const fe=v.touchPitch=new hd(v);this._add("touchPitch",fe),o.interactive&&o.touchPitch&&v.touchPitch.enable(o.touchPitch);const we=Bu(o),Te=Lh(o);v.dragRotate=new oh(o,we,Te),this._add("mouseRotate",we,["mousePitch"]),this._add("mousePitch",Te,["mouseRotate"]),o.interactive&&o.dragRotate&&v.dragRotate.enable();const Be=(({enable:Ft,clickTolerance:yt})=>{const Ht=new yl({checkCorrectEvent:Jt=>ht.mouseButton(Jt)===0&&!Jt.ctrlKey});return new gl({clickTolerance:yt,move:(Jt,oi)=>({around:oi,panDelta:oi.sub(Jt)}),activateOnStart:!0,moveStateManager:Ht,enable:Ft,assignEvents:vl})})(o),Ke=new kc(o,v);v.dragPan=new Jd(A,Be,Ke),this._add("mousePan",Be),this._add("touchPan",Ke,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&v.dragPan.enable(o.dragPan);const ot=new Nr,wt=new Yd;v.touchZoomRotate=new Oh(A,wt,ot,ne),this._add("touchRotate",ot,["touchPan","touchZoom"]),this._add("touchZoom",wt,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&v.touchZoomRotate.enable(o.touchZoomRotate);const Mt=v.scrollZoom=new al(v,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Mt,["mousePan"]),o.interactive&&o.scrollZoom&&v.scrollZoom.enable(o.scrollZoom);const Rt=v.keyboard=new Mo(v);this._add("keyboard",Rt),o.interactive&&o.keyboard&&v.keyboard.enable(),this._add("blockableMapEvent",new us(v))}_add(o,v,A){this._handlers.push({handlerName:o,handler:v,allowed:A}),this._handlersById[o]=v}stop(o){if(!this._updatingCamera){for(const{handler:v}of this._handlers)v.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$a(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,v,A){for(const M in o)if(M!==A&&(!v||v.indexOf(M)<0))return!0;return!1}_getMapTouches(o){const v=[];for(const A of o)this._el.contains(A.target)&&v.push(A);return v}mergeHandlerResult(o,v,A,M,P){if(!A)return;n.e(o,A);const q={handlerName:M,originalEvent:A.originalEvent||P};A.zoomDelta!==void 0&&(v.zoom=q),A.panDelta!==void 0&&(v.drag=q),A.pitchDelta!==void 0&&(v.pitch=q),A.bearingDelta!==void 0&&(v.rotate=q)}_applyChanges(){const o={},v={},A={};for(const[M,P,q]of this._changes)M.panDelta&&(o.panDelta=(o.panDelta||new n.P(0,0))._add(M.panDelta)),M.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+M.zoomDelta),M.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+M.bearingDelta),M.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+M.pitchDelta),M.around!==void 0&&(o.around=M.around),M.pinchAround!==void 0&&(o.pinchAround=M.pinchAround),M.noInertia&&(o.noInertia=M.noInertia),n.e(v,P),n.e(A,q);this._updateMapTransform(o,v,A),this._changes=[]}_updateMapTransform(o,v,A){const M=this._map,P=M._getTransformForUpdate(),q=M.terrain;if(!(Wc(o)||q&&this._terrainMovement))return this._fireEvents(v,A,!0);let{panDelta:J,zoomDelta:ne,bearingDelta:fe,pitchDelta:we,around:Te,pinchAround:Be}=o;Be!==void 0&&(Te=Be),M._stop(!0),Te=Te||M.transform.centerPoint;const Ke=P.pointLocation(J?Te.sub(J):Te);fe&&(P.bearing+=fe),we&&(P.pitch+=we),ne&&(P.zoom+=ne),q?this._terrainMovement||!v.drag&&!v.zoom?v.drag&&this._terrainMovement?P.center=P.pointLocation(P.centerPoint.sub(J)):P.setLocationAtPoint(Ke,Te):(this._terrainMovement=!0,this._map._elevationFreeze=!0,P.setLocationAtPoint(Ke,Te)):P.setLocationAtPoint(Ke,Te),M._applyUpdatedTransform(P),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(v,A,!0)}_fireEvents(o,v,A){const M=$a(this._eventsInProgress),P=$a(o),q={};for(const Te in o){const{originalEvent:Be}=o[Te];this._eventsInProgress[Te]||(q[`${Te}start`]=Be),this._eventsInProgress[Te]=o[Te]}!M&&P&&this._fireEvent("movestart",P.originalEvent);for(const Te in q)this._fireEvent(Te,q[Te]);P&&this._fireEvent("move",P.originalEvent);for(const Te in o){const{originalEvent:Be}=o[Te];this._fireEvent(Te,Be)}const J={};let ne;for(const Te in this._eventsInProgress){const{handlerName:Be,originalEvent:Ke}=this._eventsInProgress[Te];this._handlersById[Be].isActive()||(delete this._eventsInProgress[Te],ne=v[Be]||Ke,J[`${Te}end`]=ne)}for(const Te in J)this._fireEvent(Te,J[Te]);const fe=$a(this._eventsInProgress),we=(M||P)&&!fe;if(we&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Te=this._map._getTransformForUpdate();Te.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(Te)}if(A&&we){this._updatingCamera=!0;const Te=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Be=Ke=>Ke!==0&&-this._bearingSnap<Ke&&Ke<this._bearingSnap;!Te||!Te.essential&&it.prefersReducedMotion?(this._map.fire(new n.k("moveend",{originalEvent:ne})),Be(this._map.getBearing())&&this._map.resetNorth()):(Be(Te.bearing||this._map.getBearing())&&(Te.bearing=0),Te.freezeElevation=!0,this._map.easeTo(Te,{originalEvent:ne})),this._updatingCamera=!1}}_fireEvent(o,v){this._map.fire(new n.k(o,v?{originalEvent:v}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((o=>{delete this._frameId,this.handleEvent(new dn("renderFrame",{timeStamp:o})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Bh extends n.E{constructor(o,v){super(),this._renderFrameCallback=()=>{const A=Math.min((it.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(A)),A<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=v.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new n.N(this.transform.center.lng,this.transform.center.lat)}setCenter(o,v){return this.jumpTo({center:o},v)}panBy(o,v,A){return o=n.P.convert(o).mult(-1),this.panTo(this.transform.center,n.e({offset:o},v),A)}panTo(o,v,A){return this.easeTo(n.e({center:o},v),A)}getZoom(){return this.transform.zoom}setZoom(o,v){return this.jumpTo({zoom:o},v),this}zoomTo(o,v,A){return this.easeTo(n.e({zoom:o},v),A)}zoomIn(o,v){return this.zoomTo(this.getZoom()+1,o,v),this}zoomOut(o,v){return this.zoomTo(this.getZoom()-1,o,v),this}getBearing(){return this.transform.bearing}setBearing(o,v){return this.jumpTo({bearing:o},v),this}getPadding(){return this.transform.padding}setPadding(o,v){return this.jumpTo({padding:o},v),this}rotateTo(o,v,A){return this.easeTo(n.e({bearing:o},v),A)}resetNorth(o,v){return this.rotateTo(0,n.e({duration:1e3},o),v),this}resetNorthPitch(o,v){return this.easeTo(n.e({bearing:0,pitch:0,duration:1e3},o),v),this}snapToNorth(o,v){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,v):this}getPitch(){return this.transform.pitch}setPitch(o,v){return this.jumpTo({pitch:o},v),this}cameraForBounds(o,v){o=$t.convert(o).adjustAntiMeridian();const A=v&&v.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),A,v)}_cameraForBoxAndBearing(o,v,A,M){const P={top:0,bottom:0,right:0,left:0};if(typeof(M=n.e({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},M)).padding=="number"){const Ln=M.padding;M.padding={top:Ln,bottom:Ln,right:Ln,left:Ln}}M.padding=n.e(P,M.padding);const q=this.transform,J=q.padding,ne=new $t(o,v),fe=q.project(ne.getNorthWest()),we=q.project(ne.getNorthEast()),Te=q.project(ne.getSouthEast()),Be=q.project(ne.getSouthWest()),Ke=n.ba(-A),ot=fe.rotate(Ke),wt=we.rotate(Ke),Mt=Te.rotate(Ke),Rt=Be.rotate(Ke),Ft=new n.P(Math.max(ot.x,wt.x,Rt.x,Mt.x),Math.max(ot.y,wt.y,Rt.y,Mt.y)),yt=new n.P(Math.min(ot.x,wt.x,Rt.x,Mt.x),Math.min(ot.y,wt.y,Rt.y,Mt.y)),Ht=Ft.sub(yt),Jt=(q.width-(J.left+J.right+M.padding.left+M.padding.right))/Ht.x,oi=(q.height-(J.top+J.bottom+M.padding.top+M.padding.bottom))/Ht.y;if(oi<0||Jt<0)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Xi=Math.min(q.scaleZoom(q.scale*Math.min(Jt,oi)),M.maxZoom),An=n.P.convert(M.offset),Cn=new n.P((M.padding.left-M.padding.right)/2,(M.padding.top-M.padding.bottom)/2).rotate(n.ba(A)),Zn=An.add(Cn).mult(q.scale/q.zoomScale(Xi));return{center:q.unproject(fe.add(Te).div(2).sub(Zn)),zoom:Xi,bearing:A}}fitBounds(o,v,A){return this._fitInternal(this.cameraForBounds(o,v),v,A)}fitScreenCoordinates(o,v,A,M,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(n.P.convert(o)),this.transform.pointLocation(n.P.convert(v)),A,M),M,P)}_fitInternal(o,v,A){return o?(delete(v=n.e(o,v)).padding,v.linear?this.easeTo(v,A):this.flyTo(v,A)):this}jumpTo(o,v){this.stop();const A=this._getTransformForUpdate();let M=!1,P=!1,q=!1;return"zoom"in o&&A.zoom!==+o.zoom&&(M=!0,A.zoom=+o.zoom),o.center!==void 0&&(A.center=n.N.convert(o.center)),"bearing"in o&&A.bearing!==+o.bearing&&(P=!0,A.bearing=+o.bearing),"pitch"in o&&A.pitch!==+o.pitch&&(q=!0,A.pitch=+o.pitch),o.padding==null||A.isPaddingEqual(o.padding)||(A.padding=o.padding),this._applyUpdatedTransform(A),this.fire(new n.k("movestart",v)).fire(new n.k("move",v)),M&&this.fire(new n.k("zoomstart",v)).fire(new n.k("zoom",v)).fire(new n.k("zoomend",v)),P&&this.fire(new n.k("rotatestart",v)).fire(new n.k("rotate",v)).fire(new n.k("rotateend",v)),q&&this.fire(new n.k("pitchstart",v)).fire(new n.k("pitch",v)).fire(new n.k("pitchend",v)),this.fire(new n.k("moveend",v))}calculateCameraOptionsFromTo(o,v,A,M=0){const P=n.Z.fromLngLat(o,v),q=n.Z.fromLngLat(A,M),J=q.x-P.x,ne=q.y-P.y,fe=q.z-P.z,we=Math.hypot(J,ne,fe);if(we===0)throw new Error("Can't calculate camera options with same From and To");const Te=Math.hypot(J,ne),Be=this.transform.scaleZoom(this.transform.cameraToCenterDistance/we/this.transform.tileSize),Ke=180*Math.atan2(J,-ne)/Math.PI;let ot=180*Math.acos(Te/we)/Math.PI;return ot=fe<0?90-ot:90+ot,{center:q.toLngLat(),zoom:Be,pitch:ot,bearing:Ke}}easeTo(o,v){var A;this._stop(!1,o.easeId),((o=n.e({offset:[0,0],duration:500,easing:n.b9},o)).animate===!1||!o.essential&&it.prefersReducedMotion)&&(o.duration=0);const M=this._getTransformForUpdate(),P=M.zoom,q=M.bearing,J=M.pitch,ne=M.padding,fe="bearing"in o?this._normalizeBearing(o.bearing,q):q,we="pitch"in o?+o.pitch:J,Te="padding"in o?o.padding:M.padding,Be=n.P.convert(o.offset);let Ke=M.centerPoint.add(Be);const ot=M.pointLocation(Ke),{center:wt,zoom:Mt}=M.getConstrained(n.N.convert(o.center||ot),(A=o.zoom)!==null&&A!==void 0?A:P);this._normalizeCenter(wt,M);const Rt=M.project(ot),Ft=M.project(wt).sub(Rt),yt=M.zoomScale(Mt-P);let Ht,Jt;o.around&&(Ht=n.N.convert(o.around),Jt=M.locationPoint(Ht));const oi={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Mt!==P,this._rotating=this._rotating||q!==fe,this._pitching=this._pitching||we!==J,this._padding=!M.isPaddingEqual(Te),this._easeId=o.easeId,this._prepareEase(v,o.noMoveStart,oi),this.terrain&&this._prepareElevation(wt),this._ease((Xi=>{if(this._zooming&&(M.zoom=n.y.number(P,Mt,Xi)),this._rotating&&(M.bearing=n.y.number(q,fe,Xi)),this._pitching&&(M.pitch=n.y.number(J,we,Xi)),this._padding&&(M.interpolatePadding(ne,Te,Xi),Ke=M.centerPoint.add(Be)),this.terrain&&!o.freezeElevation&&this._updateElevation(Xi),Ht)M.setLocationAtPoint(Ht,Jt);else{const An=M.zoomScale(M.zoom-P),Cn=Mt>P?Math.min(2,yt):Math.max(.5,yt),Zn=Math.pow(Cn,1-Xi),Ln=M.unproject(Rt.add(Ft.mult(Xi*Zn)).mult(An));M.setLocationAtPoint(M.renderWorldCopies?Ln.wrap():Ln,Ke)}this._applyUpdatedTransform(M),this._fireMoveEvents(v)}),(Xi=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(v,Xi)}),o),this}_prepareEase(o,v,A={}){this._moving=!0,v||A.moving||this.fire(new n.k("movestart",o)),this._zooming&&!A.zooming&&this.fire(new n.k("zoomstart",o)),this._rotating&&!A.rotating&&this.fire(new n.k("rotatestart",o)),this._pitching&&!A.pitching&&this.fire(new n.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const v=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&v!==this._elevationTarget){const A=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(A-(v-(A*o+this._elevationStart))/(1-o)),this._elevationTarget=v}this.transform.elevation=n.y.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){const v=o.getCameraPosition(),A=this.terrain.getElevationForLngLatZoom(v.lngLat,o.zoom);if(v.altitude<A){const M=this.calculateCameraOptionsFromTo(v.lngLat,A,o.center,o.elevation);return{pitch:M.pitch,zoom:M.zoom}}return{}}_applyUpdatedTransform(o){const v=[];if(this.terrain&&v.push((M=>this._elevateCameraIfInsideTerrain(M))),this.transformCameraUpdate&&v.push((M=>this.transformCameraUpdate(M))),!v.length)return;const A=o.clone();for(const M of v){const P=A.clone(),{center:q,zoom:J,pitch:ne,bearing:fe,elevation:we}=M(P);q&&(P.center=q),J!==void 0&&(P.zoom=J),ne!==void 0&&(P.pitch=ne),fe!==void 0&&(P.bearing=fe),we!==void 0&&(P.elevation=we),A.apply(P)}this.transform.apply(A)}_fireMoveEvents(o){this.fire(new n.k("move",o)),this._zooming&&this.fire(new n.k("zoom",o)),this._rotating&&this.fire(new n.k("rotate",o)),this._pitching&&this.fire(new n.k("pitch",o))}_afterEase(o,v){if(this._easeId&&v&&this._easeId===v)return;delete this._easeId;const A=this._zooming,M=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,A&&this.fire(new n.k("zoomend",o)),M&&this.fire(new n.k("rotateend",o)),P&&this.fire(new n.k("pitchend",o)),this.fire(new n.k("moveend",o))}flyTo(o,v){var A;if(!o.essential&&it.prefersReducedMotion){const qn=n.M(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qn,v)}this.stop(),o=n.e({offset:[0,0],speed:1.2,curve:1.42,easing:n.b9},o);const M=this._getTransformForUpdate(),P=M.zoom,q=M.bearing,J=M.pitch,ne=M.padding,fe="bearing"in o?this._normalizeBearing(o.bearing,q):q,we="pitch"in o?+o.pitch:J,Te="padding"in o?o.padding:M.padding,Be=n.P.convert(o.offset);let Ke=M.centerPoint.add(Be);const ot=M.pointLocation(Ke),{center:wt,zoom:Mt}=M.getConstrained(n.N.convert(o.center||ot),(A=o.zoom)!==null&&A!==void 0?A:P);this._normalizeCenter(wt,M);const Rt=M.zoomScale(Mt-P),Ft=M.project(ot),yt=M.project(wt).sub(Ft);let Ht=o.curve;const Jt=Math.max(M.width,M.height),oi=Jt/Rt,Xi=yt.mag();if("minZoom"in o){const qn=n.ac(Math.min(o.minZoom,P,Mt),M.minZoom,M.maxZoom),ea=Jt/M.zoomScale(qn-P);Ht=Math.sqrt(ea/Xi*2)}const An=Ht*Ht;function Cn(qn){const ea=(oi*oi-Jt*Jt+(qn?-1:1)*An*An*Xi*Xi)/(2*(qn?oi:Jt)*An*Xi);return Math.log(Math.sqrt(ea*ea+1)-ea)}function Zn(qn){return(Math.exp(qn)-Math.exp(-qn))/2}function Ln(qn){return(Math.exp(qn)+Math.exp(-qn))/2}const Rn=Cn(!1);let ir=function(qn){return Ln(Rn)/Ln(Rn+Ht*qn)},Xr=function(qn){return Jt*((Ln(Rn)*(Zn(ea=Rn+Ht*qn)/Ln(ea))-Zn(Rn))/An)/Xi;var ea},Fn=(Cn(!0)-Rn)/Ht;if(Math.abs(Xi)<1e-6||!isFinite(Fn)){if(Math.abs(Jt-oi)<1e-6)return this.easeTo(o,v);const qn=oi<Jt?-1:1;Fn=Math.abs(Math.log(oi/Jt))/Ht,Xr=()=>0,ir=ea=>Math.exp(qn*Ht*ea)}return o.duration="duration"in o?+o.duration:1e3*Fn/("screenSpeed"in o?+o.screenSpeed/Ht:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=q!==fe,this._pitching=we!==J,this._padding=!M.isPaddingEqual(Te),this._prepareEase(v,!1),this.terrain&&this._prepareElevation(wt),this._ease((qn=>{const ea=qn*Fn,is=1/ir(ea);M.zoom=qn===1?Mt:P+M.scaleZoom(is),this._rotating&&(M.bearing=n.y.number(q,fe,qn)),this._pitching&&(M.pitch=n.y.number(J,we,qn)),this._padding&&(M.interpolatePadding(ne,Te,qn),Ke=M.centerPoint.add(Be)),this.terrain&&!o.freezeElevation&&this._updateElevation(qn);const Da=qn===1?wt:M.unproject(Ft.add(yt.mult(Xr(ea))).mult(is));M.setLocationAtPoint(M.renderWorldCopies?Da.wrap():Da,Ke),this._applyUpdatedTransform(M),this._fireMoveEvents(v)}),(()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(v)}),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,v){var A;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const M=this._onEaseEnd;delete this._onEaseEnd,M.call(this,v)}return o||(A=this.handlers)===null||A===void 0||A.stop(!1),this}_ease(o,v,A){A.animate===!1||A.duration===0?(o(1),v()):(this._easeStart=it.now(),this._easeOptions=A,this._onEaseFrame=o,this._onEaseEnd=v,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,v){o=n.b3(o,-180,180);const A=Math.abs(o-v);return Math.abs(o-360-v)<A&&(o-=360),Math.abs(o+360-v)<A&&(o+=360),o}_normalizeCenter(o,v){if(!v.renderWorldCopies||v.lngRange)return;const A=o.lng-v.center.lng;o.lng+=A>180?-360:A<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(n.N.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const Jl={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class lh{constructor(o=Jl){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=v=>{!v||v.sourceDataType!=="metadata"&&v.sourceDataType!=="visibility"&&v.dataType!=="style"&&v.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=ht.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=ht.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=ht.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){ht.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,v){const A=this._map._getUIString(`AttributionControl.${v}`);o.title=A,o.setAttribute("aria-label",A)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map((M=>typeof M!="string"?"":M))):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const M=this._map.style.stylesheet;this.styleOwner=M.owner,this.styleId=M.id}const v=this._map.style.sourceCaches;for(const M in v){const P=v[M];if(P.used||P.usedForTerrain){const q=P.getSource();q.attribution&&o.indexOf(q.attribution)<0&&o.push(q.attribution)}}o=o.filter((M=>String(M).trim())),o.sort(((M,P)=>M.length-P.length)),o=o.filter(((M,P)=>{for(let q=P+1;q<o.length;q++)if(o[q].indexOf(M)>=0)return!1;return!0}));const A=o.join(" | ");A!==this._attribHTML&&(this._attribHTML=A,o.length?(this._innerContainer.innerHTML=A,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Qd{constructor(o={}){this._updateCompact=()=>{const v=this._container.children;if(v.length){const A=v[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&A.classList.add("maplibregl-compact"):A.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=ht.create("div","maplibregl-ctrl");const v=ht.create("a","maplibregl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://maplibre.org/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){ht.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ra{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const v=++this._id;return this._queue.push({callback:o,id:v,cancelled:!1}),v}remove(o){const v=this._currentlyRunning,A=v?this._queue.concat(v):this._queue;for(const M of A)if(M.id===o)return void(M.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const v=this._currentlyRunning=this._queue;this._queue=[];for(const A of v)if(!A.cancelled&&(A.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Xc=n.Y([{name:"a_pos3d",type:"Int16",components:3}]);class ip extends n.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,v){this.sourceCache.update(o,v),this._renderableTilesKeys=[];const A={};for(const M of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:v}))A[M.key]=!0,this._renderableTilesKeys.push(M.key),this._tiles[M.key]||(M.posMatrix=new Float64Array(16),n.aP(M.posMatrix,0,n.X,0,n.X,0,1),this._tiles[M.key]=new ms(M,this.tileSize));for(const M in this._tiles)A[M]||delete this._tiles[M]}freeRtt(o){for(const v in this._tiles){const A=this._tiles[v];(!o||A.tileID.equals(o)||A.tileID.isChildOf(o)||o.isChildOf(A.tileID))&&(A.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((o=>this.getTileByID(o)))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const v={};for(const A of this._renderableTilesKeys){const M=this._tiles[A].tileID;if(M.canonical.equals(o.canonical)){const P=o.clone();P.posMatrix=new Float64Array(16),n.aP(P.posMatrix,0,n.X,0,n.X,0,1),v[A]=P}else if(M.canonical.isChildOf(o.canonical)){const P=o.clone();P.posMatrix=new Float64Array(16);const q=M.canonical.z-o.canonical.z,J=M.canonical.x-(M.canonical.x>>q<<q),ne=M.canonical.y-(M.canonical.y>>q<<q),fe=n.X>>q;n.aP(P.posMatrix,0,fe,0,fe,0,1),n.J(P.posMatrix,P.posMatrix,[-J*fe,-ne*fe,0]),v[A]=P}else if(o.canonical.isChildOf(M.canonical)){const P=o.clone();P.posMatrix=new Float64Array(16);const q=o.canonical.z-M.canonical.z,J=o.canonical.x-(o.canonical.x>>q<<q),ne=o.canonical.y-(o.canonical.y>>q<<q),fe=n.X>>q;n.aP(P.posMatrix,0,n.X,0,n.X,0,1),n.J(P.posMatrix,P.posMatrix,[J*fe,ne*fe,0]),n.K(P.posMatrix,P.posMatrix,[1/2**q,1/2**q,0]),v[A]=P}}return v}getSourceTile(o,v){const A=this.sourceCache._source;let M=o.overscaledZ-this.deltaZoom;if(M>A.maxzoom&&(M=A.maxzoom),M<A.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(M).key);let P=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!P||!P.dem)&&v)for(;M>=A.minzoom&&(!P||!P.dem);)P=this.sourceCache.getTileByID(o.scaledTo(M--).key);return P}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter((v=>v.timeAdded>=o))}}class dd{constructor(o,v,A){this.painter=o,this.sourceCache=new ip(v),this.options=A,this.exaggeration=typeof A.exaggeration=="number"?A.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,v,A,M=n.X){var P;if(!(v>=0&&v<M&&A>=0&&A<M))return 0;const q=this.getTerrainData(o),J=(P=q.tile)===null||P===void 0?void 0:P.dem;if(!J)return 0;const ne=(function(ot,wt,Mt){var Rt=wt[0],Ft=wt[1];return ot[0]=Mt[0]*Rt+Mt[4]*Ft+Mt[12],ot[1]=Mt[1]*Rt+Mt[5]*Ft+Mt[13],ot})([],[v/M*n.X,A/M*n.X],q.u_terrain_matrix),fe=[ne[0]*J.dim,ne[1]*J.dim],we=Math.floor(fe[0]),Te=Math.floor(fe[1]),Be=fe[0]-we,Ke=fe[1]-Te;return J.get(we,Te)*(1-Be)*(1-Ke)+J.get(we+1,Te)*Be*(1-Ke)+J.get(we,Te+1)*(1-Be)*Ke+J.get(we+1,Te+1)*Be*Ke}getElevationForLngLatZoom(o,v){if(!n.bb(v,o.wrap()))return 0;const{tileID:A,mercatorX:M,mercatorY:P}=this._getOverscaledTileIDFromLngLatZoom(o,v);return this.getElevation(A,M%n.X,P%n.X,n.X)}getElevation(o,v,A,M=n.X){return this.getDEMElevation(o,v,A,M)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const M=this.painter.context,P=new n.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new tn(M,P,M.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new tn(M,new n.R({width:1,height:1}),M.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(M.gl.NEAREST,M.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=n.an([])}const v=this.sourceCache.getSourceTile(o,!0);if(v&&v.dem&&(!v.demTexture||v.needsTerrainPrepare)){const M=this.painter.context;v.demTexture=this.painter.getTileTexture(v.dem.stride),v.demTexture?v.demTexture.update(v.dem.getPixels(),{premultiply:!1}):v.demTexture=new tn(M,v.dem.getPixels(),M.gl.RGBA,{premultiply:!1}),v.demTexture.bind(M.gl.NEAREST,M.gl.CLAMP_TO_EDGE),v.needsTerrainPrepare=!1}const A=v&&v+v.tileID.key+o.key;if(A&&!this._demMatrixCache[A]){const M=this.sourceCache.sourceCache._source.maxzoom;let P=o.canonical.z-v.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=M?P=o.canonical.z-M:n.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const q=o.canonical.x-(o.canonical.x>>P<<P),J=o.canonical.y-(o.canonical.y>>P<<P),ne=n.bc(new Float64Array(16),[1/(n.X<<P),1/(n.X<<P),0]);n.J(ne,ne,[q*n.X,J*n.X,0]),this._demMatrixCache[o.key]={matrix:ne,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:v&&v.dem&&v.dem.dim||1,u_terrain_matrix:A?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:v&&v.dem&&v.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(v&&v.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:v}}getFramebuffer(o){const v=this.painter,A=v.width/devicePixelRatio,M=v.height/devicePixelRatio;return!this._fbo||this._fbo.width===A&&this._fbo.height===M||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new tn(v.context,{width:A,height:M,data:null},v.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(v.context.gl.NEAREST,v.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new tn(v.context,{width:A,height:M,data:null},v.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(v.context.gl.NEAREST,v.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=v.context.createFramebuffer(A,M,!0,!1),this._fbo.depthAttachment.set(v.context.createRenderbuffer(v.context.gl.DEPTH_COMPONENT16,A,M))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const v=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let P=0,q=0;P<this._coordsTextureSize;P++)for(let J=0;J<this._coordsTextureSize;J++,q+=4)v[q+0]=255&J,v[q+1]=255&P,v[q+2]=J>>8<<4|P>>8,v[q+3]=0;const A=new n.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(v.buffer)),M=new tn(o,A,o.gl.RGBA,{premultiply:!1});return M.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=M,M}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const v=new Uint8Array(4),A=this.painter.context,M=A.gl,P=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),q=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),J=Math.round(this.painter.height/devicePixelRatio);A.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),M.readPixels(P,J-q-1,1,1,M.RGBA,M.UNSIGNED_BYTE,v),A.bindFramebuffer.set(null);const ne=v[0]+(v[2]>>4<<8),fe=v[1]+((15&v[2])<<8),we=this.coordsIndex[255-v[3]],Te=we&&this.sourceCache.getTileByID(we);if(!Te)return null;const Be=this._coordsTextureSize,Ke=(1<<Te.tileID.canonical.z)*Be;return new n.Z((Te.tileID.canonical.x*Be+ne)/Ke+Te.tileID.wrap,(Te.tileID.canonical.y*Be+fe)/Ke,this.getElevation(Te.tileID,ne,fe,Be))}depthAtPoint(o){const v=new Uint8Array(4),A=this.painter.context,M=A.gl;return A.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),M.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,M.RGBA,M.UNSIGNED_BYTE,v),A.bindFramebuffer.set(null),(v[0]/16777216+v[1]/65536+v[2]/256+v[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,v=new n.bd,A=new n.aY,M=this.meshSize,P=n.X/M,q=M*M;for(let Te=0;Te<=M;Te++)for(let Be=0;Be<=M;Be++)v.emplaceBack(Be*P,Te*P,0);for(let Te=0;Te<q;Te+=M+1)for(let Be=0;Be<M;Be++)A.emplaceBack(Be+Te,M+Be+Te+1,M+Be+Te+2),A.emplaceBack(Be+Te,M+Be+Te+2,Be+Te+1);const J=v.length,ne=J+2*(M+1);for(const Te of[0,1])for(let Be=0;Be<=M;Be++)for(const Ke of[0,1])v.emplaceBack(Be*P,Te*n.X,Ke);for(let Te=0;Te<2*M;Te+=2)A.emplaceBack(ne+Te,ne+Te+1,ne+Te+3),A.emplaceBack(ne+Te,ne+Te+3,ne+Te+2),A.emplaceBack(J+Te,J+Te+3,J+Te+1),A.emplaceBack(J+Te,J+Te+2,J+Te+3);const fe=v.length,we=fe+2*(M+1);for(const Te of[0,1])for(let Be=0;Be<=M;Be++)for(const Ke of[0,1])v.emplaceBack(Te*n.X,Be*P,Ke);for(let Te=0;Te<2*M;Te+=2)A.emplaceBack(fe+Te,fe+Te+1,fe+Te+3),A.emplaceBack(fe+Te,fe+Te+3,fe+Te+2),A.emplaceBack(we+Te,we+Te+3,we+Te+1),A.emplaceBack(we+Te,we+Te+2,we+Te+3);return this._mesh=new du(o.createVertexBuffer(v,Xc.members),o.createIndexBuffer(A),n.a0.simpleSegment(0,0,v.length,A.length)),this._mesh}getMeshFrameDelta(o){return 2*Math.PI*n.be/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,v){var A;const{tileID:M}=this._getOverscaledTileIDFromLngLatZoom(o,v);return(A=this.getMinMaxElevation(M).minElevation)!==null&&A!==void 0?A:0}getMinMaxElevation(o){const v=this.getTerrainData(o).tile,A={minElevation:null,maxElevation:null};return v&&v.dem&&(A.minElevation=v.dem.min*this.exaggeration,A.maxElevation=v.dem.max*this.exaggeration),A}_getOverscaledTileIDFromLngLatZoom(o,v){const A=n.Z.fromLngLat(o.wrap()),M=(1<<v)*n.X,P=A.x*M,q=A.y*M,J=Math.floor(P/n.X),ne=Math.floor(q/n.X);return{tileID:new n.S(v,0,v,J,ne),mercatorX:P,mercatorY:q}}}class np{constructor(o,v,A){this._context=o,this._size=v,this._tileSize=A,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const v=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),A=new tn(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return A.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),v.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),v.colorAttachment.set(A.texture),{id:o,fbo:v,texture:A,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((v=>o.id!==v)),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const v of this._recentlyUsed)if(!this._objects[v].inUse)return this._objects[v];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((o=>!o.inUse))===!1}}const Ol={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ju{constructor(o,v){this.painter=o,this.terrain=v,this.pool=new np(o.context,30,v.sourceCache.tileSize*v.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,v){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter((A=>!o._layers[A].isHidden(v))),this._coordsDescendingInv={};for(const A in o.sourceCaches){this._coordsDescendingInv[A]={};const M=o.sourceCaches[A].getVisibleCoordinates();for(const P of M){const q=this.terrain.sourceCache.getTerrainCoords(P);for(const J in q)this._coordsDescendingInv[A][J]||(this._coordsDescendingInv[A][J]=[]),this._coordsDescendingInv[A][J].push(q[J])}}this._coordsDescendingInvStr={};for(const A of o._order){const M=o._layers[A],P=M.source;if(Ol[M.type]&&!this._coordsDescendingInvStr[P]){this._coordsDescendingInvStr[P]={};for(const q in this._coordsDescendingInv[P])this._coordsDescendingInvStr[P][q]=this._coordsDescendingInv[P][q].map((J=>J.key)).sort().join()}}for(const A of this._renderableTiles)for(const M in this._coordsDescendingInvStr){const P=this._coordsDescendingInvStr[M][A.tileID.key];P&&P!==A.rttCoords[M]&&(A.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const v=o.type,A=this.painter,M=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Ol[v]&&(this._prevType&&Ol[this._prevType]||this._stacks.push([]),this._prevType=v,this._stacks[this._stacks.length-1].push(o.id),!M))return!0;if(Ol[this._prevType]||Ol[v]&&M){this._prevType=v;const P=this._stacks.length-1,q=this._stacks[P]||[];for(const J of this._renderableTiles){if(this.pool.isFull()&&(sd(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(J),J.rtt[P]){const fe=this.pool.getObjectForId(J.rtt[P].id);if(fe.stamp===J.rtt[P].stamp){this.pool.useObject(fe);continue}}const ne=this.pool.getOrCreateFreeObject();this.pool.useObject(ne),this.pool.stampObject(ne),J.rtt[P]={id:ne.id,stamp:ne.stamp},A.context.bindFramebuffer.set(ne.fbo.framebuffer),A.context.clear({color:n.aM.transparent,stencil:0}),A.currentStencilSource=void 0;for(let fe=0;fe<q.length;fe++){const we=A.style._layers[q[fe]],Te=we.source?this._coordsDescendingInv[we.source][J.tileID.key]:[J.tileID];A.context.viewport.set([0,0,ne.fbo.width,ne.fbo.height]),A._renderTileClippingMasks(we,Te),A.renderLayer(A,A.style.sourceCaches[we.source],we,Te),we.source&&(J.rttCoords[we.source]=this._coordsDescendingInvStr[we.source][J.tileID.key])}}return sd(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Ol[v]}return!1}}const ch={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},uh=ke,Rp={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Jl,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:n.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},Cd=L=>{L.touchstart=L.dragStart,L.touchmoveWindow=L.dragMove,L.touchend=L.dragEnd},fd={showCompass:!0,showZoom:!0,visualizePitch:!1};class ef{constructor(o,v,A=!1){this.mousedown=q=>{this.startMouse(n.e({},q,{ctrlKey:!0,preventDefault:()=>q.preventDefault()}),ht.mousePos(this.element,q)),ht.addEventListener(window,"mousemove",this.mousemove),ht.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=q=>{this.moveMouse(q,ht.mousePos(this.element,q))},this.mouseup=q=>{this.mouseRotate.dragEnd(q),this.mousePitch&&this.mousePitch.dragEnd(q),this.offTemp()},this.touchstart=q=>{q.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ht.touchPos(this.element,q.targetTouches)[0],this.startTouch(q,this._startPos),ht.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),ht.addEventListener(window,"touchend",this.touchend))},this.touchmove=q=>{q.targetTouches.length!==1?this.reset():(this._lastPos=ht.touchPos(this.element,q.targetTouches)[0],this.moveTouch(q,this._lastPos))},this.touchend=q=>{q.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const M=o.dragRotate._mouseRotate.getClickTolerance(),P=o.dragRotate._mousePitch.getClickTolerance();this.element=v,this.mouseRotate=Bu({clickTolerance:M,enable:!0}),this.touchRotate=(({enable:q,clickTolerance:J,bearingDegreesPerPixelMoved:ne=.8})=>{const fe=new Ou;return new gl({clickTolerance:J,move:(we,Te)=>({bearingDelta:(Te.x-we.x)*ne}),moveStateManager:fe,enable:q,assignEvents:Cd})})({clickTolerance:M,enable:!0}),this.map=o,A&&(this.mousePitch=Lh({clickTolerance:P,enable:!0}),this.touchPitch=(({enable:q,clickTolerance:J,pitchDegreesPerPixelMoved:ne=-.5})=>{const fe=new Ou;return new gl({clickTolerance:J,move:(we,Te)=>({pitchDelta:(Te.y-we.y)*ne}),moveStateManager:fe,enable:q,assignEvents:Cd})})({clickTolerance:P,enable:!0})),ht.addEventListener(v,"mousedown",this.mousedown),ht.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),ht.addEventListener(v,"touchcancel",this.reset)}startMouse(o,v){this.mouseRotate.dragStart(o,v),this.mousePitch&&this.mousePitch.dragStart(o,v),ht.disableDrag()}startTouch(o,v){this.touchRotate.dragStart(o,v),this.touchPitch&&this.touchPitch.dragStart(o,v),ht.disableDrag()}moveMouse(o,v){const A=this.map,{bearingDelta:M}=this.mouseRotate.dragMove(o,v)||{};if(M&&A.setBearing(A.getBearing()+M),this.mousePitch){const{pitchDelta:P}=this.mousePitch.dragMove(o,v)||{};P&&A.setPitch(A.getPitch()+P)}}moveTouch(o,v){const A=this.map,{bearingDelta:M}=this.touchRotate.dragMove(o,v)||{};if(M&&A.setBearing(A.getBearing()+M),this.touchPitch){const{pitchDelta:P}=this.touchPitch.dragMove(o,v)||{};P&&A.setPitch(A.getPitch()+P)}}off(){const o=this.element;ht.removeEventListener(o,"mousedown",this.mousedown),ht.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),ht.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ht.removeEventListener(window,"touchend",this.touchend),ht.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){ht.enableDrag(),ht.removeEventListener(window,"mousemove",this.mousemove),ht.removeEventListener(window,"mouseup",this.mouseup),ht.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),ht.removeEventListener(window,"touchend",this.touchend)}}let Yo;function Ba(L,o,v){const A=new n.N(L.lng,L.lat);if(L=new n.N(L.lng,L.lat),o){const M=new n.N(L.lng-360,L.lat),P=new n.N(L.lng+360,L.lat),q=v.locationPoint(L).distSqr(o);v.locationPoint(M).distSqr(o)<q?L=M:v.locationPoint(P).distSqr(o)<q&&(L=P)}for(;Math.abs(L.lng-v.center.lng)>180;){const M=v.locationPoint(L);if(M.x>=0&&M.y>=0&&M.x<=v.width&&M.y<=v.height)break;L.lng>v.center.lng?L.lng-=360:L.lng+=360}return L.lng!==A.lng&&v.locationPoint(L).y>v.height/2-v.getHorizon()?L:A}const yu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function pd(L,o,v){const A=L.classList;for(const M in yu)A.remove(`maplibregl-${v}-anchor-${M}`);A.add(`maplibregl-${v}-anchor-${o}`)}class Nh extends n.E{constructor(o){if(super(),this._onKeyPress=v=>{const A=v.code,M=v.charCode||v.keyCode;A!=="Space"&&A!=="Enter"&&M!==32&&M!==13||this.togglePopup()},this._onMapClick=v=>{const A=v.originalEvent.target,M=this._element;this._popup&&(A===M||M.contains(A))&&this.togglePopup()},this._update=v=>{var A;if(!this._map)return;const M=this._map.loaded()&&!this._map.isMoving();(v?.type==="terrain"||v?.type==="render"&&!M)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Ba(this._lngLat,this._flatPos,this._map.transform):(A=this._lngLat)===null||A===void 0?void 0:A.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let P="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?P=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(P=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let q="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?q="rotateX(0deg)":this._pitchAlignment==="map"&&(q=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||v&&v.type!=="moveend"||(this._pos=this._pos.round()),ht.setTransform(this._element,`${yu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${q} ${P}`),it.frameAsync(new AbortController).then((()=>{this._updateOpacity(v&&v.type==="moveend")})).catch((()=>{}))},this._onMove=v=>{if(!this._isDragging){const A=this._clickTolerance||this._map._clickTolerance;this._isDragging=v.point.dist(this._pointerdownPos)>=A}this._isDragging&&(this._pos=v.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.k("dragstart"))),this.fire(new n.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new n.k("dragend")),this._state="inactive"},this._addDragHandler=v=>{this._element.contains(v.originalEvent.target)&&(v.preventDefault(),this._positionDelta=v.point.sub(this._pos).add(this._offset),this._pointerdownPos=v.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o?.opacity,o?.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=n.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=ht.create("div");const v=ht.createNS("http://www.w3.org/2000/svg","svg"),A=41,M=27;v.setAttributeNS(null,"display","block"),v.setAttributeNS(null,"height",`${A}px`),v.setAttributeNS(null,"width",`${M}px`),v.setAttributeNS(null,"viewBox",`0 0 ${M} ${A}`);const P=ht.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");const q=ht.createNS("http://www.w3.org/2000/svg","g");q.setAttributeNS(null,"fill-rule","nonzero");const J=ht.createNS("http://www.w3.org/2000/svg","g");J.setAttributeNS(null,"transform","translate(3.0, 29.0)"),J.setAttributeNS(null,"fill","#000000");const ne=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Rt of ne){const Ft=ht.createNS("http://www.w3.org/2000/svg","ellipse");Ft.setAttributeNS(null,"opacity","0.04"),Ft.setAttributeNS(null,"cx","10.5"),Ft.setAttributeNS(null,"cy","5.80029008"),Ft.setAttributeNS(null,"rx",Rt.rx),Ft.setAttributeNS(null,"ry",Rt.ry),J.appendChild(Ft)}const fe=ht.createNS("http://www.w3.org/2000/svg","g");fe.setAttributeNS(null,"fill",this._color);const we=ht.createNS("http://www.w3.org/2000/svg","path");we.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),fe.appendChild(we);const Te=ht.createNS("http://www.w3.org/2000/svg","g");Te.setAttributeNS(null,"opacity","0.25"),Te.setAttributeNS(null,"fill","#000000");const Be=ht.createNS("http://www.w3.org/2000/svg","path");Be.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Te.appendChild(Be);const Ke=ht.createNS("http://www.w3.org/2000/svg","g");Ke.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ke.setAttributeNS(null,"fill","#FFFFFF");const ot=ht.createNS("http://www.w3.org/2000/svg","g");ot.setAttributeNS(null,"transform","translate(8.0, 8.0)");const wt=ht.createNS("http://www.w3.org/2000/svg","circle");wt.setAttributeNS(null,"fill","#000000"),wt.setAttributeNS(null,"opacity","0.25"),wt.setAttributeNS(null,"cx","5.5"),wt.setAttributeNS(null,"cy","5.5"),wt.setAttributeNS(null,"r","5.4999962");const Mt=ht.createNS("http://www.w3.org/2000/svg","circle");Mt.setAttributeNS(null,"fill","#FFFFFF"),Mt.setAttributeNS(null,"cx","5.5"),Mt.setAttributeNS(null,"cy","5.5"),Mt.setAttributeNS(null,"r","5.4999962"),ot.appendChild(wt),ot.appendChild(Mt),q.appendChild(J),q.appendChild(fe),q.appendChild(Te),q.appendChild(Ke),q.appendChild(ot),v.appendChild(q),v.setAttributeNS(null,"height",A*this._scale+"px"),v.setAttributeNS(null,"width",M*this._scale+"px"),this._element.appendChild(v),this._offset=n.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(v=>{v.preventDefault()})),this._element.addEventListener("mousedown",(v=>{v.preventDefault()})),pd(this._element,this._anchor,"marker"),o&&o.className)for(const v of o.className.split(" "))this._element.classList.add(v);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),ht.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=n.N.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const M=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[M,-1*(38.1-13.5+M)],"bottom-right":[-M,-1*(38.1-13.5+M)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var v,A;if(!(!((v=this._map)===null||v===void 0)&&v.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const M=this._map,P=M.terrain.depthAtPoint(this._pos),q=M.terrain.getElevationForLngLatZoom(this._lngLat,M.transform.tileZoom);if(M.transform.lngLatToCameraDepth(this._lngLat,q)-P<.006)return void(this._element.style.opacity=this._opacity);const J=-this._offset.y/M.transform._pixelPerMeter,ne=Math.sin(M.getPitch()*Math.PI/180)*J,fe=M.terrain.depthAtPoint(new n.P(this._pos.x,this._pos.y-this._offset.y)),we=M.transform.lngLatToCameraDepth(this._lngLat,q+ne)-fe>.006;!((A=this._popup)===null||A===void 0)&&A.isOpen()&&we&&this._popup.remove(),this._element.style.opacity=we?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=n.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,v){return o===void 0&&v===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),v!==void 0&&(this._opacityWhenCovered=v),this._map&&this._updateOpacity(!0),this}}const tf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let nf=0,hs=!1;const fc={maxWidth:100,unit:"metric"};function Yc(L,o,v){const A=v&&v.maxWidth||100,M=L._container.clientHeight/2,P=L.unproject([0,M]),q=L.unproject([A,M]),J=P.distanceTo(q);if(v&&v.unit==="imperial"){const ne=3.2808*J;ne>5280?Wn(o,A,ne/5280,L._getUIString("ScaleControl.Miles")):Wn(o,A,ne,L._getUIString("ScaleControl.Feet"))}else v&&v.unit==="nautical"?Wn(o,A,J/1852,L._getUIString("ScaleControl.NauticalMiles")):J>=1e3?Wn(o,A,J/1e3,L._getUIString("ScaleControl.Kilometers")):Wn(o,A,J,L._getUIString("ScaleControl.Meters"))}function Wn(L,o,v,A){const M=(function(P){const q=Math.pow(10,`${Math.floor(P)}`.length-1);let J=P/q;return J=J>=10?10:J>=5?5:J>=3?3:J>=2?2:J>=1?1:(function(ne){const fe=Math.pow(10,Math.ceil(-Math.log(ne)/Math.LN10));return Math.round(ne*fe)/fe})(J),q*J})(v);L.style.width=o*(M/v)+"px",L.innerHTML=`${M}&nbsp;${A}`}const Fr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},vu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Vu(L){if(L){if(typeof L=="number"){const o=Math.round(Math.abs(L)/Math.SQRT2);return{center:new n.P(0,0),top:new n.P(0,L),"top-left":new n.P(o,o),"top-right":new n.P(-o,o),bottom:new n.P(0,-L),"bottom-left":new n.P(o,-o),"bottom-right":new n.P(-o,-o),left:new n.P(L,0),right:new n.P(-L,0)}}if(L instanceof n.P||Array.isArray(L)){const o=n.P.convert(L);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:n.P.convert(L.center||[0,0]),top:n.P.convert(L.top||[0,0]),"top-left":n.P.convert(L["top-left"]||[0,0]),"top-right":n.P.convert(L["top-right"]||[0,0]),bottom:n.P.convert(L.bottom||[0,0]),"bottom-left":n.P.convert(L["bottom-left"]||[0,0]),"bottom-right":n.P.convert(L["bottom-right"]||[0,0]),left:n.P.convert(L.left||[0,0]),right:n.P.convert(L.right||[0,0])}}return Vu(new n.P(0,0))}const md=ke;se.AJAXError=n.bh,se.Evented=n.E,se.LngLat=n.N,se.MercatorCoordinate=n.Z,se.Point=n.P,se.addProtocol=n.bi,se.config=n.a,se.removeProtocol=n.bj,se.AttributionControl=lh,se.BoxZoomHandler=pi,se.CanvasSource=ws,se.CooperativeGesturesHandler=yo,se.DoubleClickZoomHandler=Fl,se.DragPanHandler=Jd,se.DragRotateHandler=oh,se.EdgeInsets=Zc,se.FullscreenControl=class extends n.E{constructor(L={}){super(),this._onFullscreenChange=()=>{var o;let v=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=v?.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)v=v.shadowRoot.fullscreenElement;v===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,L&&L.container&&(L.container instanceof HTMLElement?this._container=L.container:n.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(L){return this._map=L,this._container||(this._container=this._map.getContainer()),this._controlContainer=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){ht.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const L=this._fullscreenButton=ht.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);ht.create("span","maplibregl-ctrl-icon",L).setAttribute("aria-hidden","true"),L.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const L=this._getTitle();this._fullscreenButton.setAttribute("aria-label",L),this._fullscreenButton.title=L}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new n.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new n.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},se.GeoJSONSource=Po,se.GeolocateControl=class extends n.E{constructor(L){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new n.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new n.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const v=new n.N(o.coords.longitude,o.coords.latitude),A=o.coords.accuracy,M=this._map.getBearing(),P=n.e({bearing:M},this.options.fitBoundsOptions),q=$t.fromLngLat(v,A);this._map.fitBounds(q,P,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const v=new n.N(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(v).addTo(this._map),this._userLocationDotMarker.setLngLat(v).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const v=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=v,this._geolocateButton.setAttribute("aria-label",v),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&hs)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new n.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this._geolocateButton=ht.create("button","maplibregl-ctrl-geolocate",this._container),ht.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const v=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=v,this._geolocateButton.setAttribute("aria-label",v)}else{const v=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=v,this._geolocateButton.setAttribute("aria-label",v)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ht.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Nh({element:this._dotElement}),this._circleElement=ht.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(v=>{v.geolocateSource||this._watchState!=="ACTIVE_LOCK"||v.originalEvent&&v.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new n.k("trackuserlocationend")),this.fire(new n.k("userlocationlostfocus")))}))}},this.options=n.e({},tf,L)}onAdd(L){return this._map=L,this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return n._(this,arguments,void 0,(function*(o=!1){if(Yo!==void 0&&!o)return Yo;if(window.navigator.permissions===void 0)return Yo=!!window.navigator.geolocation,Yo;try{Yo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Yo=!!window.navigator.geolocation}return Yo}))})().then((o=>this._finishSetupUI(o))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),ht.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,nf=0,hs=!1}_isOutOfMapMaxBounds(L){const o=this._map.getMaxBounds(),v=L.coords;return o&&(v.longitude<o.getWest()||v.longitude>o.getEast()||v.latitude<o.getSouth()||v.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const L=this._map.getBounds(),o=L.getSouthEast(),v=L.getNorthEast(),A=o.distanceTo(v),M=Math.ceil(this._accuracy/(A/this._map._container.clientHeight)*2);this._circleElement.style.width=`${M}px`,this._circleElement.style.height=`${M}px`}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":nf--,hs=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new n.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.k("trackuserlocationstart")),this.fire(new n.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let L;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),nf++,nf>1?(L={maximumAge:6e5,timeout:0},hs=!0):(L=this.options.positionOptions,hs=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,L)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},se.Hash=Id,se.ImageSource=Io,se.KeyboardHandler=Mo,se.LngLatBounds=$t,se.LogoControl=Qd,se.Map=class extends Bh{constructor(L){n.bf.mark(n.bg.create);const o=Object.assign(Object.assign({},Rp),L);if(o.minZoom!=null&&o.maxZoom!=null&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(o.minPitch!=null&&o.maxPitch!=null&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(o.minPitch!=null&&o.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(o.maxPitch!=null&&o.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new od(o.minZoom,o.maxZoom,o.minPitch,o.maxPitch,o.renderWorldCopies),{bearingSnap:o.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ra,this._controls=[],this._mapId=n.a4(),this._contextLost=v=>{v.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new n.k("webglcontextlost",{originalEvent:v}))},this._contextRestored=v=>{this._setupPainter(),this.resize(),this._update(),this.fire(new n.k("webglcontextrestored",{originalEvent:v}))},this._onMapScroll=v=>{if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=o.interactive,this._maxTileCacheSize=o.maxTileCacheSize,this._maxTileCacheZoomLevels=o.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=o.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=o.preserveDrawingBuffer===!0,this._antialias=o.antialias===!0,this._trackResize=o.trackResize===!0,this._bearingSnap=o.bearingSnap,this._refreshExpiredTiles=o.refreshExpiredTiles===!0,this._fadeDuration=o.fadeDuration,this._crossSourceCollisions=o.crossSourceCollisions===!0,this._collectResourceTiming=o.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ch),o.locale),this._clickTolerance=o.clickTolerance,this._overridePixelRatio=o.pixelRatio,this._maxCanvasSize=o.maxCanvasSize,this.transformCameraUpdate=o.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=o.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=an.addThrottleControl((()=>this.isMoving())),this._requestManager=new Un(o.transformRequest),typeof o.container=="string"){if(this._container=document.getElementById(o.container),!this._container)throw new Error(`Container '${o.container}' not found.`)}else{if(!(o.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=o.container}if(o.maxBounds&&this.setMaxBounds(o.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let v=!1;const A=pu((M=>{this._trackResize&&!this._removed&&(this.resize(M),this.redraw())}),50);this._resizeObserver=new ResizeObserver((M=>{v?A(M):v=!0})),this._resizeObserver.observe(this._container)}this.handlers=new dc(this,o),this._hash=o.hash&&new Id(typeof o.hash=="string"&&o.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch}),o.bounds&&(this.resize(),this.fitBounds(o.bounds,n.e({},o.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=o.localIdeographFontFamily,this._validateStyle=o.validateStyle,o.style&&this.setStyle(o.style,{localIdeographFontFamily:o.localIdeographFontFamily}),o.attributionControl&&this.addControl(new lh(typeof o.attributionControl=="boolean"?void 0:o.attributionControl)),o.maplibreLogo&&this.addControl(new Qd,o.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(v=>{this._update(v.dataType==="style"),this.fire(new n.k(`${v.dataType}data`,v))})),this.on("dataloading",(v=>{this.fire(new n.k(`${v.dataType}dataloading`,v))})),this.on("dataabort",(v=>{this.fire(new n.k("sourcedataabort",v))}))}_getMapId(){return this._mapId}addControl(L,o){if(o===void 0&&(o=L.getDefaultPosition?L.getDefaultPosition():"top-right"),!L||!L.onAdd)return this.fire(new n.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const v=L.onAdd(this);this._controls.push(L);const A=this._controlPositions[o];return o.indexOf("bottom")!==-1?A.insertBefore(v,A.firstChild):A.appendChild(v),this}removeControl(L){if(!L||!L.onRemove)return this.fire(new n.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(L);return o>-1&&this._controls.splice(o,1),L.onRemove(this),this}hasControl(L){return this._controls.indexOf(L)>-1}calculateCameraOptionsFromTo(L,o,v,A){return A==null&&this.terrain&&(A=this.terrain.getElevationForLngLatZoom(v,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(L,o,v,A)}resize(L){var o;const v=this._containerDimensions(),A=v[0],M=v[1],P=this._getClampedPixelRatio(A,M);if(this._resizeCanvas(A,M,P),this.painter.resize(A,M,P),this.painter.overLimit()){const J=this.painter.context.gl;this._maxCanvasSize=[J.drawingBufferWidth,J.drawingBufferHeight];const ne=this._getClampedPixelRatio(A,M);this._resizeCanvas(A,M,ne),this.painter.resize(A,M,ne)}this.transform.resize(A,M),(o=this._requestedCameraState)===null||o===void 0||o.resize(A,M);const q=!this._moving;return q&&(this.stop(),this.fire(new n.k("movestart",L)).fire(new n.k("move",L))),this.fire(new n.k("resize",L)),q&&this.fire(new n.k("moveend",L)),this}_getClampedPixelRatio(L,o){const{0:v,1:A}=this._maxCanvasSize,M=this.getPixelRatio(),P=L*M,q=o*M;return Math.min(P>v?v/P:1,q>A?A/q:1)*M}getPixelRatio(){var L;return(L=this._overridePixelRatio)!==null&&L!==void 0?L:devicePixelRatio}setPixelRatio(L){this._overridePixelRatio=L,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(L){return this.transform.setMaxBounds($t.convert(L)),this._update()}setMinZoom(L){if((L=L??-2)>=-2&&L<=this.transform.maxZoom)return this.transform.minZoom=L,this._update(),this.getZoom()<L&&this.setZoom(L),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(L){if((L=L??22)>=this.transform.minZoom)return this.transform.maxZoom=L,this._update(),this.getZoom()>L&&this.setZoom(L),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(L){if((L=L??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(L>=0&&L<=this.transform.maxPitch)return this.transform.minPitch=L,this._update(),this.getPitch()<L&&this.setPitch(L),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(L){if((L=L??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(L>=this.transform.minPitch)return this.transform.maxPitch=L,this._update(),this.getPitch()>L&&this.setPitch(L),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(L){return this.transform.renderWorldCopies=L,this._update()}project(L){return this.transform.locationPoint(n.N.convert(L),this.style&&this.terrain)}unproject(L){return this.transform.pointLocation(n.P.convert(L),this.terrain)}isMoving(){var L;return this._moving||((L=this.handlers)===null||L===void 0?void 0:L.isMoving())}isZooming(){var L;return this._zooming||((L=this.handlers)===null||L===void 0?void 0:L.isZooming())}isRotating(){var L;return this._rotating||((L=this.handlers)===null||L===void 0?void 0:L.isRotating())}_createDelegatedListener(L,o,v){if(L==="mouseenter"||L==="mouseover"){let A=!1;return{layers:o,listener:v,delegates:{mousemove:P=>{const q=o.filter((ne=>this.getLayer(ne))),J=q.length!==0?this.queryRenderedFeatures(P.point,{layers:q}):[];J.length?A||(A=!0,v.call(this,new Ws(L,this,P.originalEvent,{features:J}))):A=!1},mouseout:()=>{A=!1}}}}if(L==="mouseleave"||L==="mouseout"){let A=!1;return{layers:o,listener:v,delegates:{mousemove:q=>{const J=o.filter((ne=>this.getLayer(ne)));(J.length!==0?this.queryRenderedFeatures(q.point,{layers:J}):[]).length?A=!0:A&&(A=!1,v.call(this,new Ws(L,this,q.originalEvent)))},mouseout:q=>{A&&(A=!1,v.call(this,new Ws(L,this,q.originalEvent)))}}}}{const A=M=>{const P=o.filter((J=>this.getLayer(J))),q=P.length!==0?this.queryRenderedFeatures(M.point,{layers:P}):[];q.length&&(M.features=q,v.call(this,M),delete M.features)};return{layers:o,listener:v,delegates:{[L]:A}}}}_saveDelegatedListener(L,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[L]=this._delegatedListeners[L]||[],this._delegatedListeners[L].push(o)}_removeDelegatedListener(L,o,v){if(!this._delegatedListeners||!this._delegatedListeners[L])return;const A=this._delegatedListeners[L];for(let M=0;M<A.length;M++){const P=A[M];if(P.listener===v&&P.layers.length===o.length&&P.layers.every((q=>o.includes(q)))){for(const q in P.delegates)this.off(q,P.delegates[q]);return void A.splice(M,1)}}}on(L,o,v){if(v===void 0)return super.on(L,o);const A=this._createDelegatedListener(L,typeof o=="string"?[o]:o,v);this._saveDelegatedListener(L,A);for(const M in A.delegates)this.on(M,A.delegates[M]);return this}once(L,o,v){if(v===void 0)return super.once(L,o);const A=typeof o=="string"?[o]:o,M=this._createDelegatedListener(L,A,v);for(const P in M.delegates){const q=M.delegates[P];M.delegates[P]=(...J)=>{this._removeDelegatedListener(L,A,v),q(...J)}}this._saveDelegatedListener(L,M);for(const P in M.delegates)this.once(P,M.delegates[P]);return this}off(L,o,v){return v===void 0?super.off(L,o):(this._removeDelegatedListener(L,typeof o=="string"?[o]:o,v),this)}queryRenderedFeatures(L,o){if(!this.style)return[];let v;const A=L instanceof n.P||Array.isArray(L),M=A?L:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(A?{}:L)||{},M instanceof n.P||typeof M[0]=="number")v=[n.P.convert(M)];else{const P=n.P.convert(M[0]),q=n.P.convert(M[1]);v=[P,new n.P(q.x,P.y),q,new n.P(P.x,q.y),P]}return this.style.queryRenderedFeatures(v,o,this.transform)}querySourceFeatures(L,o){return this.style.querySourceFeatures(L,o)}setStyle(L,o){return(o=n.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&L?(this._diffStyle(L,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(L,o))}setTransformRequest(L){return this._requestManager.setTransformRequest(L),this}_getUIString(L){const o=this._locale[L];if(o==null)throw new Error(`Missing UI string '${L}'`);return o}_updateStyle(L,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(L,o)));const v=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!L)),L?(this.style=new ih(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof L=="string"?this.style.loadURL(L,o,v):this.style.loadJSON(L,o,v),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ih(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(L,o){if(typeof L=="string"){const v=this._requestManager.transformRequest(L,"Style");n.h(v,new AbortController).then((A=>{this._updateDiff(A.data,o)})).catch((A=>{A&&this.fire(new n.j(A))}))}else typeof L=="object"&&this._updateDiff(L,o)}_updateDiff(L,o){try{this.style.setState(L,o)&&this._update(!0)}catch(v){n.w(`Unable to perform style diff: ${v.message||v.error||v}.  Rebuilding the style from scratch.`),this._updateStyle(L,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():n.w("There is no style added to the map.")}addSource(L,o){return this._lazyInitEmptyStyle(),this.style.addSource(L,o),this._update(!0)}isSourceLoaded(L){const o=this.style&&this.style.sourceCaches[L];if(o!==void 0)return o.loaded();this.fire(new n.j(new Error(`There is no source with ID '${L}'`)))}setTerrain(L){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),L){const o=this.style.sourceCaches[L.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${L.source}`);this.terrain===null&&o.reload();for(const v in this.style._layers){const A=this.style._layers[v];A.type==="hillshade"&&A.source===L.source&&n.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new dd(this.painter,o,L),this.painter.renderToTexture=new ju(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=v=>{v.dataType==="style"?this.terrain.sourceCache.freeRtt():v.dataType==="source"&&v.tile&&(v.sourceId!==L.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(v.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new n.k("terrain",{terrain:L})),this}getTerrain(){var L,o;return(o=(L=this.terrain)===null||L===void 0?void 0:L.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const L=this.style&&this.style.sourceCaches;for(const o in L){const v=L[o]._tiles;for(const A in v){const M=v[A];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0}removeSource(L){return this.style.removeSource(L),this._update(!0)}getSource(L){return this.style.getSource(L)}addImage(L,o,v={}){const{pixelRatio:A=1,sdf:M=!1,stretchX:P,stretchY:q,content:J,textFitWidth:ne,textFitHeight:fe}=v;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||n.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new n.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:we,height:Te,data:Be}=o,Ke=o;return this.style.addImage(L,{data:new n.R({width:we,height:Te},new Uint8Array(Be)),pixelRatio:A,stretchX:P,stretchY:q,content:J,textFitWidth:ne,textFitHeight:fe,sdf:M,version:0,userImage:Ke}),Ke.onAdd&&Ke.onAdd(this,L),this}}{const{width:we,height:Te,data:Be}=it.getImageData(o);this.style.addImage(L,{data:new n.R({width:we,height:Te},Be),pixelRatio:A,stretchX:P,stretchY:q,content:J,textFitWidth:ne,textFitHeight:fe,sdf:M,version:0})}}updateImage(L,o){const v=this.style.getImage(L);if(!v)return this.fire(new n.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const A=o instanceof HTMLImageElement||n.b(o)?it.getImageData(o):o,{width:M,height:P,data:q}=A;if(M===void 0||P===void 0)return this.fire(new n.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(M!==v.data.width||P!==v.data.height)return this.fire(new n.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const J=!(o instanceof HTMLImageElement||n.b(o));return v.data.replace(q,J),this.style.updateImage(L,v),this}getImage(L){return this.style.getImage(L)}hasImage(L){return L?!!this.style.getImage(L):(this.fire(new n.j(new Error("Missing required image id"))),!1)}removeImage(L){this.style.removeImage(L)}loadImage(L){return an.getImage(this._requestManager.transformRequest(L,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(L,o){return this._lazyInitEmptyStyle(),this.style.addLayer(L,o),this._update(!0)}moveLayer(L,o){return this.style.moveLayer(L,o),this._update(!0)}removeLayer(L){return this.style.removeLayer(L),this._update(!0)}getLayer(L){return this.style.getLayer(L)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(L,o,v){return this.style.setLayerZoomRange(L,o,v),this._update(!0)}setFilter(L,o,v={}){return this.style.setFilter(L,o,v),this._update(!0)}getFilter(L){return this.style.getFilter(L)}setPaintProperty(L,o,v,A={}){return this.style.setPaintProperty(L,o,v,A),this._update(!0)}getPaintProperty(L,o){return this.style.getPaintProperty(L,o)}setLayoutProperty(L,o,v,A={}){return this.style.setLayoutProperty(L,o,v,A),this._update(!0)}getLayoutProperty(L,o){return this.style.getLayoutProperty(L,o)}setGlyphs(L,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(L,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(L,o,v={}){return this._lazyInitEmptyStyle(),this.style.addSprite(L,o,v,(A=>{A||this._update(!0)})),this}removeSprite(L){return this._lazyInitEmptyStyle(),this.style.removeSprite(L),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(L,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(L,o,(v=>{v||this._update(!0)})),this}setLight(L,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(L,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(L){return this._lazyInitEmptyStyle(),this.style.setSky(L),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(L,o){return this.style.setFeatureState(L,o),this._update()}removeFeatureState(L,o){return this.style.removeFeatureState(L,o),this._update()}getFeatureState(L){return this.style.getFeatureState(L)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let L=0,o=0;return this._container&&(L=this._container.clientWidth||400,o=this._container.clientHeight||300),[L,o]}_setupContainer(){const L=this._container;L.classList.add("maplibregl-map");const o=this._canvasContainer=ht.create("div","maplibregl-canvas-container",L);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=ht.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const v=this._containerDimensions(),A=this._getClampedPixelRatio(v[0],v[1]);this._resizeCanvas(v[0],v[1],A);const M=this._controlContainer=ht.create("div","maplibregl-control-container",L),P=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((q=>{P[q]=ht.create("div",`maplibregl-ctrl-${q} `,M)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(L,o,v){this._canvas.width=Math.floor(v*L),this._canvas.height=Math.floor(v*o),this._canvas.style.width=`${L}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const L={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",(A=>{o={requestedAttributes:L},A&&(o.statusMessage=A.statusMessage,o.type=A.type)}),{once:!0});const v=this._canvas.getContext("webgl2",L)||this._canvas.getContext("webgl",L);if(!v){const A="Failed to initialize WebGL";throw o?(o.message=A,new Error(JSON.stringify(o))):new Error(A)}this.painter=new Pc(v,this.transform),Ci.testSupport(v)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(L){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||L,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(L){return this._update(),this._renderTaskQueue.add(L)}_cancelRenderFrame(L){this._renderTaskQueue.remove(L)}_render(L){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(L),this._removed)return;let v=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,P=it.now();this.style.zoomHistory.update(M,P);const q=new n.z(M,{now:P,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),J=q.crossFadingFactor();J===1&&J===this._crossFadingFactor||(v=!0,this._crossFadingFactor=J),this.style.update(q)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new n.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.bf.mark(n.bg.load),this.fire(new n.k("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new n.k("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,n.bf.mark(n.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var L;this._hash&&this._hash.remove();for(const v of this._controls)v.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),an.removeThrottleControl(this._imageQueueHandle),(L=this._resizeObserver)===null||L===void 0||L.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o?.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),ht.remove(this._canvasContainer),ht.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),n.bf.clearMetrics(),this._removed=!0,this.fire(new n.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,it.frameAsync(this._frameRequest).then((L=>{n.bf.frame(L),this._frameRequest=null,this._render(L)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(L){this._showTileBoundaries!==L&&(this._showTileBoundaries=L,this._update())}get showPadding(){return!!this._showPadding}set showPadding(L){this._showPadding!==L&&(this._showPadding=L,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(L){this._showCollisionBoxes!==L&&(this._showCollisionBoxes=L,L?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(L){this._showOverdrawInspector!==L&&(this._showOverdrawInspector=L,this._update())}get repaint(){return!!this._repaint}set repaint(L){this._repaint!==L&&(this._repaint=L,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(L){this._vertices=L,this._update()}get version(){return uh}getCameraTargetElevation(){return this.transform.elevation}},se.MapMouseEvent=Ws,se.MapTouchEvent=uc,se.MapWheelEvent=hc,se.Marker=Nh,se.NavigationControl=class{constructor(L){this._updateZoomButtons=()=>{const o=this._map.getZoom(),v=o===this._map.getMaxZoom(),A=o===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=A,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",A.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,v)=>{const A=this._map._getUIString(`NavigationControl.${v}`);o.title=A,o.setAttribute("aria-label",A)},this.options=n.e({},fd,L),this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(o=>this._map.zoomIn({},{originalEvent:o}))),ht.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(o=>this._map.zoomOut({},{originalEvent:o}))),ht.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})})),this._compassIcon=ht.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(L){return this._map=L,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ef(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){ht.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(L,o){const v=ht.create("button",L,this._container);return v.type="button",v.addEventListener("click",o),v}},se.Popup=class extends n.E{constructor(L){super(),this.remove=()=>(this._content&&ht.remove(this._content),this._container&&(ht.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new n.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var v;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=ht.create("div","maplibregl-popup",this._map.getContainer()),this._tip=ht.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const J of this.options.className.split(" "))this._container.classList.add(J);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Ba(this._lngLat,this._flatPos,this._map.transform):(v=this._lngLat)===null||v===void 0?void 0:v.wrap(),this._trackPointer&&!o)return;const A=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let M=this.options.anchor;const P=Vu(this.options.offset);if(!M){const J=this._container.offsetWidth,ne=this._container.offsetHeight;let fe;fe=A.y+P.bottom.y<ne?["top"]:A.y>this._map.transform.height-ne?["bottom"]:[],A.x<J/2?fe.push("left"):A.x>this._map.transform.width-J/2&&fe.push("right"),M=fe.length===0?"bottom":fe.join("-")}let q=A.add(P[M]);this.options.subpixelPositioning||(q=q.round()),ht.setTransform(this._container,`${yu[M]} translate(${q.x}px,${q.y}px)`),pd(this._container,M,"popup")},this._onClose=()=>{this.remove()},this.options=n.e(Object.create(Fr),L)}addTo(L){return this._map&&this.remove(),this._map=L,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new n.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(L){return this._lngLat=n.N.convert(L),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(L){return this.setDOMContent(document.createTextNode(L))}setHTML(L){const o=document.createDocumentFragment(),v=document.createElement("body");let A;for(v.innerHTML=L;A=v.firstChild,A;)o.appendChild(A);return this.setDOMContent(o)}getMaxWidth(){var L;return(L=this._container)===null||L===void 0?void 0:L.style.maxWidth}setMaxWidth(L){return this.options.maxWidth=L,this._update(),this}setDOMContent(L){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=ht.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(L),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(L){return this._container&&this._container.classList.add(L),this}removeClassName(L){return this._container&&this._container.classList.remove(L),this}setOffset(L){return this.options.offset=L,this._update(),this}toggleClassName(L){if(this._container)return this._container.classList.toggle(L)}setSubpixelPositioning(L){this.options.subpixelPositioning=L}_createCloseButton(){this.options.closeButton&&(this._closeButton=ht.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const L=this._container.querySelector(vu);L&&L.focus()}},se.RasterDEMTileSource=la,se.RasterTileSource=Ar,se.ScaleControl=class{constructor(L){this._onMove=()=>{Yc(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Yc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},fc),L)}getDefaultPosition(){return"bottom-left"}onAdd(L){return this._map=L,this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-scale",L.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){ht.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},se.ScrollZoomHandler=al,se.Style=ih,se.TerrainControl=class{constructor(L){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=L}onAdd(L){return this._map=L,this._container=ht.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=ht.create("button","maplibregl-ctrl-terrain",this._container),ht.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){ht.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},se.TwoFingersTouchPitchHandler=hd,se.TwoFingersTouchRotateHandler=Nr,se.TwoFingersTouchZoomHandler=Yd,se.TwoFingersTouchZoomRotateHandler=Oh,se.VectorTileSource=Ir,se.VideoSource=Mr,se.addSourceType=(L,o)=>n._(void 0,void 0,void 0,(function*(){if(Ps(L))throw new Error(`A source type called "${L}" already exists.`);((v,A)=>{Ds[v]=A})(L,o)})),se.clearPrewarmedResources=function(){const L=Gr;L&&(L.isPreloaded()&&L.numActive()===1?(L.release(vn),Gr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},se.getMaxParallelImageRequests=function(){return n.a.MAX_PARALLEL_IMAGE_REQUESTS},se.getRTLTextPluginStatus=function(){return Ha().getRTLTextPluginStatus()},se.getVersion=function(){return md},se.getWorkerCount=function(){return tr.workerCount},se.getWorkerUrl=function(){return n.a.WORKER_URL},se.importScriptInWorkers=function(L){return br().broadcast("IS",L)},se.prewarm=function(){In().acquire(vn)},se.setMaxParallelImageRequests=function(L){n.a.MAX_PARALLEL_IMAGE_REQUESTS=L},se.setRTLTextPlugin=function(L,o){return Ha().setRTLTextPlugin(L,o)},se.setWorkerCount=function(L){tr.workerCount=L},se.setWorkerUrl=function(L){n.a.WORKER_URL=L}}));var Ce=de;return Ce}))})(Yy)),Yy.exports}var gw=V4();const yw=iy(gw),U4=Bb({__proto__:null,default:yw},[gw]),vw="/mad-transit/assets/btv2busicon-BuI07VNn.svg",G4={A2:"#FF5810",A1:"#FF5810",A:"#FF5810",B:"#9ACE00",C:"#FF5810",D1:"#FF5810",D:"#FF5810",D2:"#FF5810",E:"#FFD133",F:"#7860FF",G:"#33FFF3",H:"#FF8F33",J:"#337BFF",L:"#33FF8A",O:"#FF5810",P:"#33C1A8",R:"#FF5810",S:"#6F61FF",W:"#61C1FF",28:"#FF5810",38:"#FF5810",55:"#61FFA8",60:"#FF5733",61:"#33C1FF",62:"#33FF57",63:"#FF33A8",64:"#FFD133",65:"#8D33FF",75:"#33FFF3",80:"#FF8F33",84:"#337BFF"};function H4({stopId:Z}){const ce=mw();return Tt.useEffect(()=>{const de=ce.current?.getMap();!de||de.hasImage("bus-icon")||de.loadImage(vw,(ue,Ae)=>{if(ue){console.error("Failed to load bus icon:",ue);return}de.hasImage("bus-icon")||de.addImage("bus-icon",Ae,{pixelRatio:2})})},[ce]),Tt.useEffect(()=>{const de=ce.current?.getMap();if(!de)return;const ue="buses-source",Ae="routes-source",Ce="buses-layer",se="routes-layer",n=async()=>{try{const it=(await(await fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/predictions/${Z}`)).json()).results||[],ht={};for(const Ai of it){if(!Ai.route||!Ai.polyline||Ai.polyline.length<2)continue;const an=Ai.eta_minutes??1/0;(!ht[Ai.route]||an<ht[Ai.route].eta_minutes)&&(ht[Ai.route]=Ai)}const Ci=it.filter(Ai=>Ai.vehicle_lat&&Ai.vehicle_lon).map(Ai=>({type:"Feature",geometry:{type:"Point",coordinates:[Ai.vehicle_lon,Ai.vehicle_lat]},properties:{route:Ai.route,destination:Ai.destination,stopsAway:Ai.stops_away,occupancy:Ai.occupancy||"Unknown"}})),Ui=Object.values(ht),Vi=Ui.map((Ai,an)=>{const Un=Ai.polyline.map(Pt=>[Pt.lon,Pt.lat]),rr=Ui.length,mn=(an-(rr-1)/2)*6;return{type:"Feature",geometry:{type:"LineString",coordinates:Un},properties:{route:Ai.route,color:G4[Ai.route]||"#FFD60A",offset:mn}}}),qi={type:"FeatureCollection",features:Ci},on={type:"FeatureCollection",features:Vi};de.getSource(ue)?(de.getSource(ue).setData(qi),de.getSource(Ae).setData(on)):(de.addSource(ue,{type:"geojson",data:qi}),de.addSource(Ae,{type:"geojson",data:on}),de.addLayer({id:se,type:"line",source:Ae,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","color"],"line-width":["interpolate",["exponential",1.5],["zoom"],13,2,15,5,17,8,18,10],"line-opacity":.9}}),de.addLayer({id:Ce,type:"symbol",source:ue,layout:{"icon-image":"bus-icon","icon-size":.6,"icon-allow-overlap":!0}}),de.on("click",Ce,Ai=>{const an=Ai.features?.[0];if(!an)return;const{route:Un,destination:rr,stopsAway:ln,occupancy:mn}=an.properties;new yw.Popup().setLngLat(an.geometry.coordinates).setHTML(`<b>Route ${Un}</b><br/>${rr}<br/>Stops away: ${ln}<br/>Occupancy: ${mn}`).addTo(de)}),de.on("mouseenter",Ce,()=>{de.getCanvas().style.cursor="pointer"}),de.on("mouseleave",Ce,()=>{de.getCanvas().style.cursor=""}))}catch(Fe){console.error("Failed to fetch bus data:",Fe)}};n();const ke=setInterval(n,2e4);return()=>{clearInterval(ke),de.getLayer(se)&&de.removeLayer(se),de.getLayer(Ce)&&de.removeLayer(Ce),de.getSource(ue)&&de.removeSource(ue),de.getSource(Ae)&&de.removeSource(Ae)}},[ce,Z]),null}const q4="/mad-transit/assets/btv2longbusicon-EoiJrL0g.svg";function $4({routeData:Z}){const{current:ce}=mw();Tt.useEffect(()=>{if(!ce)return;const Ce=(se,n)=>{if(ce.hasImage(se))return;const ke=new Image;ke.crossOrigin="anonymous",ke.onload=()=>{if(!ce.hasImage(se)){const Fe=window.devicePixelRatio||2;ce.addImage(se,ke,{pixelRatio:Fe})}},ke.src=n};Ce("btv2-bus-icon",vw),Ce("btv2-long-bus-icon",q4)},[ce]);const de=(Z.route_polylines||[]).map((Ce,se)=>({type:"Feature",geometry:{type:"LineString",coordinates:(Ce.polyline||[]).map(n=>[n.lon,n.lat])},properties:{id:`${Z.route}-${Ce.direction}-${se}`,direction:Ce.direction}}))||[],ue=(Z.vehicles||[]).map((Ce,se)=>{const n=Ce.vehicle_id!=null?String(Ce.vehicle_id):String(se),ke=n.length===4?"btv2-long-bus-icon":"btv2-bus-icon";return{type:"Feature",geometry:{type:"Point",coordinates:[Number(Ce.lon),Number(Ce.lat)]},properties:{id:n,destination:Ce.destination,occupancy:Ce.occupancy,bearing:Ce.bearing!=null?Number(Ce.bearing):0,icon:ke}}})||[],Ae=Z.route||"route";return he.jsxs(he.Fragment,{children:[he.jsx(Cb,{id:`route-lines-${Ae}`,type:"geojson",data:{type:"FeatureCollection",features:de},children:he.jsx(Ib,{id:`route-line-layer-${Ae}`,type:"line",paint:{"line-color":"#111111","line-width":3}})}),he.jsx(Cb,{id:`route-vehicles-${Ae}`,type:"geojson",data:{type:"FeatureCollection",features:ue},children:he.jsx(Ib,{id:`route-vehicle-layer-${Ae}`,type:"symbol",layout:{"icon-image":["coalesce",["get","icon"],"btv2-bus-icon"],"icon-size":["interpolate",["linear"],["zoom"],8,.025,12,.025,16,.1],"icon-rotate":["-",["coalesce",["get","bearing"],0],["case",["==",["get","icon"],"btv2-long-bus-icon"],-90,90]],"icon-rotation-alignment":"map","icon-anchor":"center","icon-allow-overlap":!0,"icon-ignore-placement":!0}})})]})}var Ky={exports:{}};var Z4=Ky.exports,Rb;function W4(){return Rb||(Rb=1,(function(Z,ce){((de,ue)=>{Z.exports=ue()})(Z4,function de(){var ue=typeof self<"u"?self:typeof window<"u"?window:ue!==void 0?ue:{},Ae,Ce=!ue.document&&!!ue.postMessage,se=ue.IS_PAPA_WORKER||!1,n={},ke=0,Fe={};function pt(Pt){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(Bt){var Ni=rr(Bt);Ni.chunkSize=parseInt(Ni.chunkSize),Bt.step||Bt.chunk||(Ni.chunkSize=null),this._handle=new Vi(Ni),(this._handle.streamer=this)._config=Ni}).call(this,Pt),this.parseChunk=function(Bt,Ni){var tn=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<tn){let Wi=this._config.newline;Wi||(Li=this._config.quoteChar||'"',Wi=this._handle.guessLineEndings(Bt,Li)),Bt=[...Bt.split(Wi).slice(tn)].join(Wi)}this.isFirstChunk&&mn(this._config.beforeFirstChunk)&&(Li=this._config.beforeFirstChunk(Bt))!==void 0&&(Bt=Li),this.isFirstChunk=!1,this._halted=!1;var tn=this._partialLine+Bt,Li=(this._partialLine="",this._handle.parse(tn,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(Bt=Li.meta.cursor,tn=(this._finished||(this._partialLine=tn.substring(Bt-this._baseIndex),this._baseIndex=Bt),Li&&Li.data&&(this._rowCount+=Li.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),se)ue.postMessage({results:Li,workerId:Fe.WORKER_ID,finished:tn});else if(mn(this._config.chunk)&&!Ni){if(this._config.chunk(Li,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=Li=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(Li.data),this._completeResults.errors=this._completeResults.errors.concat(Li.errors),this._completeResults.meta=Li.meta),this._completed||!tn||!mn(this._config.complete)||Li&&Li.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),tn||Li&&Li.meta.paused||this._nextChunk(),Li}this._halted=!0},this._sendError=function(Bt){mn(this._config.error)?this._config.error(Bt):se&&this._config.error&&ue.postMessage({workerId:Fe.WORKER_ID,error:Bt,finished:!1})}}function it(Pt){var Bt;(Pt=Pt||{}).chunkSize||(Pt.chunkSize=Fe.RemoteChunkSize),pt.call(this,Pt),this._nextChunk=Ce?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Ni){this._input=Ni,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(Bt=new XMLHttpRequest,this._config.withCredentials&&(Bt.withCredentials=this._config.withCredentials),Ce||(Bt.onload=ln(this._chunkLoaded,this),Bt.onerror=ln(this._chunkError,this)),Bt.open(this._config.downloadRequestBody?"POST":"GET",this._input,!Ce),this._config.downloadRequestHeaders){var Ni,tn=this._config.downloadRequestHeaders;for(Ni in tn)Bt.setRequestHeader(Ni,tn[Ni])}var Li;this._config.chunkSize&&(Li=this._start+this._config.chunkSize-1,Bt.setRequestHeader("Range","bytes="+this._start+"-"+Li));try{Bt.send(this._config.downloadRequestBody)}catch(Wi){this._chunkError(Wi.message)}Ce&&Bt.status===0&&this._chunkError()}},this._chunkLoaded=function(){Bt.readyState===4&&(Bt.status<200||400<=Bt.status?this._chunkError():(this._start+=this._config.chunkSize||Bt.responseText.length,this._finished=!this._config.chunkSize||this._start>=(Ni=>(Ni=Ni.getResponseHeader("Content-Range"))!==null?parseInt(Ni.substring(Ni.lastIndexOf("/")+1)):-1)(Bt),this.parseChunk(Bt.responseText)))},this._chunkError=function(Ni){Ni=Bt.statusText||Ni,this._sendError(new Error(Ni))}}function ht(Pt){(Pt=Pt||{}).chunkSize||(Pt.chunkSize=Fe.LocalChunkSize),pt.call(this,Pt);var Bt,Ni,tn=typeof FileReader<"u";this.stream=function(Li){this._input=Li,Ni=Li.slice||Li.webkitSlice||Li.mozSlice,tn?((Bt=new FileReader).onload=ln(this._chunkLoaded,this),Bt.onerror=ln(this._chunkError,this)):Bt=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var Li=this._input,Wi=(this._config.chunkSize&&(Wi=Math.min(this._start+this._config.chunkSize,this._input.size),Li=Ni.call(Li,this._start,Wi)),Bt.readAsText(Li,this._config.encoding));tn||this._chunkLoaded({target:{result:Wi}})},this._chunkLoaded=function(Li){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(Li.target.result)},this._chunkError=function(){this._sendError(Bt.error)}}function Ci(Pt){var Bt;pt.call(this,Pt=Pt||{}),this.stream=function(Ni){return Bt=Ni,this._nextChunk()},this._nextChunk=function(){var Ni,tn;if(!this._finished)return Ni=this._config.chunkSize,Bt=Ni?(tn=Bt.substring(0,Ni),Bt.substring(Ni)):(tn=Bt,""),this._finished=!Bt,this.parseChunk(tn)}}function Ui(Pt){pt.call(this,Pt=Pt||{});var Bt=[],Ni=!0,tn=!1;this.pause=function(){pt.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){pt.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(Li){this._input=Li,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){tn&&Bt.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),Bt.length?this.parseChunk(Bt.shift()):Ni=!0},this._streamData=ln(function(Li){try{Bt.push(typeof Li=="string"?Li:Li.toString(this._config.encoding)),Ni&&(Ni=!1,this._checkIsFinished(),this.parseChunk(Bt.shift()))}catch(Wi){this._streamError(Wi)}},this),this._streamError=ln(function(Li){this._streamCleanUp(),this._sendError(Li)},this),this._streamEnd=ln(function(){this._streamCleanUp(),tn=!0,this._streamData("")},this),this._streamCleanUp=ln(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Vi(Pt){var Bt,Ni,tn,Li,Wi=Math.pow(2,53),cr=-Wi,Pr=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,si=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,xi=this,Tn=0,zn=0,Er=!1,Et=!1,di=[],mi={data:[],errors:[],meta:{}};function vn(gr){return Pt.skipEmptyLines==="greedy"?gr.join("").trim()==="":gr.length===1&&gr[0].length===0}function tr(){if(mi&&tn&&(Gr("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+Fe.DefaultDelimiter+"'"),tn=!1),Pt.skipEmptyLines&&(mi.data=mi.data.filter(function(ma){return!vn(ma)})),vr()){let ma=function(Kr,oa){mn(Pt.transformHeader)&&(Kr=Pt.transformHeader(Kr,oa)),di.push(Kr)};var br=ma;if(mi)if(Array.isArray(mi.data[0])){for(var gr=0;vr()&&gr<mi.data.length;gr++)mi.data[gr].forEach(ma);mi.data.splice(0,1)}else mi.data.forEach(ma)}function In(ma,Kr){for(var oa=Pt.header?{}:[],Ma=0;Ma<ma.length;Ma++){var $t=Ma,Va=ma[Ma],Va=((Ir,Ar)=>(la=>(Pt.dynamicTypingFunction&&Pt.dynamicTyping[la]===void 0&&(Pt.dynamicTyping[la]=Pt.dynamicTypingFunction(la)),(Pt.dynamicTyping[la]||Pt.dynamicTyping)===!0))(Ir)?Ar==="true"||Ar==="TRUE"||Ar!=="false"&&Ar!=="FALSE"&&((la=>{if(Pr.test(la)&&(la=parseFloat(la),cr<la&&la<Wi))return 1})(Ar)?parseFloat(Ar):si.test(Ar)?new Date(Ar):Ar===""?null:Ar):Ar)($t=Pt.header?Ma>=di.length?"__parsed_extra":di[Ma]:$t,Va=Pt.transform?Pt.transform(Va,$t):Va);$t==="__parsed_extra"?(oa[$t]=oa[$t]||[],oa[$t].push(Va)):oa[$t]=Va}return Pt.header&&(Ma>di.length?Gr("FieldMismatch","TooManyFields","Too many fields: expected "+di.length+" fields but parsed "+Ma,zn+Kr):Ma<di.length&&Gr("FieldMismatch","TooFewFields","Too few fields: expected "+di.length+" fields but parsed "+Ma,zn+Kr)),oa}var Lr;mi&&(Pt.header||Pt.dynamicTyping||Pt.transform)&&(Lr=1,!mi.data.length||Array.isArray(mi.data[0])?(mi.data=mi.data.map(In),Lr=mi.data.length):mi.data=In(mi.data,0),Pt.header&&mi.meta&&(mi.meta.fields=di),zn+=Lr)}function vr(){return Pt.header&&di.length===0}function Gr(gr,In,Lr,br){gr={type:gr,code:In,message:Lr},br!==void 0&&(gr.row=br),mi.errors.push(gr)}mn(Pt.step)&&(Li=Pt.step,Pt.step=function(gr){mi=gr,vr()?tr():(tr(),mi.data.length!==0&&(Tn+=gr.data.length,Pt.preview&&Tn>Pt.preview?Ni.abort():(mi.data=mi.data[0],Li(mi,xi))))}),this.parse=function(gr,In,Lr){var br=Pt.quoteChar||'"',br=(Pt.newline||(Pt.newline=this.guessLineEndings(gr,br)),tn=!1,Pt.delimiter?mn(Pt.delimiter)&&(Pt.delimiter=Pt.delimiter(gr),mi.meta.delimiter=Pt.delimiter):((br=((ma,Kr,oa,Ma,$t)=>{var Va,Ir,Ar,la;$t=$t||[",","	","|",";",Fe.RECORD_SEP,Fe.UNIT_SEP];for(var Po=0;Po<$t.length;Po++){for(var Qs,Io=$t[Po],Mr=0,ws=0,Ds=0,Ps=(Ar=void 0,new on({comments:Ma,delimiter:Io,newline:Kr,preview:10}).parse(ma)),Qt=0;Qt<Ps.data.length;Qt++)oa&&vn(Ps.data[Qt])?Ds++:(Qs=Ps.data[Qt].length,ws+=Qs,Ar===void 0?Ar=Qs:0<Qs&&(Mr+=Math.abs(Qs-Ar),Ar=Qs));0<Ps.data.length&&(ws/=Ps.data.length-Ds),(Ir===void 0||Mr<=Ir)&&(la===void 0||la<ws)&&1.99<ws&&(Ir=Mr,Va=Io,la=ws)}return{successful:!!(Pt.delimiter=Va),bestDelimiter:Va}})(gr,Pt.newline,Pt.skipEmptyLines,Pt.comments,Pt.delimitersToGuess)).successful?Pt.delimiter=br.bestDelimiter:(tn=!0,Pt.delimiter=Fe.DefaultDelimiter),mi.meta.delimiter=Pt.delimiter),rr(Pt));return Pt.preview&&Pt.header&&br.preview++,Bt=gr,Ni=new on(br),mi=Ni.parse(Bt,In,Lr),tr(),Er?{meta:{paused:!0}}:mi||{meta:{paused:!1}}},this.paused=function(){return Er},this.pause=function(){Er=!0,Ni.abort(),Bt=mn(Pt.chunk)?"":Bt.substring(Ni.getCharIndex())},this.resume=function(){xi.streamer._halted?(Er=!1,xi.streamer.parseChunk(Bt,!0)):setTimeout(xi.resume,3)},this.aborted=function(){return Et},this.abort=function(){Et=!0,Ni.abort(),mi.meta.aborted=!0,mn(Pt.complete)&&Pt.complete(mi),Bt=""},this.guessLineEndings=function(ma,br){ma=ma.substring(0,1048576);var br=new RegExp(qi(br)+"([^]*?)"+qi(br),"gm"),Lr=(ma=ma.replace(br,"")).split("\r"),br=ma.split(`
`),ma=1<br.length&&br[0].length<Lr[0].length;if(Lr.length===1||ma)return`
`;for(var Kr=0,oa=0;oa<Lr.length;oa++)Lr[oa][0]===`
`&&Kr++;return Kr>=Lr.length/2?`\r
`:"\r"}}function qi(Pt){return Pt.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function on(Pt){var Bt=(Pt=Pt||{}).delimiter,Ni=Pt.newline,tn=Pt.comments,Li=Pt.step,Wi=Pt.preview,cr=Pt.fastMode,Pr=null,si=!1,xi=Pt.quoteChar==null?'"':Pt.quoteChar,Tn=xi;if(Pt.escapeChar!==void 0&&(Tn=Pt.escapeChar),(typeof Bt!="string"||-1<Fe.BAD_DELIMITERS.indexOf(Bt))&&(Bt=","),tn===Bt)throw new Error("Comment character same as delimiter");tn===!0?tn="#":(typeof tn!="string"||-1<Fe.BAD_DELIMITERS.indexOf(tn))&&(tn=!1),Ni!==`
`&&Ni!=="\r"&&Ni!==`\r
`&&(Ni=`
`);var zn=0,Er=!1;this.parse=function(Et,di,mi){if(typeof Et!="string")throw new Error("Input must be a string");var vn=Et.length,tr=Bt.length,vr=Ni.length,Gr=tn.length,gr=mn(Li),In=[],Lr=[],br=[],ma=zn=0;if(!Et)return Mr();if(cr||cr!==!1&&Et.indexOf(xi)===-1){for(var Kr=Et.split(Ni),oa=0;oa<Kr.length;oa++){if(br=Kr[oa],zn+=br.length,oa!==Kr.length-1)zn+=Ni.length;else if(mi)return Mr();if(!tn||br.substring(0,Gr)!==tn){if(gr){if(In=[],la(br.split(Bt)),ws(),Er)return Mr()}else la(br.split(Bt));if(Wi&&Wi<=oa)return In=In.slice(0,Wi),Mr(!0)}}return Mr()}for(var Ma=Et.indexOf(Bt,zn),$t=Et.indexOf(Ni,zn),Va=new RegExp(qi(Tn)+qi(xi),"g"),Ir=Et.indexOf(xi,zn);;)if(Et[zn]===xi)for(Ir=zn,zn++;;){if((Ir=Et.indexOf(xi,Ir+1))===-1)return mi||Lr.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:In.length,index:zn}),Qs();if(Ir===vn-1)return Qs(Et.substring(zn,Ir).replace(Va,xi));if(xi===Tn&&Et[Ir+1]===Tn)Ir++;else if(xi===Tn||Ir===0||Et[Ir-1]!==Tn){Ma!==-1&&Ma<Ir+1&&(Ma=Et.indexOf(Bt,Ir+1));var Ar=Po(($t=$t!==-1&&$t<Ir+1?Et.indexOf(Ni,Ir+1):$t)===-1?Ma:Math.min(Ma,$t));if(Et.substr(Ir+1+Ar,tr)===Bt){br.push(Et.substring(zn,Ir).replace(Va,xi)),Et[zn=Ir+1+Ar+tr]!==xi&&(Ir=Et.indexOf(xi,zn)),Ma=Et.indexOf(Bt,zn),$t=Et.indexOf(Ni,zn);break}if(Ar=Po($t),Et.substring(Ir+1+Ar,Ir+1+Ar+vr)===Ni){if(br.push(Et.substring(zn,Ir).replace(Va,xi)),Io(Ir+1+Ar+vr),Ma=Et.indexOf(Bt,zn),Ir=Et.indexOf(xi,zn),gr&&(ws(),Er))return Mr();if(Wi&&In.length>=Wi)return Mr(!0);break}Lr.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:In.length,index:zn}),Ir++}}else if(tn&&br.length===0&&Et.substring(zn,zn+Gr)===tn){if($t===-1)return Mr();zn=$t+vr,$t=Et.indexOf(Ni,zn),Ma=Et.indexOf(Bt,zn)}else if(Ma!==-1&&(Ma<$t||$t===-1))br.push(Et.substring(zn,Ma)),zn=Ma+tr,Ma=Et.indexOf(Bt,zn);else{if($t===-1)break;if(br.push(Et.substring(zn,$t)),Io($t+vr),gr&&(ws(),Er))return Mr();if(Wi&&In.length>=Wi)return Mr(!0)}return Qs();function la(Ds){In.push(Ds),ma=zn}function Po(Ds){var Ps=0;return Ps=Ds!==-1&&(Ds=Et.substring(Ir+1,Ds))&&Ds.trim()===""?Ds.length:Ps}function Qs(Ds){return mi||(Ds===void 0&&(Ds=Et.substring(zn)),br.push(Ds),zn=vn,la(br),gr&&ws()),Mr()}function Io(Ds){zn=Ds,la(br),br=[],$t=Et.indexOf(Ni,zn)}function Mr(Ds){if(Pt.header&&!di&&In.length&&!si){var Ps=In[0],Qt=Object.create(null),Gn=new Set(Ps);let Ta=!1;for(let Ha=0;Ha<Ps.length;Ha++){let ms=Ps[Ha];if(Qt[ms=mn(Pt.transformHeader)?Pt.transformHeader(ms,Ha):ms]){let xn,er=Qt[ms];for(;xn=ms+"_"+er,er++,Gn.has(xn););Gn.add(xn),Ps[Ha]=xn,Qt[ms]++,Ta=!0,(Pr=Pr===null?{}:Pr)[xn]=ms}else Qt[ms]=1,Ps[Ha]=ms;Gn.add(ms)}Ta&&console.warn("Duplicate headers found and renamed."),si=!0}return{data:In,errors:Lr,meta:{delimiter:Bt,linebreak:Ni,aborted:Er,truncated:!!Ds,cursor:ma+(di||0),renamedHeaders:Pr}}}function ws(){Li(Mr()),In=[],Lr=[]}},this.abort=function(){Er=!0},this.getCharIndex=function(){return zn}}function Ai(Pt){var Bt=Pt.data,Ni=n[Bt.workerId],tn=!1;if(Bt.error)Ni.userError(Bt.error,Bt.file);else if(Bt.results&&Bt.results.data){var Li={abort:function(){tn=!0,an(Bt.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Un,resume:Un};if(mn(Ni.userStep)){for(var Wi=0;Wi<Bt.results.data.length&&(Ni.userStep({data:Bt.results.data[Wi],errors:Bt.results.errors,meta:Bt.results.meta},Li),!tn);Wi++);delete Bt.results}else mn(Ni.userChunk)&&(Ni.userChunk(Bt.results,Li,Bt.file),delete Bt.results)}Bt.finished&&!tn&&an(Bt.workerId,Bt.results)}function an(Pt,Bt){var Ni=n[Pt];mn(Ni.userComplete)&&Ni.userComplete(Bt),Ni.terminate(),delete n[Pt]}function Un(){throw new Error("Not implemented.")}function rr(Pt){if(typeof Pt!="object"||Pt===null)return Pt;var Bt,Ni=Array.isArray(Pt)?[]:{};for(Bt in Pt)Ni[Bt]=rr(Pt[Bt]);return Ni}function ln(Pt,Bt){return function(){Pt.apply(Bt,arguments)}}function mn(Pt){return typeof Pt=="function"}return Fe.parse=function(Pt,Bt){var Ni=(Bt=Bt||{}).dynamicTyping||!1;if(mn(Ni)&&(Bt.dynamicTypingFunction=Ni,Ni={}),Bt.dynamicTyping=Ni,Bt.transform=!!mn(Bt.transform)&&Bt.transform,!Bt.worker||!Fe.WORKERS_SUPPORTED)return Ni=null,Fe.NODE_STREAM_INPUT,typeof Pt=="string"?(Pt=(tn=>tn.charCodeAt(0)!==65279?tn:tn.slice(1))(Pt),Ni=new(Bt.download?it:Ci)(Bt)):Pt.readable===!0&&mn(Pt.read)&&mn(Pt.on)?Ni=new Ui(Bt):(ue.File&&Pt instanceof File||Pt instanceof Object)&&(Ni=new ht(Bt)),Ni.stream(Pt);(Ni=(()=>{var tn;return!!Fe.WORKERS_SUPPORTED&&(tn=(()=>{var Li=ue.URL||ue.webkitURL||null,Wi=de.toString();return Fe.BLOB_URL||(Fe.BLOB_URL=Li.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",Wi,")();"],{type:"text/javascript"})))})(),(tn=new ue.Worker(tn)).onmessage=Ai,tn.id=ke++,n[tn.id]=tn)})()).userStep=Bt.step,Ni.userChunk=Bt.chunk,Ni.userComplete=Bt.complete,Ni.userError=Bt.error,Bt.step=mn(Bt.step),Bt.chunk=mn(Bt.chunk),Bt.complete=mn(Bt.complete),Bt.error=mn(Bt.error),delete Bt.worker,Ni.postMessage({input:Pt,config:Bt,workerId:Ni.id})},Fe.unparse=function(Pt,Bt){var Ni=!1,tn=!0,Li=",",Wi=`\r
`,cr='"',Pr=cr+cr,si=!1,xi=null,Tn=!1,zn=((()=>{if(typeof Bt=="object"){if(typeof Bt.delimiter!="string"||Fe.BAD_DELIMITERS.filter(function(di){return Bt.delimiter.indexOf(di)!==-1}).length||(Li=Bt.delimiter),typeof Bt.quotes!="boolean"&&typeof Bt.quotes!="function"&&!Array.isArray(Bt.quotes)||(Ni=Bt.quotes),typeof Bt.skipEmptyLines!="boolean"&&typeof Bt.skipEmptyLines!="string"||(si=Bt.skipEmptyLines),typeof Bt.newline=="string"&&(Wi=Bt.newline),typeof Bt.quoteChar=="string"&&(cr=Bt.quoteChar),typeof Bt.header=="boolean"&&(tn=Bt.header),Array.isArray(Bt.columns)){if(Bt.columns.length===0)throw new Error("Option columns is empty");xi=Bt.columns}Bt.escapeChar!==void 0&&(Pr=Bt.escapeChar+cr),Bt.escapeFormulae instanceof RegExp?Tn=Bt.escapeFormulae:typeof Bt.escapeFormulae=="boolean"&&Bt.escapeFormulae&&(Tn=/^[=+\-@\t\r].*$/)}})(),new RegExp(qi(cr),"g"));if(typeof Pt=="string"&&(Pt=JSON.parse(Pt)),Array.isArray(Pt)){if(!Pt.length||Array.isArray(Pt[0]))return Er(null,Pt,si);if(typeof Pt[0]=="object")return Er(xi||Object.keys(Pt[0]),Pt,si)}else if(typeof Pt=="object")return typeof Pt.data=="string"&&(Pt.data=JSON.parse(Pt.data)),Array.isArray(Pt.data)&&(Pt.fields||(Pt.fields=Pt.meta&&Pt.meta.fields||xi),Pt.fields||(Pt.fields=Array.isArray(Pt.data[0])?Pt.fields:typeof Pt.data[0]=="object"?Object.keys(Pt.data[0]):[]),Array.isArray(Pt.data[0])||typeof Pt.data[0]=="object"||(Pt.data=[Pt.data])),Er(Pt.fields||[],Pt.data||[],si);throw new Error("Unable to serialize unrecognized input");function Er(di,mi,vn){var tr="",vr=(typeof di=="string"&&(di=JSON.parse(di)),typeof mi=="string"&&(mi=JSON.parse(mi)),Array.isArray(di)&&0<di.length),Gr=!Array.isArray(mi[0]);if(vr&&tn){for(var gr=0;gr<di.length;gr++)0<gr&&(tr+=Li),tr+=Et(di[gr],gr);0<mi.length&&(tr+=Wi)}for(var In=0;In<mi.length;In++){var Lr=(vr?di:mi[In]).length,br=!1,ma=vr?Object.keys(mi[In]).length===0:mi[In].length===0;if(vn&&!vr&&(br=vn==="greedy"?mi[In].join("").trim()==="":mi[In].length===1&&mi[In][0].length===0),vn==="greedy"&&vr){for(var Kr=[],oa=0;oa<Lr;oa++){var Ma=Gr?di[oa]:oa;Kr.push(mi[In][Ma])}br=Kr.join("").trim()===""}if(!br){for(var $t=0;$t<Lr;$t++){0<$t&&!ma&&(tr+=Li);var Va=vr&&Gr?di[$t]:$t;tr+=Et(mi[In][Va],$t)}In<mi.length-1&&(!vn||0<Lr&&!ma)&&(tr+=Wi)}}return tr}function Et(di,mi){var vn,tr;return di==null?"":di.constructor===Date?JSON.stringify(di).slice(1,25):(tr=!1,Tn&&typeof di=="string"&&Tn.test(di)&&(di="'"+di,tr=!0),vn=di.toString().replace(zn,Pr),(tr=tr||Ni===!0||typeof Ni=="function"&&Ni(di,mi)||Array.isArray(Ni)&&Ni[mi]||((vr,Gr)=>{for(var gr=0;gr<Gr.length;gr++)if(-1<vr.indexOf(Gr[gr]))return!0;return!1})(vn,Fe.BAD_DELIMITERS)||-1<vn.indexOf(Li)||vn.charAt(0)===" "||vn.charAt(vn.length-1)===" ")?cr+vn+cr:vn)}},Fe.RECORD_SEP="",Fe.UNIT_SEP="",Fe.BYTE_ORDER_MARK="\uFEFF",Fe.BAD_DELIMITERS=["\r",`
`,'"',Fe.BYTE_ORDER_MARK],Fe.WORKERS_SUPPORTED=!Ce&&!!ue.Worker,Fe.NODE_STREAM_INPUT=1,Fe.LocalChunkSize=10485760,Fe.RemoteChunkSize=5242880,Fe.DefaultDelimiter=",",Fe.Parser=on,Fe.ParserHandle=Vi,Fe.NetworkStreamer=it,Fe.FileStreamer=ht,Fe.StringStreamer=Ci,Fe.ReadableStreamStreamer=Ui,ue.jQuery&&((Ae=ue.jQuery).fn.parse=function(Pt){var Bt=Pt.config||{},Ni=[];return this.each(function(Wi){if(!(Ae(this).prop("tagName").toUpperCase()==="INPUT"&&Ae(this).attr("type").toLowerCase()==="file"&&ue.FileReader)||!this.files||this.files.length===0)return!0;for(var cr=0;cr<this.files.length;cr++)Ni.push({file:this.files[cr],inputElem:this,instanceConfig:Ae.extend({},Bt)})}),tn(),this;function tn(){if(Ni.length===0)mn(Pt.complete)&&Pt.complete();else{var Wi,cr,Pr,si,xi=Ni[0];if(mn(Pt.before)){var Tn=Pt.before(xi.file,xi.inputElem);if(typeof Tn=="object"){if(Tn.action==="abort")return Wi="AbortError",cr=xi.file,Pr=xi.inputElem,si=Tn.reason,void(mn(Pt.error)&&Pt.error({name:Wi},cr,Pr,si));if(Tn.action==="skip")return void Li();typeof Tn.config=="object"&&(xi.instanceConfig=Ae.extend(xi.instanceConfig,Tn.config))}else if(Tn==="skip")return void Li()}var zn=xi.instanceConfig.complete;xi.instanceConfig.complete=function(Er){mn(zn)&&zn(Er,xi.file,xi.inputElem),Li()},Fe.parse(xi.file,xi.instanceConfig)}}function Li(){Ni.splice(0,1),tn()}}),se&&(ue.onmessage=function(Pt){Pt=Pt.data,Fe.WORKER_ID===void 0&&Pt&&(Fe.WORKER_ID=Pt.workerId),typeof Pt.input=="string"?ue.postMessage({workerId:Fe.WORKER_ID,results:Fe.parse(Pt.input,Pt.config),finished:!0}):(ue.File&&Pt.input instanceof File||Pt.input instanceof Object)&&(Pt=Fe.parse(Pt.input,Pt.config))&&ue.postMessage({workerId:Fe.WORKER_ID,results:Pt,finished:!0})}),(it.prototype=Object.create(pt.prototype)).constructor=it,(ht.prototype=Object.create(pt.prototype)).constructor=ht,(Ci.prototype=Object.create(Ci.prototype)).constructor=Ci,(Ui.prototype=Object.create(pt.prototype)).constructor=Ui,Fe})})(Ky)),Ky.exports}var X4=W4();const Y4=iy(X4);async function K4(){const ce=await fetch("/mad-transit/stops.csv");if(!ce.ok)throw new Error(`Failed to load stops.csv: ${ce.status} ${ce.statusText}`);const de=await ce.text();return new Promise(ue=>{Y4.parse(de,{header:!0,dynamicTyping:!0,complete:Ae=>ue(Ae.data)})})}const xw="bt_smart_launch_rules";function xv(){try{const Z=localStorage.getItem(xw);if(!Z)return[];const ce=JSON.parse(Z);return Array.isArray(ce)?ce:[]}catch(Z){return console.error("Failed to load SmartLaunch rules",Z),[]}}function cv(Z){try{localStorage.setItem(xw,JSON.stringify(Z))}catch(ce){console.error("Failed to save SmartLaunch rules",ce)}}const Db={aaA:0,aaB:22.8,aaC:100,away_summary:"9 Stops | 4.3 mi",bearing:"89",bus_type:"New Flyer Xcelsior CHARGE NG",destination:"SUN PRAIRIE",dyn:0,eta_minutes:14,feet_away:22849,fleet_count:"62 buses in fleet",last_visited_stop:{pdist:12418,sequence:26,stop_id:"10026",stop_name:"Island Eastbound",stop_percent:13},last_visited_stop_percent:13,live_action:"Arriving",live_action_summary:"at Whitney-Mineral Point",next_visited_stop:{eta_minutes:"DUE",pdist:null,sequence:null,stop_id:"10030",stop_name:"Rosa",stop_percent:15.3},occupancy:"EMPTY",origtatripno:"1235713",passenger_count:1,percent_completed:23.3,percent_until:19.3,polyline:[{lat:43.060737,lon:-89.486267},{lat:43.060767,lon:-89.479559},{lat:43.060814,lon:-89.478823},{lat:43.060829,lon:-89.478595999999},{lat:43.060775,lon:-89.478211},{lat:43.0608,lon:-89.474511},{lat:43.060862,lon:-89.472543},{lat:43.060866999999,lon:-89.472363},{lat:43.06112,lon:-89.472087},{lat:43.062043,lon:-89.472282},{lat:43.062489,lon:-89.472302},{lat:43.062925,lon:-89.472208},{lat:43.063228,lon:-89.472066},{lat:43.064308,lon:-89.471247},{lat:43.064833,lon:-89.470735},{lat:43.066099,lon:-89.468991},{lat:43.066335,lon:-89.468727},{lat:43.066576,lon:-89.468542},{lat:43.066941,lon:-89.468374},{lat:43.067229,lon:-89.468314},{lat:43.067862,lon:-89.468388},{lat:43.067896000001,lon:-89.468393000002},{lat:43.068074,lon:-89.46836},{lat:43.071462,lon:-89.468327},{lat:43.071856,lon:-89.468261},{lat:43.072219,lon:-89.468096},{lat:43.073099,lon:-89.467467},{lat:43.073141,lon:-89.467437},{lat:43.07278,lon:-89.466198},{lat:43.072725,lon:-89.465864},{lat:43.072961,lon:-89.46383},{lat:43.072982999999,lon:-89.463643999998},{lat:43.073018,lon:-89.46298},{lat:43.072818,lon:-89.45965},{lat:43.072812,lon:-89.459204},{lat:43.073041,lon:-89.45692},{lat:43.073088,lon:-89.456666},{lat:43.073189,lon:-89.456692},{lat:43.073289000001,lon:-89.456719000001},{lat:43.07421,lon:-89.456768},{lat:43.075109,lon:-89.456807},{lat:43.075253,lon:-89.456813},{lat:43.075253,lon:-89.453218},{lat:43.075267,lon:-89.451503},{lat:43.075269000001,lon:-89.451410999998},{lat:43.075213,lon:-89.450821},{lat:43.075172,lon:-89.443916},{lat:43.075209,lon:-89.443429},{lat:43.075235,lon:-89.443262999999},{lat:43.07518,lon:-89.441349},{lat:43.07512,lon:-89.440615},{lat:43.074759,lon:-89.4388},{lat:43.074375,lon:-89.437222},{lat:43.073471,lon:-89.433936},{lat:43.073384,lon:-89.433493},{lat:43.073365000001,lon:-89.433349999998},{lat:43.073185,lon:-89.432831},{lat:43.073025,lon:-89.431941},{lat:43.072946,lon:-89.431211},{lat:43.072906,lon:-89.430137},{lat:43.072908,lon:-89.428759},{lat:43.072962,lon:-89.427665},{lat:43.073187,lon:-89.425166},{lat:43.073701,lon:-89.421634},{lat:43.073851,lon:-89.420431},{lat:43.07397,lon:-89.419137},{lat:43.074066,lon:-89.417354},{lat:43.074131,lon:-89.415235},{lat:43.074117,lon:-89.414695},{lat:43.074032,lon:-89.414025},{lat:43.073891,lon:-89.413472},{lat:43.073602,lon:-89.412991},{lat:43.073445,lon:-89.412693},{lat:43.073378,lon:-89.412445},{lat:43.073314,lon:-89.411327},{lat:43.07328,lon:-89.410608},{lat:43.073206,lon:-89.410219},{lat:43.072801,lon:-89.409019},{lat:43.072278,lon:-89.407373},{lat:43.072179,lon:-89.407167},{lat:43.072120000001,lon:-89.407043},{lat:43.072189,lon:-89.406675},{lat:43.072168,lon:-89.405844},{lat:43.072143,lon:-89.404165},{lat:43.072117,lon:-89.402609},{lat:43.072088,lon:-89.400831},{lat:43.072062,lon:-89.399068},{lat:43.071994,lon:-89.39884},{lat:43.071948999999,lon:-89.398685999999}],predicted_time:"20260119 23:28",route:"D",speed_kph:57.8,speed_mph:35.9,speed_mps:16.06,stop_percent:42.6,stops_away:9,stops_between:["10030","10034","10038","10042","10046","10050","10054","10058","10062","10070"],stops_between_enriched:[{aaT:390.8,lat:43.060829,lon:-89.478595999999,stop_id:"10030",stop_name:"Rosa",stop_name_short:"Rosa",stop_percent:15.3},{aaT:397.6,lat:43.060866999999,lon:-89.472363,stop_id:"10034",stop_name:"Whitney-Mineral Point",stop_name_short:"Whitney-...",stop_percent:17},{aaT:410,lat:43.067896000001,lon:-89.468393000002,stop_id:"10038",stop_name:"Regent-Whitney",stop_name_short:"Regent-W...",stop_percent:20.1},{aaT:22.8,lat:43.072982999999,lon:-89.463643999998,stop_id:"10042",stop_name:"Eau Claire",stop_name_short:"Eau Clai...",stop_percent:23.3},{aaT:30.8,lat:43.073289000001,lon:-89.456719000001,stop_id:"10046",stop_name:"Segoe",stop_name_short:"Segoe",stop_percent:25.3},{aaT:39.6,lat:43.075269000001,lon:-89.451410999998,stop_id:"10050",stop_name:"Midvale",stop_name_short:"Midvale",stop_percent:27.5},{aaT:48.8,lat:43.075235,lon:-89.443262999999,stop_id:"10054",stop_name:"Shorewood",stop_name_short:"Shorewoo...",stop_percent:29.8},{aaT:60.4,lat:43.073365000001,lon:-89.433349999998,stop_id:"10058",stop_name:"University Bay",stop_name_short:"Universi...",stop_percent:32.7},{aaT:90.4,lat:43.072120000001,lon:-89.407043,stop_id:"10062",stop_name:"Orchard",stop_name_short:"Orchard",stop_percent:40.2},{aaT:100,lat:43.071948999999,lon:-89.398685999999,stop_id:"10070",stop_name:"East Campus",stop_name_short:"East Cam...",stop_percent:42.6}],stpid:"10070",stsd:"2026-01-19",stst:82920,success:!0,tablockid:"521A",tatripid:"1235713",timeline:"0-22.799999999999997-100",trip_uid:"A|1235713|1235713|2026-01-19|82920|521A|10070|1-SUN PRAIRIE",updated:"11:13 PM",vehicle_id:"2336",vehicle_lat:"43.06075148869715",vehicle_lon:"-89.48303738641405",waypoints:[{lat:43.0607514886972,lon:-89.4830373864141},{lat:43.060829,lon:-89.478596},{lat:43.060867,lon:-89.472363},{lat:43.067896,lon:-89.468393},{lat:43.072983,lon:-89.463644},{lat:43.073289,lon:-89.456719},{lat:43.075269,lon:-89.451411},{lat:43.075235,lon:-89.443263},{lat:43.073365,lon:-89.43335},{lat:43.07212,lon:-89.407043},{lat:43.071949,lon:-89.398686}]},J4={A:"#FF0000",A1:"#FF0000",A2:"#FF0000",B:"#84BC00",F:"#2272B5",80:"#FF7300",81:"#00B7C8",82:"#BC009D",84:"#C1C800",D:"#333366",D1:"#333366",D2:"#333366",C:"#333366",C1:"#333366",C2:"#333366",E:"#2272B5",G:"#2272B5",H:"#2272B5",J:"#2272B5",W:"#2272B5",28:"#2272B5",38:"#2272B5",L:"#46AAD1",O:"#46AAD1",P:"#46AAD1",R:"#46AAD1",R1:"#46AAD1",R2:"#46AAD1",S:"#46AAD1",55:"#46AAD1",60:"#46AAD1",65:"#46AAD1"},Q4={A:"#FF5D60",A1:"#FF5D60",A2:"#FF5D60",B:"#AFD766",F:"#1785E1",80:"#FF8D30",81:"#FF8D30",82:"#FF8D30",84:"#FF8D30",D:"#4F558F",D1:"#4F558F",D2:"#4F558F",C:"#4F558F",C1:"#4F558F",C2:"#4F558F",E:"#1785E1",G:"#1785E1",H:"#1785E1",J:"#1785E1",W:"#1785E1",28:"#1785E1",38:"#1785E1",L:"#69CFF6",O:"#69CFF6",P:"#69CFF6",R:"#69CFF6",R1:"#69CFF6",R2:"#69CFF6",S:"#69CFF6",55:"#69CFF6",60:"#69CFF6",65:"#69CFF6"};function eE(Z){return Z==="EMPTY"?"Empty":Z==="HALF_EMPTY"?"Half-Full":Z==="FULL"?"Crowded":""}function tE(Z,ce,de,ue){const Ce=pt=>pt*Math.PI/180,se=Ce(de-Z),n=Ce(ue-ce),ke=Math.sin(se/2)*Math.sin(se/2)+Math.cos(Ce(Z))*Math.cos(Ce(de))*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(ke),Math.sqrt(1-ke)))}function A_(Z){return J4[Z]||"#000000"}function mg(Z){return Q4[Z]||"#000000"}function iE(Z){if(!Z)return"";const[,ce]=Z.split(" ");if(!ce)return"";const[de,ue]=ce.split(":"),Ae=new Date;return Ae.setHours(Number(de),Number(ue),0,0),Ae.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function nE(Z){if(Z.dyn===4)return"Drop offs only";if(Z.stops_away!=null){const ce=Z.stops_away;return`${ce} stop${ce===1?"":"s"} away`}if(Array.isArray(Z.stops_between)&&Z.stops_between.length>0){const ce=Z.stops_between.length;return`${ce} stop${ce===1?"":"s"} away`}return Z.stops_away===0?"Approaching Stop":Z.eta_minutes<=1?"At Stop":Z.stops_away===null?"En Route":"Many Stops Away"}function rE(Z){return Z==="N/A"?5:Z==="EMPTY"?1:Z==="HALF_EMPTY"?3:Z==="FULL"?5:0}function aE(Z){return Z==="N/A"?"Unknown occupancy":Z==="EMPTY"?"Empty":Z==="HALF_EMPTY"?"Half full":Z==="FULL"?"Full":"Unknown occupancy"}function sE({vehicle:Z,navigate:ce}){iE(Z.predicted_time),nE(Z);const de=rE(Z.occupancy||""),ue=aE(Z.occupancy||""),Ae=eE(Z.occupancy||"");return he.jsxs(he.Fragment,{children:[he.jsxs("div",{className:"live-action-card",children:[he.jsx("div",{className:"live-action-map",children:Z.live_action}),he.jsx("div",{className:"live-action-summary-map",children:Z.live_action_summary})]}),he.jsxs("article",{className:"map-bus-card","aria-label":`Route ${Z.route} to ${Z.destination}, arriving in ${Z.eta_minutes} minutes`,children:[he.jsx("div",{className:"bus-card-route-map",style:{backgroundColor:A_(Z.route)},"aria-label":`Route ${Z.route}`,children:Z.route}),he.jsxs("div",{className:"map-bus-card-main",children:[he.jsxs("div",{className:"map-bus-card-left",children:[he.jsxs("div",{className:"bus-card-top",children:[he.jsx("div",{className:"bus-card-destination-map",children:Z.destination}),he.jsxs("div",{className:"map-bus-card-times",children:[he.jsx("div",{className:"map-bus-card-eta","aria-label":`Estimated time: ${Z.eta_minutes} minutes`,children:Z.eta_minutes!=null?`${Z.eta_minutes}`:"--"}),he.jsx("div",{className:"bus-card-eta","aria-label":`Estimated time: ${Z.eta_minutes} minutes`,children:Z.eta_minutes!=null?" min":"--"}),he.jsx("div",{className:"network-icon"})]})]}),he.jsxs("div",{className:"bus-card-bottom",children:[he.jsx("div",{className:"map-bus-card-stops-away",children:Z.away_summary}),he.jsxs("div",{className:"bus-card-occupancy",children:[Ae&&he.jsx("span",{className:"bus-card-occ-text-map",children:Ae}),he.jsx("div",{className:"bus-card-dots","aria-label":ue,children:Array.from({length:5}).map((Ce,se)=>he.jsx("span",{className:"occ-person"+(se<de?" occ-person-filled-map":" occ-person-empty"),"aria-hidden":"true"},se))})]})]})]}),he.jsx("div",{className:"map-bus-card-right",children:he.jsx("button",{type:"button",className:"map-cancel-back-btn",onClick:()=>ce(-1),"aria-label":"Go back to previous page"})})]})]})]})}function oE(Z,ce,de,ue,Ae,Ce=64){const se=[],ke=de/111320,Fe=de/(111320*Math.cos(Z*Math.PI/180));for(let pt=0;pt<=Ce;pt++){const it=pt/Ce*2*Math.PI,ht=Math.cos(it),Ci=Math.sin(it),Ui=Z+Ci*ke,Vi=ce+ht*Fe;se.push([Vi,Ui])}return{type:"Feature",geometry:{type:"Polygon",coordinates:[se]},properties:{id:ue,stopId:Ae}}}function $y(){Tt.useEffect(()=>(document.body.classList.add("map-bg"),window.scrollTo(0,0),()=>document.body.classList.remove("map-bg")),[]);const{routeId:Z,stopId:ce,vehicleId:de,all:ue}=Xb(),[Ae]=nw(),Ce=$_(),se=Ae.get("selectMode")==="true",n=Ae.get("returnTo"),ke=Ae.get("existingStops"),Fe=!!Z&&!de,pt=!!ce&&!!de,it=ue==="all",[ht,Ci]=Tt.useState([]),[Ui,Vi]=Tt.useState(!0),[qi,on]=Tt.useState(null),[Ai,an]=Tt.useState(!1),[Un,rr]=Tt.useState(null),[ln,mn]=Tt.useState(null),[Pt,Bt]=Tt.useState(!1),[Ni,tn]=Tt.useState(null),[Li,Wi]=Tt.useState(5),[cr,Pr]=Tt.useState(null),[si,xi]=Tt.useState(!1),[Tn,zn]=Tt.useState(null),[Er,Et]=Tt.useState([]),[di,mi]=Tt.useState(null),[vn,tr]=Tt.useState(!1),[vr,Gr]=Tt.useState(null),[gr,In]=Tt.useState(!1),[Lr,br]=Tt.useState(null),[ma,Kr]=Tt.useState(!1),oa=Tt.useRef(null),Ma=Tt.useRef(!1),$t=new Date;$t.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),$t.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),Tt.useEffect(()=>{K4().then(Ci).catch(Qt=>{console.error("Failed to load stops",Qt),Ci([])})},[]),Tt.useEffect(()=>{Et(xv())},[]),Tt.useEffect(()=>{if(!Fe){on(null),rr(null),an(!1);return}an(!0),rr(null),fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/routes/${Z}`).then(Qt=>{if(!Qt.ok)throw new Error(`Failed to load route ${Z}`);return Qt.json()}).then(Qt=>{on(Qt)}).catch(Qt=>{console.error(Qt),rr(Qt.message||"Error loading route")}).finally(()=>{an(!1)})},[Fe,Z]),Tt.useEffect(()=>{if(!pt){mn(null),tn(null),Bt(!1);return}const Qt=()=>{if(Bt(!0),tn(null),Ae.get("mockTrack")==="true"){setTimeout(()=>{mn({...Db,vehicle_id:de??Db.vehicle_id}),Bt(!1),Wi(5)},250);return}fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/track/${de}/${ce}`).then(Ha=>{if(!Ha.ok)throw new Error("Failed to load tracking info");return Ha.json()}).then(Ha=>{if(!Ha.success)throw new Error("Bus tracking data unavailable");if(Ha.vehicles&&Ha.vehicles.length>0)mn(Ha.vehicles[0]);else throw new Error("No vehicle data available");Wi(5)}).catch(Ha=>{console.error(Ha),tn(Ha.message||"Error loading tracking data")}).finally(()=>{Bt(!1)})};Qt();const Gn=setInterval(Qt,5e3);return()=>clearInterval(Gn)},[pt,ce,de,Ae]),Tt.useEffect(()=>{if(!it||!ce){Pr(null),zn(null),xi(!1);return}const Qt=()=>{xi(!0),zn(null),fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/track/all/${ce}`).then(Ta=>{if(!Ta.ok)throw new Error("Failed to load all buses");return Ta.json()}).then(Ta=>{if(!Ta.success)throw new Error("All buses data unavailable");Pr(Ta.vehicles||[])}).catch(Ta=>{console.error(Ta),zn(Ta.message||"Error loading all buses")}).finally(()=>{xi(!1)})};Qt();const Gn=setInterval(Qt,5e3);return()=>clearInterval(Gn)},[it,ce]),Tt.useEffect(()=>{if(!pt)return;const Qt=setInterval(()=>{Wi(Gn=>Gn<=1?5:Gn-1)},1e3);return()=>clearInterval(Qt)},[pt]);const Va=()=>{if(!navigator.geolocation){br("Geolocation is not supported.");return}In(!0),br(null),navigator.geolocation.getCurrentPosition(Qt=>{const{latitude:Gn,longitude:Ta}=Qt.coords;Gr({latitude:Gn,longitude:Ta}),In(!1),oa.current&&oa.current.flyTo({center:[Ta,Gn],zoom:16,essential:!0})},Qt=>{In(!1),br(Qt.message)})},Ir=()=>{Kr(!ma)},Ar=Tt.useMemo(()=>!ln||!ln.polyline?null:{type:"Feature",geometry:{type:"LineString",coordinates:ln.polyline.map(Gn=>[Number(Gn.lon),Number(Gn.lat)])},properties:{}},[ln]),la=Tt.useMemo(()=>!ln||!ln.remaining_route_polyline?null:{type:"Feature",geometry:{type:"LineString",coordinates:ln.remaining_route_polyline.map(Gn=>[Number(Gn.lon),Number(Gn.lat)])},properties:{}},[ln]),Po=Tt.useMemo(()=>!ln||!ln.stops_between_enriched?null:{type:"FeatureCollection",features:ln.stops_between_enriched.filter(Gn=>Gn.lat&&Gn.lon).map(Gn=>({type:"Feature",geometry:{type:"Point",coordinates:[Number(Gn.lon),Number(Gn.lat)]},properties:{stop_id:Gn.stop_id,stop_name:Gn.stop_name}}))},[ln]),Qs=Tt.useMemo(()=>{if(!it||!cr||!ln)return[];const Qt=cr.filter(Gn=>Gn.vehicle_id!==ln.vehicle_id).sort((Gn,Ta)=>{const Ha=Gn.eta_minutes??1/0;return(Ta.eta_minutes??1/0)-Ha});return Qt.map((Gn,Ta)=>!Gn.polyline||Gn.polyline.length===0?null:{geojson:{type:"Feature",geometry:{type:"LineString",coordinates:Gn.polyline.map(ms=>[Number(ms.lon),Number(ms.lat)])},properties:{vehicle_id:Gn.vehicle_id,route:Gn.route,eta_minutes:Gn.eta_minutes}},route:Gn.route,zIndex:Qt.length-Ta}).filter(Boolean)},[it,cr,ln]),Io=Tt.useMemo(()=>!it||!cr||!ln?[]:cr.filter(Qt=>Qt.vehicle_id!==ln.vehicle_id).filter(Qt=>Qt.polyline&&Qt.polyline.length>0).map(Qt=>{const Gn=Qt.polyline[0];return{vehicle_id:Qt.vehicle_id,route:Qt.route,longitude:Number(Gn.lon),latitude:Number(Gn.lat),bearing:Qt.bearing?Number(Qt.bearing):0}}),[it,cr,ln]),Mr=Tt.useMemo(()=>{if(!ln||!ln.polyline||ln.polyline.length===0)return null;const Qt=ln.polyline[0];return{longitude:Number(Qt.lon),latitude:Number(Qt.lat),bearing:ln.bearing?Number(ln.bearing):0}},[ln]);Tt.useEffect(()=>{ma&&Mr&&oa.current&&(Ma.current=!0,oa.current.flyTo({center:[Mr.longitude,Mr.latitude],zoom:16,essential:!0,duration:1e3}))},[ma,Mr]),Tt.useEffect(()=>{if(!vn||!oa.current)return;const Qt=oa.current,Gn=35,Ta=Ha=>{if(!ma||!Mr)return;if(Ma.current){Ma.current=!1;return}if(!Ha||!Ha.originalEvent)return;const ms=Qt.getCenter();tE(ms.lat,ms.lng,Mr.latitude,Mr.longitude)>Gn&&Kr(!1)};return Qt.on("moveend",Ta),()=>{Qt.off("moveend",Ta)}},[vn,ma,Mr]);const ws=Tt.useMemo(()=>{const Qt=Er.filter(Gn=>Gn.enabled!==!1);return Qt.length===0?null:{type:"FeatureCollection",features:Qt.map(Gn=>oE(Gn.center.lat,Gn.center.lon,Gn.radiusMeters,Gn.id,Gn.stopId))}},[Er]),Ds=Tt.useCallback(Qt=>{if(!se||!n){Ce(`/stop/${Qt}`);return}const Gn=ke?ke.split(","):[];if(Gn.includes(Qt)){alert(`Stop ${Qt} is already added to your group!`);return}Gn.push(Qt);const[Ta]=n.split("?"),[Ha,...ms]=Gn,xn=ms.length>0?`?stops=${ms.join(",")}`:"";Ce(`${Ta}${xn}`)},[se,n,ke,Ce]),Ps=Tt.useMemo(()=>Ui?he.jsx(B4,{stops:ht,onStopClick:Ds,selectMode:se}):null,[ht,Ui,se,Ds]);return he.jsx("main",{className:"home-root",children:he.jsxs("div",{className:"home-phone-map",children:[he.jsxs("header",{className:"map-header",children:[he.jsxs("div",{className:"map-header-top",children:[he.jsxs("div",{className:"map-search-box",children:[he.jsx("div",{className:"new-stop-logo",children:he.jsx("div",{className:"new-stop-logo-circle","aria-hidden":"true"})}),he.jsx("button",{className:"new-stop-search",onClick:()=>Ce("/chat"),"aria-label":"Search with BusterChat",children:he.jsx("span",{className:"map-search-text",children:'"Whats the fastest route to..."'})})]}),he.jsxs("div",{className:"map-header-top-left",children:[he.jsx("button",{className:"map-notif-btn","aria-label":"Notifications",children:he.jsx("span",{className:"new-stop-notif-badge",children:"2"})}),he.jsx("button",{className:"map-menu-btn","aria-label":"Menu"})]})]}),he.jsxs("nav",{className:"map-nav","aria-label":"Primary navigation",children:[he.jsx("button",{className:"map-nav-btn",onClick:()=>Ce("/"),children:"Home"}),he.jsx("div",{className:"divider"}),he.jsx("button",{className:"map-nav-btn",onClick:()=>Ce("/recent"),children:"Recent"}),he.jsx("div",{className:"map-divider"}),he.jsx("button",{className:"map-nav-btn",onClick:()=>Ce("/map"),children:"Map"}),he.jsx("div",{className:"map-divider"}),he.jsx("button",{className:"map-nav-btn",onClick:()=>Ce("/help"),children:"Help"})]})]}),se&&he.jsx("div",{className:"map-overlay map-select-mode",role:"alert","aria-live":"polite",children:he.jsxs("div",{className:"map-select-banner",children:[he.jsx("span",{children:" Select a stop to add to your group"}),he.jsx("button",{onClick:()=>Ce(n),className:"map-select-cancel","aria-label":"Cancel stop selection",children:"Cancel"})]})}),Fe&&Ai&&he.jsxs("div",{className:"map-overlay",role:"status","aria-live":"polite",children:["Loading route ",Z,""]}),Fe&&Un&&he.jsx("div",{className:"map-overlay map-overlay-error",role:"alert","aria-live":"assertive",children:Un}),pt&&Pt&&he.jsxs("div",{className:"map-overlay",role:"status","aria-live":"polite",children:["Tracking bus ",de," from stop ",ce,""]}),pt&&Ni&&he.jsx("div",{className:"map-overlay map-overlay-error",role:"alert","aria-live":"assertive",children:Ni}),he.jsxs("section",{className:"map-page-main","aria-labelledby":"map-title",children:[he.jsx("h1",{id:"map-title",className:"visually-hidden",children:pt?`Tracking bus ${de} from stop ${ce}`:Fe?`Route ${Z} map view`:se?"Select a stop to add to group":"Transit map view"}),he.jsxs("div",{className:"map-page-map-wrapper",children:[he.jsx(hw,{mapRef:oa,onLoad:()=>tr(!0),onMapClick:Qt=>{if(!Qt?.lngLat)return;const{lat:Gn,lng:Ta}=Qt.lngLat;mi({lat:Gn,lon:Ta})},"aria-label":"Interactive transit map showing bus stops and routes",children:vn&&he.jsxs(he.Fragment,{children:[Ps,vr&&he.jsx(ov,{longitude:vr.longitude,latitude:vr.latitude,anchor:"bottom",children:he.jsx("div",{style:{width:14,height:14,borderRadius:"50%",background:"#3b82f6",border:"2px solid #fff"}})}),Fe&&qi&&he.jsx($4,{routeData:qi}),Fe&&Z&&he.jsx(H4,{routeId:Z}),it&&Qs.length>0&&he.jsx(he.Fragment,{children:Qs.map((Qt,Gn)=>he.jsx(pg,{id:`all-bus-line-${Qt.geojson.properties.vehicle_id}`,type:"geojson",data:Qt.geojson,children:he.jsx(um,{id:`all-bus-line-layer-${Qt.geojson.properties.vehicle_id}`,type:"line",paint:{"line-color":A_(Qt.route),"line-width":9,"line-opacity":.9,"line-emissive-strength":.8,"line-border-color":mg(Qt.route),"line-border-width":2}})},`all-bus-${Qt.geojson.properties.vehicle_id}`))}),pt&&la&&he.jsx(pg,{id:"remaining-route-line",type:"geojson",data:la,children:he.jsx(um,{id:"remaining-route-line-layer",type:"line",paint:{"line-color":ln?.route?A_(ln.route):"#ff0000","line-width":8,"line-opacity":.8,"line-emissive-strength":.8,"line-border-color":ln?.route?mg(ln.route):"#ff0000","line-border-width":2}})}),pt&&Ar&&he.jsx(pg,{id:"tracked-bus-line",type:"geojson",data:Ar,children:he.jsx(um,{id:"tracked-bus-line-layer",type:"line",paint:{"line-color":ln?.route?A_(ln.route):"#ff0000","line-width":14,"line-emissive-strength":1,"line-border-color":ln?.route?mg(ln.route):"#ff0000","line-border-width":2}})}),pt&&ln?.remaining_route_polyline&&he.jsxs(pg,{id:"remaining-route-stops",type:"geojson",data:{type:"FeatureCollection",features:ln.remaining_route_polyline.filter(Qt=>Qt.type==="S"&&Qt.lat&&Qt.lon).map(Qt=>({type:"Feature",geometry:{type:"Point",coordinates:[Number(Qt.lon),Number(Qt.lat)]},properties:{stop_id:Qt.stpid,stop_name:Qt.stpnm}}))},children:[he.jsx(um,{id:"remaining-route-stops-outer",type:"circle"}),he.jsx(um,{id:"remaining-route-stops-inner",type:"circle",paint:{"circle-radius":4,"circle-color":"#ffffff","circle-opacity":1,"circle-stroke-width":2,"circle-stroke-color":ln?.route?A_(ln.route):"#ff0000","circle-stroke-opacity":1,"circle-emissive-strength":.9}}),he.jsx(um,{id:"remaining-route-stops-labels",type:"symbol",layout:{"text-field":["get","stop_name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":11,"text-offset":[0,1.5],"text-anchor":"top","text-allow-overlap":!1,"text-ignore-placement":!1,"symbol-avoid-edges":!0},paint:{"text-color":"#ffffff","text-opacity":["interpolate",["linear"],["zoom"],12,0,14,1],"text-halo-color":"#000000","text-halo-width":.7,"text-halo-blur":2}})]}),pt&&Po&&he.jsxs(pg,{id:"intermediate-stops",type:"geojson",data:Po,children:[he.jsx(um,{id:"intermediate-stops-outer",type:"circle",paint:{"circle-radius":13,"circle-color":ln?.route?mg(ln.route):"#ff0000","circle-emissive-strength":1}}),he.jsx(um,{id:"intermediate-stops-inner",type:"circle",paint:{"circle-radius":8,"circle-color":"#ffffff","circle-stroke-width":4,"circle-stroke-color":ln?.route?A_(ln.route):"#ff0000","circle-emissive-strength":1}}),he.jsx(um,{id:"intermediate-stops-labels",type:"symbol",layout:{"text-field":["get","stop_name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-size":11,"text-offset":[0,1.5],"text-anchor":"top","text-allow-overlap":!1,"text-ignore-placement":!1,"symbol-avoid-edges":!0},paint:{"text-color":"#ffffff","text-halo-color":"#000000","text-halo-width":.7,"text-halo-blur":2,"text-opacity":["interpolate",["linear"],["zoom"],12,0,14,1]}})]}),pt&&Mr&&he.jsx(ov,{longitude:Mr.longitude,latitude:Mr.latitude,children:he.jsx("div",{className:"map-bus-icon",alt:`Bus ${de} current location`,style:{backgroundColor:A_(ln.route),outlineColor:mg(ln.route)},children:he.jsx("div",{className:"network-icon-bus"})})}),it&&Io.map(Qt=>he.jsx(ov,{longitude:Qt.longitude,latitude:Qt.latitude,children:he.jsx("div",{className:"map-bus-icon",alt:`Bus ${Qt.vehicle_id} current location`,style:{backgroundColor:A_(Qt.route),outlineColor:mg(Qt.route)},children:he.jsx("div",{className:"network-icon-bus"})})},`bus-marker-${Qt.vehicle_id}`)),ws&&he.jsxs(pg,{id:"smartlaunch-circles",type:"geojson",data:ws,children:[he.jsx(um,{id:"smartlaunch-fill",type:"fill",paint:{"fill-color":"#0000ff","fill-opacity":.12}}),he.jsx(um,{id:"smartlaunch-outline",type:"line",paint:{"line-color":"#0000ff","line-width":2}})]})]})}),he.jsx("button",{type:"button",className:"map-page-back-btn",onClick:()=>Ce(-1),"aria-label":"Go back to previous page"}),he.jsxs("div",{className:"map-button-menu",children:[he.jsx("div",{type:"button",className:"map-page-toggle-stops-btn",onClick:()=>Vi(!Ui),"aria-label":Ui?"Hide bus stops":"Show bus stops","aria-pressed":Ui}),he.jsx("div",{className:"horizontal-divider"}),he.jsx("div",{className:"location-button",onClick:Va})]}),pt&&Mr&&he.jsx("div",{children:he.jsx("button",{className:`center-bus-button ${ma?"active":""}`,onClick:Ir,"aria-label":ma?"Stop following bus":"Follow bus","aria-pressed":ma})}),pt&&he.jsxs("div",{className:"map-countdown-timer",role:"status","aria-live":"polite","aria-label":`Refreshing in ${Li} seconds`,children:[he.jsxs("svg",{className:"countdown-ring",width:"44",height:"44",children:[he.jsx("circle",{className:"countdown-ring-circle-bg",cx:"22",cy:"22",r:"18"}),he.jsx("circle",{className:"countdown-ring-circle",cx:"22",cy:"22",r:"18",style:{strokeDashoffset:`${138.23*(1-Li/5)}`}})]}),he.jsx("span",{className:"countdown-number",children:Li})]})]}),pt&&ln&&he.jsxs("section",{className:"map-track-card","aria-labelledby":"tracking-title",children:[he.jsx("h2",{id:"tracking-title",className:"visually-hidden",children:"Currently Tracking Bus"}),he.jsx(sE,{vehicle:ln,navigate:Ce})]})]})]})})}const lE={A:"#FF0000",A1:"#FF0000",A2:"#FF0000",B:"#84BC00",F:"#2272B5",80:"#FF7300",81:"#00B7C8",82:"#BC009D",84:"#C1C800",D:"#333366",D1:"#333366",D2:"#333366",C:"#333366",C1:"#333366",C2:"#333366",E:"#2272B5",G:"#2272B5",H:"#2272B5",J:"#2272B5",W:"#2272B5",28:"#2272B5",38:"#2272B5",L:"#46AAD1",O:"#46AAD1",P:"#46AAD1",R:"#46AAD1",R1:"#46AAD1",R2:"#46AAD1",S:"#46AAD1",55:"#46AAD1",60:"#46AAD1",65:"#46AAD1"};function ey(Z){return lE[Z]||"#000000"}function cE(Z){if(!Z)return"";const[,ce]=Z.split(" ");if(!ce)return"";const[de,ue]=ce.split(":"),Ae=new Date;return Ae.setHours(Number(de),Number(ue),0,0),Ae.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function uE(Z){if(Z.dyn===4)return{text:"Drop offs only",hasNumber:!1};if(Z.stops_away!=null){const ce=Z.stops_away;return{text:`stop${ce===1?"":"s"} away`,number:ce,hasNumber:!0}}if(Array.isArray(Z.stops_between)&&Z.stops_between.length>0){const ce=Z.stops_between.length;return{text:`${ce} stop${ce===1?"":"s"} away`,number:ce,hasNumber:!0}}return Z.stops_away===0?{text:"Approaching Stop",hasNumber:!1}:Z.eta_minutes<=1?{text:"At Stop",hasNumber:!1}:Z.stops_away===null?{text:"En Route",hasNumber:!1}:{text:"Many Stops Away",hasNumber:!1}}function hE(Z){return Z==="N/A"?5:Z==="EMPTY"?1:Z==="HALF_EMPTY"?3:Z==="FULL"?5:0}function dE(Z){return Z==="N/A"?"Unknown occupancy":Z==="EMPTY"?"Empty":Z==="HALF_EMPTY"?"Half full":Z==="FULL"?"Full":"Unknown occupancy"}function fE(Z){return Z==="EMPTY"?"Near Empty":Z==="HALF_EMPTY"?"Half-Full":Z==="FULL"?"Crowded":""}function uv(Z){const ce=Number(Z);return Number.isFinite(ce)?Math.max(0,Math.min(100,ce)):0}function pE(Z,ce=8){return!Z||Z.length<=ce?Z:Z.substring(0,ce-3)+"..."}function mE({pred:Z,stopName:ce,stopId:de,countdown:ue,refreshSeconds:Ae}){const[Ce,se]=Tt.useState(!1),n=$_(),[ke,Fe]=Tt.useState(()=>uv(Z.aaB));cE(Z.predicted_time),uE(Z);const pt=hE(Z.occupancy||""),it=dE(Z.occupancy||""),ht=fE(Z.occupancy||""),Ci=Z.stops_between_enriched||[];Tt.useEffect(()=>{Fe(uv(Z.aaB))},[Z.aaB]);const Ui=()=>{Z.vehicle_id&&de&&n(`/map/${de}/${Z.vehicle_id}`)},qi=113.1*(1-ue/Ae);return he.jsx("article",{className:`bus-card ${Ce?"bus-card-expanded":""}`,"aria-label":`Route ${Z.route} to ${Z.destination}, arriving in ${Z.eta_minutes} minutes${ce?` at ${ce}`:""}`,children:he.jsxs("div",{className:"bus-card-main",children:[he.jsxs("div",{className:"bus-card-row",children:[he.jsx("div",{className:"bus-card-route",style:{backgroundColor:ey(Z.route)},"aria-label":`Route ${Z.route}`,children:Z.route}),he.jsxs("div",{className:"bus-card-left",children:[he.jsxs("div",{className:"bus-card-top",children:[he.jsx("div",{className:"bus-card-destination",children:Z.destination}),he.jsx("div",{className:"bus-card-times",children:he.jsxs("div",{className:"map-bus-card-times",children:[he.jsx("div",{className:"min-bus-card-eta","aria-label":`Estimated time: ${Z.eta_minutes} minutes`,children:Z.eta_minutes!=null?`${Z.eta_minutes}`:"--"}),he.jsx("div",{className:"bus-card-eta","aria-label":`Estimated time: ${Z.eta_minutes} minutes`,children:Z.eta_minutes!=null?" min":"--"}),he.jsx("div",{className:"network-icon-black"})]})})]}),he.jsxs("div",{className:"bus-card-bottom",children:[he.jsx("div",{className:"bus-card-stops-away",children:Z.away_summary}),he.jsxs("div",{className:"bus-card-occupancy",children:[ht&&he.jsx("span",{className:"bus-card-occ-text",children:ht}),he.jsx("div",{className:"bus-card-dots","aria-label":it,children:Array.from({length:5}).map((on,Ai)=>he.jsx("span",{className:"occ-person"+(Ai<pt?" occ-person-filled":" occ-person-empty"),"aria-hidden":"true"},Ai))})]})]})]}),he.jsx("div",{className:"bus-card-right",children:he.jsx("button",{className:"bus-card-collapse",type:"button",onClick:()=>se(!Ce),"aria-label":Ce?"Collapse bus details":"Expand bus details","aria-expanded":Ce,children:he.jsx("svg",{className:`collapse-chevron ${Ce?"collapse-chevron-up":""}`,width:"42",height:"42",viewBox:"0 0 0 0",fill:"none","aria-hidden":"true"})})})]}),Ce&&he.jsxs("div",{className:"bus-card-expanded-content",children:[he.jsxs("div",{className:"bus-card-expanded-quick-actions",children:[he.jsxs("div",{className:"bus-card-expanded-quick-actions-left",children:[he.jsxs("div",{className:"card-countdown-timer",role:"status","aria-live":"polite","aria-label":`Refreshing in ${ue} seconds`,children:[he.jsxs("svg",{className:"card-countdown-ring",width:"34",height:"34",children:[he.jsx("circle",{className:"card-countdown-ring-circle-bg",cx:"17",cy:"16",r:"16"}),he.jsx("circle",{className:"card-countdown-ring-circle",cx:"17",cy:"16",r:"15",style:{strokeDashoffset:`${qi}`}})]}),he.jsx("span",{className:"card-countdown-number",children:ue})]}),he.jsx("div",{className:"quick-actions-alerts",children:"Arrival Alerts"})]}),he.jsx("div",{className:"bus-card-expanded-quick-actions-right",children:he.jsxs("div",{className:"quick-actions-location",onClick:Ui,children:[he.jsx("div",{className:"location-btn-arrow"}),he.jsx("div",{children:Z.vehicle_id&&he.jsx("div",{className:"bus-card-view-location-btn","aria-label":`View bus ${Z.vehicle_id} location on map`,children:"View Location"})})]})})]}),he.jsxs("div",{className:"bus-card-expanded-quick-info",children:[he.jsx("div",{className:"bus-card-expanded-quick-info-left",children:"Route Timeline"}),he.jsx("div",{className:"bus-card-expanded-quick-info-right",children:"*Timeline will re-scale as bus nears stop"})]}),he.jsxs("div",{className:"bus-timeline",children:[he.jsxs("div",{className:"bus-timeline-top",children:[he.jsxs("div",{className:"bus-timeline-top-left",children:[he.jsx("div",{className:"arrow-icon"}),he.jsx("div",{className:"live-action",children:Z.live_action}),he.jsx("div",{className:"live-action-summary",children:Z.live_action_summary})]}),he.jsxs("div",{className:"bus-timeline-top-right",children:[Z.stops_away," stops away"]})]}),he.jsx("div",{className:"bus-timeline-bottom",children:he.jsxs("div",{className:"bus-timeline-bottom-content",children:[he.jsxs("div",{className:"bus-timeline-track",children:[he.jsx("div",{className:"bus-timeline-marker bus-timeline-marker-start",children:he.jsx("div",{className:"bus-timeline-marker-dot"})}),he.jsxs("div",{className:"bus-timeline-progress-container",children:[he.jsx("div",{className:"bus-timeline-progress-bar",children:he.jsx("div",{className:"bus-timeline-progress-fill",style:{width:`${ke}%`,backgroundColor:ey(Z.route)}})}),he.jsx("div",{className:"bus-timeline-bus-icon",style:{left:`${ke}%`,height:"20px",width:"20px",backgroundColor:ey(Z.route)},"aria-label":`Bus is ${ke.toFixed(0)}% of the way to your stop`}),Ci.map((on,Ai)=>{const an=Ai%2===0;return he.jsxs("div",{className:"bus-timeline-intermediate-marker",style:{left:`${uv(on.aaT)}%`},children:[he.jsx("div",{className:"bus-timeline-intermediate-dot"}),an&&he.jsx("span",{className:"bus-timeline-intermediate-label",children:pE(on.stop_name_short||on.stop_name,8)})]},on.stop_id)})]}),he.jsx("div",{className:"bus-timeline-marker bus-timeline-marker-end",children:he.jsx("div",{className:"bus-timeline-marker-dot-end"})})]}),he.jsx("div",{className:"bus-timeline-stats",children:he.jsxs("span",{className:"bus-timeline-stat",children:["Progress: ",ke.toFixed(0),"%"]})})]})})]}),he.jsxs("div",{className:"bus-view",children:[he.jsxs("div",{className:"bus-view-top",children:[he.jsxs("span",{children:["Bus #",Z.vehicle_id]}),he.jsx("span",{children:Z.bus_type})]}),he.jsxs("div",{className:"bus-view-bottom",children:[he.jsx("div",{className:"bus-view-image"}),he.jsxs("div",{className:"bus-view-bottom-text",children:[he.jsx("span",{children:"62 buses in fleet"}),he.jsxs("span",{children:["Est. number of passengers onboard: ",Z.passenger_count]})]})]})]})]})]})})}function _E({busynessData:Z,dayOffset:ce=0}){const[de,ue]=Tt.useState(ce);if(!Z?.today?.overall_by_hour||!Z?.today?.by_route_by_hour)return null;const Ae=Z.today.overall_by_hour,Ce=Math.max(...Ae,1),se=Z.current?.hour||new Date().getHours(),n=Z.today.by_route_by_hour,ke=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Fe=new Date,pt=new Date(Fe);pt.setDate(Fe.getDate()+de),ke[pt.getDay()];const it=()=>ue(Ui=>Math.max(Ui-1,-7)),ht=()=>ue(Ui=>Math.min(Ui+1,7)),Ci=Ui=>{const Vi=[],qi=Object.keys(n),on=qi.reduce((Ai,an)=>Ai+(n[an][Ui]||0),0);return on===0?[]:(qi.forEach(Ai=>{const an=n[Ai][Ui]||0;if(an>0){const Un=an/on*100;Vi.push({route:Ai,percent:Un,color:ey(Ai)})}}),Vi)};return he.jsxs("div",{className:"popular-times-section",children:[he.jsxs("div",{className:"popular-times-header",children:[he.jsx("h2",{className:"popular-times-title",children:"Popular Times Today"}),he.jsx("button",{className:"popular-times-info","aria-label":"Information about popular times",children:""})]}),he.jsxs("div",{className:"popular-times-chart",children:[he.jsx("button",{className:"popular-times-arrow popular-times-arrow-left",onClick:it,"aria-label":"Previous day",children:""}),he.jsx("div",{className:"popular-times-bars",children:Ae.map((Ui,Vi)=>{const qi=Ui/Ce*100,on=de===0&&Vi===se,Ai=Ci(Vi);return he.jsx("div",{className:`popular-times-bar-slot ${on?"popular-times-bar-current":""}`,"aria-label":`${Vi}:00 - ${Ui}% busy`,children:he.jsx("div",{className:"popular-times-pill","aria-hidden":"true",children:he.jsx("div",{className:"popular-times-fill",style:{height:`${qi}%`},children:Ai.map((an,Un)=>he.jsx("div",{className:"popular-times-segment",style:{height:`${an.percent}%`,backgroundColor:an.color},title:`Route ${an.route}: ${an.percent.toFixed(0)}%`},Un))})})},Vi)})}),he.jsx("button",{className:"popular-times-arrow popular-times-arrow-right",onClick:ht,"aria-label":"Next day",children:""})]})]})}function gE(){const{stopId:Z}=Xb(),[ce]=nw(),de=$_(),ue=ce.get("stops"),Ae=ue?ue.split(",").filter(Boolean):[],Ce=[Z,...Ae].filter(Boolean),se=Ce.length>1,[n,ke]=Tt.useState({}),[Fe,pt]=Tt.useState(null),[it,ht]=Tt.useState(!0),[Ci,Ui]=Tt.useState(null),Vi=15,[qi,on]=Tt.useState(Vi);Tt.useEffect(()=>{const Pt=setInterval(()=>{on(Bt=>Bt<=1?Vi:Bt-1)},1e3);return()=>clearInterval(Pt)},[]),Tt.useEffect(()=>{if(Ce.length===0)return;let Pt=!1,Bt=null;const Ni=async()=>{Ui(null);try{const tn=await Promise.all(Ce.map(async Wi=>{const cr=await fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/predictions/${Wi}`);if(!cr.ok)throw new Error(`Failed to load stop ${Wi}`);const Pr=await cr.json();return{stopId:Wi,results:Pr.results||[],busyness:Pr.busyness||null}}));if(Pt)return;const Li={};tn.forEach(({stopId:Wi,results:cr})=>{Li[Wi]=cr.sort((Pr,si)=>(Pr.eta_minutes??9999)-(si.eta_minutes??9999))}),ke(Li),pt(tn[0]?.busyness??null),on(Vi)}catch(tn){if(Pt)return;console.error(tn),Ui(tn?.message||"Error loading predictions")}finally{Pt||ht(!1)}};return ht(!0),Ni(),Bt=setInterval(Ni,Vi*1e3),()=>{Pt=!0,Bt&&clearInterval(Bt)}},[Ce.join(",")]);const Ai=Pt=>Pt==="10070"?"W Johnson at East Campus":Pt==="0626"?"University at N Basset":Pt==="6350"?"West Towne Ring at West Towne Mall":`Stop ${Pt}`;Tt.useEffect(()=>{if(Z)try{const Pt="bt_recent_stops",Bt=localStorage.getItem(Pt);let Ni=[];if(Bt)try{Ni=JSON.parse(Bt),Array.isArray(Ni)||(Ni=[])}catch{Ni=[]}const tn=Ni.find(cr=>cr.stopId===Z),Li=tn?(tn.visit_count||0)+1:1,Wi=Ni.filter(cr=>cr.stopId!==Z);Wi.unshift({stopId:Z,name:Ai(Z),lastVisited:new Date().toISOString(),visit_count:Li}),localStorage.setItem(Pt,JSON.stringify(Wi.slice(0,10)))}catch(Pt){console.error("Failed to persist recent stop",Pt)}},[Z]);const an=()=>{const Pt=Ce.join(",");de(`/map?selectMode=true&returnTo=/stop/${Z}&existingStops=${Pt}`)},Un=()=>{window.open("https://maps.google.com","_blank")},rr=()=>{de(`/map?stop=${Z}`)},ln=Fe?.current?.by_route?Object.keys(Fe.current.by_route).sort():[],mn=[];return Object.keys(n).forEach(Pt=>{(n[Pt]||[]).forEach(Ni=>{mn.push({...Ni,sourceStopId:Pt,sourceStopName:Ai(Pt)})})}),mn.sort((Pt,Bt)=>(Pt.eta_minutes??9999)-(Bt.eta_minutes??9999)),he.jsx("main",{className:"stop-root",children:he.jsxs("div",{className:"stop-inner",children:[he.jsxs("header",{className:"new-stop-header",children:[he.jsxs("div",{className:"new-stop-header-top",children:[he.jsxs("div",{className:"search-box",children:[he.jsx("div",{className:"new-stop-logo",children:he.jsx("div",{className:"new-stop-logo-circle","aria-hidden":"true"})}),he.jsx("button",{className:"new-stop-search",onClick:()=>de("/chat"),"aria-label":"Search with BusterChat",children:he.jsx("span",{className:"new-stop-search-text",children:'"Whats the fastest route to..."'})})]}),he.jsxs("div",{className:"header-top-left",children:[he.jsx("button",{className:"new-stop-notif-btn","aria-label":"Notifications",children:he.jsx("span",{className:"new-stop-notif-badge",children:"2"})}),he.jsx("button",{className:"new-stop-menu-btn","aria-label":"Menu"})]})]}),he.jsxs("nav",{className:"new-stop-nav","aria-label":"Primary navigation",children:[he.jsx("button",{className:"new-stop-nav-btn",onClick:()=>de("/"),children:"Home"}),he.jsx("div",{className:"divider"}),he.jsx("button",{className:"new-stop-nav-btn",onClick:()=>de("/recent"),children:"Recent"}),he.jsx("div",{className:"divider"}),he.jsx("button",{className:"new-stop-nav-btn",onClick:()=>de("/map"),children:"Map"}),he.jsx("div",{className:"divider"}),he.jsx("button",{className:"new-stop-nav-btn",onClick:()=>de("/help"),children:"Help"})]})]}),he.jsx("div",{className:"header-under-fixed"}),he.jsx("div",{className:"header-under"}),he.jsxs("section",{className:"new-stop-info",children:[he.jsxs("div",{className:"new-stop-info-row",children:[he.jsxs("h1",{className:"new-stop-id",children:["#",Z]}),he.jsx("div",{className:"new-stop-routes",children:ln.map(Pt=>he.jsx("span",{className:"new-stop-route-badge",style:{backgroundColor:ey(Pt)},children:Pt},Pt))})]}),he.jsx("div",{className:"new-stop-name",children:Ai(Z)})]}),Fe&&he.jsx(_E,{busynessData:Fe}),he.jsxs("section",{className:"new-stop-actions",children:[he.jsx("div",{className:"action-left",children:he.jsxs("button",{className:"new-stop-action-btn",onClick:Un,children:[he.jsx("span",{className:"get-directions-icon"}),"Get Directions"]})}),he.jsxs("div",{className:"action-right",children:[he.jsxs("button",{className:"new-stop-action-btn",onClick:an,children:[he.jsx("span",{className:"add-stop-icon"}),"Add Stop"]}),he.jsx("button",{className:"new-stop-action-btn-circle",onClick:rr,children:he.jsx("span",{className:"view-on-map-icon"})}),he.jsx("button",{className:"new-stop-action-btn-circle","aria-label":"Favorite this stop",children:he.jsx("span",{className:"favorite-stop-icon"})})]})]}),he.jsxs("div",{className:"stop-label-row",role:"presentation",children:[he.jsxs("div",{className:"label-row-left",children:[he.jsx("span",{children:"Route"}),he.jsx("span",{children:"Destination"})]}),he.jsxs("div",{className:"label-row-right",children:[he.jsx("span",{children:"ETA"}),he.jsx("span",{children:"Expand"})]})]}),he.jsxs("section",{className:"stop-cards","aria-labelledby":"upcoming-buses-title",children:[he.jsx("h2",{id:"upcoming-buses-title",className:"visually-hidden",children:"Upcoming Buses"}),it&&he.jsx("div",{className:"stop-loading",role:"status","aria-live":"polite",children:"Loading buses"}),Ci&&he.jsx("div",{className:"stop-error",role:"alert","aria-live":"assertive",children:Ci}),!it&&!Ci&&mn.length===0&&he.jsxs("div",{className:"stop-empty",role:"status",children:["No upcoming buses at ",se?"these stops":"this stop","."]}),!it&&!Ci&&mn.map(Pt=>{const Bt=`${Pt.sourceStopId}-${Pt.trip_uid||Pt.route}-${Pt.predicted_time}`,Ni=se?Pt.sourceStopName:null;return he.jsx(mE,{pred:Pt,stopName:Ni,stopId:Pt.sourceStopId,countdown:qi,refreshSeconds:Vi},Bt)})]}),he.jsx("div",{className:"stop-end-label",role:"separator",children:"End of Bus Information"}),he.jsxs("section",{className:"stop-report-card",children:[he.jsx("div",{className:"stop-report-icon","aria-hidden":"true"}),he.jsxs("span",{children:["Report an issue at ",se?"these stops":"this bus stop"]})]}),he.jsxs("footer",{className:"home-footer routes-footer",children:[he.jsxs("div",{className:"home-footer-left",children:[he.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),he.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),he.jsxs("div",{className:"home-footer-links",children:[he.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),he.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),he.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}const yE="bt_recent_stops";function Pb(Z){if(!Z)return"";const ce=new Date(Z);if(Number.isNaN(ce.getTime()))return"";const de=ce.toLocaleDateString([],{month:"short",day:"numeric"}),ue=ce.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return`${de}  ${ue}`}function vE(){const[Z,ce]=Tt.useState([]);Tt.useEffect(()=>{if(!(typeof window>"u"))try{const Ce=localStorage.getItem(yE);if(!Ce){ce([]);return}let se=JSON.parse(Ce);Array.isArray(se)||(se=[]),se.sort((n,ke)=>{const Fe=new Date(n.lastVisited||0).getTime();return new Date(ke.lastVisited||0).getTime()-Fe}),ce(se)}catch(Ce){console.error("Failed to read recent stops",Ce),ce([])}},[]);const de=new Date,ue=de.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),Ae=de.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return he.jsx("main",{className:"stop-root",children:he.jsxs("div",{className:"stop-inner",children:[he.jsxs("header",{className:"home-header",children:[he.jsxs("div",{className:"home-header-top",children:[he.jsxs(Yf,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[he.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),he.jsxs("div",{className:"home-wordmark",children:[he.jsx("div",{className:"home-logo-text-main",children:"badger"}),he.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),he.jsxs("div",{className:"home-clock","aria-live":"off",children:[he.jsx("div",{className:"home-clock-date",children:Ae}),he.jsx("div",{className:"home-clock-time",children:ue})]})]}),he.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[he.jsx(Yh,{to:"/",end:!0,className:({isActive:Ce})=>`home-nav-tab${Ce?" home-nav-tab--active":""}`,children:"Home"}),he.jsx(Yh,{to:"/recent",className:({isActive:Ce})=>`home-nav-tab${Ce?" home-nav-tab--active":""}`,children:"Recent"}),he.jsx(Yh,{to:"/map",className:({isActive:Ce})=>`home-nav-tab${Ce?" home-nav-tab--active":""}`,children:"Map"}),he.jsx(Yh,{to:"/routes",className:({isActive:Ce})=>`home-nav-tab${Ce?" home-nav-tab--active":""}`,children:"Routes"})]})]}),he.jsx("section",{className:"stop-header-bar","aria-labelledby":"recent-title",children:he.jsx("div",{className:"stop-header-left",children:he.jsxs("div",{className:"stop-header-text",children:[he.jsx("h1",{id:"recent-title",className:"stop-header-title",children:"Recent stops"}),he.jsx("div",{className:"stop-header-subtitle",children:"Stops you've viewed recently"})]})})}),he.jsxs("div",{className:"stop-label-row",role:"presentation",children:[he.jsx("span",{children:"Stop"}),he.jsx("span",{children:"Last visited"})]}),he.jsxs("section",{className:"stop-cards","aria-labelledby":"recent-stops-list",children:[he.jsx("h2",{id:"recent-stops-list",className:"visually-hidden",children:"Recently Visited Stops"}),Z.length===0&&he.jsx("div",{className:"stop-empty",role:"status",children:"You haven't viewed any stops yet."}),Z.map(Ce=>he.jsx(Yf,{to:`/stop/${Ce.stopId}`,className:"recent-stop-link","aria-label":`View stop ${Ce.stopId}, ${Ce.name||`Stop ${Ce.stopId}`}, last visited ${Pb(Ce.lastVisited)}`,children:he.jsxs("article",{className:"bus-card",children:[he.jsx("div",{className:"bus-card-route",style:{backgroundColor:"#111827"},"aria-label":`Stop ${Ce.stopId}`,children:Ce.stopId}),he.jsxs("div",{className:"bus-card-main",children:[he.jsxs("div",{className:"bus-card-left",children:[he.jsxs("div",{className:"bus-card-top",children:[he.jsx("div",{className:"bus-card-destination",children:Ce.name||`Stop ${Ce.stopId}`}),he.jsx("div",{className:"bus-card-times",children:he.jsx("div",{className:"bus-card-eta",children:Pb(Ce.lastVisited)})})]}),he.jsxs("div",{className:"bus-card-bottom",children:[he.jsxs("div",{className:"bus-card-occupancy",children:[he.jsx("div",{className:"bus-card-dots","aria-hidden":"true",children:Array.from({length:5}).map((se,n)=>he.jsx("span",{className:"occ-dot"},n))}),he.jsx("span",{className:"bus-card-sub",children:"Tap to view arrivals"})]}),he.jsx("div",{className:"bus-card-clock"})]})]}),he.jsx("div",{className:"bus-card-right",children:he.jsx("span",{className:"bus-card-track-label","aria-hidden":"true",children:"View stop"})})]})]})},Ce.stopId))]}),he.jsxs("footer",{className:"home-footer routes-footer",children:[he.jsxs("div",{className:"home-footer-left",children:[he.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),he.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),he.jsxs("div",{className:"home-footer-links",children:[he.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),he.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),he.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}function Lb(Z,ce){const de=40075016686e-3,ue=ce*Math.PI/180;return Math.cos(ue)*de/Math.pow(2,Z+8)}function xE(){const[Z,ce]=Tt.useState([]),[de,ue]=Tt.useState(!1),[Ae,Ce]=Tt.useState(null),[se,n]=Tt.useState(""),[ke,Fe]=Tt.useState(""),[pt,it]=Tt.useState("07:00"),[ht,Ci]=Tt.useState("12:00"),[Ui,Vi]=Tt.useState({longitude:-89.4012,latitude:43.0731,zoom:15}),qi=80;Tt.useEffect(()=>{ce(xv())},[]);const on=()=>{Fe(""),it("07:00"),Ci("12:00"),n(""),Vi({longitude:-89.4012,latitude:43.0731,zoom:15})},Ai=()=>{ue(!0),Ce(null),on()},an=Li=>{ue(!0),Ce(Li.id),Fe(Li.stopId??""),it(Li.startTime??"07:00"),Ci(Li.endTime??"12:00"),n(""),Vi(Wi=>({...Wi,longitude:Li.center?.lon??Wi.longitude,latitude:Li.center?.lat??Wi.latitude,zoom:Wi.zoom??15}))},Un=()=>{ue(!1),Ce(null),n("")},rr=Li=>{if(Li.preventDefault(),!ke.trim()){n("Please enter a stop ID.");return}const Wi=Ui.latitude,cr=Ui.longitude,si=Lb(Ui.zoom,Wi)*qi,xi={name:`SmartLaunch for stop ${ke.trim()}`,stopId:ke.trim(),center:{lat:Wi,lon:cr},radiusMeters:si,startTime:pt||null,endTime:ht||null};let Tn;if(Ae)Tn=Z.map(zn=>zn.id===Ae?{...zn,...xi}:zn);else{const zn={id:String(Date.now()),enabled:!0,...xi};Tn=[...Z,zn]}ce(Tn),cv(Tn),ue(!1),Ce(null),n("")},ln=Li=>{const Wi=Z.map(cr=>cr.id===Li?{...cr,enabled:!cr.enabled}:cr);ce(Wi),cv(Wi)},mn=Li=>{const Wi=Z.filter(cr=>cr.id!==Li);ce(Wi),cv(Wi),Ae===Li&&(ue(!1),Ce(null))},Pt=!!Ae,Bt=new Date,Ni=Bt.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),tn=Bt.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return he.jsx("main",{className:"home-root",children:he.jsxs("div",{className:"home-phone",children:[he.jsxs("header",{className:"home-header",children:[he.jsxs("div",{className:"home-header-top",children:[he.jsxs(Yf,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[he.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),he.jsxs("div",{className:"home-wordmark",children:[he.jsx("div",{className:"home-logo-text-main",children:"badger"}),he.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),he.jsxs("div",{className:"home-clock","aria-live":"off",children:[he.jsx("div",{className:"home-clock-date",children:tn}),he.jsx("div",{className:"home-clock-time",children:Ni})]})]}),he.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[he.jsx(Yh,{to:"/",end:!0,className:({isActive:Li})=>`home-nav-tab${Li?" home-nav-tab--active":""}`,children:"Home"}),he.jsx(Yh,{to:"/recent",className:({isActive:Li})=>`home-nav-tab${Li?" home-nav-tab--active":""}`,children:"Recent"}),he.jsx(Yh,{to:"/map",className:({isActive:Li})=>`home-nav-tab${Li?" home-nav-tab--active":""}`,children:"Map"}),he.jsx(Yh,{to:"/routes",className:({isActive:Li})=>`home-nav-tab${Li?" home-nav-tab--active":""}`,children:"Routes"})]})]}),he.jsxs("section",{className:"home-hero","aria-labelledby":"smartlaunch-title",children:[he.jsx("h1",{id:"smartlaunch-title",className:"home-hero-title",children:"SmartLaunch Automations"}),he.jsx("p",{className:"home-notice-body",children:"Automatically open a stop when you're in a specific place and time window."})]}),he.jsxs("section",{className:"home-card-grid","aria-labelledby":"existing-rules-title",children:[he.jsx("h2",{id:"existing-rules-title",className:"visually-hidden",children:"Your SmartLaunch Automations"}),Z.length===0&&he.jsx("p",{className:"home-notice-body",role:"status",children:"No SmartLaunch automations yet. Create one below."}),Z.map(Li=>he.jsx("article",{className:"home-card smartlaunch-rule-card","aria-label":`SmartLaunch automation for stop ${Li.stopId}, ${Li.enabled?"enabled":"disabled"}`,children:he.jsxs("div",{className:"smartlaunch-rule-content",children:[he.jsx("h3",{className:"home-card-title",children:Li.name}),he.jsxs("dl",{className:"smartlaunch-rule-details",children:[he.jsx("dt",{className:"visually-hidden",children:"Stop ID"}),he.jsxs("dd",{children:[he.jsx("strong",{children:"Stop:"})," ",Li.stopId]}),he.jsx("dt",{className:"visually-hidden",children:"Active time window"}),he.jsxs("dd",{children:[he.jsx("strong",{children:"Time:"})," ",Li.startTime&&Li.endTime?`${Li.startTime}${Li.endTime}`:"All day"]}),he.jsx("dt",{className:"visually-hidden",children:"Status"}),he.jsxs("dd",{children:[he.jsx("strong",{children:"Status:"})," ",Li.enabled?"Enabled":"Disabled"]})]}),he.jsxs("div",{className:"smartlaunch-rule-actions",children:[he.jsx("button",{type:"button",className:"smartlaunch-action-btn",onClick:()=>ln(Li.id),"aria-label":Li.enabled?`Disable ${Li.name}`:`Enable ${Li.name}`,children:Li.enabled?"Disable":"Enable"}),he.jsx("button",{type:"button",className:"smartlaunch-action-btn",onClick:()=>an(Li),"aria-label":`Edit ${Li.name}`,children:"Edit"}),he.jsx("button",{type:"button",className:"smartlaunch-action-btn smartlaunch-delete-btn",onClick:()=>mn(Li.id),"aria-label":`Delete ${Li.name}`,children:"Delete"})]})]})},Li.id))]}),he.jsxs("section",{className:"home-notice secondary","aria-labelledby":"create-section-title",children:[he.jsx("h2",{id:"create-section-title",className:"visually-hidden",children:de?Pt?"Edit Automation":"Create New Automation":"Create Automation"}),de?he.jsxs("form",{onSubmit:rr,"aria-labelledby":"form-title",children:[he.jsx("h3",{id:"form-title",className:"home-notice-title",children:Pt?"Edit SmartLaunch":"Create SmartLaunch"}),se&&he.jsx("div",{className:"form-error",role:"alert","aria-live":"assertive",children:se}),he.jsxs("div",{className:"form-field",children:[he.jsx("label",{htmlFor:"stop-id-input",className:"form-label",children:"Stop ID:"}),he.jsx("input",{id:"stop-id-input",type:"text",value:ke,onChange:Li=>{Fe(Li.target.value),n("")},className:"form-input",required:!0,"aria-required":"true","aria-invalid":se?"true":"false","aria-describedby":se?"stop-id-error":void 0}),se&&he.jsx("span",{id:"stop-id-error",className:"visually-hidden",children:se})]}),he.jsxs("fieldset",{className:"form-fieldset",children:[he.jsx("legend",{className:"form-legend",children:"Active time window"}),he.jsxs("div",{className:"form-time-group",children:[he.jsxs("div",{className:"form-field",children:[he.jsx("label",{htmlFor:"start-time-input",className:"form-label",children:"From:"}),he.jsx("input",{id:"start-time-input",type:"time",value:pt,onChange:Li=>it(Li.target.value),className:"form-input"})]}),he.jsxs("div",{className:"form-field",children:[he.jsx("label",{htmlFor:"end-time-input",className:"form-label",children:"To:"}),he.jsx("input",{id:"end-time-input",type:"time",value:ht,onChange:Li=>Ci(Li.target.value),className:"form-input"})]})]})]}),he.jsx("p",{className:"home-notice-body",children:"Drag and zoom the map so the red circle covers the area where you want this automation to trigger."}),he.jsxs("div",{className:"map-container",children:[he.jsx(hw,{viewState:Ui,onMove:Li=>Vi(Li.viewState),"aria-label":"Interactive map for setting SmartLaunch trigger location"}),he.jsx("div",{className:"smartlaunch-circle-overlay",role:"img","aria-label":`Trigger radius circle, approximately ${Math.round(Lb(Ui.zoom,Ui.latitude)*qi)} meters`,style:{width:`${qi*2}px`,height:`${qi*2}px`,marginLeft:`-${qi}px`,marginTop:`-${qi}px`}})]}),he.jsxs("div",{className:"form-actions",children:[he.jsx("button",{type:"submit",className:"smartlaunch-action-btn smartlaunch-primary-btn",children:Pt?"Save changes":"Save SmartLaunch"}),he.jsx("button",{type:"button",className:"smartlaunch-action-btn",onClick:Un,children:"Cancel"})]})]}):he.jsx("button",{type:"button",className:"smartlaunch-create-btn",onClick:Ai,children:"+ New SmartLaunch"})]}),he.jsxs("footer",{className:"home-footer",children:[he.jsxs("div",{className:"home-footer-left",children:[he.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),he.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),he.jsxs("div",{className:"home-footer-links",children:[he.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),he.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),he.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}const kb="bt_saved_stops";function Fb(Z){if(!Z)return"";const ce=new Date(Z);if(Number.isNaN(ce.getTime()))return"";const de=ce.toLocaleDateString([],{month:"short",day:"numeric"}),ue=ce.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return`${de}  ${ue}`}function bE(){const Z=$_(),[ce,de]=Tt.useState([]);Tt.useEffect(()=>{if(!(typeof window>"u"))try{const ke=localStorage.getItem(kb);if(!ke){de([]);return}let Fe=JSON.parse(ke);Array.isArray(Fe)||(Fe=[]),Fe.sort((pt,it)=>{const ht=new Date(pt.savedAt||0).getTime();return new Date(it.savedAt||0).getTime()-ht}),de(Fe)}catch(ke){console.error("Failed to read saved stops",ke),de([])}},[]);const ue=(ke,Fe)=>{if(Fe.preventDefault(),Fe.stopPropagation(),!!window.confirm("Delete this saved stop/group?"))try{const pt=ce.filter(it=>it.id!==ke);de(pt),localStorage.setItem(kb,JSON.stringify(pt))}catch(pt){console.error("Failed to delete",pt)}},Ae=ke=>{const[Fe,...pt]=ke.stopIds,it=pt.length>0?`?stops=${pt.join(",")}`:"";Z(`/stop/${Fe}${it}`)},Ce=new Date,se=Ce.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),n=Ce.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return he.jsx("main",{className:"stop-root",children:he.jsxs("div",{className:"stop-inner",children:[he.jsxs("header",{className:"home-header",children:[he.jsxs("div",{className:"home-header-top",children:[he.jsxs(Yf,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[he.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),he.jsxs("div",{className:"home-wordmark",children:[he.jsx("div",{className:"home-logo-text-main",children:"badger"}),he.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),he.jsxs("div",{className:"home-clock","aria-live":"off",children:[he.jsx("div",{className:"home-clock-date",children:n}),he.jsx("div",{className:"home-clock-time",children:se})]})]}),he.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[he.jsx(Yh,{to:"/",end:!0,className:({isActive:ke})=>`home-nav-tab${ke?" home-nav-tab--active":""}`,children:"Home"}),he.jsx(Yh,{to:"/recent",className:({isActive:ke})=>`home-nav-tab${ke?" home-nav-tab--active":""}`,children:"Recent"}),he.jsx(Yh,{to:"/map",className:({isActive:ke})=>`home-nav-tab${ke?" home-nav-tab--active":""}`,children:"Map"}),he.jsx(Yh,{to:"/routes",className:({isActive:ke})=>`home-nav-tab${ke?" home-nav-tab--active":""}`,children:"Routes"})]})]}),he.jsx("section",{className:"stop-header-bar","aria-labelledby":"saved-title",children:he.jsx("div",{className:"stop-header-left",children:he.jsxs("div",{className:"stop-header-text",children:[he.jsx("h1",{id:"saved-title",className:"stop-header-title",children:"Saved stops"}),he.jsx("div",{className:"stop-header-subtitle",children:"Your saved stops and groups"})]})})}),he.jsxs("div",{className:"stop-label-row",role:"presentation",children:[he.jsx("span",{children:"Stop"}),he.jsx("span",{children:"Saved"})]}),he.jsxs("section",{className:"stop-cards","aria-labelledby":"saved-stops-list",children:[he.jsx("h2",{id:"saved-stops-list",className:"visually-hidden",children:"Your Saved Stops and Groups"}),ce.length===0&&he.jsx("div",{className:"stop-empty",role:"status",children:"You haven't saved any stops yet."}),ce.map(ke=>he.jsxs("article",{className:"bus-card saved-stop-card","aria-label":`${ke.name}, ${ke.isGroup?`group with ${ke.stopIds.length} stops`:`stop ${ke.stopIds[0]}`}, saved on ${Fb(ke.savedAt)}`,children:[he.jsx("div",{className:"bus-card-route",style:{backgroundColor:ke.isGroup?"#8B5CF6":"#111827",minWidth:ke.isGroup?"60px":"50px",fontSize:ke.isGroup?"12px":"20px"},"aria-label":ke.isGroup?`Group with ${ke.stopIds.length} stops`:`Stop ${ke.stopIds[0]}`,children:ke.isGroup?`${ke.stopIds.length} stops`:ke.stopIds[0]}),he.jsxs("div",{className:"bus-card-main",children:[he.jsxs("div",{className:"bus-card-left",children:[he.jsxs("div",{className:"bus-card-top",children:[he.jsxs("div",{className:"bus-card-destination",children:[ke.name,ke.isGroup&&he.jsx("span",{className:"group-badge","aria-label":"This is a group",children:"GROUP"})]}),he.jsx("div",{className:"bus-card-times",children:he.jsx("div",{className:"bus-card-eta",children:Fb(ke.savedAt)})})]}),he.jsxs("div",{className:"bus-card-bottom",children:[he.jsxs("div",{className:"bus-card-occupancy",children:[he.jsx("div",{className:"bus-card-dots","aria-hidden":"true",children:Array.from({length:5}).map((Fe,pt)=>he.jsx("span",{className:"occ-dot"},pt))}),he.jsx("span",{className:"bus-card-sub",children:ke.isGroup?`Stops: ${ke.stopIds.join(", ")}`:"Tap to view arrivals"})]}),he.jsx("div",{className:"bus-card-clock"})]})]}),he.jsxs("div",{className:"bus-card-right",children:[he.jsx("button",{className:"bus-card-track",type:"button",onClick:Fe=>{Fe.stopPropagation(),Ae(ke)},style:{marginRight:"8px"},"aria-label":`View ${ke.name}`,children:"View"}),he.jsx("button",{className:"bus-card-track bus-card-delete",type:"button",onClick:Fe=>ue(ke.id,Fe),"aria-label":`Delete ${ke.name}`,children:"Delete"})]})]})]},ke.id))]}),he.jsxs("footer",{className:"home-footer routes-footer",children:[he.jsxs("div",{className:"home-footer-left",children:[he.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),he.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),he.jsxs("div",{className:"home-footer-links",children:[he.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),he.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),he.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}const wE="https://badger-transit-dawn-darkness-55.fly.dev";function TE(){let Z=localStorage.getItem("buster_sid");return Z||(Z=crypto.randomUUID(),localStorage.setItem("buster_sid",Z)),Z}function SE(){const Z=Tt.useMemo(()=>TE(),[]),[ce,de]=Tt.useState(null),[ue,Ae]=Tt.useState(""),[Ce,se]=Tt.useState(null),[n,ke]=Tt.useState(null);Tt.useEffect(()=>{navigator.geolocation.getCurrentPosition(pt=>de({lat:pt.coords.latitude,lon:pt.coords.longitude}),pt=>ke("Geolocation denied or unavailable: "+pt.message),{enableHighAccuracy:!0,timeout:1e4})},[]);async function Fe(){if(ke(null),se(null),!ce)return ke("No location yet.");const it=await(await fetch(`${wE}/api/buster/route`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-Id":Z},body:JSON.stringify({message:ue,user_location:ce})})).json();it.success?se(it):ke(it.error+(it.detail?`  ${it.detail}`:""))}return he.jsxs("div",{style:{maxWidth:720,margin:"40px auto",fontFamily:"system-ui"},children:[he.jsx("h2",{children:"Buster Route Test"}),ce?he.jsxs("p",{children:["Your location: ",ce.lat.toFixed(5),", ",ce.lon.toFixed(5)]}):he.jsx("p",{children:"Getting your location"}),he.jsxs("div",{style:{display:"flex",gap:8},children:[he.jsx("input",{value:ue,onChange:pt=>Ae(pt.target.value),placeholder:'Try "Bakke" then "second one"',style:{flex:1,padding:10}}),he.jsx("button",{onClick:Fe,style:{padding:"10px 14px"},children:"Send"})]}),n&&he.jsx("p",{style:{color:"crimson"},children:n}),Ce?.type==="route_options"&&he.jsxs("div",{style:{marginTop:16},children:[he.jsx("h3",{children:"Destination"}),he.jsxs("p",{children:[Ce.destination?.name,"  ",Ce.destination?.address]}),he.jsx("h3",{children:"Options"}),Ce.options.map(pt=>he.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:12,padding:12,marginBottom:12},children:[he.jsx("b",{children:pt.label}),he.jsxs("div",{children:["Duration: ",Math.round((pt.duration_s??0)/60)," min"]}),he.jsxs("div",{children:["Walk: ",Math.round((pt.walk_m??0)*3.28084)," ft"]}),he.jsxs("div",{children:["Transfers: ",pt.transfers]}),he.jsxs("div",{children:["Board: ",pt.board_stop||""]}),he.jsxs("details",{style:{marginTop:8},children:[he.jsx("summary",{children:"Steps"}),he.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(pt.steps,null,2)})]})]},pt.id))]}),Ce?.type==="route_selected"&&he.jsxs("div",{style:{marginTop:16},children:[he.jsx("h3",{children:"Selected"}),he.jsx("pre",{style:{whiteSpace:"pre-wrap"},children:JSON.stringify(Ce.selected,null,2)})]})]})}const EE="https://badger-transit-dawn-darkness-55.fly.dev";function AE(){const Z=Tt.useMemo(()=>crypto.randomUUID(),[]),[ce,de]=Tt.useState([{role:"assistant",text:"Where ya heading?"}]),[ue,Ae]=Tt.useState(""),[Ce,se]=Tt.useState(!1),[n,ke]=Tt.useState(null),Fe=Tt.useRef(null);Tt.useEffect(()=>{Fe.current?.scrollIntoView({behavior:"smooth"})},[ce]),Tt.useEffect(()=>{navigator.geolocation?.getCurrentPosition(it=>ke({lat:it.coords.latitude,lon:it.coords.longitude}),()=>ke(null),{enableHighAccuracy:!1,maximumAge:6e4,timeout:8e3})},[]);async function pt(it){if(it.trim()){if(!n){de(ht=>[...ht,{role:"assistant",text:"I need location access to route you (for now). Enable it and try again."}]);return}de(ht=>[...ht,{role:"user",text:it}]),Ae(""),se(!0);try{const Ci=await(await fetch(`${EE}/api/buster/chat`,{method:"POST",headers:{"Content-Type":"application/json","X-Session-Id":Z},body:JSON.stringify({message:it,user_location:n})})).json();if(!Ci.success){de(Ui=>[...Ui,{role:"assistant",text:Ci.error||"Something went wrong."}]);return}de(Ui=>[...Ui,{role:"assistant",text:Ci.assistant_message,cards:Ci.cards}])}catch{de(Ci=>[...Ci,{role:"assistant",text:"Network error talking to Buster."}])}finally{se(!1)}}}return he.jsxs("div",{style:{maxWidth:520,margin:"0 auto",padding:16},children:[he.jsx("h2",{style:{marginBottom:8},children:"Buster (Experimental)"}),he.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:12,padding:12,height:520,overflowY:"auto",background:"#fff"},children:[ce.map((it,ht)=>he.jsx("div",{style:{display:"flex",justifyContent:it.role==="user"?"flex-end":"flex-start",marginBottom:10},children:he.jsxs("div",{style:{maxWidth:"85%",padding:"10px 12px",borderRadius:12,background:it.role==="user"?"#e8f0fe":"#f3f3f3",whiteSpace:"pre-wrap"},children:[it.text,it.cards?.type==="route_options"&&he.jsx("div",{style:{marginTop:10,display:"grid",gap:8},children:it.cards.options?.map((Ci,Ui)=>he.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:12,padding:10,background:"#fff"},children:[he.jsxs("div",{style:{fontWeight:700},children:[Ci.label," (Option ",Ui+1,")"]}),he.jsxs("div",{children:["Transfers: ",Ci.transfers]}),he.jsxs("div",{children:["Walk: ",Math.round((Ci.walk_m||0)/1609.34*10)/10," mi"]}),he.jsxs("div",{children:["Total: ",Math.round((Ci.duration_s||0)/60)," min"]}),he.jsxs("div",{style:{marginTop:6,fontSize:13,color:"#333"},children:["Board at: ",Ci.board_stop||""]}),he.jsxs("button",{onClick:()=>pt(Ui===0?"first one":"second one"),style:{marginTop:8,padding:"8px 10px",borderRadius:10,border:"1px solid #ccc"},children:["Pick option ",Ui+1]})]},Ci.id||Ui))}),it.cards?.type==="route_selected"&&he.jsxs("div",{style:{marginTop:10,padding:10,borderRadius:12,background:"#fff",border:"1px solid #ddd"},children:[he.jsx("div",{style:{fontWeight:700},children:"Selected route"}),he.jsxs("div",{children:["Transfers: ",it.cards.selected?.transfers]}),he.jsxs("div",{children:["Total: ",Math.round((it.cards.selected?.duration_s||0)/60)," min"]}),he.jsxs("div",{children:["Board: ",it.cards.selected?.board_stop||""]})]})]})},ht)),he.jsx("div",{ref:Fe})]}),he.jsxs("form",{onSubmit:it=>{it.preventDefault(),pt(ue)},style:{display:"flex",gap:8,marginTop:10},children:[he.jsx("input",{value:ue,onChange:it=>Ae(it.target.value),placeholder:Ce?"Thinking...":"Type a destination or 'second one'...",disabled:Ce,style:{flex:1,padding:10,borderRadius:12,border:"1px solid #ccc"}}),he.jsx("button",{disabled:Ce,style:{padding:"10px 14px",borderRadius:12,border:"1px solid #ccc"},children:"Send"})]})]})}const ME=`stop_code,stop_name,stop_lat,stop_lon\r
0010,Langdon at N Park,43.075933,-89.400154\r
E100,E Washington at East High,43.096625,-89.353789\r
W200,Regent at West High,43.068056,-89.427955\r
W299,Regent at West High,43.067841,-89.427585\r
M600,S Gammon at Memorial High,43.063995,-89.502396\r
M601,Mid Town at Province Hill,43.031425,-89.51704\r
0107,S Park at W Olin,43.054383,-89.396533\r
L700,Pflaum at Lafollette High,43.062197,-89.320103\r
1100,E Mifflin at N Pinckney,43.076028,-89.384661\r
1101,W Main at S Carroll,43.073297,-89.383773\r
1105,Milwaukee at Walter,43.098067,-89.326187\r
1116,Fordem at Lakewood,43.096657,-89.363804\r
1121,E Johnson at N Livingston,43.082937,-89.378175\r
1122,N Sherman at Oxford,43.11014,-89.363978\r
1131,E Johnson at N Third,43.097012,-89.358407\r
1137,Milwaukee at Corry,43.099888,-89.34466\r
1138,E Gorham at N Blair,43.081202,-89.382769\r
0115,N Park at Regent,43.067983,-89.400724\r
1150,E Wilson at S Blair,43.076186,-89.376179\r
1151,E Johnson at N Paterson,43.084548,-89.37584\r
1153,Walter at Dawes,43.095569,-89.326524\r
1156,N Sherman at Commercial,43.106953,-89.364055\r
1157,N Baldwin at Sherman,43.091942,-89.372674\r
1160,E Johnson at N Fourth,43.098059,-89.357418\r
1163,W Washington at S Carroll,43.073655,-89.385427\r
1167,Jenifer at S Livingston,43.077867,-89.369993\r
1169,Atwood at Walter,43.089707,-89.329817\r
1177,Fordem at Lakewood,43.096916,-89.363631\r
1188,Winnebago at Atwood,43.091791,-89.355523\r
1190,Jenifer at S Brearly,43.080238,-89.367028\r
1194,Jenifer at S Livingston,43.077751,-89.370536\r
E949,Sycamore at Wayridge,43.113749,-89.299929\r
E958,Sycamore at Wayridge,43.113928,-89.300609\r
E961,Mendota at Sycamore,43.114056,-89.315049\r
E963,Mendota at Duncan,43.116137,-89.317725\r
E966,Mendota at Hoover,43.117912,-89.320403\r
E967,Mendota at Hoover,43.117929,-89.320069\r
E968,Mendota at Duncan,43.116101,-89.318059\r
E970,Mendota at Sycamore,43.113986,-89.315344\r
E974,Sycamore at N Thompson,43.113996,-89.296495\r
1206,Milwaukee at Leon,43.098597,-89.329459\r
1208,Williamson at Rogers,43.087361,-89.359231\r
1209,E Johnson at N Ingersoll,43.08708,-89.372246\r
0121,W Badger at Fiedler,43.038466,-89.401117\r
1219,Atwood at Waubesa,43.093781,-89.343728\r
1220,Milwaukee at N Bryan,43.099882,-89.335459\r
W230,Oxford at Wellesley,43.082649,-89.438129\r
W232,Oxford at Bowdoin,43.081968,-89.441327\r
1225,Walter at Atwood,43.089689,-89.329138\r
1227,E Johnson at N Butler,43.079045,-89.383684\r
W286,Shorewood at Topping,43.077715,-89.443523\r
W288,Shorewood at Locust,43.076148,-89.443906\r
W292,Locust at Highbury,43.076998,-89.448548\r
1230,E Wilson at S Butler,43.074504,-89.378773\r
W404,Post at Fish Hatchery,43.026758,-89.413062\r
W407,Grandview at Kingston,43.029623,-89.431296\r
W411,Grandview at Brighton,43.032882,-89.430691\r
W413,Grandview at Thames,43.03452,-89.433097\r
W418,Grandview at Sandwood,43.026955,-89.430839\r
W452,Grandview at Brighton,43.032747,-89.431321\r
1250,E Gorham at N Baldwin,43.089497,-89.369614\r
1254,N Sherman at Roth,43.11228,-89.363964\r
1267,E Johnson at N Dickinson,43.090856,-89.366921\r
1270,Walter at Milwaukee,43.097852,-89.326706\r
1293,Milwaukee at E Washington,43.100087,-89.348302\r
1301,North at E Washington,43.100875,-89.349067\r
1309,Milwaukee at Leon,43.098248,-89.329213\r
1321,Atwood at S Fair Oaks,43.093582,-89.340691\r
1325,E Johnson at N Baldwin,43.089622,-89.368749\r
1329,Sherman at Sherman,43.097097,-89.368002\r
0133,University at N Breese,43.073275,-89.413154\r
1333,E Johnson at Fordem,43.093129,-89.363622\r
1341,N Sherman at Aberg,43.11382,-89.363653\r
1375,North at Hoard,43.10486,-89.351002\r
1379,Fordem at McGuire,43.101124,-89.363887\r
1380,Aberg at Loftsgordan,43.114291,-89.357255\r
1384,Atwood at Division,43.092854,-89.351681\r
1391,Atwood at Ohio,43.093675,-89.346679\r
1394,Commercial at North,43.106929,-89.35163\r
1397,E Johnson at N Blount,43.082051,-89.37941\r
1427,Packers at Commercial,43.107091,-89.354359\r
1435,Commercial at North,43.106714,-89.351445\r
0146,Fish Hatchery at Midland,43.053981,-89.399186\r
1462,Milwaukee at N Fair Oaks,43.099808,-89.332508\r
0147,W Olin at Hickory,43.053872,-89.391782\r
1472,Winnebago at Riverside,43.088784,-89.357909\r
1478,Walter at Richard,43.093134,-89.326923\r
1480,Williamson at S Blount,43.07691,-89.373734\r
1482,Milwaukee at N Marquette,43.10002,-89.341387\r
1504,Aberg at Ruskin,43.114329,-89.361825\r
1505,Jenifer at S Ingersoll,43.081151,-89.365311\r
1509,Williamson at S Blount,43.07717,-89.372784\r
1518,North at E Johnson,43.102845,-89.350325\r
0153,E Olin at Quann,43.052132,-89.38075\r
1533,Sherman at McGuire,43.101098,-89.365319\r
1536,Jenifer at S Paterson,43.078985,-89.368807\r
1559,Jenifer at S Few,43.082421,-89.36352\r
1561,N Sherman at Roth,43.111841,-89.363667\r
1577,Sherman at N Thornton,43.094439,-89.369906\r
1585,Commercial at Packers,43.106715,-89.354273\r
0161,S Broom at W Doty,43.070146,-89.387071\r
1615,Jenifer at S Paterson,43.078654,-89.368869\r
0162,S Park at Meriter,43.065091,-89.400997\r
1622,Atwood at Oakridge,43.092129,-89.336716\r
1635,North at E Johnson,43.103454,-89.350324\r
1636,E Gorham at N Ingersoll,43.08777,-89.373443\r
1643,Eastwood at Division,43.09254,-89.350706\r
M430,Williamsburg at Danville,43.023602,-89.484536\r
M431,Putnam at Sara,43.022882,-89.492048\r
M433,Williamsburg at Prairie,43.022875,-89.488496\r
M434,Williamsburg at Prairie,43.02309,-89.488681\r
M435,Williamsburg at Danville,43.023369,-89.484684\r
M436,Putnam at Sara,43.023097,-89.492233\r
1645,Williamson at Rogers,43.087343,-89.358898\r
0166,Rimrock at John Nolen,43.04649,-89.374805\r
M603,Tramore at Darien,43.081891,-89.51659\r
M607,Darien at Tramore,43.081873,-89.516244\r
1664,E Gorham at N Blount,43.082741,-89.380595\r
M641,Mid Town at Dewberry,43.031376,-89.522406\r
M649,Mica at Flagstone,43.025964,-89.528863\r
M672,Mid Town at Dewberry,43.031591,-89.522209\r
M678,Mid Town at Province Hill,43.03164,-89.517225\r
1675,E Johnson at N Fourth,43.098301,-89.35669\r
M800,Tanglewood at McKee,43.015426,-89.505498\r
M804,Stonebridge at Mammoth,43.002373,-89.506937\r
M805,Stonebridge at Avalon,43.00428,-89.506582\r
M806,Mammoth at East Pass,43.006122,-89.509828\r
M807,Stonebridge at Drumlin,43.002034,-89.506518\r
M809,Country Grove at Westbourne,43.010874,-89.513016\r
M813,Gladstone at Tucson,43.023417,-89.51133\r
M814,McKenna at Raymond,43.031456,-89.49709\r
M815,Tucson at Lindemann,43.020193,-89.512399\r
M818,McKenna at Pilgrim,43.027311,-89.496963\r
1682,Atwood at Ohio,43.093837,-89.346939\r
M820,East Pass at Stonebridge,43.006858,-89.508164\r
M826,East Pass at Woodstone,43.010018,-89.507613\r
M827,McKee at S High Point,43.015803,-89.518067\r
M830,S High Point at Stratton,43.018908,-89.518935\r
M832,S High Point at Raymond,43.025435,-89.518068\r
M833,Manchester at Tiller,43.008308,-89.492946\r
M835,East Pass at Tanglewood,43.012285,-89.504593\r
M836,Gladstone at Tucson,43.023587,-89.511305\r
M842,Country Grove at Westbourne,43.011285,-89.5133\r
M843,Fairhaven at Dolphin,43.003543,-89.497554\r
M844,Maple Grove at Carnwood,43.020255,-89.498916\r
M845,Canterbury at Waltham,43.025481,-89.502956\r
M847,Canterbury at Pilgrim,43.028158,-89.502885\r
M849,Mammoth at Field Crest,43.007329,-89.513147\r
M852,Lancaster at McKenna,43.022455,-89.503076\r
M855,McKee at Snowy,43.01576,-89.515279\r
M857,East Pass at Stonebridge,43.006867,-89.507818\r
M858,S High Point at Snowmist,43.02171,-89.519\r
M859,East Pass at Woodstone,43.009839,-89.50739\r
M863,S High Point at Stratton,43.018631,-89.518465\r
M864,Tucson at Lindemann,43.020408,-89.512547\r
M868,Maple Grove at Putnam,43.022708,-89.49887\r
M869,S High Point at Raymond,43.025659,-89.51792\r
M870,East Pass at Artic Fox,43.002451,-89.512129\r
M873,S High Point at Snowmist,43.021711,-89.518704\r
M874,East Pass at Tanglewood,43.012383,-89.504816\r
M875,Mammoth at East Pass,43.005899,-89.509975\r
M876,Fairhaven at Dolphin,43.003758,-89.497172\r
M877,East Pass at Artic Fox,43.002558,-89.511833\r
M878,Canterbury at Raymond,43.031408,-89.502124\r
M880,Canterbury at Pilgrim,43.028023,-89.503181\r
M882,Canterbury at Waltham,43.025633,-89.503215\r
M884,Stonebridge at Frosted Leaf,43.004692,-89.506878\r
M885,Maple Grove at Putnam,43.022843,-89.498574\r
M886,McKee at Snowy,43.015966,-89.514897\r
M889,Tiller at Manchester,43.007869,-89.492958\r
M890,Cosgrove at Tonkinese,43.00522,-89.491685\r
M891,Field Crest at Mammoth,43.007723,-89.513172\r
M892,Cosgrove at Dallas,43.004341,-89.494274\r
M895,Tiller at Cosgrove,43.008041,-89.489801\r
M896,Country Grove at McKee,43.015521,-89.511566\r
M897,S High Point at McKee,43.016376,-89.518228\r
M898,McKee at Muir Field,43.015897,-89.511801\r
1692,Fordem at McGuire,43.100578,-89.364196\r
F060,Fish Hatchery at Catalpa,43.041645,-89.404114\r
1704,E Johnson at N Sixth,43.100618,-89.354007\r
1707,Fordem at E Johnson,43.093603,-89.363498\r
1715,N Sherman at Oxford,43.109495,-89.363707\r
1717,N Sherman at Fordem,43.103622,-89.363835\r
1718,Atwood at S Fair Oaks,43.093958,-89.341283\r
0173,W Badger at Cypress,43.03843,-89.397946\r
L328,Dream at Siggelkow,43.026477,-89.282309\r
L343,Roanne at Marsh,43.029757,-89.285658\r
0174,S Park at Fish Hatchery,43.056451,-89.398716\r
1746,Milwaukee at Corry,43.100112,-89.34503\r
1748,Milwaukee at Farwell,43.100148,-89.346561\r
1750,Jenifer at S Few,43.082752,-89.363446\r
1751,Milwaukee at S Fair Oaks,43.099405,-89.331817\r
1759,Aberg at Ruskin,43.114105,-89.361072\r
1766,North at Hoard,43.105084,-89.351397\r
1767,N Baldwin at E Johnson,43.089783,-89.369317\r
L703,Cottontail at McLean,43.08002,-89.272384\r
L714,McLean at Fredericksburg,43.084176,-89.273968\r
L716,McLean at Cottontail,43.080271,-89.272396\r
L717,Cottontail at Lynchburg,43.078197,-89.275129\r
L718,Cottontail at Lynchburg,43.078528,-89.275054\r
L747,Portland at Walbridge,43.096516,-89.312149\r
L749,Diamond at Portland,43.097792,-89.307442\r
L753,Diamond at Crystal,43.097609,-89.303626\r
L770,Portland at Walbridge,43.096749,-89.312531\r
L788,Portland at Diamond,43.098195,-89.308046\r
L792,Diamond at Crystal,43.097959,-89.303823\r
1780,E Johnson at N First,43.094122,-89.362695\r
1785,Walter at Hargrove,43.091433,-89.327382\r
1786,Walter at Dawes,43.095847,-89.326808\r
1787,S Pinckney at E Main,43.075033,-89.382303\r
L914,Walbridge at Alvarez,43.099614,-89.313317\r
L921,Wittwer at Milwaukee,43.09886,-89.310157\r
L923,Wittwer at Walbridge,43.102728,-89.311274\r
1798,E Johnson at N Dickinson,43.09091,-89.367254\r
1809,Walter at Richard,43.093268,-89.326626\r
0181,S Park at Cedar,43.052252,-89.394806\r
1812,E Johnson at N Third,43.097057,-89.358741\r
1830,Winnebago at S First,43.090431,-89.356623\r
1831,E Johnson at N Blair,43.08079,-89.381201\r
1834,E Gorham at N Paterson,43.085229,-89.377062\r
1837,Williamson at S Blair,43.076016,-89.375229\r
0184,Linden at Henry,43.075227,-89.410055\r
1843,E Johnson at N First,43.094265,-89.361707\r
1848,Milwaukee at Starkweather,43.099956,-89.338929\r
1855,Milwaukee at S Bryan,43.099667,-89.335459\r
1877,Aberg at N Sherman,43.114124,-89.363344\r
1878,Jenifer at S Ingersoll,43.081482,-89.365249\r
1886,Milwaukee at Walter,43.098287,-89.326946\r
1890,Walter at Hargrove,43.091353,-89.327851\r
1892,E Johnson at Fordem,43.092789,-89.364524\r
1894,Atwood at Waubesa,43.093996,-89.343913\r
1895,Aberg at Loftsgordan,43.114077,-89.357811\r
1901,Winnebago at S First,43.090439,-89.356277\r
1919,Milwaukee at Starkweather,43.099741,-89.338744\r
1922,N Sherman at Aberg,43.113954,-89.36395\r
1923,N Sherman at Commercial,43.106675,-89.363771\r
1935,Winnebago at Riverside,43.088632,-89.357687\r
1944,E Johnson at North,43.103034,-89.350794\r
1949,E Johnson at N Sixth,43.100287,-89.354069\r
0195,S Park at Crosswalk,43.04705,-89.393808\r
1959,Jenifer at S Brearly,43.080193,-89.366695\r
1963,Atwood at Winnebago,43.091952,-89.354794\r
1975,Milwaukee at S Marquette,43.099814,-89.34177\r
1996,E Gorham at N Livingston,43.084003,-89.378804\r
2007,Observatory at Walnut,43.076436,-89.424388\r
2014,Lake Mendota at Lot R,43.089239,-89.43376\r
2018,Eagle Heights at Lot E,43.086293,-89.435043\r
2023,Marsh at Highland,43.0788,-89.429795\r
2026,Eagle Heights at Lot F,43.086248,-89.436661\r
2027,University Bay at Lot 60,43.080259,-89.428067\r
0203,Rimrock at E Rusk,43.043214,-89.376979\r
2034,Lake Mendota at Eagle Heights,43.086445,-89.433772\r
2039,Lake Mendota at Lot N,43.089158,-89.438057\r
2041,Lake Mendota at University Bay,43.084252,-89.433487\r
2048,Lake Mendota at University Bay,43.084386,-89.433784\r
2050,University Bay at Lot 76,43.080886,-89.428351\r
2053,Walnut at Observatory,43.077045,-89.424906\r
2054,Eagle Heights at Lot M,43.086668,-89.441612\r
2061,Lake Mendota at Lot P,43.089784,-89.437007\r
2070,University at Ridge,43.075065,-89.439054\r
2071,Lake Mendota at Lot Q,43.090501,-89.435587\r
2076,Marsh at Lot 76,43.079006,-89.429203\r
2082,Eagle Heights at Shelter,43.086328,-89.438587\r
2088,Observatory at Walnut,43.076759,-89.42577\r
2091,Observatory at Highland,43.076973,-89.428499\r
2105,Odana at Frederick,43.050928,-89.444318\r
2112,Monroe at Glenway,43.052792,-89.435692\r
F221,Eau Claire at Regent,43.069331,-89.463074\r
2125,Highland at Observatory,43.077349,-89.428844\r
2131,University Bay at University,43.074207,-89.433585\r
2133,Mineral Point at S Owen,43.060632,-89.447048\r
2134,Mineral Point at Toepfer,43.060857,-89.44179\r
2137,Speedway at Hillcrest,43.064287,-89.433768\r
F218,Regent at Eau Claire,43.069017,-89.463666\r
2145,Observatory at Babcock,43.076319,-89.412882\r
2146,University at Forest,43.072801,-89.421956\r
2161,Tokay at Hilltop,43.05345,-89.45877\r
2164,Regent at N Allen,43.06803,-89.424141\r
0217,S Park at W Washington,43.063668,-89.400528\r
2171,N Franklin at University,43.073965,-89.436091\r
2175,Sheboygan at Eau Claire,43.072912,-89.463496\r
2177,Kendall at Ridge,43.07127,-89.43846\r
2184,Sheboygan at N Segoe,43.073101,-89.457163\r
F291,University at N Midvale,43.075108,-89.450497\r
2192,University at Walnut,43.072425,-89.425511\r
2195,Observatory at Elm,43.076347,-89.416104\r
2197,University at Norman,43.082424,-89.475082\r
F201,Regent at S Whitney,43.067897,-89.467949\r
2204,Bluff at N Blackhawk,43.069594,-89.446138\r
2205,Old Middleton at Gettle,43.074143,-89.473804\r
2213,S Midvale at Odana,43.050399,-89.450858\r
0222,Fisher at Bram,43.045474,-89.391946\r
2220,Old Middleton at N Whitney,43.074128,-89.467928\r
2222,Tokay at Charles,43.053764,-89.454673\r
2226,Tokay at U W Health,43.053795,-89.470395\r
2231,Speedway at S Franklin,43.06246,-89.436187\r
2236,Old Middleton at Gettle,43.074358,-89.473804\r
2240,Marsh at Lot 60,43.078988,-89.426659\r
2250,Mineral Point at S Segoe,43.060997,-89.458083\r
0226,Regent at La Mariposa,43.067821,-89.39749\r
2263,Mineral Point at S Midvale,43.060712,-89.450628\r
2264,Bluff at Crosswalk,43.070311,-89.442139\r
2265,Odana at Huron,43.051269,-89.439554\r
2267,Observatory at Colwood,43.076382,-89.420425\r
2274,Tokay at Hilltop,43.053772,-89.4584\r
2323,Tokay at S Segoe,43.053483,-89.466002\r
F237,N Midvale at Regent,43.068501,-89.45089\r
2338,S Segoe at Regent,43.068733,-89.454754\r
F245,Old Middleton at N Highlands,43.079871,-89.480488\r
2346,S Midvale at Midvale School,43.057265,-89.451354\r
2349,Highland at Marsh,43.078388,-89.430227\r
F255,Capital at Old Middleton,43.082583,-89.481885\r
2357,Odana at Anthony,43.05057,-89.447069\r
F260,Old Middleton at N Highlands,43.080049,-89.480883\r
F262,N Midvale at Hilldale Row,43.072422,-89.45141\r
2374,Speedway at S Franklin,43.062845,-89.436064\r
2376,Sheboygan at Eau Claire,43.073082,-89.46373\r
2377,Regent at Highland,43.067841,-89.42777\r
2388,Monroe at Knickerbocker,43.057036,-89.429336\r
2389,Monroe at Leonard,43.060885,-89.423091\r
2393,Highland at V A Hospital,43.073822,-89.42861\r
2395,Sheboygan at N Segoe,43.072904,-89.456953\r
2398,N Whitney at University,43.075999,-89.467966\r
F241,S Whitney at Mineral Point,43.061234,-89.471956\r
0241,Monroe at S Breese,43.066919,-89.413883\r
0243,John Nolen at Rimrock,43.047242,-89.374681\r
2433,Odana at S Midvale,43.050077,-89.450611\r
2442,Observatory at Colwood,43.076606,-89.420808\r
2470,Speedway at Glenway,43.061037,-89.438532\r
2473,Highland at Waisman,43.07811,-89.433141\r
2476,S Midvale at Tokay,43.053237,-89.451365\r
2487,Regent at S Midvale,43.068036,-89.450705\r
2491,S Segoe at Richland,43.063674,-89.456393\r
2494,N Franklin at University,43.073902,-89.436387\r
2496,Speedway at Hillcrest,43.064502,-89.433867\r
2497,Monroe at Commonwealth,43.058405,-89.426868\r
2505,Monroe at Glenway,43.053042,-89.434877\r
0251,S Park at Erin,43.060167,-89.40053\r
2519,Mineral Point at Berwyn,43.060799,-89.461292\r
0252,State at W Gorham,43.07491,-89.391303\r
2522,S Whitney at Odana,43.049676,-89.473749\r
2524,Monroe at Leonard,43.060679,-89.423844\r
2561,University at Highland,43.071996,-89.428227\r
2566,Monroe at S Prospect,43.063625,-89.419302\r
2576,University Bay at Marshall,43.0746,-89.433906\r
2590,S Midvale at Mineral Point,43.06056,-89.451356\r
2605,University at Walnut,43.072273,-89.424733\r
2608,Monroe at Spooner,43.065308,-89.416759\r
2615,Tokay at Charles,43.053451,-89.455055\r
2620,Highland at Marsh,43.078853,-89.430783\r
2628,S Segoe at Richland,43.064041,-89.456689\r
F234,S Midvale at Odana,43.049826,-89.451351\r
F268,Mineral Point at S Midvale,43.060945,-89.451652\r
2643,Highland at University,43.072479,-89.428535\r
F247,Mineral Point at S Segoe,43.060773,-89.457046\r
2655,S Midvale at Tokay,43.05389,-89.450872\r
2659,Speedway at Glenway,43.061081,-89.438051\r
F066,Fish Hatchery at S Park,43.056496,-89.399124\r
2665,S Whitney at Odana,43.050544,-89.473232\r
2670,S Whitney at Mineral Point,43.060536,-89.472313\r
2672,Speedway at Highland,43.06768,-89.429584\r
2691,Regent at Spooner,43.067725,-89.416364\r
2693,Regent at S Owen,43.067956,-89.447619\r
2700,Regent at N Prospect,43.067994,-89.42103\r
2702,Regent at Vista,43.068056,-89.426437\r
2709,S Midvale at Midvale School,43.057561,-89.450848\r
0271,Regent at S Park,43.067544,-89.40049\r
2711,S Segoe at Mineral Point,43.06114,-89.457293\r
2717,University at Forest,43.072703,-89.421178\r
2718,Old Middleton at N Rosa,43.074921,-89.477595\r
2725,Bluff at Crosswalk,43.070329,-89.441558\r
0273,Regent at La Mariposa,43.067436,-89.397367\r
2734,Mineral Point at S Owen,43.060847,-89.447233\r
2737,Mineral Point at Toepfer,43.060642,-89.441494\r
0274,W Washington at N Broom,43.071248,-89.389243\r
F271,N Midvale at Heather,43.071626,-89.450903\r
2742,Bluff at Ridge,43.071377,-89.439275\r
2753,Monroe at Chapman,43.055128,-89.431743\r
2762,Regent at N Owen,43.068171,-89.447236\r
2770,Highland at Waisman,43.078226,-89.433511\r
2773,Regent at Vista,43.067824,-89.426054\r
2775,Bluff at N Blackhawk,43.069379,-89.445953\r
2787,Old Middleton at N Whitney,43.073886,-89.468088\r
2790,University at N Whitney,43.076572,-89.467794\r
F278,S Whitney at Regent,43.067735,-89.468665\r
2806,University at Princeton,43.073321,-89.418215\r
F212,N Midvale at University,43.074804,-89.451399\r
2820,University at University Bay,43.073607,-89.433498\r
2822,Highland at V A Hospital,43.074458,-89.428968\r
2829,Mineral Point at Racine,43.060807,-89.465118\r
2836,Monroe at Chapman,43.05494,-89.432471\r
2850,Regent at Spooner,43.067958,-89.417191\r
2856,Monroe at Commonwealth,43.058173,-89.427621\r
0288,S Park at Erin,43.059621,-89.400999\r
2881,University Bay at Picnic Point,43.084225,-89.429092\r
2883,Monroe at Knickerbocker,43.057053,-89.428855\r
2885,Monroe at Van Buren,43.063983,-89.418327\r
0289,W Olin at Gilson,43.053844,-89.389869\r
2890,Mineral Point at Westmorland,43.060848,-89.443506\r
2892,University at Norman,43.0822,-89.475316\r
2899,Regent at S Allen,43.067806,-89.423388\r
2910,Odana at Huron,43.051493,-89.439394\r
2916,Highland at Observatory,43.076794,-89.42919\r
2921,University at Princeton,43.073222,-89.417438\r
2923,University at N Segoe,43.075152,-89.45625\r
2925,S Whitney at Science,43.056418,-89.472755\r
2938,University Bay at Picnic Point,43.084145,-89.428759\r
2939,Tokay at U W Health,43.053473,-89.470482\r
2945,University at Ridge,43.074573,-89.438473\r
2949,Regent at S Prospect,43.067779,-89.420845\r
2965,Kendall at N Franklin,43.071368,-89.436436\r
2972,Tokay at S Midvale,43.053747,-89.451649\r
2978,Observatory at Elm,43.076561,-89.416289\r
0298,Babcock at Linden,43.07529,-89.412894\r
2980,Mineral Point at Berwyn,43.061005,-89.46102\r
2984,S Whitney at Science,43.056023,-89.473507\r
2996,Observatory at Babcock,43.076534,-89.413067\r
2998,Kendall at N Franklin,43.071583,-89.436621\r
0300,Erin at S Mills,43.059989,-89.40385\r
0305,W Olin at Colby,43.052912,-89.383686\r
3105,Nichols at Monona Center,43.063089,-89.340949\r
3112,Nichols at McKenna,43.06245,-89.335778\r
3143,Dean at Shore Acres,43.069197,-89.331585\r
3150,E Broadway at Park And Ride,43.048092,-89.304921\r
3153,Owl Creek at Voges,43.040575,-89.28935\r
3155,Rimrock at Anderberg,43.028417,-89.382306\r
3163,South Towne at Industrial,43.040035,-89.354352\r
3195,Dutch Mill at Park And Ride,43.047429,-89.304367\r
0320,Fisher at Dane,43.04312,-89.392033\r
3207,Pheasant Ridge at E Badger,43.037147,-89.384534\r
3222,Rimrock at Maloney,43.031309,-89.381281\r
3231,Rimrock at Kent,43.033681,-89.380329\r
3240,W Broadway at Falcon,43.047558,-89.330133\r
3252,Moorland at Fell,43.035011,-89.370828\r
3259,Moorland at Rimrock,43.035516,-89.379427\r
0327,Regent at S Mills,43.067598,-89.403675\r
F373,Valor at Star Spangled,43.027475,-89.295285\r
3300,W Broadway at Bridge,43.047251,-89.340067\r
F331,Freese at Siggelkow,43.026762,-89.289833\r
3351,W Broadway at Bridge,43.046892,-89.339327\r
0336,N Randall at Engineering,43.072028,-89.409136\r
3368,W Broadway at Hoboken,43.047354,-89.347792\r
3371,Ski at Novation,43.031767,-89.38587\r
3393,Deer Valley at Pheasant Ridge,43.03464,-89.38519\r
3429,Moorland at Fell,43.034778,-89.370693\r
3432,Femrite at Dairy,43.051639,-89.296412\r
3448,Rimrock at Anderberg,43.028238,-89.382652\r
3450,W Broadway at W P S,43.047317,-89.344991\r
3457,South Towne at Royal,43.042308,-89.354115\r
F387,Valor at Eagles Perch,43.031996,-89.294943\r
3491,Marsh at Voges,43.041029,-89.286635\r
3500,E Badger at Rimrock,43.038416,-89.379635\r
3513,Moorland at Badger,43.035406,-89.374603\r
3517,Agriculture at Tradewinds,43.045554,-89.290241\r
3518,Moorland at Manor,43.03292,-89.358147\r
3527,Rimrock at Moorland,43.035927,-89.379538\r
0353,W Badger at Fish Hatchery,43.038494,-89.403362\r
3546,Dutch Mill at Ellestad,43.049316,-89.302007\r
3550,Nichols at Monona Center,43.063267,-89.340529\r
3572,Rimrock at Maloney,43.031228,-89.381601\r
3588,Moorland at Wayland,43.033613,-89.366314\r
F392,Brandenburg at Freese,43.028797,-89.291914\r
0360,S Park at W Olin,43.054114,-89.396841\r
3600,Pheasant Ridge at Deer Valley,43.034891,-89.385152\r
3615,W Broadway at Frazier,43.046944,-89.351322\r
F320,Marsh at Voges,43.040483,-89.286944\r
3630,W Broadway at Frazier,43.047025,-89.352309\r
0367,W Olin at Lake,43.053682,-89.386709\r
3732,Rimrock at Moorland,43.035471,-89.380155\r
3733,W Broadway at W P S,43.046949,-89.343881\r
F340,Marsh at Yesterday,43.035434,-89.286892\r
3772,South Towne at Royal,43.042622,-89.354584\r
3787,Rimrock at E Badger,43.038595,-89.378636\r
0379,John Nolen at E Olin,43.051603,-89.377887\r
3821,Ski at Deer Valley,43.033325,-89.388003\r
3827,Great Gray at Owl Creek,43.036424,-89.291875\r
3832,Moorland at Badger,43.035621,-89.374788\r
3841,W Broadway at Hoboken,43.047005,-89.34704\r
0039,N Lake at W Johnson,43.071895,-89.397341\r
3901,Nichols at Winnequah,43.06489,-89.344218\r
0391,Fish Hatchery at Carver,43.044438,-89.403805\r
3913,Moorland at Wayland,43.033371,-89.366314\r
3931,W Broadway at Falcon,43.047262,-89.329356\r
3941,Moorland at Manor,43.032705,-89.357851\r
3946,Pheasant Ridge at Quail Run,43.037379,-89.384682\r
3962,Deer Valley at Ski,43.033504,-89.388238\r
3968,Rimrock at Kent,43.033484,-89.38086\r
0398,Regent at N Randall,43.067877,-89.409353\r
3980,South Towne at Industrial,43.039892,-89.354747\r
0405,Fish Hatchery at Catalpa,43.041851,-89.403818\r
0406,Regent at N Breese,43.067931,-89.414278\r
4100,W Badger at South Transfer,43.038895,-89.394824\r
4120,E Cheryl at Lacy,43.00672,-89.391581\r
4129,Nakoma at Waban,43.041188,-89.44714\r
4137,E Cheryl at Crinkle Root,43.006722,-89.3994\r
4139,Beltline S at Grandview,43.035057,-89.4329\r
4160,E Verona at Maple Grove,42.994627,-89.512341\r
4175,Fish Hatchery at Ochalla,43.028889,-89.410668\r
4179,Verona E at Atticus,43.033406,-89.456329\r
0418,W Washington at N Bedford,43.069002,-89.392429\r
F482,High Ridge at Cahill,43.022023,-89.419045\r
4187,Todd at Pelham,43.029668,-89.42488\r
4188,Fish Hatchery at Traceway,43.023947,-89.415295\r
4192,Fish Hatchery at Emil,43.036793,-89.405423\r
4193,E Cheryl at Big Bluestem,43.00674,-89.403507\r
4194,E Cheryl at Woods Hollow,43.005014,-89.420033\r
4200,Fitchrona at Target,43.013488,-89.480827\r
4201,Fitchrona at Hy-Vee,43.013846,-89.480531\r
4210,Post at Leopold,43.026633,-89.423943\r
4216,Todd at Post,43.026974,-89.42625\r
4219,Todd at Beltline S,43.034153,-89.422808\r
4224,Greenway at Coho,43.031029,-89.414468\r
4240,McKee at Commerce Park,43.015615,-89.467717\r
4245,E Cheryl at Woods Hollow,43.004808,-89.420637\r
4253,Lacy at E Cheryl,43.006801,-89.39073\r
4257,Nakoma at Huron,43.048539,-89.438332\r
4261,E Verona at S Main,42.990502,-89.533087\r
4263,Verona E at Britta,43.035313,-89.453899\r
4295,Red Arrow at Verona E,43.032475,-89.457735\r
4310,W Verona at Legion,42.989314,-89.540273\r
4325,Coho at Post,43.02717,-89.414789\r
4326,Verona W at Summit,43.035017,-89.457576\r
F442,S Midvale at Cherokee,43.042198,-89.451385\r
4343,E Cheryl at No Oaks,43.007043,-89.395071\r
4346,Nakoma at Waban,43.041232,-89.447486\r
4347,Nakoma at Seminole,43.044044,-89.443476\r
4354,S Midvale at Nakoma,43.038564,-89.451408\r
F455,S Midvale at Nakoma,43.039307,-89.450853\r
F460,Grandview at Beltline S,43.03486,-89.43369\r
4368,Verona at Highway Ramp,43.035913,-89.454368\r
4373,Greenway at Bryant,43.031136,-89.410841\r
4377,Beltline S at Landmark,43.03469,-89.428335\r
4379,Fitchrona at McKee,43.016057,-89.480533\r
0438,Linden at N Charter,43.074985,-89.406401\r
4382,Nakoma at Huron,43.048243,-89.439035\r
4401,Northern Lights at Epic Staff C,42.996855,-89.563863\r
4412,Beltline S at Grandview,43.035263,-89.43311\r
4430,Beltline S at Whenona,43.034651,-89.448468\r
4435,Lacy at Central Park,43.009136,-89.388225\r
F437,Verona E at Red Arrow,43.032331,-89.457994\r
4443,Fish Hatchery at Greenway,43.031708,-89.408657\r
4446,Allied at Jenewein,43.028714,-89.459571\r
4456,Verona E at Britta,43.035036,-89.454664\r
4457,E Verona at Maple Grove,42.994438,-89.513007\r
F466,Grandview at Kingston,43.029686,-89.431851\r
0448,Rimrock at E Rusk,43.04248,-89.377683\r
4481,Verona W at Summit,43.034006,-89.457341\r
4485,McKee at Fitchrona,43.015547,-89.480286\r
4494,Verona W at Beltline S,43.035994,-89.454726\r
4500,Red Arrow at Thurston,43.030944,-89.456698\r
4501,Nakoma at Mohawk,43.039012,-89.450002\r
4510,Fitchrona at McKee,43.01526,-89.480816\r
4519,W Verona at Half Mile,42.988306,-89.545956\r
4520,E Cheryl at Agrace,43.005095,-89.417024\r
4523,Fish Hatchery at Post,43.026722,-89.41226\r
4526,Post at Todd,43.027072,-89.425966\r
4539,Beltline S at Seminole,43.034367,-89.443227\r
4541,Fitchrona at Kapec,43.018594,-89.475199\r
4547,Allied at Jenewein,43.028831,-89.459251\r
F451,S Midvale at Cherokee,43.042324,-89.450879\r
4552,E Cheryl at No Oaks,43.007249,-89.394689\r
4554,Post at Coho,43.027009,-89.415332\r
4555,W Verona at West End,42.987718,-89.552773\r
4556,E Verona at Enterprise,42.99287,-89.526778\r
0456,Fish Hatchery at Carver,43.044304,-89.404113\r
4560,Beltline S at Seminole,43.034554,-89.443979\r
4572,Todd at Pelham,43.029999,-89.425016\r
0459,Erin at S Mills,43.059774,-89.403665\r
4613,Post at Traceway,43.026589,-89.419082\r
0462,W Badger at Overpass,43.038517,-89.388457\r
4622,Fish Hatchery at Greenway,43.031136,-89.409595\r
4623,E Verona at Enterprise,42.992557,-89.526432\r
4637,Fish Hatchery at Traceway,43.024198,-89.414469\r
4639,Todd at Greenway,43.031521,-89.423091\r
F443,S Whitney at Kroncke,43.027545,-89.475115\r
4648,E Cheryl at Crinkle Root,43.007017,-89.399585\r
F454,S Whitney at Kroncke,43.027876,-89.475596\r
F463,Allied at Thurston,43.031167,-89.458882\r
4684,McKee at Fish Hatchery,43.015703,-89.425188\r
4688,Beltline S at Underpass,43.035943,-89.452355\r
0469,W Washington at Southwest,43.067543,-89.394121\r
0470,N Bassett at W Dayton,43.071625,-89.39286\r
4707,Fish Hatchery at Caddis,43.019436,-89.418898\r
4719,Beltline S at Underpass,43.035578,-89.451587\r
4722,E Cheryl at Big Bluestem,43.007054,-89.40368\r
0473,W Washington at S Bassett,43.070228,-89.390293\r
4732,W Verona at N Main,42.990501,-89.534012\r
4739,Greenway at Coho,43.030814,-89.414283\r
0475,S Park at Buick,43.041625,-89.393786\r
4751,Verona W at Beltline S,43.036074,-89.45427\r
4752,Fish Hatchery at Post,43.026329,-89.413136\r
4755,McKee at Commerce Park,43.015257,-89.467027\r
4761,Beltline S at Whenona,43.03461,-89.448759\r
4767,Lacy at S Fish Hatchery,43.001102,-89.42742\r
4777,Verona at Highway Ramp,43.036334,-89.452935\r
F488,Royal Wulff at High Ridge,43.021226,-89.421599\r
4790,Fish Hatchery at Greenway,43.031977,-89.40899\r
4791,Allied at Lovell,43.027076,-89.459546\r
4798,Verona E at Atticus,43.033666,-89.455922\r
0480,W Gorham at N Henry,43.075322,-89.391155\r
4801,Research Park at Lacy,43.001541,-89.425311\r
4812,W Verona at West End,42.98804,-89.553476\r
4818,Todd at Greenway,43.031844,-89.423215\r
4826,Post at Traceway,43.026759,-89.419835\r
4836,Fitchrona at King James,43.019032,-89.474097\r
4837,Post at Leopold,43.026356,-89.423227\r
4838,E Verona at Hometown,42.994093,-89.519406\r
4841,Beltline S at Todd,43.03486,-89.423054\r
4844,Fish Hatchery at Ochalla,43.028566,-89.411458\r
4845,Fish Hatchery at Emil,43.036793,-89.40493\r
4848,Nakoma at Seminole,43.043757,-89.444217\r
4861,Red Arrow at Thurston,43.031589,-89.456538\r
4876,Beltline S at Curry,43.035156,-89.425127\r
0488,Linden at N Charter,43.0752,-89.407339\r
4886,Greenway at Bryant,43.031243,-89.411149\r
4887,Research Park at E Cheryl,43.004907,-89.425163\r
4889,E Verona at Hometown,42.993736,-89.51906\r
0049,N Lake at Langdon,43.075529,-89.397191\r
0490,N Charter at W Johnson,43.072299,-89.405883\r
4905,W Verona at Legion,42.989036,-89.540667\r
F414,Grandview at Sandwood,43.026982,-89.431505\r
4918,W Verona at Half Mile,42.988503,-89.546165\r
0492,John Nolen at Lakeside,43.055713,-89.381932\r
4941,Fish Hatchery at High Ridge,43.021316,-89.417158\r
F445,Post at Todd,43.026741,-89.426126\r
F453,Post at Coho,43.026767,-89.414579\r
0496,Koster at Ardmore,43.044148,-89.385493\r
4968,Beltline S at Landmark,43.034959,-89.428619\r
4970,Lacy at Central Park,43.008966,-89.389002\r
4971,E Cheryl at Agrace,43.004889,-89.416543\r
4983,Fish Hatchery at McKee,43.015452,-89.424177\r
4984,Fitchrona at Kapec,43.018924,-89.476255\r
0499,Fish Hatchery at W Badger,43.038914,-89.403757\r
0005,W Dayton at N Orchard,43.070947,-89.406982\r
F515,Northland at Mandrake,43.14502,-89.378184\r
5109,Northport at Dryden,43.12877,-89.358748\r
0512,W Washington at N Bassett,43.069986,-89.391021\r
5125,N Sherman at Logan,43.116255,-89.363627\r
5142,Troy at Forster,43.133799,-89.373212\r
5143,Packers at International,43.121883,-89.354777\r
5149,Northport at Troy,43.133843,-89.371235\r
5162,N Sherman at Northport,43.130277,-89.363664\r
5164,Northport at Dryden,43.129128,-89.358711\r
F573,School at Fulton,43.143723,-89.382732\r
5178,Troy at Goodland,43.133855,-89.377734\r
0519,S Park at Fish Hatchery,43.057212,-89.398803\r
5193,N Sherman at Schlimgen,43.118762,-89.3636\r
5197,Troy at Green,43.134773,-89.396996\r
0052,Observatory at N Charter,43.076131,-89.40566\r
5203,Green at Meadow Ridge,43.137513,-89.397687\r
5228,Packers at Manley,43.123674,-89.355343\r
5244,Packers at Tennyson,43.1344,-89.355518\r
5260,Troy at Crosswalk,43.133856,-89.380576\r
F572,Havey at Kennedy,43.141173,-89.387664\r
F599,Wheeler at Delaware,43.148216,-89.375092\r
F030,Fish Hatchery at Cedar,43.051913,-89.399261\r
5304,N Sherman at Farragut,43.117446,-89.36391\r
0532,Linden at Babcock,43.075254,-89.412549\r
5320,Packers at Elka,43.125832,-89.355489\r
0533,Regent at S Breese,43.067725,-89.413451\r
5335,Tennyson at N Sherman,43.134771,-89.363178\r
5342,Troy at Karstens,43.133875,-89.386296\r
5346,Northport at Warner Park,43.132561,-89.367294\r
F547,Wheeler at Golf View,43.147541,-89.367122\r
F549,Wheeler at Comanche,43.148187,-89.371632\r
5358,N Sherman at Melrose,43.12289,-89.363794\r
5366,Northport at N Sherman,43.131002,-89.363774\r
0537,W Johnson at Wisconsin,43.076691,-89.387018\r
5382,N Sherman at Trailsway,43.126256,-89.363729\r
5397,Knutson at Northport,43.141738,-89.392569\r
5407,N Sherman at Melrose,43.123436,-89.363497\r
5411,Delaware at Dakota,43.143306,-89.368114\r
5420,Packers at Schlimgen,43.118418,-89.355287\r
5432,N Sherman at Lake View,43.137341,-89.363411\r
5433,Packers at Manley,43.123888,-89.354861\r
0546,S Park at Regent,43.067392,-89.401194\r
0548,Regent at N Mills,43.067822,-89.404428\r
F505,Havey at School,43.140939,-89.383141\r
5536,Troy at Lerdahl,43.133885,-89.389299\r
5546,Packers at Scott,43.132574,-89.355495\r
F056,Buick at Taft,43.04184,-89.392935\r
0561,N Park at W Dayton,43.070821,-89.400637\r
F525,School at Northland,43.145953,-89.382644\r
0564,W Wilson at S Henry,43.070692,-89.384195\r
0565,N Rusk at Nygard,43.041336,-89.384063\r
5657,Murphy at Green,43.138946,-89.396673\r
5663,Northport at Barby,43.137124,-89.380833\r
5683,N Sherman at Trailsway,43.126059,-89.363445\r
5715,Northport at Kennedy,43.139714,-89.38832\r
0573,Linden at Henry,43.075012,-89.409833\r
5733,Packers at Schlimgen,43.118633,-89.354829\r
5748,N Sherman at Schlimgen,43.11904,-89.363884\r
5777,Packers at Elka,43.125634,-89.354921\r
5796,Troy at School,43.133866,-89.38359\r
5815,Northport at Goodland,43.135743,-89.376621\r
0582,S Park at Crosswalk,43.046916,-89.394302\r
5823,N Sherman at Northside Town,43.128745,-89.363393\r
5835,North at Central Wisconsin,43.140754,-89.39519\r
5847,Delaware at Esch,43.144561,-89.370288\r
5856,Packers at International,43.121292,-89.355271\r
5865,Delaware at Tennessee,43.144938,-89.373735\r
5888,N Sherman at Sunfield,43.139194,-89.363335\r
5899,Northport at Warner Park,43.132149,-89.367295\r
0590,W Badger at Cypress,43.038645,-89.397699\r
F501,Kennedy at Havey,43.140931,-89.387887\r
0593,N Broom at W Dayton,43.073129,-89.391032\r
5950,Troy at Harper,43.133895,-89.393067\r
0060,Observatory at Bascom,43.075996,-89.40366\r
0061,W Dayton at N Mills,43.070893,-89.403698\r
6105,Watts at S High Point,43.051863,-89.517401\r
6106,Allen at Mendota,43.095966,-89.486157\r
6110,Valley Ridge at South Ridge,43.112731,-89.475179\r
6114,Fourier at Deming,43.085714,-89.527917\r
6115,Old Sauk at Everglade,43.075126,-89.497915\r
F619,N High Point at Old Sauk,43.075354,-89.518495\r
6123,Watts at S Burberry,43.050845,-89.513376\r
6128,Century at Marina,43.105761,-89.484684\r
6137,Excelsior at Deming,43.076553,-89.531014\r
F652,N High Point at Crosswalk,43.078004,-89.518906\r
6159,S Gammon at Odana,43.056859,-89.502622\r
6161,Old Sauk at Crestwood School,43.075134,-89.48157\r
6167,Century at Allen,43.104085,-89.488128\r
6169,Odana at Research Park,43.053448,-89.486217\r
6171,Allen at Marshall Park,43.094023,-89.485488\r
6176,Old Sauk at N Gammon,43.076717,-89.502201\r
6177,Branch at Maywood,43.100591,-89.493324\r
6180,Fourier at La Petite,43.08345,-89.526766\r
6184,S High Point at Tree,43.064361,-89.517529\r
6188,Odana at Research Park,43.053672,-89.486353\r
6189,Old Sauk at N High Point,43.074862,-89.518173\r
6192,Park at Elmwood,43.09627,-89.501877\r
6193,Watts at Commerce,43.054894,-89.522465\r
6199,Watts at Walmart,43.050366,-89.506983\r
6204,Watts at N Burberry,43.051158,-89.514142\r
6207,Century at Donna,43.106112,-89.49801\r
0621,John Nolen at Lakeside,43.056322,-89.381932\r
6223,Odana at Grand Canyon,43.056183,-89.49587\r
6233,Old Sauk at Ozark,43.075104,-89.488705\r
6237,Watts at Princeton Club,43.054081,-89.52081\r
6241,Odana at Potomac,43.054905,-89.491599\r
6243,University at Capital,43.084644,-89.477677\r
6246,Excelsior at Fourier,43.080291,-89.525045\r
6256,Parmenter at Donna,43.105585,-89.511052\r
6258,Excelsior at Crosswalk,43.079464,-89.529426\r
6261,Deming at Terrace,43.095244,-89.523437\r
6266,Odana at Potomac,43.05512,-89.491784\r
6269,S Gammon at Watts,43.050512,-89.502874\r
6279,Junction at U W Health,43.069647,-89.524622\r
6288,Century at Donna,43.106685,-89.498394\r
6290,S High Point at D'Onofrio,43.0565,-89.517851\r
6291,University at Allen,43.089287,-89.485669\r
6301,Allen at Mendota,43.096566,-89.485737\r
6304,Deming at Terrace,43.095477,-89.523721\r
6306,Branch at Maywood,43.100098,-89.493743\r
F639,Sawmill at N Westfield,43.079882,-89.509278\r
6318,Allen at Maywood,43.100218,-89.486543\r
6320,N Gammon at Sawmill,43.08088,-89.502452\r
6334,Heartland at Deming,43.076749,-89.531842\r
6340,Old Sauk at Ozark,43.075319,-89.489002\r
6342,Old Sauk at Samuel,43.075013,-89.53137\r
6350,West Towne Ring at West Towne Mall,43.057423,-89.504005\r
6357,Odana at Burlington Coat,43.056503,-89.499795\r
6365,Junction at City Center West,43.072171,-89.525082\r
6368,Junction at Prairie Towne,43.065348,-89.52585\r
6382,Odana at Grand Canyon,43.056746,-89.496969\r
F685,Old Sauk at Junction,43.074703,-89.526506\r
6388,Century at Park,43.108948,-89.501496\r
6394,Parmenter at Lee,43.100929,-89.511565\r
6395,Branch at University,43.096704,-89.495246\r
6422,S Gammon at Odana,43.055462,-89.503262\r
6430,Junction at City Center West,43.07149,-89.525192\r
6439,Allen at University,43.090191,-89.485645\r
6455,S Junction at Watts,43.05592,-89.527329\r
6464,Watts at Walmart,43.050679,-89.50786\r
6473,S High Point at Mineral Point,43.060878,-89.517327\r
6476,J Q Hammons at Greenway,43.090865,-89.524776\r
6483,Old Sauk at Samuel,43.074682,-89.531184\r
6489,Century at Branch,43.104074,-89.492241\r
6504,Watts at Princeton Club,43.054332,-89.520489\r
6506,Old Sauk at Everglade,43.07534,-89.498211\r
F609,N High Point at Crosswalk,43.077789,-89.518597\r
6531,N High Point at Sauk Creek,43.072435,-89.519676\r
6539,S High Point at Tree,43.064361,-89.517233\r
6543,Park at South,43.093289,-89.501726\r
6560,Valley Ridge at Century,43.110546,-89.474893\r
6570,Old Sauk at Widgeon,43.075197,-89.513099\r
F675,N High Point at Tramore,43.081218,-89.519182\r
6582,Century at Baskerville,43.10793,-89.480227\r
F688,Old Sauk at N High Point,43.075184,-89.519025\r
6611,N Gammon at Fortune,43.088257,-89.501954\r
6625,Branch at Franklin,43.098012,-89.494235\r
6628,Century at Branch,43.104468,-89.493031\r
6630,Watts at S High Point,43.052131,-89.518462\r
6632,University at Mayflower,43.097176,-89.499248\r
6638,Odana at Town Center,43.056717,-89.500363\r
F640,N High Point at Tramore,43.081083,-89.519478\r
6642,Allen at Lake,43.102877,-89.486484\r
6650,Branch at Franklin,43.097904,-89.49463\r
6651,Century at Marina,43.105555,-89.484276\r
6653,Century at Baskerville,43.107715,-89.479831\r
6656,Deming at Murphy,43.098028,-89.523391\r
6663,Century at Northbrook,43.110978,-89.506378\r
6665,N High Point at Brule,43.068103,-89.51746\r
6667,J Q Hammons at Greenway,43.090507,-89.524479\r
6676,Century at Allen,43.104596,-89.4874\r
6678,Old Sauk at Crestwood School,43.07534,-89.481916\r
6683,Parmenter at Lee,43.101063,-89.511268\r
6684,Century at Northbrook,43.111398,-89.507119\r
6685,Odana at S Gammon,43.056484,-89.502325\r
6689,Fourier at J Q Hammons,43.08227,-89.524702\r
6691,Allen at Maywood,43.100371,-89.486074\r
6700,Old Sauk at Junction,43.075034,-89.527506\r
6706,Branch at Pheasant,43.103035,-89.493042\r
6720,Watts at Sky Ridge,43.050793,-89.511044\r
6721,Parmenter at Donna,43.106203,-89.510435\r
6733,Greenway at Deming,43.089941,-89.526664\r
6748,Junction at Mineral Point,43.061363,-89.52772\r
6784,Old Sauk at Yosemite,43.075316,-89.493952\r
6802,N Gammon at Fortune,43.088203,-89.502251\r
6803,Branch at Pheasant,43.102964,-89.492758\r
6805,Parmenter at Franklin,43.098449,-89.511339\r
6814,N High Point at Brule,43.06838,-89.517744\r
6818,Junction at U W Health,43.069288,-89.524954\r
6822,University at Branch,43.096829,-89.495938\r
6823,Fourier at Excelsior,43.080211,-89.52439\r
6827,S High Point at D'Onofrio,43.057181,-89.517544\r
6840,Junction at Old Sauk,43.074407,-89.527221\r
6842,Watts at Commerce,43.055243,-89.52328\r
6843,Excelsior at Crosswalk,43.079294,-89.52913\r
6852,Parmenter at Century,43.111119,-89.509787\r
F654,Sawmill at N Gammon,43.081265,-89.502663\r
6857,Old Sauk at Yosemite,43.075101,-89.493656\r
6863,Watts at S Junction,43.055401,-89.527081\r
6878,South Ridge at Highway Q,43.113117,-89.47198\r
6887,Park at Hubbard,43.095483,-89.501617\r
6891,University at Mayflower,43.096845,-89.498507\r
6894,Allen at Marshall Park,43.093745,-89.485932\r
6899,University at Park,43.096898,-89.501211\r
6900,Park at South,43.093155,-89.502022\r
6901,Century at Valley Ridge,43.110287,-89.474572\r
F610,Sawmill at N Westfield,43.080025,-89.509575\r
0692,University at N Breese,43.073517,-89.414277\r
6921,Old Sauk at N Gammon,43.076493,-89.501941\r
6923,Junction at Mineral Point,43.060781,-89.527262\r
6925,Junction at Prairie Towne,43.065214,-89.525368\r
6931,Fourier at La Petite,43.084041,-89.526841\r
6937,Old Sauk at N Westfield,43.075084,-89.50705\r
6938,Watts at S Gammon,43.050288,-89.503762\r
6944,Fourier at J Q Hammons,43.081661,-89.524417\r
6952,Odana at Tokay,43.051678,-89.481698\r
6958,Deming at J Q Hammons,43.09398,-89.525263\r
6972,N High Point at Old Sauk,43.074682,-89.518778\r
6973,Century at Parmenter,43.111397,-89.509071\r
6979,Watts at Sky Ridge,43.050525,-89.510821\r
6981,Deming at Fourier,43.086234,-89.528128\r
6983,Deming at J Q Hammons,43.0939,-89.524929\r
0706,N Charter at University,43.073767,-89.406352\r
0709,S Park at Burr Oak,43.044427,-89.39381\r
0710,S Bassett at W Washington,43.069834,-89.390515\r
7107,Turner at Pflaum,43.062496,-89.314067\r
7111,E Buckeye at Dondee,43.073193,-89.3017\r
7114,Monona at Buckeye,43.079604,-89.324201\r
7115,Turner at Allis,43.071118,-89.314004\r
F712,Dominion at Galileo,43.091704,-89.272766\r
F713,Buckeye at Monona,43.079577,-89.323571\r
7134,Wyalusing at Stockbridge,43.094385,-89.261214\r
7137,Dempsey at Cottage Grove,43.084173,-89.31612\r
F714,Acewood at Onyx,43.091645,-89.302377\r
7148,Milwaukee at Milky,43.099278,-89.279801\r
0715,S Park at Meriter,43.065378,-89.400515\r
F751,S Thompson at 1309,43.079683,-89.283323\r
F754,Merryturn at Kevins,43.088745,-89.29322\r
F756,Acewood at Starker,43.076981,-89.303514\r
F763,Dominion at Traveler,43.091575,-89.269679\r
7167,Milwaukee at Walbridge,43.098334,-89.313368\r
7169,Milwaukee at Dempsey,43.098186,-89.318296\r
7175,Milwaukee at Swanton,43.098717,-89.301055\r
F776,Acewood at Cottage Grove,43.083875,-89.303317\r
F718,Starker at Acewood,43.076981,-89.303045\r
F711,Acewood at Leo,43.081036,-89.302778\r
F786,S Thompson at Vondron,43.067408,-89.291248\r
F788,Starker at Angel Crest,43.07705,-89.30002\r
7198,Milwaukee at Milo,43.098855,-89.305069\r
7203,E Buckeye at Ellen,43.073358,-89.288052\r
7206,E Buckeye at Dondee,43.073346,-89.302483\r
7209,Milwaukee at Portland,43.09858,-89.30728\r
F721,Vondron at E Buckeye,43.073693,-89.291347\r
F724,Merryturn at Retana,43.091885,-89.291214\r
7215,Atwood at Cottage Grove,43.08409,-89.325022\r
L723,Vondron at S Thompson,43.06756,-89.291297\r
7226,Femrite at Agriculture,43.051751,-89.292043\r
F720,Merryturn at Sudbury,43.096102,-89.291095\r
7232,Pflaum at Groveland,43.062188,-89.320363\r
7235,E Buckeye at S Stoughton E,43.073082,-89.307965\r
7236,Milwaukee at Rustic,43.099652,-89.270143\r
7247,Buckeye at Turner,43.07366,-89.313778\r
7248,Milwaukee at Swanton,43.098923,-89.301426\r
F755,S Thompson at E Buckeye,43.073836,-89.282792\r
F758,North Star at Copernicus,43.089533,-89.27692\r
7263,Cottage Grove at S Thompson,43.084271,-89.286759\r
7269,Wyalusing at Dominion,43.091511,-89.26111\r
F782,Acewood at Leo,43.080867,-89.303272\r
7296,Atwood at Margaret,43.087494,-89.327412\r
0730,S Park at Burr Oak,43.044293,-89.394303\r
7302,Pflaum at Daniels,43.062526,-89.297454\r
7306,Dempsey at Rockwell,43.08796,-89.316484\r
F710,S Thompson at Milwaukee,43.098741,-89.288879\r
7324,E Buckeye at Vondron,43.073523,-89.291879\r
F725,S Thompson at Rustic Wood,43.07072,-89.281786\r
7326,Wyalusing at Summertown,43.096893,-89.261999\r
7328,Buckeye at Turner,43.073947,-89.314494\r
7331,Agriculture at Dairy,43.059425,-89.293646\r
7333,E Buckeye at S Thompson,43.07346,-89.282558\r
7334,Cottage Grove at North Star,43.084729,-89.280004\r
7335,E Buckeye at Twilight,43.073269,-89.298718\r
7341,Cottage Grove at Drexel,43.083657,-89.320121\r
F733,Starker at Angel Crest,43.076835,-89.299835\r
7348,Turner at Ruth,43.070061,-89.314438\r
7351,Pflaum at Camden,43.062145,-89.311315\r
0736,Fish Hatchery at Wingra,43.050122,-89.400212\r
F739,Acewood at Goldfinch,43.088431,-89.302617\r
7371,Milwaukee at North Star,43.099148,-89.275677\r
7374,Dempsey at Cottage Grove,43.083627,-89.316404\r
F777,Dominion at Galileo,43.091489,-89.272581\r
7381,Milwaukee at Daffodil,43.098794,-89.296733\r
7385,Agriculture at Femrite,43.051938,-89.291488\r
7391,Pflaum at Advance,43.06228,-89.302811\r
7392,Cottage Grove at Flora,43.084445,-89.299698\r
7398,Milwaukee at Dempsey,43.0984,-89.317925\r
7399,Dempsey at Gary,43.081576,-89.316099\r
7410,Cottage Grove at Atlas,43.08429,-89.307328\r
7412,Agriculture at Pflaum,43.06143,-89.293839\r
F745,North Star at Cottage Grove,43.084916,-89.279498\r
7417,Agriculture at World Dairy,43.056656,-89.29138\r
7419,Dempsey at Pinney,43.085838,-89.316154\r
0743,W Johnson at N Mills,43.072012,-89.403735\r
F743,North Star at Copernicus,43.089283,-89.276871\r
F747,Merryturn at Retana,43.092019,-89.290917\r
7458,Agriculture at Dairy,43.059255,-89.29388\r
7470,Milwaukee at Kurt,43.099058,-89.292793\r
7471,Cottage Grove at Meadowlark,43.084163,-89.295414\r
7473,Davies at Drexel,43.07882,-89.317128\r
7479,E Buckeye at Vondron,43.073326,-89.291002\r
7490,Dempsey at Gary,43.081362,-89.316396\r
7499,Pflaum at Seiferth,43.062222,-89.307748\r
0075,W Dayton at N Park,43.070839,-89.40002\r
F757,S Thompson at Grafton,43.076656,-89.282663\r
F735,Starker at Woodvale,43.076921,-89.295995\r
0752,E Gorham at N Butler,43.079833,-89.384745\r
7520,Pflaum at Camden,43.062351,-89.312068\r
F726,North Star at Orion,43.088291,-89.278947\r
F753,North Star at Dominion,43.091286,-89.274891\r
7532,Cottage Grove at Meadowlark,43.084468,-89.296352\r
7538,E Buckeye at S Stoughton E,43.073215,-89.307113\r
7540,Cottage Grove at S Thompson,43.084611,-89.286943\r
7544,E Buckeye at Woodvale,43.073474,-89.296187\r
7547,Milwaukee at S Thompson,43.098902,-89.28836\r
F750,S Thompson at Forge,43.066532,-89.283794\r
7552,Milwaukee at Daffodil,43.099009,-89.296918\r
7553,Milwaukee at S Sprecher,43.099396,-89.266167\r
7557,Buckeye at Lakeview,43.074908,-89.317615\r
7565,S Sprecher at Cottage Grove,43.085305,-89.266607\r
7567,Davies at Buckeye,43.077076,-89.319674\r
7569,Agriculture at Pflaum,43.061654,-89.293666\r
0757,N Charter at University,43.07417,-89.406055\r
7578,Turner at Buckeye,43.073535,-89.314284\r
7581,Wyalusing at Stockbridge,43.094036,-89.260845\r
7587,Milwaukee at Rustic,43.099311,-89.269884\r
F701,Starker at Vondron,43.076979,-89.291699\r
7604,Milwaukee at North Star,43.099345,-89.276244\r
7607,Cottage Grove at Dempsey,43.083796,-89.315886\r
7608,Cottage Grove at Acewood,43.084368,-89.30355\r
7610,E Buckeye at S Thompson,43.073658,-89.283311\r
7617,Pflaum at Daniels,43.062303,-89.297997\r
7619,Cottage Grove at Flora,43.084095,-89.299501\r
F768,Dominion at S Sprecher,43.091707,-89.267185\r
7633,Milwaukee at Milo,43.098649,-89.304884\r
7638,Dempsey at Dennett,43.090028,-89.316543\r
0765,N Lake at University,43.073076,-89.397291\r
7654,Davies at Drexel,43.079151,-89.317066\r
F781,S Thompson at Vondron,43.067193,-89.291076\r
7663,Turner at Hob,43.066158,-89.314259\r
7668,Pflaum at Seiferth,43.062446,-89.307464\r
0768,W Washington at Southwest,43.067928,-89.393972\r
F780,S Thompson at 1306,43.079486,-89.283546\r
7687,E Buckeye at Woodvale,43.073297,-89.295417\r
7689,Buckeye at Camden,43.073425,-89.311433\r
7694,Turner at Hob,43.066436,-89.314542\r
F702,Vondron at S Thompson,43.067473,-89.291532\r
7704,Dempsey at Hynek,43.092535,-89.316514\r
7716,Turner at Allis,43.071395,-89.3143\r
7718,Cottage Grove at Drexel,43.083863,-89.320306\r
F723,Merryturn at Sudbury,43.096236,-89.290798\r
7729,Turner at Ruth,43.069739,-89.314192\r
F773,Merryturn at Kevins,43.08887,-89.292924\r
7734,Milwaukee at Walbridge,43.09854,-89.313578\r
7739,Pflaum at Groveland,43.061973,-89.320153\r
7745,Atwood at Margaret,43.087458,-89.327029\r
7748,Cottage Grove at Ellen,43.084578,-89.289684\r
F760,S Thompson at Rustic Wood,43.070129,-89.281874\r
F764,Vondron at E Buckeye,43.073076,-89.291632\r
F766,Starker at Vondron,43.077194,-89.291884\r
7782,Dempsey at Pinney,43.08608,-89.31645\r
F772,S Thompson at E Buckeye,43.073228,-89.283003\r
F784,Dominion at Traveler,43.091781,-89.269864\r
0782,W Badger at Fiedler,43.03869,-89.401869\r
F722,Vondron at Dolores,43.069951,-89.291614\r
7823,Buckeye at Davies,43.0767,-89.319896\r
7829,Dempsey at Rockwell,43.087691,-89.316188\r
F730,Inwood at Open Wood,43.0858,-89.294349\r
7834,Atwood at Cottage Grove,43.083356,-89.325035\r
7838,Buckeye at Lakeview,43.075454,-89.317923\r
F740,S Thompson at Grafton,43.076889,-89.28286\r
7842,Milwaukee at Portland,43.098768,-89.308033\r
L781,Vondron at Dolores,43.070166,-89.291317\r
7867,Wyalusing at Summertown,43.096875,-89.261628\r
7888,Atwood at Walter,43.089178,-89.32925\r
7892,Milwaukee at N Thompson,43.099109,-89.289298\r
F785,S Thompson at Forge,43.066255,-89.284054\r
F798,Acewood at Goldfinch,43.088781,-89.302863\r
F797,Inwood at Open Wood,43.08597,-89.294114\r
0791,W Wilson at S Henry,43.070262,-89.384331\r
7910,Milwaukee at N Sprecher,43.099729,-89.267315\r
F792,Acewood at Agate,43.094743,-89.302359\r
7913,Milwaukee at Kurt,43.098844,-89.293176\r
F716,Starker at Woodvale,43.077144,-89.295501\r
7918,E Buckeye at Kings Mill,43.074709,-89.278075\r
7920,Agriculture at World Dairy,43.05611,-89.291677\r
F795,Acewood at Cottage Grove,43.084546,-89.302846\r
7929,Milwaukee at Milky,43.099071,-89.279048\r
F790,North Star at Dominion,43.091152,-89.2752\r
F793,Acewood at Agate,43.094877,-89.302063\r
7955,Monona at Buckeye,43.079675,-89.32388\r
7968,E Buckeye at Twilight,43.073432,-89.298866\r
F769,Acewood at Onyx,43.091779,-89.30208\r
7984,E Buckeye at Ellen,43.073573,-89.288237\r
7989,Cottage Grove at Atlas,43.083958,-89.306564\r
7990,Dempsey at Overpass,43.095597,-89.316435\r
7991,Cottage Grove at Ellen,43.084238,-89.289389\r
8100,Raymond at Prairie,43.032042,-89.48917\r
8101,Raymond at Prairie,43.031702,-89.488368\r
F826,S Pleasant View at Mid Town,43.030938,-89.533299\r
8131,S Gammon at Schroeder,43.046501,-89.50303\r
8135,Reetz at Raymond,43.03216,-89.461473\r
8138,S Whitney at Piping Rock,43.041823,-89.477643\r
8153,Muir Field at Tucson,43.017338,-89.511026\r
8154,Hammersley at Reetz,43.039161,-89.460885\r
0816,Fish Hatchery at W Badger,43.038377,-89.404275\r
8160,S Gammon at Gammon,43.043734,-89.5041\r
8166,McKenna at Hammersley,43.038678,-89.500146\r
8173,S Whitney at Hammersley,43.039442,-89.477332\r
8174,Waldorf at Mansion Hill,43.034346,-89.525002\r
8180,S Gammon at Schroeder,43.045897,-89.503357\r
8186,Raymond at Lewon,43.032015,-89.468222\r
8188,McKenna at Elver Park,43.039205,-89.502639\r
8192,Muir Field at Tucson,43.017222,-89.511568\r
F814,McKenna at Lancaster,43.021972,-89.503174\r
8224,Muir Field at Lindfield,43.027135,-89.50582\r
8235,Schroeder at Saybrook,43.046254,-89.479263\r
8237,Schroeder at Forward,43.046205,-89.488444\r
8241,Schroeder at Highway Ramp,43.046282,-89.475511\r
8246,Starr Grass at S High Point,43.038469,-89.518518\r
8251,Mid Town at S Pleasant View,43.031243,-89.532757\r
8255,Schroeder at S Gammon,43.046125,-89.502437\r
F859,Carnwood at Maple Grove,43.020005,-89.498965\r
8263,Maple Grove at Westin,43.01287,-89.498773\r
8268,Woods at Mid Town,43.030929,-89.553002\r
8273,Mid Town at Woods,43.031099,-89.552472\r
8274,S Whitney at Gilbert,43.044277,-89.474227\r
0828,E Rusk at Rimrock,43.04282,-89.377831\r
8281,McKenna at Raymond,43.032127,-89.49677\r
8285,Raymond at Lewon,43.031666,-89.468604\r
8297,S Whitney at Raymond,43.03228,-89.476537\r
8301,McKenna at Morraine View,43.041791,-89.504702\r
F806,Manchester at Westin,43.01094,-89.492517\r
8341,S Whitney at Bartlett,43.034151,-89.477094\r
8363,Raymond at Leland,43.031724,-89.479917\r
8379,McKee at Muir Field,43.015673,-89.510974\r
8386,Mid Town at Hawks Landing,43.031339,-89.545243\r
F888,Carnwood at Maple Grove,43.02022,-89.499151\r
F889,Mid Town at Mica,43.031273,-89.528562\r
0839,W Johnson at N Broom,43.073639,-89.391365\r
0840,S Park at W Washington,43.06288,-89.401022\r
8404,Raymond at Reetz,43.031874,-89.462003\r
8405,Muir Field at Carnwood,43.020117,-89.506231\r
8427,Schroeder at White Oaks,43.046234,-89.484384\r
F848,S Whitney at Raymond,43.031492,-89.476981\r
8432,McKee at Tanglewood,43.015793,-89.505683\r
8435,Waldorf at Mansion Hill,43.034275,-89.524681\r
0845,Fish Hatchery at Plaenert,43.049317,-89.400521\r
8452,S Whitney at Hammersley,43.039307,-89.477838\r
F841,Carnwood at McKenna,43.019618,-89.502752\r
8469,Muir Field at McKee,43.016076,-89.511333\r
0847,Fish Hatchery at Cedar,43.052226,-89.398928\r
8486,Muir Field at Lancaster,43.022248,-89.505629\r
8496,McKenna at Morraine View,43.041356,-89.505043\r
8511,S High Point at Starr Grass,43.03864,-89.517975\r
8512,Raymond at S Whitney,43.032056,-89.477487\r
8513,McKenna at Elver Park,43.038892,-89.50217\r
8519,Muir Field at Gladstone,43.024531,-89.505311\r
8528,McKenna at Park Heights,43.03535,-89.496959\r
8537,Schroeder at Chapel Hill,43.046175,-89.493466\r
8561,Maple Grove at Manchester,43.007669,-89.498841\r
8569,McKenna at Park Heights,43.035574,-89.496725\r
8572,Muir Field at Gladstone,43.024396,-89.505607\r
F854,Hammersley at Lewon,43.039213,-89.467005\r
8597,Waldorf at Mid Town,43.031785,-89.526281\r
F804,Hammersley at Gilbert,43.039246,-89.473236\r
8605,S Whitney at Gilbert,43.044098,-89.473782\r
0862,John Nolen at E Olin,43.05034,-89.3779\r
F828,Hammersley at Saalsaa,43.039092,-89.496963\r
8633,S Whitney at Piping Rock,43.041922,-89.477038\r
8634,Raymond at McKenna,43.031957,-89.497301\r
8662,Mid Town at S Pleasant View,43.031448,-89.533584\r
F864,Prairie at Hammersley,43.038864,-89.488646\r
8679,Muir Field at Silverton,43.018119,-89.508474\r
8690,S High Point at Watts,43.051701,-89.518005\r
8692,Reetz at Flad,43.034398,-89.461524\r
0087,N Broom at W Gorham,43.07415,-89.392328\r
8712,Raymond at Leland,43.032073,-89.480102\r
8714,Muir Field at Raymond,43.030187,-89.507933\r
8723,Muir Field at Lindfield,43.026733,-89.505338\r
8728,Starr Grass at Waldorf,43.036953,-89.523537\r
F879,McKenna at Carnwood,43.020011,-89.502974\r
8745,Raymond at Canterbury,43.031578,-89.501594\r
8753,Reetz at Flad,43.034577,-89.461203\r
8759,McKenna at Hammersley,43.038213,-89.499541\r
8769,S Gammon at Gammon,43.044075,-89.503459\r
F870,Hammersley at Whitcomb,43.039196,-89.464389\r
0879,W Olin at S Park,43.053935,-89.396039\r
8796,S Whitney at Bartlett,43.033596,-89.477328\r
8830,Muir Field at Silverton,43.018414,-89.508659\r
F855,McKenna at Lancaster,43.022357,-89.502484\r
8866,Mid Town at Waldorf,43.031552,-89.526811\r
8872,Raymond at Frisch,43.032003,-89.493957\r
8893,Muir Field at Raymond,43.030429,-89.507674\r
8921,Mid Town at Hawks Landing,43.031125,-89.54449\r
8934,Muir Field at Carnwood,43.019606,-89.507118\r
8937,Raymond at S Whitney,43.031707,-89.476438\r
0894,E Rusk at N Rusk,43.039161,-89.383916\r
F840,Hammersley at Frisch,43.039175,-89.493261\r
8941,Muir Field at Lancaster,43.022382,-89.505333\r
F894,Prairie at Lomax,43.034719,-89.488791\r
0895,W Badger at Overpass,43.038311,-89.388642\r
8953,Starr Grass at Waldorf,43.036738,-89.523352\r
F856,Prairie at Jacobs,43.036858,-89.488719\r
8958,Raymond at Canterbury,43.031784,-89.50205\r
0896,S Park at Cedar,43.051598,-89.394942\r
F885,McKenna at Pilgrim,43.026989,-89.496851\r
9001,Cremer at Park And Ride,43.156799,-89.266988\r
0904,Erin at S Park,43.059997,-89.401221\r
0906,S Park at Buick,43.041491,-89.394255\r
9100,Wright at Madison College,43.121241,-89.33054\r
9101,Wright at Madison College,43.121026,-89.330256\r
9116,Melody at Independence,43.130707,-89.31024\r
9137,N Thompson at Mesta,43.109528,-89.296664\r
0914,W Gorham at Wisconsin,43.077372,-89.388191\r
9143,Portage at Derek,43.134409,-89.315498\r
9146,Melody at Portage,43.130908,-89.31538\r
0915,Fish Hatchery at Midland,43.054527,-89.398878\r
F952,E Washington at Portage,43.123226,-89.315478\r
9153,Hayes at Dawn,43.140977,-89.300548\r
9164,O'Keeffe at Linnerud,43.173927,-89.245178\r
9169,Airport at Terminal Door 6,43.137305,-89.346446\r
9171,Wright at Straubel,43.117301,-89.330422\r
9173,E Springs at High Crossing,43.131842,-89.29839\r
9175,N Stoughton E at Orin,43.122866,-89.324571\r
9176,Commercial at Redland,43.106779,-89.305228\r
9177,O'Keeffe at New Town,43.163113,-89.261016\r
F981,N Thompson at Kurt,43.10203,-89.292281\r
9182,N Stoughton E at Orin,43.123063,-89.32488\r
9204,N Thompson at Lien,43.120606,-89.298892\r
9219,O'Keeffe at Summerfield,43.169044,-89.249752\r
F925,E Washington at Schmedeman,43.115141,-89.326941\r
F934,N Thompson at Kurt,43.102101,-89.291836\r
9237,N Stoughton E at N Stoughton,43.121281,-89.324166\r
9243,N Thompson at Commercial,43.106864,-89.300461\r
9273,High Crossing at City View,43.13879,-89.288961\r
9274,Shopko at Pick N Save,43.112872,-89.348004\r
9276,N Thompson at Westwynn,43.118349,-89.297932\r
9285,Anniversary at Hayes,43.13564,-89.300199\r
9291,N Thompson at Wayridge,43.118993,-89.297622\r
9300,Eastpark at U W Health,43.153791,-89.301341\r
9306,N Stoughton E at N Stoughton,43.12147,-89.324647\r
F917,Walbridge at Milwaukee,43.09948,-89.313021\r
9322,E Washington at Wright,43.112942,-89.331095\r
F923,N Thompson at Meadows,43.102419,-89.295985\r
9338,Hayes at Forest Run,43.13813,-89.300343\r
9339,E Washington at Rethke,43.109247,-89.335385\r
9356,O'Keeffe at Brown Bear,43.165139,-89.255992\r
F961,Commercial S at N Fair Oaks,43.106146,-89.330795\r
9363,W Main at Thompson,43.176224,-89.255038\r
9364,Wright at Kinsman,43.125413,-89.330324\r
9370,N Thompson at Sycamore,43.11362,-89.296274\r
9373,Bartillon at Kinsman,43.12547,-89.322961\r
9388,Walsh at Nakoosa,43.109935,-89.310114\r
9405,Wright at E Washington,43.113962,-89.330488\r
0941,W Johnson at N Frances,43.071894,-89.395489\r
9420,N Thompson at Golden Leaf,43.111937,-89.296351\r
9432,Lien at Zeier,43.121163,-89.30046\r
9437,O'Keeffe at Linnerud,43.174491,-89.244818\r
F938,Anderson at Wright,43.120238,-89.329504\r
9439,N Thompson at Jana,43.108626,-89.298765\r
9442,Eagan at E Washington,43.126123,-89.310211\r
9472,American at Eastpark,43.147351,-89.290045\r
9479,Commercial at Nakoosa,43.108739,-89.314673\r
9486,Eastpark at Biltmore,43.151801,-89.299058\r
9490,O'Keeffe at New Town,43.163525,-89.261052\r
9497,W Main at S Grand,43.175894,-89.263965\r
9509,High Crossing at Cross Hill,43.142868,-89.28385\r
F918,Wittwer at Walbridge,43.102496,-89.311386\r
9528,O'Keeffe at Prairie,43.171594,-89.248151\r
9531,Lien at Eagan,43.120882,-89.306933\r
9535,S Grand at Blue Aster,43.171947,-89.264765\r
9543,O'Keeffe at Wild Iris,43.15949,-89.263496\r
9549,Hayes at Crosswalk,43.142305,-89.303289\r
9552,E Washington at Rethke,43.109372,-89.335929\r
F954,E Washington at Mendota,43.118826,-89.321909\r
0956,Koster at Bram,43.045572,-89.388639\r
9566,Independence at E Washington,43.128396,-89.308934\r
F968,N Thompson at Swanton,43.103793,-89.300429\r
F953,E Washington at Mendota,43.118942,-89.321031\r
F957,E Washington at Portage,43.123735,-89.313995\r
9591,Commercial at Redland,43.106564,-89.305043\r
F904,N Thompson at Meadows,43.102625,-89.296084\r
0961,N Broom at W Washington,43.071624,-89.389045\r
F912,Wittwer at Milwaukee,43.098726,-89.310441\r
9618,Independence at Melody,43.13025,-89.310241\r
0962,Regent at N Park,43.067768,-89.40149\r
9621,O'Keeffe at Brown Bear,43.164942,-89.255634\r
9629,Nakoosa at Commercial,43.10838,-89.314377\r
9633,Hayes at Portage,43.14254,-89.305995\r
9636,N Thompson at Oak Valley,43.11593,-89.296467\r
9642,Wright at Straubel,43.117167,-89.330718\r
9645,N Thompson at Oak Valley,43.116154,-89.296343\r
9651,Eastpark at U W Health,43.153513,-89.301094\r
F962,Swanton at N Thompson,43.104151,-89.300749\r
0967,W Washington at S Bedford,43.068957,-89.392096\r
9670,Melody at Stuart,43.130763,-89.312835\r
9701,High Crossing at E Springs,43.131985,-89.297648\r
9715,Portage at Village,43.140501,-89.309248\r
9717,Eastpark at Biltmore,43.152258,-89.298958\r
9719,Eagan at Lien,43.121258,-89.307155\r
9723,Portage at Rieder,43.135761,-89.31552\r
9725,Kinsman at Wright,43.125574,-89.329781\r
9733,Walsh at Commercial,43.106989,-89.309872\r
F940,Commercial N at N Fair Oaks,43.107077,-89.33114\r
9745,N Thompson at Golden Leaf,43.112151,-89.296054\r
9747,Eastpark at E Terrace,43.146341,-89.291492\r
F950,E Washington at Schmedeman,43.11533,-89.327423\r
9753,Nakoosa at Walmart,43.109301,-89.312042\r
9759,Eagan at East Towne,43.12545,-89.309199\r
9770,N Thompson at Jana,43.108743,-89.299049\r
9778,Walsh at Commercial,43.106855,-89.310181\r
9782,O'Keeffe at Summerfield,43.168991,-89.25021\r
9787,Kinsman at N Stoughton,43.125518,-89.32726\r
9797,Kinsman at Bartillon,43.125507,-89.323307\r
L981,Swanton at Easley,43.101386,-89.301421\r
9812,Nakoosa at Walmart,43.109301,-89.312523\r
9817,International at Darwin,43.129033,-89.348308\r
9822,High Crossing at Cross Hill,43.142716,-89.284728\r
9837,Shopko at Aberg,43.111179,-89.346808\r
9844,N Thompson at Commercial,43.107079,-89.300732\r
9862,O'Keeffe at Wild Iris,43.15975,-89.263965\r
F980,Swanton at Easley,43.101251,-89.301718\r
0989,W Washington at S Broom,43.07149,-89.388515\r
9892,N Thompson at Mesta,43.109788,-89.296713\r
9918,Kinsman at N Stoughton,43.125876,-89.325889\r
9939,Portage at Tomscot,43.138392,-89.313094\r
9951,N Thompson at Sycamore,43.114166,-89.295951\r
9955,O'Keeffe at Prairie,43.171146,-89.248202\r
9967,Walsh at Nakoosa,43.110051,-89.309817\r
9996,Eagan at East Towne,43.124886,-89.309002\r
C200,Regent at Capital High,43.068127,-89.439348\r
C299,Regent at Capital High,43.067912,-89.439718\r
E506,Delaware at N Sherman,43.14283,-89.363455\r
1152,Packers at Aberg,43.11335,-89.35518\r
E902,Golden Leaf at N Thompson,43.11199,-89.295832\r
E904,Glacier Hill at Lien,43.120903,-89.291418\r
E934,Glacier Hill at Valley Edge,43.114653,-89.290367\r
E956,Glacier Hill at Southridge,43.117231,-89.289806\r
E973,Lien at N Thompson,43.121312,-89.297952\r
E978,Glacier Hill at Ridge Oak,43.119094,-89.291174\r
E992,Golden Leaf at Eagle Crest,43.11255,-89.291841\r
0120,S Park at Wingra,43.049369,-89.394301\r
1216,Aberg at Packers,43.113744,-89.354797\r
1290,Aberg at N Sherman,43.114339,-89.363604\r
0139,N Randall at Regent,43.068038,-89.408834\r
0145,W Johnson at State,43.07491,-89.389575\r
1563,E Doty at M L K Junior,43.073404,-89.381687\r
1679,Packers at Aberg,43.112633,-89.353662\r
1731,E Wilson at S Butler,43.074745,-89.378044\r
L319,Crested Owl at Meinders,43.035407,-89.295764\r
0182,N Park at W Dayton,43.070687,-89.401094\r
1841,Aberg at Packers,43.113323,-89.354835\r
1868,Milwaukee at W Corporate,43.098332,-89.321914\r
1905,Atwood at Lakeland,43.0916,-89.336001\r
1964,Fordem at N Sherman,43.102646,-89.364145\r
2218,Highland at University Bay,43.076096,-89.434301\r
2257,Monroe at Spooner,43.065254,-89.416426\r
2312,S Whitney at Tokay,43.053346,-89.47374\r
F249,Eau Claire at Sheboygan,43.073225,-89.464039\r
2467,University at University Bay,43.073204,-89.433449\r
F293,Glenway at Monroe,43.053177,-89.435457\r
2511,Mineral Point at S Whitney,43.060715,-89.471634\r
2549,S Whitney at Tokay,43.053481,-89.473234\r
0269,N Brooks at W Johnson,43.072388,-89.402303\r
F264,Capital at Old Middleton,43.082627,-89.482206\r
2778,Odana at S Whitney,43.050105,-89.474009\r
F202,Eau Claire at Sheboygan,43.072625,-89.464236\r
2844,Highland at University,43.071563,-89.428711\r
2846,N Segoe at University,43.074973,-89.457164\r
0286,Drake at S Mills,43.062173,-89.404417\r
2951,Highland at Regent,43.068361,-89.428486\r
2959,University Bay at Highland,43.075773,-89.43393\r
F286,Capital at University,43.084232,-89.478047\r
3142,Lacy at Brassica,43.011432,-89.373868\r
3226,Rimrock at E Badger,43.038058,-89.37929\r
3237,Novation at Ski,43.031543,-89.385389\r
3305,Meinders at Crested Owl,43.035425,-89.296109\r
3561,Novation at 89 Degree,43.032732,-89.382254\r
3614,Highway M M at McCoy,43.023609,-89.38015\r
3646,Novation at Rimrock,43.035856,-89.380278\r
0365,S Randall at Mound,43.065164,-89.408847\r
3791,Highway M M at McCoy,43.023815,-89.37999\r
3910,Novation at 89 Degree,43.032446,-89.382908\r
4132,Fitchrona at Nesbitt,43.007814,-89.484717\r
4146,Fish Hatchery at High Ridge,43.021378,-89.417652\r
4147,Anton at Williamsburg,43.023889,-89.47093\r
4199,Jenewein at Red Arrow,43.028912,-89.456376\r
4206,Red Arrow at Jenewein,43.029154,-89.456438\r
0422,S Randall at Regent,43.067501,-89.409131\r
4350,Chalet Gardens at Verona E,43.027863,-89.463642\r
4385,E Cheryl at Fahey,43.004324,-89.412621\r
4406,E Cheryl at Fahey,43.004691,-89.411733\r
4432,Lovell at Allied,43.02695,-89.460089\r
4478,Anton at Williamsburg,43.023867,-89.471098\r
4529,Verona E at Williamsburg,43.023813,-89.467018\r
4616,McKee at Fitchrona,43.015905,-89.481039\r
4649,Fitchrona at Nesbitt,43.007846,-89.484408\r
4713,Fitchrona at Crosswalk,43.009879,-89.483254\r
4716,Red Arrow at Verona E,43.032233,-89.457797\r
4764,E Cheryl at Research Park,43.005148,-89.425681\r
4783,Cahill at Caddis,43.019364,-89.421167\r
4820,Verona E at Williamsburg,43.023788,-89.467216\r
4828,Fitchrona at Crosswalk,43.009825,-89.483599\r
F449,Allied at Jenewein,43.029233,-89.459201\r
4892,Fish Hatchery at Caddis,43.019445,-89.419428\r
4930,S Fish Hatchery at E Cheryl,43.004817,-89.428025\r
4967,Chalet Gardens at Verona E,43.027701,-89.463839\r
4997,Fitchrona at King James,43.018934,-89.473727\r
5120,Dryden at Londonderry,43.130033,-89.358945\r
5166,Tennyson at Packers,43.134794,-89.355765\r
5223,Northport at N Sherman,43.130375,-89.36317\r
5230,Wheeler at N Sherman,43.147485,-89.363266\r
5238,N Sherman at Tennyson,43.134601,-89.363537\r
5253,N Sherman at Delaware,43.143044,-89.362911\r
F578,Delaware at Dakota,43.143521,-89.36757\r
0528,S Bassett at W Doty,43.068329,-89.388553\r
F532,Northland at Mandrake,43.145226,-89.377689\r
5381,N Sherman at Sunfield,43.13914,-89.363038\r
F591,Wheeler at N Sherman,43.147253,-89.363105\r
F596,Delaware at Esch,43.144946,-89.370225\r
F517,Packers at Darwin,43.129198,-89.355103\r
5461,N Sherman at Thackeray,43.132703,-89.363316\r
5484,Wheeler at Golf View,43.147926,-89.367616\r
F502,Northland at School,43.146203,-89.382595\r
F512,Delaware at Tennessee,43.145305,-89.373908\r
5545,Dryden at Londonderry,43.130185,-89.358734\r
5601,Packers at Scott,43.132985,-89.35521\r
5610,Wheeler at Comanche,43.148412,-89.372385\r
F520,School at Fulton,43.143589,-89.383029\r
5674,Delaware at Northland,43.145512,-89.375452\r
5708,Delaware at Wheeler,43.147876,-89.375809\r
0571,Drake at S Mills,43.061958,-89.404232\r
5741,N Sherman at Northport,43.131046,-89.363354\r
5753,N Sherman at Tennyson,43.135147,-89.363215\r
5802,Tennyson at Whitman,43.134912,-89.359199\r
F514,School at Havey,43.141172,-89.383092\r
5818,N Sherman at Delaware,43.142364,-89.363233\r
F588,Packers at Darwin,43.129064,-89.355387\r
5884,N Sherman at Thackeray,43.132488,-89.363613\r
5889,N Sherman at Lake View,43.137144,-89.363127\r
5997,Tennyson at Whitman,43.134626,-89.358458\r
0610,Monroe at N Randall,43.070052,-89.409352\r
6139,Parmenter at Lisa,43.10923,-89.509735\r
6238,Parmenter at Franklin,43.098234,-89.511635\r
0638,S Randall at Drake,43.062192,-89.409144\r
6413,Murphy at Eagle,43.098321,-89.527368\r
6445,S Gammon at Memorial High,43.064263,-89.502396\r
6460,Tree at S Gammon,43.065677,-89.503447\r
6494,Parmenter at Lisa,43.108737,-89.510315\r
6541,Odana at Medical,43.049934,-89.478167\r
6554,University at Parmenter,43.096962,-89.511905\r
6621,N Gammon at Sawmill,43.081426,-89.502144\r
6670,Deming at Greenway,43.089771,-89.527269\r
6728,Odana at Medical,43.050175,-89.478279\r
6761,N Gammon at Middleton,43.084673,-89.502123\r
6771,Odana at Tokay,43.051177,-89.481155\r
6778,Tree at S Westfield,43.064036,-89.507518\r
6793,Mineral Point at S Gammon,43.06053,-89.503219\r
0682,Monroe at S Breese,43.067295,-89.413747\r
6833,University at Cayuga,43.096657,-89.513671\r
6959,S Gammon at Mineral Point,43.061103,-89.502479\r
6962,S Westfield at Mineral Point,43.061261,-89.50791\r
6990,N Gammon at Middleton,43.084441,-89.502326\r
7113,Dempsey at Overpass,43.095355,-89.316152\r
7201,Milwaukee at W Corporate,43.098143,-89.321161\r
7241,Cottage Grove at McClellan,43.084673,-89.270337\r
7245,Cottage Grove at Acewood,43.084044,-89.302551\r
7370,Wyalusing at Dominion,43.090965,-89.261371\r
7422,Cottage Grove at S Sprecher,43.084992,-89.267163\r
7431,Wyalusing at Amnicon,43.089586,-89.261115\r
7439,Dempsey at Hynek,43.092741,-89.31623\r
0745,S Park at Wingra,43.049476,-89.39382\r
7460,Cottage Grove at Dempsey,43.083985,-89.316787\r
7464,Buckeye at Camden,43.073712,-89.312161\r
7523,Dempsey at Dennett,43.090565,-89.316245\r
7562,Sprecher New at Cottage Grove,43.08583,-89.264676\r
7571,Cottage Grove at McLean,43.084614,-89.273461\r
0763,W Badger at N Rusk,43.038838,-89.384348\r
7657,Dempsey at Milwaukee,43.09789,-89.317395\r
7675,Cottage Grove at Atwood,43.083544,-89.324566\r
7684,Cottage Grove at McLean,43.084812,-89.274213\r
7848,Pflaum at Advance,43.062495,-89.302996\r
0790,W Washington at N Fairchild,43.073128,-89.386588\r
7921,Cottage Grove at North Star,43.084522,-89.279264\r
F731,North Star at Orion,43.087951,-89.279047\r
0794,N Randall at Monroe,43.069891,-89.409155\r
7946,Wyalusing at Amnicon,43.08922,-89.261696\r
7970,Cottage Grove at McClellan,43.08488,-89.27109\r
0806,S Randall at Mound,43.065441,-89.409131\r
8124,S Gammon at Watts,43.04993,-89.503317\r
8139,Maple Grove at McKee,43.016084,-89.498702\r
8146,Schroeder at Chapel Hill,43.046381,-89.494219\r
8152,Schroeder at Saybrook,43.046468,-89.48025\r
F863,Manchester at Hartford,43.014916,-89.490634\r
8182,Schroeder at Struck,43.04637,-89.496909\r
8184,Maple Grove at Nesbitt,43.002181,-89.499266\r
8218,Maple Grove at McKee,43.015403,-89.49901\r
F829,Prairie at Raymond,43.032212,-89.488615\r
F853,Prairie at Jacobs,43.036581,-89.488434\r
F821,Raymond at Reetz,43.031202,-89.461658\r
8333,Reetz at Marvin,43.036296,-89.460908\r
8371,McKee at Maple Grove,43.015574,-89.498479\r
8378,Schroeder at Forward,43.046429,-89.488024\r
8463,Maple Grove at Nesbitt,43.002011,-89.49902\r
F871,Hammersley at McKenna,43.038715,-89.499356\r
0857,N Randall at W Dayton,43.071359,-89.408871\r
F880,Manchester at Thornebury,43.012615,-89.491002\r
F844,Manchester at McKee,43.015381,-89.490943\r
8709,Raymond at Frisch,43.031664,-89.493204\r
8718,Maple Grove at Manchester,43.007123,-89.499136\r
F838,Hammersley at Prairie,43.03924,-89.488869\r
8763,McKee at Tanglewood,43.015588,-89.50493\r
8779,Raymond at McKenna,43.031626,-89.49656\r
8802,Maple Grove at Westin,43.012324,-89.49908\r
8816,Schroeder at Highway Ramp,43.046497,-89.475882\r
F839,Hammersley at Saalsaa,43.038886,-89.496543\r
F847,Flagstone at S Pleasant View,43.024842,-89.532821\r
8862,Schroeder at White Oaks,43.046458,-89.484112\r
8868,McKee at Maple Grove,43.015914,-89.499232\r
F815,Hammersley at Frisch,43.038969,-89.492533\r
F819,Prairie at Lomax,43.034522,-89.488507\r
8928,Reetz at Marvin,43.036493,-89.461216\r
9115,Eastpark at Dreamer,43.147879,-89.299152\r
9121,N Bristol at Angell,43.184025,-89.213325\r
9138,High Crossing at City View,43.138916,-89.289431\r
9157,W Main at Flint,43.183158,-89.219931\r
9178,W Main at N Bird,43.181853,-89.226945\r
9188,Windsor at Broadway,43.187533,-89.241903\r
9202,W Main at N Walker,43.179056,-89.237017\r
9209,Independence at E Washington,43.12844,-89.308613\r
9214,Anniversary at Independence,43.134682,-89.30927\r
9235,E Main at Dewey,43.182227,-89.208447\r
9236,Windsor at N Bird,43.187574,-89.226817\r
9256,N Grand at W Main,43.176782,-89.265076\r
9260,High Crossing at Crossroads,43.136294,-89.291215\r
9272,Tower at N Bristol,43.198851,-89.211239\r
9330,Eastpark at American,43.147754,-89.290526\r
9347,Darwin at Packers,43.128813,-89.354869\r
9352,N Bird at Vandenburg,43.193143,-89.226022\r
9360,Windsor at Eddington,43.187512,-89.24628\r
9365,W Main at Clarmar,43.177781,-89.241224\r
9387,Eagan at E Washington,43.126346,-89.310099\r
9403,W Main at S Bird,43.181842,-89.226141\r
9410,S Grand at Prairie Lakes,43.165783,-89.269427\r
0947,S Randall at Drake,43.062326,-89.408848\r
9487,Market at Cannery,43.182777,-89.210968\r
9492,Windsor at Lois,43.187562,-89.236685\r
9506,Windsor at N Thompson,43.187309,-89.25485\r
9521,Eastpark at W Terrace,43.144043,-89.29492\r
9536,Tower at Fitness,43.195912,-89.221637\r
9540,Grove at E Main,43.18063,-89.206498\r
9547,N Bristol at Goodland,43.192197,-89.211099\r
9577,High Crossing at Crossroads,43.13633,-89.290721\r
9582,N Bird at Windsor,43.18718,-89.226435\r
9584,Eastpark at W Terrace,43.144437,-89.2955\r
9586,N Grand at Windsor,43.18664,-89.264657\r
9637,S Grand at Prairie Lakes,43.166346,-89.268709\r
9648,Tower at Grandview,43.197002,-89.214325\r
9650,W Main at Ruby,43.180098,-89.233256\r
9689,E Main at S Bristol,43.183184,-89.213278\r
9690,Darwin at Packers,43.129037,-89.355054\r
F993,N Fair Oaks at Lexington,43.110389,-89.330394\r
9709,N Bristol at Windsor,43.188018,-89.212423\r
9718,N Bird at Summit,43.190878,-89.226165\r
9721,W Main at Ruby,43.180106,-89.232452\r
9728,N Grand at Blue Heron,43.180964,-89.264942\r
0977,Regent at S Randall,43.067653,-89.4086\r
F902,N Fair Oaks at Lexington,43.110801,-89.330678\r
9833,N Bristol at Klubertanz,43.195832,-89.210766\r
9870,Anniversary at Forest Run,43.135329,-89.302523\r
9879,W Main at S Walker,43.179054,-89.236213\r
9906,Eastpark at E Terrace,43.145876,-89.291963\r
9914,Darwin at International,43.128899,-89.349012\r
9924,N Bird at Tower,43.196465,-89.225864\r
9931,Park at Angell Park,43.180225,-89.21105\r
9936,Eastpark at Dreamer,43.147181,-89.299165\r
9938,Independence at Declaration,43.132684,-89.307927\r
9946,W Main at Clarmar,43.177791,-89.242028\r
9952,S Grand at Blue Aster,43.17141,-89.265385\r
L709,Dominion at S Sprecher,43.091492,-89.267\r
6209,Allen at Lake,43.10294,-89.486027\r
6629,Century at Park,43.108707,-89.501558\r
6986,University at Capital,43.084035,-89.477503\r
F963,Wright at Anderson,43.11988,-89.330295\r
2600,University Row at U W Health,43.076213,-89.469497\r
1129,Sherman at Marston,43.092783,-89.371797\r
W272,Shorewood at Oxford,43.081645,-89.444487\r
1289,Williamson at S Baldwin,43.084614,-89.362197\r
1498,W Wilson at M L K Junior,43.072428,-89.3817\r
1606,S Baldwin at Williamson,43.084238,-89.362395\r
M839,Cosgrove at Dallas,43.004019,-89.494348\r
M888,Tiller at Cosgrove,43.008256,-89.489986\r
M899,Cosgrove at Tonkinese,43.004898,-89.491747\r
2144,Odana at Anthony,43.05074,-89.447304\r
2234,University at Craig,43.079238,-89.471956\r
2364,Mineral Point at Racine,43.061039,-89.465871\r
2504,S Segoe at Crosswalk,43.065233,-89.454567\r
2523,Mineral Point at Westmorland,43.060633,-89.443321\r
2635,S Segoe at Regent,43.068742,-89.454235\r
2652,Regent at N Midvale,43.068385,-89.451618\r
2671,Old Middleton at N Rosa,43.074939,-89.478064\r
2713,S Segoe at Crosswalk,43.06526,-89.454073\r
2810,Tokay at S Segoe,43.053806,-89.46483\r
2816,Odana at Frederick,43.05108,-89.4447\r
2869,University at Craig,43.079543,-89.471746\r
3623,Marsh at Kipp,43.043509,-89.286605\r
0432,University at N Mills,43.073445,-89.404451\r
5429,Northport at School,43.137769,-89.382797\r
6263,S High Point at Watts,43.052248,-89.517697\r
6366,Old Sauk at N Westfield,43.075281,-89.507878\r
6596,S High Point at Mineral Point,43.060207,-89.517659\r
6871,Old Sauk at Widgeon,43.074991,-89.512346\r
7139,Wyalusing at S Sprecher,43.087829,-89.266317\r
0716,University at N Orchard,43.073454,-89.407747\r
7253,Pflaum at Turner,43.062093,-89.313735\r
7273,E Buckeye at Kings Mill,43.074547,-89.277816\r
7294,Wyalusing at Milwaukee,43.099489,-89.261635\r
7496,Pflaum at Turner,43.062299,-89.314487\r
7556,Kings Mill at Cottontail,43.076623,-89.276774\r
7720,Wyalusing at S Sprecher,43.088098,-89.266279\r
7772,Milwaukee at Wyalusing,43.099919,-89.262029\r
F837,Manchester at Westin,43.010895,-89.492172\r
8445,Raymond at Cameron,43.03174,-89.482742\r
8515,Hammersley at Reetz,43.038946,-89.4607\r
8532,Raymond at Cameron,43.032098,-89.483483\r
8639,Schroeder at Struck,43.046156,-89.496724\r
8689,S Whitney at Tolman,43.037141,-89.477368\r
F877,Manchester at Thornebury,43.01283,-89.490706\r
8810,S Whitney at Tolman,43.036595,-89.477885\r
9080,Hanson at Metro Garage,43.153803,-89.315591\r
9081,Hanson at Metro Garage,43.15358,-89.316061\r
10069,East Campus,43.073363,-89.399414\r
10070,East Campus,43.071949,-89.398686\r
10071,East Campus,43.073354,-89.398846\r
10077,State,43.07491,-89.391488\r
10078,State,43.074668,-89.389575\r
10081,Capitol Square,43.075741,-89.385056\r
10082,Capitol Square,43.073547,-89.383415\r
10085,Blair,43.078354,-89.379017\r
10086,Blair,43.078407,-89.378795\r
10089,Paterson,43.08213,-89.373681\r
10090,Paterson,43.082192,-89.373447\r
10093,Baldwin,43.087159,-89.366541\r
10094,Baldwin,43.087221,-89.366319\r
10097,First Street,43.092044,-89.359622\r
10098,First Street,43.092133,-89.359363\r
10101,Fourth Street,43.096204,-89.354061\r
10102,Fourth Street,43.096285,-89.353827\r
10105,Milwaukee-North,43.10015,-89.348945\r
10106,Milwaukee-North,43.100597,-89.348512\r
10109,Marquette,43.104112,-89.342259\r
10110,Marquette,43.104166,-89.342036\r
0200,University at East Campus,43.073381,-89.400056\r
10061,Orchard,43.073454,-89.407179\r
10062,Orchard,43.07212,-89.407043\r
0201,W Johnson at East Campus,43.071939,-89.398032\r
10057,University Bay,43.073472,-89.433609\r
10058,University Bay,43.073365,-89.43335\r
10053,Shorewood,43.075262,-89.443473\r
10054,Shorewood,43.075235,-89.443263\r
10049,Midvale,43.075359,-89.451633\r
10050,Midvale,43.075269,-89.451411\r
0389,State at W Johnson,43.074668,-89.389723\r
10045,Segoe,43.073119,-89.456879\r
10046,Segoe,43.073289,-89.456719\r
10041,Eau Claire,43.072965,-89.463854\r
10042,Eau Claire,43.072983,-89.463644\r
10037,Regent-Whitney,43.067735,-89.468442\r
10038,Regent-Whitney,43.067896,-89.468393\r
10033,Whitney-Mineral Point,43.060885,-89.47261\r
10034,Whitney-Mineral Point,43.060867,-89.472363\r
10029,Rosa,43.060856,-89.478818\r
10030,Rosa,43.060829,-89.478596\r
10025,Island,43.060816,-89.486878\r
10026,Island,43.060789,-89.486655\r
10021,Grand Canyon,43.060784,-89.496924\r
10022,Grand Canyon,43.060748,-89.496702\r
10017,Westfield,43.06067,-89.507625\r
10018,Westfield,43.060634,-89.507415\r
10013,High Point,43.060556,-89.517326\r
10014,High Point,43.060538,-89.517104\r
10001,Junction,43.057846,-89.528334\r
10004,Junction at Park And Ride,43.057836,-89.528334\r
0626,University at N Bassett,43.073282,-89.394649\r
6410,N High Point at Sauk Creek,43.072094,-89.520317\r
0887,W Johnson at N Orchard,43.072254,-89.407772\r
10113,Melvin-Rethke,43.10897,-89.336152\r
10114,Melvin-Rethke,43.109077,-89.335917\r
10117,Wright-Fair Oaks,43.11295,-89.330786\r
10118,Wright-Fair Oaks,43.113013,-89.330576\r
10121,Anderson-Wright,43.120247,-89.32985\r
10122,Anderson-Wright,43.120033,-89.330072\r
10125,Mendota,43.119077,-89.321525\r
10126,Mendota,43.118906,-89.321093\r
10129,Thierer-Portage,43.123638,-89.314909\r
10130,Thierer-Portage,43.1237,-89.314057\r
10133,Independence,43.128002,-89.308663\r
10134,Independence,43.127992,-89.307836\r
10137,East Springs,43.131489,-89.303617\r
10138,East Springs,43.131399,-89.302913\r
9579,Cremer at O'Keeffe,43.156978,-89.267148\r
3172,Femrite at Shato,43.050839,-89.313567\r
3183,Monona at E Broadway,43.048073,-89.324604\r
3198,Dean at Winnequah,43.069506,-89.338238\r
3345,E Broadway at Ahuska Park,43.047748,-89.321482\r
3348,Nichols at Shore Acres,43.062375,-89.331458\r
3357,Copps at E Broadway,43.048804,-89.310436\r
3385,Nichols at McKenna,43.062217,-89.335618\r
3488,Edna Taylor at Femrite,43.05112,-89.317035\r
3542,Pheasant Hill at Owen,43.056806,-89.33091\r
3624,Nichols at Winnequah,43.065141,-89.344292\r
3627,Femrite at Shato,43.050723,-89.314123\r
3720,E Broadway at Ahuska Park,43.04808,-89.321704\r
3781,Femrite at Edna Taylor,43.051209,-89.316578\r
3814,Owen at Pheasant Hill,43.056761,-89.330577\r
3816,Copps at E Broadway,43.049002,-89.310646\r
3835,Dean at Winnequah,43.069291,-89.338053\r
3845,E Broadway at Monona,43.04758,-89.324333\r
3854,Dean at Shore Acres,43.069412,-89.33177\r
3922,W Broadway at Monona,43.047894,-89.32511\r
3991,Nichols at Shore Acres,43.06216,-89.331274\r
7172,Monona at Femrite,43.053239,-89.325436\r
7177,Monona at Owen,43.057268,-89.325554\r
7207,Monona at Pflaum,43.062443,-89.326015\r
7237,Monona at Femrite,43.053391,-89.325152\r
7238,Monona at Pflaum,43.061897,-89.326325\r
7270,Monona at Owen,43.056722,-89.325813\r
7274,Owen at Monona,43.057108,-89.326973\r
7451,Monona at Dean,43.069506,-89.325931\r
7603,Pflaum at Monona,43.062013,-89.32567\r
7768,Monona at Coldspring,43.07298,-89.326186\r
7870,Monona at Dean,43.069346,-89.326228\r
7937,Monona at Coldspring,43.073141,-89.325889\r
1791,N Blair at E Johnson,43.080942,-89.381707\r
2094,Walnut at Observatory,43.076141,-89.425239\r
0025,Langdon at N Lake,43.075691,-89.396944\r
2502,Walnut at Gifford Pinchot,43.074314,-89.425252\r
0045,Langdon at Wisconsin,43.078482,-89.38982\r
0454,N Breese at Hoyt,43.070438,-89.414055\r
0542,N Breese at University,43.073132,-89.414055\r
0558,N Bedford at W Mifflin,43.0697,-89.393799\r
0056,Observatory at Liz Waters,43.07665,-89.407141\r
0068,N Lake at W Johnson,43.072172,-89.397625\r
0795,N Park at State,43.074599,-89.400488\r
0853,W Dayton at N Frances,43.070757,-89.395527\r
0089,Langdon at N Henry,43.076844,-89.392142\r
0096,Wisconsin at W Gorham,43.077515,-89.388055\r
0099,Langdon at N Park,43.075745,-89.400179\r
0538,N Park at University,43.072701,-89.400846\r
0341,N Park at W Johnson,43.072352,-89.400476\r
0141,W Washington at S Fairchild,43.073074,-89.386255\r
1110,E Dayton at Wisconsin,43.076428,-89.38592\r
SoTP,South Transfer,43.038957,-89.394651\r
10012,High Point,43.060547,-89.517215\r
10016,Westfield,43.060652,-89.50752\r
10020,Grand Canyon,43.060766,-89.496813\r
10024,Island,43.060803,-89.486767\r
10028,Rosa,43.060843,-89.478707\r
10032,Whitney-Mineral Point,43.060876,-89.472487\r
10036,Regent-Whitney,43.067816,-89.468418\r
10040,Eau Claire,43.072974,-89.463749\r
10048,Midvale,43.075314,-89.451522\r
10052,Shorewood,43.075249,-89.443368\r
10056,University Bay,43.073419,-89.43348\r
10084,Blair,43.078381,-89.378906\r
10088,Paterson,43.082161,-89.373564\r
10092,Baldwin,43.08719,-89.36643\r
10096,First Street,43.092089,-89.359493\r
10100,Fourth Street,43.096245,-89.353944\r
10108,Marquette,43.104139,-89.342148\r
10112,Melvin-Rethke,43.109024,-89.336035\r
10116,Wright-Fair Oaks,43.112982,-89.330681`;function bw(Z,ce,de,ue){const Ce=pt=>pt*Math.PI/180,se=Ce(de-Z),n=Ce(ue-ce),ke=Math.sin(se/2)*Math.sin(se/2)+Math.cos(Ce(Z))*Math.cos(Ce(de))*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(ke),Math.sqrt(1-ke)))}const IE="https://badger-transit-dawn-darkness-55.fly.dev";function CE(Z){return Z*3.28084}function zE(Z,ce=new Date){if(!Z.startTime||!Z.endTime)return!0;const[de,ue]=Z.startTime.split(":").map(Number),[Ae,Ce]=Z.endTime.split(":").map(Number);if(!Number.isFinite(de)||!Number.isFinite(ue)||!Number.isFinite(Ae)||!Number.isFinite(Ce))return!0;const se=de*60+ue,n=Ae*60+Ce,ke=ce.getHours()*60+ce.getMinutes();return se<=n?ke>=se&&ke<=n:ke>=se||ke<=n}function RE(Z){try{console.log("Parsing CSV text, first 200 chars:",Z.substring(0,200));const ce=Z.split(`
`).filter(Ae=>Ae.trim());if(console.log(`Total lines in CSV: ${ce.length}`),ce.length===0)return console.error("CSV file is empty"),[];const de=ce.slice(1);console.log(`Processing ${de.length} data lines...`);const ue=de.map((Ae,Ce)=>{const se=Ae.split(",").map(Ci=>Ci.trim().replace(/^"|"$/g,""));if(se.length<4)return console.warn(`Line ${Ce+2} has fewer than 4 columns:`,Ae),null;const[n,ke,Fe,pt]=se,it=parseFloat(Fe),ht=parseFloat(pt);return!n||isNaN(it)||isNaN(ht)?(console.warn(`Line ${Ce+2} has invalid data:`,{stop_id:n,lat:it,lon:ht}),null):{stop_id:n,stop_name:ke||`Stop ${n}`,lat:it,lon:ht}}).filter(Ae=>Ae!==null);return console.log(`Successfully parsed ${ue.length} valid stops`),ue.length>0&&console.log("First stop:",ue[0]),ue}catch(ce){return console.error("Failed to parse CSV:",ce),console.error("Error details:",ce.message),[]}}async function DE(){return console.log("Loading stops from imported CSV..."),RE(ME)}function ww(Z){try{const ce=localStorage.getItem("bt_recent_stops");if(!ce)return 0;const de=JSON.parse(ce);return Array.isArray(de)&&de.find(Ae=>Ae.stopId===Z)?.visit_count||0}catch{return 0}}function PE(Z,ce,de){const Ce=de.map(ke=>{const Fe=bw(Z,ce,ke.lat,ke.lon),pt=CE(Fe),it=ww(ke.stop_id);return{...ke,distanceMeters:Fe,distanceFeet:pt,visit_count:it}}).filter(ke=>ke.distanceFeet<=2e3);Ce.sort((ke,Fe)=>ke.distanceFeet-Fe.distanceFeet);const se=[];let n=0;for(;n<Ce.length&&se.length<3;){const ke=[Ce[n]],Fe=Ce[n].distanceFeet;for(let pt=n+1;pt<Ce.length&&Ce[pt].distanceFeet-Fe<=500;pt++)ke.push(Ce[pt]);ke.sort((pt,it)=>it.visit_count-pt.visit_count),se.push(...ke),n+=ke.length}return se.slice(0,3)}function LE(Z){if(!Z)return"";const ce=Z.toLowerCase().indexOf("bound");let de;if(ce===-1)de=Z;else{let Ae=ce;for(;Ae>0&&Z[Ae-1]!==" ";)Ae--;de=Z.substring(Ae)}if(de=de.trim(),de.length===0)return"";de=de.charAt(0).toUpperCase()+de.slice(1),(de.charAt(0)=="E"||de.charAt(0)=="W")&&(de.charAt(0)=="E",de=de.substring(0,9)),(de.charAt(0)=="N"||de.charAt(0)=="S")&&(de=de.substring(0,10));const ue=1e3;return de.length>ue&&(de=de.slice(0,ue).trimEnd()+""),de}async function kE(Z){try{const ce=await fetch(`${IE}/api/bus-stops/${Z}`);if(!ce.ok)return console.error(`Failed to fetch stop details for ${Z}: ${ce.status}`),null;const de=await ce.json(),ue=await fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/predictions/${Z}`);if(!ce.ok)return[];const Ae=await ue.json();return{routes:Ae.busyness?.current?.by_route?Object.keys(Ae.busyness.current.by_route).sort():[],description:LE(de.stop_desc||"")}}catch(ce){return console.error(`Failed to fetch stop details for ${Z}:`,ce),null}}const FE={A:"#FF0000",A1:"#FF0000",A2:"#FF0000",B:"#84BC00",F:"#2272B5",80:"#FF7300",81:"#00B7C8",82:"#BC009D",84:"#C1C800",D:"#333366",D1:"#333366",D2:"#333366",C:"#333366",C1:"#333366",C2:"#333366",E:"#2272B5",G:"#2272B5",H:"#2272B5",J:"#2272B5",W:"#2272B5",28:"#2272B5",38:"#2272B5",L:"#46AAD1",O:"#46AAD1",P:"#46AAD1",R:"#46AAD1",R1:"#46AAD1",R2:"#46AAD1",S:"#46AAD1",55:"#46AAD1",60:"#46AAD1",65:"#46AAD1"};function OE(Z){return FE[Z]||"#000000"}function Ob(){const Z=$_(),[ce,de]=Tt.useState(null),[ue,Ae]=Tt.useState([]),[Ce,se]=Tt.useState(!0),n=Tt.useRef(null),ke=Tt.useRef(!1);Tt.useEffect(()=>{let ht=!1;async function Ci(){if(console.log(" Starting to load suggested stops..."),!("geolocation"in navigator)){console.log(" Geolocation not available"),se(!1);return}try{console.log(" Requesting geolocation...");const Ui=await new Promise((Un,rr)=>{navigator.geolocation.getCurrentPosition(Un,rr,{enableHighAccuracy:!1,maximumAge:6e4,timeout:1e4})});if(ht)return;const{latitude:Vi,longitude:qi}=Ui.coords;console.log(` Got location: ${Vi}, ${qi}`),console.log(" Loading stops CSV...");const on=await DE();if(console.log(` Loaded ${on.length} stops from CSV`),ht)return;const Ai=PE(Vi,qi,on);console.log(` Found ${Ai.length} suggested stops:`,Ai),console.log(" Fetching stop details for suggested stops...");const an=await Promise.all(Ai.map(async Un=>{const rr=await kE(Un.stop_id);return console.log(`  Stop ${Un.stop_id}: ${rr?.routes?.length||0} routes`),{...Un,routes:rr?.routes||[],description:rr?.description||""}}));ht||(console.log(" Setting suggested stops:",an),Ae(an),se(!1))}catch(Ui){console.error(" Failed to load suggested stops:",Ui),ht||se(!1)}}return Ci(),()=>{ht=!0}},[]),Tt.useEffect(()=>{const ht=xv().filter(Ci=>Ci.enabled!==!1);if(ht.length!==0&&"geolocation"in navigator)return ke.current=!1,navigator.geolocation.getCurrentPosition(Ci=>{const{latitude:Ui,longitude:Vi}=Ci.coords,qi=new Date,on=ht.find(Ai=>zE(Ai,qi)?bw(Ui,Vi,Ai.center.lat,Ai.center.lon)<=Ai.radiusMeters:!1);on&&!ke.current&&(de({stopId:on.stopId,name:on.name||`Stop ${on.stopId}`}),n.current=window.setTimeout(()=>{ke.current||Z(`/stop/${on.stopId}`),n.current=null},1100))},Ci=>{console.warn("SmartLaunch geolocation failed/denied",Ci)},{enableHighAccuracy:!1,maximumAge:6e4,timeout:1e4}),()=>{ke.current=!0,n.current&&(window.clearTimeout(n.current),n.current=null)}},[Z]);const Fe=()=>{ke.current=!0,n.current&&(window.clearTimeout(n.current),n.current=null),de(null)},pt=new Date,it=pt.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return pt.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),he.jsx("main",{className:"home-root",children:he.jsxs("div",{className:"home-page-home-phone",children:[ce&&he.jsx("div",{className:"smartlaunch-toast",role:"alert","aria-live":"assertive",children:he.jsxs("div",{className:"smartlaunch-toast-inner",children:[he.jsxs("div",{className:"smartlaunch-toast-icon-circle","aria-hidden":"true",children:[he.jsxs("svg",{className:"smartlaunch-progress-svg",viewBox:"0 0 88 88",children:[he.jsx("circle",{className:"bg"}),he.jsx("circle",{className:"fg"})]}),he.jsx("span",{className:"smartlaunch-toast-icon-arrow",children:""})]}),he.jsxs("div",{className:"smartlaunch-toast-stop-id",children:["#",ce.stopId]}),he.jsx("button",{type:"button",className:"smartlaunch-toast-button",onClick:Fe,"aria-label":`Cancel redirect to stop ${ce.stopId}`,children:"Stop"})]})}),he.jsxs("header",{className:"home-header",children:[he.jsxs("div",{className:"home-header-top",children:[he.jsxs("div",{className:"home-search-box",children:[he.jsx("div",{className:"new-stop-logo",children:he.jsx("div",{className:"new-stop-logo-circle","aria-hidden":"true"})}),he.jsx("button",{className:"new-stop-search",onClick:()=>Z("/chat"),"aria-label":"Search with BusterChat",children:he.jsx("span",{className:"home-search-text",children:'"Whats the fastest route to..."'})})]}),he.jsxs("div",{className:"home-header-top-left",children:[he.jsx("button",{className:"home-notif-btn","aria-label":"Notifications",children:he.jsx("span",{className:"new-stop-notif-badge",children:"2"})}),he.jsx("button",{className:"home-menu-btn","aria-label":"Menu"})]})]}),he.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[he.jsx("button",{className:"home-nav-btn",onClick:()=>Z("/"),children:"Home"}),he.jsx("div",{className:"divider"}),he.jsx("button",{className:"home-nav-btn",onClick:()=>Z("/recent"),children:"Recent"}),he.jsx("div",{className:"divider"}),he.jsx("button",{className:"home-nav-btn",onClick:()=>Z("/map"),children:"Map"}),he.jsx("div",{className:"divider"}),he.jsx("button",{className:"home-nav-btn",onClick:()=>Z("/help"),children:"Help"})]})]}),he.jsx("div",{className:"home-header-under-fixed"}),he.jsx("div",{className:"home-header-under"}),he.jsx("div",{className:"page-vignette"}),he.jsx("section",{className:"home-hero","aria-labelledby":"hero-title",children:he.jsxs("h1",{id:"hero-title",className:"home-hero-title",children:["You're on a roll today. ",it]})}),Ce&&he.jsx("section",{className:"suggestion-box","aria-labelledby":"loading-title",children:he.jsx("h2",{id:"loading-title",className:"suggestion-title",children:"Loading suggested stops..."})}),!Ce&&ue.length===0&&he.jsx("section",{className:"suggestion-box","aria-labelledby":"no-suggestions-title",children:he.jsx("h2",{id:"no-suggestions-title",className:"suggestion-title",children:"No nearby stops found (check console for details)"})}),!Ce&&ue.length>0&&he.jsxs(he.Fragment,{children:[he.jsx("section",{className:"suggestion-box","aria-labelledby":"suggested-title",children:he.jsx("h2",{id:"suggested-title",className:"suggestion-title",children:"Suggested Stops"})}),he.jsx("section",{className:"suggested-card-grid","aria-label":"Suggested stops near you",children:ue.map(ht=>he.jsxs(Yf,{to:`/stop/${ht.stop_id}`,className:"suggested-stop-card",children:[ht.stop_id>9999&&he.jsx("div",{className:"suggested-stop-card-icon-brt"}),ht.stop_id<9999&&he.jsx("div",{className:"suggested-stop-card-icon-reg"}),he.jsxs("div",{className:"suggested-stop-card-right",children:[he.jsxs("div",{className:"suggested-stop-card-right-left",children:[he.jsx("div",{className:"suggested-stop-card-right-left-top",children:he.jsx("div",{className:"suggested-stop-card-info",children:he.jsxs("div",{className:"suggested-stop-card-info-top",children:[he.jsxs("div",{className:"suggested-stop-card-info-stop-name",children:[he.jsx("span",{className:"suggest-stop-id",children:ht.stop_id}),ht.description," "]}),he.jsx("div",{className:"suggested-stop-card-info-route-chips",children:ht.routes&&ht.routes.length>0&&he.jsxs("div",{className:"suggested-stop-routes",children:[ht.routes.slice(0,9).map(Ci=>he.jsx("span",{className:"suggested-route-badge",style:{backgroundColor:OE(Ci)},children:Ci},Ci)),ht.routes.length>9&&he.jsxs("span",{className:"suggested-route-more",children:["+",ht.routes.length-9]})]})})]})})}),he.jsxs("div",{className:"suggested-stop-card-right-left-bottom",children:[he.jsx("div",{className:"suggested-stop-card-divider"}),ht.description&&he.jsx("div",{className:"suggested-stop-card-info-description",children:ht.stop_name})]})]}),he.jsxs("div",{className:"suggested-stop-card-right-right",children:[he.jsxs("div",{className:"suggested-stop-card-feet",children:[Math.round(ht.distanceFeet)," ft"]}),he.jsxs("span",{className:"visit-count",children:[ww(ht.stop_id)," visits"]})]})]})]},ht.stop_id))})]}),he.jsx("section",{className:"navigation-box","aria-labelledby":"suggested-title",children:he.jsx("h2",{id:"suggested-title",className:"suggestion-title",children:"Traveling Somewhere New?"})}),he.jsx("div",{className:"destination-bar",children:he.jsx("span",{className:"dest-content",children:"Where to?"})}),he.jsx("section",{className:"options-box","aria-labelledby":"suggested-title",children:he.jsx("h2",{id:"suggested-title",className:"suggestion-title",children:"Other Tracking Options"})}),he.jsxs("div",{className:"options-grid",children:[he.jsxs("div",{className:"options-grid-top",children:[he.jsxs(Yf,{to:"/map",className:"options-btn",children:[he.jsx("div",{className:"home-card-icon home-card-icon-map","aria-hidden":"true"}),he.jsx("p",{className:"home-card-title",children:"Select a stop from Map"})]}),he.jsxs(Yf,{to:"/saved",className:"options-btn",children:[he.jsx("div",{className:"home-card-icon home-card-icon-saved","aria-hidden":"true"}),he.jsx("p",{className:"home-card-title",children:"View saved stops and groups"})]})]}),he.jsxs("div",{className:"options-grid-bottom",children:[he.jsxs(Yf,{to:"/recent",className:"options-btn",children:[he.jsx("div",{className:"home-card-icon home-card-icon-star","aria-hidden":"true"}),he.jsx("p",{className:"home-card-title",children:"View recently visited stops"})]}),he.jsxs(Yf,{to:"/routes",className:"options-btn",children:[he.jsx("div",{className:"home-card-icon home-card-icon-search","aria-hidden":"true"}),he.jsx("p",{className:"home-card-title",children:"Search by Stop ID"})]})]})]})]})})}function BE(){return he.jsxs(_S,{children:[he.jsx(Af,{path:"/",element:he.jsx(Ob,{})}),he.jsx(Af,{path:"/map",element:he.jsx($y,{})}),he.jsx(Af,{path:"/map/:routeId",element:he.jsx($y,{})}),he.jsx(Af,{path:"/map/:stopId/:vehicleId",element:he.jsx($y,{})}),he.jsx(Af,{path:"/map/:stopId/:vehicleId/:all",element:he.jsx($y,{})}),he.jsx(Af,{path:"/routes",element:he.jsx(YS,{})}),he.jsx(Af,{path:"/stop/:stopId",element:he.jsx(gE,{})}),he.jsx(Af,{path:"/recent",element:he.jsx(vE,{})}),he.jsx(Af,{path:"/saved",element:he.jsx(bE,{})}),he.jsx(Af,{path:"/settings",element:he.jsx(xE,{})}),he.jsx(Af,{path:"*",element:he.jsx(Ob,{})}),he.jsx(Af,{path:"/buster",element:he.jsx(SE,{})}),he.jsx(Af,{path:"/buster-chat",element:he.jsx(AE,{})})]})}ET.createRoot(document.getElementById("root")).render(he.jsx(yT.StrictMode,{children:he.jsx(jS,{basename:"/mad-transit/",children:he.jsx(BE,{})})}));
