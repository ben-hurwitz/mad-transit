function D1(J,ue){for(var me=0;me<ue.length;me++){const ce=ue[me];if(typeof ce!="string"&&!Array.isArray(ce)){for(const Me in ce)if(Me!=="default"&&!(Me in J)){const Pe=Object.getOwnPropertyDescriptor(ce,Me);Pe&&Object.defineProperty(J,Me,Pe.get?Pe:{enumerable:!0,get:()=>ce[Me]})}}}return Object.freeze(Object.defineProperty(J,Symbol.toStringTag,{value:"Module"}))}(function(){const ue=document.createElement("link").relList;if(ue&&ue.supports&&ue.supports("modulepreload"))return;for(const Me of document.querySelectorAll('link[rel="modulepreload"]'))ce(Me);new MutationObserver(Me=>{for(const Pe of Me)if(Pe.type==="childList")for(const le of Pe.addedNodes)le.tagName==="LINK"&&le.rel==="modulepreload"&&ce(le)}).observe(document,{childList:!0,subtree:!0});function me(Me){const Pe={};return Me.integrity&&(Pe.integrity=Me.integrity),Me.referrerPolicy&&(Pe.referrerPolicy=Me.referrerPolicy),Me.crossOrigin==="use-credentials"?Pe.credentials="include":Me.crossOrigin==="anonymous"?Pe.credentials="omit":Pe.credentials="same-origin",Pe}function ce(Me){if(Me.ep)return;Me.ep=!0;const Pe=me(Me);fetch(Me.href,Pe)}})();function Kg(J){return J&&J.__esModule&&Object.prototype.hasOwnProperty.call(J,"default")?J.default:J}var Zx={exports:{}},Zg={};var Xb;function uS(){if(Xb)return Zg;Xb=1;var J=Symbol.for("react.transitional.element"),ue=Symbol.for("react.fragment");function me(ce,Me,Pe){var le=null;if(Pe!==void 0&&(le=""+Pe),Me.key!==void 0&&(le=""+Me.key),"key"in Me){Pe={};for(var n in Me)n!=="key"&&(Pe[n]=Me[n])}else Pe=Me;return Me=Pe.ref,{$$typeof:J,type:ce,key:le,ref:Me!==void 0?Me:null,props:Pe}}return Zg.Fragment=ue,Zg.jsx=me,Zg.jsxs=me,Zg}var Wb;function hS(){return Wb||(Wb=1,Zx.exports=uS()),Zx.exports}var Ae=hS(),Xx={exports:{}},hs={};var Yb;function dS(){if(Yb)return hs;Yb=1;var J=Symbol.for("react.transitional.element"),ue=Symbol.for("react.portal"),me=Symbol.for("react.fragment"),ce=Symbol.for("react.strict_mode"),Me=Symbol.for("react.profiler"),Pe=Symbol.for("react.consumer"),le=Symbol.for("react.context"),n=Symbol.for("react.forward_ref"),tt=Symbol.for("react.suspense"),ke=Symbol.for("react.memo"),Rt=Symbol.for("react.lazy"),ut=Symbol.for("react.activity"),bt=Symbol.iterator;function rn(Tt){return Tt===null||typeof Tt!="object"?null:(Tt=bt&&Tt[bt]||Tt["@@iterator"],typeof Tt=="function"?Tt:null)}var on={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Vi=Object.assign,Wi={};function Tn(Tt,jt,ai){this.props=Tt,this.context=jt,this.refs=Wi,this.updater=ai||on}Tn.prototype.isReactComponent={},Tn.prototype.setState=function(Tt,jt){if(typeof Tt!="object"&&typeof Tt!="function"&&Tt!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Tt,jt,"setState")},Tn.prototype.forceUpdate=function(Tt){this.updater.enqueueForceUpdate(this,Tt,"forceUpdate")};function Ci(){}Ci.prototype=Tn.prototype;function Ji(Tt,jt,ai){this.props=Tt,this.context=jt,this.refs=Wi,this.updater=ai||on}var Vn=Ji.prototype=new Ci;Vn.constructor=Ji,Vi(Vn,Tn.prototype),Vn.isPureReactComponent=!0;var Oi=Array.isArray;function Hn(){}var qi={H:null,A:null,T:null,S:null},Ot=Object.prototype.hasOwnProperty;function Vt(Tt,jt,ai){var ln=ai.ref;return{$$typeof:J,type:Tt,key:jt,ref:ln!==void 0?ln:null,props:ai}}function Hi(Tt,jt){return Vt(Tt.type,jt,Tt.props)}function dn(Tt){return typeof Tt=="object"&&Tt!==null&&Tt.$$typeof===J}function Ui(Tt){var jt={"=":"=0",":":"=2"};return"$"+Tt.replace(/[=:]/g,function(ai){return jt[ai]})}var an=/\/+/g;function Hr(Tt,jt){return typeof Tt=="object"&&Tt!==null&&Tt.key!=null?Ui(""+Tt.key):jt.toString(36)}function Qr(Tt){switch(Tt.status){case"fulfilled":return Tt.value;case"rejected":throw Tt.reason;default:switch(typeof Tt.status=="string"?Tt.then(Hn,Hn):(Tt.status="pending",Tt.then(function(jt){Tt.status==="pending"&&(Tt.status="fulfilled",Tt.value=jt)},function(jt){Tt.status==="pending"&&(Tt.status="rejected",Tt.reason=jt)})),Tt.status){case"fulfilled":return Tt.value;case"rejected":throw Tt.reason}}throw Tt}function ui(Tt,jt,ai,ln,Jn){var _r=typeof Tt;(_r==="undefined"||_r==="boolean")&&(Tt=null);var Mr=!1;if(Tt===null)Mr=!0;else switch(_r){case"bigint":case"string":case"number":Mr=!0;break;case"object":switch(Tt.$$typeof){case J:case ue:Mr=!0;break;case Rt:return Mr=Tt._init,ui(Mr(Tt._payload),jt,ai,ln,Jn)}}if(Mr)return Jn=Jn(Tt),Mr=ln===""?"."+Hr(Tt,0):ln,Oi(Jn)?(ai="",Mr!=null&&(ai=Mr.replace(an,"$&/")+"/"),ui(Jn,jt,ai,"",function(Cr){return Cr})):Jn!=null&&(dn(Jn)&&(Jn=Hi(Jn,ai+(Jn.key==null||Tt&&Tt.key===Jn.key?"":(""+Jn.key).replace(an,"$&/")+"/")+Mr)),jt.push(Jn)),1;Mr=0;var pr=ln===""?".":ln+":";if(Oi(Tt))for(var Cn=0;Cn<Tt.length;Cn++)ln=Tt[Cn],_r=pr+Hr(ln,Cn),Mr+=ui(ln,jt,ai,_r,Jn);else if(Cn=rn(Tt),typeof Cn=="function")for(Tt=Cn.call(Tt),Cn=0;!(ln=Tt.next()).done;)ln=ln.value,_r=pr+Hr(ln,Cn++),Mr+=ui(ln,jt,ai,_r,Jn);else if(_r==="object"){if(typeof Tt.then=="function")return ui(Qr(Tt),jt,ai,ln,Jn);throw jt=String(Tt),Error("Objects are not valid as a React child (found: "+(jt==="[object Object]"?"object with keys {"+Object.keys(Tt).join(", ")+"}":jt)+"). If you meant to render a collection of children, use an array instead.")}return Mr}function Si(Tt,jt,ai){if(Tt==null)return Tt;var ln=[],Jn=0;return ui(Tt,ln,"","",function(_r){return jt.call(ai,_r,Jn++)}),ln}function yn(Tt){if(Tt._status===-1){var jt=Tt._result;jt=jt(),jt.then(function(ai){(Tt._status===0||Tt._status===-1)&&(Tt._status=1,Tt._result=ai)},function(ai){(Tt._status===0||Tt._status===-1)&&(Tt._status=2,Tt._result=ai)}),Tt._status===-1&&(Tt._status=0,Tt._result=jt)}if(Tt._status===1)return Tt._result.default;throw Tt._result}var Rn=typeof reportError=="function"?reportError:function(Tt){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var jt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Tt=="object"&&Tt!==null&&typeof Tt.message=="string"?String(Tt.message):String(Tt),error:Tt});if(!window.dispatchEvent(jt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",Tt);return}console.error(Tt)},wr={map:Si,forEach:function(Tt,jt,ai){Si(Tt,function(){jt.apply(this,arguments)},ai)},count:function(Tt){var jt=0;return Si(Tt,function(){jt++}),jt},toArray:function(Tt){return Si(Tt,function(jt){return jt})||[]},only:function(Tt){if(!dn(Tt))throw Error("React.Children.only expected to receive a single React element child.");return Tt}};return hs.Activity=ut,hs.Children=wr,hs.Component=Tn,hs.Fragment=me,hs.Profiler=Me,hs.PureComponent=Ji,hs.StrictMode=ce,hs.Suspense=tt,hs.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=qi,hs.__COMPILER_RUNTIME={__proto__:null,c:function(Tt){return qi.H.useMemoCache(Tt)}},hs.cache=function(Tt){return function(){return Tt.apply(null,arguments)}},hs.cacheSignal=function(){return null},hs.cloneElement=function(Tt,jt,ai){if(Tt==null)throw Error("The argument must be a React element, but you passed "+Tt+".");var ln=Vi({},Tt.props),Jn=Tt.key;if(jt!=null)for(_r in jt.key!==void 0&&(Jn=""+jt.key),jt)!Ot.call(jt,_r)||_r==="key"||_r==="__self"||_r==="__source"||_r==="ref"&&jt.ref===void 0||(ln[_r]=jt[_r]);var _r=arguments.length-2;if(_r===1)ln.children=ai;else if(1<_r){for(var Mr=Array(_r),pr=0;pr<_r;pr++)Mr[pr]=arguments[pr+2];ln.children=Mr}return Vt(Tt.type,Jn,ln)},hs.createContext=function(Tt){return Tt={$$typeof:le,_currentValue:Tt,_currentValue2:Tt,_threadCount:0,Provider:null,Consumer:null},Tt.Provider=Tt,Tt.Consumer={$$typeof:Pe,_context:Tt},Tt},hs.createElement=function(Tt,jt,ai){var ln,Jn={},_r=null;if(jt!=null)for(ln in jt.key!==void 0&&(_r=""+jt.key),jt)Ot.call(jt,ln)&&ln!=="key"&&ln!=="__self"&&ln!=="__source"&&(Jn[ln]=jt[ln]);var Mr=arguments.length-2;if(Mr===1)Jn.children=ai;else if(1<Mr){for(var pr=Array(Mr),Cn=0;Cn<Mr;Cn++)pr[Cn]=arguments[Cn+2];Jn.children=pr}if(Tt&&Tt.defaultProps)for(ln in Mr=Tt.defaultProps,Mr)Jn[ln]===void 0&&(Jn[ln]=Mr[ln]);return Vt(Tt,_r,Jn)},hs.createRef=function(){return{current:null}},hs.forwardRef=function(Tt){return{$$typeof:n,render:Tt}},hs.isValidElement=dn,hs.lazy=function(Tt){return{$$typeof:Rt,_payload:{_status:-1,_result:Tt},_init:yn}},hs.memo=function(Tt,jt){return{$$typeof:ke,type:Tt,compare:jt===void 0?null:jt}},hs.startTransition=function(Tt){var jt=qi.T,ai={};qi.T=ai;try{var ln=Tt(),Jn=qi.S;Jn!==null&&Jn(ai,ln),typeof ln=="object"&&ln!==null&&typeof ln.then=="function"&&ln.then(Hn,Rn)}catch(_r){Rn(_r)}finally{jt!==null&&ai.types!==null&&(jt.types=ai.types),qi.T=jt}},hs.unstable_useCacheRefresh=function(){return qi.H.useCacheRefresh()},hs.use=function(Tt){return qi.H.use(Tt)},hs.useActionState=function(Tt,jt,ai){return qi.H.useActionState(Tt,jt,ai)},hs.useCallback=function(Tt,jt){return qi.H.useCallback(Tt,jt)},hs.useContext=function(Tt){return qi.H.useContext(Tt)},hs.useDebugValue=function(){},hs.useDeferredValue=function(Tt,jt){return qi.H.useDeferredValue(Tt,jt)},hs.useEffect=function(Tt,jt){return qi.H.useEffect(Tt,jt)},hs.useEffectEvent=function(Tt){return qi.H.useEffectEvent(Tt)},hs.useId=function(){return qi.H.useId()},hs.useImperativeHandle=function(Tt,jt,ai){return qi.H.useImperativeHandle(Tt,jt,ai)},hs.useInsertionEffect=function(Tt,jt){return qi.H.useInsertionEffect(Tt,jt)},hs.useLayoutEffect=function(Tt,jt){return qi.H.useLayoutEffect(Tt,jt)},hs.useMemo=function(Tt,jt){return qi.H.useMemo(Tt,jt)},hs.useOptimistic=function(Tt,jt){return qi.H.useOptimistic(Tt,jt)},hs.useReducer=function(Tt,jt,ai){return qi.H.useReducer(Tt,jt,ai)},hs.useRef=function(Tt){return qi.H.useRef(Tt)},hs.useState=function(Tt){return qi.H.useState(Tt)},hs.useSyncExternalStore=function(Tt,jt,ai){return qi.H.useSyncExternalStore(Tt,jt,ai)},hs.useTransition=function(){return qi.H.useTransition()},hs.version="19.2.0",hs}var Kb;function lv(){return Kb||(Kb=1,Xx.exports=dS()),Xx.exports}var Ft=lv();const fS=Kg(Ft);var Wx={exports:{}},Xg={},Yx={exports:{}},Kx={};var Jb;function pS(){return Jb||(Jb=1,(function(J){function ue(ui,Si){var yn=ui.length;ui.push(Si);e:for(;0<yn;){var Rn=yn-1>>>1,wr=ui[Rn];if(0<Me(wr,Si))ui[Rn]=Si,ui[yn]=wr,yn=Rn;else break e}}function me(ui){return ui.length===0?null:ui[0]}function ce(ui){if(ui.length===0)return null;var Si=ui[0],yn=ui.pop();if(yn!==Si){ui[0]=yn;e:for(var Rn=0,wr=ui.length,Tt=wr>>>1;Rn<Tt;){var jt=2*(Rn+1)-1,ai=ui[jt],ln=jt+1,Jn=ui[ln];if(0>Me(ai,yn))ln<wr&&0>Me(Jn,ai)?(ui[Rn]=Jn,ui[ln]=yn,Rn=ln):(ui[Rn]=ai,ui[jt]=yn,Rn=jt);else if(ln<wr&&0>Me(Jn,yn))ui[Rn]=Jn,ui[ln]=yn,Rn=ln;else break e}}return Si}function Me(ui,Si){var yn=ui.sortIndex-Si.sortIndex;return yn!==0?yn:ui.id-Si.id}if(J.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var Pe=performance;J.unstable_now=function(){return Pe.now()}}else{var le=Date,n=le.now();J.unstable_now=function(){return le.now()-n}}var tt=[],ke=[],Rt=1,ut=null,bt=3,rn=!1,on=!1,Vi=!1,Wi=!1,Tn=typeof setTimeout=="function"?setTimeout:null,Ci=typeof clearTimeout=="function"?clearTimeout:null,Ji=typeof setImmediate<"u"?setImmediate:null;function Vn(ui){for(var Si=me(ke);Si!==null;){if(Si.callback===null)ce(ke);else if(Si.startTime<=ui)ce(ke),Si.sortIndex=Si.expirationTime,ue(tt,Si);else break;Si=me(ke)}}function Oi(ui){if(Vi=!1,Vn(ui),!on)if(me(tt)!==null)on=!0,Hn||(Hn=!0,Ui());else{var Si=me(ke);Si!==null&&Qr(Oi,Si.startTime-ui)}}var Hn=!1,qi=-1,Ot=5,Vt=-1;function Hi(){return Wi?!0:!(J.unstable_now()-Vt<Ot)}function dn(){if(Wi=!1,Hn){var ui=J.unstable_now();Vt=ui;var Si=!0;try{e:{on=!1,Vi&&(Vi=!1,Ci(qi),qi=-1),rn=!0;var yn=bt;try{t:{for(Vn(ui),ut=me(tt);ut!==null&&!(ut.expirationTime>ui&&Hi());){var Rn=ut.callback;if(typeof Rn=="function"){ut.callback=null,bt=ut.priorityLevel;var wr=Rn(ut.expirationTime<=ui);if(ui=J.unstable_now(),typeof wr=="function"){ut.callback=wr,Vn(ui),Si=!0;break t}ut===me(tt)&&ce(tt),Vn(ui)}else ce(tt);ut=me(tt)}if(ut!==null)Si=!0;else{var Tt=me(ke);Tt!==null&&Qr(Oi,Tt.startTime-ui),Si=!1}}break e}finally{ut=null,bt=yn,rn=!1}Si=void 0}}finally{Si?Ui():Hn=!1}}}var Ui;if(typeof Ji=="function")Ui=function(){Ji(dn)};else if(typeof MessageChannel<"u"){var an=new MessageChannel,Hr=an.port2;an.port1.onmessage=dn,Ui=function(){Hr.postMessage(null)}}else Ui=function(){Tn(dn,0)};function Qr(ui,Si){qi=Tn(function(){ui(J.unstable_now())},Si)}J.unstable_IdlePriority=5,J.unstable_ImmediatePriority=1,J.unstable_LowPriority=4,J.unstable_NormalPriority=3,J.unstable_Profiling=null,J.unstable_UserBlockingPriority=2,J.unstable_cancelCallback=function(ui){ui.callback=null},J.unstable_forceFrameRate=function(ui){0>ui||125<ui?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ot=0<ui?Math.floor(1e3/ui):5},J.unstable_getCurrentPriorityLevel=function(){return bt},J.unstable_next=function(ui){switch(bt){case 1:case 2:case 3:var Si=3;break;default:Si=bt}var yn=bt;bt=Si;try{return ui()}finally{bt=yn}},J.unstable_requestPaint=function(){Wi=!0},J.unstable_runWithPriority=function(ui,Si){switch(ui){case 1:case 2:case 3:case 4:case 5:break;default:ui=3}var yn=bt;bt=ui;try{return Si()}finally{bt=yn}},J.unstable_scheduleCallback=function(ui,Si,yn){var Rn=J.unstable_now();switch(typeof yn=="object"&&yn!==null?(yn=yn.delay,yn=typeof yn=="number"&&0<yn?Rn+yn:Rn):yn=Rn,ui){case 1:var wr=-1;break;case 2:wr=250;break;case 5:wr=1073741823;break;case 4:wr=1e4;break;default:wr=5e3}return wr=yn+wr,ui={id:Rt++,callback:Si,priorityLevel:ui,startTime:yn,expirationTime:wr,sortIndex:-1},yn>Rn?(ui.sortIndex=yn,ue(ke,ui),me(tt)===null&&ui===me(ke)&&(Vi?(Ci(qi),qi=-1):Vi=!0,Qr(Oi,yn-Rn))):(ui.sortIndex=wr,ue(tt,ui),on||rn||(on=!0,Hn||(Hn=!0,Ui()))),ui},J.unstable_shouldYield=Hi,J.unstable_wrapCallback=function(ui){var Si=bt;return function(){var yn=bt;bt=Si;try{return ui.apply(this,arguments)}finally{bt=yn}}}})(Kx)),Kx}var Qb;function mS(){return Qb||(Qb=1,Yx.exports=pS()),Yx.exports}var Jx={exports:{}},Sd={};var e1;function _S(){if(e1)return Sd;e1=1;var J=lv();function ue(tt){var ke="https://react.dev/errors/"+tt;if(1<arguments.length){ke+="?args[]="+encodeURIComponent(arguments[1]);for(var Rt=2;Rt<arguments.length;Rt++)ke+="&args[]="+encodeURIComponent(arguments[Rt])}return"Minified React error #"+tt+"; visit "+ke+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function me(){}var ce={d:{f:me,r:function(){throw Error(ue(522))},D:me,C:me,L:me,m:me,X:me,S:me,M:me},p:0,findDOMNode:null},Me=Symbol.for("react.portal");function Pe(tt,ke,Rt){var ut=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Me,key:ut==null?null:""+ut,children:tt,containerInfo:ke,implementation:Rt}}var le=J.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function n(tt,ke){if(tt==="font")return"";if(typeof ke=="string")return ke==="use-credentials"?ke:""}return Sd.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ce,Sd.createPortal=function(tt,ke){var Rt=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ke||ke.nodeType!==1&&ke.nodeType!==9&&ke.nodeType!==11)throw Error(ue(299));return Pe(tt,ke,null,Rt)},Sd.flushSync=function(tt){var ke=le.T,Rt=ce.p;try{if(le.T=null,ce.p=2,tt)return tt()}finally{le.T=ke,ce.p=Rt,ce.d.f()}},Sd.preconnect=function(tt,ke){typeof tt=="string"&&(ke?(ke=ke.crossOrigin,ke=typeof ke=="string"?ke==="use-credentials"?ke:"":void 0):ke=null,ce.d.C(tt,ke))},Sd.prefetchDNS=function(tt){typeof tt=="string"&&ce.d.D(tt)},Sd.preinit=function(tt,ke){if(typeof tt=="string"&&ke&&typeof ke.as=="string"){var Rt=ke.as,ut=n(Rt,ke.crossOrigin),bt=typeof ke.integrity=="string"?ke.integrity:void 0,rn=typeof ke.fetchPriority=="string"?ke.fetchPriority:void 0;Rt==="style"?ce.d.S(tt,typeof ke.precedence=="string"?ke.precedence:void 0,{crossOrigin:ut,integrity:bt,fetchPriority:rn}):Rt==="script"&&ce.d.X(tt,{crossOrigin:ut,integrity:bt,fetchPriority:rn,nonce:typeof ke.nonce=="string"?ke.nonce:void 0})}},Sd.preinitModule=function(tt,ke){if(typeof tt=="string")if(typeof ke=="object"&&ke!==null){if(ke.as==null||ke.as==="script"){var Rt=n(ke.as,ke.crossOrigin);ce.d.M(tt,{crossOrigin:Rt,integrity:typeof ke.integrity=="string"?ke.integrity:void 0,nonce:typeof ke.nonce=="string"?ke.nonce:void 0})}}else ke==null&&ce.d.M(tt)},Sd.preload=function(tt,ke){if(typeof tt=="string"&&typeof ke=="object"&&ke!==null&&typeof ke.as=="string"){var Rt=ke.as,ut=n(Rt,ke.crossOrigin);ce.d.L(tt,Rt,{crossOrigin:ut,integrity:typeof ke.integrity=="string"?ke.integrity:void 0,nonce:typeof ke.nonce=="string"?ke.nonce:void 0,type:typeof ke.type=="string"?ke.type:void 0,fetchPriority:typeof ke.fetchPriority=="string"?ke.fetchPriority:void 0,referrerPolicy:typeof ke.referrerPolicy=="string"?ke.referrerPolicy:void 0,imageSrcSet:typeof ke.imageSrcSet=="string"?ke.imageSrcSet:void 0,imageSizes:typeof ke.imageSizes=="string"?ke.imageSizes:void 0,media:typeof ke.media=="string"?ke.media:void 0})}},Sd.preloadModule=function(tt,ke){if(typeof tt=="string")if(ke){var Rt=n(ke.as,ke.crossOrigin);ce.d.m(tt,{as:typeof ke.as=="string"&&ke.as!=="script"?ke.as:void 0,crossOrigin:Rt,integrity:typeof ke.integrity=="string"?ke.integrity:void 0})}else ce.d.m(tt)},Sd.requestFormReset=function(tt){ce.d.r(tt)},Sd.unstable_batchedUpdates=function(tt,ke){return tt(ke)},Sd.useFormState=function(tt,ke,Rt){return le.H.useFormState(tt,ke,Rt)},Sd.useFormStatus=function(){return le.H.useHostTransitionStatus()},Sd.version="19.2.0",Sd}var t1;function R1(){if(t1)return Jx.exports;t1=1;function J(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(J)}catch(ue){console.error(ue)}}return J(),Jx.exports=_S(),Jx.exports}var i1;function gS(){if(i1)return Xg;i1=1;var J=mS(),ue=lv(),me=R1();function ce(c){var m="https://react.dev/errors/"+c;if(1<arguments.length){m+="?args[]="+encodeURIComponent(arguments[1]);for(var w=2;w<arguments.length;w++)m+="&args[]="+encodeURIComponent(arguments[w])}return"Minified React error #"+c+"; visit "+m+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function Me(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function Pe(c){var m=c,w=c;if(c.alternate)for(;m.return;)m=m.return;else{c=m;do m=c,(m.flags&4098)!==0&&(w=m.return),c=m.return;while(c)}return m.tag===3?w:null}function le(c){if(c.tag===13){var m=c.memoizedState;if(m===null&&(c=c.alternate,c!==null&&(m=c.memoizedState)),m!==null)return m.dehydrated}return null}function n(c){if(c.tag===31){var m=c.memoizedState;if(m===null&&(c=c.alternate,c!==null&&(m=c.memoizedState)),m!==null)return m.dehydrated}return null}function tt(c){if(Pe(c)!==c)throw Error(ce(188))}function ke(c){var m=c.alternate;if(!m){if(m=Pe(c),m===null)throw Error(ce(188));return m!==c?null:c}for(var w=c,D=m;;){var G=w.return;if(G===null)break;var W=G.alternate;if(W===null){if(D=G.return,D!==null){w=D;continue}break}if(G.child===W.child){for(W=G.child;W;){if(W===w)return tt(G),c;if(W===D)return tt(G),m;W=W.sibling}throw Error(ce(188))}if(w.return!==D.return)w=G,D=W;else{for(var ve=!1,Je=G.child;Je;){if(Je===w){ve=!0,w=G,D=W;break}if(Je===D){ve=!0,D=G,w=W;break}Je=Je.sibling}if(!ve){for(Je=W.child;Je;){if(Je===w){ve=!0,w=W,D=G;break}if(Je===D){ve=!0,D=W,w=G;break}Je=Je.sibling}if(!ve)throw Error(ce(189))}}if(w.alternate!==D)throw Error(ce(190))}if(w.tag!==3)throw Error(ce(188));return w.stateNode.current===w?c:m}function Rt(c){var m=c.tag;if(m===5||m===26||m===27||m===6)return c;for(c=c.child;c!==null;){if(m=Rt(c),m!==null)return m;c=c.sibling}return null}var ut=Object.assign,bt=Symbol.for("react.element"),rn=Symbol.for("react.transitional.element"),on=Symbol.for("react.portal"),Vi=Symbol.for("react.fragment"),Wi=Symbol.for("react.strict_mode"),Tn=Symbol.for("react.profiler"),Ci=Symbol.for("react.consumer"),Ji=Symbol.for("react.context"),Vn=Symbol.for("react.forward_ref"),Oi=Symbol.for("react.suspense"),Hn=Symbol.for("react.suspense_list"),qi=Symbol.for("react.memo"),Ot=Symbol.for("react.lazy"),Vt=Symbol.for("react.activity"),Hi=Symbol.for("react.memo_cache_sentinel"),dn=Symbol.iterator;function Ui(c){return c===null||typeof c!="object"?null:(c=dn&&c[dn]||c["@@iterator"],typeof c=="function"?c:null)}var an=Symbol.for("react.client.reference");function Hr(c){if(c==null)return null;if(typeof c=="function")return c.$$typeof===an?null:c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case Vi:return"Fragment";case Tn:return"Profiler";case Wi:return"StrictMode";case Oi:return"Suspense";case Hn:return"SuspenseList";case Vt:return"Activity"}if(typeof c=="object")switch(c.$$typeof){case on:return"Portal";case Ji:return c.displayName||"Context";case Ci:return(c._context.displayName||"Context")+".Consumer";case Vn:var m=c.render;return c=c.displayName,c||(c=m.displayName||m.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case qi:return m=c.displayName||null,m!==null?m:Hr(c.type)||"Memo";case Ot:m=c._payload,c=c._init;try{return Hr(c(m))}catch{}}return null}var Qr=Array.isArray,ui=ue.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Si=me.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,yn={pending:!1,data:null,method:null,action:null},Rn=[],wr=-1;function Tt(c){return{current:c}}function jt(c){0>wr||(c.current=Rn[wr],Rn[wr]=null,wr--)}function ai(c,m){wr++,Rn[wr]=c.current,c.current=m}var ln=Tt(null),Jn=Tt(null),_r=Tt(null),Mr=Tt(null);function pr(c,m){switch(ai(_r,m),ai(Jn,c),ai(ln,null),m.nodeType){case 9:case 11:c=(c=m.documentElement)&&(c=c.namespaceURI)?O(c):0;break;default:if(c=m.tagName,m=m.namespaceURI)m=O(m),c=B(m,c);else switch(c){case"svg":c=1;break;case"math":c=2;break;default:c=0}}jt(ln),ai(ln,c)}function Cn(){jt(ln),jt(Jn),jt(_r)}function Cr(c){c.memoizedState!==null&&ai(Mr,c);var m=ln.current,w=B(m,c.type);m!==w&&(ai(Jn,c),ai(ln,w))}function Ir(c){Jn.current===c&&(jt(ln),jt(Jn)),Mr.current===c&&(jt(Mr),Mm._currentValue=yn)}var Fa,ra;function Aa(c){if(Fa===void 0)try{throw Error()}catch(w){var m=w.stack.trim().match(/\n( *(at )?)/);Fa=m&&m[1]||"",ra=-1<w.stack.indexOf(`
    at`)?" (<anonymous>)":-1<w.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Fa+c+ra}var Da=!1;function Yt(c,m){if(!c||Da)return"";Da=!0;var w=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var D={DetermineComponentFrameRoot:function(){try{if(m){var hn=function(){throw Error()};if(Object.defineProperty(hn.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(hn,[])}catch(Ni){var Li=Ni}Reflect.construct(c,[],hn)}else{try{hn.call()}catch(Ni){Li=Ni}c.call(hn.prototype)}}else{try{throw Error()}catch(Ni){Li=Ni}(hn=c())&&typeof hn.catch=="function"&&hn.catch(function(){})}}catch(Ni){if(Ni&&Li&&typeof Ni.stack=="string")return[Ni.stack,Li.stack]}return[null,null]}};D.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var G=Object.getOwnPropertyDescriptor(D.DetermineComponentFrameRoot,"name");G&&G.configurable&&Object.defineProperty(D.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var W=D.DetermineComponentFrameRoot(),ve=W[0],Je=W[1];if(ve&&Je){var kt=ve.split(`
`),Mi=Je.split(`
`);for(G=D=0;D<kt.length&&!kt[D].includes("DetermineComponentFrameRoot");)D++;for(;G<Mi.length&&!Mi[G].includes("DetermineComponentFrameRoot");)G++;if(D===kt.length||G===Mi.length)for(D=kt.length-1,G=Mi.length-1;1<=D&&0<=G&&kt[D]!==Mi[G];)G--;for(;1<=D&&0<=G;D--,G--)if(kt[D]!==Mi[G]){if(D!==1||G!==1)do if(D--,G--,0>G||kt[D]!==Mi[G]){var nn=`
`+kt[D].replace(" at new "," at ");return c.displayName&&nn.includes("<anonymous>")&&(nn=nn.replace("<anonymous>",c.displayName)),nn}while(1<=D&&0<=G);break}}}finally{Da=!1,Error.prepareStackTrace=w}return(w=c?c.displayName||c.name:"")?Aa(w):""}function Ha(c,m){switch(c.tag){case 26:case 27:case 5:return Aa(c.type);case 16:return Aa("Lazy");case 13:return c.child!==m&&m!==null?Aa("Suspense Fallback"):Aa("Suspense");case 19:return Aa("SuspenseList");case 0:case 15:return Yt(c.type,!1);case 11:return Yt(c.type.render,!1);case 1:return Yt(c.type,!0);case 31:return Aa("Activity");default:return""}}function zr(c){try{var m="",w=null;do m+=Ha(c,w),w=c,c=c.return;while(c);return m}catch(D){return`
Error generating stack: `+D.message+`
`+D.stack}}var Dr=Object.prototype.hasOwnProperty,ma=J.unstable_scheduleCallback,rl=J.unstable_cancelCallback,ho=J.unstable_shouldYield,Vo=J.unstable_requestPaint,la=J.unstable_now,Vs=J.unstable_getCurrentPriorityLevel,qs=J.unstable_ImmediatePriority,Us=J.unstable_UserBlockingPriority,cn=J.unstable_NormalPriority,Ws=J.unstable_LowPriority,To=J.unstable_IdlePriority,Do=J.log,So=J.unstable_setDisableYieldValue,Sn=null,tr=null;function ar(c){if(typeof Do=="function"&&So(c),tr&&typeof tr.setStrictMode=="function")try{tr.setStrictMode(Sn,c)}catch{}}var Hs=Math.clz32?Math.clz32:ml,pl=Math.log,Xr=Math.LN2;function ml(c){return c>>>=0,c===0?32:31-(pl(c)/Xr|0)|0}var Uo=256,lc=262144,ul=4194304;function dt(c){var m=c&42;if(m!==0)return m;switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return c&261888;case 262144:case 524288:case 1048576:case 2097152:return c&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return c&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return c}}function Ce(c,m,w){var D=c.pendingLanes;if(D===0)return 0;var G=0,W=c.suspendedLanes,ve=c.pingedLanes;c=c.warmLanes;var Je=D&134217727;return Je!==0?(D=Je&~W,D!==0?G=dt(D):(ve&=Je,ve!==0?G=dt(ve):w||(w=Je&~c,w!==0&&(G=dt(w))))):(Je=D&~W,Je!==0?G=dt(Je):ve!==0?G=dt(ve):w||(w=D&~c,w!==0&&(G=dt(w)))),G===0?0:m!==0&&m!==G&&(m&W)===0&&(W=G&-G,w=m&-m,W>=w||W===32&&(w&4194048)!==0)?m:G}function Re(c,m){return(c.pendingLanes&~(c.suspendedLanes&~c.pingedLanes)&m)===0}function Qe(c,m){switch(c){case 1:case 2:case 4:case 8:case 64:return m+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return m+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mt(){var c=ul;return ul<<=1,(ul&62914560)===0&&(ul=4194304),c}function Nt(c){for(var m=[],w=0;31>w;w++)m.push(c);return m}function je(c,m){c.pendingLanes|=m,m!==268435456&&(c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0)}function ei(c,m,w,D,G,W){var ve=c.pendingLanes;c.pendingLanes=w,c.suspendedLanes=0,c.pingedLanes=0,c.warmLanes=0,c.expiredLanes&=w,c.entangledLanes&=w,c.errorRecoveryDisabledLanes&=w,c.shellSuspendCounter=0;var Je=c.entanglements,kt=c.expirationTimes,Mi=c.hiddenUpdates;for(w=ve&~w;0<w;){var nn=31-Hs(w),hn=1<<nn;Je[nn]=0,kt[nn]=-1;var Li=Mi[nn];if(Li!==null)for(Mi[nn]=null,nn=0;nn<Li.length;nn++){var Ni=Li[nn];Ni!==null&&(Ni.lane&=-536870913)}w&=~hn}D!==0&&Pt(c,D,0),W!==0&&G===0&&c.tag!==0&&(c.suspendedLanes|=W&~(ve&~m))}function Pt(c,m,w){c.pendingLanes|=m,c.suspendedLanes&=~m;var D=31-Hs(m);c.entangledLanes|=m,c.entanglements[D]=c.entanglements[D]|1073741824|w&261930}function Di(c,m){var w=c.entangledLanes|=m;for(c=c.entanglements;w;){var D=31-Hs(w),G=1<<D;G&m|c[D]&m&&(c[D]|=m),w&=~G}}function fi(c,m){var w=m&-m;return w=(w&42)!==0?1:hi(w),(w&(c.suspendedLanes|m))!==0?0:w}function hi(c){switch(c){case 2:c=1;break;case 8:c=4;break;case 32:c=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:c=128;break;case 268435456:c=134217728;break;default:c=0}return c}function kn(c){return c&=-c,2<c?8<c?(c&134217727)!==0?32:268435456:8:2}function hr(){var c=Si.p;return c!==0?c:(c=window.event,c===void 0?32:Uc(c.type))}function Tr(c,m){var w=Si.p;try{return Si.p=c,m()}finally{Si.p=w}}var lt=Math.random().toString(36).slice(2),te="__reactFiber$"+lt,pe="__reactProps$"+lt,ze="__reactContainer$"+lt,et="__reactEvents$"+lt,Xe="__reactListeners$"+lt,rt="__reactHandles$"+lt,wt="__reactResources$"+lt,ot="__reactMarker$"+lt;function At(c){delete c[te],delete c[pe],delete c[et],delete c[Xe],delete c[rt]}function ti(c){var m=c[te];if(m)return m;for(var w=c.parentNode;w;){if(m=w[ze]||w[te]){if(w=m.alternate,m.child!==null||w!==null&&w.child!==null)for(c=or(c);c!==null;){if(w=c[te])return w;c=or(c)}return m}c=w,w=c.parentNode}return null}function qt(c){if(c=c[te]||c[ze]){var m=c.tag;if(m===5||m===6||m===13||m===31||m===26||m===27||m===3)return c}return null}function Yi(c){var m=c.tag;if(m===5||m===26||m===27||m===6)return c.stateNode;throw Error(ce(33))}function Ki(c){var m=c[wt];return m||(m=c[wt]={hoistableStyles:new Map,hoistableScripts:new Map}),m}function Bi(c){c[ot]=!0}var dr=new Set,$n={};function Nn(c,m){Ur(c,m),Ur(c+"Capture",m)}function Ur(c,m){for($n[c]=m,c=0;c<m.length;c++)dr.add(m[c])}var La=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ja={},ss={};function js(c){return Dr.call(ss,c)?!0:Dr.call(Ja,c)?!1:La.test(c)?ss[c]=!0:(Ja[c]=!0,!1)}function ea(c,m,w){if(js(m))if(w===null)c.removeAttribute(m);else{switch(typeof w){case"undefined":case"function":case"symbol":c.removeAttribute(m);return;case"boolean":var D=m.toLowerCase().slice(0,5);if(D!=="data-"&&D!=="aria-"){c.removeAttribute(m);return}}c.setAttribute(m,""+w)}}function jr(c,m,w){if(w===null)c.removeAttribute(m);else{switch(typeof w){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(m);return}c.setAttribute(m,""+w)}}function da(c,m,w,D){if(D===null)c.removeAttribute(w);else{switch(typeof D){case"undefined":case"function":case"symbol":case"boolean":c.removeAttribute(w);return}c.setAttributeNS(m,w,""+D)}}function lr(c){switch(typeof c){case"bigint":case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function Rr(c){var m=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(m==="checkbox"||m==="radio")}function $a(c,m,w){var D=Object.getOwnPropertyDescriptor(c.constructor.prototype,m);if(!c.hasOwnProperty(m)&&typeof D<"u"&&typeof D.get=="function"&&typeof D.set=="function"){var G=D.get,W=D.set;return Object.defineProperty(c,m,{configurable:!0,get:function(){return G.call(this)},set:function(ve){w=""+ve,W.call(this,ve)}}),Object.defineProperty(c,m,{enumerable:D.enumerable}),{getValue:function(){return w},setValue:function(ve){w=""+ve},stopTracking:function(){c._valueTracker=null,delete c[m]}}}}function Ro(c){if(!c._valueTracker){var m=Rr(c)?"checked":"value";c._valueTracker=$a(c,m,""+c[m])}}function Ys(c){if(!c)return!1;var m=c._valueTracker;if(!m)return!0;var w=m.getValue(),D="";return c&&(D=Rr(c)?c.checked?"true":"false":c.value),c=D,c!==w?(m.setValue(c),!0):!1}function _l(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}var nh=/[\n"\\]/g;function es(c){return c.replace(nh,function(m){return"\\"+m.charCodeAt(0).toString(16)+" "})}function jo(c,m,w,D,G,W,ve,Je){c.name="",ve!=null&&typeof ve!="function"&&typeof ve!="symbol"&&typeof ve!="boolean"?c.type=ve:c.removeAttribute("type"),m!=null?ve==="number"?(m===0&&c.value===""||c.value!=m)&&(c.value=""+lr(m)):c.value!==""+lr(m)&&(c.value=""+lr(m)):ve!=="submit"&&ve!=="reset"||c.removeAttribute("value"),m!=null?Mc(c,ve,lr(m)):w!=null?Mc(c,ve,lr(w)):D!=null&&c.removeAttribute("value"),G==null&&W!=null&&(c.defaultChecked=!!W),G!=null&&(c.checked=G&&typeof G!="function"&&typeof G!="symbol"),Je!=null&&typeof Je!="function"&&typeof Je!="symbol"&&typeof Je!="boolean"?c.name=""+lr(Je):c.removeAttribute("name")}function _a(c,m,w,D,G,W,ve,Je){if(W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"&&(c.type=W),m!=null||w!=null){if(!(W!=="submit"&&W!=="reset"||m!=null)){Ro(c);return}w=w!=null?""+lr(w):"",m=m!=null?""+lr(m):w,Je||m===c.value||(c.value=m),c.defaultValue=m}D=D??G,D=typeof D!="function"&&typeof D!="symbol"&&!!D,c.checked=Je?c.checked:!!D,c.defaultChecked=!!D,ve!=null&&typeof ve!="function"&&typeof ve!="symbol"&&typeof ve!="boolean"&&(c.name=ve),Ro(c)}function Mc(c,m,w){m==="number"&&_l(c.ownerDocument)===c||c.defaultValue===""+w||(c.defaultValue=""+w)}function Ks(c,m,w,D){if(c=c.options,m){m={};for(var G=0;G<w.length;G++)m["$"+w[G]]=!0;for(w=0;w<c.length;w++)G=m.hasOwnProperty("$"+c[w].value),c[w].selected!==G&&(c[w].selected=G),G&&D&&(c[w].defaultSelected=!0)}else{for(w=""+lr(w),m=null,G=0;G<c.length;G++){if(c[G].value===w){c[G].selected=!0,D&&(c[G].defaultSelected=!0);return}m!==null||c[G].disabled||(m=c[G])}m!==null&&(m.selected=!0)}}function jc(c,m,w){if(m!=null&&(m=""+lr(m),m!==c.value&&(c.value=m),w==null)){c.defaultValue!==m&&(c.defaultValue=m);return}c.defaultValue=w!=null?""+lr(w):""}function Mh(c,m,w,D){if(m==null){if(D!=null){if(w!=null)throw Error(ce(92));if(Qr(D)){if(1<D.length)throw Error(ce(93));D=D[0]}w=D}w==null&&(w=""),m=w}w=lr(m),c.defaultValue=w,D=c.textContent,D===w&&D!==""&&D!==null&&(c.value=D),Ro(c)}function ou(c,m){if(m){var w=c.firstChild;if(w&&w===c.lastChild&&w.nodeType===3){w.nodeValue=m;return}}c.textContent=m}var Jh=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Qh(c,m,w){var D=m.indexOf("--")===0;w==null||typeof w=="boolean"||w===""?D?c.setProperty(m,""):m==="float"?c.cssFloat="":c[m]="":D?c.setProperty(m,w):typeof w!="number"||w===0||Jh.has(m)?m==="float"?c.cssFloat=w:c[m]=(""+w).trim():c[m]=w+"px"}function Mu(c,m,w){if(m!=null&&typeof m!="object")throw Error(ce(62));if(c=c.style,w!=null){for(var D in w)!w.hasOwnProperty(D)||m!=null&&m.hasOwnProperty(D)||(D.indexOf("--")===0?c.setProperty(D,""):D==="float"?c.cssFloat="":c[D]="");for(var G in m)D=m[G],m.hasOwnProperty(G)&&w[G]!==D&&Qh(c,G,D)}else for(var W in m)m.hasOwnProperty(W)&&Qh(c,W,m[W])}function Gc(c){if(c.indexOf("-")===-1)return!1;switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cc=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),lu=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Cc(c){return lu.test(""+c)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":c}function fo(){}var Xl=null;function Po(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Eo=null,cu=null;function Cu(c){var m=qt(c);if(m&&(c=m.stateNode)){var w=c[pe]||null;e:switch(c=m.stateNode,m.type){case"input":if(jo(c,w.value,w.defaultValue,w.defaultValue,w.checked,w.defaultChecked,w.type,w.name),m=w.name,w.type==="radio"&&m!=null){for(w=c;w.parentNode;)w=w.parentNode;for(w=w.querySelectorAll('input[name="'+es(""+m)+'"][type="radio"]'),m=0;m<w.length;m++){var D=w[m];if(D!==c&&D.form===c.form){var G=D[pe]||null;if(!G)throw Error(ce(90));jo(D,G.value,G.defaultValue,G.defaultValue,G.checked,G.defaultChecked,G.type,G.name)}}for(m=0;m<w.length;m++)D=w[m],D.form===c.form&&Ys(D)}break e;case"textarea":jc(c,w.value,w.defaultValue);break e;case"select":m=w.value,m!=null&&Ks(c,!!w.multiple,m,!1)}}}var Ch=!1;function Kf(c,m,w){if(Ch)return c(m,w);Ch=!0;try{var D=c(m);return D}finally{if(Ch=!1,(Eo!==null||cu!==null)&&(Qo(),Eo&&(m=Eo,c=cu,cu=Eo=null,Cu(m),c)))for(m=0;m<c.length;m++)Cu(c[m])}}function zc(c,m){var w=c.stateNode;if(w===null)return null;var D=w[pe]||null;if(D===null)return null;w=D[m];e:switch(m){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(D=!D.disabled)||(c=c.type,D=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!D;break e;default:c=!1}if(c)return null;if(w&&typeof w!="function")throw Error(ce(231,m,typeof w));return w}var Go=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Ed=!1;if(Go)try{var uu={};Object.defineProperty(uu,"passive",{get:function(){Ed=!0}}),window.addEventListener("test",uu,uu),window.removeEventListener("test",uu,uu)}catch{Ed=!1}var Wl=null,Ep=null,Hd=null;function rh(){if(Hd)return Hd;var c,m=Ep,w=m.length,D,G="value"in Wl?Wl.value:Wl.textContent,W=G.length;for(c=0;c<w&&m[c]===G[c];c++);var ve=w-c;for(D=1;D<=ve&&m[w-D]===G[W-D];D++);return Hd=G.slice(c,1<D?1-D:void 0)}function Wr(c){var m=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&m===13&&(c=13)):c=m,c===10&&(c=13),32<=c||c===13?c:0}function ah(){return!0}function $d(){return!1}function Cl(c){function m(w,D,G,W,ve){this._reactName=w,this._targetInst=G,this.type=D,this.nativeEvent=W,this.target=ve,this.currentTarget=null;for(var Je in c)c.hasOwnProperty(Je)&&(w=c[Je],this[Je]=w?w(W):W[Je]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?ah:$d,this.isPropagationStopped=$d,this}return ut(m.prototype,{preventDefault:function(){this.defaultPrevented=!0;var w=this.nativeEvent;w&&(w.preventDefault?w.preventDefault():typeof w.returnValue!="unknown"&&(w.returnValue=!1),this.isDefaultPrevented=ah)},stopPropagation:function(){var w=this.nativeEvent;w&&(w.stopPropagation?w.stopPropagation():typeof w.cancelBubble!="unknown"&&(w.cancelBubble=!0),this.isPropagationStopped=ah)},persist:function(){},isPersistent:ah}),m}var zl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},zu=Cl(zl),Du=ut({},zl,{view:0,detail:0}),Ru=Cl(Du),hu,ns,Dl,ed=ut({},Du,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:nd,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==Dl&&(Dl&&c.type==="mousemove"?(hu=c.screenX-Dl.screenX,ns=c.screenY-Dl.screenY):ns=hu=0,Dl=c),hu)},movementY:function(c){return"movementY"in c?c.movementY:ns}}),zh=Cl(ed),td=ut({},ed,{dataTransfer:0}),id=Cl(td),Rl=ut({},Du,{relatedTarget:0}),Ad=Cl(Rl),Id=ut({},zl,{animationName:0,elapsedTime:0,pseudoElement:0}),qc=Cl(Id),Ta=ut({},zl,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),Ap=Cl(Ta),Ip=ut({},zl,{data:0}),Dh=Cl(Ip),Gn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Mp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yl(c){var m=this.nativeEvent;return m.getModifierState?m.getModifierState(c):(c=Zd[c])?!!m[c]:!1}function nd(){return Yl}var Dc=ut({},Du,{key:function(c){if(c.key){var m=Gn[c.key]||c.key;if(m!=="Unidentified")return m}return c.type==="keypress"?(c=Wr(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?Mp[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:nd,charCode:function(c){return c.type==="keypress"?Wr(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Wr(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),En=Cl(Dc),ta=ut({},ed,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sa=Cl(ta),Kl=ut({},Du,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:nd}),Pu=Cl(Kl),va=ut({},zl,{propertyName:0,elapsedTime:0,pseudoElement:0}),If=Cl(va),rd=ut({},ed,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),Hc=Cl(rd),al=ut({},zl,{newState:0,oldState:0}),io=Cl(al),Cp=[9,13,27,32],$c=Go&&"CompositionEvent"in window,Rh=null;Go&&"documentMode"in document&&(Rh=document.documentMode);var Lu=Go&&"TextEvent"in window&&!Rh,Md=Go&&(!$c||Rh&&8<Rh&&11>=Rh),Jf=" ",po=!1;function Pl(c,m){switch(c){case"keyup":return Cp.indexOf(m.keyCode)!==-1;case"keydown":return m.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ga(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Io=!1;function Is(c,m){switch(c){case"compositionend":return ga(m);case"keypress":return m.which!==32?null:(po=!0,Jf);case"textInput":return c=m.data,c===Jf&&po?null:c;default:return null}}function ys(c,m){if(Io)return c==="compositionend"||!$c&&Pl(c,m)?(c=rh(),Hd=Ep=Wl=null,Io=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(m.ctrlKey||m.altKey||m.metaKey)||m.ctrlKey&&m.altKey){if(m.char&&1<m.char.length)return m.char;if(m.which)return String.fromCharCode(m.which)}return null;case"compositionend":return Md&&m.locale!=="ko"?null:m.data;default:return null}}var no={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ll(c){var m=c&&c.nodeName&&c.nodeName.toLowerCase();return m==="input"?!!no[c.type]:m==="textarea"}function Rc(c,m,w,D){Eo?cu?cu.push(D):cu=[D]:Eo=D,m=Km(m,"onChange"),0<m.length&&(w=new zu("onChange","change",null,w,D),c.push({event:w,listeners:m}))}var Js=null,Zc=null;function Jl(c){Ym(c,0)}function Mo(c){var m=Yi(c);if(Ys(m))return c}function cr(c,m){if(c==="change")return m}var xn=!1;if(Go){var ad;if(Go){var Un="oninput"in document;if(!Un){var ku=document.createElement("div");ku.setAttribute("oninput","return;"),Un=typeof ku.oninput=="function"}ad=Un}else ad=!1;xn=ad&&(!document.documentMode||9<document.documentMode)}function Ph(){Js&&(Js.detachEvent("onpropertychange",jn),Zc=Js=null)}function jn(c){if(c.propertyName==="value"&&Mo(Zc)){var m=[];Rc(m,Zc,c,Po(c)),Kf(Jl,m)}}function Pc(c,m,w){c==="focusin"?(Ph(),Js=m,Zc=w,Js.attachEvent("onpropertychange",jn)):c==="focusout"&&Ph()}function Xd(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return Mo(Zc)}function Lh(c,m){if(c==="click")return Mo(m)}function $o(c,m){if(c==="input"||c==="change")return Mo(m)}function Mf(c,m){return c===m&&(c!==0||1/c===1/m)||c!==c&&m!==m}var ds=typeof Object.is=="function"?Object.is:Mf;function Ua(c,m){if(ds(c,m))return!0;if(typeof c!="object"||c===null||typeof m!="object"||m===null)return!1;var w=Object.keys(c),D=Object.keys(m);if(w.length!==D.length)return!1;for(D=0;D<w.length;D++){var G=w[D];if(!Dr.call(m,G)||!ds(c[G],m[G]))return!1}return!0}function uc(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function Qf(c,m){var w=uc(c);c=0;for(var D;w;){if(w.nodeType===3){if(D=c+w.textContent.length,c<=m&&D>=m)return{node:w,offset:m-c};c=D}e:{for(;w;){if(w.nextSibling){w=w.nextSibling;break e}w=w.parentNode}w=void 0}w=uc(w)}}function sh(c,m){return c&&m?c===m?!0:c&&c.nodeType===3?!1:m&&m.nodeType===3?sh(c,m.parentNode):"contains"in c?c.contains(m):c.compareDocumentPosition?!!(c.compareDocumentPosition(m)&16):!1:!1}function gl(c){c=c!=null&&c.ownerDocument!=null&&c.ownerDocument.defaultView!=null?c.ownerDocument.defaultView:window;for(var m=_l(c.document);m instanceof c.HTMLIFrameElement;){try{var w=typeof m.contentWindow.location.href=="string"}catch{w=!1}if(w)c=m.contentWindow;else break;m=_l(c.document)}return m}function sd(c){var m=c&&c.nodeName&&c.nodeName.toLowerCase();return m&&(m==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||m==="textarea"||c.contentEditable==="true")}var ep=Go&&"documentMode"in document&&11>=document.documentMode,du=null,od=null,fu=null,Lc=!1;function kc(c,m,w){var D=w.window===w?w.document:w.nodeType===9?w:w.ownerDocument;Lc||du==null||du!==_l(D)||(D=du,"selectionStart"in D&&sd(D)?D={start:D.selectionStart,end:D.selectionEnd}:(D=(D.ownerDocument&&D.ownerDocument.defaultView||window).getSelection(),D={anchorNode:D.anchorNode,anchorOffset:D.anchorOffset,focusNode:D.focusNode,focusOffset:D.focusOffset}),fu&&Ua(fu,D)||(fu=D,D=Km(od,"onSelect"),0<D.length&&(m=new zu("onSelect","select",null,m,w),c.push({event:m,listeners:D}),m.target=du)))}function pu(c,m){var w={};return w[c.toLowerCase()]=m.toLowerCase(),w["Webkit"+c]="webkit"+m,w["Moz"+c]="moz"+m,w}var Xc={animationend:pu("Animation","AnimationEnd"),animationiteration:pu("Animation","AnimationIteration"),animationstart:pu("Animation","AnimationStart"),transitionrun:pu("Transition","TransitionRun"),transitionstart:pu("Transition","TransitionStart"),transitioncancel:pu("Transition","TransitionCancel"),transitionend:pu("Transition","TransitionEnd")},Cf={},ld={};Go&&(ld=document.createElement("div").style,"AnimationEvent"in window||(delete Xc.animationend.animation,delete Xc.animationiteration.animation,delete Xc.animationstart.animation),"TransitionEvent"in window||delete Xc.transitionend.transition);function mu(c){if(Cf[c])return Cf[c];if(!Xc[c])return c;var m=Xc[c],w;for(w in m)if(m.hasOwnProperty(w)&&w in ld)return Cf[c]=m[w];return c}var Cd=mu("animationend"),_u=mu("animationiteration"),zf=mu("animationstart"),um=mu("transitionrun"),Df=mu("transitionstart"),Ou=mu("transitioncancel"),cd=mu("transitionend"),kl=new Map,ud="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");ud.push("scrollEnd");function Gs(c,m){kl.set(c,m),Nn(m,[c])}var hc=typeof reportError=="function"?reportError:function(c){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var m=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof c=="object"&&c!==null&&typeof c.message=="string"?String(c.message):String(c),error:c});if(!window.dispatchEvent(m))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",c);return}console.error(c)},dc=[],oh=0,os=0;function Ol(){for(var c=oh,m=os=oh=0;m<c;){var w=dc[m];dc[m++]=null;var D=dc[m];dc[m++]=null;var G=dc[m];dc[m++]=null;var W=dc[m];if(dc[m++]=null,D!==null&&G!==null){var ve=D.pending;ve===null?G.next=G:(G.next=ve.next,ve.next=G),D.pending=G}W!==0&&hd(w,G,W)}}function pi(c,m,w,D){dc[oh++]=c,dc[oh++]=m,dc[oh++]=w,dc[oh++]=D,os|=D,c.lanes|=D,c=c.alternate,c!==null&&(c.lanes|=D)}function kh(c,m,w,D){return pi(c,m,w,D),Bu(c)}function gu(c,m){return pi(c,null,null,m),Bu(c)}function hd(c,m,w){c.lanes|=w;var D=c.alternate;D!==null&&(D.lanes|=w);for(var G=!1,W=c.return;W!==null;)W.childLanes|=w,D=W.alternate,D!==null&&(D.childLanes|=w),W.tag===22&&(c=W.stateNode,c===null||c._visibility&1||(G=!0)),c=W,W=W.return;return c.tag===3?(W=c.stateNode,G&&m!==null&&(G=31-Hs(w),c=W.hiddenUpdates,D=c[G],D===null?c[G]=[m]:D.push(m),m.lane=w|536870912),W):null}function Bu(c){if(50<Ga)throw Ga=0,ya=null,Error(ce(185));for(var m=c.return;m!==null;)c=m,m=c.return;return c.tag===3?c.stateNode:null}var yl={};function yu(c,m,w,D){this.tag=c,this.key=w,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=m,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=D,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xl(c,m,w,D){return new yu(c,m,w,D)}function Fu(c){return c=c.prototype,!(!c||!c.isReactComponent)}function vl(c,m){var w=c.alternate;return w===null?(w=xl(c.tag,m,c.key,c.mode),w.elementType=c.elementType,w.type=c.type,w.stateNode=c.stateNode,w.alternate=c,c.alternate=w):(w.pendingProps=m,w.type=c.type,w.flags=0,w.subtreeFlags=0,w.deletions=null),w.flags=c.flags&65011712,w.childLanes=c.childLanes,w.lanes=c.lanes,w.child=c.child,w.memoizedProps=c.memoizedProps,w.memoizedState=c.memoizedState,w.updateQueue=c.updateQueue,m=c.dependencies,w.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext},w.sibling=c.sibling,w.index=c.index,w.ref=c.ref,w.refCleanup=c.refCleanup,w}function Nu(c,m){c.flags&=65011714;var w=c.alternate;return w===null?(c.childLanes=0,c.lanes=m,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=w.childLanes,c.lanes=w.lanes,c.child=w.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=w.memoizedProps,c.memoizedState=w.memoizedState,c.updateQueue=w.updateQueue,c.type=w.type,m=w.dependencies,c.dependencies=m===null?null:{lanes:m.lanes,firstContext:m.firstContext}),c}function Oh(c,m,w,D,G,W){var ve=0;if(D=c,typeof c=="function")Fu(c)&&(ve=1);else if(typeof c=="string")ve=Yh(c,w,ln.current)?26:c==="html"||c==="head"||c==="body"?27:5;else e:switch(c){case Vt:return c=xl(31,w,m,G),c.elementType=Vt,c.lanes=W,c;case Vi:return Oc(w.children,G,W,m);case Wi:ve=8,G|=24;break;case Tn:return c=xl(12,w,m,G|2),c.elementType=Tn,c.lanes=W,c;case Oi:return c=xl(13,w,m,G),c.elementType=Oi,c.lanes=W,c;case Hn:return c=xl(19,w,m,G),c.elementType=Hn,c.lanes=W,c;default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case Ji:ve=10;break e;case Ci:ve=9;break e;case Vn:ve=11;break e;case qi:ve=14;break e;case Ot:ve=16,D=null;break e}ve=29,w=Error(ce(130,c===null?"null":typeof c,"")),D=null}return m=xl(ve,w,m,G),m.elementType=c,m.type=D,m.lanes=W,m}function Oc(c,m,w,D){return c=xl(7,c,D,m),c.lanes=w,c}function Bh(c,m,w){return c=xl(6,c,null,m),c.lanes=w,c}function Wd(c){var m=xl(18,null,null,0);return m.stateNode=c,m}function Yd(c,m,w){return m=xl(4,c.children!==null?c.children:[],c.key,m),m.lanes=w,m.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},m}var Kd=new WeakMap;function Zo(c,m){if(typeof c=="object"&&c!==null){var w=Kd.get(c);return w!==void 0?w:(m={value:c,source:m,stack:zr(m)},Kd.set(c,m),m)}return{value:c,source:m,stack:zr(m)}}var Or=[],Fh=0,dd=null,Jd=0,Ao=[],Xo=0,Ra=null,sl=1,Bl="";function Vu(c,m){Or[Fh++]=Jd,Or[Fh++]=dd,dd=c,Jd=m}function Rf(c,m,w){Ao[Xo++]=sl,Ao[Xo++]=Bl,Ao[Xo++]=Ra,Ra=c;var D=sl;c=Bl;var G=32-Hs(D)-1;D&=~(1<<G),w+=1;var W=32-Hs(m)+G;if(30<W){var ve=G-G%5;W=(D&(1<<ve)-1).toString(32),D>>=ve,G-=ve,sl=1<<32-Hs(m)+G|w<<G|D,Bl=W+c}else sl=1<<W|w<<G|D,Bl=c}function Qd(c){c.return!==null&&(Vu(c,1),Rf(c,1,0))}function lh(c){for(;c===dd;)dd=Or[--Fh],Or[Fh]=null,Jd=Or[--Fh],Or[Fh]=null;for(;c===Ra;)Ra=Ao[--Xo],Ao[Xo]=null,Bl=Ao[--Xo],Ao[Xo]=null,sl=Ao[--Xo],Ao[Xo]=null}function Nh(c,m){Ao[Xo++]=sl,Ao[Xo++]=Bl,Ao[Xo++]=Ra,sl=m.id,Bl=m.overflow,Ra=c}var mo=null,ja=null,fn=!1,Wc=null,fc=!1,Vh=Error(ce(519));function Ql(c){var m=Error(ce(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw fd(Zo(m,c)),Vh}function ch(c){var m=c.stateNode,w=c.type,D=c.memoizedProps;switch(m[te]=c,m[pe]=D,w){case"dialog":Ss("cancel",m),Ss("close",m);break;case"iframe":case"object":case"embed":Ss("load",m);break;case"video":case"audio":for(w=0;w<Wp.length;w++)Ss(Wp[w],m);break;case"source":Ss("error",m);break;case"img":case"image":case"link":Ss("error",m),Ss("load",m);break;case"details":Ss("toggle",m);break;case"input":Ss("invalid",m),_a(m,D.value,D.defaultValue,D.checked,D.defaultChecked,D.type,D.name,!0);break;case"select":Ss("invalid",m);break;case"textarea":Ss("invalid",m),Mh(m,D.value,D.defaultValue,D.children)}w=D.children,typeof w!="string"&&typeof w!="number"&&typeof w!="bigint"||m.textContent===""+w||D.suppressHydrationWarning===!0||Tf(m.textContent,w)?(D.popover!=null&&(Ss("beforetoggle",m),Ss("toggle",m)),D.onScroll!=null&&Ss("scroll",m),D.onScrollEnd!=null&&Ss("scrollend",m),D.onClick!=null&&(m.onclick=fo),m=!0):m=!1,m||Ql(c,!0)}function ef(c){for(mo=c.return;mo;)switch(mo.tag){case 5:case 31:case 13:fc=!1;return;case 27:case 3:fc=!0;return;default:mo=mo.return}}function Ia(c){if(c!==mo)return!1;if(!fn)return ef(c),fn=!0,!1;var m=c.tag,w;if((w=m!==3&&m!==27)&&((w=m===5)&&(w=c.type,w=!(w!=="form"&&w!=="button")||q(c.type,c.memoizedProps)),w=!w),w&&ja&&Ql(c),ef(c),m===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ce(317));ja=xr(c)}else if(m===31){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ce(317));ja=xr(c)}else m===27?(m=ja,Ke(c.type)?(c=In,In=null,ja=c):ja=m):ja=mo?Fn(c.stateNode.nextSibling):null;return!0}function Yc(){ja=mo=null,fn=!1}function tp(){var c=Wc;return c!==null&&(vn===null?vn=c:vn.push.apply(vn,c),Wc=null),c}function fd(c){Wc===null?Wc=[c]:Wc.push(c)}var ip=Tt(null),Fl=null,Uu=null;function uh(c,m,w){ai(ip,m._currentValue),m._currentValue=w}function hh(c){c._currentValue=ip.current,jt(ip)}function zp(c,m,w){for(;c!==null;){var D=c.alternate;if((c.childLanes&m)!==m?(c.childLanes|=m,D!==null&&(D.childLanes|=m)):D!==null&&(D.childLanes&m)!==m&&(D.childLanes|=m),c===w)break;c=c.return}}function zd(c,m,w,D){var G=c.child;for(G!==null&&(G.return=c);G!==null;){var W=G.dependencies;if(W!==null){var ve=G.child;W=W.firstContext;e:for(;W!==null;){var Je=W;W=G;for(var kt=0;kt<m.length;kt++)if(Je.context===m[kt]){W.lanes|=w,Je=W.alternate,Je!==null&&(Je.lanes|=w),zp(W.return,w,c),D||(ve=null);break e}W=Je.next}}else if(G.tag===18){if(ve=G.return,ve===null)throw Error(ce(341));ve.lanes|=w,W=ve.alternate,W!==null&&(W.lanes|=w),zp(ve,w,c),ve=null}else ve=G.child;if(ve!==null)ve.return=G;else for(ve=G;ve!==null;){if(ve===c){ve=null;break}if(G=ve.sibling,G!==null){G.return=ve.return,ve=G;break}ve=ve.return}G=ve}}function pd(c,m,w,D){c=null;for(var G=m,W=!1;G!==null;){if(!W){if((G.flags&524288)!==0)W=!0;else if((G.flags&262144)!==0)break}if(G.tag===10){var ve=G.alternate;if(ve===null)throw Error(ce(387));if(ve=ve.memoizedProps,ve!==null){var Je=G.type;ds(G.pendingProps.value,ve.value)||(c!==null?c.push(Je):c=[Je])}}else if(G===Mr.current){if(ve=G.alternate,ve===null)throw Error(ce(387));ve.memoizedState.memoizedState!==G.memoizedState.memoizedState&&(c!==null?c.push(Mm):c=[Mm])}G=G.return}c!==null&&zd(m,c,w,D),m.flags|=262144}function tf(c){for(c=c.firstContext;c!==null;){if(!ds(c.context._currentValue,c.memoizedValue))return!0;c=c.next}return!1}function Wo(c){Fl=c,Uu=null,c=c.dependencies,c!==null&&(c.firstContext=null)}function ka(c){return md(Fl,c)}function xu(c,m){return Fl===null&&Wo(c),md(c,m)}function md(c,m){var w=m._currentValue;if(m={context:m,memoizedValue:w,next:null},Uu===null){if(c===null)throw Error(ce(308));Uu=m,c.dependencies={lanes:0,firstContext:m},c.flags|=524288}else Uu=Uu.next=m;return w}var Uh=typeof AbortController<"u"?AbortController:function(){var c=[],m=this.signal={aborted:!1,addEventListener:function(w,D){c.push(D)}};this.abort=function(){m.aborted=!0,c.forEach(function(w){return w()})}},nf=J.unstable_scheduleCallback,rf=J.unstable_NormalPriority,ls={$$typeof:Ji,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function pc(){return{controller:new Uh,data:new Map,refCount:0}}function Kc(c){c.refCount--,c.refCount===0&&nf(rf,function(){c.controller.abort()})}var Xn=null,Pr=0,vu=0,ju=null;function _d(c,m){if(Xn===null){var w=Xn=[];Pr=0,vu=Xp(),ju={status:"pending",value:void 0,then:function(D){w.push(D)}}}return Pr++,m.then(L,L),m}function L(){if(--Pr===0&&Xn!==null){ju!==null&&(ju.status="fulfilled");var c=Xn;Xn=null,vu=0,ju=null;for(var m=0;m<c.length;m++)(0,c[m])()}}function o(c,m){var w=[],D={status:"pending",value:null,reason:null,then:function(G){w.push(G)}};return c.then(function(){D.status="fulfilled",D.value=m;for(var G=0;G<w.length;G++)(0,w[G])(m)},function(G){for(D.status="rejected",D.reason=G,G=0;G<w.length;G++)(0,w[G])(void 0)}),D}var x=ui.S;ui.S=function(c,m){ba=la(),typeof m=="object"&&m!==null&&typeof m.then=="function"&&_d(c,m),x!==null&&x(c,m)};var A=Tt(null);function I(){var c=A.current;return c!==null?c:It.pooledCache}function P(c,m){m===null?ai(A,A.current):ai(A,m.pool)}function H(){var c=I();return c===null?null:{parent:ls._currentValue,pool:c}}var K=Error(ce(460)),ne=Error(ce(474)),he=Error(ce(542)),be={then:function(){}};function we(c){return c=c.status,c==="fulfilled"||c==="rejected"}function Be(c,m,w){switch(w=c[w],w===void 0?c.push(m):w!==m&&(m.then(fo,fo),m=w),m.status){case"fulfilled":return m.value;case"rejected":throw c=m.reason,Et(c),c;default:if(typeof m.status=="string")m.then(fo,fo);else{if(c=It,c!==null&&100<c.shellSuspendCounter)throw Error(ce(482));c=m,c.status="pending",c.then(function(D){if(m.status==="pending"){var G=m;G.status="fulfilled",G.value=D}},function(D){if(m.status==="pending"){var G=m;G.status="rejected",G.reason=D}})}switch(m.status){case"fulfilled":return m.value;case"rejected":throw c=m.reason,Et(c),c}throw st=m,K}}function Ye(c){try{var m=c._init;return m(c._payload)}catch(w){throw w!==null&&typeof w=="object"&&typeof w.then=="function"?(st=w,K):w}}var st=null;function vt(){if(st===null)throw Error(ce(459));var c=st;return st=null,c}function Et(c){if(c===K||c===he)throw Error(ce(483))}var Ct=null,Lt=0;function _t(c){var m=Lt;return Lt+=1,Ct===null&&(Ct=[]),Be(Ct,c,m)}function Ht(c,m){m=m.props.ref,c.ref=m!==void 0?m:null}function Qt(c,m){throw m.$$typeof===bt?Error(ce(525)):(c=Object.prototype.toString.call(m),Error(ce(31,c==="[object Object]"?"object with keys {"+Object.keys(m).join(", ")+"}":c)))}function oi(c){function m(ci,Kt){if(c){var Ai=ci.deletions;Ai===null?(ci.deletions=[Kt],ci.flags|=16):Ai.push(Kt)}}function w(ci,Kt){if(!c)return null;for(;Kt!==null;)m(ci,Kt),Kt=Kt.sibling;return null}function D(ci){for(var Kt=new Map;ci!==null;)ci.key!==null?Kt.set(ci.key,ci):Kt.set(ci.index,ci),ci=ci.sibling;return Kt}function G(ci,Kt){return ci=vl(ci,Kt),ci.index=0,ci.sibling=null,ci}function W(ci,Kt,Ai){return ci.index=Ai,c?(Ai=ci.alternate,Ai!==null?(Ai=Ai.index,Ai<Kt?(ci.flags|=67108866,Kt):Ai):(ci.flags|=67108866,Kt)):(ci.flags|=1048576,Kt)}function ve(ci){return c&&ci.alternate===null&&(ci.flags|=67108866),ci}function Je(ci,Kt,Ai,un){return Kt===null||Kt.tag!==6?(Kt=Bh(Ai,ci.mode,un),Kt.return=ci,Kt):(Kt=G(Kt,Ai),Kt.return=ci,Kt)}function kt(ci,Kt,Ai,un){var ua=Ai.type;return ua===Vi?nn(ci,Kt,Ai.props.children,un,Ai.key):Kt!==null&&(Kt.elementType===ua||typeof ua=="object"&&ua!==null&&ua.$$typeof===Ot&&Ye(ua)===Kt.type)?(Kt=G(Kt,Ai.props),Ht(Kt,Ai),Kt.return=ci,Kt):(Kt=Oh(Ai.type,Ai.key,Ai.props,null,ci.mode,un),Ht(Kt,Ai),Kt.return=ci,Kt)}function Mi(ci,Kt,Ai,un){return Kt===null||Kt.tag!==4||Kt.stateNode.containerInfo!==Ai.containerInfo||Kt.stateNode.implementation!==Ai.implementation?(Kt=Yd(Ai,ci.mode,un),Kt.return=ci,Kt):(Kt=G(Kt,Ai.children||[]),Kt.return=ci,Kt)}function nn(ci,Kt,Ai,un,ua){return Kt===null||Kt.tag!==7?(Kt=Oc(Ai,ci.mode,un,ua),Kt.return=ci,Kt):(Kt=G(Kt,Ai),Kt.return=ci,Kt)}function hn(ci,Kt,Ai){if(typeof Kt=="string"&&Kt!==""||typeof Kt=="number"||typeof Kt=="bigint")return Kt=Bh(""+Kt,ci.mode,Ai),Kt.return=ci,Kt;if(typeof Kt=="object"&&Kt!==null){switch(Kt.$$typeof){case rn:return Ai=Oh(Kt.type,Kt.key,Kt.props,null,ci.mode,Ai),Ht(Ai,Kt),Ai.return=ci,Ai;case on:return Kt=Yd(Kt,ci.mode,Ai),Kt.return=ci,Kt;case Ot:return Kt=Ye(Kt),hn(ci,Kt,Ai)}if(Qr(Kt)||Ui(Kt))return Kt=Oc(Kt,ci.mode,Ai,null),Kt.return=ci,Kt;if(typeof Kt.then=="function")return hn(ci,_t(Kt),Ai);if(Kt.$$typeof===Ji)return hn(ci,xu(ci,Kt),Ai);Qt(ci,Kt)}return null}function Li(ci,Kt,Ai,un){var ua=Kt!==null?Kt.key:null;if(typeof Ai=="string"&&Ai!==""||typeof Ai=="number"||typeof Ai=="bigint")return ua!==null?null:Je(ci,Kt,""+Ai,un);if(typeof Ai=="object"&&Ai!==null){switch(Ai.$$typeof){case rn:return Ai.key===ua?kt(ci,Kt,Ai,un):null;case on:return Ai.key===ua?Mi(ci,Kt,Ai,un):null;case Ot:return Ai=Ye(Ai),Li(ci,Kt,Ai,un)}if(Qr(Ai)||Ui(Ai))return ua!==null?null:nn(ci,Kt,Ai,un,null);if(typeof Ai.then=="function")return Li(ci,Kt,_t(Ai),un);if(Ai.$$typeof===Ji)return Li(ci,Kt,xu(ci,Ai),un);Qt(ci,Ai)}return null}function Ni(ci,Kt,Ai,un,ua){if(typeof un=="string"&&un!==""||typeof un=="number"||typeof un=="bigint")return ci=ci.get(Ai)||null,Je(Kt,ci,""+un,ua);if(typeof un=="object"&&un!==null){switch(un.$$typeof){case rn:return ci=ci.get(un.key===null?Ai:un.key)||null,kt(Kt,ci,un,ua);case on:return ci=ci.get(un.key===null?Ai:un.key)||null,Mi(Kt,ci,un,ua);case Ot:return un=Ye(un),Ni(ci,Kt,Ai,un,ua)}if(Qr(un)||Ui(un))return ci=ci.get(Ai)||null,nn(Kt,ci,un,ua,null);if(typeof un.then=="function")return Ni(ci,Kt,Ai,_t(un),ua);if(un.$$typeof===Ji)return Ni(ci,Kt,Ai,xu(Kt,un),ua);Qt(Kt,un)}return null}function Fr(ci,Kt,Ai,un){for(var ua=null,uo=null,Jr=Kt,_s=Kt=0,Rs=null;Jr!==null&&_s<Ai.length;_s++){Jr.index>_s?(Rs=Jr,Jr=null):Rs=Jr.sibling;var wo=Li(ci,Jr,Ai[_s],un);if(wo===null){Jr===null&&(Jr=Rs);break}c&&Jr&&wo.alternate===null&&m(ci,Jr),Kt=W(wo,Kt,_s),uo===null?ua=wo:uo.sibling=wo,uo=wo,Jr=Rs}if(_s===Ai.length)return w(ci,Jr),fn&&Vu(ci,_s),ua;if(Jr===null){for(;_s<Ai.length;_s++)Jr=hn(ci,Ai[_s],un),Jr!==null&&(Kt=W(Jr,Kt,_s),uo===null?ua=Jr:uo.sibling=Jr,uo=Jr);return fn&&Vu(ci,_s),ua}for(Jr=D(Jr);_s<Ai.length;_s++)Rs=Ni(Jr,ci,_s,Ai[_s],un),Rs!==null&&(c&&Rs.alternate!==null&&Jr.delete(Rs.key===null?_s:Rs.key),Kt=W(Rs,Kt,_s),uo===null?ua=Rs:uo.sibling=Rs,uo=Rs);return c&&Jr.forEach(function(Af){return m(ci,Af)}),fn&&Vu(ci,_s),ua}function na(ci,Kt,Ai,un){if(Ai==null)throw Error(ce(151));for(var ua=null,uo=null,Jr=Kt,_s=Kt=0,Rs=null,wo=Ai.next();Jr!==null&&!wo.done;_s++,wo=Ai.next()){Jr.index>_s?(Rs=Jr,Jr=null):Rs=Jr.sibling;var Af=Li(ci,Jr,wo.value,un);if(Af===null){Jr===null&&(Jr=Rs);break}c&&Jr&&Af.alternate===null&&m(ci,Jr),Kt=W(Af,Kt,_s),uo===null?ua=Af:uo.sibling=Af,uo=Af,Jr=Rs}if(wo.done)return w(ci,Jr),fn&&Vu(ci,_s),ua;if(Jr===null){for(;!wo.done;_s++,wo=Ai.next())wo=hn(ci,wo.value,un),wo!==null&&(Kt=W(wo,Kt,_s),uo===null?ua=wo:uo.sibling=wo,uo=wo);return fn&&Vu(ci,_s),ua}for(Jr=D(Jr);!wo.done;_s++,wo=Ai.next())wo=Ni(Jr,ci,_s,wo.value,un),wo!==null&&(c&&wo.alternate!==null&&Jr.delete(wo.key===null?_s:wo.key),Kt=W(wo,Kt,_s),uo===null?ua=wo:uo.sibling=wo,uo=wo);return c&&Jr.forEach(function(oy){return m(ci,oy)}),fn&&Vu(ci,_s),ua}function co(ci,Kt,Ai,un){if(typeof Ai=="object"&&Ai!==null&&Ai.type===Vi&&Ai.key===null&&(Ai=Ai.props.children),typeof Ai=="object"&&Ai!==null){switch(Ai.$$typeof){case rn:e:{for(var ua=Ai.key;Kt!==null;){if(Kt.key===ua){if(ua=Ai.type,ua===Vi){if(Kt.tag===7){w(ci,Kt.sibling),un=G(Kt,Ai.props.children),un.return=ci,ci=un;break e}}else if(Kt.elementType===ua||typeof ua=="object"&&ua!==null&&ua.$$typeof===Ot&&Ye(ua)===Kt.type){w(ci,Kt.sibling),un=G(Kt,Ai.props),Ht(un,Ai),un.return=ci,ci=un;break e}w(ci,Kt);break}else m(ci,Kt);Kt=Kt.sibling}Ai.type===Vi?(un=Oc(Ai.props.children,ci.mode,un,Ai.key),un.return=ci,ci=un):(un=Oh(Ai.type,Ai.key,Ai.props,null,ci.mode,un),Ht(un,Ai),un.return=ci,ci=un)}return ve(ci);case on:e:{for(ua=Ai.key;Kt!==null;){if(Kt.key===ua)if(Kt.tag===4&&Kt.stateNode.containerInfo===Ai.containerInfo&&Kt.stateNode.implementation===Ai.implementation){w(ci,Kt.sibling),un=G(Kt,Ai.children||[]),un.return=ci,ci=un;break e}else{w(ci,Kt);break}else m(ci,Kt);Kt=Kt.sibling}un=Yd(Ai,ci.mode,un),un.return=ci,ci=un}return ve(ci);case Ot:return Ai=Ye(Ai),co(ci,Kt,Ai,un)}if(Qr(Ai))return Fr(ci,Kt,Ai,un);if(Ui(Ai)){if(ua=Ui(Ai),typeof ua!="function")throw Error(ce(150));return Ai=ua.call(Ai),na(ci,Kt,Ai,un)}if(typeof Ai.then=="function")return co(ci,Kt,_t(Ai),un);if(Ai.$$typeof===Ji)return co(ci,Kt,xu(ci,Ai),un);Qt(ci,Ai)}return typeof Ai=="string"&&Ai!==""||typeof Ai=="number"||typeof Ai=="bigint"?(Ai=""+Ai,Kt!==null&&Kt.tag===6?(w(ci,Kt.sibling),un=G(Kt,Ai),un.return=ci,ci=un):(w(ci,Kt),un=Bh(Ai,ci.mode,un),un.return=ci,ci=un),ve(ci)):w(ci,Kt)}return function(ci,Kt,Ai,un){try{Lt=0;var ua=co(ci,Kt,Ai,un);return Ct=null,ua}catch(Jr){if(Jr===K||Jr===he)throw Jr;var uo=xl(29,Jr,null,ci.mode);return uo.lanes=un,uo.return=ci,uo}finally{}}}var $i=oi(!0),An=oi(!1),Mn=!1;function Zn(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Ln(c,m){c=c.updateQueue,m.updateQueue===c&&(m.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,callbacks:null})}function zn(c){return{lane:c,tag:0,payload:null,callback:null,next:null}}function ir(c,m,w){var D=c.updateQueue;if(D===null)return null;if(D=D.shared,(St&2)!==0){var G=D.pending;return G===null?m.next=m:(m.next=G.next,G.next=m),D.pending=m,m=Bu(c),hd(c,null,w),m}return pi(c,D,m,w),Bu(c)}function $r(c,m,w){if(m=m.updateQueue,m!==null&&(m=m.shared,(w&4194048)!==0)){var D=m.lanes;D&=c.pendingLanes,w|=D,m.lanes=w,Di(c,w)}}function On(c,m){var w=c.updateQueue,D=c.alternate;if(D!==null&&(D=D.updateQueue,w===D)){var G=null,W=null;if(w=w.firstBaseUpdate,w!==null){do{var ve={lane:w.lane,tag:w.tag,payload:w.payload,callback:null,next:null};W===null?G=W=ve:W=W.next=ve,w=w.next}while(w!==null);W===null?G=W=m:W=W.next=m}else G=W=m;w={baseState:D.baseState,firstBaseUpdate:G,lastBaseUpdate:W,shared:D.shared,callbacks:D.callbacks},c.updateQueue=w;return}c=w.lastBaseUpdate,c===null?w.firstBaseUpdate=m:c.next=m,w.lastBaseUpdate=m}var qn=!1;function Yr(){if(qn){var c=ju;if(c!==null)throw c}}function Qa(c,m,w,D){qn=!1;var G=c.updateQueue;Mn=!1;var W=G.firstBaseUpdate,ve=G.lastBaseUpdate,Je=G.shared.pending;if(Je!==null){G.shared.pending=null;var kt=Je,Mi=kt.next;kt.next=null,ve===null?W=Mi:ve.next=Mi,ve=kt;var nn=c.alternate;nn!==null&&(nn=nn.updateQueue,Je=nn.lastBaseUpdate,Je!==ve&&(Je===null?nn.firstBaseUpdate=Mi:Je.next=Mi,nn.lastBaseUpdate=kt))}if(W!==null){var hn=G.baseState;ve=0,nn=Mi=kt=null,Je=W;do{var Li=Je.lane&-536870913,Ni=Li!==Je.lane;if(Ni?(Jt&Li)===Li:(D&Li)===Li){Li!==0&&Li===vu&&(qn=!0),nn!==null&&(nn=nn.next={lane:0,tag:Je.tag,payload:Je.payload,callback:null,next:null});e:{var Fr=c,na=Je;Li=m;var co=w;switch(na.tag){case 1:if(Fr=na.payload,typeof Fr=="function"){hn=Fr.call(co,hn,Li);break e}hn=Fr;break e;case 3:Fr.flags=Fr.flags&-65537|128;case 0:if(Fr=na.payload,Li=typeof Fr=="function"?Fr.call(co,hn,Li):Fr,Li==null)break e;hn=ut({},hn,Li);break e;case 2:Mn=!0}}Li=Je.callback,Li!==null&&(c.flags|=64,Ni&&(c.flags|=8192),Ni=G.callbacks,Ni===null?G.callbacks=[Li]:Ni.push(Li))}else Ni={lane:Li,tag:Je.tag,payload:Je.payload,callback:Je.callback,next:null},nn===null?(Mi=nn=Ni,kt=hn):nn=nn.next=Ni,ve|=Li;if(Je=Je.next,Je===null){if(Je=G.shared.pending,Je===null)break;Ni=Je,Je=Ni.next,Ni.next=null,G.lastBaseUpdate=Ni,G.shared.pending=null}}while(!0);nn===null&&(kt=hn),G.baseState=kt,G.firstBaseUpdate=Mi,G.lastBaseUpdate=nn,W===null&&(G.shared.lanes=0),Ti|=ve,c.lanes=ve,c.memoizedState=hn}}function Ma(c,m){if(typeof c!="function")throw Error(ce(191,c));c.call(m)}function Za(c,m){var w=c.callbacks;if(w!==null)for(c.callbacks=null,c=0;c<w.length;c++)Ma(w[c],m)}var Ls=Tt(null),ol=Tt(0);function mc(c,m){c=Ei,ai(ol,c),ai(Ls,m),Ei=c|m.baseLanes}function ks(){ai(ol,Ei),ai(Ls,Ls.current)}function Lo(){Ei=ol.current,jt(Ls),jt(ol)}var Os=Tt(null),Ms=null;function Co(c){var m=c.alternate;ai(Cs,Cs.current&1),ai(Os,c),Ms===null&&(m===null||Ls.current!==null||m.memoizedState!==null)&&(Ms=c)}function _c(c){ai(Cs,Cs.current),ai(Os,c),Ms===null&&(Ms=c)}function Nl(c){c.tag===22?(ai(Cs,Cs.current),ai(Os,c),Ms===null&&(Ms=c)):Jc()}function Jc(){ai(Cs,Cs.current),ai(Os,Os.current)}function hl(c){jt(Os),Ms===c&&(Ms=null),jt(Cs)}var Cs=Tt(0);function bu(c){for(var m=c;m!==null;){if(m.tag===13){var w=m.memoizedState;if(w!==null&&(w=w.dehydrated,w===null||gn(w)||Wn(w)))return m}else if(m.tag===19&&(m.memoizedProps.revealOrder==="forwards"||m.memoizedProps.revealOrder==="backwards"||m.memoizedProps.revealOrder==="unstable_legacy-backwards"||m.memoizedProps.revealOrder==="together")){if((m.flags&128)!==0)return m}else if(m.child!==null){m.child.return=m,m=m.child;continue}if(m===c)break;for(;m.sibling===null;){if(m.return===null||m.return===c)return null;m=m.return}m.sibling.return=m.return,m=m.sibling}return null}var Vl=0,di=null,Oa=null,fs=null,Yo=!1,mn=!1,_o=!1,bl=0,Ba=0,gc=null,jh=0;function $s(){throw Error(ce(321))}function af(c,m){if(m===null)return!1;for(var w=0;w<m.length&&w<c.length;w++)if(!ds(c[w],m[w]))return!1;return!0}function Gu(c,m,w,D,G,W){return Vl=W,di=m,m.memoizedState=null,m.updateQueue=null,m.lanes=0,ui.H=c===null||c.memoizedState===null?Tu:up,_o=!1,W=w(D,G),_o=!1,mn&&(W=qo(m,w,D,G)),Dp(c),W}function Dp(c){ui.H=pf;var m=Oa!==null&&Oa.next!==null;if(Vl=0,fs=Oa=di=null,Yo=!1,Ba=0,gc=null,m)throw Error(ce(300));c===null||ko||(c=c.dependencies,c!==null&&tf(c)&&(ko=!0))}function qo(c,m,w,D){di=c;var G=0;do{if(mn&&(gc=null),Ba=0,mn=!1,25<=G)throw Error(ce(301));if(G+=1,fs=Oa=null,c.updateQueue!=null){var W=c.updateQueue;W.lastEffect=null,W.events=null,W.stores=null,W.memoCache!=null&&(W.memoCache.index=0)}ui.H=hp,W=m(w,D)}while(mn);return W}function np(){var c=ui.H,m=c.useState()[0];return m=typeof m.then=="function"?Dd(m):m,c=c.useState()[0],(Oa!==null?Oa.memoizedState:null)!==c&&(di.flags|=1024),m}function Ko(){var c=bl!==0;return bl=0,c}function yc(c,m,w){m.updateQueue=c.updateQueue,m.flags&=-2053,c.lanes&=~w}function dh(c){if(Yo){for(c=c.memoizedState;c!==null;){var m=c.queue;m!==null&&(m.pending=null),c=c.next}Yo=!1}Vl=0,fs=Oa=di=null,mn=!1,Ba=bl=0,gc=null}function Jo(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return fs===null?di.memoizedState=fs=c:fs=fs.next=c,fs}function Qs(){if(Oa===null){var c=di.alternate;c=c!==null?c.memoizedState:null}else c=Oa.next;var m=fs===null?di.memoizedState:fs.next;if(m!==null)fs=m,Oa=c;else{if(c===null)throw di.alternate===null?Error(ce(467)):Error(ce(310));Oa=c,c={memoizedState:Oa.memoizedState,baseState:Oa.baseState,baseQueue:Oa.baseQueue,queue:Oa.queue,next:null},fs===null?di.memoizedState=fs=c:fs=fs.next=c}return fs}function wu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Dd(c){var m=Ba;return Ba+=1,gc===null&&(gc=[]),c=Be(gc,c,m),m=di,(fs===null?m.memoizedState:fs.next)===null&&(m=m.alternate,ui.H=m===null||m.memoizedState===null?Tu:up),c}function qu(c){if(c!==null&&typeof c=="object"){if(typeof c.then=="function")return Dd(c);if(c.$$typeof===Ji)return ka(c)}throw Error(ce(438,String(c)))}function Xa(c){var m=null,w=di.updateQueue;if(w!==null&&(m=w.memoCache),m==null){var D=di.alternate;D!==null&&(D=D.updateQueue,D!==null&&(D=D.memoCache,D!=null&&(m={data:D.data.map(function(G){return G.slice()}),index:0})))}if(m==null&&(m={data:[],index:0}),w===null&&(w=wu(),di.updateQueue=w),w.memoCache=m,w=m.data[m.index],w===void 0)for(w=m.data[m.index]=Array(c),D=0;D<c;D++)w[D]=Hi;return m.index++,w}function fh(c,m){return typeof m=="function"?m(c):m}function sf(c){var m=Qs();return of(m,Oa,c)}function of(c,m,w){var D=c.queue;if(D===null)throw Error(ce(311));D.lastRenderedReducer=w;var G=c.baseQueue,W=D.pending;if(W!==null){if(G!==null){var ve=G.next;G.next=W.next,W.next=ve}m.baseQueue=G=W,D.pending=null}if(W=c.baseState,G===null)c.memoizedState=W;else{m=G.next;var Je=ve=null,kt=null,Mi=m,nn=!1;do{var hn=Mi.lane&-536870913;if(hn!==Mi.lane?(Jt&hn)===hn:(Vl&hn)===hn){var Li=Mi.revertLane;if(Li===0)kt!==null&&(kt=kt.next={lane:0,revertLane:0,gesture:null,action:Mi.action,hasEagerState:Mi.hasEagerState,eagerState:Mi.eagerState,next:null}),hn===vu&&(nn=!0);else if((Vl&Li)===Li){Mi=Mi.next,Li===vu&&(nn=!0);continue}else hn={lane:0,revertLane:Mi.revertLane,gesture:null,action:Mi.action,hasEagerState:Mi.hasEagerState,eagerState:Mi.eagerState,next:null},kt===null?(Je=kt=hn,ve=W):kt=kt.next=hn,di.lanes|=Li,Ti|=Li;hn=Mi.action,_o&&w(W,hn),W=Mi.hasEagerState?Mi.eagerState:w(W,hn)}else Li={lane:hn,revertLane:Mi.revertLane,gesture:Mi.gesture,action:Mi.action,hasEagerState:Mi.hasEagerState,eagerState:Mi.eagerState,next:null},kt===null?(Je=kt=Li,ve=W):kt=kt.next=Li,di.lanes|=hn,Ti|=hn;Mi=Mi.next}while(Mi!==null&&Mi!==m);if(kt===null?ve=W:kt.next=Je,!ds(W,c.memoizedState)&&(ko=!0,nn&&(w=ju,w!==null)))throw w;c.memoizedState=W,c.baseState=ve,c.baseQueue=kt,D.lastRenderedState=W}return G===null&&(D.lanes=0),[c.memoizedState,D.dispatch]}function Rd(c){var m=Qs(),w=m.queue;if(w===null)throw Error(ce(311));w.lastRenderedReducer=c;var D=w.dispatch,G=w.pending,W=m.memoizedState;if(G!==null){w.pending=null;var ve=G=G.next;do W=c(W,ve.action),ve=ve.next;while(ve!==G);ds(W,m.memoizedState)||(ko=!0),m.memoizedState=W,m.baseQueue===null&&(m.baseState=W),w.lastRenderedState=W}return[W,D]}function Gh(c,m,w){var D=di,G=Qs(),W=fn;if(W){if(w===void 0)throw Error(ce(407));w=w()}else w=m();var ve=!ds((Oa||G).memoizedState,w);if(ve&&(G.memoizedState=w,ko=!0),G=G.queue,vc(Pd.bind(null,D,G,c),[c]),G.getSnapshot!==m||ve||fs!==null&&fs.memoizedState.tag&1){if(D.flags|=2048,Hh(9,{destroy:void 0},Qc.bind(null,D,G,w,m),null),It===null)throw Error(ce(349));W||(Vl&127)!==0||Hu(D,m,w)}return w}function Hu(c,m,w){c.flags|=16384,c={getSnapshot:m,value:w},m=di.updateQueue,m===null?(m=wu(),di.updateQueue=m,m.stores=[c]):(w=m.stores,w===null?m.stores=[c]:w.push(c))}function Qc(c,m,w,D){m.value=w,m.getSnapshot=D,xi(m)&&Fi(c)}function Pd(c,m,w){return w(function(){xi(m)&&Fi(c)})}function xi(c){var m=c.getSnapshot;c=c.value;try{var w=m();return!ds(c,w)}catch{return!0}}function Fi(c){var m=gu(c,2);m!==null&&fa(m,c,2)}function gd(c){var m=Jo();if(typeof c=="function"){var w=c;if(c=w(),_o){ar(!0);try{w()}finally{ar(!1)}}}return m.memoizedState=m.baseState=c,m.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fh,lastRenderedState:c},m}function ca(c,m,w,D){return c.baseState=w,of(c,Oa,typeof D=="function"?D:fh)}function xt(c,m,w,D,G){if(cp(c))throw Error(ce(485));if(c=m.action,c!==null){var W={payload:G,action:c,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ve){W.listeners.push(ve)}};ui.T!==null?w(!0):W.isTransition=!1,D(W),w=m.pending,w===null?(W.next=m.pending=W,hm(m,W)):(W.next=w.next,m.pending=w.next=W)}}function hm(c,m){var w=m.action,D=m.payload,G=c.state;if(m.isTransition){var W=ui.T,ve={};ui.T=ve;try{var Je=w(G,D),kt=ui.S;kt!==null&&kt(ve,Je),qh(c,m,Je)}catch(Mi){Ld(c,m,Mi)}finally{W!==null&&ve.types!==null&&(W.types=ve.types),ui.T=W}}else try{W=w(G,D),qh(c,m,W)}catch(Mi){Ld(c,m,Mi)}}function qh(c,m,w){w!==null&&typeof w=="object"&&typeof w.then=="function"?w.then(function(D){xc(c,m,D)},function(D){return Ld(c,m,D)}):xc(c,m,w)}function xc(c,m,w){m.status="fulfilled",m.value=w,yd(m),c.state=w,m=c.pending,m!==null&&(w=m.next,w===m?c.pending=null:(w=w.next,m.next=w,hm(c,w)))}function Ld(c,m,w){var D=c.pending;if(c.pending=null,D!==null){D=D.next;do m.status="rejected",m.reason=w,yd(m),m=m.next;while(m!==D)}c.action=null}function yd(c){c=c.listeners;for(var m=0;m<c.length;m++)(0,c[m])()}function dm(c,m){return m}function Pf(c,m){if(fn){var w=It.formState;if(w!==null){e:{var D=di;if(fn){if(ja){t:{for(var G=ja,W=fc;G.nodeType!==8;){if(!W){G=null;break t}if(G=Fn(G.nextSibling),G===null){G=null;break t}}W=G.data,G=W==="F!"||W==="F"?G:null}if(G){ja=Fn(G.nextSibling),D=G.data==="F!";break e}}Ql(D)}D=!1}D&&(m=w[0])}}return w=Jo(),w.memoizedState=w.baseState=m,D={pending:null,lanes:0,dispatch:null,lastRenderedReducer:dm,lastRenderedState:m},w.queue=D,w=go.bind(null,di,D),D.dispatch=w,D=gd(!1),W=ff.bind(null,di,!1,D.queue),D=Jo(),G={state:m,dispatch:null,action:c,pending:null},D.queue=G,w=xt.bind(null,di,G,W,w),G.dispatch=w,D.memoizedState=c,[m,w,!1]}function Om(c){var m=Qs();return c_(m,Oa,c)}function c_(c,m,w){if(m=of(c,m,dm)[0],c=sf(fh)[0],typeof m=="object"&&m!==null&&typeof m.then=="function")try{var D=Dd(m)}catch(ve){throw ve===K?he:ve}else D=m;m=Qs();var G=m.queue,W=G.dispatch;return w!==m.memoizedState&&(di.flags|=2048,Hh(9,{destroy:void 0},fm.bind(null,G,w),null)),[D,W,c]}function fm(c,m){c.action=m}function Rp(c){var m=Qs(),w=Oa;if(w!==null)return c_(m,w,c);Qs(),m=m.memoizedState,w=Qs();var D=w.queue.dispatch;return w.memoizedState=c,[m,D,!1]}function Hh(c,m,w,D){return c={tag:c,create:w,deps:D,inst:m,next:null},m=di.updateQueue,m===null&&(m=wu(),di.updateQueue=m),w=m.lastEffect,w===null?m.lastEffect=c.next=c:(D=w.next,w.next=c,c.next=D,m.lastEffect=c),c}function rp(){return Qs().memoizedState}function lf(c,m,w,D){var G=Jo();di.flags|=c,G.memoizedState=Hh(1|m,{destroy:void 0},w,D===void 0?null:D)}function $u(c,m,w,D){var G=Qs();D=D===void 0?null:D;var W=G.memoizedState.inst;Oa!==null&&D!==null&&af(D,Oa.memoizedState.deps)?G.memoizedState=Hh(m,W,w,D):(di.flags|=c,G.memoizedState=Hh(1|m,W,w,D))}function cf(c,m){lf(8390656,8,c,m)}function vc(c,m){$u(2048,8,c,m)}function Pp(c){di.flags|=4;var m=di.updateQueue;if(m===null)m=wu(),di.updateQueue=m,m.events=[c];else{var w=m.events;w===null?m.events=[c]:w.push(c)}}function ap(c){var m=Qs().memoizedState;return Pp({ref:m,nextImpl:c}),function(){if((St&2)!==0)throw Error(ce(440));return m.impl.apply(void 0,arguments)}}function pm(c,m){return $u(4,2,c,m)}function mm(c,m){return $u(4,4,c,m)}function $h(c,m){if(typeof m=="function"){c=c();var w=m(c);return function(){typeof w=="function"?w():m(null)}}if(m!=null)return c=c(),m.current=c,function(){m.current=null}}function Zs(c,m,w){w=w!=null?w.concat([c]):null,$u(4,4,$h.bind(null,m,c),w)}function kd(){}function uf(c,m){var w=Qs();m=m===void 0?null:m;var D=w.memoizedState;return m!==null&&af(m,D[1])?D[0]:(w.memoizedState=[c,m],c)}function Bm(c,m){var w=Qs();m=m===void 0?null:m;var D=w.memoizedState;if(m!==null&&af(m,D[1]))return D[0];if(D=c(),_o){ar(!0);try{c()}finally{ar(!1)}}return w.memoizedState=[D,m],D}function Wa(c,m,w){return w===void 0||(Vl&1073741824)!==0&&(Jt&261930)===0?c.memoizedState=m:(c.memoizedState=w,c=gr(),di.lanes|=c,Ti|=c,w)}function Zr(c,m,w,D){return ds(w,m)?w:Ls.current!==null?(c=Wa(c,w,D),ds(c,m)||(ko=!0),c):(Vl&42)===0||(Vl&1073741824)!==0&&(Jt&261930)===0?(ko=!0,c.memoizedState=w):(c=gr(),di.lanes|=c,Ti|=c,m)}function sp(c,m,w,D,G){var W=Si.p;Si.p=W!==0&&8>W?W:8;var ve=ui.T,Je={};ui.T=Je,ff(c,!1,m,w);try{var kt=G(),Mi=ui.S;if(Mi!==null&&Mi(Je,kt),kt!==null&&typeof kt=="object"&&typeof kt.then=="function"){var nn=o(kt,D);ph(c,m,nn,Sr(c))}else ph(c,m,D,Sr(c))}catch(hn){ph(c,m,{then:function(){},status:"rejected",reason:hn},Sr())}finally{Si.p=W,ve!==null&&Je.types!==null&&(ve.types=Je.types),ui.T=ve}}function hf(){}function Od(c,m,w,D){if(c.tag!==5)throw Error(ce(476));var G=df(c).queue;sp(c,G,m,yn,w===null?hf:function(){return Zh(c),w(D)})}function df(c){var m=c.memoizedState;if(m!==null)return m;m={memoizedState:yn,baseState:yn,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fh,lastRenderedState:yn},next:null};var w={};return m.next={memoizedState:w,baseState:w,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:fh,lastRenderedState:w},next:null},c.memoizedState=m,c=c.alternate,c!==null&&(c.memoizedState=m),m}function Zh(c){var m=df(c);m.next===null&&(m=c.alternate.memoizedState),ph(c,m.next.queue,{},Sr())}function Lp(){return ka(Mm)}function op(){return Qs().memoizedState}function kp(){return Qs().memoizedState}function lp(c){for(var m=c.return;m!==null;){switch(m.tag){case 24:case 3:var w=Sr();c=zn(w);var D=ir(m,c,w);D!==null&&(fa(D,m,w),$r(D,m,w)),m={cache:pc()},c.payload=m;return}m=m.return}}function bc(c,m,w){var D=Sr();w={lane:D,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null},cp(c)?Op(m,w):(w=kh(c,m,w,D),w!==null&&(fa(w,c,D),Bd(w,m,D)))}function go(c,m,w){var D=Sr();ph(c,m,w,D)}function ph(c,m,w,D){var G={lane:D,revertLane:0,gesture:null,action:w,hasEagerState:!1,eagerState:null,next:null};if(cp(c))Op(m,G);else{var W=c.alternate;if(c.lanes===0&&(W===null||W.lanes===0)&&(W=m.lastRenderedReducer,W!==null))try{var ve=m.lastRenderedState,Je=W(ve,w);if(G.hasEagerState=!0,G.eagerState=Je,ds(Je,ve))return pi(c,m,G,0),It===null&&Ol(),!1}catch{}finally{}if(w=kh(c,m,G,D),w!==null)return fa(w,c,D),Bd(w,m,D),!0}return!1}function ff(c,m,w,D){if(D={lane:2,revertLane:Xp(),gesture:null,action:D,hasEagerState:!1,eagerState:null,next:null},cp(c)){if(m)throw Error(ce(479))}else m=kh(c,w,D,2),m!==null&&fa(m,c,2)}function cp(c){var m=c.alternate;return c===di||m!==null&&m===di}function Op(c,m){mn=Yo=!0;var w=c.pending;w===null?m.next=m:(m.next=w.next,w.next=m),c.pending=m}function Bd(c,m,w){if((w&4194048)!==0){var D=m.lanes;D&=c.pendingLanes,w|=D,m.lanes=w,Di(c,w)}}var pf={readContext:ka,use:qu,useCallback:$s,useContext:$s,useEffect:$s,useImperativeHandle:$s,useLayoutEffect:$s,useInsertionEffect:$s,useMemo:$s,useReducer:$s,useRef:$s,useState:$s,useDebugValue:$s,useDeferredValue:$s,useTransition:$s,useSyncExternalStore:$s,useId:$s,useHostTransitionStatus:$s,useFormState:$s,useActionState:$s,useOptimistic:$s,useMemoCache:$s,useCacheRefresh:$s};pf.useEffectEvent=$s;var Tu={readContext:ka,use:qu,useCallback:function(c,m){return Jo().memoizedState=[c,m===void 0?null:m],c},useContext:ka,useEffect:cf,useImperativeHandle:function(c,m,w){w=w!=null?w.concat([c]):null,lf(4194308,4,$h.bind(null,m,c),w)},useLayoutEffect:function(c,m){return lf(4194308,4,c,m)},useInsertionEffect:function(c,m){lf(4,2,c,m)},useMemo:function(c,m){var w=Jo();m=m===void 0?null:m;var D=c();if(_o){ar(!0);try{c()}finally{ar(!1)}}return w.memoizedState=[D,m],D},useReducer:function(c,m,w){var D=Jo();if(w!==void 0){var G=w(m);if(_o){ar(!0);try{w(m)}finally{ar(!1)}}}else G=m;return D.memoizedState=D.baseState=G,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:G},D.queue=c,c=c.dispatch=bc.bind(null,di,c),[D.memoizedState,c]},useRef:function(c){var m=Jo();return c={current:c},m.memoizedState=c},useState:function(c){c=gd(c);var m=c.queue,w=go.bind(null,di,m);return m.dispatch=w,[c.memoizedState,w]},useDebugValue:kd,useDeferredValue:function(c,m){var w=Jo();return Wa(w,c,m)},useTransition:function(){var c=gd(!1);return c=sp.bind(null,di,c.queue,!0,!1),Jo().memoizedState=c,[!1,c]},useSyncExternalStore:function(c,m,w){var D=di,G=Jo();if(fn){if(w===void 0)throw Error(ce(407));w=w()}else{if(w=m(),It===null)throw Error(ce(349));(Jt&127)!==0||Hu(D,m,w)}G.memoizedState=w;var W={value:w,getSnapshot:m};return G.queue=W,cf(Pd.bind(null,D,W,c),[c]),D.flags|=2048,Hh(9,{destroy:void 0},Qc.bind(null,D,W,w,m),null),w},useId:function(){var c=Jo(),m=It.identifierPrefix;if(fn){var w=Bl,D=sl;w=(D&~(1<<32-Hs(D)-1)).toString(32)+w,m="_"+m+"R_"+w,w=bl++,0<w&&(m+="H"+w.toString(32)),m+="_"}else w=jh++,m="_"+m+"r_"+w.toString(32)+"_";return c.memoizedState=m},useHostTransitionStatus:Lp,useFormState:Pf,useActionState:Pf,useOptimistic:function(c){var m=Jo();m.memoizedState=m.baseState=c;var w={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return m.queue=w,m=ff.bind(null,di,!0,w),w.dispatch=m,[c,m]},useMemoCache:Xa,useCacheRefresh:function(){return Jo().memoizedState=lp.bind(null,di)},useEffectEvent:function(c){var m=Jo(),w={impl:c};return m.memoizedState=w,function(){if((St&2)!==0)throw Error(ce(440));return w.impl.apply(void 0,arguments)}}},up={readContext:ka,use:qu,useCallback:uf,useContext:ka,useEffect:vc,useImperativeHandle:Zs,useInsertionEffect:pm,useLayoutEffect:mm,useMemo:Bm,useReducer:sf,useRef:rp,useState:function(){return sf(fh)},useDebugValue:kd,useDeferredValue:function(c,m){var w=Qs();return Zr(w,Oa.memoizedState,c,m)},useTransition:function(){var c=sf(fh)[0],m=Qs().memoizedState;return[typeof c=="boolean"?c:Dd(c),m]},useSyncExternalStore:Gh,useId:op,useHostTransitionStatus:Lp,useFormState:Om,useActionState:Om,useOptimistic:function(c,m){var w=Qs();return ca(w,Oa,c,m)},useMemoCache:Xa,useCacheRefresh:kp};up.useEffectEvent=ap;var hp={readContext:ka,use:qu,useCallback:uf,useContext:ka,useEffect:vc,useImperativeHandle:Zs,useInsertionEffect:pm,useLayoutEffect:mm,useMemo:Bm,useReducer:Rd,useRef:rp,useState:function(){return Rd(fh)},useDebugValue:kd,useDeferredValue:function(c,m){var w=Qs();return Oa===null?Wa(w,c,m):Zr(w,Oa.memoizedState,c,m)},useTransition:function(){var c=Rd(fh)[0],m=Qs().memoizedState;return[typeof c=="boolean"?c:Dd(c),m]},useSyncExternalStore:Gh,useId:op,useHostTransitionStatus:Lp,useFormState:Rp,useActionState:Rp,useOptimistic:function(c,m){var w=Qs();return Oa!==null?ca(w,Oa,c,m):(w.baseState=c,[c,w.queue.dispatch])},useMemoCache:Xa,useCacheRefresh:kp};hp.useEffectEvent=ap;function Lf(c,m,w,D){m=c.memoizedState,w=w(D,m),w=w==null?m:ut({},m,w),c.memoizedState=w,c.lanes===0&&(c.updateQueue.baseState=w)}var Xh={enqueueSetState:function(c,m,w){c=c._reactInternals;var D=Sr(),G=zn(D);G.payload=m,w!=null&&(G.callback=w),m=ir(c,G,D),m!==null&&(fa(m,c,D),$r(m,c,D))},enqueueReplaceState:function(c,m,w){c=c._reactInternals;var D=Sr(),G=zn(D);G.tag=1,G.payload=m,w!=null&&(G.callback=w),m=ir(c,G,D),m!==null&&(fa(m,c,D),$r(m,c,D))},enqueueForceUpdate:function(c,m){c=c._reactInternals;var w=Sr(),D=zn(w);D.tag=2,m!=null&&(D.callback=m),m=ir(c,D,w),m!==null&&(fa(m,c,w),$r(m,c,w))}};function ao(c,m,w,D,G,W,ve){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(D,W,ve):m.prototype&&m.prototype.isPureReactComponent?!Ua(w,D)||!Ua(G,W):!0}function kf(c,m,w,D){c=m.state,typeof m.componentWillReceiveProps=="function"&&m.componentWillReceiveProps(w,D),typeof m.UNSAFE_componentWillReceiveProps=="function"&&m.UNSAFE_componentWillReceiveProps(w,D),m.state!==c&&Xh.enqueueReplaceState(m,m.state,null)}function Fd(c,m){var w=m;if("ref"in m){w={};for(var D in m)D!=="ref"&&(w[D]=m[D])}if(c=c.defaultProps){w===m&&(w=ut({},w));for(var G in c)w[G]===void 0&&(w[G]=c[G])}return w}function _m(c){hc(c)}function mf(c){console.error(c)}function gm(c){hc(c)}function dp(c,m){try{var w=c.onUncaughtError;w(m.value,{componentStack:m.stack})}catch(D){setTimeout(function(){throw D})}}function Of(c,m,w){try{var D=c.onCaughtError;D(w.value,{componentStack:w.stack,errorBoundary:m.tag===1?m.stateNode:null})}catch(G){setTimeout(function(){throw G})}}function Su(c,m,w){return w=zn(w),w.tag=3,w.payload={element:null},w.callback=function(){dp(c,m)},w}function Bc(c){return c=zn(c),c.tag=3,c}function Eu(c,m,w,D){var G=w.type.getDerivedStateFromError;if(typeof G=="function"){var W=D.value;c.payload=function(){return G(W)},c.callback=function(){Of(m,w,D)}}var ve=w.stateNode;ve!==null&&typeof ve.componentDidCatch=="function"&&(c.callback=function(){Of(m,w,D),typeof G!="function"&&(Qn===null?Qn=new Set([this]):Qn.add(this));var Je=D.stack;this.componentDidCatch(D.value,{componentStack:Je!==null?Je:""})})}function Fm(c,m,w,D,G){if(w.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){if(m=w.alternate,m!==null&&pd(m,w,G,!0),w=Os.current,w!==null){switch(w.tag){case 31:case 13:return Ms===null?ic():w.alternate===null&&Ri===0&&(Ri=3),w.flags&=-257,w.flags|=65536,w.lanes=G,D===be?w.flags|=16384:(m=w.updateQueue,m===null?w.updateQueue=new Set([D]):m.add(D),Gm(c,D,G)),!1;case 22:return w.flags|=65536,D===be?w.flags|=16384:(m=w.updateQueue,m===null?(m={transitions:null,markerInstances:null,retryQueue:new Set([D])},w.updateQueue=m):(w=m.retryQueue,w===null?m.retryQueue=new Set([D]):w.add(D)),Gm(c,D,G)),!1}throw Error(ce(435,w.tag))}return Gm(c,D,G),ic(),!1}if(fn)return m=Os.current,m!==null?((m.flags&65536)===0&&(m.flags|=256),m.flags|=65536,m.lanes=G,D!==Vh&&(c=Error(ce(422),{cause:D}),fd(Zo(c,w)))):(D!==Vh&&(m=Error(ce(423),{cause:D}),fd(Zo(m,w))),c=c.current.alternate,c.flags|=65536,G&=-G,c.lanes|=G,D=Zo(D,w),G=Su(c.stateNode,D,G),On(c,G),Ri!==4&&(Ri=2)),!1;var W=Error(ce(520),{cause:D});if(W=Zo(W,w),Qi===null?Qi=[W]:Qi.push(W),Ri!==4&&(Ri=2),m===null)return!0;D=Zo(D,w),w=m;do{switch(w.tag){case 3:return w.flags|=65536,c=G&-G,w.lanes|=c,c=Su(w.stateNode,D,c),On(w,c),!1;case 1:if(m=w.type,W=w.stateNode,(w.flags&128)===0&&(typeof m.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Qn===null||!Qn.has(W))))return w.flags|=65536,G&=-G,w.lanes|=G,G=Bc(G),Eu(G,c,w,D),On(w,G),!1}w=w.return}while(w!==null);return!1}var yo=Error(ce(461)),ko=!1;function dl(c,m,w,D){m.child=c===null?An(m,null,w,D):$i(m,c.child,w,D)}function _f(c,m,w,D,G){w=w.render;var W=m.ref;if("ref"in D){var ve={};for(var Je in D)Je!=="ref"&&(ve[Je]=D[Je])}else ve=D;return Wo(m),D=Gu(c,m,w,ve,W,G),Je=Ko(),c!==null&&!ko?(yc(c,m,G),Zu(c,m,G)):(fn&&Je&&Qd(m),m.flags|=1,dl(c,m,D,G),m.child)}function fp(c,m,w,D,G){if(c===null){var W=w.type;return typeof W=="function"&&!Fu(W)&&W.defaultProps===void 0&&w.compare===null?(m.tag=15,m.type=W,Nd(c,m,W,D,G)):(c=Oh(w.type,null,D,m,m.mode,G),c.ref=m.ref,c.return=m,m.child=c)}if(W=c.child,!_h(c,G)){var ve=W.memoizedProps;if(w=w.compare,w=w!==null?w:Ua,w(ve,D)&&c.ref===m.ref)return Zu(c,m,G)}return m.flags|=1,c=vl(W,D),c.ref=m.ref,c.return=m,m.child=c}function Nd(c,m,w,D,G){if(c!==null){var W=c.memoizedProps;if(Ua(W,D)&&c.ref===m.ref)if(ko=!1,m.pendingProps=D=W,_h(c,G))(c.flags&131072)!==0&&(ko=!0);else return m.lanes=c.lanes,Zu(c,m,G)}return Np(c,m,w,D,G)}function ym(c,m,w,D){var G=D.children,W=c!==null?c.memoizedState:null;if(c===null&&m.stateNode===null&&(m.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),D.mode==="hidden"){if((m.flags&128)!==0){if(W=W!==null?W.baseLanes|w:w,c!==null){for(D=m.child=c.child,G=0;D!==null;)G=G|D.lanes|D.childLanes,D=D.sibling;D=G&~W}else D=0,m.child=null;return gf(c,m,W,w,D)}if((w&536870912)!==0)m.memoizedState={baseLanes:0,cachePool:null},c!==null&&P(m,W!==null?W.cachePool:null),W!==null?mc(m,W):ks(),Nl(m);else return D=m.lanes=536870912,gf(c,m,W!==null?W.baseLanes|w:w,w,D)}else W!==null?(P(m,W.cachePool),mc(m,W),Jc(),m.memoizedState=null):(c!==null&&P(m,null),ks(),Jc());return dl(c,m,G,w),m.child}function Bf(c,m){return c!==null&&c.tag===22||m.stateNode!==null||(m.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),m.sibling}function gf(c,m,w,D,G){var W=I();return W=W===null?null:{parent:ls._currentValue,pool:W},m.memoizedState={baseLanes:w,cachePool:W},c!==null&&P(m,null),ks(),Nl(m),c!==null&&pd(c,m,D,!0),m.childLanes=G,null}function Vd(c,m){return m=Vp({mode:m.mode,children:m.children},c.mode),m.ref=c.ref,c.child=m,m.return=c,m}function Bp(c,m,w){return $i(m,c.child,null,w),c=Vd(m,m.pendingProps),c.flags|=2,hl(m),m.memoizedState=null,c}function Fp(c,m,w){var D=m.pendingProps,G=(m.flags&128)!==0;if(m.flags&=-129,c===null){if(fn){if(D.mode==="hidden")return c=Vd(m,D),m.lanes=536870912,Bf(null,c);if(_c(m),(c=ja)?(c=Pi(c,fc),c=c!==null&&c.data==="&"?c:null,c!==null&&(m.memoizedState={dehydrated:c,treeContext:Ra!==null?{id:sl,overflow:Bl}:null,retryLane:536870912,hydrationErrors:null},w=Wd(c),w.return=m,m.child=w,mo=m,ja=null)):c=null,c===null)throw Ql(m);return m.lanes=536870912,null}return Vd(m,D)}var W=c.memoizedState;if(W!==null){var ve=W.dehydrated;if(_c(m),G)if(m.flags&256)m.flags&=-257,m=Bp(c,m,w);else if(m.memoizedState!==null)m.child=c.child,m.flags|=128,m=null;else throw Error(ce(558));else if(ko||pd(c,m,w,!1),G=(w&c.childLanes)!==0,ko||G){if(D=It,D!==null&&(ve=fi(D,w),ve!==0&&ve!==W.retryLane))throw W.retryLane=ve,gu(c,ve),fa(D,c,ve),yo;ic(),m=Bp(c,m,w)}else c=W.treeContext,ja=Fn(ve.nextSibling),mo=m,fn=!0,Wc=null,fc=!1,c!==null&&Nh(m,c),m=Vd(m,D),m.flags|=4096;return m}return c=vl(c.child,{mode:D.mode,children:D.children}),c.ref=m.ref,m.child=c,c.return=m,c}function yf(c,m){var w=m.ref;if(w===null)c!==null&&c.ref!==null&&(m.flags|=4194816);else{if(typeof w!="function"&&typeof w!="object")throw Error(ce(284));(c===null||c.ref!==w)&&(m.flags|=4194816)}}function Np(c,m,w,D,G){return Wo(m),w=Gu(c,m,w,D,void 0,G),D=Ko(),c!==null&&!ko?(yc(c,m,G),Zu(c,m,G)):(fn&&D&&Qd(m),m.flags|=1,dl(c,m,w,G),m.child)}function pp(c,m,w,D,G,W){return Wo(m),m.updateQueue=null,w=qo(m,D,w,G),Dp(c),D=Ko(),c!==null&&!ko?(yc(c,m,W),Zu(c,m,W)):(fn&&D&&Qd(m),m.flags|=1,dl(c,m,w,W),m.child)}function mp(c,m,w,D,G){if(Wo(m),m.stateNode===null){var W=yl,ve=w.contextType;typeof ve=="object"&&ve!==null&&(W=ka(ve)),W=new w(D,W),m.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,W.updater=Xh,m.stateNode=W,W._reactInternals=m,W=m.stateNode,W.props=D,W.state=m.memoizedState,W.refs={},Zn(m),ve=w.contextType,W.context=typeof ve=="object"&&ve!==null?ka(ve):yl,W.state=m.memoizedState,ve=w.getDerivedStateFromProps,typeof ve=="function"&&(Lf(m,w,ve,D),W.state=m.memoizedState),typeof w.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(ve=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),ve!==W.state&&Xh.enqueueReplaceState(W,W.state,null),Qa(m,D,W,G),Yr(),W.state=m.memoizedState),typeof W.componentDidMount=="function"&&(m.flags|=4194308),D=!0}else if(c===null){W=m.stateNode;var Je=m.memoizedProps,kt=Fd(w,Je);W.props=kt;var Mi=W.context,nn=w.contextType;ve=yl,typeof nn=="object"&&nn!==null&&(ve=ka(nn));var hn=w.getDerivedStateFromProps;nn=typeof hn=="function"||typeof W.getSnapshotBeforeUpdate=="function",Je=m.pendingProps!==Je,nn||typeof W.UNSAFE_componentWillReceiveProps!="function"&&typeof W.componentWillReceiveProps!="function"||(Je||Mi!==ve)&&kf(m,W,D,ve),Mn=!1;var Li=m.memoizedState;W.state=Li,Qa(m,D,W,G),Yr(),Mi=m.memoizedState,Je||Li!==Mi||Mn?(typeof hn=="function"&&(Lf(m,w,hn,D),Mi=m.memoizedState),(kt=Mn||ao(m,w,kt,D,Li,Mi,ve))?(nn||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount()),typeof W.componentDidMount=="function"&&(m.flags|=4194308)):(typeof W.componentDidMount=="function"&&(m.flags|=4194308),m.memoizedProps=D,m.memoizedState=Mi),W.props=D,W.state=Mi,W.context=ve,D=kt):(typeof W.componentDidMount=="function"&&(m.flags|=4194308),D=!1)}else{W=m.stateNode,Ln(c,m),ve=m.memoizedProps,nn=Fd(w,ve),W.props=nn,hn=m.pendingProps,Li=W.context,Mi=w.contextType,kt=yl,typeof Mi=="object"&&Mi!==null&&(kt=ka(Mi)),Je=w.getDerivedStateFromProps,(Mi=typeof Je=="function"||typeof W.getSnapshotBeforeUpdate=="function")||typeof W.UNSAFE_componentWillReceiveProps!="function"&&typeof W.componentWillReceiveProps!="function"||(ve!==hn||Li!==kt)&&kf(m,W,D,kt),Mn=!1,Li=m.memoizedState,W.state=Li,Qa(m,D,W,G),Yr();var Ni=m.memoizedState;ve!==hn||Li!==Ni||Mn||c!==null&&c.dependencies!==null&&tf(c.dependencies)?(typeof Je=="function"&&(Lf(m,w,Je,D),Ni=m.memoizedState),(nn=Mn||ao(m,w,nn,D,Li,Ni,kt)||c!==null&&c.dependencies!==null&&tf(c.dependencies))?(Mi||typeof W.UNSAFE_componentWillUpdate!="function"&&typeof W.componentWillUpdate!="function"||(typeof W.componentWillUpdate=="function"&&W.componentWillUpdate(D,Ni,kt),typeof W.UNSAFE_componentWillUpdate=="function"&&W.UNSAFE_componentWillUpdate(D,Ni,kt)),typeof W.componentDidUpdate=="function"&&(m.flags|=4),typeof W.getSnapshotBeforeUpdate=="function"&&(m.flags|=1024)):(typeof W.componentDidUpdate!="function"||ve===c.memoizedProps&&Li===c.memoizedState||(m.flags|=4),typeof W.getSnapshotBeforeUpdate!="function"||ve===c.memoizedProps&&Li===c.memoizedState||(m.flags|=1024),m.memoizedProps=D,m.memoizedState=Ni),W.props=D,W.state=Ni,W.context=kt,D=nn):(typeof W.componentDidUpdate!="function"||ve===c.memoizedProps&&Li===c.memoizedState||(m.flags|=4),typeof W.getSnapshotBeforeUpdate!="function"||ve===c.memoizedProps&&Li===c.memoizedState||(m.flags|=1024),D=!1)}return W=D,yf(c,m),D=(m.flags&128)!==0,W||D?(W=m.stateNode,w=D&&typeof w.getDerivedStateFromError!="function"?null:W.render(),m.flags|=1,c!==null&&D?(m.child=$i(m,c.child,null,G),m.child=$i(m,null,w,G)):dl(c,m,w,G),m.memoizedState=W.state,c=m.child):c=Zu(c,m,G),c}function Nm(c,m,w,D){return Yc(),m.flags|=256,dl(c,m,w,D),m.child}var Vm={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function xm(c){return{baseLanes:c,cachePool:H()}}function xs(c,m,w){return c=c!==null?c.childLanes&~w:0,m&&(c|=en),c}function mh(c,m,w){var D=m.pendingProps,G=!1,W=(m.flags&128)!==0,ve;if((ve=W)||(ve=c!==null&&c.memoizedState===null?!1:(Cs.current&2)!==0),ve&&(G=!0,m.flags&=-129),ve=(m.flags&32)!==0,m.flags&=-33,c===null){if(fn){if(G?Co(m):Jc(),(c=ja)?(c=Pi(c,fc),c=c!==null&&c.data!=="&"?c:null,c!==null&&(m.memoizedState={dehydrated:c,treeContext:Ra!==null?{id:sl,overflow:Bl}:null,retryLane:536870912,hydrationErrors:null},w=Wd(c),w.return=m,m.child=w,mo=m,ja=null)):c=null,c===null)throw Ql(m);return Wn(c)?m.lanes=32:m.lanes=536870912,null}var Je=D.children;return D=D.fallback,G?(Jc(),G=m.mode,Je=Vp({mode:"hidden",children:Je},G),D=Oc(D,G,w,null),Je.return=m,D.return=m,Je.sibling=D,m.child=Je,D=m.child,D.memoizedState=xm(w),D.childLanes=xs(c,ve,w),m.memoizedState=Vm,Bf(null,D)):(Co(m),Um(m,Je))}var kt=c.memoizedState;if(kt!==null&&(Je=kt.dehydrated,Je!==null)){if(W)m.flags&256?(Co(m),m.flags&=-257,m=xf(c,m,w)):m.memoizedState!==null?(Jc(),m.child=c.child,m.flags|=128,m=null):(Jc(),Je=D.fallback,G=m.mode,D=Vp({mode:"visible",children:D.children},G),Je=Oc(Je,G,w,null),Je.flags|=2,D.return=m,Je.return=m,D.sibling=Je,m.child=D,$i(m,c.child,null,w),D=m.child,D.memoizedState=xm(w),D.childLanes=xs(c,ve,w),m.memoizedState=Vm,m=Bf(null,D));else if(Co(m),Wn(Je)){if(ve=Je.nextSibling&&Je.nextSibling.dataset,ve)var Mi=ve.dgst;ve=Mi,D=Error(ce(419)),D.stack="",D.digest=ve,fd({value:D,source:null,stack:null}),m=xf(c,m,w)}else if(ko||pd(c,m,w,!1),ve=(w&c.childLanes)!==0,ko||ve){if(ve=It,ve!==null&&(D=fi(ve,w),D!==0&&D!==kt.retryLane))throw kt.retryLane=D,gu(c,D),fa(ve,c,D),yo;gn(Je)||ic(),m=xf(c,m,w)}else gn(Je)?(m.flags|=192,m.child=c.child,m=null):(c=kt.treeContext,ja=Fn(Je.nextSibling),mo=m,fn=!0,Wc=null,fc=!1,c!==null&&Nh(m,c),m=Um(m,D.children),m.flags|=4096);return m}return G?(Jc(),Je=D.fallback,G=m.mode,kt=c.child,Mi=kt.sibling,D=vl(kt,{mode:"hidden",children:D.children}),D.subtreeFlags=kt.subtreeFlags&65011712,Mi!==null?Je=vl(Mi,Je):(Je=Oc(Je,G,w,null),Je.flags|=2),Je.return=m,D.return=m,D.sibling=Je,m.child=D,Bf(null,D),D=m.child,Je=c.child.memoizedState,Je===null?Je=xm(w):(G=Je.cachePool,G!==null?(kt=ls._currentValue,G=G.parent!==kt?{parent:kt,pool:kt}:G):G=H(),Je={baseLanes:Je.baseLanes|w,cachePool:G}),D.memoizedState=Je,D.childLanes=xs(c,ve,w),m.memoizedState=Vm,Bf(c.child,D)):(Co(m),w=c.child,c=w.sibling,w=vl(w,{mode:"visible",children:D.children}),w.return=m,w.sibling=null,c!==null&&(ve=m.deletions,ve===null?(m.deletions=[c],m.flags|=16):ve.push(c)),m.child=w,m.memoizedState=null,w)}function Um(c,m){return m=Vp({mode:"visible",children:m},c.mode),m.return=c,c.child=m}function Vp(c,m){return c=xl(22,c,null,m),c.lanes=0,c}function xf(c,m,w){return $i(m,c.child,null,w),c=Um(m,m.pendingProps.children),c.flags|=2,m.memoizedState=null,c}function _p(c,m,w){c.lanes|=m;var D=c.alternate;D!==null&&(D.lanes|=m),zp(c.return,m,w)}function Up(c,m,w,D,G,W){var ve=c.memoizedState;ve===null?c.memoizedState={isBackwards:m,rendering:null,renderingStartTime:0,last:D,tail:w,tailMode:G,treeForkCount:W}:(ve.isBackwards=m,ve.rendering=null,ve.renderingStartTime=0,ve.last=D,ve.tail=w,ve.tailMode=G,ve.treeForkCount=W)}function vm(c,m,w){var D=m.pendingProps,G=D.revealOrder,W=D.tail;D=D.children;var ve=Cs.current,Je=(ve&2)!==0;if(Je?(ve=ve&1|2,m.flags|=128):ve&=1,ai(Cs,ve),dl(c,m,D,w),D=fn?Jd:0,!Je&&c!==null&&(c.flags&128)!==0)e:for(c=m.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&_p(c,w,m);else if(c.tag===19)_p(c,w,m);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===m)break e;for(;c.sibling===null;){if(c.return===null||c.return===m)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}switch(G){case"forwards":for(w=m.child,G=null;w!==null;)c=w.alternate,c!==null&&bu(c)===null&&(G=w),w=w.sibling;w=G,w===null?(G=m.child,m.child=null):(G=w.sibling,w.sibling=null),Up(m,!1,G,w,W,D);break;case"backwards":case"unstable_legacy-backwards":for(w=null,G=m.child,m.child=null;G!==null;){if(c=G.alternate,c!==null&&bu(c)===null){m.child=G;break}c=G.sibling,G.sibling=w,w=G,G=c}Up(m,!0,w,null,W,D);break;case"together":Up(m,!1,null,null,void 0,D);break;default:m.memoizedState=null}return m.child}function Zu(c,m,w){if(c!==null&&(m.dependencies=c.dependencies),Ti|=m.lanes,(w&m.childLanes)===0)if(c!==null){if(pd(c,m,w,!1),(w&m.childLanes)===0)return null}else return null;if(c!==null&&m.child!==c.child)throw Error(ce(153));if(m.child!==null){for(c=m.child,w=vl(c,c.pendingProps),m.child=w,w.return=m;c.sibling!==null;)c=c.sibling,w=w.sibling=vl(c,c.pendingProps),w.return=m;w.sibling=null}return m.child}function _h(c,m){return(c.lanes&m)!==0?!0:(c=c.dependencies,!!(c!==null&&tf(c)))}function bm(c,m,w){switch(m.tag){case 3:pr(m,m.stateNode.containerInfo),uh(m,ls,c.memoizedState.cache),Yc();break;case 27:case 5:Cr(m);break;case 4:pr(m,m.stateNode.containerInfo);break;case 10:uh(m,m.type,m.memoizedProps.value);break;case 31:if(m.memoizedState!==null)return m.flags|=128,_c(m),null;break;case 13:var D=m.memoizedState;if(D!==null)return D.dehydrated!==null?(Co(m),m.flags|=128,null):(w&m.child.childLanes)!==0?mh(c,m,w):(Co(m),c=Zu(c,m,w),c!==null?c.sibling:null);Co(m);break;case 19:var G=(c.flags&128)!==0;if(D=(w&m.childLanes)!==0,D||(pd(c,m,w,!1),D=(w&m.childLanes)!==0),G){if(D)return vm(c,m,w);m.flags|=128}if(G=m.memoizedState,G!==null&&(G.rendering=null,G.tail=null,G.lastEffect=null),ai(Cs,Cs.current),D)break;return null;case 22:return m.lanes=0,ym(c,m,w,m.pendingProps);case 24:uh(m,ls,c.memoizedState.cache)}return Zu(c,m,w)}function Oo(c,m,w){if(c!==null)if(c.memoizedProps!==m.pendingProps)ko=!0;else{if(!_h(c,w)&&(m.flags&128)===0)return ko=!1,bm(c,m,w);ko=(c.flags&131072)!==0}else ko=!1,fn&&(m.flags&1048576)!==0&&Rf(m,Jd,m.index);switch(m.lanes=0,m.tag){case 16:e:{var D=m.pendingProps;if(c=Ye(m.elementType),m.type=c,typeof c=="function")Fu(c)?(D=Fd(c,D),m.tag=1,m=mp(null,m,c,D,w)):(m.tag=0,m=Np(null,m,c,D,w));else{if(c!=null){var G=c.$$typeof;if(G===Vn){m.tag=11,m=_f(null,m,c,D,w);break e}else if(G===qi){m.tag=14,m=fp(null,m,c,D,w);break e}}throw m=Hr(c)||c,Error(ce(306,m,""))}}return m;case 0:return Np(c,m,m.type,m.pendingProps,w);case 1:return D=m.type,G=Fd(D,m.pendingProps),mp(c,m,D,G,w);case 3:e:{if(pr(m,m.stateNode.containerInfo),c===null)throw Error(ce(387));D=m.pendingProps;var W=m.memoizedState;G=W.element,Ln(c,m),Qa(m,D,null,w);var ve=m.memoizedState;if(D=ve.cache,uh(m,ls,D),D!==W.cache&&zd(m,[ls],w,!0),Yr(),D=ve.element,W.isDehydrated)if(W={element:D,isDehydrated:!1,cache:ve.cache},m.updateQueue.baseState=W,m.memoizedState=W,m.flags&256){m=Nm(c,m,D,w);break e}else if(D!==G){G=Zo(Error(ce(424)),m),fd(G),m=Nm(c,m,D,w);break e}else{switch(c=m.stateNode.containerInfo,c.nodeType){case 9:c=c.body;break;default:c=c.nodeName==="HTML"?c.ownerDocument.body:c}for(ja=Fn(c.firstChild),mo=m,fn=!0,Wc=null,fc=!0,w=An(m,null,D,w),m.child=w;w;)w.flags=w.flags&-3|4096,w=w.sibling}else{if(Yc(),D===G){m=Zu(c,m,w);break e}dl(c,m,D,w)}m=m.child}return m;case 26:return yf(c,m),c===null?(w=Ec(m.type,null,m.pendingProps,null))?m.memoizedState=w:fn||(w=m.type,c=m.pendingProps,D=z(_r.current).createElement(w),D[te]=m,D[pe]=c,Tc(D,w,c),Bi(D),m.stateNode=D):m.memoizedState=Ec(m.type,c.memoizedProps,m.pendingProps,c.memoizedState),null;case 27:return Cr(m),c===null&&fn&&(D=m.stateNode=nr(m.type,m.pendingProps,_r.current),mo=m,fc=!0,G=ja,Ke(m.type)?(In=G,ja=Fn(D.firstChild)):ja=G),dl(c,m,m.pendingProps.children,w),yf(c,m),c===null&&(m.flags|=4194304),m.child;case 5:return c===null&&fn&&((G=D=ja)&&(D=Ut(D,m.type,m.pendingProps,fc),D!==null?(m.stateNode=D,mo=m,ja=Fn(D.firstChild),fc=!1,G=!0):G=!1),G||Ql(m)),Cr(m),G=m.type,W=m.pendingProps,ve=c!==null?c.memoizedProps:null,D=W.children,q(G,W)?D=null:ve!==null&&q(G,ve)&&(m.flags|=32),m.memoizedState!==null&&(G=Gu(c,m,np,null,null,w),Mm._currentValue=G),yf(c,m),dl(c,m,D,w),m.child;case 6:return c===null&&fn&&((c=w=ja)&&(w=ii(w,m.pendingProps,fc),w!==null?(m.stateNode=w,mo=m,ja=null,c=!0):c=!1),c||Ql(m)),null;case 13:return mh(c,m,w);case 4:return pr(m,m.stateNode.containerInfo),D=m.pendingProps,c===null?m.child=$i(m,null,D,w):dl(c,m,D,w),m.child;case 11:return _f(c,m,m.type,m.pendingProps,w);case 7:return dl(c,m,m.pendingProps,w),m.child;case 8:return dl(c,m,m.pendingProps.children,w),m.child;case 12:return dl(c,m,m.pendingProps.children,w),m.child;case 10:return D=m.pendingProps,uh(m,m.type,D.value),dl(c,m,D.children,w),m.child;case 9:return G=m.type._context,D=m.pendingProps.children,Wo(m),G=ka(G),D=D(G),m.flags|=1,dl(c,m,D,w),m.child;case 14:return fp(c,m,m.type,m.pendingProps,w);case 15:return Nd(c,m,m.type,m.pendingProps,w);case 19:return vm(c,m,w);case 31:return Fp(c,m,w);case 22:return ym(c,m,w,m.pendingProps);case 24:return Wo(m),D=ka(ls),c===null?(G=I(),G===null&&(G=It,W=pc(),G.pooledCache=W,W.refCount++,W!==null&&(G.pooledCacheLanes|=w),G=W),m.memoizedState={parent:D,cache:G},Zn(m),uh(m,ls,G)):((c.lanes&w)!==0&&(Ln(c,m),Qa(m,null,null,w),Yr()),G=c.memoizedState,W=m.memoizedState,G.parent!==D?(G={parent:D,cache:D},m.memoizedState=G,m.lanes===0&&(m.memoizedState=m.updateQueue.baseState=G),uh(m,ls,D)):(D=W.cache,uh(m,ls,D),D!==G.cache&&zd(m,[ls],w,!0))),dl(c,m,m.pendingProps.children,w),m.child;case 29:throw m.pendingProps}throw Error(ce(156,m.tag))}function ec(c){c.flags|=4}function Ff(c,m,w,D,G){if((m=(c.mode&32)!==0)&&(m=!1),m){if(c.flags|=16777216,(G&335544128)===G)if(c.stateNode.complete)c.flags|=8192;else if(fl())c.flags|=8192;else throw st=be,ne}else c.flags&=-16777217}function Nf(c,m){if(m.type!=="stylesheet"||(m.state.loading&4)!==0)c.flags&=-16777217;else if(c.flags|=16777216,!Al(m))if(fl())c.flags|=8192;else throw st=be,ne}function gh(c,m){m!==null&&(c.flags|=4),c.flags&16384&&(m=c.tag!==22?mt():536870912,c.lanes|=m,ji|=m)}function Vf(c,m){if(!fn)switch(c.tailMode){case"hidden":m=c.tail;for(var w=null;m!==null;)m.alternate!==null&&(w=m),m=m.sibling;w===null?c.tail=null:w.sibling=null;break;case"collapsed":w=c.tail;for(var D=null;w!==null;)w.alternate!==null&&(D=w),w=w.sibling;D===null?m||c.tail===null?c.tail=null:c.tail.sibling=null:D.sibling=null}}function so(c){var m=c.alternate!==null&&c.alternate.child===c.child,w=0,D=0;if(m)for(var G=c.child;G!==null;)w|=G.lanes|G.childLanes,D|=G.subtreeFlags&65011712,D|=G.flags&65011712,G.return=c,G=G.sibling;else for(G=c.child;G!==null;)w|=G.lanes|G.childLanes,D|=G.subtreeFlags,D|=G.flags,G.return=c,G=G.sibling;return c.subtreeFlags|=D,c.childLanes=w,m}function wm(c,m,w){var D=m.pendingProps;switch(lh(m),m.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return so(m),null;case 1:return so(m),null;case 3:return w=m.stateNode,D=null,c!==null&&(D=c.memoizedState.cache),m.memoizedState.cache!==D&&(m.flags|=2048),hh(ls),Cn(),w.pendingContext&&(w.context=w.pendingContext,w.pendingContext=null),(c===null||c.child===null)&&(Ia(m)?ec(m):c===null||c.memoizedState.isDehydrated&&(m.flags&256)===0||(m.flags|=1024,tp())),so(m),null;case 26:var G=m.type,W=m.memoizedState;return c===null?(ec(m),W!==null?(so(m),Nf(m,W)):(so(m),Ff(m,G,null,D,w))):W?W!==c.memoizedState?(ec(m),so(m),Nf(m,W)):(so(m),m.flags&=-16777217):(c=c.memoizedProps,c!==D&&ec(m),so(m),Ff(m,G,c,D,w)),null;case 27:if(Ir(m),w=_r.current,G=m.type,c!==null&&m.stateNode!=null)c.memoizedProps!==D&&ec(m);else{if(!D){if(m.stateNode===null)throw Error(ce(166));return so(m),null}c=ln.current,Ia(m)?ch(m):(c=nr(G,D,w),m.stateNode=c,ec(m))}return so(m),null;case 5:if(Ir(m),G=m.type,c!==null&&m.stateNode!=null)c.memoizedProps!==D&&ec(m);else{if(!D){if(m.stateNode===null)throw Error(ce(166));return so(m),null}if(W=ln.current,Ia(m))ch(m);else{var ve=z(_r.current);switch(W){case 1:W=ve.createElementNS("http://www.w3.org/2000/svg",G);break;case 2:W=ve.createElementNS("http://www.w3.org/1998/Math/MathML",G);break;default:switch(G){case"svg":W=ve.createElementNS("http://www.w3.org/2000/svg",G);break;case"math":W=ve.createElementNS("http://www.w3.org/1998/Math/MathML",G);break;case"script":W=ve.createElement("div"),W.innerHTML="<script><\/script>",W=W.removeChild(W.firstChild);break;case"select":W=typeof D.is=="string"?ve.createElement("select",{is:D.is}):ve.createElement("select"),D.multiple?W.multiple=!0:D.size&&(W.size=D.size);break;default:W=typeof D.is=="string"?ve.createElement(G,{is:D.is}):ve.createElement(G)}}W[te]=m,W[pe]=D;e:for(ve=m.child;ve!==null;){if(ve.tag===5||ve.tag===6)W.appendChild(ve.stateNode);else if(ve.tag!==4&&ve.tag!==27&&ve.child!==null){ve.child.return=ve,ve=ve.child;continue}if(ve===m)break e;for(;ve.sibling===null;){if(ve.return===null||ve.return===m)break e;ve=ve.return}ve.sibling.return=ve.return,ve=ve.sibling}m.stateNode=W;e:switch(Tc(W,G,D),G){case"button":case"input":case"select":case"textarea":D=!!D.autoFocus;break e;case"img":D=!0;break e;default:D=!1}D&&ec(m)}}return so(m),Ff(m,m.type,c===null?null:c.memoizedProps,m.pendingProps,w),null;case 6:if(c&&m.stateNode!=null)c.memoizedProps!==D&&ec(m);else{if(typeof D!="string"&&m.stateNode===null)throw Error(ce(166));if(c=_r.current,Ia(m)){if(c=m.stateNode,w=m.memoizedProps,D=null,G=mo,G!==null)switch(G.tag){case 27:case 5:D=G.memoizedProps}c[te]=m,c=!!(c.nodeValue===w||D!==null&&D.suppressHydrationWarning===!0||Tf(c.nodeValue,w)),c||Ql(m,!0)}else c=z(c).createTextNode(D),c[te]=m,m.stateNode=c}return so(m),null;case 31:if(w=m.memoizedState,c===null||c.memoizedState!==null){if(D=Ia(m),w!==null){if(c===null){if(!D)throw Error(ce(318));if(c=m.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(ce(557));c[te]=m}else Yc(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;so(m),c=!1}else w=tp(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=w),c=!0;if(!c)return m.flags&256?(hl(m),m):(hl(m),null);if((m.flags&128)!==0)throw Error(ce(558))}return so(m),null;case 13:if(D=m.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(G=Ia(m),D!==null&&D.dehydrated!==null){if(c===null){if(!G)throw Error(ce(318));if(G=m.memoizedState,G=G!==null?G.dehydrated:null,!G)throw Error(ce(317));G[te]=m}else Yc(),(m.flags&128)===0&&(m.memoizedState=null),m.flags|=4;so(m),G=!1}else G=tp(),c!==null&&c.memoizedState!==null&&(c.memoizedState.hydrationErrors=G),G=!0;if(!G)return m.flags&256?(hl(m),m):(hl(m),null)}return hl(m),(m.flags&128)!==0?(m.lanes=w,m):(w=D!==null,c=c!==null&&c.memoizedState!==null,w&&(D=m.child,G=null,D.alternate!==null&&D.alternate.memoizedState!==null&&D.alternate.memoizedState.cachePool!==null&&(G=D.alternate.memoizedState.cachePool.pool),W=null,D.memoizedState!==null&&D.memoizedState.cachePool!==null&&(W=D.memoizedState.cachePool.pool),W!==G&&(D.flags|=2048)),w!==c&&w&&(m.child.flags|=8192),gh(m,m.updateQueue),so(m),null);case 4:return Cn(),c===null&&Tl(m.stateNode.containerInfo),so(m),null;case 10:return hh(m.type),so(m),null;case 19:if(jt(Cs),D=m.memoizedState,D===null)return so(m),null;if(G=(m.flags&128)!==0,W=D.rendering,W===null)if(G)Vf(D,!1);else{if(Ri!==0||c!==null&&(c.flags&128)!==0)for(c=m.child;c!==null;){if(W=bu(c),W!==null){for(m.flags|=128,Vf(D,!1),c=W.updateQueue,m.updateQueue=c,gh(m,c),m.subtreeFlags=0,c=w,w=m.child;w!==null;)Nu(w,c),w=w.sibling;return ai(Cs,Cs.current&1|2),fn&&Vu(m,D.treeForkCount),m.child}c=c.sibling}D.tail!==null&&la()>_n&&(m.flags|=128,G=!0,Vf(D,!1),m.lanes=4194304)}else{if(!G)if(c=bu(W),c!==null){if(m.flags|=128,G=!0,c=c.updateQueue,m.updateQueue=c,gh(m,c),Vf(D,!0),D.tail===null&&D.tailMode==="hidden"&&!W.alternate&&!fn)return so(m),null}else 2*la()-D.renderingStartTime>_n&&w!==536870912&&(m.flags|=128,G=!0,Vf(D,!1),m.lanes=4194304);D.isBackwards?(W.sibling=m.child,m.child=W):(c=D.last,c!==null?c.sibling=W:m.child=W,D.last=W)}return D.tail!==null?(c=D.tail,D.rendering=c,D.tail=c.sibling,D.renderingStartTime=la(),c.sibling=null,w=Cs.current,ai(Cs,G?w&1|2:w&1),fn&&Vu(m,D.treeForkCount),c):(so(m),null);case 22:case 23:return hl(m),Lo(),D=m.memoizedState!==null,c!==null?c.memoizedState!==null!==D&&(m.flags|=8192):D&&(m.flags|=8192),D?(w&536870912)!==0&&(m.flags&128)===0&&(so(m),m.subtreeFlags&6&&(m.flags|=8192)):so(m),w=m.updateQueue,w!==null&&gh(m,w.retryQueue),w=null,c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(w=c.memoizedState.cachePool.pool),D=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(D=m.memoizedState.cachePool.pool),D!==w&&(m.flags|=2048),c!==null&&jt(A),null;case 24:return w=null,c!==null&&(w=c.memoizedState.cache),m.memoizedState.cache!==w&&(m.flags|=2048),hh(ls),so(m),null;case 25:return null;case 30:return null}throw Error(ce(156,m.tag))}function u_(c,m){switch(lh(m),m.tag){case 1:return c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 3:return hh(ls),Cn(),c=m.flags,(c&65536)!==0&&(c&128)===0?(m.flags=c&-65537|128,m):null;case 26:case 27:case 5:return Ir(m),null;case 31:if(m.memoizedState!==null){if(hl(m),m.alternate===null)throw Error(ce(340));Yc()}return c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 13:if(hl(m),c=m.memoizedState,c!==null&&c.dehydrated!==null){if(m.alternate===null)throw Error(ce(340));Yc()}return c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 19:return jt(Cs),null;case 4:return Cn(),null;case 10:return hh(m.type),null;case 22:case 23:return hl(m),Lo(),c!==null&&jt(A),c=m.flags,c&65536?(m.flags=c&-65537|128,m):null;case 24:return hh(ls),null;case 25:return null;default:return null}}function jp(c,m){switch(lh(m),m.tag){case 3:hh(ls),Cn();break;case 26:case 27:case 5:Ir(m);break;case 4:Cn();break;case 31:m.memoizedState!==null&&hl(m);break;case 13:hl(m);break;case 19:jt(Cs);break;case 10:hh(m.type);break;case 22:case 23:hl(m),Lo(),c!==null&&jt(A);break;case 24:hh(ls)}}function Uf(c,m){try{var w=m.updateQueue,D=w!==null?w.lastEffect:null;if(D!==null){var G=D.next;w=G;do{if((w.tag&c)===c){D=void 0;var W=w.create,ve=w.inst;D=W(),ve.destroy=D}w=w.next}while(w!==G)}}catch(Je){cs(m,m.return,Je)}}function Fc(c,m,w){try{var D=m.updateQueue,G=D!==null?D.lastEffect:null;if(G!==null){var W=G.next;D=W;do{if((D.tag&c)===c){var ve=D.inst,Je=ve.destroy;if(Je!==void 0){ve.destroy=void 0,G=m;var kt=w,Mi=Je;try{Mi()}catch(nn){cs(G,kt,nn)}}}D=D.next}while(D!==W)}}catch(nn){cs(m,m.return,nn)}}function jf(c){var m=c.updateQueue;if(m!==null){var w=c.stateNode;try{Za(m,w)}catch(D){cs(c,c.return,D)}}}function Gf(c,m,w){w.props=Fd(c.type,c.memoizedProps),w.state=c.memoizedState;try{w.componentWillUnmount()}catch(D){cs(c,m,D)}}function Xu(c,m){try{var w=c.ref;if(w!==null){switch(c.tag){case 26:case 27:case 5:var D=c.stateNode;break;case 30:D=c.stateNode;break;default:D=c.stateNode}typeof w=="function"?c.refCleanup=w(D):w.current=D}}catch(G){cs(c,m,G)}}function tc(c,m){var w=c.ref,D=c.refCleanup;if(w!==null)if(typeof D=="function")try{D()}catch(G){cs(c,m,G)}finally{c.refCleanup=null,c=c.alternate,c!=null&&(c.refCleanup=null)}else if(typeof w=="function")try{w(null)}catch(G){cs(c,m,G)}else w.current=null}function xd(c){var m=c.type,w=c.memoizedProps,D=c.stateNode;try{e:switch(m){case"button":case"input":case"select":case"textarea":w.autoFocus&&D.focus();break e;case"img":w.src?D.src=w.src:w.srcSet&&(D.srcset=w.srcSet)}}catch(G){cs(c,c.return,G)}}function vd(c,m,w){try{var D=c.stateNode;_g(D,c.type,w,m),D[pe]=m}catch(G){cs(c,c.return,G)}}function yh(c){return c.tag===5||c.tag===3||c.tag===26||c.tag===27&&Ke(c.type)||c.tag===4}function Tm(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||yh(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.tag===27&&Ke(c.type)||c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function Gp(c,m,w){var D=c.tag;if(D===5||D===6)c=c.stateNode,m?(w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w).insertBefore(c,m):(m=w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w,m.appendChild(c),w=w._reactRootContainer,w!=null||m.onclick!==null||(m.onclick=fo));else if(D!==4&&(D===27&&Ke(c.type)&&(w=c.stateNode,m=null),c=c.child,c!==null))for(Gp(c,m,w),c=c.sibling;c!==null;)Gp(c,m,w),c=c.sibling}function qp(c,m,w){var D=c.tag;if(D===5||D===6)c=c.stateNode,m?w.insertBefore(c,m):w.appendChild(c);else if(D!==4&&(D===27&&Ke(c.type)&&(w=c.stateNode),c=c.child,c!==null))for(qp(c,m,w),c=c.sibling;c!==null;)qp(c,m,w),c=c.sibling}function jm(c){var m=c.stateNode,w=c.memoizedProps;try{for(var D=c.type,G=m.attributes;G.length;)m.removeAttributeNode(G[0]);Tc(m,D,w),m[te]=c,m[pe]=w}catch(W){cs(c,c.return,W)}}var xh=!1,ps=!1,wc=!1,Hp=typeof WeakSet=="function"?WeakSet:Set,Ul=null;function gp(c,m){if(c=c.containerInfo,g=em,c=gl(c),sd(c)){if("selectionStart"in c)var w={start:c.selectionStart,end:c.selectionEnd};else e:{w=(w=c.ownerDocument)&&w.defaultView||window;var D=w.getSelection&&w.getSelection();if(D&&D.rangeCount!==0){w=D.anchorNode;var G=D.anchorOffset,W=D.focusNode;D=D.focusOffset;try{w.nodeType,W.nodeType}catch{w=null;break e}var ve=0,Je=-1,kt=-1,Mi=0,nn=0,hn=c,Li=null;t:for(;;){for(var Ni;hn!==w||G!==0&&hn.nodeType!==3||(Je=ve+G),hn!==W||D!==0&&hn.nodeType!==3||(kt=ve+D),hn.nodeType===3&&(ve+=hn.nodeValue.length),(Ni=hn.firstChild)!==null;)Li=hn,hn=Ni;for(;;){if(hn===c)break t;if(Li===w&&++Mi===G&&(Je=ve),Li===W&&++nn===D&&(kt=ve),(Ni=hn.nextSibling)!==null)break;hn=Li,Li=hn.parentNode}hn=Ni}w=Je===-1||kt===-1?null:{start:Je,end:kt}}else w=null}w=w||{start:0,end:0}}else w=null;for(T={focusedElem:c,selectionRange:w},em=!1,Ul=m;Ul!==null;)if(m=Ul,c=m.child,(m.subtreeFlags&1028)!==0&&c!==null)c.return=m,Ul=c;else for(;Ul!==null;){switch(m=Ul,W=m.alternate,c=m.flags,m.tag){case 0:if((c&4)!==0&&(c=m.updateQueue,c=c!==null?c.events:null,c!==null))for(w=0;w<c.length;w++)G=c[w],G.ref.impl=G.nextImpl;break;case 11:case 15:break;case 1:if((c&1024)!==0&&W!==null){c=void 0,w=m,G=W.memoizedProps,W=W.memoizedState,D=w.stateNode;try{var Fr=Fd(w.type,G);c=D.getSnapshotBeforeUpdate(Fr,W),D.__reactInternalSnapshotBeforeUpdate=c}catch(na){cs(w,w.return,na)}}break;case 3:if((c&1024)!==0){if(c=m.stateNode.containerInfo,w=c.nodeType,w===9)si(c);else if(w===1)switch(c.nodeName){case"HEAD":case"HTML":case"BODY":si(c);break;default:c.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((c&1024)!==0)throw Error(ce(163))}if(c=m.sibling,c!==null){c.return=m.return,Ul=c;break}Ul=m.return}}function Sm(c,m,w){var D=w.flags;switch(w.tag){case 0:case 11:case 15:U(c,w),D&4&&Uf(5,w);break;case 1:if(U(c,w),D&4)if(c=w.stateNode,m===null)try{c.componentDidMount()}catch(ve){cs(w,w.return,ve)}else{var G=Fd(w.type,m.memoizedProps);m=m.memoizedState;try{c.componentDidUpdate(G,m,c.__reactInternalSnapshotBeforeUpdate)}catch(ve){cs(w,w.return,ve)}}D&64&&jf(w),D&512&&Xu(w,w.return);break;case 3:if(U(c,w),D&64&&(c=w.updateQueue,c!==null)){if(m=null,w.child!==null)switch(w.child.tag){case 27:case 5:m=w.child.stateNode;break;case 1:m=w.child.stateNode}try{Za(c,m)}catch(ve){cs(w,w.return,ve)}}break;case 27:m===null&&D&4&&jm(w);case 26:case 5:U(c,w),m===null&&D&4&&xd(w),D&512&&Xu(w,w.return);break;case 12:U(c,w);break;case 31:U(c,w),D&4&&t(c,w);break;case 13:U(c,w),D&4&&a(c,w),D&64&&(c=w.memoizedState,c!==null&&(c=c.dehydrated,c!==null&&(w=h_.bind(null,w),Er(c,w))));break;case 22:if(D=w.memoizedState!==null||xh,!D){m=m!==null&&m.memoizedState!==null||ps,G=xh;var W=ps;xh=D,(ps=m)&&!W?X(c,w,(w.subtreeFlags&8772)!==0):U(c,w),xh=G,ps=W}break;case 30:break;default:U(c,w)}}function Wu(c){var m=c.alternate;m!==null&&(c.alternate=null,Wu(m)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(m=c.stateNode,m!==null&&At(m)),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}var vs=null,wl=!1;function Au(c,m,w){for(w=w.child;w!==null;)h(c,m,w),w=w.sibling}function h(c,m,w){if(tr&&typeof tr.onCommitFiberUnmount=="function")try{tr.onCommitFiberUnmount(Sn,w)}catch{}switch(w.tag){case 26:ps||tc(w,m),Au(c,m,w),w.memoizedState?w.memoizedState.count--:w.stateNode&&(w=w.stateNode,w.parentNode.removeChild(w));break;case 27:ps||tc(w,m);var D=vs,G=wl;Ke(w.type)&&(vs=w.stateNode,wl=!1),Au(c,m,w),Gi(w.stateNode),vs=D,wl=G;break;case 5:ps||tc(w,m);case 6:if(D=vs,G=wl,vs=null,Au(c,m,w),vs=D,wl=G,vs!==null)if(wl)try{(vs.nodeType===9?vs.body:vs.nodeName==="HTML"?vs.ownerDocument.body:vs).removeChild(w.stateNode)}catch(W){cs(w,m,W)}else try{vs.removeChild(w.stateNode)}catch(W){cs(w,m,W)}break;case 18:vs!==null&&(wl?(c=vs,yt(c.nodeType===9?c.body:c.nodeName==="HTML"?c.ownerDocument.body:c,w.stateNode),im(c)):yt(vs,w.stateNode));break;case 4:D=vs,G=wl,vs=w.stateNode.containerInfo,wl=!0,Au(c,m,w),vs=D,wl=G;break;case 0:case 11:case 14:case 15:Fc(2,w,m),ps||Fc(4,w,m),Au(c,m,w);break;case 1:ps||(tc(w,m),D=w.stateNode,typeof D.componentWillUnmount=="function"&&Gf(w,m,D)),Au(c,m,w);break;case 21:Au(c,m,w);break;case 22:ps=(D=ps)||w.memoizedState!==null,Au(c,m,w),ps=D;break;default:Au(c,m,w)}}function t(c,m){if(m.memoizedState===null&&(c=m.alternate,c!==null&&(c=c.memoizedState,c!==null))){c=c.dehydrated;try{im(c)}catch(w){cs(m,m.return,w)}}}function a(c,m){if(m.memoizedState===null&&(c=m.alternate,c!==null&&(c=c.memoizedState,c!==null&&(c=c.dehydrated,c!==null))))try{im(c)}catch(w){cs(m,m.return,w)}}function d(c){switch(c.tag){case 31:case 13:case 19:var m=c.stateNode;return m===null&&(m=c.stateNode=new Hp),m;case 22:return c=c.stateNode,m=c._retryCache,m===null&&(m=c._retryCache=new Hp),m;default:throw Error(ce(435,c.tag))}}function y(c,m){var w=d(c);m.forEach(function(D){if(!w.has(D)){w.add(D);var G=qm.bind(null,c,D);D.then(G,G)}})}function b(c,m){var w=m.deletions;if(w!==null)for(var D=0;D<w.length;D++){var G=w[D],W=c,ve=m,Je=ve;e:for(;Je!==null;){switch(Je.tag){case 27:if(Ke(Je.type)){vs=Je.stateNode,wl=!1;break e}break;case 5:vs=Je.stateNode,wl=!1;break e;case 3:case 4:vs=Je.stateNode.containerInfo,wl=!0;break e}Je=Je.return}if(vs===null)throw Error(ce(160));h(W,ve,G),vs=null,wl=!1,W=G.alternate,W!==null&&(W.return=null),G.return=null}if(m.subtreeFlags&13886)for(m=m.child;m!==null;)M(m,c),m=m.sibling}var S=null;function M(c,m){var w=c.alternate,D=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:b(m,c),R(c),D&4&&(Fc(3,c,c.return),Uf(3,c),Fc(5,c,c.return));break;case 1:b(m,c),R(c),D&512&&(ps||w===null||tc(w,w.return)),D&64&&xh&&(c=c.updateQueue,c!==null&&(D=c.callbacks,D!==null&&(w=c.shared.hiddenCallbacks,c.shared.hiddenCallbacks=w===null?D:w.concat(D))));break;case 26:var G=S;if(b(m,c),R(c),D&512&&(ps||w===null||tc(w,w.return)),D&4){var W=w!==null?w.memoizedState:null;if(D=c.memoizedState,w===null)if(D===null)if(c.stateNode===null){e:{D=c.type,w=c.memoizedProps,G=G.ownerDocument||G;t:switch(D){case"title":W=G.getElementsByTagName("title")[0],(!W||W[ot]||W[te]||W.namespaceURI==="http://www.w3.org/2000/svg"||W.hasAttribute("itemprop"))&&(W=G.createElement(D),G.head.insertBefore(W,G.querySelector("head > title"))),Tc(W,D,w),W[te]=c,Bi(W),D=W;break e;case"link":var ve=Th("link","href",G).get(D+(w.href||""));if(ve){for(var Je=0;Je<ve.length;Je++)if(W=ve[Je],W.getAttribute("href")===(w.href==null||w.href===""?null:w.href)&&W.getAttribute("rel")===(w.rel==null?null:w.rel)&&W.getAttribute("title")===(w.title==null?null:w.title)&&W.getAttribute("crossorigin")===(w.crossOrigin==null?null:w.crossOrigin)){ve.splice(Je,1);break t}}W=G.createElement(D),Tc(W,D,w),G.head.appendChild(W);break;case"meta":if(ve=Th("meta","content",G).get(D+(w.content||""))){for(Je=0;Je<ve.length;Je++)if(W=ve[Je],W.getAttribute("content")===(w.content==null?null:""+w.content)&&W.getAttribute("name")===(w.name==null?null:w.name)&&W.getAttribute("property")===(w.property==null?null:w.property)&&W.getAttribute("http-equiv")===(w.httpEquiv==null?null:w.httpEquiv)&&W.getAttribute("charset")===(w.charSet==null?null:w.charSet)){ve.splice(Je,1);break t}}W=G.createElement(D),Tc(W,D,w),G.head.appendChild(W);break;default:throw Error(ce(468,D))}W[te]=c,Bi(W),D=W}c.stateNode=D}else Sh(G,c.type,c.stateNode);else c.stateNode=vo(G,D,c.memoizedProps);else W!==D?(W===null?w.stateNode!==null&&(w=w.stateNode,w.parentNode.removeChild(w)):W.count--,D===null?Sh(G,c.type,c.stateNode):vo(G,D,c.memoizedProps)):D===null&&c.stateNode!==null&&vd(c,c.memoizedProps,w.memoizedProps)}break;case 27:b(m,c),R(c),D&512&&(ps||w===null||tc(w,w.return)),w!==null&&D&4&&vd(c,c.memoizedProps,w.memoizedProps);break;case 5:if(b(m,c),R(c),D&512&&(ps||w===null||tc(w,w.return)),c.flags&32){G=c.stateNode;try{ou(G,"")}catch(Fr){cs(c,c.return,Fr)}}D&4&&c.stateNode!=null&&(G=c.memoizedProps,vd(c,G,w!==null?w.memoizedProps:G)),D&1024&&(wc=!0);break;case 6:if(b(m,c),R(c),D&4){if(c.stateNode===null)throw Error(ce(162));D=c.memoizedProps,w=c.stateNode;try{w.nodeValue=D}catch(Fr){cs(c,c.return,Fr)}}break;case 3:if(eh=null,G=S,S=ia(m.containerInfo),b(m,c),S=G,R(c),D&4&&w!==null&&w.memoizedState.isDehydrated)try{im(m.containerInfo)}catch(Fr){cs(c,c.return,Fr)}wc&&(wc=!1,N(c));break;case 4:D=S,S=ia(c.stateNode.containerInfo),b(m,c),R(c),S=D;break;case 12:b(m,c),R(c);break;case 31:b(m,c),R(c),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,y(c,D)));break;case 13:b(m,c),R(c),c.child.flags&8192&&c.memoizedState!==null!=(w!==null&&w.memoizedState!==null)&&(Br=la()),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,y(c,D)));break;case 22:G=c.memoizedState!==null;var kt=w!==null&&w.memoizedState!==null,Mi=xh,nn=ps;if(xh=Mi||G,ps=nn||kt,b(m,c),ps=nn,xh=Mi,R(c),D&8192)e:for(m=c.stateNode,m._visibility=G?m._visibility&-2:m._visibility|1,G&&(w===null||kt||xh||ps||Y(c)),w=null,m=c;;){if(m.tag===5||m.tag===26){if(w===null){kt=w=m;try{if(W=kt.stateNode,G)ve=W.style,typeof ve.setProperty=="function"?ve.setProperty("display","none","important"):ve.display="none";else{Je=kt.stateNode;var hn=kt.memoizedProps.style,Li=hn!=null&&hn.hasOwnProperty("display")?hn.display:null;Je.style.display=Li==null||typeof Li=="boolean"?"":(""+Li).trim()}}catch(Fr){cs(kt,kt.return,Fr)}}}else if(m.tag===6){if(w===null){kt=m;try{kt.stateNode.nodeValue=G?"":kt.memoizedProps}catch(Fr){cs(kt,kt.return,Fr)}}}else if(m.tag===18){if(w===null){kt=m;try{var Ni=kt.stateNode;G?Mt(Ni,!0):Mt(kt.stateNode,!1)}catch(Fr){cs(kt,kt.return,Fr)}}}else if((m.tag!==22&&m.tag!==23||m.memoizedState===null||m===c)&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===c)break e;for(;m.sibling===null;){if(m.return===null||m.return===c)break e;w===m&&(w=null),m=m.return}w===m&&(w=null),m.sibling.return=m.return,m=m.sibling}D&4&&(D=c.updateQueue,D!==null&&(w=D.retryQueue,w!==null&&(D.retryQueue=null,y(c,w))));break;case 19:b(m,c),R(c),D&4&&(D=c.updateQueue,D!==null&&(c.updateQueue=null,y(c,D)));break;case 30:break;case 21:break;default:b(m,c),R(c)}}function R(c){var m=c.flags;if(m&2){try{for(var w,D=c.return;D!==null;){if(yh(D)){w=D;break}D=D.return}if(w==null)throw Error(ce(160));switch(w.tag){case 27:var G=w.stateNode,W=Tm(c);qp(c,W,G);break;case 5:var ve=w.stateNode;w.flags&32&&(ou(ve,""),w.flags&=-33);var Je=Tm(c);qp(c,Je,ve);break;case 3:case 4:var kt=w.stateNode.containerInfo,Mi=Tm(c);Gp(c,Mi,kt);break;default:throw Error(ce(161))}}catch(nn){cs(c,c.return,nn)}c.flags&=-3}m&4096&&(c.flags&=-4097)}function N(c){if(c.subtreeFlags&1024)for(c=c.child;c!==null;){var m=c;N(m),m.tag===5&&m.flags&1024&&m.stateNode.reset(),c=c.sibling}}function U(c,m){if(m.subtreeFlags&8772)for(m=m.child;m!==null;)Sm(c,m.alternate,m),m=m.sibling}function Y(c){for(c=c.child;c!==null;){var m=c;switch(m.tag){case 0:case 11:case 14:case 15:Fc(4,m,m.return),Y(m);break;case 1:tc(m,m.return);var w=m.stateNode;typeof w.componentWillUnmount=="function"&&Gf(m,m.return,w),Y(m);break;case 27:Gi(m.stateNode);case 26:case 5:tc(m,m.return),Y(m);break;case 22:m.memoizedState===null&&Y(m);break;case 30:Y(m);break;default:Y(m)}c=c.sibling}}function X(c,m,w){for(w=w&&(m.subtreeFlags&8772)!==0,m=m.child;m!==null;){var D=m.alternate,G=c,W=m,ve=W.flags;switch(W.tag){case 0:case 11:case 15:X(G,W,w),Uf(4,W);break;case 1:if(X(G,W,w),D=W,G=D.stateNode,typeof G.componentDidMount=="function")try{G.componentDidMount()}catch(Mi){cs(D,D.return,Mi)}if(D=W,G=D.updateQueue,G!==null){var Je=D.stateNode;try{var kt=G.shared.hiddenCallbacks;if(kt!==null)for(G.shared.hiddenCallbacks=null,G=0;G<kt.length;G++)Ma(kt[G],Je)}catch(Mi){cs(D,D.return,Mi)}}w&&ve&64&&jf(W),Xu(W,W.return);break;case 27:jm(W);case 26:case 5:X(G,W,w),w&&D===null&&ve&4&&xd(W),Xu(W,W.return);break;case 12:X(G,W,w);break;case 31:X(G,W,w),w&&ve&4&&t(G,W);break;case 13:X(G,W,w),w&&ve&4&&a(G,W);break;case 22:W.memoizedState===null&&X(G,W,w),Xu(W,W.return);break;case 30:break;default:X(G,W,w)}m=m.sibling}}function Q(c,m){var w=null;c!==null&&c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(w=c.memoizedState.cachePool.pool),c=null,m.memoizedState!==null&&m.memoizedState.cachePool!==null&&(c=m.memoizedState.cachePool.pool),c!==w&&(c!=null&&c.refCount++,w!=null&&Kc(w))}function ae(c,m){c=null,m.alternate!==null&&(c=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==c&&(m.refCount++,c!=null&&Kc(c))}function ie(c,m,w,D){if(m.subtreeFlags&10256)for(m=m.child;m!==null;)_e(c,m,w,D),m=m.sibling}function _e(c,m,w,D){var G=m.flags;switch(m.tag){case 0:case 11:case 15:ie(c,m,w,D),G&2048&&Uf(9,m);break;case 1:ie(c,m,w,D);break;case 3:ie(c,m,w,D),G&2048&&(c=null,m.alternate!==null&&(c=m.alternate.memoizedState.cache),m=m.memoizedState.cache,m!==c&&(m.refCount++,c!=null&&Kc(c)));break;case 12:if(G&2048){ie(c,m,w,D),c=m.stateNode;try{var W=m.memoizedProps,ve=W.id,Je=W.onPostCommit;typeof Je=="function"&&Je(ve,m.alternate===null?"mount":"update",c.passiveEffectDuration,-0)}catch(kt){cs(m,m.return,kt)}}else ie(c,m,w,D);break;case 31:ie(c,m,w,D);break;case 13:ie(c,m,w,D);break;case 23:break;case 22:W=m.stateNode,ve=m.alternate,m.memoizedState!==null?W._visibility&2?ie(c,m,w,D):Te(c,m):W._visibility&2?ie(c,m,w,D):(W._visibility|=2,fe(c,m,w,D,(m.subtreeFlags&10256)!==0||!1)),G&2048&&Q(ve,m);break;case 24:ie(c,m,w,D),G&2048&&ae(m.alternate,m);break;default:ie(c,m,w,D)}}function fe(c,m,w,D,G){for(G=G&&((m.subtreeFlags&10256)!==0||!1),m=m.child;m!==null;){var W=c,ve=m,Je=w,kt=D,Mi=ve.flags;switch(ve.tag){case 0:case 11:case 15:fe(W,ve,Je,kt,G),Uf(8,ve);break;case 23:break;case 22:var nn=ve.stateNode;ve.memoizedState!==null?nn._visibility&2?fe(W,ve,Je,kt,G):Te(W,ve):(nn._visibility|=2,fe(W,ve,Je,kt,G)),G&&Mi&2048&&Q(ve.alternate,ve);break;case 24:fe(W,ve,Je,kt,G),G&&Mi&2048&&ae(ve.alternate,ve);break;default:fe(W,ve,Je,kt,G)}m=m.sibling}}function Te(c,m){if(m.subtreeFlags&10256)for(m=m.child;m!==null;){var w=c,D=m,G=D.flags;switch(D.tag){case 22:Te(w,D),G&2048&&Q(D.alternate,D);break;case 24:Te(w,D),G&2048&&ae(D.alternate,D);break;default:Te(w,D)}m=m.sibling}}var De=8192;function Se(c,m,w){if(c.subtreeFlags&De)for(c=c.child;c!==null;)Ze(c,m,w),c=c.sibling}function Ze(c,m,w){switch(c.tag){case 26:Se(c,m,w),c.flags&De&&c.memoizedState!==null&&Sf(w,S,c.memoizedState,c.memoizedProps);break;case 5:Se(c,m,w);break;case 3:case 4:var D=S;S=ia(c.stateNode.containerInfo),Se(c,m,w),S=D;break;case 22:c.memoizedState===null&&(D=c.alternate,D!==null&&D.memoizedState!==null?(D=De,De=16777216,Se(c,m,w),De=D):Se(c,m,w));break;default:Se(c,m,w)}}function Ve(c){var m=c.alternate;if(m!==null&&(c=m.child,c!==null)){m.child=null;do m=c.sibling,c.sibling=null,c=m;while(c!==null)}}function Ge(c){var m=c.deletions;if((c.flags&16)!==0){if(m!==null)for(var w=0;w<m.length;w++){var D=m[w];Ul=D,it(D,c)}Ve(c)}if(c.subtreeFlags&10256)for(c=c.child;c!==null;)Fe(c),c=c.sibling}function Fe(c){switch(c.tag){case 0:case 11:case 15:Ge(c),c.flags&2048&&Fc(9,c,c.return);break;case 3:Ge(c);break;case 12:Ge(c);break;case 22:var m=c.stateNode;c.memoizedState!==null&&m._visibility&2&&(c.return===null||c.return.tag!==13)?(m._visibility&=-3,Oe(c)):Ge(c);break;default:Ge(c)}}function Oe(c){var m=c.deletions;if((c.flags&16)!==0){if(m!==null)for(var w=0;w<m.length;w++){var D=m[w];Ul=D,it(D,c)}Ve(c)}for(c=c.child;c!==null;){switch(m=c,m.tag){case 0:case 11:case 15:Fc(8,m,m.return),Oe(m);break;case 22:w=m.stateNode,w._visibility&2&&(w._visibility&=-3,Oe(m));break;default:Oe(m)}c=c.sibling}}function it(c,m){for(;Ul!==null;){var w=Ul;switch(w.tag){case 0:case 11:case 15:Fc(8,w,m);break;case 23:case 22:if(w.memoizedState!==null&&w.memoizedState.cachePool!==null){var D=w.memoizedState.cachePool.pool;D!=null&&D.refCount++}break;case 24:Kc(w.memoizedState.cache)}if(D=w.child,D!==null)D.return=w,Ul=D;else e:for(w=c;Ul!==null;){D=Ul;var G=D.sibling,W=D.return;if(Wu(D),D===w){Ul=null;break e}if(G!==null){G.return=W,Ul=G;break e}Ul=W}}}var ft={getCacheForType:function(c){var m=ka(ls),w=m.data.get(c);return w===void 0&&(w=c(),m.data.set(c,w)),w},cacheSignal:function(){return ka(ls).controller.signal}},ht=typeof WeakMap=="function"?WeakMap:Map,St=0,It=null,zt=null,Jt=0,gt=0,nt=null,Bt=!1,Dt=!1,li=!1,Ei=0,Ri=0,Ti=0,mi=0,pn=0,en=0,ji=0,Qi=null,vn=null,rr=!1,Br=0,ba=0,_n=1/0,aa=null,Qn=null,yr=0,Gr=null,Kr=null,qr=0,mr=0,wa=null,Bs=null,Ga=0,ya=null;function Sr(){return(St&2)!==0&&Jt!==0?Jt&-Jt:ui.T!==null?Xp():hr()}function gr(){if(en===0)if((Jt&536870912)===0||fn){var c=lc;lc<<=1,(lc&3932160)===0&&(lc=262144),en=c}else en=536870912;return c=Os.current,c!==null&&(c.flags|=32),en}function fa(c,m,w){(c===It&&(gt===2||gt===9)||c.cancelPendingCommit!==null)&&(Ho(c,0),Bo(c,Jt,en,!1)),je(c,w),((St&2)===0||c!==It)&&(c===It&&((St&2)===0&&(mi|=w),Ri===4&&Bo(c,Jt,en,!1)),tu(c))}function bs(c,m,w){if((St&6)!==0)throw Error(ce(327));var D=!w&&(m&127)===0&&(m&c.expiredLanes)===0||Re(c,m),G=D?Na(c,m):Fs(c,m,!0),W=D;do{if(G===0){Dt&&!D&&Bo(c,m,0,!1);break}else{if(w=c.current.alternate,W&&!qa(w)){G=Fs(c,m,!1),W=!1;continue}if(G===2){if(W=m,c.errorRecoveryDisabledLanes&W)var ve=0;else ve=c.pendingLanes&-536870913,ve=ve!==0?ve:ve&536870912?536870912:0;if(ve!==0){m=ve;e:{var Je=c;G=Qi;var kt=Je.current.memoizedState.isDehydrated;if(kt&&(Ho(Je,ve).flags|=256),ve=Fs(Je,ve,!1),ve!==2){if(li&&!kt){Je.errorRecoveryDisabledLanes|=W,mi|=W,G=4;break e}W=vn,vn=G,W!==null&&(vn===null?vn=W:vn.push.apply(vn,W))}G=ve}if(W=!1,G!==2)continue}}if(G===1){Ho(c,0),Bo(c,m,0,!0);break}e:{switch(D=c,W=G,W){case 0:case 1:throw Error(ce(345));case 4:if((m&4194048)!==m)break;case 6:Bo(D,m,en,!Bt);break e;case 2:vn=null;break;case 3:case 5:break;default:throw Error(ce(329))}if((m&62914560)===m&&(G=Br+300-la(),10<G)){if(Bo(D,m,en,!Bt),Ce(D,0,!0)!==0)break e;qr=m,D.timeoutHandle=de(ws.bind(null,D,w,vn,aa,rr,m,en,mi,ji,Bt,W,"Throttled",-0,0),G);break e}ws(D,w,vn,aa,rr,m,en,mi,ji,Bt,W,null,-0,0)}}break}while(!0);tu(c)}function ws(c,m,w,D,G,W,ve,Je,kt,Mi,nn,hn,Li,Ni){if(c.timeoutHandle=-1,hn=m.subtreeFlags,hn&8192||(hn&16785408)===16785408){hn={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:fo},Ze(m,W,hn);var Fr=(W&62914560)===W?Br-la():(W&4194048)===W?ba-la():0;if(Fr=z_(hn,Fr),Fr!==null){qr=W,c.cancelPendingCommit=Fr(vf.bind(null,c,m,W,w,D,G,ve,Je,kt,nn,hn,null,Li,Ni)),Bo(c,W,ve,!Mi);return}}vf(c,m,W,w,D,G,ve,Je,kt)}function qa(c){for(var m=c;;){var w=m.tag;if((w===0||w===11||w===15)&&m.flags&16384&&(w=m.updateQueue,w!==null&&(w=w.stores,w!==null)))for(var D=0;D<w.length;D++){var G=w[D],W=G.getSnapshot;G=G.value;try{if(!ds(W(),G))return!1}catch{return!1}}if(w=m.child,m.subtreeFlags&16384&&w!==null)w.return=m,m=w;else{if(m===c)break;for(;m.sibling===null;){if(m.return===null||m.return===c)return!0;m=m.return}m.sibling.return=m.return,m=m.sibling}}return!0}function Bo(c,m,w,D){m&=~pn,m&=~mi,c.suspendedLanes|=m,c.pingedLanes&=~m,D&&(c.warmLanes|=m),D=c.expirationTimes;for(var G=m;0<G;){var W=31-Hs(G),ve=1<<W;D[W]=-1,G&=~ve}w!==0&&Pt(c,w,m)}function Qo(){return(St&6)===0?(Zp(0),!1):!0}function oo(){if(zt!==null){if(gt===0)var c=zt.return;else c=zt,Uu=Fl=null,dh(c),Ct=null,Lt=0,c=zt;for(;c!==null;)jp(c.alternate,c),c=c.return;zt=null}}function Ho(c,m){var w=c.timeoutHandle;w!==-1&&(c.timeoutHandle=-1,ye(w)),w=c.cancelPendingCommit,w!==null&&(c.cancelPendingCommit=null,w()),qr=0,oo(),It=c,zt=w=vl(c.current,null),Jt=m,gt=0,nt=null,Bt=!1,Dt=Re(c,m),li=!1,ji=en=pn=mi=Ti=Ri=0,vn=Qi=null,rr=!1,(m&8)!==0&&(m|=m&32);var D=c.entangledLanes;if(D!==0)for(c=c.entanglements,D&=m;0<D;){var G=31-Hs(D),W=1<<G;m|=c[G],D&=~W}return Ei=m,Ol(),w}function jl(c,m){di=null,ui.H=pf,m===K||m===he?(m=vt(),gt=3):m===ne?(m=vt(),gt=4):gt=m===yo?8:m!==null&&typeof m=="object"&&typeof m.then=="function"?6:1,nt=m,zt===null&&(Ri=1,dp(c,Zo(m,c.current)))}function fl(){var c=Os.current;return c===null?!0:(Jt&4194048)===Jt?Ms===null:(Jt&62914560)===Jt||(Jt&536870912)!==0?c===Ms:!1}function eu(){var c=ui.H;return ui.H=pf,c===null?pf:c}function Yu(){var c=ui.A;return ui.A=ft,c}function ic(){Ri=4,Bt||(Jt&4194048)!==Jt&&Os.current!==null||(Dt=!0),(Ti&134217727)===0&&(mi&134217727)===0||It===null||Bo(It,Jt,en,!1)}function Fs(c,m,w){var D=St;St|=2;var G=eu(),W=Yu();(It!==c||Jt!==m)&&(aa=null,Ho(c,m)),m=!1;var ve=Ri;e:do try{if(gt!==0&&zt!==null){var Je=zt,kt=nt;switch(gt){case 8:oo(),ve=6;break e;case 3:case 2:case 9:case 6:Os.current===null&&(m=!0);var Mi=gt;if(gt=0,nt=null,nc(c,Je,kt,Mi),w&&Dt){ve=0;break e}break;default:Mi=gt,gt=0,nt=null,nc(c,Je,kt,Mi)}}lo(),ve=Ri;break}catch(nn){jl(c,nn)}while(!0);return m&&c.shellSuspendCounter++,Uu=Fl=null,St=D,ui.H=G,ui.A=W,zt===null&&(It=null,Jt=0,Ol()),ve}function lo(){for(;zt!==null;)zs(zt)}function Na(c,m){var w=St;St|=2;var D=eu(),G=Yu();It!==c||Jt!==m?(aa=null,_n=la()+500,Ho(c,m)):Dt=Re(c,m);e:do try{if(gt!==0&&zt!==null){m=zt;var W=nt;t:switch(gt){case 1:gt=0,nt=null,nc(c,m,W,1);break;case 2:case 9:if(we(W)){gt=0,nt=null,Ts(m);break}m=function(){gt!==2&&gt!==9||It!==c||(gt=7),tu(c)},W.then(m,m);break e;case 3:gt=7;break e;case 4:gt=5;break e;case 7:we(W)?(gt=0,nt=null,Ts(m)):(gt=0,nt=null,nc(c,m,W,7));break;case 5:var ve=null;switch(zt.tag){case 26:ve=zt.memoizedState;case 5:case 27:var Je=zt;if(ve?Al(ve):Je.stateNode.complete){gt=0,nt=null;var kt=Je.sibling;if(kt!==null)zt=kt;else{var Mi=Je.return;Mi!==null?(zt=Mi,Ud(Mi)):zt=null}break t}}gt=0,nt=null,nc(c,m,W,5);break;case 6:gt=0,nt=null,nc(c,m,W,6);break;case 8:oo(),Ri=6;break e;default:throw Error(ce(462))}}Ns();break}catch(nn){jl(c,nn)}while(!0);return Uu=Fl=null,ui.H=D,ui.A=G,St=w,zt!==null?0:(It=null,Jt=0,Ol(),Ri)}function Ns(){for(;zt!==null&&!ho();)zs(zt)}function zs(c){var m=Oo(c.alternate,c,Ei);c.memoizedProps=c.pendingProps,m===null?Ud(c):zt=m}function Ts(c){var m=c,w=m.alternate;switch(m.tag){case 15:case 0:m=pp(w,m,m.pendingProps,m.type,void 0,Jt);break;case 11:m=pp(w,m,m.pendingProps,m.type.render,m.ref,Jt);break;case 5:dh(m);default:jp(w,m),m=zt=Nu(m,Ei),m=Oo(w,m,Ei)}c.memoizedProps=c.pendingProps,m===null?Ud(c):zt=m}function nc(c,m,w,D){Uu=Fl=null,dh(m),Ct=null,Lt=0;var G=m.return;try{if(Fm(c,G,m,w,Jt)){Ri=1,dp(c,Zo(w,c.current)),zt=null;return}}catch(W){if(G!==null)throw zt=G,W;Ri=1,dp(c,Zo(w,c.current)),zt=null;return}m.flags&32768?(fn||D===1?c=!0:Dt||(Jt&536870912)!==0?c=!1:(Bt=c=!0,(D===2||D===9||D===3||D===6)&&(D=Os.current,D!==null&&D.tag===13&&(D.flags|=16384))),Ku(m,c)):Ud(m)}function Ud(c){var m=c;do{if((m.flags&32768)!==0){Ku(m,Bt);return}c=m.return;var w=wm(m.alternate,m,Ei);if(w!==null){zt=w;return}if(m=m.sibling,m!==null){zt=m;return}zt=m=c}while(m!==null);Ri===0&&(Ri=5)}function Ku(c,m){do{var w=u_(c.alternate,c);if(w!==null){w.flags&=32767,zt=w;return}if(w=c.return,w!==null&&(w.flags|=32768,w.subtreeFlags=0,w.deletions=null),!m&&(c=c.sibling,c!==null)){zt=c;return}zt=c=w}while(c!==null);Ri=6,zt=null}function vf(c,m,w,D,G,W,ve,Je,kt){c.cancelPendingCommit=null;do el();while(yr!==0);if((St&6)!==0)throw Error(ce(327));if(m!==null){if(m===c.current)throw Error(ce(177));if(W=m.lanes|m.childLanes,W|=os,ei(c,w,W,ve,Je,kt),c===It&&(zt=It=null,Jt=0),Kr=m,Gr=c,qr=w,mr=W,wa=G,Bs=D,(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?(c.callbackNode=null,c.callbackPriority=0,Hm(cn,function(){return Iu(),null})):(c.callbackNode=null,c.callbackPriority=0),D=(m.flags&13878)!==0,(m.subtreeFlags&13878)!==0||D){D=ui.T,ui.T=null,G=Si.p,Si.p=2,ve=St,St|=4;try{gp(c,m,w)}finally{St=ve,Si.p=G,ui.T=D}}yr=1,Wh(),vh(),bh()}}function Wh(){if(yr===1){yr=0;var c=Gr,m=Kr,w=(m.flags&13878)!==0;if((m.subtreeFlags&13878)!==0||w){w=ui.T,ui.T=null;var D=Si.p;Si.p=2;var G=St;St|=4;try{M(m,c);var W=T,ve=gl(c.containerInfo),Je=W.focusedElem,kt=W.selectionRange;if(ve!==Je&&Je&&Je.ownerDocument&&sh(Je.ownerDocument.documentElement,Je)){if(kt!==null&&sd(Je)){var Mi=kt.start,nn=kt.end;if(nn===void 0&&(nn=Mi),"selectionStart"in Je)Je.selectionStart=Mi,Je.selectionEnd=Math.min(nn,Je.value.length);else{var hn=Je.ownerDocument||document,Li=hn&&hn.defaultView||window;if(Li.getSelection){var Ni=Li.getSelection(),Fr=Je.textContent.length,na=Math.min(kt.start,Fr),co=kt.end===void 0?na:Math.min(kt.end,Fr);!Ni.extend&&na>co&&(ve=co,co=na,na=ve);var ci=Qf(Je,na),Kt=Qf(Je,co);if(ci&&Kt&&(Ni.rangeCount!==1||Ni.anchorNode!==ci.node||Ni.anchorOffset!==ci.offset||Ni.focusNode!==Kt.node||Ni.focusOffset!==Kt.offset)){var Ai=hn.createRange();Ai.setStart(ci.node,ci.offset),Ni.removeAllRanges(),na>co?(Ni.addRange(Ai),Ni.extend(Kt.node,Kt.offset)):(Ai.setEnd(Kt.node,Kt.offset),Ni.addRange(Ai))}}}}for(hn=[],Ni=Je;Ni=Ni.parentNode;)Ni.nodeType===1&&hn.push({element:Ni,left:Ni.scrollLeft,top:Ni.scrollTop});for(typeof Je.focus=="function"&&Je.focus(),Je=0;Je<hn.length;Je++){var un=hn[Je];un.element.scrollLeft=un.left,un.element.scrollTop=un.top}}em=!!g,T=g=null}finally{St=G,Si.p=D,ui.T=w}}c.current=m,yr=2}}function vh(){if(yr===2){yr=0;var c=Gr,m=Kr,w=(m.flags&8772)!==0;if((m.subtreeFlags&8772)!==0||w){w=ui.T,ui.T=null;var D=Si.p;Si.p=2;var G=St;St|=4;try{Sm(c,m.alternate,m)}finally{St=G,Si.p=D,ui.T=w}}yr=3}}function bh(){if(yr===4||yr===3){yr=0,Vo();var c=Gr,m=Kr,w=qr,D=Bs;(m.subtreeFlags&10256)!==0||(m.flags&10256)!==0?yr=5:(yr=0,Kr=Gr=null,bf(c,c.pendingLanes));var G=c.pendingLanes;if(G===0&&(Qn=null),kn(w),m=m.stateNode,tr&&typeof tr.onCommitFiberRoot=="function")try{tr.onCommitFiberRoot(Sn,m,void 0,(m.current.flags&128)===128)}catch{}if(D!==null){m=ui.T,G=Si.p,Si.p=2,ui.T=null;try{for(var W=c.onRecoverableError,ve=0;ve<D.length;ve++){var Je=D[ve];W(Je.value,{componentStack:Je.stack})}}finally{ui.T=m,Si.p=G}}(qr&3)!==0&&el(),tu(c),G=c.pendingLanes,(w&261930)!==0&&(G&42)!==0?c===ya?Ga++:(Ga=0,ya=c):Ga=0,Zp(0)}}function bf(c,m){(c.pooledCacheLanes&=m)===0&&(m=c.pooledCache,m!=null&&(c.pooledCache=null,Kc(m)))}function el(){return Wh(),vh(),bh(),Iu()}function Iu(){if(yr!==5)return!1;var c=Gr,m=mr;mr=0;var w=kn(qr),D=ui.T,G=Si.p;try{Si.p=32>w?32:w,ui.T=null,w=wa,wa=null;var W=Gr,ve=qr;if(yr=0,Kr=Gr=null,qr=0,(St&6)!==0)throw Error(ce(331));var Je=St;if(St|=4,Fe(W.current),_e(W,W.current,ve,w),St=Je,Zp(0,!1),tr&&typeof tr.onPostCommitFiberRoot=="function")try{tr.onPostCommitFiberRoot(Sn,W)}catch{}return!0}finally{Si.p=G,ui.T=D,bf(c,m)}}function Ju(c,m,w){m=Zo(w,m),m=Su(c.stateNode,m,2),c=ir(c,m,2),c!==null&&(je(c,2),tu(c))}function cs(c,m,w){if(c.tag===3)Ju(c,c,w);else for(;m!==null;){if(m.tag===3){Ju(m,c,w);break}else if(m.tag===1){var D=m.stateNode;if(typeof m.type.getDerivedStateFromError=="function"||typeof D.componentDidCatch=="function"&&(Qn===null||!Qn.has(D))){c=Zo(w,c),w=Bc(2),D=ir(m,w,2),D!==null&&(Eu(w,D,m,c),je(D,2),tu(D));break}}m=m.return}}function Gm(c,m,w){var D=c.pingCache;if(D===null){D=c.pingCache=new ht;var G=new Set;D.set(m,G)}else G=D.get(m),G===void 0&&(G=new Set,D.set(m,G));G.has(w)||(li=!0,G.add(w),c=A_.bind(null,c,m,w),m.then(c,c))}function A_(c,m,w){var D=c.pingCache;D!==null&&D.delete(m),c.pingedLanes|=c.suspendedLanes&w,c.warmLanes&=~w,It===c&&(Jt&w)===w&&(Ri===4||Ri===3&&(Jt&62914560)===Jt&&300>la()-Br?(St&2)===0&&Ho(c,0):pn|=w,ji===Jt&&(ji=0)),tu(c)}function Em(c,m){m===0&&(m=mt()),c=gu(c,m),c!==null&&(je(c,m),tu(c))}function h_(c){var m=c.memoizedState,w=0;m!==null&&(w=m.retryLane),Em(c,w)}function qm(c,m){var w=0;switch(c.tag){case 31:case 13:var D=c.stateNode,G=c.memoizedState;G!==null&&(w=G.retryLane);break;case 19:D=c.stateNode;break;case 22:D=c.stateNode._retryCache;break;default:throw Error(ce(314))}D!==null&&D.delete(m),Em(c,w)}function Hm(c,m){return ma(c,m)}var bd=null,wf=null,Am=!1,$p=!1,$m=!1,qf=0;function tu(c){c!==wf&&c.next===null&&(wf===null?bd=wf=c:wf=wf.next=c),$p=!0,Am||(Am=!0,Wm())}function Zp(c,m){if(!$m&&$p){$m=!0;do for(var w=!1,D=bd;D!==null;){if(c!==0){var G=D.pendingLanes;if(G===0)var W=0;else{var ve=D.suspendedLanes,Je=D.pingedLanes;W=(1<<31-Hs(42|c)+1)-1,W&=G&~(ve&~Je),W=W&201326741?W&201326741|1:W?W|2:0}W!==0&&(w=!0,Xm(D,W))}else W=Jt,W=Ce(D,D===It?W:0,D.cancelPendingCommit!==null||D.timeoutHandle!==-1),(W&3)===0||Re(D,W)||(w=!0,Xm(D,W));D=D.next}while(w);$m=!1}}function yp(){d_()}function d_(){$p=Am=!1;var c=0;qf!==0&&re()&&(c=qf);for(var m=la(),w=null,D=bd;D!==null;){var G=D.next,W=Zm(D,m);W===0?(D.next=null,w===null?bd=G:w.next=G,G===null&&(wf=w)):(w=D,(c!==0||(W&3)!==0)&&($p=!0)),D=G}yr!==0&&yr!==5||Zp(c),qf!==0&&(qf=0)}function Zm(c,m){for(var w=c.suspendedLanes,D=c.pingedLanes,G=c.expirationTimes,W=c.pendingLanes&-62914561;0<W;){var ve=31-Hs(W),Je=1<<ve,kt=G[ve];kt===-1?((Je&w)===0||(Je&D)!==0)&&(G[ve]=Qe(Je,m)):kt<=m&&(c.expiredLanes|=Je),W&=~Je}if(m=It,w=Jt,w=Ce(c,c===m?w:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),D=c.callbackNode,w===0||c===m&&(gt===2||gt===9)||c.cancelPendingCommit!==null)return D!==null&&D!==null&&rl(D),c.callbackNode=null,c.callbackPriority=0;if((w&3)===0||Re(c,w)){if(m=w&-w,m===c.callbackPriority)return m;switch(D!==null&&rl(D),kn(w)){case 2:case 8:w=Us;break;case 32:w=cn;break;case 268435456:w=To;break;default:w=cn}return D=I_.bind(null,c),w=ma(w,D),c.callbackPriority=m,c.callbackNode=w,m}return D!==null&&D!==null&&rl(D),c.callbackPriority=2,c.callbackNode=null,2}function I_(c,m){if(yr!==0&&yr!==5)return c.callbackNode=null,c.callbackPriority=0,null;var w=c.callbackNode;if(el()&&c.callbackNode!==w)return null;var D=Jt;return D=Ce(c,c===It?D:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),D===0?null:(bs(c,D,m),Zm(c,la()),c.callbackNode!=null&&c.callbackNode===w?I_.bind(null,c):null)}function Xm(c,m){if(el())return null;bs(c,m,!0)}function Wm(){Le(function(){(St&6)!==0?ma(qs,yp):d_()})}function Xp(){if(qf===0){var c=vu;c===0&&(c=Uo,Uo<<=1,(Uo&261888)===0&&(Uo=256)),qf=c}return qf}function $_(c){return c==null||typeof c=="symbol"||typeof c=="boolean"?null:typeof c=="function"?c:Cc(""+c)}function M_(c,m){var w=m.ownerDocument.createElement("input");return w.name=m.name,w.value=m.value,c.id&&w.setAttribute("form",c.id),m.parentNode.insertBefore(w,m),c=new FormData(c),w.parentNode.removeChild(w),c}function mg(c,m,w,D,G){if(m==="submit"&&w&&w.stateNode===G){var W=$_((G[pe]||null).action),ve=D.submitter;ve&&(m=(m=ve[pe]||null)?$_(m.formAction):ve.getAttribute("formAction"),m!==null&&(W=m,ve=null));var Je=new zu("action","action",null,D,G);c.push({event:Je,listeners:[{instance:null,listener:function(){if(D.defaultPrevented){if(qf!==0){var kt=ve?M_(G,ve):new FormData(G);Od(w,{pending:!0,data:kt,method:G.method,action:W},null,kt)}}else typeof W=="function"&&(Je.preventDefault(),kt=ve?M_(G,ve):new FormData(G),Od(w,{pending:!0,data:kt,method:G.method,action:W},W,kt))},currentTarget:G}]})}}for(var xp=0;xp<ud.length;xp++){var Gl=ud[xp],Hf=Gl.toLowerCase(),f_=Gl[0].toUpperCase()+Gl.slice(1);Gs(Hf,"on"+f_)}Gs(Cd,"onAnimationEnd"),Gs(_u,"onAnimationIteration"),Gs(zf,"onAnimationStart"),Gs("dblclick","onDoubleClick"),Gs("focusin","onFocus"),Gs("focusout","onBlur"),Gs(um,"onTransitionRun"),Gs(Df,"onTransitionStart"),Gs(Ou,"onTransitionCancel"),Gs(cd,"onTransitionEnd"),Ur("onMouseEnter",["mouseout","mouseover"]),Ur("onMouseLeave",["mouseout","mouseover"]),Ur("onPointerEnter",["pointerout","pointerover"]),Ur("onPointerLeave",["pointerout","pointerover"]),Nn("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Nn("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Nn("onBeforeInput",["compositionend","keypress","textInput","paste"]),Nn("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Nn("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Nn("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Wp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),C_=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Wp));function Ym(c,m){m=(m&4)!==0;for(var w=0;w<c.length;w++){var D=c[w],G=D.event;D=D.listeners;e:{var W=void 0;if(m)for(var ve=D.length-1;0<=ve;ve--){var Je=D[ve],kt=Je.instance,Mi=Je.currentTarget;if(Je=Je.listener,kt!==W&&G.isPropagationStopped())break e;W=Je,G.currentTarget=Mi;try{W(G)}catch(nn){hc(nn)}G.currentTarget=null,W=kt}else for(ve=0;ve<D.length;ve++){if(Je=D[ve],kt=Je.instance,Mi=Je.currentTarget,Je=Je.listener,kt!==W&&G.isPropagationStopped())break e;W=Je,G.currentTarget=Mi;try{W(G)}catch(nn){hc(nn)}G.currentTarget=null,W=kt}}}}function Ss(c,m){var w=m[et];w===void 0&&(w=m[et]=new Set);var D=c+"__bubble";w.has(D)||(p_(m,c,2,!1),w.add(D))}function Im(c,m,w){var D=0;m&&(D|=4),p_(w,c,D,m)}var wd="_reactListening"+Math.random().toString(36).slice(2);function Tl(c){if(!c[wd]){c[wd]=!0,dr.forEach(function(w){w!=="selectionchange"&&(C_.has(w)||Im(w,!1,c),Im(w,!0,c))});var m=c.nodeType===9?c:c.ownerDocument;m===null||m[wd]||(m[wd]=!0,Im("selectionchange",!1,m))}}function p_(c,m,w,D){switch(Uc(m)){case 2:var G=th;break;case 8:G=e_;break;default:G=t_}w=G.bind(null,m,w,c),G=void 0,!Ed||m!=="touchstart"&&m!=="touchmove"&&m!=="wheel"||(G=!0),D?G!==void 0?c.addEventListener(m,w,{capture:!0,passive:G}):c.addEventListener(m,w,!0):G!==void 0?c.addEventListener(m,w,{passive:G}):c.addEventListener(m,w,!1)}function $f(c,m,w,D,G){var W=D;if((m&1)===0&&(m&2)===0&&D!==null)e:for(;;){if(D===null)return;var ve=D.tag;if(ve===3||ve===4){var Je=D.stateNode.containerInfo;if(Je===G)break;if(ve===4)for(ve=D.return;ve!==null;){var kt=ve.tag;if((kt===3||kt===4)&&ve.stateNode.containerInfo===G)return;ve=ve.return}for(;Je!==null;){if(ve=ti(Je),ve===null)return;if(kt=ve.tag,kt===5||kt===6||kt===26||kt===27){D=W=ve;continue e}Je=Je.parentNode}}D=D.return}Kf(function(){var Mi=W,nn=Po(w),hn=[];e:{var Li=kl.get(c);if(Li!==void 0){var Ni=zu,Fr=c;switch(c){case"keypress":if(Wr(w)===0)break e;case"keydown":case"keyup":Ni=En;break;case"focusin":Fr="focus",Ni=Ad;break;case"focusout":Fr="blur",Ni=Ad;break;case"beforeblur":case"afterblur":Ni=Ad;break;case"click":if(w.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ni=zh;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ni=id;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ni=Pu;break;case Cd:case _u:case zf:Ni=qc;break;case cd:Ni=If;break;case"scroll":case"scrollend":Ni=Ru;break;case"wheel":Ni=Hc;break;case"copy":case"cut":case"paste":Ni=Ap;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ni=Sa;break;case"toggle":case"beforetoggle":Ni=io}var na=(m&4)!==0,co=!na&&(c==="scroll"||c==="scrollend"),ci=na?Li!==null?Li+"Capture":null:Li;na=[];for(var Kt=Mi,Ai;Kt!==null;){var un=Kt;if(Ai=un.stateNode,un=un.tag,un!==5&&un!==26&&un!==27||Ai===null||ci===null||(un=zc(Kt,ci),un!=null&&na.push(Yp(Kt,un,Ai))),co)break;Kt=Kt.return}0<na.length&&(Li=new Ni(Li,Fr,null,w,nn),hn.push({event:Li,listeners:na}))}}if((m&7)===0){e:{if(Li=c==="mouseover"||c==="pointerover",Ni=c==="mouseout"||c==="pointerout",Li&&w!==Xl&&(Fr=w.relatedTarget||w.fromElement)&&(ti(Fr)||Fr[ze]))break e;if((Ni||Li)&&(Li=nn.window===nn?nn:(Li=nn.ownerDocument)?Li.defaultView||Li.parentWindow:window,Ni?(Fr=w.relatedTarget||w.toElement,Ni=Mi,Fr=Fr?ti(Fr):null,Fr!==null&&(co=Pe(Fr),na=Fr.tag,Fr!==co||na!==5&&na!==27&&na!==6)&&(Fr=null)):(Ni=null,Fr=Mi),Ni!==Fr)){if(na=zh,un="onMouseLeave",ci="onMouseEnter",Kt="mouse",(c==="pointerout"||c==="pointerover")&&(na=Sa,un="onPointerLeave",ci="onPointerEnter",Kt="pointer"),co=Ni==null?Li:Yi(Ni),Ai=Fr==null?Li:Yi(Fr),Li=new na(un,Kt+"leave",Ni,w,nn),Li.target=co,Li.relatedTarget=Ai,un=null,ti(nn)===Mi&&(na=new na(ci,Kt+"enter",Fr,w,nn),na.target=Ai,na.relatedTarget=co,un=na),co=un,Ni&&Fr)t:{for(na=Jm,ci=Ni,Kt=Fr,Ai=0,un=ci;un;un=na(un))Ai++;un=0;for(var ua=Kt;ua;ua=na(ua))un++;for(;0<Ai-un;)ci=na(ci),Ai--;for(;0<un-Ai;)Kt=na(Kt),un--;for(;Ai--;){if(ci===Kt||Kt!==null&&ci===Kt.alternate){na=ci;break t}ci=na(ci),Kt=na(Kt)}na=null}else na=null;Ni!==null&&m_(hn,Li,Ni,na,!1),Fr!==null&&co!==null&&m_(hn,co,Fr,na,!0)}}e:{if(Li=Mi?Yi(Mi):window,Ni=Li.nodeName&&Li.nodeName.toLowerCase(),Ni==="select"||Ni==="input"&&Li.type==="file")var uo=cr;else if(Ll(Li))if(xn)uo=$o;else{uo=Xd;var Jr=Pc}else Ni=Li.nodeName,!Ni||Ni.toLowerCase()!=="input"||Li.type!=="checkbox"&&Li.type!=="radio"?Mi&&Gc(Mi.elementType)&&(uo=cr):uo=Lh;if(uo&&(uo=uo(c,Mi))){Rc(hn,uo,w,nn);break e}Jr&&Jr(c,Li,Mi),c==="focusout"&&Mi&&Li.type==="number"&&Mi.memoizedProps.value!=null&&Mc(Li,"number",Li.value)}switch(Jr=Mi?Yi(Mi):window,c){case"focusin":(Ll(Jr)||Jr.contentEditable==="true")&&(du=Jr,od=Mi,fu=null);break;case"focusout":fu=od=du=null;break;case"mousedown":Lc=!0;break;case"contextmenu":case"mouseup":case"dragend":Lc=!1,kc(hn,w,nn);break;case"selectionchange":if(ep)break;case"keydown":case"keyup":kc(hn,w,nn)}var _s;if($c)e:{switch(c){case"compositionstart":var Rs="onCompositionStart";break e;case"compositionend":Rs="onCompositionEnd";break e;case"compositionupdate":Rs="onCompositionUpdate";break e}Rs=void 0}else Io?Pl(c,w)&&(Rs="onCompositionEnd"):c==="keydown"&&w.keyCode===229&&(Rs="onCompositionStart");Rs&&(Md&&w.locale!=="ko"&&(Io||Rs!=="onCompositionStart"?Rs==="onCompositionEnd"&&Io&&(_s=rh()):(Wl=nn,Ep="value"in Wl?Wl.value:Wl.textContent,Io=!0)),Jr=Km(Mi,Rs),0<Jr.length&&(Rs=new Dh(Rs,c,null,w,nn),hn.push({event:Rs,listeners:Jr}),_s?Rs.data=_s:(_s=ga(w),_s!==null&&(Rs.data=_s)))),(_s=Lu?Is(c,w):ys(c,w))&&(Rs=Km(Mi,"onBeforeInput"),0<Rs.length&&(Jr=new Dh("onBeforeInput","beforeinput",null,w,nn),hn.push({event:Jr,listeners:Rs}),Jr.data=_s)),mg(hn,c,Mi,w,nn)}Ym(hn,m)})}function Yp(c,m,w){return{instance:c,listener:m,currentTarget:w}}function Km(c,m){for(var w=m+"Capture",D=[];c!==null;){var G=c,W=G.stateNode;if(G=G.tag,G!==5&&G!==26&&G!==27||W===null||(G=zc(c,w),G!=null&&D.unshift(Yp(c,G,W)),G=zc(c,m),G!=null&&D.push(Yp(c,G,W))),c.tag===3)return D;c=c.return}return[]}function Jm(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5&&c.tag!==27);return c||null}function m_(c,m,w,D,G){for(var W=m._reactName,ve=[];w!==null&&w!==D;){var Je=w,kt=Je.alternate,Mi=Je.stateNode;if(Je=Je.tag,kt!==null&&kt===D)break;Je!==5&&Je!==26&&Je!==27||Mi===null||(kt=Mi,G?(Mi=zc(w,W),Mi!=null&&ve.unshift(Yp(w,Mi,kt))):G||(Mi=zc(w,W),Mi!=null&&ve.push(Yp(w,Mi,kt)))),w=w.return}ve.length!==0&&c.push({event:m,listeners:ve})}var Kp=/\r\n?/g,__=/\u0000|\uFFFD/g;function jd(c){return(typeof c=="string"?c:""+c).replace(Kp,`
`).replace(__,"")}function Tf(c,m){return m=jd(m),jd(c)===m}function xo(c,m,w,D,G,W){switch(w){case"children":typeof D=="string"?m==="body"||m==="textarea"&&D===""||ou(c,D):(typeof D=="number"||typeof D=="bigint")&&m!=="body"&&ou(c,""+D);break;case"className":jr(c,"class",D);break;case"tabIndex":jr(c,"tabindex",D);break;case"dir":case"role":case"viewBox":case"width":case"height":jr(c,w,D);break;case"style":Mu(c,D,W);break;case"data":if(m!=="object"){jr(c,"data",D);break}case"src":case"href":if(D===""&&(m!=="a"||w!=="href")){c.removeAttribute(w);break}if(D==null||typeof D=="function"||typeof D=="symbol"||typeof D=="boolean"){c.removeAttribute(w);break}D=Cc(""+D),c.setAttribute(w,D);break;case"action":case"formAction":if(typeof D=="function"){c.setAttribute(w,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof W=="function"&&(w==="formAction"?(m!=="input"&&xo(c,m,"name",G.name,G,null),xo(c,m,"formEncType",G.formEncType,G,null),xo(c,m,"formMethod",G.formMethod,G,null),xo(c,m,"formTarget",G.formTarget,G,null)):(xo(c,m,"encType",G.encType,G,null),xo(c,m,"method",G.method,G,null),xo(c,m,"target",G.target,G,null)));if(D==null||typeof D=="symbol"||typeof D=="boolean"){c.removeAttribute(w);break}D=Cc(""+D),c.setAttribute(w,D);break;case"onClick":D!=null&&(c.onclick=fo);break;case"onScroll":D!=null&&Ss("scroll",c);break;case"onScrollEnd":D!=null&&Ss("scrollend",c);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(ce(61));if(w=D.__html,w!=null){if(G.children!=null)throw Error(ce(60));c.innerHTML=w}}break;case"multiple":c.multiple=D&&typeof D!="function"&&typeof D!="symbol";break;case"muted":c.muted=D&&typeof D!="function"&&typeof D!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(D==null||typeof D=="function"||typeof D=="boolean"||typeof D=="symbol"){c.removeAttribute("xlink:href");break}w=Cc(""+D),c.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",w);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":D!=null&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(w,""+D):c.removeAttribute(w);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":D&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(w,""):c.removeAttribute(w);break;case"capture":case"download":D===!0?c.setAttribute(w,""):D!==!1&&D!=null&&typeof D!="function"&&typeof D!="symbol"?c.setAttribute(w,D):c.removeAttribute(w);break;case"cols":case"rows":case"size":case"span":D!=null&&typeof D!="function"&&typeof D!="symbol"&&!isNaN(D)&&1<=D?c.setAttribute(w,D):c.removeAttribute(w);break;case"rowSpan":case"start":D==null||typeof D=="function"||typeof D=="symbol"||isNaN(D)?c.removeAttribute(w):c.setAttribute(w,D);break;case"popover":Ss("beforetoggle",c),Ss("toggle",c),ea(c,"popover",D);break;case"xlinkActuate":da(c,"http://www.w3.org/1999/xlink","xlink:actuate",D);break;case"xlinkArcrole":da(c,"http://www.w3.org/1999/xlink","xlink:arcrole",D);break;case"xlinkRole":da(c,"http://www.w3.org/1999/xlink","xlink:role",D);break;case"xlinkShow":da(c,"http://www.w3.org/1999/xlink","xlink:show",D);break;case"xlinkTitle":da(c,"http://www.w3.org/1999/xlink","xlink:title",D);break;case"xlinkType":da(c,"http://www.w3.org/1999/xlink","xlink:type",D);break;case"xmlBase":da(c,"http://www.w3.org/XML/1998/namespace","xml:base",D);break;case"xmlLang":da(c,"http://www.w3.org/XML/1998/namespace","xml:lang",D);break;case"xmlSpace":da(c,"http://www.w3.org/XML/1998/namespace","xml:space",D);break;case"is":ea(c,"is",D);break;case"innerText":case"textContent":break;default:(!(2<w.length)||w[0]!=="o"&&w[0]!=="O"||w[1]!=="n"&&w[1]!=="N")&&(w=cc.get(w)||w,ea(c,w,D))}}function Qm(c,m,w,D,G,W){switch(w){case"style":Mu(c,D,W);break;case"dangerouslySetInnerHTML":if(D!=null){if(typeof D!="object"||!("__html"in D))throw Error(ce(61));if(w=D.__html,w!=null){if(G.children!=null)throw Error(ce(60));c.innerHTML=w}}break;case"children":typeof D=="string"?ou(c,D):(typeof D=="number"||typeof D=="bigint")&&ou(c,""+D);break;case"onScroll":D!=null&&Ss("scroll",c);break;case"onScrollEnd":D!=null&&Ss("scrollend",c);break;case"onClick":D!=null&&(c.onclick=fo);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!$n.hasOwnProperty(w))e:{if(w[0]==="o"&&w[1]==="n"&&(G=w.endsWith("Capture"),m=w.slice(2,G?w.length-7:void 0),W=c[pe]||null,W=W!=null?W[w]:null,typeof W=="function"&&c.removeEventListener(m,W,G),typeof D=="function")){typeof W!="function"&&W!==null&&(w in c?c[w]=null:c.hasAttribute(w)&&c.removeAttribute(w)),c.addEventListener(m,D,G);break e}w in c?c[w]=D:D===!0?c.setAttribute(w,""):ea(c,w,D)}}}function Tc(c,m,w){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Ss("error",c),Ss("load",c);var D=!1,G=!1,W;for(W in w)if(w.hasOwnProperty(W)){var ve=w[W];if(ve!=null)switch(W){case"src":D=!0;break;case"srcSet":G=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(ce(137,m));default:xo(c,m,W,ve,w,null)}}G&&xo(c,m,"srcSet",w.srcSet,w,null),D&&xo(c,m,"src",w.src,w,null);return;case"input":Ss("invalid",c);var Je=W=ve=G=null,kt=null,Mi=null;for(D in w)if(w.hasOwnProperty(D)){var nn=w[D];if(nn!=null)switch(D){case"name":G=nn;break;case"type":ve=nn;break;case"checked":kt=nn;break;case"defaultChecked":Mi=nn;break;case"value":W=nn;break;case"defaultValue":Je=nn;break;case"children":case"dangerouslySetInnerHTML":if(nn!=null)throw Error(ce(137,m));break;default:xo(c,m,D,nn,w,null)}}_a(c,W,Je,kt,Mi,ve,G,!1);return;case"select":Ss("invalid",c),D=ve=W=null;for(G in w)if(w.hasOwnProperty(G)&&(Je=w[G],Je!=null))switch(G){case"value":W=Je;break;case"defaultValue":ve=Je;break;case"multiple":D=Je;default:xo(c,m,G,Je,w,null)}m=W,w=ve,c.multiple=!!D,m!=null?Ks(c,!!D,m,!1):w!=null&&Ks(c,!!D,w,!0);return;case"textarea":Ss("invalid",c),W=G=D=null;for(ve in w)if(w.hasOwnProperty(ve)&&(Je=w[ve],Je!=null))switch(ve){case"value":D=Je;break;case"defaultValue":G=Je;break;case"children":W=Je;break;case"dangerouslySetInnerHTML":if(Je!=null)throw Error(ce(91));break;default:xo(c,m,ve,Je,w,null)}Mh(c,D,G,W);return;case"option":for(kt in w)if(w.hasOwnProperty(kt)&&(D=w[kt],D!=null))switch(kt){case"selected":c.selected=D&&typeof D!="function"&&typeof D!="symbol";break;default:xo(c,m,kt,D,w,null)}return;case"dialog":Ss("beforetoggle",c),Ss("toggle",c),Ss("cancel",c),Ss("close",c);break;case"iframe":case"object":Ss("load",c);break;case"video":case"audio":for(D=0;D<Wp.length;D++)Ss(Wp[D],c);break;case"image":Ss("error",c),Ss("load",c);break;case"details":Ss("toggle",c);break;case"embed":case"source":case"link":Ss("error",c),Ss("load",c);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Mi in w)if(w.hasOwnProperty(Mi)&&(D=w[Mi],D!=null))switch(Mi){case"children":case"dangerouslySetInnerHTML":throw Error(ce(137,m));default:xo(c,m,Mi,D,w,null)}return;default:if(Gc(m)){for(nn in w)w.hasOwnProperty(nn)&&(D=w[nn],D!==void 0&&Qm(c,m,nn,D,w,void 0));return}}for(Je in w)w.hasOwnProperty(Je)&&(D=w[Je],D!=null&&xo(c,m,Je,D,w,null))}function _g(c,m,w,D){switch(m){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var G=null,W=null,ve=null,Je=null,kt=null,Mi=null,nn=null;for(Ni in w){var hn=w[Ni];if(w.hasOwnProperty(Ni)&&hn!=null)switch(Ni){case"checked":break;case"value":break;case"defaultValue":kt=hn;default:D.hasOwnProperty(Ni)||xo(c,m,Ni,null,D,hn)}}for(var Li in D){var Ni=D[Li];if(hn=w[Li],D.hasOwnProperty(Li)&&(Ni!=null||hn!=null))switch(Li){case"type":W=Ni;break;case"name":G=Ni;break;case"checked":Mi=Ni;break;case"defaultChecked":nn=Ni;break;case"value":ve=Ni;break;case"defaultValue":Je=Ni;break;case"children":case"dangerouslySetInnerHTML":if(Ni!=null)throw Error(ce(137,m));break;default:Ni!==hn&&xo(c,m,Li,Ni,D,hn)}}jo(c,ve,Je,kt,Mi,nn,W,G);return;case"select":Ni=ve=Je=Li=null;for(W in w)if(kt=w[W],w.hasOwnProperty(W)&&kt!=null)switch(W){case"value":break;case"multiple":Ni=kt;default:D.hasOwnProperty(W)||xo(c,m,W,null,D,kt)}for(G in D)if(W=D[G],kt=w[G],D.hasOwnProperty(G)&&(W!=null||kt!=null))switch(G){case"value":Li=W;break;case"defaultValue":Je=W;break;case"multiple":ve=W;default:W!==kt&&xo(c,m,G,W,D,kt)}m=Je,w=ve,D=Ni,Li!=null?Ks(c,!!w,Li,!1):!!D!=!!w&&(m!=null?Ks(c,!!w,m,!0):Ks(c,!!w,w?[]:"",!1));return;case"textarea":Ni=Li=null;for(Je in w)if(G=w[Je],w.hasOwnProperty(Je)&&G!=null&&!D.hasOwnProperty(Je))switch(Je){case"value":break;case"children":break;default:xo(c,m,Je,null,D,G)}for(ve in D)if(G=D[ve],W=w[ve],D.hasOwnProperty(ve)&&(G!=null||W!=null))switch(ve){case"value":Li=G;break;case"defaultValue":Ni=G;break;case"children":break;case"dangerouslySetInnerHTML":if(G!=null)throw Error(ce(91));break;default:G!==W&&xo(c,m,ve,G,D,W)}jc(c,Li,Ni);return;case"option":for(var Fr in w)if(Li=w[Fr],w.hasOwnProperty(Fr)&&Li!=null&&!D.hasOwnProperty(Fr))switch(Fr){case"selected":c.selected=!1;break;default:xo(c,m,Fr,null,D,Li)}for(kt in D)if(Li=D[kt],Ni=w[kt],D.hasOwnProperty(kt)&&Li!==Ni&&(Li!=null||Ni!=null))switch(kt){case"selected":c.selected=Li&&typeof Li!="function"&&typeof Li!="symbol";break;default:xo(c,m,kt,Li,D,Ni)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var na in w)Li=w[na],w.hasOwnProperty(na)&&Li!=null&&!D.hasOwnProperty(na)&&xo(c,m,na,null,D,Li);for(Mi in D)if(Li=D[Mi],Ni=w[Mi],D.hasOwnProperty(Mi)&&Li!==Ni&&(Li!=null||Ni!=null))switch(Mi){case"children":case"dangerouslySetInnerHTML":if(Li!=null)throw Error(ce(137,m));break;default:xo(c,m,Mi,Li,D,Ni)}return;default:if(Gc(m)){for(var co in w)Li=w[co],w.hasOwnProperty(co)&&Li!==void 0&&!D.hasOwnProperty(co)&&Qm(c,m,co,void 0,D,Li);for(nn in D)Li=D[nn],Ni=w[nn],!D.hasOwnProperty(nn)||Li===Ni||Li===void 0&&Ni===void 0||Qm(c,m,nn,Li,D,Ni);return}}for(var ci in w)Li=w[ci],w.hasOwnProperty(ci)&&Li!=null&&!D.hasOwnProperty(ci)&&xo(c,m,ci,null,D,Li);for(hn in D)Li=D[hn],Ni=w[hn],!D.hasOwnProperty(hn)||Li===Ni||Li==null&&Ni==null||xo(c,m,hn,Li,D,Ni)}function f(c){switch(c){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function l(){if(typeof performance.getEntriesByType=="function"){for(var c=0,m=0,w=performance.getEntriesByType("resource"),D=0;D<w.length;D++){var G=w[D],W=G.transferSize,ve=G.initiatorType,Je=G.duration;if(W&&Je&&f(ve)){for(ve=0,Je=G.responseEnd,D+=1;D<w.length;D++){var kt=w[D],Mi=kt.startTime;if(Mi>Je)break;var nn=kt.transferSize,hn=kt.initiatorType;nn&&f(hn)&&(kt=kt.responseEnd,ve+=nn*(kt<Je?1:(Je-Mi)/(kt-Mi)))}if(--D,m+=8*(W+ve)/(G.duration/1e3),c++,10<c)break}}if(0<c)return m/c/1e6}return navigator.connection&&(c=navigator.connection.downlink,typeof c=="number")?c:5}var g=null,T=null;function z(c){return c.nodeType===9?c:c.ownerDocument}function O(c){switch(c){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function B(c,m){if(c===0)switch(m){case"svg":return 1;case"math":return 2;default:return 0}return c===1&&m==="foreignObject"?0:c}function q(c,m){return c==="textarea"||c==="noscript"||typeof m.children=="string"||typeof m.children=="number"||typeof m.children=="bigint"||typeof m.dangerouslySetInnerHTML=="object"&&m.dangerouslySetInnerHTML!==null&&m.dangerouslySetInnerHTML.__html!=null}var Z=null;function re(){var c=window.event;return c&&c.type==="popstate"?c===Z?!1:(Z=c,!0):(Z=null,!1)}var de=typeof setTimeout=="function"?setTimeout:void 0,ye=typeof clearTimeout=="function"?clearTimeout:void 0,Ee=typeof Promise=="function"?Promise:void 0,Le=typeof queueMicrotask=="function"?queueMicrotask:typeof Ee<"u"?function(c){return Ee.resolve(null).then(c).catch(qe)}:de;function qe(c){setTimeout(function(){throw c})}function Ke(c){return c==="head"}function yt(c,m){var w=m,D=0;do{var G=w.nextSibling;if(c.removeChild(w),G&&G.nodeType===8)if(w=G.data,w==="/$"||w==="/&"){if(D===0){c.removeChild(G),im(m);return}D--}else if(w==="$"||w==="$?"||w==="$~"||w==="$!"||w==="&")D++;else if(w==="html")Gi(c.ownerDocument.documentElement);else if(w==="head"){w=c.ownerDocument.head,Gi(w);for(var W=w.firstChild;W;){var ve=W.nextSibling,Je=W.nodeName;W[ot]||Je==="SCRIPT"||Je==="STYLE"||Je==="LINK"&&W.rel.toLowerCase()==="stylesheet"||w.removeChild(W),W=ve}}else w==="body"&&Gi(c.ownerDocument.body);w=G}while(w);im(m)}function Mt(c,m){var w=c;c=0;do{var D=w.nextSibling;if(w.nodeType===1?m?(w._stashedDisplay=w.style.display,w.style.display="none"):(w.style.display=w._stashedDisplay||"",w.getAttribute("style")===""&&w.removeAttribute("style")):w.nodeType===3&&(m?(w._stashedText=w.nodeValue,w.nodeValue=""):w.nodeValue=w._stashedText||""),D&&D.nodeType===8)if(w=D.data,w==="/$"){if(c===0)break;c--}else w!=="$"&&w!=="$?"&&w!=="$~"&&w!=="$!"||c++;w=D}while(w)}function si(c){var m=c.firstChild;for(m&&m.nodeType===10&&(m=m.nextSibling);m;){var w=m;switch(m=m.nextSibling,w.nodeName){case"HTML":case"HEAD":case"BODY":si(w),At(w);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(w.rel.toLowerCase()==="stylesheet")continue}c.removeChild(w)}}function Ut(c,m,w,D){for(;c.nodeType===1;){var G=w;if(c.nodeName.toLowerCase()!==m.toLowerCase()){if(!D&&(c.nodeName!=="INPUT"||c.type!=="hidden"))break}else if(D){if(!c[ot])switch(m){case"meta":if(!c.hasAttribute("itemprop"))break;return c;case"link":if(W=c.getAttribute("rel"),W==="stylesheet"&&c.hasAttribute("data-precedence"))break;if(W!==G.rel||c.getAttribute("href")!==(G.href==null||G.href===""?null:G.href)||c.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin)||c.getAttribute("title")!==(G.title==null?null:G.title))break;return c;case"style":if(c.hasAttribute("data-precedence"))break;return c;case"script":if(W=c.getAttribute("src"),(W!==(G.src==null?null:G.src)||c.getAttribute("type")!==(G.type==null?null:G.type)||c.getAttribute("crossorigin")!==(G.crossOrigin==null?null:G.crossOrigin))&&W&&c.hasAttribute("async")&&!c.hasAttribute("itemprop"))break;return c;default:return c}}else if(m==="input"&&c.type==="hidden"){var W=G.name==null?null:""+G.name;if(G.type==="hidden"&&c.getAttribute("name")===W)return c}else return c;if(c=Fn(c.nextSibling),c===null)break}return null}function ii(c,m,w){if(m==="")return null;for(;c.nodeType!==3;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!w||(c=Fn(c.nextSibling),c===null))return null;return c}function Pi(c,m){for(;c.nodeType!==8;)if((c.nodeType!==1||c.nodeName!=="INPUT"||c.type!=="hidden")&&!m||(c=Fn(c.nextSibling),c===null))return null;return c}function gn(c){return c.data==="$?"||c.data==="$~"}function Wn(c){return c.data==="$!"||c.data==="$?"&&c.ownerDocument.readyState!=="loading"}function Er(c,m){var w=c.ownerDocument;if(c.data==="$~")c._reactRetry=m;else if(c.data!=="$?"||w.readyState!=="loading")m();else{var D=function(){m(),w.removeEventListener("DOMContentLoaded",D)};w.addEventListener("DOMContentLoaded",D),c._reactRetry=D}}function Fn(c){for(;c!=null;c=c.nextSibling){var m=c.nodeType;if(m===1||m===3)break;if(m===8){if(m=c.data,m==="$"||m==="$!"||m==="$?"||m==="$~"||m==="&"||m==="F!"||m==="F")break;if(m==="/$"||m==="/&")return null}}return c}var In=null;function xr(c){c=c.nextSibling;for(var m=0;c;){if(c.nodeType===8){var w=c.data;if(w==="/$"||w==="/&"){if(m===0)return Fn(c.nextSibling);m--}else w!=="$"&&w!=="$!"&&w!=="$?"&&w!=="$~"&&w!=="&"||m++}c=c.nextSibling}return null}function or(c){c=c.previousSibling;for(var m=0;c;){if(c.nodeType===8){var w=c.data;if(w==="$"||w==="$!"||w==="$?"||w==="$~"||w==="&"){if(m===0)return c;m--}else w!=="/$"&&w!=="/&"||m++}c=c.previousSibling}return null}function nr(c,m,w){switch(m=z(w),c){case"html":if(c=m.documentElement,!c)throw Error(ce(452));return c;case"head":if(c=m.head,!c)throw Error(ce(453));return c;case"body":if(c=m.body,!c)throw Error(ce(454));return c;default:throw Error(ce(451))}}function Gi(c){for(var m=c.attributes;m.length;)c.removeAttributeNode(m[0]);At(c)}var sr=new Map,vr=new Set;function ia(c){return typeof c.getRootNode=="function"?c.getRootNode():c.nodeType===9?c:c.ownerDocument}var ms=Si.d;Si.d={f:eo,r:Sl,D:ql,C:iu,L:Sc,m:tl,X:ac,S:il,M:nu};function eo(){var c=ms.f(),m=Qo();return c||m}function Sl(c){var m=qt(c);m!==null&&m.tag===5&&m.type==="form"?Zh(m):ms.r(c)}var Nc=typeof document>"u"?null:document;function rc(c,m,w){var D=Nc;if(D&&typeof m=="string"&&m){var G=es(m);G='link[rel="'+c+'"][href="'+G+'"]',typeof w=="string"&&(G+='[crossorigin="'+w+'"]'),vr.has(G)||(vr.add(G),c={rel:c,crossOrigin:w,href:m},D.querySelector(G)===null&&(m=D.createElement("link"),Tc(m,"link",c),Bi(m),D.head.appendChild(m)))}}function ql(c){ms.D(c),rc("dns-prefetch",c,null)}function iu(c,m){ms.C(c,m),rc("preconnect",c,m)}function Sc(c,m,w){ms.L(c,m,w);var D=Nc;if(D&&c&&m){var G='link[rel="preload"][as="'+es(m)+'"]';m==="image"&&w&&w.imageSrcSet?(G+='[imagesrcset="'+es(w.imageSrcSet)+'"]',typeof w.imageSizes=="string"&&(G+='[imagesizes="'+es(w.imageSizes)+'"]')):G+='[href="'+es(c)+'"]';var W=G;switch(m){case"style":W=Hl(c);break;case"script":W=rs(c)}sr.has(W)||(c=ut({rel:"preload",href:m==="image"&&w&&w.imageSrcSet?void 0:c,as:m},w),sr.set(W,c),D.querySelector(G)!==null||m==="style"&&D.querySelector(El(W))||m==="script"&&D.querySelector(Ds(W))||(m=D.createElement("link"),Tc(m,"link",c),Bi(m),D.head.appendChild(m)))}}function tl(c,m){ms.m(c,m);var w=Nc;if(w&&c){var D=m&&typeof m.as=="string"?m.as:"script",G='link[rel="modulepreload"][as="'+es(D)+'"][href="'+es(c)+'"]',W=G;switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":W=rs(c)}if(!sr.has(W)&&(c=ut({rel:"modulepreload",href:c},m),sr.set(W,c),w.querySelector(G)===null)){switch(D){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(w.querySelector(Ds(W)))return}D=w.createElement("link"),Tc(D,"link",c),Bi(D),w.head.appendChild(D)}}}function il(c,m,w){ms.S(c,m,w);var D=Nc;if(D&&c){var G=Ki(D).hoistableStyles,W=Hl(c);m=m||"default";var ve=G.get(W);if(!ve){var Je={loading:0,preload:null};if(ve=D.querySelector(El(W)))Je.loading=5;else{c=ut({rel:"stylesheet",href:c,"data-precedence":m},w),(w=sr.get(W))&&bo(c,w);var kt=ve=D.createElement("link");Bi(kt),Tc(kt,"link",c),kt._p=new Promise(function(Mi,nn){kt.onload=Mi,kt.onerror=nn}),kt.addEventListener("load",function(){Je.loading|=1}),kt.addEventListener("error",function(){Je.loading|=2}),Je.loading|=4,Vc(ve,m,D)}ve={type:"stylesheet",instance:ve,count:1,state:Je},G.set(W,ve)}}}function ac(c,m){ms.X(c,m);var w=Nc;if(w&&c){var D=Ki(w).hoistableScripts,G=rs(c),W=D.get(G);W||(W=w.querySelector(Ds(G)),W||(c=ut({src:c,async:!0},m),(m=sr.get(G))&&Zf(c,m),W=w.createElement("script"),Bi(W),Tc(W,"link",c),w.head.appendChild(W)),W={type:"script",instance:W,count:1,state:null},D.set(G,W))}}function nu(c,m){ms.M(c,m);var w=Nc;if(w&&c){var D=Ki(w).hoistableScripts,G=rs(c),W=D.get(G);W||(W=w.querySelector(Ds(G)),W||(c=ut({src:c,async:!0,type:"module"},m),(m=sr.get(G))&&Zf(c,m),W=w.createElement("script"),Bi(W),Tc(W,"link",c),w.head.appendChild(W)),W={type:"script",instance:W,count:1,state:null},D.set(G,W))}}function Ec(c,m,w,D){var G=(G=_r.current)?ia(G):null;if(!G)throw Error(ce(446));switch(c){case"meta":case"title":return null;case"style":return typeof w.precedence=="string"&&typeof w.href=="string"?(m=Hl(w.href),w=Ki(G).hoistableStyles,D=w.get(m),D||(D={type:"style",instance:null,count:0,state:null},w.set(m,D)),D):{type:"void",instance:null,count:0,state:null};case"link":if(w.rel==="stylesheet"&&typeof w.href=="string"&&typeof w.precedence=="string"){c=Hl(w.href);var W=Ki(G).hoistableStyles,ve=W.get(c);if(ve||(G=G.ownerDocument||G,ve={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},W.set(c,ve),(W=G.querySelector(El(c)))&&!W._p&&(ve.instance=W,ve.state.loading=5),sr.has(c)||(w={rel:"preload",as:"style",href:w.href,crossOrigin:w.crossOrigin,integrity:w.integrity,media:w.media,hrefLang:w.hrefLang,referrerPolicy:w.referrerPolicy},sr.set(c,w),W||Qu(G,c,w,ve.state))),m&&D===null)throw Error(ce(528,""));return ve}if(m&&D!==null)throw Error(ce(529,""));return null;case"script":return m=w.async,w=w.src,typeof w=="string"&&m&&typeof m!="function"&&typeof m!="symbol"?(m=rs(w),w=Ki(G).hoistableScripts,D=w.get(m),D||(D={type:"script",instance:null,count:0,state:null},w.set(m,D)),D):{type:"void",instance:null,count:0,state:null};default:throw Error(ce(444,c))}}function Hl(c){return'href="'+es(c)+'"'}function El(c){return'link[rel="stylesheet"]['+c+"]"}function wh(c){return ut({},c,{"data-precedence":c.precedence,precedence:null})}function Qu(c,m,w,D){c.querySelector('link[rel="preload"][as="style"]['+m+"]")?D.loading=1:(m=c.createElement("link"),D.preload=m,m.addEventListener("load",function(){return D.loading|=1}),m.addEventListener("error",function(){return D.loading|=2}),Tc(m,"link",w),Bi(m),c.head.appendChild(m))}function rs(c){return'[src="'+es(c)+'"]'}function Ds(c){return"script[async]"+c}function vo(c,m,w){if(m.count++,m.instance===null)switch(m.type){case"style":var D=c.querySelector('style[data-href~="'+es(w.href)+'"]');if(D)return m.instance=D,Bi(D),D;var G=ut({},w,{"data-href":w.href,"data-precedence":w.precedence,href:null,precedence:null});return D=(c.ownerDocument||c).createElement("style"),Bi(D),Tc(D,"style",G),Vc(D,w.precedence,c),m.instance=D;case"stylesheet":G=Hl(w.href);var W=c.querySelector(El(G));if(W)return m.state.loading|=4,m.instance=W,Bi(W),W;D=wh(w),(G=sr.get(G))&&bo(D,G),W=(c.ownerDocument||c).createElement("link"),Bi(W);var ve=W;return ve._p=new Promise(function(Je,kt){ve.onload=Je,ve.onerror=kt}),Tc(W,"link",D),m.state.loading|=4,Vc(W,w.precedence,c),m.instance=W;case"script":return W=rs(w.src),(G=c.querySelector(Ds(W)))?(m.instance=G,Bi(G),G):(D=w,(G=sr.get(W))&&(D=ut({},w),Zf(D,G)),c=c.ownerDocument||c,G=c.createElement("script"),Bi(G),Tc(G,"link",D),c.head.appendChild(G),m.instance=G);case"void":return null;default:throw Error(ce(443,m.type))}else m.type==="stylesheet"&&(m.state.loading&4)===0&&(D=m.instance,m.state.loading|=4,Vc(D,w.precedence,c));return m.instance}function Vc(c,m,w){for(var D=w.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),G=D.length?D[D.length-1]:null,W=G,ve=0;ve<D.length;ve++){var Je=D[ve];if(Je.dataset.precedence===m)W=Je;else if(W!==G)break}W?W.parentNode.insertBefore(c,W.nextSibling):(m=w.nodeType===9?w.head:w,m.insertBefore(c,m.firstChild))}function bo(c,m){c.crossOrigin==null&&(c.crossOrigin=m.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=m.referrerPolicy),c.title==null&&(c.title=m.title)}function Zf(c,m){c.crossOrigin==null&&(c.crossOrigin=m.crossOrigin),c.referrerPolicy==null&&(c.referrerPolicy=m.referrerPolicy),c.integrity==null&&(c.integrity=m.integrity)}var eh=null;function Th(c,m,w){if(eh===null){var D=new Map,G=eh=new Map;G.set(w,D)}else G=eh,D=G.get(w),D||(D=new Map,G.set(w,D));if(D.has(c))return D;for(D.set(c,null),w=w.getElementsByTagName(c),G=0;G<w.length;G++){var W=w[G];if(!(W[ot]||W[te]||c==="link"&&W.getAttribute("rel")==="stylesheet")&&W.namespaceURI!=="http://www.w3.org/2000/svg"){var ve=W.getAttribute(m)||"";ve=c+ve;var Je=D.get(ve);Je?Je.push(W):D.set(ve,[W])}}return D}function Sh(c,m,w){c=c.ownerDocument||c,c.head.insertBefore(w,m==="title"?c.querySelector("head > title"):null)}function Yh(c,m,w){if(w===1||m.itemProp!=null)return!1;switch(c){case"meta":case"title":return!0;case"style":if(typeof m.precedence!="string"||typeof m.href!="string"||m.href==="")break;return!0;case"link":if(typeof m.rel!="string"||typeof m.href!="string"||m.href===""||m.onLoad||m.onError)break;switch(m.rel){case"stylesheet":return c=m.disabled,typeof m.precedence=="string"&&c==null;default:return!0}case"script":if(m.async&&typeof m.async!="function"&&typeof m.async!="symbol"&&!m.onLoad&&!m.onError&&m.src&&typeof m.src=="string")return!0}return!1}function Al(c){return!(c.type==="stylesheet"&&(c.state.loading&3)===0)}function Sf(c,m,w,D){if(w.type==="stylesheet"&&(typeof D.media!="string"||matchMedia(D.media).matches!==!1)&&(w.state.loading&4)===0){if(w.instance===null){var G=Hl(D.href),W=m.querySelector(El(G));if(W){m=W._p,m!==null&&typeof m=="object"&&typeof m.then=="function"&&(c.count++,c=Jp.bind(c),m.then(c,c)),w.state.loading|=4,w.instance=W,Bi(W);return}W=m.ownerDocument||m,D=wh(D),(G=sr.get(G))&&bo(D,G),W=W.createElement("link"),Bi(W);var ve=W;ve._p=new Promise(function(Je,kt){ve.onload=Je,ve.onerror=kt}),Tc(W,"link",D),w.instance=W}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(w,m),(m=w.state.preload)&&(w.state.loading&3)===0&&(c.count++,w=Jp.bind(c),m.addEventListener("load",w),m.addEventListener("error",w))}}var vp=0;function z_(c,m){return c.stylesheets&&c.count===0&&bp(c,c.stylesheets),0<c.count||0<c.imgCount?function(w){var D=setTimeout(function(){if(c.stylesheets&&bp(c,c.stylesheets),c.unsuspend){var W=c.unsuspend;c.unsuspend=null,W()}},6e4+m);0<c.imgBytes&&vp===0&&(vp=62500*l());var G=setTimeout(function(){if(c.waitingForImages=!1,c.count===0&&(c.stylesheets&&bp(c,c.stylesheets),c.unsuspend)){var W=c.unsuspend;c.unsuspend=null,W()}},(c.imgBytes>vp?50:800)+m);return c.unsuspend=w,function(){c.unsuspend=null,clearTimeout(D),clearTimeout(G)}}:null}function Jp(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)bp(this,this.stylesheets);else if(this.unsuspend){var c=this.unsuspend;this.unsuspend=null,c()}}}var Qp=null;function bp(c,m){c.stylesheets=null,c.unsuspend!==null&&(c.count++,Qp=new Map,m.forEach(Xf,c),Qp=null,Jp.call(c))}function Xf(c,m){if(!(m.state.loading&4)){var w=Qp.get(c);if(w)var D=w.get(null);else{w=new Map,Qp.set(c,w);for(var G=c.querySelectorAll("link[data-precedence],style[data-precedence]"),W=0;W<G.length;W++){var ve=G[W];(ve.nodeName==="LINK"||ve.getAttribute("media")!=="not all")&&(w.set(ve.dataset.precedence,ve),D=ve)}D&&w.set(null,D)}G=m.instance,ve=G.getAttribute("data-precedence"),W=w.get(ve)||D,W===D&&w.set(null,G),w.set(ve,G),this.count++,D=Jp.bind(this),G.addEventListener("load",D),G.addEventListener("error",D),W?W.parentNode.insertBefore(G,W.nextSibling):(c=c.nodeType===9?c.head:c,c.insertBefore(G,c.firstChild)),m.state.loading|=4}}var Mm={$$typeof:Ji,Provider:null,Consumer:null,_currentValue:yn,_currentValue2:yn,_threadCount:0};function Z_(c,m,w,D,G,W,ve,Je,kt){this.tag=1,this.containerInfo=c,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Nt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Nt(0),this.hiddenUpdates=Nt(null),this.identifierPrefix=D,this.onUncaughtError=G,this.onCaughtError=W,this.onRecoverableError=ve,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=kt,this.incompleteTransitions=new Map}function X_(c,m,w,D,G,W,ve,Je,kt,Mi,nn,hn){return c=new Z_(c,m,w,ve,kt,Mi,nn,hn,Je),m=1,W===!0&&(m|=24),W=xl(3,null,null,m),c.current=W,W.stateNode=c,m=pc(),m.refCount++,c.pooledCache=m,m.refCount++,W.memoizedState={element:D,isDehydrated:w,cache:m},Zn(W),c}function D_(c){return c?(c=yl,c):yl}function Ef(c,m,w,D,G,W){G=D_(G),D.context===null?D.context=G:D.pendingContext=G,D=zn(m),D.payload={element:w},W=W===void 0?null:W,W!==null&&(D.callback=W),w=ir(c,D,m),w!==null&&(fa(w,c,m),$r(w,c,m))}function R_(c,m){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var w=c.retryLane;c.retryLane=w!==0&&w<m?w:m}}function g_(c,m){R_(c,m),(c=c.alternate)&&R_(c,m)}function Cm(c){if(c.tag===13||c.tag===31){var m=gu(c,67108864);m!==null&&fa(m,c,67108864),g_(c,67108864)}}function zm(c){if(c.tag===13||c.tag===31){var m=Sr();m=hi(m);var w=gu(c,m);w!==null&&fa(w,c,m),g_(c,m)}}var em=!0;function th(c,m,w,D){var G=ui.T;ui.T=null;var W=Si.p;try{Si.p=2,t_(c,m,w,D)}finally{Si.p=W,ui.T=G}}function e_(c,m,w,D){var G=ui.T;ui.T=null;var W=Si.p;try{Si.p=8,t_(c,m,w,D)}finally{Si.p=W,ui.T=G}}function t_(c,m,w,D){if(em){var G=y_(D);if(G===null)$f(c,m,D,i_,w),gg(c,D);else if(ny(G,c,m,w,D))D.stopPropagation();else if(gg(c,D),m&4&&-1<iy.indexOf(c)){for(;G!==null;){var W=qt(G);if(W!==null)switch(W.tag){case 3:if(W=W.stateNode,W.current.memoizedState.isDehydrated){var ve=dt(W.pendingLanes);if(ve!==0){var Je=W;for(Je.pendingLanes|=2,Je.entangledLanes|=2;ve;){var kt=1<<31-Hs(ve);Je.entanglements[1]|=kt,ve&=~kt}tu(W),(St&6)===0&&(_n=la()+500,Zp(0))}}break;case 31:case 13:Je=gu(W,2),Je!==null&&fa(Je,W,2),Qo(),g_(W,2)}if(W=y_(D),W===null&&$f(c,m,D,i_,w),W===G)break;G=W}G!==null&&D.stopPropagation()}else $f(c,m,D,null,w)}}function y_(c){return c=Po(c),P_(c)}var i_=null;function P_(c){if(i_=null,c=ti(c),c!==null){var m=Pe(c);if(m===null)c=null;else{var w=m.tag;if(w===13){if(c=le(m),c!==null)return c;c=null}else if(w===31){if(c=n(m),c!==null)return c;c=null}else if(w===3){if(m.stateNode.current.memoizedState.isDehydrated)return m.tag===3?m.stateNode.containerInfo:null;c=null}else m!==c&&(c=null)}}return i_=c,null}function Uc(c){switch(c){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Vs()){case qs:return 2;case Us:return 8;case cn:case Ws:return 32;case To:return 268435456;default:return 32}default:return 32}}var ru=!1,au=null,Ac=null,Eh=null,ih=new Map,n_=new Map,tm=[],iy="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function gg(c,m){switch(c){case"focusin":case"focusout":au=null;break;case"dragenter":case"dragleave":Ac=null;break;case"mouseover":case"mouseout":Eh=null;break;case"pointerover":case"pointerout":ih.delete(m.pointerId);break;case"gotpointercapture":case"lostpointercapture":n_.delete(m.pointerId)}}function x_(c,m,w,D,G,W){return c===null||c.nativeEvent!==W?(c={blockedOn:m,domEventName:w,eventSystemFlags:D,nativeEvent:W,targetContainers:[G]},m!==null&&(m=qt(m),m!==null&&Cm(m)),c):(c.eventSystemFlags|=D,m=c.targetContainers,G!==null&&m.indexOf(G)===-1&&m.push(G),c)}function ny(c,m,w,D,G){switch(m){case"focusin":return au=x_(au,c,m,w,D,G),!0;case"dragenter":return Ac=x_(Ac,c,m,w,D,G),!0;case"mouseover":return Eh=x_(Eh,c,m,w,D,G),!0;case"pointerover":var W=G.pointerId;return ih.set(W,x_(ih.get(W)||null,c,m,w,D,G)),!0;case"gotpointercapture":return W=G.pointerId,n_.set(W,x_(n_.get(W)||null,c,m,w,D,G)),!0}return!1}function ry(c){var m=ti(c.target);if(m!==null){var w=Pe(m);if(w!==null){if(m=w.tag,m===13){if(m=le(w),m!==null){c.blockedOn=m,Tr(c.priority,function(){zm(w)});return}}else if(m===31){if(m=n(w),m!==null){c.blockedOn=m,Tr(c.priority,function(){zm(w)});return}}else if(m===3&&w.stateNode.current.memoizedState.isDehydrated){c.blockedOn=w.tag===3?w.stateNode.containerInfo:null;return}}}c.blockedOn=null}function L_(c){if(c.blockedOn!==null)return!1;for(var m=c.targetContainers;0<m.length;){var w=y_(c.nativeEvent);if(w===null){w=c.nativeEvent;var D=new w.constructor(w.type,w);Xl=D,w.target.dispatchEvent(D),Xl=null}else return m=qt(w),m!==null&&Cm(m),c.blockedOn=w,!1;m.shift()}return!0}function yg(c,m,w){L_(c)&&w.delete(m)}function r_(){ru=!1,au!==null&&L_(au)&&(au=null),Ac!==null&&L_(Ac)&&(Ac=null),Eh!==null&&L_(Eh)&&(Eh=null),ih.forEach(yg),n_.forEach(yg)}function k_(c,m){c.blockedOn===m&&(c.blockedOn=null,ru||(ru=!0,J.unstable_scheduleCallback(J.unstable_NormalPriority,r_)))}var O_=null;function xg(c){O_!==c&&(O_=c,J.unstable_scheduleCallback(J.unstable_NormalPriority,function(){O_===c&&(O_=null);for(var m=0;m<c.length;m+=3){var w=c[m],D=c[m+1],G=c[m+2];if(typeof D!="function"){if(P_(D||w)===null)continue;break}var W=qt(w);W!==null&&(c.splice(m,3),m-=3,Od(W,{pending:!0,data:G,method:w.method,action:D},D,G))}}))}function im(c){function m(kt){return k_(kt,c)}au!==null&&k_(au,c),Ac!==null&&k_(Ac,c),Eh!==null&&k_(Eh,c),ih.forEach(m),n_.forEach(m);for(var w=0;w<tm.length;w++){var D=tm[w];D.blockedOn===c&&(D.blockedOn=null)}for(;0<tm.length&&(w=tm[0],w.blockedOn===null);)ry(w),w.blockedOn===null&&tm.shift();if(w=(c.ownerDocument||c).$$reactFormReplay,w!=null)for(D=0;D<w.length;D+=3){var G=w[D],W=w[D+1],ve=G[pe]||null;if(typeof W=="function")ve||xg(w);else if(ve){var Je=null;if(W&&W.hasAttribute("formAction")){if(G=W,ve=W[pe]||null)Je=ve.formAction;else if(P_(G)!==null)continue}else Je=ve.action;typeof Je=="function"?w[D+1]=Je:(w.splice(D,3),D-=3),xg(w)}}}function ay(){function c(W){W.canIntercept&&W.info==="react-transition"&&W.intercept({handler:function(){return new Promise(function(ve){return G=ve})},focusReset:"manual",scroll:"manual"})}function m(){G!==null&&(G(),G=null),D||setTimeout(w,20)}function w(){if(!D&&!navigation.transition){var W=navigation.currentEntry;W&&W.url!=null&&navigation.navigate(W.url,{state:W.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var D=!1,G=null;return navigation.addEventListener("navigate",c),navigation.addEventListener("navigatesuccess",m),navigation.addEventListener("navigateerror",m),setTimeout(w,100),function(){D=!0,navigation.removeEventListener("navigate",c),navigation.removeEventListener("navigatesuccess",m),navigation.removeEventListener("navigateerror",m),G!==null&&(G(),G=null)}}}function W_(c){this._internalRoot=c}Dm.prototype.render=W_.prototype.render=function(c){var m=this._internalRoot;if(m===null)throw Error(ce(409));var w=m.current,D=Sr();Ef(w,D,c,m,null,null)},Dm.prototype.unmount=W_.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var m=c.containerInfo;Ef(c.current,2,null,c,null,null),Qo(),m[ze]=null}};function Dm(c){this._internalRoot=c}Dm.prototype.unstable_scheduleHydration=function(c){if(c){var m=hr();c={blockedOn:null,target:c,priority:m};for(var w=0;w<tm.length&&m!==0&&m<tm[w].priority;w++);tm.splice(w,0,c),w===0&&ry(c)}};var vg=ue.version;if(vg!=="19.2.0")throw Error(ce(527,vg,"19.2.0"));Si.findDOMNode=function(c){var m=c._reactInternals;if(m===void 0)throw typeof c.render=="function"?Error(ce(188)):(c=Object.keys(c).join(","),Error(ce(268,c)));return c=ke(m),c=c!==null?Rt(c):null,c=c===null?null:c.stateNode,c};var sy={bundleType:0,version:"19.2.0",rendererPackageName:"react-dom",currentDispatcherRef:ui,reconcilerVersion:"19.2.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var B_=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!B_.isDisabled&&B_.supportsFiber)try{Sn=B_.inject(sy),tr=B_}catch{}}return Xg.createRoot=function(c,m){if(!Me(c))throw Error(ce(299));var w=!1,D="",G=_m,W=mf,ve=gm;return m!=null&&(m.unstable_strictMode===!0&&(w=!0),m.identifierPrefix!==void 0&&(D=m.identifierPrefix),m.onUncaughtError!==void 0&&(G=m.onUncaughtError),m.onCaughtError!==void 0&&(W=m.onCaughtError),m.onRecoverableError!==void 0&&(ve=m.onRecoverableError)),m=X_(c,1,!1,null,null,w,D,null,G,W,ve,ay),c[ze]=m.current,Tl(c),new W_(m)},Xg.hydrateRoot=function(c,m,w){if(!Me(c))throw Error(ce(299));var D=!1,G="",W=_m,ve=mf,Je=gm,kt=null;return w!=null&&(w.unstable_strictMode===!0&&(D=!0),w.identifierPrefix!==void 0&&(G=w.identifierPrefix),w.onUncaughtError!==void 0&&(W=w.onUncaughtError),w.onCaughtError!==void 0&&(ve=w.onCaughtError),w.onRecoverableError!==void 0&&(Je=w.onRecoverableError),w.formState!==void 0&&(kt=w.formState)),m=X_(c,1,!0,m,w??null,D,G,kt,W,ve,Je,ay),m.context=D_(null),w=m.current,D=Sr(),D=hi(D),G=zn(D),G.callback=null,ir(w,G,D),w=D,m.current.lanes=w,je(m,w),tu(m),c[ze]=m.current,Tl(c),new Dm(m)},Xg.version="19.2.0",Xg}var n1;function yS(){if(n1)return Wx.exports;n1=1;function J(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(J)}catch(ue){console.error(ue)}}return J(),Wx.exports=gS(),Wx.exports}var xS=yS();const vS=Kg(xS);var r1="popstate";function bS(J={}){function ue(ce,Me){let{pathname:Pe,search:le,hash:n}=ce.location;return av("",{pathname:Pe,search:le,hash:n},Me.state&&Me.state.usr||null,Me.state&&Me.state.key||"default")}function me(ce,Me){return typeof Me=="string"?Me:Yg(Me)}return TS(ue,me,null,J)}function Ic(J,ue){if(J===!1||J===null||typeof J>"u")throw new Error(ue)}function Sp(J,ue){if(!J){typeof console<"u"&&console.warn(ue);try{throw new Error(ue)}catch{}}}function wS(){return Math.random().toString(36).substring(2,10)}function a1(J,ue){return{usr:J.state,key:J.key,idx:ue}}function av(J,ue,me=null,ce){return{pathname:typeof J=="string"?J:J.pathname,search:"",hash:"",...typeof ue=="string"?dg(ue):ue,state:me,key:ue&&ue.key||ce||wS()}}function Yg({pathname:J="/",search:ue="",hash:me=""}){return ue&&ue!=="?"&&(J+=ue.charAt(0)==="?"?ue:"?"+ue),me&&me!=="#"&&(J+=me.charAt(0)==="#"?me:"#"+me),J}function dg(J){let ue={};if(J){let me=J.indexOf("#");me>=0&&(ue.hash=J.substring(me),J=J.substring(0,me));let ce=J.indexOf("?");ce>=0&&(ue.search=J.substring(ce),J=J.substring(0,ce)),J&&(ue.pathname=J)}return ue}function TS(J,ue,me,ce={}){let{window:Me=document.defaultView,v5Compat:Pe=!1}=ce,le=Me.history,n="POP",tt=null,ke=Rt();ke==null&&(ke=0,le.replaceState({...le.state,idx:ke},""));function Rt(){return(le.state||{idx:null}).idx}function ut(){n="POP";let Wi=Rt(),Tn=Wi==null?null:Wi-ke;ke=Wi,tt&&tt({action:n,location:Vi.location,delta:Tn})}function bt(Wi,Tn){n="PUSH";let Ci=av(Vi.location,Wi,Tn);ke=Rt()+1;let Ji=a1(Ci,ke),Vn=Vi.createHref(Ci);try{le.pushState(Ji,"",Vn)}catch(Oi){if(Oi instanceof DOMException&&Oi.name==="DataCloneError")throw Oi;Me.location.assign(Vn)}Pe&&tt&&tt({action:n,location:Vi.location,delta:1})}function rn(Wi,Tn){n="REPLACE";let Ci=av(Vi.location,Wi,Tn);ke=Rt();let Ji=a1(Ci,ke),Vn=Vi.createHref(Ci);le.replaceState(Ji,"",Vn),Pe&&tt&&tt({action:n,location:Vi.location,delta:0})}function on(Wi){return SS(Wi)}let Vi={get action(){return n},get location(){return J(Me,le)},listen(Wi){if(tt)throw new Error("A history only accepts one active listener");return Me.addEventListener(r1,ut),tt=Wi,()=>{Me.removeEventListener(r1,ut),tt=null}},createHref(Wi){return ue(Me,Wi)},createURL:on,encodeLocation(Wi){let Tn=on(Wi);return{pathname:Tn.pathname,search:Tn.search,hash:Tn.hash}},push:bt,replace:rn,go(Wi){return le.go(Wi)}};return Vi}function SS(J,ue=!1){let me="http://localhost";typeof window<"u"&&(me=window.location.origin!=="null"?window.location.origin:window.location.href),Ic(me,"No window.location.(origin|href) available to create URL");let ce=typeof J=="string"?J:Yg(J);return ce=ce.replace(/ $/,"%20"),!ue&&ce.startsWith("//")&&(ce=me+ce),new URL(ce,me)}function P1(J,ue,me="/"){return ES(J,ue,me,!1)}function ES(J,ue,me,ce){let Me=typeof ue=="string"?dg(ue):ue,Pe=l_(Me.pathname||"/",me);if(Pe==null)return null;let le=L1(J);AS(le);let n=null;for(let tt=0;n==null&&tt<le.length;++tt){let ke=BS(Pe);n=kS(le[tt],ke,ce)}return n}function L1(J,ue=[],me=[],ce="",Me=!1){let Pe=(le,n,tt=Me,ke)=>{let Rt={relativePath:ke===void 0?le.path||"":ke,caseSensitive:le.caseSensitive===!0,childrenIndex:n,route:le};if(Rt.relativePath.startsWith("/")){if(!Rt.relativePath.startsWith(ce)&&tt)return;Ic(Rt.relativePath.startsWith(ce),`Absolute route path "${Rt.relativePath}" nested under path "${ce}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),Rt.relativePath=Rt.relativePath.slice(ce.length)}let ut=o_([ce,Rt.relativePath]),bt=me.concat(Rt);le.children&&le.children.length>0&&(Ic(le.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${ut}".`),L1(le.children,ue,bt,ut,tt)),!(le.path==null&&!le.index)&&ue.push({path:ut,score:PS(ut,le.index),routesMeta:bt})};return J.forEach((le,n)=>{if(le.path===""||!le.path?.includes("?"))Pe(le,n);else for(let tt of k1(le.path))Pe(le,n,!0,tt)}),ue}function k1(J){let ue=J.split("/");if(ue.length===0)return[];let[me,...ce]=ue,Me=me.endsWith("?"),Pe=me.replace(/\?$/,"");if(ce.length===0)return Me?[Pe,""]:[Pe];let le=k1(ce.join("/")),n=[];return n.push(...le.map(tt=>tt===""?Pe:[Pe,tt].join("/"))),Me&&n.push(...le),n.map(tt=>J.startsWith("/")&&tt===""?"/":tt)}function AS(J){J.sort((ue,me)=>ue.score!==me.score?me.score-ue.score:LS(ue.routesMeta.map(ce=>ce.childrenIndex),me.routesMeta.map(ce=>ce.childrenIndex)))}var IS=/^:[\w-]+$/,MS=3,CS=2,zS=1,DS=10,RS=-2,s1=J=>J==="*";function PS(J,ue){let me=J.split("/"),ce=me.length;return me.some(s1)&&(ce+=RS),ue&&(ce+=CS),me.filter(Me=>!s1(Me)).reduce((Me,Pe)=>Me+(IS.test(Pe)?MS:Pe===""?zS:DS),ce)}function LS(J,ue){return J.length===ue.length&&J.slice(0,-1).every((ce,Me)=>ce===ue[Me])?J[J.length-1]-ue[ue.length-1]:0}function kS(J,ue,me=!1){let{routesMeta:ce}=J,Me={},Pe="/",le=[];for(let n=0;n<ce.length;++n){let tt=ce[n],ke=n===ce.length-1,Rt=Pe==="/"?ue:ue.slice(Pe.length)||"/",ut=Zy({path:tt.relativePath,caseSensitive:tt.caseSensitive,end:ke},Rt),bt=tt.route;if(!ut&&ke&&me&&!ce[ce.length-1].route.index&&(ut=Zy({path:tt.relativePath,caseSensitive:tt.caseSensitive,end:!1},Rt)),!ut)return null;Object.assign(Me,ut.params),le.push({params:Me,pathname:o_([Pe,ut.pathname]),pathnameBase:jS(o_([Pe,ut.pathnameBase])),route:bt}),ut.pathnameBase!=="/"&&(Pe=o_([Pe,ut.pathnameBase]))}return le}function Zy(J,ue){typeof J=="string"&&(J={path:J,caseSensitive:!1,end:!0});let[me,ce]=OS(J.path,J.caseSensitive,J.end),Me=ue.match(me);if(!Me)return null;let Pe=Me[0],le=Pe.replace(/(.)\/+$/,"$1"),n=Me.slice(1);return{params:ce.reduce((ke,{paramName:Rt,isOptional:ut},bt)=>{if(Rt==="*"){let on=n[bt]||"";le=Pe.slice(0,Pe.length-on.length).replace(/(.)\/+$/,"$1")}const rn=n[bt];return ut&&!rn?ke[Rt]=void 0:ke[Rt]=(rn||"").replace(/%2F/g,"/"),ke},{}),pathname:Pe,pathnameBase:le,pattern:J}}function OS(J,ue=!1,me=!0){Sp(J==="*"||!J.endsWith("*")||J.endsWith("/*"),`Route path "${J}" will be treated as if it were "${J.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${J.replace(/\*$/,"/*")}".`);let ce=[],Me="^"+J.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(le,n,tt)=>(ce.push({paramName:n,isOptional:tt!=null}),tt?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return J.endsWith("*")?(ce.push({paramName:"*"}),Me+=J==="*"||J==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):me?Me+="\\/*$":J!==""&&J!=="/"&&(Me+="(?:(?=\\/|$))"),[new RegExp(Me,ue?void 0:"i"),ce]}function BS(J){try{return J.split("/").map(ue=>decodeURIComponent(ue).replace(/\//g,"%2F")).join("/")}catch(ue){return Sp(!1,`The URL path "${J}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${ue}).`),J}}function l_(J,ue){if(ue==="/")return J;if(!J.toLowerCase().startsWith(ue.toLowerCase()))return null;let me=ue.endsWith("/")?ue.length-1:ue.length,ce=J.charAt(me);return ce&&ce!=="/"?null:J.slice(me)||"/"}var FS=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,NS=J=>FS.test(J);function VS(J,ue="/"){let{pathname:me,search:ce="",hash:Me=""}=typeof J=="string"?dg(J):J,Pe;if(me)if(NS(me))Pe=me;else{if(me.includes("//")){let le=me;me=me.replace(/\/\/+/g,"/"),Sp(!1,`Pathnames cannot have embedded double slashes - normalizing ${le} -> ${me}`)}me.startsWith("/")?Pe=o1(me.substring(1),"/"):Pe=o1(me,ue)}else Pe=ue;return{pathname:Pe,search:GS(ce),hash:qS(Me)}}function o1(J,ue){let me=ue.replace(/\/+$/,"").split("/");return J.split("/").forEach(Me=>{Me===".."?me.length>1&&me.pop():Me!=="."&&me.push(Me)}),me.length>1?me.join("/"):"/"}function Qx(J,ue,me,ce){return`Cannot include a '${J}' character in a manually specified \`to.${ue}\` field [${JSON.stringify(ce)}].  Please separate it out to the \`to.${me}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function US(J){return J.filter((ue,me)=>me===0||ue.route.path&&ue.route.path.length>0)}function O1(J){let ue=US(J);return ue.map((me,ce)=>ce===ue.length-1?me.pathname:me.pathnameBase)}function B1(J,ue,me,ce=!1){let Me;typeof J=="string"?Me=dg(J):(Me={...J},Ic(!Me.pathname||!Me.pathname.includes("?"),Qx("?","pathname","search",Me)),Ic(!Me.pathname||!Me.pathname.includes("#"),Qx("#","pathname","hash",Me)),Ic(!Me.search||!Me.search.includes("#"),Qx("#","search","hash",Me)));let Pe=J===""||Me.pathname==="",le=Pe?"/":Me.pathname,n;if(le==null)n=me;else{let ut=ue.length-1;if(!ce&&le.startsWith("..")){let bt=le.split("/");for(;bt[0]==="..";)bt.shift(),ut-=1;Me.pathname=bt.join("/")}n=ut>=0?ue[ut]:"/"}let tt=VS(Me,n),ke=le&&le!=="/"&&le.endsWith("/"),Rt=(Pe||le===".")&&me.endsWith("/");return!tt.pathname.endsWith("/")&&(ke||Rt)&&(tt.pathname+="/"),tt}var o_=J=>J.join("/").replace(/\/\/+/g,"/"),jS=J=>J.replace(/\/+$/,"").replace(/^\/*/,"/"),GS=J=>!J||J==="?"?"":J.startsWith("?")?J:"?"+J,qS=J=>!J||J==="#"?"":J.startsWith("#")?J:"#"+J;function HS(J){return J!=null&&typeof J.status=="number"&&typeof J.statusText=="string"&&typeof J.internal=="boolean"&&"data"in J}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var F1=["POST","PUT","PATCH","DELETE"];new Set(F1);var $S=["GET",...F1];new Set($S);var fg=Ft.createContext(null);fg.displayName="DataRouter";var Wy=Ft.createContext(null);Wy.displayName="DataRouterState";Ft.createContext(!1);var N1=Ft.createContext({isTransitioning:!1});N1.displayName="ViewTransition";var ZS=Ft.createContext(new Map);ZS.displayName="Fetchers";var XS=Ft.createContext(null);XS.displayName="Await";var Lm=Ft.createContext(null);Lm.displayName="Navigation";var Jg=Ft.createContext(null);Jg.displayName="Location";var km=Ft.createContext({outlet:null,matches:[],isDataRoute:!1});km.displayName="Route";var cv=Ft.createContext(null);cv.displayName="RouteError";function WS(J,{relative:ue}={}){Ic(Qg(),"useHref() may be used only in the context of a <Router> component.");let{basename:me,navigator:ce}=Ft.useContext(Lm),{hash:Me,pathname:Pe,search:le}=ey(J,{relative:ue}),n=Pe;return me!=="/"&&(n=Pe==="/"?me:o_([me,Pe])),ce.createHref({pathname:n,search:le,hash:Me})}function Qg(){return Ft.useContext(Jg)!=null}function E_(){return Ic(Qg(),"useLocation() may be used only in the context of a <Router> component."),Ft.useContext(Jg).location}var V1="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function U1(J){Ft.useContext(Lm).static||Ft.useLayoutEffect(J)}function pg(){let{isDataRoute:J}=Ft.useContext(km);return J?lE():YS()}function YS(){Ic(Qg(),"useNavigate() may be used only in the context of a <Router> component.");let J=Ft.useContext(fg),{basename:ue,navigator:me}=Ft.useContext(Lm),{matches:ce}=Ft.useContext(km),{pathname:Me}=E_(),Pe=JSON.stringify(O1(ce)),le=Ft.useRef(!1);return U1(()=>{le.current=!0}),Ft.useCallback((tt,ke={})=>{if(Sp(le.current,V1),!le.current)return;if(typeof tt=="number"){me.go(tt);return}let Rt=B1(tt,JSON.parse(Pe),Me,ke.relative==="path");J==null&&ue!=="/"&&(Rt.pathname=Rt.pathname==="/"?ue:o_([ue,Rt.pathname])),(ke.replace?me.replace:me.push)(Rt,ke.state,ke)},[ue,me,Pe,Me,J])}Ft.createContext(null);function j1(){let{matches:J}=Ft.useContext(km),ue=J[J.length-1];return ue?ue.params:{}}function ey(J,{relative:ue}={}){let{matches:me}=Ft.useContext(km),{pathname:ce}=E_(),Me=JSON.stringify(O1(me));return Ft.useMemo(()=>B1(J,JSON.parse(Me),ce,ue==="path"),[J,Me,ce,ue])}function KS(J,ue){return G1(J,ue)}function G1(J,ue,me,ce,Me){Ic(Qg(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:Pe}=Ft.useContext(Lm),{matches:le}=Ft.useContext(km),n=le[le.length-1],tt=n?n.params:{},ke=n?n.pathname:"/",Rt=n?n.pathnameBase:"/",ut=n&&n.route;{let Ci=ut&&ut.path||"";q1(ke,!ut||Ci.endsWith("*")||Ci.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${ke}" (under <Route path="${Ci}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${Ci}"> to <Route path="${Ci==="/"?"*":`${Ci}/*`}">.`)}let bt=E_(),rn;if(ue){let Ci=typeof ue=="string"?dg(ue):ue;Ic(Rt==="/"||Ci.pathname?.startsWith(Rt),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${Rt}" but pathname "${Ci.pathname}" was given in the \`location\` prop.`),rn=Ci}else rn=bt;let on=rn.pathname||"/",Vi=on;if(Rt!=="/"){let Ci=Rt.replace(/^\//,"").split("/");Vi="/"+on.replace(/^\//,"").split("/").slice(Ci.length).join("/")}let Wi=P1(J,{pathname:Vi});Sp(ut||Wi!=null,`No routes matched location "${rn.pathname}${rn.search}${rn.hash}" `),Sp(Wi==null||Wi[Wi.length-1].route.element!==void 0||Wi[Wi.length-1].route.Component!==void 0||Wi[Wi.length-1].route.lazy!==void 0,`Matched leaf route at location "${rn.pathname}${rn.search}${rn.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let Tn=iE(Wi&&Wi.map(Ci=>Object.assign({},Ci,{params:Object.assign({},tt,Ci.params),pathname:o_([Rt,Pe.encodeLocation?Pe.encodeLocation(Ci.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Ci.pathname]),pathnameBase:Ci.pathnameBase==="/"?Rt:o_([Rt,Pe.encodeLocation?Pe.encodeLocation(Ci.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:Ci.pathnameBase])})),le,me,ce,Me);return ue&&Tn?Ft.createElement(Jg.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...rn},navigationType:"POP"}},Tn):Tn}function JS(){let J=oE(),ue=HS(J)?`${J.status} ${J.statusText}`:J instanceof Error?J.message:JSON.stringify(J),me=J instanceof Error?J.stack:null,ce="rgba(200,200,200, 0.5)",Me={padding:"0.5rem",backgroundColor:ce},Pe={padding:"2px 4px",backgroundColor:ce},le=null;return console.error("Error handled by React Router default ErrorBoundary:",J),le=Ft.createElement(Ft.Fragment,null,Ft.createElement("p",null," Hey developer "),Ft.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Ft.createElement("code",{style:Pe},"ErrorBoundary")," or"," ",Ft.createElement("code",{style:Pe},"errorElement")," prop on your route.")),Ft.createElement(Ft.Fragment,null,Ft.createElement("h2",null,"Unexpected Application Error!"),Ft.createElement("h3",{style:{fontStyle:"italic"}},ue),me?Ft.createElement("pre",{style:Me},me):null,le)}var QS=Ft.createElement(JS,null),eE=class extends Ft.Component{constructor(J){super(J),this.state={location:J.location,revalidation:J.revalidation,error:J.error}}static getDerivedStateFromError(J){return{error:J}}static getDerivedStateFromProps(J,ue){return ue.location!==J.location||ue.revalidation!=="idle"&&J.revalidation==="idle"?{error:J.error,location:J.location,revalidation:J.revalidation}:{error:J.error!==void 0?J.error:ue.error,location:ue.location,revalidation:J.revalidation||ue.revalidation}}componentDidCatch(J,ue){this.props.onError?this.props.onError(J,ue):console.error("React Router caught the following error during render",J)}render(){return this.state.error!==void 0?Ft.createElement(km.Provider,{value:this.props.routeContext},Ft.createElement(cv.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function tE({routeContext:J,match:ue,children:me}){let ce=Ft.useContext(fg);return ce&&ce.static&&ce.staticContext&&(ue.route.errorElement||ue.route.ErrorBoundary)&&(ce.staticContext._deepestRenderedBoundaryId=ue.route.id),Ft.createElement(km.Provider,{value:J},me)}function iE(J,ue=[],me=null,ce=null,Me=null){if(J==null){if(!me)return null;if(me.errors)J=me.matches;else if(ue.length===0&&!me.initialized&&me.matches.length>0)J=me.matches;else return null}let Pe=J,le=me?.errors;if(le!=null){let Rt=Pe.findIndex(ut=>ut.route.id&&le?.[ut.route.id]!==void 0);Ic(Rt>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(le).join(",")}`),Pe=Pe.slice(0,Math.min(Pe.length,Rt+1))}let n=!1,tt=-1;if(me)for(let Rt=0;Rt<Pe.length;Rt++){let ut=Pe[Rt];if((ut.route.HydrateFallback||ut.route.hydrateFallbackElement)&&(tt=Rt),ut.route.id){let{loaderData:bt,errors:rn}=me,on=ut.route.loader&&!bt.hasOwnProperty(ut.route.id)&&(!rn||rn[ut.route.id]===void 0);if(ut.route.lazy||on){n=!0,tt>=0?Pe=Pe.slice(0,tt+1):Pe=[Pe[0]];break}}}let ke=me&&ce?(Rt,ut)=>{ce(Rt,{location:me.location,params:me.matches?.[0]?.params??{},errorInfo:ut})}:void 0;return Pe.reduceRight((Rt,ut,bt)=>{let rn,on=!1,Vi=null,Wi=null;me&&(rn=le&&ut.route.id?le[ut.route.id]:void 0,Vi=ut.route.errorElement||QS,n&&(tt<0&&bt===0?(q1("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),on=!0,Wi=null):tt===bt&&(on=!0,Wi=ut.route.hydrateFallbackElement||null)));let Tn=ue.concat(Pe.slice(0,bt+1)),Ci=()=>{let Ji;return rn?Ji=Vi:on?Ji=Wi:ut.route.Component?Ji=Ft.createElement(ut.route.Component,null):ut.route.element?Ji=ut.route.element:Ji=Rt,Ft.createElement(tE,{match:ut,routeContext:{outlet:Rt,matches:Tn,isDataRoute:me!=null},children:Ji})};return me&&(ut.route.ErrorBoundary||ut.route.errorElement||bt===0)?Ft.createElement(eE,{location:me.location,revalidation:me.revalidation,component:Vi,error:rn,children:Ci(),routeContext:{outlet:null,matches:Tn,isDataRoute:!0},onError:ke}):Ci()},null)}function uv(J){return`${J} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function nE(J){let ue=Ft.useContext(fg);return Ic(ue,uv(J)),ue}function rE(J){let ue=Ft.useContext(Wy);return Ic(ue,uv(J)),ue}function aE(J){let ue=Ft.useContext(km);return Ic(ue,uv(J)),ue}function hv(J){let ue=aE(J),me=ue.matches[ue.matches.length-1];return Ic(me.route.id,`${J} can only be used on routes that contain a unique "id"`),me.route.id}function sE(){return hv("useRouteId")}function oE(){let J=Ft.useContext(cv),ue=rE("useRouteError"),me=hv("useRouteError");return J!==void 0?J:ue.errors?.[me]}function lE(){let{router:J}=nE("useNavigate"),ue=hv("useNavigate"),me=Ft.useRef(!1);return U1(()=>{me.current=!0}),Ft.useCallback(async(Me,Pe={})=>{Sp(me.current,V1),me.current&&(typeof Me=="number"?J.navigate(Me):await J.navigate(Me,{fromRouteId:ue,...Pe}))},[J,ue])}var l1={};function q1(J,ue,me){!ue&&!l1[J]&&(l1[J]=!0,Sp(!1,me))}Ft.memo(cE);function cE({routes:J,future:ue,state:me,unstable_onError:ce}){return G1(J,void 0,me,ce,ue)}function cm(J){Ic(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function uE({basename:J="/",children:ue=null,location:me,navigationType:ce="POP",navigator:Me,static:Pe=!1}){Ic(!Qg(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let le=J.replace(/^\/*/,"/"),n=Ft.useMemo(()=>({basename:le,navigator:Me,static:Pe,future:{}}),[le,Me,Pe]);typeof me=="string"&&(me=dg(me));let{pathname:tt="/",search:ke="",hash:Rt="",state:ut=null,key:bt="default"}=me,rn=Ft.useMemo(()=>{let on=l_(tt,le);return on==null?null:{location:{pathname:on,search:ke,hash:Rt,state:ut,key:bt},navigationType:ce}},[le,tt,ke,Rt,ut,bt,ce]);return Sp(rn!=null,`<Router basename="${le}"> is not able to match the URL "${tt}${ke}${Rt}" because it does not start with the basename, so the <Router> won't render anything.`),rn==null?null:Ft.createElement(Lm.Provider,{value:n},Ft.createElement(Jg.Provider,{children:ue,value:rn}))}function hE({children:J,location:ue}){return KS(sv(J),ue)}function sv(J,ue=[]){let me=[];return Ft.Children.forEach(J,(ce,Me)=>{if(!Ft.isValidElement(ce))return;let Pe=[...ue,Me];if(ce.type===Ft.Fragment){me.push.apply(me,sv(ce.props.children,Pe));return}Ic(ce.type===cm,`[${typeof ce.type=="string"?ce.type:ce.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Ic(!ce.props.index||!ce.props.children,"An index route cannot have child routes.");let le={id:ce.props.id||Pe.join("-"),caseSensitive:ce.props.caseSensitive,element:ce.props.element,Component:ce.props.Component,index:ce.props.index,path:ce.props.path,middleware:ce.props.middleware,loader:ce.props.loader,action:ce.props.action,hydrateFallbackElement:ce.props.hydrateFallbackElement,HydrateFallback:ce.props.HydrateFallback,errorElement:ce.props.errorElement,ErrorBoundary:ce.props.ErrorBoundary,hasErrorBoundary:ce.props.hasErrorBoundary===!0||ce.props.ErrorBoundary!=null||ce.props.errorElement!=null,shouldRevalidate:ce.props.shouldRevalidate,handle:ce.props.handle,lazy:ce.props.lazy};ce.props.children&&(le.children=sv(ce.props.children,Pe)),me.push(le)}),me}var Uy="get",jy="application/x-www-form-urlencoded";function Yy(J){return J!=null&&typeof J.tagName=="string"}function dE(J){return Yy(J)&&J.tagName.toLowerCase()==="button"}function fE(J){return Yy(J)&&J.tagName.toLowerCase()==="form"}function pE(J){return Yy(J)&&J.tagName.toLowerCase()==="input"}function mE(J){return!!(J.metaKey||J.altKey||J.ctrlKey||J.shiftKey)}function _E(J,ue){return J.button===0&&(!ue||ue==="_self")&&!mE(J)}function ov(J=""){return new URLSearchParams(typeof J=="string"||Array.isArray(J)||J instanceof URLSearchParams?J:Object.keys(J).reduce((ue,me)=>{let ce=J[me];return ue.concat(Array.isArray(ce)?ce.map(Me=>[me,Me]):[[me,ce]])},[]))}function gE(J,ue){let me=ov(J);return ue&&ue.forEach((ce,Me)=>{me.has(Me)||ue.getAll(Me).forEach(Pe=>{me.append(Me,Pe)})}),me}var Vy=null;function yE(){if(Vy===null)try{new FormData(document.createElement("form"),0),Vy=!1}catch{Vy=!0}return Vy}var xE=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ev(J){return J!=null&&!xE.has(J)?(Sp(!1,`"${J}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${jy}"`),null):J}function vE(J,ue){let me,ce,Me,Pe,le;if(fE(J)){let n=J.getAttribute("action");ce=n?l_(n,ue):null,me=J.getAttribute("method")||Uy,Me=ev(J.getAttribute("enctype"))||jy,Pe=new FormData(J)}else if(dE(J)||pE(J)&&(J.type==="submit"||J.type==="image")){let n=J.form;if(n==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let tt=J.getAttribute("formaction")||n.getAttribute("action");if(ce=tt?l_(tt,ue):null,me=J.getAttribute("formmethod")||n.getAttribute("method")||Uy,Me=ev(J.getAttribute("formenctype"))||ev(n.getAttribute("enctype"))||jy,Pe=new FormData(n,J),!yE()){let{name:ke,type:Rt,value:ut}=J;if(Rt==="image"){let bt=ke?`${ke}.`:"";Pe.append(`${bt}x`,"0"),Pe.append(`${bt}y`,"0")}else ke&&Pe.append(ke,ut)}}else{if(Yy(J))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');me=Uy,ce=null,Me=jy,le=J}return Pe&&Me==="text/plain"&&(le=Pe,Pe=void 0),{action:ce,method:me.toLowerCase(),encType:Me,formData:Pe,body:le}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function dv(J,ue){if(J===!1||J===null||typeof J>"u")throw new Error(ue)}function bE(J,ue,me){let ce=typeof J=="string"?new URL(J,typeof window>"u"?"server://singlefetch/":window.location.origin):J;return ce.pathname==="/"?ce.pathname=`_root.${me}`:ue&&l_(ce.pathname,ue)==="/"?ce.pathname=`${ue.replace(/\/$/,"")}/_root.${me}`:ce.pathname=`${ce.pathname.replace(/\/$/,"")}.${me}`,ce}async function wE(J,ue){if(J.id in ue)return ue[J.id];try{let me=await import(J.module);return ue[J.id]=me,me}catch(me){return console.error(`Error loading route module \`${J.module}\`, reloading page...`),console.error(me),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function TE(J){return J==null?!1:J.href==null?J.rel==="preload"&&typeof J.imageSrcSet=="string"&&typeof J.imageSizes=="string":typeof J.rel=="string"&&typeof J.href=="string"}async function SE(J,ue,me){let ce=await Promise.all(J.map(async Me=>{let Pe=ue.routes[Me.route.id];if(Pe){let le=await wE(Pe,me);return le.links?le.links():[]}return[]}));return ME(ce.flat(1).filter(TE).filter(Me=>Me.rel==="stylesheet"||Me.rel==="preload").map(Me=>Me.rel==="stylesheet"?{...Me,rel:"prefetch",as:"style"}:{...Me,rel:"prefetch"}))}function c1(J,ue,me,ce,Me,Pe){let le=(tt,ke)=>me[ke]?tt.route.id!==me[ke].route.id:!0,n=(tt,ke)=>me[ke].pathname!==tt.pathname||me[ke].route.path?.endsWith("*")&&me[ke].params["*"]!==tt.params["*"];return Pe==="assets"?ue.filter((tt,ke)=>le(tt,ke)||n(tt,ke)):Pe==="data"?ue.filter((tt,ke)=>{let Rt=ce.routes[tt.route.id];if(!Rt||!Rt.hasLoader)return!1;if(le(tt,ke)||n(tt,ke))return!0;if(tt.route.shouldRevalidate){let ut=tt.route.shouldRevalidate({currentUrl:new URL(Me.pathname+Me.search+Me.hash,window.origin),currentParams:me[0]?.params||{},nextUrl:new URL(J,window.origin),nextParams:tt.params,defaultShouldRevalidate:!0});if(typeof ut=="boolean")return ut}return!0}):[]}function EE(J,ue,{includeHydrateFallback:me}={}){return AE(J.map(ce=>{let Me=ue.routes[ce.route.id];if(!Me)return[];let Pe=[Me.module];return Me.clientActionModule&&(Pe=Pe.concat(Me.clientActionModule)),Me.clientLoaderModule&&(Pe=Pe.concat(Me.clientLoaderModule)),me&&Me.hydrateFallbackModule&&(Pe=Pe.concat(Me.hydrateFallbackModule)),Me.imports&&(Pe=Pe.concat(Me.imports)),Pe}).flat(1))}function AE(J){return[...new Set(J)]}function IE(J){let ue={},me=Object.keys(J).sort();for(let ce of me)ue[ce]=J[ce];return ue}function ME(J,ue){let me=new Set;return new Set(ue),J.reduce((ce,Me)=>{let Pe=JSON.stringify(IE(Me));return me.has(Pe)||(me.add(Pe),ce.push({key:Pe,link:Me})),ce},[])}function H1(){let J=Ft.useContext(fg);return dv(J,"You must render this element inside a <DataRouterContext.Provider> element"),J}function CE(){let J=Ft.useContext(Wy);return dv(J,"You must render this element inside a <DataRouterStateContext.Provider> element"),J}var fv=Ft.createContext(void 0);fv.displayName="FrameworkContext";function $1(){let J=Ft.useContext(fv);return dv(J,"You must render this element inside a <HydratedRouter> element"),J}function zE(J,ue){let me=Ft.useContext(fv),[ce,Me]=Ft.useState(!1),[Pe,le]=Ft.useState(!1),{onFocus:n,onBlur:tt,onMouseEnter:ke,onMouseLeave:Rt,onTouchStart:ut}=ue,bt=Ft.useRef(null);Ft.useEffect(()=>{if(J==="render"&&le(!0),J==="viewport"){let Vi=Tn=>{Tn.forEach(Ci=>{le(Ci.isIntersecting)})},Wi=new IntersectionObserver(Vi,{threshold:.5});return bt.current&&Wi.observe(bt.current),()=>{Wi.disconnect()}}},[J]),Ft.useEffect(()=>{if(ce){let Vi=setTimeout(()=>{le(!0)},100);return()=>{clearTimeout(Vi)}}},[ce]);let rn=()=>{Me(!0)},on=()=>{Me(!1),le(!1)};return me?J!=="intent"?[Pe,bt,{}]:[Pe,bt,{onFocus:Wg(n,rn),onBlur:Wg(tt,on),onMouseEnter:Wg(ke,rn),onMouseLeave:Wg(Rt,on),onTouchStart:Wg(ut,rn)}]:[!1,bt,{}]}function Wg(J,ue){return me=>{J&&J(me),me.defaultPrevented||ue(me)}}function DE({page:J,...ue}){let{router:me}=H1(),ce=Ft.useMemo(()=>P1(me.routes,J,me.basename),[me.routes,J,me.basename]);return ce?Ft.createElement(PE,{page:J,matches:ce,...ue}):null}function RE(J){let{manifest:ue,routeModules:me}=$1(),[ce,Me]=Ft.useState([]);return Ft.useEffect(()=>{let Pe=!1;return SE(J,ue,me).then(le=>{Pe||Me(le)}),()=>{Pe=!0}},[J,ue,me]),ce}function PE({page:J,matches:ue,...me}){let ce=E_(),{manifest:Me,routeModules:Pe}=$1(),{basename:le}=H1(),{loaderData:n,matches:tt}=CE(),ke=Ft.useMemo(()=>c1(J,ue,tt,Me,ce,"data"),[J,ue,tt,Me,ce]),Rt=Ft.useMemo(()=>c1(J,ue,tt,Me,ce,"assets"),[J,ue,tt,Me,ce]),ut=Ft.useMemo(()=>{if(J===ce.pathname+ce.search+ce.hash)return[];let on=new Set,Vi=!1;if(ue.forEach(Tn=>{let Ci=Me.routes[Tn.route.id];!Ci||!Ci.hasLoader||(!ke.some(Ji=>Ji.route.id===Tn.route.id)&&Tn.route.id in n&&Pe[Tn.route.id]?.shouldRevalidate||Ci.hasClientLoader?Vi=!0:on.add(Tn.route.id))}),on.size===0)return[];let Wi=bE(J,le,"data");return Vi&&on.size>0&&Wi.searchParams.set("_routes",ue.filter(Tn=>on.has(Tn.route.id)).map(Tn=>Tn.route.id).join(",")),[Wi.pathname+Wi.search]},[le,n,ce,Me,ke,ue,J,Pe]),bt=Ft.useMemo(()=>EE(Rt,Me),[Rt,Me]),rn=RE(Rt);return Ft.createElement(Ft.Fragment,null,ut.map(on=>Ft.createElement("link",{key:on,rel:"prefetch",as:"fetch",href:on,...me})),bt.map(on=>Ft.createElement("link",{key:on,rel:"modulepreload",href:on,...me})),rn.map(({key:on,link:Vi})=>Ft.createElement("link",{key:on,nonce:me.nonce,...Vi})))}function LE(...J){return ue=>{J.forEach(me=>{typeof me=="function"?me(ue):me!=null&&(me.current=ue)})}}var Z1=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{Z1&&(window.__reactRouterVersion="7.9.6")}catch{}function kE({basename:J,children:ue,window:me}){let ce=Ft.useRef();ce.current==null&&(ce.current=bS({window:me,v5Compat:!0}));let Me=ce.current,[Pe,le]=Ft.useState({action:Me.action,location:Me.location}),n=Ft.useCallback(tt=>{Ft.startTransition(()=>le(tt))},[le]);return Ft.useLayoutEffect(()=>Me.listen(n),[Me,n]),Ft.createElement(uE,{basename:J,children:ue,location:Pe.location,navigationType:Pe.action,navigator:Me})}var X1=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ih=Ft.forwardRef(function({onClick:ue,discover:me="render",prefetch:ce="none",relative:Me,reloadDocument:Pe,replace:le,state:n,target:tt,to:ke,preventScrollReset:Rt,viewTransition:ut,...bt},rn){let{basename:on}=Ft.useContext(Lm),Vi=typeof ke=="string"&&X1.test(ke),Wi,Tn=!1;if(typeof ke=="string"&&Vi&&(Wi=ke,Z1))try{let Vt=new URL(window.location.href),Hi=ke.startsWith("//")?new URL(Vt.protocol+ke):new URL(ke),dn=l_(Hi.pathname,on);Hi.origin===Vt.origin&&dn!=null?ke=dn+Hi.search+Hi.hash:Tn=!0}catch{Sp(!1,`<Link to="${ke}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let Ci=WS(ke,{relative:Me}),[Ji,Vn,Oi]=zE(ce,bt),Hn=FE(ke,{replace:le,state:n,target:tt,preventScrollReset:Rt,relative:Me,viewTransition:ut});function qi(Vt){ue&&ue(Vt),Vt.defaultPrevented||Hn(Vt)}let Ot=Ft.createElement("a",{...bt,...Oi,href:Wi||Ci,onClick:Tn||Pe?ue:qi,ref:LE(rn,Vn),target:tt,"data-discover":!Vi&&me==="render"?"true":void 0});return Ji&&!Vi?Ft.createElement(Ft.Fragment,null,Ot,Ft.createElement(DE,{page:Ci})):Ot});Ih.displayName="Link";var nl=Ft.forwardRef(function({"aria-current":ue="page",caseSensitive:me=!1,className:ce="",end:Me=!1,style:Pe,to:le,viewTransition:n,children:tt,...ke},Rt){let ut=ey(le,{relative:ke.relative}),bt=E_(),rn=Ft.useContext(Wy),{navigator:on,basename:Vi}=Ft.useContext(Lm),Wi=rn!=null&&GE(ut)&&n===!0,Tn=on.encodeLocation?on.encodeLocation(ut).pathname:ut.pathname,Ci=bt.pathname,Ji=rn&&rn.navigation&&rn.navigation.location?rn.navigation.location.pathname:null;me||(Ci=Ci.toLowerCase(),Ji=Ji?Ji.toLowerCase():null,Tn=Tn.toLowerCase()),Ji&&Vi&&(Ji=l_(Ji,Vi)||Ji);const Vn=Tn!=="/"&&Tn.endsWith("/")?Tn.length-1:Tn.length;let Oi=Ci===Tn||!Me&&Ci.startsWith(Tn)&&Ci.charAt(Vn)==="/",Hn=Ji!=null&&(Ji===Tn||!Me&&Ji.startsWith(Tn)&&Ji.charAt(Tn.length)==="/"),qi={isActive:Oi,isPending:Hn,isTransitioning:Wi},Ot=Oi?ue:void 0,Vt;typeof ce=="function"?Vt=ce(qi):Vt=[ce,Oi?"active":null,Hn?"pending":null,Wi?"transitioning":null].filter(Boolean).join(" ");let Hi=typeof Pe=="function"?Pe(qi):Pe;return Ft.createElement(Ih,{...ke,"aria-current":Ot,className:Vt,ref:Rt,style:Hi,to:le,viewTransition:n},typeof tt=="function"?tt(qi):tt)});nl.displayName="NavLink";var OE=Ft.forwardRef(({discover:J="render",fetcherKey:ue,navigate:me,reloadDocument:ce,replace:Me,state:Pe,method:le=Uy,action:n,onSubmit:tt,relative:ke,preventScrollReset:Rt,viewTransition:ut,...bt},rn)=>{let on=UE(),Vi=jE(n,{relative:ke}),Wi=le.toLowerCase()==="get"?"get":"post",Tn=typeof n=="string"&&X1.test(n),Ci=Ji=>{if(tt&&tt(Ji),Ji.defaultPrevented)return;Ji.preventDefault();let Vn=Ji.nativeEvent.submitter,Oi=Vn?.getAttribute("formmethod")||le;on(Vn||Ji.currentTarget,{fetcherKey:ue,method:Oi,navigate:me,replace:Me,state:Pe,relative:ke,preventScrollReset:Rt,viewTransition:ut})};return Ft.createElement("form",{ref:rn,method:Wi,action:Vi,onSubmit:ce?tt:Ci,...bt,"data-discover":!Tn&&J==="render"?"true":void 0})});OE.displayName="Form";function BE(J){return`${J} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function W1(J){let ue=Ft.useContext(fg);return Ic(ue,BE(J)),ue}function FE(J,{target:ue,replace:me,state:ce,preventScrollReset:Me,relative:Pe,viewTransition:le}={}){let n=pg(),tt=E_(),ke=ey(J,{relative:Pe});return Ft.useCallback(Rt=>{if(_E(Rt,ue)){Rt.preventDefault();let ut=me!==void 0?me:Yg(tt)===Yg(ke);n(J,{replace:ut,state:ce,preventScrollReset:Me,relative:Pe,viewTransition:le})}},[tt,n,ke,me,ce,ue,J,Me,Pe,le])}function Y1(J){Sp(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let ue=Ft.useRef(ov(J)),me=Ft.useRef(!1),ce=E_(),Me=Ft.useMemo(()=>gE(ce.search,me.current?null:ue.current),[ce.search]),Pe=pg(),le=Ft.useCallback((n,tt)=>{const ke=ov(typeof n=="function"?n(new URLSearchParams(Me)):n);me.current=!0,Pe("?"+ke,tt)},[Pe,Me]);return[Me,le]}var NE=0,VE=()=>`__${String(++NE)}__`;function UE(){let{router:J}=W1("useSubmit"),{basename:ue}=Ft.useContext(Lm),me=sE();return Ft.useCallback(async(ce,Me={})=>{let{action:Pe,method:le,encType:n,formData:tt,body:ke}=vE(ce,ue);if(Me.navigate===!1){let Rt=Me.fetcherKey||VE();await J.fetch(Rt,me,Me.action||Pe,{preventScrollReset:Me.preventScrollReset,formData:tt,body:ke,formMethod:Me.method||le,formEncType:Me.encType||n,flushSync:Me.flushSync})}else await J.navigate(Me.action||Pe,{preventScrollReset:Me.preventScrollReset,formData:tt,body:ke,formMethod:Me.method||le,formEncType:Me.encType||n,replace:Me.replace,state:Me.state,fromRouteId:me,flushSync:Me.flushSync,viewTransition:Me.viewTransition})},[J,ue,me])}function jE(J,{relative:ue}={}){let{basename:me}=Ft.useContext(Lm),ce=Ft.useContext(km);Ic(ce,"useFormAction must be used inside a RouteContext");let[Me]=ce.matches.slice(-1),Pe={...ey(J||".",{relative:ue})},le=E_();if(J==null){Pe.search=le.search;let n=new URLSearchParams(Pe.search),tt=n.getAll("index");if(tt.some(Rt=>Rt==="")){n.delete("index"),tt.filter(ut=>ut).forEach(ut=>n.append("index",ut));let Rt=n.toString();Pe.search=Rt?`?${Rt}`:""}}return(!J||J===".")&&Me.route.index&&(Pe.search=Pe.search?Pe.search.replace(/^\?/,"?index&"):"?index"),me!=="/"&&(Pe.pathname=Pe.pathname==="/"?me:o_([me,Pe.pathname])),Yg(Pe)}function GE(J,{relative:ue}={}){let me=Ft.useContext(N1);Ic(me!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:ce}=W1("useViewTransitionState"),Me=ey(J,{relative:ue});if(!me.isTransitioning)return!1;let Pe=l_(me.currentLocation.pathname,ce)||me.currentLocation.pathname,le=l_(me.nextLocation.pathname,ce)||me.nextLocation.pathname;return Zy(Me.pathname,le)!=null||Zy(Me.pathname,Pe)!=null}var K1=R1();const qE=[{title:"Bus Rapid Transit",routes:[{code:"A",color:"#F00",name:"Route A"},{code:"B*",color:"#84BC00",name:"Route B (limited service)"},{code:"F*",color:"#0039AA",name:"Route F (limited service)"}]},{title:"Campus Buses",routes:[{code:"80",color:"#FF7300",name:"Route 80"},{code:"82",color:"#00B7C8",name:"Route 82"},{code:"81",color:"#FF7300",name:"Route 81"},{code:"84",color:"#C1C800",name:"Route 84"}]},{title:"Standard Service",routes:[{code:"C",color:"#00B7C8",name:"Route C"},{code:"D",color:"#FFA600",name:"Route D"},{code:"E",color:"#C1C800",name:"Route E"},{code:"G",color:"#00B7C8",name:"Route G"},{code:"H",color:"#C1C800",name:"Route H"},{code:"J",color:"#C1C800",name:"Route J"},{code:"L",color:"#9269EB",name:"Route L"},{code:"O",color:"#BC009D",name:"Route O"},{code:"P",color:"#C1C800",name:"Route P"},{code:"R",color:"#BC009D",name:"Route R"},{code:"S",color:"#C1C800",name:"Route S"},{code:"W",color:"#9269EB",name:"Route W"},{code:"28",color:"#00B7C8",name:"Route 28"},{code:"38",color:"#FF7300",name:"Route 38"},{code:"55",color:"#FFA600",name:"Route 55"},{code:"60",color:"#9269EB",name:"Route 60"},{code:"61",color:"#9269EB",name:"Route 61"},{code:"62",color:"#FFA600",name:"Route 62"},{code:"63",color:"#9269EB",name:"Route 63"},{code:"64",color:"#FF7300",name:"Route 64"},{code:"65",color:"#BC009D",name:"Route 65"},{code:"75",color:"#9269EB",name:"Route 75"}]}];function HE(){const J=new Date,ue=J.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),me=J.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return Ae.jsx("main",{className:"routes-root",children:Ae.jsxs("div",{className:"routes-inner",children:[Ae.jsxs("header",{className:"home-header",children:[Ae.jsxs("div",{className:"home-header-top",children:[Ae.jsxs(Ih,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[Ae.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),Ae.jsxs("div",{className:"home-wordmark",children:[Ae.jsx("div",{className:"home-logo-text-main",children:"badger"}),Ae.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),Ae.jsxs("div",{className:"home-clock","aria-live":"off",children:[Ae.jsx("div",{className:"home-clock-date",children:me}),Ae.jsx("div",{className:"home-clock-time",children:ue})]})]}),Ae.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[Ae.jsx(nl,{to:"/",end:!0,className:({isActive:ce})=>`home-nav-tab${ce?" home-nav-tab--active":""}`,children:"Home"}),Ae.jsx(nl,{to:"/recent",className:({isActive:ce})=>`home-nav-tab${ce?" home-nav-tab--active":""}`,children:"Recent"}),Ae.jsx(nl,{to:"/map",className:({isActive:ce})=>`home-nav-tab${ce?" home-nav-tab--active":""}`,children:"Map"}),Ae.jsx(nl,{to:"/routes",className:({isActive:ce})=>`home-nav-tab${ce?" home-nav-tab--active":""}`,children:"Routes"})]})]}),Ae.jsxs("section",{className:"routes-hero","aria-labelledby":"routes-title",children:[Ae.jsx("h1",{id:"routes-title",className:"routes-hero-title",children:" Routes"}),Ae.jsx("p",{className:"routes-hero-subtitle",children:"Select a route to see live bus locations"})]}),Ae.jsx("div",{className:"routes-groups",children:qE.map(ce=>Ae.jsxs("section",{className:"routes-panel","aria-labelledby":`group-${ce.title.replace(/\s+/g,"-").toLowerCase()}`,children:[Ae.jsx("h2",{id:`group-${ce.title.replace(/\s+/g,"-").toLowerCase()}`,className:"routes-panel-title",children:ce.title}),Ae.jsx("nav",{className:"routes-chip-row","aria-label":`${ce.title} routes`,children:ce.routes.map(Me=>Ae.jsx(Ih,{to:`/map/${Me.code}`,className:"route-chip-link",style:{backgroundColor:Me.color},"aria-label":`View ${Me.name} on map`,children:Ae.jsx("span",{"aria-hidden":"true",children:Me.code})},Me.code))})]},ce.title))}),Ae.jsxs("footer",{className:"home-footer routes-footer",children:[Ae.jsxs("div",{className:"home-footer-left",children:[Ae.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),Ae.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),Ae.jsxs("div",{className:"home-footer-links",children:[Ae.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),Ae.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),Ae.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}const $E="modulepreload",ZE=function(J){return"/p87/"+J},u1={},J1=function(ue,me,ce){let Me=Promise.resolve();if(me&&me.length>0){let ke=function(Rt){return Promise.all(Rt.map(ut=>Promise.resolve(ut).then(bt=>({status:"fulfilled",value:bt}),bt=>({status:"rejected",reason:bt}))))};var le=ke;document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),tt=n?.nonce||n?.getAttribute("nonce");Me=ke(me.map(Rt=>{if(Rt=ZE(Rt),Rt in u1)return;u1[Rt]=!0;const ut=Rt.endsWith(".css"),bt=ut?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${Rt}"]${bt}`))return;const rn=document.createElement("link");if(rn.rel=ut?"stylesheet":$E,ut||(rn.as="script"),rn.crossOrigin="",rn.href=Rt,tt&&rn.setAttribute("nonce",tt),document.head.appendChild(rn),ut)return new Promise((on,Vi)=>{rn.addEventListener("load",on),rn.addEventListener("error",()=>Vi(new Error(`Unable to preload CSS for ${Rt}`)))})}))}function Pe(n){const tt=new Event("vite:preloadError",{cancelable:!0});if(tt.payload=n,window.dispatchEvent(tt),!tt.defaultPrevented)throw n}return Me.then(n=>{for(const tt of n||[])tt.status==="rejected"&&Pe(tt.reason);return ue().catch(Pe)})},Q1=Ft.createContext(null);function ew(){var J;const ue=(J=Ft.useContext(Q1))===null||J===void 0?void 0:J.maps,me=Ft.useContext(q_);return Ft.useMemo(()=>({...ue,current:me?.map}),[ue,me])}function XE(J,ue){const me=Array.isArray(J)?J[0]:J?J.x:0,ce=Array.isArray(J)?J[1]:J?J.y:0,Me=Array.isArray(ue)?ue[0]:ue?ue.x:0,Pe=Array.isArray(ue)?ue[1]:ue?ue.y:0;return me===Me&&ce===Pe}function Yf(J,ue){if(J===ue)return!0;if(!J||!ue)return!1;if(Array.isArray(J)){if(!Array.isArray(ue)||J.length!==ue.length)return!1;for(let me=0;me<J.length;me++)if(!Yf(J[me],ue[me]))return!1;return!0}else if(Array.isArray(ue))return!1;if(typeof J=="object"&&typeof ue=="object"){const me=Object.keys(J),ce=Object.keys(ue);if(me.length!==ce.length)return!1;for(const Me of me)if(!ue.hasOwnProperty(Me)||!Yf(J[Me],ue[Me]))return!1;return!0}return!1}function WE(J){const ue=J.clone();return ue.pixelsToGLUnits=J.pixelsToGLUnits,ue}function h1(J,ue){if(!J.getProjection)return;const me=J.getProjection(),ce=ue.getProjection();Yf(me,ce)||ue.setProjection(me)}function d1(J){return{longitude:J.center.lng,latitude:J.center.lat,zoom:J.zoom,pitch:J.pitch,bearing:J.bearing,padding:J.padding}}function f1(J,ue){const me=ue.viewState||ue;let ce=!1;if("zoom"in me){const Me=J.zoom;J.zoom=me.zoom,ce=ce||Me!==J.zoom}if("bearing"in me){const Me=J.bearing;J.bearing=me.bearing,ce=ce||Me!==J.bearing}if("pitch"in me){const Me=J.pitch;J.pitch=me.pitch,ce=ce||Me!==J.pitch}if(me.padding&&!J.isPaddingEqual(me.padding)&&(ce=!0,J.padding=me.padding),"longitude"in me&&"latitude"in me){const Me=J.center;J.center=new Me.constructor(me.longitude,me.latitude),ce=ce||Me!==J.center}return ce}const YE=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function p1(J){if(!J)return null;if(typeof J=="string"||("toJS"in J&&(J=J.toJS()),!J.layers))return J;const ue={};for(const ce of J.layers)ue[ce.id]=ce;const me=J.layers.map(ce=>{let Me=null;"interactive"in ce&&(Me=Object.assign({},ce),delete Me.interactive);const Pe=ue[ce.ref];if(Pe){Me=Me||Object.assign({},ce),delete Me.ref;for(const le of YE)le in Pe&&(Me[le]=Pe[le])}return Me||ce});return{...J,layers:me}}var m1={};const _1={version:8,sources:{},layers:[]},g1={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},tv={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},y1={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},KE=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],JE=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class hg{constructor(ue,me,ce){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=Me=>{const Pe=this.props[y1[Me.type]];Pe?Pe(Me):Me.type==="error"&&console.error(Me.error)},this._onPointerEvent=Me=>{(Me.type==="mousemove"||Me.type==="mouseout")&&this._updateHover(Me);const Pe=this.props[g1[Me.type]];Pe&&(this.props.interactiveLayerIds&&Me.type!=="mouseover"&&Me.type!=="mouseout"&&(Me.features=this._hoveredFeatures||this._queryRenderedFeatures(Me.point)),Pe(Me),delete Me.features)},this._onCameraEvent=Me=>{if(!this._internalUpdate){const Pe=this.props[tv[Me.type]];Pe&&Pe(Me)}Me.type in this._deferredEvents&&(this._deferredEvents[Me.type]=!1)},this._MapClass=ue,this.props=me,this._initialize(ce)}get map(){return this._map}get transform(){return this._renderTransform}setProps(ue){const me=this.props;this.props=ue;const ce=this._updateSettings(ue,me);ce&&this._createShadowTransform(this._map);const Me=this._updateSize(ue),Pe=this._updateViewState(ue,!0);this._updateStyle(ue,me),this._updateStyleComponents(ue,me),this._updateHandlers(ue,me),(ce||Me||Pe&&!this._map.isMoving())&&this.redraw()}static reuse(ue,me){const ce=hg.savedMaps.pop();if(!ce)return null;const Me=ce.map,Pe=Me.getContainer();for(me.className=Pe.className;Pe.childNodes.length>0;)me.appendChild(Pe.childNodes[0]);Me._container=me;const le=Me._resizeObserver;le&&(le.disconnect(),le.observe(me)),ce.setProps({...ue,styleDiffing:!1}),Me.resize();const{initialViewState:n}=ue;return n&&(n.bounds?Me.fitBounds(n.bounds,{...n.fitBoundsOptions,duration:0}):ce._updateViewState(n,!1)),Me.isStyleLoaded()?Me.fire("load"):Me.once("styledata",()=>Me.fire("load")),Me._update(),ce}_initialize(ue){const{props:me}=this,{mapStyle:ce=_1}=me,Me={...me,...me.initialViewState,accessToken:me.mapboxAccessToken||QE()||null,container:ue,style:p1(ce)},Pe=Me.initialViewState||Me.viewState||Me;if(Object.assign(Me,{center:[Pe.longitude||0,Pe.latitude||0],zoom:Pe.zoom||0,pitch:Pe.pitch||0,bearing:Pe.bearing||0}),me.gl){const Rt=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=Rt,me.gl)}const le=new this._MapClass(Me);Pe.padding&&le.setPadding(Pe.padding),me.cursor&&(le.getCanvas().style.cursor=me.cursor),this._createShadowTransform(le);const n=le._render;le._render=Rt=>{this._inRender=!0,n.call(le,Rt),this._inRender=!1};const tt=le._renderTaskQueue.run;le._renderTaskQueue.run=Rt=>{tt.call(le._renderTaskQueue,Rt),this._onBeforeRepaint()},le.on("render",()=>this._onAfterRepaint());const ke=le.fire;le.fire=this._fireEvent.bind(this,ke),le.on("resize",()=>{this._renderTransform.resize(le.transform.width,le.transform.height)}),le.on("styledata",()=>{this._updateStyleComponents(this.props,{}),h1(le.transform,this._renderTransform)}),le.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const Rt in g1)le.on(Rt,this._onPointerEvent);for(const Rt in tv)le.on(Rt,this._onCameraEvent);for(const Rt in y1)le.on(Rt,this._onEvent);this._map=le}recycle(){const me=this.map.getContainer().querySelector("[mapboxgl-children]");me?.remove(),hg.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const ue=this._map;!this._inRender&&ue.style&&(ue._frame&&(ue._frame.cancel(),ue._frame=null),ue._render())}_createShadowTransform(ue){const me=WE(ue.transform);ue.painter.transform=me,this._renderTransform=me}_updateSize(ue){const{viewState:me}=ue;if(me){const ce=this._map;if(me.width!==ce.transform.width||me.height!==ce.transform.height)return ce.resize(),!0}return!1}_updateViewState(ue,me){if(this._internalUpdate)return!1;const ce=this._map,Me=this._renderTransform,{zoom:Pe,pitch:le,bearing:n}=Me,tt=ce.isMoving();tt&&(Me.cameraElevationReference="sea");const ke=f1(Me,{...d1(ce.transform),...ue});if(tt&&(Me.cameraElevationReference="ground"),ke&&me){const Rt=this._deferredEvents;Rt.move=!0,Rt.zoom||(Rt.zoom=Pe!==Me.zoom),Rt.rotate||(Rt.rotate=n!==Me.bearing),Rt.pitch||(Rt.pitch=le!==Me.pitch)}return tt||f1(ce.transform,ue),ke}_updateSettings(ue,me){const ce=this._map;let Me=!1;for(const Pe of KE)if(Pe in ue&&!Yf(ue[Pe],me[Pe])){Me=!0;const le=ce[`set${Pe[0].toUpperCase()}${Pe.slice(1)}`];le?.call(ce,ue[Pe])}return Me}_updateStyle(ue,me){if(ue.cursor!==me.cursor&&(this._map.getCanvas().style.cursor=ue.cursor||""),ue.mapStyle!==me.mapStyle){const{mapStyle:ce=_1,styleDiffing:Me=!0}=ue,Pe={diff:Me};return"localIdeographFontFamily"in ue&&(Pe.localIdeographFontFamily=ue.localIdeographFontFamily),this._map.setStyle(p1(ce),Pe),!0}return!1}_updateStyleComponents(ue,me){const ce=this._map;let Me=!1;return ce.isStyleLoaded()&&("light"in ue&&ce.setLight&&!Yf(ue.light,me.light)&&(Me=!0,ce.setLight(ue.light)),"fog"in ue&&ce.setFog&&!Yf(ue.fog,me.fog)&&(Me=!0,ce.setFog(ue.fog)),"terrain"in ue&&ce.setTerrain&&!Yf(ue.terrain,me.terrain)&&(!ue.terrain||ce.getSource(ue.terrain.source))&&(Me=!0,ce.setTerrain(ue.terrain))),Me}_updateHandlers(ue,me){var ce,Me;const Pe=this._map;let le=!1;for(const n of JE){const tt=(ce=ue[n])!==null&&ce!==void 0?ce:!0,ke=(Me=me[n])!==null&&Me!==void 0?Me:!0;Yf(tt,ke)||(le=!0,tt?Pe[n].enable(tt):Pe[n].disable())}return le}_queryRenderedFeatures(ue){const me=this._map,ce=me.transform,{interactiveLayerIds:Me=[]}=this.props;try{return me.transform=this._renderTransform,me.queryRenderedFeatures(ue,{layers:Me.filter(me.getLayer.bind(me))})}catch{return[]}finally{me.transform=ce}}_updateHover(ue){var me;const{props:ce}=this;if(ce.interactiveLayerIds&&(ce.onMouseMove||ce.onMouseEnter||ce.onMouseLeave)){const Pe=ue.type,le=((me=this._hoveredFeatures)===null||me===void 0?void 0:me.length)>0,n=this._queryRenderedFeatures(ue.point),tt=n.length>0;!tt&&le&&(ue.type="mouseleave",this._onPointerEvent(ue)),this._hoveredFeatures=n,tt&&!le&&(ue.type="mouseenter",this._onPointerEvent(ue)),ue.type=Pe}else this._hoveredFeatures=null}_fireEvent(ue,me,ce){const Me=this._map,Pe=Me.transform,le=typeof me=="string"?me:me.type;return le==="move"&&this._updateViewState(this.props,!1),le in tv&&(typeof me=="object"&&(me.viewState=d1(Pe)),this._map.isMoving())?(Me.transform=this._renderTransform,ue.call(Me,me,ce),Me.transform=Pe,Me):(ue.call(Me,me,ce),Me)}_onBeforeRepaint(){const ue=this._map;this._internalUpdate=!0;for(const ce in this._deferredEvents)this._deferredEvents[ce]&&ue.fire(ce);this._internalUpdate=!1;const me=this._map.transform;ue.transform=this._renderTransform,this._onAfterRepaint=()=>{h1(this._renderTransform,me),ue.transform=me}}}hg.savedMaps=[];function QE(){let J=null;if(typeof location<"u"){const ue=/access_token=([^&\/]*)/.exec(location.search);J=ue&&ue[1]}try{J=J||m1.MapboxAccessToken}catch{}try{J=J||m1.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return J}const eA=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function tA(J){if(!J)return null;const ue=J.map,me={getMap:()=>ue,getCenter:()=>J.transform.center,getZoom:()=>J.transform.zoom,getBearing:()=>J.transform.bearing,getPitch:()=>J.transform.pitch,getPadding:()=>J.transform.padding,getBounds:()=>J.transform.getBounds(),project:ce=>{const Me=ue.transform;ue.transform=J.transform;const Pe=ue.project(ce);return ue.transform=Me,Pe},unproject:ce=>{const Me=ue.transform;ue.transform=J.transform;const Pe=ue.unproject(ce);return ue.transform=Me,Pe},queryTerrainElevation:(ce,Me)=>{const Pe=ue.transform;ue.transform=J.transform;const le=ue.queryTerrainElevation(ce,Me);return ue.transform=Pe,le},queryRenderedFeatures:(ce,Me)=>{const Pe=ue.transform;ue.transform=J.transform;const le=ue.queryRenderedFeatures(ce,Me);return ue.transform=Pe,le}};for(const ce of iA(ue))!(ce in me)&&!eA.includes(ce)&&(me[ce]=ue[ce].bind(ue));return me}function iA(J){const ue=new Set;let me=J;for(;me;){for(const ce of Object.getOwnPropertyNames(me))ce[0]!=="_"&&typeof J[ce]=="function"&&ce!=="fire"&&ce!=="setEventedParent"&&ue.add(ce);me=Object.getPrototypeOf(me)}return Array.from(ue)}const nA=typeof document<"u"?Ft.useLayoutEffect:Ft.useEffect,rA=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function aA(J,ue){for(const ce of rA)ce in ue&&(J[ce]=ue[ce]);const{RTLTextPlugin:me="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=ue;me&&J.getRTLTextPluginStatus&&J.getRTLTextPluginStatus()==="unavailable"&&J.setRTLTextPlugin(me,ce=>{ce&&console.error(ce)},!0)}const q_=Ft.createContext(null);function tw(J,ue,me){const ce=Ft.useContext(Q1),[Me,Pe]=Ft.useState(null),le=Ft.useRef(),{current:n}=Ft.useRef({mapLib:null,map:null});Ft.useEffect(()=>{const Rt=J.mapLib;let ut=!0,bt;return Promise.resolve(Rt||me).then(rn=>{if(!ut)return;if(!rn)throw new Error("Invalid mapLib");const on="Map"in rn?rn:rn.default;if(!on.Map)throw new Error("Invalid mapLib");if(aA(on,J),!on.supported||on.supported(J))J.reuseMaps&&(bt=hg.reuse(J,le.current)),bt||(bt=new hg(on.Map,J,le.current)),n.map=tA(bt),n.mapLib=on,Pe(bt),ce?.onMapMount(n.map,J.id);else throw new Error("Map is not supported by this browser")}).catch(rn=>{const{onError:on}=J;on?on({type:"error",target:null,originalEvent:null,error:rn}):console.error(rn)}),()=>{ut=!1,bt&&(ce?.onMapUnmount(J.id),J.reuseMaps?bt.recycle():bt.destroy())}},[]),nA(()=>{Me&&Me.setProps(J)}),Ft.useImperativeHandle(ue,()=>n.map,[Me]);const tt=Ft.useMemo(()=>({position:"relative",width:"100%",height:"100%",...J.style}),[J.style]),ke={height:"100%"};return Ft.createElement("div",{id:J.id,ref:le,style:tt},Me&&Ft.createElement(q_.Provider,{value:n},Ft.createElement("div",{"mapboxgl-children":"",style:ke},J.children)))}const sA=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function H_(J,ue){if(!J||!ue)return;const me=J.style;for(const ce in ue){const Me=ue[ce];Number.isFinite(Me)&&!sA.test(ce)?me[ce]=`${Me}px`:me[ce]=Me}}function oA(J,ue){const{map:me,mapLib:ce}=Ft.useContext(q_),Me=Ft.useRef({props:J});Me.current.props=J;const Pe=Ft.useMemo(()=>{let Vi=!1;Ft.Children.forEach(J.children,Ci=>{Ci&&(Vi=!0)});const Wi={...J,element:Vi?document.createElement("div"):null},Tn=new ce.Marker(Wi);return Tn.setLngLat([J.longitude,J.latitude]),Tn.getElement().addEventListener("click",Ci=>{var Ji,Vn;(Vn=(Ji=Me.current.props).onClick)===null||Vn===void 0||Vn.call(Ji,{type:"click",target:Tn,originalEvent:Ci})}),Tn.on("dragstart",Ci=>{var Ji,Vn;const Oi=Ci;Oi.lngLat=Pe.getLngLat(),(Vn=(Ji=Me.current.props).onDragStart)===null||Vn===void 0||Vn.call(Ji,Oi)}),Tn.on("drag",Ci=>{var Ji,Vn;const Oi=Ci;Oi.lngLat=Pe.getLngLat(),(Vn=(Ji=Me.current.props).onDrag)===null||Vn===void 0||Vn.call(Ji,Oi)}),Tn.on("dragend",Ci=>{var Ji,Vn;const Oi=Ci;Oi.lngLat=Pe.getLngLat(),(Vn=(Ji=Me.current.props).onDragEnd)===null||Vn===void 0||Vn.call(Ji,Oi)}),Tn},[]);Ft.useEffect(()=>(Pe.addTo(me.getMap()),()=>{Pe.remove()}),[]);const{longitude:le,latitude:n,offset:tt,style:ke,draggable:Rt=!1,popup:ut=null,rotation:bt=0,rotationAlignment:rn="auto",pitchAlignment:on="auto"}=J;return Ft.useEffect(()=>{H_(Pe.getElement(),ke)},[ke]),Ft.useImperativeHandle(ue,()=>Pe,[]),(Pe.getLngLat().lng!==le||Pe.getLngLat().lat!==n)&&Pe.setLngLat([le,n]),tt&&!XE(Pe.getOffset(),tt)&&Pe.setOffset(tt),Pe.isDraggable()!==Rt&&Pe.setDraggable(Rt),Pe.getRotation()!==bt&&Pe.setRotation(bt),Pe.getRotationAlignment()!==rn&&Pe.setRotationAlignment(rn),Pe.getPitchAlignment()!==on&&Pe.setPitchAlignment(on),Pe.getPopup()!==ut&&Pe.setPopup(ut),K1.createPortal(J.children,Pe.getElement())}const lA=Ft.memo(Ft.forwardRef(oA));function x1(J){return new Set(J?J.trim().split(/\s+/):[])}function cA(J,ue){const{map:me,mapLib:ce}=Ft.useContext(q_),Me=Ft.useMemo(()=>document.createElement("div"),[]),Pe=Ft.useRef({props:J});Pe.current.props=J;const le=Ft.useMemo(()=>{const n={...J},tt=new ce.Popup(n);return tt.setLngLat([J.longitude,J.latitude]),tt.once("open",ke=>{var Rt,ut;(ut=(Rt=Pe.current.props).onOpen)===null||ut===void 0||ut.call(Rt,ke)}),tt},[]);if(Ft.useEffect(()=>{const n=tt=>{var ke,Rt;(Rt=(ke=Pe.current.props).onClose)===null||Rt===void 0||Rt.call(ke,tt)};return le.on("close",n),le.setDOMContent(Me).addTo(me.getMap()),()=>{le.off("close",n),le.isOpen()&&le.remove()}},[]),Ft.useEffect(()=>{H_(le.getElement(),J.style)},[J.style]),Ft.useImperativeHandle(ue,()=>le,[]),le.isOpen()&&((le.getLngLat().lng!==J.longitude||le.getLngLat().lat!==J.latitude)&&le.setLngLat([J.longitude,J.latitude]),J.offset&&!Yf(le.options.offset,J.offset)&&le.setOffset(J.offset),(le.options.anchor!==J.anchor||le.options.maxWidth!==J.maxWidth)&&(le.options.anchor=J.anchor,le.setMaxWidth(J.maxWidth)),le.options.className!==J.className)){const n=x1(le.options.className),tt=x1(J.className);for(const ke of n)tt.has(ke)||le.removeClassName(ke);for(const ke of tt)n.has(ke)||le.addClassName(ke);le.options.className=J.className}return K1.createPortal(J.children,Me)}Ft.memo(Ft.forwardRef(cA));function ty(J,ue,me,ce){const Me=Ft.useContext(q_),Pe=Ft.useMemo(()=>J(Me),[]);return Ft.useEffect(()=>{const le=ue,n=null,tt=typeof ue=="function"?ue:null,{map:ke}=Me;return ke.hasControl(Pe)||(ke.addControl(Pe,le?.position),n&&n(Me)),()=>{tt&&tt(Me),ke.hasControl(Pe)&&ke.removeControl(Pe)}},[]),Pe}function uA(J){const ue=ty(({mapLib:me})=>new me.AttributionControl(J),{position:J.position});return Ft.useEffect(()=>{H_(ue._container,J.style)},[J.style]),null}Ft.memo(uA);function hA(J){const ue=ty(({mapLib:me})=>new me.FullscreenControl({container:J.containerId&&document.getElementById(J.containerId)}),{position:J.position});return Ft.useEffect(()=>{H_(ue._controlContainer,J.style)},[J.style]),null}Ft.memo(hA);function dA(J,ue){const me=Ft.useRef({props:J}),ce=ty(({mapLib:Me})=>{const Pe=new Me.GeolocateControl(J),le=Pe._setupUI;return Pe._setupUI=n=>{Pe._container.hasChildNodes()||le(n)},Pe.on("geolocate",n=>{var tt,ke;(ke=(tt=me.current.props).onGeolocate)===null||ke===void 0||ke.call(tt,n)}),Pe.on("error",n=>{var tt,ke;(ke=(tt=me.current.props).onError)===null||ke===void 0||ke.call(tt,n)}),Pe.on("outofmaxbounds",n=>{var tt,ke;(ke=(tt=me.current.props).onOutOfMaxBounds)===null||ke===void 0||ke.call(tt,n)}),Pe.on("trackuserlocationstart",n=>{var tt,ke;(ke=(tt=me.current.props).onTrackUserLocationStart)===null||ke===void 0||ke.call(tt,n)}),Pe.on("trackuserlocationend",n=>{var tt,ke;(ke=(tt=me.current.props).onTrackUserLocationEnd)===null||ke===void 0||ke.call(tt,n)}),Pe},{position:J.position});return me.current.props=J,Ft.useImperativeHandle(ue,()=>ce,[]),Ft.useEffect(()=>{H_(ce._container,J.style)},[J.style]),null}Ft.memo(Ft.forwardRef(dA));function fA(J){const ue=ty(({mapLib:me})=>new me.NavigationControl(J),{position:J.position});return Ft.useEffect(()=>{H_(ue._container,J.style)},[J.style]),null}Ft.memo(fA);function pA(J){const ue=ty(({mapLib:Pe})=>new Pe.ScaleControl(J),{position:J.position}),me=Ft.useRef(J),ce=me.current;me.current=J;const{style:Me}=J;return J.maxWidth!==void 0&&J.maxWidth!==ce.maxWidth&&(ue.options.maxWidth=J.maxWidth),J.unit!==void 0&&J.unit!==ce.unit&&ue.setUnit(J.unit),Ft.useEffect(()=>{H_(ue._container,Me)},[Me]),null}Ft.memo(pA);function Xy(J,ue){if(!J)throw new Error(ue)}function mA(J,ue,me,ce){if(Xy(me.id===ce.id,"layer id changed"),Xy(me.type===ce.type,"layer type changed"),me.type==="custom"||ce.type==="custom")return;const{layout:Me={},paint:Pe={},filter:le,minzoom:n,maxzoom:tt,beforeId:ke}=me;if(ke!==ce.beforeId&&J.moveLayer(ue,ke),Me!==ce.layout){const Rt=ce.layout||{};for(const ut in Me)Yf(Me[ut],Rt[ut])||J.setLayoutProperty(ue,ut,Me[ut]);for(const ut in Rt)Me.hasOwnProperty(ut)||J.setLayoutProperty(ue,ut,void 0)}if(Pe!==ce.paint){const Rt=ce.paint||{};for(const ut in Pe)Yf(Pe[ut],Rt[ut])||J.setPaintProperty(ue,ut,Pe[ut]);for(const ut in Rt)Pe.hasOwnProperty(ut)||J.setPaintProperty(ue,ut,void 0)}Yf(le,ce.filter)||J.setFilter(ue,le),(n!==ce.minzoom||tt!==ce.maxzoom)&&J.setLayerZoomRange(ue,n,tt)}function _A(J,ue,me){if(J.style&&J.style._loaded&&(!("source"in me)||J.getSource(me.source))){const ce={...me,id:ue};delete ce.beforeId,J.addLayer(ce,me.beforeId)}}let gA=0;function iw(J){const ue=Ft.useContext(q_).map.getMap(),me=Ft.useRef(J),[,ce]=Ft.useState(0),Me=Ft.useMemo(()=>J.id||`jsx-layer-${gA++}`,[]);if(Ft.useEffect(()=>{if(ue){const le=()=>ce(n=>n+1);return ue.on("styledata",le),le(),()=>{ue.off("styledata",le),ue.style&&ue.style._loaded&&ue.getLayer(Me)&&ue.removeLayer(Me)}}},[ue]),ue&&ue.style&&ue.getLayer(Me))try{mA(ue,Me,J,me.current)}catch(le){console.warn(le)}else _A(ue,Me,J);return me.current=J,null}let yA=0;function xA(J,ue,me){if(J.style&&J.style._loaded){const ce={...me};return delete ce.id,delete ce.children,J.addSource(ue,ce),J.getSource(ue)}return null}function vA(J,ue,me){Xy(ue.id===me.id,"source id changed"),Xy(ue.type===me.type,"source type changed");let ce="",Me=0;for(const le in ue)le!=="children"&&le!=="id"&&!Yf(me[le],ue[le])&&(ce=le,Me++);if(!Me)return;const Pe=ue.type;Pe==="geojson"?J.setData(ue.data):Pe==="image"?J.updateImage({url:ue.url,coordinates:ue.coordinates}):"setCoordinates"in J&&Me===1&&ce==="coordinates"?J.setCoordinates(ue.coordinates):"setUrl"in J&&ce==="url"?J.setUrl(ue.url):"setTiles"in J&&ce==="tiles"?J.setTiles(ue.tiles):console.warn(`Unable to update <Source> prop: ${ce}`)}function nw(J){const ue=Ft.useContext(q_).map.getMap(),me=Ft.useRef(J),[,ce]=Ft.useState(0),Me=Ft.useMemo(()=>J.id||`jsx-source-${yA++}`,[]);Ft.useEffect(()=>{if(ue){const le=()=>setTimeout(()=>ce(n=>n+1),0);return ue.on("styledata",le),le(),()=>{var n;if(ue.off("styledata",le),ue.style&&ue.style._loaded&&ue.getSource(Me)){const tt=(n=ue.getStyle())===null||n===void 0?void 0:n.layers;if(tt)for(const ke of tt)ke.source===Me&&ue.removeLayer(ke.id);ue.removeSource(Me)}}}},[ue]);let Pe=ue&&ue.style&&ue.getSource(Me);return Pe?vA(Pe,J,me.current):Pe=xA(ue,Me,J),me.current=J,Pe&&Ft.Children.map(J.children,le=>le&&Ft.cloneElement(le,{source:Me}))||null}function bA(){return ew()}const wA=J1(()=>Promise.resolve().then(()=>AA),[]),TA=Ft.forwardRef(function(ue,me){return tw(ue,me,wA)}),rw=lA,iv=iw,v1=nw;function aw({children:J,onMapClick:ue,onLoad:me,viewState:ce,onMove:Me}){const Pe=Ft.useRef(null),[le,n]=Ft.useState(null),[tt,ke]=Ft.useState(!1),[Rt,ut]=Ft.useState(null),[bt,rn]=Ft.useState(!0),on={longitude:-89.4012,latitude:43.0731,zoom:16},Vi=(Ji,Vn)=>{if(!Ji||typeof Ji.setSnow!="function"){if(!Ji)return;console.warn("map.setSnow is not defined. Are you missing a plugin script?");return}Vn?Ji.setSnow({density:.85,intensity:1,color:"#FFFFFF",opacity:1,"center-thinning":.4,direction:[0,50],"flake-size":.71,vignette:.3,vignetteColor:"#FFFFFF"}):typeof Ji.removeSnow=="function"?Ji.removeSnow():Ji.setSnow({density:0,intensity:0,opacity:0,"center-thinning":0,direction:[0,0],"flake-size":0,vignette:0,vignetteColor:"#FFFFFF"})},Wi=Ji=>{const Vn=Ji.target;Pe.current=Vn,Vi(Vn,bt),me&&me(Ji)},Tn=()=>{if(!navigator.geolocation){ut("Geolocation is not supported by your browser.");return}ke(!0),ut(null),navigator.geolocation.getCurrentPosition(Ji=>{const{latitude:Vn,longitude:Oi}=Ji.coords;n({latitude:Vn,longitude:Oi}),ke(!1),Pe.current&&typeof Pe.current.flyTo=="function"&&Pe.current.flyTo({center:[Oi,Vn],zoom:16,essential:!0})},Ji=>{ke(!1),ut(Ji.message||"Unable to retrieve your location.")})},Ci=()=>{const Ji=!bt;rn(Ji),Pe.current&&Vi(Pe.current,Ji)};return Ae.jsxs("div",{className:"map-view-root",style:{width:"100%",height:"100%",position:"relative"},children:[Ae.jsxs("div",{className:"map-controls",style:{position:"absolute",top:12,right:12,zIndex:1,display:"flex",flexDirection:"column",gap:8},children:[Ae.jsx("button",{type:"button",onClick:Ci,style:{padding:"6px 10px",borderRadius:6,border:"none",cursor:"pointer",fontSize:12,background:"#ffffff",boxShadow:"0 1px 4px rgba(0,0,0,0.15)"},children:bt?"Disable Snow":"Enable Snow"}),Rt&&Ae.jsx("div",{style:{marginTop:4,maxWidth:160,fontSize:10,background:"rgba(255,255,255,0.9)",padding:"4px 6px",borderRadius:4},children:Rt})]}),Ae.jsx("div",{style:{position:"absolute",bottom:12,right:12,zIndex:1},children:Ae.jsx("button",{type:"button",onClick:Tn,style:{padding:"6px 10px",borderRadius:6,border:"none",cursor:"pointer",fontSize:12,background:"#ffffff",boxShadow:"0 1px 4px rgba(0,0,0,0.15)"},children:tt?"Locating":"My Location"})}),Ae.jsxs(TA,{...ce?{...ce}:{},initialViewState:ce?void 0:on,minZoom:12.75,maxZoom:18,mapStyle:"mapbox://styles/ben-hurwitz/cmixuervv003501rxg4mjgm6k",mapboxAccessToken:"pk.eyJ1IjoiYmVuLWh1cndpdHoiLCJhIjoiY21oOGF0cjVjMDlzdDJscG9oemZpZ2J0ZSJ9.WDhxlwNRVnVxBlbDIgrppQ",scrollZoom:!0,doubleClickZoom:!0,dragRotate:!1,touchZoomRotate:!0,onClick:ue,onLoad:Wi,onMove:Me,style:{width:"100%",height:"100%"},children:[le&&Ae.jsx(rw,{longitude:le.longitude,latitude:le.latitude,anchor:"bottom",children:Ae.jsx("div",{style:{width:14,height:14,borderRadius:"50%",background:"#3b82f6",border:"2px solid #ffffff",boxShadow:"0 0 0 2px rgba(59,130,246,0.5)"}})}),J]})]})}var Gy={exports:{}},SA=Gy.exports,b1;function EA(){return b1||(b1=1,(function(J,ue){(function(me,ce){J.exports=ce()})(SA,(function(){var me,ce,Me;function Pe(n,tt){if(!me)me=tt;else if(!ce)ce=tt;else{var ke="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+me+")(sharedChunk); ("+ce+")(sharedChunk); self.onerror = null;",Rt={};me(Rt),Me=tt(Rt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Me.workerUrl=window.URL.createObjectURL(new Blob([ke],{type:"text/javascript"})))}}Pe(["exports"],(function(n){var tt=1e-6,ke=typeof Float32Array<"u"?Float32Array:Array;function Rt(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=i*p-u*s;return _?(r[0]=p*(_=1/_),r[1]=-s*_,r[2]=-u*_,r[3]=i*_,r):null}function ut(){var r=new ke(9);return ke!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function bt(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=e[4],v=e[5],E=e[6],C=e[7],k=e[8];return r[0]=_*k-v*C,r[1]=u*C-s*k,r[2]=s*v-u*_,r[3]=v*E-p*k,r[4]=i*k-u*E,r[5]=u*p-i*v,r[6]=p*C-_*E,r[7]=s*E-i*C,r[8]=i*_-s*p,r}function rn(r,e,i){var s=e[0],u=e[1],p=e[2],_=e[3],v=e[4],E=e[5],C=e[6],k=e[7],F=e[8],V=i[0],j=i[1],$=i[2],ee=i[3],oe=i[4],se=i[5],ge=i[6],xe=i[7],Ie=i[8];return r[0]=V*s+j*_+$*C,r[1]=V*u+j*v+$*k,r[2]=V*p+j*E+$*F,r[3]=ee*s+oe*_+se*C,r[4]=ee*u+oe*v+se*k,r[5]=ee*p+oe*E+se*F,r[6]=ge*s+xe*_+Ie*C,r[7]=ge*u+xe*v+Ie*k,r[8]=ge*p+xe*E+Ie*F,r}function on(){var r=new ke(16);return ke!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function Vi(r){var e=new ke(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Wi(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Tn(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=e[4],v=e[5],E=e[6],C=e[7],k=e[8],F=e[9],V=e[10],j=e[11],$=e[12],ee=e[13],oe=e[14],se=e[15],ge=i*v-s*_,xe=i*E-u*_,Ie=i*C-p*_,He=s*E-u*v,Ne=s*C-p*v,We=u*C-p*E,at=k*ee-F*$,ct=k*oe-V*$,Gt=k*se-j*$,pt=F*oe-V*ee,Xt=F*se-j*ee,ni=V*se-j*oe,ri=ge*ni-xe*Xt+Ie*pt+He*Gt-Ne*ct+We*at;return ri?(r[0]=(v*ni-E*Xt+C*pt)*(ri=1/ri),r[1]=(u*Xt-s*ni-p*pt)*ri,r[2]=(ee*We-oe*Ne+se*He)*ri,r[3]=(V*Ne-F*We-j*He)*ri,r[4]=(E*Gt-_*ni-C*ct)*ri,r[5]=(i*ni-u*Gt+p*ct)*ri,r[6]=(oe*Ie-$*We-se*xe)*ri,r[7]=(k*We-V*Ie+j*xe)*ri,r[8]=(_*Xt-v*Gt+C*at)*ri,r[9]=(s*Gt-i*Xt-p*at)*ri,r[10]=($*Ne-ee*Ie+se*ge)*ri,r[11]=(F*Ie-k*Ne-j*ge)*ri,r[12]=(v*ct-_*pt-E*at)*ri,r[13]=(i*pt-s*ct+u*at)*ri,r[14]=(ee*xe-$*He-oe*ge)*ri,r[15]=(k*He-F*xe+V*ge)*ri,r):null}function Ci(r,e,i){var s=e[0],u=e[1],p=e[2],_=e[3],v=e[4],E=e[5],C=e[6],k=e[7],F=e[8],V=e[9],j=e[10],$=e[11],ee=e[12],oe=e[13],se=e[14],ge=e[15],xe=i[0],Ie=i[1],He=i[2],Ne=i[3];return r[0]=xe*s+Ie*v+He*F+Ne*ee,r[1]=xe*u+Ie*E+He*V+Ne*oe,r[2]=xe*p+Ie*C+He*j+Ne*se,r[3]=xe*_+Ie*k+He*$+Ne*ge,r[4]=(xe=i[4])*s+(Ie=i[5])*v+(He=i[6])*F+(Ne=i[7])*ee,r[5]=xe*u+Ie*E+He*V+Ne*oe,r[6]=xe*p+Ie*C+He*j+Ne*se,r[7]=xe*_+Ie*k+He*$+Ne*ge,r[8]=(xe=i[8])*s+(Ie=i[9])*v+(He=i[10])*F+(Ne=i[11])*ee,r[9]=xe*u+Ie*E+He*V+Ne*oe,r[10]=xe*p+Ie*C+He*j+Ne*se,r[11]=xe*_+Ie*k+He*$+Ne*ge,r[12]=(xe=i[12])*s+(Ie=i[13])*v+(He=i[14])*F+(Ne=i[15])*ee,r[13]=xe*u+Ie*E+He*V+Ne*oe,r[14]=xe*p+Ie*C+He*j+Ne*se,r[15]=xe*_+Ie*k+He*$+Ne*ge,r}function Ji(r,e,i){var s,u,p,_,v,E,C,k,F,V,j,$,ee=i[0],oe=i[1],se=i[2];return e===r?(r[12]=e[0]*ee+e[4]*oe+e[8]*se+e[12],r[13]=e[1]*ee+e[5]*oe+e[9]*se+e[13],r[14]=e[2]*ee+e[6]*oe+e[10]*se+e[14],r[15]=e[3]*ee+e[7]*oe+e[11]*se+e[15]):(u=e[1],p=e[2],_=e[3],v=e[4],E=e[5],C=e[6],k=e[7],F=e[8],V=e[9],j=e[10],$=e[11],r[0]=s=e[0],r[1]=u,r[2]=p,r[3]=_,r[4]=v,r[5]=E,r[6]=C,r[7]=k,r[8]=F,r[9]=V,r[10]=j,r[11]=$,r[12]=s*ee+v*oe+F*se+e[12],r[13]=u*ee+E*oe+V*se+e[13],r[14]=p*ee+C*oe+j*se+e[14],r[15]=_*ee+k*oe+$*se+e[15]),r}function Vn(r,e,i){var s=i[0],u=i[1],p=i[2];return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r[4]=e[4]*u,r[5]=e[5]*u,r[6]=e[6]*u,r[7]=e[7]*u,r[8]=e[8]*p,r[9]=e[9]*p,r[10]=e[10]*p,r[11]=e[11]*p,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Oi(r,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[4],_=e[5],v=e[6],E=e[7],C=e[8],k=e[9],F=e[10],V=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=p*u+C*s,r[5]=_*u+k*s,r[6]=v*u+F*s,r[7]=E*u+V*s,r[8]=C*u-p*s,r[9]=k*u-_*s,r[10]=F*u-v*s,r[11]=V*u-E*s,r}function Hn(r,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[0],_=e[1],v=e[2],E=e[3],C=e[8],k=e[9],F=e[10],V=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*u-C*s,r[1]=_*u-k*s,r[2]=v*u-F*s,r[3]=E*u-V*s,r[8]=p*s+C*u,r[9]=_*s+k*u,r[10]=v*s+F*u,r[11]=E*s+V*u,r}function qi(r,e,i){var s=Math.sin(i),u=Math.cos(i),p=e[0],_=e[1],v=e[2],E=e[3],C=e[4],k=e[5],F=e[6],V=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*u+C*s,r[1]=_*u+k*s,r[2]=v*u+F*s,r[3]=E*u+V*s,r[4]=C*u-p*s,r[5]=k*u-_*s,r[6]=F*u-v*s,r[7]=V*u-E*s,r}function Ot(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Vt(r,e,i){var s,u,p,_=i[0],v=i[1],E=i[2],C=Math.sqrt(_*_+v*v+E*E);return C<tt?null:(_*=C=1/C,v*=C,E*=C,s=Math.sin(e),u=Math.cos(e),r[0]=_*_*(p=1-u)+u,r[1]=v*_*p+E*s,r[2]=E*_*p-v*s,r[3]=0,r[4]=_*v*p-E*s,r[5]=v*v*p+u,r[6]=E*v*p+_*s,r[7]=0,r[8]=_*E*p+v*s,r[9]=v*E*p-_*s,r[10]=E*E*p+u,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Hi(r,e){var i=e[0],s=e[1],u=e[2],p=e[4],_=e[5],v=e[6],E=e[8],C=e[9],k=e[10];return r[0]=Math.sqrt(i*i+s*s+u*u),r[1]=Math.sqrt(p*p+_*_+v*v),r[2]=Math.sqrt(E*E+C*C+k*k),r}function dn(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=i+i,v=s+s,E=u+u,C=i*_,k=s*_,F=s*v,V=u*_,j=u*v,$=u*E,ee=p*_,oe=p*v,se=p*E;return r[0]=1-F-$,r[1]=k+se,r[2]=V-oe,r[3]=0,r[4]=k-se,r[5]=1-C-$,r[6]=j+ee,r[7]=0,r[8]=V+oe,r[9]=j-ee,r[10]=1-C-F,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var Ui=Ci;function an(){var r=new ke(3);return ke!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Hr(r){var e=new ke(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function Qr(r){var e=r[0],i=r[1],s=r[2];return Math.sqrt(e*e+i*i+s*s)}function ui(r,e,i){var s=new ke(3);return s[0]=r,s[1]=e,s[2]=i,s}function Si(r,e,i,s){return r[0]=e,r[1]=i,r[2]=s,r}function yn(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function Rn(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function wr(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function Tt(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function jt(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function ai(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function ln(r,e,i,s){return r[0]=e[0]+i[0]*s,r[1]=e[1]+i[1]*s,r[2]=e[2]+i[2]*s,r}function Jn(r,e){var i=e[0]-r[0],s=e[1]-r[1],u=e[2]-r[2];return Math.sqrt(i*i+s*s+u*u)}function _r(r,e){var i=e[0]-r[0],s=e[1]-r[1],u=e[2]-r[2];return i*i+s*s+u*u}function Mr(r){var e=r[0],i=r[1],s=r[2];return e*e+i*i+s*s}function pr(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Cn(r,e){var i=e[0],s=e[1],u=e[2],p=i*i+s*s+u*u;return p>0&&(p=1/Math.sqrt(p)),r[0]=e[0]*p,r[1]=e[1]*p,r[2]=e[2]*p,r}function Cr(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function Ir(r,e,i){var s=e[0],u=e[1],p=e[2],_=i[0],v=i[1],E=i[2];return r[0]=u*E-p*v,r[1]=p*_-s*E,r[2]=s*v-u*_,r}function Fa(r,e,i,s){var u=e[0],p=e[1],_=e[2];return r[0]=u+s*(i[0]-u),r[1]=p+s*(i[1]-p),r[2]=_+s*(i[2]-_),r}function ra(r,e,i){var s=e[0],u=e[1],p=e[2],_=i[3]*s+i[7]*u+i[11]*p+i[15];return r[0]=(i[0]*s+i[4]*u+i[8]*p+i[12])/(_=_||1),r[1]=(i[1]*s+i[5]*u+i[9]*p+i[13])/_,r[2]=(i[2]*s+i[6]*u+i[10]*p+i[14])/_,r}function Aa(r,e,i){var s=e[0],u=e[1],p=e[2];return r[0]=s*i[0]+u*i[3]+p*i[6],r[1]=s*i[1]+u*i[4]+p*i[7],r[2]=s*i[2]+u*i[5]+p*i[8],r}function Da(r,e,i){var s=i[0],u=i[1],p=i[2],_=i[3],v=e[0],E=e[1],C=e[2],k=u*C-p*E,F=p*v-s*C,V=s*E-u*v;return r[0]=v+_*(k+=k)+u*(V+=V)-p*(F+=F),r[1]=E+_*F+p*k-s*V,r[2]=C+_*V+s*F-u*k,r}function Yt(r){return r[0]=0,r[1]=0,r[2]=0,r}function Ha(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var zr=Rn,Dr=wr,ma=Qr;function rl(){var r=new ke(4);return ke!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function ho(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function Vo(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=i*i+s*s+u*u+p*p;return _>0&&(_=1/Math.sqrt(_)),r[0]=i*_,r[1]=s*_,r[2]=u*_,r[3]=p*_,r}function la(r,e,i){var s=e[0],u=e[1],p=e[2],_=e[3];return r[0]=i[0]*s+i[4]*u+i[8]*p+i[12]*_,r[1]=i[1]*s+i[5]*u+i[9]*p+i[13]*_,r[2]=i[2]*s+i[6]*u+i[10]*p+i[14]*_,r[3]=i[3]*s+i[7]*u+i[11]*p+i[15]*_,r}function Vs(){var r=new ke(4);return ke!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function qs(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Us(r,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],_=e[3],v=Math.sin(i),E=Math.cos(i);return r[0]=s*E+_*v,r[1]=u*E+p*v,r[2]=p*E-u*v,r[3]=_*E-s*v,r}function cn(r,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],_=e[3],v=Math.sin(i),E=Math.cos(i);return r[0]=s*E-p*v,r[1]=u*E+_*v,r[2]=p*E+s*v,r[3]=_*E-u*v,r}an(),rl();var Ws,To,Do,So=Vo,Sn=(Ws=an(),To=ui(1,0,0),Do=ui(0,1,0),function(r,e,i){var s=Cr(e,i);return s<-.999999?(Ir(Ws,To,e),ma(Ws)<1e-6&&Ir(Ws,Do,e),Cn(Ws,Ws),(function(u,p,_){_*=.5;var v=Math.sin(_);u[0]=v*p[0],u[1]=v*p[1],u[2]=v*p[2],u[3]=Math.cos(_)})(r,Ws,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Ir(Ws,e,i),r[0]=Ws[0],r[1]=Ws[1],r[2]=Ws[2],r[3]=1+s,So(r,r))});function tr(){var r=new ke(2);return ke!=Float32Array&&(r[0]=0,r[1]=0),r}function ar(r,e){var i=new ke(2);return i[0]=r,i[1]=e,i}function Hs(r,e,i){return r[0]=e,r[1]=i,r}function pl(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function Xr(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function ml(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function Uo(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function lc(r,e){var i=e[0],s=e[1],u=i*i+s*s;return u>0&&(u=1/Math.sqrt(u)),r[0]=e[0]*u,r[1]=e[1]*u,r}function ul(r,e){return r[0]*e[0]+r[1]*e[1]}Vs(),Vs(),ut();var dt,Ce,Re=Xr;function Qe(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}tr();var mt=(function(){if(Ce)return dt;function r(e,i,s,u){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=u}return Ce=1,dt=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,u=0;u<8;u++){var p=this.sampleCurveX(s)-e;if(Math.abs(p)<i)return s;var _=this.sampleCurveDerivativeX(s);if(Math.abs(_)<1e-6)break;s-=p/_}var v=0,E=1;for(s=e,u=0;u<20&&(p=this.sampleCurveX(s),!(Math.abs(p-e)<i));u++)e>p?v=s:E=s,s=.5*(E-v)+v;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},dt})(),Nt=Qe(mt);function je(r,e){this.x=r,this.y=e}function ei(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!ei(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!ei(r[i],e[i]))return!1;return!0}return r===e}je.prototype={clone(){return new je(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround(r,e){const i=Math.cos(r),s=Math.sin(r),u=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:je},je.convert=function(r){if(r instanceof je)return r;if(Array.isArray(r))return new je(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new je(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const Pt=Math.PI/180,Di=180/Math.PI;function fi(r){return r*Pt}function hi(r){return r*Di}const kn=[[0,0],[1,0],[1,1],[0,1]];function hr(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Tr(r,e,i,s){const u=new Nt(r,e,i,s);return function(p){return u.solve(p)}}const lt=Tr(.25,.1,.25,1);function te(r,e,i){return Math.min(i,Math.max(e,r))}function pe(r,e,i){return(i=te((i-r)/(e-r),0,1))*i*(3-2*i)}function ze(r,e,i){const s=i-e,u=((r-e)%s+s)%s+e;return u===e?i:u}function et(r,e,i){if(!r.length)return i(null,[]);let s=r.length;const u=new Array(r.length);let p=null;r.forEach(((_,v)=>{e(_,((E,C)=>{E&&(p=E),u[v]=C,--s==0&&i(p,u)}))}))}let Xe=1;function rt(){return Xe++}function wt(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function ot(r,e){r.forEach((i=>{e[i]&&(e[i]=e[i].bind(e))}))}function At(r,e,i){const s={};for(const u in r)s[u]=e.call(this,r[u],u,r);return s}function ti(r,e,i){const s={};for(const u in r)e.call(this,r[u],u,r)&&(s[u]=r[u]);return s}function qt(r){return Array.isArray(r)?r.map(qt):typeof r=="object"&&r?At(r,qt):r}function Yi(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const Ki={};function Bi(r){Ki[r]||(typeof console<"u"&&console.warn(r),Ki[r]=!0)}function dr(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function $n(r){let e=0;for(let i,s,u=0,p=r.length,_=p-1;u<p;_=u++)i=r[u],s=r[_],e+=(s.x-i.x)*(i.y+s.y);return e}function Nn([r,e,i]){const s=fi(e+90),u=fi(i);return{x:r*Math.cos(s)*Math.sin(u),y:r*Math.sin(s)*Math.sin(u),z:r*Math.cos(u),azimuthal:e,polar:i}}function Ur(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function La(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((i,s,u,p)=>{const _=u||p;return e[s]=!_||_.toLowerCase(),""})),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Ja=null;function ss(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function js(r,e,i,s){for(;e<i;){const u=e+i>>1;r[u]<s?e=u+1:i=u}return e}function ea(r,e,i,s){for(;e<i;){const u=e+i>>1;r[u]<=s?e=u+1:i=u}return e}function jr(r){return r>0?1/(1.001-r):1+r}function da(r){return r>0?1-1/(1.001-r):-r}function lr(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Rr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Rr.API_URL)return null;try{const r=new URL(Rr.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function $a(r){return Rr.API_URL_REGEX.test(r)}function Ro(r){return Rr.API_SPRITE_REGEX.test(r)}let Ys,_l,nh,es,jo,_a;function Mc(){return Ys==null&&(Ys=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ys}const Ks={now:()=>es!==void 0?es:performance.now(),setNow(r){es=r},restoreNow(){es=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:s}=r;jo||(jo=document.createElement("canvas"));const u=jo.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>jo.width||s>jo.height)&&(jo.width=i,jo.height=s),u.clearRect(-e,-e,i+2*e,s+2*e),u.drawImage(r,0,0,i,s),u.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:r=>(_l||(_l=document.createElement("a")),_l.href=r,_l.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(nh==null&&(nh=window.matchMedia("(prefers-reduced-motion: reduce)")),nh.matches)},hasCanvasFingerprintNoise(){if(_a!==void 0)return _a;if(!Mc())return _a=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let u=0;u<r.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);const s=e.getImageData(0,0,r.width,r.height);i=0;for(let u=0;u<s.data.length;++u)if(u%4!=3&&i++!==s.data[u])return _a=!0,!0;return _a=!1,!1}};function jc(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(r.slice(i));for(const u in e)s.set(u,e[u]);return`${r.slice(0,i)}?${s.toString()}`}function Mh(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const s=new URLSearchParams,u=new URLSearchParams(r.slice(i));for(const _ of e.persistentParams){const v=u.get(_);v&&s.set(_,v)}const p=s.toString();return`${r.slice(0,i)}${p.length>0?`?${p}`:""}`}const ou="mapbox-tiles";let Jh=500,Qh=50;const Mu=["language","worldview","jobid"];let Gc,cc;function lu(){try{return caches}catch{}}function Cc(){const r=lu();r&&Gc==null&&(Gc=r.open(ou))}let fo=1/0;const Xl={supported:!1,testSupport:function(r){!cu&&Eo&&(Cu?Kf(r):Po=r)}};let Po,Eo,cu=!1,Cu=!1;const Ch=typeof self<"u"?self:{};function Kf(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Eo),r.isContextLost())return;Xl.supported=!0}catch{}r.deleteTexture(e),cu=!0}Ch.document&&(Eo=Ch.document.createElement("img"),Eo.onload=function(){Po&&Kf(Po),Po=null,Cu=!0},Eo.onerror=function(){cu=!0,Po=null},Eo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const zc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(zc);class Go extends Error{constructor(e,i,s){i===401&&$a(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Ed=Ur()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,uu=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Ed())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(s,u){const p=new AbortController,_=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Ed(),referrerPolicy:s.referrerPolicy,signal:p.signal});let v=!1,E=!1;const C=(k=_.url).indexOf("sku=")>0&&$a(k);var k;s.type==="json"&&_.headers.set("Accept","application/json");const F=(j,$,ee)=>{if(E)return;if(j&&j.message!=="SecurityError"&&Bi(j.toString()),$&&ee)return V($);const oe=Date.now();fetch(_).then((se=>{if(se.ok){const ge=C?se.clone():null;return V(se,ge,oe)}return u(new Go(se.statusText,se.status,s.url))})).catch((se=>{se.name!=="AbortError"&&u(new Error(`${se.message} ${s.url}`))}))},V=(j,$,ee)=>{(s.type==="arrayBuffer"?j.arrayBuffer():s.type==="json"?j.json():j.text()).then((oe=>{E||($&&ee&&(function(se,ge,xe){if(Cc(),Gc==null)return;const Ie=La(ge.headers.get("Cache-Control")||"");if(Ie["no-store"])return;const He={status:ge.status,statusText:ge.statusText,headers:new Headers};ge.headers.forEach(((at,ct)=>He.headers.set(ct,at))),Ie["max-age"]&&He.headers.set("Expires",new Date(xe+1e3*Ie["max-age"]).toUTCString());const Ne=He.headers.get("Expires");if(!Ne||new Date(Ne).getTime()-xe<42e4)return;let We=Mh(se.url,{persistentParams:Mu});if(ge.status===206){const at=se.headers.get("Range");if(!at)return;He.status=200,We=jc(We,{range:at})}(function(at,ct){if(cc===void 0)try{new Response(new ReadableStream),cc=!0}catch{cc=!1}cc?ct(at.body):at.blob().then(ct).catch((Gt=>Bi(Gt.message)))})(ge,(at=>{const ct=new Response((Gt=ge.status)!==200&&Gt!==404&&[101,103,204,205,304].includes(Gt)?null:at,He);var Gt;Cc(),Gc?.then((pt=>pt.put(We,ct))).catch((pt=>Bi(pt.message)))}))})(_,$,ee),v=!0,u(null,oe,j.headers))})).catch((oe=>{E||u(new Error(oe.message))}))};return C?(function(j,$){if(Cc(),Gc==null)return $(null);Gc.then((ee=>{let oe=Mh(j.url,{persistentParams:Mu});const se=j.headers.get("Range");se&&(oe=jc(oe,{range:se})),ee.match(oe).then((ge=>{const xe=(function(Ie){if(!Ie)return!1;const He=new Date(Ie.headers.get("Expires")||0),Ne=La(Ie.headers.get("Cache-Control")||"");return Number(He)>Date.now()&&!Ne["no-cache"]})(ge);ee.delete(oe).catch($),xe&&ee.put(oe,ge.clone()).catch($),$(null,ge,xe)})).catch($)})).catch($)})(_,F):F(null,null),{cancel:()=>{E=!0,v||p.abort()}}})(r,e);if(Ur(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return(function(s,u){const p=new XMLHttpRequest;p.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const _ in s.headers)p.setRequestHeader(_,s.headers[_]);return s.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=s.credentials==="include",p.onerror=()=>{u(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let _=p.response;if(s.type==="json")try{_=JSON.parse(p.response)}catch(E){return u(E)}const v=new Headers;p.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((E=>{const C=E.split(": "),k=C.shift(),F=C.join(": ");v.append(k,F)})),u(null,_,v)}else u(new Go(p.statusText,p.status,s.url))},p.send(s.body),{cancel:()=>p.abort()}})(r,e)},Wl=function(r,e){return uu(Object.assign(r,{type:"arrayBuffer"}),e)};function Ep(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const Hd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let rh,Wr;rh=[],Wr=0;const ah=function(r,e){if(Xl.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Wr>=Rr.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return rh.push(p),p}Wr++;let i=!1;const s=()=>{if(!i)for(i=!0,Wr--;rh.length&&Wr<Rr.MAX_PARALLEL_IMAGE_REQUESTS;){const p=rh.shift(),{requestParameters:_,callback:v,cancelled:E}=p;E||(p.cancel=ah(_,v).cancel)}},u=Wl(r,((p,_,v)=>{s(),p?e(p):_&&(self.createImageBitmap?(function(E,C){const k=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(k).then((F=>{C(null,F)})).catch((F=>{C(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(_,((E,C)=>e(E,C,v))):(function(E,C){const k=new Image;k.onload=()=>{C(null,k),URL.revokeObjectURL(k.src),k.onload=null,requestAnimationFrame((()=>{k.src=Hd}))},k.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Blob([new Uint8Array(E)],{type:"image/png"});k.src=E.byteLength?URL.createObjectURL(F):Hd})(_,((E,C)=>e(E,C,v))))}));return{cancel:()=>{u.cancel(),s()}}};var $d,Cl,zl,zu={exports:{}},Du={exports:{}},Ru={exports:{}},hu=(function(){if(zl)return zu.exports;zl=1;var r=($d||($d=1,Du.exports=function(i,s){var u,p,_,v,E,C,k,F;for(p=i.length-(u=3&i.length),_=s,E=3432918353,C=461845907,F=0;F<p;)k=255&i.charCodeAt(F)|(255&i.charCodeAt(++F))<<8|(255&i.charCodeAt(++F))<<16|(255&i.charCodeAt(++F))<<24,++F,_=27492+(65535&(v=5*(65535&(_=(_^=k=(65535&(k=(k=(65535&k)*E+(((k>>>16)*E&65535)<<16)&4294967295)<<15|k>>>17))*C+(((k>>>16)*C&65535)<<16)&4294967295)<<13|_>>>19))+((5*(_>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(k=0,u){case 3:k^=(255&i.charCodeAt(F+2))<<16;case 2:k^=(255&i.charCodeAt(F+1))<<8;case 1:_^=k=(65535&(k=(k=(65535&(k^=255&i.charCodeAt(F)))*E+(((k>>>16)*E&65535)<<16)&4294967295)<<15|k>>>17))*C+(((k>>>16)*C&65535)<<16)&4294967295}return _^=i.length,_=2246822507*(65535&(_^=_>>>16))+((2246822507*(_>>>16)&65535)<<16)&4294967295,_=3266489909*(65535&(_^=_>>>13))+((3266489909*(_>>>16)&65535)<<16)&4294967295,(_^=_>>>16)>>>0}),Du.exports),e=(Cl||(Cl=1,Ru.exports=function(i,s){for(var u,p=i.length,_=s^p,v=0;p>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(v)|(255&i.charCodeAt(++v))<<8|(255&i.charCodeAt(++v))<<16|(255&i.charCodeAt(++v))<<24))+((1540483477*(u>>>16)&65535)<<16),_=1540483477*(65535&_)+((1540483477*(_>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:_^=(255&i.charCodeAt(v+2))<<16;case 2:_^=(255&i.charCodeAt(v+1))<<8;case 1:_=1540483477*(65535&(_^=255&i.charCodeAt(v)))+((1540483477*(_>>>16)&65535)<<16)}return _=1540483477*(65535&(_^=_>>>13))+((1540483477*(_>>>16)&65535)<<16),(_^=_>>>15)>>>0}),Ru.exports);return zu.exports=r,zu.exports.murmur3=r,zu.exports.murmur2=e,zu.exports})(),ns=Qe(hu);class Dl{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class ed extends Dl{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function zh(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function td(r,e,i){if(i&&i[r]){const s=i[r].indexOf(e);s!==-1&&i[r].splice(s,1)}}class id{on(e,i){return this._listeners=this._listeners||{},zh(e,i,this._listeners),this}off(e,i){return td(e,i,this._listeners),td(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},zh(e,i,this._oneTimeListeners),this):new Promise((s=>{this.once(e,s)}))}fire(e,i){const s=typeof e=="string"?new Dl(e,i):e,u=s.type;if(this.listens(u)){s.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const E of p)E.call(this,s);const _=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const E of _)td(u,E,this._oneTimeListeners),E.call(this,s);const v=this._eventedParent;if(v){const E=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(s,E),v.fire(s)}}else s instanceof ed&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Rl{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Rl(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,s]=e.split("");return new Rl({name:i,iconsetId:s})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Rl.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Ad,Id={},qc=(function(){if(Ad)return Id;Ad=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(p){return(p=Math.round(p))<0?0:p>255?255:p}function i(p){return e(p[p.length-1]==="%"?parseFloat(p)/100*255:parseInt(p))}function s(p){return(_=p[p.length-1]==="%"?parseFloat(p)/100:parseFloat(p))<0?0:_>1?1:_;var _}function u(p,_,v){return v<0?v+=1:v>1&&(v-=1),6*v<1?p+(_-p)*v*6:2*v<1?_:3*v<2?p+(_-p)*(2/3-v)*6:p}try{Id.parseCSSColor=function(p){var _,v=p.replace(/ /g,"").toLowerCase();if(v in r)return r[v].slice();if(v[0]==="#")return v.length===4?(_=parseInt(v.substr(1),16))>=0&&_<=4095?[(3840&_)>>4|(3840&_)>>8,240&_|(240&_)>>4,15&_|(15&_)<<4,1]:null:v.length===7&&(_=parseInt(v.substr(1),16))>=0&&_<=16777215?[(16711680&_)>>16,(65280&_)>>8,255&_,1]:null;var E=v.indexOf("("),C=v.indexOf(")");if(E!==-1&&C+1===v.length){var k=v.substr(0,E),F=v.substr(E+1,C-(E+1)).split(","),V=1;switch(k){case"rgba":if(F.length!==4)return null;V=s(F.pop());case"rgb":return F.length!==3?null:[i(F[0]),i(F[1]),i(F[2]),V];case"hsla":if(F.length!==4)return null;V=s(F.pop());case"hsl":if(F.length!==3)return null;var j=(parseFloat(F[0])%360+360)%360/360,$=s(F[1]),ee=s(F[2]),oe=ee<=.5?ee*($+1):ee+$-ee*$,se=2*ee-oe;return[e(255*u(se,oe,j+1/3)),e(255*u(se,oe,j)),e(255*u(se,oe,j-1/3)),V];default:return null}}return null}}catch{}return Id})();class Ta{constructor(e,i,s,u=1){this.r=e,this.g=i,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Ta)return e;if(typeof e!="string")return;const i=qc.parseCSSColor(e);return i?new Ta(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,s,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${u})`}toNonPremultipliedRenderColor(e){const{r:i,g:s,b:u,a:p}=this;return new Ip(e,i,s,u,p)}toPremultipliedRenderColor(e){const{r:i,g:s,b:u,a:p}=this;return new Dh(e,i*p,s*p,u*p,p)}clone(){return new Ta(this.r,this.g,this.b,this.a)}}class Ap{constructor(e,i,s,u,p,_=!1){if(this.premultiplied=!1,this.premultiplied=_,e){const v=e.image.height,E=v*v;this.premultiplied?(i=p===0?0:i/p*(v-1),s=p===0?0:s/p*(v-1),u=p===0?0:u/p*(v-1)):(i*=v-1,s*=v-1,u*=v-1);const C=Math.floor(i),k=Math.floor(s),F=Math.floor(u),V=Math.ceil(i),j=Math.ceil(s),$=Math.ceil(u),ee=i-C,oe=s-k,se=u-F,ge=e.image.data,xe=4*(C+k*E+F*v),Ie=4*(C+k*E+$*v),He=4*(C+j*E+F*v),Ne=4*(C+j*E+$*v),We=4*(V+k*E+F*v),at=4*(V+k*E+$*v),ct=4*(V+j*E+F*v),Gt=4*(V+j*E+$*v);if(xe<0||Gt>=ge.length)throw new Error("out of range");this.r=Gn(Gn(Gn(ge[xe],ge[Ie],se),Gn(ge[He],ge[Ne],se),oe),Gn(Gn(ge[We],ge[at],se),Gn(ge[ct],ge[Gt],se),oe),ee)/255*(this.premultiplied?p:1),this.g=Gn(Gn(Gn(ge[xe+1],ge[Ie+1],se),Gn(ge[He+1],ge[Ne+1],se),oe),Gn(Gn(ge[We+1],ge[at+1],se),Gn(ge[ct+1],ge[Gt+1],se),oe),ee)/255*(this.premultiplied?p:1),this.b=Gn(Gn(Gn(ge[xe+2],ge[Ie+2],se),Gn(ge[He+2],ge[Ne+2],se),oe),Gn(Gn(ge[We+2],ge[at+2],se),Gn(ge[ct+2],ge[Gt+2],se),oe),ee)/255*(this.premultiplied?p:1),this.a=p}else this.r=i,this.g=s,this.b=u,this.a=p}toArray(){const{r:e,g:i,b:s,a:u}=this;return[255*e,255*i,255*s,u]}toHslaArray(){let{r:e,g:i,b:s,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const $=1/u;e*=$,i*=$,s*=$}const p=Math.min(Math.max(e,0),1),_=Math.min(Math.max(i,0),1),v=Math.min(Math.max(s,0),1),E=Math.min(p,_,v),C=Math.max(p,_,v),k=C-E,F=.5*(E+C);if(k===0)return[0,0,100*F,u];const V=F>.5?k/(2-C-E):k/(C+E);let j;switch(C){case p:j=60*((_-v)/k+(_<v?6:0));break;case _:j=60*((v-p)/k+2);break;default:j=60*((p-_)/k+4)}return[j,100*V,100*F,u]}toArray01(){const{r:e,g:i,b:s,a:u}=this;return[e,i,s,u]}toArray01Scaled(e){const{r:i,g:s,b:u}=this;return[i*e,s*e,u*e]}toArray01Linear(){const{r:e,g:i,b:s,a:u}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(s,2.2),u]}}class Ip extends Ap{constructor(e,i,s,u,p){super(e,i,s,u,p,!1)}}class Dh extends Ap{constructor(e,i,s,u,p){super(e,i,s,u,p,!0)}}function Gn(r,e,i){return r*(1-i)+e*i}function Mp(r,e,i){return r.map(((s,u)=>Gn(s,e[u],i)))}Ta.black=new Ta(0,0,0,1),Ta.white=new Ta(1,1,1,1),Ta.transparent=new Ta(0,0,0,0),Ta.red=new Ta(1,0,0,1),Ta.blue=new Ta(0,0,1,1);var Zd=Object.freeze({__proto__:null,array:Mp,color:function(r,e,i){return new Ta(Gn(r.r,e.r,i),Gn(r.g,e.g,i),Gn(r.b,e.b,i),Gn(r.a,e.a,i))},number:Gn});class Yl extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class nd{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,u]of i)this.bindings[s]=u}concat(e){return new nd(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Dc={kind:"null"},En={kind:"number"},ta={kind:"string"},Sa={kind:"boolean"},Kl={kind:"color"},Pu={kind:"object"},va={kind:"value"},If={kind:"collator"},rd={kind:"formatted"},Hc={kind:"resolvedImage"};function al(r,e){return{kind:"array",itemType:r,N:e}}function io(r){if(r.kind==="array"){const e=io(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const Cp=[Dc,En,ta,Sa,Kl,rd,Pu,al(va),Hc];function $c(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!$c(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of Cp)if(!$c(i,e))return null}}return`Expected ${io(r)} but found ${io(e)} instead.`}function Rh(r,e){return e.some((i=>i.kind===r.kind))}function Lu(r,e){return e.some((i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r))}function Md(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&Md(r.itemType,e.itemType):r.kind===e.kind}class Jf{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class po{constructor(e,i,s,u,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=u,this.textColor=p}}class Pl{constructor(e){this.sections=e}static fromString(e){return new Pl([new po(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((e=>e.text.length!==0||!!e.image&&e.image.hasPrimary()))}static factory(e){return e instanceof Pl?e:Pl.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map((e=>e.text)).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const u=i.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(s)}return e}}class ga{constructor(e,i={}){this.id=Rl.from(e),this.params=i.params,this.sx=i.sx||1,this.sy=i.sy||1}toString(){return JSON.stringify(this)}static parse(e){let i,s,u,p;try{({id:i,params:s,sx:u,sy:p}=JSON.parse(e)||{})}catch{return null}return i?new ga(i,{params:s,sx:u,sy:p}):null}scaleSelf(e,i=e){return this.sx*=e,this.sy*=i,this}}class Io{constructor(e,i,s,u,p=!1){this.primaryId=Rl.from(e),this.primaryOptions=i,s&&(this.secondaryId=Rl.from(s)),this.secondaryOptions=u,this.available=p}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ga(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ga(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?Io.build({name:e}):e}static build(e,i,s,u){return!e||typeof e=="object"&&!("name"in e)?null:new Io(e,s,i,u)}}function Is(r,e,i,s){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[r,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[r,e,i,s]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ys(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof Ta||r instanceof Jf||r instanceof Pl||r instanceof Io)return!0;if(Array.isArray(r)){for(const e of r)if(!ys(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!ys(r[e]))return!1;return!0}return!1}function no(r){if(r===null)return Dc;if(typeof r=="string")return ta;if(typeof r=="boolean")return Sa;if(typeof r=="number")return En;if(r instanceof Ta)return Kl;if(r instanceof Jf)return If;if(r instanceof Pl)return rd;if(r instanceof Io)return Hc;if(Array.isArray(r)){const e=r.length;let i;for(const s of r){const u=no(s);if(i){if(i===u)continue;i=va;break}i=u}return al(i||va,e)}return Pu}function Ll(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof Pl||r instanceof Io||r instanceof Ta?r.toString():JSON.stringify(r)}class Rc{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ys(e[1]))return i.error("invalid value");const s=e[1];let u=no(s);const p=i.expectedType;return u.kind!=="array"||u.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(u=p),new Rc(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ta?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Pl?this.value.serialize():this.value}}class Js{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Zc={string:ta,number:En,boolean:Sa,object:Pu};class Jl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,u=1;const p=e[0];if(p==="array"){let v,E;if(e.length>2){const C=e[1];if(typeof C!="string"||!(C in Zc)||C==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);v=Zc[C],u++}else v=va;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);E=e[2],u++}s=al(v,E)}else s=Zc[p];const _=[];for(;u<e.length;u++){const v=i.parse(e[u],u,va);if(!v)return null;_.push(v)}return new Jl(s,_)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!$c(this.type,no(s)))return s;if(i===this.args.length-1)throw new Js(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${io(no(s))} but was expected to be of type ${io(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map((s=>s.serialize())))}}class Mo{constructor(e){this.type=rd,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const u=[];let p=!1;for(let _=1;_<=e.length-1;++_){const v=e[_];if(p&&typeof v=="object"&&!Array.isArray(v)){p=!1;let E=null;if(v["font-scale"]&&(E=i.parseObjectValue(v["font-scale"],_,"font-scale",En),!E))return null;let C=null;if(v["text-font"]&&(C=i.parseObjectValue(v["text-font"],_,"text-font",al(ta)),!C))return null;let k=null;if(v["text-color"]&&(k=i.parseObjectValue(v["text-color"],_,"text-color",Kl),!k))return null;const F=u[u.length-1];F.scale=E,F.font=C,F.textColor=k}else{const E=i.parse(e[_],_,va);if(!E)return null;const C=E.type.kind;if(C!=="string"&&C!=="value"&&C!=="null"&&C!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,u.push({content:E,scale:null,font:null,textColor:null})}}return new Mo(u)}evaluate(e){return new Pl(this.sections.map((i=>{const s=i.content.evaluate(e);return Md(no(s),Hc)?new po("",s,null,null,null):new po(Ll(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)})))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class cr{constructor(e,i,s,u){this._imageWarnHistory={},this.type=Hc,this.namePrimary=e,this.nameSecondary=i,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const u=[];function p(){if(s<e.length){const v=i.parse(e[s],s++,ta);return v?(u.push({image:v,options:{}}),!0):(i.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function _(){if(s<e.length){const E=e[s];if((v=E)===null||typeof v!="object"||Array.isArray(v))return!0;const C=E.params,k=E.iconset,F=i.concat(s);if(!C&&!k)return s++,!0;if(C){if(typeof C!="object"||C.constructor!==Object)return F.error('Image options "params" should be an object'),!1;const V={},j=F.concat(void 0,"params");for(const $ in C){if(!$)return j.error("Image parameter name should be non-empty"),!1;const ee=j.concat(void 0,$).parse(C[$],void 0,Kl,void 0,{typeAnnotation:"coerce"});if(!ee)return!1;V[$]=ee}u[u.length-1].options.params=V}if(k){if(typeof k!="object"||k.constructor!==Object)return F.error('Image options "iconset" should be an object'),!1;if(!k.id)return F.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=k}return s++,!0}var v;return!0}for(let v=0;v<2;v++)if(!p()||!_())return;return new cr(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const u in i)if(i[u])try{s[u]=i[u].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=Io.build(i,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const p=u.getPrimary().id;if(u.available=e.availableImages.some((_=>Rl.isEqual(_,p))),u.available){const _=u.getSecondary()?u.getSecondary().id:null;_&&(u.available=e.availableImages.some((v=>Rl.isEqual(v,_))))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const s={};if(i&&(s.iconset={id:i}),e){s.params={};for(const u in e)e[u]&&(s.params[u]=e[u].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function xn(r){return Un(r)?"string":ku(r)?"number":Ph(r)?"boolean":Array.isArray(r)?"array":r===null?"null":ad(r)?"object":typeof r}function ad(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function Un(r){return typeof r=="string"||r instanceof String}function ku(r){return typeof r=="number"||r instanceof Number}function Ph(r){return typeof r=="boolean"||r instanceof Boolean}const jn={"to-boolean":Sa,"to-color":Kl,"to-number":En,"to-string":ta};class Pc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],u=[];let p=Dc;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const _=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);p=al(i.expectedType.itemType,_)}else{if(!(_>0&&ys(e[1][0])))return null;p=al(no(e[1][0]),_)}for(let v=0;v<_;v++){const E=e[1][v];let C;if(Array.isArray(E))C=i.parse(E,void 0,p.itemType);else{const k=xn(E);if(k!==p.itemType.kind)return i.error(`Expected ${p.itemType.kind} but found ${k}.`);C=i.registry.literal.parse(["literal",E===void 0?null:E],i)}if(!C)return null;u.push(C)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");p=jn[s];for(let _=1;_<e.length;_++){const v=i.parse(e[_],_,va);if(!v)return null;u.push(v)}}return new Pc(p,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const u of this.args){if(i=u.evaluate(e),s=null,i instanceof Ta)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:Is(i[0],i[1],i[2],i[3]),!s))return new Ta(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Js(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Js(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Pl.fromString(Ll(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Io.build(Ll(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map((i=>i.evaluate(e))):Ll(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Mo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new cr(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((i=>{e.push(i.serialize())})),e}}const Xd=["Unknown","Point","LineString","Polygon"];class Lh{constructor(e,i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Xd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Ta.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class $o{constructor(e,i,s,u,p){this.name=e,this.type=i,this._evaluate=s,this.args=u,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const i=$o.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((e=>e.serialize())))}static parse(e,i){const s=e[0],u=$o.definitions[s];if(!u)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(u)?u[0]:u.type,_=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,v=[];let E=null,C=-1;for(const[k,F]of _){if(Array.isArray(k)&&k.length!==e.length-1)continue;v.push(k),C++,E=new ch(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const V=[];let j=!1;for(let $=1;$<e.length;$++){const ee=e[$],oe=Array.isArray(k)?k[$-1]:k.type,se=E.parse(ee,1+V.length,oe);if(!se){j=!0;break}V.push(se)}if(!j)if(Array.isArray(k)&&k.length!==V.length)E.error(`Expected ${k.length} arguments, but found ${V.length} instead.`);else{for(let $=0;$<V.length;$++){const ee=Array.isArray(k)?k[$]:k.type,oe=V[$];E.concat($+1).checkSubtype(ee,oe.type)}if(E.errors.length===0)return new $o(s,p,F,V,C)}}if(v.length===1)i.errors.push(...E.errors);else{const k=(v.length?v:_.map((([V])=>V))).map(Mf).join(" | "),F=[];for(let V=1;V<e.length;V++){const j=i.parse(e[V],1+F.length);if(!j)return null;F.push(io(j.type))}i.error(`Expected arguments of type ${k}, but found (${F.join(", ")}) instead.`)}return null}static register(e,i){$o.definitions=i;for(const s in i)e[s]=$o}}function Mf(r){return Array.isArray(r)?`(${r.map(io).join(", ")})`:`(${io(r.type)}...)`}class ds{constructor(e,i,s){this.type=If,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const u=s["case-sensitive"]===void 0?i.parse(!1,1,Sa):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",Sa);if(!u)return null;const p=s["diacritic-sensitive"]===void 0?i.parse(!1,1,Sa):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",Sa);if(!p)return null;let _=null;return s.locale&&(_=i.parseObjectValue(s.locale,1,"locale",ta),!_)?null:new ds(u,p,_)}evaluate(e){return new Jf(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function Ua(r,e,i=0,s=r.length-1,u=Qf){for(;s>i;){if(s-i>600){const E=s-i+1,C=e-i+1,k=Math.log(E),F=.5*Math.exp(2*k/3),V=.5*Math.sqrt(k*F*(E-F)/E)*(C-E/2<0?-1:1);Ua(r,e,Math.max(i,Math.floor(e-C*F/E+V)),Math.min(s,Math.floor(e+(E-C)*F/E+V)),u)}const p=r[e];let _=i,v=s;for(uc(r,i,e),u(r[s],p)>0&&uc(r,i,s);_<v;){for(uc(r,_,v),_++,v--;u(r[_],p)<0;)_++;for(;u(r[v],p)>0;)v--}u(r[i],p)===0?uc(r,i,v):(v++,uc(r,v,s)),v<=e&&(i=v+1),e<=v&&(s=v-1)}}function uc(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}function Qf(r,e){return r<e?-1:r>e?1:0}function sh(r){let e=0;for(let i,s,u=0,p=r.length,_=p-1;u<p;_=u++)i=r[u],s=r[_],e+=(s.x-i.x)*(i.y+s.y);return e}function gl(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function sd(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function ep(r,e,i){const s=r[0]-e[0],u=r[1]-e[1],p=r[0]-i[0],_=r[1]-i[1];return s*_-p*u==0&&s*p<=0&&u*_<=0}function du(r,e,i=!1){let s=!1;for(let v=0,E=e.length;v<E;v++){const C=e[v];for(let k=0,F=C.length,V=F-1;k<F;V=k++){const j=C[V],$=C[k];if(ep(r,j,$))return i;(p=j)[1]>(u=r)[1]!=(_=$)[1]>u[1]&&u[0]<(_[0]-p[0])*(u[1]-p[1])/(_[1]-p[1])+p[0]&&(s=!s)}}var u,p,_;return s}function od(r,e,i,s){const u=s[0]-i[0],p=s[1]-i[1],_=(r[0]-i[0])*p-u*(r[1]-i[1]),v=(e[0]-i[0])*p-u*(e[1]-i[1]);return _>0&&v<0||_<0&&v>0}function fu(r,e,i,s){return(u=[s[0]-i[0],s[1]-i[1]])[0]*(p=[e[0]-r[0],e[1]-r[1]])[1]-u[1]*p[0]!=0&&!(!od(r,e,i,s)||!od(i,s,r,e));var u,p}function Lc(r){const e=new je(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new je(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const s of r[0])e.x>s.x&&(e.x=s.x),e.y>s.y&&(e.y=s.y),i.x<s.x&&(i.x=s.x),i.y<s.y&&(i.y=s.y);return{min:e,max:i}}const kc=8192;function pu(r,e){const i=(180+r[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*kc),Math.round(s*u*kc)]}function Xc(r,e){for(let i=0;i<e.length;i++)if(du(r,e[i]))return!0;return!1}function Cf(r,e,i){for(const s of i)for(let u=0,p=s.length,_=p-1;u<p;_=u++)if(fu(r,e,s[_],s[u]))return!0;return!1}function ld(r,e){for(let i=0;i<r.length;++i)if(!du(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(Cf(r[i],r[i+1],e))return!1;return!0}function mu(r,e){for(let i=0;i<e.length;i++)if(ld(r,e[i]))return!0;return!1}function Cd(r,e,i){const s=[];for(let u=0;u<r.length;u++){const p=[];for(let _=0;_<r[u].length;_++){const v=pu(r[u][_],i);gl(e,v),p.push(v)}s.push(p)}return s}function _u(r,e,i){const s=[];for(let u=0;u<r.length;u++){const p=Cd(r[u],e,i);s.push(p)}return s}function zf(r,e,i,s){if(r[0]<i[0]||r[0]>i[2]){const u=.5*s;let p=r[0]-i[0]>u?-s:i[0]-r[0]>u?s:0;p===0&&(p=r[0]-i[2]>u?-s:i[2]-r[0]>u?s:0),r[0]+=p}gl(e,r)}function um(r,e,i,s){const u=Math.pow(2,s.z)*kc,p=[s.x*kc,s.y*kc],_=[];if(!r)return _;for(const v of r)for(const E of v){const C=[E.x+p[0],E.y+p[1]];zf(C,e,i,u),_.push(C)}return _}function Df(r,e,i,s){const u=Math.pow(2,s.z)*kc,p=[s.x*kc,s.y*kc],_=[];if(!r)return _;for(const E of r){const C=[];for(const k of E){const F=[k.x+p[0],k.y+p[1]];gl(e,F),C.push(F)}_.push(C)}if(e[2]-e[0]<=u/2){(v=e)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const E of _)for(const C of E)zf(C,e,i,u)}var v;return _}class Ou{constructor(e,i){this.type=Sa,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ys(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let u=0;u<s.features.length;++u){const p=s.features[u].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Ou(s,s.features[u].geometry)}else if(s.type==="Feature"){const u=s.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Ou(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Ou(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return(function(i,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(s.type==="Polygon"){const v=Cd(s.coordinates,p,_),E=um(i.geometry(),u,p,_);if(!sd(u,p))return!1;for(const C of E)if(!du(C,v))return!1}if(s.type==="MultiPolygon"){const v=_u(s.coordinates,p,_),E=um(i.geometry(),u,p,_);if(!sd(u,p))return!1;for(const C of E)if(!Xc(C,v))return!1}return!0})(e,this.geometries);if(e.geometryType()==="LineString")return(function(i,s){const u=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],_=i.canonicalID();if(!_)return!1;if(s.type==="Polygon"){const v=Cd(s.coordinates,p,_),E=Df(i.geometry(),u,p,_);if(!sd(u,p))return!1;for(const C of E)if(!ld(C,v))return!1}if(s.type==="MultiPolygon"){const v=_u(s.coordinates,p,_),E=Df(i.geometry(),u,p,_);if(!sd(u,p))return!1;for(const C of E)if(!mu(C,v))return!1}return!0})(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const cd={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},kl=1/298.257223563,ud=kl*(2-kl),Gs=Math.PI/180;class hc{static fromTile(e,i,s){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),p=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Gs;return new hc(p,s)}static get units(){return cd}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!cd[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(cd).join(", ")}`);const s=6378.137*Gs*(i?cd[i]:1),u=Math.cos(e*Gs),p=1/(1-ud*(1-u*u)),_=Math.sqrt(p);this.kx=s*_*u,this.ky=s*_*p*(1-ud)}distance(e,i){const s=os(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+u*u)}bearing(e,i){const s=os(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/Gs}destination(e,i,s){const u=s*Gs;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const u=e[s];for(let p=0,_=u.length,v=_-1;p<_;v=p++)i+=os(u[p][0]-u[v][0])*(u[p][1]+u[v][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){const p=e[u],_=e[u+1],v=this.distance(p,_);if(s+=v,s>i)return oh(p,_,(i-(s-v))/v)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[u,p]=i,_=os(s[0]-u)*this.kx,v=(s[1]-p)*this.ky;if(_!==0||v!==0){const E=(os(e[0]-u)*this.kx*_+(e[1]-p)*this.ky*v)/(_*_+v*v);E>1?(u=s[0],p=s[1]):E>0&&(u+=_/this.kx*E,p+=v/this.ky*E)}return _=os(e[0]-u)*this.kx,v=(e[1]-p)*this.ky,Math.sqrt(_*_+v*v)}pointOnLine(e,i){let s=1/0,u=e[0][0],p=e[0][1],_=0,v=0;for(let E=0;E<e.length-1;E++){let C=e[E][0],k=e[E][1],F=os(e[E+1][0]-C)*this.kx,V=(e[E+1][1]-k)*this.ky,j=0;F===0&&V===0||(j=(os(i[0]-C)*this.kx*F+(i[1]-k)*this.ky*V)/(F*F+V*V),j>1?(C=e[E+1][0],k=e[E+1][1]):j>0&&(C+=F/this.kx*j,k+=V/this.ky*j)),F=os(i[0]-C)*this.kx,V=(i[1]-k)*this.ky;const $=F*F+V*V;$<s&&(s=$,u=C,p=k,_=E,v=j)}return{point:[u,p],index:_,t:Math.max(0,Math.min(1,v))}}lineSlice(e,i,s){let u=this.pointOnLine(s,e),p=this.pointOnLine(s,i);if(u.index>p.index||u.index===p.index&&u.t>p.t){const C=u;u=p,p=C}const _=[u.point],v=u.index+1,E=p.index;!dc(s[v],_[0])&&v<=E&&_.push(s[v]);for(let C=v+1;C<=E;C++)_.push(s[C]);return dc(s[E],p.point)||_.push(p.point),_}lineSliceAlong(e,i,s){let u=0;const p=[];for(let _=0;_<s.length-1;_++){const v=s[_],E=s[_+1],C=this.distance(v,E);if(u+=C,u>e&&p.length===0&&p.push(oh(v,E,(e-(u-C))/C)),u>=i)return p.push(oh(v,E,(i-(u-C))/C)),p;u>e&&p.push(E)}return p}bufferPoint(e,i){const s=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-s,e[0]+u,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-s,e[2]+u,e[3]+s]}insideBBox(e,i){return os(e[0]-i[0])>=0&&os(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function dc(r,e){return r[0]===e[0]&&r[1]===e[1]}function oh(r,e,i){const s=os(e[0]-r[0]);return[r[0]+s*i,r[1]+(e[1]-r[1])*i]}function os(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class Ol{constructor(e=[],i=((s,u)=>s<u?-1:s>u?1:0)){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,u=i[e];for(;e>0;){const p=e-1>>1,_=i[p];if(s(u,_)>=0)break;i[e]=_,e=p}i[e]=u}_down(e){const{data:i,compare:s}=this,u=this.length>>1,p=i[e];for(;e<u;){let _=1+(e<<1);const v=_+1;if(v<this.length&&s(i[v],i[_])<0&&(_=v),s(i[_],p)>=0)break;i[e]=i[_],e=_}i[e]=p}}var pi=8192;function kh(r,e){return e.dist-r.dist}const gu=100,hd=50;function Bu(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function yl(r){return r[1]-r[0]+1}function yu(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function xl(r,e){if(r[0]>r[1])return[null,null];const i=yl(r);if(e){if(i===2)return[r,null];const s=Math.floor(i/2);return[[r[0],r[0]+s],[r[0]+s,r[1]]]}{if(i===1)return[r,null];const s=Math.floor(i/2)-1;return[[r[0],r[0]+s],[r[0]+s+1,r[1]]]}}function Fu(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!yu(e,r.length))return i;for(let s=e[0];s<=e[1];++s)gl(i,r[s]);return i}function vl(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let s=0;s<r[i].length;++s)gl(e,r[i][s]);return e}function Nu(r,e,i){if(Bu(r)||Bu(e))return NaN;let s=0,u=0;return r[2]<e[0]&&(s=e[0]-r[2]),r[0]>e[2]&&(s=r[0]-e[2]),r[1]>e[3]&&(u=r[1]-e[3]),r[3]<e[1]&&(u=e[1]-r[3]),i.distance([0,0],[s,u])}function Oh(r){return 360*r-180}function Oc(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Bh(r,e){const i=Math.pow(2,e.z),s=(r.y/pi+e.y)/i;return[Oh((r.x/pi+e.x)/i),Oc(s)]}function Wd(r,e){const i=[];for(let s=0;s<r.length;++s)i.push(Bh(r[s],e));return i}function Yd(r,e,i){const s=i.pointOnLine(e,r).point;return i.distance(r,s)}function Kd(r,e,i,s,u){const p=i.slice(s[0],s[1]+1);let _=1/0;for(let v=e[0];v<=e[1];++v)if((_=Math.min(_,Yd(r[v],p,u)))===0)return 0;return _}function Zo(r,e,i,s,u){const p=Math.min(u.pointToSegmentDistance(r,i,s),u.pointToSegmentDistance(e,i,s)),_=Math.min(u.pointToSegmentDistance(i,r,e),u.pointToSegmentDistance(s,r,e));return Math.min(p,_)}function Or(r,e,i,s,u){if(!yu(e,r.length)||!yu(s,i.length))return NaN;let p=1/0;for(let _=e[0];_<e[1];++_)for(let v=s[0];v<s[1];++v){if(fu(r[_],r[_+1],i[v],i[v+1]))return 0;p=Math.min(p,Zo(r[_],r[_+1],i[v],i[v+1],u))}return p}function Fh(r,e,i,s,u){if(!yu(e,r.length)||!yu(s,i.length))return NaN;let p=1/0;for(let _=e[0];_<=e[1];++_)for(let v=s[0];v<=s[1];++v)if((p=Math.min(p,u.distance(r[_],i[v])))===0)return p;return p}function dd(r,e,i){if(du(r,e,!0))return 0;let s=1/0;for(const u of e){const p=u.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[p-1]&&(s=Math.min(s,i.pointToSegmentDistance(r,u[p-1],u[0])))===0||(s=Math.min(s,Yd(r,u,i)))===0)return s}return s}function Jd(r,e,i,s){if(!yu(e,r.length))return NaN;for(let p=e[0];p<=e[1];++p)if(du(r[p],i,!0))return 0;let u=1/0;for(let p=e[0];p<e[1];++p)for(const _ of i)for(let v=0,E=_.length,C=E-1;v<E;C=v++){if(fu(r[p],r[p+1],_[C],_[v]))return 0;u=Math.min(u,Zo(r[p],r[p+1],_[C],_[v],s))}return u}function Ao(r,e){for(const i of r)for(let s=0;s<=i.length-1;++s)if(du(i[s],e,!0))return!0;return!1}function Xo(r,e,i,s=1/0){const u=vl(r),p=vl(e);if(s!==1/0&&Nu(u,p,i)>=s)return s;if(sd(u,p)){if(Ao(r,e))return 0}else if(Ao(e,r))return 0;let _=s;for(const v of r)for(let E=0,C=v.length,k=C-1;E<C;k=E++)for(const F of e)for(let V=0,j=F.length,$=j-1;V<j;$=V++){if(fu(v[k],v[E],F[$],F[V]))return 0;_=Math.min(_,Zo(v[k],v[E],F[$],F[V],i))}return _}function Ra(r,e,i,s,u,p,_){if(p===null||_===null)return;const v=Nu(Fu(s,p),Fu(u,_),i);v<e&&r.push({dist:v,range1:p,range2:_})}function sl(r,e,i,s,u=1/0){let p=Math.min(s.distance(r[0],i[0][0]),u);if(p===0)return p;const _=new Ol([{dist:0,range1:[0,r.length-1],range2:[0,0]}],kh),v=e?hd:gu,E=vl(i);for(;_.length;){const C=_.pop();if(C.dist>=p)continue;const k=C.range1;if(yl(k)<=v){if(!yu(k,r.length))return NaN;if(e){const F=Jd(r,k,i,s);if((p=Math.min(p,F))===0)return p}else for(let F=k[0];F<=k[1];++F){const V=dd(r[F],i,s);if((p=Math.min(p,V))===0)return p}}else{const F=xl(k,e);if(F[0]!==null){const V=Nu(Fu(r,F[0]),E,s);V<p&&_.push({dist:V,range1:F[0],range2:[0,0]})}if(F[1]!==null){const V=Nu(Fu(r,F[1]),E,s);V<p&&_.push({dist:V,range1:F[1],range2:[0,0]})}}}return p}function Bl(r,e,i,s,u,p=1/0){let _=Math.min(p,u.distance(r[0],i[0]));if(_===0)return _;const v=new Ol([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],kh),E=e?hd:gu,C=s?hd:gu;for(;v.length;){const k=v.pop();if(k.dist>=_)continue;const F=k.range1,V=k.range2;if(yl(F)<=E&&yl(V)<=C){if(!yu(F,r.length)||!yu(V,i.length))return NaN;if(e&&s?_=Math.min(_,Or(r,F,i,V,u)):e||s?e&&!s?_=Math.min(_,Kd(i,V,r,F,u)):!e&&s&&(_=Math.min(_,Kd(r,F,i,V,u))):_=Math.min(_,Fh(r,F,i,V,u)),_===0)return _}else{const j=xl(F,e),$=xl(V,s);Ra(v,_,u,r,i,j[0],$[0]),Ra(v,_,u,r,i,j[0],$[1]),Ra(v,_,u,r,i,j[1],$[0]),Ra(v,_,u,r,i,j[1],$[1])}}return _}function Vu(r,e,i,s,u=1/0){let p=u;const _=Fu(r,[0,r.length-1]);for(const v of i)if(!(p!==1/0&&Nu(_,Fu(v,[0,v.length-1]),s)>=p)&&(p=Math.min(p,Bl(r,e,v,!0,s,p)),p===0))return p;return p}function Rf(r,e,i,s,u=1/0){let p=u;const _=Fu(r,[0,r.length-1]);for(const v of i){if(p!==1/0&&Nu(_,vl(v),s)>=p)continue;const E=sl(r,e,v,s,p);if(isNaN(E))return E;if((p=Math.min(p,E))===0)return p}return p}function Qd(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class lh{constructor(e,i){this.type=En,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(ys(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let u=0;u<s.features.length;++u)if(Qd(s.features[u].geometry.type))return new lh(s,s.features[u].geometry)}else if(s.type==="Feature"){if(Qd(s.geometry.type))return new lh(s,s.geometry)}else if(Qd(s.type))return new lh(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return(function(u,p,_){const v=[];for(const C of u)for(const k of C)v.push(Bh(k,p));const E=new hc(v[0][1],"meters");return _.type==="Point"||_.type==="MultiPoint"||_.type==="LineString"?Bl(v,!1,_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",E):_.type==="MultiLineString"?Vu(v,!1,_.coordinates,E):_.type==="Polygon"||_.type==="MultiPolygon"?Rf(v,!1,_.type==="Polygon"?[_.coordinates]:_.coordinates,E):null})(i,s,this.geometries);if(e.geometryType()==="LineString")return(function(u,p,_){const v=[];for(const C of u){const k=[];for(const F of C)k.push(Bh(F,p));v.push(k)}const E=new hc(v[0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Vu(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,E);if(_.type==="MultiLineString"){let C=1/0;for(let k=0;k<_.coordinates.length;k++){const F=Vu(_.coordinates[k],!0,v,E,C);if(isNaN(F))return F;if((C=Math.min(C,F))===0)return C}return C}if(_.type==="Polygon"||_.type==="MultiPolygon"){let C=1/0;for(let k=0;k<v.length;k++){const F=Rf(v[k],!0,_.type==="Polygon"?[_.coordinates]:_.coordinates,E,C);if(isNaN(F))return F;if((C=Math.min(C,F))===0)return C}return C}return null})(i,s,this.geometries);if(e.geometryType()==="Polygon")return(function(u,p,_){const v=[];for(const C of(function(k,F){const V=k.length;if(V<=1)return[k];const j=[];let $,ee;for(let oe=0;oe<V;oe++){const se=sh(k[oe]);se!==0&&(k[oe].area=Math.abs(se),ee===void 0&&(ee=se<0),ee===se<0?($&&j.push($),$=[k[oe]]):$.push(k[oe]))}return $&&j.push($),j})(u)){const k=[];for(let F=0;F<C.length;++F)k.push(Wd(C[F],p));v.push(k)}const E=new hc(v[0][0][0][1],"meters");if(_.type==="Point"||_.type==="MultiPoint"||_.type==="LineString")return Rf(_.type==="Point"?[_.coordinates]:_.coordinates,_.type==="LineString",v,E);if(_.type==="MultiLineString"){let C=1/0;for(let k=0;k<_.coordinates.length;k++){const F=Rf(_.coordinates[k],!0,v,E,C);if(isNaN(F))return F;if((C=Math.min(C,F))===0)return C}return C}return _.type==="Polygon"||_.type==="MultiPolygon"?(function(C,k,F){let V=1/0;for(const j of C)for(const $ of k){const ee=Xo(j,$,F,V);if(isNaN(ee))return ee;if((V=Math.min(V,ee))===0)return V}return V})(_.type==="Polygon"?[_.coordinates]:_.coordinates,v,E):null})(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Nh(r){if(r instanceof $o&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Ou||r instanceof lh)return!1;if(r instanceof Vh)return r.featureConstant;let e=!0;return r.eachChild((i=>{e&&!Nh(i)&&(e=!1)})),e}function mo(r){if(r instanceof $o&&r.name==="feature-state")return!1;let e=!0;return r.eachChild((i=>{e&&!mo(i)&&(e=!1)})),e}function ja(r,e){if(r instanceof $o&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild((s=>{i&&!ja(s,e)&&(i=!1)})),i}function fn(r,e,i){return[r,e,i].filter(Boolean).join("")}function Wc(r,e){switch(r){case"string":return Ll(e);case"number":return+e;case"boolean":return!!e;case"color":return Ta.parse(e);case"formatted":return Pl.fromString(Ll(e));case"resolvedImage":return Io.build(Ll(e))}return e}function fc(r,e,i,s){return s!==void 0&&(r=s*Math.round(r/s)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Vh{constructor(e,i,s,u=!1){this.type=e,this.key=i,this.scope=s,this.featureConstant=u}static parse(e,i){let s=i.expectedType;if(s==null&&(s=va),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const u=i.parse(e[1],1);if(!(u instanceof Rc))return i.error("Key name of 'config' expression must be a string literal.");let p,_=!0;const v=Ll(u.value);if(e.length>=3){const E=i.parse(e[2],2);if(!(E instanceof Rc))return i.error("Scope of 'config' expression must be a string literal.");p=Ll(E.value)}if(i.options){const E=fn(v,p,i._scope),C=i.options.get(E);C&&(_=Nh(C.value||C.default))}return new Vh(s,v,p,_)}evaluate(e){const i=fn(this.key,this.scope,e.scope),s=e.getConfig(i);if(!s)return null;const{type:u,value:p,values:_,minValue:v,maxValue:E,stepValue:C}=s,k=s.default.evaluate(e);let F=k;if(p){const V=e.scope;e.scope=(V||"").split("").slice(1).join(""),F=p.evaluate(e),e.scope=V}return u&&(F=Wc(u,F)),F===void 0||v===void 0&&E===void 0&&C===void 0||(typeof F=="number"?F=fc(F,v,E,C):Array.isArray(F)&&(F=F.map((V=>typeof V=="number"?fc(V,v,E,C):V)))),p!==void 0&&F!==void 0&&_&&!_.includes(F)&&(F=k,u&&(F=Wc(u,F))),(u&&u!==this.type||F!==void 0&&!Md(no(F),this.type))&&(F=Wc(this.type.kind,F)),F}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Ql{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new Ql(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ch{constructor(e,i=[],s,u=new nd,p=[],_,v,E){this.registry=e,this.path=i,this.key=i.map((C=>typeof C=="string"?`['${C}']`:`[${C}]`)).join(""),this.scope=u,this.errors=p,this.expectedType=s,this._scope=_,this.options=v,this.iconImageUseTheme=E}parse(e,i,s,u,p={}){return i||s?this.concat(i,null,s,u)._parse(e,p):this._parse(e,p)}parseObjectValue(e,i,s,u,p,_={}){return this.concat(i,s,u,p)._parse(e,_)}_parse(e,i){function s(u,p,_){return _==="assert"?new Jl(p,[u]):_==="coerce"?new Pc(p,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let p=u.parse(e,this);if(!p)return null;if(this.expectedType){const _=this.expectedType,v=p.type;if(_.kind!=="string"&&_.kind!=="number"&&_.kind!=="boolean"&&_.kind!=="object"&&_.kind!=="array"||v.kind!=="value")if(_.kind!=="color"&&_.kind!=="formatted"&&_.kind!=="resolvedImage"||v.kind!=="value"&&v.kind!=="string"){if(this.checkSubtype(_,v))return null}else p=s(p,_,i.typeAnnotation||"coerce");else p=s(p,_,i.typeAnnotation||"assert")}if(!(p instanceof Rc)&&p.type.kind!=="resolvedImage"&&ef(p)){const _=new Lh(this._scope,this.options,this.iconImageUseTheme);try{p=new Rc(p.type,p.evaluate(_))}catch(v){return this.error(v.message),null}}return p}return Pc.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,u){let p=typeof e=="number"?this.path.concat(e):this.path;p=typeof i=="string"?p.concat(i):p;const _=u?this.scope.concat(u):this.scope;return new ch(this.registry,p,s||null,_,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const s=`${this.key}${i.map((u=>`[${u}]`)).join("")}`;this.errors.push(new Yl(s,e))}checkSubtype(e,i){const s=$c(e,i);return s&&this.error(s),s}}function ef(r){if(r instanceof Ql)return ef(r.boundExpression);if(r instanceof $o&&r.name==="error"||r instanceof ds||r instanceof Ou||r instanceof lh||r instanceof Vh)return!1;const e=r instanceof Pc||r instanceof Jl;let i=!0;return r.eachChild((s=>{i=e?i&&ef(s):i&&s instanceof Rc})),!!i&&Nh(r)&&ja(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ia(r,e){const i=r.length-1;let s,u,p=0,_=i,v=0;for(;p<=_;)if(v=Math.floor((p+_)/2),s=r[v],u=r[v+1],s<=e){if(v===i||e<u)return v;p=v+1}else{if(!(s>e))throw new Js("Input is not a number.");_=v-1}return 0}class Yc{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,p]of s)this.labels.push(u),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,En);if(!s)return null;const u=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let _=1;_<e.length;_+=2){const v=_===1?-1/0:e[_],E=e[_+1],C=_,k=_+1;if(typeof v!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(u.length&&u[u.length-1][0]>=v)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const F=i.parse(E,k,p);if(!F)return null;p=p||F.type,u.push([v,F])}return new Yc(p,s,u)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const p=i.length;return u>=i[p-1]?s[p-1].evaluate(e):s[Ia(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const tp=.95047,fd=1.08883,ip=4/29,Fl=6/29,Uu=3*Fl*Fl,uh=Fl*Fl*Fl,hh=Math.PI/180,zp=180/Math.PI;function zd(r){return r>uh?Math.pow(r,1/3):r/Uu+ip}function pd(r){return r>Fl?r*r*r:Uu*(r-ip)}function tf(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Wo(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function ka(r){const e=Wo(r.r),i=Wo(r.g),s=Wo(r.b),u=zd((.4124564*e+.3575761*i+.1804375*s)/tp),p=zd((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*p-16,a:500*(u-p),b:200*(p-zd((.0193339*e+.119192*i+.9503041*s)/fd)),alpha:r.a}}function xu(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,s=isNaN(r.b)?e:e-r.b/200;return e=1*pd(e),i=tp*pd(i),s=fd*pd(s),new Ta(tf(3.2404542*i-1.5371385*e-.4985314*s),tf(-.969266*i+1.8760108*e+.041556*s),tf(.0556434*i-.2040259*e+1.0572252*s),r.alpha)}function md(r,e,i){const s=e-r;return r+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Uh={forward:ka,reverse:xu,interpolate:function(r,e,i){return{l:Gn(r.l,e.l,i),a:Gn(r.a,e.a,i),b:Gn(r.b,e.b,i),alpha:Gn(r.alpha,e.alpha,i)}}},nf={forward:function(r){const{l:e,a:i,b:s}=ka(r),u=Math.atan2(s,i)*zp;return{h:u<0?u+360:u,c:Math.sqrt(i*i+s*s),l:e,alpha:r.a}},reverse:function(r){const e=r.h*hh,i=r.c;return xu({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:md(r.h,e.h,i),c:Gn(r.c,e.c,i),l:Gn(r.l,e.l,i),alpha:Gn(r.alpha,e.alpha,i)}}};var rf=Object.freeze({__proto__:null,hcl:nf,lab:Uh});class ls{constructor(e,i,s,u,p){this.type=e,this.operator=i,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[_,v]of p)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(e,i,s,u){let p=0;if(e.name==="exponential")p=pc(i,e.base,s,u);else if(e.name==="linear")p=pc(i,1,s,u);else if(e.name==="cubic-bezier"){const _=e.controlPoints;p=new Nt(_[0],_[1],_[2],_[3]).solve(pc(i,1,s,u))}return p}static parse(e,i){let[s,u,p,..._]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const C=u[1];if(typeof C!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:C}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const C=u.slice(1);if(C.length!==4||C.some((k=>typeof k!="number"||k<0||k>1)))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:C}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,En),!p)return null;const v=[];let E=null;s==="interpolate-hcl"||s==="interpolate-lab"?E=Kl:i.expectedType&&i.expectedType.kind!=="value"&&(E=i.expectedType);for(let C=0;C<_.length;C+=2){const k=_[C],F=_[C+1],V=C+3,j=C+4;if(typeof k!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(v.length&&v[v.length-1][0]>=k)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const $=i.parse(F,j,E);if(!$)return null;E=E||$.type,v.push([k,$])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new ls(E,s,u,p,v):i.error(`Type ${io(E)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return s[0].evaluate(e);const p=i.length;if(u>=i[p-1])return s[p-1].evaluate(e);const _=Ia(i,u),v=ls.interpolationFactor(this.interpolation,u,i[_],i[_+1]),E=s[_].evaluate(e),C=s[_+1].evaluate(e);return this.operator==="interpolate"?Zd[this.type.kind.toLowerCase()](E,C,v):this.operator==="interpolate-hcl"?nf.reverse(nf.interpolate(nf.forward(E),nf.forward(C),v)):Uh.reverse(Uh.interpolate(Uh.forward(E),Uh.forward(C),v))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function pc(r,e,i,s){const u=s-i,p=r-i;return u===0?0:e===1?p/u:(Math.pow(e,p)-1)/(Math.pow(e,u)-1)}class Kc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const u=i.expectedType;u&&u.kind!=="value"&&(s=u);const p=[];for(const v of e.slice(1)){const E=i.parse(v,1+p.length,s,void 0,{typeAnnotation:"omit"});if(!E)return null;s=s||E.type,p.push(E)}const _=u&&p.some((v=>$c(u,v.type)));return new Kc(_?va:s,p)}evaluate(e){let i,s=null,u=0;for(const p of this.args){if(u++,s=p.evaluate(e),s&&s instanceof Io&&!s.available&&(i||(i=s),s=null,u===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every((e=>e.outputDefined()))}serialize(){const e=["coalesce"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class Xn{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let p=1;p<e.length-1;p+=2){const _=e[p];if(typeof _!="string")return i.error(`Expected string, but found ${typeof _} instead.`,p);if(/[^a-zA-Z0-9_]/.test(_))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const v=i.parse(e[p+1],p+1);if(!v)return null;s.push([_,v])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return u?new Xn(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class Pr{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,En),u=i.parse(e[2],2,al(i.expectedType||va));return s&&u?new Pr(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Js("Array index out of bounds: negative index");if(i>=s.length)throw new Js("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new Js("Array index must be an integer. Use at-interpolated for fractional indices");return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vu{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,En),u=i.parse(e[2],2,al(i.expectedType||va));return s&&u?new vu(u.type.itemType,s,u):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Js(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new Js(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const u=Math.floor(i),p=Math.ceil(i),_=s[u],v=s[p];if(typeof _!="number"||typeof v!="number")throw new Js(`Cannot interpolate between non-number values at index ${i}.`);const E=i-u;return _*(1-E)+v*E}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ju{constructor(e,i){this.type=Sa,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,va),u=i.parse(e[2],2,va);return s&&u?Rh(s.type,[Sa,ta,En,Dc,va])?new ju(s,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${io(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Lu(i,["boolean","string","number","null"]))throw new Js(`Expected first argument to be of type boolean, string, number or null, but found ${io(no(i))} instead.`);if(!Lu(s,["string","array"]))throw new Js(`Expected second argument to be of type array or string, but found ${io(no(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class _d{constructor(e,i,s){this.type=En,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,va),u=i.parse(e[2],2,va);if(!s||!u)return null;if(!Rh(s.type,[Sa,ta,En,Dc,va]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${io(s.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,En);return p?new _d(s,u,p):null}return new _d(s,u)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Lu(i,["boolean","string","number","null"]))throw new Js(`Expected first argument to be of type boolean, string, number or null, but found ${io(no(i))} instead.`);if(!Lu(s,["string","array"]))throw new Js(`Expected second argument to be of type array or string, but found ${io(no(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(i,u)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class L{constructor(e,i,s,u,p,_){this.inputType=e,this.type=i,this.input=s,this.cases=u,this.outputs=p,this.otherwise=_}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const p={},_=[];for(let C=2;C<e.length-1;C+=2){let k=e[C];const F=e[C+1];Array.isArray(k)||(k=[k]);const V=i.concat(C);if(k.length===0)return V.error("Expected at least one branch label.");for(const $ of k){if(typeof $!="number"&&typeof $!="string")return V.error("Branch labels must be numbers or strings.");if(typeof $=="number"&&Math.abs($)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof $=="number"&&Math.floor($)!==$)return V.error("Numeric branch labels must be integer values.");if(s){if(V.checkSubtype(s,no($)))return null}else s=no($);if(p[String($)]!==void 0)return V.error("Branch labels must be unique.");p[String($)]=_.length}const j=i.parse(F,C,u);if(!j)return null;u=u||j.type,_.push(j)}const v=i.parse(e[1],1,va);if(!v)return null;const E=i.parse(e[e.length-1],e.length-1,u);return E?v.type.kind!=="value"&&i.concat(1).checkSubtype(s,v.type)?null:new L(s,u,v,p,_,E):null}evaluate(e){const i=this.input.evaluate(e);return(Md(no(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every((e=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],u={};for(const _ of i){const v=u[this.cases[_]];v===void 0?(u[this.cases[_]]=s.length,s.push([this.cases[_],[_]])):s[v][1].push(_)}const p=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,v]of s)e.push(v.length===1?p(v[0]):v.map(p)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}class o{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const u=[];for(let _=1;_<e.length-1;_+=2){const v=i.parse(e[_],_,Sa);if(!v)return null;const E=i.parse(e[_+1],_+1,s);if(!E)return null;u.push([v,E]),s=s||E.type}const p=i.parse(e[e.length-1],e.length-1,s);return p?new o(s,u,p):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every((([e,i])=>i.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild((i=>{e.push(i.serialize())})),e}}class x{constructor(e,i,s,u){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,va),u=i.parse(e[2],2,En);if(!s||!u)return null;if(!Rh(s.type,[al(va),ta,va]))return i.error(`Expected first argument to be of type array or string, but found ${io(s.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,En);return p?new x(s.type,s,u,p):null}return new x(s.type,s,u)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Lu(i,["string","array"]))throw new Js(`Expected first argument to be of type array or string, but found ${io(no(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(s,u)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class A{constructor(e,i){this.type=al(ta),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,ta),u=i.parse(e[2],2,ta);return s&&u?new A(s,u):void 0}evaluate(e){const i=this.str.evaluate(e),s=this.delimiter.evaluate(e);return i.split(s)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function I(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function P(r,e,i,s){return s.compare(e,i)===0}function H(r,e,i){const s=r!=="=="&&r!=="!=";return class sw{constructor(p,_,v){this.type=Sa,this.lhs=p,this.rhs=_,this.collator=v,this.hasUntypedArgument=p.type.kind==="value"||_.type.kind==="value"}static parse(p,_){if(p.length!==3&&p.length!==4)return _.error("Expected two or three arguments.");const v=p[0];let E=_.parse(p[1],1,va);if(!E)return null;if(!I(v,E.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${io(E.type)}'.`);let C=_.parse(p[2],2,va);if(!C)return null;if(!I(v,C.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${io(C.type)}'.`);if(E.type.kind!==C.type.kind&&E.type.kind!=="value"&&C.type.kind!=="value")return _.error(`Cannot compare types '${io(E.type)}' and '${io(C.type)}'.`);s&&(E.type.kind==="value"&&C.type.kind!=="value"?E=new Jl(C.type,[E]):E.type.kind!=="value"&&C.type.kind==="value"&&(C=new Jl(E.type,[C])));let k=null;if(p.length===4){if(E.type.kind!=="string"&&C.type.kind!=="string"&&E.type.kind!=="value"&&C.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(k=_.parse(p[3],3,If),!k)return null}return new sw(E,C,k)}evaluate(p){const _=this.lhs.evaluate(p),v=this.rhs.evaluate(p);if(s&&this.hasUntypedArgument){const E=no(_),C=no(v);if(E.kind!==C.kind||E.kind!=="string"&&E.kind!=="number")throw new Js(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${E.kind}, ${C.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const E=no(_),C=no(v);if(E.kind!=="string"||C.kind!=="string")return e(p,_,v)}return this.collator?i(p,_,v,this.collator.evaluate(p)):e(p,_,v)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[r];return this.eachChild((_=>{p.push(_.serialize())})),p}}}const K=H("==",(function(r,e,i){return e===i}),P),ne=H("!=",(function(r,e,i){return e!==i}),(function(r,e,i,s){return!P(0,e,i,s)})),he=H("<",(function(r,e,i){return e<i}),(function(r,e,i,s){return s.compare(e,i)<0})),be=H(">",(function(r,e,i){return e>i}),(function(r,e,i,s){return s.compare(e,i)>0})),we=H("<=",(function(r,e,i){return e<=i}),(function(r,e,i,s){return s.compare(e,i)<=0})),Be=H(">=",(function(r,e,i){return e>=i}),(function(r,e,i,s){return s.compare(e,i)>=0}));class Ye{constructor(e,i,s,u,p,_){this.type=ta,this.number=e,this.locale=i,this.currency=s,this.unit=u,this.minFractionDigits=p,this.maxFractionDigits=_}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,En);if(!s)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let p=null;if(u.locale&&(p=i.parseObjectValue(u.locale,2,"locale",ta),!p))return null;let _=null;if(u.currency&&(_=i.parseObjectValue(u.currency,2,"currency",ta),!_))return null;let v=null;if(u.unit&&(v=i.parseObjectValue(u.unit,2,"unit",ta),!v))return null;let E=null;if(u["min-fraction-digits"]&&(E=i.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",En),!E))return null;let C=null;return u["max-fraction-digits"]&&(C=i.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",En),!C)?null:new Ye(s,p,_,v,E,C)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class st{constructor(e){this.type=En,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${io(s.type)} instead.`):new st(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Js(`Expected value to be of type string or array, but found ${io(no(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild((i=>{e.push(i.serialize())})),e}}function vt(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Et={"==":K,"!=":ne,">":be,"<":he,">=":Be,"<=":we,array:Jl,at:Pr,"at-interpolated":vu,boolean:Jl,case:o,coalesce:Kc,collator:ds,format:Mo,image:cr,in:ju,"index-of":_d,interpolate:ls,"interpolate-hcl":ls,"interpolate-lab":ls,length:st,let:Xn,literal:Rc,match:L,number:Jl,"number-format":Ye,object:Jl,slice:x,step:Yc,string:Jl,"to-boolean":Pc,"to-color":Pc,"to-number":Pc,"to-string":Pc,var:Ql,within:Ou,distance:lh,config:Vh,split:A};function Ct(r,[e,i,s,u]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const p=u?u.evaluate(r):1,_=Is(e,i,s,p);if(_)throw new Js(_);return new Ta(e/255,i/255,s/255,p)}function Lt(r,[e,i,s,u]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const p=u?u.evaluate(r):1,_=(function(C,k,F,V){return typeof C=="number"&&C>=0&&C<=360?typeof k=="number"&&k>=0&&k<=100&&typeof F=="number"&&F>=0&&F<=100?V===void 0||typeof V=="number"&&V>=0&&V<=1?null:`Invalid hsla value [${[C,k,F,V].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof V=="number"?[C,k,F,V]:[C,k,F]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof V=="number"?[C,k,F,V]:[C,k,F]).join(", ")}]: 'h' must be between 0 and 360.`})(e,i,s,p);if(_)throw new Js(_);const v=`hsla(${e}, ${i}%, ${s}%, ${p})`,E=Ta.parse(v);if(!E)throw new Js(`Failed to parse HSLA color: ${v}`);return E}function _t(r,e){return r in e}function Ht(r,e){const i=e[r];return i===void 0?null:i}function Qt(r){return{type:r}}function oi(r){if(r instanceof Vh)return new Set([r.key]);let e=new Set;return r.eachChild((i=>{e=new Set([...e,...oi(i)])})),e}function $i(r){if(r instanceof $o&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild((i=>{!e&&$i(i)&&(e=!0)})),e}function An(r){return{result:"success",value:r}}function Mn(r){return{result:"error",value:r}}function Zn(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Ln(r){return r["property-type"]==="data-driven"}function zn(r){return Zn(r.expression,"measure-light")}function ir(r){return Zn(r.expression,"zoom")}function $r(r){return!!r.expression&&r.expression.interpolated}function On(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function qn(r){return r}function Yr(r,e){const i=e.type==="color",s=r.stops&&typeof r.stops[0][0]=="object",u=s||!(s||r.property!==void 0),p=r.type||($r(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map((C=>[C[0],Ta.parse(C[1])]))),r.default=Ta.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!rf[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let _,v,E;if(p==="exponential")_=Ls;else if(p==="interval")_=Za;else if(p==="categorical"){_=Ma,v=Object.create(null);for(const C of r.stops)v[C[0]]=C[1];E=typeof r.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);_=ol}if(s){const C={},k=[];for(let j=0;j<r.stops.length;j++){const $=r.stops[j],ee=$[0].zoom;C[ee]===void 0&&(C[ee]={zoom:ee,type:r.type,property:r.property,default:r.default,stops:[]},k.push(ee)),C[ee].stops.push([$[0].value,$[1]])}const F=[];for(const j of k)F.push([C[j].zoom,Yr(C[j],e)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:ls.interpolationFactor.bind(void 0,V),zoomStops:F.map((j=>j[0])),evaluate:({zoom:j},$)=>Ls({stops:F,base:r.base},e,j).evaluate(j,$)}}if(u){const C=p==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:ls.interpolationFactor.bind(void 0,C),zoomStops:r.stops.map((k=>k[0])),evaluate:({zoom:k})=>_(r,e,k,v,E)}}return{kind:"source",evaluate(C,k){const F=k&&k.properties?k.properties[r.property]:void 0;return F===void 0?Qa(r.default,e.default):_(r,e,F,v,E)}}}function Qa(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function Ma(r,e,i,s,u){return Qa(typeof i===u?s[i]:void 0,r.default,e.default)}function Za(r,e,i){if(!ku(i))return Qa(r.default,e.default);const s=r.stops.length;if(s===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[s-1][0])return r.stops[s-1][1];const u=Ia(r.stops.map((p=>p[0])),i);return r.stops[u][1]}function Ls(r,e,i){const s=r.base!==void 0?r.base:1;if(!ku(i))return Qa(r.default,e.default);const u=r.stops.length;if(u===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[u-1][0])return r.stops[u-1][1];const p=Ia(r.stops.map((k=>k[0])),i),_=(function(k,F,V,j){const $=j-V,ee=k-V;return $===0?0:F===1?ee/$:(Math.pow(F,ee)-1)/(Math.pow(F,$)-1)})(i,s,r.stops[p][0],r.stops[p+1][0]),v=r.stops[p][1],E=r.stops[p+1][1];let C=Zd[e.type]||qn;if(r.colorSpace&&r.colorSpace!=="rgb"){const k=rf[r.colorSpace];C=(F,V)=>k.reverse(k.interpolate(k.forward(F),k.forward(V),_))}return typeof v.evaluate=="function"?{evaluate(...k){const F=v.evaluate.apply(void 0,k),V=E.evaluate.apply(void 0,k);if(F!==void 0&&V!==void 0)return C(F,V,_)}}:C(v,E,_)}function ol(r,e,i){return e.type==="color"?i=Ta.parse(i):e.type==="formatted"?i=Pl.fromString(i.toString()):e.type==="resolvedImage"?i=Io.build(i.toString()):xn(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Qa(i,r.default,e.default)}$o.register(Et,{error:[{kind:"error"},[ta],(r,[e])=>{throw new Js(e.evaluate(r))}],typeof:[ta,[va],(r,[e])=>io(no(e.evaluate(r)))],"to-rgba":[al(En,4),[Kl],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[al(En,4),[Kl],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Kl,[En,En,En],Ct],rgba:[Kl,[En,En,En,En],Ct],hsl:[Kl,[En,En,En],Lt],hsla:[Kl,[En,En,En,En],Lt],has:{type:Sa,overloads:[[[ta],(r,[e])=>_t(e.evaluate(r),r.properties())],[[ta,Pu],(r,[e,i])=>_t(e.evaluate(r),i.evaluate(r))]]},get:{type:va,overloads:[[[ta],(r,[e])=>Ht(e.evaluate(r),r.properties())],[[ta,Pu],(r,[e,i])=>Ht(e.evaluate(r),i.evaluate(r))]]},"feature-state":[va,[ta],(r,[e])=>Ht(e.evaluate(r),r.featureState||{})],properties:[Pu,[],r=>r.properties()],"geometry-type":[ta,[],r=>r.geometryType()],worldview:[ta,[],r=>r.globals.worldview||""],"is-active-floor":[Sa,Qt(ta),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const i=r.globals.activeFloors;return e.some((s=>{const u=s.evaluate(r);return i.has(u)}))}],id:[va,[],r=>r.id()],zoom:[En,[],r=>r.globals.zoom],pitch:[En,[],r=>r.globals.pitch||0],"distance-from-center":[En,[],r=>r.distanceFromCenter()],"measure-light":[En,[ta],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[En,[],r=>r.globals.heatmapDensity||0],"line-progress":[En,[],r=>r.globals.lineProgress||0],"raster-value":[En,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[En,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[En,[],r=>r.globals.skyRadialProgress||0],accumulated:[va,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[En,Qt(En),(r,e)=>{let i=0;for(const s of e)i+=s.evaluate(r);return i}],"*":[En,Qt(En),(r,e)=>{let i=1;for(const s of e)i*=s.evaluate(r);return i}],"-":{type:En,overloads:[[[En,En],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[En],(r,[e])=>-e.evaluate(r)]]},"/":[En,[En,En],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[En,[En,En],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[En,[],()=>Math.LN2],pi:[En,[],()=>Math.PI],e:[En,[],()=>Math.E],"^":[En,[En,En],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[En,[En],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[En,[En],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[En,[En],(r,[e])=>Math.log(e.evaluate(r))],log2:[En,[En],(r,[e])=>Math.log2(e.evaluate(r))],sin:[En,[En],(r,[e])=>Math.sin(e.evaluate(r))],cos:[En,[En],(r,[e])=>Math.cos(e.evaluate(r))],tan:[En,[En],(r,[e])=>Math.tan(e.evaluate(r))],asin:[En,[En],(r,[e])=>Math.asin(e.evaluate(r))],acos:[En,[En],(r,[e])=>Math.acos(e.evaluate(r))],atan:[En,[En],(r,[e])=>Math.atan(e.evaluate(r))],min:[En,Qt(En),(r,e)=>Math.min(...e.map((i=>i.evaluate(r))))],max:[En,Qt(En),(r,e)=>Math.max(...e.map((i=>i.evaluate(r))))],abs:[En,[En],(r,[e])=>Math.abs(e.evaluate(r))],round:[En,[En],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[En,[En],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[En,[En],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[Sa,[ta,va],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[Sa,[va],(r,[e])=>r.id()===e.value],"filter-type-==":[Sa,[ta],(r,[e])=>r.geometryType()===e.value],"filter-<":[Sa,[ta,va],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s<u}],"filter-id-<":[Sa,[va],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[Sa,[ta,va],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s>u}],"filter-id->":[Sa,[va],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[Sa,[ta,va],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[Sa,[va],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[Sa,[ta,va],(r,[e,i])=>{const s=r.properties()[e.value],u=i.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[Sa,[va],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[Sa,[va],(r,[e])=>e.value in r.properties()],"filter-has-id":[Sa,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[Sa,[al(ta)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[Sa,[al(va)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[Sa,[ta,al(va)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[Sa,[ta,al(va)],(r,[e,i])=>(function(s,u,p,_){for(;p<=_;){const v=p+_>>1;if(u[v]===s)return!0;u[v]>s?_=v-1:p=v+1}return!1})(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Sa,overloads:[[[Sa,Sa],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Qt(Sa),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:Sa,overloads:[[[Sa,Sa],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Qt(Sa),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[Sa,[Sa],(r,[e])=>!e.evaluate(r)],"is-supported-script":[Sa,[ta],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[ta,[ta],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[ta,[ta],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[ta,Qt(va),(r,e)=>e.map((i=>Ll(i.evaluate(r)))).join("")],"resolved-locale":[ta,[If],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[En,[En,En,va],(r,e)=>{const[i,s,u]=e.map((_=>_.evaluate(r)));if(i>s||i===s)return i;let p;if(typeof u=="string")p=(function(_){let v=0;if(_.length===0)return v;for(let E=0;E<_.length;E++)v=(v<<5)-v+_.charCodeAt(E),v|=0;return v})(u);else{if(typeof u!="number")throw new Js(`Invalid seed input: ${u}`);p=u}return i+vt(p)()*(s-i)}]});class mc{constructor(e,i,s,u,p){this.expression=e,this._warningHistory={},this._scope=s,this._options=u,this._iconImageUseTheme=p,this._evaluator=new Lh(s,u,p),this._defaultValue=i?(function(_){return _.type==="color"&&(On(_.default)||Array.isArray(_.default))?new Ta(0,0,0,0):_.type==="color"?Ta.parse(_.default)||null:_.default===void 0?null:_.default})(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=oi(e),this.isIndoorDependent=$i(e)}evaluateWithoutErrorHandling(e,i,s,u,p,_,v,E){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,u,p,_,v,E,C){this._evaluator||(this._evaluator=new Lh(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=v||null,this._evaluator.featureDistanceData=E||null,this._evaluator.iconImageUseTheme=C||null;try{const k=this.expression.evaluate(this._evaluator);if(k==null||typeof k=="number"&&k!=k)return this._defaultValue;if(this._enumValues&&!(k in this._enumValues))throw new Js(`Expected value to be one of ${Object.keys(this._enumValues).map((F=>JSON.stringify(F))).join(", ")}, but found ${JSON.stringify(k)} instead.`);return k}catch(k){const F=k;return this._warningHistory[F.message]||(this._warningHistory[F.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${F.message}`)),this._defaultValue}}}function ks(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Et}function Lo(r,e,i,s,u){const p=new ch(Et,[],e?(function(v){const E={color:Kl,string:ta,number:En,enum:ta,boolean:Sa,formatted:rd,resolvedImage:Hc};return v.type==="array"?al(E[v.value]||va,v.length):E[v.type]})(e):void 0,void 0,void 0,i,s,u),_=p.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return _?An(new mc(_,e,i,s,u)):Mn(p.errors)}class Os{constructor(e,i,s,u){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!mo(i.expression),this.configDependencies=oi(i.expression),this.isIndoorDependent=$i(i.expression)}evaluateWithoutErrorHandling(e,i,s,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,p,_)}evaluate(e,i,s,u,p,_,v){return this._styleExpression.evaluate(e,i,s,u,p,_,void 0,void 0,v)}}class Ms{constructor(e,i,s,u,p,_){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!mo(i.expression),this.isIndoorDependent=$i(i.expression),this.isLightConstant=p,this.isLineProgressConstant=_,this.configDependencies=oi(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,s,u,p,_){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,u,p,_)}evaluate(e,i,s,u,p,_){return this._styleExpression.evaluate(e,i,s,u,p,_)}interpolationFactor(e,i,s){return this.interpolationType?ls.interpolationFactor(this.interpolationType,e,i,s):0}}function Co(r,e,i,s,u){if((r=Lo(r,e,i,s,u)).result==="error")return r;const p=r.value.expression,_=Nh(p);if(!_&&!Ln(e))return Mn([new Yl("","data expressions not supported")]);const v=ja(p,["zoom","pitch","distance-from-center"]);if(!v&&!ir(e))return Mn([new Yl("","zoom expressions not supported")]);const E=ja(p,["measure-light"]);if(!E&&!zn(e))return Mn([new Yl("","measure-light expression not supported")]);const C=ja(p,["line-progress"]);if(!C&&!(function(V){return Zn(V.expression,"line-progress")})(e))return Mn([new Yl("","line-progress expression not supported")]);const k=e.expression&&e.expression.relaxZoomRestriction,F=Nl(p);return F||v||k?F instanceof Yl?Mn([F]):F instanceof ls&&!$r(e)?Mn([new Yl("",'"interpolate" expressions cannot be used with this property')]):An(F?new Ms(_&&C?"camera":"composite",r.value,F.labels,F instanceof ls?F.interpolation:void 0,E,C):new Os(_&&C?"constant":"source",r.value,E,C)):Mn([new Yl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class _c{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,Yr(this._parameters,this._specification))}static deserialize(e){return new _c(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Nl(r){let e=null;if(r instanceof Xn)e=Nl(r.result);else if(r instanceof Kc){for(const i of r.args)if(e=Nl(i),e)break}else(r instanceof Yc||r instanceof ls)&&r.input instanceof $o&&r.input.name==="zoom"&&(e=r);return e instanceof Yl||r.eachChild((i=>{const s=Nl(i);s instanceof Yl?e=s:e&&s&&e!==s&&(e=new Yl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}var Jc,hl,Cs=(function(){if(hl)return Jc;hl=1,Jc=e;var r=3;function e(i,s,u){var p=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var _=new Int32Array(this.arrayBuffer);i=_[0],this.d=(s=_[1])+2*(u=_[2]);for(var v=0;v<this.d*this.d;v++){var E=_[r+v],C=_[r+v+1];p.push(E===C?null:_.subarray(E,C))}var k=_[r+p.length+1];this.keys=_.subarray(_[r+p.length],k),this.bboxes=_.subarray(k),this.insert=this._insertReadonly}else{this.d=s+2*u;for(var F=0;F<this.d*this.d;F++)p.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=u,this.scale=s/i,this.uid=0;var V=u/s*i;this.min=-V,this.max=i+V}return e.prototype.insert=function(i,s,u,p,_){this._forEachCell(s,u,p,_,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(_)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,u,p,_,v){this.cells[_].push(v)},e.prototype.query=function(i,s,u,p,_){var v=this.min,E=this.max;if(i<=v&&s<=v&&E<=u&&E<=p&&!_)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(i,s,u,p,this._queryCell,C,{},_),C},e.prototype._queryCell=function(i,s,u,p,_,v,E,C){var k=this.cells[_];if(k!==null)for(var F=this.keys,V=this.bboxes,j=0;j<k.length;j++){var $=k[j];if(E[$]===void 0){var ee=4*$;(C?C(V[ee+0],V[ee+1],V[ee+2],V[ee+3]):i<=V[ee+2]&&s<=V[ee+3]&&u>=V[ee+0]&&p>=V[ee+1])?(E[$]=!0,v.push(F[$])):E[$]=!1}}},e.prototype._forEachCell=function(i,s,u,p,_,v,E,C){for(var k=this._convertToCellCoord(i),F=this._convertToCellCoord(s),V=this._convertToCellCoord(u),j=this._convertToCellCoord(p),$=k;$<=V;$++)for(var ee=F;ee<=j;ee++){var oe=this.d*ee+$;if((!C||C(this._convertFromCellCoord($),this._convertFromCellCoord(ee),this._convertFromCellCoord($+1),this._convertFromCellCoord(ee+1)))&&_.call(this,i,s,u,p,oe,v,E,C))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=r+this.cells.length+1+1,u=0,p=0;p<this.cells.length;p++)u+=this.cells[p].length;var _=new Int32Array(s+u+this.keys.length+this.bboxes.length);_[0]=this.extent,_[1]=this.n,_[2]=this.padding;for(var v=s,E=0;E<i.length;E++){var C=i[E];_[r+E]=v,_.set(C,v),v+=C.length}return _[r+i.length]=v,_.set(this.keys,v),_[r+i.length+1]=v+=this.keys.length,_.set(this.bboxes,v),v+=this.bboxes.length,_.buffer},Jc})(),bu=Qe(Cs);const Vl={};function di(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Vl[e]={klass:r,omit:i.omit||[]}}di(Object,"Object"),bu.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},bu.deserialize=function(r){return new bu(r.buffer)},Object.defineProperty(bu,"name",{value:"Grid"}),di(bu,"Grid"),delete je.prototype.constructor,di(Ta,"Color"),di(Error,"Error"),di(Pl,"Formatted"),di(po,"FormattedSection"),di(Go,"AJAXError"),di(Io,"ResolvedImage"),di(_c,"StylePropertyFunction"),di(mc,"StyleExpression",{omit:["_evaluator"]}),di(Rl,"ImageId"),di(ga,"ImageVariant"),di(Ms,"ZoomDependentExpression"),di(Os,"ZoomConstantExpression"),di($o,"CompoundExpression",{omit:["_evaluate"]});for(const r in Et)Vl[Et[r]._classRegistryKey]||di(Et[r],`Expression${r}`);function Oa(r){return r&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function fs(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(Oa(r)||r instanceof ImageBitmap)return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const s of r)i.push(fs(s,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[s,u]of r.entries())i.entries.push(fs(s),fs(u,e));return i}if(r instanceof Set){const i={$name:"Set"};let s=0;for(const u of r.values())i[++s]=fs(u);return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const u=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const p in r)r.hasOwnProperty(p)&&(Vl[s].omit.indexOf(p)>=0||(u[p]=fs(r[p],e)));r instanceof Error&&(u.message=r.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof r)}function Yo(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||Oa(r)||r instanceof ImageBitmap||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Yo);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const u=r.entries||[],p=new Map;for(let _=0;_<u.length;_+=2)p.set(Yo(u[_]),Yo(u[_+1]));return p}if(e==="Set"){const u=new Set;for(const p of Object.keys(r))p!=="$name"&&u.add(Yo(r[p]));return u}if(e==="BigInt")return BigInt(r.value);const{klass:i}=Vl[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const s=Object.create(i.prototype);for(const u of Object.keys(r))u!=="$name"&&(s[u]=Yo(r[u]));return s}throw new Error("can't deserialize object of type "+typeof r)}const mn={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function _o(r){for(const e of r)if(gc(e.charCodeAt(0)))return!0;return!1}function bl(r){for(const e of r)if(!Ba(e.charCodeAt(0)))return!1;return!0}function Ba(r){return!(mn.Arabic(r)||mn["Arabic Supplement"](r)||mn["Arabic Extended-A"](r)||mn["Arabic Presentation Forms-A"](r)||mn["Arabic Presentation Forms-B"](r))}function gc(r){return!(r!==746&&r!==747&&(r<4352||!(mn["Bopomofo Extended"](r)||mn.Bopomofo(r)||mn["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||mn["CJK Compatibility Ideographs"](r)||mn["CJK Compatibility"](r)||mn["CJK Radicals Supplement"](r)||mn["CJK Strokes"](r)||!(!mn["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||mn["CJK Unified Ideographs Extension A"](r)||mn["CJK Unified Ideographs"](r)||mn["Enclosed CJK Letters and Months"](r)||mn["Hangul Compatibility Jamo"](r)||mn["Hangul Jamo Extended-A"](r)||mn["Hangul Jamo Extended-B"](r)||mn["Hangul Jamo"](r)||mn["Hangul Syllables"](r)||mn.Hiragana(r)||mn["Ideographic Description Characters"](r)||mn.Kanbun(r)||mn["Kangxi Radicals"](r)||mn["Katakana Phonetic Extensions"](r)||mn.Katakana(r)&&r!==12540||!(!mn["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!mn["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||mn["Unified Canadian Aboriginal Syllabics"](r)||mn["Unified Canadian Aboriginal Syllabics Extended"](r)||mn["Vertical Forms"](r)||mn["Yijing Hexagram Symbols"](r)||mn["Yi Syllables"](r)||mn["Yi Radicals"](r))))}function jh(r){return!(gc(r)||(function(e){return!!(mn["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||mn["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||mn["Letterlike Symbols"](e)||mn["Number Forms"](e)||mn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||mn["Control Pictures"](e)&&e!==9251||mn["Optical Character Recognition"](e)||mn["Enclosed Alphanumerics"](e)||mn["Geometric Shapes"](e)||mn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||mn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||mn["CJK Symbols and Punctuation"](e)||mn.Katakana(e)||mn["Private Use Area"](e)||mn["CJK Compatibility Forms"](e)||mn["Small Form Variants"](e)||mn["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)})(r))}function $s(r){return mn.Arabic(r)||mn["Arabic Supplement"](r)||mn["Arabic Extended-A"](r)||mn["Arabic Presentation Forms-A"](r)||mn["Arabic Presentation Forms-B"](r)}function af(r){return r>=1424&&r<=2303||mn["Arabic Presentation Forms-A"](r)||mn["Arabic Presentation Forms-B"](r)}function Gu(r,e){return!(!e&&af(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||mn.Khmer(r))}function Dp(r){for(const e of r)if(af(e.charCodeAt(0)))return!0;return!1}const qo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let np=null,Ko=qo.unavailable,yc=null;const dh=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(Ko=qo.error),np&&np(r)};function Jo(){Qs.fire(new Dl("pluginStateChange",{pluginStatus:Ko,pluginURL:yc}))}const Qs=new id,wu=function(){return Ko},Dd=function(){if(Ko!==qo.deferred||!yc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ko=qo.loading,Jo(),yc&&Wl({url:yc},(r=>{r?dh(r):(Ko=qo.loaded,Jo())}))},qu={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ko===qo.loaded||qu.applyArabicShaping!=null,isLoading:()=>Ko===qo.loading,setState(r){Ko=r.pluginStatus,yc=r.pluginURL},isParsing:()=>Ko===qo.parsing,isParsed:()=>Ko===qo.parsed,getPluginURL:()=>yc};class Xa{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return(function(i,s){for(const u of i)if(!Gu(u.charCodeAt(0),s))return!1;return!0})(e,qu.isLoaded())}}class fh{constructor(e,i,s,u,p){this.property=e,this.value=i,this.expression=(function(_,v,E,C,k){if(On(_))return new _c(_,v);if(ks(_)||Array.isArray(_)&&_.length>0){const F=Co(_,v,E,C,k);if(F.result==="error")throw new Error(F.value.map((V=>`${V.key}: ${V.message}`)).join(", "));return F.value}{let F=_;return typeof _=="string"&&v.type==="color"&&(F=Ta.parse(_)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>F}}})(i===void 0?e.specification.default:i,e.specification,s,u,p)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s,u){return this.property.possiblyEvaluate(this,e,i,s,u)}}class sf{constructor(e,i,s,u){this.property=e,this.value=new fh(e,void 0,i,s,u)}transitioned(e,i){return new Rd(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Rd(this.property,this.value,null,{},0)}}class of{constructor(e,i,s,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return qt(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new sf(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new fh(this._values[e].property,i===null?void 0:qt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const u in e){const p=e[u];if(u.endsWith("-transition")){const _=u.slice(0,-11);s[_]&&this.setTransition(_,p)}else s.hasOwnProperty(u)&&this.setValue(u,p)}}getTransition(e){return qt(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new sf(this._values[e].property)),this._values[e].transition=qt(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const s=new Gh(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,i._values[u]);return s}untransitioned(){const e=new Gh(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Rd{constructor(e,i,s,u,p){const _=u.delay||0,v=u.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+_,this.end=this.begin+v,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const u=e.now||0,p=this.value.possiblyEvaluate(e,i,s),_=this.prior;if(_){if(u>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(u<this.begin)return _.possiblyEvaluate(e,i,s);{const v=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,i,s),p,hr(v))}}return p}}class Gh{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const u=new Pd(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].possiblyEvaluate(e,i,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Hu{constructor(e,i,s,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return qt(this._values[e].value)}setValue(e,i){this._values[e]=new fh(this._values[e].property,i===null?void 0:qt(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s,u){const p=new Pd(this._properties);for(const _ of Object.keys(this._values))p._values[_]=this._values[_].possiblyEvaluate(e,i,s,u);return p}isIndoorDependent(){return this._isIndoorDependent}}class Qc{constructor(e,i,s,u){this.property=e,this.value=i,this.parameters=s,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,u){return this.property.evaluate(this.value,this.parameters,e,i,s,u,this.iconImageUseTheme)}}class Pd{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class xi{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const u=Zd[this.specification.type];return u?u(e,i,s):e}}class Fi{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,u,p){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Qc(this,{kind:"constant",value:e.expression.evaluate(i,null,{},s,u,void 0,p)},i):new Qc(this,e.expression,i,p)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Qc(this,{kind:"constant",value:void 0},e.parameters);const u=Zd[this.specification.type];return u?new Qc(this,{kind:"constant",value:u(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,u,p,_,v){return e.kind==="constant"?e.value:e.evaluate(i,s,u,p,_,void 0,v)}}class gd{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,u){return!!e.expression.evaluate(i,null,{},s,u)}interpolate(){return!1}}class ca{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Xa(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new fh(u,void 0),_=this.defaultTransitionablePropertyValues[s]=new sf(u);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate(i)}}}di(Fi,"DataDrivenProperty"),di(xi,"DataConstantProperty"),di(gd,"ColorRampProperty");var xt=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function hm(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function qh(r){if(Array.isArray(r))return r.map(qh);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=qh(r[i]);return e}return hm(r)}function xc(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!xc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ld(r,e="",i=null,s="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};xc(r)||(r=Rp(r));const u=r;let p=!0;try{p=(function(k){if(!Pf(k))return k;let F=qh(k);return dm(F),F=yd(F),F})(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let _=null,v=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){v=xt[`filter_${s}`];const k=Lo(p,v,e,i);if(k.result==="error")throw new Error(k.value.map((F=>`${F.key}: ${F.message}`)).join(", "));_=(F,V,j)=>k.value.evaluate(F,V,{},j)}let E=null,C=null;if(p!==u){const k=Lo(u,v,e,i);if(k.result==="error")throw new Error(k.value.map((F=>`${F.key}: ${F.message}`)).join(", "));E=(F,V,j,$,ee)=>k.value.evaluate(F,V,{},j,void 0,void 0,$,ee),C=!Nh(k.value.expression)}return{filter:_,dynamicFilter:E||void 0,needGeometry:fm(p),needFeature:!!C}}function yd(r){if(!Array.isArray(r))return r;const e=(function(i){if(Om.has(i[0])){for(let s=1;s<i.length;s++)if(Pf(i[s]))return!0}return i})(r);return e===!0?e:e.map((i=>yd(i)))}function dm(r){let e=!1;const i=[];if(r[0]==="case"){for(let s=1;s<r.length-1;s+=2)e=e||Pf(r[s]),i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||Pf(r[1]);for(let s=2;s<r.length-1;s+=2)i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||Pf(r[1]);for(let s=1;s<r.length-1;s+=2)i.push(r[s+1])}e&&(r.length=0,r.push("any",...i));for(let s=1;s<r.length;s++)dm(r[s])}function Pf(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(Pf(r[i]))return!0;return!1}const Om=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function c_(r,e){return r<e?-1:r>e?1:0}function fm(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(fm(r[e]))return!0;return!1}function Rp(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Hh(r[1],r[2],"=="):e==="!="?$u(Hh(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Hh(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Rp))):e==="all"?["all"].concat(r.slice(1).map(Rp)):e==="none"?["all"].concat(r.slice(1).map(Rp).map($u)):e==="in"?rp(r[1],r.slice(2)):e==="!in"?$u(rp(r[1],r.slice(2))):e==="has"?lf(r[1]):e!=="!has"||$u(lf(r[1]));var i}function Hh(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function rp(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((i=>typeof i!=typeof e[0]))?["filter-in-large",r,["literal",e.sort(c_)]]:["filter-in-small",r,["literal",e]]}}function lf(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function $u(r){return["!",r]}const cf="";function vc(r,e){return e?`${r}${cf}${e}`:r}let Pp;const ap=()=>Pp||(Pp=new ca({"icon-size":new Fi(xt.layout_symbol["icon-size"]),"icon-image":new Fi(xt.layout_symbol["icon-image"]),"icon-rotate":new Fi(xt.layout_symbol["icon-rotate"]),"icon-offset":new Fi(xt.layout_symbol["icon-offset"]),"text-size":new Fi(xt.layout_symbol["text-size"]),"text-rotate":new Fi(xt.layout_symbol["text-rotate"]),"text-offset":new Fi(xt.layout_symbol["text-offset"])}));class pm{constructor(e,i,s,u,p,_){const v=Lo(e,xt.appearance.condition);if(v.result==="success"&&(this.condition=v.value),this.name=i,s){this.properties=new Pd(ap()),this.unevaluatedLayout=new Hu(ap(),u,p,_);for(const E in s)this.unevaluatedLayout.setValue(E,s[E])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,i,s){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,s))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),i=this.hasProperty("icon-size"),s=this.hasProperty("icon-offset"),u=this.hasProperty("icon-rotate");return e||i||s||u}hasTextProperties(){const e=this.hasProperty("text-size"),i=this.hasProperty("text-offset"),s=this.hasProperty("text-rotate");return e||i||s}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const mm="-transition",$h=new Set(["fill","line","background","hillshade","raster"]);class Zs extends id{constructor(e,i,s,u,p,_){if(super(),this.id=e.id,this.fqid=vc(this.id,s),this.type=e.type,this.scope=s,this.lut=u,this.options=p,this.iconImageUseTheme=_,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const v=Lo(this.filter,xt[`filter_${e.type}`]);v.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...v.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||v.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Hu(i.layout,this.scope,p,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new of(i.paint,this.scope,p);for(const v in e.paint)this.setPaintProperty(v,e.paint[v]);for(const v in e.layout)this.setLayoutProperty(v,e.layout[v]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pd(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&$h.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach((i=>{this.appearances.push(new pm(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))}))}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(mm)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const s=this._transitionablePaint,u=s._properties.properties;if(e.endsWith(mm)){const F=e.slice(0,-11);return u[F]&&s.setTransition(F,i||void 0),!1}if(!u[e])return!1;const p=s._values[e],_=p.value.isDataDriven(),v=p.value;s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const E=s._values[e].value,C=E.isDataDriven(),k=e.endsWith("pattern")||e==="line-dasharray";return C||_||k||this._handleOverridablePaintPropertyUpdate(e,v,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map((i=>i.serialize()))),ti(e,((i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length)))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Qc&&Ln(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!mo(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Ld(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,s){return{}}queryRadius(e){}queryIntersectsFeature(e,i,s,u,p,_,v,E,C){}}const kd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class uf{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Bm=new ArrayBuffer(0);class Wa{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,i){return e._trim(),i&&e.arrayBuffer&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,e.arrayBuffer?i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement:(i.capacity=0,i.arrayBuffer=Bm),i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Zr(r,e=1){let i=0,s=0;return{members:r.map((u=>{const p=kd[u.type].BYTES_PER_ELEMENT,_=i=sp(i,Math.max(e,p)),v=u.components||1;return s=Math.max(s,p),i+=p*v,{name:u.name,type:u.type,components:v,offset:_}})),size:sp(i,Math.max(s,e)),alignment:e}}function sp(r,e){return Math.ceil(r/e)*e}class hf extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,e}}hf.prototype.bytesPerElement=4,di(hf,"StructArrayLayout2i4");class Od extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=u,e}}Od.prototype.bytesPerElement=6,di(Od,"StructArrayLayout3i6");class df extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=4*e;return this.int16[_+0]=i,this.int16[_+1]=s,this.int16[_+2]=u,this.int16[_+3]=p,e}}df.prototype.bytesPerElement=8,di(df,"StructArrayLayout4i8");class Zh extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Zh.prototype.bytesPerElement=4,di(Zh,"StructArrayLayout1f4");class Lp extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=4*e,_=2*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.float32[_+1]=u,e}}Lp.prototype.bytesPerElement=8,di(Lp,"StructArrayLayout2i1f8");class op extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=u,e}}op.prototype.bytesPerElement=8,di(op,"StructArrayLayout3i8");class kp extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const v=5*e;return this.int16[v+0]=i,this.int16[v+1]=s,this.int16[v+2]=u,this.int16[v+3]=p,this.int16[v+4]=_,e}}kp.prototype.bytesPerElement=10,di(kp,"StructArrayLayout5i10");class lp extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,v)}emplace(e,i,s,u,p,_,v,E){const C=6*e,k=12*e,F=3*e;return this.int16[C+0]=i,this.int16[C+1]=s,this.uint8[k+4]=u,this.uint8[k+5]=p,this.uint8[k+6]=_,this.uint8[k+7]=v,this.float32[F+2]=E,e}}lp.prototype.bytesPerElement=12,di(lp,"StructArrayLayout2i4ub1f12");class bc extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=u,e}}bc.prototype.bytesPerElement=12,di(bc,"StructArrayLayout3f12");class go extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const v=6*e,E=3*e;return this.uint16[v+0]=i,this.uint16[v+1]=s,this.uint16[v+2]=u,this.uint16[v+3]=p,this.float32[E+2]=_,e}}go.prototype.bytesPerElement=12,di(go,"StructArrayLayout4ui1f12");class ph extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=4*e;return this.uint16[_+0]=i,this.uint16[_+1]=s,this.uint16[_+2]=u,this.uint16[_+3]=p,e}}ph.prototype.bytesPerElement=8,di(ph,"StructArrayLayout4ui8");class ff extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,u,p,_)}emplace(e,i,s,u,p,_,v){const E=6*e;return this.int16[E+0]=i,this.int16[E+1]=s,this.int16[E+2]=u,this.int16[E+3]=p,this.int16[E+4]=_,this.int16[E+5]=v,e}}ff.prototype.bytesPerElement=12,di(ff,"StructArrayLayout6i12");class cp extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v,E,C,k,F,V){const j=this.length;return this.resize(j+1),this.emplace(j,e,i,s,u,p,_,v,E,C,k,F,V)}emplace(e,i,s,u,p,_,v,E,C,k,F,V,j){const $=12*e;return this.int16[$+0]=i,this.int16[$+1]=s,this.int16[$+2]=u,this.int16[$+3]=p,this.uint16[$+4]=_,this.uint16[$+5]=v,this.uint16[$+6]=E,this.uint16[$+7]=C,this.int16[$+8]=k,this.int16[$+9]=F,this.int16[$+10]=V,this.int16[$+11]=j,e}}cp.prototype.bytesPerElement=24,di(cp,"StructArrayLayout4i4ui4i24");class Op extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,u,p,_)}emplace(e,i,s,u,p,_,v){const E=10*e,C=5*e;return this.int16[E+0]=i,this.int16[E+1]=s,this.int16[E+2]=u,this.float32[C+2]=p,this.float32[C+3]=_,this.float32[C+4]=v,e}}Op.prototype.bytesPerElement=20,di(Op,"StructArrayLayout3i3f20");class Bd extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=4*e;return this.float32[_+0]=i,this.float32[_+1]=s,this.float32[_+2]=u,this.float32[_+3]=p,e}}Bd.prototype.bytesPerElement=16,di(Bd,"StructArrayLayout4f16");class pf extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}pf.prototype.bytesPerElement=4,di(pf,"StructArrayLayout1ul4");class Tu extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,e}}Tu.prototype.bytesPerElement=4,di(Tu,"StructArrayLayout2ui4");class up extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v,E,C,k,F,V,j){const $=this.length;return this.resize($+1),this.emplace($,e,i,s,u,p,_,v,E,C,k,F,V,j)}emplace(e,i,s,u,p,_,v,E,C,k,F,V,j,$){const ee=20*e,oe=10*e;return this.int16[ee+0]=i,this.int16[ee+1]=s,this.int16[ee+2]=u,this.int16[ee+3]=p,this.int16[ee+4]=_,this.float32[oe+3]=v,this.float32[oe+4]=E,this.float32[oe+5]=C,this.float32[oe+6]=k,this.int16[ee+14]=F,this.uint32[oe+8]=V,this.uint16[ee+18]=j,this.uint16[ee+19]=$,e}}up.prototype.bytesPerElement=40,di(up,"StructArrayLayout5i4f1i1ul2ui40");class hp extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,v)}emplace(e,i,s,u,p,_,v,E){const C=8*e;return this.int16[C+0]=i,this.int16[C+1]=s,this.int16[C+2]=u,this.int16[C+4]=p,this.int16[C+5]=_,this.int16[C+6]=v,this.int16[C+7]=E,e}}hp.prototype.bytesPerElement=16,di(hp,"StructArrayLayout3i2i2i16");class Lf extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const v=4*e,E=8*e;return this.float32[v+0]=i,this.float32[v+1]=s,this.float32[v+2]=u,this.int16[E+6]=p,this.int16[E+7]=_,e}}Lf.prototype.bytesPerElement=16,di(Lf,"StructArrayLayout2f1f2i16");class Xh extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,u,p,_)}emplace(e,i,s,u,p,_,v){const E=20*e,C=5*e;return this.uint8[E+0]=i,this.uint8[E+1]=s,this.float32[C+1]=u,this.float32[C+2]=p,this.float32[C+3]=_,this.float32[C+4]=v,e}}Xh.prototype.bytesPerElement=20,di(Xh,"StructArrayLayout2ub4f20");class ao extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s)}emplace(e,i,s,u){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=u,e}}ao.prototype.bytesPerElement=6,di(ao,"StructArrayLayout3ui6");class kf extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge,xe,Ie,He){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge,xe,Ie,He)}emplace(e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge,xe,Ie,He,Ne){const We=30*e,at=15*e,ct=60*e;return this.int16[We+0]=i,this.int16[We+1]=s,this.int16[We+2]=u,this.float32[at+2]=p,this.float32[at+3]=_,this.uint16[We+8]=v,this.uint16[We+9]=E,this.uint32[at+5]=C,this.uint32[at+6]=k,this.uint32[at+7]=F,this.uint16[We+16]=V,this.uint16[We+17]=j,this.uint16[We+18]=$,this.float32[at+10]=ee,this.float32[at+11]=oe,this.uint8[ct+48]=se,this.uint8[ct+49]=ge,this.uint8[ct+50]=xe,this.uint32[at+13]=Ie,this.int16[We+28]=He,this.uint8[ct+58]=Ne,e}}kf.prototype.bytesPerElement=60,di(kf,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Fd extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge,xe,Ie,He,Ne,We,at,ct,Gt,pt,Xt,ni,ri,vi,wi,_i){const gi=this.length;return this.resize(gi+1),this.emplace(gi,e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge,xe,Ie,He,Ne,We,at,ct,Gt,pt,Xt,ni,ri,vi,wi,_i)}emplace(e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge,xe,Ie,He,Ne,We,at,ct,Gt,pt,Xt,ni,ri,vi,wi,_i,gi){const Zt=20*e,$t=40*e,yi=80*e;return this.float32[Zt+0]=i,this.float32[Zt+1]=s,this.int16[$t+4]=u,this.int16[$t+5]=p,this.int16[$t+6]=_,this.int16[$t+7]=v,this.int16[$t+8]=E,this.int16[$t+9]=C,this.int16[$t+10]=k,this.int16[$t+11]=F,this.int16[$t+12]=V,this.uint16[$t+13]=j,this.uint16[$t+14]=$,this.uint16[$t+15]=ee,this.uint16[$t+16]=oe,this.uint16[$t+17]=se,this.uint16[$t+18]=ge,this.uint16[$t+19]=xe,this.uint16[$t+20]=Ie,this.uint16[$t+21]=He,this.uint16[$t+22]=Ne,this.uint16[$t+23]=We,this.uint16[$t+24]=at,this.uint16[$t+25]=ct,this.uint16[$t+26]=Gt,this.uint16[$t+27]=pt,this.uint32[Zt+14]=Xt,this.float32[Zt+15]=ni,this.float32[Zt+16]=ri,this.float32[Zt+17]=vi,this.float32[Zt+18]=wi,this.uint8[yi+76]=_i,this.uint16[$t+39]=gi,e}}Fd.prototype.bytesPerElement=80,di(Fd,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class _m extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_){const v=this.length;return this.resize(v+1),this.emplace(v,e,i,s,u,p,_)}emplace(e,i,s,u,p,_,v){const E=6*e;return this.float32[E+0]=i,this.float32[E+1]=s,this.float32[E+2]=u,this.float32[E+3]=p,this.float32[E+4]=_,this.float32[E+5]=v,e}}_m.prototype.bytesPerElement=24,di(_m,"StructArrayLayout6f24");class mf extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,s,u,p)}emplace(e,i,s,u,p,_){const v=5*e;return this.float32[v+0]=i,this.float32[v+1]=s,this.float32[v+2]=u,this.float32[v+3]=p,this.float32[v+4]=_,e}}mf.prototype.bytesPerElement=20,di(mf,"StructArrayLayout5f20");class gm extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,v)}emplace(e,i,s,u,p,_,v,E){const C=7*e;return this.float32[C+0]=i,this.float32[C+1]=s,this.float32[C+2]=u,this.float32[C+3]=p,this.float32[C+4]=_,this.float32[C+5]=v,this.float32[C+6]=E,e}}gm.prototype.bytesPerElement=28,di(gm,"StructArrayLayout7f28");class dp extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v,E,C,k,F){const V=this.length;return this.resize(V+1),this.emplace(V,e,i,s,u,p,_,v,E,C,k,F)}emplace(e,i,s,u,p,_,v,E,C,k,F,V){const j=11*e;return this.float32[j+0]=i,this.float32[j+1]=s,this.float32[j+2]=u,this.float32[j+3]=p,this.float32[j+4]=_,this.float32[j+5]=v,this.float32[j+6]=E,this.float32[j+7]=C,this.float32[j+8]=k,this.float32[j+9]=F,this.float32[j+10]=V,e}}dp.prototype.bytesPerElement=44,di(dp,"StructArrayLayout11f44");class Of extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v,E,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,s,u,p,_,v,E,C)}emplace(e,i,s,u,p,_,v,E,C,k){const F=9*e;return this.float32[F+0]=i,this.float32[F+1]=s,this.float32[F+2]=u,this.float32[F+3]=p,this.float32[F+4]=_,this.float32[F+5]=v,this.float32[F+6]=E,this.float32[F+7]=C,this.float32[F+8]=k,e}}Of.prototype.bytesPerElement=36,di(Of,"StructArrayLayout9f36");class Su extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=s,e}}Su.prototype.bytesPerElement=8,di(Su,"StructArrayLayout2f8");class Bc extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,u)}emplace(e,i,s,u,p){const _=6*e;return this.uint32[3*e+0]=i,this.uint16[_+2]=s,this.uint16[_+3]=u,this.uint16[_+4]=p,e}}Bc.prototype.bytesPerElement=12,di(Bc,"StructArrayLayout1ul3ui12");class Eu extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Eu.prototype.bytesPerElement=2,di(Eu,"StructArrayLayout1ui2");class Fm extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe){const se=this.length;return this.resize(se+1),this.emplace(se,e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe)}emplace(e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se){const ge=16*e;return this.float32[ge+0]=i,this.float32[ge+1]=s,this.float32[ge+2]=u,this.float32[ge+3]=p,this.float32[ge+4]=_,this.float32[ge+5]=v,this.float32[ge+6]=E,this.float32[ge+7]=C,this.float32[ge+8]=k,this.float32[ge+9]=F,this.float32[ge+10]=V,this.float32[ge+11]=j,this.float32[ge+12]=$,this.float32[ge+13]=ee,this.float32[ge+14]=oe,this.float32[ge+15]=se,e}}Fm.prototype.bytesPerElement=64,di(Fm,"StructArrayLayout16f64");class yo extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,u,p,_,v){const E=this.length;return this.resize(E+1),this.emplace(E,e,i,s,u,p,_,v)}emplace(e,i,s,u,p,_,v,E){const C=10*e,k=5*e;return this.uint16[C+0]=i,this.uint16[C+1]=s,this.uint16[C+2]=u,this.uint16[C+3]=p,this.float32[k+2]=_,this.float32[k+3]=v,this.float32[k+4]=E,e}}yo.prototype.bytesPerElement=20,di(yo,"StructArrayLayout4ui3f20");class ko extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}ko.prototype.bytesPerElement=2,di(ko,"StructArrayLayout1i2");class dl extends Wa{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}dl.prototype.bytesPerElement=1,di(dl,"StructArrayLayout1ub1");class _f extends uf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_f.prototype.size=40;class fp extends up{get(e){return new _f(this,e)}}di(fp,"CollisionBoxArray");class Nd extends uf{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Nd.prototype.size=60;class ym extends kf{get(e){return new Nd(this,e)}}di(ym,"PlacedSymbolArray");class Bf extends uf{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Bf.prototype.size=80;class gf extends Fd{get(e){return new Bf(this,e)}}di(gf,"SymbolInstanceArray");class Vd extends Zh{getoffsetX(e){return this.float32[1*e+0]}}di(Vd,"GlyphOffsetArray");class Bp extends hf{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}di(Bp,"SymbolLineVertexArray");class Fp extends uf{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Fp.prototype.size=12;class yf extends Bc{get(e){return new Fp(this,e)}}di(yf,"FeatureIndexArray");class Np extends Tu{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}di(Np,"FillExtrusionCentroidArray");class pp extends uf{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}pp.prototype.size=6;class mp extends Od{get(e){return new pp(this,e)}}di(mp,"FillExtrusionWallArray");const Nm=Zr([{name:"a_pos",components:2,type:"Int16"}],4),Vm=Zr([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),xm=Zr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xs{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,u){let p=this.segments[this.segments.length-1];return e>xs.MAX_VERTEX_ARRAY_LENGTH&&Bi(`Max vertices per segment is ${xs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>xs.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==u)&&(p={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},u!==void 0&&(p.sortKey=u),this.segments.push(p)),p}prepareSegment(e,i,s,u){return this._prepareSegment(e,i.length,s.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,u){return new xs([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}function mh(r,e){return 256*(r=te(Math.floor(r),0,255))+te(Math.floor(e),0,255)}xs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,di(xs,"SegmentVector");const Um=Zr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vp=Zr([{name:"a_pattern_b",components:4,type:"Uint16"}]),xf=Zr([{name:"a_dash",components:4,type:"Uint16"}]);class _p{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,u){this.ids.push(Up(e)),this.positions.push(i,s,u)}eachPosition(e,i){const s=Up(e);let u=0,p=this.ids.length-1;for(;u<p;){const _=u+p>>1;this.ids[_]>=s?p=_:u=_+1}for(;this.ids[u]===s;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return vm(s,u,0,s.length-1),i&&(i.add(s.buffer),i.add(u.buffer)),{ids:s,positions:u}}static deserialize(e){const i=new _p;let s;i.ids=e.ids,i.positions=e.positions;for(const u of i.ids)u!==s&&i.uniqueIds.push(u),s=u;return i.indexed=!0,i}}function Up(r){const e=+r;return Number.isSafeInteger(e)?e:ns(String(r))}function vm(r,e,i,s){for(;i<s;){const u=r[i+s>>1];let p=i-1,_=s+1;for(;;){do p++;while(r[p]<u);do _--;while(r[_]>u);if(p>=_)break;Zu(r,p,_),Zu(e,3*p,3*_),Zu(e,3*p+1,3*_+1),Zu(e,3*p+2,3*_+2)}_-i<s-_?(vm(r,e,i,_),i=_+1):(vm(r,e,_+1,s),s=_)}}function Zu(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}di(_p,"FeaturePositionMap");class _h{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class bm extends _h{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Oo extends _h{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class ec extends _h{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class Ff extends _h{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Nf extends _h{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class gh extends _h{constructor(e){super(e),this.current=Ta.transparent.toPremultipliedRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Vf=new Float32Array(16);class so extends _h{constructor(e){super(e),this.current=Vf}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let u=1;u<16;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const wm=new Float32Array(9),u_=new Float32Array(4);class jp extends _h{constructor(e){super(e),this.current=u_}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(s[u]!==this.current[u]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function Uf(r){return[mh(255*r.r,255*r.g),mh(255*r.b,255*r.a)]}function Fc(r,e,i,s,u,p,_,v){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Xa(0,{brightness:p,worldview:v}),e,i,u,s,_)==="none":r.value==="none")}class jf{constructor(e,i,s,u){this.value=e,this.uniformNames=i.map((p=>`u_${p}`)),this.type=s,this.context=u}setUniform(e,i,s,u,p){const _=u.constantOr(this.value);i.set(e,p,_ instanceof Ta?_.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):_)}getBinding(e,i){return this.type==="color"?new gh(e):new Oo(e)}}class Gf{constructor(e,i){this.uniformNames=i.map((s=>`u_${s}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,s,u,p){let _=null;p!=="u_pattern"&&p!=="u_dash"||(_=this.pattern),p==="u_pattern_b"&&(_=this.patternTransition),p==="u_pixel_ratio"&&(_=this.pixelRatio),_&&i.set(e,p,_)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Nf(e):new Oo(e)}}class Xu{constructor(e,i,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map((p=>({name:`a_${p}`,type:"Float32",components:s==="color"?2:1,offset:0}))),this.paintVertexArray=new u}populatePaintArray(e,i,s,u,p,_,v,E){const C=this.paintVertexArray.length,k=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Xa(0,{brightness:_,worldview:E}),i,{},p,u,v):this.expression.kind==="constant"&&this.expression.value,F=Fc(this.lutExpression,i,{},u,p,_,v,E);this.paintVertexArray.resize(e),this._setPaintValue(C,e,k,F?null:this.context.lut)}updatePaintArray(e,i,s,u,p,_,v,E){const C=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:v,worldview:E},s,u,void 0,p):this.expression.kind==="constant"&&this.expression.value,k=Fc(this.lutExpression,s,u,p,void 0,v,void 0,E);this._setPaintValue(e,i,C,k?null:this.context.lut)}_setPaintValue(e,i,s,u){if(this.type==="color"){const p=Uf(s.toPremultipliedRenderColor(u));for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,p[0],p[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class tc{constructor(e,i,s,u,p,_){this.expression=e,this.uniformNames=i.map((v=>`u_${v}_t`)),this.type=s,this.useIntegerZoom=u,this.context=p,this.maxValue=0,this.paintVertexAttributes=i.map((v=>({name:`a_${v}`,type:"Float32",components:s==="color"?4:2,offset:0}))),this.paintVertexArray=new _}populatePaintArray(e,i,s,u,p,_,v,E){const C=this.expression.evaluate(new Xa(this.context.zoom,{brightness:_,worldview:E}),i,{},p,u,v),k=this.expression.evaluate(new Xa(this.context.zoom+1,{brightness:_,worldview:E}),i,{},p,u,v),F=Fc(this.lutExpression,i,{},u,p,_,v,E),V=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(V,e,C,k,F?null:this.context.lut)}updatePaintArray(e,i,s,u,p,_,v,E){const C=this.expression.evaluate({zoom:this.context.zoom,brightness:v,worldview:E},s,u,void 0,p),k=this.expression.evaluate({zoom:this.context.zoom+1,brightness:v,worldview:E},s,u,void 0,p),F=Fc(this.lutExpression,s,u,p,void 0,v,void 0,E);this._setPaintValue(e,i,C,k,F?null:this.context.lut)}_setPaintValue(e,i,s,u,p){if(this.type==="color"){const _=Uf(s.toPremultipliedRenderColor(p)),v=Uf(s.toPremultipliedRenderColor(p));for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,_[0],_[1],v[0],v[1])}else{for(let _=e;_<i;_++)this.paintVertexArray.emplace(_,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,u,p){const _=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,v=te(this.expression.interpolationFactor(_,this.context.zoom,this.context.zoom+1),0,1);i.set(e,p,v)}getBinding(e,i){return new Oo(e)}}class xd{constructor(e,i,s,u,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(s==="array"?xf:Um).members;for(let _=0;_<i.length;++_);this.paintVertexArray=new u,this.paintTransitionVertexArray=new ph}populatePaintArray(e,i,s,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,u,p,_,v){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],_)}_setPaintValues(e,i,s,u){if(!u||!s)return;const p=u[s[0]],_=u[s[1]];if(p){if(p){const{tl:v,br:E,pixelRatio:C}=p;for(let k=e;k<i;k++)this.paintVertexArray.emplace(k,v[0],v[1],E[0],E[1],C)}if(_){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:v,br:E}=_;for(let C=e;C<i;C++)this.paintTransitionVertexArray.emplace(C,v[0],v[1],E[0],E[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Vp.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class vd{constructor(e,i,s=(()=>!0)){this.binders={},this._buffers=[],this.context=i;const u=[];for(const p in e.paint._values){const _=e.paint.get(p);if(p.endsWith("-use-theme")||!s(p)||!(_ instanceof Qc&&Ln(_.property.specification)))continue;const v=Gp(p,e.type),E=_.value,C=_.property.specification.type,k=!!_.property.useIntegerZoom,F=p==="line-dasharray"||p.endsWith("pattern"),V=e.paint.get(`${p}-use-theme`),j=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||V&&V.value.kind!=="constant";if(E.kind!=="constant"||j)if(E.kind==="source"||j||F){const $=xh(p,C,"source");this.binders[p]=F?new xd(E,v,C,$,e.id):new Xu(E,v,C,$),u.push(`/a_${p}`)}else{const $=xh(p,C,"composite");this.binders[p]=new tc(E,v,C,k,i,$),u.push(`/z_${p}`)}else this.binders[p]=F?new Gf(E.value,v):new jf(E.value,v,C,i),u.push(`/u_${p}`);V&&(this.binders[p].lutExpression=V.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Xu||i instanceof tc?i.maxValue:0}populatePaintArrays(e,i,s,u,p,_,v,E){for(const C in this.binders){const k=this.binders[C];k.context=this.context,(k instanceof Xu||k instanceof tc||k instanceof xd)&&k.populatePaintArray(e,i,s,u,p,_,v,E)}}setConstantPatternPositions(e,i){for(const s in this.binders){const u=this.binders[s];u instanceof Gf&&u.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof xd?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,s,u,p,_,v,E,C,k){let F=!1;const V=Object.keys(e),j=V.length!==0&&!E,$=j?V:i.uniqueIds;this.context.lut=p.lut;for(const ee in this.binders){const oe=this.binders[ee];if(oe.context=this.context,(oe instanceof Xu||oe instanceof tc||oe instanceof xd)&&oe.expression&&oe.expression.kind&&oe.expression.kind!=="constant"&&(oe.expression.isStateDependent===!0||oe.expression.isLightConstant===!1)){const se=p.paint.get(ee);oe.expression=se.value;for(const ge of $){const xe=e[ge.toString()];i.eachPosition(ge,((Ie,He,Ne)=>{const We=u.feature(Ie);oe.updatePaintArray(He,Ne,We,xe,_,v,C,k)}))}if(!j)for(const ge of s.uniqueIds){const xe=e[ge.toString()];s.eachPosition(ge,((Ie,He,Ne)=>{const We=u.feature(Ie);oe.updatePaintArray(He,Ne,We,xe,_,v,C,k)}))}F=!0}}return F}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof jf||s instanceof Gf)&&e.push(...s.uniformNames.map((u=>`#define HAS_UNIFORM_${u}`)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof jf||u instanceof Gf||u instanceof tc)for(const p of u.uniformNames)i.push({name:p,property:s,binding:u.getBinding(e,p)})}return i}setUniforms(e,i,s,u,p){for(const{name:_,property:v,binding:E}of s)this.binders[v].setUniform(e,E,p,u.get(v),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Xu||i instanceof tc||i instanceof xd)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof xd&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof Xu||s instanceof tc||s instanceof xd)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Xu||i instanceof tc||i instanceof xd)&&i.destroy()}}}class yh{constructor(e,i,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new vd(u,i,s);this.needsUpload=!1,this._featureMap=new _p,this._featureMapWithoutIds=new _p,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,u,p,_,v,E,C){for(const k in this.programConfigurations)this.programConfigurations[k].populatePaintArrays(e,i,u,p,_,v,E,C);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,u,p,_,v,E){for(const C of s)this.needsUpload=this.programConfigurations[C.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,C,u,p,_,v||0,E)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Tm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Gp(r,e){return Tm[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const qp={"line-pattern":{source:go,composite:go},"fill-pattern":{source:go,composite:go},"fill-extrusion-pattern":{source:go,composite:go},"line-dasharray":{source:ph,composite:ph}},jm={color:{source:Su,composite:Bd},number:{source:Zh,composite:Su}};function xh(r,e,i){const s=qp[r];return s&&s[i]||jm[e][i]}di(jf,"ConstantBinder"),di(Gf,"PatternConstantBinder"),di(Xu,"SourceExpressionBinder"),di(xd,"PatternCompositeBinder"),di(tc,"CompositeExpressionBinder"),di(vd,"ProgramConfiguration",{omit:["_buffers"]}),di(yh,"ProgramConfigurationSet");const ps=pi/Math.PI/2,wc=5,Hp=6,Ul=16383,gp=64,Sm=[gp,32,16],Wu=-ps,vs=ps;function wl(r,e,i,s=ps){return i=fi(i),[r*Math.sin(i)*s,-e*s,r*Math.cos(i)*s]}function Au(r,e,i){return wl(Math.cos(fi(r)),Math.sin(fi(r)),e,i)}const h=63710088e-1,t=2*Math.PI*h;class a{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new a(ze(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,u=e.lat*i,p=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return h*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new d({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return Au(this.lat,this.lng,ps+e*ps/h)}static convert(e){if(e instanceof a)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new a(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new a(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class d{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof a?new a(e.lng,e.lat):a.convert(e),this}setSouthWest(e){return this._sw=e instanceof a?new a(e.lng,e.lat):a.convert(e),this}extend(e){const i=this._sw,s=this._ne;let u,p;if(e instanceof a)u=e,p=e;else{if(!(e instanceof d))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(d.convert(e)):this.extend(a.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(a.convert(e)):this;if(u=e._sw,p=e._ne,!u||!p)return this}return i||s?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),s.lng=Math.max(p.lng,s.lng),s.lat=Math.max(p.lat,s.lat)):(this._sw=new a(u.lng,u.lat),this._ne=new a(p.lng,p.lat)),this}getCenter(){return new a((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new a(this.getWest(),this.getNorth())}getSouthEast(){return new a(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=a.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){if(e)return e instanceof d?e:new d(e)}}const y=0,b=25.5;function S(r){return t*Math.cos(r*Math.PI/180)}function M(r){return(180+r)/360}function R(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function N(r,e){return r/S(e)}function U(r){return 360*r-180}function Y(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function X(r,e){return r*S(Y(e))}const Q=85.051129;function ae(r){return Math.cos(fi(te(r,-Q,Q)))}function ie(r,e){const i=te(e,y,b),s=Math.pow(2,i);return ae(r)*t/(512*s)}function _e(r){return 1/Math.cos(r*Math.PI/180)}function fe(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/pi)/(1<<r.z)*2));return 80150034*i/(i*i+1)/pi/(1<<r.z)}class Te{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=a.convert(e);return new Te(M(s.lng),R(s.lat),N(i,s.lat))}toLngLat(){return new a(U(this.x),Y(this.y))}toAltitude(){return X(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/t*_e(Y(this.y))}}function De(r,e,i,s,u,p,_,v,E){const C=(e+s)/2,k=(i+u)/2,F=new je(C,k);v(F),(function(V,j,$,ee,oe,se){const ge=$-oe,xe=ee-se;return Math.abs((ee-j)*ge-($-V)*xe)/Math.hypot(ge,xe)})(F.x,F.y,p.x,p.y,_.x,_.y)>=E?(De(r,e,i,C,k,p,F,v,E),De(r,C,k,s,u,F,_,v,E)):r.push(_)}function Se(r,e,i){let s=r[0],u=s.x,p=s.y;e(s);const _=[s];for(let v=1;v<r.length;v++){const E=r[v],{x:C,y:k}=E;e(E),De(_,u,p,C,k,s,E,e,i),u=C,p=k,s=E}return _}function Ze(r,e,i,s){if(s(e,i)){const u=e.add(i)._mult(.5);Ze(r,e,u,s),Ze(r,u,i,s)}else r.push(i)}function Ve(r,e){let i=r[0];const s=[i];for(let u=1;u<r.length;u++){const p=r[u];Ze(s,i,p,e),i=p}return s}const Ge=Math.pow(2,14)-1,Fe=-Ge-1;function Oe(r,e){const i=Math.round(r.x*e),s=Math.round(r.y*e);return r.x=te(i,Fe,Ge),r.y=te(s,Fe,Ge),(i<r.x||i>r.x+1||s<r.y||s>r.y+1)&&Bi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function it(r,e,i){const s=r.loadGeometry(),u=r.extent,p=pi/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:v,x:E,y:C,projection:k}=i,F=V=>{const j=U((e.x+V.x/u)/_),$=Y((e.y+V.y/u)/_),ee=k.project(j,$);V.x=(ee.x*v-E)*u,V.y=(ee.y*v-C)*u};for(let V=0;V<s.length;V++)if(r.type!==1)s[V]=Se(s[V],F,1);else{const j=[];for(const $ of s[V])$.x<0||$.x>=u||$.y<0||$.y>=u||(F($),j.push($));s[V]=j}}for(const _ of s)for(const v of _)Oe(v,p);return s}function ft(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?it(r):[]}}class ht{constructor(e,i,s,u,p){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=p,e.readFields(St,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,s=[];let u,p=1,_=0,v=0,E=0;for(;e.pos<i;){if(_<=0){const C=e.readVarint();p=7&C,_=C>>3}if(_--,p===1||p===2)v+=e.readSVarint(),E+=e.readSVarint(),p===1&&(u&&s.push(u),u=[]),u&&u.push(new je(v,E));else{if(p!==7)throw new Error(`unknown command ${p}`);u&&u.push(u[0].clone())}}return u&&s.push(u),s}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let s=1,u=0,p=0,_=0,v=1/0,E=-1/0,C=1/0,k=-1/0;for(;e.pos<i;){if(u<=0){const F=e.readVarint();s=7&F,u=F>>3}if(u--,s===1||s===2)p+=e.readSVarint(),_+=e.readSVarint(),p<v&&(v=p),p>E&&(E=p),_<C&&(C=_),_>k&&(k=_);else if(s!==7)throw new Error(`unknown command ${s}`)}return[v,C,E,k]}toGeoJSON(e,i,s){const u=this.extent*Math.pow(2,s),p=this.extent*e,_=this.extent*i,v=this.loadGeometry();function E(V){return[360*(V.x+p)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(V.y+_)/u)*Math.PI))-90]}function C(V){return V.map(E)}let k;if(this.type===1){const V=[];for(const $ of v)V.push($[0]);const j=C(V);k=V.length===1?{type:"Point",coordinates:j[0]}:{type:"MultiPoint",coordinates:j}}else if(this.type===2){const V=v.map(C);k=V.length===1?{type:"LineString",coordinates:V[0]}:{type:"MultiLineString",coordinates:V}}else{if(this.type!==3)throw new Error("unknown feature type");{const V=(function($){const ee=$.length;if(ee<=1)return[$];const oe=[];let se,ge;for(let xe=0;xe<ee;xe++){const Ie=It($[xe]);Ie!==0&&(ge===void 0&&(ge=Ie<0),ge===Ie<0?(se&&oe.push(se),se=[$[xe]]):se&&se.push($[xe]))}return se&&oe.push(se),oe})(v),j=[];for(const $ of V)j.push($.map(C));k=j.length===1?{type:"Polygon",coordinates:j[0]}:{type:"MultiPolygon",coordinates:j}}}const F={type:"Feature",geometry:k,properties:this.properties};return this.id!=null&&(F.id=this.id),F}}function St(r,e,i){r===1?e.id=i.readVarint():r===2?(function(s,u){const p=s.readVarint()+s.pos;for(;s.pos<p;){const _=u._keys[s.readVarint()],v=u._values[s.readVarint()];u.properties[_]=v}})(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function It(r){let e=0;for(let i,s,u=0,p=r.length,_=p-1;u<p;_=u++)i=r[u],s=r[_],e+=(s.x-i.x)*(i.y+s.y);return e}ht.types=["Unknown","Point","LineString","Polygon"];class zt{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Jt,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new ht(this._pbf,i,this.extent,this._keys,this._values)}}function Jt(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push((function(s){let u=null;const p=s.readVarint()+s.pos;for(;s.pos<p;){const _=s.readVarint()>>3;u=_===1?s.readString():_===2?s.readFloat():_===3?s.readDouble():_===4?s.readVarint64():_===5?s.readVarint():_===6?s.readSVarint():_===7?s.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u})(i))}class gt{constructor(e,i){this.layers=e.readFields(nt,{},i)}}function nt(r,e,i){if(r===3){const s=new zt(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}const Bt="3d_elevation_id",Dt="level";class li{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,s){return this.get(e,!0,i,s)}optional(e,i,s){return this.get(e,!1,i,s)}success(){return this._valid}get(e,i,s,u){const p=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&p!==void 0&&!Number.isNaN(p)?s(u?u(p):p):i&&(this._valid=!1),this}}class Ei{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,s){return this.featureFunc(e,i,s)}parseVertex(e,i,s){return this.vertexFunc(e,i,s)}}const Ri=new Ei(((r,e,i)=>r.reset(e).require(Bt,(s=>{i.id=s})).optional("fixed_height_relative",(s=>{i.constantHeight=s}),mi.decodeRelativeHeight).geometry((s=>{i.bounds=s}),Lc).success()),((r,e,i)=>r.reset(e).require(Bt,(s=>{i.id=s})).require("elevation_idx",(s=>{i.idx=s})).require("extent",(s=>{i.extent=s})).require("height_relative",(s=>{i.height=s}),mi.decodeRelativeHeight).geometry((s=>{i.position=s}),mi.getPoint).success())),Ti=new Ei(((r,e,i)=>r.reset(e).require(Bt,(s=>{i.id=s})).optional("fixed_height",(s=>{i.constantHeight=s}),mi.decodeMetricHeight).geometry((s=>{i.bounds=s}),Lc).success()),((r,e,i)=>r.reset(e).require(Bt,(s=>{i.id=s})).require("elevation_idx",(s=>{i.idx=s})).require("extent",(s=>{i.extent=s})).require("height",(s=>{i.height=s}),mi.decodeMetricHeight).geometry((s=>{i.position=s}),mi.getPoint).success()));class mi{static getPoint(e){return ar(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Ti:void 0:Ri}static parse(e){const i=[],s=[],u=e.length,p=new li;for(let _=0;_<u;_++){const v=e.feature(_),E=v.properties.version,C=mi.getVersionSchema(E);if(C===void 0){Bi(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const k=v.properties.type;if(!k)continue;const F=ht.types[v.type];if(F==="Point"&&k==="curve_point"){const V={};C.parseVertex(p,v,V)&&i.push(V)}else if(F==="Polygon"&&k==="curve_meta"){const V={};C.parseFeature(p,v,V)&&s.push(V)}}return{vertices:i,features:s}}}class pn{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const u=ul(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/u;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,!0}}class en{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const u=Cr(i,this.dir);if(Math.abs(u)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,s){if((function(j,$){var ee=j[0],oe=j[1],se=j[2],ge=$[0],xe=$[1],Ie=$[2];return Math.abs(ee-ge)<=tt*Math.max(1,Math.abs(ee),Math.abs(ge))&&Math.abs(oe-xe)<=tt*Math.max(1,Math.abs(oe),Math.abs(xe))&&Math.abs(se-Ie)<=tt*Math.max(1,Math.abs(se),Math.abs(Ie))})(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[u,p,_]=this.dir,v=this.pos[0]-e[0],E=this.pos[1]-e[1],C=this.pos[2]-e[2],k=u*u+p*p+_*_,F=2*(v*u+E*p+C*_),V=F*F-4*k*(v*v+E*E+C*C-i*i);if(V<0){const j=Math.max(-F/2,0),$=v+u*j,ee=E+p*j,oe=C+_*j,se=Math.hypot($,ee,oe);return s[0]=$*i/se,s[1]=ee*i/se,s[2]=oe*i/se,!1}{const j=(-F-Math.sqrt(V))/(2*k);if(j<0){const $=Math.hypot(v,E,C);return s[0]=v*i/$,s[1]=E*i/$,s[2]=C*i/$,!1}return s[0]=v+u*j,s[1]=E+p*j,s[2]=C+_*j,!0}}}class ji{constructor(e,i,s,u,p){this.TL=e,this.TR=i,this.BR=s,this.BL=u,this.horizon=p}static fromInvProjectionMatrix(e,i,s){const u=[-1,1,1],p=[1,1,1],_=[1,-1,1],v=[-1,-1,1],E=ra(u,u,e),C=ra(p,p,e),k=ra(_,_,e),F=ra(v,v,e);return new ji(E,C,k,F,i/s)}}function Qi(r,e,i){let s=1/0,u=-1/0;const p=[];for(const _ of r){zr(p,_,e);const v=Cr(p,i);s=Math.min(s,v),u=Math.max(u,v)}return[s,u]}function vn(r,e){let i=!0;for(let s=0;s<r.planes.length;s++){const u=r.planes[s];let p=0;for(let _=0;_<e.length;_++)p+=+(Cr(u,e[_])+u[3]>=0);if(p===0)return 0;p!==e.length&&(i=!1)}return i?2:1}function rr(r,e){for(const i of r.projections){const s=Qi(e,r.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Br(r,e){let i=0;const s=[0,0,0,0];for(let _=0;_<r.length;_++)s[0]=r[_][0],s[1]=r[_][1],s[2]=r[_][2],s[3]=1,(u=s)[0]*(p=e)[0]+u[1]*p[1]+u[2]*p[2]+u[3]*p[3]>=0&&i++;var u,p;return i}class ba{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=_n.fromPoints(this.points),this.projections=[],this.frustumEdges=[zr([],this.points[2],this.points[3]),zr([],this.points[0],this.points[3]),zr([],this.points[4],this.points[0]),zr([],this.points[5],this.points[1]),zr([],this.points[6],this.points[2]),zr([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const u=[0,-s[2],s[1]],p=[s[2],0,-s[0]];this.projections.push({axis:u,projection:Qi(this.points,this.points[0],u)}),this.projections.push({axis:p,projection:Qi(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,i,s,u){const p=Math.pow(2,s),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((C=>{const k=la([],C,e),F=1/k[3]/i*p;return(V=k)[0]=(j=k)[0]*($=[F,F,u?1/k[3]:F,F])[0],V[1]=j[1]*$[1],V[2]=j[2]*$[2],V[3]=j[3]*$[3],V;var V,j,$})),v=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((C=>{const k=Cn([],Ir([],zr([],_[C[0]],_[C[1]]),zr([],_[C[2]],_[C[1]]))),F=-Cr(k,_[C[1]]);return k.concat(F)})),E=[];for(let C=0;C<_.length;C++)E.push([_[C][0],_[C][1],_[C][2]]);return new ba(E,v)}intersectsPrecise(e,i,s){for(let u=0;u<i.length;u++)if(!Br(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Br(e,this.planes[u]))return 0;for(const u of s)for(const p of this.frustumEdges){const _=Ir([],u,p),v=Qr(_);if(v===0)continue;ai(_,_,1/v);const E=Qi(this.points,this.points[0],_),C=Qi(e,this.points[0],_);if(E[0]>C[1]||C[0]>E[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(Cr([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class _n{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)Tt(i,i,u),jt(s,s,u);return new _n(i,s)}static fromTileIdAndHeight(e,i,s){const u=1<<e.canonical.z,p=e.canonical.x,_=e.canonical.y;return new _n([p/u,_/u,i],[(p+1)/u,(_+1)/u,s])}static applyTransform(e,i){const s=e.getCorners();for(let u=0;u<s.length;++u)ra(s[u],s[u],i);return _n.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],u=[...s];for(let p=0;p<3;p++)for(let _=0;_<3;_++){const v=i[4*_+p],E=v*e.min[_],C=v*e.max[_];s[p]+=Math.min(E,C),u[p]+=Math.max(E,C)}return new _n(s,u)}static projectAabbCorners(e,i){const s=e.getCorners();for(let u=0;u<s.length;++u)ra(s[u],s[u],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=ai([],yn([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=Hr(this.min),u=Hr(this.max);for(let p=0;p<i.length;p++)s[p]=i[p]?this.min[p]:this.center[p],u[p]=i[p]?this.center[p]:this.max[p];return u[2]=this.max[2],new _n(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?vn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?vn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?rr(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?rr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}di(_n,"Aabb");class aa{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,s=i[1],u=-i[0],p=(e.extent+1)*this.metersToTile;return[new je(Math.trunc(e.position[0]+s*p),Math.trunc(e.position[1]+u*p)),new je(Math.trunc(e.position[0]-s*p),Math.trunc(e.position[1]-u*p))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Qn{constructor(e,i,s,u,p,_){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[tr(),tr(),tr(),tr(),tr(),tr(),tr()],this.id=e,this.heightRange={min:s,max:s},this.safeArea=i,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=p,this.edges=this.edges.filter((v=>{return v.a<this.vertices.length&&v.b<this.vertices.length&&!((E=this.vertices[v.a].position)[0]===(C=this.vertices[v.b].position)[0]&&E[1]===C[1]);var E,C})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const v of this.vertices)this.vertexProps.push({dir:ar(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,v.height),this.heightRange.max=Math.max(this.heightRange.max,v.height);for(const v of this.edges){const E=this.vertices[v.a].position,C=this.vertices[v.b].position,k=Xr(tr(),C,E),F=Uo(k),V=ml(tr(),k,1/F);this.edgeProps.push({vec:k,dir:V,len:F});const j=this.vertexProps[v.a].dir,$=this.vertexProps[v.b].dir;pl(j,j,V),pl($,$,V)}for(const v of this.vertexProps)v.dir[0]===0&&v.dir[1]===0||lc(v.dir,v.dir);this.tessellate(_)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[s,u]=i;return Gn(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,u)}computeSlopeNormal(e,i){const s=this.getClosestEdge(e);if(!s)return ui(0,0,1);const u=s[0],p=this.edges[u],_=this.edgeProps[u].vec,v=ui(_[0],_[1],(this.vertices[p.b].height-this.vertices[p.a].height)*i),E=ui(v[1],-v[0],0);Ir(E,E,v);const C=Qr(E);return C>0?ai(E,E,1/C):Si(E,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,s=Number.POSITIVE_INFINITY,u=0;const[p,_,v,E,C,k,F]=this._tmpVec2;Hs(F,e.x,e.y);const V=new pn(F,null);for(let j=0;j<this.edges.length;j++){const $=this.edges[j],ee=this.edgeProps[j].dir;V.dir=ee;const oe=this.vertices[$.a].position,se=this.vertices[$.b].position,ge=V.intersectsPlane(oe,this.vertexProps[$.a].dir,p),xe=V.intersectsPlane(se,this.vertexProps[$.b].dir,_);if(!ge||!xe)continue;Xr(v,_,p),Xr(E,F,p);const Ie=ul(v,v),He=Ie>0?ul(E,v)/Ie:0,Ne=te(He,0,1),We=Math.abs((He-Ne)*this.edgeProps[j].len);Xr(C,F,oe),Hs(k,ee[1],-ee[0]);const at=We+Math.abs(ul(C,k));at<s&&(i=j,s=at,u=Ne)}return[i,u]}tessellate(e){const i=an(),s=an(),u=an(),p=an();for(let _=this.edges.length-1;_>=0;--_){const v=this.edges[_].a,E=this.edges[_].b,{position:C,height:k,extent:F}=this.vertices[v],{position:V,height:j,extent:$}=this.vertices[E],ee=this.vertexProps[v].dir,oe=this.vertexProps[E].dir;if(Si(i,C[0]/e,C[1]/e,k),Si(s,V[0]/e,V[1]/e,j),Si(u,ee[1],-ee[0],0),ai(u,u,F),Si(p,oe[1],-oe[0],0),ai(p,p,$),this.distSqLines(ui(i[0]+.5*u[0],i[1]+.5*u[1],i[2]+.5*u[2]),ui(s[0]-.5*p[0],s[1]-.5*p[1],s[2]-.5*p[2]),ui(i[0]-.5*u[0],i[1]-.5*u[1],i[2]-.5*u[2]),ui(s[0]+.5*p[0],s[1]+.5*p[1],s[2]+.5*p[2]))<=.0025000000000000005)continue;const se=this.vertices.length,ge=pl(tr(),C,V);this.vertices.push({position:ml(ge,ge,.5),height:.5*(k+j),extent:.5*(F+$)});const xe=pl(tr(),ee,oe);this.vertexProps.push({dir:lc(xe,xe)}),this.edges.splice(_,1),this.edgeProps.splice(_,1),this.edges.push({a:v,b:se}),this.edges.push({a:se,b:E});const Ie=Xr(tr(),this.vertices[se].position,C),He=Uo(Ie),Ne={vec:Ie,dir:ml(tr(),Ie,1/He),len:He};this.edgeProps.push(Ne),this.edgeProps.push(Ne)}}distSqLines(e,i,s,u){const p=Rn(an(),i,e),_=Rn(an(),u,s),v=Rn(an(),e,s),E=Cr(p,p),C=Cr(p,_),k=Cr(p,v),F=Cr(_,_),V=Cr(_,v),j=E*F-C*C;if(j===0)return _r(Fa(p,s,u,Cr(v,_)/Cr(_,_)),e);const $=(E*V-C*k)/j;return _r(Fa(p,e,i,(C*V-k*F)/j),Fa(_,s,u,$))}}class yr{static parseFrom(e,i){const s=mi.parse(e);if(!s)return[];let{vertices:u,features:p}=s;const _=1/fe(i);p.sort(((k,F)=>k.id-F.id)),u.sort(((k,F)=>k.id-F.id||k.idx-F.idx)),u=u.filter(((k,F,V)=>F===V.findIndex((j=>j.id===k.id&&j.idx===k.idx))));const v=new Array;let E=0;const C=u.length;for(const k of p){if(k.constantHeight){v.push(new Qn(k.id,k.bounds,k.constantHeight));continue}for(;E!==C&&u[E].id<k.id;)E++;if(E===C||u[E].id!==k.id)continue;const F=new Array,V=new Array,j=E;for(;E!==C&&u[E].id===k.id;){const $=u[E];if(F.push({position:$.position,height:$.height,extent:$.extent}),E!==j&&u[E-1].idx===$.idx-1){const ee=E-j;V.push({a:ee-1,b:ee})}E++}v.push(new Qn(k.id,k.bounds,void 0,F,V,_))}return v}static getElevationFeature(e,i){if(!i)return;const s=+e.properties[Bt];return Number.isNaN(s)?void 0:i.find((u=>u.id===s))}}class Gr{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*pi,this.yOffset=(e.y*this.zScale-i.y)*pi)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,s){const u=this.constantElevation(i,s);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),s))}computeBiasedHeight(e,i){return i<=0?e:e+i*pe(0,i,e>=0?e:Math.abs(.5*e))}}di(Qn,"ElevationFeature");class Kr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new hf,this.indexArray=new ao,this.segments=new xs,this.programConfigurations=new yh(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Zh),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){const p=this.layers[0],_=[];let v=null;p.type==="circle"&&(v=p.layout.get("circle-sort-key"));for(const{feature:C,id:k,index:F,sourceLayerIndex:V}of e){const j=this.layers[0]._featureFilter.needGeometry,$=ft(C,j);if(!this.layers[0]._featureFilter.filter(new Xa(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),$,s))continue;const ee=v?v.evaluate($,{},s):void 0,oe={id:k,properties:C.properties,type:C.type,sourceLayerIndex:V,index:F,geometry:j?$.geometry:it(C,s,u),patterns:{},sortKey:ee};_.push(oe)}v&&_.sort(((C,k)=>C.sortKey-k.sortKey));let E=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new ff,E=u.projection);for(const C of _){const{geometry:k,index:F,sourceLayerIndex:V}=C,j=e[F].feature;this.addFeature(C,k,F,i.availableImages,s,E,i.brightness,i.elevationFeatures),i.featureIndex.insert(j,k,F,V,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,s,u,p,_,v){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Nm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,xm.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Vm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,s,u,p,_,v,E){let C;this.elevationMode!=="none"&&(C=yr.getElevationFeature(e,E));for(const k of i)for(const F of k){const V=F.x,j=F.y;if(V<0||V>=pi||j<0||j>=pi)continue;if(_){const oe=_.projectTilePoint(V,j,p),se=_.upVector(p,V,j);this.addGlobeExtVertex(oe,se),this.addGlobeExtVertex(oe,se),this.addGlobeExtVertex(oe,se),this.addGlobeExtVertex(oe,se)}const $=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),ee=$.vertexLength;if(this.addCircleVertex(V,j,-1,-1),this.addCircleVertex(V,j,1,-1),this.addCircleVertex(V,j,1,1),this.addCircleVertex(V,j,-1,1),this.elevationMode!=="none"){const oe=C?C.pointElevation(new je(V,j)):0;this.hasElevation=this.hasElevation||oe!==0;for(let se=0;se<4;se++)this.elevatedLayoutVertexArray.emplaceBack(oe)}this.indexArray.emplaceBack(ee,ee+1,ee+2),this.indexArray.emplaceBack(ee,ee+2,ee+3),$.vertexLength+=4,$.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,p,v,void 0,this.worldview)}addCircleVertex(e,i,s,u){this.layoutVertexArray.emplaceBack(2*e+(s+1)/2,2*i+(u+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function qr(r,e){for(let i=0;i<r.length;i++)if(qa(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(qa(r,e[i]))return!0;return!!Ga(r,e)}function mr(r,e,i){return!!qa(r,e)||!!fa(e,r,i)}function wa(r,e){if(r.length===1)return ws(e,r[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let u=0;u<s.length;u++)if(qa(r,s[u]))return!0}for(let i=0;i<r.length;i++)if(ws(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Ga(r,e[i]))return!0;return!1}function Bs(r,e,i){if(r.length>1){if(Ga(r,e))return!0;for(let s=0;s<e.length;s++)if(fa(e[s],r,i))return!0}for(let s=0;s<r.length;s++)if(fa(r[s],e,i))return!0;return!1}function Ga(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const s=r[i],u=r[i+1];for(let p=0;p<e.length-1;p++)if(ya(s,u,e[p],e[p+1]))return!0}return!1}function ya(r,e,i,s){return dr(r,i,s)!==dr(e,i,s)&&dr(r,e,i)!==dr(r,e,s)}function Sr(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function gr(r,e,i,s){const u=Sr(r,e,s),p=Sr(r,e,i);if(Math.sign(u)===Math.sign(p))return;const _=Sr(i,s,r),v=_+p-u;return Math.sign(_)!==Math.sign(v)?[_/(_-v),p/(p-u)]:void 0}function fa(r,e,i){const s=i*i;if(e.length===1)return r.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(bs(r,e[u-1],e[u])<s)return!0;return!1}function bs(r,e,i){const s=e.distSqr(i);if(s===0)return r.distSqr(e);const u=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/s;return r.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function ws(r,e){let i,s,u,p=!1;for(let _=0;_<r.length;_++){i=r[_];for(let v=0,E=i.length-1;v<i.length;E=v++)s=i[v],u=i[E],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(p=!p)}return p}function qa(r,e){let i=!1;for(let s=0,u=r.length-1;s<r.length;u=s++){const p=r[s],_=r[u];p.y>e.y!=_.y>e.y&&e.x<(_.x-p.x)*(e.y-p.y)/(_.y-p.y)+p.x&&(i=!i)}return i}function Bo(r,e,i,s,u){for(const _ of r)if(e<=_.x&&i<=_.y&&s>=_.x&&u>=_.y)return!0;const p=[new je(e,i),new je(e,u),new je(s,u),new je(s,i)];if(r.length>2){for(const _ of p)if(qa(r,_))return!0}for(let _=0;_<r.length-1;_++)if(Qo(r[_],r[_+1],p))return!0;return!1}function Qo(r,e,i){const s=i[0],u=i[2];if(r.x<s.x&&e.x<s.x||r.x>u.x&&e.x>u.x||r.y<s.y&&e.y<s.y||r.y>u.y&&e.y>u.y)return!1;const p=dr(r,e,i[0]);return p!==dr(r,e,i[1])||p!==dr(r,e,i[2])||p!==dr(r,e,i[3])}function oo(r,e,i,s,u,p){let _=e.y-r.y,v=r.x-e.x;if(p=p||0){const E=_*_+v*v;if(E===0)return!0;const C=Math.sqrt(E);_/=C,v/=C}return!((i.x-r.x)*_+(i.y-r.y)*v-p<0||(s.x-r.x)*_+(s.y-r.y)*v-p<0||(u.x-r.x)*_+(u.y-r.y)*v-p<0)}function Ho(r,e,i,s,u,p,_){return!(oo(r,e,s,u,p,_)||oo(e,i,s,u,p,_)||oo(i,r,s,u,p,_)||oo(s,u,r,e,i,_)||oo(u,p,r,e,i,_)||oo(p,s,r,e,i,_))}function jl(r,e,i){const s=e.paint.get(r).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(r)}function fl(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function eu(r,e,i,s,u){if(!e[0]&&!e[1])return r;const p=je.convert(e)._mult(u);i==="viewport"&&p._rotate(-s);const _=[];for(let v=0;v<r.length;v++)_.push(r[v].sub(p));return _}function Yu(r,e,i,s){const u=je.convert(r)._mult(s);return e==="viewport"&&u._rotate(-i),u}let ic,Fs;function lo(r,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[r*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}di(Kr,"CircleBucket",{omit:["layers"]});class Na{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Ts(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const s=(function(p,_,v){var E=lo(256*p,256*(_=Math.pow(2,v)-_-1),v),C=lo(256*(p+1),256*(_+1),v);return E[0]+","+E[1]+","+C[0]+","+C[1]})(this.x,this.y,this.z),u=(function(p,_,v){let E,C="";for(let k=p;k>0;k--)E=1<<k-1,C+=(_&E?1:0)+(v&E?2:0);return C})(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ns{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ts(e,i.z,i.z,i.x,i.y)}}class zs{constructor(e,i,s,u,p){this.overscaledZ=e,this.wrap=i,this.canonical=new Na(s,+u,+p),this.key=i===0&&e===s?this.canonical.key:Ts(i,e,s,u,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new zs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new zs(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Ts(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Ts(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new zs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new zs(i,this.wrap,i,s,u),new zs(i,this.wrap,i,s+1,u),new zs(i,this.wrap,i,s,u+1),new zs(i,this.wrap,i,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new zs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new zs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ns(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ts(r,e,i,s,u){const p=1<<Math.min(i,22);let _=p*(u%p)+s%p;return r&&i<22&&(_+=p*p*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*_+i)+(e-i)}const nc=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new zs(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new zs(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new zs(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new zs(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];di(Na,"CanonicalTileID"),di(zs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Ud=Zr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ku}=Ud,vf=Zr([{name:"a_pos_3",components:3,type:"Int16"}]);var Wh=Zr([{name:"a_pos",type:"Int16",components:2}]);function vh(r){return r*ps/h}const bh=[new _n([Wu,Wu,Wu],[vs,vs,vs]),new _n([Wu,Wu,Wu],[0,0,vs]),new _n([0,Wu,Wu],[vs,0,vs]),new _n([Wu,0,Wu],[0,vs,vs]),new _n([0,0,Wu],[vs,vs,vs])];function bf(r,e,i,s=!0){const u=ai([],r._camera.position,r.worldSize),p=[e,i,1,1];la(p,p,r.pixelMatrixInverse),ho(p,p,1/p[3]);const _=Cn([],zr([],p,u)),v=r.globeMatrix,E=[v[12],v[13],v[14]],C=zr([],E,u),k=Qr(C),F=Cn([],C),V=r.worldSize/(2*Math.PI),j=Cr(F,_),$=Math.asin(V/k);if($<Math.acos(j)){if(!s)return null;const Gt=[],pt=[];ai(Gt,_,k/j),Cn(pt,zr(pt,Gt,C)),Cn(_,yn(_,C,ai(_,pt,Math.tan($)*k)))}const ee=[];new en(u,_).closestPointOnSphere(E,V,ee);const oe=Cn([],ss(v,0)),se=Cn([],ss(v,1)),ge=Cn([],ss(v,2)),xe=Cr(oe,ee),Ie=Cr(se,ee),He=Cr(ge,ee),Ne=hi(Math.asin(-Ie/V));let We=hi(Math.atan2(xe,He));We=r.center.lng+(function(Gt,pt){const Xt=(pt-Gt+180)%360-180;return Xt<-180?Xt+360:Xt})(r.center.lng,We);const at=M(We),ct=te(R(Ne),0,1);return new Te(at,ct)}class el{constructor(e,i,s){this.a=zr([],e,s),this.b=zr([],i,s),this.center=s;const u=Cn([],this.a),p=Cn([],this.b);this.angle=Math.acos(Cr(u,p))}}function Iu(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:(function(s,u,p,_){const v=Math.sin(p);return s*(Math.sin((1-_)*p)/v)+u*(Math.sin(_*p)/v)})(r.a[e],r.b[e],r.angle,te(i,0,1))+r.center[e]}function Ju(r){if(r.z<=1)return bh[r.z+2*r.y+r.x];const e=h_(Em(r));return _n.fromPoints(e)}function cs(r,e,i){return ai(r,r,1-i),ln(r,r,e,i)}function Gm(r,e,i){for(const s of r)ra(s,s,e),ai(s,s,i)}function A_(r,e,i,s){const u=e/r.worldSize,p=r.globeMatrix;if(i.z<=1){const ct=Ju(i).getCorners();return Gm(ct,p,u),_n.fromPoints(ct)}const _=Em(i,s),v=h_(_,ps+vh(r._tileCoverLift));Gm(v,p,u);const E=Number.MAX_VALUE,C=[-E,-E,-E],k=[E,E,E];if(_.contains(r.center)){for(const pt of v)Tt(k,k,pt),jt(C,C,pt);C[2]=0;const ct=r.point,Gt=[ct.x*u,ct.y*u,0];return Tt(k,k,Gt),jt(C,C,Gt),new _n(k,C)}if(r._tileCoverLift>0){for(const ct of v)Tt(k,k,ct),jt(C,C,ct);return new _n(k,C)}const F=[p[12]*u,p[13]*u,p[14]*u],V=_.getCenter(),j=te(r.center.lat,-Q,Q),$=te(V.lat,-Q,Q),ee=M(r.center.lng),oe=R(j);let se=ee-M(V.lng);const ge=oe-R($);se>.5?se-=1:se<-.5&&(se+=1);let xe=0;Math.abs(se)>Math.abs(ge)?xe=se>=0?1:3:(xe=ge>=0?0:2,ln(F,F,[p[4]*u,p[5]*u,p[6]*u],-Math.sin(fi(ge>=0?_.getSouth():_.getNorth()))*ps));const Ie=v[xe],He=v[(xe+1)%4],Ne=new el(Ie,He,F),We=[Iu(Ne,0)||Ie[0],Iu(Ne,1)||Ie[1],Iu(Ne,2)||Ie[2]],at=tu(r.zoom);if(at>0){const ct=(function({x:pt,y:Xt,z:ni},ri,vi,wi,_i){const gi=1/(1<<ni);let Zt=pt*gi,$t=Zt+gi,yi=Xt*gi,ki=yi+gi,Ii=0;const Dn=(Zt+$t)/2-wi;return Dn>.5?Ii=-1:Dn<-.5&&(Ii=1),Zt=((Zt+Ii)*ri-(wi*=ri))*vi+wi,$t=(($t+Ii)*ri-wi)*vi+wi,yi=(yi*ri-(_i*=ri))*vi+_i,ki=(ki*ri-_i)*vi+_i,[[Zt,ki,0],[$t,ki,0],[$t,yi,0],[Zt,yi,0]]})(i,e,r._pixelsPerMercatorPixel,ee,oe);for(let pt=0;pt<v.length;pt++)cs(v[pt],ct[pt],at);const Gt=yn([],ct[xe],ct[(xe+1)%4]);ai(Gt,Gt,.5),cs(We,Gt,at)}for(const ct of v)Tt(k,k,ct),jt(C,C,ct);return k[2]=Math.min(Ie[2],He[2]),Tt(k,k,We),jt(C,C,We),new _n(k,C)}function Em({x:r,y:e,z:i},s=!1){const u=1/(1<<i),p=new a(U(r*u),e===(1<<i)-1&&s?-90:Y((e+1)*u)),_=new a(U((r+1)*u),e===0&&s?90:Y(e*u));return new d(p,_)}function h_(r,e=ps){const i=fi(r.getNorth()),s=fi(r.getSouth()),u=Math.cos(i),p=Math.cos(s),_=Math.sin(i),v=Math.sin(s),E=r.getWest(),C=r.getEast();return[wl(p,v,E,e),wl(p,v,C,e),wl(u,_,C,e),wl(u,_,E,e)]}function qm(r,e,i,s){const u=1<<i.z,p=(r/pi+i.x)/u;return Au(Y((e/pi+i.y)/u),U(p),s)}function Hm({min:r,max:e}){return Ul/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const bd=new Float64Array(16);function wf(r){const e=Hm(r),i=Ot(bd,[e,e,e]);return Ji(i,i,pr([],r.min))}function Am(r){const e=(s=r.min,(i=bd)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const u=1/Hm(r);return Vn(e,e,[u,u,u])}function $p(r){const e=pi/(2*Math.PI);return r/(2*Math.PI)/e}function $m(r,e){return pi/(512*Math.pow(2,r))*Hm(Ju(e))}function qf(r,e,i,s,u){const p=$p(i),_=[r,e,-i/(2*Math.PI)],v=Wi(new Float64Array(16));return Ji(v,v,_),Vn(v,v,[p,p,p]),Oi(v,v,fi(-u)),Hn(v,v,fi(-s)),v}function tu(r){return pe(wc,Hp,r)}function Zp(r,e){const i=Au(e.lat,e.lng),s=(function($){const ee=Au($._center.lat,$._center.lng);let oe=Ir([],ui(0,1,0),ee);const se=Vt([],-$.angle,ee);oe=ra(oe,oe,se),Vt(se,-$._pitch,oe);const ge=Cn([],ee);return ai(ge,ge,vh($.cameraToCenterDistance/$.pixelsPerMeter)),ra(ge,ge,se),yn([],ee,ge)})(r);return _=(u=Rn([],s,i))[0],v=u[1],E=u[2],C=(p=i)[0],k=p[1],F=p[2],j=(V=Math.sqrt((_*_+v*v+E*E)*(C*C+k*k+F*F)))&&Cr(u,p)/V,Math.acos(Math.min(Math.max(j,-1),1));var u,p,_,v,E,C,k,F,V,j}function yp(r,e){return Zp(r,e)>Math.PI/2*1.01}const d_=fi(85),Zm=Math.cos(d_),I_=Math.sin(d_),Xm=on(),Wm=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Xp(r,e,i,s,u,p,_,v,E){if(p&&r.queryGeometry.isAboveHorizon)return!1;p&&(E*=r.pixelToTileUnitsFactor);const C=r.tileID.canonical,k=i.projection.upVectorScale(C,i.center.lat,i.worldSize).metersToTile;for(const F of e)for(const V of F){const j=V.add(v),$=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(j.x,j.y,!0):0,ee=i.projection.projectTilePoint(j.x,j.y,C);if($>0){const xe=i.projection.upVector(C,j.x,j.y);ee.x+=xe[0]*k*$,ee.y+=xe[1]*k*$,ee.z+=xe[2]*k*$}const oe=p?j:$_(ee.x,ee.y,ee.z,s),se=p?r.tilespaceRays.map((xe=>xp(xe,$))):r.queryGeometry.screenGeometry,ge=la([],[ee.x,ee.y,ee.z,1],s);if(!_&&p?E*=ge[3]/i.cameraToCenterDistance:_&&!p&&(E*=i.cameraToCenterDistance/ge[3]),p){const xe=Y((V.y/pi+C.y)/(1<<C.z));E/=i.projection.pixelsPerMeter(xe,1)/N(1,xe)}if(mr(se,oe,E))return!0}return!1}function $_(r,e,i,s){const u=la([],[r,e,i,1],s);return new je(u[0]/u[3],u[1]/u[3])}const M_=ui(0,0,0),mg=ui(0,0,1);function xp(r,e){const i=an();return M_[2]=e,r.intersectsPlane(M_,mg,i),new je(i[0],i[1])}class Gl extends Kr{}let Hf,f_,Wp,C_;function Ym(r,{width:e,height:i},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*s);return r.width=e,r.height=i,r.data=u,r}function Ss(r,e,i){const{width:s,height:u}=e;s===r.width&&u===r.height||(Im(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,s),height:Math.min(r.height,u)},i,null),r.width=s,r.height=u,r.data=e.data)}function Im(r,e,i,s,u,p,_,v){if(u.width===0||u.height===0)return e;if(u.width>r.width||u.height>r.height||i.x>r.width-u.width||i.y>r.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const E=r.data,C=e.data,k=p===4&&v;for(let F=0;F<u.height;F++){const V=((i.y+F)*r.width+i.x)*p,j=((s.y+F)*e.width+s.x)*p;if(k)for(let $=0;$<u.width;$++){const ee=V+$*p+3,oe=j+$*p;C[oe+0]=255,C[oe+1]=255,C[oe+2]=255,C[oe+3]=E[ee]}else if(_)for(let $=0;$<u.width;$++){const ee=V+$*p,oe=j+$*p,se=new Ta(E[ee+0]/255,E[ee+1]/255,E[ee+2]/255,E[ee+3]).toNonPremultipliedRenderColor(_).toArray();C[oe+0]=se[0],C[oe+1]=se[1],C[oe+2]=se[2],C[oe+3]=se[3]}else for(let $=0;$<u.width*p;$++)C[j+$]=E[V+$]}return e}di(Gl,"HeatmapBucket",{omit:["layers"]});class wd{constructor(e,i){Ym(this,e,1,i)}resize(e){Ss(this,new wd(e),1)}clone(){return new wd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,p){Im(e,i,s,u,p,1,null)}}class Tl{constructor(e,i){Ym(this,e,4,i)}resize(e){Ss(this,new Tl(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Tl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,u,p,_,v){Im(e,i,s,u,p,4,_,v)}}class p_{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function $f(r){const e={},i=r.resolution||256,s=r.clips?r.clips.length:1,u=r.image||new Tl({width:i,height:s}),p=(_,v,E)=>{e[r.evaluationKey]=E;const C=r.expression.evaluate(e),k=C?C.toNonPremultipliedRenderColor(null):null;k&&(u.data[_+v+0]=Math.floor(255*k.r),u.data[_+v+1]=Math.floor(255*k.g),u.data[_+v+2]=Math.floor(255*k.b),u.data[_+v+3]=Math.floor(255*k.a))};if(r.clips)for(let _=0,v=0;_<s;++_,v+=4*i)for(let E=0,C=0;E<i;E++,C+=4){const k=E/(i-1),{start:F,end:V}=r.clips[_];p(v,C,F*(1-k)+V*k)}else for(let _=0,v=0;_<i;_++,v+=4)p(0,v,_/(i-1));return u}di(wd,"AlphaImage"),di(Tl,"RGBAImage");const Yp=Zr([{name:"a_pos",components:2,type:"Int16"}],4),Km=Zr([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Jm=Zr([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),m_=Zr([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Kp(r,e,i=2){const s=e&&e.length,u=s?e[0]*i:r.length;let p=__(r,0,u,i,!0);const _=[];if(!p||p.next===p.prev)return _;let v,E,C;if(s&&(p=(function(k,F,V,j){const $=[];for(let ee=0,oe=F.length;ee<oe;ee++){const se=__(k,F[ee]*j,ee<oe-1?F[ee+1]*j:k.length,j,!1);se===se.next&&(se.steiner=!0),$.push(z(se))}$.sort(f);for(let ee=0;ee<$.length;ee++)V=l($[ee],V);return V})(r,e,p,i)),r.length>80*i){v=r[0],E=r[1];let k=v,F=E;for(let V=i;V<u;V+=i){const j=r[V],$=r[V+1];j<v&&(v=j),$<E&&(E=$),j>k&&(k=j),$>F&&(F=$)}C=Math.max(k-v,F-E),C=C!==0?32767/C:0}return Tf(p,_,i,v,E,C,0),_}function __(r,e,i,s,u){let p;if(u===(function(_,v,E,C){let k=0;for(let F=v,V=E-C;F<E;F+=C)k+=(_[V]-_[F])*(_[F+1]+_[V+1]),V=F;return k})(r,e,i,s)>0)for(let _=e;_<i;_+=s)p=Ke(_/s|0,r[_],r[_+1],p);else for(let _=i-s;_>=e;_-=s)p=Ke(_/s|0,r[_],r[_+1],p);return p&&re(p,p.next)&&(yt(p),p=p.next),p}function jd(r,e){if(!r)return r;e||(e=r);let i,s=r;do if(i=!1,s.steiner||!re(s,s.next)&&Z(s.prev,s,s.next)!==0)s=s.next;else{if(yt(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function Tf(r,e,i,s,u,p,_){if(!r)return;!_&&p&&(function(E,C,k,F){let V=E;do V.z===0&&(V.z=T(V.x,V.y,C,k,F)),V.prevZ=V.prev,V.nextZ=V.next,V=V.next;while(V!==E);V.prevZ.nextZ=null,V.prevZ=null,(function(j){let $,ee=1;do{let oe,se=j;j=null;let ge=null;for($=0;se;){$++;let xe=se,Ie=0;for(let Ne=0;Ne<ee&&(Ie++,xe=xe.nextZ,xe);Ne++);let He=ee;for(;Ie>0||He>0&&xe;)Ie!==0&&(He===0||!xe||se.z<=xe.z)?(oe=se,se=se.nextZ,Ie--):(oe=xe,xe=xe.nextZ,He--),ge?ge.nextZ=oe:j=oe,oe.prevZ=ge,ge=oe;se=xe}ge.nextZ=null,ee*=2}while($>1)})(V)})(r,s,u,p);let v=r;for(;r.prev!==r.next;){const E=r.prev,C=r.next;if(p?Qm(r,s,u,p):xo(r))e.push(E.i,r.i,C.i),yt(r),r=C.next,v=C.next;else if((r=C)===v){_?_===1?Tf(r=Tc(jd(r),e),e,i,s,u,p,2):_===2&&_g(r,e,i,s,u,p):Tf(jd(r),e,i,s,u,p,1);break}}}function xo(r){const e=r.prev,i=r,s=r.next;if(Z(e,i,s)>=0)return!1;const u=e.x,p=i.x,_=s.x,v=e.y,E=i.y,C=s.y,k=Math.min(u,p,_),F=Math.min(v,E,C),V=Math.max(u,p,_),j=Math.max(v,E,C);let $=s.next;for(;$!==e;){if($.x>=k&&$.x<=V&&$.y>=F&&$.y<=j&&B(u,v,p,E,_,C,$.x,$.y)&&Z($.prev,$,$.next)>=0)return!1;$=$.next}return!0}function Qm(r,e,i,s){const u=r.prev,p=r,_=r.next;if(Z(u,p,_)>=0)return!1;const v=u.x,E=p.x,C=_.x,k=u.y,F=p.y,V=_.y,j=Math.min(v,E,C),$=Math.min(k,F,V),ee=Math.max(v,E,C),oe=Math.max(k,F,V),se=T(j,$,e,i,s),ge=T(ee,oe,e,i,s);let xe=r.prevZ,Ie=r.nextZ;for(;xe&&xe.z>=se&&Ie&&Ie.z<=ge;){if(xe.x>=j&&xe.x<=ee&&xe.y>=$&&xe.y<=oe&&xe!==u&&xe!==_&&B(v,k,E,F,C,V,xe.x,xe.y)&&Z(xe.prev,xe,xe.next)>=0||(xe=xe.prevZ,Ie.x>=j&&Ie.x<=ee&&Ie.y>=$&&Ie.y<=oe&&Ie!==u&&Ie!==_&&B(v,k,E,F,C,V,Ie.x,Ie.y)&&Z(Ie.prev,Ie,Ie.next)>=0))return!1;Ie=Ie.nextZ}for(;xe&&xe.z>=se;){if(xe.x>=j&&xe.x<=ee&&xe.y>=$&&xe.y<=oe&&xe!==u&&xe!==_&&B(v,k,E,F,C,V,xe.x,xe.y)&&Z(xe.prev,xe,xe.next)>=0)return!1;xe=xe.prevZ}for(;Ie&&Ie.z<=ge;){if(Ie.x>=j&&Ie.x<=ee&&Ie.y>=$&&Ie.y<=oe&&Ie!==u&&Ie!==_&&B(v,k,E,F,C,V,Ie.x,Ie.y)&&Z(Ie.prev,Ie,Ie.next)>=0)return!1;Ie=Ie.nextZ}return!0}function Tc(r,e){let i=r;do{const s=i.prev,u=i.next.next;!re(s,u)&&de(s,i,i.next,u)&&Le(s,u)&&Le(u,s)&&(e.push(s.i,i.i,u.i),yt(i),yt(i.next),i=r=u),i=i.next}while(i!==r);return jd(i)}function _g(r,e,i,s,u,p){let _=r;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&q(_,v)){let E=qe(_,v);return _=jd(_,_.next),E=jd(E,E.next),Tf(_,e,i,s,u,p,0),void Tf(E,e,i,s,u,p,0)}v=v.next}_=_.next}while(_!==r)}function f(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function l(r,e){const i=(function(u,p){let _=p;const v=u.x,E=u.y;let C,k=-1/0;if(re(u,_))return _;do{if(re(u,_.next))return _.next;if(E<=_.y&&E>=_.next.y&&_.next.y!==_.y){const ee=_.x+(E-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(ee<=v&&ee>k&&(k=ee,C=_.x<_.next.x?_:_.next,ee===v))return C}_=_.next}while(_!==p);if(!C)return null;const F=C,V=C.x,j=C.y;let $=1/0;_=C;do{if(v>=_.x&&_.x>=V&&v!==_.x&&O(E<j?v:k,E,V,j,E<j?k:v,E,_.x,_.y)){const ee=Math.abs(E-_.y)/(v-_.x);Le(_,u)&&(ee<$||ee===$&&(_.x>C.x||_.x===C.x&&g(C,_)))&&(C=_,$=ee)}_=_.next}while(_!==F);return C})(r,e);if(!i)return e;const s=qe(i,r);return jd(s,s.next),jd(i,i.next)}function g(r,e){return Z(r.prev,r,e.prev)<0&&Z(e.next,r,r.next)<0}function T(r,e,i,s,u){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*u|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function z(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function O(r,e,i,s,u,p,_,v){return(u-_)*(e-v)>=(r-_)*(p-v)&&(r-_)*(s-v)>=(i-_)*(e-v)&&(i-_)*(p-v)>=(u-_)*(s-v)}function B(r,e,i,s,u,p,_,v){return!(r===_&&e===v)&&O(r,e,i,s,u,p,_,v)}function q(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!(function(i,s){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==s.i&&u.next.i!==s.i&&de(u,u.next,i,s))return!0;u=u.next}while(u!==i);return!1})(r,e)&&(Le(r,e)&&Le(e,r)&&(function(i,s){let u=i,p=!1;const _=(i.x+s.x)/2,v=(i.y+s.y)/2;do u.y>v!=u.next.y>v&&u.next.y!==u.y&&_<(u.next.x-u.x)*(v-u.y)/(u.next.y-u.y)+u.x&&(p=!p),u=u.next;while(u!==i);return p})(r,e)&&(Z(r.prev,r,e.prev)||Z(r,e.prev,e))||re(r,e)&&Z(r.prev,r,r.next)>0&&Z(e.prev,e,e.next)>0)}function Z(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function re(r,e){return r.x===e.x&&r.y===e.y}function de(r,e,i,s){const u=Ee(Z(r,e,i)),p=Ee(Z(r,e,s)),_=Ee(Z(i,s,r)),v=Ee(Z(i,s,e));return u!==p&&_!==v||!(u!==0||!ye(r,i,e))||!(p!==0||!ye(r,s,e))||!(_!==0||!ye(i,r,s))||!(v!==0||!ye(i,e,s))}function ye(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Ee(r){return r>0?1:r<0?-1:0}function Le(r,e){return Z(r.prev,r,r.next)<0?Z(r,e,r.next)>=0&&Z(r,r.prev,e)>=0:Z(r,e,r.prev)<0||Z(r,r.next,e)<0}function qe(r,e){const i=Mt(r.i,r.x,r.y),s=Mt(e.i,e.x,e.y),u=r.next,p=e.prev;return r.next=e,e.prev=r,i.next=u,u.prev=i,s.next=i,i.prev=s,p.next=s,s.prev=p,s}function Ke(r,e,i,s){const u=Mt(r,e,i);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function yt(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Mt(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function si(r,e){const i=r.length;if(i<=1)return[r];const s=[];let u,p;for(let _=0;_<i;_++){const v=$n(r[_]);v!==0&&(r[_].area=Math.abs(v),p===void 0&&(p=v<0),p===v<0?(u&&s.push(u),u=[r[_]]):u.push(r[_]))}if(u&&s.push(u),e>1)for(let _=0;_<s.length;_++)s[_].length<=e||(Ua(s[_],e,1,s[_].length-1,Ut),s[_]=s[_].slice(0,e));return s}function Ut(r,e){return e.area-r.area}function ii(r,e,i=1){if(!r)return null;const s=typeof r=="string"?Io.from(r).getPrimary():r.getPrimary(),u=typeof r=="string"?null:r.getSecondary();for(const p of[s,u]){if(!p)continue;const _=p.id.toString();e.has(_)||e.set(_,[]),p.scaleSelf(i),e.get(_).push(p)}return{primary:s.toString(),secondary:u?u.toString():null}}function Pi(r,e,i,s){const u=s.patternDependencies;let p=!1;for(const _ of e){const v=_.paint.get(`${r}-pattern`);v.isConstant()||(p=!0),ii(v.constantOr(null),u,i)&&(p=!0)}return p}function gn(r,e,i,s,u,p){const _=p.patternDependencies;for(const v of e){const E=v.paint.get(`${r}-pattern`).value;if(E.kind!=="constant"){let C=E.evaluate({zoom:s},i,{},p.availableImages);C=C&&C.name?C.name:C;const k=ii(C,_,u);if(!k)continue;const{primary:F,secondary:V}=k;F&&(i.patterns[v.id]=[F,V].filter(Boolean))}}return i}class Wn{constructor(){this.polygons=new Map}add(e,...i){const s=this.polygons.get(e);s?s.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,s]of e.polygons)this.add(i,...s)}}class Er{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=pi&&i>=pi}static evaluate(e){if(e.length===0)return new Er;let i=[];for(const E of e)i.push(...E.portals);if(i.length===0)return new Er;for(const E of i){const C=E.va,k=E.vb;(Er.isOnBorder(C.x,k.x)||Er.isOnBorder(C.y,k.y))&&(E.type="border")}const s=i.filter((E=>E.type!=="unevaluated")),u=i.filter((E=>E.type==="unevaluated"));if(u.length===0)return new Er;u.sort(((E,C)=>E.hash===C.hash?E.isTunnel===C.isTunnel?0:E.isTunnel?-1:1:E.hash<C.hash?1:-1)),i=s.concat(u);let p=s.length,_=p,v=p;do if(_++,_===i.length||i[p].hash!==i[_].hash){if(_-p==2){v<p&&(i[v]=i[p],i[p]=null);const E=i[v],C=i[_-1];E.type=E.isTunnel!==C.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:C.connection.a},v++}p=_}while(p!==i.length);return i.splice(v),i.sort(((E,C)=>E.hash<C.hash?1:-1)),{portals:i}}}di(Er,"ElevationPortalGraph"),di(Wn,"ElevationPolygons");class Fn{constructor(e,i,s){this.outPositions=e,this.outNormals=i,this.outIndices=s,this.vertexLookup=new Map}addVertex(e,i,s){let u=e[2];s!=null&&(u*=s);const p=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,_=this.vertexLookup.get(p);if(_!=null)return _;const v=this.outPositions.length;this.vertexLookup.set(p,v);const E=Math.trunc(16384*i[0]),C=Math.trunc(16384*i[1]),k=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(E,C,k),v}addTriangle(e,i,s){this.outIndices.emplaceBack(e,i,s)}addTriangles(e,i,s){if(e.length===0)return;const u=s.length===1,p=an(),_=an();for(let v=0;v<e.length;v+=3){const E=i[e[v+0]],C=i[e[v+1]],k=i[e[v+2]],F=u?s[0]:s[e[v+1]],V=u?s[0]:s[e[v+2]];Si(p,E.x,E.y,u?s[0]:s[e[v+0]]);const j=this.addVertex(p,_);Si(p,C.x,C.y,F);const $=this.addVertex(p,_);Si(p,k.x,k.y,V);const ee=this.addVertex(p,_);this.outIndices.emplaceBack(j,$,ee)}}addQuad(e,i,s,u,p,_){const v=this.addVertex(e,p,_),E=this.addVertex(i,p,_),C=this.addVertex(s,p,_),k=this.addVertex(u,p,_);this.addTriangle(v,E,C),this.addTriangle(C,k,v)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class In{constructor(e,i,s,u){this.unevaluatedPortals=new Er,this.portalPolygons=new Wn,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Lp,this.vertexNormals=new op,this.indexArray=new ao,this.tileToMeters=fe(e),this.bridgeProgramConfigurations=new yh(i,{zoom:s,lut:u},(p=>p!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new yh(i,{zoom:s,lut:u},(p=>p!=="fill-bridge-guard-rail-color"))}addVertices(e,i){const s=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(i[u]);return s}addTriangles(e,i,s){const u=s?this.unevalTunnelTriangles:this.unevalTriangles;for(const p of e)u.push(p+i)}addRenderableRing(e,i,s,u,p,_){const v=[new je(p.min.x,p.min.y),new je(p.max.x,p.min.y),new je(p.max.x,p.max.y),new je(p.min.x,p.max.y)];for(let E=0;E<s-1;E++){const C=i+E,k=C+1,F=this.unevalVertices[C],V=this.unevalVertices[k];if(!(F.x>=p.min.x&&F.x<=p.max.x&&F.y>=p.min.y&&F.y<=p.max.y||V.x>=p.min.x&&V.x<=p.max.x&&V.y>=p.min.y&&V.y<=p.max.y||Qo(F,V,v))||this.isOnBorder(F.x,V.x)||this.isOnBorder(F.y,V.y))continue;const j=In.computeEdgeHash(this.unevalVertices[C],this.unevalVertices[k]);let $,ee=this.vertexHashLookup.get(In.computePosHash(F));ee!=null?$=ee.next:(ee=this.vertexHashLookup.get(In.computePosHash(V)),$=ee!=null?ee.prev:j),this.unevalEdges.push({polygonIdx:e,a:C,b:k,hash:j,portalHash:$,isTunnel:u,type:"unevaluated",featureInfo:_})}}addPortalCandidates(e,i,s,u,p){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:p});const _=i[0];this.vertexHashLookup.clear();let v=In.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let E=0;E<_.length-1;E++){const C=_[E+0],k=_[E+1],F=ar(k.x-C.x,k.y-C.y),V=Uo(F);if(V===0)continue;let j="unevaluated";const $=u.pointElevation(C),ee=u.pointElevation(k);Math.abs($)<.01&&Math.abs(ee)<.01?j="entrance":(this.isOnBorder(C.x,k.x)||this.isOnBorder(C.y,k.y))&&(j="border");const oe=In.computeEdgeHash(C,k);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:C,vb:k,vab:F,length:V,hash:oe,isTunnel:s,type:j});const se=In.computePosHash(C);this.vertexHashLookup.set(se,{prev:v,next:oe}),v=oe}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=V=>{V.primitiveLength=this.indexArray.length-V.primitiveOffset},u=new Fn(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const p=i(),_=i(),v=i(),E=(V,j)=>{V.sort(((ee,oe)=>ee.type===j&&oe.type!==j?-1:ee.type!==j&&oe.type===j?1:0));const $=V.findIndex((ee=>ee.type!==j));return $>=0?$:V.length};let C=0;this.unevalEdges.length>0&&(C=E(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},this.tileToMeters)),s(v);const k=i(),F=i();if(this.unevalEdges.length>0){const V=this.unevalEdges.splice(C),j=E(V,"tunnel")+C;this.unevalEdges.push(...V),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:C},{min:C,max:j})}s(k),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(F),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(_),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(p),this.maskSegments=xs.simpleSegment(0,F.primitiveOffset,0,F.primitiveLength),this.depthSegments=xs.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableBridgeSegments=xs.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableTunnelSegments=xs.simpleSegment(0,k.primitiveOffset,0,k.primitiveLength),this.shadowCasterSegments=xs.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength)}update(e,i,s,u,p,_,v,E){this.bridgeProgramConfigurations.updatePaintArrays(e,i,p,s,u,_,v,E),this.tunnelProgramConfigurations.updatePaintArrays(e,i,p,s,u,_,v,E)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Jm.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,m_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,s,u,p){const _=(v,E)=>{for(let C=0;C<E.length-1;C++){const k=E[C].featureIndex,F=E[C+1].vertexStart,V=e.feature(k);v.populatePaintArrays(F,V,k,{},s,i,u,void 0,p)}};_(this.bridgeProgramConfigurations,this.bridgeFeatureSections),_(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,s,u,p){const _=new Map;for(let v=u;v<p;v++){const E=s[v],C=E.a,k=E.b,F=In.computePosHash(e[C]),V=In.computePosHash(e[k]);let j=_.get(F);j||(j={},_.set(F,j));let $=_.get(V);$||($={},_.set(V,$)),i[C]<=0&&i[k]<=0||(j.to=k,$.from=C)}return _}isTerminalVertex(e,i){const s=In.computePosHash(this.unevalVertices[e]),u=i.get(s);return!u||!u.from||!u.to}constructBridgeStructures(e,i,s,u,p,_){e.clearVertexLookup();const v=this.computeVertexConnections(i,s,u,p.min,p.max),E=1/_,C=.5*E,k=(vi,wi)=>Si(vi,i[wi].x,i[wi].y,s[wi]*E),F=an(),V=an(),j=an(),$=an(),ee=an(),oe=(vi,wi)=>{const _i=v.get(In.computePosHash(i[wi])),gi=_i.from,Zt=_i.to;if(!gi||!Zt)return;k(F,gi),k(V,wi),k(j,Zt),Yt($),Ha(F,V)||(zr(ee,V,F),Cn($,ee)),Ha(j,V)||(zr(ee,j,V),yn($,$,Cn(ee,ee)));const $t=ma($);return $t>0?ai(vi,$,1/$t):void 0};let se=Number.POSITIVE_INFINITY;this.sortSubarray(u,p.min,p.max,((vi,wi)=>vi.featureInfo.featureIndex-wi.featureInfo.featureIndex));const ge=an(),xe=an(),Ie=an(),He=an(),Ne=an(),We=an(),at=an(),ct=an(),Gt=an(),pt=[an(),an(),an(),an()],Xt=[an(),an(),an(),an()],ni=[{coord:new je(0,0),height:0},{coord:new je(0,0),height:0}],ri=(vi,wi)=>vi>wi;for(let vi=p.min;vi<p.max;vi++){const wi=u[vi];if(!wi.featureInfo.guardRailEnabled||!this.prepareEdgePoints(ni,i,s,wi,ri))continue;const[_i,gi]=ni;if(Si(ge,_i.coord.x,_i.coord.y,E*_i.height),Si(xe,gi.coord.x,gi.coord.y,E*gi.height),Ha(ge,xe))continue;zr(Ie,xe,ge),Cn(Ie,Ie);const Zt=oe(ct,wi.a)||Ie,$t=oe(Gt,wi.b)||Ie;Si(He,Zt[1],-Zt[0],0),Cn(He,He),Si(Ne,$t[1],-$t[0],0),Cn(Ne,Ne),Ir(ct,He,Zt),Cn(We,ct),Ir(ct,Ne,$t),Cn(at,ct),yn(pt[0],ge,ai(ct,zr(ct,He,We),C)),yn(pt[1],ge,ai(ct,yn(ct,He,We),C)),yn(pt[2],ge,ai(ct,We,C)),pt[3]=ge,yn(Xt[0],xe,ai(ct,zr(ct,Ne,at),C)),yn(Xt[1],xe,ai(ct,yn(ct,Ne,at),C)),yn(Xt[2],xe,ai(ct,at,C)),Xt[3]=xe,se=this.addFeatureSection(wi.featureInfo.featureIndex,se,this.bridgeFeatureSections,e);const yi=e.addVertex(pt[0],He,_),ki=e.addVertex(pt[1],He,_),Ii=e.addVertex(Xt[0],Ne,_),Dn=e.addVertex(Xt[1],Ne,_);e.addTriangle(yi,ki,Ii),e.addTriangle(ki,Dn,Ii);const tn=e.addVertex(pt[1],We,_),sn=e.addVertex(pt[2],We,_),bn=e.addVertex(Xt[1],at,_),Vr=e.addVertex(Xt[2],at,_);e.addTriangle(tn,sn,bn),e.addTriangle(sn,Vr,bn),pr(He,He),pr(Ne,Ne);const zi=e.addVertex(pt[2],He,_),wn=e.addVertex(pt[3],He,_),fr=e.addVertex(Xt[2],Ne,_),ha=e.addVertex(Xt[3],Ne,_);e.addTriangle(zi,wn,fr),e.addTriangle(wn,ha,fr);const xa=this.isTerminalVertex(wi.a,v),Ar=this.isTerminalVertex(wi.b,v);_i.height<.01&&xa&&e.addQuad(pt[3],pt[2],pt[1],pt[0],pr(Zt,Zt),_),gi.height<.01&&Ar&&e.addQuad(Xt[0],Xt[1],Xt[2],Xt[3],$t,_)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,s,u,p,_){e.clearVertexLookup();let v=Number.POSITIVE_INFINITY;const E=(se,ge)=>se.featureInfo.featureIndex-ge.featureInfo.featureIndex;this.sortSubarray(u,p.min,p.max,E),this.sortSubarray(u,_.min,_.max,E);const C=se=>Cn(se,se),k=[{coord:new je(0,0),height:0},{coord:new je(0,0),height:0}],F=(se,ge)=>se<ge,V=an(),j=an(),$=an(),ee=an(),oe=an();for(let se=p.min;se<p.max;se++){if(!this.prepareEdgePoints(k,i,s,u[se],F))continue;const[ge,xe]=k,Ie=C(Si(oe,-(xe.coord.y-ge.coord.y),xe.coord.x-ge.coord.x,0));v=this.addFeatureSection(u[se].featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Si(V,ge.coord.x,ge.coord.y,ge.height),Si(j,xe.coord.x,xe.coord.y,xe.height),Si($,xe.coord.x,xe.coord.y,u[se].isTunnel?-.1:0),Si(ee,ge.coord.x,ge.coord.y,u[se].isTunnel?-.1:0),Ie)}for(let se=_.min;se<_.max;se++){const ge=u[se];ge.isTunnel&&([ge.a,ge.b]=[ge.b,ge.a]);const xe=i[ge.a],Ie=i[ge.b],He=C(Si(oe,-(Ie.y-xe.y),Ie.x-xe.x,0));v=this.addFeatureSection(ge.featureInfo.featureIndex,v,this.tunnelFeatureSections,e),e.addQuad(Si(V,Ie.x,Ie.y,0),Si(j,xe.x,xe.y,0),Si($,xe.x,xe.y,s[ge.a]+4),Si(ee,Ie.x,Ie.y,s[ge.b]+4),He),e.addQuad(Si(V,xe.x,xe.y,0),Si(j,Ie.x,Ie.y,0),Si($,Ie.x,Ie.y,s[ge.b]+4),Si(ee,xe.x,xe.y,s[ge.a]+4),He)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,s,u){e.coord.x=i,e.coord.y=s,e.height=u}prepareEdgePoints(e,i,s,u,p){let _=i[u.a].x,v=i[u.a].y,E=i[u.b].x,C=i[u.b].y,k=s[u.a],F=s[u.b];const V=p(k,0),j=p(F,0);if(V&&j)return this.setElevatedPoint(e[0],_,v,k),this.setElevatedPoint(e[1],E,C,F),!0;if(!V&&!j)return!1;if(V){if(!j){const $=F/(F-k);E=Gn(E,_,$),C=Gn(C,v,$),F=Gn(F,k,$)}}else{const $=k/(k-F);_=Gn(_,E,$),v=Gn(v,C,$),k=Gn(k,F,$)}return this.setElevatedPoint(e[0],_,v,k),this.setElevatedPoint(e[1],E,C,F),!0}prepareEdges(e,i){if(i.length===0)return;i.sort(((v,E)=>v.hash===E.hash?E.polygonIdx-v.polygonIdx:E.hash>v.hash?1:-1));let s=0,u=0,p=0,_=i[s].polygonIdx;do u++,(u===i.length||i[s].hash!==i[u].hash)&&((u-s==1||i[u-1].polygonIdx!==_)&&(p<s&&(i[p]=i[s],i[s]=null),i[p].type="none",p++),s=u,s!==i.length&&(_=i[s].polygonIdx));while(s!==i.length);if(i.splice(p),i.length!==0&&e.length!==0){i.sort(((C,k)=>C.portalHash<k.portalHash?1:-1));let v=0,E=0;for(;v!==i.length&&E!==e.length;){const C=i[v],k=e[E];C.portalHash>k.hash?v++:k.hash>C.portalHash?E++:(C.type=k.type,v++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=pi&&i>=pi}addFeatureSection(e,i,s,u){return e!==i&&(i=e,s.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),i}sortSubarray(e,i,s,u){const p=e.slice(i,s);p.sort(u),e.splice(i,p.length,...p)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(In.computePosHash(e))<<32n|BigInt(In.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var xr,or={exports:{}},nr=(xr||(xr=1,(function(r){function e(Ue,$e){return Ue>$e?1:Ue<$e?-1:0}var i=function(Ue,$e){Ue===void 0&&(Ue=e),$e===void 0&&($e=!1),this._compare=Ue,this._root=null,this._size=0,this._noDuplicates=!!$e},s={size:{configurable:!0}};function u(Ue,$e,Wt,bi,Zi){var Xi=Zi-bi;if(Xi>0){var Pn=bi+Math.floor(Xi/2),Bn={key:$e[Pn],data:Wt[Pn],parent:Ue};return Bn.left=u(Bn,$e,Wt,bi,Pn),Bn.right=u(Bn,$e,Wt,Pn+1,Zi),Bn}return null}function p(Ue,$e,Wt,bi,Zi){if(!(Wt>=bi)){for(var Xi=Ue[Wt+bi>>1],Pn=Wt-1,Bn=bi+1;;){do Pn++;while(Zi(Ue[Pn],Xi)<0);do Bn--;while(Zi(Ue[Bn],Xi)>0);if(Pn>=Bn)break;var br=Ue[Pn];Ue[Pn]=Ue[Bn],Ue[Bn]=br,br=$e[Pn],$e[Pn]=$e[Bn],$e[Bn]=br}p(Ue,$e,Wt,Bn,Zi),p(Ue,$e,Bn+1,bi,Zi)}}i.prototype.rotateLeft=function(Ue){var $e=Ue.right;$e&&(Ue.right=$e.left,$e.left&&($e.left.parent=Ue),$e.parent=Ue.parent),Ue.parent?Ue===Ue.parent.left?Ue.parent.left=$e:Ue.parent.right=$e:this._root=$e,$e&&($e.left=Ue),Ue.parent=$e},i.prototype.rotateRight=function(Ue){var $e=Ue.left;$e&&(Ue.left=$e.right,$e.right&&($e.right.parent=Ue),$e.parent=Ue.parent),Ue.parent?Ue===Ue.parent.left?Ue.parent.left=$e:Ue.parent.right=$e:this._root=$e,$e&&($e.right=Ue),Ue.parent=$e},i.prototype._splay=function(Ue){for(;Ue.parent;){var $e=Ue.parent;$e.parent?$e.left===Ue&&$e.parent.left===$e?(this.rotateRight($e.parent),this.rotateRight($e)):$e.right===Ue&&$e.parent.right===$e?(this.rotateLeft($e.parent),this.rotateLeft($e)):$e.left===Ue&&$e.parent.right===$e?(this.rotateRight($e),this.rotateLeft($e)):(this.rotateLeft($e),this.rotateRight($e)):$e.left===Ue?this.rotateRight($e):this.rotateLeft($e)}},i.prototype.splay=function(Ue){for(var $e,Wt,bi,Zi,Xi;Ue.parent;)(Wt=($e=Ue.parent).parent)&&Wt.parent?((bi=Wt.parent).left===Wt?bi.left=Ue:bi.right=Ue,Ue.parent=bi):(Ue.parent=null,this._root=Ue),Zi=Ue.left,Xi=Ue.right,Ue===$e.left?(Wt&&(Wt.left===$e?($e.right?(Wt.left=$e.right,Wt.left.parent=Wt):Wt.left=null,$e.right=Wt,Wt.parent=$e):(Zi?(Wt.right=Zi,Zi.parent=Wt):Wt.right=null,Ue.left=Wt,Wt.parent=Ue)),Xi?($e.left=Xi,Xi.parent=$e):$e.left=null,Ue.right=$e,$e.parent=Ue):(Wt&&(Wt.right===$e?($e.left?(Wt.right=$e.left,Wt.right.parent=Wt):Wt.right=null,$e.left=Wt,Wt.parent=$e):(Xi?(Wt.left=Xi,Xi.parent=Wt):Wt.left=null,Ue.right=Wt,Wt.parent=Ue)),Zi?($e.right=Zi,Zi.parent=$e):$e.right=null,Ue.left=$e,$e.parent=Ue)},i.prototype.replace=function(Ue,$e){Ue.parent?Ue===Ue.parent.left?Ue.parent.left=$e:Ue.parent.right=$e:this._root=$e,$e&&($e.parent=Ue.parent)},i.prototype.minNode=function(Ue){if(Ue===void 0&&(Ue=this._root),Ue)for(;Ue.left;)Ue=Ue.left;return Ue},i.prototype.maxNode=function(Ue){if(Ue===void 0&&(Ue=this._root),Ue)for(;Ue.right;)Ue=Ue.right;return Ue},i.prototype.insert=function(Ue,$e){var Wt=this._root,bi=null,Zi=this._compare;if(this._noDuplicates)for(;Wt;){if(bi=Wt,Zi(Wt.key,Ue)===0)return;Wt=Zi(Wt.key,Ue)<0?Wt.right:Wt.left}else for(;Wt;)bi=Wt,Wt=Zi(Wt.key,Ue)<0?Wt.right:Wt.left;return Wt={key:Ue,data:$e,left:null,right:null,parent:bi},bi?Zi(bi.key,Wt.key)<0?bi.right=Wt:bi.left=Wt:this._root=Wt,this.splay(Wt),this._size++,Wt},i.prototype.find=function(Ue){for(var $e=this._root,Wt=this._compare;$e;){var bi=Wt($e.key,Ue);if(bi<0)$e=$e.right;else{if(!(bi>0))return $e;$e=$e.left}}return null},i.prototype.contains=function(Ue){for(var $e=this._root,Wt=this._compare;$e;){var bi=Wt(Ue,$e.key);if(bi===0)return!0;$e=bi<0?$e.left:$e.right}return!1},i.prototype.remove=function(Ue){var $e=this.find(Ue);if(!$e)return!1;if(this.splay($e),$e.left)if($e.right){var Wt=this.minNode($e.right);Wt.parent!==$e&&(this.replace(Wt,Wt.right),Wt.right=$e.right,Wt.right.parent=Wt),this.replace($e,Wt),Wt.left=$e.left,Wt.left.parent=Wt}else this.replace($e,$e.left);else this.replace($e,$e.right);return this._size--,!0},i.prototype.removeNode=function(Ue){if(!Ue)return!1;if(this.splay(Ue),Ue.left)if(Ue.right){var $e=this.minNode(Ue.right);$e.parent!==Ue&&(this.replace($e,$e.right),$e.right=Ue.right,$e.right.parent=$e),this.replace(Ue,$e),$e.left=Ue.left,$e.left.parent=$e}else this.replace(Ue,Ue.left);else this.replace(Ue,Ue.right);return this._size--,!0},i.prototype.erase=function(Ue){var $e=this.find(Ue);if($e){this.splay($e);var Wt=$e.left,bi=$e.right,Zi=null;Wt&&(Wt.parent=null,Zi=this.maxNode(Wt),this.splay(Zi),this._root=Zi),bi&&(Wt?Zi.right=bi:this._root=bi,bi.parent=Zi),this._size--}},i.prototype.pop=function(){var Ue=this._root,$e=null;if(Ue){for(;Ue.left;)Ue=Ue.left;$e={key:Ue.key,data:Ue.data},this.remove(Ue.key)}return $e},i.prototype.next=function(Ue){var $e=Ue;if($e)if($e.right)for($e=$e.right;$e&&$e.left;)$e=$e.left;else for($e=Ue.parent;$e&&$e.right===Ue;)Ue=$e,$e=$e.parent;return $e},i.prototype.prev=function(Ue){var $e=Ue;if($e)if($e.left)for($e=$e.left;$e&&$e.right;)$e=$e.right;else for($e=Ue.parent;$e&&$e.left===Ue;)Ue=$e,$e=$e.parent;return $e},i.prototype.forEach=function(Ue){for(var $e=this._root,Wt=[],bi=!1,Zi=0;!bi;)$e?(Wt.push($e),$e=$e.left):Wt.length>0?(Ue($e=Wt.pop(),Zi++),$e=$e.right):bi=!0;return this},i.prototype.range=function(Ue,$e,Wt,bi){for(var Zi=[],Xi=this._compare,Pn=this._root;Zi.length!==0||Pn;)if(Pn)Zi.push(Pn),Pn=Pn.left;else{if(Xi((Pn=Zi.pop()).key,$e)>0)break;if(Xi(Pn.key,Ue)>=0&&Wt.call(bi,Pn))return this;Pn=Pn.right}return this},i.prototype.keys=function(){for(var Ue=this._root,$e=[],Wt=[],bi=!1;!bi;)Ue?($e.push(Ue),Ue=Ue.left):$e.length>0?(Ue=$e.pop(),Wt.push(Ue.key),Ue=Ue.right):bi=!0;return Wt},i.prototype.values=function(){for(var Ue=this._root,$e=[],Wt=[],bi=!1;!bi;)Ue?($e.push(Ue),Ue=Ue.left):$e.length>0?(Ue=$e.pop(),Wt.push(Ue.data),Ue=Ue.right):bi=!0;return Wt},i.prototype.at=function(Ue){for(var $e=this._root,Wt=[],bi=!1,Zi=0;!bi;)if($e)Wt.push($e),$e=$e.left;else if(Wt.length>0){if($e=Wt.pop(),Zi===Ue)return $e;Zi++,$e=$e.right}else bi=!0;return null},i.prototype.load=function(Ue,$e,Wt){if(Ue===void 0&&(Ue=[]),$e===void 0&&($e=[]),Wt===void 0&&(Wt=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var bi=Ue.length;return Wt&&p(Ue,$e,0,bi-1,this._compare),this._root=u(null,Ue,$e,0,bi),this._size=bi,this},i.prototype.min=function(){var Ue=this.minNode(this._root);return Ue?Ue.key:null},i.prototype.max=function(){var Ue=this.maxNode(this._root);return Ue?Ue.key:null},i.prototype.isEmpty=function(){return this._root===null},s.size.get=function(){return this._size},i.createTree=function(Ue,$e,Wt,bi,Zi){return new i(Wt,Zi).load(Ue,$e,bi)},Object.defineProperties(i.prototype,s);var _=0,v=1,E=2,C=3,k=0,F=1,V=2,j=3;function $(Ue,$e,Wt){$e===null?(Ue.inOut=!1,Ue.otherInOut=!0):(Ue.isSubject===$e.isSubject?(Ue.inOut=!$e.inOut,Ue.otherInOut=$e.otherInOut):(Ue.inOut=!$e.otherInOut,Ue.otherInOut=$e.isVertical()?!$e.inOut:$e.inOut),$e&&(Ue.prevInResult=!ee($e,Wt)||$e.isVertical()?$e.prevInResult:$e));var bi=ee(Ue,Wt);Ue.resultTransition=bi?(function(Zi,Xi){var Pn,Bn=!Zi.inOut,br=!Zi.otherInOut;switch(Xi){case k:Pn=Bn&&br;break;case F:Pn=Bn||br;break;case j:Pn=Bn^br;break;case V:Pn=Zi.isSubject?Bn&&!br:br&&!Bn}return Pn?1:-1})(Ue,Wt):0}function ee(Ue,$e){switch(Ue.type){case _:switch($e){case k:return!Ue.otherInOut;case F:return Ue.otherInOut;case V:return Ue.isSubject&&Ue.otherInOut||!Ue.isSubject&&!Ue.otherInOut;case j:return!0}break;case E:return $e===k||$e===F;case C:return $e===V;case v:return!1}return!1}var oe=function(Ue,$e,Wt,bi,Zi){this.left=$e,this.point=Ue,this.otherEvent=Wt,this.isSubject=bi,this.type=Zi||_,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},se={inResult:{configurable:!0}};function ge(Ue,$e){return Ue[0]===$e[0]&&Ue[1]===$e[1]}oe.prototype.isBelow=function(Ue){var $e=this.point,Wt=this.otherEvent.point;return this.left?($e[0]-Ue[0])*(Wt[1]-Ue[1])-(Wt[0]-Ue[0])*($e[1]-Ue[1])>0:(Wt[0]-Ue[0])*($e[1]-Ue[1])-($e[0]-Ue[0])*(Wt[1]-Ue[1])>0},oe.prototype.isAbove=function(Ue){return!this.isBelow(Ue)},oe.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},se.inResult.get=function(){return this.resultTransition!==0},oe.prototype.clone=function(){var Ue=new oe(this.point,this.left,this.otherEvent,this.isSubject,this.type);return Ue.contourId=this.contourId,Ue.resultTransition=this.resultTransition,Ue.prevInResult=this.prevInResult,Ue.isExteriorRing=this.isExteriorRing,Ue.inOut=this.inOut,Ue.otherInOut=this.otherInOut,Ue},Object.defineProperties(oe.prototype,se);var xe=11102230246251565e-32,Ie=134217729,He=(3+8*xe)*xe;function Ne(Ue,$e,Wt,bi,Zi){var Xi,Pn,Bn,br,Lr=$e[0],Nr=bi[0],sa=0,er=0;Nr>Lr==Nr>-Lr?(Xi=Lr,Lr=$e[++sa]):(Xi=Nr,Nr=bi[++er]);var ur=0;if(sa<Ue&&er<Wt)for(Nr>Lr==Nr>-Lr?(Bn=Xi-((Pn=Lr+Xi)-Lr),Lr=$e[++sa]):(Bn=Xi-((Pn=Nr+Xi)-Nr),Nr=bi[++er]),Xi=Pn,Bn!==0&&(Zi[ur++]=Bn);sa<Ue&&er<Wt;)Nr>Lr==Nr>-Lr?(Bn=Xi-((Pn=Xi+Lr)-(br=Pn-Xi))+(Lr-br),Lr=$e[++sa]):(Bn=Xi-((Pn=Xi+Nr)-(br=Pn-Xi))+(Nr-br),Nr=bi[++er]),Xi=Pn,Bn!==0&&(Zi[ur++]=Bn);for(;sa<Ue;)Bn=Xi-((Pn=Xi+Lr)-(br=Pn-Xi))+(Lr-br),Lr=$e[++sa],Xi=Pn,Bn!==0&&(Zi[ur++]=Bn);for(;er<Wt;)Bn=Xi-((Pn=Xi+Nr)-(br=Pn-Xi))+(Nr-br),Nr=bi[++er],Xi=Pn,Bn!==0&&(Zi[ur++]=Bn);return Xi===0&&ur!==0||(Zi[ur++]=Xi),ur}function We(Ue){return new Float64Array(Ue)}var at=33306690738754716e-32,ct=22204460492503146e-32,Gt=11093356479670487e-47,pt=We(4),Xt=We(8),ni=We(12),ri=We(16),vi=We(4);function wi(Ue,$e,Wt){var bi=(function(Zi,Xi,Pn,Bn,br,Lr){var Nr=(Xi-Lr)*(Pn-br),sa=(Zi-br)*(Bn-Lr),er=Nr-sa;if(Nr===0||sa===0||Nr>0!=sa>0)return er;var ur=Math.abs(Nr+sa);return Math.abs(er)>=at*ur?er:-(function(Ea,Ca,za,Ya,us,is,Pa){var Va,kr,pa,to,Yn,oa,as,gs,Ps,Fo,Es,Kn,ro,Ka,Xs,Il,oc,ll,cl=Ea-us,Zl=za-us,Kh=Ca-is,As=Ya-is;pt[0]=(Xs=(gs=cl-(as=(oa=Ie*cl)-(oa-cl)))*(Fo=As-(Ps=(oa=Ie*As)-(oa-As)))-((Ka=cl*As)-as*Ps-gs*Ps-as*Fo))-((Es=Xs-(oc=(gs=Kh-(as=(oa=Ie*Kh)-(oa-Kh)))*(Fo=Zl-(Ps=(oa=Ie*Zl)-(oa-Zl)))-((Il=Kh*Zl)-as*Ps-gs*Ps-as*Fo)))+(Yn=Xs-Es))+(Yn-oc),pt[1]=(ro=Ka-((Kn=Ka+Es)-(Yn=Kn-Ka))+(Es-Yn))-((Es=ro-Il)+(Yn=ro-Es))+(Yn-Il),pt[2]=Kn-((ll=Kn+Es)-(Yn=ll-Kn))+(Es-Yn),pt[3]=ll;var zo=(function(Pm,su){for(var Ah=su[0],qd=1;qd<4;qd++)Ah+=su[qd];return Ah})(0,pt),No=ct*Pa;if(zo>=No||-zo>=No||(Va=Ea-(cl+(Yn=Ea-cl))+(Yn-us),pa=za-(Zl+(Yn=za-Zl))+(Yn-us),kr=Ca-(Kh+(Yn=Ca-Kh))+(Yn-is),to=Ya-(As+(Yn=Ya-As))+(Yn-is),Va===0&&kr===0&&pa===0&&to===0)||(No=Gt*Pa+He*Math.abs(zo),(zo+=cl*to+As*Va-(Kh*pa+Zl*kr))>=No||-zo>=No))return zo;vi[0]=(Xs=(gs=Va-(as=(oa=Ie*Va)-(oa-Va)))*(Fo=As-(Ps=(oa=Ie*As)-(oa-As)))-((Ka=Va*As)-as*Ps-gs*Ps-as*Fo))-((Es=Xs-(oc=(gs=kr-(as=(oa=Ie*kr)-(oa-kr)))*(Fo=Zl-(Ps=(oa=Ie*Zl)-(oa-Zl)))-((Il=kr*Zl)-as*Ps-gs*Ps-as*Fo)))+(Yn=Xs-Es))+(Yn-oc),vi[1]=(ro=Ka-((Kn=Ka+Es)-(Yn=Kn-Ka))+(Es-Yn))-((Es=ro-Il)+(Yn=ro-Es))+(Yn-Il),vi[2]=Kn-((ll=Kn+Es)-(Yn=ll-Kn))+(Es-Yn),vi[3]=ll;var Td=Ne(4,pt,4,vi,Xt);vi[0]=(Xs=(gs=cl-(as=(oa=Ie*cl)-(oa-cl)))*(Fo=to-(Ps=(oa=Ie*to)-(oa-to)))-((Ka=cl*to)-as*Ps-gs*Ps-as*Fo))-((Es=Xs-(oc=(gs=Kh-(as=(oa=Ie*Kh)-(oa-Kh)))*(Fo=pa-(Ps=(oa=Ie*pa)-(oa-pa)))-((Il=Kh*pa)-as*Ps-gs*Ps-as*Fo)))+(Yn=Xs-Es))+(Yn-oc),vi[1]=(ro=Ka-((Kn=Ka+Es)-(Yn=Kn-Ka))+(Es-Yn))-((Es=ro-Il)+(Yn=ro-Es))+(Yn-Il),vi[2]=Kn-((ll=Kn+Es)-(Yn=ll-Kn))+(Es-Yn),vi[3]=ll;var Ml=Ne(Td,Xt,4,vi,ni);vi[0]=(Xs=(gs=Va-(as=(oa=Ie*Va)-(oa-Va)))*(Fo=to-(Ps=(oa=Ie*to)-(oa-to)))-((Ka=Va*to)-as*Ps-gs*Ps-as*Fo))-((Es=Xs-(oc=(gs=kr-(as=(oa=Ie*kr)-(oa-kr)))*(Fo=pa-(Ps=(oa=Ie*pa)-(oa-pa)))-((Il=kr*pa)-as*Ps-gs*Ps-as*Fo)))+(Yn=Xs-Es))+(Yn-oc),vi[1]=(ro=Ka-((Kn=Ka+Es)-(Yn=Kn-Ka))+(Es-Yn))-((Es=ro-Il)+(Yn=ro-Es))+(Yn-Il),vi[2]=Kn-((ll=Kn+Es)-(Yn=ll-Kn))+(Es-Yn),vi[3]=ll;var Tp=Ne(Ml,ni,4,vi,ri);return ri[Tp-1]})(Zi,Xi,Pn,Bn,br,Lr,ur)})(Ue[0],Ue[1],$e[0],$e[1],Wt[0],Wt[1]);return bi>0?-1:bi<0?1:0}function _i(Ue,$e){var Wt=Ue.point,bi=$e.point;return Wt[0]>bi[0]?1:Wt[0]<bi[0]?-1:Wt[1]!==bi[1]?Wt[1]>bi[1]?1:-1:(function(Zi,Xi,Pn,Bn){return Zi.left!==Xi.left?Zi.left?1:-1:wi(Pn,Zi.otherEvent.point,Xi.otherEvent.point)!==0?Zi.isBelow(Xi.otherEvent.point)?-1:1:!Zi.isSubject&&Xi.isSubject?1:-1})(Ue,$e,Wt)}function gi(Ue,$e,Wt){var bi=new oe($e,!1,Ue,Ue.isSubject),Zi=new oe($e,!0,Ue.otherEvent,Ue.isSubject);return ge(Ue.point,Ue.otherEvent.point)&&console.warn("what is that, a collapsed segment?",Ue),bi.contourId=Zi.contourId=Ue.contourId,_i(Zi,Ue.otherEvent)>0&&(Ue.otherEvent.left=!0,Zi.left=!1),Ue.otherEvent.otherEvent=Zi,Ue.otherEvent=bi,Wt.push(Zi),Wt.push(bi),Wt}function Zt(Ue,$e){return Ue[0]*$e[1]-Ue[1]*$e[0]}function $t(Ue,$e){return Ue[0]*$e[0]+Ue[1]*$e[1]}function yi(Ue,$e,Wt){var bi=(function(br,Lr,Nr,sa,er){var ur=[Lr[0]-br[0],Lr[1]-br[1]],Ea=[sa[0]-Nr[0],sa[1]-Nr[1]];function Ca(oa,as,gs){return[oa[0]+as*gs[0],oa[1]+as*gs[1]]}var za=[Nr[0]-br[0],Nr[1]-br[1]],Ya=Zt(ur,Ea),us=Ya*Ya,is=$t(ur,ur);if(us>0){var Pa=Zt(za,Ea)/Ya;if(Pa<0||Pa>1)return null;var Va=Zt(za,ur)/Ya;return Va<0||Va>1?null:Pa===0||Pa===1?[Ca(br,Pa,ur)]:Va===0||Va===1?[Ca(Nr,Va,Ea)]:[Ca(br,Pa,ur)]}if((us=(Ya=Zt(za,ur))*Ya)>0)return null;var kr=$t(ur,za)/is,pa=kr+$t(ur,Ea)/is,to=Math.min(kr,pa),Yn=Math.max(kr,pa);return to<=1&&Yn>=0?to===1?[Ca(br,to>0?to:0,ur)]:Yn===0?[Ca(br,Yn<1?Yn:1,ur)]:[Ca(br,to>0?to:0,ur),Ca(br,Yn<1?Yn:1,ur)]:null})(Ue.point,Ue.otherEvent.point,$e.point,$e.otherEvent.point),Zi=bi?bi.length:0;if(Zi===0||Zi===1&&(ge(Ue.point,$e.point)||ge(Ue.otherEvent.point,$e.otherEvent.point))||Zi===2&&Ue.isSubject===$e.isSubject)return 0;if(Zi===1)return ge(Ue.point,bi[0])||ge(Ue.otherEvent.point,bi[0])||gi(Ue,bi[0],Wt),ge($e.point,bi[0])||ge($e.otherEvent.point,bi[0])||gi($e,bi[0],Wt),1;var Xi=[],Pn=!1,Bn=!1;return ge(Ue.point,$e.point)?Pn=!0:_i(Ue,$e)===1?Xi.push($e,Ue):Xi.push(Ue,$e),ge(Ue.otherEvent.point,$e.otherEvent.point)?Bn=!0:_i(Ue.otherEvent,$e.otherEvent)===1?Xi.push($e.otherEvent,Ue.otherEvent):Xi.push(Ue.otherEvent,$e.otherEvent),Pn&&Bn||Pn?($e.type=v,Ue.type=$e.inOut===Ue.inOut?E:C,Pn&&!Bn&&gi(Xi[1].otherEvent,Xi[0].point,Wt),2):Bn?(gi(Xi[0],Xi[1].point,Wt),3):Xi[0]!==Xi[3].otherEvent?(gi(Xi[0],Xi[1].point,Wt),gi(Xi[1],Xi[2].point,Wt),3):(gi(Xi[0],Xi[1].point,Wt),gi(Xi[3].otherEvent,Xi[2].point,Wt),3)}function ki(Ue,$e){if(Ue===$e)return 0;if(wi(Ue.point,Ue.otherEvent.point,$e.point)!==0||wi(Ue.point,Ue.otherEvent.point,$e.otherEvent.point)!==0)return ge(Ue.point,$e.point)?Ue.isBelow($e.otherEvent.point)?-1:1:Ue.point[0]===$e.point[0]?Ue.point[1]<$e.point[1]?-1:1:_i(Ue,$e)===1?$e.isAbove(Ue.point)?-1:1:Ue.isBelow($e.point)?-1:1;if(Ue.isSubject!==$e.isSubject)return Ue.isSubject?-1:1;var Wt=Ue.point,bi=$e.point;return Wt[0]===bi[0]&&Wt[1]===bi[1]?(Wt=Ue.otherEvent.point)[0]===(bi=$e.otherEvent.point)[0]&&Wt[1]===bi[1]?0:Ue.contourId>$e.contourId?1:-1:_i(Ue,$e)===1?1:-1}var Ii=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Dn(Ue,$e,Wt,bi){var Zi,Xi=Ue+1,Pn=$e[Ue].point,Bn=$e.length;for(Xi<Bn&&(Zi=$e[Xi].point);Xi<Bn&&Zi[0]===Pn[0]&&Zi[1]===Pn[1];){if(!Wt[Xi])return Xi;++Xi<Bn&&(Zi=$e[Xi].point)}for(Xi=Ue-1;Wt[Xi]&&Xi>bi;)Xi--;return Xi}Ii.prototype.isExterior=function(){return this.holeOf==null};var tn=bn,sn=bn;function bn(Ue,$e){if(!(this instanceof bn))return new bn(Ue,$e);if(this.data=Ue||[],this.length=this.data.length,this.compare=$e||Vr,this.length>0)for(var Wt=(this.length>>1)-1;Wt>=0;Wt--)this._down(Wt)}function Vr(Ue,$e){return Ue<$e?-1:Ue>$e?1:0}bn.prototype={push:function(Ue){this.data.push(Ue),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var Ue=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),Ue}},peek:function(){return this.data[0]},_up:function(Ue){for(var $e=this.data,Wt=this.compare,bi=$e[Ue];Ue>0;){var Zi=Ue-1>>1,Xi=$e[Zi];if(Wt(bi,Xi)>=0)break;$e[Ue]=Xi,Ue=Zi}$e[Ue]=bi},_down:function(Ue){for(var $e=this.data,Wt=this.compare,bi=this.length>>1,Zi=$e[Ue];Ue<bi;){var Xi=1+(Ue<<1),Pn=Xi+1,Bn=$e[Xi];if(Pn<this.length&&Wt($e[Pn],Bn)<0&&(Xi=Pn,Bn=$e[Pn]),Wt(Bn,Zi)>=0)break;$e[Ue]=Bn,Ue=Xi}$e[Ue]=Zi}},tn.default=sn;var zi=Math.max,wn=Math.min,fr=0;function ha(Ue,$e,Wt,bi,Zi,Xi){var Pn,Bn,br,Lr,Nr,sa;for(Pn=0,Bn=Ue.length-1;Pn<Bn;Pn++)if(Lr=Ue[Pn+1],Nr=new oe(br=Ue[Pn],!1,void 0,$e),sa=new oe(Lr,!1,Nr,$e),Nr.otherEvent=sa,br[0]!==Lr[0]||br[1]!==Lr[1]){Nr.contourId=sa.contourId=Wt,Xi||(Nr.isExteriorRing=!1,sa.isExteriorRing=!1),_i(Nr,sa)>0?sa.left=!0:Nr.left=!0;var er=br[0],ur=br[1];Zi[0]=wn(Zi[0],er),Zi[1]=wn(Zi[1],ur),Zi[2]=zi(Zi[2],er),Zi[3]=zi(Zi[3],ur),bi.push(Nr),bi.push(sa)}}var xa=[];function Ar(Ue,$e,Wt){typeof Ue[0][0][0]=="number"&&(Ue=[Ue]),typeof $e[0][0][0]=="number"&&($e=[$e]);var bi=(function(ur,Ea,Ca){var za=null;return ur.length*Ea.length==0&&(Ca===k?za=xa:Ca===V?za=ur:Ca!==F&&Ca!==j||(za=ur.length===0?Ea:ur)),za})(Ue,$e,Wt);if(bi)return bi===xa?null:bi;var Zi=[1/0,1/0,-1/0,-1/0],Xi=[1/0,1/0,-1/0,-1/0],Pn=(function(ur,Ea,Ca,za,Ya){var us,is,Pa,Va,kr,pa,to=new tn(null,_i);for(Pa=0,Va=ur.length;Pa<Va;Pa++)for(kr=0,pa=(us=ur[Pa]).length;kr<pa;kr++)(is=kr===0)&&fr++,ha(us[kr],!0,fr,to,Ca,is);for(Pa=0,Va=Ea.length;Pa<Va;Pa++)for(kr=0,pa=(us=Ea[Pa]).length;kr<pa;kr++)is=kr===0,Ya===V&&(is=!1),is&&fr++,ha(us[kr],!1,fr,to,za,is);return to})(Ue,$e,Zi,Xi,Wt);if(bi=(function(ur,Ea,Ca,za,Ya){var us=null;return(Ca[0]>za[2]||za[0]>Ca[2]||Ca[1]>za[3]||za[1]>Ca[3])&&(Ya===k?us=xa:Ya===V?us=ur:Ya!==F&&Ya!==j||(us=ur.concat(Ea))),us})(Ue,$e,Zi,Xi,Wt))return bi===xa?null:bi;for(var Bn=(function(ur){var Ea,Ca,za=(function(Pa){var Va,kr,pa,to,Yn=[];for(kr=0,pa=Pa.length;kr<pa;kr++)((Va=Pa[kr]).left&&Va.inResult||!Va.left&&Va.otherEvent.inResult)&&Yn.push(Va);for(var oa=!1;!oa;)for(oa=!0,kr=0,pa=Yn.length;kr<pa;kr++)kr+1<pa&&_i(Yn[kr],Yn[kr+1])===1&&(to=Yn[kr],Yn[kr]=Yn[kr+1],Yn[kr+1]=to,oa=!1);for(kr=0,pa=Yn.length;kr<pa;kr++)(Va=Yn[kr]).otherPos=kr;for(kr=0,pa=Yn.length;kr<pa;kr++)(Va=Yn[kr]).left||(to=Va.otherPos,Va.otherPos=Va.otherEvent.otherPos,Va.otherEvent.otherPos=to);return Yn})(ur),Ya={},us=[],is=function(){if(!Ya[Ea]){var Pa=us.length,Va=(function(Yn,oa,as){var gs=new Ii;if(Yn.prevInResult!=null){var Ps=Yn.prevInResult,Fo=Ps.outputContourId;if(Ps.resultTransition>0){var Es=oa[Fo];if(Es.holeOf!=null){var Kn=Es.holeOf;oa[Kn].holeIds.push(as),gs.holeOf=Kn,gs.depth=oa[Fo].depth}else oa[Fo].holeIds.push(as),gs.holeOf=Fo,gs.depth=oa[Fo].depth+1}else gs.holeOf=null,gs.depth=oa[Fo].depth}else gs.holeOf=null,gs.depth=0;return gs})(za[Ea],us,Pa),kr=function(Yn){Ya[Yn]=!0,Yn<za.length&&za[Yn]&&(za[Yn].outputContourId=Pa)},pa=Ea,to=Ea;for(Va.points.push(za[Ea].point);kr(pa),kr(pa=za[pa].otherPos),Va.points.push(za[pa].point),!((pa=Dn(pa,za,Ya,to))==to||pa>=za.length)&&za[pa];);us.push(Va)}};for(Ea=0,Ca=za.length;Ea<Ca;Ea++)is();return us})((function(ur,Ea,Ca,za,Ya,us){for(var is,Pa,Va,kr=new i(ki),pa=[],to=Math.min(za[2],Ya[2]);ur.length!==0;){var Yn=ur.pop();if(pa.push(Yn),us===k&&Yn.point[0]>to||us===V&&Yn.point[0]>za[2])break;if(Yn.left){Pa=is=kr.insert(Yn),is=is!==(Va=kr.minNode())?kr.prev(is):null,Pa=kr.next(Pa);var oa=is?is.key:null;if($(Yn,oa,us),Pa&&yi(Yn,Pa.key,ur)===2&&($(Yn,oa,us),$(Pa.key,Yn,us)),is&&yi(is.key,Yn,ur)===2){var as=is;$(oa,(as=as!==Va?kr.prev(as):null)?as.key:null,us),$(Yn,oa,us)}}else Pa=is=kr.find(Yn=Yn.otherEvent),is&&Pa&&(is=is!==Va?kr.prev(is):null,Pa=kr.next(Pa),kr.remove(Yn),Pa&&is&&yi(is.key,Pa.key,ur))}return pa})(Pn,0,0,Zi,Xi,Wt)),br=[],Lr=0;Lr<Bn.length;Lr++){var Nr=Bn[Lr];if(Nr.isExterior()){for(var sa=[Nr.points],er=0;er<Nr.holeIds.length;er++)sa.push(Bn[Nr.holeIds[er]].points);br.push(sa)}}return br}var ts={UNION:F,DIFFERENCE:V,INTERSECTION:k,XOR:j};r.diff=function(Ue,$e){return Ar(Ue,$e,V)},r.intersection=function(Ue,$e){return Ar(Ue,$e,k)},r.operations=ts,r.union=function(Ue,$e){return Ar(Ue,$e,F)},r.xor=function(Ue,$e){return Ar(Ue,$e,j)},Object.defineProperty(r,"__esModule",{value:!0})})(or.exports)),or.exports);function Gi(r,e,i,s){const u=[],p=s===0?(_,v,E,C,k,F)=>{_.push(new je(F,E+(F-v)/(C-v)*(k-E)))}:(_,v,E,C,k,F)=>{_.push(new je(v+(F-E)/(k-E)*(C-v),F))};for(const _ of r){const v=[];for(const E of _){if(E.length<=2)continue;const C=[];for(let V=0;V<E.length-1;V++){const j=E[V].x,$=E[V].y,ee=E[V+1].x,oe=E[V+1].y,se=s===0?j:$,ge=s===0?ee:oe;se<e?ge>e&&p(C,j,$,ee,oe,e):se>i?ge<i&&p(C,j,$,ee,oe,i):C.push(E[V]),ge<e&&se>=e&&p(C,j,$,ee,oe,e),ge>i&&se<=i&&p(C,j,$,ee,oe,i)}let k=E[E.length-1];const F=s===0?k.x:k.y;F>=e&&F<=i&&C.push(k),C.length&&(k=C[C.length-1],C[0].x===k.x&&C[0].y===k.y||C.push(C[0]),v.push(C))}v.length&&u.push(v)}return u}function sr(r,e){const i=ia(r),s=ia([e]),u=nr.intersection(i,s);return u==null?[]:ms(u)}function vr(r,e){let s=ia(r,65536);const u=[];for(;e.valid();e.next()){const[p,_]=e.get(),v=p.x*65536,E=p.y*65536,C=_.x*65536,k=_.y*65536,F=C-v,V=k-E,j=Math.hypot(F,V);if(j===0)continue;const $=Math.trunc(V/j*3),ee=-Math.trunc(F/j*3);u.push([[[v,E],[C,k],[C+$,k+ee],[v+$,E+ee],[v,E]]])}return u.length>0&&(s=nr.diff(s,u)),ms(s,1/65536)}function ia(r,e=1){return[r.map((i=>i.map((s=>[s.x*e,s.y*e]))))]}function ms(r,e=1){return r.map((i=>i.map(((s,u)=>{const p=s.map((_=>new je(_[0]*e,_[1]*e).round()));return u>0&&p.reverse(),p}))))}class eo{constructor(e,i){this.layoutVertexArray=new hf,this.indexArray=new ao,this.lineIndexArray=new Tu,this.triangleSegments=new xs,this.lineSegments=new xs,this.programConfigurations=new yh(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Zh)}update(e,i,s,u,p,_,v,E){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,v,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Yp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Km.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,s,u,p,_,v){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,s,u,p,_,void 0,v)}}class Sl{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new eo(e,!1),this.elevationBufferData=new eo(e,!0),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){this.hasPattern=Pi("fill",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:v,id:E,index:C,sourceLayerIndex:k}of e){const F=this.layers[0]._featureFilter.needGeometry,V=ft(v,F);if(!this.layers[0]._featureFilter.filter(new Xa(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),V,s))continue;const j=p?p.evaluate(V,{},s,i.availableImages):void 0,$={id:E,properties:v.properties,type:v.type,sourceLayerIndex:k,index:C,geometry:F?V.geometry:it(v,s,u),patterns:{},sortKey:j};_.push($)}p&&_.sort(((v,E)=>v.sortKey-E.sortKey));for(const v of _){const{geometry:E,index:C,sourceLayerIndex:k}=v;if(this.hasPattern){const F=gn("fill",this.layers,v,this.zoom,this.pixelRatio,i);this.patternFeatures.push(F)}else this.addFeature(v,E,C,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[C].feature,E,C,k,this.index)}}update(e,i,s,u,p,_,v){this.bufferData.update(e,i,s,u,p,_,v,this.worldview),this.elevationBufferData.update(e,i,s,u,p,_,v,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,s,u,p,_,v,this.worldview)}addFeatures(e,i,s,u,p,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,s,u,_,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,s,u,p,_=[],v,E){const C=si(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,C,u,s,E):this.addGeometry(C,this.bufferData),this.bufferData.populatePaintArrays(e,s,p,_,u,v,this.worldview),this.elevationBufferData.populatePaintArrays(e,s,p,_,u,v,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,s,u,p){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,s,u,p,this.worldview))}addElevatedRoadFeature(e,i,s,u,p){const _=new Array,v=yr.getElevationFeature(e,p);if(!v)return void this.addGeometry(i,this.bufferData);{const C=this.clipPolygonsToTile(i,1);C.length>0&&_.push({polygons:C,elevationFeature:v,elevationTileID:s})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},s),featureIndex:u};for(const C of _)if(C.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new In(C.elevationTileID,this.layers,this.zoom,this.lut));const F=C.elevationFeature.isTunnel();let V=0;e.properties.hasOwnProperty(Dt)&&(V=+e.properties[Dt]);for(const j of C.polygons)this.elevatedStructures.addPortalCandidates(C.elevationFeature.id,j,F,C.elevationFeature,V)}C.elevationFeature.constantHeight==null&&(C.polygons=this.prepareElevatedPolygons(C.polygons,C.elevationFeature,C.elevationTileID));const k=new Gr(s,C.elevationTileID);this.addElevatedGeometry(C.polygons,k,C.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,E)}}addElevatedGeometry(e,i,s,u,p,_){const v={elevation:s,elevationSampler:i,bias:u,index:p,featureInfo:_},[E,C]=this.addGeometry(e,this.elevationBufferData,v);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:C}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,C))}addGeometry(e,i,s){let u=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,_=null;s&&(_=s.elevationSampler.constantElevation(s.elevation,s.bias),_!=null&&(u=_,p=_));const v=(E,C,k)=>{if(s!=null)if(C.push(E),_!=null)i.elevatedLayoutVertexArray.emplaceBack(_),k.push(_);else{const F=s.elevationSampler.pointElevation(E,s.elevation,s.bias);i.elevatedLayoutVertexArray.emplaceBack(F),k.push(F),u=Math.min(u,F),p=Math.max(p,F)}};for(const E of e){let C=0;for(const xe of E)C+=xe.length;const k=i.triangleSegments.prepareSegment(C,i.layoutVertexArray,i.indexArray),F=k.vertexLength,V=[],j=[],$=[],ee=[],oe=[],se=i.layoutVertexArray.length;for(const xe of E){if(xe.length===0)continue;xe!==E[0]&&j.push(V.length/2);const Ie=i.lineSegments.prepareSegment(xe.length,i.layoutVertexArray,i.lineIndexArray),He=Ie.vertexLength;s&&oe.push(i.layoutVertexArray.length-se),v(xe[0],$,ee),i.layoutVertexArray.emplaceBack(xe[0].x,xe[0].y),i.lineIndexArray.emplaceBack(He+xe.length-1,He),V.push(xe[0].x),V.push(xe[0].y);for(let Ne=1;Ne<xe.length;Ne++)v(xe[Ne],$,ee),i.layoutVertexArray.emplaceBack(xe[Ne].x,xe[Ne].y),i.lineIndexArray.emplaceBack(He+Ne-1,He+Ne),V.push(xe[Ne].x),V.push(xe[Ne].y);Ie.vertexLength+=xe.length,Ie.primitiveLength+=xe.length}const ge=Kp(V,j);for(let xe=0;xe<ge.length;xe+=3)i.indexArray.emplaceBack(F+ge[xe],F+ge[xe+1],F+ge[xe+2]);if(ge.length>0&&s&&this.elevationMode==="hd-road-base"){const xe=s.elevation.isTunnel(),Ie=s.elevation.safeArea,He=this.elevatedStructures.addVertices($,ee);this.elevatedStructures.addTriangles(ge,He,xe);const Ne=oe.length;if(Ne>0){for(let We=0;We<Ne-1;We++)this.elevatedStructures.addRenderableRing(s.index,oe[We]+He,oe[We+1]-oe[We],xe,Ie,s.featureInfo);this.elevatedStructures.addRenderableRing(s.index,oe[Ne-1]+He,$.length-oe[Ne-1],xe,Ie,s.featureInfo)}}k.vertexLength+=C,k.primitiveLength+=ge.length/3}return[u,p]}prepareElevatedPolygons(e,i,s){const u=1/fe(s),p=[];for(const _ of e){const v=vr(_,new aa(i,u));p.push(...v)}return p}clipPolygonsToTile(e,i){const s=-i,u=-i,p=pi+i,_=pi+i;let v=0;const E=[],C=[];for(;v<e.length;v++){const V=e[v],j=Lc(V);(j.min.x>=s&&j.max.x<=p&&j.min.y>=u&&j.max.y<=_?E:C).push(V)}if(E.length===e.length)return e;const k=[new je(s,u),new je(p,u),new je(p,_),new je(s,_),new je(s,u)],F=E;for(const V of C)F.push(...sr(V,k));return F}}let Nc,rc,ql,iu;di(Sl,"FillBucket",{omit:["layers","patternFeatures"]}),di(eo,"FillBufferData"),di(In,"ElevatedStructures");class Sc{constructor(e,i,s,u){if(this.triangleCount=i.length/3,this.min=new je(0,0),this.max=new je(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[p,_]=[e[0].clone(),e[0].clone()];for(let F=1;F<e.length;++F){const V=e[F];p.x=Math.min(p.x,V.x),p.y=Math.min(p.y,V.y),_.x=Math.max(_.x,V.x),_.y=Math.max(_.y,V.y)}if(u){const F=Math.ceil(Math.max(_.x-p.x,_.y-p.y)/u);s=Math.max(s,F)}if(s===0)return;this.min=p,this.max=_;const v=this.max.sub(this.min);v.x=Math.max(v.x,1),v.y=Math.max(v.y,1);const E=Math.max(v.x,v.y)/s;this.cellsX=Math.max(1,Math.ceil(v.x/E)),this.cellsY=Math.max(1,Math.ceil(v.y/E)),this.xScale=1/E,this.yScale=1/E;const C=[];for(let F=0;F<this.triangleCount;F++){const V=e[i[3*F+0]].sub(this.min),j=e[i[3*F+1]].sub(this.min),$=e[i[3*F+2]].sub(this.min),ee=tl(Math.floor(Math.min(V.x,j.x,$.x)),this.xScale,this.cellsX),oe=tl(Math.floor(Math.max(V.x,j.x,$.x)),this.xScale,this.cellsX),se=tl(Math.floor(Math.min(V.y,j.y,$.y)),this.yScale,this.cellsY),ge=tl(Math.floor(Math.max(V.y,j.y,$.y)),this.yScale,this.cellsY),xe=new je(0,0),Ie=new je(0,0),He=new je(0,0),Ne=new je(0,0);for(let We=se;We<=ge;++We){xe.y=Ie.y=We*E,He.y=Ne.y=(We+1)*E;for(let at=ee;at<=oe;++at)xe.x=He.x=at*E,Ie.x=Ne.x=(at+1)*E,(Ho(V,j,$,xe,Ie,Ne)||Ho(V,j,$,xe,Ne,He))&&C.push({cellIdx:We*this.cellsX+at,triIdx:F})}}if(C.length===0)return;C.sort(((F,V)=>F.cellIdx-V.cellIdx||F.triIdx-V.triIdx));let k=0;for(;k<C.length;){const F=C[k].cellIdx,V={start:this.payload.length,len:0};for(;k<C.length&&C[k].cellIdx===F;)++V.len,this.payload.push(C[k++].triIdx);this.cells[F]=V}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=tl(e.x-this.min.x,this.xScale,this.cellsX),u=tl(e.y-this.min.y,this.yScale,this.cellsY),p=this.cells[u*this.cellsX+s];if(p){this._lazyInitLookup();for(let _=0;_<p.len;_++){const v=this.payload[p.start+_],E=Math.floor(v/8),C=1<<v%8;if(!(this.lookup[E]&C)&&(this.lookup[E]|=C,i.push(v),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const u=tl(e.x-this.min.x,this.xScale,this.cellsX),p=tl(i.x-this.min.x,this.xScale,this.cellsX),_=tl(e.y-this.min.y,this.yScale,this.cellsY),v=tl(i.y-this.min.y,this.yScale,this.cellsY);for(let E=_;E<=v;E++)for(let C=u;C<=p;C++){const k=this.cells[E*this.cellsX+C];if(k)for(let F=0;F<k.len;F++){const V=this.payload[k.start+F],j=Math.floor(V/8),$=1<<V%8;if(!(this.lookup[j]&$)&&(this.lookup[j]|=$,s.push(V),s.length===this.triangleCount))return}}}}function tl(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}di(Sc,"TriangleGridIndex");class il{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}updateAppearances(e,i,s,u){}populate(e,i,s,u){const p=[];for(const{feature:_,id:v,index:E,sourceLayerIndex:C}of e){const k=this.layers[0]._featureFilter.needGeometry,F=ft(_,k);if(!this.layers[0]._featureFilter.filter(new Xa(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),F,s))continue;const V={id:v,properties:_.properties,type:_.type,sourceLayerIndex:C,index:E,geometry:k?F.geometry:it(_,s,u),patterns:{}};p.push(V)}for(const _ of p){const{geometry:v,index:E,sourceLayerIndex:C}=_;this.addFeature(_,v,E,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[E].feature,v,E,C,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,u,p,_,v){}destroy(){}addFeature(e,i,s,u,p,_=[],v){for(const E of si(i,2)){const C=[],k=[],F=[],V=new je(1/0,1/0),j=new je(-1/0,-1/0);for(const oe of E)if(oe.length!==0){oe!==E[0]&&F.push(k.length/2);for(let se=0;se<oe.length;se++)k.push(oe[se].x),k.push(oe[se].y),C.push(oe[se]),V.x=Math.min(V.x,oe[se].x),V.y=Math.min(V.y,oe[se].y),j.x=Math.max(j.x,oe[se].x),j.y=Math.max(j.y,oe[se].y)}const $=Kp(k,F),ee=new Sc(C,$,8,256);this.footprints.push({vertices:C,indices:$,grid:ee,min:V,max:j})}}}di(il,"ClipBucket",{omit:["layers"]});const ac=Zr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),nu=Zr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Ec=Zr([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Hl=Zr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),El=Zr([{name:"a_join_normal_inside",components:3,type:"Int16"}]),wh=Zr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Qu=Zr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:rs}=ac,Ds=Number.MAX_SAFE_INTEGER,vo=Ds-1;function Vc(r,e,i,s){return r.order<e||r.order===Ds||!(r.clipMask&i)||(function(u,p){return p.length!==0&&p.find((_=>_===u))===void 0})(s,r.clipScope)}function bo(r,e){return r.x-e.x||r.y-e.y}function Zf(r,e){return bo(r.min,e.min)===0&&bo(r.max,e.max)===0}function eh(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function Th(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!Zf(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!ei(r[i].clipScope,e[i].clipScope))return!1;return!0}function Sh(r,e,i){const s=1/pi,u=1/(1<<i.canonical.z),p=(e.x*s+i.canonical.x)*u+i.wrap,_=(e.y*s+i.canonical.y)*u;return{min:new je((r.x*s+i.canonical.x)*u+i.wrap,(r.y*s+i.canonical.y)*u),max:new je(p,_)}}function Yh(r,e,i){const s=1<<i.canonical.z,u=((e.x-i.wrap)*s-i.canonical.x)*pi,p=(e.y*s-i.canonical.y)*pi;return{min:new je(((r.x-i.wrap)*s-i.canonical.x)*pi,(r.y*s-i.canonical.y)*pi),max:new je(u,p)}}function Al(r,e,i,s,u,p,_){const v=r.indices,E=r.vertices,C=[];for(let k=s;k<s+u;k+=3){const F=e[i[k+0]+p],V=e[i[k+1]+p],j=e[i[k+2]+p],$=Math.min(F.x,V.x,j.x),ee=Math.max(F.x,V.x,j.x),oe=Math.min(F.y,V.y,j.y),se=Math.max(F.y,V.y,j.y);C.length=0,r.grid.query(new je($,oe),new je(ee,se),C);for(let ge=0;ge<C.length;ge++){const xe=C[ge];if(Ho(E[v[3*xe+0]],E[v[3*xe+1]],E[v[3*xe+2]],F,V,j,_))return!0}}return!1}function Sf(r,e,i,s){if(!r||!i)return!1;let u=r.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<r.vertices.length)return Sf(i,s,r,e);const p=e.canonical,_=s.canonical,v=Math.pow(2,_.z-p.z);u=r.vertices.map((E=>new je((E.x+p.x*pi)*v-_.x*pi,(E.y+p.y*pi)*v-_.y*pi)))}return Al(i,u,r.indices,0,r.indices.length,0,0)}function vp(r,e,i,s){const u=Math.pow(2,s.z-i.z);return new je((r+i.x*pi)*u-s.x*pi,(e+i.y*pi)*u-s.y*pi)}function z_(r,e){const i=[];e.grid.queryPoint(r,i);const s=e.indices,u=e.vertices;for(let p=0;p<i.length;p++){const _=i[p];if(qa([u[s[3*_+0]],u[s[3*_+1]],u[s[3*_+2]]],r))return!0}return!1}const Jp=[new je(0,0),new je(pi,0),new je(pi,pi),new je(0,pi)];function Qp(r,e){const i=[];let s=[];if(!e||r.length<2)return[r];if(r.length===2)return Qo(r[0],r[1],Jp)?[r]:[];for(let u=0;u<r.length+2;u++){const p=r[u%r.length],_=r[(u+1)%r.length],v=Qo(u===0?r[r.length-1]:r[(u-1)%r.length],p,Jp),E=Qo(p,_,Jp),C=v||E;C&&s.push(p),C&&E||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const bp=ht.types,Xf=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Mm=["fill-extrusion-flood-light-ground-radius"],Z_=Math.pow(2,13),X_=Math.pow(2,15)-1,D_=new je(0,1),Ef=2147483648,R_=7,g_=450;function Cm(r,e,i,s,u,p,_,v){r.emplaceBack((e<<1)+_,(i<<1)+p,(Math.floor(s*Z_)<<1)+u,Math.round(v))}function zm(r,e,i){r.emplaceBack(e.x*pi,e.y*pi,i?1:0)}function em(r,e,i,s,u,p){r.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+u,p)}function th(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class e_{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class t_{constructor(){this.centroidXY=new je(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new je(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new je(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new je(this.max.x-this.min.x,this.max.y-this.min.y)}}class y_{constructor(){this.acc=new je(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===pi)&&i.x===s.x)!=((i.y===0||i.y===pi)&&i.y===s.y)&&this.processBorderOverlap(i,s),u&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Gn(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>pi!=e.x>pi&&this.addBorderIntersection(1,Gn(i.y,e.y,(pi-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Gn(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>pi!=e.y>pi&&this.addBorderIntersection(3,Gn(i.x,e.x,(pi-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new je(0,0):new je(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((e,i)=>e+ +(i[0]!==Number.MAX_VALUE)),0):0}}function i_(r,e){const i=r.add(e)._unit(),s=te(r.x*i.x+r.y*i.y,-1,1);var u,p,_;return u=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(u)))/4*X_*((p=r).x*(_=e).y-p.y*_.x<0?-1:1)}const P_=[r=>r.x<0,r=>r.x>pi,r=>r.y<0,r=>r.y>pi];function Uc(r,e,i,s){const u=[4];if(s===0)return u;i._mult(s);const p=r.sub(i),_=e.sub(i),v=[r,e,p,_];for(let E=0;E<4;E++)for(const C of v)if(P_[E](C)){u.push(E);break}return u}class ru{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new kp,this.indexArray=new ao,this.programConfigurations=new yh(e.layers,{zoom:e.zoom,lut:e.lut},(i=>Mm.includes(i))),this._segments=new xs,this.hiddenByLandmarkVertexArray=new dl,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new xs}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,u=!1){const p=e.length;if(p>2){let _=Math.max(0,this._segments.get().length-1);const v=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[_].length);let E;_!==this._segments.get().length-1&&(_++,this._segmentToGroundQuads[_]=[],this._segmentToRegionTriCounts[_]=[0,0,0,0,0]);{const C=e[0],k=e[1];E=i_(C.sub(e[p-1])._perp()._unit(),k.sub(C)._perp()._unit())}for(let C=0;C<p;C++){const k=C===p-1?0:C+1,F=e[C],V=e[k],j=e[k===p-1?0:k+1],$=V.sub(F)._perp()._unit(),ee=i_($,j.sub(V)._perp()._unit()),oe=E,se=ee;if(n_(F,V,i)||u&&tm(F,i)&&tm(V,i)){E=ee;continue}const ge=v.vertexLength;em(this.vertexArray,F,V,1,1,oe),em(this.vertexArray,F,V,1,0,oe),em(this.vertexArray,F,V,0,1,se),em(this.vertexArray,F,V,0,0,se),v.vertexLength+=4;const xe=Uc(F,V,$,s);for(const Ie of xe)this._segmentToGroundQuads[_].push({id:ge,region:Ie}),this._segmentToRegionTriCounts[_][Ie]+=2,v.primitiveLength+=2;E=ee}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort(((u,p)=>u.region-p.region));for(let s=0;s<i;s++){const u=this._segmentToGroundQuads[s],p=e[s],_=this._segmentToRegionTriCounts[s];_.reduce(((E,C)=>E+C),0);let v=0;for(let E=0;E<=4;E++){const C=_[E];if(C!==0){let k=this.regionSegments[E];k||(k=this.regionSegments[E]=new xs);const F={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+v,vertexLength:p.vertexLength,primitiveLength:C};k.get().push(F)}v+=C}for(let E=0;E<u.length;E++){const C=u[E].id;this.indexArray.emplaceBack(C,C+1,C+3),this.indexArray.emplaceBack(C,C+3,C+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,u,p,_,v){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,u,p,_,void 0,v)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,nu.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,Ec.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,u,p,_,v,E){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,u,p,_,v,E)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Ef))}updateHiddenByLandmarkRange(e,i,s){if(!this.hasData())return;const u=i+e;if(i!==0){for(let p=e;p<u;++p)this.hiddenByLandmarkVertexArray.emplace(p,s?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,wh.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class au{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ao,this.footprintVertices=new hf,this.footprintSegments=[],this.layoutVertexArray=new df,this.centroidVertexArray=new Np,this.wallVertexArray=new mp,this.indexArray=new ao,this.programConfigurations=new yh(e.layers,{zoom:e.zoom,lut:e.lut},(i=>Xf.includes(i))),this.segments=new xs,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.groundEffect=new ru(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){this.features=[],this.hasPattern=Pi("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=fe(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:p,id:_,index:v,sourceLayerIndex:E}of e){const C=this.layers[0]._featureFilter.needGeometry,k=ft(p,C);if(!this.layers[0]._featureFilter.filter(new Xa(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,s))continue;const F={id:_,sourceLayerIndex:E,index:v,geometry:C?k.geometry:it(p,s,u),properties:p.properties,type:p.type,patterns:{}},V=this.layoutVertexArray.length,j=bp[F.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:p.id,feature:gn("fill-extrusion",this.layers,F,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const $ of F.geometry)for(const ee of Qp($,j))this.addFeature(p.id,F,[ee],v,s,{},i.availableImages,u,i.brightness);else this.addFeature(p.id,F,F.geometry,v,s,{},i.availableImages,u,i.brightness);i.featureIndex.insert(p,F.geometry,v,E,this.index,V)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,u,p,_){for(const{featureId:v,feature:E}of this.features){const C=bp[E.type]==="Polygon",{geometry:k}=E;if(this.wallMode)for(const F of k)for(const V of Qp(F,C))this.addFeature(v,E,[V],E.index,i,s,u,p,_);else this.addFeature(v,E,k,E.index,i,s,u,p,_)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,u,p,_,v){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,v,this.worldview),this.groundEffect.update(e,i,p,s,u,_,v,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,rs),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,El.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Qu.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Hl.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,u,p,_,v,E,C){const k=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,F=[new je(0,0),new je(pi,pi)],V=E.projection,j=V.name==="globe",$=this.wallMode||bp[i.type]==="Polygon",ee=new y_;ee.centroidDataIndex=this.centroidData.length;const oe=new t_;oe.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(oe.buildingId=i.properties.building_id);const se=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},p)<=0,ge=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},p);let xe;if(oe.height=ge,oe.vertexArrayOffset=this.layoutVertexArray.length,oe.groundVertexArrayOffset=this.groundEffect.vertexArray.length,j&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ff),this.wallMode){if(j)return void Bi("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;xe=(function(pt){const Xt=pt[0].x===pt[pt.length-1].x&&pt[0].y===pt[pt.length-1].y;(function(sn){let bn=0;const Vr=sn.length;for(let zi=0;zi<Vr;zi++)bn+=(sn[(zi+1)%Vr].x-sn[zi].x)*(sn[(zi+1)%Vr].y+sn[zi].y);return bn>=0})(pt)||(pt=pt.reverse());const ri={geometry:[],joinNormals:[],indices:[]},vi=[],wi=[],_i=[];let gi=pt.length;for(;gi>=2&&pt[gi-1].equals(pt[gi-2]);)gi--;if(gi<(Xt?3:2))return ri;let Zt,$t,yi,ki,Ii,Dn=0;for(;Dn<gi-1&&pt[Dn].equals(pt[Dn+1]);)Dn++;Xt&&(Zt=pt[gi-2],Ii=pt[Dn].sub(Zt)._unit()._perp());for(let sn=Dn;sn<gi;sn++){if(yi=sn===gi-1?Xt?pt[Dn+1]:void 0:pt[sn+1],yi&&pt[sn].equals(yi))continue;Ii&&(ki=Ii),Zt&&($t=Zt),Zt=pt[sn],Ii=yi?yi.sub(Zt)._unit()._perp():ki,ki=ki||Ii;let bn=ki.add(Ii);bn.x===0&&bn.y===0||bn._unit();const Vr=bn.x*Ii.x+bn.y*Ii.y,zi=Vr!==0?1/Vr:1/0,wn=ki.x*Ii.y-ki.y*Ii.x>0;let fr="miter";const ha=2;fr==="miter"&&zi>ha&&(fr="bevel"),fr==="bevel"&&(zi>100&&(fr="flipbevel"),zi<ha&&(fr="miter"));const xa=(Ar,ts,Ue,$e)=>{const Wt=new je(Ar.x,Ar.y),bi=new je(Ar.x,Ar.y);Wt.x+=ts.x*$e,Wt.y+=ts.y*$e,bi.x-=ts.x*Math.max(Ue,1),bi.y-=ts.y*Math.max(Ue,1),_i.push(ts),vi.push(Wt),wi.push(bi)};if(fr==="miter")bn._mult(zi),xa(Zt,bn,0,0);else if(fr==="flipbevel")bn=Ii.mult(-1),xa(Zt,bn,0,0),xa(Zt,bn.mult(-1),0,0);else{const Ar=-Math.sqrt(zi*zi-1),ts=wn?Ar:0,Ue=wn?0:Ar;$t&&xa(Zt,ki,ts,Ue),yi&&xa(Zt,Ii,ts,Ue)}}ri.geometry=[...vi,...wi.reverse(),vi[0]],ri.joinNormals=[..._i,..._i.reverse(),_i[_i.length-1]];const tn=ri.geometry.length-1;for(let sn=0;sn<tn/2;sn++)if(sn+1<tn/2){let bn=sn,Vr=sn+1,zi=tn-1-sn,wn=tn-2-sn;bn=bn===0?tn-1:bn-1,Vr=Vr===0?tn-1:Vr-1,zi=zi===0?tn-1:zi-1,wn=wn===0?tn-1:wn-1,ri.indices.push(zi),ri.indices.push(Vr),ri.indices.push(bn),ri.indices.push(zi),ri.indices.push(wn),ri.indices.push(Vr)}return ri})(s[0]),s=[xe.geometry]}const Ie=(pt,Xt)=>pt<(Xt.length-1)/2||pt===Xt.length-1,He=this.wallMode?[s]:si(s,500);for(let pt=He.length-1;pt>=0;pt--){const Xt=He[pt];(Xt.length===0||(Ne=Xt[0]).every((ni=>ni.x<=0))||Ne.every((ni=>ni.x>=pi))||Ne.every((ni=>ni.y<=0))||Ne.every((ni=>ni.y>=pi)))&&He.splice(pt,1)}var Ne;let We;if(j)We=ny(He,F,p);else{We=[];for(const pt of He)We.push({polygon:pt,bounds:F})}const at=$?this.edgeRadius:0,ct=at>0&&this.zoom<17,Gt=(pt,Xt)=>{if(pt.length===0)return!1;const ni=pt[pt.length-1];return Xt.x===ni.x&&Xt.y===ni.y};for(const{polygon:pt,bounds:Xt}of We){let ni=0,ri=0;for(const gi of pt)$&&!gi[0].equals(gi[gi.length-1])&&gi.push(gi[0]),ri+=$?gi.length-1:gi.length;const vi=this.segments.prepareSegment(($?5:4)*ri,this.layoutVertexArray,this.indexArray);oe.footprintSegIdx<0&&(oe.footprintSegIdx=this.footprintSegments.length),oe.polygonSegIdx<0&&(oe.polygonSegIdx=this.polygonSegments.length);const wi={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},_i=new e_;if(_i.vertexOffset=this.footprintVertices.length,_i.indexOffset=3*this.footprintIndices.length,_i.ringIndices=[],$){const gi=[],Zt=[];ni=vi.vertexLength;for(let yi=0;yi<pt.length;yi++){const ki=pt[yi];ki.length&&yi!==0&&Zt.push(gi.length/2);const Ii=[];let Dn,tn;Dn=ki[1].sub(ki[0])._perp()._unit(),_i.ringIndices.push(ki.length-1);for(let sn=1;sn<ki.length;sn++){const bn=ki[sn],Vr=ki[sn===ki.length-1?1:sn+1],zi=bn.clone();if(at){tn=Vr.sub(bn)._perp()._unit();const wn=Dn.add(tn)._unit(),fr=at*Math.min(4,1/(Dn.x*wn.x+Dn.y*wn.y));zi.x+=fr*wn.x,zi.y+=fr*wn.y,zi.x=Math.round(zi.x),zi.y=Math.round(zi.y),Dn=tn}if(!se||at!==0&&!ct||Gt(Ii,zi)||Ii.push(zi),Cm(this.layoutVertexArray,zi.x,zi.y,0,0,1,1,0),this.wallMode){const wn=Ie(sn,ki);zm(this.wallVertexArray,xe.joinNormals[sn],!wn)}vi.vertexLength++,this.footprintVertices.emplaceBack(bn.x,bn.y),gi.push(bn.x,bn.y),j&&th(this.layoutVertexExtArray,V.projectTilePoint(zi.x,zi.y,p),V.upVector(p,zi.x,zi.y))}se&&(at===0||ct)&&(Ii.length!==0&&Gt(Ii,Ii[0])&&Ii.pop(),this.groundEffect.addData(Ii,Xt,k))}const $t=this.wallMode?xe.indices:Kp(gi,Zt);for(let yi=0;yi<$t.length;yi+=3)this.footprintIndices.emplaceBack(_i.vertexOffset+$t[yi+0],_i.vertexOffset+$t[yi+1],_i.vertexOffset+$t[yi+2]),this.indexArray.emplaceBack(ni+$t[yi],ni+$t[yi+2],ni+$t[yi+1]),vi.primitiveLength++;_i.indexCount+=$t.length,_i.vertexCount+=this.footprintVertices.length-_i.vertexOffset}for(let gi=0;gi<pt.length;gi++){const Zt=pt[gi];ee.startRing(oe,Zt[0]);let $t=Zt.length>4&&iy(Zt[Zt.length-2],Zt[0],Zt[1]),yi=at?Eh(Zt[Zt.length-2],Zt[0],Zt[1],at):0;const ki=[];let Ii,Dn,tn;Dn=Zt[1].sub(Zt[0])._perp()._unit();let sn=!0;for(let bn=1,Vr=0;bn<Zt.length;bn++){let zi=Zt[bn-1],wn=Zt[bn];const fr=Zt[bn===Zt.length-1?1:bn+1];if(ee.appendEdge(oe,wn,zi),n_(wn,zi,Xt)){at&&(Dn=fr.sub(wn)._perp()._unit(),sn=!sn);continue}const ha=wn.sub(zi)._perp(),xa=ha.x/(Math.abs(ha.x)+Math.abs(ha.y)),Ar=ha.y>0?1:0,ts=zi.dist(wn);if(Vr+ts>32768&&(Vr=0),at){tn=fr.sub(wn)._perp()._unit();let bi=ih(zi,wn,fr,Ac(Dn,tn),at);isNaN(bi)&&(bi=0);const Zi=wn.sub(zi)._unit();zi=zi.add(Zi.mult(yi))._round(),wn=wn.add(Zi.mult(-bi))._round(),yi=bi,Dn=tn,se&&this.zoom>=17&&(Gt(ki,zi)||ki.push(zi),Gt(ki,wn)||ki.push(wn))}const Ue=vi.vertexLength,$e=Zt.length>4&&iy(zi,wn,fr);let Wt=gg(Vr,$t,sn);if(Cm(this.layoutVertexArray,zi.x,zi.y,xa,Ar,0,0,Wt),Cm(this.layoutVertexArray,zi.x,zi.y,xa,Ar,0,1,Wt),this.wallMode){const bi=Ie(bn-1,Zt),Zi=xe.joinNormals[bn-1];zm(this.wallVertexArray,Zi,bi),zm(this.wallVertexArray,Zi,bi)}if(Vr+=ts,Wt=gg(Vr,$e,!sn),$t=$e,Cm(this.layoutVertexArray,wn.x,wn.y,xa,Ar,0,0,Wt),Cm(this.layoutVertexArray,wn.x,wn.y,xa,Ar,0,1,Wt),this.wallMode){const bi=Ie(bn,Zt),Zi=xe.joinNormals[bn];zm(this.wallVertexArray,Zi,bi),zm(this.wallVertexArray,Zi,bi)}if(vi.vertexLength+=4,this.indexArray.emplaceBack(Ue+0,Ue+1,Ue+2),this.indexArray.emplaceBack(Ue+1,Ue+3,Ue+2),vi.primitiveLength+=2,at){const bi=ni+(bn===1?Zt.length-2:bn-2),Zi=bn===1?ni:bi+1;if(this.indexArray.emplaceBack(Ue+1,bi,Ue+3),this.indexArray.emplaceBack(bi,Zi,Ue+3),vi.primitiveLength+=2,Ii===void 0&&(Ii=Ue),!n_(fr,Zt[bn],Xt)){const Xi=bn===Zt.length-1?Ii:vi.vertexLength;this.indexArray.emplaceBack(Ue+2,Ue+3,Xi),this.indexArray.emplaceBack(Ue+3,Xi+1,Xi),this.indexArray.emplaceBack(Ue+3,Zi,Xi+1),vi.primitiveLength+=3}sn=!sn}if(j){const bi=this.layoutVertexExtArray,Zi=V.projectTilePoint(zi.x,zi.y,p),Xi=V.projectTilePoint(wn.x,wn.y,p),Pn=V.upVector(p,zi.x,zi.y),Bn=V.upVector(p,wn.x,wn.y);th(bi,Zi,Pn),th(bi,Zi,Pn),th(bi,Xi,Bn),th(bi,Xi,Bn)}}$&&(ni+=Zt.length-1),se&&at&&this.zoom>=17&&(ki.length!==0&&Gt(ki,ki[0])&&ki.pop(),this.groundEffect.addData(ki,Xt,k,at>0))}this.footprintSegments.push(_i),wi.triangleCount=this.indexArray.length-wi.triangleArrayOffset,this.polygonSegments.push(wi),++oe.footprintSegLen,++oe.polygonSegLen}if(oe.vertexCount=this.layoutVertexArray.length-oe.vertexArrayOffset,oe.groundVertexCount=this.groundEffect.vertexArray.length-oe.groundVertexArrayOffset,oe.vertexCount!==0){if(oe.centroidXY=ee.borders?D_:this.encodeCentroid(ee,oe),this.centroidData.push(oe),ee.borders){this.featuresOnBorder.push(ee);const pt=this.featuresOnBorder.length-1;for(let Xt=0;Xt<ee.borders.length;Xt++)ee.borders[Xt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Xt].push(pt)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,_,v,p,C,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,u,_,v,p,C,this.worldview),this.maxHeight=Math.max(this.maxHeight,ge)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort(((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0]))}splitToSubtiles(){const e=[];for(let v=0;v<this.centroidData.length;v++){const E=this.centroidData[v],C=+(E.min.y+E.max.y>pi),k=2*C+(+(E.min.x+E.max.x>pi)^C);for(let F=0;F<E.polygonSegLen;F++){const V=E.polygonSegIdx+F;e.push({centroidIdx:v,subtile:k,polygonSegmentIdx:V,triangleSegmentIdx:this.polygonSegments[V].triangleSegIdx})}}const i=new ao;e.sort(((v,E)=>v.triangleSegmentIdx===E.triangleSegmentIdx?v.subtile-E.subtile:v.triangleSegmentIdx-E.triangleSegmentIdx));let s=0,u=0,p=0;for(const v of e){if(v.triangleSegmentIdx!==s)break;p++}const _=e.length;for(;u!==e.length;){s=e[u].triangleSegmentIdx;let v=0,E=u,C=u;for(let k=E;k<p&&e[k].subtile===v;k++)C++;for(;E!==p;){const k=e[E];v=k.subtile;const F=this.centroidData[k.centroidIdx].min.clone(),V=this.centroidData[k.centroidIdx].max.clone(),j={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let $=E;$<C;$++){const ee=e[$],oe=this.polygonSegments[ee.polygonSegmentIdx],se=this.centroidData[ee.centroidIdx].min,ge=this.centroidData[ee.centroidIdx].max,xe=this.indexArray.uint16;for(let Ie=oe.triangleArrayOffset;Ie<oe.triangleArrayOffset+oe.triangleCount;Ie++)i.emplaceBack(xe[3*Ie],xe[3*Ie+1],xe[3*Ie+2]);j.primitiveLength+=oe.triangleCount,F.x=Math.min(F.x,se.x),F.y=Math.min(F.y,se.y),V.x=Math.max(V.x,ge.x),V.y=Math.max(V.y,ge.y)}j.primitiveLength>0&&this.triangleSubSegments.push({segment:j,min:F,max:V}),E=C;for(let $=E;$<p&&e[$].subtile===e[E].subtile;$++)C++}u=p;for(let k=u;k<_&&e[k].triangleSegmentIdx===e[u].triangleSegmentIdx;k++)p++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const u=new xs;if(this.wallMode){for(const ee of this.triangleSubSegments)u.segments.push(ee.segment);return u}let p=0,_=0;const v=1<<e.canonical.z;if(i){const ee=i.getMinMaxForTile(e);ee&&(p=ee.min,_=ee.max)}_+=this.maxHeight;const E=e.toUnwrapped();let C;const k=[E.canonical.x/v+E.wrap,E.canonical.y/v],F=[(E.canonical.x+1)/v+E.wrap,(E.canonical.y+1)/v],V=(ee,oe,se)=>[ee[0]*(1-se[0])+oe[0]*se[0],ee[1]*(1-se[1])+oe[1]*se[1]],j=[],$=[];for(const ee of this.triangleSubSegments){j[0]=ee.min.x/pi,j[1]=ee.min.y/pi,$[0]=ee.max.x/pi,$[1]=ee.max.y/pi;const oe=V(k,F,j),se=V(k,F,$);if(new _n([oe[0],oe[1],p],[se[0],se[1],_]).intersectsPrecise(s)===0){C&&(u.segments.push(C),C=void 0);continue}const ge=ee.segment;C&&C.vertexOffset!==ge.vertexOffset&&(u.segments.push(C),C=void 0),C?(C.vertexLength+=ge.vertexLength,C.primitiveLength+=ge.primitiveLength):C={vertexOffset:ge.vertexOffset,primitiveLength:ge.primitiveLength,vertexLength:ge.vertexLength,primitiveOffset:ge.primitiveOffset,sortKey:void 0,vaos:{}}}return C&&u.segments.push(C),u}encodeCentroid(e,i){const s=e.centroid(),u=i.span(),p=Math.min(7,Math.round(u.x*this.tileToMeter/10)),_=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new je(te(s.x,1,pi-1)<<3|p,te(s.y,1,pi-1)<<3|_)}encodeBorderCentroid(e){if(!e.borders)return new je(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const u=i[0][0]!==s?0:1;return new je(6|(i[0][0]!==s?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{const u=i[2][0]!==s?2:3;return new je((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,u=e.flags&Ef?D_:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||p!==u.x){for(let _=i;_<s;++_)this.centroidVertexArray.emplace(_,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(Th(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const _ of this.centroidData)_.flags&=2147483647;const p=[];for(const _ of this.activeReplacements){if(_.order<s)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));if(_.footprint.buildingIds)for(const E of this.centroidData)E.flags&Ef||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y||_.footprint.buildingIds.has(E.buildingId)&&(E.flags|=Ef);else for(const E of this.centroidData)if(!(E.flags&Ef||_.min.x>E.max.x||E.min.x>_.max.x||_.min.y>E.max.y||E.min.y>_.max.y))for(let C=0;C<E.footprintSegLen;C++){const k=this.footprintSegments[E.footprintSegIdx+C];if(p.length=0,ry(this.footprintVertices,k.vertexOffset,k.vertexCount,_.footprintTileId.canonical,e.canonical,p),Al(_.footprint,p,this.footprintIndices.uint16,k.indexOffset,k.indexCount,-k.vertexOffset,-v)){E.flags|=Ef;break}}}for(const _ of this.centroidData)this.writeCentroidToBuffer(_);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let u=!1;for(let p=0;p<s.footprintSegLen;p++){const _=this.footprintSegments[s.footprintSegIdx+p];let v=0;for(const E of _.ringIndices){for(let C=v,k=E+v-1;C<E+v;k=C++){const F=this.footprintVertices.int16[2*(C+_.vertexOffset)+0],V=this.footprintVertices.int16[2*(C+_.vertexOffset)+1],j=this.footprintVertices.int16[2*(k+_.vertexOffset)+1];V>i!=j>i&&e<(this.footprintVertices.int16[2*(k+_.vertexOffset)+0]-F)*(i-V)/(j-V)+F&&(u=!u)}v=E}}return u}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+pi)*pi+(i+pi);if(this.partLookup.hasOwnProperty(p)){const _=this.partLookup[p];return _?{height:_.height,hidden:!!(_.flags&Ef)}:void 0}for(const _ of this.centroidData)e>_.max.x||_.min.x>e||i>_.max.y||_.min.y>i||_.height<=s||this.footprintContainsPoint(e,i,_)&&(s=_.height,this.partLookup[p]=_,u=!!(_.flags&Ef));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:u};this.partLookup[p]=void 0}}function Ac(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function Eh(r,e,i,s){const u=e.sub(r)._perp()._unit(),p=i.sub(e)._perp()._unit();return ih(r,e,i,Ac(u,p),s)}function ih(r,e,i,s,u){const p=Math.sqrt(1-s*s);return Math.min(r.dist(e)/3,e.dist(i)/3,u*p/s)}function n_(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function tm(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function iy(r,e,i){if(r.x<0||r.x>=pi||e.x<0||e.x>=pi||i.x<0||i.x>=pi)return!1;const s=i.sub(e),u=s.perp(),p=r.sub(e);return(s.x*p.x+s.y*p.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(p.x*p.x+p.y*p.y))>-.866&&u.x*p.x+u.y*p.y<0}function gg(r,e,i){const s=e?2|r:-3&r;return i?1|s:-2&s}function x_(){const r=Math.PI/32,e=Math.tan(r),i=h;return i*Math.sqrt(1+2*e*e)-i}function ny(r,e,i){const s=1<<i.z,u=U(i.x/s),p=U((i.x+1)/s),_=Y(i.y/s),v=Y((i.y+1)/s);return(function(E,C,k,F,V=0,j){const $=[];if(!E.length||!k||!F)return $;const ee=(Ne,We)=>{for(const at of Ne)$.push({polygon:at,bounds:We})},oe=Math.ceil(Math.log2(k)),se=Math.ceil(Math.log2(F)),ge=oe-se,xe=[];for(let Ne=0;Ne<Math.abs(ge);Ne++)xe.push(ge>0?0:1);for(let Ne=0;Ne<Math.min(oe,se);Ne++)xe.push(0),xe.push(1);let Ie=E;if(Ie=Gi(Ie,C[0].y-V,C[1].y+V,1),Ie=Gi(Ie,C[0].x-V,C[1].x+V,0),!Ie.length)return $;const He=[];for(xe.length?He.push({polygons:Ie,bounds:C,depth:0}):ee(Ie,C);He.length;){const Ne=He.pop(),We=Ne.depth,at=xe[We],ct=Ne.bounds[0],Gt=Ne.bounds[1],pt=at===0?ct.x:ct.y,Xt=at===0?Gt.x:Gt.y,ni=j?j(at,pt,Xt):.5*(pt+Xt),ri=Gi(Ne.polygons,pt-V,ni+V,at),vi=Gi(Ne.polygons,ni-V,Xt+V,at);if(ri.length){const wi=[ct,new je(at===0?ni:Gt.x,at===1?ni:Gt.y)];xe.length>We+1?He.push({polygons:ri,bounds:wi,depth:We+1}):ee(ri,wi)}if(vi.length){const wi=[new je(at===0?ni:ct.x,at===1?ni:ct.y),Gt];xe.length>We+1?He.push({polygons:vi,bounds:wi,depth:We+1}):ee(vi,wi)}}return $})(r,e,Math.ceil((p-u)/11.25),Math.ceil((_-v)/11.25),1,((E,C,k)=>{if(E===0)return .5*(C+k);{const F=Y((i.y+C/pi)/s);return(R(.5*(Y((i.y+k/pi)/s)+F))*s-i.y)*pi}}))}function ry(r,e,i,s,u,p){const _=Math.pow(2,s.z-u.z);for(let v=0;v<i;v++){let E=r.int16[2*(v+e)+0],C=r.int16[2*(v+e)+1];E=(E+u.x*pi)*_-s.x*pi,C=(C+u.y*pi)*_-s.y*pi,p.push(new je(E,C))}}let L_,yg;di(au,"FillExtrusionBucket",{omit:["layers","features"]}),di(t_,"PartData"),di(e_,"FootprintSegment"),di(y_,"BorderCentroidData"),di(ru,"GroundEffect");class r_ extends je{constructor(e,i,s){super(e,i),this.z=s}}class k_ extends r_{constructor(e,i,s,u){super(e,i,s),this.w=u}}function O_(r,e,i,s){const u=i==="x"?"y":"x",p=(s-r[i])/(e[i]-r[i]);r[u]=Math.round(r[u]+(e[u]-r[u])*p),r[i]=s,r.hasOwnProperty("z")&&(r.z=Gn(r.z,e.z,p)),r.hasOwnProperty("w")&&(r.w=Gn(r.w,e.w,p))}function xg(r,e,i,s){const u=i,p=s;for(const _ of["x","y"]){let v=r,E=e;v[_]>=E[_]&&(v=e,E=r),v[_]<u&&E[_]>u&&O_(v,E,_,u),v[_]<p&&E[_]>p&&O_(E,v,_,p)}}function im(r,e,i,s,u,p){const _=[];for(let v=0;v<r.length;v++){const E=r[v];let C;const k=_.length;let F=0;for(let V=0;V<E.length-1;V++){let j=E[V],$=E[V+1],ee=0;const oe=F;let se,ge;p&&(ee=Math.hypot($.x-j.x,$.y-j.y),F+=ee,se=j,ge=$),j.x<e&&$.x<e||(j.x<e?j=new je(e,j.y+(e-j.x)/($.x-j.x)*($.y-j.y))._round():$.x<e&&($=new je(e,j.y+(e-j.x)/($.x-j.x)*($.y-j.y))._round()),j.y<i&&$.y<i||(j.y<i?j=new je(j.x+(i-j.y)/($.y-j.y)*($.x-j.x),i)._round():$.y<i&&($=new je(j.x+(i-j.y)/($.y-j.y)*($.x-j.x),i)._round()),j.x>=s&&$.x>=s||(j.x>=s?j=new je(s,j.y+(s-j.x)/($.x-j.x)*($.y-j.y))._round():$.x>=s&&($=new je(s,j.y+(s-j.x)/($.x-j.x)*($.y-j.y))._round()),j.y>=u&&$.y>=u||(j.y>=u?j=new je(j.x+(u-j.y)/($.y-j.y)*($.x-j.x),u)._round():$.y>=u&&($=new je(j.x+(u-j.y)/($.y-j.y)*($.x-j.x),u)._round()),C&&j.equals(C[C.length-1])||(C=[j],_.push(C),p&&p.push({progress:{min:oe+W_(se,ge,j)*ee,max:1},parentIndex:v,prevPoint:se,nextPoint:ge})),C.push($),p&&(p[p.length-1].progress.max=oe+W_(se,ge,$)*ee,p[p.length-1].nextPoint=ge)))))}if(p&&F>0)for(let V=k;V<_.length;V++)p[V].progress.min/=F,p[V].progress.max/=F}return _}function ay(r,e,i,s,u){if(r.length<2)return void s.push(r);const p=[];for(;e.valid();){const[C,k]=e.get();for(let F=0;F<r.length-1;F++){const V=r[F],j=r[F+1],$=gr(V,j,C,k);if($){const[ee]=$,oe=new je(Gn(V.x,j.x,ee),Gn(V.y,j.y,ee));p.push({t:F+ee,distance:0,point:oe})}}e.next()}if(p.length===0)return void s.push(r);p.sort(((C,k)=>C.t-k.t));let _=0,v=0,E=[];for(s.push(E);_!==r.length;){if(v===p.length){for(;_!==r.length;)E.length!==0&&E[E.length-1].equals(r[_])||E.push(r[_]),_++;break}p[v].t<=_?(E.length!==0&&E[E.length-1].equals(p[v].point)||E.push(p[v].point),Math.trunc(p[v].t),v++):(E.length!==0&&E[E.length-1].equals(r[_])||E.push(r[_]),_++)}}function W_(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function Dm(r,e){return r.x*e.x+r.y*e.y}function vg(r,e){if(r.length===1){let i=0;const s=e[i++];let u;for(;!u||s.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const p=e[i],_=r[0],v=u.sub(s),E=p.sub(s),C=_.sub(s),k=Dm(v,v),F=Dm(v,E),V=Dm(E,E),j=Dm(C,v),$=Dm(C,E),ee=k*V-F*F,oe=(V*j-F*$)/ee,se=(k*$-F*j)/ee,ge=s.z*(1-oe-se)+u.z*oe+p.z*se;if(isFinite(ge))return ge}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function sy(r,e,i){let s=1/0;wa(i,e)&&(s=vg(i,e[0]));for(let u=0;u<e.length;u++){const p=e[u],_=r[u];for(let v=0;v<p.length-1;v++){const E=p[v],C=[E,p[v+1],_[v+1],_[v],E];qr(i,C)&&(s=Math.min(s,vg(i,C)))}}return s!==1/0&&s}function B_(r,e,i,s,u,p,_,v,E,C,k){return r.projection.name==="globe"?(function(F,V,j,$,ee,oe,se,ge,xe,Ie,He){const Ne=[],We=[],at=F.projection.upVectorScale(He,F.center.lat,F.worldSize).metersToTile,ct=[0,0,0,1],Gt=[0,0,0,1],pt=(ni,ri,vi,wi)=>{ni[0]=ri,ni[1]=vi,ni[2]=wi,ni[3]=1},Xt=x_();j>0&&(j+=Xt),$+=Xt;for(const ni of V){const ri=[],vi=[];for(const wi of ni){const _i=wi.x+ee.x,gi=wi.y+ee.y,Zt=F.projection.projectTilePoint(_i,gi,He),$t=F.projection.upVector(He,wi.x,wi.y);let yi=j,ki=$;if(se){const Ii=c(_i,gi,j,$,se,ge,xe,Ie);yi+=Ii.base,ki+=Ii.top}j!==0?pt(ct,Zt.x+$t[0]*at*yi,Zt.y+$t[1]*at*yi,Zt.z+$t[2]*at*yi):pt(ct,Zt.x,Zt.y,Zt.z),pt(Gt,Zt.x+$t[0]*at*ki,Zt.y+$t[1]*at*ki,Zt.z+$t[2]*at*ki),ra(ct,ct,oe),ra(Gt,Gt,oe),ri.push(new r_(ct[0],ct[1],ct[2])),vi.push(new r_(Gt[0],Gt[1],Gt[2]))}Ne.push(ri),We.push(vi)}return[Ne,We]})(r,e,i,s,u,p,_,v,E,C,k):_?(function(F,V,j,$,ee,oe,se,ge,xe){const Ie=[],He=[],Ne=[0,0,0,1];for(const We of F){const at=[],ct=[];for(const Gt of We){const pt=Gt.x+$.x,Xt=Gt.y+$.y,ni=c(pt,Xt,V,j,oe,se,ge,xe);Ne[0]=pt,Ne[1]=Xt,Ne[2]=ni.base,Ne[3]=1,la(Ne,Ne,ee),Ne[3]=Math.max(Ne[3],1e-5);const ri=new r_(Ne[0]/Ne[3],Ne[1]/Ne[3],Ne[2]/Ne[3]);Ne[0]=pt,Ne[1]=Xt,Ne[2]=ni.top,Ne[3]=1,la(Ne,Ne,ee),Ne[3]=Math.max(Ne[3],1e-5);const vi=new r_(Ne[0]/Ne[3],Ne[1]/Ne[3],Ne[2]/Ne[3]);at.push(ri),ct.push(vi)}Ie.push(at),He.push(ct)}return[Ie,He]})(e,i,s,u,p,_,v,E,C):(function(F,V,j,$,ee){const oe=[],se=[],ge=ee[8]*V,xe=ee[9]*V,Ie=ee[10]*V,He=ee[11]*V,Ne=ee[8]*j,We=ee[9]*j,at=ee[10]*j,ct=ee[11]*j;for(const Gt of F){const pt=[],Xt=[];for(const ni of Gt){const ri=ni.x+$.x,vi=ni.y+$.y,wi=ee[0]*ri+ee[4]*vi+ee[12],_i=ee[1]*ri+ee[5]*vi+ee[13],gi=ee[2]*ri+ee[6]*vi+ee[14],Zt=ee[3]*ri+ee[7]*vi+ee[15],$t=wi+ge,yi=_i+xe,ki=gi+Ie,Ii=Math.max(Zt+He,1e-5),Dn=wi+Ne,tn=_i+We,sn=gi+at,bn=Math.max(Zt+ct,1e-5);pt.push(new r_($t/Ii,yi/Ii,ki/Ii)),Xt.push(new r_(Dn/bn,tn/bn,sn/bn))}oe.push(pt),se.push(Xt)}return[oe,se]})(e,i,s,u,p)}function c(r,e,i,s,u,p,_,v){const E=_*u.getElevationAt(r,e,!0,!0),C=p[0]!==0,k=C?p[1]===0?_*(p[0]/R_-g_):_*(function(F,V,j){const $=Math.floor(V[0]/8),ee=Math.floor(V[1]/8),oe=10*(V[0]-8*$),se=10*(V[1]-8*ee),ge=F.getElevationAt($,ee,!0,!0),xe=F.getMeterToDEM(j),Ie=Math.floor(.5*(oe*xe-1)),He=Math.floor(.5*(se*xe-1)),Ne=F.tileCoordToPixel($,ee),We=2*Ie+1,at=2*He+1,ct=(function(vi,wi,_i,gi,Zt){return[vi.getElevationAtPixel(wi,_i,!0),vi.getElevationAtPixel(wi+Zt,_i,!0),vi.getElevationAtPixel(wi,_i+Zt,!0),vi.getElevationAtPixel(wi+gi,_i+Zt,!0)]})(F,Ne.x-Ie,Ne.y-He,We,at),Gt=Math.abs(ct[0]-ct[1]),pt=Math.abs(ct[2]-ct[3]),Xt=Math.abs(ct[0]-ct[2])+Math.abs(ct[1]-ct[3]),ni=Math.min(.25,.5*xe*(Gt+pt)/We),ri=Math.min(.25,.5*xe*Xt/at);return ge+Math.max(ni*oe,ri*se)})(u,p,v):E;return{base:E+(i===0?-1:i),top:C?Math.max(k+s,E+i+2):E+s}}class m{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class w{constructor(){this.tasks={},this.taskQueue=[],ot(["process"],this),this.invoker=new m(this.process),this.nextId=0}add(e,i){const s=this.nextId++,u=(function({type:p,isSymbolTile:_,zoom:v}){return v=v||0,p==="message"?0:p!=="maybePrepare"||_?p!=="parseTile"||_?p==="parseTile"&&_?300-v:p==="maybePrepare"&&_?400-v:500:200-v:100-v})(i);if(u===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((s=>!!this.tasks[s])),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const p=this.tasks[this.taskQueue[u]];p.priority<i&&(i=p.priority,e=u)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class D{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},ot(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new w}send(e,i,s,u,p=!1,_){const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=_,this.callbacks[v]=s);const E=new Set;return this.target.postMessage({id:v,type:e,hasCallback:!!s,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:fs(i,E)},E),{cancel:()=>{s&&delete this.callbacks[v],this.target.postMessage({id:v,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[s];delete this.cancelCallbacks[s],u&&u.cancel()}else if(i.mustQueue||Ur(self)){const u=this.callbacks[s],p=this.scheduler.add((()=>this.processTask(s,i)),u&&u.metadata||{type:"message"});p&&(this.cancelCallbacks[s]=p)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(Yo(i.error)):s(null,Yo(i.data)))}else{const s=new Set,u=i.hasCallback?(_,v)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:_?fs(_):null,data:fs(v,s)},s)}:()=>{},p=Yo(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,u);else if(this.parent.getWorkerSource){const _=i.type.split("."),{source:v,scope:E}=p;this.parent.getWorkerSource(i.sourceMapId,_[0],v,E)[_[1]](p,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var G={workerUrl:"",workerClass:null,workerParams:void 0};const W="mapboxgl_preloaded_worker_pool";class ve{constructor(e){this.active={},this.name=e}acquire(e,i=ve.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;){const u=(s=`${this.name||""}WorkerPool: ${e}-${this.workers.length}`,G.workerClass!=null?new G.workerClass:new self.Worker(G.workerUrl,Object.assign({name:s},G.workerParams)));this.workers.push(u)}var s;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach((i=>{i.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[W]}numActive(){return Object.keys(this.active).length}}ve.workerCount=2;class Je{constructor(e,i,s="Worker",u=ve.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=rt();const p=this.workerPool.acquire(this.id,u);for(let _=0;_<p.length;_++){const v=new Je.Actor(p[_],i,this.id);v.name=`${s} ${_}`,this.actors.push(v)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(e,i,s){et(this.actors,((u,p)=>{u.send(e,i,p)}),s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((e=>{e.remove()})),this.actors=[],this.workerPool.release(this.id)}}let kt,Mi;function nn(){return kt||(kt=new ve),kt}Je.Actor=D;const hn=4096;class Li{constructor(e){this.module=e,this.memoryStack=this.module.malloc(hn),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>hn?-1:(new Int32Array(this.module.heap32.buffer,i,e.length).set(e),i)}createFloatArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>hn?-1:(new Float32Array(this.module.heapF32.buffer,i,e.length).set(e),i)}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.normalScale;this.module.setStyle(i[0],i[1],i[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,s){this.module.setFauxFacadeOptions(e?1:0,i?1:0,s)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){this.memoryStackNextFree=this.memoryStack;for(const v of e){const E=this.createIntArray(v.ringIndices),C=this.createFloatArray(v.coordinates);if(E===-1||C===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(v.id,v.sourceId,v.minHeight,v.height,v.roofType,C,E,v.ringIndices.length-1)}for(const v of i){let E;E=v.entrances?JSON.parse(v.entrances):[];const C=this.createFloatArray(E),k=this.createFloatArray(v.coordinates);if(C===-1||k===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(v.sourceId,v.crossPerc,v.distanceToRoad,C,E.length,k,v.coordinates.length)}if(!this.module.generateMesh()){const v=this.module.getLastError();return this.readStringBuffer(v)}const s=this.module.getMeshCount(),u=new Array(s);for(let v=0;v<s;v++){const E=this.module.getPositionsPtr(v),C=this.module.getPositionsLength(v),k=new Float32Array(this.module.heapF32.buffer,E,C),F=this.module.getNormalsPtr(v),V=this.module.getNormalsLength(v),j=new Float32Array(this.module.heapF32.buffer,F,V),$=this.module.getAOPtr(v),ee=this.module.getAOLength(v),oe=new Float32Array(this.module.heapF32.buffer,$,ee),se=this.module.getUVPtr(v),ge=this.module.getUVLength(v),xe=new Float32Array(this.module.heapF32.buffer,se,ge),Ie=this.module.getFauxFacadePtr(v),He=this.module.getFauxFacadeLength(v),Ne=new Uint8Array(this.module.heapU8.buffer,Ie,He),We=this.module.getIndicesPtr(v),at=this.module.getIndicesLength(v),ct=new Int16Array(this.module.heap16.buffer,We,at),Gt=this.module.getBuildingPart(v);u[v]={positions:k,normals:j,ao:oe,uv:xe,isFauxFacade:Ne,indices:ct,buildingPart:Gt}}const p=this.module.getRingCount(),_=[];for(let v=0;v<p;v++){const E=this.module.getRingPtr(v),C=this.module.getRingLength(v),k=new Float32Array(this.module.heapF32.buffer,E,C);_.push(k)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:_}}}let Ni,Fr,na,co,ci,Kt=null,Ai=null,un=null,ua=null;function uo(){return Ur(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Fr||Rr.DRACO_URL}function Jr(){if(Ur(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(co)return co;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return co=WebAssembly.validate(r)?Rr.MESHOPT_SIMD_URL:Rr.MESHOPT_URL,co}function _s(){return ua}const Rs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},wo={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},Af={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function oy(r,e,i){const s=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:u,byteLength:r.byteLength},i.buffers[u]=r}const Ky="KHR_draco_mesh_compression";function yw(r,e){const i=r.extensions&&r.extensions[Ky];if(!i)return;const s=new na.Decoder,u=yv(e,i.bufferView),p=new na.Mesh;if(!s.DecodeArrayToMesh(u,u.byteLength,p))throw new Error("Failed to decode Draco mesh");const _=e.json.accessors[r.indices],v=Rs[_.componentType],E=_.count*v.BYTES_PER_ELEMENT,C=na._malloc(E);v===Uint16Array?s.GetTrianglesUInt16Array(p,E,C):s.GetTrianglesUInt32Array(p,E,C),oy(na.memory.buffer.slice(C,C+E),_,e),na._free(C);for(const k of Object.keys(i.attributes)){const F=s.GetAttributeByUniqueId(p,i.attributes[k]),V=e.json.accessors[r.attributes[k]],j=wo[V.componentType],$=V.count*Af[V.type]*Rs[V.componentType].BYTES_PER_ELEMENT,ee=na._malloc($);s.GetAttributeDataArrayForAllPoints(p,F,na[j],$,ee),oy(na.memory.buffer.slice(ee,ee+$),V,e),na._free(ee)}s.destroy(),p.destroy(),delete r.extensions[Ky]}const ly="EXT_meshopt_compression";function xw(r,e){if(!r.extensions||!r.extensions[ly])return;const i=r.extensions[ly],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);ci.decodeGltfBuffer(u,i.count,i.byteStride,s,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=u.buffer,delete r.extensions[ly]}const mv=1179937895,_v=new TextDecoder("utf8");function gv(r,e){return new URL(r,e).href}function vw(r,e,i,s){return fetch(gv(r.uri,s)).then((u=>u.arrayBuffer())).then((u=>{e.buffers[i]=u}))}function yv(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function bw(r,e,i,s){if(r.uri){const u=gv(r.uri,s);return fetch(u).then((p=>p.blob())).then((p=>createImageBitmap(p))).then((p=>{e.images[i]=p}))}if(r.bufferView!==void 0){const u=yv(e,r.bufferView),p=new Blob([u],{type:r.mimeType});return createImageBitmap(p).then((_=>{e.images[i]=_}))}}function xv(r,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===mv){const k=new Uint32Array(r,e);let F=2;const V=(k[F++]>>2)-3,j=k[F++]>>2;if(F++,s.json=JSON.parse(_v.decode(k.subarray(F,F+j))),F+=j,F<V){const $=k[F++];F++;const ee=e+(F<<2);s.buffers[0]=r.slice(ee,ee+$)}}else s.json=JSON.parse(_v.decode(new Uint8Array(r,e)));const{buffers:u,images:p,meshes:_,extensionsUsed:v,bufferViews:E}=s.json;let C=Promise.resolve();if(u){const k=[];for(let F=0;F<u.length;F++){const V=u[F];V.uri?k.push(vw(V,s,F,i)):s.buffers[F]||(s.buffers[F]=null)}C=Promise.all(k)}return C.then((()=>{const k=[],F=v&&v.includes(Ky),V=v&&v.includes(ly);if(F&&k.push((function(){if(!na)return Ni??(Ni=(function(j){let $,ee=null;function oe(){$=new Uint8Array(ee.buffer)}function se(){throw new Error("Unexpected Draco error.")}const ge={a:{a:se,d:function(xe,Ie,He){return $.copyWithin(xe,Ie,Ie+He)},c:function(xe){const Ie=$.length,He=Math.max(xe>>>0,Math.ceil(1.2*Ie)),Ne=Math.ceil((He-Ie)/65536);try{return ee.grow(Ne),oe(),!0}catch{return!1}},b:se}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(j,ge):j.then((xe=>xe.arrayBuffer())).then((xe=>WebAssembly.instantiate(xe,ge)))).then((xe=>{const{Rb:Ie,Qb:He,P:Ne,T:We,X:at,Ja:ct,La:Gt,Qa:pt,Va:Xt,Wa:ni,eb:ri,jb:vi,f:wi,e:_i,yb:gi,zb:Zt,Ab:$t,Bb:yi,Db:ki,Gb:Ii}=xe.instance.exports;ee=_i;const Dn=(()=>{let tn=0,sn=0,bn=0,Vr=0;return zi=>{bn&&(Ie(Vr),Ie(tn),sn+=bn,bn=tn=0),tn||(sn+=128,tn=He(sn));const wn=zi.length+7&-8;let fr=tn;wn>=sn&&(bn=wn,fr=Vr=He(wn));for(let ha=0;ha<zi.length;ha++)$[fr+ha]=zi[ha];return fr}})();return oe(),wi(),{memory:_i,_free:Ie,_malloc:He,Mesh:class{constructor(){this.ptr=Ne()}destroy(){We(this.ptr)}},Decoder:class{constructor(){this.ptr=ct()}destroy(){vi(this.ptr)}DecodeArrayToMesh(tn,sn,bn){const Vr=Dn(tn),zi=Gt(this.ptr,Vr,sn,bn.ptr);return!!at(zi)}GetAttributeByUniqueId(tn,sn){return{ptr:pt(this.ptr,tn.ptr,sn)}}GetTrianglesUInt16Array(tn,sn,bn){Xt(this.ptr,tn.ptr,sn,bn)}GetTrianglesUInt32Array(tn,sn,bn){ni(this.ptr,tn.ptr,sn,bn)}GetAttributeDataArrayForAllPoints(tn,sn,bn,Vr,zi){ri(this.ptr,tn.ptr,sn.ptr,bn,Vr,zi)}},DT_INT8:gi(),DT_UINT8:Zt(),DT_INT16:$t(),DT_UINT16:yi(),DT_UINT32:ki(),DT_FLOAT32:Ii()}}))})(fetch(uo())),Ni.then((j=>{na=j,Ni=void 0})))})()),V&&k.push((function(){if(ci)return;const j=(function($){let ee;const oe=WebAssembly.instantiateStreaming($,{}).then((xe=>{ee=xe.instance,ee.exports.__wasm_call_ctors()})),se={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ge={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:oe,supported:!0,decodeGltfBuffer(xe,Ie,He,Ne,We,at){(function(ct,Gt,pt,Xt,ni,ri,vi){const wi=ct.exports.sbrk,_i=Xt+3&-4,gi=wi(_i*ni),Zt=wi(ri.length),$t=new Uint8Array(ct.exports.memory.buffer);$t.set(ri,Zt);const yi=Gt(gi,Xt,ni,Zt,ri.length);if(yi===0&&vi&&vi(gi,_i,ni),pt.set($t.subarray(gi,gi+Xt*ni)),wi(gi-wi(0)),yi!==0)throw new Error(`Malformed buffer data: ${yi}`)})(ee,ee.exports[ge[We]],xe,Ie,He,Ne,ee.exports[se[at]])}}})(fetch(Jr()));return j.ready.then((()=>{ci=j}))})()),p)for(let j=0;j<p.length;j++)k.push(bw(p[j],s,j,i));return(k.length?Promise.all(k):Promise.resolve()).then((()=>{if(F&&_)for(const{primitives:j}of _)for(const $ of j)yw($,s);if(V&&_&&E)for(const j of E)xw(j,s);return s}))}))}function vv(r){return fetch(r).then((e=>e.arrayBuffer())).then((e=>xv(e,0,r)))}function Jy(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Qy(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class ex{constructor(e,i,s,u){this.context=e,this.format=s,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:u&&u.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:p}=this,{gl:_}=p,{x:v,y:E}=i&&i.position?i.position:{x:0,y:0},C=v+s,k=E+u;!this.size||this.size[0]===C&&this.size[1]===k||(_.bindTexture(_.TEXTURE_2D,null),_.deleteTexture(this.texture),this.texture=_.createTexture(),this.size=null),_.bindTexture(_.TEXTURE_2D,this.texture),p.pixelStoreUnpackFlipY.set(!1),p.pixelStoreUnpack.set(1),p.pixelStoreUnpackPremultiplyAlpha.set(this.format===_.RGBA8&&(!i||i.premultiply!==!1));const F=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&C>0&&k>0){const V=this.useMipmap?Math.floor(Math.log2(Math.max(C,k)))+1:1;_.texStorage2D(_.TEXTURE_2D,V,this.format,C,k),this.size=[C,k]}this.size&&(F?_.texSubImage2D(_.TEXTURE_2D,0,v,E,Jy(this.format),Qy(this.format),e):"data"in e&&e.data&&_.texSubImage2D(_.TEXTURE_2D,0,v,E,s,u,Jy(this.format),Qy(this.format),e.data)),this.useMipmap&&_.generateMipmap(_.TEXTURE_2D)}bind(e,i,s=!1){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,u,p){const{context:_}=this,{gl:v}=_;v.bindTexture(v.TEXTURE_2D,this.texture),i!==this.magFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,this.useMipmap?e===v.NEAREST?v.NEAREST_MIPMAP_NEAREST:v.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,s),this.wrapS=s),u!==this.wrapT&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,u),this.wrapT=u),p!==this.compareMode&&(p?(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.COMPARE_REF_TO_TEXTURE),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_FUNC,p)):v.texParameteri(v.TEXTURE_2D,v.TEXTURE_COMPARE_MODE,v.NONE),this.compareMode=p)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class bg{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}const ww=Zr([{name:"a_pos_3f",components:3,type:"Float32"}]),Tw=Zr([{name:"a_color_3f",components:3,type:"Float32"}]),Sw=Zr([{name:"a_color_4f",components:4,type:"Float32"}]),Ew=Zr([{name:"a_uv_2f",components:2,type:"Float32"}]),Aw=Zr([{name:"a_normal_3f",components:3,type:"Float32"}]),Iw=Zr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Mw=Zr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function bv(r,e){const i=cy(r.projection,r.zoom,r.width,r.height),s=(function(p,_,v,E,C){const k=new a(v.lng-180*v_,v.lat),F=new a(v.lng+180*v_,v.lat),V=p.project(k.lng,k.lat),j=p.project(F.lng,F.lat),$=-Math.atan2(j.y-V.y,j.x-V.x),ee=Te.fromLngLat(v);ee.y=te(ee.y,-1+v_,1-v_);const oe=ee.toLngLat(),se=p.project(oe.lng,oe.lat),ge=Te.fromLngLat(oe);ge.x+=v_;const xe=ge.toLngLat(),Ie=p.project(xe.lng,xe.lat),He=Tv(Ie.x-se.x,Ie.y-se.y,$),Ne=Te.fromLngLat(oe);Ne.y+=v_;const We=Ne.toLngLat(),at=p.project(We.lng,We.lat),ct=Tv(at.x-se.x,at.y-se.y,$),Gt=Math.abs(He.x)/Math.abs(ct.y),pt=Wi([]);qi(pt,pt,-$*(1-(C?0:E)));const Xt=Wi([]);return Vn(Xt,Xt,[1,1-(1-Gt)*E,1]),Xt[4]=-ct.x/ct.y*E,qi(Xt,Xt,$),Ci(Xt,pt,Xt),Xt})(r.projection,0,r.center,i,e),u=wv(r);return Vn(s,s,[u,u,1]),s}function wv(r){const e=r.projection,i=cy(r.projection,r.zoom,r.width,r.height),s=tx(e,r.center),u=tx(e,a.convert(e.center));return Math.pow(2,s*i+(1-i)*u)}function cy(r,e,i,s,u=1/0){const p=r.range;if(!p)return 0;const _=Math.min(u,Math.max(i,s)),v=Math.log2(_/1024);return pe(p[0]+v,p[1]+v,e)}const v_=1/4e4;function tx(r,e){const i=te(e.lat,-Q,Q),s=new a(e.lng-180*v_,i),u=new a(e.lng+180*v_,i),p=r.project(s.lng,i),_=r.project(u.lng,i),v=Te.fromLngLat(s),E=Te.fromLngLat(u),C=_.x-p.x,k=_.y-p.y,F=E.x-v.x,V=E.y-v.y,j=Math.sqrt((F*F+V*V)/(C*C+k*k));return Math.log2(j)}function Tv(r,e,i){const s=Math.cos(i),u=Math.sin(i);return{x:r*s-e*u,y:r*u+e*s}}function Sv(r,e,i){Wi(r),qi(r,r,fi(e[2])),Oi(r,r,fi(e[0])),Hn(r,r,fi(e[1])),Vn(r,r,i),Ci(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function uy(r,e,i,s,u,p,_,v){const E=[i[0]-e[0],i[1]-e[1],0],C=[s[0]-e[0],s[1]-e[1],0];if(Qr(E)<1e-12||Qr(C)<1e-12)return qs(r);const k=Ir([],E,C);Cn(k,k),Rn(C,s,e),E[2]=(p-u)*v,C[2]=(_-u)*v;const F=E;return Ir(F,E,C),Cn(F,F),Sn(r,k,F)}function hy(r,e,i=!1){const s=tu(e.zoom),u=(function(p,_,v){const E=_.worldSize,C=[p[12],p[13],p[14]],k=Y(C[1]/E),F=U(C[0]/E),V=Wi([]),j=N(1,k)*E,$=N(1,0)*E*ie(k,_.zoom),ee=1/$p(E);let oe=$*ee;if(v){const Ie=cy(_.projection,_.zoom,_.width,_.height,1024);oe=ee*_.projection.pixelSpaceConversion(_.center.lat,E,Ie)}const se=Au(k,F);yn(se,se,ai([],Cn([],se),j*oe*C[2]));const ge=(function(Ie){const He=[Ie[0],Ie[1],Ie[2]];let Ne=[0,1,0];const We=Ir([],Ne,He);return Ir(Ne,He,We),Mr(Ne)===0&&(Ne=[0,1,0],Ir(We,He,Ne)),Cn(We,We),Cn(Ne,Ne),Cn(He,He),[We[0],We[1],We[2],0,Ne[0],Ne[1],Ne[2],0,He[0],He[1],He[2],0,Ie[0],Ie[1],Ie[2],1]})(se);Vn(V,V,[oe,oe,oe*j]),Ji(V,V,[-C[0],-C[1],-C[2]]);const xe=Ci([],_.globeMatrix,ge);return Ci(xe,xe,V),Ci(xe,xe,p),xe})(r,e,i);if(s>0){const p=(function(_,v){const E=v.worldSize,C=N(1,0)*E*ie(v.center.lat,v.zoom)/$p(E),k=N(1,v.center.lat)*E,F=Wi([]);Hn(F,F,fi(v.center.lng)),Oi(F,F,fi(v.center.lat)),Ji(F,F,[0,0,ps]),Vn(F,F,[C,C,C*k]);const V=v.point;return Ji(F,F,[-V.x,-V.y,0]),Ci(F,F,_),Ci(F,v.globeMatrix,F)})(r,e);return(function(_,v,E){const C=($,ee,oe)=>{const se=Qr($),ge=Qr(ee),xe=cs($,ee,oe);return ai(xe,xe,1/Qr(xe)*Gn(se,ge,oe))},k=C([_[0],_[1],_[2]],[v[0],v[1],v[2]],E),F=C([_[4],_[5],_[6]],[v[4],v[5],v[6]],E),V=C([_[8],_[9],_[10]],[v[8],v[9],v[10]],E),j=cs([_[12],_[13],_[14]],[v[12],v[13],v[14]],E);return[k[0],k[1],k[2],0,F[0],F[1],F[2],0,V[0],V[1],V[2],0,j[0],j[1],j[2],1]})(u,p,s)}return u}function ix(r,e,i,s){const u=_n.projectAabbCorners(s,i);let p=Number.MAX_VALUE;for(let v=0;v<u.length;++v){const E=u[v];E[0]=(.5*E[0]+.5)*e.width,E[1]=(.5-.5*E[1])*e.height,E[2]<p&&(p=E[2])}const _=(function(v){const E=[];let C=0;for(let j=1;j<v.length;j++)(v[j][0]<v[C][0]||v[j][0]===v[C][0]&&v[j][1]<v[C][1])&&(C=j);let k,F=C;const V=new Uint8Array(v.length);do{if(V[F])break;E.push(new je(v[F][0],v[F][1])),V[F]=1,k=(F+1)%v.length;for(let j=0;j<v.length;j++){if(v[j][0]===v[k][0]&&v[j][1]===v[k][1]||v[j][0]===v[F][0]&&v[j][1]===v[F][1])continue;const $=[v[j][0]-v[F][0],v[j][1]-v[F][1]],ee=[v[k][0]-v[F][0],v[k][1]-v[F][1]],oe=$[0]*ee[1]-$[1]*ee[0];(oe>0||oe===0&&$[0]*ee[0]+$[1]*ee[1]>=0&&$[0]*$[0]+$[1]*$[1]>ee[0]*ee[0]+ee[1]*ee[1])&&(k=j)}F=k}while(F!==C);return E.length>0&&E.push(E[0]),E})(u);if(qr(r,_))return p}const F_=64,Y_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function dy(r,e,i,s,u,p,_,v,E,C=!1){const k=i.zoom,F=i.project(s),V=ie(s.lat,k),j=1/V;Wi(r),Ji(r,r,[F.x+_[0]*j,F.y+_[1]*j,_[2]]);let $=1,ee=1;const oe=i.worldSize;if(C){if(i.projection.name==="mercator"){let Ie=0;i.elevation&&(Ie=i.elevation.getAtPointOrZero(new Te(F.x/oe,F.y/oe),0));const He=la([],[F.x,F.y,Ie,1],i.projMatrix)[3]/i.cameraToCenterDistance;$=He,ee=He*ie(i.center.lat,k)}else if(i.projection.name==="globe"){const Ie=hy(r,i),He=[0,0,0,1];la(He,He,Ci([],i.projMatrix,Ie));const Ne=He[3]/i.cameraToCenterDistance,We=tu(k),at=i.projection.pixelsPerMeter(s.lat,oe)*ie(s.lat,k),ct=i.projection.pixelsPerMeter(i.center.lat,oe)*ie(i.center.lat,k);$=Ne/Gn(at,ae(i.center.lat),We),ee=Ne*V/at,$*=ct,ee*=ct}}else $=j;Vn(r,r,[$,$,ee]);const se=[...r],ge=e.orientation,xe=[];if(Sv(xe,[ge[0]+(u?u[0]:0),ge[1]+(u?u[1]:0),ge[2]+(u?u[2]:0)],p),Ci(r,se,xe),v&&i.elevation){let Ie=0;const He=[];if(E&&i.elevation){Ie=(function(We,at,ct,Gt,pt){const Xt=at.elevation;if(!Xt)return 0;const ni=_n.projectAabbCorners(ct,Gt),ri=N(1,pt.lat)*at.worldSize,vi=(function(sn,bn){const Vr=[0,0,1],zi=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const wn of zi){const fr=sn[wn.corners[0]],ha=sn[wn.corners[1]],xa=sn[wn.corners[2]],Ar=[ha[0]-fr[0],ha[1]-fr[1],bn*(ha[2]-fr[2])],ts=Ir(Ar,Ar,[xa[0]-fr[0],xa[1]-fr[1],bn*(xa[2]-fr[2])]);Cn(ts,ts),wn.dotProductWithUp=Cr(ts,Vr)}return zi.sort(((wn,fr)=>wn.dotProductWithUp-fr.dotProductWithUp)),zi[0].corners})(ni,ri),wi=ni[vi[0]],_i=ni[vi[1]],gi=ni[vi[2]],Zt=ni[vi[3]],$t=Xt.getAtPointOrZero(new Te(wi[0]/at.worldSize,wi[1]/at.worldSize),0),yi=Xt.getAtPointOrZero(new Te(_i[0]/at.worldSize,_i[1]/at.worldSize),0),ki=Xt.getAtPointOrZero(new Te(gi[0]/at.worldSize,gi[1]/at.worldSize),0),Ii=Xt.getAtPointOrZero(new Te(Zt[0]/at.worldSize,Zt[1]/at.worldSize),0),Dn=($t+Ii)/2,tn=(yi+ki)/2;return Dn>tn?yi<ki?uy(We,_i,Zt,wi,yi,Ii,$t,ri):uy(We,gi,wi,Zt,ki,$t,Ii,ri):$t<Ii?uy(We,wi,_i,gi,$t,yi,ki,ri):uy(We,Zt,gi,_i,Ii,ki,yi,ri),Math.max(Dn,tn)})(He,i,e.aabb,r,s);const Ne=Ci([],dn([],He),xe);Ci(r,se,Ne)}else Ie=i.elevation.getAtPointOrZero(new Te(F.x/oe,F.y/oe),0);Ie!==0&&(r[14]+=Ie)}}class Ev{constructor(e,i,s,u,p){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=s!=null?new a(s[0],s[1]):new a(0,0),this.orientation=u??[0,0,0],this.nodes=p,this.uploaded=!1,this.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){Ci(e.globalMatrix,i,e.localMatrix);const s=this.nodeOverrides.get(e.name);if(s!==void 0){const _=[];p=s.orientation,Wi(u=_),Hn(u,u,fi(p[1])),qi(u,u,fi(p[2])),Oi(u,u,fi(p[0])),Ci(e.globalMatrix,e.globalMatrix,_)}var u,p;if(e.meshes)for(const _ of e.meshes){const v=_n.applyTransformFast(_.aabb,e.globalMatrix);this.aabb.encapsulate(v)}if(e.children)for(const _ of e.children)this._applyTransformations(_,e.globalMatrix)}computeBoundsAndApplyParent(){const e=Wi([]);this.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,s,u,p,_,v=!1){dy(this.matrix,this,e.transform,this.position,i,s,u,p,_,v)}upload(e){if(!this.uploaded){for(const i of this.nodes)nx(i,e);for(const i of this.nodes)fy(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)rx(e)}}function wg(r,e,i=!1){r.uploaded||(r.gfxTexture=new ex(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function Cw(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,ww.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,Aw.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,Ew.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?Tw:Sw).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,Mw.members,!0)),r.segments=xs.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const s=r.material;s.pbrMetallicRoughness.baseColorTexture&&wg(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&wg(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&wg(s.normalTexture,e),s.occlusionTexture&&wg(s.occlusionTexture,e,i),s.emissionTexture&&wg(s.emissionTexture,e)}function nx(r,e,i){if(r.meshes)for(const s of r.meshes)Cw(s,e,i);if(r.children)for(const s of r.children)nx(s,e,i)}function fy(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)fy(e)}function rx(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)rx(i)}function N_(r,e){const i=r.json.bufferViews[e.bufferView],s=Rs[e.componentType];return new s(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==Af[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:Af[e.type]))}function ax(r,e,i,s){const u=Rs[e.componentType],p=(function(k){switch(k){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(u),_=r.json.bufferViews[e.bufferView],v=_.byteStride?_.byteStride/u.BYTES_PER_ELEMENT:Af[e.type],E=i.float32,C=E.length/i.capacity;for(let k=0,F=0;k<e.count*v;k+=v,F+=C)for(let V=0;V<C;V++)E[F+V]=s[k+V]*p;i._trim()}function zw(r,e,i){const s=r.indices,u=r.attributes,p={};p.indexArray=new ao;const _=e.json.accessors[s],v=_.count/3;p.indexArray.reserve(v);const E=N_(e,_);for(let V=0;V<v;V++)p.indexArray.emplaceBack(E[3*V],E[3*V+1],E[3*V+2]);p.indexArray._trim(),p.vertexArray=new bc;const C=e.json.accessors[u.POSITION];p.vertexArray.reserve(C.count);const k=N_(e,C);for(let V=0;V<C.count;V++)p.vertexArray.emplaceBack(k[3*V],k[3*V+1],k[3*V+2]);if(p.vertexArray._trim(),p.aabb=new _n(C.min,C.max),p.centroid=(function(V,j){const $=[0,0,0],ee=V.length;if(ee>0){for(let oe=0;oe<ee;oe++){const se=3*V[oe];$[0]+=j[se],$[1]+=j[se+1],$[2]+=j[se+2]}$[0]/=ee,$[1]/=ee,$[2]/=ee}return $})(E,k),u.COLOR_0!==void 0){const V=e.json.accessors[u.COLOR_0],j=Af[V.type],$=N_(e,V);p.colorArray=j===3?new bc:new Bd,p.colorArray.resize(V.count),ax(e,V,p.colorArray,$)}if(u.NORMAL!==void 0){p.normalArray=new bc;const V=e.json.accessors[u.NORMAL];p.normalArray.resize(V.count);const j=N_(e,V);ax(e,V,p.normalArray,j)}if(u.TEXCOORD_0!==void 0&&i.length>0){p.texcoordArray=new Su;const V=e.json.accessors[u.TEXCOORD_0];p.texcoordArray.resize(V.count);const j=N_(e,V);ax(e,V,p.texcoordArray,j)}if(u._FEATURE_ID_RGBA4444!==void 0){const V=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(p.featureData=N_(e,V))}u._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(N_(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const F=r.material;return p.material=(function(V,j){const{emissiveFactor:$=[0,0,0],alphaMode:ee="OPAQUE",alphaCutoff:oe=.5,normalTexture:se,occlusionTexture:ge,emissiveTexture:xe,doubleSided:Ie,name:He}=V,{baseColorFactor:Ne=[1,1,1,1],metallicFactor:We=1,roughnessFactor:at=1,baseColorTexture:ct,metallicRoughnessTexture:Gt}=V.pbrMetallicRoughness||{},pt=ge?j[ge.index]:void 0;if(ge&&ge.extensions&&ge.extensions.KHR_texture_transform&&pt){const Xt=ge.extensions.KHR_texture_transform;pt.offsetScale=[Xt.offset[0],Xt.offset[1],Xt.scale[0],Xt.scale[1]]}return{name:He,pbrMetallicRoughness:{baseColorFactor:new Ta(...Ne),metallicFactor:We,roughnessFactor:at,baseColorTexture:ct?j[ct.index]:void 0,metallicRoughnessTexture:Gt?j[Gt.index]:void 0},doubleSided:Ie,emissiveFactor:new Ta(...$),alphaMode:ee,alphaCutoff:oe,normalTexture:se?j[se.index]:void 0,occlusionTexture:pt,emissionTexture:xe?j[xe.index]:void 0,defined:V.defined===void 0}})(F!==void 0?e.json.materials[F]:{defined:!1},i),p}function Av(r,e,i){const{matrix:s,rotation:u,translation:p,scale:_,mesh:v,extras:E,children:C,name:k}=r,F={};if(F.name=k,F.localMatrix=s||(function(V,j,$,ee){var oe=j[0],se=j[1],ge=j[2],xe=j[3],Ie=oe+oe,He=se+se,Ne=ge+ge,We=oe*Ie,at=oe*He,ct=oe*Ne,Gt=se*He,pt=se*Ne,Xt=ge*Ne,ni=xe*Ie,ri=xe*He,vi=xe*Ne,wi=ee[0],_i=ee[1],gi=ee[2];return V[0]=(1-(Gt+Xt))*wi,V[1]=(at+vi)*wi,V[2]=(ct-ri)*wi,V[3]=0,V[4]=(at-vi)*_i,V[5]=(1-(We+Xt))*_i,V[6]=(pt+ni)*_i,V[7]=0,V[8]=(ct+ri)*gi,V[9]=(pt-ni)*gi,V[10]=(1-(We+Gt))*gi,V[11]=0,V[12]=$[0],V[13]=$[1],V[14]=$[2],V[15]=1,V})([],u||[0,0,0,1],p||[0,0,0],_||[1,1,1]),F.globalMatrix=Vi(F.localMatrix),v!==void 0){F.meshes=i[v];const V=F.anchor=[0,0];for(const j of F.meshes){const{min:$,max:ee}=j.aabb;V[0]+=$[0]+ee[0],V[1]+=$[1]+ee[1]}V[0]=Math.floor(V[0]/F.meshes.length/2),V[1]=Math.floor(V[1]/F.meshes.length/2)}if(E&&(E.id&&(F.id=E.id),E.lights&&(F.lights=(function(V){if(!V.length)return[];const j=(function(ge){const xe=atob(ge),Ie=new Uint8Array(xe.length);for(let He=0;He<xe.length;He++)Ie[He]=xe.codePointAt(He);return Ie})(V),$=[],ee=j.length/24,oe=new Uint16Array(j.buffer),se=new Float32Array(j.buffer);for(let ge=0;ge<ee;ge++){const xe=oe[2*ge*6]/30,Ie=oe[2*ge*6+1]/30,He=oe[2*ge*6+10]/100,Ne=se[6*ge+1],We=se[6*ge+2],at=se[6*ge+3],ct=se[6*ge+4],Gt=at-Ne,pt=ct-We,Xt=Math.hypot(Gt,pt);$.push({pos:[Ne+.5*Gt,We+.5*pt,Ie],normal:[pt/Xt,-Gt/Xt,0],width:Xt,height:xe,depth:He,points:[Ne,We,at,ct]})}return $})(E.lights)),E.MAPBOX_geometry_bloom&&(F.isGeometryBloom=E.MAPBOX_geometry_bloom)),C){const V=[];for(const j of C)V.push(Av(e.json.nodes[j],e,i));F.children=V}return F}function Dw(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Sc(r.vertices,r.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:s}}function Rw(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const _ of i){if(!Array.isArray(_)||_.length!==2)continue;const v=_[0],E=_[1];typeof v=="number"&&typeof E=="number"&&s.push(new je(v,E))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let u=0;for(let _=0;_<s.length;_++){const v=s[_],E=s[(_+1)%s.length],C=s[(_+2)%s.length];u+=(v.x-E.x)*(C.y-E.y)-(C.x-E.x)*(v.y-E.y)}u>0&&s.reverse();const p=Kp(s.flatMap((_=>[_.x,_.y])),[]);return p.length===0?null:{vertices:s,indices:p}}function Pw(r,e){const i=[],s=[];let u=0;const p=[];for(const _ of r){u=i.length;const v=_.vertexArray.float32,E=_.indexArray.uint16;for(let C=0;C<_.vertexArray.length;C++)p[0]=v[3*C+0],p[1]=v[3*C+1],p[2]=v[3*C+2],ra(p,p,e),i.push(new je(p[0],p[1]));for(let C=0;C<3*_.indexArray.length;C++)s.push(E[C]+u)}if(s.length%3!=0)return null;for(let _=0;_<s.length;_+=3){const v=i[s[_+0]],E=i[s[_+1]],C=i[s[_+2]];(v.x-E.x)*(C.y-E.y)-(C.x-E.x)*(v.y-E.y)>0&&([s[_+1],s[_+2]]=[s[_+2],s[_+1]])}return{vertices:i,indices:s}}function sx(r){const e=(function(E,C){const k=[],F=WebGL2RenderingContext;if(E.json.textures)for(const V of E.json.textures){const j={magFilter:F.LINEAR,minFilter:F.NEAREST,wrapS:F.REPEAT,wrapT:F.REPEAT};V.sampler!==void 0&&Object.assign(j,E.json.samplers[V.sampler]),k.push({image:C[V.source],sampler:j,uploaded:!1})}return k})(r,r.images),i=(function(E,C){const k=[];for(const F of E.json.meshes){const V=[];for(const j of F.primitives)V.push(zw(j,E,C));k.push(V)}return k})(r,e),{scenes:s,scene:u,nodes:p}=r.json,_=s?s[u||0].nodes:[...p.keys()],v=[];for(const E of _)v.push(Av(p[E],r,i));return(function(E,C,k){const F={},V=new Set;for(let j=0;j<E.length;j++){const $=k[C[j]];if(!$.extras)continue;const ee=$.extras["mapbox:footprint:version"],oe=$.extras["mapbox:footprint:id"];(ee||oe)&&V.add(j),ee==="1.0.0"&&oe&&(F[oe]=j)}for(let j=0;j<E.length;j++){if(V.has(j))continue;const $=E[j],ee=k[C[j]];if(!ee.extras)continue;let oe=null;$.id in F&&(oe=Pw(E[F[$.id]].meshes,$.localMatrix)),oe||(oe=Rw(ee)),oe&&($.footprint=Dw(oe))}if(V.size>0){const j=Array.from(V.values()).sort((($,ee)=>$-ee));for(let $=j.length-1;$>=0;$--)E.splice(j[$],1)}})(v,_,r.json.nodes),v}function Lw(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,s=r.aabb.min[1]-1,u=F_/(r.aabb.max[0]-i+2),p=F_/(r.aabb.max[1]-s+2);for(let _=0;_<e.length;_+=3){const v=e[_+2],E=(e[_+0]-i)*u|0,C=(e[_+1]-s)*p|0;v>r.heightmap[C*F_+E]&&(r.heightmap[C*F_+E]=v)}}function Iv(r,e,i,s,u){i.reserve(i.length+4*r.length),s.reserve(s.length+10*r.length),u.reserve(u.length+10*r.length);let p=s.length;for(const _ of r){const v=Math.min(10,Math.max(4,1.3*_.height))*e,E=[-_.normal[1],_.normal[0],0],C=Math.min(.29,.1*_.width/_.depth),k=_.width-2*_.depth*e*(C+.01),F=ln([],_.pos,E,k/2),V=ln([],_.pos,E,-k/2),j=[F[0],F[1],F[2]+_.height],$=[V[0],V[1],V[2]+_.height],ee=ln([],_.normal,E,C);ai(ee,ee,v);const oe=ln([],_.normal,E,-C);ai(oe,oe,v),yn(ee,F,ee),yn(oe,V,oe),F[2]+=.1,V[2]+=.1,s.emplaceBack(ee[0],ee[1],ee[2]),s.emplaceBack(oe[0],oe[1],oe[2]),s.emplaceBack(F[0],F[1],F[2]),s.emplaceBack(V[0],V[1],V[2]),s.emplaceBack(j[0],j[1],j[2]),s.emplaceBack($[0],$[1],$[2]),s.emplaceBack(F[0],F[1],F[2]),s.emplaceBack(V[0],V[1],V[2]),s.emplaceBack(ee[0],ee[1],ee[2]),s.emplaceBack(oe[0],oe[1],oe[2]);const se=k/v/2;u.emplaceBack(-se-C,-1,se,.8),u.emplaceBack(se+C,-1,se,.8),u.emplaceBack(-se,0,se,1.3),u.emplaceBack(se,0,se,1.3),u.emplaceBack(se+C,-.8,se,.7),u.emplaceBack(se+C,-.8,se,.7),u.emplaceBack(0,0,se,1.3),u.emplaceBack(0,0,se,1.3),u.emplaceBack(se+C,-1.2,se,.8),u.emplaceBack(se+C,-1.2,se,.8),i.emplaceBack(6+p,4+p,8+p),i.emplaceBack(7+p,9+p,5+p),i.emplaceBack(0+p,1+p,2+p),i.emplaceBack(1+p,3+p,2+p),p+=10}}function kw(r,e){const i={};i.indexArray=new ao,i.vertexArray=new bc,i.colorArray=new Bd,Iv(r,e,i.indexArray,i.vertexArray,i.colorArray);const s={defined:!0};s.emissiveFactor=Ta.black;const u={};return u.baseColorFactor=Ta.white,s.pbrMetallicRoughness=u,i.material=s,i.aabb=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const Mv=Zr([{name:"a_pos_3f",components:3,type:"Float32"}]),Ow=Zr([{name:"a_normal_3",components:3,type:"Int16"}]),Bw=Zr([{name:"a_centroid_3",components:3,type:"Int16"}]),Cv=Zr([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Fw=Zr([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Nw=Zr([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Vw=Zr([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Uw=Zr([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),jw=Zr([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),zv=ht.types,py=32767;function Gw(r,e){const i=pi+e;for(const s of r)for(const u of s)if(u.x<-e||u.x>i||u.y<-e||u.y>i)return!1;return!0}function qw(r){switch(r){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${r}`)}}class ox{constructor(){this.layoutVertexArray=new bc,this.layoutAttenuationArray=new Bd,this.layoutColorArray=new Tu,this.indexArray=new ao,this.indexArrayForConflation=new ao,this.segmentsBucket=new xs}}class lx{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new xs,this.entranceBloom=new ox;const i=66560;this.layoutVertexArray=new bc,this.layoutVertexArray.reserve(i),this.layoutNormalArray=new Od,this.layoutNormalArray.reserve(i),this.layoutCentroidArray=new Od,this.layoutCentroidArray.reserve(i),this.layoutColorArray=new Tu,this.layoutColorArray.reserve(i),this.layoutFloodLightDataArray=new Eu,this.layoutFloodLightDataArray.reserve(i),this.layoutAOArray=new dl,this.layoutAOArray.reserve(i),this.indexArray=new ao,this.indexArray.reserve(66560),this.indexArrayForConflation=new ao,this.segmentsBucket=new xs,this.entranceBloom=new ox,e&&(this.layoutFacadePaintArray=new Tu,this.layoutFacadeDataArray=new ph,this.layoutFacadeVerticalRangeArray=new Tu)}reserve(e,i,s){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(i),s&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class Dv{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Su,this.footprintsIndices=new Eu,this.footprintsMin=new je(1/0,1/0),this.footprintsMax=new je(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new lx(!1),this.buildingWithFacade=new lx(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new yh(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.projection=e.projection,this.groundEffect=new ru(e),this.groundEffect.groundRadiusArray=new Zh,this.hasAppearances=null}updateFootprints(e,i){const s=new Sc([],[],1),u={vertices:[],indices:new Uint32Array(0),grid:s,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};i.push({footprint:u,id:e})}updateAppearances(e,i,s,u){}prepare(){return(function(){if(ua!=null||un!=null)return null;if(Ai!=null)return Ai;const e=fetch(Rr.BUILDING_GEN_URL);return Ai=(function(i){let s,u,p,_,v;function E(){s=new Uint8Array(v.buffer),u=new Int16Array(v.buffer),p=new Int32Array(v.buffer),_=new Float32Array(v.buffer)}function C(){throw new Error("Unexpected BuildingGen error.")}const k=()=>{},F={a:{a:C,f:function(V){const j=s.length,$=Math.max(V>>>0,Math.ceil(1.2*j)),ee=Math.ceil(($-j)/65536);try{return v.grow(ee),E(),!0}catch{return!1}},g:C,b:k,c:k,d:k,e:k}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,F):i.then((V=>V.arrayBuffer())).then((V=>WebAssembly.instantiate(V,F)))).then((V=>{const j=V.instance.exports;return(0,j.g)(),v=j.f,E(),new Li({setStyle:j.h,setAOOptions:j.i,setMetricOptions:j.j,setStructuralOptions:j.k,setFacadeOptions:j.l,setFauxFacadeOptions:j.m,setFacadeClassifierOptions:j.n,addFeature:j.o,addFacade:j.p,generateMesh:j.q,getLastError:j.r,getOuterRingLength:j.s,getMeshCount:j.t,getPositionsPtr:j.u,getPositionsLength:j.v,getNormalsPtr:j.w,getNormalsLength:j.x,getAOPtr:j.y,getAOLength:j.z,getUVPtr:j.A,getUVLength:j.B,getFauxFacadePtr:j.C,getFauxFacadeLength:j.D,getIndicesPtr:j.E,getIndicesLength:j.F,getBuildingPart:j.G,getRingCount:j.H,getRingPtr:j.I,getRingLength:j.J,malloc:j.K,free:j.L,heapU8:s,heap16:u,heap32:p,heapF32:_})}))})(e).then((i=>(Ai=null,ua=i,ua))).catch((i=>{Bi("Could not load building-gen"),Ai=null,un=i})),Ai})()}populate(e,i,s,u){const p=_s();if(!p)return;const _=fe(s);this.tileToMeter=_,this.brightness=i.brightness,p.setStyle({normalScale:[1,-1,_],tileToMeters:_}),p.setAOOptions(!1,.3),p.setMetricOptions(!1,16),p.setStructuralOptions(!0),p.setFacadeClassifierOptions(3);const v=new Map,E=new Map;let C=0;for(const{feature:se}of e){if(zv[se.type]!=="LineString"){v.set(se.id,se.properties.source_id);continue}const ge=this.layers[0]._featureFilter.needGeometry;if(ge&&!this.layers[0]._featureFilter.filter(new Xa(this.zoom),se,s))continue;const xe=ft(se,ge);if(!ge&&!this.layers[0]._featureFilter.filter(new Xa(this.zoom),xe,s))continue;const Ie=ge?xe.geometry:it(se,s,u),He=[];for(const ct of Ie)for(const Gt of ct)He.push(Gt.x),He.push(Gt.y);const Ne={coordinates:He,crossPerc:se.properties.cross_perc,distanceToRoad:se.properties.distance_to_road,entrances:se.properties.entrances,sourceId:0},We=se.properties.source_id;let at=E.get(We);at||(at=[],E.set(We,at)),at.push(Ne),++C}this.maxHeight=0;const k=new Array,F=new Set,V=se=>{se!=null&&F.add(se)},j=(se,ge)=>{se!=null&&k.push({buildingId:se,footprintIndex:ge})},$=64*(e.length-C),ee=$/2;this.buildingWithFacade.reserve($,ee,!0),this.buildingWithoutFacade.reserve(2*$,2*ee,!1),this.footprintsIndices.reserve(16*(e.length-C)),this.footprintsVertices.reserve(8*(e.length-C));for(const{feature:se,id:ge,index:xe,sourceLayerIndex:Ie}of e){if(zv[se.type]==="LineString")continue;const He=this.layers[0]._featureFilter.needGeometry;if(He&&!this.layers[0]._featureFilter.filter(new Xa(this.zoom),se,s))continue;let Ne=null;if(se.properties&&se.properties.hasOwnProperty("building_id")&&(Ne=se.properties.building_id,F.has(Ne)))continue;const We=ft(se,He);if(!He&&!this.layers[0]._featureFilter.filter(new Xa(this.zoom),We,s))continue;const at=He?We.geometry:it(se,s,u),ct=si(at,500);let Gt=!1;for(const Kn of ct)if(Kn.length!==1){Gt=!0;break}if(Gt){V(Ne);continue}if(!Gw(at,163)){V(Ne);continue}const pt=this.layers[0],Xt=qw(pt.layout.get("building-roof-shape").evaluate(se,{},s)),ni=pt.layout.get("building-base").evaluate(se,{},s),ri=pt.layout.get("building-height").evaluate(se,{},s),vi=pt.layout.get("building-flood-light-ground-radius").evaluate(se,{},s),wi=pt.paint.get("building-ambient-occlusion-intensity"),_i=vi/this.tileToMeter;se.properties["building-part"]="roof";const gi=pt.paint.get("building-color").evaluate(se,{},this.canonical).toPremultipliedRenderColor(this.lut),Zt=pt.paint.get("building-emissive-strength").evaluate(se,{},this.canonical);se.properties["building-part"]="wall";const $t=pt.paint.get("building-color").evaluate(se,{},this.canonical).toPremultipliedRenderColor(this.lut),yi=pt.paint.get("building-emissive-strength").evaluate(se,{},this.canonical);se.properties["building-part"]="window";const ki=pt.paint.get("building-color").evaluate(se,{},this.canonical).toPremultipliedRenderColor(this.lut),Ii=pt.paint.get("building-emissive-strength").evaluate(se,{},this.canonical);se.properties["building-part"]="door";const Dn=pt.paint.get("building-color").evaluate(se,{},this.canonical).toPremultipliedRenderColor(this.lut),tn=pt.paint.get("building-emissive-strength").evaluate(se,{},this.canonical);let sn=pt.layout.get("building-flood-light-wall-radius").evaluate(se,{},s);sn=te(sn,0,2048);const bn=sn/2048*py,Vr=v.get(ge),zi=E.get(Vr)||[],wn=zi.length!==0&&pt.layout.get("building-facade").evaluate(se,{},s);p.setFacadeOptions(4,!0),p.setFauxFacadeOptions(wn,!1,1);let fr=0,ha=0,xa=0,Ar=0,ts=0,Ue=0,$e=0,Wt=0,bi=0,Zi=0,Xi=0;if(wn){let Kn=Math.round(pt.layout.get("building-facade-floors").evaluate(se,{},s));if(ni===0){Kn=Math.max(1,Kn-(zi.length>0?1:0));let Ka=4;if(ri>100){const Xs=[10,13,15];Ka=Xs[se.id?se.id%Xs.length:0]}else ri<=10&&(Ka=3);p.setFacadeOptions(Ka,!0),ts=(ri<15?1.3:1.61803)*Ka/_}else ts=ni/_;Ue=ri/_,ts=Math.min(ts,Ue),xa=pt.layout.get("building-facade-unit-width").evaluate(se,{},s)/_,Ar=(Ue-ts)/Kn,p.setFauxFacadeOptions(!0,!0,xa);const ro=pt.layout.get("building-facade-window").evaluate(se,{},s);fr=ro[0],ha=ro[1],$e=Math.floor(65535*Math.min(1,ts/pi)),Wt=Math.floor(65535*Math.min(1,Ue/pi)),bi=Math.floor(255*fr)<<8|Math.floor(255*ha),Zi=Math.floor(65535*Math.min(1,xa/pi)),Xi=Math.floor(65535*Math.min(1,Ar/pi))}const Pn=Array(ct.length),Bn={x:1/0,y:1/0},br={x:-1/0,y:-1/0},Lr={x:0,y:0};let Nr=0;for(let Kn=0;Kn<ct.length;Kn++){const ro=ct[Kn];if(ro.length>0){const Ka=[],Xs=Array(ro.length+1);Xs[0]=0;for(let Il=0;Il<ro.length;Il++){const oc=ro[Il];for(let ll=0;ll<oc.length;ll++){const cl=oc[oc.length-ll-1];Bn.x=Math.min(Bn.x,cl.x),Bn.y=Math.min(Bn.y,cl.y),br.x=Math.max(br.x,cl.x),br.y=Math.max(br.y,cl.y),Lr.x+=cl.x,Lr.y+=cl.y,Nr++,Ka.push(cl.x),Ka.push(cl.y)}Xs[Il+1]=Ka.length}Pn[Kn]={id:se.id?se.id:0,height:ri,minHeight:ni,sourceId:0,roofType:Xt,coordinates:Ka,ringIndices:Xs}}}Lr.x/=Nr||1,Lr.y/=Nr||1;const sa=p.generateMesh(Pn,zi);if(typeof sa=="string"){Bi(`Unable to generate building ${se.id}: ${sa}`),V(Ne);continue}if(sa.meshes.length===0||sa.modifiedPolygonRings.length===0){V(Ne);continue}const er=wn?this.buildingWithFacade:this.buildingWithoutFacade;let ur=0;for(const Kn of sa.meshes)ur+=Kn.positions.length/3;const Ea=er.segmentsBucket.prepareSegment(ur,er.layoutVertexArray,er.indexArray),Ca=[];let za=null,Ya=0,us=-1;const is=er.layoutVertexArray.length,Pa=is+ur;er.layoutVertexArray.resize(Pa),er.layoutCentroidArray.resize(Pa),er.layoutNormalArray.resize(Pa),er.layoutAOArray.resize(Pa),er.layoutColorArray.resize(Pa),er.layoutFloodLightDataArray.resize(Pa),wn&&(er.layoutFacadePaintArray.resize(Pa),er.layoutFacadeDataArray.resize(Pa),er.layoutFacadeVerticalRangeArray.resize(Pa));const Va=er.indexArray.length;let kr=0,pa=is;for(const Kn of sa.meshes){let ro,Ka;if(Kn.buildingPart===1)ro=gi,Ka=Zt;else if(Kn.buildingPart===0)ro=$t,Ka=yi;else if(Kn.buildingPart===2)ro=ki,Ka=Ii;else{if(Kn.buildingPart!==3)continue;ro=Dn,Ka=tn}if(Ka=te(Ka,0,1),Kn.buildingPart===3){const As=new Array;for(let Ml=0;Ml<Kn.positions.length;Ml+=12){const Tp=Kn.positions[Ml+0],Pm=Kn.positions[Ml+1],su=Kn.positions[Ml+3],Ah=Kn.positions[Ml+4],qd=Kn.positions[Ml+2],S_=Kn.positions[Ml+8]-qd,cg=1,om=su-Tp,lm=Ah-Pm,$g=Math.hypot(om,lm);As.push({pos:[Tp+.5*om,Pm+.5*lm,qd],normal:[lm/$g,-om/$g,0],width:$g,height:S_,depth:cg,points:[Tp,Pm,su,Ah]})}const zo=er.entranceBloom.segmentsBucket.prepareSegment(10*As.length,er.entranceBloom.layoutVertexArray,er.entranceBloom.indexArray),No=er.entranceBloom.layoutVertexArray.length;Ya=er.entranceBloom.indexArray.length,Iv(As,.5/this.tileToMeter,er.entranceBloom.indexArray,er.entranceBloom.layoutVertexArray,er.entranceBloom.layoutAttenuationArray);const Td=er.entranceBloom.layoutVertexArray.length-No;us=er.entranceBloom.indexArray.length-Ya;for(let Ml=0;Ml<Td;Ml++)er.entranceBloom.layoutColorArray.emplaceBack(255*Dn.r<<8|255*Dn.g,255*Dn.b<<8|51*tn);zo.vertexLength+=Td,zo.primitiveLength+=us,za={part:Kn.buildingPart,vertexOffset:No,vertexLength:Td}}er.layoutVertexArray.float32.set(Kn.positions,3*pa);const Xs=Kn.positions.length/3;for(let As=0;As<Xs;++As){const zo=3*As;kr=Math.max(kr,Kn.positions[zo+2]);const No=Kn.normals[zo+1]*py,Td=Kn.normals[zo+2]*py,Ml=3*(pa+As);er.layoutNormalArray.int16[Ml]=Kn.normals[zo]*py,er.layoutNormalArray.int16[Ml+1]=No,er.layoutNormalArray.int16[Ml+2]=Td;const Tp=Kn.ao[As];er.layoutAOArray.uint8[pa+As]=255*Tp;const Pm=1+(Tp-1)*wi,su=255*ro.b*Pm<<8|255*Ka;er.layoutColorArray.uint16[2*(pa+As)]=255*ro.r*Pm<<8|255*ro.g*Pm,er.layoutColorArray.uint16[2*(pa+As)+1]=su}const Il=Math.floor(Lr.x),oc=Math.floor(Lr.y),ll=Math.floor(ri);for(let As=0;As<Xs;++As){const zo=3*(pa+As);er.layoutCentroidArray.int16[zo]=Il,er.layoutCentroidArray.int16[zo+1]=oc,er.layoutCentroidArray.int16[zo+2]=ll}if(er.layoutFloodLightDataArray.uint16.fill(Kn.buildingPart===0?bn:0,pa,pa+Xs),wn){const As=255*ki.r<<8|255*ki.g,zo=255*ki.b<<8|255*Ii;for(let No=0;No<Xs;++No){const Td=2*(pa+No);er.layoutFacadePaintArray.uint16[Td]=As,er.layoutFacadePaintArray.uint16[Td+1]=zo}for(let No=0;No<Xs;++No)if(Kn.isFauxFacade[No]){const Td=Math.min(65535,Math.floor(Kn.uv[2*No]*sa.outerRingLength));er.layoutFacadeDataArray.emplace(pa+No,1|Td,bi,Zi,Xi),er.layoutFacadeVerticalRangeArray.emplace(pa+No,$e,Wt)}else er.layoutFacadeDataArray.emplace(pa+No,0,0,0,0),er.layoutFacadeVerticalRangeArray.emplace(pa+No,0,0)}const cl=Ea.vertexLength,Zl=Kn.indices.length/3,Kh=er.indexArray.length;er.indexArray.resize(Kh+Zl);for(let As=0;As<Zl;++As){const zo=3*As,No=3*Kh+zo;er.indexArray.uint16[No]=cl+Kn.indices[zo],er.indexArray.uint16[No+1]=cl+Kn.indices[zo+1],er.indexArray.uint16[No+2]=cl+Kn.indices[zo+2]}Kn.buildingPart!==1&&Kn.buildingPart!==0&&Kn.buildingPart!==2&&Kn.buildingPart!==3||Ca.push({part:Kn.buildingPart,vertexOffset:pa,vertexLength:Kn.positions.length/3}),pa+=Xs,Ea.vertexLength+=Xs,Ea.primitiveLength+=Kn.indices.length/3}this.maxHeight=Math.max(this.maxHeight,kr);const to=er.indexArray.length-Va,Yn=this.footprintsIndices.length,oa=this.footprintsVertices.length,as=[],gs=new je(1/0,1/0),Ps=new je(-1/0,-1/0),Fo=this.groundEffect.vertexArray.length;for(const Kn of sa.modifiedPolygonRings){const ro=[],Ka=new je(1/0,1/0),Xs=new je(-1/0,-1/0);for(let Il=0;Il<Kn.length;Il+=2){const oc=Kn.length-Il-2;Ka.x=Math.min(Ka.x,Kn[oc]),Ka.y=Math.min(Ka.y,Kn[oc+1]),Xs.x=Math.max(Xs.x,Kn[oc]),Xs.y=Math.max(Xs.y,Kn[oc+1]);const ll=new je(Kn[oc],Kn[oc+1]);ro.push(ll),as.push(ll.x,ll.y),this.footprintsVertices.emplaceBack(ll.x,ll.y)}gs.x=Math.min(gs.x,Ka.x),gs.y=Math.min(gs.y,Ka.y),Ps.x=Math.max(Ps.x,Xs.x),Ps.y=Math.max(Ps.y,Xs.y),this.groundEffect.addData(ro,[Ka,Xs],_i)}const Es=this.groundEffect.vertexArray.length-Fo;this.groundEffect.groundRadiusArray.reserveForAdditional(Es);for(let Kn=0;Kn<Es;Kn++)this.groundEffect.groundRadiusArray.emplaceBack(vi);(Bn.x<0||br.x>pi||Bn.y<0||br.y>pi)&&this.featuresOnBorder.push({featureId:se.id,footprintIndex:this.footprints.length});{const Kn=Kp(as,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+Kn.length),this.footprintsIndices.uint16.set(Kn,Yn),this.buildingIds.add(Ne??se.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,gs.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,gs.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Ps.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Ps.y);const ro={footprintVertexOffset:oa,footprintVertexLength:this.footprintsVertices.length-oa,footprintIndexOffset:Yn,footprintIndexLength:this.footprintsIndices.length-Yn,min:gs,max:Ps,hiddenFlags:0,indicesOffset:Va,indicesLength:to,bloomIndicesOffset:Ya,bloomIndicesLength:us,groundEffectVertexOffset:Fo,groundEffectVertexLength:Es,hasFauxFacade:wn,height:kr,promoteId:ge,feature:We,parts:Ca,buildingBloom:za},Ka=this.footprints.length;se.id!==void 0&&this.featureFootprintLookup.set(se.id,Ka),j(Ne,Ka),this.footprints.push(ro)}this.programConfigurations.populatePaintArrays(er.layoutVertexArray.length,se,xe,{},i.availableImages,s,i.brightness),this.groundEffect.addPaintPropertiesData(se,xe,{},i.availableImages,s,i.brightness),i.featureIndex.insert(se,at,xe,Ie,this.index,is)}k.forEach((({buildingId:se,footprintIndex:ge})=>{F.has(se)&&(this.footprints[ge].hiddenFlags|=4)}));const oe=new Set;this.buildingIds.forEach(((se,ge,xe)=>{F.has(se)||oe.add(se)})),this.buildingIds=oe,this.groundEffect.prepareBorderSegments()}update(e,i,s,u,p,_,v){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,v),this.groundEffect.update(e,i,p,s,u,_,v),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=s=>{s.layoutVertexBuffer=e.createVertexBuffer(s.layoutVertexArray,Mv.members),s.layoutNormalBuffer=e.createVertexBuffer(s.layoutNormalArray,Ow.members),s.layoutCentroidBuffer=e.createVertexBuffer(s.layoutCentroidArray,Bw.members),s.layoutFloodLightDataBuffer=e.createVertexBuffer(s.layoutFloodLightDataArray,jw.members),s.layoutFacadeDataArray&&s.layoutFacadeDataArray.length&&(s.layoutFacadeDataBuffer=e.createVertexBuffer(s.layoutFacadeDataArray,Nw.members)),s.layoutFacadeVerticalRangeArray&&s.layoutFacadeVerticalRangeArray.length&&(s.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(s.layoutFacadeVerticalRangeArray,Vw.members)),s.entranceBloom.layoutVertexArray.length&&(s.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(s.entranceBloom.layoutVertexArray,Mv.members),s.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(s.entranceBloom.layoutAttenuationArray,Uw.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,s=!0){let u=!1;const p=s?i:0,_=0|(s?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of e){const E=this.footprints[v],C=E.hiddenFlags&_|p;E.hiddenFlags!==C&&(E.hiddenFlags=C,u=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const u of this.footprints){const p=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,_=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let E=u.indicesOffset;E<_;E++)p.indexArrayForConflation.uint16[3*E+0]=0,p.indexArrayForConflation.uint16[3*E+1]=0,p.indexArrayForConflation.uint16[3*E+2]=0;const v=u.bloomIndicesOffset+u.bloomIndicesLength;for(let E=u.bloomIndicesOffset;E<v;E++)p.entranceBloom.indexArrayForConflation.uint16[3*E+0]=0,p.entranceBloom.indexArrayForConflation.uint16[3*E+1]=0,p.entranceBloom.indexArrayForConflation.uint16[3*E+2]=0}}const s=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=s=>{s.layoutColorBuffer?s.layoutColorBuffer.updateData(s.layoutColorArray):s.layoutColorBuffer=e.createVertexBuffer(s.layoutColorArray,Cv.members,!0),s.layoutFacadePaintArray&&(s.layoutFacadePaintBuffer?s.layoutFacadePaintBuffer.updateData(s.layoutFacadePaintArray):s.layoutFacadePaintBuffer=e.createVertexBuffer(s.layoutFacadePaintArray,Fw.members,!0)),s.entranceBloom.layoutColorBuffer?s.entranceBloom.layoutColorBuffer.updateData(s.entranceBloom.layoutColorArray):s.entranceBloom.layoutColorBuffer=e.createVertexBuffer(s.entranceBloom.layoutColorArray,Cv.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const s=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.footprints){if(4&u.hiddenFlags)continue;const p=i[u.promoteId],_=u.feature;_.properties["building-part"]="roof";const v=e.paint.get("building-color").evaluate(_,p,this.canonical).toPremultipliedRenderColor(this.lut),E=e.paint.get("building-emissive-strength").evaluate(_,p,this.canonical);_.properties["building-part"]="wall";const C=e.paint.get("building-color").evaluate(_,p,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(_,p,this.canonical);_.properties["building-part"]="window";const F=e.paint.get("building-color").evaluate(_,p,this.canonical).toPremultipliedRenderColor(this.lut),V=e.paint.get("building-emissive-strength").evaluate(_,p,this.canonical);_.properties["building-part"]="door";const j=e.paint.get("building-color").evaluate(_,p,this.canonical).toPremultipliedRenderColor(this.lut),$=e.paint.get("building-emissive-strength").evaluate(_,p,this.canonical),ee=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const se of u.parts){let ge,xe=v;se.part===1?(xe=v,ge=E):se.part===0?(xe=C,ge=k):se.part===2?(xe=F,ge=V):se.part===3&&(xe=j,ge=$),ge=te(ge,0,1);for(let Ie=0;Ie<se.vertexLength;Ie++){const He=se.vertexOffset+Ie,Ne=1+(ee.layoutAOArray.uint8[He]/255-1)*s;ee.layoutColorArray.emplace(He,xe.r*Ne*255<<8|xe.g*Ne*255,xe.b*Ne*255<<8|255*ge),u.hasFauxFacade&&ee.layoutFacadePaintArray.emplace(He,255*F.r<<8|255*F.g,255*F.b<<8|255*V)}}const oe=u.buildingBloom;if(oe)for(let se=0;se<oe.vertexLength;se++)ee.entranceBloom.layoutColorArray.emplace(oe.vertexOffset+se,255*j.r<<8|255*j.g,255*j.b<<8|51*$)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(Th(this.activeReplacements,u))return;this.activeReplacements=u;for(const _ of this.footprints)_.hiddenFlags&=-2;const p=[];for(const _ of this.activeReplacements){if(_.order<=vo)continue;const v=Math.max(1,Math.pow(2,_.footprintTileId.canonical.z-e.canonical.z));for(const E of this.footprints)E.min.x>_.max.x||E.max.x<_.min.x||E.min.y>_.max.y||E.max.y<_.min.y||(p.length=0,$w(this.footprintsVertices,E.footprintVertexOffset,E.footprintVertexLength,_.footprintTileId.canonical,e.canonical,p),Al(_.footprint,p,this.footprintsIndices.uint16,E.footprintIndexOffset,E.footprintIndexLength,0,-v)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(_.groundEffectVertexOffset,_.groundEffectVertexLength,_.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,u=!0;const p=4*(e+pi)*pi+(i+pi);if(this.footprintLookup.hasOwnProperty(p)){const v=this.footprintLookup[p];return v?{height:v.height,hidden:v.hiddenFlags!==0}:void 0}const _=new je(e,i);for(const v of this.footprints)e>v.max.x||v.min.x>e||i>v.max.y||v.min.y>i||v.height<=s||Hw(_,this.footprintsVertices.float32.subarray(2*v.footprintVertexOffset,2*(v.footprintVertexOffset+v.footprintVertexLength)),this.footprintsIndices.uint16.subarray(v.footprintIndexOffset,v.footprintIndexOffset+v.footprintIndexLength))&&(s=v.height,this.footprintLookup[p]=v,u=v.hiddenFlags!==0);if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:u};this.footprintLookup[p]=void 0}}function Hw(r,e,i){for(let s=0;s<i.length;s+=3){const u=i[s],p=i[s+1],_=i[s+2],v=e[2*u+0],E=e[2*u+1],C=e[2*p+0],k=e[2*p+1],F=e[2*_+0],V=e[2*_+1],j=(v-F)*(r.y-V)-(E-V)*(r.x-F),$=(C-v)*(r.y-E)-(k-E)*(r.x-v);if(j<0!=$<0&&j!==0&&$!==0)continue;const ee=(F-C)*(r.y-k)-(V-k)*(r.x-C);if(ee===0||ee<0==j+$<=0)return!0}return!1}function $w(r,e,i,s,u,p){const _=Math.pow(2,s.z-u.z);for(let v=0;v<i;v++){let E=r.float32[2*(v+e)+0],C=r.float32[2*(v+e)+1];E=(E+u.x*pi)*_-s.x*pi,C=(C+u.y*pi)*_-s.y*pi,p.push(new je(E,C))}}let Rv,Pv;di(Dv,"BuildingBucket",{omit:["layers"]}),di(lx,"BuildingGeometry"),di(ox,"BuildingBloomGeometry");const Zw=Zr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Xw=Zr([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Ww}=Zw,Yw=Zr([{name:"a_packed",components:3,type:"Float32"}]),{members:Kw}=Yw,Jw=Zr([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Qw}=Jw;class Lv{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new wd({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=wt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const u=[];let p=e.length%2==1?-e[e.length-1]*s:0,_=e[0]*s,v=!0;u.push({left:p,right:_,isDash:v,zeroLength:e[0]===0});let E=e[0];for(let C=1;C<e.length;C++){v=!v;const k=e[C];p=E*s,E+=k,_=E*s,u.push({left:p,right:_,isDash:v,zeroLength:k===0})}return u}addRoundDash(e,i,s){const u=i/2;for(let p=-s;p<=s;p++){const _=this.width*(this.nextRow+s+p);let v=0,E=e[v];for(let C=0;C<this.width;C++){C/E.right>1&&(E=e[++v]);const k=Math.abs(C-E.left),F=Math.abs(C-E.right),V=Math.min(k,F);let j;const $=p/s*(u+1);if(E.isDash){const ee=u-Math.abs($);j=Math.sqrt(V*V+ee*ee)}else j=u-Math.sqrt(V*V+$*$);this.image.data[_+C]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e,i){for(let E=e.length-1;E>=0;--E){const C=e[E],k=e[E+1];C.zeroLength?e.splice(E,1):k&&k.isDash===C.isDash&&(k.left=C.left,e.splice(E,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const p=this.width*this.nextRow;let _=0,v=e[_];for(let E=0;E<this.width;E++){E/v.right>1&&(v=e[++_]);const C=Math.abs(E-v.left),k=Math.abs(E-v.right),F=Math.min(C,k);this.image.data[p+E]=Math.max(0,Math.min(255,(v.isDash?F:-F)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const u=i==="round",p=u?7:0,_=2*p+1;if(this.nextRow+_>this.height)return Bi("LineAtlas out of space"),null;e.length===0&&e.push(1);let v=0;for(let k=0;k<e.length;k++)e[k]<0&&(Bi("Negative value is found in line dasharray, replacing values with 0"),e[k]=0),v+=e[k];if(v!==0){const k=this.width/v,F=this.getDashRanges(e,this.width,k);u?this.addRoundDash(F,k,p):this.addRegularDash(F,i==="square"?.5*k:0)}const E=this.nextRow+p;this.nextRow+=_;const C={tl:[E,p],br:[v,0]};return this.positions[s]=C,C}}di(Lv,"LineAtlas");const e2=ht.types,t2=Math.cos(Math.PI/180*37.5),i2=Math.cos(Math.PI/180*5);class cx{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((i=>{this.gradients[i.id]={}})),this.layoutVertexArray=new lp,this.layoutVertexArray2=new bc,this.patternVertexArray=new bc,this.indexArray=new ao,this.programConfigurations=new yh(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new xs,this.maxLineLength=0,this.zOffsetVertexArray=new bc,this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.tessellationStep=e.tessellationStep?e.tessellationStep:pi/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){this.hasPattern=Pi("line",this.layers,this.pixelRatio,i);const p=this.layers[0].layout.get("line-sort-key");this.tileToMeter=fe(s);const _=this.layers[0].layout.get("line-elevation-reference");if(_==="hd-road-markup")this.elevationType="road";else{const V=this.layers[0].layout.get("line-z-offset"),j=V.isConstant()&&!V.constantOr(0);this.elevationType=_!=="sea"&&_!=="ground"&&j?"none":"offset",this.elevationType==="offset"&&_==="none"&&Bi(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const v=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&v!==void 0;const E=[];for(const{feature:V,id:j,index:$,sourceLayerIndex:ee}of e){const oe=this.layers[0]._featureFilter.needGeometry,se=ft(V,oe);if(!this.layers[0]._featureFilter.filter(new Xa(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),se,s))continue;const ge=p?p.evaluate(se,{},s):void 0,xe={id:j,properties:V.properties,type:V.type,sourceLayerIndex:ee,index:$,geometry:oe?se.geometry:it(V,s,u),patterns:{},sortKey:ge};E.push(xe)}p&&E.sort(((V,j)=>V.sortKey-j.sortKey));const{lineAtlas:C,featureIndex:k}=i,F=this.addConstantDashes(C);for(const V of E){const{geometry:j,index:$,sourceLayerIndex:ee}=V;if(F&&this.addFeatureDashes(V,C),this.hasPattern){const oe=gn("line",this.layers,V,this.zoom,this.pixelRatio,i);this.patternFeatures.push(oe)}else this.addFeature(V,j,$,s,C.positions,i.availableImages,i.brightness,i.elevationFeatures);k.insert(e[$].feature,j,$,ee,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,p=s.layout.get("line-cap").value;if(u.kind!=="constant"||p.kind!=="constant")i=!0;else{const _=p.value,v=u.value;if(!v)continue;e.addDash(v,_)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if(p.kind==="constant"&&_.kind==="constant")continue;let v,E;if(p.kind==="constant"){if(v=p.value,!v)continue}else v=p.evaluate({zoom:s},e);E=_.kind==="constant"?_.value:_.evaluate({zoom:s},e),i.addDash(v,E),e.patterns[u.id]=[i.getKey(v,E)]}}update(e,i,s,u,p,_,v,E){this.programConfigurations.updatePaintArrays(e,i,p,s,u,_,v,E)}addFeatures(e,i,s,u,p,_){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,i,s,u,_,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Kw)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Qw)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Xw.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ww),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let s,u;if(i&&i>0?(s=`mapbox_clip_start_${i}`,u=`mapbox_clip_end_${i}`):(s="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(s)&&e.properties.hasOwnProperty(u))return{start:+e.properties[s],end:+e.properties[u]}}addFeature(e,i,s,u,p,_,v,E){const C=this.layers[0].layout,k=C.get("line-join").evaluate(e,{}),F=C.get("line-cap").evaluate(e,{}),V=C.get("line-miter-limit"),j=C.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const $=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=C.get("line-z-offset").value;const ee=this.layers[0].paint.get("line-width").value;if(ee.kind!=="constant"&&ee.isLineProgressConstant===!1&&(this.variableWidthValue=ee),this.elevationType==="road"){const oe=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,u,E,k,F,V,j)){const[se,ge]=this.clipRuntimeLinesToTile(i,1);for(let xe=0;xe<se.length;xe++){const Ie=se[xe],He=ge[xe],Ne={progress:{min:He.progress.min,max:He.progress.max},nextDir:this.computeSegNextDir(He,Ie),prevDir:this.computeSegPrevDir(He,Ie)};this.addLine(Ie,e,u,k,F,V,j,Ne,$&&He.parentIndex>0?He.parentIndex:null)}this.fillNonElevatedRoadSegment(oe)}}else for(let oe=0;oe<i.length;oe++)this.addLine(i[oe],e,u,k,F,V,j,void 0,$&&oe>0?oe:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,p,_,u,v,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return im(e,-i,-i,pi+i,pi+i)}clipRuntimeLinesToTile(e,i){const s=[];return[im(e,-i,-i,pi+i,pi+i,s),s]}addElevatedRoadFeature(e,i,s,u,p,_,v,E){const C=[],k=yr.getElevationFeature(e,u);if(k){const F=this.clipLinesToTile(i,1),V=this.prepareElevatedLines(F,k,s);for(const j of V)C.push({geometry:j,elevation:k,elevationTileID:s,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(C.length===0)return!1;for(const F of C){const V=this.layoutVertexArray.length;this.addLine(F.geometry,e,s,p,_,v,E);const j=new Gr(s,F.elevationTileID);if(F.elevation)for(let $=V;$<this.layoutVertexArray.length;$++){const ee=new je(this.layoutVertexArray.int16[6*$]>>1,this.layoutVertexArray.int16[6*$+1]>>1),oe=j.pointElevation(ee,F.elevation,.05);this.updateHeightRange(oe),this.zOffsetVertexArray.emplaceBack(oe,0,0)}else this.fillNonElevatedRoadSegment(V)}return!0}prepareElevatedLines(e,i,s){if(i.constantHeight!=null)return e;const u=[],p=1/fe(s);for(const _ of e)ay(_,new aa(i,p),0,u);return u}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,s,u,p,_,v,E,C){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=C?this.lineFeatureClips(i,C):this.lineClips;const k=u==="none";this.patternJoinNone=this.hasPattern&&k,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const F=E&&E.progress.min>0,V=E&&E.progress.max<1;if(this.lineClips){let ct={min:this.lineClips.start,max:this.lineClips.end},Gt=1;if(E){const ni=this.lineClips.end-this.lineClips.start;ct=(function(ri,vi,wi){return{min:lr(ri.min,vi,wi),max:lr(ri.max,vi,wi)}})(E.progress,{min:0,max:1},ct),ni>0&&(Gt=(ct.max-ct.min)/ni)}const pt=+i.properties.mapbox_clip_feature_len,Xt=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(pt)||Number.isNaN(Xt)){for(let ri=0;ri<e.length-1;ri++)this.totalDistance+=e[ri].dist(e[ri+1]);const ni=this.totalDistance/(ct.max-ct.min);this.totalFeatureLength=Number.isFinite(ni)?ni:0,this.lineClips.start=ct.min,this.lineClips.end=ct.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=pt,this.distance=Xt*Gt,this.lineClips.start=ct.min,this.lineClips.end=ct.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const j=e2[i.type]==="Polygon";let $=e.length;for(;$>=2&&e[$-1].equals(e[$-2]);)$--;let ee=0;for(;ee<$-1&&e[ee].equals(e[ee+1]);)ee++;if($<(j?3:2))return;u==="bevel"&&(_=1.05);const oe=this.segments.prepareSegment(10*$,this.layoutVertexArray,this.indexArray);let se,ge,xe,Ie,He,Ne,We,at;E&&E.prevDir&&(Ne=E.prevDir.perp()),E&&E.nextDir&&(We=E.nextDir.perp()),this.e1=this.e2=-1,j&&(se=e[$-2],He=e[ee].sub(se)._unit()._perp());for(let ct=ee;ct<$;ct++){if(xe=ct===$-1?j?e[ee+1]:void 0:e[ct+1],xe&&e[ct].equals(xe))continue;He&&(Ie=He),se&&(ge=se),se=e[ct],at=this.evaluateLineProgressFeatures(ge?ge.dist(se):0),He=xe?xe.sub(se)._unit()._perp():Ie,Ie=Ie||He;const Gt=ge&&xe;let pt=Gt?u:j||k?"butt":p;const Xt=Ie.x*He.x+Ie.y*He.y;if(k){const $t=function(yi){if(yi.patternJoinNone){const ki=yi.segmentPoints.length/2,Ii=yi.lineSoFar-yi.segmentStart;for(let Dn=0;Dn<ki;++Dn){const tn=yi.segmentPoints[2*Dn+1],sn=Math.round(yi.segmentPoints[2*Dn])+.5+.25*tn;yi.patternVertexArray.emplaceBack(sn,Ii,yi.segmentStart),yi.patternVertexArray.emplaceBack(sn,Ii,yi.segmentStart)}yi.segmentPoints.length=0}yi.e1=yi.e2=-1};if(Gt&&Xt<i2){this.updateDistance(ge,se),this.addCurrentVertex(se,Ie,1,1,oe,at),$t(this),this.addCurrentVertex(se,He,-1,-1,oe,at);continue}if(ge){if(!xe){this.updateDistance(ge,se),this.addCurrentVertex(se,Ie,1,1,oe,at),$t(this);continue}pt="miter"}}let ni=Ie.add(He);ni.x===0&&ni.y===0||ni._unit();const ri=ni.x*He.x+ni.y*He.y,vi=ri!==0?1/ri:1/0,wi=2*Math.sqrt(2-2*ri),_i=ri<t2&&ge&&xe,gi=Ie.x*He.y-Ie.y*He.x>0,Zt=this.overscaling<=16?15*pi/(512*this.overscaling):0;if(Gt&&pt==="round"){if(vi<v)pt="miter";else if(vi<=2){const $t=ux(se,-10,pi+10);pt=this.elevationType==="offset"&&($t||this.hasCrossSlope)?"miter":"fakeround"}}if(pt==="miter"&&vi>_&&(pt="bevel"),pt==="bevel"&&(vi>2&&(pt="flipbevel"),vi<_&&(pt="miter")),ge&&!(pt==="miter"&&_i)&&this.updateDistance(ge,se),pt==="miter")if(_i){const $t=se.dist(ge);if($t>2*Zt){const ki=se.sub(se.sub(ge)._mult(Zt/$t)._round());this.updateDistance(ge,ki),this.addCurrentVertex(ki,Ie,0,0,oe,at),ge=ki}this.updateDistance(ge,se),ni._mult(vi),this.addCurrentVertex(se,ni,0,0,oe,at);const yi=se.dist(xe);if(yi>2*Zt){const ki=se.add(xe.sub(se)._mult(Zt/yi)._round());this.updateDistance(se,ki),this.addCurrentVertex(ki,He,0,0,oe,at),se=ki}}else ni._mult(vi),this.addCurrentVertex(se,ni,0,0,oe,at);else if(pt==="flipbevel"){if(vi>100)ni=He.mult(-1);else{const $t=vi*Ie.add(He).mag()/Ie.sub(He).mag();ni._perp()._mult($t*(gi?-1:1))}this.addCurrentVertex(se,ni,0,0,oe,at),this.addCurrentVertex(se,ni.mult(-1),0,0,oe,at)}else if(pt==="bevel"||pt==="fakeround"){at!=null&&ge&&this.addCurrentVertex(se,We||Ie,-1,-1,oe,at);const $t=se.dist(ge)<=2*Zt&&pt!=="bevel",yi=ni.mult(gi?1:-1);yi._mult(vi);const ki=He.mult(gi?-1:1),Ii=Ie.mult(gi?-1:1),Dn=this.evaluateLineProgressFeatures(this.distance);if(at==null&&(this.addHalfVertex(se,yi.x,yi.y,!1,!gi,0,oe,Dn),$t||this.addHalfVertex(se,yi.x+2*Ii.x,yi.y+2*Ii.y,!1,gi,0,oe,Dn)),pt==="fakeround"){const tn=Math.round(180*wi/Math.PI/20);this.addHalfVertex(se,Ii.x,Ii.y,!1,gi,0,oe,Dn);for(let sn=0;sn<tn;sn++){let bn=sn/tn;if(bn!==.5){const zi=bn-.5;bn+=bn*zi*(bn-1)*((1.0904+Xt*(Xt*(3.55645-1.43519*Xt)-3.2452))*zi*zi+(.848013+Xt*(.215638*Xt-1.06021)))}const Vr=ki.sub(Ii)._mult(bn)._add(Ii)._unit();this.addHalfVertex(se,Vr.x,Vr.y,!1,gi,0,oe,Dn)}this.addHalfVertex(se,ki.x,ki.y,!1,gi,0,oe,Dn)}$t||at!=null||this.addHalfVertex(se,yi.x+2*ki.x,yi.y+2*ki.y,!1,gi,0,oe,Dn),at!=null&&xe&&this.addCurrentVertex(se,Ne||He,1,1,oe,at)}else if(pt==="butt")this.addCurrentVertex(se,ni,0,0,oe,at);else if(pt==="square"){if(!ge){const $t=F?0:-1;this.addCurrentVertex(se,ni,$t,$t,oe,at)}if(this.addCurrentVertex(se,ni,0,0,oe,at),ge){const $t=V?0:1;this.addCurrentVertex(se,ni,$t,$t,oe,at)}}else if(pt==="round"){if(ge){const $t=!Gt&&We?We:Ie;this.addCurrentVertex(se,$t,0,0,oe,at),!Gt&&V||this.addCurrentVertex(se,$t,1,1,oe,at,!0)}if(xe){const $t=!Gt&&Ne?Ne:He;!Gt&&F||this.addCurrentVertex(se,$t,-1,-1,oe,at,!0),this.addCurrentVertex(se,$t,0,0,oe,at)}}}}addVerticesTo(e,i,s,u,p,_,v,E,C,k){const F=(i.w-e.w)/this.tessellationStep|0;let V=0;const j=this.scaledDistance;if(F>1){this.lineSoFar=e.w;const ee=(i.x-e.x)/F,oe=(i.y-e.y)/F,se=(i.z-e.z)/F,ge=(i.w-e.w)/F;for(let xe=1;xe<F;++xe){e.x+=ee,e.y+=oe,e.z+=se,this.lineSoFar+=ge,V+=ge;const Ie=this.evaluateLineProgressFeatures(this.prevDistance+V);this.scaledDistance=(this.prevDistance+V)/this.totalDistance,this.addHalfVertex(e,s,u,k,!1,v,C,Ie),this.addHalfVertex(e,p,_,k,!0,-E,C,Ie)}}this.lineSoFar=i.w,this.scaledDistance=j;const $=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,u,k,!1,v,C,$),this.addHalfVertex(i,p,_,k,!0,-E,C,$)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Bi(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,s,u,p,_,v=!1){const E=i.x+i.y*s,C=i.y-i.x*s,k=i.y*u-i.x,F=-i.y-i.x*u;if(_!=null){const V=this.elevationType==="offset",j=-10,$=pi+10,ee=_.zOffset,oe=new k_(e.x,e.y,ee,this.lineSoFar),se=!!V&&ux(e,j,$),ge=this.lineSoFar,xe=this.distance;if(this.currentVertex)if(se){const Ie=this.currentVertexIsOutside,He=this.currentVertex,Ne=new k_(e.x,e.y,ee,this.lineSoFar);if(xg(He,Ne,j,$),!ux(Ne,j,$)){if(Ie){this.e1=this.e2=-1,this.distance-=He.dist(oe),this.lineSoFar=He.w;const We=this.evaluateLineProgressFeatures(He.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(He,E,C,v,!1,s,p,We),this.addHalfVertex(He,k,F,v,!0,-u,p,We),this.prevDistance=this.distance}this.distance=this.prevDistance+He.dist(Ne),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(He,Ne,E,C,k,F,s,u,p,v),this.distance=xe,this.scaledDistance=this.distance/this.totalDistance}}else{const Ie=this.currentVertex;if(this.currentVertexIsOutside){xg(Ie,oe,j,$),this.e1=this.e2=-1,this.distance-=Ie.dist(oe),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Ie.w;const He=this.evaluateLineProgressFeatures(Ie.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ie,E,C,v,!1,s,p,He),this.addHalfVertex(Ie,k,F,v,!0,-u,p,He),this.prevDistance=this.distance,this.distance=xe,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Ie,oe,E,C,k,F,s,u,p,v)}else se||(this.addHalfVertex(e,E,C,v,!1,s,p,_),this.addHalfVertex(e,k,F,v,!0,-u,p,_));this.currentVertex=oe,this.currentVertexIsOutside=se,this.lineSoFar=ge}else this.addHalfVertex(e,E,C,v,!1,s,p,_),this.addHalfVertex(e,k,F,v,!0,-u,p,_)}addHalfVertex({x:e,y:i},s,u,p,_,v,E,C){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),_||this.segmentPoints.push(this.lineSoFar-this.segmentStart,v)),this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(v===0?0:v<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const F=Gn(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,F)}const k=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,k),E.primitiveLength++),_?this.e2=k:this.e1=k,C!=null&&this.zOffsetVertexArray.emplaceBack(C.zOffset,C.variableWidth,C.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function ux(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let kv,Ov;function Bv(r,e,i){return e*(pi/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}di(cx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Fv=(r,e,i)=>(1-i)*r+i*e;function Nv(r,e){return 1/Bv(r,1,e.tileZoom)}function Vv(r,e,i,s){return r.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const Uv=r=>{const e=[];jv(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=r.layout.get("line-join").constantOr("miter")==="none",u=!!r.paint.get("line-pattern").constantOr(1);return s&&u&&e.push("LINE_JOIN_NONE"),e};function jv(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let hx;const Gv=()=>hx||(hx={layout:kv||(kv=new ca({"line-cap":new Fi(xt.layout_line["line-cap"]),"line-join":new Fi(xt.layout_line["line-join"]),"line-miter-limit":new xi(xt.layout_line["line-miter-limit"]),"line-round-limit":new xi(xt.layout_line["line-round-limit"]),"line-sort-key":new Fi(xt.layout_line["line-sort-key"]),"line-z-offset":new Fi(xt.layout_line["line-z-offset"]),"line-elevation-reference":new xi(xt.layout_line["line-elevation-reference"]),"line-cross-slope":new xi(xt.layout_line["line-cross-slope"]),visibility:new xi(xt.layout_line.visibility),"line-width-unit":new xi(xt.layout_line["line-width-unit"])})),paint:Ov||(Ov=new ca({"line-opacity":new Fi(xt.paint_line["line-opacity"]),"line-color":new Fi(xt.paint_line["line-color"]),"line-translate":new xi(xt.paint_line["line-translate"]),"line-translate-anchor":new xi(xt.paint_line["line-translate-anchor"]),"line-width":new Fi(xt.paint_line["line-width"]),"line-gap-width":new Fi(xt.paint_line["line-gap-width"]),"line-offset":new Fi(xt.paint_line["line-offset"]),"line-blur":new Fi(xt.paint_line["line-blur"]),"line-dasharray":new Fi(xt.paint_line["line-dasharray"]),"line-pattern":new Fi(xt.paint_line["line-pattern"]),"line-pattern-cross-fade":new xi(xt.paint_line["line-pattern-cross-fade"]),"line-gradient":new gd(xt.paint_line["line-gradient"]),"line-trim-offset":new xi(xt.paint_line["line-trim-offset"]),"line-trim-fade-range":new xi(xt.paint_line["line-trim-fade-range"]),"line-trim-color":new xi(xt.paint_line["line-trim-color"]),"line-emissive-strength":new Fi(xt.paint_line["line-emissive-strength"]),"line-border-width":new Fi(xt.paint_line["line-border-width"]),"line-border-color":new Fi(xt.paint_line["line-border-color"]),"line-occlusion-opacity":new xi(xt.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},hx);class n2 extends Fi{possiblyEvaluate(e,i){return i=new Xa(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,u){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,u)}}let Tg;function qv(r,e){return e>0?e+2*r:r}const r2=Zr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),a2=Zr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),s2=Zr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Zr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const o2=Zr([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),l2=Zr([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),c2=Zr([{name:"a_texb",components:2,type:"Uint16"}]),u2=Zr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),h2=Zr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Zr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Hv=Zr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),d2=Zr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Zr([{name:"triangle",components:3,type:"Uint16"}]),Zr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Zr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Zr([{type:"Float32",name:"offsetX"}]),Zr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var sc=24;function f2(r,e,i){return r.sections.forEach((s=>{s.text=(function(u,p,_){const v=p.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?u=u.toLocaleUpperCase():v==="lowercase"&&(u=u.toLocaleLowerCase()),qu.applyArabicShaping&&(u=qu.applyArabicShaping(u)),u})(s.text,e,i)})),r}const Sg={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function p2(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function m2(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const dx=4294967296,$v=1/dx,Zv=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let my=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){const s=this.readVarint(),u=s>>3,p=this.pos;this.type=7&s,r(u,e,this),this.pos===p&&this.skip(s)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*dx;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*dx;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let i,s;return s=e[this.pos++],i=127&s,s<128?i:(s=e[this.pos++],i|=(127&s)<<7,s<128?i:(s=e[this.pos++],i|=(127&s)<<14,s<128?i:(s=e[this.pos++],i|=(127&s)<<21,s<128?i:(s=e[this.pos],i|=(15&s)<<28,(function(u,p,_){const v=_.buf;let E,C;if(C=v[_.pos++],E=(112&C)>>4,C<128||(C=v[_.pos++],E|=(127&C)<<3,C<128)||(C=v[_.pos++],E|=(127&C)<<10,C<128)||(C=v[_.pos++],E|=(127&C)<<17,C<128)||(C=v[_.pos++],E|=(127&C)<<24,C<128)||(C=v[_.pos++],E|=(1&C)<<31,C<128))return K_(u,E,p);throw new Error("Expected varint not more than 10 bytes")})(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&Zv?Zv.decode(this.buf.subarray(e,r)):(function(i,s,u){let p="",_=s;for(;_<u;){const v=i[_];let E,C,k,F=null,V=v>239?4:v>223?3:v>191?2:1;if(_+V>u)break;V===1?v<128&&(F=v):V===2?(E=i[_+1],(192&E)==128&&(F=(31&v)<<6|63&E,F<=127&&(F=null))):V===3?(E=i[_+1],C=i[_+2],(192&E)==128&&(192&C)==128&&(F=(15&v)<<12|(63&E)<<6|63&C,(F<=2047||F>=55296&&F<=57343)&&(F=null))):V===4&&(E=i[_+1],C=i[_+2],k=i[_+3],(192&E)==128&&(192&C)==128&&(192&k)==128&&(F=(15&v)<<18|(63&E)<<12|(63&C)<<6|63&k,(F<=65535||F>=1114112)&&(F=null))),F===null?(F=65533,V=1):F>65535&&(F-=65536,p+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),p+=String.fromCharCode(F),_+=V}return p})(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*$v),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*$v),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?(function(e,i){let s,u;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(s=~(-e%4294967296),u=~(-e/4294967296),4294967295^s?s=s+1|0:(s=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),(function(p,_,v){v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,p>>>=7,v.buf[v.pos++]=127&p|128,v.buf[v.pos]=127&(p>>>=7)})(s,0,i),(function(p,_){const v=(7&p)<<4;_.buf[_.pos++]|=v|((p>>>=3)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p|((p>>>=7)?128:0),p&&(_.buf[_.pos++]=127&p)))))})(u,i)})(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=(function(s,u,p){for(let _,v,E=0;E<u.length;E++){if(_=u.charCodeAt(E),_>55295&&_<57344){if(!v){_>56319||E+1===u.length?(s[p++]=239,s[p++]=191,s[p++]=189):v=_;continue}if(_<56320){s[p++]=239,s[p++]=191,s[p++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(s[p++]=239,s[p++]=191,s[p++]=189,v=null);_<128?s[p++]=_:(_<2048?s[p++]=_>>6|192:(_<65536?s[p++]=_>>12|224:(s[p++]=_>>18|240,s[p++]=_>>12&63|128),s[p++]=_>>6&63|128),s[p++]=63&_|128)}return p})(this.buf,r,this.pos);const i=this.pos-e;i>=128&&Xv(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;const i=this.pos;r(e,this);const s=this.pos-i;s>=128&&Xv(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,_2,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,g2,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,v2,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,y2,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,x2,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,b2,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,w2,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,T2,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,S2,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function K_(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function Xv(r,e,i){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(let u=i.pos-1;u>=r;u--)i.buf[u+s]=i.buf[u]}function _2(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function g2(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function y2(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function x2(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function v2(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function b2(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function w2(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function T2(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function S2(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}const fx=3;function E2(r,e,i){e.glyphs=[],r===1&&i.readMessage(A2,e)}function A2(r,e,i){if(r===3){const{id:s,bitmap:u,width:p,height:_,left:v,top:E,advance:C}=i.readMessage(I2,{});e.glyphs.push({id:s,bitmap:new wd({width:p+2*fx,height:_+2*fx},u),metrics:{width:p,height:_,left:v,top:E,advance:C}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function I2(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const Wv=fx,Gd={horizontal:1,vertical:2,horizontalOnly:3};class Eg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new Eg;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new Eg;return i.image=e,i}}class J_{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,s){const u=new J_;for(let p=0;p<e.sections.length;p++){const _=e.sections[p];_.image?u.addImageSection(_,s):u.addTextSection(_,i)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=(function(i,s){let u="";for(let p=0;p<i.length;p++){const _=i.charCodeAt(p+1)||null,v=i.charCodeAt(p-1)||null;u+=!s&&(_&&jh(_)&&!Sg[i[p+1]]||v&&jh(v)&&!Sg[i[p-1]])||!Sg[i[p]]?i[p]:Sg[i[p]]}return u})(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&_y[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&_y[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new J_;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((e,i)=>Math.max(e,this.sections[i].scale)),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Eg.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e,i){const s=e.image?e.image.getPrimary():null;if(!s)return void Bi("Can't add FormattedSection with an empty image.");s.scaleSelf(i);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(Eg.forImage(s)),this.sectionIndex.push(this.sections.length-1)):Bi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function px(r,e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee=1){const oe=J_.fromFeature(r,u,ee);F===Gd.vertical&&oe.verticalizePunctuation(V);let se=[];const ge=(function(We,at,ct,Gt,pt,Xt){if(!We)return[];const ni=[],ri=(function(gi,Zt,$t,yi,ki,Ii){let Dn=0;for(let tn=0;tn<gi.length();tn++){const sn=gi.getSection(tn);Dn+=Yv(gi.getCodePoint(tn),sn,yi,ki,Zt,Ii)}return Dn/Math.max(1,Math.ceil(Dn/$t))})(We,at,ct,Gt,pt,Xt),vi=We.text.indexOf("")>=0;let wi=0;for(let gi=0;gi<We.length();gi++){const Zt=We.getSection(gi),$t=We.getCodePoint(gi);if(_y[$t]||(wi+=Yv($t,Zt,Gt,pt,at,Xt)),gi<We.length()-1){const yi=!((_i=$t)<11904||!(mn["Bopomofo Extended"](_i)||mn.Bopomofo(_i)||mn["CJK Compatibility Forms"](_i)||mn["CJK Compatibility Ideographs"](_i)||mn["CJK Compatibility"](_i)||mn["CJK Radicals Supplement"](_i)||mn["CJK Strokes"](_i)||mn["CJK Symbols and Punctuation"](_i)||mn["CJK Unified Ideographs Extension A"](_i)||mn["CJK Unified Ideographs"](_i)||mn["Enclosed CJK Letters and Months"](_i)||mn["Halfwidth and Fullwidth Forms"](_i)||mn.Hiragana(_i)||mn["Ideographic Description Characters"](_i)||mn["Kangxi Radicals"](_i)||mn["Katakana Phonetic Extensions"](_i)||mn.Katakana(_i)||mn["Vertical Forms"](_i)||mn["Yi Radicals"](_i)||mn["Yi Syllables"](_i)));(M2[$t]||yi||Zt.image)&&ni.push(Jv(gi+1,wi,ri,ni,C2($t,We.getCodePoint(gi+1),yi&&vi),!1))}}var _i;return Qv(Jv(We.length(),wi,ri,ni,0,!0))})(oe,C,p,e,s,j),{processBidirectionalText:xe,processStyledBidirectionalText:Ie}=qu;if(xe&&oe.sections.length===1){const We=xe(oe.toString(),ge);for(const at of We){const ct=new J_;ct.text=at,ct.sections=oe.sections;for(let Gt=0;Gt<at.length;Gt++)ct.sectionIndex.push(0);se.push(ct)}}else if(Ie){const We=Ie(oe.text,oe.sectionIndex,ge);for(const at of We){const ct=new J_;ct.text=at[0],ct.sectionIndex=at[1],ct.sections=oe.sections,se.push(ct)}}else se=(function(We,at){const ct=[],Gt=We.text;let pt=0;for(const Xt of at)ct.push(We.substring(pt,Xt)),pt=Xt;return pt<Gt.length&&ct.push(We.substring(pt,Gt.length)),ct})(oe,ge);const He=[],Ne={positionedLines:He,text:oe.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:F,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(We,at,ct,Gt,pt,Xt,ni,ri,vi,wi,_i,gi){let Zt=0,$t=0,yi=0;const ki=ri==="right"?1:ri==="left"?0:.5;let Ii=!1;for(const zi of pt){const wn=zi.getSections();for(const fr of wn){if(fr.image)continue;const ha=at[fr.fontStack];if(ha&&(Ii=ha.ascender!==void 0&&ha.descender!==void 0,!Ii))break}if(!Ii)break}let Dn=0;for(const zi of pt){zi.trim();const wn=zi.getMaxScale(),fr=(wn-1)*sc,ha={positionedGlyphs:[],lineOffset:0};We.positionedLines[Dn]=ha;const xa=ha.positionedGlyphs;let Ar=0;if(!zi.length()){$t+=Xt,++Dn;continue}let ts=0,Ue=0;for(let Wt=0;Wt<zi.length();Wt++){const bi=zi.getSection(Wt),Zi=zi.getSectionIndex(Wt),Xi=zi.getCodePoint(Wt);let Pn=bi.scale,Bn=null,br=null,Lr=null,Nr=sc,sa=0,er=vi;er===Gd.vertical&&((tn=Xi)===12312||tn===12313||tn===12316||tn===12540||tn===12448)&&(er=Gd.horizontal);const ur=!(er===Gd.horizontal||!_i&&!gc(Xi)||_i&&(_y[Xi]||$s(Xi)));if(bi.image){const Ea=Gt.get(bi.image.toString());if(!Ea)continue;Lr=bi.image,We.iconsInText=We.iconsInText||!0,br=Ea.paddedRect;const Ca=Ea.displaySize;Pn=Pn*sc/gi,Bn={width:Ca[0],height:Ca[1],left:0,top:-Wv,advance:ur?Ca[1]:Ca[0],localGlyph:!1},sa=Ii?-Bn.height*Pn:wn*sc-17-Ca[1]*Pn,Nr=Bn.advance;const za=(ur?Ca[0]:Ca[1])*Pn-sc*wn;za>0&&za>Ar&&(Ar=za)}else{const Ea=ct[bi.fontStack];if(!Ea)continue;Ea[Xi]&&(br=Ea[Xi]);const Ca=at[bi.fontStack];if(!Ca)continue;const za=Ca.glyphs[Xi];if(!za)continue;if(Bn=za.metrics,Nr=Xi!==8203?sc:0,Ii){const Ya=Ca.ascender!==void 0?Math.abs(Ca.ascender):0,us=Ca.descender!==void 0?Math.abs(Ca.descender):0,is=(Ya+us)*Pn;ts<is&&(ts=is,Ue=(Ya-us)/2*Pn),sa=-Ya*Pn}else sa=(wn-Pn)*sc-17}ur?(We.verticalizable=!0,xa.push({glyph:Xi,image:Lr,x:Zt,y:$t+sa,vertical:ur,scale:Pn,localGlyph:Bn.localGlyph,fontStack:bi.fontStack,sectionIndex:Zi,metrics:Bn,rect:br}),Zt+=Nr*Pn+wi):(xa.push({glyph:Xi,image:Lr,x:Zt,y:$t+sa,vertical:ur,scale:Pn,localGlyph:Bn.localGlyph,fontStack:bi.fontStack,sectionIndex:Zi,metrics:Bn,rect:br}),Zt+=Bn.advance*Pn+wi)}xa.length!==0&&(yi=Math.max(Zt-wi,yi),Ii?e0(xa,ki,Ar,Ue,Xt*wn/2):e0(xa,ki,Ar,0,Xt/2)),Zt=0;const $e=Xt*wn+Ar;ha.lineOffset=Math.max(Ar,fr),$t+=$e,++Dn}var tn;const sn=$t,{horizontalAlign:bn,verticalAlign:Vr}=mx(ni);(function(zi,wn,fr,ha,xa,Ar){const ts=(wn-fr)*xa,Ue=-Ar*ha;for(const $e of zi)for(const Wt of $e.positionedGlyphs)Wt.x+=ts,Wt.y+=Ue})(We.positionedLines,ki,bn,Vr,yi,sn),We.top+=-Vr*sn,We.bottom=We.top+sn,We.left+=-bn*yi,We.right=We.left+yi,We.hasBaseline=Ii})(Ne,e,i,s,se,_,v,E,F,C,V,$),!(function(We){for(const at of We)if(at.positionedGlyphs.length!==0)return!1;return!0})(He))return Ne}const _y={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},M2={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yv(r,e,i,s,u,p){if(e.image){const _=s.get(e.image.toString());return _?_.displaySize[0]*e.scale*sc/p+u:0}{const _=i[e.fontStack],v=_&&_.glyphs[r];return v?v.metrics.advance*e.scale+u:0}}function Kv(r,e,i,s){const u=Math.pow(r-e,2);return s?r<e?u/2:2*u:u+Math.abs(i)*i}function C2(r,e,i){let s=0;return r===10&&(s-=1e4),i&&(s+=150),r!==40&&r!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function Jv(r,e,i,s,u,p){let _=null,v=Kv(e,i,u,p);for(const E of s){const C=Kv(e-E.x,i,u,p)+E.badness;C<=v&&(_=E,v=C)}return{index:r,x:e,priorBreak:_,badness:v}}function Qv(r){return r?Qv(r.priorBreak).concat(r.index):[]}function mx(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function e0(r,e,i,s,u){if(!(e||i||s||u))return;const p=r.length-1,_=r[p],v=(_.x+_.metrics.advance*_.scale)*e;for(let E=0;E<=p;E++)r[E].x-=v,r[E].y+=i+s+u}function _x(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function gy(r,e,i,s){const{horizontalAlign:u,verticalAlign:p}=mx(s),_=i[0]-r.displaySize[0]*u,v=i[1]-r.displaySize[1]*p;return{imagePrimary:r,imageSecondary:e,top:v,bottom:v+r.displaySize[1],left:_,right:_+r.displaySize[0]}}function gx(r,e,i,s,u,p){const _=r.imagePrimary;let v;if(_.content){const oe=_.content,se=_.pixelRatio||1;v=[oe[0]/se,oe[1]/se,_.displaySize[0]-oe[2]/se,_.displaySize[1]-oe[3]/se]}const E=e.left*p,C=e.right*p;let k,F,V,j;i==="width"||i==="both"?(j=u[0]+E-s[3],F=u[0]+C+s[1]):(j=u[0]+(E+C-_.displaySize[0])/2,F=j+_.displaySize[0]);const $=e.top*p,ee=e.bottom*p;return i==="height"||i==="both"?(k=u[1]+$-s[0],V=u[1]+ee+s[2]):(k=u[1]+($+ee-_.displaySize[1])/2,V=k+_.displaySize[1]),{imagePrimary:_,imageSecondary:void 0,top:k,right:F,bottom:V,left:j,collisionPadding:v}}function t0(r){return!r.imagePrimary.stretchX}function i0(r){return!r.imagePrimary.stretchY}function n0(r){return{width:r.right-r.left,height:r.bottom-r.top}}const nm=128;function Q_(r,e,i){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Xa(r+1,{worldview:i}))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:u,interpolationType:p}=s;let _=0;for(;_<u.length&&u[_]<=r;)_++;_=Math.max(0,_-1);let v=_;for(;v<u.length&&u[v]<r+1;)v++;v=Math.min(u.length-1,v);const E=u[_],C=u[v];return s.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:E,maxZoom:C,minSize:s.evaluate(new Xa(E,{worldview:i})),maxSize:s.evaluate(new Xa(C,{worldview:i})),interpolationType:p}}}function yx(r,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:u}){return r.kind==="source"?s/nm:r.kind==="composite"?Gn(s/nm,u/nm,i):e}function eg(r,e,i=1){let s=0,u=0;if(r.kind==="constant")u=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:p,minZoom:_,maxZoom:v}=r,E=p?te(ls.interpolationFactor(p,e,_,v),0,1):0;r.kind==="camera"?u=Gn(r.minSize,r.maxSize,E)*i:s=E*i}return{uSizeT:s,uSize:u}}class a_ extends je{constructor(e,i,s,u,p){super(e,i),this.angle=u,this.z=s,p!==void 0&&(this.segment=p)}clone(){return new a_(this.x,this.y,this.z,this.angle,this.segment)}}function r0(r,e,i,s,u){if(e.segment===void 0)return!0;let p=e,_=e.segment+1,v=0;for(;v>-i/2;){if(_--,_<0)return!1;v-=r[_].dist(p),p=r[_]}v+=r[_].dist(r[_+1]),_++;const E=[];let C=0;for(;v<i/2;){const k=r[_],F=r[_+1];if(!F)return!1;let V=r[_-1].angleTo(k)-k.angleTo(F);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:v,angleDelta:V}),C+=V;v-E[0].distance>s;)C-=E.shift().angleDelta;if(C>u)return!1;_++,v+=k.dist(F)}return!0}function a0(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function s0(r,e,i){return r?.6*e*i:0}function o0(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function z2(r,e,i,s,u,p){const _=s0(i,u,p),v=o0(i,s)*p;let E=0;const C=a0(r)/2;for(let k=0;k<r.length-1;k++){const F=r[k],V=r[k+1],j=F.dist(V);if(E+j>C){const $=(C-E)/j,ee=Gn(F.x,V.x,$),oe=Gn(F.y,V.y,$),se=new a_(ee,oe,0,V.angleTo(F),k);return!_||r0(r,se,v,_,e)?se:void 0}E+=j}}function D2(r,e,i,s,u,p,_,v,E){const C=s0(s,p,_),k=o0(s,u),F=k*_,V=r[0].x===0||r[0].x===E||r[0].y===0||r[0].y===E;return e-F<e/4&&(e=F+e/4),l0(r,V?e/2*v%e:(k/2+2*p)*_*v%e,e,C,i,F,V,!1,E)}function l0(r,e,i,s,u,p,_,v,E){const C=p/2,k=a0(r);let F=0,V=e-i,j=[];for(let $=0;$<r.length-1;$++){const ee=r[$],oe=r[$+1],se=ee.dist(oe),ge=oe.angleTo(ee);for(;V+i<F+se;){V+=i;const xe=(V-F)/se,Ie=Gn(ee.x,oe.x,xe),He=Gn(ee.y,oe.y,xe);if(Ie>=0&&Ie<E&&He>=0&&He<E&&V-C>=0&&V+C<=k){const Ne=new a_(Ie,He,0,ge,$);s&&!r0(r,Ne,p,s,u)||j.push(Ne)}}F+=se}return v||j.length||_||(j=l0(r,F/2,i,s,u,p,_,!0,E)),j}function c0(r){let e=0,i=0;for(const _ of r)e+=_.w*_.h,i=Math.max(i,_.w);r.sort(((_,v)=>v.h-_.h));const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,p=0;for(const _ of r)for(let v=s.length-1;v>=0;v--){const E=s[v];if(!(_.w>E.w||_.h>E.h)){if(_.x=E.x,_.y=E.y,p=Math.max(p,_.y+_.h),u=Math.max(u,_.x+_.w),_.w===E.w&&_.h===E.h){const C=s.pop();C&&v<s.length&&(s[v]=C)}else _.h===E.h?(E.x+=_.w,E.w-=_.w):_.w===E.w?(E.y+=_.h,E.h-=_.h):(s.push({x:E.x+_.w,y:E.y,w:E.w-_.w,h:_.h}),E.y+=_.h,E.h-=_.h);break}}return{w:u,h:p,fill:e/(u*p)||0}}di(a_,"Anchor");const V_=1;class Ag{static getImagePositionScale(e,i,s){if(i&&e){const{sx:u,sy:p}=e;return{x:u,y:p}}return{x:s,y:s}}constructor(e,i,s,u){this.paddedRect=e;const{pixelRatio:p,version:_,stretchX:v,stretchY:E,content:C,sdf:k,usvg:F}=i;this.pixelRatio=p,this.stretchX=v,this.stretchY=E,this.content=C,this.version=_,this.padding=s,this.sdf=k,this.usvg=F,this.scale=Ag.getImagePositionScale(u,F,p)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function xx(r,e,i){const s=ga.parse(r),u=(function(p,_,v=[1,1]){return{x:0,y:0,w:(p.data?p.data.width:p.width*v[0])+2*_,h:(p.data?p.data.height:p.height*v[1])+2*_}})(e,i,[s.sx,s.sy]);return{bin:u,imagePosition:new Ag(u,e,i,s),imageVariant:s}}class u0{constructor(e,i,s){const u=new Map,p=new Map;this.haveRenderCallbacks=[];const _=[];this.addImages(e,u,V_,_),this.addImages(i,p,2,_);const{w:v,h:E}=c0(_),C=new Tl({width:v||1,height:E||1});for(const[k,F]of e.entries()){const V=u.get(k).paddedRect;Tl.copy(F.data,C,{x:0,y:0},{x:V.x+V_,y:V.y+V_},F.data,null,F.sdf)}for(const[k,F]of i.entries()){const V=p.get(k),j=V.paddedRect;let $=V.padding;const ee=j.x+$,oe=j.y+$,se=F.data.width,ge=F.data.height;$=$>1?$-1:$,Tl.copy(F.data,C,{x:0,y:0},{x:ee,y:oe},F.data,s),Tl.copy(F.data,C,{x:0,y:ge-$},{x:ee,y:oe-$},{width:se,height:$},s),Tl.copy(F.data,C,{x:0,y:0},{x:ee,y:oe+ge},{width:se,height:$},s),Tl.copy(F.data,C,{x:se-$,y:0},{x:ee-$,y:oe},{width:$,height:ge},s),Tl.copy(F.data,C,{x:0,y:0},{x:ee+se,y:oe},{width:$,height:ge},s),Tl.copy(F.data,C,{x:se-$,y:ge-$},{x:ee-$,y:oe-$},{width:$,height:$},s),Tl.copy(F.data,C,{x:0,y:ge-$},{x:ee+se,y:oe-$},{width:$,height:$},s),Tl.copy(F.data,C,{x:0,y:0},{x:ee+se,y:oe+ge},{width:$,height:$},s),Tl.copy(F.data,C,{x:se-$,y:0},{x:ee-$,y:oe+ge},{width:$,height:$},s)}this.lut=s,this.image=C,this.iconPositions=u,this.patternPositions=p}addImages(e,i,s,u){for(const[p,_]of e.entries()){const{bin:v,imagePosition:E,imageVariant:C}=xx(p,_,s);i.set(p,E),u.push(v),_.hasRenderCallback&&this.haveRenderCallbacks.push(C.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((u=>e.hasImage(u,s))),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const u of e.getUpdatedImages(s)){for(const p of this.iconPositions.keys()){const _=ga.parse(p);if(Rl.isEqual(_.id,u)){const v=e.getImage(u,s);this.patchUpdatedImage(this.iconPositions.get(p),v,i,null)}}for(const p of this.patternPositions.keys()){const _=ga.parse(p);if(Rl.isEqual(_.id,u)){const v=e.getImage(u,s);this.patchUpdatedImage(this.patternPositions.get(p),v,i,this.lut)}}}}patchUpdatedImage(e,i,s,u=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[p,_]=e.tl,v=e.sdf;if(this.lut||v){const E={width:i.data.width,height:i.data.height},C=new Tl(E);Tl.copy(i.data,C,{x:0,y:0},{x:0,y:0},E,u,v),s.update(C,{position:{x:p,y:_}})}else s.update(i.data,{position:{x:p,y:_}})}}di(Ag,"ImagePosition"),di(u0,"ImageAtlas");const Ig=1e20;function h0(r,e,i,s,u,p,_,v,E){for(let C=e;C<e+s;C++)d0(r,i*p+C,p,u,_,v,E);for(let C=i;C<i+u;C++)d0(r,C*p+e,1,s,_,v,E)}function d0(r,e,i,s,u,p,_){p[0]=0,_[0]=-Ig,_[1]=Ig,u[0]=r[e];for(let v=1,E=0,C=0;v<s;v++){u[v]=r[e+v*i];const k=v*v;do{const F=p[E];C=(u[v]-u[F]+k-F*F)/(v-F)/2}while(C<=_[E]&&--E>-1);E++,p[E]=v,_[E]=C,_[E+1]=Ig}for(let v=0,E=0;v<s;v++){for(;_[E+1]<v;)E++;const C=p[E],k=v-C;r[e+v*i]=u[C]+k*k}}const rm=2,vx={none:0,ideographs:1,all:2};class tg{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[],u=this.url||Rr.GLYPHS_URL;for(const p in e)for(const _ of e[p])s.push({stack:p,id:_});et(s,(({stack:p,id:_},v)=>{let E=this.entries[p];E||(E=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=E.glyphs[_];if(C!==void 0)return void v(null,{stack:p,id:_,glyph:C});if(C=this._tinySDF(E,p,_),C)return E.glyphs[_]=C,void v(null,{stack:p,id:_,glyph:C});const k=Math.floor(_/256);if(256*k>65535)return Bi("glyphs > 65535 not supported"),void v(null,{stack:p,id:_,glyph:C});if(E.ranges[k])return void v(null,{stack:p,id:_,glyph:C});let F=E.requests[k];F||(F=E.requests[k]=[],tg.loadGlyphRange(p,k,u,this.requestManager,((V,j)=>{if(j){E.ascender=j.ascender,E.descender=j.descender;for(const $ in j.glyphs)this._doesCharSupportLocalGlyph(+$)||(E.glyphs[+$]=j.glyphs[+$]);E.ranges[k]=!0}for(const $ of F)$(V,j);delete E.requests[k]}))),F.push(((V,j)=>{V?v(V):j&&v(null,{stack:p,id:_,glyph:j.glyphs[_]||null})}))}),((p,_)=>{if(p)i(p);else if(_){const v={};for(const{stack:E,id:C,glyph:k}of _)v[E]===void 0&&(v[E]={}),v[E].glyphs===void 0&&(v[E].glyphs={}),v[E].glyphs[C]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics},v[E].ascender=this.entries[E].ascender,v[E].descender=this.entries[E].descender;i(null,v)}}))}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==vx.none&&(this.localGlyphMode===vx.all?!!this.localFontFamily:!!this.localFontFamily&&(mn["CJK Unified Ideographs"](e)||mn["Hangul Syllables"](e)||mn.Hiragana(e)||mn.Katakana(e)||mn["CJK Symbols and Punctuation"](e)||mn["CJK Unified Ideographs Extension A"](e)||mn["CJK Unified Ideographs Extension B"](e)||mn.Osage(e)))}_tinySDF(e,i,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let p=e.tinySDF;if(!p){let ee="400";/bold/i.test(i)?ee="900":/medium/i.test(i)?ee="500":/light/i.test(i)&&(ee="200"),p=e.tinySDF=new tg.TinySDF({fontFamily:u,fontWeight:ee,fontSize:24*rm,buffer:3*rm,radius:8*rm}),p.fontWeight=ee}if(this.localGlyphs[p.fontWeight][s])return this.localGlyphs[p.fontWeight][s];const _=String.fromCodePoint(s),{data:v,width:E,height:C,glyphWidth:k,glyphHeight:F,glyphLeft:V,glyphTop:j,glyphAdvance:$}=p.draw(_);return this.localGlyphs[p.fontWeight][s]={id:s,bitmap:new wd({width:E,height:C},v),metrics:{width:k/rm,height:F/rm,left:V/rm,top:j/rm-27,advance:$/rm,localGlyph:!0}}}}tg.loadGlyphRange=function(r,e,i,s,u){const p=256*e,_=p+255,v=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${p}-${_}`),zc.Glyphs);Wl(v,((E,C)=>{if(E)u(E);else if(C){const k={},F=(function(V){return new my(V).readFields(E2,{})})(C);for(const V of F.glyphs)k[V.id]=V;u(null,{glyphs:k,ascender:F.ascender,descender:F.descender})}}))},tg.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:p="normal",fontStyle:_="normal",lang:v=null}={}){this.buffer=e,this.cutoff=s,this.radius=i,this.lang=v;const E=this.size=r+4*e,C=this._createCanvas(E),k=this.ctx=C.getContext("2d",{willReadFrequently:!0});k.font=`${_} ${p} ${r}px ${u}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:p}=this.ctx.measureText(r),_=Math.ceil(i),v=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-u))),E=Math.min(this.size-this.buffer,_+Math.ceil(s)),C=v+2*this.buffer,k=E+2*this.buffer,F=Math.max(C*k,0),V=new Uint8ClampedArray(F),j={data:V,width:C,height:k,glyphWidth:v,glyphHeight:E,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(v===0||E===0)return j;const{ctx:$,buffer:ee,gridInner:oe,gridOuter:se}=this;this.lang&&($.lang=this.lang),$.clearRect(ee,ee,v,E),$.fillText(r,ee,ee+_);const ge=$.getImageData(ee,ee,v,E);se.fill(Ig,0,F),oe.fill(0,0,F);for(let xe=0;xe<E;xe++)for(let Ie=0;Ie<v;Ie++){const He=ge.data[4*(xe*v+Ie)+3]/255;if(He===0)continue;const Ne=(xe+ee)*C+Ie+ee;if(He===1)se[Ne]=0,oe[Ne]=Ig;else{const We=.5-He;se[Ne]=We>0?We*We:0,oe[Ne]=We<0?We*We:0}}h0(se,0,0,C,k,C,this.f,this.v,this.z),h0(oe,ee,ee,v,E,C,this.f,this.v,this.z);for(let xe=0;xe<F;xe++){const Ie=Math.sqrt(se[xe])-Math.sqrt(oe[xe]);V[xe]=Math.round(255-255*(Ie/this.radius+this.cutoff))}return j}};const Rm=V_;function f0(r,e){return r+e[1]-e[0]}function bx(r,e,i,s,u=1){const p=[],_=r.imagePrimary,v=_.pixelRatio,E=_.paddedRect.w-2*Rm,C=_.paddedRect.h-2*Rm,k=(r.right-r.left)*u,F=(r.bottom-r.top)*u,V=_.stretchX||[[0,E]],j=_.stretchY||[[0,C]],$=V.reduce(f0,0),ee=j.reduce(f0,0),oe=E-$,se=C-ee;let ge=0,xe=$,Ie=0,He=ee,Ne=0,We=oe,at=0,ct=se;if(_.content&&s){const pt=_.content;ge=yy(V,0,pt[0]),Ie=yy(j,0,pt[1]),xe=yy(V,pt[0],pt[2]),He=yy(j,pt[1],pt[3]),Ne=pt[0]-ge,at=pt[1]-Ie,We=pt[2]-pt[0]-xe,ct=pt[3]-pt[1]-He}const Gt=(pt,Xt,ni,ri)=>{const vi=xy(pt.stretch-ge,xe,k,r.left*u),wi=vy(pt.fixed-Ne,We,pt.stretch,$),_i=xy(Xt.stretch-Ie,He,F,r.top*u),gi=vy(Xt.fixed-at,ct,Xt.stretch,ee),Zt=xy(ni.stretch-ge,xe,k,r.left*u),$t=vy(ni.fixed-Ne,We,ni.stretch,$),yi=xy(ri.stretch-Ie,He,F,r.top*u),ki=vy(ri.fixed-at,ct,ri.stretch,ee),Ii=new je(vi,_i),Dn=new je(Zt,_i),tn=new je(Zt,yi),sn=new je(vi,yi),bn=new je(wi/v,gi/v),Vr=new je($t/v,ki/v),zi=e*Math.PI/180;if(zi){const ts=Math.sin(zi),Ue=Math.cos(zi),$e=[Ue,-ts,ts,Ue];Ii._matMult($e),Dn._matMult($e),sn._matMult($e),tn._matMult($e)}const wn=pt.stretch+pt.fixed,fr=ni.stretch+ni.fixed,ha=Xt.stretch+Xt.fixed,xa=ri.stretch+ri.fixed,Ar=r.imageSecondary;return{tl:Ii,tr:Dn,bl:sn,br:tn,texPrimary:{x:_.paddedRect.x+Rm+wn,y:_.paddedRect.y+Rm+ha,w:fr-wn,h:xa-ha},texSecondary:Ar?{x:Ar.paddedRect.x+Rm+wn,y:Ar.paddedRect.y+Rm+ha,w:fr-wn,h:xa-ha}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:bn,pixelOffsetBR:Vr,minFontScaleX:We/v/k,minFontScaleY:ct/v/F,isSDF:i}};if(s&&(_.stretchX||_.stretchY)){const pt=p0(V,oe,$),Xt=p0(j,se,ee);for(let ni=0;ni<pt.length-1;ni++){const ri=pt[ni],vi=pt[ni+1];for(let wi=0;wi<Xt.length-1;wi++)p.push(Gt(ri,Xt[wi],vi,Xt[wi+1]))}}else p.push(Gt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:C+1}));return p}function R2(r,e){const i=r.stretchY||[[0,r.paddedRect.h-2*Rm]];return e&&(r.stretchX||r.stretchY)?m0(r.stretchX||[[0,r.paddedRect.w-2*Rm]])*m0(i):1}function yy(r,e,i){let s=0;for(const u of r)s+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return s}function p0(r,e,i){const s=[{fixed:-Rm,stretch:0}];for(const[u,p]of r){const _=s[s.length-1];s.push({fixed:u-_.stretch,stretch:_.stretch}),s.push({fixed:u-_.stretch,stretch:_.stretch+(p-u)})}return s.push({fixed:e+Rm,stretch:i}),s}function m0(r){return 2*r.length+1}function xy(r,e,i,s){return r/e*i+s}function vy(r,e,i,s){return r-e*i/s}function P2(r,e,i,s){const u=e+r.positionedLines[s].lineOffset;return s===0?i+u/2:i+(u+(e+r.positionedLines[s-1].lineOffset))/2}function L2(r,e=1,i=!1){let s=1/0,u=1/0,p=-1/0,_=-1/0;const v=r[0];for(let j=0;j<v.length;j++){const $=v[j];(!j||$.x<s)&&(s=$.x),(!j||$.y<u)&&(u=$.y),(!j||$.x>p)&&(p=$.x),(!j||$.y>_)&&(_=$.y)}const E=Math.min(p-s,_-u);let C=E/2;const k=new Ol([],k2);if(E===0)return new je(s,u);for(let j=s;j<p;j+=E)for(let $=u;$<_;$+=E)k.push(new ig(j+C,$+C,C,r));let F=(function(j){let $=0,ee=0,oe=0;const se=j[0];for(let ge=0,xe=se.length,Ie=xe-1;ge<xe;Ie=ge++){const He=se[ge],Ne=se[Ie],We=He.x*Ne.y-Ne.x*He.y;ee+=(He.x+Ne.x)*We,oe+=(He.y+Ne.y)*We,$+=3*We}return new ig(ee/$,oe/$,0,j)})(r),V=k.length;for(;k.length;){const j=k.pop();(j.d>F.d||!F.d)&&(F=j,i&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,V)),j.max-F.d<=e||(C=j.h/2,k.push(new ig(j.p.x-C,j.p.y-C,C,r)),k.push(new ig(j.p.x+C,j.p.y-C,C,r)),k.push(new ig(j.p.x-C,j.p.y+C,C,r)),k.push(new ig(j.p.x+C,j.p.y+C,C,r)),V+=4)}return i&&(console.log(`num probes: ${V}`),console.log(`best distance: ${F.d}`)),F.p}function k2(r,e){return e.max-r.max}class ig{constructor(e,i,s,u){this.p=new je(e,i),this.h=s,this.d=(function(p,_){let v=!1,E=1/0;for(let C=0;C<_.length;C++){const k=_[C];for(let F=0,V=k.length,j=V-1;F<V;j=F++){const $=k[F],ee=k[j];$.y>p.y!=ee.y>p.y&&p.x<(ee.x-$.x)*(p.y-$.y)/(ee.y-$.y)+$.x&&(v=!v),E=Math.min(E,bs(p,$,ee))}}return(v?1:-1)*Math.sqrt(E)})(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const O2=Object.keys,wx=Number.POSITIVE_INFINITY,B2=Math.sqrt(2);function b_(r,e,i,s,u){const p=_x(r)&&r.collisionPadding?r.collisionPadding:[0,0,0,0],_={top:r.top-p[1],bottom:r.bottom+p[3],left:r.left-p[0],right:r.right+p[2],scaled:!1};return s!==void 0&&(function(v,E){v.top*=E,v.bottom*=E,v.left*=E,v.right*=E,v.scaled=!0})(_,s),i&&(function(v,E){if(!E)return;const C=fi(E),k=new je(v.left,v.top),F=new je(v.right,v.top),V=new je(v.left,v.bottom),j=new je(v.right,v.bottom),$=new je(0,0);k._rotateAround(C,$),F._rotateAround(C,$),V._rotateAround(C,$),j._rotateAround(C,$),v.left=Math.min(k.x,F.x,V.x,j.x),v.right=Math.max(k.x,F.x,V.x,j.x),v.top=Math.min(k.y,F.y,V.y,j.y),v.bottom=Math.max(k.y,F.y,V.y,j.y)})(_,i),u&&(_.left+=u[0],_.right+=u[0],_.top+=u[1],_.bottom+=u[1]),e?{top:Math.min(e.top,_.top),bottom:Math.max(e.bottom,_.bottom),left:Math.min(e.left,_.left),right:Math.max(e.right,_.right),scaled:e.scaled||_.scaled}:_}function _0(r,[e,i]){let s=0,u=0;if(i===wx){e<0&&(e=0);const p=e/B2;switch(r){case"top-right":case"top-left":u=p-7;break;case"bottom-right":case"bottom-left":u=7-p;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(r){case"top-right":case"bottom-right":s=-p;break;case"top-left":case"bottom-left":s=p;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(r){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function F2(r,e,i,s,u,p,_,v,E,C,k,F,V,j){const $=r.layers[0],ee=$.appearances;if(ee.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const oe={iconBBox:null,iconVerticalBBox:null},se={textBBox:null,textVerticalBBox:null},{baseIconRotate:ge,baseTextRotate:xe,iconScaleFactor:Ie}=(function(Ne,We,at){const ct=Ne.get("icon-rotate").evaluate(We,{},at),Gt=Ne.get("text-rotate").evaluate(We,{},at),[pt,Xt]=Ne.get("icon-size-scale-range");return{baseIconRotate:ct,baseTextRotate:Gt,iconScaleFactor:te(1,pt,Xt)}})(s,u,p);e&&(oe.iconBBox=b_(e,oe.iconBBox,ge,_),i)&&(oe.iconVerticalBBox=b_(i,oe.iconVerticalBBox,ge+90,_));const He=wy(F.horizontal);He&&(se.textBBox=b_(He,se.textBBox,xe,1,j)),F.vertical&&(se.textVerticalBBox=b_(F.vertical,se.textVerticalBBox,xe+90,1,j));for(const Ne of ee)Ne.hasIconProperties()&&N2(oe,r,$,Ne,u,p,v,ge,_,E,e,C,Ie,k),Ne.hasTextProperties()&&V2(se,$,Ne,u,p,j,xe,V,He,F.vertical);return{iconBBox:oe.iconBBox,iconVerticalBBox:oe.iconVerticalBBox,textBBox:se.textBBox,textVerticalBBox:se.textVerticalBBox}}function N2(r,e,i,s,u,p,_,v,E,C,k,F,V,j){const{appearanceIconOffset:$,appearanceIconRotate:ee,appearanceIconSize:oe}=(function(Ie,He,Ne,We,at,ct,Gt,pt){const Xt=Ie.hasProperty("icon-offset")?He.getAppearanceValueAndResolveTokens(Ie,"icon-offset",Ne,We,[]):null,ni=Xt&&Array.isArray(Xt)?Xt:at,ri=Ie.hasProperty("icon-rotate")?He.getAppearanceValueAndResolveTokens(Ie,"icon-rotate",Ne,We,[]):null,vi=typeof ri=="number"?ri:ct,wi=Ie.hasProperty("icon-size")?He.getAppearanceValueAndResolveTokens(Ie,"icon-size",Ne,We,[]):null;return{appearanceIconOffset:ni,appearanceIconRotate:vi,appearanceIconSize:typeof wi=="number"?wi*pt.iconScaleFactor:Gt}})(s,i,u,p,_,v,E,C);let se=null,ge=null,xe=null;s.hasProperty("icon-image")?xe=(function(Ie,He,Ne,We,at,ct,Gt){let pt=null;const Xt=He.getAppearanceValueAndResolveTokens(Ne,"icon-image",We,at,[]);if(Xt){const ni=Ie.getResolvedImageFromTokens(Xt),ri=Ne.getUnevaluatedProperty("icon-size"),vi=Mg(ni,Q_(Ie.zoom,ri,Ie.worldview),ri,at,Ie.zoom,We,Ie.pixelRatio,Gt,Ie.worldview);pt=ct.get(vi.iconPrimary.toString())}return pt})(e,i,s,u,p,F,V):k&&(xe=k.imagePrimary),xe&&(se=gy(xe,null,$,j),e.allowVerticalPlacement&&(ge=gy(xe,null,$,j))),se&&(r.iconBBox=b_(se,r.iconBBox,ee,oe)),ge&&(r.iconVerticalBBox=b_(ge,r.iconVerticalBBox,ee+90,oe))}function V2(r,e,i,s,u,p,_,v,E,C){const{appearanceTextOffset:k,appearanceTextRotate:F,appearanceTextSize:V}=(function($,ee,oe,se,ge,xe,Ie){const He=$.hasProperty("text-offset")?ee.getAppearanceValueAndResolveTokens($,"text-offset",oe,se,[]):null,Ne=He&&Array.isArray(He)?[He[0]*sc,He[1]*sc]:ge,We=$.hasProperty("text-rotate")?ee.getAppearanceValueAndResolveTokens($,"text-rotate",oe,se,[]):null,at=typeof We=="number"?We:xe,ct=$.hasProperty("text-size")?ee.getAppearanceValueAndResolveTokens($,"text-size",oe,se,[]):null;return{appearanceTextOffset:Ne,appearanceTextRotate:at,appearanceTextSize:typeof ct=="number"?ct:Ie}})(i,e,s,u,p,_,v),j=V/v;E&&(r.textBBox=b_(E,r.textBBox,F,j,k)),C&&(r.textVerticalBBox=b_(C,r.textVerticalBBox,F+90,j,k))}function by(r,e,i,s,u,p,_,v,E){if(!e||!e.usvg)return;const C=n0(s),k=n0(u),F=p!=="both"&&p!=="width"||!t0(s)?1:k.width/C.width,V=p!=="both"&&p!=="height"||!i0(s)?1:k.height/C.height;i.scaleSelf(F,V);const j=i.toString();_.set(j,i),v.set(j,e);const{imagePosition:$}=xx(j,e,V_);E.set(j,$)}function g0(r,e,i,s,u,p,_,v,E){if(!r)return;const C=(function(k,F,V,j,$,ee){if(k.kind==="camera")return k.maxSize;if(k.kind==="composite"){const oe=F.possiblyEvaluate(new Xa(k.maxZoom,{worldview:ee}),V).evaluate($,{},V),se=F.possiblyEvaluate(new Xa(k.minZoom,{worldview:ee}),V).evaluate($,{},V);return Math.max(oe,se)}return F.possiblyEvaluate(new Xa(j,{worldview:ee})).evaluate($,{},V)})(e,i,s,u,p,E);return r.scaleSelf(C*v*_)}function Mg(r,e,i,s,u,p,_,v,E){return{iconPrimary:g0(r.getPrimary(),e,i,s,u,p,_,v,E),iconSecondary:g0(r.getSecondary(),e,i,s,u,p,_,v,E)}}function U2(r,e,i){if(!e)return;const s=i.get(r.toString()),u=i.get(e.toString());s&&u&&(s.paddedRect.w===u.paddedRect.w&&s.paddedRect.h===u.paddedRect.h||Bi(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),s.usvg!==u.usvg&&Bi(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function y0(r,e,i,s){if(!r)return;const u=e.get(i.toString());if(r.imagePrimary=u,s){const p=e.get(s.toString());r.imageSecondary=p}}function j2(r,e){for(const i in r.horizontal)x0(r.horizontal[i],e);x0(r.vertical,e)}function x0(r,e){if(r){for(const i of r.positionedLines)for(const s of i.positionedGlyphs)if(s.image!==null){const u=s.image.toString();s.rect=e.get(u).paddedRect}}}function Tx(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function G2(r,e,i,s,u,p,_,v,E){const C=wy(p.horizontal)||p.vertical,k=i.get("icon-text-fit-padding").evaluate(s,{},u);let F,V=e;return e&&E!=="none"&&(r.allowVerticalPlacement&&p.vertical&&(F=gx(e,p.vertical,E,k,v,_)),C&&(V=gx(e,C,E,k,v,_))),{defaultShapedIcon:V,verticallyShapedIcon:F}}function q2(r,e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge,xe,Ie,He,Ne,We){let at=_.textMaxSize.evaluate(e,{},V);at===void 0?at=v*_.textScaleFactor:at*=_.textScaleFactor;const ct=r.layers[0].layout,Gt=sc,pt=v*_.textScaleFactor/Gt,Xt=wy(i.horizontal)||i.vertical;if(oe!=="none"&&r.appearanceFeatureData&&e.index<r.appearanceFeatureData.length){const tn=r.appearanceFeatureData[e.index];tn&&(tn.textShaping=Xt,tn.iconTextFitPadding=ct.get("icon-text-fit-padding").evaluate(e,{},V),tn.fontScale=pt)}const ni=j.name==="globe",ri=r.tilePixelRatio*at/Gt,vi=(yi=r.overscaling,r.zoom>18&&yi>2&&(yi>>=1),Math.max(pi/(512*yi),1)*ct.get("symbol-spacing")),wi=ct.get("text-padding")*r.tilePixelRatio,_i=ct.get("icon-padding")*r.tilePixelRatio,gi=fi(ct.get("text-max-angle")),Zt=ct.get("icon-rotation-alignment")==="map"&&xe!=="point",$t=vi/2;var yi;r.hasAnyIconTextFit===!1&&oe!=="none"&&(r.hasAnyIconTextFit=!0);const ki=e.properties?+e.properties[Bt]:null,Ii=ki&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(ki):65535,Dn=(tn,sn,bn)=>{if(sn.x<0||sn.x>=pi||sn.y<0||sn.y>=pi)return;let Vr=null;if(ni){const{x:zi,y:wn,z:fr}=j.projectTilePoint(sn.x,sn.y,bn);Vr={anchor:new a_(zi,wn,fr,0,void 0),up:j.upVector(bn,sn.x,sn.y)}}(function(zi,wn,fr,ha,xa,Ar,ts,Ue,$e,Wt,bi,Zi,Xi,Pn,Bn,br,Lr,Nr,sa,er,ur,Ea,Ca,za,Ya,us,is,Pa,Va,kr,pa,to,Yn){const oa=zi.addToLineVertexArray(wn,ha);let as,gs,Ps,Fo,Es,Kn,ro,Ka=0,Xs=0,Il=0,oc=0,ll=-1,cl=-1;const Zl={};let Kh=ns("");const As=fr?fr.anchor:wn,zo=Pa!=="none";let No=0,Td=0;if($e._unevaluatedLayout.getValue("text-radial-offset")===void 0){const su=$e.layout.get("text-offset").evaluate(ur,{},Ya);No=su[0]*sc,Td=su[1]*sc}else No=$e.layout.get("text-radial-offset").evaluate(ur,{},Ya)*sc,Td=wx;if(zi.allowVerticalPlacement&&xa.vertical){const su=xa.vertical;if(Bn)Kn=Sx(su),Ue&&(ro=Sx(Ue));else{const Ah=$e.layout.get("text-rotate").evaluate(ur,{},Ya)+90;Ps=Ty(Wt,As,wn,bi,Zi,Xi,su,Pn,Ah,br,to),Ue&&(Fo=Ty(Wt,As,wn,bi,Zi,Xi,Ue,Nr,Ah,null,pa))}}if(Ar){const su=zi.iconSizeData,Ah=$e.layout.get("icon-rotate").evaluate(ur,{},Ya),qd=bx(Ar,Ah,Ca,zo,Ea.iconScaleFactor),S_=Ue?bx(Ue,Ah,Ca,zo,Ea.iconScaleFactor):void 0;gs=Ty(Wt,As,wn,bi,Zi,Xi,Ar,Nr,Ah,null,kr);const cg=(function(lm,$g,Fb,iS,Nb,Vb,nS,rS){const Ub=lm.layers[0],jb=Ub.appearances;let ug=$g.length;if(Fb&&(ug=Math.max(ug,Fb.length)),jb.length===0)return ug;const[aS,sS]=iS.get("icon-size-scale-range"),oS=te(1,aS,sS);for(const Gb of jb){const qb=Gb.getUnevaluatedProperties();if(qb._values["icon-image"].value!==void 0){const Hb=Ub.getAppearanceValueAndResolveTokens(Gb,"icon-image",Nb,Vb,[]);if(Hb){const $b=lm.getResolvedImageFromTokens(Hb);if($b){const Zb=qb._values["icon-size"],lS=Mg($b,Q_(lm.zoom,Zb,lm.worldview),Zb,Vb,lm.zoom,Nb,lm.pixelRatio,oS,lm.worldview),cS=nS.get(lS.iconPrimary.toString());ug=Math.max(ug,R2(cS,rS))}}}}return ug})(zi,qd,S_,$e.layout,ur,Ya,zi.iconAtlasPositions,zo);Ka=4*cg;let om=null;su.kind==="source"?(om=[nm*$e.layout.get("icon-size").evaluate(ur,{},Ya)*Ea.iconScaleFactor],om[0]>s_&&Bi(`${zi.layerIds[0]}: Value for "icon-size" is >= ${Cg}. Reduce your "icon-size".`)):su.kind==="composite"&&(om=[nm*Ea.compositeIconSizes[0].evaluate(ur,{},Ya)*Ea.iconScaleFactor,nm*Ea.compositeIconSizes[1].evaluate(ur,{},Ya)*Ea.iconScaleFactor],(om[0]>s_||om[1]>s_)&&Bi(`${zi.layerIds[0]}: Value for "icon-size" is >= ${Cg}. Reduce your "icon-size".`)),zi.addSymbols(zi.icon,qd,om,er,sa,ur,void 0,fr,wn,oa.lineStartIndex,oa.lineLength,-1,za,Ya,us,is,zi.symbolInstances.length,cg),ll=zi.icon.placedSymbolArray.length-1,S_&&(Xs=4*cg,zi.addSymbols(zi.icon,S_,om,er,sa,ur,Gd.vertical,fr,wn,oa.lineStartIndex,oa.lineLength,-1,za,Ya,us,is,zi.symbolInstances.length,cg),cl=zi.icon.placedSymbolArray.length-1)}for(const su in xa.horizontal){const Ah=su,qd=xa.horizontal[Ah];as||(Kh=ns(qd.text),Bn?Es=Sx(qd):as=Ty(Wt,As,wn,bi,Zi,Xi,qd,Pn,$e.layout.get("text-rotate").evaluate(ur,{},Ya),br,to));const S_=qd.positionedLines.length===1;if(Il+=v0(zi,fr,wn,qd,ts,$e,Bn,ur,br,oa,xa.vertical?Gd.horizontal:Gd.horizontalOnly,S_?O2(xa.horizontal):[Ah],Zl,ll,Ea,za,Ya,zi.symbolInstances.length,us),S_)break}xa.vertical&&(oc+=v0(zi,fr,wn,xa.vertical,ts,$e,Bn,ur,br,oa,Gd.vertical,["vertical"],Zl,cl,Ea,za,Ya,zi.symbolInstances.length,us));let Ml=-1;const Tp=(su,Ah)=>su?Math.max(su,Ah):Ah;Ml=Tp(Es,Ml),Ml=Tp(Kn,Ml),Ml=Tp(ro,Ml);const Pm=Ml>-1?1:0;zi.glyphOffsetArray.length>=65535&&Bi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ur.sortKey!==void 0&&zi.addToSortKeyRanges(zi.symbolInstances.length,ur.sortKey),zi.symbolInstances.emplaceBack(wn.x,wn.y,As.x,As.y,As.z,Zl.right>=0?Zl.right:-1,Zl.center>=0?Zl.center:-1,Zl.left>=0?Zl.left:-1,Zl.vertical>=0?Zl.vertical:-1,ll,cl,Kh,as!==void 0?as:zi.collisionBoxArray.length,as!==void 0?as+1:zi.collisionBoxArray.length,Ps!==void 0?Ps:zi.collisionBoxArray.length,Ps!==void 0?Ps+1:zi.collisionBoxArray.length,gs!==void 0?gs:zi.collisionBoxArray.length,gs!==void 0?gs+1:zi.collisionBoxArray.length,Fo||zi.collisionBoxArray.length,Fo?Fo+1:zi.collisionBoxArray.length,bi,Il,oc,Ka,Xs,Pm,0,No,Td,Ml,0,zo?1:0,Va)})(r,sn,Vr,tn,i,s,p,u,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,wi,ge,C,0,_i,Zt,se,e,_,k,F,V,$,ee,oe,Ii,Ie,He,Ne)};if(xe==="line")for(const tn of im(e.geometry,0,0,pi,pi)){const sn=D2(tn,vi,gi,i.vertical||Xt,s,Gt,ri,r.overscaling,pi);for(const bn of sn)Xt&&H2(r,Xt.text,$t,bn)||Dn(tn,bn,V)}else if(xe==="line-center"){for(const tn of e.geometry)if(tn.length>1){const sn=z2(tn,gi,i.vertical||Xt,s,Gt,ri);sn&&Dn(tn,sn,V)}}else if(e.type==="Polygon")for(const tn of si(e.geometry,0)){const sn=L2(tn,16);Dn(tn[0],new a_(sn.x,sn.y,0,0,void 0),V)}else if(e.type==="LineString")for(const tn of e.geometry)Dn(tn,new a_(tn[0].x,tn[0].y,0,0,void 0),V);else if(e.type==="Point")for(const tn of e.geometry)for(const sn of tn)Dn([sn],new a_(sn.x,sn.y,0,0,void 0),V)}const Cg=255,s_=Cg*nm;function v0(r,e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge){const xe=(function(Ne,We,at,ct,Gt,pt,Xt,ni){const ri=[];if(We.positionedLines.length===0)return ri;const vi=ct.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,wi=(function(yi){const ki=yi[0],Ii=yi[1],Dn=ki*Ii;return Dn>0?[ki,-Ii]:Dn<0?[-ki,Ii]:ki===0?[Ii,ki]:[Ii,-ki]})(at);let _i=Math.abs(We.top-We.bottom);for(const yi of We.positionedLines)_i-=yi.lineOffset;const gi=We.positionedLines.length,Zt=_i/gi;let $t=We.top-at[1];for(let yi=0;yi<gi;++yi){const ki=We.positionedLines[yi];$t=P2(We,Zt,$t,yi);for(const Ii of ki.positionedGlyphs){if(!Ii.rect)continue;const Dn=Ii.rect||{};let tn=Wv+1,sn=!0,bn=1,Vr=0;if(Ii.image){const Lr=Xt.get(Ii.image.toString());if(!Lr)continue;if(Lr.sdf){Bi("SDF images are not supported in formatted text and will be ignored.");continue}sn=!1,bn=Lr.pixelRatio,tn=V_/bn}const zi=(Gt||ni)&&Ii.vertical,wn=Ii.metrics.advance*Ii.scale/2,fr=Ii.metrics,ha=Ii.rect;if(ha===null)continue;ni&&We.verticalizable&&(Vr=Ii.image?wn-Ii.metrics.width*Ii.scale/2:0);const xa=Gt?[Ii.x+wn,Ii.y]:[0,0];let Ar=[0,0],ts=[0,0],Ue=!1;Gt||(zi?(ts=[Ii.x+wn+wi[0],Ii.y+wi[1]-Vr],Ue=!0):Ar=[Ii.x+wn+at[0],Ii.y+at[1]-Vr]);const $e=ha.w*Ii.scale/(bn*(Ii.localGlyph?rm:1)),Wt=ha.h*Ii.scale/(bn*(Ii.localGlyph?rm:1));let bi,Zi,Xi,Pn;if(zi){const Lr=Ii.y-$t,Nr=new je(-wn,wn-Lr),sa=-Math.PI/2,er=new je(...ts);bi=new je(-wn+Ar[0],Ar[1]),bi._rotateAround(sa,Nr)._add(er),bi.x+=-Lr+wn,bi.y-=(fr.left-tn)*Ii.scale;const ur=Ii.image?fr.advance*Ii.scale:sc*Ii.scale,Ea=String.fromCodePoint(Ii.glyph);p2(Ea)?bi.x+=(1-tn)*Ii.scale:m2(Ea)?bi.x+=ur-fr.height*Ii.scale+(-tn-1)*Ii.scale:bi.x+=Ii.image||fr.width+2*tn===ha.w&&fr.height+2*tn===ha.h?(ur-Wt)/2:(ur-(fr.height+2*tn)*Ii.scale)/2,Zi=new je(bi.x,bi.y-$e),Xi=new je(bi.x+Wt,bi.y),Pn=new je(bi.x+Wt,bi.y-$e)}else{const Lr=(fr.left-tn)*Ii.scale-wn+Ar[0],Nr=(-fr.top-tn)*Ii.scale+Ar[1],sa=Lr+$e,er=Nr+Wt;bi=new je(Lr,Nr),Zi=new je(sa,Nr),Xi=new je(Lr,er),Pn=new je(sa,er)}if(vi){let Lr;Lr=Gt?new je(0,0):Ue?new je(wi[0],wi[1]):new je(at[0],at[1]),bi._rotateAround(vi,Lr),Zi._rotateAround(vi,Lr),Xi._rotateAround(vi,Lr),Pn._rotateAround(vi,Lr)}const Bn=new je(0,0),br=new je(0,0);ri.push({tl:bi,tr:Zi,bl:Xi,br:Pn,texPrimary:Dn,texSecondary:void 0,writingMode:We.writingMode,glyphOffset:xa,sectionIndex:Ii.sectionIndex,isSDF:sn,pixelOffsetTL:Bn,pixelOffsetBR:br,minFontScaleX:0,minFontScaleY:0})}}return ri})(0,s,E,p,_,v,u,r.allowVerticalPlacement),Ie=r.textSizeData;let He=null;Ie.kind==="source"?(He=[nm*p.layout.get("text-size").evaluate(v,{},oe)*$.textScaleFactor],He[0]>s_&&Bi(`${r.layerIds[0]}: Value for "text-size" is >= ${Cg}. Reduce your "text-size".`)):Ie.kind==="composite"&&(He=[nm*$.compositeTextSizes[0].evaluate(v,{},oe)*$.textScaleFactor,nm*$.compositeTextSizes[1].evaluate(v,{},oe)*$.textScaleFactor],(He[0]>s_||He[1]>s_)&&Bi(`${r.layerIds[0]}: Value for "text-size" is >= ${Cg}. Reduce your "text-size".`)),r.addSymbols(r.text,xe,He,E,_,v,k,e,i,C.lineStartIndex,C.lineLength,j,ee,oe,ge,!1,se,xe.length);for(const Ne of F)V[Ne]=r.text.placedSymbolArray.length-1;return 4*xe.length}function wy(r){for(const e in r)return r[e];return null}function Ty(r,e,i,s,u,p,_,v,E,C,k){let F,V,j,$;if(F=k?k.top:_.top,V=k?k.bottom:_.bottom,j=k?k.left:_.left,$=k?k.right:_.right,_x(_)&&_.collisionPadding){const ee=_.collisionPadding;j-=ee[0],F-=ee[1],$+=ee[2],V+=ee[3]}if(E){const ee=new je(j,F),oe=new je($,F),se=new je(j,V),ge=new je($,V),xe=fi(E);let Ie=new je(0,0);C&&(Ie=new je(C[0],C[1])),ee._rotateAround(xe,Ie),oe._rotateAround(xe,Ie),se._rotateAround(xe,Ie),ge._rotateAround(xe,Ie),j=Math.min(ee.x,oe.x,se.x,ge.x),$=Math.max(ee.x,oe.x,se.x,ge.x),F=Math.min(ee.y,oe.y,se.y,ge.y),V=Math.max(ee.y,oe.y,se.y,ge.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,j,F,$,V,v,s,u,p),r.length-1}function Sx(r){_x(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function H2(r,e,i,s){const u=r.compareText;if(e in u){const p=u[e];for(let _=p.length-1;_>=0;_--)if(s.dist(p[_])<i)return!0}else u[e]=[];return u[e].push(s),!1}function b0(r,e){const i=r.fovAboveCenter,s=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,u=(r._camera.position[2]*r.worldSize-s)/Math.cos(r._pitch),p=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let _=Math.sin(r._pitch)*p+u;const v=u*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let E=Math.max(r.zoom-17,0);r.isOrthographic&&(E/=10),_*=1+E}return Math.min(1.01*_,v)}function zg(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),s=r.x*i,u=(r.x+1)*i,p=r.y*i,_=(r.y+1)*i,v=U(s),E=U(u),C=Y(p),k=Y(_),F=e.project(v,C),V=e.project(E,C),j=e.project(E,k),$=e.project(v,k);let ee=Math.min(F.x,V.x,j.x,$.x),oe=Math.min(F.y,V.y,j.y,$.y),se=Math.max(F.x,V.x,j.x,$.x),ge=Math.max(F.y,V.y,j.y,$.y);const xe=i/16;function Ie(Ne,We,at,ct,Gt,pt){const Xt=(at+Gt)/2,ni=(ct+pt)/2,ri=e.project(U(Xt),Y(ni)),vi=Math.max(0,ee-ri.x,oe-ri.y,ri.x-se,ri.y-ge);ee=Math.min(ee,ri.x),se=Math.max(se,ri.x),oe=Math.min(oe,ri.y),ge=Math.max(ge,ri.y),vi>xe&&(Ie(Ne,ri,at,ct,Xt,ni),Ie(ri,We,Xt,ni,Gt,pt))}Ie(F,V,s,p,u,p),Ie(V,j,u,p,u,_),Ie(j,$,u,_,s,_),Ie($,F,s,_,s,p),ee-=xe,oe-=xe,se+=xe,ge+=xe;const He=1/Math.max(se-ee,ge-oe);return{scale:He,x:ee*He,y:oe*He,x2:se*He,y2:ge*He,projection:e}}function w0(r,{x:e,y:i},s=0){return new je(((e-s)*r.scale-r.x)*pi,(i*r.scale-r.y)*pi)}const $2=Wi(new Float32Array(16));class w_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new a(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s,u=!0){return e._coordinatePoint(e.locationCoordinate(i,s),u)}pixelsPerMeter(e,i){return N(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return b0(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,u){const p=e.horizonLineFromTop(!1),_=new je(i,Math.max(p,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,u))}pointCoordinate3D(e,i,s){const u=new je(i,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const p=this.pointCoordinate(e,u.x,u.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return $2}createTileMatrix(e,i,s){let u,p,_;const v=s.canonical,E=Wi(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=zg(v,this);u=1,p=C.x+s.wrap*C.scale,_=C.y,Vn(E,E,[u/C.scale,u/C.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(v.z),p=(v.x+Math.pow(2,v.z)*s.wrap)*u,_=v.y*u;return Ji(E,E,[p,_,0]),Vn(E,E,[u/pi,u/pi,1]),E}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class Z2 extends w_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(fi(i));this.n=(u+Math.sin(fi(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:u,r0:p}=this,_=fi(e-this.center[0]),v=fi(i),E=Math.sqrt(u-2*s*Math.sin(v))/s;return{x:E*Math.sin(_*s),y:E*Math.cos(_*s)-p,z:0}}unproject(e,i){const{n:s,c:u,r0:p}=this,_=p+i;let v=Math.atan2(e,Math.abs(_))*Math.sign(_);_*s<0&&(v-=Math.PI*Math.sign(e)*Math.sign(_));const E=fi(this.center[0])*s;v=ze(v,-Math.PI-E,Math.PI-E);const C=te(hi(v/s)+this.center[0],-180,180),k=Math.asin(te((u-(e*e+_*_)*s*s)/(2*s),-1,1)),F=te(hi(k),-Q,Q);return new a(C,F)}}const Dg=1.340264,Rg=-.081106,Pg=893e-6,Lg=.003796,Sy=Math.sqrt(3)/2;class X2 extends w_{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Sy*Math.sin(i)),u=s*s,p=u*u*u;return{x:.5*(e*Math.cos(s)/(Sy*(Dg+3*Rg*u+p*(7*Pg+9*Lg*u)))/Math.PI+.5),y:1-.5*(s*(Dg+Rg*u+p*(Pg+Lg*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=s*s,p=u*u*u;for(let k,F,V,j=0;j<12&&(F=s*(Dg+Rg*u+p*(Pg+Lg*u))-i,V=Dg+3*Rg*u+p*(7*Pg+9*Lg*u),k=F/V,s=te(s-k,-Math.PI/3,Math.PI/3),u=s*s,p=u*u*u,!(Math.abs(k)<1e-12));++j);const _=Sy*e*(Dg+3*Rg*u+p*(7*Pg+9*Lg*u))/Math.cos(s),v=Math.asin(Math.sin(s)/Sy),E=te(180*_/Math.PI,-180,180),C=te(180*v/Math.PI,-Q,Q);return new a(E,C)}}class W2 extends w_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),u=te(360*(.5-i),-Q,Q);return new a(s,u)}}const ng=Math.PI/2;function Ey(r){return Math.tan((ng+r)/2)}class Y2 extends w_{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let u=fi(i),p=fi(s);this.southernCenter=u+p<0,this.southernCenter&&(u=-u,p=-p);const _=Math.cos(u),v=Ey(u);this.n=u===p?Math.sin(u):Math.log(_/Math.cos(p))/Math.log(Ey(p)/v),this.f=_*Math.pow(Ey(u),this.n)/this.n}project(e,i){i=fi(i),this.southernCenter&&(i=-i),e=fi(e-this.center[0]);const s=1e-6,{n:u,f:p}=this;p>0?i<-ng+s&&(i=-ng+s):i>ng-s&&(i=ng-s);const _=p/Math.pow(Ey(i),u);let v=_*Math.sin(u*e),E=p-_*Math.cos(u*e);return v=.5*(v/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:v,y:this.southernCenter?E:1-E,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:u}=this,p=u-i,_=Math.sign(p),v=Math.sign(s)*Math.sqrt(e*e+p*p);let E=Math.atan2(e,Math.abs(p))*_;p*s<0&&(E-=Math.PI*Math.sign(e)*_);const C=te(hi(E/s)+this.center[0],-180,180),k=te(hi(2*Math.atan(Math.pow(u/v,1/s))-ng),-Q,Q);return new a(C,this.southernCenter?-k:k)}}class T0 extends w_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:M(e),y:R(i),z:0}}unproject(e,i){const s=U(e),u=Y(i);return new a(s,u)}}const S0=fi(Q);class K2 extends w_{project(e,i){const s=(i=fi(i))*i,u=s*s;return{x:.5*((e=fi(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,u=25,p=0,_=s*s;do{_=s*s;const C=_*_;p=(s*(1.007226+_*(.015085+C*(.028874*_-.044475-.005916*C)))-i)/(1.007226+_*(.045255+C*(.259866*_-.311325-.005916*11*C))),s=te(s-p,-S0,S0)}while(Math.abs(p)>1e-6&&--u>0);_=s*s;const v=te(hi(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),E=hi(s);return new a(v,E)}}const E0=fi(Q);class J2 extends w_{project(e,i){i=fi(i),e=fi(e);const s=Math.cos(i),u=2/Math.PI,p=Math.acos(s*Math.cos(e/2)),_=Math.sin(p)/p,v=.5*(e*u+2*s*Math.sin(e/2)/_)||0,E=.5*(i+Math.sin(i)/_)||0;return{x:.5*(v/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,p=25;const _=1e-6;let v=0,E=0;do{const C=Math.cos(u),k=Math.sin(u),F=2*k*C,V=k*k,j=C*C,$=Math.cos(s/2),ee=Math.sin(s/2),oe=2*$*ee,se=ee*ee,ge=1-j*$*$,xe=ge?1/ge:0,Ie=ge?Math.acos(C*$)*Math.sqrt(1/ge):0,He=.5*(2*Ie*C*ee+2*s/Math.PI)-e,Ne=.5*(Ie*k+u)-i,We=.5*xe*(j*se+Ie*C*$*V)+1/Math.PI,at=xe*(oe*F/4-Ie*k*ee),ct=.125*xe*(F*ee-Ie*k*j*oe),Gt=.5*xe*(V*$+Ie*se*C)+.5,pt=at*ct-Gt*We;v=(Ne*at-He*Gt)/pt,E=(He*ct-Ne*We)/pt,s=te(s-v,-Math.PI,Math.PI),u=te(u-E,-E0,E0)}while((Math.abs(v)>_||Math.abs(E)>_)&&--p>0);return new a(hi(s),hi(u))}}class A0 extends w_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:u}=this;return{x:fi(e)*u*s+.5,y:-Math.sin(fi(i))/u*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:u}=this,p=-(i-.5)/s,_=te(hi((e-.5)/s)/u,-180,180),v=Math.asin(te(p*u,-1,1)),E=te(hi(v),-Q,Q);return new a(_,E)}}class Q2 extends T0{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const u=qm(e,i,s);return ra(u,u,wf(Ju(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i,s){const u=Au(i.lat,i.lng),p=Cn([],u),_=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ln(u,u,p,N(1,0)*pi*_);const v=Wi(new Float64Array(16));return Ci(v,e.pixelMatrix,e.globeMatrix),ra(u,u,v),new je(u[0],u[1])}pixelsPerMeter(e,i){return N(1,0)*i}pixelSpaceConversion(e,i,s){const u=N(1,e)*i,p=Gn(N(1,45)*i,u,s);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,s){const u=Am(Ju(s.canonical));return Ci(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:s}=e,u=wf(Ju(i));return Hn(u,u,fi(s.lng)),Oi(u,u,fi(s.lat)),Vn(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,s,u){return bf(e,i,s,!0)||new Te(0,0)}pointCoordinate3D(e,i,s){const u=this.pointCoordinate(e,i,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!bf(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=(function(u,p){const _=u.cameraToCenterDistance,v=u._centerAltitude*p,E=u._camera,C=u._camera.forward(),k=yn([],ai([],C,-_),[0,0,v]),F=u.worldSize/(2*Math.PI),V=[0,0,-F],j=u.width/u.height,$=Math.tan(u.fovAboveCenter),ee=ai([],E.up(),$),oe=ai([],E.right(),$*j),se=Cn([],yn([],yn([],C,ee),oe)),ge=[];let xe;if(new en(k,se).closestPointOnSphere(V,F,ge)){const Ie=yn([],ge,V),He=zr([],Ie,k);xe=Math.cos(u.fovAboveCenter)*Qr(He)}else{const Ie=zr([],k,V),He=zr([],V,k);Cn(He,He);const Ne=Qr(Ie)-F;xe=Math.sqrt(Ne*(Ne+2*F));const We=Math.acos(xe/(F+Ne))-Math.acos(Cr(C,He));xe*=Math.cos(We)}return 1.01*xe})(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=tu(e.zoom);if(s>0){const u=b0(e,N(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Gn(i,u+p*(1-Math.cos(_)),Math.pow(s,10))}return i}upVector(e,i,s){return qm(i,s,e,1)}upVectorScale(e){return{metersToTile:vh(Hm(Ju(e)))}}}function I0(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new T0(r);case"equirectangular":return new W2(r);case"naturalEarth":return new K2(r);case"equalEarth":return new X2(r);case"winkelTripel":return new J2(r);case"albers":return i?new A0(r):new Z2(r);case"lambertConformalConic":return i?new A0(r):new Y2(r);case"globe":return new Q2(r)}throw new Error(`Invalid projection name: ${r.name}`)}const eT=ht.types,tT=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function kg(r,e,i,s,u,p,_,v,E,C,k,F,V){const j=v?Math.min(s_,Math.round(v[0])):0,$=v?Math.min(s_,Math.round(v[1])):0;r.emplaceBack(e,i,Math.round(32*s),Math.round(32*u),p,_,(j<<1)+(E?1:0),0+($<<1),16*C,16*k,256*F,256*V)}function Og(r,e,i){r.emplaceBack(e,i)}function Bg(r,e,i,s,u,p,_){r.emplaceBack(e,i,s,u,p,_)}const Ay=(r,e,i,s)=>{for(let u=0;u<e;u++)r.emplaceBack(i[0],i[1],i[2],s[0],s[1],s[2])};function rg(r,e,i,s,u){r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u),r.emplaceBack(e,i,s,u)}function iT(r){for(const e of r.sections)if(Dp(e.text))return!0;return!1}class Ex{constructor(e){this.layoutVertexArray=new cp,this.indexArray=new ao,this.programConfigurations=e,this.segments=new xs,this.dynamicLayoutVertexArray=new Bd,this.opacityVertexArray=new pf,this.placedSymbolArray=new ym,this.iconTransitioningVertexArray=new Tu,this.globeExtVertexArray=new Op,this.zOffsetVertexArray=new Zh,this.orientationVertexArray=new _m,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){const s=[],u=this.layoutVertexArray.uint16;for(let p=0;p<i;++p){const _=12*(e+p);s.push(...u.slice(_,_+12))}return s}updateIconVertexData(e,i,s,u,p,_,v,E,C,k,F,V,j){const $=this.layoutVertexArray.uint16,ee=12*e;$[ee]=i,$[ee+1]=s,$[ee+2]=u,$[ee+3]=p,$[ee+4]=_,$[ee+5]=v,$[ee+6]=E,$[ee+7]=C,$[ee+8]=k,$[ee+9]=F,$[ee+10]=V,$[ee+11]=j}upload(e,i,s,u,p,_){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,r2.members,!!_),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,s2.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,tT,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,c2.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,a2.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,o2.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,l2.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}di(Ex,"SymbolBuffers");class Ax{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new xs,this.collisionVertexArray=new Xh,this.collisionVertexArrayExt=new Bd}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,u2.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,h2.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}di(Ax,"CollisionBuffers");class Iy{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map((_=>_.fqid)),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Wi([]),this.placementViewportMatrix=Wi([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=Q_(this.zoom,i["text-size"],this.worldview),this.iconSizeData=Q_(this.zoom,i["icon-size"],this.worldview);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),p=s.get("symbol-z-order");this.lut=e.lut,this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map((_=>Gd[_])),this.stateDependentLayerIds=this.layers.filter((_=>_.isStateDependent())).map((_=>_.id)),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some((s=>s.getProperty(e)!=null))}createArrays(){this.text=new Ex(new yh(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("text")||e.startsWith("symbol")))),this.icon=new Ex(new yh(this.layers,{zoom:this.zoom,lut:this.lut},(e=>e.startsWith("icon")||e.startsWith("symbol")))),this.glyphOffsetArray=new Vd,this.lineVertexArray=new Bp,this.symbolInstances=new gf}calculateGlyphDependencies(e,i,s,u,p){for(const _ of e){const v=_.codePointAt(0);if(v===void 0)break;if(i[v]=!0,u&&p&&v<=65535){const E=Sg[_];E&&(i[E.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,s,u,p,_){let v=1;const E=e.getUnevaluatedProperties()._values["icon-size"],C=Q_(this.zoom,E,this.worldview),k=eg(C,i);if(C.kind!=="constant"&&C.kind!=="camera"||(v=k.uSize),C.kind==="composite"){const{minZoom:F,maxZoom:V}=C,j=E.possiblyEvaluate(new Xa(F,{worldview:this.worldview}),u),$=E.possiblyEvaluate(new Xa(V,{worldview:this.worldview}),u),ee=j.evaluate(s,{},u,p);v=ee+($.evaluate(s,{},u,p)-ee)*k.uSizeT}return C.kind==="source"&&(v=E.possiblyEvaluate(new Xa(this.zoom,{worldview:this.worldview}),u).evaluate(s,{},u,p)),v*_}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Th(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?Io.build(e):e}populate(e,i,s,u){const p=this.layers[0],_=p.layout,v=this.projection.name==="globe",E=_.get("text-font"),C=_.get("text-field"),k=_.get("icon-image"),[F,V]=_.get("icon-size-scale-range"),j=te(i.scaleFactor||1,F,V),$=(C.value.kind!=="constant"||C.value.value instanceof Pl&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),ee=k.value.kind!=="constant"||!!k.value.value||Object.keys(k.parameters).length>0,oe=this.hasAnyAppearanceProperty("icon-image"),se=_.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!$&&!ee&&!oe)return;const ge=i.iconDependencies,xe=i.glyphDependencies,Ie=i.availableImages,He=new Xa(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),Ne=We=>{const at=We.id.toString();ge.has(at)?ge.get(at).push(We):ge.set(at,[We])};for(const We of e){const{feature:at,id:ct,index:Gt,sourceLayerIndex:pt}=We,Xt=p._featureFilter.needGeometry,ni=ft(at,Xt);if(!p._featureFilter.filter(He,ni,s))continue;if(Xt||(ni.geometry=it(at,s,u)),v&&at.type!==1&&s.z<=5){const yi=ni.geometry,ki=.98078528056,Ii=(Dn,tn)=>Cr(qm(Dn.x,Dn.y,s,1),qm(tn.x,tn.y,s,1))<ki;for(let Dn=0;Dn<yi.length;Dn++)yi[Dn]=Ve(yi[Dn],Ii)}let ri,vi;if($){const yi=p.getValueAndResolveTokens("text-field",ni,s,Ie),ki=Pl.factory(yi);iT(ki)&&(this.hasRTLText=!0),(!this.hasRTLText||wu()==="unavailable"||this.hasRTLText&&qu.isParsed())&&(ri=f2(ki,p,ni))}if(ee){const yi=p.getValueAndResolveTokens("icon-image",ni,s,Ie);vi=this.getResolvedImageFromTokens(yi)}const wi=this.layers[0];let _i=!1;if(!vi&&oe){const yi=wi.getAppearances();for(const ki of yi)if(ki.getProperty("icon-image")){const Ii=wi.getAppearanceValueAndResolveTokens(ki,"icon-image",ni,s,Ie);if(Ii){vi=this.getResolvedImageFromTokens(Ii),_i=!0;break}}}if(!ri&&!vi)continue;const gi=this.sortFeaturesByKey?se.evaluate(ni,{},s):void 0,Zt={id:ct,text:ri,icon:vi,index:Gt,sourceLayerIndex:pt,geometry:ni.geometry,properties:at.properties,type:eT[at.type],sortKey:gi};if(this.features.push(Zt),this.featureToAppearanceIndex[Gt]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:ct,properties:at.properties,usesAppearanceIconAsPlaceholder:_i,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),vi){const yi=wi._unevaluatedLayout._values,{iconPrimary:ki,iconSecondary:Ii}=Mg(vi,this.iconSizeData,yi["icon-size"],s,this.zoom,Zt,this.pixelRatio,j,this.worldview);Ne(ki),Ii&&(this.hasAnySecondaryIcon=!0,Ne(Ii))}const $t=wi.getAppearances();if($t.length!==0&&$t.forEach((yi=>{if(!yi.getProperty("icon-image"))return;const ki=this.getCombinedIconPrimary(yi,wi,ni,s,Ie,Zt,j);ki&&Ne(ki)})),ri){const yi=E.evaluate(ni,{},s).join(","),ki=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gd.vertical)>=0;for(const Ii of ri.sections)if(Ii.image){const Dn=Ii.image.getPrimary().scaleSelf(this.pixelRatio),tn=Dn.id.toString(),sn=ge.get(tn)||[];sn.push(Dn),ge.set(tn,sn)}else{const Dn=_o(ri.toString()),tn=Ii.fontStack||yi,sn=xe[tn]=xe[tn]||{};this.calculateGlyphDependencies(Ii.text,sn,ki,this.allowVerticalPlacement,Dn)}}}if(_.get("symbol-placement")==="line"&&(this.features=(function(We){const at={},ct={},Gt=[];let pt=0;function Xt(wi){Gt.push(We[wi]),pt++}function ni(wi,_i,gi){const Zt=ct[wi];return delete ct[wi],ct[_i]=Zt,Gt[Zt].geometry[0].pop(),Gt[Zt].geometry[0]=Gt[Zt].geometry[0].concat(gi[0]),Zt}function ri(wi,_i,gi){const Zt=at[_i];return delete at[_i],at[wi]=Zt,Gt[Zt].geometry[0].shift(),Gt[Zt].geometry[0]=gi[0].concat(Gt[Zt].geometry[0]),Zt}function vi(wi,_i,gi){const Zt=gi?_i[0][_i[0].length-1]:_i[0][0];return`${wi}:${Zt.x}:${Zt.y}`}for(let wi=0;wi<We.length;wi++){const _i=We[wi],gi=_i.geometry,Zt=_i.text?_i.text.toString():null;if(!Zt){Xt(wi);continue}const $t=vi(Zt,gi),yi=vi(Zt,gi,!0);if($t in ct&&yi in at&&ct[$t]!==at[yi]){const ki=ri($t,yi,gi),Ii=ni($t,yi,Gt[ki].geometry);delete at[$t],delete ct[yi],ct[vi(Zt,Gt[Ii].geometry,!0)]=Ii,Gt[ki].geometry=null}else $t in ct?ni($t,yi,gi):yi in at?ri($t,yi,gi):(Xt(wi),at[$t]=pt-1,ct[yi]=pt-1)}return Gt.filter((wi=>wi.geometry))})(this.features)),_.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const We of i.elevationFeatures)this.elevationFeatureIdToIndex.set(We.id,this.elevationFeatures.length),this.elevationFeatures.push(We)}}else _.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((We,at)=>We.sortKey-at.sortKey))}getCombinedIconPrimary(e,i,s,u,p,_,v){let E,C;const k=e.getUnevaluatedProperties();if(k._values["icon-image"].value!==void 0){const F=i.getAppearanceValueAndResolveTokens(e,"icon-image",s,u,p);E=this.getResolvedImageFromTokens(F)}else{const F=i.getValueAndResolveTokens("icon-image",s,u,p);E=this.getResolvedImageFromTokens(F)}if(E){const F=k._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];C=Mg(E,Q_(this.zoom,F,this.worldview),F,u,this.zoom,_,this.pixelRatio,v,this.worldview).iconPrimary}return C}updateAppearanceBasedIconTextures(e,i,s,u){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const p=this.layers[0];let _=!1,v=0;const E=p.layout,[C,k]=E.get("icon-size-scale-range"),F=te(1,C,k);for(let V=0;V<this.symbolInstances.length;V++){const j=this.symbolInstances.get(V),$=this.featureToAppearanceIndex[j.featureIndex],ee=$!==void 0?this.appearanceFeatureData[$]:void 0;if(ee&&j.placedIconSymbolIndex>=0){const oe=ee.id,se=i&&oe!==void 0?i[String(oe)]:void 0,ge={type:"Point",id:ee.id,properties:ee.properties,geometry:[]},xe=this.layers[0].appearances&&this.layers[0].appearances.find((Ie=>Ie.isActive({globals:u,feature:ge,canonical:e,featureState:se})));if(ee.activeAppearance===xe){v+=j.numIconVertices;continue}if(xe){ee.activeAppearance=xe;const Ie=this.getCombinedIconPrimary(xe,p,ge,e,s,{sortKey:void 0,text:void 0,icon:null,index:j.featureIndex,sourceLayerIndex:j.featureIndex,geometry:[],properties:ee.properties,type:"Point",id:ee.id},F);if(!Ie)continue;const He=Ie.toString(),Ne=this.iconAtlasPositions&&this.iconAtlasPositions.get(He);if(Ne){const We=p.getAppearanceValueAndResolveTokens(xe,"icon-offset",ge,e,s),at=We&&Array.isArray(We)?We:[0,0];let ct=gy(Ne,void 0,at,p.layout.get("icon-anchor").evaluate(ge,{},e));const Gt=p.getAppearanceValueAndResolveTokens(xe,"icon-rotate",ge,e,s),pt=typeof Gt=="number"?Gt:0,Xt=Ne.sdf,ni=p.layout.get("icon-text-fit").constantOr("none");ni!=="none"&&ee.textShaping&&ee.iconTextFitPadding&&ee.fontScale&&(ct=gx(ct,ee.textShaping,ni,ee.iconTextFitPadding,at,ee.fontScale));const ri=this.calculateEffectiveAppearanceIconSize(xe,u.zoom,ge,e,s,F),vi=0,wi=1+(Math.min(s_,Math.round(ri*nm))<<1),_i=bx(ct,pt,Xt,ni!=="none",F);ee.isUsingAppearanceVertexData||(ee.isUsingAppearanceVertexData=!0,ee.layoutBasedVertexData=this.icon.getIconVertexData(v,j.numIconVertices));for(let Zt=0;Zt<_i.length;++Zt){const $t=_i[Zt],yi=ee.layoutBasedVertexData[0]||j.tileAnchorX,ki=ee.layoutBasedVertexData[1]||j.tileAnchorY,Ii=16*$t.pixelOffsetTL.x,Dn=16*$t.pixelOffsetTL.y,tn=16*$t.pixelOffsetBR.x,sn=16*$t.pixelOffsetBR.y,bn=16*$t.minFontScaleX,Vr=16*$t.minFontScaleY;this.icon.updateIconVertexData(v,yi,ki,Math.round(32*$t.tl.x),Math.round(32*$t.tl.y),$t.texPrimary.x,$t.texPrimary.y,vi,wi,Ii,Dn,bn,Vr),this.icon.updateIconVertexData(v+1,yi,ki,Math.round(32*$t.tr.x),Math.round(32*$t.tr.y),$t.texPrimary.x+$t.texPrimary.w,$t.texPrimary.y,vi,wi,tn,Dn,bn,Vr),this.icon.updateIconVertexData(v+2,yi,ki,Math.round(32*$t.bl.x),Math.round(32*$t.bl.y),$t.texPrimary.x,$t.texPrimary.y+$t.texPrimary.h,vi,wi,Ii,sn,bn,Vr),this.icon.updateIconVertexData(v+3,yi,ki,Math.round(32*$t.br.x),Math.round(32*$t.br.y),$t.texPrimary.x+$t.texPrimary.w,$t.texPrimary.y+$t.texPrimary.h,vi,wi,tn,sn,bn,Vr),v+=4}const gi=j.numIconVertices-4*_i.length;for(let Zt=0;Zt<gi;++Zt)this.icon.updateIconVertexData(v+Zt,0,0,0,0,0,0,0,0,0,0,0,0);_=!0}else v+=j.numIconVertices}else if(ee.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(v,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(v+3,0,0,0,0,0,0,0,0,0,0,0,0),_=!0),v+=j.numIconVertices,ee.activeAppearance=null;else if(ee.isUsingAppearanceVertexData){const He=ee.layoutBasedVertexData.length/12;for(let Ne=0;Ne<He;++Ne){const We=Ne*12;this.icon.updateIconVertexData(v+Ne,ee.layoutBasedVertexData[We+0],ee.layoutBasedVertexData[We+1],ee.layoutBasedVertexData[We+2],ee.layoutBasedVertexData[We+3],ee.layoutBasedVertexData[We+4],ee.layoutBasedVertexData[We+5],ee.layoutBasedVertexData[We+6],ee.layoutBasedVertexData[We+7],ee.layoutBasedVertexData[We+8],ee.layoutBasedVertexData[We+9],ee.layoutBasedVertexData[We+10],ee.layoutBasedVertexData[We+11])}v+=He,ee.isUsingAppearanceVertexData=!1,ee.activeAppearance=null,_=!0}else v+=j.numIconVertices,ee.activeAppearance=null}}return _}update(e,i,s,u,p,_,v){this.text.programConfigurations.updatePaintArrays(e,i,p,s,u,_,v,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,p,s,u,_,v,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const s=fe(e),u=1/s;let p=!1,_=!1;for(let v=0;v<this.symbolInstances.length;v++){const E=this.symbolInstances.get(v),C=ui(1,0,0),k=ui(0,1,0),{numHorizontalGlyphVertices:F,numVerticalGlyphVertices:V,numIconVertices:j,numVerticalIconVertices:$}=E,ee=F>0||V>0,oe=j>0,se=this.elevationFeatures[E.elevationFeatureIndex];if(se){const ge=new je(E.tileAnchorX,E.tileAnchorY),xe=.075+se.pointElevation(ge);E.zOffset!==xe&&(i=!0,E.zOffset=xe),xe!==0&&(this.hasAnyZOffset=!0);const Ie=se.computeSlopeNormal(ge,u),He=Sn(Vs(),ui(0,0,1),Ie);Da(C,C,He),Da(k,k,He),C[2]*=s,k[2]*=s,C[0]===1&&C[1]===0&&C[2]===0&&k[0]===0&&k[1]===1&&k[2]===0||(p=p||ee,_=_||oe)}if(ee&&(Ay(this.text.orientationVertexArray,F,C,k),Ay(this.text.orientationVertexArray,V,C,k)),oe){const{placedIconSymbolIndex:ge,verticalPlacedIconSymbolIndex:xe}=E;ge>=0&&Ay(this.icon.orientationVertexArray,j,C,k),xe>=0&&Ay(this.icon.orientationVertexArray,$,C,k)}}p||(this.text.orientationVertexArray=void 0),_||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(p,_,v)=>{s+=_,s>p.length&&p.resize(s);for(let E=-_;E<0;E++)p.emplace(E+s,v)},i=(p,_,v)=>{u+=_,u>p.length&&p.resize(u);for(let E=-_;E<0;E++)p.emplace(E+u,v)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,u=0;for(let p=0;p<this.symbolInstances.length;p++){const _=this.symbolInstances.get(p),{numHorizontalGlyphVertices:v,numVerticalGlyphVertices:E,numIconVertices:C}=_,k=_.zOffset,F=C>0;if((v>0||E>0)&&(e(this.text.zOffsetVertexArray,v,k),e(this.text.zOffsetVertexArray,E,k)),F){const{placedIconSymbolIndex:V,verticalPlacedIconSymbolIndex:j}=_;V>=0&&i(this.icon.zOffsetVertexArray,C,k),j>=0&&i(this.icon.zOffsetVertexArray,_.numVerticalIconVertices,k)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,s,u,p){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some((_=>_.appearances&&_.appearances.length>0))),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,s,u){return!!(e&&i&&s)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,s,u)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=I0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:p}of i)this.lineVertexArray.emplaceBack(u,p);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee,oe,se,ge){const xe=e.indexArray,Ie=e.layoutVertexArray,He=e.globeExtVertexArray,Ne=e.segments.prepareSegment(4*ge,Ie,xe,this.canOverlap?_.sortKey:void 0),We=this.glyphOffsetArray.length,at=Ne.vertexLength,ct=this.allowVerticalPlacement&&v===Gd.vertical?Math.PI/2:0,Gt=_.text&&_.text.sections;for(let ni=0;ni<i.length;ni++){const{tl:ri,tr:vi,bl:wi,br:_i,texPrimary:gi,texSecondary:Zt,pixelOffsetTL:$t,pixelOffsetBR:yi,minFontScaleX:ki,minFontScaleY:Ii,glyphOffset:Dn,isSDF:tn,sectionIndex:sn}=i[ni],bn=Ne.vertexLength,Vr=Dn[1];if(kg(Ie,C.x,C.y,ri.x,Vr+ri.y,gi.x,gi.y,s,tn,$t.x,$t.y,ki,Ii),kg(Ie,C.x,C.y,vi.x,Vr+vi.y,gi.x+gi.w,gi.y,s,tn,yi.x,$t.y,ki,Ii),kg(Ie,C.x,C.y,wi.x,Vr+wi.y,gi.x,gi.y+gi.h,s,tn,$t.x,yi.y,ki,Ii),kg(Ie,C.x,C.y,_i.x,Vr+_i.y,gi.x+gi.w,gi.y+gi.h,s,tn,yi.x,yi.y,ki,Ii),E){const{x:zi,y:wn,z:fr}=E.anchor,[ha,xa,Ar]=E.up;Bg(He,zi,wn,fr,ha,xa,Ar),Bg(He,zi,wn,fr,ha,xa,Ar),Bg(He,zi,wn,fr,ha,xa,Ar),Bg(He,zi,wn,fr,ha,xa,Ar),rg(e.dynamicLayoutVertexArray,zi,wn,fr,ct)}else rg(e.dynamicLayoutVertexArray,C.x,C.y,C.z,ct);if(oe){const zi=Zt||gi;Og(e.iconTransitioningVertexArray,zi.x,zi.y),Og(e.iconTransitioningVertexArray,zi.x+zi.w,zi.y),Og(e.iconTransitioningVertexArray,zi.x,zi.y+zi.h),Og(e.iconTransitioningVertexArray,zi.x+zi.w,zi.y+zi.h)}xe.emplaceBack(bn,bn+1,bn+2),xe.emplaceBack(bn+1,bn+2,bn+3),Ne.vertexLength+=4,Ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dn[0]),ni!==i.length-1&&sn===i[ni+1].sectionIndex||e.programConfigurations.populatePaintArrays(Ie.length,_,_.index,{},j,$,ee,Gt&&Gt[sn],this.worldview)}const pt=ge-i.length;pt!==0&&this._addNullVertices(pt,Ie,s,E,He,e,oe,Ne,xe);const Xt=E?E.anchor:C;e.placedSymbolArray.emplaceBack(Xt.x,Xt.y,Xt.z,C.x,C.y,We,this.glyphOffsetArray.length-We,at,k,F,C.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],v,0,0,0,V,0),e.symbolInstanceIndices.push(se)}_addNullVertices(e,i,s,u,p,_,v,E,C){for(let k=0;k<e;k++){for(let V=0;V<4;V++)kg(i,0,0,0,0,0,0,s,!1,0,0,0,0),u&&Bg(p,0,0,0,0,0,0),rg(_.dynamicLayoutVertexArray,0,0,0,0),v&&Og(_.iconTransitioningVertexArray,0,0);const F=E.vertexLength;C.emplaceBack(F,F+1,F+2),C.emplaceBack(F+1,F+2,F+3),E.vertexLength+=4,E.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,s,u,p,_,v){e.emplaceBack(i,s,u,p,_,Math.round(v.x),Math.round(v.y))}_addCollisionDebugVertices(e,i,s,u,p,_,v){const E=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),C=E.vertexLength,k=v.tileAnchorX,F=v.tileAnchorY;for(let j=0;j<4;j++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,v.zOffset),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,k,F,new je(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,k,F,new je(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,k,F,new je(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,p,_,k,F,new je(e.x1,e.y2)),E.vertexLength+=4;const V=s.indexArray;V.emplaceBack(C,C+1),V.emplaceBack(C+1,C+2),V.emplaceBack(C+2,C+3),V.emplaceBack(C+3,C),E.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,u,p,_){for(let v=u;v<p;v++){const E=s.get(v),C=this.getSymbolInstanceTextSize(e,_,i,v);this._addCollisionDebugVertices(E,C,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,i,s,u,p,_){for(let v=u;v<p;v++){const E=s.get(v),C=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._addCollisionDebugVertices(E,C,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ax(hp,Hv.members,Tu),this.iconCollisionBox=new Ax(hp,Hv.members,Tu);const u=eg(this.iconSizeData,e),p=eg(this.textSizeData,e,s);for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_);this._addTextDebugCollisionBoxes(p,e,i,v.textBoxStartIndex,v.textBoxEndIndex,v),this._addTextDebugCollisionBoxes(p,e,i,v.verticalTextBoxStartIndex,v.verticalTextBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,e,i,v.iconBoxStartIndex,v.iconBoxEndIndex,v),this._addIconDebugCollisionBoxes(u,e,i,v.verticalIconBoxStartIndex,v.verticalIconBoxEndIndex,v)}}getSymbolInstanceTextSize(e,i,s,u){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),_=yx(this.textSizeData,e,p)/sc;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,i,s){const u=this.icon.placedSymbolArray.get(s),p=yx(this.iconSizeData,e,u);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,s,u){e.emplaceBack(i,-s,-s,u),e.emplaceBack(i,s,-s,u),e.emplaceBack(i,s,s,u),e.emplaceBack(i,-s,s,u)}_updateTextDebugCollisionBoxes(e,i,s,u,p,_,v){for(let E=u;E<p;E++){const C=s.get(E),k=this.getSymbolInstanceTextSize(e,_,i,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,k,C.padding,_.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,u,p,_,v){for(let E=u;E<p;E++){const C=s.get(E),k=this.getSymbolInstanceIconSize(e,i,_.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,k,C.padding,_.zOffset)}}updateCollisionDebugBuffers(e,i,s,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const p=eg(this.iconSizeData,e,u),_=eg(this.textSizeData,e,s);for(let v=0;v<this.symbolInstances.length;v++){const E=this.symbolInstances.get(v);this._updateTextDebugCollisionBoxes(_,e,i,E.textBoxStartIndex,E.textBoxEndIndex,E,s),this._updateTextDebugCollisionBoxes(_,e,i,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,s),this._updateIconDebugCollisionBoxes(p,e,i,E.iconBoxStartIndex,E.iconBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(p,e,i,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,u,p,_,v,E,C){const k={};if(i<s){const{x1:F,y1:V,x2:j,y2:$,padding:ee,projectedAnchorX:oe,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:xe,tileAnchorY:Ie,featureIndex:He}=e.get(i);k.textBox={x1:F,y1:V,x2:j,y2:$,padding:ee,projectedAnchorX:oe,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:xe,tileAnchorY:Ie},k.textFeatureIndex=He}if(u<p){const{x1:F,y1:V,x2:j,y2:$,padding:ee,projectedAnchorX:oe,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:xe,tileAnchorY:Ie,featureIndex:He}=e.get(u);k.verticalTextBox={x1:F,y1:V,x2:j,y2:$,padding:ee,projectedAnchorX:oe,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:xe,tileAnchorY:Ie},k.verticalTextFeatureIndex=He}if(_<v){const{x1:F,y1:V,x2:j,y2:$,padding:ee,projectedAnchorX:oe,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:xe,tileAnchorY:Ie,featureIndex:He}=e.get(_);k.iconBox={x1:F,y1:V,x2:j,y2:$,padding:ee,projectedAnchorX:oe,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:xe,tileAnchorY:Ie},k.iconFeatureIndex=He}if(E<C){const{x1:F,y1:V,x2:j,y2:$,padding:ee,projectedAnchorX:oe,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:xe,tileAnchorY:Ie,featureIndex:He}=e.get(E);k.verticalIconBox={x1:F,y1:V,x2:j,y2:$,padding:ee,projectedAnchorX:oe,projectedAnchorY:se,projectedAnchorZ:ge,tileAnchorX:xe,tileAnchorY:Ie},k.verticalIconFeatureIndex=He}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),u=s.vertexStartIndex+4*s.numGlyphs;for(let p=s.vertexStartIndex;p<u;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),u=[],p=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const E=this.symbolInstances.get(v);u.push(0|Math.round(i*E.tileAnchorX+s*E.tileAnchorY)),p.push(E.featureIndex)}return _.sort(((v,E)=>u[v]-u[E]||p[E]-p[v])),_}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset))}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:v,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:C}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),p>=0&&p!==u&&this.addIndicesForPlacedSymbol(this.text,p),_>=0&&_!==p&&_!==u&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&this.addIndicesForPlacedSymbol(this.text,v),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),C>=0&&this.addIndicesForPlacedSymbol(this.icon,C)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let s;return this.elevationFeatures&&i<this.elevationFeatures.length&&(s=this.elevationFeatures[i]),s}}function M0(r,e){return e.replace(/{([^{}]+)}/g,((i,s)=>s in r?String(r[s]):""))}let C0,z0,Ix;di(Iy,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Iy.addDynamicAttributes=rg;class D0{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Dc,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}di(D0,"FormatSectionOverride",{omit:["defaultValue"]});const Mx=()=>Ix||(Ix={layout:C0||(C0=new ca({"symbol-placement":new xi(xt.layout_symbol["symbol-placement"]),"symbol-spacing":new xi(xt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new xi(xt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Fi(xt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new xi(xt.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new xi(xt.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new xi(xt.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new xi(xt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new xi(xt.layout_symbol["icon-ignore-placement"]),"icon-optional":new xi(xt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new xi(xt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Fi(xt.layout_symbol["icon-size"]),"icon-size-scale-range":new xi(xt.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Fi(xt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Fi(xt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Fi(xt.layout_symbol["icon-image"]),"icon-image-use-theme":new xi({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Fi(xt.layout_symbol["icon-rotate"]),"icon-padding":new xi(xt.layout_symbol["icon-padding"]),"icon-keep-upright":new xi(xt.layout_symbol["icon-keep-upright"]),"icon-offset":new Fi(xt.layout_symbol["icon-offset"]),"icon-anchor":new Fi(xt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new xi(xt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new xi(xt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new xi(xt.layout_symbol["text-rotation-alignment"]),"text-field":new Fi(xt.layout_symbol["text-field"]),"text-font":new Fi(xt.layout_symbol["text-font"]),"text-size":new Fi(xt.layout_symbol["text-size"]),"text-size-scale-range":new xi(xt.layout_symbol["text-size-scale-range"]),"text-max-width":new Fi(xt.layout_symbol["text-max-width"]),"text-line-height":new Fi(xt.layout_symbol["text-line-height"]),"text-letter-spacing":new Fi(xt.layout_symbol["text-letter-spacing"]),"text-justify":new Fi(xt.layout_symbol["text-justify"]),"text-radial-offset":new Fi(xt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new xi(xt.layout_symbol["text-variable-anchor"]),"text-anchor":new Fi(xt.layout_symbol["text-anchor"]),"text-max-angle":new xi(xt.layout_symbol["text-max-angle"]),"text-writing-mode":new xi(xt.layout_symbol["text-writing-mode"]),"text-rotate":new Fi(xt.layout_symbol["text-rotate"]),"text-padding":new xi(xt.layout_symbol["text-padding"]),"text-keep-upright":new xi(xt.layout_symbol["text-keep-upright"]),"text-transform":new Fi(xt.layout_symbol["text-transform"]),"text-offset":new Fi(xt.layout_symbol["text-offset"]),"text-allow-overlap":new xi(xt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new xi(xt.layout_symbol["text-ignore-placement"]),"text-optional":new xi(xt.layout_symbol["text-optional"]),visibility:new xi(xt.layout_symbol.visibility)})),paint:z0||(z0=new ca({"icon-opacity":new Fi(xt.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Fi(xt.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Fi(xt.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Fi(xt.paint_symbol["text-emissive-strength"]),"icon-color":new Fi(xt.paint_symbol["icon-color"]),"icon-halo-color":new Fi(xt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Fi(xt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Fi(xt.paint_symbol["icon-halo-blur"]),"icon-translate":new xi(xt.paint_symbol["icon-translate"]),"icon-translate-anchor":new xi(xt.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new xi(xt.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Fi(xt.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Fi(xt.paint_symbol["text-occlusion-opacity"]),"text-color":new Fi(xt.paint_symbol["text-color"],{runtimeType:Kl,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new Fi(xt.paint_symbol["text-halo-color"]),"text-halo-width":new Fi(xt.paint_symbol["text-halo-width"]),"text-halo-blur":new Fi(xt.paint_symbol["text-halo-blur"]),"text-translate":new xi(xt.paint_symbol["text-translate"]),"text-translate-anchor":new xi(xt.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new xi(xt.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new xi(xt.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new xi(xt.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new xi(xt.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Fi(xt.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},Ix);class My extends Zs{constructor(e,i,s,u){super(e,Mx(),i,s,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Wi([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach((u=>{u.recalculate(e,i,this.iconImageUseTheme)})),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const p of s)u.indexOf(p)<0&&u.push(p);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===u||(this._colorAdjustmentMatrix=(function(p,_,v,E){p=da(p),_=jr(_);const C=on(),k=p/3,F=1-2*k,V=[F,k,k,0,k,F,k,0,k,k,F,0,0,0,0,1],j=.5-.5*_,$=E-v;return Ci(C,[$,0,0,0,0,$,0,0,0,0,$,0,v,v,v,1],[_,0,0,0,0,_,0,0,0,0,_,0,j,j,j,1]),Ci(C,C,V),C})(e,i,s,u),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,u){const p=this.layout.get(e).evaluate(i,{},s,u),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||ks(_.value)||!p?p:M0(i.properties,p)}getAppearanceValueAndResolveTokens(e,i,s,u,p){const _=e.getProperty(i);if(!_)return;const v=_.evaluate(s,{},u,p),E=e.getUnevaluatedProperties()._values[i];return E.isDataDriven()||ks(E.value)||!v||typeof v!="string"?v:M0(s.properties,v)}createBucket(e){return new Iy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Mx().paint.overridableProperties){if(!My.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new D0(i),u=new mc(s,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new Os("source",u):new Ms("composite",u,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Qc(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&My.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),u=Mx().paint.properties[i];let p=!1;const _=v=>{for(const E of v)if(u.overrides&&u.overrides.hasOverride(E))return void(p=!0)};if(s.value.kind==="constant"&&s.value.value instanceof Pl)_(s.value.value.sections);else if(s.value.kind==="source"){const v=C=>{p||(C instanceof Rc&&no(C.value)===rd?_(C.value.sections):C instanceof Mo?_(C.sections):C.eachChild(v))},E=s.value;E._styleExpression&&v(E._styleExpression.expression)}return p}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new vd(this,{zoom:i,lut:s}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let R0,P0,L0,k0;var Cx=Zr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Cy(r,e,i,s,u,p,_,v){const E=[r,e,1,i,s,1,u,p,1],C=[_,v,1],k=bt([],E),[F,V,j]=Aa(C,C,k);return rn(E,E,[F,0,0,0,V,0,0,0,j])}function O0(r,e,i,s,u,p,_,v){const E=(function(C,k,F,V,j,$,ee,oe){const se=Cy(0,0,1,0,1,1,0,1),ge=Cy(C,k,F,V,j,$,ee,oe);return rn(ge,ge,bt([],se))})(r,e,i,s,u,p,_,v);return[E[2]/E[8]/pi,E[5]/E[8]/pi]}function zy(r){return[r[0],Math.min(Math.max(r[1],-Q),Q)]}class B0 extends id{constructor(e,i,s,u){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Dl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ah(this.map._requestManager.transformRequest(this.url,zc.Image),((s,u)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new ed(s)):u&&(this.image=u instanceof HTMLImageElement?Ks.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())}))}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new bg(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Dl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof bg||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const p of e)p[1]>s&&(s=p[1]),p[1]<i&&(i=p[1]);const u=(s+i)/2;if(u>Q?this.onNorthPole=!0:u<-Q&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Te.fromLngLat);this.tileID=(function(_){let v=1/0,E=1/0,C=-1/0,k=-1/0;for(const ee of _)v=Math.min(v,ee.x),E=Math.min(E,ee.y),C=Math.max(C,ee.x),k=Math.max(k,ee.y);const F=Math.max(C-v,k-E),V=Math.max(0,Math.floor(-Math.log2(F))),j=Math.pow(2,V);let $=Math.floor((v+C)/2*j);return $>1&&($-=1),new Na(V,$,Math.floor((E+k)/2*j))})(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Dl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof bg||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const se in this.tiles){const ge=this.tiles[se];ge.state!=="loaded"&&(ge.state="loaded",ge.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=zg(new Na(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(se){const ge=se[1].x-se[0].x,xe=se[1].y-se[0].y,Ie=se[2].x-se[1].x,He=se[2].y-se[1].y,Ne=se[3].x-se[2].x,We=se[3].y-se[2].y,at=se[0].x-se[3].x,ct=se[0].y-se[3].y,Gt=ge*He-Ie*xe,pt=Ie*We-Ne*He,Xt=Ne*ct-at*We,ni=at*xe-ge*ct;return Gt>0&&pt>0&&Xt>0&&ni>0||Gt<0&&pt<0&&Xt<0&&ni<0})(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=zg(this.tileID,this.map.transform.projection),[p,_,v,E]=this.coordinates.map((se=>{const ge=u.projection.project(se[0],se[1]);return w0(u,ge)._round()}));this.perspectiveTransform=O0(p.x,p.y,_.x,_.y,v.x,v.y,E.x,E.y);const C=this._boundsArray=new df;C.emplaceBack(p.x,p.y,0,0),C.emplaceBack(_.x,_.y,pi,0),C.emplaceBack(E.x,E.y,0,pi),C.emplaceBack(v.x,v.y,pi,pi),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(C,Cx.members),this.boundsSegments=xs.simpleSegment(0,0,4,2);const k=[],F=[zy((V=this.coordinates)[0]),zy(V[1]),zy(V[2]),zy(V[3])];var V;const[j,$,ee,oe]=(function(se){let ge=se[0][0],xe=ge,Ie=se[0][1],He=Ie;for(let Ne=1;Ne<se.length;Ne++)se[Ne][0]<ge?ge=se[Ne][0]:se[Ne][0]>xe&&(xe=se[Ne][0]),se[Ne][1]<Ie?Ie=se[Ne][1]:se[Ne][1]>He&&(He=se[Ne][1]);return[ge,Ie,xe-ge,He-Ie]})(F);{const se=new df,[ge,xe,Ie,He]=(function(_i){let gi=_i[0].x,Zt=gi,$t=_i[0].y,yi=$t;for(let ki=1;ki<_i.length;ki++)_i[ki].x<gi?gi=_i[ki].x:_i[ki].x>Zt&&(Zt=_i[ki].x),_i[ki].y<$t?$t=_i[ki].y:_i[ki].y>yi&&(yi=_i[ki].y);return[gi,$t,Zt-gi,yi-$t]})(s),Ne=_i=>[(_i.x-ge)/Ie,(_i.y-xe)/He],[We,at,ct,Gt]=s.map(Ne),pt=(function(_i,gi,Zt,$t,yi,ki,Ii,Dn){const tn=Cy(0,0,1,0,1,1,0,1);return rn(tn,tn,bt([],Cy(_i,gi,Zt,$t,yi,ki,Ii,Dn)))})(We[0],We[1],at[0],at[1],ct[0],ct[1],Gt[0],Gt[1]);this.elevatedGlobePerspectiveTransform=O0(We[0],We[1],at[0],at[1],ct[0],ct[1],Gt[0],Gt[1]);const Xt=(_i,gi)=>{k.push(_i.lng);const Zt=Math.round((_i.lng-j)/ee*pi),$t=Math.round((_i.lat-$)/oe*pi),yi=Ne(gi),ki=Aa([],[yi[0],yi[1],1],pt),Ii=Math.round(ki[0]/ki[2]*pi),Dn=Math.round(ki[1]/ki[2]*pi);se.emplaceBack(Zt,$t,Ii,Dn)},ni=s[3].x-s[0].x,ri=s[3].y-s[0].y,vi=s[2].x-s[1].x,wi=s[2].y-s[1].y;for(let _i=0;_i<65;_i++){const gi=_i/64,Zt=[s[0].x+gi*ni,s[0].y+gi*ri],$t=[s[1].x+gi*vi,s[1].y+gi*wi],yi=$t[0]-Zt[0],ki=$t[1]-Zt[1];for(let Ii=0;Ii<65;Ii++){const Dn=Ii/64,tn={x:Zt[0]+yi*Dn,y:Zt[1]+ki*Dn};Xt(i.projection.unproject(tn.x,tn.y),tn)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(se,Cx.members)}{this.maxLongitudeTriangleSize=0;let se=[],ge=new ao;const xe=(Ie,He,Ne)=>{ge.emplaceBack(Ie,He,Ne);const We=k[Ie],at=k[He],ct=k[Ne],Gt=Math.min(Math.min(We,at),ct),pt=Math.max(Math.max(We,at),ct)-Gt;pt>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=pt),se.push(Gt+pt/2)};for(let Ie=0;Ie<64;Ie++)for(let He=0;He<64;He++){const Ne=65*Ie+He,We=Ne+1,at=Ne+65,ct=at+1;xe(Ne,at,We),xe(We,at,ct)}[se,ge]=(function(Ie,He){const Ne=Array.from({length:Ie.length},((ct,Gt)=>Gt));Ne.sort(((ct,Gt)=>Ie[ct]-Ie[Gt]));const We=[],at=new ao;for(let ct=0;ct<Ne.length;ct++){const Gt=Ne[ct];We.push(Ie[Gt]);const pt=3*Gt,Xt=pt+1;at.emplaceBack(He.uint16[pt],He.uint16[Xt],He.uint16[Xt+1])}return[We,at]})(se,ge),this.elevatedGlobeTrianglesCenterLongitudes=se,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(ge)}this.elevatedGlobeSegments=xs.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,ee/pi,0,oe/pi,0,0,$,j,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof bg||(this.texture?this.texture.update(this.image):(this.texture=new ex(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let u=(p=e+180)+360*Math.round((s[0]-p)/360);var p;const _=new xs,v=(F,V)=>{_.segments.push({vertexOffset:0,primitiveOffset:F,vertexLength:i.segments[0].vertexLength,primitiveLength:V,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-u)<=E){const F=ea(s,0,s.length,u+E);return F===s.length||v(F,js(s,F+1,s.length,u+360-E)-F),_}u<s[0]&&(u+=360);const C=js(s,0,s.length,u-E);if(C===s.length)return v(0,s.length),_;v(0,C-0);const k=ea(s,C+1,s.length,u+E);return k!==s.length&&v(k,s.length-k),_}}const nT=(Math.pow(256,2)-1)/16907520;class F0 extends Zs{constructor(e,i,s,u){super(e,{layout:L0||(L0=new ca({visibility:new xi(xt.layout_raster.visibility)})),paint:k0||(k0=new ca({"raster-opacity":new xi(xt.paint_raster["raster-opacity"]),"raster-color":new gd(xt.paint_raster["raster-color"]),"raster-color-mix":new xi(xt.paint_raster["raster-color-mix"]),"raster-color-range":new xi(xt.paint_raster["raster-color-range"]),"raster-hue-rotate":new xi(xt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new xi(xt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new xi(xt.paint_raster["raster-brightness-max"]),"raster-saturation":new xi(xt.paint_raster["raster-saturation"]),"raster-contrast":new xi(xt.paint_raster["raster-contrast"]),"raster-resampling":new xi(xt.paint_raster["raster-resampling"]),"raster-fade-duration":new xi(xt.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new xi(xt.paint_raster["raster-emissive-strength"]),"raster-array-band":new xi(xt.paint_raster["raster-array-band"]),"raster-elevation":new xi(xt.paint_raster["raster-elevation"]),"raster-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof B0&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(u)||s===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=$f({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:u}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,u])}}let N0,V0,U0,j0,G0;class q0 extends Zs{constructor(e,i,s,u){super(e,{layout:N0||(N0=new ca({visibility:new xi(xt["layout_raster-particle"].visibility)})),paint:V0||(V0=new ca({"raster-particle-array-band":new xi(xt["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new xi(xt["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new gd(xt["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new xi(xt["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new xi(xt["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new xi(xt["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new xi(xt["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new xi(xt["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},i,s,u),this._updateColorRamp(),this.lastInvalidatedAt=Ks.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=$f({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ks.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class rT extends Zs{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function zx(r,e,i){const s=[0,0,1],u=qs([]);return cn(u,u,i?-fi(r)+Math.PI:fi(r)),Us(u,u,-fi(e)),Da(s,s,u),Cn(s,s)}const H0={None:0,Model:1,Symbol:2,FillExtrusion:4};class Dy{constructor(e,i,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function Dx(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class $0{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class Z0{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Fm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let u=Math.floor(s[i+2]);const p=1.05*(s[i+2]-u);return u/=100,[s[i]%1*1.05,s[i+1]%1*1.05,p,u]}tileCoordinatesForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let u=s[i+0];return u=u>pi?u-pi:u,new je(Math.trunc(u),Math.trunc(s[i+1]))}translationForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+4],s[i+5],s[i+6]]}rotationScaleForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+10],s[i+11],s[i+12],s[i+13],s[i+14],s[i+15]]}transformForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+4],s[i+10],s[i+11],s[i+12],s[i+5],s[i+13],s[i+14],s[i+15],s[i+6],0,0,0,1]}}class Rx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map((i=>i.fqid)),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((i=>i.isStateDependent())).map((i=>i.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,u){}populate(e,i,s,u){this.tileToMeter=fe(s);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:_,id:v,index:E,sourceLayerIndex:C}of e){const k=v??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),F=ft(_,p);if(!this.layers[0]._featureFilter.filter(new Xa(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),F,s))continue;const V={id:k,sourceLayerIndex:C,index:E,geometry:p?F.geometry:it(_,s,u),properties:_.properties,type:_.type,patterns:{}},j=this.addFeature(V,V.geometry,F);j&&i.featureIndex.insert(_,V.geometry,E,C,this.index,this.instancesPerModel[j].instancedDataArray.length,pi/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let s=0;for(const u of this.modelUris){const p=e.getModel(u,i);if(!p)continue;const _=this.instancesPerModel[u];if(_){const v=.5*Jn(p.aabb.max,p.aabb.min)*_.maxScale+_.maxXYTranslationDistance,E=Math.min(pi,Math.max(v/this.tileToMeter,pi/32));s=Math.max(E,s)}}return s}update(e,i,s,u){for(const p in this.instancesPerModel){const _=this.instancesPerModel[p];for(const v in e)_.idToFeaturesIndex.hasOwnProperty(v)&&(this.evaluate(_.features[_.idToFeaturesIndex[v]],e[v],_,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const u of s.features){const p=this.layers[0],_=u.feature,v=this.canonical,E=p.paint.get("model-rotation").evaluate(_,{},v),C=p.paint.get("model-scale").evaluate(_,{},v),k=p.paint.get("model-translation").evaluate(_,{},v);Ha(u.rotation,E)&&Ha(u.scale,C)&&Ha(u.translation,k)||(this.evaluate(u,u.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,u){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const p=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Th(this.activeReplacements,p))return!1;this.activeReplacements=p;let _=!1;for(const v in this.instancesPerModel){const E=this.instancesPerModel[v],C=E.instancedDataArray;for(const k of E.features){const F=k.instancedDataOffset,V=k.instancedDataCount;for(let j=0;j<V;j++){const $=16*(j+F);let ee=C.float32[$+0];const oe=ee>pi;ee=oe?ee-pi:ee;const se=Math.floor(ee),ge=Math.floor(C.float32[$+1]);let xe=!1;for(const Ie of this.activeReplacements)if(!Vc(Ie,s,H0.Model,u)&&!(Ie.min.x>se||se>Ie.max.x||Ie.min.y>ge||ge>Ie.max.y)&&(xe=z_(vp(se,ge,e.canonical,Ie.footprintTileId.canonical),Ie.footprint),xe))break;C.float32[$]=xe?ee+pi:ee,_=_||xe!==oe}}}return _}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,Iw.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const s in this.instancesPerModel){const u=this.instancesPerModel[s];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(e&&i&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)i.removeModel(s,"",!0)}addFeature(e,i,s){const u=this.layers[0],p=u.layout.get("model-id").evaluate(s,{},this.canonical);if(!p)return Bi(`modelId is not evaluated for layer ${u.id} and it is not going to get rendered.`),p;(Dx(p,!1)||this.styleDefinedModelURLs[p]!==void 0)&&(this.modelUris.includes(p)||this.modelUris.push(p)),this.instancesPerModel[p]||(this.instancesPerModel[p]=new Z0);const _=this.instancesPerModel[p],v=_.instancedDataArray,E=new $0(s,v.length);for(const C of i)for(const k of C){if(k.x<0||k.x>=pi||k.y<0||k.y>=pi)continue;if(this.lookupDim!==0){const V=(this.lookupDim-1)/pi,j=this.lookupDim*(k.y*V|0)+k.x*V|0;if(this.lookup){if(this.lookup[j]!==0)continue;this.lookup[j]=1}}this.instanceCount++;const F=v.length;v.resize(F+1),_.instancesEvaluatedElevation.push(0),v.float32[16*F]=k.x,v.float32[16*F+1]=k.y}return E.instancedDataCount=_.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(e.id&&(_.idToFeaturesIndex[e.id]=_.features.length),_.features.push(E),this.evaluate(E,{},_,!1)),p}getModelUris(){return this.modelUris}evaluate(e,i,s,u){const p=this.layers[0],_=e.feature,v=this.canonical,E=e.rotation=p.paint.get("model-rotation").evaluate(_,i,v),C=e.scale=p.paint.get("model-scale").evaluate(_,i,v),k=e.translation=p.paint.get("model-translation").evaluate(_,i,v),F=Object.assign({},p.paint.get("model-color").evaluate(_,i,v));F.a=p.paint.get("model-color-mix-intensity").evaluate(_,i,v);const V=[];this.maxVerticalOffset<k[2]&&(this.maxVerticalOffset=k[2]);const j=k[0]*k[0]+k[1]*k[1],$=j>0?Math.sqrt(j):0;s.maxScale=Math.max(Math.max(s.maxScale,C[0]),Math.max(C[1],C[2])),s.maxXYTranslationDistance=Math.max(s.maxXYTranslationDistance,$),this.maxScale=Math.max(Math.max(this.maxScale,C[0]),Math.max(C[1],C[2])),Sv(V,E,C);const ee=Math.round(100*F.a)+F.b/1.05;for(let oe=0;oe<e.instancedDataCount;++oe){const se=e.instancedDataOffset+oe,ge=16*se,xe=s.instancedDataArray.float32;let Ie=0;u&&(Ie=xe[ge+6]-s.instancesEvaluatedElevation[se]);const He=0|xe[ge+1];xe[ge]=(0|xe[ge])+F.r/1.05,xe[ge+1]=He+F.g/1.05,xe[ge+2]=ee,xe[ge+3]=1/(v.z>10?this.tileToMeter:fe(v,He)),xe[ge+4]=k[0],xe[ge+5]=k[1],xe[ge+6]=k[2]+Ie,xe[ge+7]=V[0],xe[ge+8]=V[1],xe[ge+9]=V[2],xe[ge+10]=V[4],xe[ge+11]=V[5],xe[ge+12]=V[6],xe[ge+13]=V[8],xe[ge+14]=V[9],xe[ge+15]=V[10],s.instancesEvaluatedElevation[se]=k[2]}}}let X0,W0;di(Rx,"ModelBucket",{omit:["layers"]}),di(Z0,"PerModelAttributes"),di($0,"ModelFeature");class ag{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const u=s||e.findDEMTileFor(i);if(!u||!u.dem)return;const p=u.dem,_=u.tileID,v=1<<i.canonical.z-_.canonical.z;return new ag(u,p.dim/pi/v,[(i.canonical.x/v-_.canonical.x)*p.dim,(i.canonical.y/v-_.canonical.y)*p.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1];return new je(Math.floor(e*this._scale+this._offset[0]),Math.floor(s))}getElevationAt(e,i,s,u){const p=e*this._scale+this._offset[0],_=i*this._scale+this._offset[1],v=Math.floor(p),E=Math.floor(_),C=this._dem;return u=!!u,s?Gn(Gn(C.get(v,E,u),C.get(v,E+1,u),_-E),Gn(C.get(v+1,E,u),C.get(v+1,E+1,u),_-E),p-v):C.get(v,E,u)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*N(1,e)*this._dem.stride}}const Px=new Float32Array(262144),U_=new Uint8Array(262144);function Y0(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,Y0(i));return e}function K0(r,e,i){if(r.meshes)for(const s of r.meshes){if(s.aabb.min[0]===1/0)continue;const u=_n.applyTransform(s.aabb,r.globalMatrix);i.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(r.children)for(const s of r.children)K0(s,e,i)}const J0=["","wall","door","roof","window","lamp","logo"];class Q0{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Y0(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new _n([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=_n.applyTransformFast(s.aabb,this.node.globalMatrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Ry{constructor(e,i,s,u,p,_,v,E){this.id=s,this.layers=e,this.layerIds=this.layers.map((C=>C.fqid)),this.stateDependentLayerIds=this.layers.filter((C=>C.isStateDependent())).map((C=>C.id)),this.modelTraits|=Y_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=Y_.HasMapboxMeshFeatures),p&&(this.modelTraits|=Y_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=_,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const C of i)this.nodesInfo.push(new Q0(C)),K0(C,v.featureIndexArray.length,v.grid),v.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,v.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const s of this.getNodesInfo()){const u=s.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}updateAppearances(e,i,s,u){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!ei(e,this.states))for(const u of s)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const u=s.node;this.uploaded?this.updatePbrBuffer(u):nx(u,e,!0)}for(const s of i)fy(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const u=e.transform.projectionOptions,p=e.style.getBrightness(),_=this.brightness!==p;if(!this.uploaded||this.dirty||u.name!==this.projection.name||Fg(s.paint.get("model-color").value,_)||Fg(s.paint.get("model-color-mix-intensity").value,_)||Fg(s.paint.get("model-roughness").value,_)||Fg(s.paint.get("model-emissive-strength").value,_)||Fg(s.paint.get("model-height-based-emissive-strength-multiplier").value,_)){this.projection=u,this.brightness=p;const v=this.getNodesInfo();for(const E of v)E.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),u=this.id.canonical;for(const p of s){const _=p.feature;p.evaluatedTranslation=i.paint.get("model-translation").evaluate(_,{},u),p.evaluatedScale=i.paint.get("model-scale").evaluate(_,{},u)}}evaluate(e,i){const s=this.getNodesInfo();for(const u of s){if(!u.node.meshes)continue;const p=u.feature,_=i&&i[p.id];if(ei(_,u.state))continue;u.state=structuredClone(_);const v=u.node.meshes&&u.node.meshes[0].featureData,E=u.evaluatedColor[2],C=u.evaluatedRMEA[2],k=this.id.canonical;if(u.hasTranslucentParts=!1,v){for(let F=0;F<J0.length;F++){const V=J0[F];V.length&&(p.properties.part=V);const j=e.paint.get("model-color").evaluate(p,_,k).toPremultipliedRenderColor(null),$=e.paint.get("model-color-mix-intensity").evaluate(p,_,k);u.evaluatedColor[F]=[j.r,j.g,j.b,$],u.evaluatedRMEA[F][0]=e.paint.get("model-roughness").evaluate(p,_,k),u.evaluatedRMEA[F][2]=e.paint.get("model-emissive-strength").evaluate(p,_,k),u.evaluatedRMEA[F][3]=j.a,u.emissionHeightBasedParams[F]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(p,_,k),!u.hasTranslucentParts&&j.a<1&&(u.hasTranslucentParts=!0)}delete p.properties.part,sT(u,E!==u.evaluatedColor[2]||C!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(p,_,k);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(p,_,k),u.evaluatedScale=e.paint.get("model-scale").evaluate(p,_,k),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,u){const p=e.findDEMTileFor(s);if(p&&(p.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const _=ag.create(e,s,p);if(!_)return;this.modelTraits&Y_.HasMapboxMeshFeatures&&this.updateDEM(e,_,s,u);for(const v of this.getNodesInfo()){const E=v.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const C=E.footprint.vertices;let k=_.getElevationAt(C[0].x,C[0].y,!0,!0);for(let F=1;F<C.length;F++)k=Math.min(k,_.getElevationAt(C[F].x,C[F].y,!0,!0));E.elevation=k}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,u){let p=i._dem._modifiedForSources[u];if(p===void 0&&(i._dem._modifiedForSources[u]=[],p=i._dem._modifiedForSources[u]),p.includes(s.canonical))return;const _=i._dem.dim;p.push(s.canonical);let v=!1;for(const E of this.getNodesInfo()){const C=E.node;if(!C.footprint||!C.footprint.grid)continue;const k=C.footprint.grid,F=i.tileCoordToPixel(k.min.x,k.min.y),V=i.tileCoordToPixel(k.max.x,k.max.y),j=Math.min(Math.min(_-V.y,F.x),Math.min(F.y,_-V.x));if(j<0)continue;const $=te(j,2,5);let ee=Math.max(0,F.x-$),oe=Math.max(0,F.y-$),se=Math.min(V.x+$,_-1),ge=Math.min(V.y+$,_-1);for(let Ne=oe;Ne<=ge;++Ne)for(let We=ee;We<=se;++We)U_[Ne*_+We]=255;let xe=0,Ie=0;for(let Ne=0;Ne<k.cellsY;++Ne)for(let We=0;We<k.cellsX;++We){if(!k.cells[Ne*k.cellsX+We])continue;const at=i.tileCoordToPixel(k.min.x+We/k.xScale,k.min.y+Ne/k.yScale),ct=i.tileCoordToPixel(k.min.x+(We+1)/k.xScale,k.min.y+(Ne+1)/k.yScale);for(let Gt=at.y;Gt<=Math.min(ct.y+1,_-1);++Gt)for(let pt=at.x;pt<=Math.min(ct.x+1,_-1);++pt)U_[Gt*_+pt]===255&&(U_[Gt*_+pt]=0,xe+=i.getElevationAtPixel(pt,Gt),Ie++)}const He=xe/Ie;ee=Math.max(1,F.x-$),oe=Math.max(1,F.y-$),se=Math.min(V.x+$,_-2),ge=Math.min(V.y+$,_-2),v=!0;for(let Ne=oe;Ne<=ge;++Ne)for(let We=ee;We<=se;++We)U_[Ne*_+We]===0&&(Px[Ne*_+We]=i._dem.set(We,Ne,He));for(let Ne=1;Ne<$;++Ne){ee=Math.max(1,F.x-Ne),oe=Math.max(1,F.y-Ne),se=Math.min(V.x+Ne,_-2),ge=Math.min(V.y+Ne,_-2);for(let We=oe;We<=ge;++We)for(let at=ee;at<=se;++at){const ct=We*_+at;if(U_[ct]===255){let Gt=0,pt=0,Xt=-1,ni=-1;for(let ri=-1;ri<=1;++ri)for(let vi=-1;vi<=1;++vi){const wi=(We+ri)*_+at+vi;if(U_[wi]>=Ne)continue;const _i=Px[wi],gi=Math.abs(_i);gi>pt&&(Gt=_i,pt=gi,Xt=vi,ni=ri)}if(pt>.1){const ri=1-(Ne+.5*Math.abs(Xt*ni))/$;let vi=i._dem.get(at,We)+Gt*ri;const wi=i._dem.get(at+Xt,We+ni),_i=i._dem.get(at-Xt,We-ni,!0);(vi-wi)*(vi-_i)>0&&(vi=(wi+_i)/2),Px[ct]=i._dem.set(at,We,vi),U_[ct]=Ne}}}}}v&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ks.now())}setFilter(e){this.filter=e?Ld(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((e=>this.filter.filter(new Xa(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical))):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)fy(i.node),rx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const p=u.node.footprint;u.hiddenByReplacement=!!p&&!s.find((_=>_.footprint===p))}}getHeightAtTileCoord(e,i){const s=[],u=[0,0,0],p=Wi([]);for(const _ of this.getNodesInfo()){const v=_.node.meshes[0],E=v.transformedAabb;if(e<E.min[0]||i<E.min[1]||e>E.max[0]||i>E.max[1])continue;if(_.node.hidden===!0)return{height:1/0,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};Tn(p,_.node.globalMatrix),u[0]=e,u[1]=i,ra(u,u,p);const C=(u[0]-v.aabb.min[0])/(v.aabb.max[0]-v.aabb.min[0])*F_|0,k=Math.min(63,(u[1]-v.aabb.min[1])/(v.aabb.max[1]-v.aabb.min[1])*F_|0)*F_+Math.min(63,C),F=v.heightmap[k];if(!(F<0&&_.node.footprint))return _.hiddenByReplacement?void 0:{height:F,maxHeight:_.feature.properties.height,hidden:!1,verticalScale:_.evaluatedScale[2]};if(_.node.footprint.grid.query(new je(e,i),new je(e,i),s),s.length>0)return{height:void 0,maxHeight:_.feature.properties.height,hidden:_.hiddenByReplacement,verticalScale:_.evaluatedScale[2]}}}}function Fg(r,e){return r instanceof Os&&!r.isLightConstant&&e}function aT(r,e,i,s,u,p,_,v){let E=(61440&e|(61440&e)>>4)>>8,C=(3840&e|(3840&e)>>4)>>4,k=240&e|(240&e)>>4;i[3]>0&&(E=Gn(E,255*i[0],i[3]),C=Gn(C,255*i[1],i[3]),k=Gn(k,255*i[2],i[3]));const F=E<<8|C,V=k<<8|Math.floor(255*s[3]),j=(function(Ne){const We=te(Ne,0,2);return Math.min(Math.round(.5*We*255),255)})(s[2])<<8|15*s[0]<<4|15*s[1],$=te(u[0],0,1),ee=te(u[1],0,1),oe=te(u[2],0,1),se=te(u[3],0,1);let ge,xe,Ie,He;if($!==ee&&_!==p&&ee!==$){const Ne=_-p;xe=1/(Ne*(ee-$)),Ie=-(p+Ne*$)/(Ne*(ee-$));const We=te(u[4],-1,1);He=Math.pow(10,We),ge=255*oe<<8|255*se}else ge=65535,xe=0,Ie=1,He=1;if(r.emplaceBack(F,V,j,ge,xe,Ie,He),v){const Ne=v.length;v.clear();for(let We=0;We<Ne;We++)v.emplaceBack(F,V,j,ge,xe,Ie,He)}}function sT(r,e,i){const s=r.node;let u=0;const p=i&Y_.HasMeshoptCompression;for(const _ of s.meshes){if(s.lights&&s.lightMeshIndex===u||!_.featureData)continue;_.featureArray=new yo,_.featureArray.reserve(_.featureData.length);let v=e;for(const E of _.featureData){const C=p?65535&E:E>>16&65535,k=p?E>>16&65535:65535&E,F=(15&k)<8?15&k:0,V=r.evaluatedRMEA[F],j=r.evaluatedColor[F],$=r.emissionHeightBasedParams[F];let ee;if(v&&F===2&&s.lights&&(ee=new yo,ee.resize(10*s.lights.length)),aT(_.featureArray,C,j,V,$,_.aabb.min[2],_.aabb.max[2],ee),ee&&v){v=!1;const oe=s.meshes[s.lightMeshIndex];oe.featureArray=ee,oe.featureArray._trim()}}_.featureArray._trim(),u++}}di(Ry,"Tiled3dModelBucket",{omit:["layers"]}),di(Q0,"Tiled3dModelFeature");const oT=["id","tile","layer","source","sourceLayer","state"];class j_{constructor(e,i,s,u,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=u,this.properties=e?e.properties:{},this.id=p}clone(){const e=new j_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of oT)this[i]!==void 0&&(e[i]=this[i]);return e}}class G_ extends id{constructor(e,i,s,u){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){const e=[];for(const i in this._options.models){const s=this._options.models[i],u=this._modelsInfo.get(i);if(u){const p=u.model;p.position=s.position!=null?new a(s.position[0],s.position[1]):new a(0,0),p.orientation=s.orientation!=null?s.orientation:[0,0,0],u.modelSpec=s,G_.applyModelSpecification(p,s),p.computeBoundsAndApplyParent(),this.models.push(p)}else{const p=vv(this.map._requestManager.transformRequest(s.uri,zc.Model).url).then((_=>{if(!_)return;const v=sx(_),E=new Ev(i,s.uri,s.position,s.orientation,v);G_.applyModelSpecification(E,s),E.computeBoundsAndApplyParent(),this.models.push(E),this._modelsInfo.set(i,{modelSpec:s,model:E})})).catch((_=>{this.fire(new ed(new Error(`Could not load model ${i} from ${s.uri}: ${_.message}`)))}));e.push(p)}}Promise.allSettled(e).then((()=>{this._loaded=!0,this.fire(new Dl("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((i=>{this._loaded=!0,this.fire(new ed(new Error(`Could not load models: ${i.message}`)))}))}static applyModelSpecification(e,i){i.nodeOverrides&&G_.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&G_.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every((s=>typeof s=="string"))){e.nodeOverrideNames=[];for(const s of i)e.nodeOverrideNames.push(s)}else Object.entries(i).forEach((([s,u])=>{const p={orientation:[0,0,0]};if(u.hasOwnProperty("orientation")){const _=u.orientation;_&&(p.orientation=_)}e.nodeOverrides.set(s,p)}))}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every((s=>typeof s=="string"))){e.materialOverrideNames=[];for(const s of i)e.materialOverrideNames.push(s)}else Object.entries(i).forEach((([s,u])=>{const p={color:new Ta(1,1,1),colorMix:0,emissionStrength:0,opacity:1},_=u["model-color"];_!==void 0&&(p.color.r=_[0],p.color.g=_[1],p.color.b=_[2]);const v=u["model-color-mix-intensity"];v!==void 0&&(p.colorMix=v);const E=u["model-emissive-strength"];E!==void 0&&(p.emissionStrength=E);const C=u["model-opacity"];C!==void 0&&(p.opacity=C),e.materialOverrides.set(s,p)}))}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=vc(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const i=new Map;for(const s in e){const u=e[s];if(this._modelsInfo.has(s)){const p=this._modelsInfo.get(s);p&&p.modelSpec.uri===u.uri&&i.set(s,p)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function Lx(r,e,i,s){const u=1<<r.z;e.lat=Y((s/pi+r.y)/u),e.lng=U((i/pi+r.x)/u)}function lT(r,e,i,s){const u=r.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let p=Number.MAX_VALUE;const _=u.node,v=i.tile,E=s.calculatePosMatrix(v.tileID.toUnwrapped(),s.worldSize),C=u.evaluatedScale;let k=0;s.elevation&&_.elevation&&(k=_.elevation*s.elevation.exaggeration()),Ji(E,E,[(_.anchor?_.anchor[0]:0)*(C[0]-1),(_.anchor?_.anchor[1]:0)*(C[1]-1),k]),Vn(E,E,C);const F=i.queryGeometry,V=F.isPointQuery()?F.screenBounds:F.screenGeometry,j=function(ee){const oe=Ci([],E,ee.globalMatrix);Ci(oe,s.expandedFarZProjMatrix,oe);for(let se=0;se<ee.meshes.length;++se){const ge=ee.meshes[se];if(se===ee.lightMeshIndex)continue;const xe=ix(V,s,oe,ge.aabb);xe!=null&&(p=Math.min(xe,p))}if(ee.children)for(const se of ee.children)j(se)};if(j(_),p===Number.MAX_VALUE)return;const $=new a(0,0);return Lx(v.tileID.canonical,$,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:p,position:$,feature:u.feature}}const cT={circle:class extends Zs{constructor(r,e,i,s){super(r,{layout:ic||(ic=new ca({"circle-sort-key":new Fi(xt.layout_circle["circle-sort-key"]),"circle-elevation-reference":new xi(xt.layout_circle["circle-elevation-reference"]),visibility:new xi(xt.layout_circle.visibility)})),paint:Fs||(Fs=new ca({"circle-radius":new Fi(xt.paint_circle["circle-radius"]),"circle-color":new Fi(xt.paint_circle["circle-color"]),"circle-blur":new Fi(xt.paint_circle["circle-blur"]),"circle-opacity":new Fi(xt.paint_circle["circle-opacity"]),"circle-translate":new xi(xt.paint_circle["circle-translate"]),"circle-translate-anchor":new xi(xt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new xi(xt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new xi(xt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Fi(xt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Fi(xt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Fi(xt.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new xi(xt.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(r){return new Kr(r)}queryRadius(r){const e=r;return jl("circle-radius",this,e)+jl("circle-stroke-width",this,e)+fl(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,s,u,p,_,v){const E=Yu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Xp(r,s,p,_,v,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,C)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const s=Wm(this);return{config:new vd(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Zs{createBucket(r){return new Gl(r)}constructor(r,e,i,s){super(r,{layout:Hf||(Hf=new ca({visibility:new xi(xt.layout_heatmap.visibility)})),paint:f_||(f_=new ca({"heatmap-radius":new Fi(xt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Fi(xt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new xi(xt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new gd(xt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new xi(xt.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=$f({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return jl("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,s,u,p,_,v){const E=this.paint.get("heatmap-radius").evaluate(e,i);return Xp(r,s,p,_,v,!0,!0,new je(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new vd(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends Zs{constructor(r,e,i,s){super(r,{layout:Wp||(Wp=new ca({visibility:new xi(xt.layout_hillshade.visibility)})),paint:C_||(C_=new ca({"hillshade-illumination-direction":new xi(xt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new xi(xt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new xi(xt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new xi(xt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new xi(xt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new xi(xt.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new xi(xt.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends Zs{constructor(r,e,i,s){super(r,{layout:Nc||(Nc=new ca({"fill-sort-key":new Fi(xt.layout_fill["fill-sort-key"]),visibility:new xi(xt.layout_fill.visibility),"fill-elevation-reference":new xi(xt.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Fi(xt.layout_fill["fill-construct-bridge-guard-rail"])})),paint:rc||(rc=new ca({"fill-antialias":new xi(xt.paint_fill["fill-antialias"]),"fill-opacity":new Fi(xt.paint_fill["fill-opacity"]),"fill-color":new Fi(xt.paint_fill["fill-color"]),"fill-outline-color":new Fi(xt.paint_fill["fill-outline-color"]),"fill-translate":new xi(xt.paint_fill["fill-translate"]),"fill-translate-anchor":new xi(xt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Fi(xt.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new xi(xt.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new xi(xt.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Fi(xt.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Fi(xt.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Fi(xt.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new vd(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Sl(r)}queryRadius(){return fl(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,s,u,p){return!r.queryGeometry.isAboveHorizon&&wa(eu(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Zs{constructor(r,e,i,s){super(r,{layout:L_||(L_=new ca({visibility:new xi(xt["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new xi(xt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:yg||(yg=new ca({"fill-extrusion-opacity":new xi(xt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Fi(xt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new xi(xt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new xi(xt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Fi(xt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new xi(xt["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Fi(xt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Fi(xt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new xi(xt["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new xi(xt["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new xi(xt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new xi(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new xi(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new xi(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new xi(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new xi(xt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new xi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new xi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Fi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Fi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new xi(xt["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new xi(xt["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new xi(xt["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new xi(xt["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Fi(xt["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Fi(xt["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new xi(xt["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new au(r)}queryRadius(){return fl(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,s,u,p,_,v,E){const C=Yu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(e,i),F=this.paint.get("fill-extrusion-base").evaluate(e,i),V=[0,0],j=v&&p.elevation,$=p.elevation?p.elevation.exaggeration():1,ee=r.tile.getBucket(this);if(j&&ee instanceof au){const Ie=ee.centroidVertexArray,He=E+1;He<Ie.length&&(V[0]=Ie.geta_centroid_pos0(He),V[1]=Ie.geta_centroid_pos1(He))}if(V[0]===0&&V[1]===1)return!1;p.projection.name==="globe"&&(s=ny([s],[new je(0,0),new je(pi,pi)],r.tileID.canonical).map((Ie=>Ie.polygon)).flat());const oe=j?v:null,[se,ge]=B_(p,s,F,k,C,_,oe,V,$,p.center.lat,r.tileID.canonical),xe=r.queryGeometry;return sy(se,ge,xe.isPointQuery()?xe.screenBounds:xe.screenGeometry)}},building:class extends Zs{constructor(r,e,i,s){super(r,{layout:Rv||(Rv=new ca({visibility:new xi(xt.layout_building.visibility),"building-facade":new Fi(xt.layout_building["building-facade"]),"building-facade-floors":new Fi(xt.layout_building["building-facade-floors"]),"building-facade-unit-width":new Fi(xt.layout_building["building-facade-unit-width"]),"building-facade-window":new Fi(xt.layout_building["building-facade-window"]),"building-roof-shape":new Fi(xt.layout_building["building-roof-shape"]),"building-height":new Fi(xt.layout_building["building-height"]),"building-base":new Fi(xt.layout_building["building-base"]),"building-flood-light-wall-radius":new Fi(xt.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Fi(xt.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Fi(xt.layout_building["building-flip-roof-orientation"])})),paint:Pv||(Pv=new ca({"building-opacity":new xi(xt.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new xi(xt.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new xi(xt.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new xi(xt.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new xi(xt.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new xi(xt.paint_building["building-vertical-scale"]),"building-cast-shadows":new xi(xt.paint_building["building-cast-shadows"]),"building-color":new Fi(xt.paint_building["building-color"]),"building-emissive-strength":new Fi(xt.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new xi(xt.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new xi(xt.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new xi(xt.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new xi(xt.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new xi(xt.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Dv(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,i,s,u,p,_,v,E){let C=this.layout.get("building-height").evaluate(e,i);const k=this.layout.get("building-base").evaluate(e,i),F=r.tile.getBucket(this).getFootprint(e);if(F){if(F.hiddenFlags!==0)return!1;C=F.height}const[V,j]=B_(p,s,k,C,new je(0,0),_,null,[0,0],1,p.center.lat,r.tileID.canonical),$=r.queryGeometry;return sy(V,j,$.isPointQuery()?$.screenBounds:$.screenGeometry)}},line:class extends Zs{constructor(r,e,i,s){const u=Gv();super(r,u,e,i,s),u.layout&&(this.layout=new Pd(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Yc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(Tg)return Tg;const i=Gv();return Tg=new n2(i.paint.properties["line-width"].specification),Tg.useIntegerZoom=!0,Tg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new cx(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const s=Uv(this);return{config:new vd(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(r){const e=r,i=qv(jl("line-width",this,e),jl("line-gap-width",this,e)),s=jl("line-offset",this,e);return i/2+Math.abs(s)+fl(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,s,u,p){if(r.queryGeometry.isAboveHorizon)return!1;const _=eu(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),v=r.pixelToTileUnitsFactor/2*qv(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),E=this.paint.get("line-offset").evaluate(e,i);return E&&(s=(function(C,k){const F=[],V=new je(0,0);for(let j=0;j<C.length;j++){const $=C[j],ee=[];for(let oe=0;oe<$.length;oe++){const se=$[oe],ge=$[oe+1],xe=oe===0?V:se.sub($[oe-1])._unit()._perp(),Ie=oe===$.length-1?V:ge.sub(se)._unit()._perp(),He=xe._add(Ie)._unit();He._mult(1/(He.x*Ie.x+He.y*Ie.y)),ee.push(He._mult(k)._add(se))}F.push(ee)}return F})(s,E*r.pixelToTileUnitsFactor)),(function(C,k,F){for(let V=0;V<k.length;V++){const j=k[V];if(C.length>=3){for(let $=0;$<j.length;$++)if(qa(C,j[$]))return!0}if(Bs(C,j,F))return!0}return!1})(_,s,v)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:My,background:class extends Zs{constructor(r,e,i,s){super(r,{layout:R0||(R0=new ca({visibility:new xi(xt.layout_background.visibility)})),paint:P0||(P0=new ca({"background-pitch-alignment":new xi(xt.paint_background["background-pitch-alignment"]),"background-color":new xi(xt.paint_background["background-color"]),"background-pattern":new xi(xt.paint_background["background-pattern"]),"background-opacity":new xi(xt.paint_background["background-opacity"]),"background-emissive-strength":new xi(xt.paint_background["background-emissive-strength"]),"background-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:F0,"raster-particle":q0,sky:class extends Zs{constructor(r,e,i,s){super(r,{layout:U0||(U0=new ca({visibility:new xi(xt.layout_sky.visibility)})),paint:j0||(j0=new ca({"sky-type":new xi(xt.paint_sky["sky-type"]),"sky-atmosphere-sun":new xi(xt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new xi(xt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new xi(xt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new xi(xt.paint_sky["sky-gradient-radius"]),"sky-gradient":new gd(xt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new xi(xt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new xi(xt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new xi(xt.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=$f({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),u=!s,p=r.style.light,_=p.properties.get("position");return u&&p.properties.get("anchor")==="viewport"&&Bi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?zx(_.azimuthal,90-_.polar,e):zx(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return zx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Zs{constructor(r,e,i,s){super(r,{paint:G0||(G0=new ca({}))},e,null)}},model:class extends Zs{constructor(r,e,i,s){super(r,{layout:X0||(X0=new ca({visibility:new xi(xt.layout_model.visibility),"model-id":new Fi(xt.layout_model["model-id"])})),paint:W0||(W0=new ca({"model-opacity":new Fi(xt.paint_model["model-opacity"]),"model-rotation":new Fi(xt.paint_model["model-rotation"]),"model-scale":new Fi(xt.paint_model["model-scale"]),"model-translation":new Fi(xt.paint_model["model-translation"]),"model-color":new Fi(xt.paint_model["model-color"]),"model-color-mix-intensity":new Fi(xt.paint_model["model-color-mix-intensity"]),"model-type":new xi(xt.paint_model["model-type"]),"model-cast-shadows":new xi(xt.paint_model["model-cast-shadows"]),"model-receive-shadows":new xi(xt.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new xi(xt.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Fi(xt.paint_model["model-emissive-strength"]),"model-roughness":new Fi(xt.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Fi(xt.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new xi(xt.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new xi(xt.paint_model["model-front-cutoff"]),"model-elevation-reference":new xi(xt.paint_model["model-elevation-reference"]),"model-color-use-theme":new Fi({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Rx(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof Ry?pi-1:0}queryRenderedFeatures(r,e,i){const s=e.getSource();if(!(s&&s instanceof G_))return{};const u=s,p={};p[this.id]=[];const _=p[this.id];let v=0;for(const E of u.models){const C=e.getFeatureState(this.sourceLayer,E.id),k={type:"Unknown",id:E.id,properties:E.featureProperties},F=this.paint.get("model-rotation").evaluate(k,C),V=this.paint.get("model-scale").evaluate(k,C),j=this.paint.get("model-translation").evaluate(k,C),$=this.paint.get("model-elevation-reference");let ee=[];dy(ee,E,i,E.position,F,V,j,$==="ground",$==="ground",!1),i.projection.name==="globe"&&(ee=hy(ee,i));const oe=Ci([],i.projMatrix,ee),se=ix(r.isPointQuery()?r.screenBounds:r.screenGeometry,i,oe,E.aabb);if(se!=null){const ge=new j_(void 0,0,0,0,E.id);ge.layer=this.layer,ge.properties=structuredClone(E.featureProperties),ge.properties.layer=this.id,ge.properties.uri=E.uri,ge.properties.orientation=E.orientation,ge.sourceLayer=this.sourceLayer,ge.geometry={type:"Point",coordinates:[E.position.lng,E.position.lat]},ge.state=C,ge.source=this.source,_.push({featureIndex:v,feature:ge,intersectionZ:se})}++v}return p}queryIntersectsFeature(r,e,i,s,u,p){if(!this.modelManager)return!1;const _=this.modelManager,v=r.tile.getBucket(this);if(!(v&&v instanceof Rx))return!1;for(const E in v.instancesPerModel){const C=v.instancesPerModel[E],k=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(C.idToFeaturesIndex.hasOwnProperty(k)){const F=C.features[C.idToFeaturesIndex[k]],V=_.getModel(E,this.scope);if(!V)return!1;let j=[];const $=new a(0,0),ee=v.canonical;let oe=Number.MAX_VALUE;for(let se=0;se<F.instancedDataCount;++se){const ge=16*(F.instancedDataOffset+se),xe=C.instancedDataArray.float32,Ie=[xe[ge+4],xe[ge+5],xe[ge+6]];Lx(ee,$,Math.floor(xe[ge]),Math.floor(xe[ge+1])),dy(j,V,p,$,F.rotation,F.scale,Ie,!1,!1,!1),p.projection.name==="globe"&&(j=hy(j,p));const He=Ci([],p.projMatrix,j),Ne=r.queryGeometry,We=ix(Ne.isPointQuery()?Ne.screenBounds:Ne.screenGeometry,p,He,V.aabb);We!=null&&(oe=Math.min(We,oe))}return oe!==Number.MAX_VALUE&&oe}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ms}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Zs{constructor(r,e,i,s){super(r,{layout:ql||(ql=new ca({"clip-layer-types":new xi(xt.layout_clip["clip-layer-types"]),"clip-layer-scope":new xi(xt.layout_clip["clip-layer-scope"])})),paint:iu||(iu=new ca({}))},e,i,s)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new il(r)}is3D(r){return!0}}},kx=new Ta(0,0,0),Ox={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Bx={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Py={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},uT={PAINT_ORDER_FILL_AND_STROKE:1},Ng={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},eb={MASK_TYPE_LUMINANCE:1};function hT(r,e,i){r===1&&e.icons.push((function(s,u){return(function(p){if(p.usvg_tree.height||(p.usvg_tree.height=p.usvg_tree.width),!p.metadata)return p;const{metadata:_}=p;if(_.content_area){const{content_area:v}=_;v.left==null&&(v.left=0),v.top==null&&(v.top=v.left),v.width==null&&(v.width=p.usvg_tree.width),v.height==null&&(v.height=v.width)}if(_.text_placeholder){const{text_placeholder:v}=_;v.top==null&&(v.top=v.left),v.height==null&&(v.height=v.width)}return _.stretch_x&&_.stretch_x.length&&tb(_,"x"),_.stretch_y&&_.stretch_y.length&&tb(_,"y"),p})(s.readFields(dT,{name:void 0},u))})(i,i.readVarint()+i.pos))}function tb(r,e){const i=[],s=r[`stretch_${e}`];let u=null;for(let p=0;p<s.length;p++)u===null?u=i.length===0?s[0]:i[i.length-1][1]+s[p]:(i.push([u,u+s[p]]),u=null);r[`stretch_${e}_areas`]=i}function dT(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=(function(s,u){return s.readFields(fT,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)})(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=(function(s,u){return s.readFields(_T,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)})(i,i.readVarint()+i.pos),e.data="usvg_tree")}function fT(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=ib(i,i.readVarint()+i.pos):r===4?e.variables.push((function(s,u){return s.readFields(mT,{name:void 0},u)})(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=ib(i,i.readVarint()+i.pos))}function ib(r,e){return r.readFields(pT,{},e)}function pT(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function mT(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=Oy(i.readVarint()),e.value="rgb_color")}function _T(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(Ly(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push((function(s,u){return s.readFields(TT,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)})(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push((function(s,u){return s.readFields(ET,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)})(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push((function(s,u){return s.readFields(AT,{children:[]},u)})(i,i.readVarint()+i.pos)):r===8&&e.masks.push((function(s,u){const p=s.readFields(IT,{left:0,width:20,mask_type:eb.MASK_TYPE_LUMINANCE,children:[]},u);return p.height==null&&(p.height=p.width),p.top==null&&(p.top=p.left),p})(i,i.readVarint()+i.pos))}function Ly(r,e){return r.readFields(gT,{},e)}function gT(r,e,i){r===1?(e.group=(function(s,u){return s.readFields(yT,{opacity:255,children:[]},u)})(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=(function(s,u){return s.readFields(vT,{paint_order:1,commands:[],step:1,diffs:[],rule:Ox.PATH_RULE_NON_ZERO},u)})(i,i.readVarint()+i.pos),e.node="path")}function yT(r,e,i){r===1?e.transform=ky(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(Ly(i,i.readVarint()+i.pos))}function ky(r,e){return r.readFields(xT,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function xT(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function vT(r,e,i){r===1?e.fill=(function(s,u){return s.readFields(bT,{rgb_color:kx,paint:"rgb_color",opacity:255},u)})(i,i.readVarint()+i.pos):r===2?e.stroke=(function(s,u){return s.readFields(wT,{rgb_color:kx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)})(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function bT(r,e,i){r===1?(e.rgb_color=Oy(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function Oy(r){return new Ta((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function wT(r,e,i){r===1?(e.rgb_color=Oy(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function TT(r,e,i){r===1?e.transform=ky(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(nb(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function nb(r,e){return r.readFields(ST,{offset:0,opacity:255,rgb_color:kx},e)}function ST(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=Oy(i.readVarint()))}function ET(r,e,i){r===1?e.transform=ky(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(nb(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function AT(r,e,i){r===1?e.transform=ky(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(Ly(i,i.readVarint()+i.pos))}function IT(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(Ly(i,i.readVarint()+i.pos))}class MT{static calculate(e={},i=[]){const s=new Map,u=new Map;if(Object.keys(e).length===0)return s;i.forEach((p=>{u.set(p.name,p.rgb_color||new Ta(0,0,0))}));for(const[p,_]of Object.entries(e))u.has(p)?s.set(u.get(p).toString(),_):console.warn(`Ignoring unknown image variable "${p}"`);return s}}function sg(r,e=255,i){const s=e/255,u=r.toString(),p=i.has(u)?i.get(u).clone():r.clone();return p.a*=s,p.toString()}function Vg(r,e){if(!Mc()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}let Fx,Ug=null;function Nx(r,e,i,s,u){for(const p of s.children)rb(r,e,i,p,u)}function rb(r,e,i,s,u){s.group?(r.save(),(function(p,_,v,E,C){const k=E.mask_idx!=null?v.masks[E.mask_idx]:null,F=E.clip_path_idx!=null?v.clip_paths[E.clip_path_idx]:null;if(E.transform&&(_=og(E.transform).preMultiplySelf(_)),!(function($,ee,oe){return $.opacity!==255||ee||oe})(E,F!=null,k!=null))return void Nx(p,_,v,E,C);const V=Vg(p.canvas.width,p.canvas.height),j=V.getContext("2d");Nx(j,_,v,E,C),F&&hb(j,_,v,F),k&&db(j,_,v,k,C),p.globalAlpha=E.opacity/255,p.drawImage(V,0,0)})(r,e,i,s.group,u),r.restore()):s.path&&(r.save(),(function(p,_,v,E,C){p.setTransform(_),E.paint_order===uT.PAINT_ORDER_FILL_AND_STROKE?(ab(p,v,E,C),ob(p,v,E,C)):(ob(p,v,E,C),ab(p,v,E,C))})(r,e,i,s.path,u),r.restore())}function ab(r,e,i,s){const u=i.fill;if(!u)return;const p=u.opacity/255;switch(r.save(),r.beginPath(),fb(i,r),u.paint){case"rgb_color":r.fillStyle=sg(u.rgb_color,u.opacity,s);break;case"linear_gradient_idx":{const _=e.linear_gradients[u.linear_gradient_idx];_.transform&&r.setTransform(og(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=lb(r,_,p,s);break}case"radial_gradient_idx":{const _=e.radial_gradients[u.radial_gradient_idx];_.transform&&r.setTransform(og(_.transform).preMultiplySelf(r.getTransform())),r.fillStyle=cb(r,_,p,s)}}r.fill(sb(i)),r.restore()}function sb(r){return r.rule===Ox.PATH_RULE_NON_ZERO?"nonzero":r.rule===Ox.PATH_RULE_EVEN_ODD?"evenodd":void 0}function ob(r,e,i,s){const u=i.stroke;if(!u)return;const p=pb(i);r.lineWidth=u.width,r.miterLimit=u.miterlimit,r.setLineDash(u.dasharray),r.lineDashOffset=u.dashoffset;const _=u.opacity/255;switch(u.paint){case"rgb_color":r.strokeStyle=sg(u.rgb_color,u.opacity,s);break;case"linear_gradient_idx":r.strokeStyle=lb(r,e.linear_gradients[u.linear_gradient_idx],_,s,!0);break;case"radial_gradient_idx":r.strokeStyle=cb(r,e.radial_gradients[u.radial_gradient_idx],_,s,!0)}switch(u.linejoin){case Py.LINE_JOIN_MITER_CLIP:case Py.LINE_JOIN_MITER:r.lineJoin="miter";break;case Py.LINE_JOIN_ROUND:r.lineJoin="round";break;case Py.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(u.linecap){case Bx.LINE_CAP_BUTT:r.lineCap="butt";break;case Bx.LINE_CAP_ROUND:r.lineCap="round";break;case Bx.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(p)}function lb(r,e,i,s,u=!1){if(e.stops.length===1){const V=e.stops[0];return sg(V.rgb_color,V.opacity*i,s)}const{x1:p,y1:_,x2:v,y2:E}=e;let C=new DOMPoint(p,_),k=new DOMPoint(v,E);if(u){const V=og(e.transform);C=V.transformPoint(C),k=V.transformPoint(k)}const F=r.createLinearGradient(C.x,C.y,k.x,k.y);for(const V of e.stops)F.addColorStop(V.offset,sg(V.rgb_color,V.opacity*i,s));return F}function cb(r,e,i,s,u=!1){if(e.stops.length===1){const se=e.stops[0];return sg(se.rgb_color,se.opacity*i,s)}const p=og(e.transform),{fx:_,fy:v,fr:E,cx:C,cy:k,r:F}=e;let V=new DOMPoint(_,v),j=new DOMPoint(C,k),$=E,ee=F;if(u){V=p.transformPoint(V),j=p.transformPoint(j);const se=(p.a+p.d)/2;$=E*se,ee=e.r*se}const oe=r.createRadialGradient(V.x,V.y,$,j.x,j.y,ee);for(const se of e.stops)oe.addColorStop(se.offset,sg(se.rgb_color,se.opacity*i,s));return oe}function ub(r,e,i,s){const u=s.transform?og(s.transform).preMultiplySelf(e):e,p=Vg(r.canvas.width,r.canvas.height),_=p.getContext("2d");for(const E of s.children)if(E.group)ub(_,u,i,E.group);else if(E.path){const C=E.path,k=new Path2D;k.addPath(pb(C),u),_.fill(k,sb(C))}const v=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;v&&hb(_,u,i,v),r.globalCompositeOperation="source-over",r.drawImage(p,0,0)}function hb(r,e,i,s){const u=Vg(r.canvas.width,r.canvas.height);ub(u.getContext("2d"),e,i,s),r.globalCompositeOperation="destination-in",r.drawImage(u,0,0)}function db(r,e,i,s,u){if(s.children.length===0)return;const p=s.mask_idx!=null?i.masks[s.mask_idx]:null;p&&db(r,e,i,p,u);const _=r.canvas.width,v=r.canvas.height,E=Vg(_,v),C=E.getContext("2d"),k=s.width,F=s.height,V=s.left,j=s.top,$=new Path2D,ee=new Path2D;ee.rect(V,j,k,F),$.addPath(ee,e),C.clip($);for(const ge of s.children)rb(C,e,i,ge,u);const oe=C.getImageData(0,0,_,v),se=oe.data;if(s.mask_type===eb.MASK_TYPE_LUMINANCE)for(let ge=0;ge<se.length;ge+=4)se[ge+3]=se[ge+3]/255*(.2126*se[ge]+.7152*se[ge+1]+.0722*se[ge+2]);C.putImageData(oe,0,0),r.globalCompositeOperation="destination-in",r.drawImage(E,0,0)}function og(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function fb(r,e){const i=r.step;let s=r.diffs[0]*i,u=r.diffs[1]*i;e.moveTo(s,u);for(let p=0,_=2;p<r.commands.length;p++)switch(r.commands[p]){case Ng.PATH_COMMAND_MOVE:s+=r.diffs[_++]*i,u+=r.diffs[_++]*i,e.moveTo(s,u);break;case Ng.PATH_COMMAND_LINE:s+=r.diffs[_++]*i,u+=r.diffs[_++]*i,e.lineTo(s,u);break;case Ng.PATH_COMMAND_QUAD:{const v=s+r.diffs[_++]*i,E=u+r.diffs[_++]*i;s=v+r.diffs[_++]*i,u=E+r.diffs[_++]*i,e.quadraticCurveTo(v,E,s,u);break}case Ng.PATH_COMMAND_CUBIC:{const v=s+r.diffs[_++]*i,E=u+r.diffs[_++]*i,C=v+r.diffs[_++]*i,k=E+r.diffs[_++]*i;s=C+r.diffs[_++]*i,u=k+r.diffs[_++]*i,e.bezierCurveTo(v,E,C,k,s,u);break}case Ng.PATH_COMMAND_CLOSE:e.closePath()}return e}function pb(r){return fb(r,new Path2D)}class By{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}di(By,"LRUCache");class Vx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Tl(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new By(150)),this.cacheMap.get(s).get(vc(e.toString(),i))}setInCache(e,i,s,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new By(150));const p=this.cacheDependenciesMap.get(u),_=vc(e.id.toString(),s);p.get(_)||p.set(_,new Set);const v=this.cacheMap.get(u),E=e.toString();p.get(_).add(E),v.put(vc(e.toString(),s),i)}removeImagesFromCacheByIds(e,i,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const u=this.cacheMap.get(s),p=this.cacheDependenciesMap.get(s);for(const _ of e){const v=vc(_.toString(),i);if(p.has(v)){for(const E of p.get(v))u.delete(E);p.delete(v)}}}rasterize(e,i,s,u){const p=this.getFromCache(e,s,u);if(p)return p.clone();const _=(function(E,C){const k=MT.calculate(C.params,E.metadata?E.metadata.variables:[]),F=E.usvg_tree,V=F.width,j=F.height,$=Math.max(1,Math.round(V*C.sx)),ee=Math.max(1,Math.round(j*C.sy)),oe=new DOMMatrix([$/V,0,0,ee/j,0,0]);return Ug===null&&(Ug=Vg(10,10),Fx=Ug.getContext("2d",{willReadFrequently:!0})),Ug.width=$,Ug.height=ee,Nx(Fx,oe,F,F,k),Fx.getImageData(0,0,$,ee)})(i.icon,e),v=Vx._getImage(_);return this.setInCache(e,v,s,u),v.clone()}}class mb{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function _b(r,e,i,s){let u=0,p=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(s[_])<1e-15){if(i[_]<r[_]||i[_]>e[_])return null}else{const v=1/s[_];let E=(r[_]-i[_])*v,C=(e[_]-i[_])*v;if(E>C){const k=E;E=C,C=k}if(E>u&&(u=E),C<p&&(p=C),u>p)return null}return u}function gb(r,e,i,s,u,p,_,v,E,C,k){const F=s-r,V=u-e,j=p-i,$=_-r,ee=v-e,oe=E-i,se=k[1]*oe-k[2]*ee,ge=k[2]*$-k[0]*oe,xe=k[0]*ee-k[1]*$,Ie=F*se+V*ge+j*xe;if(Math.abs(Ie)<1e-15)return null;const He=1/Ie,Ne=C[0]-r,We=C[1]-e,at=C[2]-i,ct=(Ne*se+We*ge+at*xe)*He;if(ct<0||ct>1)return null;const Gt=We*j-at*V,pt=at*F-Ne*j,Xt=Ne*V-We*F,ni=(k[0]*Gt+k[1]*pt+k[2]*Xt)*He;return ni<0||ct+ni>1?null:($*Gt+ee*pt+oe*Xt)*He}function yb(r,e,i){return(r-e)/(i-e)}function xb(r,e,i,s,u,p,_,v,E){const C=1<<i,k=p-s,F=_-u,V=(r+1)/C*k+s,j=(e+0)/C*F+u,$=(e+1)/C*F+u;v[0]=(r+0)/C*k+s,v[1]=j,E[0]=V,E[1]=$}class vb{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=(function(p){const _=Math.ceil(Math.log2(p.dim/8)),v=[];let E=Math.ceil(Math.pow(2,_));const C=1/E,k=(j,$,ee,oe,se)=>{const ge=oe?1:0,xe=(j+1)*ee-ge,Ie=$*ee,He=($+1)*ee-ge;se[0]=j*ee,se[1]=Ie,se[2]=xe,se[3]=He};let F=new mb(E);const V=[];for(let j=0;j<E*E;j++){k(j%E,Math.floor(j/E),C,!1,V);const $=T_(V[0],V[1],p),ee=T_(V[2],V[1],p),oe=T_(V[2],V[3],p),se=T_(V[0],V[3],p);F.minimums.push(Math.min($,ee,oe,se)),F.maximums.push(Math.max($,ee,oe,se)),F.leaves.push(1)}for(v.push(F),E/=2;E>=1;E/=2){const j=v[v.length-1];F=new mb(E);for(let $=0;$<E*E;$++){k($%E,Math.floor($/E),2,!0,V);const ee=j.getElevation(V[0],V[1]),oe=j.getElevation(V[2],V[1]),se=j.getElevation(V[2],V[3]),ge=j.getElevation(V[0],V[3]),xe=j.isLeaf(V[0],V[1]),Ie=j.isLeaf(V[2],V[1]),He=j.isLeaf(V[2],V[3]),Ne=j.isLeaf(V[0],V[3]),We=Math.min(ee.min,oe.min,se.min,ge.min),at=Math.max(ee.max,oe.max,se.max,ge.max),ct=xe&&Ie&&He&&Ne;F.maximums.push(at),F.minimums.push(We),F.leaves.push(at-We<=5&&ct?1:0)}v.push(F)}return v})(this.dem),s=i.length-1,u=i[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,u,p,_,v=1){return _b([e,i,-100],[s,u,this.maximums[0]*v],p,_)}raycast(e,i,s,u,p,_,v=1){if(!this.nodeCount)return null;const E=this.raycastRoot(e,i,s,u,p,_,v);if(E==null)return null;const C=[],k=[],F=[],V=[],j=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:$,t:ee,nodex:oe,nodey:se,depth:ge}=j.pop();if(this.leaves[$]){xb(oe,se,ge,e,i,s,u,F,V);const Ie=1<<ge,He=(oe+0)/Ie,Ne=(oe+1)/Ie,We=(se+0)/Ie,at=(se+1)/Ie,ct=T_(He,We,this.dem)*v,Gt=T_(Ne,We,this.dem)*v,pt=T_(Ne,at,this.dem)*v,Xt=T_(He,at,this.dem)*v,ni=gb(F[0],F[1],ct,V[0],F[1],Gt,V[0],V[1],pt,p,_),ri=gb(V[0],V[1],pt,F[0],V[1],Xt,F[0],F[1],ct,p,_),vi=Math.min(ni!==null?ni:Number.MAX_VALUE,ri!==null?ri:Number.MAX_VALUE);if(vi!==Number.MAX_VALUE)return vi;{const wi=ln([],p,_,ee);if(bb(ct,Gt,Xt,pt,yb(wi[0],F[0],V[0]),yb(wi[1],F[1],V[1]))>=wi[2])return ee}continue}let xe=0;for(let Ie=0;Ie<this._siblingOffset.length;Ie++){xb((oe<<1)+this._siblingOffset[Ie][0],(se<<1)+this._siblingOffset[Ie][1],ge+1,e,i,s,u,F,V),F[2]=-100,V[2]=this.maximums[this.childOffsets[$]+Ie]*v;const He=_b(F,V,p,_);if(He!=null){const Ne=He;C[Ie]=Ne;let We=!1;for(let at=0;at<xe&&!We;at++)Ne>=C[k[at]]&&(k.splice(at,0,Ie),We=!0);We||(k[xe]=Ie),xe++}}for(let Ie=0;Ie<xe;Ie++){const He=k[Ie];j.push({idx:this.childOffsets[$]+He,t:C[He],nodex:(oe<<1)+this._siblingOffset[He][0],nodey:(se<<1)+this._siblingOffset[He][1],depth:ge+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,u,p){if(e[u].isLeaf(i,s)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const _=u-1,v=e[_];let E=0,C=0;for(let k=0;k<this._siblingOffset.length;k++){const F=2*i+this._siblingOffset[k][0],V=2*s+this._siblingOffset[k][1],j=v.getElevation(F,V),$=v.isLeaf(F,V),ee=this._addNode(j.min,j.max,$);$&&(E|=1<<k),C||(C=ee)}for(let k=0;k<this._siblingOffset.length;k++)E&1<<k||this._construct(e,2*i+this._siblingOffset[k][0],2*s+this._siblingOffset[k][1],_,C+k)}}function bb(r,e,i,s,u,p){return Gn(Gn(r,i,p),Gn(e,s,p),u)}function T_(r,e,i){const s=i.dim,u=te(r*s-.5,0,s-1),p=te(e*s-.5,0,s-1),_=Math.floor(u),v=Math.floor(p),E=Math.min(_+1,s-1),C=Math.min(v+1,s-1);return bb(i.get(_,v),i.get(E,v),i.get(_,C),i.get(E,C),u-_,p-v)}const CT={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function zT(r,e,i){return(256*r*256+256*e+i)/10-1e4}function DT(r,e,i){return 256*r+e+i/256-32768}class Fy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void Bi(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,_=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let E=0;E<p;E++)_[this._idx(-1,E)]=_[this._idx(0,E)],_[this._idx(p,E)]=_[this._idx(p-1,E)],_[this._idx(E,-1)]=_[this._idx(E,0)],_[this._idx(E,p)]=_[this._idx(E,p-1)];_[this._idx(-1,-1)]=_[this._idx(0,0)],_[this._idx(p,-1)]=_[this._idx(p-1,0)],_[this._idx(-1,p)]=_[this._idx(0,p-1)],_[this._idx(p,p)]=_[this._idx(p-1,p-1)]}const v=s==="terrarium"?DT:zT;for(let E=0;E<_.length;++E){const C=4*E;this.floatView[E]=v(this.pixels[C],this.pixels[C+1],this.pixels[C+2])}this._timestamp=Ks.now()}_buildQuadTree(){this._tree=new vb(this)}get(e,i,s=!1){s&&(e=te(e,-1,this.dim),i=te(i,-1,this.dim));const u=this._idx(e,i);return this.floatView[u]}set(e,i,s){const u=this._idx(e,i),p=this.floatView[u];return this.floatView[u]=s,s-p}static getUnpackVector(e){return CT[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],u=Fy.getUnpackVector(i);let p=Math.floor((e+u[3])/u[2]);return s[2]=p%256,p=Math.floor(p/256),s[1]=p%256,p=Math.floor(p/256),s[0]=p,s}getPixels(){return new p_({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,p=i*this.dim+this.dim,_=s*this.dim,v=s*this.dim+this.dim;switch(i){case-1:u=p-1;break;case 1:p=u+1}switch(s){case-1:_=v-1;break;case 1:v=_+1}const E=-i*this.dim,C=-s*this.dim;for(let k=_;k<v;k++)for(let F=u;F<p;F++){const V=4*this._idx(F,k),j=4*this._idx(F+E,k+C);this.pixels[V+0]=e.pixels[j+0],this.pixels[V+1]=e.pixels[j+1],this.pixels[V+2]=e.pixels[j+2],this.pixels[V+3]=e.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function RT(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push((function(s,u){return s.readFields(BT,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)})(i,i.readVarint()+i.pos))}function PT(r,e,i){r===1?(e.delta_filter=(function(s,u){return s.readFields(LT,{blockSize:0},u)})(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function LT(r,e,i){r===1&&(e.blockSize=i.readVarint())}function kT(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function OT(r,e,i){let s=0,u=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push((function(p,_){return p.readFields(PT,{},_)})(i,i.readVarint()+i.pos)):r===4?e.codec=(function(p,_){return p.readFields(kT,{},_)})(i,i.readVarint()+i.pos):r===5?u=i.readFloat():r===6?s=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=s)}function BT(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push((function(s,u){return s.readFields(OT,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)})(i,i.readVarint()+i.pos))}function FT(r,e,i){if(r===2)(function(s,u,p){s.readFields(NT,p,u)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function NT(r,e,i){if(r===1){let s=0;const u=i.readVarint()+i.pos;for(;i.pos<u;)e[s++]=i.readVarint()}}function VT(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const u=s===1?1:0,p=s===2?1:0;for(let _=0;_<e[0];_++){const v=e[1]*_;for(let E=u;E<e[1];E++){const C=e[2]*(E+v);for(let k=p;k<e[2];k++){const F=e[3]*(k+C);for(let V=0;V<e[3];V++){const j=F+V;r[j]+=r[j-i]}}}}i*=e[s]}return r}function UT(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function jT(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const s=r[i],u=r[i+1];r[i]=(240&s)>>4|(61440&s)>>8|(240&u)<<4|61440&u,r[i+1]=15&s|(3840&s)>>4|(15&u)<<8|(3840&u)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const s=r[i],u=r[i+1],p=r[i+2],_=r[i+3];r[i+0]=(192&s)>>6|(192&u)>>4|(192&p)>>2|192&_,r[i+1]=(48&s)>>4|(48&u)>>2|48&p|(48&_)<<2,r[i+2]=(12&s)>>2|12&u|(12&p)<<2|(12&_)<<4,r[i+3]=3&s|(3&u)<<2|(3&p)<<4|(3&_)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}di(Fy,"DEMData"),di(vb,"DemMinMaxQuadTree",{omit:["dem"]});var Wf=Uint8Array,jg=Uint16Array,GT=Int32Array,wb=new Wf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Tb=new Wf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qT=new Wf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Sb=function(r,e){for(var i=new jg(31),s=0;s<31;++s)i[s]=e+=1<<r[s-1];var u=new GT(i[30]);for(s=1;s<30;++s)for(var p=i[s];p<i[s+1];++p)u[p]=p-i[s]<<5|s;return{b:i,r:u}},Eb=Sb(wb,2),Ab=Eb.b,HT=Eb.r;Ab[28]=258,HT[258]=28;for(var $T=Sb(Tb,0).b,Ib=new jg(32768),$l=0;$l<32768;++$l){var lg=(43690&$l)>>1|(21845&$l)<<1;Ib[$l]=((65280&(lg=(61680&(lg=(52428&lg)>>2|(13107&lg)<<2))>>4|(3855&lg)<<4))>>8|(255&lg)<<8)>>1}var Gg=function(r,e,i){for(var s=r.length,u=0,p=new jg(e);u<s;++u)r[u]&&++p[r[u]-1];var _,v=new jg(e);for(u=1;u<e;++u)v[u]=v[u-1]+p[u-1]<<1;_=new jg(1<<e);var E=15-e;for(u=0;u<s;++u)if(r[u])for(var C=u<<4|r[u],k=e-r[u],F=v[r[u]-1]++<<k,V=F|(1<<k)-1;F<=V;++F)_[Ib[F]>>E]=C;return _},qg=new Wf(288);for($l=0;$l<144;++$l)qg[$l]=8;for($l=144;$l<256;++$l)qg[$l]=9;for($l=256;$l<280;++$l)qg[$l]=7;for($l=280;$l<288;++$l)qg[$l]=8;var Mb=new Wf(32);for($l=0;$l<32;++$l)Mb[$l]=5;var ZT=Gg(qg,9),XT=Gg(Mb,5),Ux=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},am=function(r,e,i){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(7&e)&i},jx=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},WT=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],sm=function(r,e,i){var s=new Error(e||WT[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,sm),!i)throw s;return s},YT=new Wf(0),KT=typeof TextDecoder<"u"&&new TextDecoder;try{KT.decode(YT,{stream:!0})}catch{}const JT={gzip_data:"gzip"};class wp extends Error{constructor(e){super(e),this.name="MRTError"}}const QT={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Cb={uint32:1,uint16:2,uint8:4},eS={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Gx;class Ny{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new wp(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new wp("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new wp(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const u=new Gx(i.subarray(0,s)).readFields(RT,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new wp(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const p of u.layers)this.layers[p.name]=new zb(p,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let u of e.blockIndices){const p=s.dataIndex[u],_=p.firstByte-e.firstByte,v=p.lastByte-e.firstByte;if(s._blocksInProgress.has(u))continue;const E={layerName:s.name,firstByte:_,lastByte:v,pixelFormat:s.pixelFormat,blockIndex:u,blockShape:[p.bands.length].concat(s.bandShape),buffer:s.buffer,codec:p.codec.codec,filters:p.filters.map((C=>C.filter))};s._blocksInProgress.add(u),i.push(E)}return new Db(i,(()=>{i.forEach((u=>s._blocksInProgress.delete(u.blockIndex)))}),((u,p)=>{if(i.forEach((_=>s._blocksInProgress.delete(_.blockIndex))),u)throw u;p.forEach((_=>{this.getLayer(_.layerName).processDecodedData(_)}))}))}}class zb{constructor({version:e,name:i,units:s,tileSize:u,pixelFormat:p,buffer:_,dataIndex:v},E){if(this.version=e,this.version!==1)throw new wp(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=u,this.buffer=_,this.pixelFormat=QT[p],this.dataIndex=v,this.bandShape=[u+2*_,u+2*_,Cb[this.pixelFormat]],this._decodedBlocks=new By(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Cb[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:e})=>e)).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,u]of this.dataIndex.entries()){for(const[p,_]of u.bands.entries())if(_===e)return{bandIndex:i+p,blockIndex:s,blockBandIndex:p};i+=u.bands.length}break;case"number":for(const[s,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new wp(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,s=-1/0;const u=[],p=new Set;for(const _ of e){const{blockIndex:v}=this.getBlockForBand(_);if(v<0)throw new wp(`Invalid band: ${JSON.stringify(_)}`);const E=this.dataIndex[v];u.includes(v)||u.push(v),p.add(v),i=Math.min(i,E.firstByte),s=Math.max(s,E.lastByte)}if(p.size>this.cacheSize)throw new wp(`Number of blocks to decode (${p.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e);if(i<0)throw new wp(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(i.toString());if(!u)throw new wp(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const p=this.dataIndex[i],_=this.bandShape.reduce(((C,k)=>C*k),1),v=s*_,E=u.subarray(v,v+_);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:p.offset,scale:p.scale}}}Ny.setPbf=function(r){Gx=r};class Db{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}Ny.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map((s=>{const{layerName:u,firstByte:p,lastByte:_,pixelFormat:v,blockShape:E,blockIndex:C,filters:k,codec:F}=s,V=i.subarray(p,_+1),j=new Uint32Array(E[0]*E[1]*E[2]);let $;if(F!=="gzip_data")throw new wp(`Unhandled codec: ${F}`);return $=(function(ee,oe){if(!globalThis.DecompressionStream&&oe==="gzip_data")return Promise.resolve(((Ie=(function(We){We[0]==31&&We[1]==139&&We[2]==8||sm(6,"invalid gzip data");var at=We[3],ct=10;4&at&&(ct+=2+(We[10]|We[11]<<8));for(var Gt=(at>>3&1)+(at>>4&1);Gt>0;Gt-=!We[ct++]);return ct+(2&at)})(xe=ee))+8>xe.length&&sm(6,"invalid gzip data"),(function(We,at,ct,Gt){var pt=We.length;if(!pt||at.f&&!at.l)return ct||new Wf(0);var Xt=!ct,ni=Xt||at.i!=2,ri=at.i;Xt&&(ct=new Wf(3*pt));var vi,wi,_i=function(is){var Pa=ct.length;if(is>Pa){var Va=new Wf(Math.max(2*Pa,is));Va.set(ct),ct=Va}},gi=at.f||0,Zt=at.p||0,$t=at.b||0,yi=at.l,ki=at.d,Ii=at.m,Dn=at.n,tn=8*pt;do{if(!yi){gi=am(We,Zt,1);var sn=am(We,Zt+1,3);if(Zt+=3,!sn){var bn=We[(Wt=4+((Zt+7)/8|0))-4]|We[Wt-3]<<8,Vr=Wt+bn;if(Vr>pt){ri&&sm(0);break}ni&&_i($t+bn),ct.set(We.subarray(Wt,Vr),$t),at.b=$t+=bn,at.p=Zt=8*Vr,at.f=gi;continue}if(sn==1)yi=ZT,ki=XT,Ii=9,Dn=5;else if(sn==2){var zi=am(We,Zt,31)+257,wn=am(We,Zt+10,15)+4,fr=zi+am(We,Zt+5,31)+1;Zt+=14;for(var ha=new Wf(fr),xa=new Wf(19),Ar=0;Ar<wn;++Ar)xa[qT[Ar]]=am(We,Zt+3*Ar,7);Zt+=3*wn;var ts=Ux(xa),Ue=(1<<ts)-1,$e=Gg(xa,ts);for(Ar=0;Ar<fr;){var Wt,bi=$e[am(We,Zt,Ue)];if(Zt+=15&bi,(Wt=bi>>4)<16)ha[Ar++]=Wt;else{var Zi=0,Xi=0;for(Wt==16?(Xi=3+am(We,Zt,3),Zt+=2,Zi=ha[Ar-1]):Wt==17?(Xi=3+am(We,Zt,7),Zt+=3):Wt==18&&(Xi=11+am(We,Zt,127),Zt+=7);Xi--;)ha[Ar++]=Zi}}var Pn=ha.subarray(0,zi),Bn=ha.subarray(zi);Ii=Ux(Pn),Dn=Ux(Bn),yi=Gg(Pn,Ii),ki=Gg(Bn,Dn)}else sm(1);if(Zt>tn){ri&&sm(0);break}}ni&&_i($t+131072);for(var br=(1<<Ii)-1,Lr=(1<<Dn)-1,Nr=Zt;;Nr=Zt){var sa=(Zi=yi[jx(We,Zt)&br])>>4;if((Zt+=15&Zi)>tn){ri&&sm(0);break}if(Zi||sm(2),sa<256)ct[$t++]=sa;else{if(sa==256){Nr=Zt,yi=null;break}var er=sa-254;sa>264&&(er=am(We,Zt,(1<<(Ca=wb[Ar=sa-257]))-1)+Ab[Ar],Zt+=Ca);var ur=ki[jx(We,Zt)&Lr],Ea=ur>>4;if(ur||sm(3),Zt+=15&ur,Bn=$T[Ea],Ea>3){var Ca=Tb[Ea];Bn+=jx(We,Zt)&(1<<Ca)-1,Zt+=Ca}if(Zt>tn){ri&&sm(0);break}ni&&_i($t+131072);var za=$t+er;if($t<Bn){var Ya=0-Bn,us=Math.min(Bn,za);for(Ya+$t<0&&sm(3);$t<us;++$t)ct[$t]=(void 0)[Ya+$t]}for(;$t<za;++$t)ct[$t]=ct[$t-Bn]}}at.l=yi,at.p=Nr,at.b=$t,at.f=gi,yi&&(gi=1,at.m=Ii,at.d=ki,at.n=Dn)}while(!gi);return $t!=ct.length&&Xt?(vi=ct,((wi=$t)==null||wi>vi.length)&&(wi=vi.length),new Wf(vi.subarray(0,wi))):ct.subarray(0,$t)})(xe.subarray(Ie,-8),{i:2},new Wf(((se=xe)[(ge=se.length)-4]|se[ge-3]<<8|se[ge-2]<<16|se[ge-1]<<24)>>>0))));var se,ge,xe,Ie;const He=JT[oe];if(!He)throw new Error(`Unhandled codec: ${oe}`);const Ne=new globalThis.DecompressionStream(He);return new Response(new Blob([ee]).stream().pipeThrough(Ne)).arrayBuffer().then((We=>new Uint8Array(We)))})(V,F).then((ee=>((function(oe,se){oe.readFields(FT,se)})(new Gx(ee),j),new eS[v](j.buffer)))),$.then((ee=>{for(let oe=k.length-1;oe>=0;oe--)switch(k[oe]){case"delta_filter":VT(ee,E);break;case"zigzag_filter":UT(ee);break;case"bitshuffle_filter":jT(ee,v);break;default:throw new wp(`Unhandled filter "${k[oe]}"`)}return{layerName:u,blockIndex:C,data:ee}})).catch((ee=>{throw ee}))})))},di(Db,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),di(Ny,"MapboxRasterTile"),di(zb,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Rb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Pb{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new bu(pi,16,0),this.featureIndexArray=new yf,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,u,p,_=0,v=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,p,_);const C=this.grid;for(let k=0;k<i.length;k++){const F=i[k],V=[1/0,1/0,-1/0,-1/0];for(let j=0;j<F.length;j++){const $=F[j];V[0]=Math.min(V[0],$.x),V[1]=Math.min(V[1],$.y),V[2]=Math.max(V[2],$.x),V[3]=Math.max(V[3],$.y)}v!==0&&(V[0]-=v,V[1]-=v,V[2]+=v,V[3]+=v),V[0]<pi&&V[1]<pi&&V[2]>=0&&V[3]>=0&&C.insert(E,V[0],V[1],V[2],V[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new gt(new my(this.rawTileData)).layers,this.sourceLayerCoder=new Rb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:u,tileTransform:p,pixelPosMatrix:_,availableImages:v,worldview:E}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const C=i.queryRadius?i.queryRadius:0,k=s.bufferedTilespaceBounds,F=this.grid.query(k.min.x,k.min.y,k.max.x,k.max.y,((ee,oe,se,ge)=>Bo(s.bufferedTilespaceGeometry,ee-C,oe-C,se+C,ge+C)));F.sort(tS);let V=null;u.elevation&&F.length>0&&(V=ag.create(u.elevation,this.tileID));const j={};let $;for(let ee=0;ee<F.length;ee++){const oe=F[ee];if(oe===$)continue;$=oe;const se=this.featureIndexArray.get(oe);let ge=null;this.is3DTile?this.loadMatchingModelFeature(j,se,e,s,u,E):this.loadMatchingFeature(j,se,e,v,E,((xe,Ie,He,Ne=0)=>(ge||(ge=it(xe,this.tileID.canonical,p)),Ie.queryIntersectsFeature(s,xe,He,ge,this.z,u,_,V,Ne))))}return j}loadMatchingFeature(e,i,s,u,p,_){const{featureIndex:v,bucketIndex:E,sourceLayerIndex:C,layoutVertexArrayOffset:k}=i,F=this.bucketLayerIDs[E],V=s.layers,j=Object.keys(V);if(j.length&&!Yi(j,F))return;const $=s.sourceCache,ee=this.sourceLayerCoder.decode(C),oe=this.vtLayers[ee].feature(v),se=this.getId(oe,ee);for(let ge=0;ge<F.length;ge++){const xe=F[ge];if(!V[xe])continue;const{styleLayer:Ie,targets:He}=V[xe];let Ne={};se!==void 0&&(Ne=$.getFeatureState(Ie.sourceLayer,se));const We=!_||_(oe,Ie,Ne,k);if(!We)continue;const at=new j_(oe,this.z,this.x,this.y,se);at.tile=this.tileID.canonical,at.state=Ne;let ct=this.serializedLayersCache.get(xe);ct||(ct=Ie.serialize(),ct.id=xe,this.serializedLayersCache.set(xe,ct)),at.source=ct.source,at.sourceLayer=ct["source-layer"],at.layer=Object.assign({},ct),at.layer.paint=Lb(ct.paint,Ie.paint,oe,Ne,u),at.layer.layout=Lb(ct.layout,Ie.layout,oe,Ne,u);let Gt=!1;for(const pt of He){this.updateFeatureProperties(at,pt);const{filter:Xt}=pt;if(Xt){if(oe.properties=at.properties,Xt.needGeometry){const ni=ft(oe,!0);if(!Xt.filter(new Xa(this.tileID.overscaledZ,{worldview:p}),ni,this.tileID.canonical))continue}else if(!Xt.filter(new Xa(this.tileID.overscaledZ,{worldview:p}),oe))continue}Gt=!0,pt.targetId&&this.addFeatureVariant(at,pt)}Gt&&this.appendToResult(e,xe,v,at,We)}}loadMatchingModelFeature(e,i,s,u,p,_){const{featureIndex:v,bucketIndex:E}=i,C=this.bucketLayerIDs[E],k=s.layers,F=Object.keys(k);if(!F.length||Yi(F,C))for(let V=0;V<C.length;V++){const j=C[V],{styleLayer:$,targets:ee}=k[j];if($.type!=="model")continue;const oe=u.tile,se=oe.getBucket($);if(!(se&&se instanceof Ry))continue;const ge=lT(se,v,u,p);if(!ge)continue;const{z:xe,x:Ie,y:He}=oe.tileID.canonical,{feature:Ne,intersectionZ:We,position:at}=ge;let ct={};Ne.id!==void 0&&(ct=s.sourceCache.getFeatureState($.sourceLayer,Ne.id));const Gt=new j_({},xe,Ie,He,Ne.id);Gt.tile=this.tileID.canonical,Gt.state=ct,Gt.properties=Ne.properties,Gt.geometry={type:"Point",coordinates:[at.lng,at.lat]};let pt=this.serializedLayersCache.get(j);pt||(pt=$.serialize(),pt.id=j,this.serializedLayersCache.set(j,pt)),Gt.source=pt.source,Gt.sourceLayer=pt["source-layer"],Gt.layer=Object.assign({},pt);let Xt=!1;for(const ni of ee){this.updateFeatureProperties(Gt,ni);const{filter:ri}=ni;if(ri){if(Ne.properties=Gt.properties,ri.needGeometry){if(!ri.filter(new Xa(this.tileID.overscaledZ,{worldview:_}),Ne,this.tileID.canonical))continue}else if(!ri.filter(new Xa(this.tileID.overscaledZ,{worldview:_}),Ne))continue}Xt=!0,ni.targetId&&this.addFeatureVariant(Gt,ni)}Xt&&this.appendToResult(e,j,v,Gt,We)}}updateFeatureProperties(e,i,s){if(i.properties){const u={};for(const p in i.properties){const _=i.properties[p].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);_!=null&&(u[p]=_)}e.properties=u}}addFeatureVariant(e,i,s){const u={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(u)}appendToResult(e,i,s,u,p){let _=e[i];_===void 0&&(_=e[i]=[]),_.push({featureIndex:s,feature:u,intersectionZ:p})}lookupSymbolFeatures(e,i,s,u,p,_){const v={};this.loadVTLayers();for(const E of e)this.loadMatchingFeature(v,{bucketIndex:i,sourceLayerIndex:s,featureIndex:E,layoutVertexArrayOffset:0},u,p,_);return v}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),p=this.vtFeatures[u];if(p[i])return p[i];const _=this.vtLayers[u].feature(i);return p[i]=_,_}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const p=Lo(u);if(p.result!=="success"){const _=p.value.map((v=>`${v.key}: ${v.message}`)).join(", ");return void Bi(`Failed to create expression for promoteId: ${_}`)}this.promoteIdExpression=p.value}s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[u];typeof s=="boolean"&&(s=Number(s))}return s}}function Lb(r,e,i,s,u){return At(r,((p,_)=>{const v=e instanceof Pd?e.get(_):null;return v&&v.evaluate?v.evaluate(i,s,void 0,u):v}))}function tS(r,e){return e-r}di(Pb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const kb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class qx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const p=kb[15&s];if(!p)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(e,2,1),[v]=new Uint32Array(e,4,1);return new qx(v,_,p,e)}constructor(e,i=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=kb.indexOf(this.ArrayType),_=2*e*this.ArrayType.BYTES_PER_ELEMENT,v=e*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-v%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+E,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+E),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+v+E,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Hx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:_,nodeSize:v}=this,E=[0,p.length-1,0],C=[];for(;E.length;){const k=E.pop()||0,F=E.pop()||0,V=E.pop()||0;if(F-V<=v){for(let oe=V;oe<=F;oe++){const se=_[2*oe],ge=_[2*oe+1];se>=e&&se<=s&&ge>=i&&ge<=u&&C.push(p[oe])}continue}const j=V+F>>1,$=_[2*j],ee=_[2*j+1];$>=e&&$<=s&&ee>=i&&ee<=u&&C.push(p[j]),(k===0?e<=$:i<=ee)&&(E.push(V),E.push(j-1),E.push(1-k)),(k===0?s>=$:u>=ee)&&(E.push(j+1),E.push(F),E.push(1-k))}return C}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:p,nodeSize:_}=this,v=[0,u.length-1,0],E=[],C=s*s;for(;v.length;){const k=v.pop()||0,F=v.pop()||0,V=v.pop()||0;if(F-V<=_){for(let oe=V;oe<=F;oe++)Bb(p[2*oe],p[2*oe+1],e,i)<=C&&E.push(u[oe]);continue}const j=V+F>>1,$=p[2*j],ee=p[2*j+1];Bb($,ee,e,i)<=C&&E.push(u[j]),(k===0?e-s<=$:i-s<=ee)&&(v.push(V),v.push(j-1),v.push(1-k)),(k===0?e+s>=$:i+s>=ee)&&(v.push(j+1),v.push(F),v.push(1-k))}return E}}function Hx(r,e,i,s,u,p){if(u-s<=i)return;const _=s+u>>1;Ob(r,e,_,s,u,p),Hx(r,e,i,s,_-1,1-p),Hx(r,e,i,_+1,u,1-p)}function Ob(r,e,i,s,u,p){for(;u>s;){if(u-s>600){const C=u-s+1,k=i-s+1,F=Math.log(C),V=.5*Math.exp(2*F/3),j=.5*Math.sqrt(F*V*(C-V)/C)*(k-C/2<0?-1:1);Ob(r,e,i,Math.max(s,Math.floor(i-k*V/C+j)),Math.min(u,Math.floor(i+(C-k)*V/C+j)),p)}const _=e[2*i+p];let v=s,E=u;for(Hg(r,e,s,i),e[2*u+p]>_&&Hg(r,e,s,u);v<E;){for(Hg(r,e,v,E),v++,E--;e[2*v+p]<_;)v++;for(;e[2*E+p]>_;)E--}e[2*s+p]===_?Hg(r,e,s,E):(E++,Hg(r,e,E,u)),E<=i&&(s=E+1),i<=E&&(u=E-1)}}function Hg(r,e,i,s){$x(r,i,s),$x(e,2*i,2*s),$x(e,2*i+1,2*s+1)}function $x(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}function Bb(r,e,i,s){const u=r-i,p=e-s;return u*u+p*p}n.$=Ph,n.A=ga,n.B=vc,n.C=2,n.D=Je,n.E=id,n.F=Ag,n.G=c0,n.H=ad,n.I=Rl,n.J=hm,n.K=xn,n.L=ku,n.M=$r,n.N=Ln,n.O=ir,n.P=je,n.Q=ks,n.R=zc,n.S=qh,n.T=ex,n.U=Lo,n.V=Dy,n.W=Co,n.X=ja,n.Y=Nh,n.Z=mo,n._=$o,n.a=function(r){return Rr.API_CDN_URL_REGEX.test(r)},n.a$=Y,n.a0=Un,n.a1=qc,n.a2=xc,n.a3=class extends Dy{},n.a4=On,n.a5=zn,n.a6=xt,n.a7=function(r){const e=r.value;return e?Un(e)?Dx(e,!0)?[]:[new Dy(r.key,e,`invalid url "${e}"`)]:[new Dy(r.key,e,`string expected, "${xn(e)}" found`)]:[]},n.a8=of,n.a9=ca,n.aA=te,n.aB=Ci,n.aC=la,n.aD=ps,n.aE=qa,n.aF=M,n.aG=Se,n.aH=function(r,e){const i={};for(let s=0;s<e.length;s++){const u=e[s];u in r&&(i[u]=r[u])}return i},n.aI=d,n.aJ=R,n.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,s){const u=this.entries[r]=this.entries[r]||{callbacks:[]};if(u.result){const[p,_]=u.result;return this.scheduler?this.scheduler.add((()=>{s(p,_)}),e):s(p,_),()=>{}}return u.callbacks.push(s),u.cancel||(u.cancel=i(((p,_)=>{u.result=[p,_];for(const v of u.callbacks)this.scheduler?this.scheduler.add((()=>{v(p,_)}),e):v(p,_);setTimeout((()=>delete this.entries[r]),3e3)}))),()=>{u.result||(u.callbacks=u.callbacks.filter((p=>p!==s)),u.callbacks.length||(u.cancel(),delete this.entries[r]))}}},n.aL=function(r,e,i){const s=JSON.stringify(r.request);return r.data&&(this.deduped.entries[s]={result:[null,r.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},(u=>{const p=Wl(r.request,((_,v,E)=>{_?u(_):v&&u(null,{rawData:v,vectorTile:i?void 0:new gt(new my(v)),responseHeaders:new Map(E.entries())})}));return()=>{p.cancel(),u()}}),e)},n.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},n.aN=Go,n.aO=function(r){fo++,fo>Qh&&(r.getActor().send("enforceCacheSizeLimit",Jh),fo=0)},n.aP=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},n.aQ=zs,n.aR=F0,n.aS=q0,n.aT=a,n.aU=B0,n.aV=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<r.length;s++){const u=document.createElement("source");Ep(r[s])||(i.crossOrigin="Anonymous"),u.src=r[s],i.appendChild(u)}return{cancel:()=>{}}},n.aW=bg,n.aX=G_,n.aY=ot,n.aZ=zg,n.a_=U,n.aa=xi,n.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Nn(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Gn(r.x,e.x,i),y:Gn(r.y,e.y,i),z:Gn(r.z,e.z,i),azimuthal:Gn(r.azimuthal,e.azimuthal,i),polar:Gn(r.polar,e.polar,i)}}},n.ac=Xa,n.ad=Ms,n.ae=Te,n.af=ra,n.ag=Qr,n.ah=pe,n.ai=Pd,n.aj=tu,n.ak=Gn,n.al=pi,n.am=Mp,n.an=fi,n.ao=Ta,n.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return(function([i,s]){const u=Nn([1,i,s]);return{x:u.x,y:u.y,z:u.z}})(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Gn(r.x,e.x,i),y:Gn(r.y,e.y,i),z:Gn(r.z,e.z,i)}}},n.aq=function(r,e,i=0,s=!0){const u=new je(i,i),p=r.sub(u),_=e.add(u),v=[p,new je(_.x,p.y),_,new je(p.x,_.y)];return s&&v.push(p.clone()),v},n.ar=function(r,e){const i=[];for(let s=0;s<r.length;s++){const u=ze(s-1,-1,r.length-1),p=ze(s+1,-1,r.length-1),_=r[s],v=r[p],E=r[u].sub(_).unit(),C=v.sub(_).unit(),k=C.angleWithSep(E.x,E.y),F=E.add(C).unit().mult(-1*e/Math.sin(k/2));i.push(_.add(F))}return i},n.as=w0,n.at=Bo,n.au=function(r,e,i=0){return ui(((e.x-i)*r.scale-r.x)*pi,(e.y*r.scale-r.y)*pi,X(e.z,e.y))},n.av=zr,n.aw=Cn,n.ax=en,n.ay=Bv,n.az=function(r){let e=1/0,i=1/0,s=-1/0,u=-1/0;for(const p of r)e=Math.min(e,p.x),i=Math.min(i,p.y),s=Math.max(s,p.x),u=Math.max(u,p.y);return{min:new je(e,i),max:new je(s,u)}},n.b=function(r){return Rr.API_FONTS_REGEX.test(r)},n.b$=vp,n.b0=ao,n.b1=df,n.b2=rt,n.b3=fp,n.b4=Iy,n.b5=function(){qu.isLoading()||qu.isLoaded()||wu()!=="deferred"||Dd()},n.b6=Ld,n.b7=ft,n.b8=j_,n.b9=La,n.bA=Wi,n.bB=qi,n.bC=on,n.bD=function(r,e){const{x:i,y:s}=r.point,u=qf(i,s,r.worldSize/r._pixelsPerMercatorPixel,0,0);return Ci(u,u,Am(Ju(e)))},n.bE=Rt,n.bF=Yt,n.bG=Jn,n.bH=ln,n.bI=Ir,n.bJ=Cr,n.bK=eg,n.bL=Gd,n.bM=yx,n.bN=function(r,e,i,s,u){const p=5*e+2;r.float32[p+0]=i,r.float32[p+1]=s,r.float32[p+2]=u},n.bO=rg,n.bP=ar,n.bQ=ml,n.bR=pl,n.bS=Re,n.bT=ze,n.bU=function(r,e,i,s){var u=new ke(4);return u[0]=r,u[1]=e,u[2]=i,u[3]=s,u},n.bV=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,u=Math.floor(r.x),p=Math.floor((r.x-u)*s),_=Math.floor(r.y*s),v=this.findDEMTileFor(new zs(i,u,i,p,_));return!(!v||!v.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||r.y<0||r.y>1)return e;const u=s.getSource().maxzoom,p=1<<u,_=Math.floor(r.x),v=r.x-_,E=new zs(u,_,u,Math.floor(v*p),Math.floor(r.y*p)),C=this.findDEMTileFor(E);if(!C||!C.dem)return e;const k=C.dem,F=1<<C.tileID.canonical.z,V=(v*F-C.tileID.canonical.x)*k.dim,j=(r.y*F-C.tileID.canonical.y)*k.dim,$=Math.floor(V),ee=Math.floor(j);return(i?this.exaggeration():1)*Gn(Gn(k.get($,ee),k.get($,ee+1),j-ee),Gn(k.get($+1,ee),k.get($+1,ee+1),j-ee),V-$)}static getAtTileOffset(r,e,i,s){const u=1<<r.canonical.z;return s?s.pointElevation(e):i?i.getAtPointOrZero(new Te(r.wrap+(r.canonical.x+e.x/pi)/u,(r.canonical.y+e.y/pi)/u)):0}static getAtTileOffsetFunc(r,e,i,s){return(u,p,_)=>{const v=this.getAtTileOffset(r,u,p,_),E=s.upVector(r.canonical,u.x,u.y);return ai(E,E,v*s.upVectorScale(r.canonical,e,i).metersToTile),E}}getForTilePoints(r,e,i,s){if(this.isUsingMockSource())return!1;const u=ag.create(this,r,s);return!!u&&(e.forEach((p=>{p[2]=this.exaggeration()*u.getElevationAt(p[0],p[1],i)})),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,u=1<<r.canonical.z-s.canonical.z;let p=r.canonical.x/u-s.canonical.x,_=r.canonical.y/u-s.canonical.y,v=0;for(let E=0;E<r.canonical.z-s.canonical.z&&!i.leaves[v];E++){p*=2,_*=2;const C=2*Math.floor(_)+Math.floor(p);v=i.childOffsets[v]+C,p%=1,_%=1}return{min:this.exaggeration()*i.minimums[v],max:this.exaggeration()*i.maximums[v]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const u of r){const p=this.getMinMaxForTile(u.tileID);p&&(i=Math.min(i,p.min),s=Math.max(s,p.max),e=!0)}return e?{min:i,max:s}:null}},n.bW=im,n.bX=qr,n.bY=sc,n.bZ=Vc,n.b_=H0,n.ba=cx,n.bb=Sl,n.bc=it,n.bd=hf,n.be=Eu,n.bf=Wh,n.bg=xs,n.bh=Kp,n.bi=Cx,n.bj=function(r,e){const i=tu(e.zoom);if(i===0)return Ju(r);const s=Em(r),u=h_(s),p=M(s.getWest())*e.worldSize,_=M(s.getEast())*e.worldSize,v=R(s.getNorth())*e.worldSize,E=R(s.getSouth())*e.worldSize,C=[p,v,0],k=[_,v,0],F=[p,E,0],V=[_,E,0],j=Tn([],e.globeMatrix);return ra(C,C,j),ra(k,k,j),ra(F,F,j),ra(V,V,j),u[0]=cs(u[0],F,i),u[1]=cs(u[1],V,i),u[2]=cs(u[2],k,i),u[3]=cs(u[3],C,i),_n.fromPoints(u)},n.bk=wf,n.bl=Tn,n.bm=qm,n.bn=cs,n.bo=Od,n.bp=vf,n.bq=Ot,n.br=Ji,n.bs=Ny,n.bt=my,n.bu=Wl,n.bv=function(r,e){const i=[];for(const s in r)s in e||i.push(s);return i},n.bw=et,n.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.by=ei,n.bz=Vi,n.c=Ro,n.c$=function(r,e,i){let s=0;for(let u=0;u<2;++u)r[u]>0&&(s+=(r[u]-0)*(r[u]-0)),e[u]<0&&(s+=(0-e[u])*(0-e[u]));return s},n.c0=z_,n.c1=mx,n.c2=_0,n.c3=Tx,n.c4=qx,n.c5=ai,n.c6=ma,n.c7=qs,n.c8=function(r,e,i){i*=.5;var s=e[0],u=e[1],p=e[2],_=e[3],v=Math.sin(i),E=Math.cos(i);return r[0]=s*E+u*v,r[1]=u*E-s*v,r[2]=p*E+_*v,r[3]=_*E-p*v,r},n.c9=Us,n.cA=an,n.cB=ba,n.cC=wv,n.cD=Na,n.cE=A_,n.cF=function(r,e,i,s,u,p,_,v,E){if(E.name==="globe")return A_(r,e,new Na(i,s,u),!1);const C=zg({z:i,x:s,y:u},E);return new _n([(p+C.x/C.scale)*e,e*(C.y/C.scale),_],[(p+C.x2/C.scale)*e,e*(C.y2/C.scale),v])},n.cG=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},n.cH=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},n.cI=function(r){const e=Math.round((r+45+360)%360/90)%4;return kn[e]},n.cJ=Q,n.cK=ho,n.cL=Hp,n.cM=function(r){const e=Wi(new Float64Array(16));Ci(e,r.pixelMatrix,r.globeMatrix);const i=[0,Wu,0],s=[0,vs,0];return ra(i,i,e),ra(s,s,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!yp(r,new a(r.center.lat,90)),s[0]>0&&s[0]<=r.width&&s[1]>0&&s[1]<=r.height&&!yp(r,new a(r.center.lat,-90))]},n.cN=function(r,e){const{scale:i}=r.tileTransform,s=i*pi/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return(function(u,p,_){var v=p[1],E=p[2],C=p[3],k=_[0],F=_[1];return u[0]=p[0]*k,u[1]=v*k,u[2]=E*F,u[3]=C*F,u})(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},n.cO=cy,n.cP=Ui,n.cQ=bv,n.cR=function(r){const e=bv(r,!0);return Rt([],[e[0],e[1],e[4],e[5]])},n.cS=Vn,n.cT=ji,n.cU=Oi,n.cV=function(r){const{x:e,y:i}=r.point,{lng:s,lat:u}=r._center;return qf(e,i,r.worldSize,s,u)},n.cW=wr,n.cX=hi,n.cY=Ts,n.cZ=Qo,n.c_=wc,n.ca=ss,n.cb=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},n.cc=dn,n.cd=function(r,e,i,s,u){var p=1/Math.tan(e/2);if(r[0]=p/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=p,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,u!=null&&u!==1/0){var _=1/(s-u);r[10]=(u+s)*_,r[14]=2*u*s*_}else r[10]=-1,r[14]=-2*s;return r},n.ce=function(r,e,i,s,u,p,_){var v=1/(e-i),E=1/(s-u),C=1/(p-_);return r[0]=-2*v,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*E,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*C,r[11]=0,r[12]=(e+i)*v,r[13]=(u+s)*E,r[14]=(_+p)*C,r[15]=1,r},n.cf=N,n.cg=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},n.ch=bm,n.ci=Ff,n.cj=Oo,n.ck=ec,n.cl=so,n.cm=I0,n.cn=function(){var r=new ke(4);return ke!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},n.co=function(r,e,i){var s=e[0],u=e[1],p=e[2],_=e[3],v=Math.sin(i),E=Math.cos(i);return r[0]=s*E+p*v,r[1]=u*E+_*v,r[2]=s*-v+p*E,r[3]=u*-v+_*E,r},n.cp=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},n.cq=Ha,n.cr=function(r){var e=r[0],i=r[1],s=r[2],u=r[3];return Math.sqrt(e*e+i*i+s*s+u*u)},n.cs=So,n.ct=Da,n.cu=Ns,n.cv=3,n.cw=2,n.cx=7,n.cy=6,n.cz=Fa,n.d=function(r){return Rr.API_TILEJSON_REGEX.test(r)},n.d$=class{constructor(r,e,i,s){this.context=r,this.format=s,this.size=i,this.texture=r.gl.createTexture();const[u,p,_]=this.size,{gl:v}=r;v.bindTexture(v.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&v.texImage3D(v.TEXTURE_3D,0,this.format,u,p,_,0,Jy(this.format),Qy(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),r!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,r),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},n.d0=function(r){return r*r*r*r*r},n.d1=S,n.d2=45,n.d3=Nf,n.d4=function(r,e,i){const s=Math.sqrt(r*r+e*e+i*i),u=s>0?Math.acos(i/s)*Di:0;let p=r!==0||e!==0?Math.atan2(-e,-r)*Di+90:0;return p<0&&(p+=360),[s,p,u]},n.d5=ui,n.d6=Nn,n.d7=fe,n.d8=yn,n.d9=_n,n.dA=function(r){return r({pluginStatus:Ko,pluginURL:yc}),Qs.on("pluginStateChange",r),r},n.dB=gh,n.dC=class extends _h{constructor(r){super(r),this.current=wm}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},n.dD=hr,n.dE=function(r,e,i){const s=tu(i.zoom),u=r.style.map._antialias,p=r.terrain&&r.terrain.exaggeration()>0;return s===0&&!u&&!p},n.dF=function(r){const e=r.pixelsPerMeter,i=e/N(1,r.center.lat),s=Wi(new Float64Array(16));return Ji(s,s,[r.point.x,r.point.y,0]),Vn(s,s,[i,i,e]),Float32Array.from(s)},n.dG=Em,n.dH=function(r){const e=Q-5;r=te(r,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(fi(r))),3);return Math.round(i*(Sm.length-1))},n.dI=function(r,e,i,s){const u=e.getNorth(),p=e.getSouth(),_=e.getWest(),v=e.getEast(),E=1<<r.z,C=v-_,k=u-p,F=C/gp,V=-k/Sm[i],j=[0,F,0,V,0,0,u,_,0];if(r.z>0){const $=180/s;rn(j,j,[$/C+1,0,0,0,$/k+1,0,-.5*$/F,.5*$/V,1])}return j[2]=E,j[5]=r.x,j[8]=r.y,j},n.dJ=Ju,n.dK=function(r,e,i){const s=Wi(new Float64Array(16)),u=(e/(1<<r)-.5)*Math.PI*2;return Hn(s,i.globeMatrix,u),Float32Array.from(s)},n.dL=p_,n.dM=vh,n.dN=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},n.dO=ut,n.dP=function(r,e){var i=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=i,r[2]=0,r[3]=-i,r[4]=s,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},n.dQ=Aa,n.dR=$m,n.dS=jr,n.dT=da,n.dU=256,n.dV=function(r,e){const i=[0,0,0];return ra(i,i,wf(Ju(e.canonical))),ra(i,i,r),i},n.dW=r=>({u_matrix:new so(r),u_texsize:new ec(r),u_pixels_to_tile_units:new jp(r),u_device_pixel_ratio:new Oo(r),u_width_scale:new Oo(r),u_floor_width_scale:new Oo(r),u_image:new bm(r),u_units_to_pixels:new ec(r),u_tile_units_to_pixels:new Oo(r),u_alpha_discard_threshold:new Oo(r),u_trim_offset:new ec(r),u_trim_fade_range:new ec(r),u_trim_color:new Nf(r),u_zbias_factor:new Oo(r),u_tile_to_meter:new Oo(r),u_ground_shadow_factor:new Ff(r),u_pattern_transition:new Oo(r)}),n.dX=r=>({u_matrix:new so(r),u_pixels_to_tile_units:new jp(r),u_device_pixel_ratio:new Oo(r),u_width_scale:new Oo(r),u_floor_width_scale:new Oo(r),u_units_to_pixels:new ec(r),u_dash_image:new bm(r),u_gradient_image:new bm(r),u_image_height:new Oo(r),u_texsize:new ec(r),u_tile_units_to_pixels:new Oo(r),u_alpha_discard_threshold:new Oo(r),u_trim_offset:new ec(r),u_trim_fade_range:new ec(r),u_trim_color:new Nf(r),u_zbias_factor:new Oo(r),u_tile_to_meter:new Oo(r),u_ground_shadow_factor:new Ff(r)}),n.dY=r=>({u_camera_to_center_distance:new Oo(r),u_extrude_scale:new jp(r),u_device_pixel_ratio:new Oo(r),u_matrix:new so(r),u_inv_rot_matrix:new so(r),u_merc_center:new ec(r),u_tile_id:new Ff(r),u_zoom_transition:new Oo(r),u_up_dir:new Ff(r),u_emissive_strength:new Oo(r)}),n.dZ=Lf,n.d_=d2,n.da=Rn,n.db=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},n.dc=vv,n.dd=sx,n.de=Ev,n.df=Dx,n.dg=function(r,e){return r.readFields(hT,{icons:[]},e)},n.dh=nn,n.di=tg,n.dj=vx,n.dk=Ed,n.dl=dh,n.dm=Mh,n.dn=ns,n.dp=qt,n.dq=function(r){const e=r.indexOf(cf);return e>=0?r.slice(0,e):r},n.dr=function(r){return r.indexOf(cf)>=0},n.ds=function(r){const e=r.lastIndexOf(cf);return e>=0?r.slice(e+1):""},n.dt=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.du=function(r,e,i,s){return r.type==="custom"?new rT(r,e):new cT[r.type](r,e,i,s)},n.dv=ti,n.dw=function(r){const e=r.indexOf(cf);return e>=0?r.slice(e+1):""},n.dx=class extends j_{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},n.dy=Qs,n.dz=uu,n.e=Rr,n.e$=Si,n.e0=Wm,n.e1=(r,e,i,s,u,p)=>{const _=r.transform,v=_.projection.name==="globe";let E;if(p.paint.get("circle-pitch-alignment")==="map")if(v){const k=$m(_.zoom,e.canonical)*_._pixelsPerMercatorPixel;E=Float32Array.from([k,0,0,k])}else E=_.calculatePixelsToTileUnitsMatrix(i);else E=new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(_.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ks.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Xm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(v){C.u_inv_rot_matrix=s,C.u_merc_center=u,C.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],C.u_zoom_transition=tu(_.zoom);const k=u[0]*pi,F=u[1]*pi;C.u_up_dir=_.projection.upVector(new Na(0,0,0),k,F)}return C},n.e2=Uv,n.e3=Io,n.e4=(r,e,i,s,u,p,_,v,E,C)=>{const k=r.transform,F=k.pitch<15?Fv(.07,.7,te((14-k.zoom)/5,0,1)):.07,V=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:Vv(r,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:k.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:p,u_floor_width_scale:_,u_image:0,u_tile_units_to_pixels:Nv(e,k),u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:v,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(V?null:i.lut).toArray01(),u_zbias_factor:F,u_tile_to_meter:fe(e.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:C}},n.e5=(r,e,i,s,u,p,_,v,E,C)=>{const k=r.transform,F=k.calculatePixelsToTileUnitsMatrix(e),V=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",j=k.pitch<15?Fv(.07,.7,te((14-k.zoom)/5,0,1)):.07;return{u_matrix:Vv(r,e,i,s),u_pixels_to_tile_units:F,u_device_pixel_ratio:p,u_width_scale:_,u_floor_width_scale:v,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:jv(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Nv(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(V?null:i.lut).toArray01(),u_zbias_factor:j,u_tile_to_meter:fe(e.tileID.canonical,0),u_ground_shadow_factor:C}},n.e6=wt,n.e7=$f,n.e8=X,n.e9=nc,n.eA=function(r,e){var i=2*Math.acos(e[3]),s=Math.sin(i/2);return s>tt?(r[0]=e[0]/s,r[1]=e[1]/s,r[2]=e[2]/s):(r[0]=1,r[1]=0,r[2]=0),i},n.eB=Lx,n.eC=dy,n.eD=hy,n.eE=[1,1,1],n.eF=ag,n.eG=rl,n.eH=function(r,e,i,s){var u=e[0],p=e[1],_=e[2],v=e[3];return r[0]=u+s*(i[0]-u),r[1]=p+s*(i[1]-p),r[2]=_+s*(i[2]-_),r[3]=v+s*(i[3]-v),r},n.eI=Y_,n.eJ=Tu,n.eK=Su,n.eL=function(r,e,i,s,u,p,_,v,E,C,k,F,V,j,$,ee){var oe=new ke(16);return oe[0]=r,oe[1]=e,oe[2]=i,oe[3]=s,oe[4]=u,oe[5]=p,oe[6]=_,oe[7]=v,oe[8]=E,oe[9]=C,oe[10]=k,oe[11]=F,oe[12]=V,oe[13]=j,oe[14]=$,oe[15]=ee,oe},n.eM=h,n.eN=Of,n.eO=dp,n.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new je(1/0,1/0),max:new je(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=Sh(new je(0,0),new je(pi,pi),r),s=[];if(e&&!eh(i,this._globalClipBounds))return s;for(const u of this._activeRegions){if(u.hiddenByOverlap||!eh(i,u))continue;const p=Yh(u.min,u.max,r);s.push({min:p.min,max:p.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return s}setSources(r){this._setSources(r.map((e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(s).buckets[e.layer];u&&u.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope}))))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),s=r.getClipMask(),u=r.getClipScope();for(const p of e){if(!p.footprint)continue;const _=Sh(p.footprint.min,p.footprint.max,p.id);this._activeRegions.push({min:_.min,max:_.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:p.id,footprint:p.footprint,order:i,clipMask:s,clipScope:u})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort(((e,i)=>e.priority-i.priority||bo(e.min,i.min)||bo(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||(function(s,u){const p=(_,v)=>_+v;return s.length-u.length||s.reduce(p,"").localeCompare(u.reduce(p,""))})(e.clipScope,i.clipScope)));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];r=i.priority!==s.priority||!Zf(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!ei(i.clipScope,s.clipScope),this._activeRegions[e].hiddenByOverlap=s.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Ds&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const u=s[i].priority;for(;i<s.length&&s[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let u=i;const p=i;for(;u!==s;){const _=this._activeRegions[u];_.hiddenByOverlap=!1;for(let v=0;v<p;v++){const E=this._activeRegions[v];if(!E.hiddenByOverlap&&_.order===Ds&&eh(_,E)&&(_.hiddenByOverlap=Sf(_.footprint,_.tileId,E.footprint,E.tileId),_.hiddenByOverlap))break}++u}i=s,s=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},n.eQ=Ds,n.eR=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new hf,s=new ao,u=[],p=r+1+2,_=e[0]+1,v=e[0]+1+(1+e.length),E=(C,k,F)=>{let V=C===p-1?C-2:C===0?C:C-1;return V+=F?24575:0,[V,k]};for(let C=0;C<p;++C)i.emplaceBack(...E(C,0,!0));for(let C=0;C<_;++C)for(let k=0;k<p;++k)i.emplaceBack(...E(k,C,(k===0||k===p-1)&&!0));for(let C=0;C<e.length;++C){const k=e[C];for(let F=0;F<p;++F)i.emplaceBack(...E(F,k,!0))}for(let C=0;C<e.length;++C){const k=s.length,F=e[C]+1+2,V=new ao;for(let ee=0;ee<F-1;ee++){const oe=ee===F-2,se=oe?p*(v-e.length+C-ee):p;for(let ge=0;ge<p-1;ge++){const xe=ee*p+ge;ee===0||oe||ge===0||ge===p-2?(V.emplaceBack(xe+1,xe,xe+se),V.emplaceBack(xe+se,xe+se+1,xe+1)):(s.emplaceBack(xe+1,xe,xe+se),s.emplaceBack(xe+se,xe+se+1,xe+1))}}const j=xs.simpleSegment(0,k,i.length,s.length-k);for(let ee=0;ee<V.uint16.length;ee+=3)s.emplaceBack(V.uint16[ee],V.uint16[ee+1],V.uint16[ee+2]);const $=xs.simpleSegment(0,k,i.length,s.length-k);u.push({withoutSkirts:j,withSkirts:$})}return{vertices:i,indices:s,segments:u}}_createGrid(r){const e=this._fillGridMeshWithLods(gp,Sm);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Wh.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new ao;for(let _=0;_<=gp;_++)e.emplaceBack(0,_+1,_+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new mf,s=new mf,u=new mf,p=new mf;this._poleSegments=[];for(let _=0,v=0;_<wc;_++){const E=360/(1<<_);i.emplaceBack(0,-ps,0,.5,0),s.emplaceBack(0,-ps,0,.5,1),u.emplaceBack(0,-ps,0,.5,.5),p.emplaceBack(0,-ps,0,.5,.5);for(let C=0;C<=gp;C++){let k=C/gp,F=0;const V=Gn(0,E,k),[j,$,ee]=wl(Zm,I_,V,ps);i.emplaceBack(j,$,ee,k,F),s.emplaceBack(j,$,ee,k,1-F);const oe=fi(V);k=.5+.5*Math.sin(oe),F=.5+.5*Math.cos(oe),u.emplaceBack(j,$,ee,k,F),p.emplaceBack(j,$,ee,k,1-F)}this._poleSegments.push(xs.simpleSegment(v,0,66,64)),v+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Ku,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(s,Ku,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(u,Ku,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(p,Ku,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},n.eS=vo,n.eT=Tr,n.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.eV=lt,n.eW=_e,n.eX=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},n.eY=Dr,n.eZ=Au,n.e_=Mr,n.ea=au,n.eb=x_,n.ec=Ef,n.ed=g_,n.ee=R_,n.ef=ie,n.eg=function(r,e){if(r===e){var i=e[1],s=e[2],u=e[3],p=e[6],_=e[7],v=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=s,r[9]=p,r[11]=e[14],r[12]=u,r[13]=_,r[14]=v}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},n.eh=nT,n.ei=Zr,n.ej=ko,n.ek=256,n.el=Am,n.em=bc,n.en=Hn,n.eo=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},n.ep=mf,n.eq=vt,n.er=gm,n.es=function(r,e,i,s,u){return te((r-e)/(i-e)*(u-s)+s,s,u)},n.et=cn,n.eu=function(r,e){var i=e[0],s=e[1],u=e[2],p=e[3],_=e[4],v=e[5],E=e[6],C=e[7],k=e[8],F=k*_-v*C,V=-k*p+v*E,j=C*p-_*E,$=i*F+s*V+u*j;return $?(r[0]=F*($=1/$),r[1]=(-k*s+u*C)*$,r[2]=(v*s-u*_)*$,r[3]=V*$,r[4]=(k*i-u*E)*$,r[5]=(-v*i+u*p)*$,r[6]=j*$,r[7]=(-C*i+s*E)*$,r[8]=(_*i-s*p)*$,r):null},n.ev=2,n.ew=pr,n.ex=Vs,n.ey=Hi,n.ez=function(r,e){var i=new ke(3);Hi(i,e);var s=1/i[0],u=1/i[1],p=1/i[2],_=e[0]*s,v=e[1]*u,E=e[2]*p,C=e[4]*s,k=e[5]*u,F=e[6]*p,V=e[8]*s,j=e[9]*u,$=e[10]*p,ee=_+k+$,oe=0;return ee>0?(oe=2*Math.sqrt(ee+1),r[3]=.25*oe,r[0]=(F-j)/oe,r[1]=(V-E)/oe,r[2]=(v-C)/oe):_>k&&_>$?(oe=2*Math.sqrt(1+_-k-$),r[3]=(F-j)/oe,r[0]=.25*oe,r[1]=(v+C)/oe,r[2]=(V+E)/oe):k>$?(oe=2*Math.sqrt(1+k-_-$),r[3]=(V-E)/oe,r[0]=(v+C)/oe,r[1]=.25*oe,r[2]=(F+j)/oe):(oe=2*Math.sqrt(1+$-_-k),r[3]=(v-C)/oe,r[0]=(V+E)/oe,r[1]=(F+j)/oe,r[2]=.25*oe),r},n.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,((e,i)=>String.fromCharCode(+("0x"+i)))))},n.f0=function([r,e,i]){const s=Math.hypot(r,e,i),u=Math.atan2(r,i),p=.5*Math.PI-Math.acos(-e/s);return new a(hi(u),hi(p))},n.f1=Vo,n.f2=tx,n.f3=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!(function(i){if(Ja==null){const s=i.navigator?i.navigator.userAgent:null;Ja=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return Ja})(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},n.f4=function(r,e){Jh=r,Qh=e},n.f5=yp,n.f6=Zp,n.f7=function(r){const e=[0,0,0],i=Wi(new Float64Array(16));return Ci(i,r.pixelMatrix,r.globeMatrix),ra(e,e,i),new je(e[0],e[1])},n.f8=function(){const r=kt;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(W),kt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.f9=function(){nn().acquire(W)},n.fA=Fy,n.fB=ht,n.fC=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==mv){const i=new Uint32Array(r,0,7),[,,s,u,p,_]=i;e=i.byteLength+u+p+_+p,(s!==r.byteLength||e>=r.byteLength)&&Bi("Invalid b3dm header information.")}return xv(r,e)},n.fD=function(r,e){const i=sx(r);for(const s of i){for(const u of s.meshes)Lw(u);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(kw(s.lights,e)))}return i},n.fE=Ry,n.fF=Ur,n.fG=D,n.fH=qu,n.fI=qo,n.fJ=function(r){Cc(),Gc?.then((e=>{e.keys().then((i=>{for(let s=0;s<i.length-r;s++)e.delete(i[s]).catch((u=>Bi(u.message)))})).catch((i=>Bi(i.message)))})).catch((e=>Bi(e.message)))},n.fa=wu,n.fb=function(r,e,i=!1){if(Ko===qo.deferred||Ko===qo.loading||Ko===qo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");yc=Ks.resolveURL(r),Ko=qo.deferred,np=e,Jo(),i||Dd()},n.fc=function(r){co=Ks.resolveURL(r),Kt||(Kt=new Je(nn(),new id)),Kt.broadcast("setMeshoptUrl",co)},n.fd=Jr,n.fe=function(r){Fr=Ks.resolveURL(r),Kt||(Kt=new Je(nn(),new id)),Kt.broadcast("setDracoUrl",Fr)},n.ff=uo,n.fg=G,n.fh=function(r){const e=lu();if(!e)return;const i=e.delete(ou);r&&i.then((()=>r())).catch(r)},n.fi=ve,n.fj=di,n.fk=wd,n.fl=rm,n.fm=Rb,n.fn=Pb,n.fo=Lv,n.fp=Bt,n.fq="hd_road_elevation",n.fr=yr,n.fs=At,n.ft=Er,n.fu=xx,n.fv=V_,n.fw=function(r,e,i,s,u,p,_,v=1,E,C,k){r.createArrays(),r.tilePixelRatio=pi/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const F=r.layers[0].layout,V=r.layers[0]._unevaluatedLayout._values,j={};j.scaleFactor=v,j.textSizeScaleRange=F.get("text-size-scale-range"),j.iconSizeScaleRange=F.get("icon-size-scale-range");const[$,ee]=j.textSizeScaleRange,[oe,se]=j.iconSizeScaleRange;j.textScaleFactor=te(j.scaleFactor,$,ee),j.iconScaleFactor=te(j.scaleFactor,oe,se);const ge=V["text-size"],xe=V["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:ct,maxZoom:Gt}=r.textSizeData;j.compositeTextSizes=[ge.possiblyEvaluate(new Xa(ct,{worldview:k}),p),ge.possiblyEvaluate(new Xa(Gt,{worldview:k}),p)]}if(r.iconSizeData.kind==="composite"){const{minZoom:ct,maxZoom:Gt}=r.iconSizeData;j.compositeIconSizes=[xe.possiblyEvaluate(new Xa(ct,{worldview:k}),p),xe.possiblyEvaluate(new Xa(Gt,{worldview:k}),p)]}j.layoutTextSize=ge.possiblyEvaluate(new Xa(_+1,{worldview:k}),p),j.layoutIconSize=xe.possiblyEvaluate(new Xa(_+1,{worldview:k}),p),j.textMaxSize=ge.possiblyEvaluate(new Xa(18,{worldview:k}),p);const Ie=F.get("symbol-placement"),He=F.get("text-rotation-alignment")==="map"&&Ie!=="point",Ne=F.get("text-size");let We=!1;const at=[];for(const ct of r.features){const Gt=F.get("text-font").evaluate(ct,{},p).join(","),pt=Ne.evaluate(ct,{},p)*j.textScaleFactor,Xt=j.layoutTextSize.evaluate(ct,{},p)*j.textScaleFactor,ni=j.layoutIconSize.evaluate(ct,{},p)*j.iconScaleFactor,ri={horizontal:{},vertical:void 0},vi=ct.text;let wi,_i=[0,0];if(vi){const Ar=vi.toString(),ts=F.get("text-letter-spacing").evaluate(ct,{},p)*sc,Ue=F.get("text-line-height").evaluate(ct,{},p)*sc,$e=bl(Ar)?ts:0,Wt=F.get("text-anchor").evaluate(ct,{},p),bi=F.get("text-variable-anchor");if(!bi){const br=F.get("text-radial-offset").evaluate(ct,{},p);if(br)_i=_0(Wt,[br*sc,wx]);else{const Lr=F.get("text-offset").evaluate(ct,{},p);_i=[Lr[0]*sc,Lr[1]*sc]}}let Zi=He?"center":F.get("text-justify").evaluate(ct,{},p);const Xi=Ie==="point",Pn=Xi?F.get("text-max-width").evaluate(ct,{},p)*sc:1/0,Bn=br=>{r.allowVerticalPlacement&&_o(Ar)&&(ri.vertical=px(vi,e,i,u,Gt,Pn,Ue,Wt,br,$e,_i,Gd.vertical,!0,Xt,pt,E))};if(!He&&bi){const br=Zi==="auto"?bi.map((Nr=>Tx(Nr))):[Zi];let Lr=!1;for(let Nr=0;Nr<br.length;Nr++){const sa=br[Nr];if(!ri.horizontal[sa])if(Lr)ri.horizontal[sa]=ri.horizontal[0];else{const er=px(vi,e,i,u,Gt,Pn,Ue,"center",sa,$e,_i,Gd.horizontal,!1,Xt,pt,E);er&&(ri.horizontal[sa]=er,Lr=er.positionedLines.length===1)}}Bn("left")}else{if(Zi==="auto"&&(Zi=Tx(Wt)),Xi||F.get("text-writing-mode").indexOf("horizontal")>=0||!_o(Ar)){const br=px(vi,e,i,u,Gt,Pn,Ue,Wt,Zi,$e,_i,Gd.horizontal,!1,Xt,pt,E);br&&(ri.horizontal[Zi]=br)}Bn(Xi?"left":Zi)}}let gi,Zt,$t,yi,ki,Ii,Dn=!1;const tn=F.get("icon-text-fit").evaluate(ct,{},p);if(ct.icon&&ct.icon.hasPrimary()){const Ar=Mg(ct.icon,r.iconSizeData,V["icon-size"],p,r.zoom,ct,E,j.iconScaleFactor,k);gi=Ar.iconPrimary,$t=Ar.iconSecondary;const ts=gi.toString();if(Zt=s.get(ts),Zt&&(ki=F.get("icon-offset").evaluate(ct,{},p),Ii=F.get("icon-anchor").evaluate(ct,{},p),wi=gy(u.get(ts),$t?u.get($t.toString()):void 0,ki,Ii),Dn=Zt.sdf,r.sdfIcons===void 0?r.sdfIcons=Zt.sdf:r.sdfIcons!==Zt.sdf&&Bi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Zt.pixelRatio!==r.pixelRatio||F.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),$t){const Ue=$t.toString();yi=s.get(Ue)}}We=We||!(!ct.icon||!ct.icon.hasSecondary());const sn=wy(ri.horizontal)||ri.vertical;r.iconsInText||(r.iconsInText=!!sn&&sn.iconsInText);const bn=Xt*j.textScaleFactor/sc,{defaultShapedIcon:Vr,verticallyShapedIcon:zi}=G2(r,wi,F,ct,p,ri,bn,ki,tn);tn!=="none"&&wi&&(t0(wi)||i0(wi))&&(by(0,Zt,gi,wi,Vr,tn,C,s,u),by(0,yi,$t,wi,Vr,tn,C,s,u),zi&&(by(0,Zt,gi,wi,zi,tn,C,s,u),by(0,yi,$t,wi,zi,tn,C,s,u))),wi=Vr;const{iconBBox:wn,iconVerticalBBox:fr,textBBox:ha,textVerticalBBox:xa}=F2(r,wi,zi,F,ct,p,ni,ki,j,u,Ii,ri,Xt,_i);at.push({feature:ct,shapedTextOrientations:ri,shapedText:sn,shapedIcon:wi,iconPrimary:gi,iconSecondary:$t,iconOffset:ki,iconAnchor:Ii,verticallyShapedIcon:zi,layoutTextSize:Xt,layoutIconSize:ni,textOffset:_i,isSDFIcon:Dn,iconTextFit:tn,iconCollisionBounds:wn,iconVerticalCollisionBounds:fr,textCollisionBounds:ha,textVerticalCollisionBounds:xa})}return{featureData:at,sizes:j,hasAnySecondaryIcon:We,textAlongLine:He,symbolPlacement:Ie}},n.fx=u0,n.fy=function(r,e,i,s,u,p,_,v,E,C){r.iconAtlasPositions=C.iconPositions;const{featureData:k,hasAnySecondaryIcon:F,sizes:V,textAlongLine:j,symbolPlacement:$}=e;for(const ee of k){const{shapedIcon:oe,verticallyShapedIcon:se,feature:ge,shapedTextOrientations:xe,shapedText:Ie,layoutTextSize:He,textOffset:Ne,isSDFIcon:We,iconPrimary:at,iconSecondary:ct,iconTextFit:Gt,iconOffset:pt,iconCollisionBounds:Xt,iconVerticalCollisionBounds:ni,textCollisionBounds:ri}=ee;y0(oe,C.iconPositions,at,ct),y0(se,C.iconPositions,at,ct),j2(xe,C.iconPositions),U2(at,ct,C.iconPositions),(Ie||oe)&&q2(r,ge,xe,oe,se,E,V,He,0,Ne,We,s,u,_,v,F,Gt,pt,j,$,Xt,ni,ri)}i&&r.generateCollisionDebugBuffers(p,r.collisionBoxArray,V.textScaleFactor)},n.fz=gt,n.g=function(r,e){return uu(Object.assign(r,{method:"GET"}),e)},n.h=function(r){return r.indexOf("mapbox:")===0},n.i=function(r){return Rr.API_STYLE_REGEX.test(r)&&!Ro(r)},n.j=$a,n.k=Xl,n.l=function(r){return decodeURIComponent(atob(r).split("").map((e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2))).join(""))},n.m=function(r,e){return uu(Object.assign(r,{type:"json"}),e)},n.n=ah,n.o=Ks,n.p=function(r,e){return uu(Object.assign(r,{method:"POST"}),e)},n.q=Tl,n.r=Mc,n.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=function(){return Mi||(Mi=new ve("ImageRasterizer")),Mi},n.u=function(){return(function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)})()},n.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},n.w=Bi,n.x=Vx,n.y=ed,n.z=Dl})),Pe(["./shared"],(function(n){function tt(lt){const te=lt?lt.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function ke(lt){if(typeof lt=="number"||typeof lt=="boolean"||typeof lt=="string"||lt==null)return JSON.stringify(lt);if(Array.isArray(lt)){let pe="[";for(const ze of lt)pe+=`${ke(ze)},`;return`${pe}]`}let te="{";for(const pe of Object.keys(lt).sort())te+=`${pe}:${ke(lt[pe])},`;return`${te}}`}function Rt(lt){let te="";for(const pe of n.bx)te+=`/${ke(lt[pe])}`;return te}class ut{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,pe){this._layerConfigs={},this._layers={},this.update(te,[],pe)}update(te,pe,ze){this._options=ze;for(const Xe of te)this._layerConfigs[Xe.id]=Xe,(this._layers[Xe.id]=n.du(Xe,this.scope,null,this._options)).compileFilter(ze),this.keyCache[Xe.id]&&delete this.keyCache[Xe.id];for(const Xe of pe)delete this.keyCache[Xe],delete this._layerConfigs[Xe],delete this._layers[Xe];this.familiesBySource={};const et=(function(Xe,rt){const wt={};for(let At=0;At<Xe.length;At++){const ti=Xe[At];let qt=rt&&rt[ti.id];qt||(ti.type==="symbol"?qt=ti.id:(qt=Rt(ti),ti.type==="line"&&ti.paint&&(function Ki(Bi){return typeof Bi=="string"&&Bi==="line-progress"||(Array.isArray(Bi)?Bi.some(Ki):!(!Bi||typeof Bi!="object")&&Object.values(Bi).some(Ki))})(ti.paint["line-width"])&&(qt+=`/${ke(ti.paint["line-width"])}`))),rt&&(rt[ti.id]=qt);let Yi=wt[qt];Yi||(Yi=wt[qt]=[]),Yi.push(ti)}const ot=[];for(const At in wt)ot.push(wt[At]);return ot})(Object.values(this._layerConfigs),this.keyCache);for(const Xe of et){const rt=Xe.map((Yi=>this._layers[Yi.id])),wt=rt[0];if(wt.visibility==="none")continue;const ot=wt.source||"";let At=this.familiesBySource[ot];At||(At=this.familiesBySource[ot]={});const ti=wt.sourceLayer||"_geojsonTileLayer";let qt=At[ti];qt||(qt=At[ti]=[]),qt.push(rt)}}}const bt=1*n.fl;class rn{constructor(te){const pe={},ze=[];for(const wt in te){const ot=te[wt],At=pe[wt]={};for(const ti in ot.glyphs){const qt=ot.glyphs[+ti];if(!qt||qt.bitmap.width===0||qt.bitmap.height===0)continue;const Yi=qt.metrics.localGlyph?bt:1,Ki={x:0,y:0,w:qt.bitmap.width+2*Yi,h:qt.bitmap.height+2*Yi};ze.push(Ki),At[ti]=Ki}}const{w:et,h:Xe}=n.G(ze),rt=new n.fk({width:et||1,height:Xe||1});for(const wt in te){const ot=te[wt];for(const At in ot.glyphs){const ti=ot.glyphs[+At];if(!ti||ti.bitmap.width===0||ti.bitmap.height===0)continue;const qt=pe[wt][At],Yi=ti.metrics.localGlyph?bt:1;n.fk.copy(ti.bitmap,rt,{x:0,y:0},{x:qt.x+Yi,y:qt.y+Yi},ti.bitmap)}}this.image=rt,this.positions=pe}}function on(lt,te,pe){lt[te]?pe&&(lt[te].center=pe):lt[te]={floorIds:new Set,center:pe||[0,0],floors:{}}}function Vi(lt,te,pe,ze){for(const et of te)on(lt,et),lt[et].floors[pe]=ze,lt[et].floorIds.add(pe)}function Wi(lt){return{id:lt.properties.id.toString(),center:lt.properties.center.toString().split(";").map(Number)}}function Tn(lt){return{id:lt.properties.id.toString(),isDefault:!!lt.properties.is_default&&lt.properties.is_default,connections:lt.properties.connected_floor_ids?new Set(lt.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:lt.properties.conflicted_floor_ids?new Set(lt.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:lt.properties.building_ids?new Set(lt.properties.building_ids.toString().split(";")):new Set,name:lt.properties.name.toString(),zIndex:lt.properties.z_index}}function Ci(lt,te){return te.every((pe=>lt.properties&&lt.properties[pe]!=null))}function Ji(lt){return Ci(lt,["type","id","name"])&&lt.properties.type==="building"}function Vn(lt){return Ci(lt,["type","id","name","z_index"])&&lt.properties.type==="floor"}n.fj(rn,"GlyphAtlas");class Oi{constructor(te){this.tileID=new n.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.request&&te.request.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=n.aZ(te.tileID.canonical,te.projection),this.projection=te.projection,this.worldview=te.worldview,this.localizableLayerIds=te.localizableLayerIds,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep,this.scaleFactor=te.scaleFactor,this.worldview=te.worldview,this.indoor=te.indoor}parse(te,pe,ze,et,Xe,rt){this.status="parsing",this.data=te,this.collisionBoxArray=new n.b3;const wt=new n.fm(Object.keys(te.layers).sort()),ot=new n.fn(this.tileID,this.promoteId);ot.bucketLayerIDs=[];const At={},ti=new n.fo(256,256),qt={featureIndex:ot,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ti,availableImages:ze,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const dr=this.indoor.indoorState.activeFloorsVisible,$n=(function(Nn,Ur,La){const Ja=(function(ea,jr){if(!ea)return n.w("No source layers defined in indoor specification"),jr;if(ea.size===0)return jr;const da=ea.difference(jr);for(const lr of da)n.w(`Missing source layer required in indoor specification: ${lr}`);return jr.intersection(jr)})(Ur.sourceLayers,new Set(Object.keys(Nn.layers))),ss=Ur.indoorState,js=(function(ea,jr,da,lr){const Rr=new Set,$a=new Set,Ro=new Set,Ys=new Map,_l={},nh=es=>{const jo=Ys.get(es)||new Set;for(const _a of Rr)if((Ys.get(_a)||new Set).has(es)||jo.has(_a))return!0;return!1};for(const es of jr){const jo=ea.layers[es];if(jo)for(let _a=0;_a<jo.length;_a++){const Mc=jo.feature(_a);if(Ji(Mc)){const{id:Ks,center:jc}=Wi(Mc);on(_l,Ks,jc),Rr.add(Ks)}else if(Vn(Mc)){const{id:Ks,isDefault:jc,connections:Mh,conflicts:ou,buildings:Jh,name:Qh,zIndex:Mu}=Tn(Mc);Vi(_l,Jh,Ks,{name:Qh,zIndex:Mu}),Ys.set(Ks,ou),(Ks===lr||Mh.has(lr))&&Rr.add(Ks),$a.add(Ks),jc&&Ro.add(Ks)}}else n.w(`indoor source layer not found: ${es}`)}if(da)for(const es of da)$a.has(es)&&(nh(es)||Rr.add(es));for(const es of Ro)Rr.has(es)||nh(es)||Rr.add(es);return{buildings:_l,activeFloors:Rr}})(Nn,Ja,ss.lastActiveFloors,ss.selectedFloorId);return La.send("setIndoorData",js),js})(te,this.indoor,Xe);qt.activeFloors=dr?$n.activeFloors:void 0}const Yi=[],Ki=pe.familiesBySource[this.source];for(const dr in Ki){const $n=te.layers[dr];if(!$n)continue;let Nn=!1,Ur=!1,La=!1;for(const jr of Ki[dr])jr[0].type==="symbol"?Nn=!0:Ur=!0,jr[0].is3D()&&jr[0].type!=="model"&&(La=!0);if(this.extraShadowCaster&&!La||this.isSymbolTile===!0&&!Nn||this.isSymbolTile===!1&&!Ur)continue;$n.version===1&&n.w(`Vector tile source "${this.source}" layer "${dr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ja=wt.encode(dr),ss=[],js=this.localizableLayerIds&&this.localizableLayerIds.has(dr);let ea=!1;for(let jr=0,da=0;jr<$n.length;jr++){const lr=$n.feature(jr),Rr=ot.getId(lr,dr),$a=lr.properties?lr.properties.worldview:null;if(js&&this.worldview&&typeof $a=="string")if($a==="all")lr.properties.$localized=!0;else{if(!$a.split(",").includes(this.worldview))continue;lr.properties.$localized=!0,lr.properties.worldview=this.worldview}!ea&&lr.properties&&lr.properties.hasOwnProperty(n.fp)&&(ea=!0),ss.push({feature:lr,id:Rr,index:da,sourceLayerIndex:Ja}),da++}ea&&!qt.elevationFeatures&&te.layers.hasOwnProperty(n.fq)&&(qt.elevationFeatures=n.fr.parseFrom(te.layers[n.fq],this.canonical));for(const jr of Ki[dr]){const da=jr[0];if(this.extraShadowCaster&&(!da.is3D()||da.type==="model")||this.isSymbolTile!==void 0&&da.type==="symbol"!==this.isSymbolTile||da.minzoom&&this.zoom<Math.floor(da.minzoom)||da.maxzoom&&this.zoom>=da.maxzoom||da.visibility==="none")continue;Hn(jr,this.zoom,qt.brightness,ze,this.worldview);const lr=At[da.id]=da.createBucket({index:ot.bucketLayerIDs.length,layers:jr,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ja,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:et,worldview:this.worldview,localizable:js});ot.bucketLayerIDs.push(jr.map(($a=>n.B($a.id,$a.scope))));let Rr=lr.prepare?lr.prepare():null;Rr!=null?(Rr=Rr.then((()=>lr.populate(ss,qt,this.tileID.canonical,this.tileTransform))),Yi.push(Rr)):lr.populate(ss,qt,this.tileID.canonical,this.tileTransform)}}const Bi=()=>{let dr,$n,Nn,Ur,La,Ja;ti.trim();const ss={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},js=()=>{if(dr)return this.status="done",rt(dr);if(this.extraShadowCaster)this.status="done",rt(null,{buckets:Object.values(At).filter((jr=>!jr.isEmpty())),featureIndex:ot,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:qt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if($n&&Nn&&Ur){const jr=new rn($n),da=new Map;for(const[$a,Ro]of Nn.entries()){const{imagePosition:Ys}=n.fu($a,Ro,n.fv);da.set($a,Ys)}const lr={};for(const $a in At){const Ro=At[$a];Ro instanceof n.b4&&(Hn(Ro.layers,this.zoom,qt.brightness,ze,this.worldview),lr[$a]=n.fw(Ro,$n,jr.positions,Nn,da,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,La,this.worldview))}const Rr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Xe,Nn,La,(()=>{Rr.iconsPending=!1,ea(lr,jr,Rr)})),this.rasterizeIfNeeded(Xe,Ur,Ja,(()=>{Rr.patternsPending=!1,ea(lr,jr,Rr)}))}},ea=(jr,da,lr,Rr)=>{if(lr.iconsPending||lr.patternsPending)return;const $a=new n.fx(Nn,Ur,this.lut);for(const Ro in At){const Ys=At[Ro];if(Ro in jr)n.fy(Ys,jr[Ro],this.showCollisionBoxes,ze,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Nn,$a);else if(Ys.hasPattern&&(Ys instanceof n.ba||Ys instanceof n.bb||Ys instanceof n.ea)){Hn(Ys.layers,this.zoom,qt.brightness,ze,this.worldview);const _l=Object.fromEntries($a.patternPositions);Ys.addFeatures(qt,this.tileID.canonical,_l,ze,this.tileTransform,this.brightness)}}this.status="done",rt(null,{buckets:Object.values(At).filter((Ro=>!Ro.isEmpty())),featureIndex:ot,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:da.image,lineAtlas:ti,imageAtlas:$a,brightness:qt.brightness})};if(!this.extraShadowCaster){const jr=n.fs(qt.glyphDependencies,(Rr=>Object.keys(Rr).map(Number)));Object.keys(jr).length?Xe.send("getGlyphs",{uid:this.uid,stacks:jr},((Rr,$a)=>{dr||(dr=Rr,$n=$a,js())}),void 0,!1,ss):$n={};const da=Array.from(qt.iconDependencies.keys()).map((Rr=>n.I.parse(Rr)));da.length?Xe.send("getImages",{images:da,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Rr,$a)=>{dr||(dr=Rr,Nn=new Map,La=this.updateImageMapAndGetImageTaskQueue(Nn,$a,qt.iconDependencies),js())}),void 0,!1,ss):(Nn=new Map,La=new Map);const lr=Array.from(qt.patternDependencies.keys()).map((Rr=>n.I.parse(Rr)));lr.length?Xe.send("getImages",{images:lr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Rr,$a)=>{dr||(dr=Rr,Ur=new Map,Ja=this.updateImageMapAndGetImageTaskQueue(Ur,$a,qt.patternDependencies),js())}),void 0,!1,ss):(Ur=new Map,Ja=new Map)}if(qt.elevationFeatures&&qt.elevationFeatures.length>0){const jr=[];for(const lr of Object.values(At))if(lr instanceof n.bb){const Rr=lr.getUnevaluatedPortalGraph();Rr&&jr.push(Rr)}const da=n.ft.evaluate(jr);for(const lr of Object.values(At))if(lr instanceof n.bb){const Rr=te.layers[wt.decode(lr.sourceLayerIndex)];lr.setEvaluatedPortalGraph(da,Rr,this.tileID.canonical,qt.availableImages,qt.brightness)}}js()};Yi.length>0?Promise.allSettled(Yi).then(Bi).catch(rt):Bi()}updateParameters(te){this.scaleFactor=te.scaleFactor,this.showCollisionBoxes=te.showCollisionBoxes,this.projection=te.projection,this.brightness=te.brightness,this.tileTransform=n.aZ(te.tileID.canonical,te.projection),this.extraShadowCaster=te.extraShadowCaster,this.lut=te.lut,this.worldview=te.worldview,this.indoor=te.indoor}rasterizeIfNeeded(te,pe,ze,et){Array.from(pe.values()).some((Xe=>Xe.usvg))?this.rasterize(te,pe,ze,et):et()}updateImageMapAndGetImageTaskQueue(te,pe,ze){const et=new Map;for(const Xe of pe.keys()){const rt=ze.get(Xe)||[];for(const wt of rt){const ot=wt.toString(),At=pe.get(wt.id.toString());At.usvg?et.has(ot)||(et.set(ot,wt),te.set(ot,Object.assign({},At))):te.set(ot,At)}}return et}rasterize(te,pe,ze,et){this.rasterizeTask=te.send("rasterizeImages",{scope:this.scope,tasks:ze},((Xe,rt)=>{if(!Xe)for(const[wt,ot]of rt.entries()){const At=Object.assign(pe.get(wt),{data:ot});pe.set(wt,At)}et()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Hn(lt,te,pe,ze,et){const Xe=new n.ac(te,{brightness:pe,worldview:et});for(const rt of lt)rt.recalculate(Xe,ze)}class qi extends n.E{constructor(te,pe,ze,et,Xe,rt,wt){super(),this.actor=te,this.layerIndex=pe,this.availableImages=ze,this.availableModels=et,this.loadVectorData=rt||n.aL,this.loading={},this.loaded={},this.deduped=new n.aK(te.scheduler),this.isSpriteLoaded=Xe,this.scheduler=te.scheduler,this.brightness=wt}loadTile(te,pe){const ze=te.uid,et=te&&te.request,Xe=et&&et.collectResourceTiming,rt=this.loading[ze]=new Oi(te);rt.abort=this.loadVectorData(te,((wt,ot)=>{const At=!this.loading[ze];if(delete this.loading[ze],rt.cancelRasterize(),At||wt||!ot)return rt.status="done",At||(this.loaded[ze]=rt),pe(wt);const ti=ot.rawData,qt={},Yi=n.aM(ot.responseHeaders);Yi&&Yi.expires&&(qt.expires=Yi.expires),Yi&&Yi.cacheControl&&(qt.cacheControl=Yi.cacheControl),rt.vectorTile=ot.vectorTile||new n.fz(new n.bt(ti));const Ki=()=>{rt.parse(rt.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((Bi,dr)=>{if(Bi||!dr)return pe(Bi);const $n={};if(Xe){const Nn=tt(et);Nn.length>0&&($n.resourceTiming=JSON.parse(JSON.stringify(Nn)))}pe(null,Object.assign({rawTileData:ti.slice(0),responseHeaders:ot.responseHeaders},dr,qt,$n))}))};this.isSpriteLoaded?Ki():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(Ki,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):Ki()})),this.loaded=this.loaded||{},this.loaded[ze]=rt}))}reloadTile(te,pe){const ze=this.loaded,et=te.uid;if(ze&&ze[et]){const Xe=ze[et];Xe.updateParameters(te);const rt=(wt,ot)=>{const At=Xe.reloadCallback;At&&(delete Xe.reloadCallback,Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,At)),pe(wt,ot)};Xe.status==="parsing"?Xe.reloadCallback=rt:Xe.status==="done"&&(Xe.vectorTile?Xe.parse(Xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,rt):rt())}else pe(null,void 0)}abortTile(te,pe){const ze=te.uid,et=this.loading[ze];et&&(et.abort&&et.abort(),delete this.loading[ze]),pe()}removeTile(te,pe){const ze=this.loaded,et=te.uid;ze&&ze[et]&&delete ze[et],pe()}}class Ot{loadTile(te,pe){const{uid:ze,encoding:et,rawImageData:Xe,padding:rt}=te,wt=ImageBitmap&&Xe instanceof ImageBitmap?this.getImageData(Xe,rt):Xe;pe(null,new n.fA(ze,wt,et,rt<1))}reloadTile(te,pe){pe(null,null)}abortTile(te,pe){pe()}removeTile(te,pe){pe()}getImageData(te,pe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const ze=this.offscreenCanvasContext.getImageData(-pe,-pe,te.width+2*pe,te.height+2*pe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ze}}n.bs.setPbf(n.bt);class Vt{constructor(te){this._mrt=new n.bs(te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=te.uid,this.tileID=te.tileID,this.source=te.source}parse(te,pe){const ze=this._mrt;this.status="parsing",this._entireBuffer=te;try{ze.parseHeader(te),this._isHeaderLoaded=!0;const et=[];for(const Xe in ze.layers){const rt=ze.getLayer(Xe),wt=rt.getDataRange(rt.getBandList()),ot=ze.createDecodingTask(wt),At=te.slice(wt.firstByte,wt.lastByte+1),ti=n.bs.performDecoding(At,ot).then((qt=>ot.complete(null,qt))).catch((qt=>ot.complete(qt,null)));et.push(ti)}Promise.allSettled(et).then((()=>pe(null,ze))).catch((Xe=>pe(Xe)))}catch(et){pe(et)}}}class Hi{constructor(te){this.actor=te,this.loading={},this.loaded={}}loadTile(te,pe){const ze=te.uid,et=te.request,Xe=this.loading[ze]=new Vt(te),{cancel:rt}=n.bu(et,((wt,ot,At)=>{const ti=!this.loading[ze];if(delete this.loading[ze],ti||wt||!ot)return Xe.status="done",ti||(this.loaded[ze]=Xe),pe(wt);Xe.parse(ot,((qt,Yi)=>{if(qt||!Yi)return pe(qt);pe(null,Yi,At)})),this.loaded[ze]=Xe}));Xe.abort=rt}reloadTile(te,pe){pe(null,void 0)}abortTile(te,pe){const ze=te.uid,et=this.loading[ze];et&&(et.abort&&et.abort(),delete this.loading[ze]),pe()}removeTile(te,pe){const ze=te.uid;this.loaded[ze]&&delete this.loaded[ze],pe()}decodeRasterArray(te,pe){n.bs.performDecoding(te.buffer,te.task).then((ze=>pe(null,ze))).catch((ze=>pe(ze)))}}const dn=n.fB.prototype.toGeoJSON;class Ui{constructor(te){this._feature=te,this.extent=n.al,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const pe of this._feature.geometry)te.push([new n.P(pe[0],pe[1])]);return te}{const te=[];for(const pe of this._feature.geometry){const ze=[];for(const et of pe)ze.push(new n.P(et[0],et[1]));te.push(ze)}return te}}toGeoJSON(te,pe,ze){return dn.call(this,te,pe,ze)}}class an{constructor(te,pe){this.name=te,this.extent=n.al,this.length=pe.length,this._jsonFeatures=pe}feature(te){return new Ui(this._jsonFeatures[te])}}class Hr{constructor(te){this.layers={},this.extent=n.al;for(const pe of Object.keys(te))this.layers[pe]=new an(pe,te[pe])}}const Qr=64/4096,ui=128;class Si{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],pe){for(const ze of te){const et=ze.id;if(et==null)continue;let Xe=this.features.get(et);Xe&&this.updateCache(Xe,pe),ze.geometry?(Xe=Rn(ze),this.updateCache(Xe,pe),this.features.set(et,Xe)):this.features.delete(et),this.updateCache(Xe,pe)}}updateCache(te,pe){for(const{canonical:ze,uid:et}of Object.values(pe)){const{z:Xe,x:rt,y:wt}=ze;yn(te,Math.pow(2,Xe),rt,wt)&&delete pe[et]}}getTile(te,pe,ze){const et=Math.pow(2,te),Xe=[];for(const rt of this.features.values())yn(rt,et,pe,ze)&&Xe.push(ai(rt,et,pe,ze));return{features:Xe}}getFeatures(){return[...this.features.values()]}}function yn({minX:lt,minY:te,maxX:pe,maxY:ze},et,Xe,rt){return lt<(Xe+1+Qr)/et&&te<(rt+1+Qr)/et&&pe>(Xe-Qr)/et&&ze>(rt-Qr)/et}function Rn(lt){const{id:te,geometry:pe,properties:ze}=lt;if(!pe)return;if(pe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:et,coordinates:Xe}=pe,rt={id:te,type:1,geometry:[],tags:ze,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},wt=rt.geometry;if(et==="Point")wr(Xe,wt,rt);else if(et==="MultiPoint")for(const ot of Xe)wr(ot,wt,rt);else if(et==="LineString")rt.type=2,Tt(Xe,wt,rt);else if(et==="MultiLineString")rt.type=2,jt(Xe,wt,rt);else if(et==="Polygon")rt.type=3,jt(Xe,wt,rt,!0);else{if(et!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");rt.type=3;for(const ot of Xe)jt(ot,wt,rt,!0)}return rt}function wr([lt,te],pe,ze){const et=n.aF(lt);let Xe=n.aJ(te);Xe=Xe<0?0:Xe>1?1:Xe,pe.push(et,Xe),ze.minX=Math.min(ze.minX,et),ze.minY=Math.min(ze.minY,Xe),ze.maxX=Math.max(ze.maxX,et),ze.maxY=Math.max(ze.maxY,Xe)}function Tt(lt,te,pe,ze=!1,et=!1){const Xe=[];for(const rt of lt)wr(rt,Xe,pe);te.push(Xe),ze&&(function(rt,wt){let ot=0;for(let At=0,ti=rt.length,qt=ti-2;At<ti;qt=At,At+=2)ot+=(rt[At]-rt[qt])*(rt[At+1]+rt[qt+1]);if(ot>0===wt)for(let At=0,ti=rt.length;At<ti/2;At+=2){const qt=rt[At],Yi=rt[At+1];rt[At]=rt[ti-2-At],rt[At+1]=rt[ti-1-At],rt[ti-2-At]=qt,rt[ti-1-At]=Yi}})(Xe,et)}function jt(lt,te,pe,ze=!1){for(let et=0;et<lt.length;et++)Tt(lt[et],te,pe,ze,et===0)}function ai(lt,te,pe,ze){const{id:et,type:Xe,geometry:rt,tags:wt}=lt,ot=[];if(Xe===1)(function(At,ti,qt,Yi,Ki){for(let Bi=0;Bi<At.length;Bi+=2){const dr=Math.round(n.al*(At[Bi+0]*ti-qt)),$n=Math.round(n.al*(At[Bi+1]*ti-Yi));Ki.push([dr,$n])}})(rt,te,pe,ze,ot);else if(Xe===2)for(const At of rt)ln(At,te,pe,ze,ot);else if(Xe===3)for(const At of rt)Jn(At,te,pe,ze,ot);return{id:et,type:Xe,geometry:ot,tags:wt}}function ln(lt,te,pe,ze,et){const Xe=-ui,rt=n.al+ui;let wt;for(let ot=0;ot<lt.length-2;ot+=2){let At=Math.round(n.al*(lt[ot+0]*te-pe)),ti=Math.round(n.al*(lt[ot+1]*te-ze)),qt=Math.round(n.al*(lt[ot+2]*te-pe)),Yi=Math.round(n.al*(lt[ot+3]*te-ze));const Ki=qt-At,Bi=Yi-ti;At<Xe&&qt<Xe||(At<Xe?(ti+=Math.round(Bi*((Xe-At)/Ki)),At=Xe):qt<Xe&&(Yi=ti+Math.round(Bi*((Xe-At)/Ki)),qt=Xe),ti<Xe&&Yi<Xe||(ti<Xe?(At+=Math.round(Ki*((Xe-ti)/Bi)),ti=Xe):Yi<Xe&&(qt=At+Math.round(Ki*((Xe-ti)/Bi)),Yi=Xe),At>=rt&&qt>=rt||(At>=rt?(ti+=Math.round(Bi*((rt-At)/Ki)),At=rt):qt>=rt&&(Yi=ti+Math.round(Bi*((rt-At)/Ki)),qt=rt),ti>=rt&&Yi>=rt||(ti>=rt?(At+=Math.round(Ki*((rt-ti)/Bi)),ti=rt):Yi>=rt&&(qt=At+Math.round(Ki*((rt-ti)/Bi)),Yi=rt),wt&&At===wt[wt.length-1][0]&&ti===wt[wt.length-1][1]||(wt=[[At,ti]],et.push(wt)),wt.push([qt,Yi])))))}}function Jn(lt,te,pe,ze,et){const Xe=(pe-Qr)/te,rt=(ze-Qr)/te,wt=(pe+1+Qr)/te,ot=(ze+1+Qr)/te;function At(Yi,Ki){let Bi=0;return Yi<Xe?Bi|=1:Yi>wt&&(Bi|=2),Ki<rt?Bi|=4:Ki>ot&&(Bi|=8),Bi}let ti=[];for(let Yi=1;Yi<=8;Yi*=2){let Ki=lt[lt.length-2],Bi=lt[lt.length-1],dr=!(At(Ki,Bi)&Yi);for(let $n=0;$n<lt.length;$n+=2){const Nn=lt[$n],Ur=lt[$n+1],La=!(At(Nn,Ur)&Yi);La!==dr&&(8&Yi?ti.push(Ki+(Nn-Ki)*(ot-Bi)/(Ur-Bi),ot):4&Yi?ti.push(Ki+(Nn-Ki)*(rt-Bi)/(Ur-Bi),rt):2&Yi?ti.push(wt,Bi+(Ur-Bi)*(wt-Ki)/(Nn-Ki)):1&Yi&&ti.push(Xe,Bi+(Ur-Bi)*(Xe-Ki)/(Nn-Ki))),La&&ti.push(Nn,Ur),Ki=Nn,Bi=Ur,dr=La}if(!(lt=ti).length||Yi===8)break;ti=[]}const qt=[];for(let Yi=0;Yi<ti.length;Yi+=2)qt.push([Math.round(n.al*(ti[Yi]*te-pe)),Math.round(n.al*(ti[Yi+1]*te-ze))]);et.push(qt)}function _r({name:lt,features:te},pe){pe.writeStringField(1,lt),pe.writeVarintField(5,n.al);const ze=new Map,et=new Map,Xe={keys:ze,values:et,feature:null};for(const rt of te)Xe.feature=rt,pe.writeMessage(2,Mr,Xe);for(const rt of ze.keys())pe.writeStringField(3,rt);for(const rt of et.keys())pe.writeMessage(4,Fa,rt)}function Mr(lt,te){const pe=lt.feature;pe.id!==void 0&&Number.isSafeInteger(+pe.id)&&te.writeVarintField(1,+pe.id),pe.tags&&te.writeMessage(2,pr,lt),te.writeVarintField(3,pe.type),te.writeMessage(4,Ir,pe)}function pr({keys:lt,values:te,feature:pe},ze){for(const et of Object.keys(pe.tags)){let Xe=pe.tags[et];if(Xe===null)continue;let rt=lt.get(et);rt===void 0&&(rt=lt.size,lt.set(et,rt)),ze.writeVarint(rt);const wt=typeof Xe;wt!=="string"&&wt!=="boolean"&&wt!=="number"&&(Xe=JSON.stringify(Xe));let ot=te.get(Xe);ot===void 0&&(ot=te.size,te.set(Xe,ot)),ze.writeVarint(ot)}}function Cn(lt,te){return(te<<3)+(7&lt)}function Cr(lt){return lt<<1^lt>>31}function Ir(lt,te){const{geometry:pe,type:ze}=lt;let et=0,Xe=0;if(ze===1){te.writeVarint(Cn(1,pe.length));for(const rt of pe){const wt=rt[0]-et,ot=rt[1]-Xe;te.writeVarint(Cr(wt)),te.writeVarint(Cr(ot)),et+=wt,Xe+=ot}}else for(const rt of pe){te.writeVarint(Cn(1,1));const wt=rt.length-(ze===3?1:0);for(let ot=0;ot<wt;ot++){ot===1&&te.writeVarint(Cn(2,wt-1));const At=rt[ot][0]-et,ti=rt[ot][1]-Xe;te.writeVarint(Cr(At)),te.writeVarint(Cr(ti)),et+=At,Xe+=ti}ze===3&&te.writeVarint(Cn(7,1))}}function Fa(lt,te){const pe=typeof lt;pe==="string"?te.writeStringField(1,lt):pe==="boolean"?te.writeBooleanField(7,lt):pe==="number"&&(lt%1!=0?te.writeDoubleField(3,lt):lt<0?te.writeSVarintField(6,lt):te.writeVarintField(5,lt))}const ra={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:lt=>lt},Aa=Math.fround||(Da=new Float32Array(1),lt=>(Da[0]=+lt,Da[0]));var Da;const Yt=3,Ha=5,zr=6;class Dr{constructor(te){this.options=Object.assign(Object.create(ra),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:pe,minZoom:ze,maxZoom:et}=this.options;pe&&console.time("total time");const Xe=`prepare ${te.length} points`;pe&&console.time(Xe),this.points=te;const rt=[];for(let ot=0;ot<te.length;ot++){const At=te[ot];if(!At.geometry)continue;const[ti,qt]=At.geometry.coordinates,Yi=Aa(ho(ti)),Ki=Aa(Vo(qt));rt.push(Yi,Ki,1/0,ot,-1,1),this.options.reduce&&rt.push(0)}let wt=this.trees[et+1]=this._createTree(rt);pe&&console.timeEnd(Xe);for(let ot=et;ot>=ze;ot--){const At=+Date.now();wt=this.trees[ot]=this._createTree(this._cluster(wt,ot)),pe&&console.log("z%d: %d clusters in %dms",ot,wt.numItems,+Date.now()-At)}return pe&&console.timeEnd("total time"),this}getClusters(te,pe){let ze=((te[0]+180)%360+360)%360-180;const et=Math.max(-90,Math.min(90,te[1]));let Xe=te[2]===180?180:((te[2]+180)%360+360)%360-180;const rt=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)ze=-180,Xe=180;else if(ze>Xe){const qt=this.getClusters([ze,et,180,rt],pe),Yi=this.getClusters([-180,et,Xe,rt],pe);return qt.concat(Yi)}const wt=this.trees[this._limitZoom(pe)],ot=wt.range(ho(ze),Vo(rt),ho(Xe),Vo(et)),At=wt.data,ti=[];for(const qt of ot){const Yi=this.stride*qt;ti.push(At[Yi+Ha]>1?ma(At,Yi,this.clusterProps):this.points[At[Yi+Yt]])}return ti}getChildren(te){const pe=this._getOriginId(te),ze=this._getOriginZoom(te),et="No cluster with the specified id.",Xe=this.trees[ze];if(!Xe)throw new Error(et);const rt=Xe.data;if(pe*this.stride>=rt.length)throw new Error(et);const wt=this.options.radius/(this.options.extent*Math.pow(2,ze-1)),ot=Xe.within(rt[pe*this.stride],rt[pe*this.stride+1],wt),At=[];for(const ti of ot){const qt=ti*this.stride;rt[qt+4]===te&&At.push(rt[qt+Ha]>1?ma(rt,qt,this.clusterProps):this.points[rt[qt+Yt]])}if(At.length===0)throw new Error(et);return At}getLeaves(te,pe,ze){const et=[];return this._appendLeaves(et,te,pe=pe||10,ze=ze||0,0),et}getTile(te,pe,ze){const et=this.trees[this._limitZoom(te)],Xe=Math.pow(2,te),{extent:rt,radius:wt}=this.options,ot=wt/rt,At=(ze-ot)/Xe,ti=(ze+1+ot)/Xe,qt={features:[]};return this._addTileFeatures(et.range((pe-ot)/Xe,At,(pe+1+ot)/Xe,ti),et.data,pe,ze,Xe,qt),pe===0&&this._addTileFeatures(et.range(1-ot/Xe,At,1,ti),et.data,Xe,ze,Xe,qt),pe===Xe-1&&this._addTileFeatures(et.range(0,At,ot/Xe,ti),et.data,-1,ze,Xe,qt),qt.features.length?qt:null}getClusterExpansionZoom(te){let pe=this._getOriginZoom(te)-1;for(;pe<=this.options.maxZoom;){const ze=this.getChildren(te);if(pe++,ze.length!==1)break;te=ze[0].properties.cluster_id}return pe}_appendLeaves(te,pe,ze,et,Xe){const rt=this.getChildren(pe);for(const wt of rt){const ot=wt.properties;if(ot&&ot.cluster?Xe+ot.point_count<=et?Xe+=ot.point_count:Xe=this._appendLeaves(te,ot.cluster_id,ze,et,Xe):Xe<et?Xe++:te.push(wt),te.length===ze)break}return Xe}_createTree(te){const pe=new n.c4(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ze=0;ze<te.length;ze+=this.stride)pe.add(te[ze],te[ze+1]);return pe.finish(),pe.data=te,pe}_addTileFeatures(te,pe,ze,et,Xe,rt){for(const wt of te){const ot=wt*this.stride,At=pe[ot+Ha]>1;let ti,qt,Yi;if(At)ti=rl(pe,ot,this.clusterProps),qt=pe[ot],Yi=pe[ot+1];else{const dr=this.points[pe[ot+Yt]];ti=dr.properties;const[$n,Nn]=dr.geometry.coordinates;qt=ho($n),Yi=Vo(Nn)}const Ki={type:1,geometry:[[Math.round(this.options.extent*(qt*Xe-ze)),Math.round(this.options.extent*(Yi*Xe-et))]],tags:ti};let Bi;Bi=At||this.options.generateId?pe[ot+Yt]:this.points[pe[ot+Yt]].id,Bi!==void 0&&(Ki.id=Bi),rt.features.push(Ki)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,pe){const{radius:ze,extent:et,reduce:Xe,minPoints:rt}=this.options,wt=ze/(et*Math.pow(2,pe)),ot=te.data,At=[],ti=this.stride;for(let qt=0;qt<ot.length;qt+=ti){if(ot[qt+2]<=pe)continue;ot[qt+2]=pe;const Yi=ot[qt],Ki=ot[qt+1],Bi=te.within(ot[qt],ot[qt+1],wt),dr=ot[qt+Ha];let $n=dr;for(const Nn of Bi){const Ur=Nn*ti;ot[Ur+2]>pe&&($n+=ot[Ur+Ha])}if($n>dr&&$n>=rt){let Nn,Ur=Yi*dr,La=Ki*dr,Ja=-1;const ss=(qt/ti<<5)+(pe+1)+this.points.length;for(const js of Bi){const ea=js*ti;if(ot[ea+2]<=pe)continue;ot[ea+2]=pe;const jr=ot[ea+Ha];Ur+=ot[ea]*jr,La+=ot[ea+1]*jr,ot[ea+4]=ss,Xe&&(Nn||(Nn=this._map(ot,qt,!0),Ja=this.clusterProps.length,this.clusterProps.push(Nn)),Xe(Nn,this._map(ot,ea)))}ot[qt+4]=ss,At.push(Ur/$n,La/$n,1/0,ss,-1,$n),Xe&&At.push(Ja)}else{for(let Nn=0;Nn<ti;Nn++)At.push(ot[qt+Nn]);if($n>1)for(const Nn of Bi){const Ur=Nn*ti;if(!(ot[Ur+2]<=pe)){ot[Ur+2]=pe;for(let La=0;La<ti;La++)At.push(ot[Ur+La])}}}}return At}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,pe,ze){if(te[pe+Ha]>1){const rt=this.clusterProps[te[pe+zr]];return ze?Object.assign({},rt):rt}const et=this.points[te[pe+Yt]].properties,Xe=this.options.map(et);return ze&&Xe===et?Object.assign({},Xe):Xe}}function ma(lt,te,pe){return{type:"Feature",id:lt[te+Yt],properties:rl(lt,te,pe),geometry:{type:"Point",coordinates:[(ze=lt[te],360*(ze-.5)),la(lt[te+1])]}};var ze}function rl(lt,te,pe){const ze=lt[te+Ha],et=ze>=1e4?`${Math.round(ze/1e3)}k`:ze>=1e3?Math.round(ze/100)/10+"k":ze,Xe=lt[te+zr],rt=Xe===-1?{}:Object.assign({},pe[Xe]);return Object.assign(rt,{cluster:!0,cluster_id:lt[te+Yt],point_count:ze,point_count_abbreviated:et})}function ho(lt){return lt/360+.5}function Vo(lt){const te=Math.sin(lt*Math.PI/180),pe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return pe<0?0:pe>1?1:pe}function la(lt){const te=(180-360*lt)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Vs(lt,te,pe,ze){let et=ze;const Xe=te+(pe-te>>1);let rt,wt=pe-te;const ot=lt[te],At=lt[te+1],ti=lt[pe],qt=lt[pe+1];for(let Yi=te+3;Yi<pe;Yi+=3){const Ki=qs(lt[Yi],lt[Yi+1],ot,At,ti,qt);if(Ki>et)rt=Yi,et=Ki;else if(Ki===et){const Bi=Math.abs(Yi-Xe);Bi<wt&&(rt=Yi,wt=Bi)}}et>ze&&(rt-te>3&&Vs(lt,te,rt,ze),lt[rt+2]=et,pe-rt>3&&Vs(lt,rt,pe,ze))}function qs(lt,te,pe,ze,et,Xe){let rt=et-pe,wt=Xe-ze;if(rt!==0||wt!==0){const ot=((lt-pe)*rt+(te-ze)*wt)/(rt*rt+wt*wt);ot>1?(pe=et,ze=Xe):ot>0&&(pe+=rt*ot,ze+=wt*ot)}return rt=lt-pe,wt=te-ze,rt*rt+wt*wt}function Us(lt,te,pe,ze){const et={id:lt??null,type:te,geometry:pe,tags:ze,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")cn(et,pe);else if(te==="Polygon")cn(et,pe[0]);else if(te==="MultiLineString")for(const Xe of pe)cn(et,Xe);else if(te==="MultiPolygon")for(const Xe of pe)cn(et,Xe[0]);return et}function cn(lt,te){for(let pe=0;pe<te.length;pe+=3)lt.minX=Math.min(lt.minX,te[pe]),lt.minY=Math.min(lt.minY,te[pe+1]),lt.maxX=Math.max(lt.maxX,te[pe]),lt.maxY=Math.max(lt.maxY,te[pe+1])}function Ws(lt,te,pe,ze){if(!te.geometry)return;const et=te.geometry.coordinates;if(et&&et.length===0)return;const Xe=te.geometry.type,rt=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2);let wt=[],ot=te.id;if(pe.promoteId?ot=te.properties[pe.promoteId]:pe.generateId&&(ot=ze||0),Xe==="Point")To(et,wt);else if(Xe==="MultiPoint")for(const At of et)To(At,wt);else if(Xe==="LineString")Do(et,wt,rt,!1);else if(Xe==="MultiLineString"){if(pe.lineMetrics){for(const At of et)wt=[],Do(At,wt,rt,!1),lt.push(Us(ot,"LineString",wt,te.properties));return}So(et,wt,rt,!1)}else if(Xe==="Polygon")So(et,wt,rt,!0);else{if(Xe!=="MultiPolygon"){if(Xe==="GeometryCollection"){for(const At of te.geometry.geometries)Ws(lt,{id:ot,geometry:At,properties:te.properties},pe,ze);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const At of et){const ti=[];So(At,ti,rt,!0),wt.push(ti)}}lt.push(Us(ot,Xe,wt,te.properties))}function To(lt,te){te.push(Sn(lt[0]),tr(lt[1]),0)}function Do(lt,te,pe,ze){let et,Xe,rt=0;for(let ot=0;ot<lt.length;ot++){const At=Sn(lt[ot][0]),ti=tr(lt[ot][1]);te.push(At,ti,0),ot>0&&(rt+=ze?(et*ti-At*Xe)/2:Math.sqrt(Math.pow(At-et,2)+Math.pow(ti-Xe,2))),et=At,Xe=ti}const wt=te.length-3;te[2]=1,Vs(te,0,wt,pe),te[wt+2]=1,te.size=Math.abs(rt),te.start=0,te.end=te.size}function So(lt,te,pe,ze){for(let et=0;et<lt.length;et++){const Xe=[];Do(lt[et],Xe,pe,ze),te.push(Xe)}}function Sn(lt){return lt/360+.5}function tr(lt){const te=Math.sin(lt*Math.PI/180),pe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return pe<0?0:pe>1?1:pe}function ar(lt,te,pe,ze,et,Xe,rt,wt){if(ze/=te,Xe>=(pe/=te)&&rt<ze)return lt;if(rt<pe||Xe>=ze)return null;const ot=[];for(const At of lt){const ti=At.geometry;let qt=At.type;const Yi=et===0?At.minX:At.minY,Ki=et===0?At.maxX:At.maxY;if(Yi>=pe&&Ki<ze){ot.push(At);continue}if(Ki<pe||Yi>=ze)continue;let Bi=[];if(qt==="Point"||qt==="MultiPoint")Hs(ti,Bi,pe,ze,et);else if(qt==="LineString")pl(ti,Bi,pe,ze,et,!1,wt.lineMetrics);else if(qt==="MultiLineString")ml(ti,Bi,pe,ze,et,!1);else if(qt==="Polygon")ml(ti,Bi,pe,ze,et,!0);else if(qt==="MultiPolygon")for(const dr of ti){const $n=[];ml(dr,$n,pe,ze,et,!0),$n.length&&Bi.push($n)}if(Bi.length){if(wt.lineMetrics&&qt==="LineString"){for(const dr of Bi)ot.push(Us(At.id,qt,dr,At.tags));continue}qt!=="LineString"&&qt!=="MultiLineString"||(Bi.length===1?(qt="LineString",Bi=Bi[0]):qt="MultiLineString"),qt!=="Point"&&qt!=="MultiPoint"||(qt=Bi.length===3?"Point":"MultiPoint"),ot.push(Us(At.id,qt,Bi,At.tags))}}return ot.length?ot:null}function Hs(lt,te,pe,ze,et){for(let Xe=0;Xe<lt.length;Xe+=3){const rt=lt[Xe+et];rt>=pe&&rt<=ze&&Uo(te,lt[Xe],lt[Xe+1],lt[Xe+2])}}function pl(lt,te,pe,ze,et,Xe,rt){let wt=Xr(lt);const ot=et===0?lc:ul;let At,ti,qt=lt.start;for(let $n=0;$n<lt.length-3;$n+=3){const Nn=lt[$n],Ur=lt[$n+1],La=lt[$n+2],Ja=lt[$n+3],ss=lt[$n+4],js=et===0?Nn:Ur,ea=et===0?Ja:ss;let jr=!1;rt&&(At=Math.sqrt(Math.pow(Nn-Ja,2)+Math.pow(Ur-ss,2))),js<pe?ea>pe&&(ti=ot(wt,Nn,Ur,Ja,ss,pe),rt&&(wt.start=qt+At*ti)):js>ze?ea<ze&&(ti=ot(wt,Nn,Ur,Ja,ss,ze),rt&&(wt.start=qt+At*ti)):Uo(wt,Nn,Ur,La),ea<pe&&js>=pe&&(ti=ot(wt,Nn,Ur,Ja,ss,pe),jr=!0),ea>ze&&js<=ze&&(ti=ot(wt,Nn,Ur,Ja,ss,ze),jr=!0),!Xe&&jr&&(rt&&(wt.end=qt+At*ti),te.push(wt),wt=Xr(lt)),rt&&(qt+=At)}let Yi=lt.length-3;const Ki=lt[Yi],Bi=lt[Yi+1],dr=et===0?Ki:Bi;dr>=pe&&dr<=ze&&Uo(wt,Ki,Bi,lt[Yi+2]),Yi=wt.length-3,Xe&&Yi>=3&&(wt[Yi]!==wt[0]||wt[Yi+1]!==wt[1])&&Uo(wt,wt[0],wt[1],wt[2]),wt.length&&te.push(wt)}function Xr(lt){const te=[];return te.size=lt.size,te.start=lt.start,te.end=lt.end,te}function ml(lt,te,pe,ze,et,Xe){for(const rt of lt)pl(rt,te,pe,ze,et,Xe,!1)}function Uo(lt,te,pe,ze){lt.push(te,pe,ze)}function lc(lt,te,pe,ze,et,Xe){const rt=(Xe-te)/(ze-te);return Uo(lt,Xe,pe+(et-pe)*rt,1),rt}function ul(lt,te,pe,ze,et,Xe){const rt=(Xe-pe)/(et-pe);return Uo(lt,te+(ze-te)*rt,Xe,1),rt}function dt(lt,te){const pe=[];for(let ze=0;ze<lt.length;ze++){const et=lt[ze],Xe=et.type;let rt;if(Xe==="Point"||Xe==="MultiPoint"||Xe==="LineString")rt=Ce(et.geometry,te);else if(Xe==="MultiLineString"||Xe==="Polygon"){rt=[];for(const wt of et.geometry)rt.push(Ce(wt,te))}else if(Xe==="MultiPolygon"){rt=[];for(const wt of et.geometry){const ot=[];for(const At of wt)ot.push(Ce(At,te));rt.push(ot)}}pe.push(Us(et.id,Xe,rt,et.tags))}return pe}function Ce(lt,te){const pe=[];pe.size=lt.size,lt.start!==void 0&&(pe.start=lt.start,pe.end=lt.end);for(let ze=0;ze<lt.length;ze+=3)pe.push(lt[ze]+te,lt[ze+1],lt[ze+2]);return pe}function Re(lt,te){if(lt.transformed)return lt;const pe=1<<lt.z,ze=lt.x,et=lt.y;for(const Xe of lt.features){const rt=Xe.geometry,wt=Xe.type;if(Xe.geometry=[],wt===1)for(let ot=0;ot<rt.length;ot+=2)Xe.geometry.push(Qe(rt[ot],rt[ot+1],te,pe,ze,et));else for(let ot=0;ot<rt.length;ot++){const At=[];for(let ti=0;ti<rt[ot].length;ti+=2)At.push(Qe(rt[ot][ti],rt[ot][ti+1],te,pe,ze,et));Xe.geometry.push(At)}}return lt.transformed=!0,lt}function Qe(lt,te,pe,ze,et,Xe){return[Math.round(pe*(lt*ze-et)),Math.round(pe*(te*ze-Xe))]}function mt(lt,te,pe,ze,et){const Xe=te===et.maxZoom?0:et.tolerance/((1<<te)*et.extent),rt={features:[],numPoints:0,numSimplified:0,numFeatures:lt.length,source:null,x:pe,y:ze,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const wt of lt)Nt(rt,wt,Xe,et);return rt}function Nt(lt,te,pe,ze){const et=te.geometry,Xe=te.type,rt=[];if(lt.minX=Math.min(lt.minX,te.minX),lt.minY=Math.min(lt.minY,te.minY),lt.maxX=Math.max(lt.maxX,te.maxX),lt.maxY=Math.max(lt.maxY,te.maxY),Xe==="Point"||Xe==="MultiPoint")for(let wt=0;wt<et.length;wt+=3)rt.push(et[wt],et[wt+1]),lt.numPoints++,lt.numSimplified++;else if(Xe==="LineString")je(rt,et,lt,pe,!1,!1);else if(Xe==="MultiLineString"||Xe==="Polygon")for(let wt=0;wt<et.length;wt++)je(rt,et[wt],lt,pe,Xe==="Polygon",wt===0);else if(Xe==="MultiPolygon")for(let wt=0;wt<et.length;wt++){const ot=et[wt];for(let At=0;At<ot.length;At++)je(rt,ot[At],lt,pe,!0,At===0)}if(rt.length){let wt=te.tags||null;if(Xe==="LineString"&&ze.lineMetrics){wt={};for(const At in te.tags)wt[At]=te.tags[At];wt.mapbox_clip_start=et.start/et.size,wt.mapbox_clip_end=et.end/et.size}const ot={geometry:rt,type:Xe==="Polygon"||Xe==="MultiPolygon"?3:Xe==="LineString"||Xe==="MultiLineString"?2:1,tags:wt};te.id!==null&&(ot.id=te.id),lt.features.push(ot)}}function je(lt,te,pe,ze,et,Xe){const rt=ze*ze;if(ze>0&&te.size<(et?rt:ze))return void(pe.numPoints+=te.length/3);const wt=[];for(let ot=0;ot<te.length;ot+=3)(ze===0||te[ot+2]>rt)&&(pe.numSimplified++,wt.push(te[ot],te[ot+1])),pe.numPoints++;et&&(function(ot,At){let ti=0;for(let qt=0,Yi=ot.length,Ki=Yi-2;qt<Yi;Ki=qt,qt+=2)ti+=(ot[qt]-ot[Ki])*(ot[qt+1]+ot[Ki+1]);if(ti>0===At)for(let qt=0,Yi=ot.length;qt<Yi/2;qt+=2){const Ki=ot[qt],Bi=ot[qt+1];ot[qt]=ot[Yi-2-qt],ot[qt+1]=ot[Yi-1-qt],ot[Yi-2-qt]=Ki,ot[Yi-1-qt]=Bi}})(wt,Xe),lt.push(wt)}const ei={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Pt{constructor(te,pe){const ze=(pe=this.options=(function(Xe,rt){for(const wt in rt)Xe[wt]=rt[wt];return Xe})(Object.create(ei),pe)).debug;if(ze&&console.time("preprocess data"),pe.maxZoom<0||pe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(pe.promoteId&&pe.generateId)throw new Error("promoteId and generateId cannot be used together.");let et=(function(Xe,rt){const wt=[];if(Xe.type==="FeatureCollection")for(let ot=0;ot<Xe.features.length;ot++)Ws(wt,Xe.features[ot],rt,ot);else Ws(wt,Xe.type==="Feature"?Xe:{geometry:Xe},rt);return wt})(te,pe);this.tiles={},this.tileCoords=[],ze&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",pe.indexMaxZoom,pe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),et=(function(Xe,rt){const wt=rt.buffer/rt.extent;let ot=Xe;const At=ar(Xe,1,-1-wt,wt,0,-1,2,rt),ti=ar(Xe,1,1-wt,2+wt,0,-1,2,rt);return(At||ti)&&(ot=ar(Xe,1,-wt,1+wt,0,-1,2,rt)||[],At&&(ot=dt(At,1).concat(ot)),ti&&(ot=ot.concat(dt(ti,-1)))),ot})(et,pe),et.length&&this.splitTile(et,0,0,0),ze&&(et.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,pe,ze,et,Xe,rt,wt){const ot=[te,pe,ze,et],At=this.options,ti=At.debug;for(;ot.length;){et=ot.pop(),ze=ot.pop(),pe=ot.pop(),te=ot.pop();const qt=1<<pe,Yi=Di(pe,ze,et);let Ki=this.tiles[Yi];if(!Ki&&(ti>1&&console.time("creation"),Ki=this.tiles[Yi]=mt(te,pe,ze,et,At),this.tileCoords.push({z:pe,x:ze,y:et}),ti)){ti>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",pe,ze,et,Ki.numFeatures,Ki.numPoints,Ki.numSimplified),console.timeEnd("creation"));const jr=`z${pe}`;this.stats[jr]=(this.stats[jr]||0)+1,this.total++}if(Ki.source=te,Xe==null){if(pe===At.indexMaxZoom||Ki.numPoints<=At.indexMaxPoints)continue}else{if(pe===At.maxZoom||pe===Xe)continue;if(Xe!=null){const jr=Xe-pe;if(ze!==rt>>jr||et!==wt>>jr)continue}}if(Ki.source=null,te.length===0)continue;ti>1&&console.time("clipping");const Bi=.5*At.buffer/At.extent,dr=.5-Bi,$n=.5+Bi,Nn=1+Bi;let Ur=null,La=null,Ja=null,ss=null,js=ar(te,qt,ze-Bi,ze+$n,0,Ki.minX,Ki.maxX,At),ea=ar(te,qt,ze+dr,ze+Nn,0,Ki.minX,Ki.maxX,At);te=null,js&&(Ur=ar(js,qt,et-Bi,et+$n,1,Ki.minY,Ki.maxY,At),La=ar(js,qt,et+dr,et+Nn,1,Ki.minY,Ki.maxY,At),js=null),ea&&(Ja=ar(ea,qt,et-Bi,et+$n,1,Ki.minY,Ki.maxY,At),ss=ar(ea,qt,et+dr,et+Nn,1,Ki.minY,Ki.maxY,At),ea=null),ti>1&&console.timeEnd("clipping"),ot.push(Ur||[],pe+1,2*ze,2*et),ot.push(La||[],pe+1,2*ze,2*et+1),ot.push(Ja||[],pe+1,2*ze+1,2*et),ot.push(ss||[],pe+1,2*ze+1,2*et+1)}}getTile(te,pe,ze){te=+te,pe=+pe,ze=+ze;const et=this.options,{extent:Xe,debug:rt}=et;if(te<0||te>24)return null;const wt=1<<te,ot=Di(te,pe=pe+wt&wt-1,ze);if(this.tiles[ot])return Re(this.tiles[ot],Xe);rt>1&&console.log("drilling down to z%d-%d-%d",te,pe,ze);let At,ti=te,qt=pe,Yi=ze;for(;!At&&ti>0;)ti--,qt>>=1,Yi>>=1,At=this.tiles[Di(ti,qt,Yi)];return At&&At.source?(rt>1&&(console.log("found parent tile z%d-%d-%d",ti,qt,Yi),console.time("drilling down")),this.splitTile(At.source,ti,qt,Yi,te,pe,ze),rt>1&&console.timeEnd("drilling down"),this.tiles[ot]?Re(this.tiles[ot],Xe):null):null}}function Di(lt,te,pe){return 32*((1<<lt)*pe+te)+lt}function fi(lt,te){const pe=lt.tileID.canonical;if(!this._geoJSONIndex)return void te(null,null);const ze=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!ze)return void te(null,null);const et=At=>At.tags&&"3d_elevation_id"in At.tags&&"source"in At.tags&&At.tags.source==="elevation",Xe=ze.features.filter((At=>et(At)));let rt={_geojsonTileLayer:ze.features};Xe.length>0&&(rt={_geojsonTileLayer:ze.features.filter((At=>!et(At))),hd_road_elevation:Xe});const wt=new Hr(rt),ot=(function(At){const ti=new n.bt;for(const qt of Object.keys(At))ti.writeMessage(3,_r,{name:qt,features:At[qt]});return ti.finish()})(rt).buffer;te(null,{vectorTile:wt,rawData:ot})}class hi extends qi{constructor(te,pe,ze,et,Xe,rt,wt){super(te,pe,ze,et,Xe,fi,wt),rt&&(this.loadGeoJSON=rt),this._dynamicIndex=new Si}loadData(te,pe){const ze=te&&te.request,et=ze&&ze.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(te,((Xe,rt)=>{if(Xe||!rt)return pe(Xe);if(typeof rt!="object")return pe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const ot=n.U(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ot.result==="error")throw new Error(ot.value.map((At=>`${At.key}: ${At.message}`)).join(", "));rt.features=rt.features.filter((At=>ot.value.evaluate({zoom:0},At)))}te.dynamic?(rt.type==="Feature"&&(rt={type:"FeatureCollection",features:[rt]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(rt.features,this.loaded),te.cluster&&(rt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new Dr((function({superclusterOptions:ot,clusterProperties:At}){if(!At||!ot)return ot;const ti={},qt={},Yi={accumulated:null,zoom:0},Ki={properties:null},Bi=Object.keys(At);for(const dr of Bi){const[$n,Nn]=At[dr],Ur=n.U(Nn),La=n.U(typeof $n=="string"?[$n,["accumulated"],["get",dr]]:$n);ti[dr]=Ur.value,qt[dr]=La.value}return ot.map=dr=>{Ki.properties=dr;const $n={};for(const Nn of Bi)$n[Nn]=ti[Nn].evaluate(Yi,Ki);return $n},ot.reduce=(dr,$n)=>{Ki.properties=$n;for(const Nn of Bi)Yi.accumulated=dr[Nn],dr[Nn]=qt[Nn].evaluate(Yi,Ki)},ot})(te)).load(rt.features):te.dynamic?this._dynamicIndex:(function(ot,At){return new Pt(ot,At)})(rt,te.geojsonVtOptions)}catch(ot){return pe(ot)}const wt={};if(et){const ot=tt(ze);ot&&(wt.resourceTiming={},wt.resourceTiming[te.source]=JSON.parse(JSON.stringify(ot)))}pe(null,wt)}}))}reloadTile(te,pe){const ze=this.loaded;return ze&&ze[te.uid]?te.partial?pe(null,void 0):super.reloadTile(te,pe):this.loadTile(te,pe)}loadGeoJSON(te,pe){if(te.request)n.m(te.request,pe);else{if(typeof te.data!="string")return pe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return pe(null,JSON.parse(te.data))}catch{return pe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(te,pe){try{pe(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(ze){pe(ze)}}getClusterChildren(te,pe){try{pe(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(ze){pe(ze)}}getClusterLeaves(te,pe){try{pe(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(ze){pe(ze)}}}class kn{constructor(te,pe,ze){this.tileID=new n.aQ(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=pe,this.worldview=ze}parse(te,pe,ze,et){this.status="parsing";const Xe=new n.aQ(ze.tileID.overscaledZ,ze.tileID.wrap,ze.tileID.canonical.z,ze.tileID.canonical.x,ze.tileID.canonical.y),rt=[],wt=pe.familiesBySource[ze.source],ot=new n.fn(Xe,ze.promoteId);ot.bucketLayerIDs=[],ot.is3DTile=!0,n.fC(te).then((At=>{if(!At)return et(new Error("Could not parse tile"));const ti=At.json.extensionsUsed&&At.json.extensionsUsed.includes("MAPBOX_mesh_features")||At.json.asset.extras&&At.json.asset.extras.MAPBOX_mesh_features,qt=At.json.extensionsUsed&&At.json.extensionsUsed.includes("EXT_meshopt_compression"),Yi=new n.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ki in wt)for(const Bi of wt[Ki]){const dr=Bi[0];ot.bucketLayerIDs.push(Bi.map((Ur=>n.B(Ur.id,Ur.scope)))),dr.recalculate(Yi,[]);const $n=n.fD(At,1/n.d7(ze.tileID.canonical)),Nn=new n.fE(Bi,$n,Xe,ti,qt,this.brightness,ot,this.worldview);ti||(Nn.needsUpload=!0),rt.push(Nn),Nn.evaluate(dr)}this.status="done",et(null,{buckets:rt,featureIndex:ot,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((At=>et(new Error(At.message))))}}class hr{constructor(te,pe,ze,et,Xe,rt,wt,ot){this.actor=te,this.layerIndex=pe,this.availableImages=ze,this.availableModels=et,this.brightness=wt,this.loading={},this.loaded={},this.worldview=ot}loadTile(te,pe){const ze=te.uid,et=this.loading[ze]=new kn(te,this.brightness,this.worldview);n.bu(te.request,((Xe,rt)=>{const wt=!this.loading[ze];return delete this.loading[ze],wt||Xe?(et.status="done",wt||(this.loaded[ze]=et),pe(Xe)):rt&&rt.byteLength!==0?void et.parse(rt,this.layerIndex,te,((ot,At)=>{et.status="done",this.loaded=this.loaded||{},this.loaded[ze]=et,ot||!At?pe(ot):pe(null,At)})):(et.status="done",this.loaded[ze]=et,pe())}))}reloadTile(te,pe){const ze=this.loaded,et=te.uid;if(ze&&ze[et]){const Xe=ze[et];Xe.projection=te.projection,Xe.brightness=te.brightness;const rt=(wt,ot)=>{Xe.reloadCallback&&(delete Xe.reloadCallback,this.loadTile(te,pe)),pe(wt,ot)};Xe.status==="parsing"?Xe.reloadCallback=rt:Xe.status==="done"&&this.loadTile(te,pe)}}abortTile(te,pe){const ze=te.uid;this.loading[ze]&&delete this.loading[ze],pe()}removeTile(te,pe){const ze=this.loaded,et=te.uid;ze&&ze[et]&&delete ze[et],pe()}}class Tr{constructor(te){this.self=te,this.actor=new n.fG(te,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new n.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=n.cm({name:"mercator"}),this.workerSourceTypes={vector:qi,geojson:hi,"raster-dem":Ot,"raster-array":Hi,"batched-model":hr},this.workerSources={},this.self.registerWorkerSource=(pe,ze)=>{if(this.workerSourceTypes[pe])throw new Error(`Worker source with name "${pe}" already registered.`);this.workerSourceTypes[pe]=ze},this.self.registerRTLTextPlugin=pe=>{if(n.fH.isParsed())throw new Error("RTL text plugin already registered.");n.fH.setState({pluginStatus:n.fI.parsed,pluginURL:n.fH.getPluginURL()}),n.fH.applyArabicShaping=pe.applyArabicShaping,n.fH.processBidirectionalText=pe.processBidirectionalText,n.fH.processStyledBidirectionalText=pe.processStyledBidirectionalText;for(const ze of this.rtlPluginParsingListeners)ze(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(te,pe,ze){delete this.layerIndexes[te],delete this.availableImages[te],delete this.availableModels[te],delete this.workerSources[te],ze()}checkIfReady(te,pe,ze){ze()}setReferrer(te,pe){this.referrer=pe}spriteLoaded(te,pe){this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={});const{scope:ze,isLoaded:et}=pe;if(this.isSpriteLoaded[te][ze]=et,this.workerSources[te]&&this.workerSources[te][ze])for(const Xe in this.workerSources[te][ze]){const rt=this.workerSources[te][ze][Xe];for(const wt in rt){const ot=rt[wt];ot instanceof qi&&(ot.isSpriteLoaded=et,ot.fire(new n.z("isSpriteLoaded")))}}}setImages(te,pe,ze){this.availableImages[te]||(this.availableImages[te]={});const{scope:et,images:Xe}=pe;if(this.availableImages[te][et]=Xe,this.workerSources[te]&&this.workerSources[te][et]){for(const rt in this.workerSources[te][et]){const wt=this.workerSources[te][et][rt];for(const ot in wt)wt[ot].availableImages=Xe}ze()}else ze()}setModels(te,{scope:pe,models:ze},et){if(this.availableModels[te]||(this.availableModels[te]={}),this.availableModels[te][pe]=ze,this.workerSources[te]&&this.workerSources[te][pe]){for(const Xe in this.workerSources[te][pe]){const rt=this.workerSources[te][pe][Xe];for(const wt in rt)rt[wt].availableModels=ze}et()}else et()}setProjection(te,pe){this.projections[te]=n.cm(pe)}setBrightness(te,pe,ze){this.brightness=pe,ze()}setWorldview(te,pe,ze){this.worldview=pe,ze()}setLayers(te,pe,ze){this.getLayerIndex(te,pe.scope).replace(pe.layers,pe.options),ze()}updateLayers(te,pe,ze){this.getLayerIndex(te,pe.scope).update(pe.layers,pe.removedIds,pe.options),ze()}loadTile(te,pe,ze){pe.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,pe.type,pe.source,pe.scope).loadTile(pe,ze)}decodeRasterArray(te,pe,ze){this.getWorkerSource(te,pe.type,pe.source,pe.scope).decodeRasterArray(pe,ze)}reloadTile(te,pe,ze){pe.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,pe.type,pe.source,pe.scope).reloadTile(pe,ze)}abortTile(te,pe,ze){this.getWorkerSource(te,pe.type,pe.source,pe.scope).abortTile(pe,ze)}removeTile(te,pe,ze){this.getWorkerSource(te,pe.type,pe.source,pe.scope).removeTile(pe,ze)}removeSource(te,pe,ze){if(!(this.workerSources[te]&&this.workerSources[te][pe.scope]&&this.workerSources[te][pe.scope][pe.type]&&this.workerSources[te][pe.scope][pe.type][pe.source]))return;const et=this.workerSources[te][pe.scope][pe.type][pe.source];delete this.workerSources[te][pe.scope][pe.type][pe.source],et.removeSource!==void 0?et.removeSource(pe,ze):ze()}loadWorkerSource(te,pe,ze){try{this.self.importScripts(pe.url),ze()}catch(et){ze(et)}}syncRTLPluginState(te,pe,ze){if(n.fH.isParsed())ze(null,!0);else if(n.fH.isParsing())this.rtlPluginParsingListeners.push(ze);else try{n.fH.setState(pe);const et=n.fH.getPluginURL();!n.fH.isLoaded()||n.fH.isParsed()||n.fH.isParsing()||et==null||(n.fH.setState({pluginStatus:n.fI.parsing,pluginURL:n.fH.getPluginURL()}),this.self.importScripts(et),n.fH.isParsed()?ze(null,!0):this.rtlPluginParsingListeners.push(ze))}catch(et){ze(et)}}setDracoUrl(te,pe){this.dracoUrl=pe}getAvailableImages(te,pe){this.availableImages[te]||(this.availableImages[te]={});let ze=this.availableImages[te][pe];return ze||(ze=[]),ze}getAvailableModels(te,pe){this.availableModels[te]||(this.availableModels[te]={});let ze=this.availableModels[te][pe];return ze||(ze={}),ze}getLayerIndex(te,pe){this.layerIndexes[te]||(this.layerIndexes[te]={});let ze=this.layerIndexes[te][pe];return ze||(ze=this.layerIndexes[te][pe]=new ut,ze.scope=pe),ze}getWorkerSource(te,pe,ze,et){const Xe=this.workerSources;return Xe[te]||(Xe[te]={}),Xe[te][et]||(Xe[te][et]={}),Xe[te][et][pe]||(Xe[te][et][pe]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),Xe[te][et][pe][ze]||(Xe[te][et][pe][ze]=new this.workerSourceTypes[pe]({send:(rt,wt,ot,At,ti,qt)=>this.actor.send(rt,wt,ot,te,ti,qt),scheduler:this.actor.scheduler},this.getLayerIndex(te,et),this.getAvailableImages(te,et),this.getAvailableModels(te,et),this.isSpriteLoaded[te][et],void 0,this.brightness,this.worldview)),Xe[te][et][pe][ze]}rasterizeImagesWorker(te,pe,ze){const et=new Map;for(const[Xe,{image:rt,imageVariant:wt}]of pe.tasks.entries()){const ot=this.imageRasterizer.rasterize(wt,rt,pe.scope,te);et.set(Xe,ot)}ze(void 0,et)}removeRasterizedImages(te,pe,ze){this.imageRasterizer.removeImagesFromCacheByIds(pe.imageIds,pe.scope,te),ze()}enforceCacheSizeLimit(te,pe){n.fJ(pe)}getWorkerPerformanceMetrics(te,pe,ze){ze(void 0,void 0)}}return n.fF(self)&&(self.worker=new Tr(self)),Tr})),Pe(["./shared"],(function(n){var tt="3.17.0";const ke={create:"create",load:"load",fullLoad:"fullLoad"},Rt={mark(h){performance.mark(h)},measure(h,t,a){performance.measure(h,t,a)}};function ut(h){const t=h.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var bt,rn={},on=(function(){if(bt)return rn;function h(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,S,M=new Blob([""],{type:"text/javascript"}),R=URL.createObjectURL(M);try{S=new Worker(R),b=!0}catch{b=!1}return S&&S.terminate(),URL.revokeObjectURL(R),b})()?(function(){var b=document.createElement("canvas");b.width=b.height=1;var S=b.getContext("2d");if(!S)return!1;var M=S.getImageData(0,0,1,1);return M&&M.width===b.width})()?(a[y=d&&d.failIfMajorPerformanceCaveat]===void 0&&(a[y]=(function(b){var S,M=(function(R){var N=document.createElement("canvas"),U=Object.create(h.webGLContextAttributes);return U.failIfMajorPerformanceCaveat=R,N.getContext("webgl2",U)})(b);if(!M)return!1;try{S=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!S||M.isContextLost())&&(M.shaderSource(S,"void main() {}"),M.compileShader(S),M.getShaderParameter(S,M.COMPILE_STATUS)===!0)})(y)),a[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}bt=1,rn.supported=h,rn.notSupportedReason=t;var a={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},rn})();function Vi(h,t,a){const d=document.createElement(h);return t!=null&&(d.className=t),a&&a.appendChild(d),d}function Wi(h,t,a){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const y of Object.keys(t))d.setAttributeNS(null,y,String(t[y]));return a&&a.appendChild(d),d}const Tn=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ci=Tn&&Tn.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Ji;function Vn(){Tn&&Ci&&(Ji=Tn[Ci],Tn[Ci]="none")}function Oi(){Tn&&Ci&&(Tn[Ci]=Ji)}function Hn(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Hn,!0)}function qi(){window.addEventListener("click",Hn,!0),window.setTimeout((()=>{window.removeEventListener("click",Hn,!0)}),0)}function Ot(h,t){const a=h.getBoundingClientRect();return dn(h,a,t)}function Vt(h,t){const a=h.getBoundingClientRect(),d=[];for(let y=0;y<t.length;y++)d.push(dn(h,a,t[y]));return d}function Hi(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function dn(h,t,a){const d=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new n.P((a.clientX-t.left)*d,(a.clientY-t.top)*d)}const Ui="01",an="NO_ACCESS_TOKEN";class Hr{constructor(t,a,d){this._transformRequestFn=t,this._customAccessToken=a,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=(function(){let a="";for(let d=0;d<10;d++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ui,a].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}}normalizeStyleURL(t,a){if(!n.h(t))return t;const d=ui(t);return d.params.push(`sdk=js-${tt}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeGlyphsURL(t,a){if(!n.h(t))return t;const d=ui(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeModelURL(t,a){if(!n.h(t))return t;const d=ui(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||a)}normalizeSourceURL(t,a,d,y){if(!n.h(t))return t;const b=ui(t);return b.path=`/v4/${b.authority}.json`,b.params.push("secure"),d&&b.params.push(`language=${d}`),y&&b.params.push(`worldview=${y}`),this._makeAPIURL(b,this._customAccessToken||a)}normalizeIconsetURL(t,a){const d=ui(t);return n.h(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||a)):Si(d)}normalizeSpriteURL(t,a,d,y){const b=ui(t);return n.h(t)?(b.path=`/styles/v1${b.path}/sprite${a}${d}`,this._makeAPIURL(b,this._customAccessToken||y)):(b.path+=`${a}${d}`,Si(b))}normalizeTileURL(t,a,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.h(t))return t;const y=ui(t);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${a||d&&y.authority!=="raster"&&d===512?"@2x":""}${n.k.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${n.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${n.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${n.e.TILE_URL_VERSION}${y.path}`);const b=this._customAccessToken||(function(S){for(const M of S){const R=M.match(/^access_token=(.*)$/);if(R)return R[1]}return null})(y.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&b&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,b)}canonicalizeTileURL(t,a){const d=ui(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let y="mapbox://";d.path.match(/^\/raster\/v1\//)?y+=`raster/${d.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${d.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${d.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let b=d.params;return a&&(b=b.filter((S=>!S.match(/^access_token=/)))),b.length&&(y+=`?${b.join("&")}`),y}canonicalizeTileset(t,a){const d=!!a&&n.h(a),y=[];for(const b of t.tiles||[])n.j(b)?y.push(this.canonicalizeTileURL(b,d)):y.push(b);return y}_makeAPIURL(t,a){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=ui(n.e.API_URL);if(t.protocol=y.protocol,t.authority=y.authority,t.protocol==="http"){const b=t.params.indexOf("secure");b>=0&&t.params.splice(b,1)}if(y.path!=="/"&&(t.path=`${y.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return Si(t);if(a=a||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!a)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(a[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter((b=>b.indexOf("access_token")===-1)),t.params.push(`access_token=${a||""}`),Si(t)}}const Qr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ui(h){const t=h.match(Qr);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Si(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const yn="mapbox.eventData";function Rn(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.l(t[1]))}catch{return null}}class wr{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const a=Rn(n.e.ACCESS_TOKEN);let d="";return d=a&&a.u?n.f(a.u):n.e.ACCESS_TOKEN||"",t?`${yn}.${t}:${d}`:`${yn}:${d}`}fetchEventData(){const t=n.s("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp");if(t)try{const b=localStorage.getItem(a);b&&(this.eventData=JSON.parse(b));const S=localStorage.getItem(d);S&&(this.anonId=S);const M=localStorage.getItem(y);M&&(this.anonIdTimestamp=Number(M));const R=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<R)&&this.refreshUUID()}catch{n.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=n.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=n.s("localStorage"),a=this.getStorageKey(),d=this.getStorageKey("uuid"),y=this.getStorageKey("uuidTimestamp"),b=this.anonId,S=this.anonIdTimestamp;if(t&&b)try{localStorage.setItem(d,b),Object.keys(this.eventData).length>=1&&localStorage.setItem(a,JSON.stringify(this.eventData)),S&&localStorage.setItem(y,S.toString())}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,a,d,y){if(!n.e.EVENTS_URL)return;const b=ui(n.e.EVENTS_URL);b.params.push(`access_token=${y||n.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(t).toISOString()},M=a?Object.assign(S,a):S,R={url:Si(b),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};this.pendingRequest=n.p(R,(N=>{this.pendingRequest=null,d(N),this.saveEventData(),this.processRequests(y)}))}queueRequest(t,a){this.queue.push(t),this.processRequests(a)}}class Tt extends wr{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!n.e.EVENTS_URL||!t&&!n.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),n.v(this.anonId)||this.refreshUUID();const a=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:a},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:a,payload:d}=this.queue.shift();this.postEvent(a,d,(()=>{}),t)}}const jt=new class extends wr{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some((a=>n.h(a)||n.j(a)))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Rn(n.e.ACCESS_TOKEN),a=t?t.u:n.e.ACCESS_TOKEN;let d=a!==this.eventData.tokenU;n.v(this.anonId)||(this.refreshUUID(),d=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const b=new Date(this.eventData.lastSuccess),S=new Date(y),M=(y-this.eventData.lastSuccess)/864e5;d=d||M>=1||M<-1||b.getDate()!==S.getDate()}else d=!0;d?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:tt,skuId:Ui,"enabled.telemetry":!1,userId:this.anonId},(b=>{b||(this.eventData.lastSuccess=y,this.eventData.tokenU=a)}),h):this.processRequests()}},ai=jt.postTurnstileEvent.bind(jt),ln=new class extends wr{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,a,d){this.skuToken=t,this.errorCb=d,n.e.EVENTS_URL&&(a||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error(an)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),n.v(this.anonId)||this.refreshUUID(),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:tt,skuId:Ui,skuToken:this.skuToken,userId:this.anonId},(d=>{d?this.errorCb(d):t&&(this.success[t]=!0)}),h))}remove(){this.errorCb=null}},Jn=ln.postMapLoadEvent.bind(ln),_r=new class extends wr{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=n.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:a,style:d,importedStyles:y}=t;if(!n.e.EVENTS_URL||!h&&!n.e.ACCESS_TOKEN)return;const b=this.getMapInstanceId(a),S={mapInstanceId:b,eventId:this.getEventId(b),style:d};y.length&&(S.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:S},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:a}=this.queue.shift();this.postEvent(t,a,(()=>{}),h)}},Mr=_r.postStyleLoadEvent.bind(_r),pr=new Tt({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Cn=pr.postMetricsEvent.bind(pr),Cr=new Tt({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Ir=Cr.postMetricsEvent.bind(Cr),Fa=new class extends wr{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){n.e.EVENTS_URL&&(h||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:a}=this.queue.shift(),d=(function(y){const b=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),M=(function(Q){const ae={};if(Q){for(const ie in Q)if(ie!=="other")for(const _e of Q[ie]){const fe=`${ie}ResolveRangeMin`,Te=`${ie}ResolveRangeMax`,De=`${ie}RequestCount`,Se=`${ie}RequestCachedCount`;ae[fe]=Math.min(ae[fe]||1/0,_e.startTime),ae[Te]=Math.max(ae[Te]||-1/0,_e.responseEnd);const Ze=Ve=>{ae[Ve]===void 0&&(ae[Ve]=0),++ae[Ve]};_e.transferSize!==void 0&&_e.transferSize===0&&Ze(Se),Ze(De)}}return ae})((function(Q,ae){const ie={};if(Q)for(const _e of Q){const fe=ae(_e);ie[fe]===void 0&&(ie[fe]=[]),ie[fe].push(_e)}return ie})(b,ut)),R=window.devicePixelRatio,N=navigator.connection||navigator.mozConnection||navigator.webkitConnection,U=N?N.effectiveType:void 0,Y={counters:[],metadata:[],attributes:[]},X=(Q,ae,ie)=>{ie!=null&&Q.push({name:ae,value:ie.toString()})};for(const Q in M)X(Y.counters,Q,M[Q]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(X(Y.counters,"interactionRangeMin",y.interactionRange[0]),X(Y.counters,"interactionRangeMax",y.interactionRange[1])),S)for(const Q of Object.values(ke)){const ae=S.find((ie=>ie.name===Q));ae&&X(Y.counters,Q,ae.startTime)}return X(Y.counters,"visibilityHidden",y.visibilityHidden),X(Y.attributes,"style",(function(Q){if(Q)for(const ae of Q){const ie=ae.name.split("?")[0];if(n.i(ie)){const _e=ie.split("/").slice(-2);if(_e.length===2)return`mapbox://styles/${_e[0]}/${_e[1]}`}}})(b)),X(Y.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),X(Y.attributes,"fogEnabled",y.fogEnabled?"true":"false"),X(Y.attributes,"projection",y.projection),X(Y.attributes,"zoom",y.zoom),X(Y.metadata,"devicePixelRatio",R),X(Y.metadata,"connectionEffectiveType",U),X(Y.metadata,"navigatorUserAgent",navigator.userAgent),X(Y.metadata,"screenWidth",window.screen.width),X(Y.metadata,"screenHeight",window.screen.height),X(Y.metadata,"windowWidth",window.innerWidth),X(Y.metadata,"windowHeight",window.innerHeight),X(Y.metadata,"mapWidth",y.width/R),X(Y.metadata,"mapHeight",y.height/R),X(Y.metadata,"webglRenderer",y.renderer),X(Y.metadata,"webglVendor",y.vendor),X(Y.metadata,"sdkVersion",tt),X(Y.metadata,"sdkIdentifier","mapbox-gl-js"),Y})(a);for(const y of d.metadata);for(const y of d.counters);for(const y of d.attributes);this.postEvent(t,d,(()=>{}),h)}},ra=Fa.postPerformanceEvent.bind(Fa),Aa=new class extends wr{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,a,d){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const y=ui(n.e.API_URL+n.e.SESSION_PATH);y.params.push(`sku=${t||""}`),y.params.push(`access_token=${d||n.e.ACCESS_TOKEN||""}`);const b={url:Si(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(b,(S=>{this.pendingRequest=null,a(S),this.saveEventData(),this.processRequests(d)}))}getSessionAPI(h,t,a,d){this.skuToken=t,this.errorCb=d,n.e.SESSION_PATH&&n.e.API_URL&&(a||n.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},a):this.errorCb(new Error(an)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:a}=this.queue.shift();t&&this.success[t]||this.getSession(a,this.skuToken,(d=>{d?this.errorCb(d):t&&(this.success[t]=!0)}),h)}remove(){this.errorCb=null}},Da=Aa.getSessionAPI.bind(Aa),Yt=new Set;function Ha(h,t){t?Yt.add(h):Yt.delete(h)}class zr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,a){this._updatedSourceCaches[t]=a,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const a=t.scope;this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._updatedLayers[a].add(t.id),this.setDirty()}removeLayer(t){const a=t.scope;this._removedLayers[a]=this._removedLayers[a]||{},this._updatedLayers[a]=this._updatedLayers[a]||new Set,this._removedLayers[a][t.id]=t,this._updatedLayers[a].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const a in this._updatedLayers)t[a]=t[a]||{},t[a].updatedIds=Array.from(this._updatedLayers[a].values());for(const a in this._removedLayers)t[a]=t[a]||{},t[a].removedIds=Object.keys(this._removedLayers[a]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,a){this._updatedImages[a]=this._updatedImages[a]||new Set,this._updatedImages[a].add(n.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Dr(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class ma extends n.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&n.r()&&(this.imageRasterizerDispatcher=new n.D(n.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new n.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const a=this.atlasTexture.get(t);a&&(a.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,a){this.imageProviders.has(a)||this.imageProviders.set(a,new Map),this.imageProviders.get(a).set(t.id,t)}removeImageProvider(t,a){this.imageProviders.has(a)&&this.imageProviders.get(a).delete(t)}getPendingImageProviders(){const t=[];for(const a of this.imageProviders.values())for(const d of a.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,a){if(this.loaded.get(a)!==t&&(this.loaded.set(a,t),t)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,a,y);this.requestors=[]}}hasImage(t,a){return!!this.getImage(t,a)}getImage(t,a){return this.images.get(a).get(t.toString())}addImage(t,a,d){this._validate(t,d)&&this.images.get(a).set(t.toString(),d)}_validate(t,a){let d=!0;return this._validateStretch(a.stretchX,a.data&&a.data.width)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(a.stretchY,a.data&&a.data.height)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(a.content,a)||(this.fire(new n.y(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,a){if(!t)return!0;let d=0;for(const y of t){if(y[0]<d||y[1]<y[0]||a<y[1])return!1;d=y[1]}return!0}_validateContent(t,a){return t?t.length!==4||!a.usvg&&(t[0]<0||a.data.width<t[0]||t[1]<0||a.data.height<t[1]||t[2]<0||a.data.width<t[2]||t[3]<0||a.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,a,d){const y=this.images.get(a).get(t.toString());d.version=y.version+1,this.images.get(a).set(t.toString(),d),this.updatedImages.get(a).add(t),this.removeFromImageRasterizerCache(t,a)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,a){this.spriteFormat!=="raster"&&(n.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:a}):this.imageRasterizer.removeImagesFromCacheByIds([t],a))}removeImage(t,a){const d=this.images.get(a),y=d.get(t.toString());d.delete(t.toString()),this.patterns.get(a).delete(t.toString()),this.removeFromImageRasterizerCache(t,a),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map((a=>n.I.from(a)))}getImages(t,a,d){const y=[],b=[],S=this.imageProviders.get(a);for(const U of t){if(!U.iconsetId){y.push(U);continue}const Y=S.get(U.iconsetId);Y&&(this.getImage(U,a)?b.push(U):Y.addPendingRequest(U))}if(y.length===0)return void this._notify(b,a,d);let M=!0;const R=!!this.loaded.get(a),N=this.images.get(a);if(!R)for(const U of y)N.has(U.toString())||(M=!1);R||M?this._notify(y,a,d):this.requestors.push({ids:y,scope:a,callback:d})}rasterizeImages(t,a){const d=new Map,{tasks:y,scope:b}=t;for(const[S,M]of y.entries()){const R=this.getImage(M.id,b);R&&d.set(S,{image:R,imageVariant:M})}this._rasterizeImages(b,d,a)}_rasterizeImages(t,a,d){if(n.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:a,scope:t},d);else{const y=new Map;for(const[b,{image:S,imageVariant:M}]of a.entries())y.set(b,this.imageRasterizer.rasterize(M,S,t,0));d(void 0,y)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,a,d){const y=this.images.get(a),b=new Map;for(const S of t){if(!y.get(S.toString())){if(S.iconsetId)continue;this.fire(new n.z("styleimagemissing",{id:S.name}))}const M=y.get(S.toString());if(!M){n.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const R={data:M.usvg?null:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,usvg:M.usvg,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!!(M.userImage&&M.userImage.render)};M.usvg&&Object.assign(R,{width:M.icon.usvg_tree.width,height:M.icon.usvg_tree.height}),b.set(n.I.toString(S),R)}d(null,b)}getPixelSize(t){const{width:a,height:d}=this.atlasImage.get(t);return{width:a,height:d}}getPattern(t,a,d){const y=t.toString(),b=this.patterns.get(a),S=b.get(y),M=this.getImage(t,a);if(!M)return null;if(S){if(S.position.version===M.version)return S.position;S.position.version=M.version}else{if(M.usvg&&!M.data){const R=this.getPatternInFlightId(y,a);if(this.patternsInFlight.has(R))return null;this.patternsInFlight.add(R);const N=new n.A(t).scaleSelf(n.o.devicePixelRatio),U=new Map([[N.toString(),{image:M,imageVariant:N}]]);return this._rasterizeImages(a,U,((Y,X)=>this.storePatternImage(N,a,M,d,X))),null}this.storePattern(t,a,M)}return this._updatePatternAtlas(a,d),b.get(y).position}getPatternInFlightId(t,a){return n.B(t,a)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,a,d,y,b){const S=t.toString(),M=b?b.get(S):void 0;M&&(d.data=M,this.storePattern(t.id,a,d),this._updatePatternAtlas(a,y),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),a)))}storePattern(t,a,d){const y={w:d.data.width+2*n.C,h:d.data.height+2*n.C,x:0,y:0},b=new n.F(y,d,n.C);this.patterns.get(a).set(t.toString(),{bin:y,position:b})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,a){const d=t.gl;let y=this.atlasTexture.get(a);y?this.dirty&&(y.update(this.atlasImage.get(a)),this.dirty=!1):(y=new n.T(t,this.atlasImage.get(a),d.RGBA8),this.atlasTexture.set(a,y)),y.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,a){const d=this.patterns.get(t),y=Array.from(d.values()).map((({bin:N})=>N)),{w:b,h:S}=n.G(y),M=this.atlasImage.get(t);M.resize({width:b||1,height:S||1});const R=this.images.get(t);for(const[N,{bin:U,position:Y}]of d.entries()){let X=Y.padding;const Q=U.x+X,ae=U.y+X,ie=R.get(N).data,_e=ie.width,fe=ie.height;X=X>1?X-1:X,n.q.copy(ie,M,{x:0,y:0},{x:Q,y:ae},{width:_e,height:fe},a),n.q.copy(ie,M,{x:0,y:fe-X},{x:Q,y:ae-X},{width:_e,height:X},a),n.q.copy(ie,M,{x:0,y:0},{x:Q,y:ae+fe},{width:_e,height:X},a),n.q.copy(ie,M,{x:_e-X,y:0},{x:Q-X,y:ae},{width:X,height:fe},a),n.q.copy(ie,M,{x:0,y:0},{x:Q+_e,y:ae},{width:X,height:fe},a),n.q.copy(ie,M,{x:_e-X,y:fe-X},{x:Q-X,y:ae-X},{width:X,height:X},a),n.q.copy(ie,M,{x:0,y:fe-X},{x:Q+_e,y:ae-X},{width:X,height:X},a),n.q.copy(ie,M,{x:0,y:0},{x:Q+_e,y:ae+fe},{width:X,height:X},a),n.q.copy(ie,M,{x:_e-X,y:0},{x:Q-X,y:ae+fe},{width:X,height:X},a)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,a){const d=this.images.get(a);for(const y of t){if(this.callbackDispatchedThisFrame.get(a).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(a).add(y.toString());const b=d.get(y.toString());Dr(b)&&this.updateImage(y,a,b)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function rl(h){const t=h.value,a=h.valueSpec,d=h.style,y=h.styleSpec,b=h.key,S=h.arrayElementValidator||dt;if(!Array.isArray(t))return[new n.V(b,t,`array expected, ${n.K(t)} found`)];if(a.length&&t.length!==a.length)return[new n.V(b,t,`array length ${a.length} expected, length ${t.length} found`)];if(a["min-length"]&&t.length<a["min-length"])return[new n.V(b,t,`array length at least ${a["min-length"]} expected, length ${t.length} found`)];let M={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};y.$version<7&&(M.function=a.function),n.H(a.value)&&(M=a.value);let R=[];for(let N=0;N<t.length;N++)R=R.concat(S({array:t,arrayIndex:N,value:t[N],valueSpec:M,style:d,styleSpec:y,key:`${b}[${N}]`},!0));return R}function ho(h){const t=h.key,a=h.value,d=h.valueSpec;if(!n.L(a))return[new n.V(t,a,`number expected, ${n.K(a)} found`)];if(a!=a)return[new n.V(t,a,"number expected, NaN found")];if("minimum"in d){let y=d.minimum;if(Array.isArray(d.minimum)&&(y=d.minimum[h.arrayIndex]),a<y)return[new n.V(t,a,`${a} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(Array.isArray(d.maximum)&&(y=d.maximum[h.arrayIndex]),a>y)return[new n.V(t,a,`${a} is greater than the maximum value ${y}`)]}return[]}function Vo(h){const t=h.key,a=h.value;if(!n.H(a))return[new n.V(t,a,`object expected, ${n.K(a)} found`)];const d=h.valueSpec,y=n.J(a.type);let b,S,M,R={};const N=y!=="categorical"&&a.property===void 0,U=!N,Y=(function(ie){const _e=ie.stops;return Array.isArray(_e)&&Array.isArray(_e[0])&&n.H(_e[0][0])})(a),X=Ce({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(ie){if(y==="identity")return[new n.V(ie.key,ie.value,'identity function may not have a "stops" property')];let _e=[];const fe=ie.value;return _e=_e.concat(rl({key:ie.key,value:fe,valueSpec:ie.valueSpec,style:ie.style,styleSpec:ie.styleSpec,arrayElementValidator:Q})),Array.isArray(fe)&&fe.length===0&&_e.push(new n.V(ie.key,fe,"array must have at least one stop")),_e},default:function(ie){return dt({key:ie.key,value:ie.value,valueSpec:d,style:ie.style,styleSpec:ie.styleSpec})}}});return y==="identity"&&N&&X.push(new n.V(h.key,h.value,'missing required property "property"')),y==="identity"||a.stops||X.push(new n.V(h.key,h.value,'missing required property "stops"')),y==="exponential"&&d.expression&&!n.M(d)&&X.push(new n.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(U&&!n.N(d)?X.push(new n.V(h.key,h.value,"property functions not supported")):N&&!n.O(d)&&X.push(new n.V(h.key,h.value,"zoom functions not supported"))),y!=="categorical"&&!Y||a.property!==void 0||X.push(new n.V(h.key,h.value,'"property" property is required')),X;function Q(ie){let _e=[];const fe=ie.value,Te=ie.key;if(!Array.isArray(fe))return[new n.V(Te,fe,`array expected, ${n.K(fe)} found`)];if(fe.length!==2)return[new n.V(Te,fe,`array length 2 expected, length ${fe.length} found`)];if(Y){if(!n.H(fe[0]))return[new n.V(Te,fe,`object expected, ${n.K(fe[0])} found`)];const De=fe[0];if(De.zoom===void 0)return[new n.V(Te,fe,"object stop key must have zoom")];if(De.value===void 0)return[new n.V(Te,fe,"object stop key must have value")];const Se=n.J(De.zoom);if(typeof Se!="number")return[new n.V(Te,De.zoom,"stop zoom values must be numbers")];if(M&&M>Se)return[new n.V(Te,De.zoom,"stop zoom values must appear in ascending order")];Se!==M&&(M=Se,S=void 0,R={}),_e=_e.concat(Ce({key:`${Te}[0]`,value:fe[0],valueSpec:{zoom:{}},style:ie.style,styleSpec:ie.styleSpec,objectElementValidators:{zoom:ho,value:ae}}))}else _e=_e.concat(ae({key:`${Te}[0]`,value:fe[0],style:ie.style,styleSpec:ie.styleSpec},fe));return n.Q(n.S(fe[1]))?_e.concat([new n.V(`${Te}[1]`,fe[1],"expressions are not allowed in function stops.")]):_e.concat(dt({key:`${Te}[1]`,value:fe[1],valueSpec:d,style:ie.style,styleSpec:ie.styleSpec}))}function ae(ie,_e){const fe=n.K(ie.value),Te=n.J(ie.value),De=ie.value!==null?ie.value:_e;if(b){if(fe!==b)return[new n.V(ie.key,De,`${fe} stop domain type must match previous stop domain type ${b}`)]}else b=fe;if(fe!=="number"&&fe!=="string"&&fe!=="boolean"&&typeof Te!="number"&&typeof Te!="string"&&typeof Te!="boolean")return[new n.V(ie.key,De,"stop domain value must be a number, string, or boolean")];if(fe!=="number"&&y!=="categorical"){let Se=`number expected, ${fe} found`;return n.N(d)&&y===void 0&&(Se+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(ie.key,De,Se)]}return y!=="categorical"||fe!=="number"||typeof Te=="number"&&isFinite(Te)&&Math.floor(Te)===Te?y!=="categorical"&&fe==="number"&&typeof Te=="number"&&typeof S=="number"&&S!==void 0&&Te<S?[new n.V(ie.key,De,"stop domain values must appear in ascending order")]:(S=Te,y==="categorical"&&Te in R?[new n.V(ie.key,De,"stop domain values must be unique")]:(R[Te]=!0,[])):[new n.V(ie.key,De,`integer expected, found ${String(Te)}`)]}}function la(h){const t=(h.expressionContext==="property"?n.W:n.U)(n.S(h.value),h.valueSpec);if(t.result==="error")return t.value.map((d=>new n.V(`${h.key}${d.key}`,h.value,d.message)));const a=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!a.outputDefined())return[new n.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!n.Z(a))return[new n.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return Vs(a,h);if(h.expressionContext==="appearance")return qs(a,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!n.X(a,["zoom","feature-state"]))return[new n.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!n.Y(a))return[new n.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vs(h,t){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)a.delete(y);if(a.size===0)return[];const d=[];return h instanceof n._&&a.has(h.name)?[new n.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild((y=>{d.push(...Vs(y,t))})),d)}function qs(h,t){const a=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const y of t.valueSpec.expression.parameters)a.add(y);if(a.size===0)return[];const d=[];return h instanceof n._&&!a.has(h.name)?[new n.V(t.key,t.value,`["${h.name}"] is not an allowed parameter`)]:(h.eachChild((y=>{d.push(...qs(y,t))})),d)}function Us(h){const t=h.key,a=h.value,d=h.valueSpec,y=[];return Array.isArray(d.values)?d.values.indexOf(n.J(a))===-1&&y.push(new n.V(t,a,`expected one of [${d.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(d.values).indexOf(n.J(a))===-1&&y.push(new n.V(t,a,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(a)} found`)),y}function cn(h){return n.a2(n.S(h.value))?la(Object.assign({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):Ws(h)}function Ws(h){const t=h.value,a=h.key;if(!Array.isArray(t))return[new n.V(a,t,`array expected, ${n.K(t)} found`)];if(t.length<1)return[new n.V(a,t,"filter array must have at least 1 element")];const d=h.styleSpec;let y=Us({key:`${a}[0]`,value:t[0],valueSpec:d.filter_operator});const b=()=>{t.length>=2&&(n.a0(t[1])||y.push(new n.V(`${a}[1]`,t[1],`string expected, ${n.K(t[1])} found`)));for(let S=2;S<t.length;S++)n.J(t[1])==="$type"?y=y.concat(Us({key:`${a}[${S}]`,value:t[S],valueSpec:d.geometry_type})):n.a0(t[S])||n.L(t[S])||n.$(t[S])||y.push(new n.V(`${a}[${S}]`,t[S],`string, number, or boolean expected, ${n.K(t[S])} found.`))};switch(n.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.J(t[1])==="$type"&&y.push(new n.V(a,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&y.push(new n.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`)),b();break;case"==":case"!=":t.length!==3&&y.push(new n.V(a,t,`filter array for operator "${t[0]}" must have 3 elements`)),b();break;case"in":case"!in":b();break;case"any":case"all":case"none":for(let S=1;S<t.length;S++)y=y.concat(Ws({key:`${a}[${S}]`,value:t[S],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":t.length!==2?y.push(new n.V(a,t,`filter array for "${t[0]}" operator must have 2 elements`)):n.a0(t[1])||y.push(new n.V(`${a}[1]`,t[1],`string expected, ${n.K(t[1])} found`))}return y}function To(h,t){const a=h.key,d=h.style,y=h.layer,b=h.styleSpec,S=h.value,M=h.objectKey,R=b[`${t}_${h.layerType}`];if(!R)return[];const N=M.match(/^(.*)-use-theme$/);if(N&&R[N[1]])return n.Q(n.S(S))?[].concat(dt({key:a,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:M})):dt({key:a,value:S,valueSpec:{type:"string"},style:d,styleSpec:b});const U=M.match(/^(.*)-transition$/);if(t==="paint"&&U&&R[U[1]]&&R[U[1]].transition)return dt({key:a,value:S,valueSpec:b.transition,style:d,styleSpec:b});const Y=h.valueSpec||R[M];if(!Y)return[new n.a3(a,S,`unknown property "${M}"`)];let X;if(n.a0(S)&&n.N(Y)&&!Y.tokens&&(X=/^{([^}]+)}$/.exec(S))){const ae=`\`{ "type": "identity", "property": ${X?JSON.stringify(X[1]):'"_"'} }\``;return[new n.V(a,S,`"${M}" does not support interpolation syntax
Use an identity property function instead: ${ae}.`)]}const Q=[];if(h.layerType==="symbol")M!=="text-field"||!d||d.glyphs||d.imports||Q.push(new n.V(a,S,'use of "text-field" requires a style "glyphs" property')),M==="text-font"&&n.a4(n.S(S))&&n.J(S.type)==="identity"&&Q.push(new n.V(a,S,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&n.N(Y)&&(n.a5(Y)||n.O(Y))){const ae=n.W(n.S(S),Y).value,ie="expression"in ae&&ae.expression||"_styleExpression"in ae&&ae._styleExpression&&ae._styleExpression.expression;ie&&!n.X(ie,["measure-light"])&&(M==="model-emissive-strength"&&n.Y(ie)&&n.Z(ie)||Q.push(new n.V(a,S,`${M} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return Q.concat(dt({key:h.key,value:S,valueSpec:Y,style:d,styleSpec:b,expressionContext:"property",propertyType:t,propertyKey:M}))}function Do(h){return To(h,"paint")}function So(h){return To(h,"layout")}function Sn(h){let t=[];const a=h.value,d=h.key,y=h.style,b=h.styleSpec;if(!n.H(a))return[new n.V(d,a,"object expected")];a.type||a.ref||t.push(new n.V(d,a,'either "type" or "ref" is required'));let S=n.J(a.type);const M=n.J(a.ref);if(a.id){const R=n.J(a.id);for(let N=0;N<h.arrayIndex;N++){const U=y.layers[N];n.J(U.id)===R&&t.push(new n.V(d,a.id,`duplicate layer id "${R}", previously used at line ${U.id.__line__}`))}}if("ref"in a){let R;["type","source","source-layer","filter","layout"].forEach((N=>{N in a&&t.push(new n.V(d,a[N],`"${N}" is prohibited for ref layers`))})),y.layers.forEach((N=>{n.J(N.id)===M&&(R=N)})),R?R.ref?t.push(new n.V(d,a.ref,"ref cannot reference another ref layer")):S=n.J(R.type):typeof M=="string"&&t.push(new n.V(d,a.ref,`ref layer "${M}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(a.source)if(n.a0(a.source)){const R=y.sources&&y.sources[a.source],N=R&&n.J(R.type);R?N==="vector"&&S==="raster"?t.push(new n.V(d,a.source,`layer "${a.id}" requires a raster source`)):N==="raster"&&S!=="raster"?t.push(new n.V(d,a.source,`layer "${a.id}" requires a vector source`)):N!=="vector"||a["source-layer"]?N==="raster-dem"&&S!=="hillshade"?t.push(new n.V(d,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):N!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&a.paint&&(a.paint["line-gradient"]||a.paint["line-trim-offset"])&&N==="geojson"&&!R.lineMetrics?t.push(new n.V(d,a,`layer "${a.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&N!=="raster-array"&&t.push(new n.V(d,a.source,`layer "${a.id}" requires a 'raster-array' source.`)):t.push(new n.V(d,a.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(d,a,`layer "${a.id}" must specify a "source-layer"`)):t.push(new n.V(d,a.source,`source "${a.source}" not found`))}else t.push(new n.V(`${d}.source`,a.source,'"source" must be a string'));else t.push(new n.V(d,a,'missing required property "source"'));return t=t.concat(Ce({key:d,value:a,valueSpec:b.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dt({key:`${d}.type`,value:a.type,valueSpec:b.layer.type,style:h.style,styleSpec:h.styleSpec,object:a,objectKey:"type"}),filter:R=>cn(Object.assign({layerType:S},R)),layout:R=>Ce({layer:a,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":N=>So(Object.assign({layerType:S},N))}}),paint:R=>Ce({layer:a,key:R.key,value:R.value,valueSpec:{},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{"*":N=>Do(Object.assign({layerType:S,layer:a},N))}}),appearances(R){const N=rl({key:R.key,value:R.value,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:X=>(function(Q){const{key:ae,layer:ie,layerType:_e}=Q,fe=n.J(Q.value),Te=n.J(fe.name),De=n.J(fe.condition),Se=Ce({key:ae,value:fe,valueSpec:Q.styleSpec.appearance,style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{condition:Ze=>(function(Ve){const Ge=[];return Ge.push(...la({key:Ve.key,value:Ve.object.condition,valueSpec:n.a6.appearance.condition,expressionContext:"appearance"})),Ge})(Object.assign({layer:ie,layerType:_e},Ze)),properties:Ze=>(function(Ve){const Ge=[],{styleSpec:Fe,layer:Oe,layerType:it}=Ve,ft=Fe[`paint_${it}`],ht=Fe[`layout_${it}`],St=Ve.object[Ve.objectKey];for(const It in St){const zt=It in ft?"paint":It in ht?"layout":void 0;if(!zt){Ge.push(new n.V(Ve.key,It,`unknown property "${It}" for layer type "${it}"`));continue}const Jt=Object.assign({},Ve,{key:`${Ve.key}.${It}`,object:St,objectKey:It,layer:Oe,layerType:it,value:St[It],valueSpec:zt==="paint"?ft[It]:ht[It]});Ge.push(...To(Jt,zt))}return Ge})(Object.assign({layer:ie,layerType:_e},Ze))}});return Te!=="hidden"&&De===void 0&&Se.push(new n.V(Q.key,"name",'Appearance with name different than "hidden" must have a condition')),Se})(Object.assign({layerType:S,layer:a},X))}),U=Array.isArray(R.value)?R.value:[],Y=new Set;return U.forEach(((X,Q)=>{const ae=n.J(X.name);if(ae)if(Y.has(ae)){const ie=n.J(a.id);N.push(new n.V(R.key,ae,`Duplicated appearance name "${ae}" for layer "${ie}"`))}else Y.add(ae)})),N}}})),t}function tr({key:h,value:t}){return n.a0(t)?[]:[new n.V(h,t,`string expected, ${n.K(t)} found`)]}const ar={promoteId:function h({key:t,value:a}){if(n.a0(a))return tr({key:t,value:a});if(Array.isArray(a)){const y=[],b=n.S(a),S=n.U(b);return S.result==="error"&&S.value.forEach((M=>{y.push(new n.V(`${t}${M.key}`,null,`${M.message}`))})),n.X(S.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||y.push(new n.V(`${t}`,null,"promoteId expression should be only feature dependent")),y}if(!n.H(a))return[new n.V(t,a,`string, expression or object expected, "${n.K(a)}" found`)];const d=[];for(const y in a)d.push(...h({key:`${t}.${y}`,value:a[y]}));return d}};function Hs(h){const t=h.value,a=h.key,d=h.styleSpec,y=h.style;if(!n.H(t))return[new n.V(a,t,`object expected, ${n.K(t)} found`)];if(!("type"in t))return[new n.V(a,t,'"type" is required')];const b=n.J(t.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(b)&&("url"in t||"tiles"in t||S.push(new n.a3(a,t,'Either "url" or "tiles" is required.'))),b){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Ce({key:a,value:t,valueSpec:d[`source_${b.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:ar})),S;case"geojson":if(S=Ce({key:a,value:t,valueSpec:d.source_geojson,style:y,styleSpec:d,objectElementValidators:ar}),"cluster"in t&&"clusterProperties"in t){if(!n.H(t.clusterProperties))return[new n.V(`${a}.clusterProperties`,t,`object expected, ${n.K(t)} found`)];for(const M in t.clusterProperties){const R=t.clusterProperties[M];if(!Array.isArray(R))return[new n.V(`${a}.clusterProperties.${M}`,R,"array expected")];const[N,U]=R,Y=typeof N=="string"?[N,["accumulated"],["get",M]]:N;S.push(...la({key:`${a}.${M}.map`,value:U,expressionContext:"cluster-map"})),S.push(...la({key:`${a}.${M}.reduce`,value:Y,expressionContext:"cluster-reduce"}))}}return S;case"video":return Ce({key:a,value:t,valueSpec:d.source_video,style:y,styleSpec:d});case"image":return Ce({key:a,value:t,valueSpec:d.source_image,style:y,styleSpec:d});case"canvas":return[new n.V(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Us({key:`${a}.type`,value:t.type,valueSpec:{values:pl(d)}})}}function pl(h){return h.source.reduce(((t,a)=>{const d=h[a];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values||{}))),t}),[])}function Xr(h){const t=h.value,a=h.styleSpec,d=a.light,y=h.style;if(t===void 0)return[];if(!n.H(t))return[new n.V("light",t,`object expected, ${n.K(t)} found`)];let b=[];for(const S in t){const M=S.match(/^(.*)-transition$/),R=S.match(/^(.*)-use-theme$/);b=b.concat(R&&d[R[1]]?dt({key:S,value:t[S],valueSpec:{type:"string"},style:y,styleSpec:a}):M&&d[M[1]]&&d[M[1]].transition?dt({key:S,value:t[S],valueSpec:a.transition,style:y,styleSpec:a}):d[S]?dt({key:S,value:t[S],valueSpec:d[S],style:y,styleSpec:a}):[new n.V(S,t[S],`unknown property "${S}"`)])}return b}function ml(h){const t=h.value;if(!t)return[];const a=h.key;if(!n.H(t))return[new n.V(a,t,`object expected, ${n.K(t)} found`)];let d=[];const y=h.styleSpec,b=y["light-3d"],S=h.style,M=h.style.lights;for(const U of["type","id"])if(!(U in t))return d=d.concat([new n.V(a,t,`missing property "${U}"`)]),d;if(!n.a0(t.type))return d=d.concat([new n.V(`${a}.type`,t.type,"string expected")]),d;if(M)for(let U=0;U<h.arrayIndex;U++){const Y=n.J(t.type),X=M[U];n.J(X.type)===Y&&d.push(new n.V(a,t.id,`duplicate light type "${t.type}", previously defined at line ${X.id.__line__}`))}const R=`properties_light_${t.type}`;if(!(R in y))return d=d.concat([new n.V(`${a}.type`,t,`Invalid light type ${t.type}`)]),d;const N=y[R];for(const U in t)if(U==="properties"){const Y=t[U];if(!n.H(Y))return d=d.concat([new n.V("properties",Y,`object expected, ${n.K(Y)} found`)]),d;for(const X in Y){const Q=X.match(/^(.*)-transition$/),ae=X.match(/^(.*)-use-theme$/);d=d.concat(ae&&N[ae[1]]?dt({key:U,value:Y[X],valueSpec:{type:"string"},style:S,styleSpec:y}):Q&&N[Q[1]]&&N[Q[1]].transition?dt({key:U,value:t[U],valueSpec:y.transition,style:S,styleSpec:y}):N[X]?dt({key:X,value:Y[X],valueSpec:N[X],style:S,styleSpec:y}):[new n.a3(h.key,Y[X],`unknown property "${X}"`)])}}else d=d.concat(b[U]?dt({key:U,value:t[U],valueSpec:b[U],style:S,styleSpec:y}):[new n.a3(U,t[U],`unknown property "${U}"`)]);return d}function Uo(h){const t=h.value,a=h.key,d=h.style,y=h.styleSpec,b=y.terrain;if(t==null)return[];if(!n.H(t))return[new n.V("terrain",t,`object expected, ${n.K(t)} found`)];let S=[];for(const M in t){const R=M.match(/^(.*)-transition$/),N=M.match(/^(.*)-use-theme$/);S=S.concat(N&&b[N[1]]?dt({key:M,value:t[M],valueSpec:{type:"string"},style:d,styleSpec:y}):R&&b[R[1]]&&b[R[1]].transition?dt({key:M,value:t[M],valueSpec:y.transition,style:d,styleSpec:y}):b[M]?dt({key:M,value:t[M],valueSpec:b[M],style:d,styleSpec:y}):[new n.a3(M,t[M],`unknown property "${M}"`)])}if(t.source)if(n.a0(t.source)){const M=d.sources&&d.sources[t.source],R=M&&n.J(M.type);M?R!=="raster-dem"&&S.push(new n.V(`${a}.source`,t.source,`terrain cannot be used with a source of type ${R}, it only be used with a "raster-dem" source type`)):S.push(new n.V(`${a}.source`,t.source,`source "${t.source}" not found`))}else S.push(new n.V(`${a}.source`,t.source,"source must be a string"));else S.push(new n.V(a,t,'terrain is missing required property "source"'));return S}function lc(h){const t=h.value,a=h.style,d=h.styleSpec,y=d.fog;if(t===void 0)return[];if(!n.H(t))return[new n.V("fog",t,`object expected, ${n.K(t)} found`)];let b=[];for(const S in t){const M=S.match(/^(.*)-transition$/),R=S.match(/^(.*)-use-theme$/);b=b.concat(R&&y[R[1]]?dt({key:S,value:t[S],valueSpec:{type:"string"},style:a,styleSpec:d}):M&&y[M[1]]&&y[M[1]].transition?dt({key:S,value:t[S],valueSpec:d.transition,style:a,styleSpec:d}):y[S]?dt({key:S,value:t[S],valueSpec:y[S],style:a,styleSpec:d}):[new n.a3(S,t[S],`unknown property "${S}"`)])}return b}const ul={"*":()=>[],array:rl,boolean:function(h){const t=h.value,a=h.key;return n.$(t)?[]:[new n.V(a,t,`boolean expected, ${n.K(t)} found`)]},number:ho,color:function({key:h,value:t}){return n.a0(t)?n.a1.parseCSSColor(t)===null?[new n.V(h,t,`color expected, "${t}" found`)]:[]:[new n.V(h,t,`color expected, ${n.K(t)} found`)]},enum:Us,filter:cn,function:Vo,layer:Sn,object:Ce,source:Hs,model:n.a7,light:Xr,"light-3d":ml,terrain:Uo,fog:lc,string:tr,formatted:function(h){return tr(h).length===0?[]:la(h)},resolvedImage:function(h){return tr(h).length===0?[]:la(h)},projection:function(h){const t=h.value,a=h.styleSpec,d=a.projection,y=h.style;if(n.H(t)){let b=[];for(const S in t)b=b.concat(dt({key:S,value:t[S],valueSpec:d[S],style:y,styleSpec:a}));return b}return n.a0(t)?[]:[new n.V("projection",t,`object or string expected, ${n.K(t)} found`)]},import:function(h){const t=h.key,{value:a,styleSpec:d}=h;if(!n.H(a))return[new n.V(t,a,"import must be an object")];const{data:y,...b}=a;Object.defineProperty(b,"__line__",{value:a.__line__,enumerable:!1});let S=Ce(Object.assign({},h,{value:b,valueSpec:d.import}));return n.J(b.id)===""&&S.push(new n.V(`${h.key}.id`,b,"import id can't be an empty string")),y&&(S=S.concat(Qe(y,d,{key:`${h.key}.data`}))),S},iconset:function(h){const t=h.value,a=h.key,d=h.styleSpec,y=h.style;if(!n.H(t))return[new n.V(a,t,"object expected")];if(!t.type)return[new n.V(a,t,'"type" is required')];const b=n.J(t.type);let S=[];if(S=S.concat(Ce({key:a,value:t,valueSpec:d[`iconset_${b}`],style:y,styleSpec:d})),(function(M,R){return!(M!=="source"||!R.source)})(b,t)){const M=y.sources&&y.sources[t.source],R=M&&n.J(M.type);M?R!=="raster-array"&&S.push(new n.V(a,t.source,`iconset cannot be used with a source of type ${String(R)}, it only be used with a "raster-array" source type`)):S.push(new n.V(a,t.source,`source "${t.source}" not found`))}return S}};function dt(h,t=!1){const a=h.value,d=h.valueSpec,y=h.styleSpec;if(d.expression){if(n.a4(n.J(a)))return Vo(h);if(n.Q(n.S(a)))return la(h)}if(d.type&&ul[d.type]){const b=ul[d.type](h);return t===!0&&b.length>0&&Array.isArray(h.value)?la(h):b}return Ce(Object.assign({},h,{valueSpec:d.type?y[d.type]:d}))}function Ce(h){const t=h.key,a=h.value,d=h.valueSpec||{},y=h.objectElementValidators||{},b=h.style,S=h.styleSpec;if(!n.H(a))return[new n.V(t,a,`object expected, ${n.K(a)} found`)];let M=[];for(const R in a){const N=R.split(".")[0];let U;y[N]?U=y[N]:d[N]?U=dt:y["*"]?U=y["*"]:d["*"]&&(U=dt),U?M=M.concat(U({key:(t&&`${t}.`)+R,value:a[R],valueSpec:d[N]||d["*"],style:b,styleSpec:S,object:a,objectKey:R},a)):M.push(new n.a3(t,a[R],`unknown property "${R}"`))}for(const R in d){if(y[R])continue;const N=d[R];N.required&&N.default===void 0&&a[R]===void 0&&M.push(new n.V(t,a,`missing required property "${R}"`))}return M}function Re({key:h,value:t}){const a=tr({key:h,value:t});if(a.length)return a;const d=t;return d.indexOf("{fontstack}")===-1&&a.push(new n.V(h,t,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&a.push(new n.V(h,t,'"glyphs" url must include a "{range}" token')),a}function Qe(h,t=n.a6,a={}){return Ce({key:a.key||"",value:h,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:h,objectElementValidators:{glyphs:Re}})}function mt(h,t=n.a6){return pe(Qe(h,t))}const Nt=h=>pe(Hs(h)),je=h=>pe(Xr(h)),ei=h=>pe(ml(h)),Pt=h=>pe(Uo(h)),Di=h=>pe(lc(h)),fi=h=>pe((function(t){const a=t.value,d=t.style,y=t.styleSpec,b=y.snow;if(a===void 0)return[];if(!n.H(a))return[new n.V("snow",a,`object expected, ${n.K(a)} found`)];let S=[];for(const M in a){const R=M.match(/^(.*)-transition$/);S=S.concat(R&&b[R[1]]&&b[R[1]].transition?dt({key:M,value:a[M],valueSpec:y.transition,style:d,styleSpec:y}):b[M]?dt({key:M,value:a[M],valueSpec:b[M],style:d,styleSpec:y}):[new n.a3(M,a[M],`unknown property "${M}"`)])}return S})(h)),hi=h=>pe((function(t){const a=t.value,d=t.style,y=t.styleSpec,b=y.rain;if(a===void 0)return[];if(!n.H(a))return[new n.V("rain",a,`object expected, ${n.K(a)} found`)];let S=[];for(const M in a){const R=M.match(/^(.*)-transition$/);S=S.concat(R&&b[R[1]]&&b[R[1]].transition?dt({key:M,value:a[M],valueSpec:y.transition,style:d,styleSpec:y}):b[M]?dt({key:M,value:a[M],valueSpec:b[M],style:d,styleSpec:y}):[new n.a3(M,a[M],`unknown property "${M}"`)])}return S})(h)),kn=h=>pe(Sn(h)),hr=h=>pe(cn(h)),Tr=h=>pe(Do(h)),lt=h=>pe(So(h)),te=h=>pe(n.a7(h));function pe(h){return h.slice().sort(((t,a)=>t.line&&a.line?t.line-a.line:0))}function ze(h,t){let a=!1;if(t&&t.length)for(const d of t)d instanceof n.a3?n.w(d.message):(h.fire(new n.y(new Error(d.message))),a=!0);return a}const et=n.a6.light;let Xe;class rt extends n.E{constructor(t,a="flat"){super(),this._transitionable=new n.a8(Xe||(Xe=new n.a9({anchor:new n.aa(et.anchor),position:new n.ab(et.position),color:new n.aa(et.color),intensity:new n.aa(et.intensity)}))),this.setLight(t,a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,a,d={}){this._validate(je,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=a)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&ze(this,t.call(mt,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}const wt=n.a6.terrain;let ot=class extends n.E{constructor(h,t,a,d,y){super(),this.scope=a,this._transitionable=new n.a8(new n.a9({source:new n.aa(wt.source),exaggeration:new n.aa(wt.exaggeration)}),a,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=y}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new n.ac(h,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let a=-1,d=-1,y=1;for(const b of t.zoomStops)y=t.evaluate(new n.ac(b,{worldview:this.worldview})),y>.01?(a=b,d=-1):d=b;return y<.01&&a>0&&d>a?[a,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof n.ad}};const At=45,ti=65,qt=.05;function Yi(h,t,a,d){const y=n.ah(At,ti,a),[b,S]=Ki(h,d);let M=1-Math.min(1,Math.exp((t-b)/(S-b)*-6));return M*=M*M,M=Math.min(1,1.00747*M),M*y*h.alpha}function Ki(h,t){const a=.5/Math.tan(.5*t);return[h.range[0]+a,h.range[1]+a]}function Bi(h,t,a,d,y){const b=n.af([],[t,a,d],y.mercatorFogMatrix);return Yi(h,n.ag(b),y.pitch,y._fov)}function dr(h,t,a,d,y,b,S){const M=[[a,d,0],[y,d,0],[y,b,0],[a,b,0]];let R=Number.MAX_VALUE,N=-Number.MAX_VALUE;for(const U of M){const Y=n.af([],U,t),X=n.ag(Y);R=Math.min(R,X),N=Math.max(N,X)}return[Yi(h,R,S.pitch,S._fov),Yi(h,N,S.pitch,S._fov)]}const $n=n.a6.fog;class Nn extends n.E{constructor(t,a,d,y){super();const b=new n.a9({range:new n.aa($n.range),color:new n.aa($n.color),"color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.aa($n["high-color"]),"high-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.aa($n["space-color"]),"space-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.aa($n["horizon-blend"]),"star-intensity":new n.aa($n["star-intensity"]),"vertical-range":new n.aa($n["vertical-range"])});this._transitionable=new n.a8(b,d,new Map(y)),this.set(t,y),this._transitioning=this._transitionable.untransitioned(),this._transform=a,this.properties=new n.ai(b),this.scope=d}get state(){const t=this._transform,a=t.projection.name==="globe",d=n.aj(t.zoom),y=this.properties.get("range"),b=[.5,3];return{range:a?[n.ak(b[0],y[0],d),n.ak(b[1],y[1],d)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,a,d={}){if(this._validate(Di,t,d))return;const y=Object.assign({},t);for(const b of Object.keys($n))y[b]===void 0&&(y[b]=$n[b].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,a)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const a=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.ah(At,ti,t))*a.a}getOpacityAtLatLng(t,a){return this._transform.projection.supportsFog?(function(d,y,b){const S=n.ae.fromLngLat(y),M=b.elevation?b.elevation.getAtPointOrZero(S):0;return Bi(d,S.x,S.y,M,b)})(this.state,t,a):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const a=this._transform.calculateFogTileMatrix(t.toUnwrapped());return dr(this.state,a,0,0,n.al,n.al,this._transform)}getOpacityForBounds(t,a,d,y,b){return this._transform.projection.supportsFog?dr(this.state,t,a,d,y,b,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Ki(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const a=[4,5,6,7];for(const d of a){const y=t.points[d];let b;if(y[2]>=0)b=y;else{const S=t.points[d-4];b=n.am(S,y,S[2]/(S[2]-y[2]))}if(Bi(this.state,b[0],b[1],0,this._transform)>=qt)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,a,d){return(!d||d.validate!==!1)&&ze(this,t.call(mt,Object.assign({value:a,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}let Ur,La,Ja,ss,js=class extends n.E{constructor(h,t,a,d){super();const y=Ur||(Ur=new n.a9({density:new n.aa(n.a6.snow.density),intensity:new n.aa(n.a6.snow.intensity),color:new n.aa(n.a6.snow.color),opacity:new n.aa(n.a6.snow.opacity),vignette:new n.aa(n.a6.snow.vignette),"vignette-color":new n.aa(n.a6.snow["vignette-color"]),"center-thinning":new n.aa(n.a6.snow["center-thinning"]),direction:new n.aa(n.a6.snow.direction),"flake-size":new n.aa(n.a6.snow["flake-size"])}));this._transitionable=new n.a8(y,a,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(y),this.scope=a}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),d=n.an(a[0]),y=-Math.max(n.an(a[1]),.01),b=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette"),M=this.properties.get("vignette-color");return M.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(t.r,t.g,t.b,t.a*h),direction:b,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:M}}get(){return this._transitionable.serialize()}set(h,t,a={}){if(this._validate(fi,h,a))return;const d=Object.assign({},h),y=n.a6.snow;for(const b of Object.keys(y))d[b]===void 0&&(d[b]=y[b].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,a){return(!a||a.validate!==!1)&&ze(this,h.call(mt,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}},ea=class extends n.E{constructor(h,t,a,d){super();const y=La||(La=new n.a9({density:new n.aa(n.a6.rain.density),intensity:new n.aa(n.a6.rain.intensity),color:new n.aa(n.a6.rain.color),opacity:new n.aa(n.a6.rain.opacity),vignette:new n.aa(n.a6.rain.vignette),"vignette-color":new n.aa(n.a6.rain["vignette-color"]),"center-thinning":new n.aa(n.a6.rain["center-thinning"]),direction:new n.aa(n.a6.rain.direction),"droplet-size":new n.aa(n.a6.rain["droplet-size"]),"distortion-strength":new n.aa(n.a6.rain["distortion-strength"])}));this._transitionable=new n.a8(y,a,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(y),this.scope=a}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),a=this.properties.get("direction"),d=n.an(a[0]),y=-Math.max(n.an(a[1]),.01),b=[Math.cos(d)*Math.cos(y),Math.sin(d)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(t.r,t.g,t.b,t.a*h),direction:b,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(h,t,a={}){if(this._validate(hi,h,a))return;const d=Object.assign({},h),y=n.a6.rain;for(const b of Object.keys(y))d[b]===void 0&&(d[b]=y[b].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,a){return(!a||a.validate!==!1)&&ze(this,h.call(mt,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}};class jr extends n.E{constructor(t,a,d,y){super(),this.scope=d,this._options=t,this.properties=new n.ai(a),this._transitionable=new n.a8(a,d,new Map(y)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,a){this._options=t,this._transitionable.setTransitionOrValue(t.properties,a)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class da{constructor(t,a,d){this.screenBounds=t,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(t,a){let d,y;if(t instanceof n.P||typeof t[0]=="number"){const b=n.P.convert(t);d=[b],y=a.isPointAboveHorizon(b)}else{const b=n.P.convert(t[0]),S=n.P.convert(t[1]),M=b.add(S)._div(2);d=[b,S],y=n.aq(b,S).every((R=>a.isPointAboveHorizon(R)))&&a.isPointAboveHorizon(M)}return new da(d,y,a)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],y=n.aq(a,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>a.x&&this.cameraPoint.x<d.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?y[2]=this.cameraPoint:this.cameraPoint.x<=a.x&&(y[3]=this.cameraPoint)),n.ar(y,t)}bufferedCameraGeometryGlobe(t){const a=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],y=n.aq(a,d,t),b=this.cameraPoint.clone();switch(3*((b.y>a.y)+(b.y>d.y))+((b.x>a.x)+(b.x>d.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(t,a,d,y=0){const b=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/a._pixelsPerMercatorPixel+1,S=d?this._bufferedCameraMercator(b,a):this._bufferedScreenMercator(b,a);let M=t.tileID.wrap+(S.unwrapped?y:0);const R=S.polygon.map((_e=>n.as(t.tileTransform,_e,M)));if(!n.at(R,0,0,n.al,n.al))return;M=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const N=this.screenGeometryMercator.polygon.map((_e=>n.au(t.tileTransform,_e,M))),U=N.map((_e=>new n.P(_e[0],_e[1]))),Y=a.getFreeCameraOptions().position||new n.ae(0,0,0),X=n.au(t.tileTransform,Y,M),Q=N.map((_e=>{const fe=n.av(_e,_e,X);return n.aw(fe,fe),new n.ax(X,fe)})),ae=n.ay(t,1,a.zoom)*a._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:U,tilespaceRays:Q,bufferedTilespaceGeometry:R,bufferedTilespaceBounds:(ie=n.az(R),ie.min.x=n.aA(ie.min.x,0,n.al),ie.min.y=n.aA(ie.min.y,0,n.al),ie.max.x=n.aA(ie.max.x,0,n.al),ie.max.y=n.aA(ie.max.y,0,n.al),ie),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:ae};var ie}_bufferedScreenMercator(t,a){const d=$a(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let y;return y=a.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),a):{polygon:this.bufferedScreenGeometry(t).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._screenRaycastCache[d]=y,y}}_bufferedCameraMercator(t,a){const d=$a(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let y;return y=a.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),a):{polygon:this.bufferedCameraGeometry(t).map((b=>a.pointCoordinate3D(b))),unwrapped:!0},this._cameraRaycastCache[d]=y,y}}_projectAndResample(t,a){const d=(function(b,S){const M=n.aB([],S.pixelMatrix,S.globeMatrix),R=[0,-n.aD,0,1],N=[0,n.aD,0,1],U=[0,0,0,1];n.aC(R,R,M),n.aC(N,N,M),n.aC(U,U,M);const Y=new n.P(R[0]/R[3],R[1]/R[3]),X=new n.P(N[0]/N[3],N[1]/N[3]),Q=n.aE(b,Y)&&R[3]<U[3],ae=n.aE(b,X)&&N[3]<U[3];if(!Q&&!ae)return null;const ie=(function(Ge,Fe,Oe){for(let it=1;it<Ge.length;it++){const ft=Rr(Fe.pointCoordinate3D(Ge[it-1]).x),ht=Rr(Fe.pointCoordinate3D(Ge[it]).x);if(Oe<0){if(ft<ht)return{idx:it,t:-ft/(ht-1-ft)}}else if(ht<ft)return{idx:it,t:(1-ft)/(ht+1-ft)}}return null})(b,S,Q?-1:1);if(!ie)return null;const{idx:_e,t:fe}=ie;let Te=_e>1?lr(b.slice(0,_e),S):[],De=_e<b.length?lr(b.slice(_e),S):[];Te=Te.map((Ge=>new n.P(Rr(Ge.x),Ge.y))),De=De.map((Ge=>new n.P(Rr(Ge.x),Ge.y)));const Se=[...Te];Se.length===0&&Se.push(De[De.length-1]);const Ze=n.ak(Se[Se.length-1].y,(De.length===0?Te[0]:De[0]).y,fe);let Ve;return Ve=Q?[new n.P(0,Ze),new n.P(0,0),new n.P(1,0),new n.P(1,Ze)]:[new n.P(1,Ze),new n.P(1,1),new n.P(0,1),new n.P(0,Ze)],Se.push(...Ve),De.length===0?Se.push(Te[0]):Se.push(...De),{polygon:Se.map((Ge=>new n.ae(Ge.x,Ge.y))),unwrapped:!1}})(t,a);if(d)return d;const y=(function(b,S){let M=!1,R=-1/0,N=0;for(let Y=0;Y<b.length-1;Y++)b[Y].x>R&&(R=b[Y].x,N=Y);for(let Y=0;Y<b.length-1;Y++){const X=(N+Y)%(b.length-1),Q=b[X],ae=b[X+1];Math.abs(Q.x-ae.x)>.5&&(Q.x<ae.x?(Q.x+=1,X===0&&(b[b.length-1].x+=1)):(ae.x+=1,X+1===b.length-1&&(b[0].x+=1)),M=!0)}const U=n.aF(S.center.lng);return M&&U<Math.abs(U-1)&&b.forEach((Y=>{Y.x-=1})),{polygon:b,unwrapped:M}})(lr(t,a).map((b=>new n.P(Rr(b.x),b.y))),a);return{polygon:y.polygon.map((b=>new n.ae(b.x,b.y))),unwrapped:y.unwrapped}}}function lr(h,t){return n.aG(h,(a=>{const d=t.pointCoordinate3D(a);a.x=d.x,a.y=d.y}),1/256)}function Rr(h){return h<0?1+h%1:h%1}function $a(h){return 100*h|0}function Ro(h,t,a,d,y){const b=function(M,R){if(M)return y(M);if(R){if(h.url&&R.tiles&&h.tiles&&delete h.tiles,R.variants){if(!Array.isArray(R.variants))return y(new Error("variants must be an array"));for(const U of R.variants){if(U==null||typeof U!="object"||U.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(U.capabilities))return y(new Error("capabilities must be an array"));if(U.capabilities.length===1&&U.capabilities[0]==="meshopt"){R=Object.assign(R,U);break}}}const N=n.aH(Object.assign({},R,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);N.tiles=t.canonicalizeTileset(N,h.url),y(null,N)}},S=(function(M,R,N){if(!M)return null;if(!R&&!N)return M;N=N||M.worldview_default;const U=Object.values(M.language||{});if(U.length===0)return null;const Y=Object.values(M.worldview||{});if(Y.length===0)return null;const X=U.every((ae=>ae===R)),Q=Y.every((ae=>ae===N));return X&&Q?M:R in(M.language_options||{})||N in(M.worldview_options||{})?null:M.language_options&&M.worldview_options?M:null})(h.data,a,d);return S?n.o.frame((()=>b(null,S))):h.url?n.m(t.transformRequest(t.normalizeSourceURL(h.url,null,a,d),n.R.Source),b):n.o.frame((()=>{const{data:M,...R}=h;b(null,R)}))}function Ys(h,t){const a=Math.pow(2,t.z),d=Math.floor(n.aF(h.getWest())*a),y=Math.floor(n.aJ(h.getNorth())*a),b=Math.ceil(n.aF(h.getEast())*a),S=Math.ceil(n.aJ(h.getSouth())*a);return t.x>=d&&t.x<b&&t.y>=y&&t.y<S}class _l{constructor(t,a,d){this.bounds=t?n.aI.convert(this.validateBounds(t)):null,this.minzoom=a||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const a of t)this.extraBounds.push(n.aI.convert(this.validateBounds(a)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Ys(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const a of this.extraBounds)if(Ys(a,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const a=new _l(t.bounds,t.minzoom,t.maxzoom);return a.addExtraBounds(t.extra_bounds),a}}class nh extends n.E{constructor(t,a,d,y){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,n.aH(a,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},a),this._collectResourceTiming=!!a.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new n.aK}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const a=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Ro(this._options,this.map._requestManager,a,d,((y,b)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)a&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${a}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new n.y(y));else if(b){if(Object.assign(this,b),this.hasWorldviews=!!b.worldview_options,b.worldview_default&&(this.worldviewDefault=b.worldview_default),b.vector_layers){this.vectorLayers=b.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of b.vector_layers)this.vectorLayerIds.push(S.id),b.worldview&&b.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=_l.fromTileJSON(b),ai(b.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(y)}))}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,a){const d=t.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(d),b=this.map._requestManager.transformRequest(y,n.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,M=S?{image:S.image.clone()}:null,R={request:b,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:M,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&n.h(d)&&(R.localizableLayerIds=this.localizableLayerIds),R.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=a:t.request=t.actor.send("reloadTile",R,N.bind(this));else if(t.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",R,N.bind(this),void 0,!0);else{const U=n.aL.call({deduped:this._deduped},R,((Y,X)=>{if(Y||!X)N.call(this,Y);else{const Q=n.aM(X.responseHeaders);R.data={rawData:X.rawData.slice(0),expires:Q.expires,cacheControl:Q.cacheControl},t.actor&&t.actor.send("loadTile",R,N.bind(this),void 0,!0)}}),!0);t.request={cancel:U}}function N(U,Y){return delete t.request,t.aborted?a(null):U&&U instanceof n.aN&&U.status!==404?a(U):(Y&&Y.resourceTiming&&(t.resourceTiming=Y.resourceTiming),this.map._refreshExpiredTiles&&Y&&t.setExpiryData(Y),t.loadVectorData(Y,this.map.painter),n.aO(this.dispatcher),a(null,Y),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class es extends n.E{constructor(t,a,d,y){super(),this.id=t,this.dispatcher=d,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},a),Object.assign(this,n.aH(a,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const a=this.map.getWorldview();this._tileJSONRequest=Ro(this._options,this.map._requestManager,null,a,((d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new n.y(d)):y&&(Object.assign(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map((b=>b.id))),this.tileBounds=_l.fromTileJSON(y),ai(y.tiles),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)}))}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(t)))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,a){const d=n.o.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=n.n(this.map._requestManager.transformRequest(y,n.R.Tile),((b,S,M)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(b)return t.state="errored",a(b);if(!S)return a(null);const R=n.aM(M);this.map._refreshExpiredTiles&&t.setExpiryData(R),t.setTexture(S,this.map.painter),t.state="loaded",n.aO(this.dispatcher),a(null)}))}abortTile(t,a){t.request&&(t.request.cancel(),delete t.request),a&&a()}unloadTile(t,a){t.texture&&t.texture instanceof n.T?(t.destroy(!1),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),a&&a()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function jo([h,t],a,d,{scaled:y=!0}={}){const{tileSize:b,buffer:S}=d,{x:M,y:R,z:N}=a;if(!isFinite(M)||!isFinite(R)||!isFinite(N))throw new Error("Invalid MRT header");const U=2**N,Y=U*n.aF(h),X=U*n.aJ(t);return(function([Q,ae],ie,{scaled:_e=!0}={}){if(!ie)throw new Error("bandView is undefined");const{data:fe,tileSize:Te,buffer:De,offset:Se,scale:Ze,dimension:Ve}=ie;if(Q<-De||Q>Te+De||ae<-De||ae>Te+De)throw new Error(`Point (${Q}, ${ae}) out of bounds for tileSize=${Te}, buffer=${De}`);const Ge=(ae+De)*(Te+2*De)+(Q+De);if(new Uint32Array(fe.buffer)[Ge]===4294967295)return null;let Fe=[];Fe=_e?[]:new ie.data.constructor(Ve);for(let Oe=0;Oe<Ve;Oe++)Fe[Oe]=Math.round(1e12*(fe[Ve*Ge+Oe]*Ze+Se))/1e12;return Fe})([Math.min(Math.max(-S,Math.floor((Y-M)*b)),b-1+S),Math.min(Math.max(-S,Math.floor((X-R)*b)),b-1+S)],d,{scaled:y})}class _a extends es{constructor(t,a,d,y){super(t,a,d,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},a)}triggerRepaint(t){const a=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);a&&a.enabled&&d&&a._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,a){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,n.R.Tile),b={request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=y,t.actor||(t.actor=this.dispatcher.getActor());const S=(M,R,N)=>{if(delete t.request,t.aborted)return t.state="unloaded",a(null);if(M)return M.name==="AbortError"?void 0:(t.state="errored",a(M));if(this.map._refreshExpiredTiles&&R){const U=n.aM(N);t.setExpiryData(U)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!R)return a(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=R}a(null)};t.request=this.partial?t.fetchHeader(void 0,S.bind(this)):t.actor.send("loadTile",b,S.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,a){const d=t.texturePerLayer;if(t.flushAllQueues(),d.size){t.destroy(!1);for(const y of d.values())this.map.painter.saveTileTexture(y)}else t.destroy()}prepareTile(t,a,d,y){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(a,d,y,((b,S)=>{if(b)return t.state="errored",this.fire(new n.y(b)),void this.triggerRepaint(t);S&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(d,S,this.map.painter),t.state="loaded",this.triggerRepaint(t))})))}getInitialBand(t){if(!this.rasterLayers)return 0;const a=this.rasterLayers.find((({id:b})=>b===t)),d=a&&a.fields,y=d&&d.bands&&d.bands;return y?y[0]:0}getTextureDescriptor(t,a,d){if(!t)return;const y=a.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let b=null;a instanceof n.aR?b=a.paint.get("raster-array-band"):a instanceof n.aS&&(b=a.paint.get("raster-particle-array-band"));const S=b||this.getInitialBand(y);if(S==null)return;if(!t.textureDescriptorPerLayer.get(a.id))return void this.prepareTile(t,y,a.id,S);if(t.updateNeeded(a.id,S)&&!d)return;const M=t.textureDescriptorPerLayer.get(a.id);return Object.assign({},M,{texture:t.texturePerLayer.get(a.id)})}getImages(t,a){const d=new Map;for(const y of t)for(const b of a){const[S,M]=b.split("/"),R=y.getLayer(S);if(!R||!R.hasBand(M)||!R.hasDataForBand(M))continue;const{bytes:N,tileSize:U,buffer:Y}=R.getBandView(M),X=U+2*Y,Q={data:new n.q({width:X,height:X},N),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(b,Q)}return d}queryRasterArrayValueByBandId(t,a,d){const y=a._mrt;return new Promise((b=>{const S={},M=new Set;for(const[R,N]of Object.entries(y.layers)){if(d.layerName&&R!==d.layerName)continue;const U={};S[R]=U;for(const{bands:Y}of N.dataIndex)for(const X of Y)d.bands&&!d.bands.includes(X)||(M.add(n.B(R,X)),a.fetchBand(R,null,X,(Q=>{n.o.frame((()=>{U[X]=Q?null:jo([t.lng,t.lat],y,N.getBandView(X)),M.delete(n.B(R,X)),M.size===0&&b(S)}))}),!1))}M.size===0&&b(S)}))}_loadTileForQuery(t,a){if(this._loadTileLoaded[t.uid])return void a(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(a);this._loadTilePending[t.uid]=[a];const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(d,n.R.Tile);t.actor.send("loadTile",{request:y,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((b,S,M)=>{if(b)return this._loadTilePending[t.uid].forEach((R=>R(b,null))),void delete this._loadTilePending[t.uid];if(!S)return this._loadTilePending[t.uid].forEach((R=>R(null,null))),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&S){const R=n.aM(M);t.setExpiryData(R)}t._mrt=S,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach((R=>R(null,S))),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]}),void 0,!0)}queryRasterArrayValueByAllBands(t,a,d){return new Promise(((y,b)=>{this._loadTileForQuery(a,((S,M)=>{S?b(S):y(M?this.queryRasterArrayValueByBandId(t,a,d):null)}))}))}queryRasterArrayValue(t,a){const d=n.aT.convert(t),y=this.findLoadedParent(d);return y&&y._mrt?a.bands||!this.partial?this.queryRasterArrayValueByBandId(d,y,a):this.queryRasterArrayValueByAllBands(d,y,a):Promise.resolve(null)}findLoadedParent(t){const a=n.ae.fromLngLat(t,this.map.transform.tileSize),d=this.maxzoom+1,y=1<<d,b=Math.floor(a.x),S=Math.floor((a.x-b)*y),M=Math.floor(a.y*y),R=this.map.style.getSourceCache(this.id),N=new n.aQ(d,b,d,S,M);return R.findLoadedParent(N,this.minzoom)}}const Mc={vector:nh,raster:es,"raster-dem":class extends es{constructor(h,t,a,d){super(h,t,a,d),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(y,b){y&&(h.state="errored",t(y)),b&&(h.dem=b,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=n.n(this.map._requestManager.transformRequest(a,n.R.Tile),(function(y,b,S){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(y)h.state="errored",t(y);else if(b){const M=n.aM(S);this.map._refreshExpiredTiles&&h.setExpiryData(M);const R=ImageBitmap&&b instanceof ImageBitmap&&n.r(),N=1-(b.width-n.aP(b.width))/2;N<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const U=R?b:n.o.getImageData(b,N),Y={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:U,encoding:this.encoding,padding:N};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",Y,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,a=Math.pow(2,t.z),d=(t.x-1+a)%a,y=t.x===0?h.wrap-1:h.wrap,b=(t.x+1+a)%a,S=t.x+1===a?h.wrap+1:h.wrap,M={};return M[new n.aQ(h.overscaledZ,y,t.z,d,t.y).key]={backfilled:!1},M[new n.aQ(h.overscaledZ,S,t.z,b,t.y).key]={backfilled:!1},t.y>0&&(M[new n.aQ(h.overscaledZ,y,t.z,d,t.y-1).key]={backfilled:!1},M[new n.aQ(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},M[new n.aQ(h.overscaledZ,S,t.z,b,t.y-1).key]={backfilled:!1}),t.y+1<a&&(M[new n.aQ(h.overscaledZ,y,t.z,d,t.y+1).key]={backfilled:!1},M[new n.aQ(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},M[new n.aQ(h.overscaledZ,S,t.z,b,t.y+1).key]={backfilled:!1}),M}},"raster-array":_a,geojson:class extends n.E{constructor(h,t,a,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=a.getActor(),this.setEventedParent(d),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const y=n.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*y,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*y,extent:n.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*y,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new n.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new n.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const a of this._data.features)t.set(a.id,a);for(const a of h.features)t.set(a.id,a);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,a,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:a},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:h},this.workerOptions);t.scope=this.scope;const a=this._data;typeof a=="string"?(t.request=this.map._requestManager.transformRequest(n.o.resolveURL(a),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(a),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,((d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new n.y(d));else{const b={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(b.resourceTiming=y.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new n.z("data",b)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const h=n.B(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const a=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,y=d?{image:d.image.clone()}:null,b=this._partialReload,S={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:b,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};h.request=this.actor.send(a,S,((M,R)=>b&&!R?(h.state="loaded",t(null)):(delete h.request,h.destroy(!1),h.aborted?t(null):M?t(M):(h.loadVectorData(R,this.map.painter,a==="reloadTile"),t(null)))),void 0,a==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aU{constructor(h,t,a,d){super(h,t,a,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aV(this.urls,((t,a)=>{this._loaded=!0,t?this.fire(new n.y(t)):a&&(this.video=a,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new n.y(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aU,model:n.aX,"batched-model":class extends n.E{constructor(h,t,a,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=a,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(h)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map.getWorldview();this._tileJSONRequest=Ro(this._options,this.map._requestManager,t,a,((d,y)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),a&&a.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new n.y(d))):y&&(Object.assign(this,y),y.bounds&&(this.tileBounds=new _l(y.bounds,this.minzoom,this.maxzoom)),ai(y.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)}))}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const a=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(a,n.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:n.o.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const b=Object.values(h.buckets);for(const S of b)S.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,y.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,y.bind(this),void 0,!0);function y(b,S){return h.aborted?t(null):b&&b.status!==404?t(b):(this.map._refreshExpiredTiles&&S&&h.setExpiryData(S),h.loadModelData(S,this.map.painter),h.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends n.aU{constructor(h,t,a,d){super(h,t,a,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some((y=>!Array.isArray(y)||y.length!==2||y.some((b=>typeof b!="number"))))||this.fire(new n.y(new n.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.y(new n.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.y(new n.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.y(new n.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.y(new n.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof n.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends n.E{constructor(h,t,a,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=a,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _l(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,n.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:a,z:d}=h.canonical;return this._implementation.hasTile({x:t,y:a,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:a,y:d,z:y}=h.tileID.canonical,b=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:a,y:d,z:y},{signal:b.signal})).then((function(S){return delete h.request,h.aborted?(h.state="unloaded",t(null)):S===void 0?(h.state="errored",t(null)):S===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):(function(M){return M instanceof ImageData||M instanceof HTMLCanvasElement||M instanceof ImageBitmap||M instanceof HTMLImageElement})(S)?(this.loadTileData(h,S),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((S=>{S.name!=="AbortError"&&(h.state="errored",t(S))})),h.request.cancel=()=>b.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof n.T?(h.destroy(!1),h.texture&&h.texture instanceof n.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:a,y:d,z:y}=h.tileID.canonical;this._implementation.unloadTile({x:a,y:d,z:y})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z})))}_clearTiles(){const h=n.B(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}}},Ks=function(h,t,a,d){const y=new Mc[t.type](h,t,a,d);if(y.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${y.id}`);return n.aY(["load","abort","unload","serialize","prepare"],y),y};function jc(h,t,a=""){return`${a}:${t.id||""}:${t.layer.id}:${(function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:y,importId:b}=d;return`featureset:${y}${b?`:import:${b}`:""}`}})(h.target)}`}function Mh(h,t,a,d=""){if(h.uniqueFeatureID){const y=jc(h,t,d);if(a.has(y))return!0;a.add(y)}return!1}function ou(h,t,a,d,y=!1){const b=t.sourceCache.transform,S=t.sourceCache.tilesIn(h,t.has3DLayers,y);S.sort(Mu);const M=[];for(const R of S){const N=R.tile.queryRenderedFeatures(t,R,a,d,b,y);Object.keys(N).length&&M.push({wrappedTileID:R.tile.tileID.wrapped().key,queryResults:N})}for(const R in t.layers){const N=t.layers[R];if(N.styleLayer){const U=N.styleLayer.queryRenderedFeatures(h,t.sourceCache,d);Object.keys(U).length&&M.push({wrappedTileID:0,queryResults:U})}}return M.length===0?{}:(function(R){const N={},U={};for(const Y of R){const X=Y.queryResults,Q=Y.wrappedTileID,ae=U[Q]=U[Q]||{};for(const ie in X){const _e=X[ie],fe=ae[ie]=ae[ie]||{},Te=N[ie]=N[ie]||[];for(const De of _e)fe[De.featureIndex]||(fe[De.featureIndex]=!0,Te.push(De))}}return N})(M)}function Jh(h,t,a,d,y,b){const S={},M=d.queryRenderedSymbols(h),R=[];for(const N of Object.keys(M).map(Number))R.push(y[N]);R.sort(Mu);for(const N of R){const U=N.featureIndex.lookupSymbolFeatures(M[N.bucketInstanceId],N.bucketIndex,N.sourceLayerIndex,t,a,b);for(const Y in U){const X=S[Y]=S[Y]||[],Q=U[Y];Q.sort(((ae,ie)=>{const _e=N.featureSortOrder;if(_e){const fe=_e.indexOf(ae.featureIndex);return _e.indexOf(ie.featureIndex)-fe}return ie.featureIndex-ae.featureIndex}));for(const ae of Q)X.push(ae)}}return S}function Qh(h,t){const a=h.getRenderableIds().map((b=>h.getTileByID(b))),d=[],y={};for(let b=0;b<a.length;b++){const S=a[b],M=S.tileID.canonical.key;y[M]||(y[M]=!0,S.querySourceFeatures(d,t))}return d}function Mu(h,t){const a=h.tileID,d=t.tileID;return a.overscaledZ-d.overscaledZ||a.canonical.y-d.canonical.y||a.wrap-d.wrap||a.canonical.x-d.canonical.x}function Gc(h,t){const a={};if(!t)return a;for(const d of h){const y=d.layerIds.map((b=>t.getLayer(b))).filter(Boolean);if(y.length!==0){d.layers=y,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map((b=>y.filter((S=>S.id===b))[0])));for(const b of y)a[b.fqid]=d}}return a}const cc=32,lu=33,Cc=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,a=0,d=0,y=0,b=0,S=0,M=0;for(1&t?y=b=S=cc:a=d=M=cc;(t>>=1)>1;){const N=a+y>>1,U=d+b>>1;1&t?(y=a,b=d,a=S,d=M):(a=y,d=b,y=S,b=M),S=N,M=U}const R=4*h;Cc[R+0]=a,Cc[R+1]=d,Cc[R+2]=y,Cc[R+3]=b}const fo=new Uint16Array(2178),Xl=new Uint8Array(1089),Po=new Uint16Array(1089);function Eo(h){return h===0?-.03125:h===32?.03125:0}const cu={type:2,extent:n.al,loadGeometry:()=>[[new n.P(0,0),new n.P(n.al+1,0),new n.P(n.al+1,n.al+1),new n.P(0,n.al+1),new n.P(0,0)]]};class Cu{constructor(t,a,d,y,b,S){this.tileID=t,this.uid=n.b2(),this.uses=0,this.tileSize=a,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=b,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=S,this._hasAppearances=null}registerFadeDuration(t){const a=t+this.timeAdded;a<n.o.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,a,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Gc(t.buckets,a.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const b=this.buckets[y];if(b instanceof n.b4){if(this.hasSymbolBuckets=!0,!d)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const b=this.buckets[y];if(b instanceof n.b4&&b.hasRTLText){this.hasRTLText=!0,n.b5();break}}this.queryPadding=0;for(const y in this.buckets){const b=this.buckets[y],S=a.style.getOwnLayer(y);if(!S)continue;const M=S.queryRadius(b);this.queryPadding=Math.max(this.queryPadding,M)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,a,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Gc(t.buckets,a.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,a){for(const b in this.buckets){const S=this.buckets[b];if(S.uploadPending()){let M={},R=[],N={zoom:0,pitch:0,brightness:0,worldview:""};if(a){if(a.style){R=a.style.listImages();const U=S.layers[0],Y=U.sourceLayer||"_geojsonTileLayer",X=a.style.getLayerSourceCache(U);X&&(M=X._state.getState(Y,void 0))}N={zoom:a.transform.zoom||0,pitch:a.transform.pitch||0,brightness:a.style.getBrightness()||0,worldview:a.worldview||""}}S.upload(t,this.tileID.canonical,M,R,N)}}const d=t.gl,y=this.imageAtlas;y&&!y.uploaded&&(this.imageAtlasTexture=new n.T(t,y.image,d.RGBA8,{useMipmap:!!y.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,d.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,d.R8),this.lineAtlas.uploaded=!0)}prepare(t,a,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!a||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=a.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(a)),(this._lastUpdatedBrightness||y||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(a,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const a in this.buckets){const d=this.buckets[a];d.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,d.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,a,d,y,b,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const M=this.evaluateQueryRenderedFeaturePadding(),R=(function(N,U){const Y=n.bq([],[.5*N.width,.5*-N.height,1]);return n.br(Y,Y,[1,-1,0]),n.aB(Y,Y,N.calculateProjMatrix(U.toUnwrapped())),Float32Array.from(Y)})(b,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:a,pixelPosMatrix:R,transform:y,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:M})}querySourceFeatures(t,a){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const y=d.loadVTLayers(),b=a?a.sourceLayer:"",S=y._geojsonTileLayer||y[b];if(!S)return;const M=n.b6(a&&a.filter),{z:R,x:N,y:U}=this.tileID.canonical,Y={z:R,x:N,y:U};for(let X=0;X<S.length;X++){const Q=S.feature(X);if(M.needGeometry){const _e=n.b7(Q,!0);if(!M.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),_e,this.tileID.canonical))continue}else if(!M.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),Q))continue;const ae=d.getId(Q,b),ie=new n.b8(Q,R,N,U,ae);ie.tile=Y,t.push(ie)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const a=this.expirationTime;if(t.cacheControl){const d=n.b9(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let y=!1;if(this.expirationTime>d)y=!1;else if(a)if(this.expirationTime<a)y=!0;else{const b=this.expirationTime-a;b?this.expirationTime=d+Math.max(b,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const a in this.buckets)if(t.style.hasLayer(a)&&this.buckets[a].layers.some((d=>d.appearances&&d.appearances.length>0)))return!0;return!1}updateBuckets(t,a){if(!this.latestFeatureIndex||!t.style)return;const d=t.style.listImages(),y=t.style.getBrightness();for(const b in this.buckets){if(!t.style.hasLayer(b))continue;const S=this.buckets[b],M=S.layers[0],R=M.sourceLayer||"_geojsonTileLayer",N=t.style.getLayerSourceCache(M);let U={};N&&(U=N._state.getState(R,void 0));const Y=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},X=Object.keys(U).length>0&&!a;S.hasAppearances=S.layers.some((ie=>ie.appearances&&ie.appearances.length>0));const Q=X?S.stateDependentLayers:S.layers;if(X&&S.stateDependentLayers.length!==0||a){const ie=this.latestFeatureIndex.loadVTLayers();S.update(U,ie[R],d,Y,Q,a,y)}if(X&&S.stateDependentLayers.length!==0||a||S.hasAppearances){const ie={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};S.updateAppearances(this.tileID.canonical,U,d,ie)}(S instanceof n.ba||S instanceof n.bb)&&t._terrain&&t._terrain.enabled&&N&&S.uploadPending()&&t._terrain._clearRenderCacheForTile(N.id,this.tileID);const ae=t&&t.style&&t.style.getOwnLayer(b);ae&&(this.queryPadding=Math.max(this.queryPadding,ae.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.o.now()+t}setTexture(t,a){const d=a.context,y=d.gl;this.texture=this.texture||a.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(d,t,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(t,a){const d={};for(const y of a)d[y]=!0;this.dependencies[t]=d}hasDependency(t,a){for(const d of t){const y=this.dependencies[d];if(y){for(const b of a)if(y[b])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,a){if(!a||a.name==="mercator"||this._tileDebugBuffer)return;const d=n.bc(cu,this.tileID.canonical,this.tileTransform)[0],y=new n.bd,b=new n.be;for(let S=0;S<d.length;S++){const{x:M,y:R}=d[S];y.emplaceBack(M,R),b.emplaceBack(S)}b.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(y,n.bf.members),this._tileDebugSegments=n.bg.simpleSegment(0,0,y.length,b.length)}_makeTileBoundsBuffers(t,a){if(this._tileBoundsBuffer||!a||a.name==="mercator")return;const d=n.bc(cu,this.tileID.canonical,this.tileTransform)[0];let y,b;if(this.isRaster){const S=(function(M,R){const N=n.aZ(M,R),U=Math.pow(2,M.z);for(let _e=0;_e<lu;_e++)for(let fe=0;fe<lu;fe++){const Te=n.a_((M.x+(fe+Eo(fe))/cc)/U),De=n.a$((M.y+(_e+Eo(_e))/cc)/U),Se=R.project(Te,De),Ze=_e*lu+fe;fo[2*Ze+0]=Math.round((Se.x*N.scale-N.x)*n.al),fo[2*Ze+1]=Math.round((Se.y*N.scale-N.y)*n.al)}Xl.fill(0),Po.fill(0);for(let _e=2045;_e>=0;_e--){const fe=4*_e,Te=Cc[fe+0],De=Cc[fe+1],Se=Cc[fe+2],Ze=Cc[fe+3],Ve=Te+Se>>1,Ge=De+Ze>>1,Fe=Ve+Ge-De,Oe=Ge+Te-Ve,it=De*lu+Te,ft=Ze*lu+Se,ht=Ge*lu+Ve,St=Math.hypot((fo[2*it+0]+fo[2*ft+0])/2-fo[2*ht+0],(fo[2*it+1]+fo[2*ft+1])/2-fo[2*ht+1])>=16;Xl[ht]=Xl[ht]||(St?1:0),_e<1022&&(Xl[ht]=Xl[ht]||Xl[(De+Oe>>1)*lu+(Te+Fe>>1)]||Xl[(Ze+Oe>>1)*lu+(Se+Fe>>1)])}const Y=new n.b1,X=new n.b0;let Q=0;function ae(_e,fe){const Te=fe*lu+_e;return Po[Te]===0&&(Y.emplaceBack(fo[2*Te+0],fo[2*Te+1],_e*n.al/cc,fe*n.al/cc),Po[Te]=++Q),Po[Te]-1}function ie(_e,fe,Te,De,Se,Ze){const Ve=_e+Te>>1,Ge=fe+De>>1;if(Math.abs(_e-Se)+Math.abs(fe-Ze)>1&&Xl[Ge*lu+Ve])ie(Se,Ze,_e,fe,Ve,Ge),ie(Te,De,Se,Ze,Ve,Ge);else{const Fe=ae(_e,fe),Oe=ae(Te,De),it=ae(Se,Ze);X.emplaceBack(Fe,Oe,it)}}return ie(0,0,cc,cc,cc,0),ie(cc,cc,0,0,0,cc),{vertices:Y,indices:X}})(this.tileID.canonical,a);y=S.vertices,b=S.indices}else{y=new n.b1,b=new n.b0;for(const{x:M,y:R}of d)y.emplaceBack(M,R,0,0);const S=n.bh(y.int16.subarray(0,4*y.length),void 0,4);for(let M=0;M<S.length;M+=3)b.emplaceBack(S[M],S[M+1],S[M+2])}this._tileBoundsBuffer=t.createVertexBuffer(y,n.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(b),this._tileBoundsSegments=n.bg.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugBuffers(t,a){const d=a.projection;if(!d||d.name!=="globe"||a.freezeTileCoverage)return;const y=this.tileID.canonical,b=n.bj(y,a),S=n.bk(b),M=n.aj(a.zoom);let R;M>0&&(R=n.bl(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,y,a,S,R,M),this._makeGlobeTileDebugTextBuffer(t,y,a,S,R,M)}_globePoint(t,a,d,y,b,S,M){let R=n.bm(t,a,d);if(S){const N=1<<d.z,U=n.aF(y.center.lng),Y=n.aJ(y.center.lat),X=(d.x+.5)/N-U;let Q=0;X>.5?Q=-1:X<-.5&&(Q=1);let ae=(t/n.al+d.x)/N+Q,ie=(a/n.al+d.y)/N;ae=(ae-U)*y._pixelsPerMercatorPixel+U,ie=(ie-Y)*y._pixelsPerMercatorPixel+Y;const _e=[ae*y.worldSize,ie*y.worldSize,0];n.af(_e,_e,S),R=n.bn(R,_e,M)}return n.af(R,R,b)}_makeGlobeTileDebugBorderBuffer(t,a,d,y,b,S){const M=new n.bd,R=new n.be,N=new n.bo,U=(X,Q,ae,ie,_e)=>{const fe=(ae-X)/(_e-1),Te=(ie-Q)/(_e-1),De=M.length;for(let Se=0;Se<_e;Se++){const Ze=X+Se*fe,Ve=Q+Se*Te;M.emplaceBack(Ze,Ve);const Ge=this._globePoint(Ze,Ve,a,d,y,b,S);N.emplaceBack(Ge[0],Ge[1],Ge[2]),R.emplaceBack(De+Se)}},Y=n.al;U(0,0,Y,0,16),U(Y,0,Y,Y,16),U(Y,Y,0,Y,16),U(0,Y,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(R),this._tileDebugBuffer=t.createVertexBuffer(M,n.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(N,n.bp.members),this._tileDebugSegments=n.bg.simpleSegment(0,0,M.length,R.length)}_makeGlobeTileDebugTextBuffer(t,a,d,y,b,S){const M=n.al/4,R=new n.bd,N=new n.b0,U=new n.bo,Y=25;N.reserve(32),R.reserve(Y),U.reserve(Y);const X=(Q,ae)=>Y*Q+ae;for(let Q=0;Q<Y;Q++){const ae=Q*M;for(let ie=0;ie<Y;ie++){const _e=ie*M;R.emplaceBack(_e,ae);const fe=this._globePoint(_e,ae,a,d,y,b,S);U.emplaceBack(fe[0],fe[1],fe[2])}}for(let Q=0;Q<4;Q++)for(let ae=0;ae<4;ae++){const ie=X(Q,ae),_e=X(Q,ae+1),fe=X(Q+1,ae),Te=X(Q+1,ae+1);N.emplaceBack(ie,_e,fe),N.emplaceBack(fe,_e,Te)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(N),this._tileDebugTextBuffer=t.createVertexBuffer(R,n.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(U,n.bp.members),this._tileDebugTextSegments=n.bg.simpleSegment(0,0,Y,32)}destroy(t=!0){for(const a in this.buckets)this.buckets[a].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof n.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bs.setPbf(n.bt);class Ch extends Cu{constructor(t,a,d,y,b){super(t,a,d,y,b),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,a,d){const y=d.context,b=y.gl;let S=this.texturePerLayer.get(t)||d.getTileTexture(a.width);S&&S instanceof n.T?S.update(a,{premultiply:!1}):S=new n.T(y,a,b.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,S)}flushQueues(t){const a=this._workQueuePerLayer.get(t)||[],d=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const a=this._workQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const a=this._fetchQueuePerLayer.get(t)||[];for(;a.length;)a.pop()()}}fetchHeader(t=16384,a){const d=this._mrt=new n.bs(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.bu(y,((b,S,M)=>{if(b)a(b);else try{const R=d.getHeaderLength(S);if(R>t)return void(this.request=this.fetchHeader(R,a));d.parseHeader(S),this._isHeaderLoaded=!0;let N=0;for(const U of Object.values(d.layers))N=Math.max(N,U.dataIndex[U.dataIndex.length-1].lastByte);S.byteLength>=N&&(this.entireBuffer=S),a(null,this.entireBuffer||S,M)}catch(R){a(R)}})),this.request}fetchBandForRender(t,a,d,y){this.fetchBand(t,a,d,(b=>{if(b)return void y(b);this.updateTextureDescriptor(t,a,d);const S=this.textureDescriptorPerLayer.get(a);y(null,S?S.img:null)}))}fetchBand(t,a,d,y,b=!0){const S=this._mrt;if(!this._isHeaderLoaded||!S)return void y(new Error("Tile header is not ready"));const M=this.actor;if(!M)return void y(new Error("Can't fetch tile band without an actor"));let R;const N=n.B(String(d),n.B(this.tileID.key,t));let U=this._taskQueue.get(N);U?U.add(y):(U=new Set,U.add(y),this._taskQueue.set(N,U));const Y=(ie,_e)=>{R.complete(ie,_e),ie?y(ie):(U.forEach((fe=>fe(null,_e))),this._taskQueue.delete(N))},X=(ie,_e)=>{if(ie)return y(ie);const fe=M.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:_e,task:R},Y,void 0,!0);if(a!==null){const Te=this._workQueuePerLayer.get(a)||[];Te.push((()=>{fe&&fe.cancel(),R.cancel()})),this._workQueuePerLayer.has(a)||this._workQueuePerLayer.set(a,Te)}};let Q;try{Q=S.getLayer(t)}catch(ie){if(this.state==="reloading")return;throw ie}if(!Q)return void y(new Error(`Unknown sourceLayer "${t}"`));if(Q.hasDataForBand(d))return U.forEach((ie=>ie(null,null))),void this._taskQueue.delete(N);const ae=Q.getDataRange([d]);if(R=S.createDecodingTask(ae),!R||R.tasks.length)if(a!==null&&this.flushQueues(a),this.entireBuffer)X(null,this.entireBuffer.slice(ae.firstByte,ae.lastByte+1));else{const ie=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ae.firstByte}-${ae.lastByte}`}}),_e=n.bu(ie,X);if(a!==null){const fe=this._fetchQueuePerLayer.get(a)||[];fe.push((()=>{_e.cancel(),R.cancel()})),this._fetchQueuePerLayer.has(a)||this._fetchQueuePerLayer.set(a,fe)}}}updateNeeded(t,a){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==a||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,a,d){if(!this._mrt)return;const y=this._mrt.getLayer(t);if(!y||!y.hasBand(d)||!y.hasDataForBand(d))return;const{bytes:b,tileSize:S,buffer:M,offset:R,scale:N}=y.getBandView(d),U=S+2*M,Y=new n.q({width:U,height:U},b),X=this.texturePerLayer.get(a);X&&X instanceof n.T&&X.update(Y,{premultiply:!1}),this.textureDescriptorPerLayer.set(a,{layer:t,band:d,img:Y,buffer:M,offset:R,tileSize:S,format:y.pixelFormat,mix:[N,256*N,65536*N,16777216*N]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const a of this.texturePerLayer.values())a&&a instanceof n.T&&a.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Kf{constructor(t,a){this.max=t,this.onRemove=a,this.reset()}reset(){for(const t in this.data)for(const a of this.data[t])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(t,a,d){const y=t.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const b={value:a,timeout:void 0};if(d!==void 0&&(b.timeout=setTimeout((()=>{this.remove(t,b)}),d)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const a=this.data[t].shift();return a.timeout&&clearTimeout(a.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),a.value}getByKey(t){const a=this.data[t];return a?a[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,a){if(!this.has(t))return this;const d=t.wrapped().key,y=a===void 0?0:this.data[d].indexOf(a),b=this.data[d][y];return this.data[d].splice(y,1),b.timeout&&clearTimeout(b.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(b.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(t){const a=[];for(const d in this.data)for(const y of this.data[d])t(y.value)||a.push(y);for(const d of a)this.remove(d.value.tileID,d)}}class zc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,a,d){const y=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][y]=this.stateChanges[t][y]||{},Object.assign(this.stateChanges[t][y],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const b in this.state[t])b!==y&&(this.deletedStates[t][b]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][y]===null){this.deletedStates[t][y]={};for(const b in this.state[t][y])d[b]||(this.deletedStates[t][y][b]=null)}else for(const b in d)this.deletedStates[t]&&this.deletedStates[t][y]&&this.deletedStates[t][y][b]===null&&delete this.deletedStates[t][y][b]}removeFeatureState(t,a,d){if(this.deletedStates[t]===null)return;const y=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&a!==void 0)this.deletedStates[t][y]!==null&&(this.deletedStates[t][y]=this.deletedStates[t][y]||{},this.deletedStates[t][y][d]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][y])for(d in this.deletedStates[t][y]={},this.stateChanges[t][y])this.deletedStates[t][y][d]=null;else this.deletedStates[t][y]=null;else this.deletedStates[t]=null}getState(t,a){const d=this.state[t]||{},y=this.stateChanges[t]||{},b=this.deletedStates[t];if(b===null)return{};if(a!==void 0){const M=String(a),R=Object.assign({},d[M],y[M]);if(b){const N=b[a];if(N===null)return{};for(const U in N)delete R[U]}return R}const S=Object.assign({},d,y);if(b)for(const M in b)delete S[M];return S}initializeTileState(t,a){t.refreshFeatureState(a)}coalesceChanges(t,a){const d={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const b={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),Object.assign(this.state[y][S],this.stateChanges[y][S]),b[S]=this.state[y][S];d[y]=b}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const b={};if(this.deletedStates[y]===null)for(const S in this.state[y])b[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else if(this.state[y][S])for(const M of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][M];b[S]=this.state[y][S]}d[y]=d[y]||{},Object.assign(d[y],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const y in t)t[y].refreshFeatureState(a)}}class Go extends n.E{constructor(t,a,d){super(),this.id=t,this._onlySymbols=d,a.on("data",(y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),a.on("error",(()=>{this._sourceErrored=!0})),this._source=a,this._tiles={},this._cache=new Kf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new zc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,a){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,a)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const d=this._tiles[a];d.upload(t,this.map?this.map.painter:void 0),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((t=>t.tileID)).sort(Ed).map((t=>t.key))}getRenderableIds(t,a){const d=[];for(const y in this._tiles)this._isIdRenderable(+y,t,a)&&d.push(this._tiles[y]);return t?d.sort(((y,b)=>{const S=y.tileID,M=b.tileID,R=new n.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),N=new n.P(M.canonical.x,M.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-M.overscaledZ||N.y-R.y||N.x-R.x})).map((y=>y.tileID.key)):d.map((y=>y.tileID)).sort(Ed).map((y=>y.key))}hasRenderableParent(t){const a=this.findLoadedParent(t,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(t,a,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(a||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,a){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=a),this._loadTile(d,this._tileLoaded.bind(this,d,t,a)))}_tileLoaded(t,a,d,y,b){if(y){if(t.state="errored",y.status!==404)this._source.fire(new n.y(y,{tile:t}));else{if(this._source.fire(new n.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const M=this.map.painter.terrain;this.update(this.transform,M.getScaledDemTileSize(),!0),M.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=n.o.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(a,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let S=new Map;b&&b.responseHeaders&&(S=b.responseHeaders),this._source.fire(new n.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:S}))}_backfillDEM(t){const a=this.getRenderableIds();for(let y=0;y<a.length;y++){const b=a[y];if(t.neighboringTiles&&t.neighboringTiles[b]){const S=this.getTileByID(b);d(t,S),d(S,t)}}function d(y,b){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let S=b.tileID.canonical.x-y.tileID.canonical.x;const M=b.tileID.canonical.y-y.tileID.canonical.y,R=Math.pow(2,y.tileID.canonical.z),N=b.tileID.key;S===0&&M===0||Math.abs(M)>1||(Math.abs(S)>1&&(Math.abs(S+R)===1?S+=R:Math.abs(S-R)===1&&(S-=R)),b.dem&&y.dem&&(y.dem.backfillBorder(b.dem,S,M),y.neighboringTiles&&y.neighboringTiles[N]&&(y.neighboringTiles[N].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,a,d,y){for(const b in this._tiles){let S=this._tiles[b];if(y[b]||!S.hasData()||S.tileID.overscaledZ<=a||S.tileID.overscaledZ>d)continue;let M=S.tileID;for(;S&&S.tileID.overscaledZ>a+1;){const N=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[N.key],S&&S.hasData()&&(M=N)}let R=M;for(;R.overscaledZ>a;)if(R=R.scaledTo(R.overscaledZ-1),t[R.key]){y[M.key]=M;break}}}findLoadedParent(t,a){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=a?d:null}for(let d=t.overscaledZ-1;d>=a;d--){const y=t.scaledTo(d),b=this._getLoadedTile(y);if(b)return b}}_getLoadedTile(t){const a=this._tiles[t.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,a){a=a||this._source.tileSize;const d=Math.ceil(t.width/a)+1,y=Math.ceil(t.height/a)+1,b=Math.floor(d*y*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,b):b,M=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(M)}handleWrapJump(t){const a=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,a){const d={};for(const y in this._tiles){const b=this._tiles[y];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+a),d[b.tileID.key]=b}this._tiles=d;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(t,a,d,y,b){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,a),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let M,R=this._source.maxzoom;const N=this.map&&this.map.painter?this.map.painter._terrain:null;if(N&&N.sourceCache===this&&N.attenuationRange()){const X=N.attenuationRange()[0],Q=Math.floor(X)-Math.log2(N.getDemUpscale());R>Q&&(R=Q)}if(this.used||this.usedForTerrain){if(this._source.tileID)M=t.getVisibleUnwrappedCoordinates(this._source.tileID).map((X=>new n.aQ(X.canonical.z,X.wrap,X.canonical.z,X.canonical.x,X.canonical.y)));else if(this.tileCoverLift!==0){const X=t.clone();X.tileCoverLift=this.tileCoverLift,M=X.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&t.projection.name==="globe"&&(M.push(new n.aQ(1,0,1,0,0)),M.push(new n.aQ(1,0,1,1,0)),M.push(new n.aQ(1,0,1,0,1)),M.push(new n.aQ(1,0,1,1,1)))}else if(M=t.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:R,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const X=this._source.hasTile.bind(this._source);M=M.filter((Q=>X(Q)))}}else M=[];if(M.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!uu(this._source.type)){const X=t.coveringZoomLevel({tileSize:a||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),Q=Math.min(X,this._source.maxzoom);if(S){const ae=t.extendTileCover(M,Q);for(const ie of ae)M.push(ie)}else if(b){const ae=t.extendTileCoverToNearPlane(M,this.transform.getFrustum(Q),Q);for(const ie of ae)M.push(ie)}else if(this.castsShadows&&y){const ae=t.extendTileCover(M,Q,y,16);for(const ie of ae)this._shadowCasterTiles[ie.key]=!0,M.push(ie)}}const U=this._updateRetainedTiles(M);if(uu(this._source.type)&&M.length!==0){const X={},Q={},ae=Object.keys(U);for(const _e of ae){const fe=U[_e],Te=this._tiles[_e];if(!Te||Te.fadeEndTime&&Te.fadeEndTime<=n.o.now())continue;const De=this.findLoadedParent(fe,Math.max(fe.overscaledZ-Go.maxOverzooming,this._source.minzoom));De&&(this._addTile(De.tileID),X[De.tileID.key]=De.tileID),Q[_e]=fe}const ie=M[M.length-1].overscaledZ;for(const _e in this._tiles){const fe=this._tiles[_e];if(U[_e]||!fe.hasData())continue;let Te=fe.tileID;for(;Te.overscaledZ>ie;){Te=Te.scaledTo(Te.overscaledZ-1);const De=this._tiles[Te.key];if(De&&De.hasData()&&Q[Te.key]){U[_e]=fe.tileID;break}}}for(const _e in X)U[_e]||(this._coveredTiles[_e]=!0,U[_e]=X[_e])}for(const X in U)this._tiles[X].clearFadeHold();const Y=n.bv(this._tiles,U);for(const X of Y){const Q=this._tiles[X];Q.hasSymbolBuckets&&!Q.holdingForFade()?Q.setHoldDuration(this.map._fadeDuration):Q.hasSymbolBuckets&&!Q.symbolFadeFinished()||this._removeTile(+X)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const a={};if(t.length===0)return a;const d={},y=t.reduce(((N,U)=>Math.min(N,U.overscaledZ)),1/0),b=t[0].overscaledZ,S=Math.max(b-Go.maxOverzooming,this._source.minzoom),M=Math.max(b+Go.maxUnderzooming,this._source.minzoom),R={};for(const N of t){const U=this._addTile(N);a[N.key]=N,U.hasData()||y<this._source.maxzoom&&(R[N.key]=N)}this._retainLoadedChildren(R,y,M,a);for(const N of t){let U=this._tiles[N.key];if(U.hasData())continue;if(N.canonical.z>=this._source.maxzoom){const X=N.children(this._source.maxzoom)[0],Q=this.getTile(X);if(Q&&Q.hasData()){a[X.key]=X;continue}}else{const X=N.children(this._source.maxzoom);if(a[X[0].key]&&a[X[1].key]&&a[X[2].key]&&a[X[3].key])continue}let Y=U.wasRequested();for(let X=N.overscaledZ-1;X>=S;--X){const Q=N.scaledTo(X);if(d[Q.key]||(d[Q.key]=!0,U=this.getTile(Q),!U&&Y&&(U=this._addTile(Q)),U&&(a[Q.key]=Q,Y=U.wasRequested(),U.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const a=[];let d,y=this._tiles[t].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){d=this._loadedParentTiles[y.key];break}a.push(y.key);const b=y.scaledTo(y.overscaledZ-1);if(d=this._getLoadedTile(b),d)break;y=b}for(const b of a)this._loadedParentTiles[b]=d}}_addTile(t){let a=this._tiles[t.key];if(a)return a.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),a;a=this._cache.getAndRemove(t),a&&(this._setTileReloadTimer(t.key,a),a.tileID=t,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,a)));const d=!!a;if(!d){const y=this.map?this.map.painter:null,b=this._source.tileSize*t.overscaleFactor();a=this._source.type==="raster-array"?new Ch(t,b,this.transform.tileZoom,y,this._isRaster):new Cu(t,b,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(a,this._tileLoaded.bind(this,a,t.key,a.state))}return a.uses++,this._tiles[t.key]=a,d||this._source.fire(new n.z("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a}_setTileReloadTimer(t,a){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=a.getExpiryTimeout();d&&(this._timers[t]=setTimeout((()=>{this._reloadTile(t,"expired"),delete this._timers[t]}),d))}_removeTile(t){const a=this._tiles[t];a&&(a.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),a.uses>0||(a.hasData()&&a.state!=="reloading"||a.state==="empty"?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,a,d){const y=[],b=this.transform;if(!b)return y;const S=b.projection.name==="globe",M=n.aF(b.center.lng);for(const R in this._tiles){const N=this._tiles[R];if(d&&N.clearQueryDebugViz(),N.holdingForFade())continue;let U;if(S){const Y=N.tileID.canonical;if(Y.z===0){const X=[Math.abs(n.aA(M,...Wl(Y,-1))-M),Math.abs(n.aA(M,...Wl(Y,1))-M)];U=[0,2*X.indexOf(Math.min(...X))-1]}else{const X=[Math.abs(n.aA(M,...Wl(Y,-1))-M),Math.abs(n.aA(M,...Wl(Y,0))-M),Math.abs(n.aA(M,...Wl(Y,1))-M)];U=[X.indexOf(Math.min(...X))-1]}}else U=[0];for(const Y of U){const X=t.containsTile(N,b,a,Y);X&&y.push(X)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,a){const d=this.getRenderableIds(t,a).map((b=>this._tiles[b].tileID)),y=this.transform.projection.name==="globe";for(const b of d)b.projMatrix=this.transform.calculateProjMatrix(b.toUnwrapped()),b.expandedProjMatrix=y?this.transform.calculateProjMatrix(b.toUnwrapped(),!1,!0):b.projMatrix;return d}sortCoordinatesByDistance(t){const a=t.slice(),d=this.transform._camera.position,y=this.transform._camera.forward(),b={};for(const S of a){const M=1/(1<<S.canonical.z);b[S.key]=((S.canonical.x+.5)*M+S.wrap-d[0])*y[0]+((S.canonical.y+.5)*M-d[1])*y[1]-d[2]*y[2]}return a.sort(((S,M)=>b[S.key]-b[M.key])),a}hasTransition(){if(this._source.hasTransition())return!0;if(uu(this._source.type))for(const t in this._tiles){const a=this._tiles[t];if(a.fadeEndTime!==void 0&&a.fadeEndTime>=n.o.now())return!0}return!1}setFeatureState(t,a,d){this._state.updateState(t=t||"_geojsonTileLayer",a,d)}removeFeatureState(t,a,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",a,d)}getFeatureState(t,a){return this._state.getState(t=t||"_geojsonTileLayer",a)}setDependencies(t,a,d){const y=this._tiles[t];y&&y.setDependencies(a,d)}reloadTilesForDependencies(t,a){for(const d in this._tiles)this._tiles[d].hasDependency(t,a)&&this._reloadTile(+d,"reloading");this._cache.filter((d=>!d.hasDependency(t,a)))}_preloadTiles(t,a){if(!this._sourceLoaded){const R=()=>{this._sourceLoaded&&(this._source.off("data",R),this._preloadTiles(t,a))};return void this._source.on("data",R)}const d=new Map,y=Array.isArray(t)?t:[t],b=this.map.painter.terrain,S=this.usedForTerrain&&b?b.getScaledDemTileSize():this._source.tileSize;for(const R of y){const N=R.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const U of N)d.set(U.key,U);this.usedForTerrain&&R.updateElevation(!1)}const M=Array.from(d.values());n.bw(M,((R,N)=>{const U=new Cu(R,this._source.tileSize*R.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(U,(Y=>{this._source.type==="raster-dem"&&U.dem&&this._backfillDEM(U),N(Y,U)}))}),a)}}function Ed(h,t){const a=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||d-a||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function uu(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function Wl(h,t){const a=1<<h.z;return[h.x/a+t,(h.x+1)/a+t]}Go.maxOverzooming=10,Go.maxUnderzooming=3;class Ep{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,a=!1;for(const d in this.style._mergedLayers){const y=this.style._mergedLayers[d];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:t,visibilityChanged:a});else if(y.type==="model"){const b=this.style.getLayerSource(y);b&&b.type==="batched-model"&&this.layers.push({layer:y,visible:t,visibilityChanged:a})}}}onNewFrame(t){this.layersGotHidden=!1;for(const a of this.layers){const d=a.layer;let y=!1;d.type==="fill-extrusion"?y=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?y=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(y=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&a.visible,a.visible=y}}updateZOffset(t,a){this.currentBuildingBuckets=[];for(const y of this.layers){const b=y.layer,S=this.style.getLayerSourceCache(b);let M=1;b.type==="fill-extrusion"?M=y.visible?b.paint.get("fill-extrusion-vertical-scale"):0:b.type==="building"&&(M=y.visible?b.paint.get("building-vertical-scale"):0);let R=S?S.getTile(a):null;if(!R&&S)for(const N in S._tiles){const U=S._tiles[N];if(a.canonical.isChildOf(U.tileID.canonical)){R=U;break}}this.currentBuildingBuckets.push({bucket:R?R.getBucket(b):null,tileID:R?R.tileID:a,verticalScale:M})}t.hasAnyZOffset=!1;let d=!1;for(let y=0;y<t.symbolInstances.length;y++){const b=t.symbolInstances.get(y),S=b.zOffset,M=this._getHeightAtTileOffset(a,b.tileAnchorX,b.tileAnchorY);b.zOffset=M!==Number.NEGATIVE_INFINITY?M:S,d||S===b.zOffset||(d=!0),t.hasAnyZOffset||b.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,a,d,y){let b=a,S=d;if(t.canonical.z!==y.canonical.z){const M=y.canonical,R=1/(1<<t.canonical.z-M.z);b=(a+t.canonical.x*n.al)*R-M.x*n.al|0,S=(d+t.canonical.y*n.al)*R-M.y*n.al|0}return{tileX:b,tileY:S}}_getHeightAtTileOffset(t,a,d){let y,b;for(let S=0;S<this.layers.length;++S){const M=this.layers[S].layer;if(M.type!=="fill-extrusion"&&M.type!=="building")continue;const{bucket:R,tileID:N,verticalScale:U}=this.currentBuildingBuckets[S];if(!R)continue;const{tileX:Y,tileY:X}=this._mapCoordToOverlappingTile(t,a,d,N),Q=R.getHeightAtTileCoord(Y,X);Q&&Q.height!==void 0&&(Q.hidden?y=Q.height:b=Math.max(Q.height*U,b||0))}if(b!==void 0)return b;for(let S=0;S<this.layers.length;++S){const M=this.layers[S];if(M.layer.type!=="model"||!M.visible)continue;const{bucket:R,tileID:N}=this.currentBuildingBuckets[S];if(!R)continue;const{tileX:U,tileY:Y}=this._mapCoordToOverlappingTile(t,a,d,N),X=R.getHeightAtTileCoord(U,Y);if(X&&!X.hidden)return X.height===void 0&&y!==void 0?Math.min(X.maxHeight,y)*X.verticalScale:X.height?X.height*X.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Hd(h,t){const a={};for(const d in h)d!=="ref"&&(a[d]=h[d]);return n.bx.forEach((d=>{d in t&&(a[d]=t[d])})),a}function rh(h){h=h.slice();const t=Object.create(null);for(let a=0;a<h.length;a++)t[h[a].id]=h[a];for(let a=0;a<h.length;a++)"ref"in h[a]&&(h[a]=Hd(h[a],t[h[a].ref]));return h}const Wr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ah(h,t,a){a.push({command:Wr.addSource,args:[h,t[h]]})}function $d(h,t,a){t.push({command:Wr.removeSource,args:[h]}),a[h]=!0}function Cl(h,t,a,d){$d(h,a,d),ah(h,t,a)}function zl(h,t,a){let d;for(d in h[a])if(h[a].hasOwnProperty(d)&&d!=="data"&&!n.by(h[a][d],t[a][d]))return!1;for(d in t[a])if(t[a].hasOwnProperty(d)&&d!=="data"&&!n.by(h[a][d],t[a][d]))return!1;return!0}function zu(h,t,a,d,y,b){let S;for(S in t=t||{},h=h||{})h.hasOwnProperty(S)&&(n.by(h[S],t[S])||a.push({command:b,args:[d,S,t[S],y]}));for(S in t)t.hasOwnProperty(S)&&!h.hasOwnProperty(S)&&(n.by(h[S],t[S])||a.push({command:b,args:[d,S,t[S],y]}))}function Du(h){return h.id}function Ru(h,t){return h[t.id]=t,h}function hu(h,t,a){const d=t.createTileMatrix(h,h.worldSize,a.toUnwrapped());return n.aB(new Float32Array(16),h.projMatrix,d)}function ns(h,t,a){if(t.projection.name===a.projection.name)return h.projMatrix;const d=a.clone();return d.setProjection(t.projection),hu(d,t.getProjection(),h)}function Dl(h,t,a){return t.name===a.projection.name?h.projMatrix:hu(a,t,h)}class ed{constructor(t,a){this.reset(t,a)}reset(t,a){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(a||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.aA(t,0,1);let a=1,d=this._distances[a];const y=t*this.paddedLength+this.padding;for(;d<y&&a<this._distances.length;)d=this._distances[++a];const b=a-1,S=this._distances[b],M=d-S,R=M>0?(y-S)/M:0;return this.points[b].mult(1-R).add(this.points[a].mult(R))}}class zh{constructor(t,a,d){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(a/d);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=a,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/a,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,a,d,y,b){this._forEachCell(a,d,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(t,a,d,y){this._forEachCell(a-y,d-y,a+y,d+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(a),this.circles.push(d),this.circles.push(y)}_insertBoxCell(t,a,d,y,b,S){this.boxCells[b].push(S)}_insertCircleCell(t,a,d,y,b,S){this.circleCells[b].push(S)}_query(t,a,d,y,b,S){if(d<0||t>this.width||y<0||a>this.height)return!b&&[];const M=[];if(t<=0&&a<=0&&this.width<=d&&this.height<=y){if(b)return!0;for(let R=0;R<this.boxKeys.length;R++)M.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(let R=0;R<this.circleKeys.length;R++){const N=this.circles[3*R],U=this.circles[3*R+1],Y=this.circles[3*R+2];M.push({key:this.circleKeys[R],x1:N-Y,y1:U-Y,x2:N+Y,y2:U+Y})}return S?M.filter(S):M}return this._forEachCell(t,a,d,y,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?M.length>0:M}_queryCircle(t,a,d,y,b){const S=t-d,M=t+d,R=a-d,N=a+d;if(M<0||S>this.width||N<0||R>this.height)return!y&&[];const U=[];return this._forEachCell(S,R,M,N,this._queryCellCircle,U,{hitTest:y,circle:{x:t,y:a,radius:d},seenUids:{box:{},circle:{}}},b),y?U.length>0:U}query(t,a,d,y,b){return this._query(t,a,d,y,!1,b)}hitTest(t,a,d,y,b){return this._query(t,a,d,y,!0,b)}hitTestCircle(t,a,d,y){return this._queryCircle(t,a,d,!0,y)}_queryCell(t,a,d,y,b,S,M,R){const N=M.seenUids,U=this.boxCells[b];if(U!==null){const X=this.bboxes;for(const Q of U)if(!N.box[Q]){N.box[Q]=!0;const ae=4*Q;if(t<=X[ae+2]&&a<=X[ae+3]&&d>=X[ae+0]&&y>=X[ae+1]&&(!R||R(this.boxKeys[Q]))){if(M.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Q],x1:X[ae],y1:X[ae+1],x2:X[ae+2],y2:X[ae+3]})}}}const Y=this.circleCells[b];if(Y!==null){const X=this.circles;for(const Q of Y)if(!N.circle[Q]){N.circle[Q]=!0;const ae=3*Q;if(this._circleAndRectCollide(X[ae],X[ae+1],X[ae+2],t,a,d,y)&&(!R||R(this.circleKeys[Q]))){if(M.hitTest)return S.push(!0),!0;{const ie=X[ae],_e=X[ae+1],fe=X[ae+2];S.push({key:this.circleKeys[Q],x1:ie-fe,y1:_e-fe,x2:ie+fe,y2:_e+fe})}}}}}_queryCellCircle(t,a,d,y,b,S,M,R){const N=M.circle,U=M.seenUids,Y=this.boxCells[b];if(Y!==null){const Q=this.bboxes;for(const ae of Y)if(!U.box[ae]){U.box[ae]=!0;const ie=4*ae;if(this._circleAndRectCollide(N.x,N.y,N.radius,Q[ie+0],Q[ie+1],Q[ie+2],Q[ie+3])&&(!R||R(this.boxKeys[ae])))return S.push(!0),!0}}const X=this.circleCells[b];if(X!==null){const Q=this.circles;for(const ae of X)if(!U.circle[ae]){U.circle[ae]=!0;const ie=3*ae;if(this._circlesCollide(Q[ie],Q[ie+1],Q[ie+2],N.x,N.y,N.radius)&&(!R||R(this.circleKeys[ae])))return S.push(!0),!0}}}_forEachCell(t,a,d,y,b,S,M,R){const N=this._convertToXCellCoord(t),U=this._convertToYCellCoord(a),Y=this._convertToXCellCoord(d),X=this._convertToYCellCoord(y);for(let Q=N;Q<=Y;Q++)for(let ae=U;ae<=X;ae++)if(b.call(this,t,a,d,y,this.xCellCount*ae+Q,S,M,R))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,a,d,y,b,S){const M=y-t,R=b-a,N=d+S;return N*N>M*M+R*R}_circleAndRectCollide(t,a,d,y,b,S,M){const R=(S-y)/2,N=Math.abs(t-(y+R));if(N>R+d)return!1;const U=(M-b)/2,Y=Math.abs(a-(b+U));if(Y>U+d)return!1;if(N<=R||Y<=U)return!0;const X=N-R,Q=Y-U;return X*X+Q*Q<=d*d}}const td={unknown:0,flipRequired:1,flipNotRequired:2},id=Math.tan(85*Math.PI/180);function Rl(h,t,a,d,y,b,S){const M=n.bC();if(a)if(b.name==="globe"){const R=n.bD(y,t);n.aB(M,M,R)}else{const R=n.bE([],S);M[0]=R[0],M[1]=R[1],M[4]=R[2],M[5]=R[3],d||n.bB(M,M,y.angle)}else n.aB(M,y.labelPlaneMatrix,h);return M}function Ad(h,t,a,d,y,b,S){const M=Rl(h,t,a,d,y,b,S);return b.name==="globe"&&a||(M[2]=M[6]=M[10]=M[14]=0),M}function Id(h,t,a,d,y,b,S){if(a){if(b.name==="globe"){const M=Rl(h,t,a,d,y,b,S);return n.bl(M,M),n.aB(M,h,M),M}{const M=n.bz(h),R=n.bA([]);return R[0]=S[0],R[1]=S[1],R[4]=S[2],R[5]=S[3],n.aB(M,M,R),d||n.bB(M,M,-y.angle),M}}return y.glCoordMatrix}function qc(h,t,a,d){const y=[h,t,a,1];a?n.aC(y,y,d):En(y,y,d);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function Ta(h,t){return Math.min(.5+h/t*.5,1.5)}function Ap(h,t){const a=h[0]/h[3],d=h[1]/h[3];return a>=-t[0]&&a<=t[0]&&d>=-t[1]&&d<=t[1]}function Ip(h,t,a,d,y,b,S,M,R,N,U=1){const Y=a.transform,X=d?h.textSizeData:h.iconSizeData,Q=n.bK(X,a.transform.zoom,U),ae=Y.projection.name==="globe",ie=[256/a.width*2+1,256/a.height*2+1],_e=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;_e.clear();let fe=null;ae&&(fe=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const Te=h.lineVertexArray,De=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,Se=a.transform.width/a.transform.height;let Ze,Ve=!1;for(let Ge=0;Ge<De.length;Ge++){const Fe=De.get(Ge),{numGlyphs:Oe,writingMode:it}=Fe;if(it!==n.bL.vertical||Ve||Ze===n.bL.horizontal||(Ve=!0),Ze=it,(Fe.hidden||it===n.bL.vertical)&&!Ve){Dc(Oe,_e);continue}Ve=!1;const ft=new n.P(Fe.tileAnchorX,Fe.tileAnchorY),ht=h.elevationType==="road",St=!!Y.elevation||ht;let{x:It,y:zt,z:Jt}=Y.projection.projectTilePoint(ft.x,ft.y,N.canonical),gt=null;if(St){const Qi=ht?h.getElevationFeatureForText(Ge):null;gt={getElevation:R,elevation:Y.elevation,elevationFeature:Qi};const[vn,rr,Br]=R(ft,Y.elevation,Qi);It+=vn,zt+=rr,Jt+=Br}const nt=[It,zt,Jt,1];if(n.aC(nt,nt,t),!Ap(nt,ie)){Dc(Oe,_e);continue}const Bt=nt[3],Dt=Ta(a.transform.getCameraToCenterDistance(Y.projection),Bt),li=n.bM(X,Q,Fe),Ei=S?li/Dt:li*Dt,Ri=qc(It,zt,Jt,y);if(Ri[3]<=0){Dc(Oe,_e);continue}let Ti={};const mi=n.an(h.layers[0].layout.get("text-max-angle")),pn=Math.cos(mi),en=S?null:gt,ji=Mp(Fe,Ei,!1,M,t,y,b,h.glyphOffsetArray,Te,_e,fe,Ri,ft,Ti,Se,en,Y.projection,N,S,pn);Ve=ji.useVertical,en&&ji.needsFlipping&&(Ti={}),(ji.notEnoughRoom||Ve||ji.needsFlipping&&Mp(Fe,Ei,!0,M,t,y,b,h.glyphOffsetArray,Te,_e,fe,Ri,ft,Ti,Se,en,Y.projection,N,S,pn).notEnoughRoom)&&Dc(Oe,_e)}d?(h.text.dynamicLayoutVertexBuffer.updateData(_e),fe&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(fe)):(h.icon.dynamicLayoutVertexBuffer.updateData(_e),fe&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(fe))}function Dh(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e){const{lineStartIndex:fe,glyphStartIndex:Te,segment:De}=M,Se=Te+M.numGlyphs,Ze=fe+M.lineLength,Ve=t.getoffsetX(Te),Ge=t.getoffsetX(Se-1),Fe=nd(h*Ve,a,d,y,b,S,De,fe,Ze,R,N,U,Y,X,!0,Q,ae,ie,_e);if(!Fe)return null;const Oe=nd(h*Ge,a,d,y,b,S,De,fe,Ze,R,N,U,Y,X,!0,Q,ae,ie,_e);return Oe?{first:Fe,last:Oe}:null}function Gn(h,t,a,d){return h===n.bL.horizontal&&Math.abs(d)>Math.abs(a)?{useVertical:!0}:h===n.bL.vertical?d>0?{needsFlipping:!0}:null:t!==td.unknown&&(function(y,b){return y===0||Math.abs(b/y)>id})(a,d)?t===td.flipRequired?{needsFlipping:!0}:null:a<0?{needsFlipping:!0}:null}function Mp(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e,fe,Te,De){const Se=t/24,Ze=h.lineOffsetX*Se,Ve=h.lineOffsetY*Se,{lineStartIndex:Ge,glyphStartIndex:Fe,numGlyphs:Oe,segment:it,writingMode:ft,flipState:ht}=h,St=Ge+h.lineLength,It=zt=>{if(U){const[Bt,Dt,li]=zt.up,Ei=N.length;n.bN(U,Ei+0,Bt,Dt,li),n.bN(U,Ei+1,Bt,Dt,li),n.bN(U,Ei+2,Bt,Dt,li),n.bN(U,Ei+3,Bt,Dt,li)}const[Jt,gt,nt]=zt.point;n.bO(N,Jt,gt,nt,zt.angle)};if(Oe>1){const zt=Dh(Se,M,Ze,Ve,a,Y,X,h,R,b,Q,ie,!1,_e,fe,Te,De);if(!zt)return{notEnoughRoom:!0};if(d&&!a){let[Jt,gt,nt]=zt.first.point,[Bt,Dt,li]=zt.last.point;[Jt,gt]=qc(Jt,gt,nt,S),[Bt,Dt]=qc(Bt,Dt,li,S);const Ei=Gn(ft,ht,(Bt-Jt)*ae,Dt-gt);if(h.flipState=Ei&&Ei.needsFlipping?td.flipRequired:td.flipNotRequired,Ei)return Ei}It(zt.first);for(let Jt=Fe+1;Jt<Fe+Oe-1;Jt++){const gt=nd(Se*M.getoffsetX(Jt),Ze,Ve,a,Y,X,it,Ge,St,R,b,Q,ie,!1,!1,_e,fe,Te,De);if(!gt)return N.length-=4*(Jt-Fe),{notEnoughRoom:!0};It(gt)}It(zt.last)}else{if(d&&!a){const Jt=qc(X.x,X.y,0,y),gt=Ge+it+1,nt=new n.P(R.getx(gt),R.gety(gt)),Bt=qc(nt.x,nt.y,0,y),Dt=Bt[3]>0?Bt:Yl(X,nt,Jt,1,y,void 0,_e,fe.canonical),li=Gn(ft,ht,(Dt[0]-Jt[0])*ae,Dt[1]-Jt[1]);if(h.flipState=li&&li.needsFlipping?td.flipRequired:td.flipNotRequired,li)return li}const zt=nd(Se*M.getoffsetX(Fe),Ze,Ve,a,Y,X,it,Ge,St,R,b,Q,ie,!1,!1,_e,fe,Te,De);if(!zt)return{notEnoughRoom:!0};It(zt)}return{}}function Zd(h,t,a,d,y){const{x:b,y:S,z:M}=d.projectTilePoint(h.x,h.y,t);if(!y)return qc(b,S,M,a);const[R,N,U]=y.getElevation(h,y.elevation,y.elevationFeature);return qc(b+R,S+N,M+U,a)}function Yl(h,t,a,d,y,b,S,M){const R=Zd(h.sub(t)._unit()._add(h),M,y,S,b);return n.av(R,a,R),n.aw(R,R),n.bH(R,a,R,d)}function nd(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e,fe,Te){const De=d?h-t:h+t;let Se=De>0?1:-1,Ze=0;d&&(Se*=-1,Ze=Math.PI),Se<0&&(Ze+=Math.PI);let Ve=M+S+(Se>0?0:1)|0,Ge=y,Fe=y,Oe=0,it=0;const ft=Math.abs(De),ht=[],St=[];let It=b,zt=It,Jt=n.bF([]);const gt=()=>Yl(zt,It,Fe,ft-Oe+1,U,X,ie,_e.canonical);for(;Oe+it<=ft;){if(Ve+=Se,Ve<M||Ve>=R)return null;if(Fe=Ge,zt=It,ht.push(Fe),Q&&St.push(zt),It=new n.P(N.getx(Ve),N.gety(Ve)),Ge=Y[Ve],!Ge){const en=Zd(It,_e.canonical,U,ie,X);Ge=en[3]>0?Y[Ve]=en:gt()}Oe+=it;const mi=n.av([],Ge,Fe),pn=n.bG(Fe,Ge);if(a&&pn>0&&it>0&&n.bJ(Jt,mi)/(it*pn)<Te)return null;it=pn,Jt=mi}ae&&X&&(Y[Ve]&&(Ge=gt(),it=n.bG(Fe,Ge),Jt=n.av([],Ge,Fe)),Y[Ve]=Ge);const nt=(ft-Oe)/it,Bt=It.sub(zt)._mult(nt)._add(zt),Dt=n.bH([],Fe,Jt,nt);let li=[0,0,1],Ei=Jt[0],Ri=Jt[1];if(fe&&(li=ie.upVector(_e.canonical,Bt.x,Bt.y),li[0]!==0||li[1]!==0||li[2]!==1)){const mi=[li[2],0,-li[0]],pn=n.bI([],li,mi);n.aw(mi,mi),n.aw(pn,pn),Ei=n.bJ(Jt,mi),Ri=n.bJ(Jt,pn)}if(a){const mi=n.bI([],li,Jt);n.aw(mi,mi),n.bH(Dt,Dt,mi,a*Se)}const Ti=Ze+Math.atan2(Ri,Ei);return ht.push(Dt),Q&&St.push(Bt),{point:Dt,angle:Ti,path:ht,tilePath:St,up:li}}function Dc(h,t){const a=t.length,d=a+4*h;t.resize(d),t.float32.fill(-1/0,4*a,4*d)}function En(h,t,a){const d=t[0],y=t[1];return h[0]=a[0]*d+a[4]*y+a[12],h[1]=a[1]*d+a[5]*y+a[13],h[3]=a[3]*d+a[7]*y+a[15],h}const ta=100;class Sa{constructor(t,a,d=new zh(t.width+200,t.height+200,25),y=new zh(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=y,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ta,this.screenBottomBoundary=t.height+ta,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=a}placeCollisionBox(t,a,d,y,b,S,M,R,N,U,Y){let X=d.projectedAnchorX,Q=d.projectedAnchorY,ae=d.projectedAnchorZ;const ie=d.tileAnchorX,_e=d.tileAnchorY,fe=d.elevation,Te=d.tileID,De=t.getProjection();if(fe&&Te){const[St,It,zt]=De.upVector(Te.canonical,d.tileAnchorX,d.tileAnchorY),Jt=De.upVectorScale(Te.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;X+=St*fe*Jt,Q+=It*fe*Jt,ae+=zt*fe*Jt}const Se=t.projection.name==="globe",Ze=t.projection.name==="globe"?n.aj(this.transform.zoom):0;if(Te&&Se&&Ze<1&&!S){const St=1<<Te.canonical.z,It=n.bP(ie,_e);n.bQ(It,It,1/n.al),n.bR(It,It,n.bP(Te.canonical.x,Te.canonical.y)),n.bQ(It,It,1/St),n.bS(It,It,n.bP(y[0],y[1])),It[0]=n.bT(It[0],-.5,.5),n.bQ(It,It,n.al);const zt=n.bU(It[0],It[1],n.al/(2*Math.PI),1);n.aC(zt,zt,b),X=n.ak(X,zt[0],Ze),Q=n.ak(Q,zt[1],Ze),ae=n.ak(ae,zt[2],Ze)}const Ve=this.projectAndGetPerspectiveRatio(U,X,Q,ae,d.tileID,De.name==="globe"||!!fe||this.transform.pitch>0,De),Ge=N*Ve.perspectiveRatio,Fe=(d.x1*a+M.x-d.padding)*Ge+Ve.point.x,Oe=(d.y1*a+M.y-d.padding)*Ge+Ve.point.y,it=(d.x2*a+M.x+d.padding)*Ge+Ve.point.x,ft=(d.y2*a+M.y+d.padding)*Ge+Ve.point.y,ht=Ve.perspectiveRatio<=.55||Ve.occluded;return!this.isInsideGrid(Fe,Oe,it,ft)||!R&&this.grid.hitTest(Fe,Oe,it,ft,Y)||ht?{box:[],offscreen:!1,occluded:Ve.occluded}:{box:[Fe,Oe,it,ft],offscreen:this.isOffscreen(Fe,Oe,it,ft),occluded:!1}}placeCollisionCircles(t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e){const fe=[],Te=this.transform.elevation,De=t.getProjection(),Se=t.elevationType==="road",Ze=!!Te||Se,Ve=n.bV.getAtTileOffsetFunc(_e,this.transform.center.lat,this.transform.worldSize,De),Ge=new n.P(d.tileAnchorX,d.tileAnchorY),Fe=new n.P(d.tileAnchorX,d.tileAnchorY);let{x:Oe,y:it,z:ft}=De.projectTilePoint(Fe.x,Fe.y,_e.canonical),ht=null;if(Ze){const pn=Se?t.getElevationFeatureForText(y):null;ht={getElevation:Ve,elevation:Te,elevationFeature:pn};const[en,ji,Qi]=Ve(Ge,Te,pn);Oe+=en,it+=ji,ft+=Qi}const St=De.name==="globe",It=this.projectAndGetPerspectiveRatio(R,Oe,it,ft,_e,St||!!Te||this.transform.pitch>0,De),{perspectiveRatio:zt}=It,Jt=(X?M/zt:M*zt)/n.bY,gt=qc(Oe,it,ft,N),nt=d.lineOffsetX*Jt,Bt=d.lineOffsetY*Jt,Dt=n.an(t.layers[0].layout.get("text-max-angle")),li=Math.cos(Dt),Ei=It.signedDistanceFromCamera>0?Dh(Jt,S,nt,Bt,Se&&d.flipState===1,gt,Fe,d,b,N,{},Ze&&!X?ht:null,X&&Ze,De,_e,X,li):null;let Ri=!1,Ti=!1,mi=!0;if(Ei&&!It.occluded){const pn=.5*ae*zt+ie,en=new n.P(-100,-100),ji=new n.P(this.screenRightBoundary,this.screenBottomBoundary),Qi=new ed,{first:vn,last:rr}=Ei,Br=vn.path.length;let ba=[];for(let Qn=Br-1;Qn>=1;Qn--)ba.push(vn.path[Qn]);for(let Qn=1;Qn<rr.path.length;Qn++)ba.push(rr.path[Qn]);const _n=2.5*pn;U&&(ba=ba.map((([Qn,yr,Gr],Kr)=>(Ze&&!St&&(Gr=Ve(Kr<Br-1?vn.tilePath[Br-1-Kr]:rr.tilePath[Kr-Br+2],Te,ht.elevationFeature)[2]),qc(Qn,yr,Gr,U)))),ba.some((Qn=>Qn[3]<=0))&&(ba=[]));let aa=[];if(ba.length>0){let Qn=1/0,yr=-1/0,Gr=1/0,Kr=-1/0;for(const qr of ba)Qn=Math.min(Qn,qr[0]),Gr=Math.min(Gr,qr[1]),yr=Math.max(yr,qr[0]),Kr=Math.max(Kr,qr[1]);yr>=en.x&&Qn<=ji.x&&Kr>=en.y&&Gr<=ji.y&&(aa=[ba.map((qr=>new n.P(qr[0],qr[1])))],(Qn<en.x||yr>ji.x||Gr<en.y||Kr>ji.y)&&(aa=n.bW(aa,en.x,en.y,ji.x,ji.y)))}for(const Qn of aa){Qi.reset(Qn,.25*pn);let yr=0;yr=Qi.length<=.5*pn?1:Math.ceil(Qi.paddedLength/_n)+1;for(let Gr=0;Gr<yr;Gr++){const Kr=Gr/Math.max(yr-1,1),qr=Qi.lerp(Kr),mr=qr.x+ta,wa=qr.y+ta;fe.push(mr,wa,pn,0);const Bs=mr-pn,Ga=wa-pn,ya=mr+pn,Sr=wa+pn;if(mi=mi&&this.isOffscreen(Bs,Ga,ya,Sr),Ti=Ti||this.isInsideGrid(Bs,Ga,ya,Sr),!a&&this.grid.hitTestCircle(mr,wa,pn,Q)&&(Ri=!0,!Y))return{circles:[],offscreen:!1,collisionDetected:Ri,occluded:!1}}}}return{circles:!Y&&Ri||!Ti?[]:fe,offscreen:mi,collisionDetected:Ri,occluded:It.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const a=[];let d=1/0,y=1/0,b=-1/0,S=-1/0;for(const U of t){const Y=new n.P(U.x+ta,U.y+ta);d=Math.min(d,Y.x),y=Math.min(y,Y.y),b=Math.max(b,Y.x),S=Math.max(S,Y.y),a.push(Y)}const M=this.grid.query(d,y,b,S).concat(this.ignoredGrid.query(d,y,b,S)),R={},N={};for(const U of M){const Y=U.key;if(R[Y.bucketInstanceId]===void 0&&(R[Y.bucketInstanceId]={}),R[Y.bucketInstanceId][Y.featureIndex])continue;const X=[new n.P(U.x1,U.y1),new n.P(U.x2,U.y1),new n.P(U.x2,U.y2),new n.P(U.x1,U.y2)];n.bX(a,X)&&(R[Y.bucketInstanceId][Y.featureIndex]=!0,N[Y.bucketInstanceId]===void 0&&(N[Y.bucketInstanceId]=[]),N[Y.bucketInstanceId].push(Y.featureIndex))}return N}insertCollisionBox(t,a,d,y,b){(a?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:y,collisionGroupID:b},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,a,d,y,b){const S=a?this.ignoredGrid:this.grid,M={bucketInstanceId:d,featureIndex:y,collisionGroupID:b};for(let R=0;R<t.length;R+=4)S.insertCircle(M,t[R],t[R+1],t[R+2])}projectAndGetPerspectiveRatio(t,a,d,y,b,S,M){const R=[a,d,y,1];let N=!1;y||this.transform.pitch>0?(n.aC(R,R,t),this.fogState&&b&&M.name!=="globe"&&(N=(function(X,Q,ae,ie,_e,fe){const Te=fe.calculateFogTileMatrix(_e),De=[Q,ae,ie];return n.af(De,De,Te),Yi(X,n.ag(De),fe.pitch,fe._fov)})(this.fogState,a,d,y,b.toUnwrapped(),this.transform)>.9)):En(R,R,t);const U=R[3];return{point:new n.P((R[0]/U+1)/2*this.transform.width+ta,(-R[1]/U+1)/2*this.transform.height+ta),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/U*.5,1.5),signedDistanceFromCamera:U,occluded:S&&R[2]>U||N}}isOffscreen(t,a,d,y){return d<ta||t>=this.screenRightBoundary||y<ta||a>this.screenBottomBoundary}isInsideGrid(t,a,d,y){return d>=0&&t<this.gridRightBoundary&&y>=0&&a<this.gridBottomBoundary}getViewportMatrix(){const t=n.bA([]);return n.br(t,t,[-100,-100,0]),t}}class Kl{constructor(t,a,d,y){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?a:-a))):y&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Pu{constructor(t,a,d,y,b,S=!1){this.text=new Kl(t?t.text:null,a,d,b),this.icon=new Kl(t?t.icon:null,a,y,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class va{constructor(t,a,d,y=!1){this.text=t,this.icon=a,this.skipFade=d,this.clipped=y}}class If{constructor(){this.invProjMatrix=n.bC(),this.viewportMatrix=n.bC(),this.circles=[]}}class rd{constructor(t,a,d,y,b){this.bucketInstanceId=t,this.featureIndex=a,this.sourceLayerIndex=d,this.bucketIndex=y,this.tileID=b}}class Hc{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const a=++this.maxGroupID;this.collisionGroups[t]={ID:a,predicate:d=>d.collisionGroupID===a}}return this.collisionGroups[t]}}function al(h,t,a,d,y){const{horizontalAlign:b,verticalAlign:S}=n.c1(h),M=-(b-.5)*t,R=-(S-.5)*a,N=n.c2(h,d);return new n.P(M+N[0]*y,R+N[1]*y)}function io(h,t,a,d,y){const b=new n.P(h,t);return a&&b._rotate(d?y:-y),b}class Cp{constructor(t,a,d,y,b,S){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Sa(this.transform,b),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=a,this.retainedQueryData={},this.collisionGroups=new Hc(d),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,a,d,y,b=1){const S=d.getBucket(a),M=d.latestFeatureIndex;if(!S||!M||a.fqid!==S.layerIds[0])return;const R=S.layers[0].layout,N=S.layers[0].paint,U=d.collisionBoxArray,Y=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),X=d.tileSize/n.al,Q=d.tileID.toUnwrapped();this.transform.setProjection(S.projection);const ae=(ie=d.tileID,_e=S.getProjection(),fe=this.transform,_e.name===this.projection?fe.calculateProjMatrix(ie.toUnwrapped()):hu(fe,_e,ie));var ie,_e,fe;const Te=R.get("text-pitch-alignment")==="map",De=R.get("text-rotation-alignment")==="map";a.compileFilter(a.options);const Se=a.dynamicFilter(),Ze=a.dynamicFilterNeedsFeature(),Ve=this.transform.calculatePixelsToTileUnitsMatrix(d),Ge=Ad(ae,d.tileID.canonical,Te,De,this.transform,S.getProjection(),Ve);let Fe=null;const Oe=S.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(Te){const nt=Id(ae,d.tileID.canonical,Te,De,this.transform,S.getProjection(),Ve);Fe=n.aB([],this.transform.labelPlaneMatrix,nt)}let it=null;Se&&d.latestFeatureIndex&&(it={unwrappedTileID:Q,dynamicFilter:Se,dynamicFilterNeedsFeature:Ze}),this.retainedQueryData[S.bucketInstanceId]=new rd(S.bucketInstanceId,M,S.sourceLayerIndex,S.index,d.tileID);const[ft,ht]=S.layers[0].layout.get("text-size-scale-range"),St=n.aA(b,ft,ht),[It,zt]=R.get("icon-size-scale-range"),Jt=n.aA(b,It,zt),gt={bucket:S,layout:R,paint:N,posMatrix:ae,invMatrix:Oe,mercatorCenter:[n.aF(this.transform.center.lng),n.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Ge,labelToScreenMatrix:Fe,clippingData:it,scale:Y,textPixelRatio:X,holdingForFade:d.holdingForFade(),collisionBoxArray:U,partiallyEvaluatedTextSize:n.bK(S.textSizeData,this.transform.zoom,St),partiallyEvaluatedIconSize:n.bK(S.iconSizeData,this.transform.zoom,Jt),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(y)for(const nt of S.sortKeyRanges){const{sortKey:Bt,symbolInstanceStart:Dt,symbolInstanceEnd:li}=nt;t.push({sortKey:Bt,symbolInstanceStart:Dt,symbolInstanceEnd:li,parameters:gt})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:gt})}attemptAnchorPlacement(t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e,fe,Te,De,Se,Ze){const{textOffset0:Ve,textOffset1:Ge,crossTileID:Fe}=ie,Oe=[Ve,Ge],it=al(t,S,M,Oe,R),ft=this.collisionIndex.placeCollisionBox(fe,R,a,d,y,b,io(it.x,it.y,N,U,this.transform.angle),ae,Y,X,Q.predicate);if(De){const ht=fe.getSymbolInstanceIconSize(Ze,this.transform.zoom,ie.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(fe,ht,De,d,y,b,io(it.x,it.y,N,U,this.transform.angle),ae,Y,X,Q.predicate).box.length===0)return}if(ft.box.length>0){let ht;return this.prevPlacement&&this.prevPlacement.variableOffsets[Fe]&&this.prevPlacement.placements[Fe]&&this.prevPlacement.placements[Fe].text&&(ht=this.prevPlacement.variableOffsets[Fe].anchor),this.variableOffsets[Fe]={textOffset:Oe,width:S,height:M,anchor:t,textScale:R,prevAnchor:ht},this.markUsedJustification(fe,t,ie,Te),fe.allowVerticalPlacement&&(this.markUsedOrientation(fe,Te,ie),this.placedOrientations[Fe]=Te),{shift:it,placedGlyphBoxes:ft}}}placeLayerBucketPart(t,a,d,y,b=1){const{bucket:S,layout:M,paint:R,posMatrix:N,textLabelPlaneMatrix:U,labelToScreenMatrix:Y,clippingData:X,textPixelRatio:Q,mercatorCenter:ae,invMatrix:ie,holdingForFade:_e,collisionBoxArray:fe,partiallyEvaluatedTextSize:Te,partiallyEvaluatedIconSize:De,collisionGroup:Se,latestFeatureIndex:Ze}=t.parameters,Ve=M.get("text-optional"),Ge=M.get("icon-optional"),Fe=M.get("text-allow-overlap"),Oe=M.get("icon-allow-overlap"),it=M.get("text-rotation-alignment")==="map",ft=M.get("icon-rotation-alignment")==="map",ht=M.get("text-pitch-alignment")==="map",St=R.get("symbol-z-offset"),It=M.get("symbol-elevation-reference")==="sea",zt=M.get("symbol-placement"),[Jt,gt]=M.get("text-size-scale-range"),[nt,Bt]=M.get("icon-size-scale-range"),Dt=n.aA(b,Jt,gt),li=n.aA(b,nt,Bt),Ei=M.get("text-variable-anchor"),Ri=it&&zt!=="point",Ti=ft&&zt!=="point",mi=Ei&&S.hasTextData(),pn=S.hasIconTextFit()&&mi&&S.hasIconData();this.transform.setProjection(S.projection);const en=mi||Ri,ji=Ti||pn;let Qi=Fe&&(Oe||!S.hasIconData()||Ge),vn=Oe&&(Fe||!S.hasTextData()||Ve);const rr=!St.isConstant();!S.collisionArrays&&fe&&S.deserializeCollisionBoxes(fe),d&&y&&S.updateCollisionDebugBuffers(this.transform.zoom,fe,Dt,li);const Br=(_n,aa,Qn)=>{const{crossTileID:yr,numVerticalGlyphVertices:Gr}=_n;let Kr=null;if(X&&X.dynamicFilterNeedsFeature||rr){const Fs=this.retainedQueryData[S.bucketInstanceId];Kr=Ze.loadFeature({featureIndex:_n.featureIndex,bucketIndex:Fs.bucketIndex,sourceLayerIndex:Fs.sourceLayerIndex,layoutVertexArrayOffset:0});const lo=Kr.properties?Kr.properties.worldview:null;if(S.localizable&&S.worldview&&typeof lo=="string")if(lo==="all")Kr.properties.$localized=!0;else{if(!lo.split(",").includes(S.worldview))return;Kr.properties.$localized=!0,Kr.properties.worldview=S.worldview}}if(X&&!(0,X.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:S.worldview},Kr,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new n.P(_n.tileAnchorX,_n.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[yr]=new va(!1,!1,!1,!0),void a.add(yr);const qr=St.evaluate(Kr,{});if(a.has(yr))return;if(_e)return void(this.placements[yr]=new va(!1,!1,!1));let mr=!1,wa=!1,Bs=!0,Ga=!1,ya=!1,Sr=null,gr={box:null,offscreen:null,occluded:null},fa={box:null},bs=null,ws=null,qa=null,Bo=0,Qo=0,oo=0;Qn.textFeatureIndex?Bo=Qn.textFeatureIndex:_n.useRuntimeCollisionCircles&&(Bo=_n.featureIndex),Qn.verticalTextFeatureIndex&&(Qo=Qn.verticalTextFeatureIndex);const Ho=S.elevationFeatures?S.elevationFeatures[_n.elevationFeatureIndex]:void 0,jl=Fs=>{Fs.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const lo=this.transform.elevation;Fs.elevation=It?qr:qr+n.bV.getAtTileOffset(Fs.tileID,new n.P(Fs.tileAnchorX,Fs.tileAnchorY),lo,Ho),Fs.elevation+=_n.zOffset},fl=Qn.textBox;if(fl){jl(fl);const Fs=Na=>{let Ns=n.bL.horizontal;if(S.allowVerticalPlacement&&!Na&&this.prevPlacement){const zs=this.prevPlacement.placedOrientations[yr];zs&&(this.placedOrientations[yr]=zs,Ns=zs,this.markUsedOrientation(S,Ns,_n))}return Ns},lo=(Na,Ns)=>{if(S.allowVerticalPlacement&&Gr>0&&Qn.verticalTextBox){for(const zs of S.writingModes)if(zs===n.bL.vertical?(gr=Ns(),fa=gr):gr=Na(),gr&&gr.box&&gr.box.length)break}else gr=Na()};if(Ei){let Na=Ei;if(this.prevPlacement&&this.prevPlacement.variableOffsets[yr]){const Ts=this.prevPlacement.variableOffsets[yr];Na.indexOf(Ts.anchor)>0&&(Na=Na.filter((nc=>nc!==Ts.anchor)),Na.unshift(Ts.anchor))}const Ns=(Ts,nc,Ud)=>{const Ku=S.getSymbolInstanceTextSize(Te,_n,this.transform.zoom,aa),vf=(Ts.x2-Ts.x1)*Ku+2*Ts.padding,Wh=(Ts.y2-Ts.y1)*Ku+2*Ts.padding,vh=_n.hasIconTextFit&&!Oe?nc:null;vh&&jl(vh);let bh={box:[],offscreen:!1,occluded:!1};const bf=Fe?2*Na.length:Na.length;for(let el=0;el<bf;++el){const Iu=this.attemptAnchorPlacement(Na[el%Na.length],Ts,ae,ie,en,vf,Wh,Ku,it,ht,Q,N,Se,el>=Na.length,_n,aa,S,Ud,vh,Te,De);if(Iu&&(bh=Iu.placedGlyphBoxes,bh&&bh.box&&bh.box.length)){mr=!0,Sr=Iu.shift;break}}return bh};lo((()=>Ns(fl,Qn.iconBox,n.bL.horizontal)),(()=>{const Ts=Qn.verticalTextBox;return Ts&&jl(Ts),S.allowVerticalPlacement&&!(gr&&gr.box&&gr.box.length)&&Gr>0&&Ts?Ns(Ts,Qn.verticalIconBox,n.bL.vertical):{box:null,offscreen:null,occluded:null}})),gr&&(mr=gr.box,Bs=gr.offscreen,Ga=gr.occluded);const zs=Fs(!(!gr||!gr.box));if(!mr&&this.prevPlacement){const Ts=this.prevPlacement.variableOffsets[yr];Ts&&(this.variableOffsets[yr]=Ts,this.markUsedJustification(S,Ts.anchor,_n,zs))}}else{const Na=(Ns,zs)=>{const Ts=S.getSymbolInstanceTextSize(Te,_n,this.transform.zoom,aa),nc=this.collisionIndex.placeCollisionBox(S,Ts,Ns,ae,ie,en,new n.P(0,0),Fe,Q,N,Se.predicate);return nc&&nc.box&&nc.box.length&&(this.markUsedOrientation(S,zs,_n),this.placedOrientations[yr]=zs),nc};lo((()=>Na(fl,n.bL.horizontal)),(()=>{const Ns=Qn.verticalTextBox;return S.allowVerticalPlacement&&Gr>0&&Ns?(jl(Ns),Na(Ns,n.bL.vertical)):{box:null,offscreen:null,occluded:null}})),Fs(!!(gr&&gr.box&&gr.box.length))}}if(bs=gr,mr=bs&&bs.box&&bs.box.length>0,Bs=bs&&bs.offscreen,Ga=bs&&bs.occluded,_n.useRuntimeCollisionCircles){const Fs=_n.centerJustifiedTextSymbolIndex>=0?_n.centerJustifiedTextSymbolIndex:_n.verticalPlacedTextSymbolIndex,lo=S.text.placedSymbolArray.get(Fs),Na=n.bM(S.textSizeData,Te,lo),Ns=M.get("text-padding");ws=this.collisionIndex.placeCollisionCircles(S,Fe,lo,Fs,S.lineVertexArray,S.glyphOffsetArray,Na,N,U,Y,d,ht,Se.predicate,_n.collisionCircleDiameter*Na/n.bY,Ns,this.retainedQueryData[S.bucketInstanceId].tileID),mr=Fe||ws.circles.length>0&&!ws.collisionDetected,Bs=Bs&&ws.offscreen,Ga=ws.occluded}if(Qn.iconFeatureIndex&&(oo=Qn.iconFeatureIndex),Qn.iconBox){const Fs=lo=>{jl(lo);const Na=_n.hasIconTextFit&&Sr?io(Sr.x,Sr.y,it,ht,this.transform.angle):new n.P(0,0),Ns=S.getSymbolInstanceIconSize(De,this.transform.zoom,_n.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Ns,lo,ae,ie,ji,Na,Oe,Q,N,Se.predicate)};fa&&fa.box&&fa.box.length&&Qn.verticalIconBox?(qa=Fs(Qn.verticalIconBox),wa=qa.box.length>0):(qa=Fs(Qn.iconBox),wa=qa.box.length>0),Bs=Bs&&qa.offscreen,ya=qa.occluded}const eu=Ve||_n.numHorizontalGlyphVertices===0&&Gr===0,Yu=Ge||_n.numIconVertices===0;if(eu||Yu?Yu?eu||(wa=wa&&mr):mr=wa&&mr:wa=mr=wa&&mr,mr&&bs&&bs.box&&this.collisionIndex.insertCollisionBox(bs.box,M.get("text-ignore-placement"),S.bucketInstanceId,fa&&fa.box&&Qo?Qo:Bo,Se.ID),wa&&qa&&this.collisionIndex.insertCollisionBox(qa.box,M.get("icon-ignore-placement"),S.bucketInstanceId,oo,Se.ID),ws&&(mr&&this.collisionIndex.insertCollisionCircles(ws.circles,M.get("text-ignore-placement"),S.bucketInstanceId,Bo,Se.ID),d)){const Fs=S.bucketInstanceId;let lo=this.collisionCircleArrays[Fs];lo===void 0&&(lo=this.collisionCircleArrays[Fs]=new If);for(let Na=0;Na<ws.circles.length;Na+=4)lo.circles.push(ws.circles[Na+0]),lo.circles.push(ws.circles[Na+1]),lo.circles.push(ws.circles[Na+2]),lo.circles.push(ws.collisionDetected?1:0)}const ic=S.projection.name!=="globe";Qi=Qi&&(ic||!Ga),vn=vn&&(ic||!ya),this.placements[yr]=new va(mr||Qi,wa||vn,Bs||S.justReloaded),a.add(yr)},ba=this.retainedQueryData[S.bucketInstanceId].tileID;if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,ba),S.elevationType==="road"&&S.updateRoadElevation(ba.canonical),S.updateZOffset(),S.sortFeaturesByY){const _n=S.getSortedSymbolIndexes(this.transform.angle);for(let aa=_n.length-1;aa>=0;--aa){const Qn=_n[aa];Br(S.symbolInstances.get(Qn),Qn,S.collisionArrays[Qn])}S.hasAnyZOffset&&n.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const _n=S.getSortedIndexesByZOffset();for(let aa=0;aa<_n.length;++aa){const Qn=_n[aa];Br(S.symbolInstances.get(Qn),Qn,S.collisionArrays[Qn])}}else for(let _n=t.symbolInstanceStart;_n<t.symbolInstanceEnd;_n++)Br(S.symbolInstances.get(_n),_n,S.collisionArrays[_n]);if(d&&S.bucketInstanceId in this.collisionCircleArrays){const _n=this.collisionCircleArrays[S.bucketInstanceId];n.bl(_n.invProjMatrix,N),_n.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(t,a,d,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:R,crossTileID:N}=d,U=n.c3(a),Y=y===n.bL.vertical?R:U==="left"?b:U==="center"?S:U==="right"?M:-1;b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=Y>=0&&b!==Y?0:N),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=Y>=0&&S!==Y?0:N),M>=0&&(t.text.placedSymbolArray.get(M).crossTileID=Y>=0&&M!==Y?0:N),R>=0&&(t.text.placedSymbolArray.get(R).crossTileID=Y>=0&&R!==Y?0:N)}markUsedOrientation(t,a,d){const y=a===n.bL.horizontal||a===n.bL.horizontalOnly?a:0,b=a===n.bL.vertical?a:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:R,verticalPlacedTextSymbolIndex:N}=d,U=t.text.placedSymbolArray;S>=0&&(U.get(S).placedOrientation=y),M>=0&&(U.get(M).placedOrientation=y),R>=0&&(U.get(R).placedOrientation=y),N>=0&&(U.get(N).placedOrientation=b)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const a=this.prevPlacement;let d=!1;this.prevZoomAdjustment=a?a.zoomAdjustment(this.transform.zoom):0;const y=a?a.symbolFadeChange(t):1,b=a?a.opacities:{},S=a?a.variableOffsets:{},M=a?a.placedOrientations:{};for(const R in this.placements){const N=this.placements[R],U=b[R];U?(this.opacities[R]=new Pu(U,y,N.text,N.icon,null,N.clipped),d=d||N.text!==U.text.placed||N.icon!==U.icon.placed):(this.opacities[R]=new Pu(null,y,N.text,N.icon,N.skipFade,N.clipped),d=d||N.text||N.icon)}for(const R in b){const N=b[R];if(!this.opacities[R]){const U=new Pu(N,y,!1,!1);U.isHidden()||(this.opacities[R]=U,d=d||N.text.placed||N.icon.placed)}}for(const R in S)this.variableOffsets[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.variableOffsets[R]=S[R]);for(const R in M)this.placedOrientations[R]||!this.opacities[R]||this.opacities[R].isHidden()||(this.placedOrientations[R]=M[R]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=a?a.lastPlacementChangeTime:t)}updateLayerOpacities(t,a,d,y){y&&(this.lastReplacementSourceUpdateTime=y.updateTime);const b=new Set;for(const S of a){const M=S.getBucket(t);M&&S.latestFeatureIndex&&t.fqid===M.layerIds[0]&&(this.updateBucketOpacities(M,b,S,S.collisionBoxArray,d,y,S.tileID,t.scope),M.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(M,S.tileID),M.elevationType==="road"&&M.updateRoadElevation(S.tileID.canonical),M.updateZOffset())}}updateBucketOpacities(t,a,d,y,b,S,M,R){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const N=t.layers[0].layout,U=t.layers[0].paint,Y=!!t.layers[0].dynamicFilter(),X=new Pu(null,0,!1,!1,!0),Q=N.get("text-allow-overlap"),ae=N.get("icon-allow-overlap"),ie=N.get("text-variable-anchor"),_e=N.get("text-rotation-alignment")==="map",fe=N.get("text-pitch-alignment")==="map",Te=U.get("symbol-z-offset"),De=N.get("symbol-elevation-reference")==="sea",Se=!Te.isConstant(),Ze=new Pu(null,0,Q&&(ae||!t.hasIconData()||N.get("icon-optional")),ae&&(Q||!t.hasTextData()||N.get("text-optional")),!0);!t.collisionArrays&&y&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(y);const Ve=(Fe,Oe,it)=>{for(let ft=0;ft<Oe/4;ft++)Fe.opacityVertexArray.emplaceBack(it)};let Ge=0;S&&t.updateReplacement(M,S);for(let Fe=0;Fe<t.symbolInstances.length;Fe++){const Oe=t.symbolInstances.get(Fe),{numHorizontalGlyphVertices:it,numVerticalGlyphVertices:ft,crossTileID:ht,numIconVertices:St,tileAnchorX:It,tileAnchorY:zt}=Oe;let Jt=null;const gt=this.retainedQueryData[t.bucketInstanceId];Se&&Oe&&gt&&(Jt=d.latestFeatureIndex.loadFeature({featureIndex:Oe.featureIndex,bucketIndex:gt.bucketIndex,sourceLayerIndex:gt.sourceLayerIndex,layoutVertexArrayOffset:0}));const nt=Te.evaluate(Jt,{}),Bt=a.has(ht);let Dt=this.opacities[ht];Bt?Dt=X:Dt||(Dt=Ze,this.opacities[ht]=Dt),a.add(ht);const li=it>0||ft>0,Ei=St>0,Ri=this.placedOrientations[ht],Ti=Ri===n.bL.vertical,mi=Ri===n.bL.horizontal||Ri===n.bL.horizontalOnly;!li&&!Ei||Dt.isHidden()||Ge++;let pn=!1;if((li||Ei)&&S)for(const en of t.activeReplacements){if(n.bZ(en,b,n.b_.Symbol,R)||en.min.x>It||It>en.max.x||en.min.y>zt||zt>en.max.y)continue;const ji=n.b$(It,zt,M.canonical,en.footprintTileId.canonical);if(pn=n.c0(ji,en.footprint),pn)break}if(li){const en=pn?Is:Io(Dt.text);Ve(t.text,it,Ti?Is:en),Ve(t.text,ft,mi?Is:en);const ji=Dt.text.isHidden(),{leftJustifiedTextSymbolIndex:Qi,centerJustifiedTextSymbolIndex:vn,rightJustifiedTextSymbolIndex:rr,verticalPlacedTextSymbolIndex:Br}=Oe,ba=t.text.placedSymbolArray,_n=ji||Ti?1:0;Qi>=0&&(ba.get(Qi).hidden=_n),vn>=0&&(ba.get(vn).hidden=_n),rr>=0&&(ba.get(rr).hidden=_n),Br>=0&&(ba.get(Br).hidden=ji||mi?1:0);const aa=this.variableOffsets[ht];aa&&this.markUsedJustification(t,aa.anchor,Oe,Ri);const Qn=this.placedOrientations[ht];Qn&&(this.markUsedJustification(t,"left",Oe,Qn),this.markUsedOrientation(t,Qn,Oe))}if(Ei){const en=pn?Is:Io(Dt.icon),{placedIconSymbolIndex:ji,verticalPlacedIconSymbolIndex:Qi}=Oe,vn=t.icon.placedSymbolArray,rr=Dt.icon.isHidden()?1:0;ji>=0&&(Ve(t.icon,St,Ti?Is:en),vn.get(ji).hidden=rr),Qi>=0&&(Ve(t.icon,Oe.numVerticalIconVertices,mi?Is:en),vn.get(Qi).hidden=rr)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const en=t.collisionArrays[Fe];if(en){let ji=new n.P(0,0),Qi=!0;if(en.textBox||en.verticalTextBox){if(ie){const rr=this.variableOffsets[ht];rr?(ji=al(rr.anchor,rr.width,rr.height,rr.textOffset,rr.textScale),_e&&ji._rotate(fe?this.transform.angle:-this.transform.angle)):Qi=!1}Y&&(Qi=!Dt.clipped),en.textBox&&$c(t.textCollisionBox.collisionVertexArray,Dt.text.placed,!Qi||Ti,nt,De,ji.x,ji.y),en.verticalTextBox&&$c(t.textCollisionBox.collisionVertexArray,Dt.text.placed,!Qi||mi,nt,De,ji.x,ji.y)}const vn=Qi&&!!(!mi&&en.verticalIconBox);en.iconBox&&$c(t.iconCollisionBox.collisionVertexArray,Dt.icon.placed,vn,nt,De,Oe.hasIconTextFit?ji.x:0,Oe.hasIconTextFit?ji.y:0),en.verticalIconBox&&$c(t.iconCollisionBox.collisionVertexArray,Dt.icon.placed,!vn,nt,De,Oe.hasIconTextFit?ji.x:0,Oe.hasIconTextFit?ji.y:0)}}}if(t.fullyClipped=Ge===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const Fe=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=Fe.invProjMatrix,t.placementViewportMatrix=Fe.viewportMatrix,t.collisionCircleArray=Fe.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,a){const d=this.zoomAtLastRecencyCheck===a?1-this.zoomAdjustment(a):1;return this.zoomAtLastRecencyCheck=a,this.commitTime+this.fadeDuration*d>t}isStale(){return this.stale}setStale(){this.stale=!0}}function $c(h,t,a,d,y,b,S){h.emplaceBack(t?1:0,a?1:0,b||0,S||0,d,y?1:0),h.emplaceBack(t?1:0,a?1:0,b||0,S||0,d,y?1:0),h.emplaceBack(t?1:0,a?1:0,b||0,S||0,d,y?1:0),h.emplaceBack(t?1:0,a?1:0,b||0,S||0,d,y?1:0)}const Rh=Math.pow(2,25),Lu=Math.pow(2,24),Md=Math.pow(2,17),Jf=Math.pow(2,16),po=Math.pow(2,9),Pl=Math.pow(2,8),ga=Math.pow(2,1);function Io(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,a=Math.floor(127*h.opacity);return a*Rh+t*Lu+a*Md+t*Jf+a*po+t*Pl+a*ga+t}const Is=0;class ys{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,a,d,y,b,S){const M=this._bucketParts;for(;this._currentTileIndex<t.length;)if(a.getBucketParts(M,y,t[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort(((R,N)=>R.sortKey-N.sortKey)));this._currentPartIndex<M.length;){const R=M[this._currentPartIndex];if(a.placeLayerBucketPart(R,this._seenCrossTileIDs,d,R.symbolInstanceStart===0,S),this._currentPartIndex++,b())return!0}return!1}}class no{constructor(t,a,d,y,b,S,M,R,N){this.placement=new Cp(t,b,S,M,R,N),this._currentPlacementIndex=a.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(t,a,d,y,b){const S=n.o.now(),M=()=>{const R=n.o.now()-S;return!this._forceFullPlacement&&R>2};for(;this._currentPlacementIndex>=0;){const R=a[t[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if(R.type==="symbol"&&R.visibility!=="none"&&(!R.minzoom||R.minzoom<=N)&&(!R.maxzoom||R.maxzoom>N)){const U=R,Y=U.layout.get("symbol-z-elevate"),X=U.layout.get("symbol-sort-key").constantOr(1)!==void 0,Q=U.layout.get("symbol-z-order"),ae=Q==="viewport-y"||Q==="auto"&&!(Q!=="viewport-y"&&X),ie=U.layout.get("text-allow-overlap")||U.layout.get("icon-allow-overlap")||U.layout.get("text-ignore-placement")||U.layout.get("icon-ignore-placement"),_e=ae&&ie,fe=this._inProgressLayer=this._inProgressLayer||new ys(U),Te=n.B(R.source,R.scope);if(fe.continuePlacement(Y||_e?y[Te]:d[Te],this.placement,this._showCollisionBoxes,R,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ll=512/n.al/2;class Rc{constructor(t,a,d){this.tileID=t,this.bucketInstanceId=d,this.index=new n.c4(a.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=t.canonical.x*n.al,b=t.canonical.y*n.al;for(let S=0;S<a.length;S++){const{key:M,crossTileID:R,tileAnchorX:N,tileAnchorY:U}=a.get(S),Y=Math.floor((y+N)*Ll),X=Math.floor((b+U)*Ll);this.index.add(Y,X),this.keys.push(M),this.crossTileIDs.push(R)}this.index.finish()}findMatches(t,a,d){const y=this.tileID.canonical.z<a.canonical.z?1:Math.pow(2,this.tileID.canonical.z-a.canonical.z),b=Ll/Math.pow(2,a.canonical.z-this.tileID.canonical.z),S=a.canonical.x*n.al,M=a.canonical.y*n.al;for(let R=0;R<t.length;R++){const N=t.get(R);if(N.crossTileID)continue;const{key:U,tileAnchorX:Y,tileAnchorY:X}=N,Q=Math.floor((S+Y)*b),ae=Math.floor((M+X)*b),ie=this.index.range(Q-y,ae-y,Q+y,ae+y).sort(((_e,fe)=>_e-fe));for(const _e of ie){const fe=this.crossTileIDs[_e];if(this.keys[_e]===U&&!d.has(fe)){d.add(fe),N.crossTileID=fe;break}}}}}class Js{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Zc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const a=Math.round((t-this.lng)/360);if(a!==0)for(const d in this.indexes){const y=this.indexes[d],b={};for(const S in y){const M=y[S];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+a),b[M.tileID.key]=M}this.indexes[d]=b}this.lng=t}addBucket(t,a,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===a.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let b=0;b<a.symbolInstances.length;b++)a.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const y=this.usedCrossTileIDs[t.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>t.overscaledZ)for(const M in S){const R=S[M];R.tileID.isChildOf(t)&&R.findMatches(a.symbolInstances,t,y)}else{const M=S[t.scaledTo(Number(b)).key];M&&M.findMatches(a.symbolInstances,t,y)}}for(let b=0;b<a.symbolInstances.length;b++){const S=a.symbolInstances.get(b);S.crossTileID||(S.crossTileID=d.generate(),y.add(S.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Rc(t,a.symbolInstances,a.bucketInstanceId),!0}removeBucketCrossTileIDs(t,a){for(const d of a.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let a=!1;for(const d in this.indexes){const y=this.indexes[d];for(const b in y)t[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,y[b]),delete y[b],a=!0)}return a}}class Jl{constructor(){this.layerIndexes={},this.crossTileIDs=new Js,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,a,d,y){let b=this.layerIndexes[t.fqid];b===void 0&&(b=this.layerIndexes[t.fqid]=new Zc);let S=!1;const M={};y.name!=="globe"&&b.handleWrapJump(d);for(const R of a){const N=R.getBucket(t);N&&t.fqid===N.layerIds[0]&&(N.bucketInstanceId||(N.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(R.tileID,N,this.crossTileIDs)&&(S=!0),M[N.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(S=!0),S}pruneUnusedLayers(t){const a={};t.forEach((d=>{a[d]=!0}));for(const d in this.layerIndexes)a[d]||delete this.layerIndexes[d]}}const Mo=771;class cr{constructor(t,a,d,y){this.blendFunction=t,this.blendColor=a.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=y}}cr.Replace=[1,0,1,0],cr.disabled=new cr(cr.Replace,n.ao.transparent,[!1,!1,!1,!1]),cr.unblended=new cr(cr.Replace,n.ao.transparent,[!0,!0,!0,!0]),cr.alphaBlended=new cr([1,Mo,1,Mo],n.ao.transparent,[!0,!0,!0,!0]),cr.alphaBlendedNonPremultiplied=new cr([770,Mo,770,Mo],n.ao.transparent,[!0,!0,!0,!0]),cr.multiply=new cr([774,0,774,0],n.ao.transparent,[!0,!0,!0,!0]),cr.additive=new cr([1,1,1,1],n.ao.transparent,[!0,!0,!0,!0]);class xn{constructor(t,a,d){this.func=t,this.mask=a,this.range=d}}xn.ReadOnly=!1,xn.ReadWrite=!0,xn.disabled=new xn(519,xn.ReadOnly,[0,1]);const ad=7680;class Un{constructor(t,a,d,y,b,S){this.test=t,this.ref=a,this.mask=d,this.fail=y,this.depthFail=b,this.pass=S}}Un.disabled=new Un({func:519,mask:0},0,0,ad,ad,ad);const ku=1029,Ph=2305;class jn{constructor(t,a,d){this.enable=t,this.mode=a,this.frontFace=d}}function Pc(h,t){const a=n.ca(h,3);n.cc(h,t),n.cg(h,3,a)}function Xd(h,t){const a=n.c7([]);return n.c8(a,a,-t),n.c9(a,a,-h),a}function Lh(h,t){const a=[h[0],h[1],0],d=[t[0],t[1],0];if(n.ag(a)>=1e-15){const S=n.aw([],a);n.c5(d,S,n.bJ(d,S)),t[0]=d[0],t[1]=d[1]}const y=n.bI([],t,h);if(n.c6(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return Xd(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),b)}jn.disabled=new jn(!1,ku,Ph),jn.backCCW=new jn(!0,ku,Ph),jn.backCW=new jn(!0,ku,2304),jn.frontCW=new jn(!0,1028,2304),jn.frontCCW=new jn(!0,1028,Ph);class $o{constructor(t,a){this.position=t,this.orientation=a}get position(){return this._position}set position(t){if(t){const a=t instanceof n.ae?t:new n.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(a.x=n.bT(a.x,0,1)),this._position=a}else this._position=null}lookAtPoint(t,a,d){if(this.orientation=null,!this.position)return;const y=this.position,b=d||(this._elevation?this._elevation.getAtPointOrZero(n.ae.fromLngLat(t)):0),S=n.ae.fromLngLat(t,b),M=[S.x-y.x,S.y-y.y,S.z-y.z];a||(a=[0,0,1]),a[2]=Math.abs(a[2]),this.orientation=Lh(M,a)}setPitchBearing(t,a){this.orientation=Xd(n.an(t),n.an(-a))}}class Mf{constructor(t,a){this._transform=n.bA([]),this.orientation=a,this.position=t}get mercatorPosition(){const t=this.position;return new n.ae(t[0],t[1],t[2])}get position(){const t=n.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var a;t&&n.cg(this._transform,3,[(a=t)[0],a[1],a[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.c7([]),t&&Pc(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),a=this.right();return{bearing:Math.atan2(-a[1],a[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,a){this._orientation=Xd(t,a),Pc(this._transform,this._orientation)}forward(){const t=n.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=n.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=n.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,a){const d=new Float64Array(16);return n.bl(d,this.getWorldToCamera(t,a)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,a,d){const y=this.position;n.c5(y,y,-t);const b=new Float64Array(16);return n.bq(b,[d,d,d]),n.br(b,b,y),b[10]*=a,b}getWorldToCamera(t,a){const d=new Float64Array(16),y=new Float64Array(4),b=this.position;return n.cb(y,this._orientation),n.c5(b,b,-t),n.cc(d,y),n.br(d,d,b),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=a,d[9]*=a,d[10]*=a,d[11]*=a,d}getCameraToClipPerspective(t,a,d,y){const b=new Float64Array(16);return n.cd(b,t,a,d,y),b}getCameraToClipOrthographic(t,a,d,y,b,S){const M=new Float64Array(16);return n.ce(M,t,a,d,y,b,S),M}getDistanceToElevation(t,a=!1){const d=t===0?0:n.cf(t,a?n.a$(this.position[1]):this.position[1]),y=this.forward();return(d-this.position[2])/y[2]}clone(){return new Mf([...this.position],[...this.orientation])}}const ds={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Ua{constructor(t=0,a=0,d=0,y=0){if(isNaN(t)||t<0||isNaN(a)||a<0||isNaN(d)||d<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=a,this.left=d,this.right=y}interpolate(t,a,d){return a.top!=null&&t.top!=null&&(this.top=n.ak(t.top,a.top,d)),a.bottom!=null&&t.bottom!=null&&(this.bottom=n.ak(t.bottom,a.bottom,d)),a.left!=null&&t.left!=null&&(this.left=n.ak(t.left,a.left,d)),a.right!=null&&t.right!=null&&(this.right=n.ak(t.right,a.right,d)),this}getCenter(t,a){const d=n.aA((this.left+t-this.right)/2,0,t),y=n.aA((this.top+a-this.bottom)/2,0,a);return new n.P(d,y)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Ua(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const uc=15;class Qf{constructor(t,a,d,y,b,S,M){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=t||0,this._maxZoom=a||22,this._minPitch=d??0,this._maxPitch=y??60,this.setProjection(S),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new n.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ua,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Mf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Qf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<uc}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,a=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(a),this._calcMatrices()}getProjection(){return n.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const a=this.projection?this.getProjection():void 0;this.projection=n.cm(this.projectionOptions);const d=this.getProjection(),y=!n.by(a,d);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.cm({name:"mercator"});const a=t!==this.projection.name;return a&&this._calcMatrices(),a}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const a=-t*Math.PI/180;this.angle!==a&&(this._unmodified=!1,this.angle=a,this._calcMatrices(),this.rotationMatrix=n.cn(),n.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const a=n.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==a&&(this._unmodified=!1,this._pitch=a,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const a=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==a&&(this._unmodified=!1,this._setZoom(a),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,a=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!a||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;a||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,a=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let y=0,b=0;for(let S=0;S<a.length;S++){const M=new n.P(a[S][0]*this.width,d+a[S][1]*(this.height-d)),R=t.pointCoordinate(M);if(!R)continue;const N=1/Math.hypot(R[0]-this._camera.position[0],R[1]-this._camera.position[1]);y+=R[3]*N,b+=N}return b===0?NaN:y/b}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,a=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*a,y=this._mercatorZfromZoom(t),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(y-d,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const a=this.elevation,d=t.elevation,y=a!=null!=(d!=null)||a&&d&&a.exaggeration()!==d.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!y}computeZoomRelativeTo(t){const a=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[a.x,a.y,a.z]:[t.x,t.y,t.z];const y=n.ag(n.av([],this._camera.position,d));return n.aA(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let a=!1;if(t.orientation&&!n.cp(t.orientation,this._camera.orientation)&&(a=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];n.cq(d,this._camera.position)||(this._setCameraPosition(d),a=!0)}a&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,a=new $o;return a.position=new n.ae(t[0],t[1],t[2]),a.orientation=this._camera.orientation,a._elevation=this.elevation,a._renderWorldCopies=this.renderWorldCopies,a}_setCameraOrientation(t){if(!n.cr(t))return!1;n.cs(t,t);const a=n.ct([],[0,0,-1],t),d=n.ct([],[0,-1,0],t);if(d[2]<0)return!1;const y=Lh(a,d);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(t){const a=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;t[2]=n.aA(t[2],y/d,y/a),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,a,d){this._unmodified=!1,this._edgeInsets.interpolate(t,a,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const a=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,a)}getVisibleUnwrappedCoordinates(t){const a=[new n.cu(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new n.P(0,0)),y=this.pointCoordinate(new n.P(this.width,0)),b=this.pointCoordinate(new n.P(this.width,this.height)),S=this.pointCoordinate(new n.P(0,this.height)),M=Math.floor(Math.min(d.x,y.x,b.x,S.x)),R=Math.floor(Math.max(d.x,y.x,b.x,S.x)),N=1;for(let U=M-N;U<=R+N;U++)U!==0&&a.push(new n.cu(U,t))}return a}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,a,d,y){let b=[];const S=d!=null,M=!S;if(M&&this.zoom<a||S&&d[0]===0&&d[1]===0)return b;const R=new Set,N=(Y,X,Q,ae,ie)=>{const _e=n.cY(X,Y,Q,ae,ie);R.has(_e)||(b.push(new n.aQ(Y,X,Q,ae,ie)),R.add(_e))};for(let Y=0;Y<t.length;Y++){const X=t[Y];if(M&&X.canonical.z!==a||S&&y!==void 0&&y>X.canonical.z)continue;const Q=X.canonical,ae=X.overscaledZ,ie=X.wrap,_e=1<<Q.z,fe=Q.x+1<_e,Te=Q.x>0,De=Q.y+1<_e,Se=Q.y>0,Ze=X.wrap-(Te?0:1),Ve=X.wrap+(fe?0:1),Ge=Te?Q.x-1:_e-1,Fe=fe?Q.x+1:0;if(S)d[0]<0?(N(ae,Ve,Q.z,Fe,Q.y),d[1]<0&&De&&(N(ae,ie,Q.z,Q.x,Q.y+1),N(ae,Ve,Q.z,Fe,Q.y+1)),d[1]>0&&Se&&(N(ae,ie,Q.z,Q.x,Q.y-1),N(ae,Ve,Q.z,Fe,Q.y-1))):d[0]>0?(N(ae,Ze,Q.z,Ge,Q.y),d[1]<0&&De&&(N(ae,ie,Q.z,Q.x,Q.y+1),N(ae,Ze,Q.z,Ge,Q.y+1)),d[1]>0&&Se&&(N(ae,ie,Q.z,Q.x,Q.y-1),N(ae,Ze,Q.z,Ge,Q.y-1))):d[1]<0&&De?N(ae,ie,Q.z,Q.x,Q.y+1):Se&&N(ae,ie,Q.z,Q.x,Q.y-1);else{const Oe=X.visibleQuadrants;1&Oe&&(N(ae,Ze,Q.z,Ge,Q.y),Se&&(N(ae,ie,Q.z,Q.x,Q.y-1),N(ae,Ze,Q.z,Ge,Q.y-1))),2&Oe&&(N(ae,Ve,Q.z,Fe,Q.y),Se&&(N(ae,ie,Q.z,Q.x,Q.y-1),N(ae,Ve,Q.z,Fe,Q.y-1))),4&Oe&&(N(ae,Ze,Q.z,Ge,Q.y),De&&(N(ae,ie,Q.z,Q.x,Q.y+1),N(ae,Ze,Q.z,Ge,Q.y+1))),8&Oe&&(N(ae,Ve,Q.z,Fe,Q.y),De&&(N(ae,ie,Q.z,Q.x,Q.y+1),N(ae,Ve,Q.z,Fe,Q.y+1)))}}const U=[];for(const Y of b)b.some((X=>Y.isChildOf(X)))||U.push(Y);if(b=U.filter((Y=>!t.some((X=>!!(Y.overscaledZ<a&&X.isChildOf(Y))||Y.equals(X)||Y.isChildOf(X))))),M){const Y=1<<a,X=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Q=[Y*X.x,Y*X.y],ae=4,ie=ae*ae;b=b.filter((_e=>{const fe=_e.canonical.x+.5-Q[0],Te=_e.canonical.y+.5-Q[1];return fe*fe+Te*Te<ie}))}return b}extendTileCoverToNearPlane(t,a,d){const y=[],b=new Set;for(const Te of t)b.add(Te.key);const S=(Te,De,Se,Ze,Ve)=>{const Ge=n.cY(De,Te,Se,Ze,Ve);b.has(Ge)||(y.push(new n.aQ(Te,De,Se,Ze,Ve)),b.add(Ge))},M=t.reduce(((Te,De)=>Math.max(Te,De.overscaledZ)),d),R=1<<d,N=[new n.P(0,0),new n.P(n.al,0),new n.P(n.al,n.al),new n.P(0,n.al)],U=new n.P(0,0),Y=new n.P(0,0),X=(Te,De)=>{const Se=Math.floor(Te[0]),Ze=Math.floor(Te[1]),Ve=(Te[0]-Se)*n.al,Ge=(Te[1]-Ze)*n.al,Fe=Math.floor(De[0]),Oe=Math.floor(De[1]),it=(De[0]-Fe)*n.al,ft=(De[1]-Oe)*n.al;for(let ht=-1;ht<=1;ht++){const St=Se+ht;if(!(St<0||St>=R)){U.x=Ve-ht*n.al,Y.x=it-(St-Fe)*n.al;for(let It=-1;It<=1;It++){const zt=Ze+It;U.y=Ge-It*n.al,Y.y=ft-(zt-Oe)*n.al,n.cZ(U,Y,N)&&S(M,0,d,St,zt)}}}},Q=a.points,ae=Q[n.cv],ie=Q[n.cw],_e=this._projectToGround(ae,Q[n.cx]),fe=this._projectToGround(ie,Q[n.cy]);return X(ae,_e),X(ie,fe),y}_projectToGround(t,a){return n.cz(n.cA(),t,a,t[2]/(t[2]-a[2]))}coveringTiles(t){let a=this.coveringZoomLevel(t);const d=a,y=this.elevation&&this.elevation.exaggeration(),b=y&&!t.isTerrainDEM,S=this.projection.name==="mercator";if(t.minzoom!==void 0&&a<t.minzoom)return[];t.maxzoom!==void 0&&a>t.maxzoom&&(a=t.maxzoom);const M=this.locationCoordinate(this.center),R=this.center.lat,N=1<<a,U=[N*M.x,N*M.y,0],Y=this.projection.name==="globe",X=!Y,Q=n.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,a,X),ae=Y?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ie=N*n.cf(1,this.center.lat),_e=this._camera.position[2]/n.cf(1,this.center.lat),fe=[N*ae.x,N*ae.y,_e*(X?1:ie)],Te=Y||y,De=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),Se=this.isLODDisabled(!0)?a:0;let Ze;if(this._elevation&&t.isTerrainDEM)Ze=1e4*this._elevation.exaggeration();else if(this._elevation){const nt=this._elevation.getMinMaxForVisibleTiles();Ze=nt?nt.max:this._centerAltitude}else Ze=this._centerAltitude;const Ve=t.isTerrainDEM?-Ze:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ge=this.projection.isReprojectedInTileSpace?n.cC(this):1,Fe=nt=>{const Dt=new n.ae(nt.x+25e-6,nt.y,nt.z),li=new n.ae(nt.x,nt.y+25e-6,nt.z),Ei=nt.toLngLat(),Ri=Dt.toLngLat(),Ti=li.toLngLat(),mi=this.locationCoordinate(Ei),pn=this.locationCoordinate(Ri),en=this.locationCoordinate(Ti),ji=Math.hypot(pn.x-mi.x,pn.y-mi.y),Qi=Math.hypot(en.x-mi.x,en.y-mi.y);return Math.sqrt(ji*Qi)*Ge/25e-6},Oe=nt=>{const Bt=Ze,Dt=Ve;return{aabb:n.cF(this,N,0,0,0,nt,Dt,Bt,this.projection),zoom:0,x:0,y:0,minZ:Dt,maxZ:Bt,wrap:nt,fullyVisible:!1}},it=[];let ft=[];const ht=a,St=t.reparseOverscaled?d:a,It=(_e-this._centerAltitude)*ie,zt=nt=>{if(!this._elevation||!nt.tileID||!S)return;const Bt=this._elevation.getMinMaxForTile(nt.tileID),Dt=nt.aabb;Bt?(Dt.min[2]=Bt.min,Dt.max[2]=Bt.max,Dt.center[2]=(Dt.min[2]+Dt.max[2])/2):(nt.shouldSplit=gt(nt),nt.shouldSplit||(Dt.min[2]=Dt.max[2]=Dt.center[2]=this._centerAltitude))},Jt=(nt,Bt)=>{if(.707*Bt<nt)return 1;const Dt=Bt/nt;return Dt/(1.4144271570014144+(Math.pow(1.1,Dt-1.4144271570014144+1)-1)/(1.1-1)-1)},gt=nt=>{if(nt.zoom<Se)return!0;if(nt.zoom===ht)return!1;if(nt.shouldSplit!=null)return nt.shouldSplit;const Bt=nt.aabb.distanceX(fe),Dt=nt.aabb.distanceY(fe);let li=It,Ei=1;if(Y){li=nt.aabb.distanceZ(fe);const Qi=Math.pow(2,nt.zoom),vn=n.a$((nt.y+1)/Qi),rr=n.a$(nt.y/Qi),Br=Math.min(Math.max(R,vn),rr),ba=n.d1(Br)/n.d1(R);if(Ei=Br===R?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ba/this._mercatorScaleRatio),this.zoom<=n.c_&&nt.zoom===ht-1&&ba>=.9)return!0}else if(b&&(li=nt.aabb.distanceZ(fe)*ie),this.projection.isReprojectedInTileSpace&&d<=5){const Qi=Math.pow(2,nt.zoom),vn=Fe(new n.ae((nt.x+.5)/Qi,(nt.y+.5)/Qi));Ei=vn>.85?1:vn}if(!S&&!Y){const Qi=Math.sqrt(Bt*Bt+Dt*Dt+li*li);let vn=(1<<ht-nt.zoom)*De*Ei;return vn*=Jt(Math.max(li,It),Qi),Qi<vn}let Ri=Number.MAX_VALUE,Ti=0;const mi=nt.aabb.getCorners(),pn=[];for(const Qi of mi){n.av(pn,Qi,fe),Y||(b?pn[2]*=ie:pn[2]=It);const vn=n.bJ(pn,this._camera.forward());vn<Ri&&(Ri=vn,Ti=Math.abs(pn[2]))}let en=(1<<ht-nt.zoom)*De*Ei;if(en*=Jt(Math.max(Ti,It),Ri),Ri<en)return!0;const ji=nt.aabb.closestPoint(U);return ji[0]===U[0]&&ji[1]===U[1]};if(this.renderWorldCopies)for(let nt=1;nt<=3;nt++)it.push(Oe(-nt)),it.push(Oe(nt));for(it.push(Oe(0));it.length>0;){const nt=it.pop(),Bt=nt.x,Dt=nt.y;let li=nt.fullyVisible;const Ei=()=>this.projection.name==="globe"&&(nt.y===0||nt.y===(1<<nt.zoom)-1);if(!li){let Ri=Te?nt.aabb.intersects(Q):nt.aabb.intersectsFlat(Q);if(Ri===0&&Ei()){const Ti=new n.cD(nt.zoom,Bt,Dt);Ri=n.cE(this,N,Ti,!0).intersects(Q)}if(Ri===0)continue;li=Ri===2}if(nt.zoom!==ht&&gt(nt))for(let Ri=0;Ri<4;Ri++){const Ti=(Bt<<1)+Ri%2,mi=(Dt<<1)+(Ri>>1),pn={aabb:S?nt.aabb.quadrant(Ri):n.cF(this,N,nt.zoom+1,Ti,mi,nt.wrap,nt.minZ,nt.maxZ,this.projection),zoom:nt.zoom+1,x:Ti,y:mi,wrap:nt.wrap,fullyVisible:li,tileID:void 0,shouldSplit:void 0,minZ:nt.minZ,maxZ:nt.maxZ};b&&!Y&&(pn.tileID=new n.aQ(nt.zoom+1===ht?St:nt.zoom+1,nt.wrap,nt.zoom+1,Ti,mi),zt(pn)),it.push(pn)}else{const Ri=nt.zoom===ht?St:nt.zoom;if(t.minzoom&&t.minzoom>Ri)continue;let Ti=0;if(!li){let ji=Te?nt.aabb.intersectsPrecise(Q):nt.aabb.intersectsPreciseFlat(Q);if(ji===0&&Ei()){const Qi=new n.cD(nt.zoom,Bt,Dt);ji=n.cE(this,N,Qi,!0).intersectsPrecise(Q)}if(ji===0)continue;if(t.calculateQuadrantVisibility)if(Q.containsPoint(nt.aabb.center))Ti=15;else for(let Qi=0;Qi<4;Qi++)nt.aabb.quadrant(Qi).intersects(Q)!==0&&(Ti|=1<<Qi)}const mi=U[0]-(.5+Bt+(nt.wrap<<nt.zoom))*(1<<a-nt.zoom),pn=U[1]-.5-Dt,en=nt.tileID?nt.tileID:new n.aQ(Ri,nt.wrap,nt.zoom,Bt,Dt);t.calculateQuadrantVisibility&&(en.visibleQuadrants=Ti),ft.push({tileID:en,distanceSq:mi*mi+pn*pn})}}if(this.fogCullDistSq){const nt=this.fogCullDistSq,Bt=this.horizonLineFromTop();ft=ft.filter((Dt=>{const li=[0,0,0,1],Ei=[n.al,n.al,0,1],Ri=this.calculateFogTileMatrix(Dt.tileID.toUnwrapped());n.aC(li,li,Ri),n.aC(Ei,Ei,Ri);const Ti=n.cG([],li,Ei),mi=n.cH([],li,Ei),pn=n.c$(Ti,mi);if(pn===0)return!0;let en=!1;const ji=this._elevation;if(ji&&pn>nt&&Bt!==0){const Qi=this.calculateProjMatrix(Dt.tileID.toUnwrapped());let vn;t.isTerrainDEM||(vn=ji.getMinMaxForTile(Dt.tileID)),vn||(vn={min:Ve,max:Ze});const rr=n.cI(this.rotation),Br=[rr[0]*n.al,rr[1]*n.al,vn.max];n.af(Br,Br,Qi),en=(1-Br[1])*this.height*.5<Bt}return pn<nt||en}))}return ft.sort(((nt,Bt)=>nt.distanceSq-Bt.distanceSq)).map((nt=>nt.tileID))}resize(t,a){this.width=t,this.height=a,this.pixelsToGLUnits=[2/t,-2/a],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const a=n.aA(t.lat,-n.cJ,n.cJ),d=this.projection.project(t.lng,a);return new n.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,a){let d,y;const b=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;d=(a.x-b.x)/M,y=(a.y-b.y)/M}else{const M=this.pointCoordinate(a),R=this.pointCoordinate(b);d=M.x-R.x,y=M.y-R.y}const S=this.locationCoordinate(t);this.setLocation(new n.ae(S.x-d,S.y-y))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,a){return this.projection.locationPoint(this,t,a)}locationPoint3D(t,a){return this.projection.locationPoint(this,t,a,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,a){return this.coordinateLocation(this.pointCoordinate3D(t,a))}locationCoordinate(t,a){const d=a?n.cf(a,t.lat):void 0,y=this.projection.project(t.lng,t.lat);return new n.ae(y.x,y.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,a){const d=a??this._centerAltitude,y=[t.x,t.y,0,1],b=[t.x,t.y,1,1];n.aC(y,y,this.pixelMatrixInverse),n.aC(b,b,this.pixelMatrixInverse);const S=b[3];n.cK(y,y,1/y[3]),n.cK(b,b,1/S);const M=y[2],R=b[2];return{p0:y,p1:b,t:M===R?0:(d-M)/(R-M)}}screenPointToMercatorRay(t){const a=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return n.aC(a,a,this.pixelMatrixInverse),n.aC(d,d,this.pixelMatrixInverse),n.cK(a,a,1/a[3]),n.cK(d,d,1/d[3]),a[2]=n.cf(a[2],this._center.lat)*this.worldSize,d[2]=n.cf(d[2],this._center.lat)*this.worldSize,n.cK(a,a,1/this.worldSize),n.cK(d,d,1/this.worldSize),new n.ax([a[0],a[1],a[2]],n.aw([],n.av([],d,a)))}rayIntersectionCoordinate(t){const{p0:a,p1:d,t:y}=t,b=n.cf(a[2],this._center.lat),S=n.cf(d[2],this._center.lat);return new n.ae(n.ak(a[0],d[0],y)/this.worldSize,n.ak(a[1],d[1],y)/this.worldSize,n.ak(b,S,y))}pointCoordinate(t,a=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,a)}pointCoordinate3D(t,a){if(!this.elevation)return this.pointCoordinate(t,a);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new n.ae(d[0],d[1],d[2]);let y=0,b=this.horizonLineFromTop();if(t.y>b)return this.pointCoordinate(t,a);const S=.02*b,M=t.clone();for(let R=0;R<10&&b-y>S;R++){M.y=n.ak(y,b,.66);const N=this.projection.pointCoordinate3D(this,M.x,M.y);N?(b=M.y,d=N):y=M.y}return d?new n.ae(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.cL)return!this.isPointAboveHorizon(t);const a=this.pointCoordinate(t);return a.y>=0&&a.y<=1}_coordinatePoint(t,a){const d=a&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,y=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return n.aC(y,y,this.pixelMatrix),y[3]>0?new n.P(y[0]/y[3],y[1]/y[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:a}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new n.P(a,t)),S=this.pointLocation3D(new n.P(y,t)),M=this.pointLocation3D(new n.P(y,d)),R=this.pointLocation3D(new n.P(a,d));let N=Math.min(b.lng,S.lng,M.lng,R.lng),U=Math.max(b.lng,S.lng,M.lng,R.lng),Y=Math.min(b.lat,S.lat,M.lat,R.lat),X=Math.max(b.lat,S.lat,M.lat,R.lat);const Q=Math.pow(2,-this.zoom)/16*270,ae=this.projection.name==="globe"?1:4,ie=(_e,fe,Te,De,Se)=>{const Ze=(_e+Te)/2,Ve=(fe+De)/2,Ge=new n.P(Ze,Ve),{lng:Fe,lat:Oe}=this.pointLocation3D(Ge),it=Math.max(0,N-Fe,Y-Oe,Fe-U,Oe-X);N=Math.min(N,Fe),U=Math.max(U,Fe),Y=Math.min(Y,Oe),X=Math.max(X,Oe),(Se<ae||it>Q)&&(ie(_e,fe,Ze,Ve,Se+1),ie(Ze,Ve,Te,De,Se+1))};if(ie(a,t,y,t,1),ie(y,t,y,d,1),ie(y,d,a,d,1),ie(a,d,a,t,1),this.projection.name==="globe"){const[_e,fe]=n.cM(this);_e?(X=90,U=180,N=-180):fe&&(Y=-90,U=180,N=-180)}return new n.aI(new n.aT(N,Y),new n.aT(U,X))}_getBoundsRectangular(t,a){const{top:d,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,M=new n.P(y,d),R=new n.P(S,d),N=new n.P(S,b),U=new n.P(y,b);let Y=this.pointCoordinate(M,t),X=this.pointCoordinate(R,t);const Q=this.pointCoordinate(N,a),ae=this.pointCoordinate(U,a),ie=(_e,fe)=>(fe.y-_e.y)/(fe.x-_e.x);return Y.y>1&&X.y>=0?Y=new n.ae((1-ae.y)/ie(ae,Y)+ae.x,1):Y.y<0&&X.y<=1&&(Y=new n.ae(-ae.y/ie(ae,Y)+ae.x,0)),X.y>1&&Y.y>=0?X=new n.ae((1-Q.y)/ie(Q,X)+Q.x,1):X.y<0&&Y.y<=1&&(X=new n.ae(-Q.y/ie(Q,X)+Q.x,0)),new n.aI().extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(ae)).extend(this.coordinateLocation(Q))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const a=t.visibleDemTiles.reduce(((d,y)=>{if(y.dem){const b=y.dem.tree;d.min=Math.min(d.min,b.minimums[0]),d.max=Math.max(d.max,b.maximums[0])}return d}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(a.min*t.exaggeration(),a.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const a=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-a*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-n.cJ,this.maxLat=n.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.aF(this.minLng)*this.tileSize,this.worldMaxX=n.aF(this.maxLng)*this.tileSize,this.worldMinY=n.aJ(this.maxLat)*this.tileSize,this.worldMaxY=n.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,a){return this.projection.createTileMatrix(this,a,t)}calculateDistanceTileData(t){const a=t.key,d=this._distanceTileDataCache;if(d[a])return d[a];const y=t.canonical,b=1/this.height,S=this.cameraWorldSize,M=S/this.zoomScale(y.z),R=(y.x+Math.pow(2,y.z)*t.wrap)*M,N=y.y*M,U=this.point;U.x*=S/this.worldSize,U.y*=S/this.worldSize;const Y=this.angle,X=Math.sin(-Y),Q=-Math.cos(-Y);return d[a]={bearing:[X,Q],center:[(U.x-R)*b,(U.y-N)*b],scale:M/n.al*b},d[a]}calculateFogTileMatrix(t){const a=t.key,d=this._fogTileMatrixCache;if(d[a])return d[a];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.aB(y,this.worldToFogMatrix,y),d[a]=new Float32Array(y),d[a]}calculateProjMatrix(t,a=!1,d=!1){const y=t.key;let b;if(b=d?this._expandedProjMatrixCache:a?this._alignedProjMatrixCache:this._projMatrixCache,b[y])return b[y];const S=this.calculatePosMatrix(t,this.worldSize);let M;return M=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:a?this.alignedProjMatrix:this.projMatrix,n.aB(S,M,S),b[y]=new Float32Array(S),b[y]}calculatePixelsToTileUnitsMatrix(t){const a=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[a])return d[a];const y=n.cN(t,this);return d[a]=y,d[a]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,a=n.bq([],[t,t,t]);return n.aB(a,a,this.globeMatrix),a}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const a=n.cf(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(a),y=this._camera.forward(),b=n.cf(1,this._center.lat);d[2]/=b,y[2]/=b,n.aw(y,y);const S=t.raycast(d,y,t.exaggeration());if(S){const M=n.bH([],d,y,S),R=new n.ae(M[0],M[1],n.cf(M[2],n.a$(M[1]))),N=(R.z+n.ag([R.x-d[0],R.y-d[1],R.z-d[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(N),this._centerAltitude=R.toAltitude(),this._center=this.coordinateLocation(R),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const a=this._elevation,d=n.cf(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),b=a.getAtPointOrZero(new n.ae(...y)),S=this.pixelsPerMeter/this.worldSize*b,M=this._minimumHeightOverTerrain(),R=y[2]-S;if(R<=M)if(R<0||t){const N=this.locationCoordinate(this._center,this._centerAltitude),U=[y[0],y[1],N.z-y[2]],Y=n.ag(U);U[2]-=(M-R)/this._pixelsPerMercatorPixel;const X=n.ag(U);if(X===0)return;n.c5(U,U,Y/X*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],N.z*this._pixelsPerMercatorPixel-U[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const X=this.center;return X.lat=n.aA(X.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(X.lng=n.aA(X.lng,this.minLng,this.maxLng)),this.center=X,void(this._constraining=!1)}const a=this._unmodified,{x:d,y}=this.point;let b=0,S=d,M=y;const R=this.width/2,N=this.height/2,U=this.worldMinY*this.scale,Y=this.worldMaxY*this.scale;if(y-N<U&&(M=U+N),y+N>Y&&(M=Y-N),Y-U<this.height&&(b=Math.max(b,this.height/(Y-U)),M=(Y+U)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const X=this.worldMinX*this.scale,Q=this.worldMaxX*this.scale,ae=this.worldSize/2-(X+Q)/2;S=(d+ae+this.worldSize)%this.worldSize-ae,S-R<X&&(S=X+R),S+R>Q&&(S=Q-R),Q-X<this.width&&(b=Math.max(b,this.width/(Q-X)),S=(Q+X)/2)}S===d&&M===y||this._allowWorldUnderZoom||(this.center=this.unproject(new n.P(S,M))),b&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=a,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,a=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.cf(1,this.center.lat)/n.cf(1,n.d2));const y=n.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const b=this.projection.zAxisUnit==="meters"?d:1,S=this._camera.getWorldToCamera(this.worldSize,b);let M;const R=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(R[8]=2*-t.x/this.width,R[9]=2*t.y/this.height,this.isOrthographic){let Oe=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),it=Oe*this.aspect,ft=-it,ht=-Oe;it-=t.x,ft-=t.x,Oe+=t.y,ht+=t.y,M=this._camera.getCameraToClipOrthographic(ft,it,ht,Oe,this._nearZ,this._farZ),((St,It,zt,Jt)=>{for(let gt=0;gt<16;gt++)St[gt]=n.ak(It[gt],zt[gt],Jt)})(M,M,R,n.d0(this.pitch>=uc?1:this.pitch/uc))}else M=R;const N=n.cP([],R,S);let U=n.cP([],M,S);if(this.projection.isReprojectedInTileSpace){const Oe=this.locationCoordinate(this.center),it=n.bA([]);n.br(it,it,[Oe.x*this.worldSize,Oe.y*this.worldSize,0]),n.aB(it,it,n.cQ(this)),n.br(it,it,[-Oe.x*this.worldSize,-Oe.y*this.worldSize,0]),n.aB(U,U,it),n.aB(N,N,it),this.inverseAdjustmentMatrix=n.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.cS([],U,[this.worldSize,this.worldSize,this.worldSize/b,1]),this.projMatrix=U,this.invProjMatrix=n.bl(new Float64Array(16),this.projMatrix),a){const Oe=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Oe[8]=2*-t.x/this.width,Oe[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.cP([],Oe,S)}else this.expandedFarZProjMatrix=this.projMatrix;const Y=n.bl([],M);this.frustumCorners=n.cT.fromInvProjectionMatrix(Y,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!a);const X=new Float32Array(16);n.bA(X),n.cS(X,X,[1,-1,1]),n.cU(X,X,this._pitch),n.bB(X,X,this.angle);const Q=n.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.bz(Q);const ae=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-t.x/this.width,Q[9]=2*(t.y+ae)/this.height,this.skyboxMatrix=n.aB(X,Q,X);const ie=this.point,_e=ie.x,fe=ie.y,Te=this.width%2/2,De=this.height%2/2,Se=Math.cos(this.angle),Ze=Math.sin(this.angle),Ve=_e-Math.round(_e)+Se*Te+Ze*De,Ge=fe-Math.round(fe)+Se*De+Ze*Te,Fe=new Float64Array(U);if(n.br(Fe,Fe,[Ve>.5?Ve-1:Ve,Ge>.5?Ge-1:Ge,0]),this.alignedProjMatrix=Fe,U=n.bC(),n.cS(U,U,[this.width/2,-this.height/2,1]),n.br(U,U,[1,-1,0]),this.labelPlaneMatrix=U,U=n.bC(),n.cS(U,U,[1,-1,1]),n.br(U,U,[-1,-1,0]),n.cS(U,U,[2/this.width,2/this.height,1]),this.glCoordMatrix=U,this.pixelMatrix=n.aB(new Float64Array(16),this.labelPlaneMatrix,N),this._calcFogMatrices(),this._distanceTileDataCache={},U=n.bl(new Float64Array(16),this.pixelMatrix),!U)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=U,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.cV(this);const Oe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.af(Oe,Oe,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=U;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,a=this.cameraPixelsPerMeter,d=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[t,t,a];n.c5(b,b,y),n.c5(d,d,-1),n.cW(d,d,b);const S=n.bC();n.br(S,S,d),n.cS(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,a,y)}_computeCameraPosition(t){const a=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*a-t/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-d[0]*b,y.y/this.worldSize-d[1]*b,t/this.worldSize*this._centerAltitude-d[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const a=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],y=t[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((a-d)/y,1)),this._camera.position=n.bH([],this._camera.position,t,b),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,a=this._camera.forward(),{pitch:d,bearing:y}=this._camera.getPitchBearing(),b=n.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.an(this._maxPitch)),M=Math.max((t[2]-b)/Math.cos(d),S),R=this._zoomFromMercatorZ(M);n.bH(t,t,a,M),this._pitch=n.aA(d,n.an(this.minPitch),n.an(this.maxPitch)),this.angle=n.bT(y,-Math.PI,Math.PI),this._setZoom(n.aA(R,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let a=0,d=n.cL,y=0,b=1/0;for(;d-a>1e-6&&d>a;){const S=a+.5*(d-a),M=this.tileSize*Math.pow(2,S),R=this.getCameraToCenterDistance(this.projection,S,M),N=this.scaleZoom(R/(Math.max(0,t)*this.tileSize)),U=Math.abs(S-N);U<b&&(b=U,y=S),S<N?a=S:d=S}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,a){const d=Math.min(t.x,a.x),y=Math.max(t.x,a.x),b=Math.min(t.y,a.y),S=Math.max(t.y,a.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new n.P(d,b),new n.P(y,S),new n.P(d,S),new n.P(y,b)],R=this.renderWorldCopies?-3:0,N=this.renderWorldCopies?4:1;for(const U of M){const Y=this.pointRayIntersection(U);if(Y.t<0)return!0;const X=this.rayIntersectionCoordinate(Y);if(X.x<R||X.y<0||X.x>N||X.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,a){const d=n.ag(n.av([],this._camera.position,t)),y=this._zoomFromMercatorZ(d)+a;return d-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const t=(function([a,d,y],b){const S=[a,d,y,1];n.aC(S,S,b);const M=S[3]=Math.max(S[3],1e-6);return S[0]/=M,S[1]/=M,S[2]/=M,S})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,a=this.zoom,d=this.worldSize){const y=n.cO(t,a,this.width,this.height,1024),b=t.pixelSpaceConversion(this.center.lat,d,y);let S=.5/Math.tan(.5*this._fov)*this.height*b;return this.isOrthographic&&(S=n.ak(1,S,n.d0(this.pitch>=uc?1:this.pitch/uc))),S}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.aB(t,t,this.globeMatrix),t}getFrustum(t){return n.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const sh=(h,t)=>{if(t>0&&h.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const a=h.transform,d=Math.max(Math.abs(a._zoom-(h.minCutoffZoom-1)),1),y=a.isLODDisabled(!1)?n.ah(60,45,a.pitch):n.ah(30,15,a.pitch),b=a._farZ-a._nearZ,S=t*a.height,M=((1-(R=y))*a.cameraToCenterDistance+R*(a._farZ+S))*d;var R;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[a._nearZ,a._farZ,(M-a._nearZ)/b,(M-S-a._nearZ)/b]}}},gl=2048;class sd{constructor(t,a){this.aabb=t,this.lastCascade=a}}class ep{add(t,a){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],a.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],a.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],a.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],a.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],a.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],a.max[2])):this.receivers[t.key]=new sd(a,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,a,d){const y=n.d9.fromPoints(t.points);let b=0;for(const S in this.receivers){const M=this.receivers[S];if(!M||!y.intersectsAabb(M.aabb))continue;M.aabb.min=y.closestPoint(M.aabb.min),M.aabb.max=y.closestPoint(M.aabb.max);const R=M.aabb.getCorners();for(let N=0;N<d.length;N++){let U=!0;for(const Y of R){const X=[Y[0]*a,Y[1]*a,Y[2]];if(n.af(X,X,d[N].matrix),X[0]<-1||X[0]>1||X[1]<-1||X[1]>1){U=!1;break}}if(M.lastCascade=N,b=Math.max(b,N),U)break}}return b+1}}class du{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ep,this._depthMode=new xn(t.context.gl.LEQUAL,xn.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,a){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!a||!a.properties)return;const y=a.properties.get("shadow-intensity");if(!a.shadowsEnabled()||y<=0||(this._shadowLayerCount=d.style.order.reduce(((ae,ie)=>{const _e=d.style._mergedLayers[ie];return ae+(_e.hasShadowPass()&&!_e.isHidden(t.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const b=d.context,S=gl,M=gl;if(this._cascades.length===0||gl!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ae=0;ae<2;++ae){const ie=d._shadowMapDebug,_e=b.gl,fe=b.createFramebuffer(S,M,ie?1:0,"texture"),Te=new n.T(b,{width:S,height:M,data:null},_e.DEPTH_COMPONENT16);if(fe.depthAttachment.set(Te.texture),ie){const De=new n.T(b,{width:S,height:M,data:null},_e.RGBA8);fe.colorAttachment0.set(De.texture)}this._cascades.push({framebuffer:fe,texture:Te,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.cB,scale:0})}}this.shadowDirection=fu(a);let R=0;if(t.elevation){const ae=t.elevation,ie=[1e4,-1e4];ae.visibleDemTiles.filter((_e=>_e.dem)).forEach((_e=>{const fe=_e.dem.tree;ie[0]=Math.min(ie[0],fe.minimums[0]),ie[1]=Math.max(ie[1],fe.maximums[0])})),ie[0]!==1e4&&(R=(ie[1]-ie[0])*ae.exaggeration())}const N=1.5*t.cameraToCenterDistance,U=3*N,Y=new Float64Array(16);for(let ae=0;ae<this._cascades.length;++ae){const ie=this._cascades[ae];let _e=t.height/50,fe=1;ae===0?fe=N:(_e=N,fe=U);const[Te,De]=kc(t,this.shadowDirection,_e,fe,gl,R);ie.scale=t.scale,ie.matrix=Te,ie.boundingSphereRadius=De,n.bl(Y,ie.matrix),ie.frustum=n.cB.fromInvProjectionMatrix(Y,1,0,!0),ie.far=fe}const X=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[X].far,this._cascades[X].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=gl,this._uniformValues.u_shadowmap_0=ds.ShadowMap0,this._uniformValues.u_shadowmap_1=ds.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const Q=d.transform.elevation;for(const ae of this._groundShadowTiles){let ie={min:0,max:0};if(Q){const _e=Q.getMinMaxForTile(ae);_e&&(ie=_e)}this.addShadowReceiver(ae.toUnwrapped(),ie.min,ie.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,a){if(!this.enabled)return;const d=this.painter,y=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),y.viewport.set([0,0,gl,gl]);for(let b=0;b<this._numCascadesToRender;++b){d.currentShadowCascade=b,y.bindFramebuffer.set(this._cascades[b].framebuffer.framebuffer),y.clear({color:n.ao.white,depth:1});for(const S of t.order){const M=t._mergedLayers[S];if(!M.hasShadowPass()||M.isHidden(d.transform.zoom))continue;const R=t.getLayerSourceCache(M),N=R?a[R.id]:void 0;(M.type==="model"||N&&N.length)&&d.renderLayer(d,R,M,N)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,a=t.style,d=t.context,y=d.gl,b=a.directionalLight,S=a.ambientLight;if(!b||!S)return;const M=[],R=sh(t,t.longestCutoffRange);R.shouldRenderCutoff&&M.push("RENDER_CUTOFF"),M.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&M.push("NORMAL_OFFSET");const N=Lc(a,b,S),U=new xn(y.LEQUAL,xn.ReadOnly,t.depthRangeFor3D),Y=new Un({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const X of this._groundShadowTiles){const Q=X.toUnwrapped(),ae=t.isTileAffectedByFog(X),ie=t.getOrCreateProgram("groundShadow",{defines:M,overrideFog:ae});this.setupShadows(Q,ie),t.uploadCommonUniforms(d,ie,Q,null,R);const _e={u_matrix:t.transform.calculateProjMatrix(Q),u_ground_shadow_factor:N};ie.draw(t,y.TRIANGLES,U,Y,cr.multiply,jn.disabled,_e,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?cr.unblended:cr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const a=this.painter.transform,d=a.calculatePosMatrix(t,a.worldSize);return n.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){const a=n.bz(t);return n.aB(a,this._cascades[this.painter.currentShadowCascade].matrix,t),a}setupShadows(t,a,d){if(!this.enabled)return;const y=this.painter.transform,b=this.painter.context,S=b.gl,M=this._uniformValues,R=new Float64Array(16),N=y.calculatePosMatrix(t,y.worldSize);for(let U=0;U<this._cascades.length;U++)n.aB(R,this._cascades[U].matrix,N),M[U===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(R),b.activeTexture.set(S.TEXTURE0+ds.ShadowMap0+U),this._cascades[U].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const U=n.d7(t.canonical),Y=2/y.tileSize*n.al/gl,X=Y*this._cascades[0].boundingSphereRadius,Q=Y*this._cascades[this._cascades.length-1].boundingSphereRadius,ae=(d==="vector-tile"?1:3)*(function(ie,_e,fe,Te,De){const Se=n.aA((ie-22)/-22,0,1);return .125*(1-Se)+4*Se})(y.zoom);M.u_shadow_normal_offset=[U,X*ae,Q*ae],M.u_shadow_bias=[1e-4,.0012,.012]}else M.u_shadow_bias=[36e-5,.0012,.012];a.setShadowUniformValues(b,M)}setupShadowsFromMatrix(t,a,d=!1){if(!this.enabled)return;const y=this.painter.context,b=y.gl,S=this._uniformValues,M=new Float64Array(16);for(let R=0;R<2;R++)n.aB(M,this._cascades[R].matrix,t),S[R===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(M),y.activeTexture.set(b.TEXTURE0+ds.ShadowMap0+R),this._cascades[R].texture.bindExtraParam(b.LINEAR,b.LINEAR,b.CLAMP_TO_EDGE,b.CLAMP_TO_EDGE,b.GREATER);this.useNormalOffset=d,d?(S.u_shadow_normal_offset=[1,3,3],S.u_shadow_bias=[6e-5,.0012,.012]):S.u_shadow_bias=[36e-5,.0012,.012],a.setShadowUniformValues(y,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,a,d,y){if(y[2]>=0)return{};const b=(function(R,N,U){const Y=U/(1<<R.canonical.z);return new n.d9([R.canonical.x*Y+R.wrap*U,R.canonical.y*Y+R.wrap*U,0],[(R.canonical.x+1)*Y+R.wrap*U,(R.canonical.y+1)*Y+R.wrap*U,N])})(t,a,d).getCorners(),S=a/-y[2];y[0]<0?(n.d8(b[0],b[0],[y[0]*S,0,0]),n.d8(b[3],b[3],[y[0]*S,0,0])):y[0]>0&&(n.d8(b[1],b[1],[y[0]*S,0,0]),n.d8(b[2],b[2],[y[0]*S,0,0])),y[1]<0?(n.d8(b[0],b[0],[0,y[1]*S,0]),n.d8(b[1],b[1],[0,y[1]*S,0])):y[1]>0&&(n.d8(b[2],b[2],[0,y[1]*S,0]),n.d8(b[3],b[3],[0,y[1]*S,0]));const M={};return M.vertices=b,M.planes=[od(b[1],b[0],b[4]),od(b[2],b[1],b[5]),od(b[3],b[2],b[6]),od(b[0],b[3],b[7])],M}addShadowReceiver(t,a,d){this._receivers.add(t,n.d9.fromTileIdAndHeight(t,a,d))}getMaxCascadeForTile(t){const a=this._receivers.get(t);return a&&a.lastCascade?a.lastCascade:0}}function od(h,t,a){const d=n.av([],a,t),y=n.av([],h,t),b=n.bI([],d,y),S=n.ag(b);return S===0?[0,0,1,0]:(n.c5(b,b,1/S),[b[0],b[1],b[2],-n.bJ(b,t)])}function fu(h){const t=h.properties.get("direction"),a=n.d4(t.x,t.y,t.z);a[2]=n.aA(a[2],0,75);const d=n.d6([a[0],a[1],a[2]]);return n.d5(d.x,d.y,d.z)}function Lc(h,t,a){const d=t.properties.get("color-use-theme")==="none",y=t.properties.get("color"),b=t.properties.get("intensity"),S=t.properties.get("direction"),M=[S.x,S.y,S.z],R=a.properties.get("color-use-theme")==="none",N=a.properties.get("color"),U=a.properties.get("intensity"),Y=Math.max(n.bJ([0,0,1],M),0),X=[0,0,0];n.c5(X,N.toPremultipliedRenderColor(R?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),U);const Q=[0,0,0];return n.c5(Q,y.toPremultipliedRenderColor(d?null:h.getLut(a.scope)).toArray01Linear().slice(0,3),Y*b),n.db([X[0]>0?X[0]/(X[0]+Q[0]):0,X[1]>0?X[1]/(X[1]+Q[1]):0,X[2]>0?X[2]/(X[2]+Q[2]):0])}function kc(h,t,a,d,y,b){const S=h.zoom,M=h.scale,R=h.worldSize,N=1/R,U=h.aspect,Y=Math.sqrt(1+U*U)*Math.tan(.5*h.fovX),X=Y*Y,Q=d-a,ae=d+a;let ie,_e;X>Q/ae?(ie=d,_e=d*Y):(ie=.5*ae*(1+X),_e=.5*Math.sqrt(Q*Q+2*(d*d+a*a)*X+ae*ae*X*X));const fe=h.projection.pixelsPerMeter(h.center.lat,R),Te=h._camera.getCameraToWorldMercator(),De=[0,0,-ie*N];n.af(De,De,Te);let Se=_e*N;const Ze=h._edgeInsets;if(!(Ze.left===0&&Ze.top===0&&Ze.right===0&&Ze.bottom===0||Ze.left===Ze.right&&Ze.top===Ze.bottom)){const li=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?fe:1),Ei=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,a,d);Ei[8]=2*-h.centerOffset.x/h.width,Ei[9]=2*h.centerOffset.y/h.height;const Ri=new Float64Array(16);n.cP(Ri,Ei,li);const Ti=new Float64Array(16);n.bl(Ti,Ri);const mi=n.cB.fromInvProjectionMatrix(Ti,R,S,!0);for(const pn of mi.points){const en=((Ve=pn)[0]/=M,Ve[1]/=M,Ve[2]=n.cf(Ve[2],h._center.lat),Ve);Se=Math.max(Se,n.c6(n.da([],De,en)))}}var Ve;Se*=y/(y-1);const Ge=Math.acos(t[2]),Fe=Math.atan2(-t[0],-t[1]),Oe=new Mf;Oe.position=De,Oe.setPitchBearing(Ge,Fe);const it=Oe.getWorldToCamera(R,fe),ft=Se*R,ht=Math.min(h._mercatorZfromZoom(17)*R*-2,-2*ft),St=Oe.getCameraToClipOrthographic(-ft,ft,-ft,ft,ht,(ft+b*fe)/t[2]),It=new Float64Array(16);n.aB(It,St,it);const zt=n.d5(Math.floor(1e6*De[0])/1e6*R,Math.floor(1e6*De[1])/1e6*R,0),Jt=.5*y,gt=[0,0,0];n.af(gt,zt,It),n.c5(gt,gt,Jt);const nt=[Math.floor(gt[0]),Math.floor(gt[1]),Math.floor(gt[2])],Bt=[0,0,0];n.av(Bt,gt,nt),n.c5(Bt,Bt,-1/Jt);const Dt=new Float64Array(16);return n.bA(Dt),n.br(Dt,Dt,Bt),n.aB(It,Dt,It),[It,ft]}class pu extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,a){return n.dc(this.requestManager.transformRequest(a,n.R.Model).url).then((d=>{if(!d)return;const y=n.dd(d),b=new n.de(t,a,void 0,void 0,y);return b.computeBoundsAndApplyParent(),b})).catch((d=>{if(d&&d.status===404)return null;this.fire(new n.y(new Error(`Could not load model ${t} from ${a}: ${d.message}`)))}))}load(t,a,d={forceReload:!1}){this.models[a]||(this.models[a]={});const y=Object.keys(t),b=[],S=[];for(const M of y){const R=t[M];this.hasURLBeenRequested(R)&&!d.forceReload||(this.modelByURL[R]={modelId:M,scope:a},b.push(this.loadModel(M,R)),S.push(M)),this.models[a][M]||(this.models[a][M]={model:null,numReferences:1})}this.numModelsLoading[a]=(this.numModelsLoading[a]||0)+S.length,Promise.allSettled(b).then((M=>{for(let R=0;R<M.length;R++){const{status:N}=M[R];if(N==="rejected")continue;const{value:U}=M[R];this.models[a][S[R]]||(this.models[a][S[R]]={model:null,numReferences:1}),this.models[a][S[R]].model=U}this.numModelsLoading[a]-=S.length,this.fire(new n.z("data",{dataType:"style"}))})).catch((M=>{this.fire(new n.y(new Error(`Could not load models: ${M.message}`)))}))}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,a,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,a):this.getModelByURL(this.modelUris[a][t]))}getModel(t,a){return this.models[a]||(this.models[a]={}),this.models[a][t]?this.models[a][t].model:void 0}getModelByURL(t){if(!t)return null;const a=this.modelByURL[t];return a?this.models[a.scope][a.modelId].model:null}hasModelBeenAdded(t,a){return this.models[a]&&this.models[a][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,a,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const y=this.requestManager.normalizeModelURL(a);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===y)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:b,modelId:S}=this.modelByURL[y];this.models[b][S].numReferences++}else this.modelUris[d][t]=y,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const d=this.modelUris[a];for(const y in t)d[y]=this.requestManager.normalizeModelURL(t[y])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,a){this.models[a]||(this.models[a]={}),this.modelUris[a]||(this.modelUris[a]={});const d={};for(const y of t)this.hasModel(y,a,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[a][y].numReferences++:this.modelUris[a][y]&&!this.hasURLBeenRequested(y)?d[y]=this.modelUris[a][y]:!this.hasURLBeenRequested(y)&&n.df(y,!1)&&(this.modelUris[a][y]=this.requestManager.normalizeModelURL(y),d[y]=this.modelUris[a][y]);this.load(d,a)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,a,d=!1,y=!1){if(this.models[a]&&this.models[a][t]&&(this.models[a][t].numReferences--,this.models[a][t].numReferences===0||y)){const b=this.modelUris[a][t];d||delete this.modelUris[a][t],delete this.modelByURL[b];const S=this.models[a][t].model;if(!S)return;delete this.models[a][t],S.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const a of Object.keys(this.models[t])){const d=this.models[t][a].model;delete this.models[t][a],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,a){this.models[a]||(this.models[a]={});for(const d in this.models[a])this.models[a][d].model&&this.models[a][d].model.upload(t.context)}}const Xc=n.a6.colorTheme,Cf=new n.a9({data:new n.aa(Xc.data)});function ld(h){if(!h.metadata||!h.metadata.content_area)return;const t=n.o.devicePixelRatio,{left:a,top:d,width:y,height:b}=h.metadata.content_area,S=a*t,M=d*t;return[S,M,S+y*t,M+b*t]}function mu(h){if(h)return h.map((([t,a])=>[t*n.o.devicePixelRatio,a*n.o.devicePixelRatio]))}class Cd{constructor(t,a,d){this.id=t,this.scope=a,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const a=this.sourceCache.getVisibleCoordinates();if(a.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof _a))return t;const y=a.map((S=>this.sourceCache.getTile(S))),b=d.getImages(y,Array.from(this.pendingRequests));for(const[S,M]of b)t.set(n.I.from({name:S,iconsetId:this.id}),M),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),t}}const _u=(h,t)=>ze(h,t&&t.filter((a=>a.identifier!=="source.canvas"))),zf=n.aH(Wr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),um=n.aH(Wr,["setCenter","setZoom","setBearing","setPitch"]),Df=new Set(["background","sky","slot","custom"]),Ou={version:8,layers:[],sources:{}},cd={duration:300,delay:0};class kl extends n.E{constructor(t,a={}){super(),this.map=t,this.scope=a.scope||"",this.globalId=null,this.fragments=[],this.importDepth=a.importDepth||0,this.importsCache=a.importsCache||new Map,this.resolvedImports=a.resolvedImports||new Set,this.transition=Object.assign({},cd),this._buildingIndex=new Ep(this),this.crossTileSymbolIndex=new Jl,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=a.styleChanges||new zr,this._hasDataDrivenEmissive=!1,this.dispatcher=a.dispatcher?a.dispatcher:new n.D(n.dh(),this),a.imageManager?this.imageManager=a.imageManager:(this.imageManager=new ma(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=a.glyphManager?a.glyphManager:new n.di(t._requestManager,a.localFontFamily?n.dj.all:a.localIdeographFontFamily?n.dj.ideographs:n.dj.none,a.localFontFamily||a.localIdeographFontFamily),a.modelManager?this.modelManager=a.modelManager:(this.modelManager=new pu(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=a.configOptions?a.configOptions:new Map,this._configDependentLayers=a.configDependentLayers?a.configDependentLayers:new Set,this._indoorDependentLayers=a.indoorDependentLayers?a.indoorDependentLayers:new Set,this._config=a.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:a.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=a.initialConfig,this.dispatcher.broadcast("setReferrer",n.dk());const d=this;this._rtlTextPluginCallback=kl.registerForPluginStateChange((y=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},((b,S)=>{if(n.dl(b),S&&S.every((M=>M)))for(const M in d._sourceCaches){const R=d._sourceCaches[M],N=R.getSource().type;N!=="vector"&&N!=="geojson"||R.reload()}}))})),this.on("data",(y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getOwnSource(y.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const M=this._layers[S];M.source===b.id&&this._validateLayer(M)}}))}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.h(t))return t;const a=n.dm(t);if(!a.startsWith("http"))try{return new URL(a,location.href).toString()}catch{return a}return a}return`json://${n.dn(JSON.stringify(t))}`}_diffStyle(t,a,d){this.globalId=this._getGlobalId(t);const y=(b,S)=>{try{S(null,this.setState(b,d))}catch(M){S(M,!1)}};if(typeof t=="string"){const b=this.map._requestManager.normalizeStyleURL(t),S=this.map._requestManager.transformRequest(b,n.R.Style);n.m(S,((M,R)=>{M?this.fire(new n.y(M)):R&&y(R,a)}))}else typeof t=="object"&&y(t,a)}loadURL(t,a={}){this.fire(new n.z("dataloading",{dataType:"style"}));const d=typeof a.validate=="boolean"?a.validate:!n.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,a.accessToken),this.resolvedImports.add(t);const y=this.importsCache.get(t);if(y)return this._load(y,d);const b=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.m(b,((S,M)=>{if(this._request=null,S)this.fire(new n.y(S));else if(M)return this.importsCache.set(t,M),this._load(M,d)}))}loadJSON(t,a={}){this.fire(new n.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.o.frame((()=>{this._request=null,this._load(t,a.validate!==!1)}))}loadEmpty(){this.fire(new n.z("dataloading",{dataType:"style"})),this._load(Ou,!1)}_loadImports(t,a,d){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const b of t){const S=this._createFragmentStyle(b),M=new Promise((U=>{S.once("style.import.load",U),S.once("error",U)})).then((()=>this.mergeAll()));if(y.push(M),this.resolvedImports.has(b.url)){S.loadEmpty();continue}const R=b.data||this.importsCache.get(b.url);R?(S.loadJSON(R,{validate:a}),this._isInternalStyle(R)&&(S.globalId=null)):b.url?S.loadURL(b.url,{validate:a}):S.loadEmpty();const N={style:S,id:b.id,config:b.config};if(d){const U=this.fragments.findIndex((({id:Y})=>Y===d));this.fragments=this.fragments.slice(0,U).concat(N).concat(this.fragments.slice(U))}else this.fragments.push(N)}return Promise.allSettled(y)}getImportGlobalIds(t=this,a=new Set){for(const d of t.fragments)d.style.globalId&&a.add(d.style.globalId),this.getImportGlobalIds(d.style,a);return[...a.values()]}_createFragmentStyle(t){const a=this.scope?n.B(t.id,this.scope):t.id;let d;const y=this._initialConfig&&this._initialConfig[a];(t.config||y)&&(d=Object.assign({},t.config,y));const b=new kl(this.map,{scope:a,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return b.setEventedParent(this.map,{style:b}),b}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,a){if(this._isInternalStyle(t)){const b=Object.assign({},Ou,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(b,a)}if(this.updateConfig(this._config,t.schema),a&&_u(this,mt(t)))return;this._loaded=!0,this.stylesheet=n.dp(t);const d=()=>{for(const R in t.sources)this.addSource(R,t.sources[R],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const R in t.iconsets)this.addIconset(R,t.iconsets[R]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const b=rh(this.stylesheet.layers);if(this._order=b.map((R=>R.id)),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const R=this.stylesheet.lights[0];this.light=new rt(R.properties,R.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new rt(this.stylesheet.light)),this._layers={};for(const R of b){const N=n.du(R,this.scope,this._styleColorTheme.lut,this.options);N.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(N.fqid),N.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(N.fqid),this._hasAppearances=this._hasAppearances||N.getAppearances().length!==0,N.setEventedParent(this,{layer:{id:N.id}}),this._layers[N.id]=N;const U=this.getOwnLayerSourceCache(N),Y=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&N.canCastShadows()&&Y&&(U.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.z("data",{dataType:"style"}));const M=this.isRootStyle();t.imports?this._loadImports(t.imports,a).then((()=>{this._reloadImports(),this.fire(new n.z(M?"style.load":"style.import.load"))})).catch((R=>{this.fire(new n.y(new Error("Failed to load imports",R))),this.fire(new n.z(M?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new n.z(M?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const b=this._evaluateColorThemeData(y);this._loadColorTheme(b).then((()=>{d()})).catch((S=>{n.w(`Couldn't load color theme from the stylesheet: ${S}`),d()}))}else this._styleColorTheme.lut=null,d()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some((t=>t.style.hasAppearances()))}mergeAll(){let t,a,d,y,b,S,M,R,N,U;const Y={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((X=>{if(X.stylesheet){if(X.light!=null&&(t=X.light),X.stylesheet.lights)for(const Q of X.stylesheet.lights)Q.type==="ambient"&&X.ambientLight!=null&&(a=X.ambientLight),Q.type==="directional"&&X.directionalLight!=null&&(d=X.directionalLight);y=this._prioritizeTerrain(y,X.terrain,X.stylesheet.terrain),X.stylesheet.fog&&X.fog!=null&&(b=X.fog),X.stylesheet.snow&&X.snow!=null&&(S=X.snow),X.stylesheet.rain&&X.rain!=null&&(M=X.rain),X.stylesheet.camera!=null&&(U=X.stylesheet.camera),X.stylesheet.projection!=null&&(R=X.stylesheet.projection),X.stylesheet.transition!=null&&(N=X.stylesheet.transition),Y[X.scope]=X._styleColorTheme}})),this.light=t,this.ambientLight=a,this.directionalLight=d,this.fog=b,this.snow=S,this.rain=M,this._styleColorThemeForScope=Y,y===null?delete this.terrain:this.terrain=y,this.camera=U||{"camera-projection":"perspective"},this.projection=R||{name:"mercator"},this.transition=Object.assign({},cd,N),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const a=d=>{for(const y of d.fragments)a(y.style);t(d)};a(this)}_prioritizeTerrain(t,a,d){const y=t&&t.drapeRenderMode===0;return d===null?a&&a.drapeRenderMode===0?a:y?t:null:a!=null&&(!t||y||a&&a.drapeRenderMode===1)?a:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((a=>{t=this._prioritizeTerrain(t,a.terrain,a.stylesheet.terrain)})),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle((a=>{a.stylesheet.projection!=null&&(t=a.stylesheet.projection)})),this.projection=t||{name:"mercator"}}mergeSources(){const t={},a={},d={};this.forEachFragmentStyle((y=>{for(const b in y._sourceCaches){const S=n.B(b,y.scope);t[S]=y._sourceCaches[b]}for(const b in y._otherSourceCaches){const S=n.B(b,y.scope);a[S]=y._otherSourceCaches[b]}for(const b in y._symbolSourceCaches){const S=n.B(b,y.scope);d[S]=y._symbolSourceCaches[b]}})),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=a,this._mergedSymbolSourceCaches=d}mergeIndoor(){this.forEachFragmentStyle((t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const a of Object.values(t.stylesheet.indoor)){const d=a,y=n.B(d.sourceId,t.scope);this._mergedIndoor[y]=new Set(d.sourceLayers||[])}}))}mergeLayers(){const t={},a=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((S=>{for(const M of S._order){const R=S._layers[M];if(R.type==="slot"){const N=n.dq(M);if(t[N])continue;t[N]=[]}R.slot&&t[R.slot]?t[R.slot].push(R):a.push(R)}})),this._mergedOrder=[];let y=-1;const b=(S=[])=>{for(const M of S)if(M.type==="slot"){const R=n.dq(M.id);t[R]&&b(t[R]),this._mergedSlots.push(R)}else{const R=n.B(M.id,M.scope);this._mergedOrder.push(R),d[R]=M,M.is3D(!!this.terrain)&&(this._has3DLayers=!0,y=this._mergedOrder.length-1),M.type==="circle"&&(this._hasCircleLayers=!0),M.type==="symbol"&&(this._hasSymbolLayers=!0),M.type==="clip"&&(this._clipLayerPresent=!0)}};if(b(a),this._has3DLayers){const S={};for(let M=0;M<this._mergedOrder.length;++M){const R=this._mergedOrder[M];S[R]=M===y?1:M<y?d[R].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((M,R)=>S[M]-S[R]))}this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?(function(a,d,y,b){const S=Object.assign({},d);for(const R of Object.keys(Xc))S[R]===void 0&&(S[R]=Xc[R].default);const M=new n.a8(Cf,a,new Map(y));return M.setTransitionOrValue(S,y),M.untransitioned().possiblyEvaluate(new n.ac(0,{worldview:void 0}))})(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const a=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((d,y)=>{const b="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let S=t;S.startsWith(b)||(S=b+S);const M=n.I.from("mapbox-reserved-lut"),R=new Image;R.src=S,R.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},R.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==a)return void d();this._styleColorTheme.lutLoading=!1;const{width:N,height:U,data:Y}=n.o.getImageData(R);if(U>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(N!==U*U)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(M)&&this.removeImage(M),this.addImage(M,{data:new n.q({width:N,height:U},Y),pixelRatio:1,sdf:!1,usvg:!1,version:0});const X=this.imageManager.getImage(M,this.scope);X?(this._styleColorTheme.lut={image:X.data,data:t},d()):y(new Error("Missing LUT image."))}}))}getLut(t){const a=this._styleColorThemeForScope[t];return a?a.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=(function(a,d,y){let b,S,M;const R=n.o.devicePixelRatio>1?"@2x":"";let N=n.m(d.transformRequest(d.normalizeSpriteURL(a,R,".json"),n.R.SpriteJSON),((X,Q)=>{N=null,M||(M=X,b=Q,Y())})),U=n.n(d.transformRequest(d.normalizeSpriteURL(a,R,".png"),n.R.SpriteImage),((X,Q)=>{U=null,M||(M=X,S=Q,Y())}));function Y(){if(M)y(M);else if(b&&S){const X=n.o.getImageData(S),Q={};for(const ae in b){const{width:ie,height:_e,x:fe,y:Te,sdf:De,pixelRatio:Se,stretchX:Ze,stretchY:Ve,content:Ge}=b[ae],Fe=new n.q({width:ie,height:_e});n.q.copy(X,Fe,{x:fe,y:Te},{x:0,y:0},{width:ie,height:_e},null),Q[ae]={data:Fe,pixelRatio:Se!==void 0?Se:1,sdf:De!==void 0&&De,stretchX:Ze,stretchY:Ve,content:Ge,usvg:!1,version:0}}y(null,Q)}}return{cancel(){N&&(N.cancel(),N=null),U&&(U.cancel(),U=null)}}})(t,this.map._requestManager,((a,d)=>{if(this._spriteRequest=null,a)this.fire(new n.y(a));else if(d){const y=new Map;for(const b in d)y.set(n.I.from(b),d[b]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))}))}addIconset(t,a){if(a.type==="sprite")return void this._loadSprite(a.url);const d=this.getOwnSourceCache(a.source);if(!d)return void this.fire(new n.y(new Error(`Source "${a.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const y=d.getSource();if(y.type!=="raster-array")return void this.fire(new n.y(new Error(`Source "${a.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const b=new Cd(t,this.scope,d);this.imageManager.addImageProvider(b,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!n.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const a=this.map._spriteFormat==="auto";var d,y;this._spriteRequest=(y=(b,S)=>{if(this._spriteRequest=null,b)a?this._loadSprite(t):this.fire(new n.y(b));else if(S){const M=new Map;for(const R in S)M.set(n.I.from(R),S[R]);this.addImages(M)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))},n.bu((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),n.R.Iconset),((b,S)=>{if(b)return void y(b);const M={},R=n.dg(new n.bt(S));for(const N of R.icons){const U={version:1,pixelRatio:n.o.devicePixelRatio,content:ld(N),stretchX:N.metadata?mu(N.metadata.stretch_x_areas):void 0,stretchY:N.metadata?mu(N.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:N};M[N.name]=U}y(null,M)})))}_validateLayer(t){const a=this.getOwnSource(t.source);if(!a)return;const d=t.sourceLayer;d&&(a.type==="geojson"||a.vectorLayerIds&&a.vectorLayerIds.indexOf(d)===-1)&&this.fire(new n.y(new Error(`Source layer "${d}" does not exist on source "${a.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((t,a)=>{const d=this.fragments[a];return d&&d.style&&(t.data=d.style.serialize()),t}))}_serializeSources(){const t={};for(const a in this._sourceCaches){const d=this._sourceCaches[a].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const a=[];for(const d of t){const y=this._layers[d];y&&y.type!=="custom"&&a.push(y.serialize())}return a}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const a=this._mergedLayers[t];if(a._transitionablePaint&&a._transitionablePaint._values){const d=a._transitionablePaint._values["line-emissive-strength"];if(d&&d.value&&d.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const a=this.getOwnLayer(t);if(a)return a;this.fire(new n.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const a=this.getOwnSource(t);if(a)return a;this.fire(new n.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,a){const d=this.map.painter;if(d)for(let y=t.minzoom||0;y<(t.maxzoom||25.5);y++){const b=t.getProgramIds();if(b)for(const S of b){const M=t.getDefaultProgramParams(S,a.zoom,this._styleColorTheme.lut);M&&(d.style=this,this.fog&&(d._fogVisible=!0,M.overrideFog=!0,d.getOrCreateProgram(S,M)),d._fogVisible=!1,M.overrideFog=!1,d.getOrCreateProgram(S,M),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(M.overrideRtt=!0,d.getOrCreateProgram(S,M)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const a=this.calculateLightsBrightness();t.brightness=a||0,a!==this._brightness&&(this._brightness=a,this.dispatcher.broadcast("setBrightness",a)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const M=this._changes.getLayerUpdatesByScope();for(const R in M){const{updatedIds:N,removedIds:U}=M[R];(N||U)&&(this._updateWorkerLayers(R,N,U),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const b={};for(const M in this._mergedSourceCaches){const R=this._mergedSourceCaches[M];b[M]=R.used,R.used=!1,R.tileCoverLift=0}for(const M of this._mergedOrder){const R=this._mergedLayers[M];if(R.visibility!=="none"&&R.recalculate(t,this._availableImages),!R.isHidden(t.zoom)){const N=this.getLayerSourceCache(R);N&&(N.used=!0,N.tileCoverLift=Math.max(N.tileCoverLift,R.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(R,t)})):this.precompilePrograms(R,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const M of S)M.sourceCache.used=!0;for(const M in b){const R=this._mergedSourceCaches[M];b[M]!==R.used&&R.getSource().fire(new n.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:R.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new n.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const a of t){const d=a.resolvePendingRequests(),y=this.getFragmentStyle(a.scope);y&&y.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const a in this._mergedSourceCaches){const d=this._mergedSourceCaches[a].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[a].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const a in t)this._changes.resetUpdatedImages(a)}_updateWorkerLayers(t,a,d){const y=this.getFragmentStyle(t);y&&this.dispatcher.broadcast("updateLayers",{layers:a?y._serializeLayers(a):[],scope:t,removedIds:d||[],options:y.options})}setState(t,a){if(this._checkLoaded(),_u(this,mt(t)))return!1;(t=n.dp(t)).layers=rh(t.layers);const d=(function(S,M){if(!S)return[{command:Wr.setStyle,args:[M]}];let R=[];try{if(!n.by(S.version,M.version))return[{command:Wr.setStyle,args:[M]}];if(n.by(S.center,M.center)||R.push({command:Wr.setCenter,args:[M.center]}),n.by(S.zoom,M.zoom)||R.push({command:Wr.setZoom,args:[M.zoom]}),n.by(S.bearing,M.bearing)||R.push({command:Wr.setBearing,args:[M.bearing]}),n.by(S.pitch,M.pitch)||R.push({command:Wr.setPitch,args:[M.pitch]}),n.by(S.sprite,M.sprite)||R.push({command:Wr.setSprite,args:[M.sprite]}),n.by(S.glyphs,M.glyphs)||R.push({command:Wr.setGlyphs,args:[M.glyphs]}),n.by(S.imports,M.imports)||(function(Q=[],ae=[],ie){ae=ae||[];const _e=(Q=Q||[]).map(Du),fe=ae.map(Du),Te=Q.reduce(Ru,{}),De=ae.reduce(Ru,{}),Se=_e.slice();let Ze,Ve,Ge,Fe;for(Ze=0,Ve=0;Ze<_e.length;Ze++)Ge=_e[Ze],De.hasOwnProperty(Ge)?Ve++:(ie.push({command:Wr.removeImport,args:[Ge]}),Se.splice(Se.indexOf(Ge,Ve),1));for(Ze=0,Ve=0;Ze<fe.length;Ze++)Ge=fe[fe.length-1-Ze],Se[Se.length-1-Ze]!==Ge&&(Te.hasOwnProperty(Ge)?(ie.push({command:Wr.removeImport,args:[Ge]}),Se.splice(Se.lastIndexOf(Ge,Se.length-Ve),1)):Ve++,Fe=Se[Se.length-Ze],ie.push({command:Wr.addImport,args:[De[Ge],Fe]}),Se.splice(Se.length-Ze,0,Ge));for(const Oe of ae){const it=Te[Oe.id];it&&(delete it.data,n.by(it,Oe)||ie.push({command:Wr.updateImport,args:[Oe.id,Oe]}))}})(S.imports,M.imports,R),n.by(S.transition,M.transition)||R.push({command:Wr.setTransition,args:[M.transition]}),n.by(S.light,M.light)||R.push({command:Wr.setLight,args:[M.light]}),n.by(S.fog,M.fog)||R.push({command:Wr.setFog,args:[M.fog]}),n.by(S.snow,M.snow)||R.push({command:Wr.setSnow,args:[M.snow]}),n.by(S.rain,M.rain)||R.push({command:Wr.setRain,args:[M.rain]}),n.by(S.projection,M.projection)||R.push({command:Wr.setProjection,args:[M.projection]}),n.by(S.lights,M.lights)||R.push({command:Wr.setLights,args:[M.lights]}),n.by(S.camera,M.camera)||R.push({command:Wr.setCamera,args:[M.camera]}),n.by(S.iconsets,M.iconsets)||(function(Q,ae,ie){let _e;for(_e in ae=ae||{},Q=Q||{})Q.hasOwnProperty(_e)&&(ae.hasOwnProperty(_e)||ie.push({command:Wr.removeIconset,args:[_e]}));for(_e in ae){if(!ae.hasOwnProperty(_e))continue;const fe=ae[_e];Q.hasOwnProperty(_e)?n.by(Q[_e],fe)||(ie.push({command:Wr.removeIconset,args:[_e]}),ie.push({command:Wr.addIconset,args:[_e,fe]})):ie.push({command:Wr.addIconset,args:[_e,fe]})}})(S.iconsets,M.iconsets,R),!n.by(S["color-theme"],M["color-theme"]))return[{command:Wr.setStyle,args:[M]}];const N={},U=[];(function(Q,ae,ie,_e){let fe;for(fe in ae=ae||{},Q=Q||{})Q.hasOwnProperty(fe)&&(ae.hasOwnProperty(fe)||$d(fe,ie,_e));for(fe in ae){if(!ae.hasOwnProperty(fe))continue;const Te=ae[fe];Q.hasOwnProperty(fe)?n.by(Q[fe],Te)||(Q[fe].type==="geojson"&&Te.type==="geojson"&&zl(Q,ae,fe)?ie.push({command:Wr.setGeoJSONSourceData,args:[fe,Te.data]}):Cl(fe,ae,ie,_e)):ah(fe,ae,ie)}})(S.sources,M.sources,U,N);const Y=[];S.layers&&S.layers.forEach((Q=>{Q.source&&N[Q.source]?R.push({command:Wr.removeLayer,args:[Q.id]}):Y.push(Q)}));let X=S.terrain;X&&N[X.source]&&(R.push({command:Wr.setTerrain,args:[void 0]}),X=void 0),R=R.concat(U),n.by(X,M.terrain)||R.push({command:Wr.setTerrain,args:[M.terrain]}),(function(Q,ae,ie){ae=ae||[];const _e=(Q=Q||[]).map(Du),fe=ae.map(Du),Te=Q.reduce(Ru,{}),De=ae.reduce(Ru,{}),Se=_e.slice(),Ze=Object.create(null);let Ve,Ge,Fe,Oe,it,ft,ht;for(Ve=0,Ge=0;Ve<_e.length;Ve++)Fe=_e[Ve],De.hasOwnProperty(Fe)?Ge++:(ie.push({command:Wr.removeLayer,args:[Fe]}),Se.splice(Se.indexOf(Fe,Ge),1));for(Ve=0,Ge=0;Ve<fe.length;Ve++)Fe=fe[fe.length-1-Ve],Se[Se.length-1-Ve]!==Fe&&(Te.hasOwnProperty(Fe)?(ie.push({command:Wr.removeLayer,args:[Fe]}),Se.splice(Se.lastIndexOf(Fe,Se.length-Ge),1)):Ge++,ft=Se[Se.length-Ve],ie.push({command:Wr.addLayer,args:[De[Fe],ft]}),Se.splice(Se.length-Ve,0,Fe),Ze[Fe]=!0);for(Ve=0;Ve<fe.length;Ve++)if(Fe=fe[Ve],Oe=Te[Fe],it=De[Fe],!Ze[Fe]&&!n.by(Oe,it))if(n.by(Oe.source,it.source)&&n.by(Oe["source-layer"],it["source-layer"])&&n.by(Oe.type,it.type)){for(ht in zu(Oe.layout,it.layout,ie,Fe,null,Wr.setLayoutProperty),zu(Oe.paint,it.paint,ie,Fe,null,Wr.setPaintProperty),n.by(Oe.slot,it.slot)||ie.push({command:Wr.setSlot,args:[Fe,it.slot]}),n.by(Oe.filter,it.filter)||ie.push({command:Wr.setFilter,args:[Fe,it.filter]}),n.by(Oe.minzoom,it.minzoom)&&n.by(Oe.maxzoom,it.maxzoom)||ie.push({command:Wr.setLayerZoomRange,args:[Fe,it.minzoom,it.maxzoom]}),Oe)Oe.hasOwnProperty(ht)&&ht!=="layout"&&ht!=="paint"&&ht!=="filter"&&ht!=="metadata"&&ht!=="minzoom"&&ht!=="maxzoom"&&ht!=="slot"&&(ht.indexOf("paint.")===0?zu(Oe[ht],it[ht],ie,Fe,ht.slice(6),Wr.setPaintProperty):n.by(Oe[ht],it[ht])||ie.push({command:Wr.setLayerProperty,args:[Fe,ht,it[ht]]}));for(ht in it)it.hasOwnProperty(ht)&&!Oe.hasOwnProperty(ht)&&ht!=="layout"&&ht!=="paint"&&ht!=="filter"&&ht!=="metadata"&&ht!=="minzoom"&&ht!=="maxzoom"&&ht!=="slot"&&(ht.indexOf("paint.")===0?zu(Oe[ht],it[ht],ie,Fe,ht.slice(6),Wr.setPaintProperty):n.by(Oe[ht],it[ht])||ie.push({command:Wr.setLayerProperty,args:[Fe,ht,it[ht]]}))}else ie.push({command:Wr.removeLayer,args:[Fe]}),ft=Se[Se.lastIndexOf(Fe)+1],ie.push({command:Wr.addLayer,args:[it,ft]})})(Y,M.layers,R)}catch(N){console.warn("Unable to compute style diff:",N),R=[{command:Wr.setStyle,args:[M]}]}return R})(this.serialize(),t).filter((S=>!(S.command in um)));if(d.length===0)return!1;const y=d.filter((S=>!(S.command in zf)));if(y.length>0)throw new Error(`Unimplemented: ${y.map((S=>S.command)).join(", ")}.`);const b=[];return d.forEach((S=>{b.push(this[S.command](...S.args))})),a&&Promise.all(b).then(a).catch(a),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[a,d]of t.entries()){if(this.getImage(a))return this.fire(new n.y(new Error(`An image with the name "${a.name}" already exists.`)));this.imageManager.addImage(a,this.scope,d),this._changes.updateImage(a,this.scope)}return this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this}addImage(t,a){return this.getImage(t)?this.fire(new n.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,a),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this)}updateImage(t,a,d=!1){this.imageManager.updateImage(t,this.scope,a),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new n.z("data",{dataType:"style"})),this}addModel(t,a,d={}){return this._checkLoaded(),this._validate(te,`models.${t}`,a,null,d)||(this.modelManager.addModel(t,a,this.getActualScope()),this.fire(new n.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,a,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!a.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(a).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(a.type)>=0&&this._validate(Nt,`sources.${t}`,a,null,d))return;this.map&&this.map._collectResourceTiming&&(a.collectResourceTiming=!0);const y=Ks(t,a,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id})));const b=S=>{const M=(S?"symbol:":"other:")+y.id,R=n.B(M,this.scope),N=this._sourceCaches[M]=new Go(R,y,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=N,N.onAdd(this.map)};b(!1),a.type!=="vector"&&a.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const a=this.getOwnSource(t);if(!a)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find((([b,S])=>S.type==="source"&&S.source===t));if(y)return this.fire(new n.y(new Error(`Source "${t}" cannot be removed while iconset "${y[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const y of d){const b=n.dq(y.id);delete this._sourceCaches[b],this._changes.discardSourceCacheUpdate(y.id),y.fire(new n.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),a.setEventedParent(null),a.onRemove&&a.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,a){this._checkLoaded(),this.getOwnSource(t).setData(a),this._changes.setDirty()}getOwnSource(t){const a=this.getOwnSourceCache(t);return a&&a.getSource()}getOwnSources(){const t=[];for(const a in this._otherSourceCaches){const d=this.getOwnSourceCache(a);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const a in t){const d=t[a]._tiles;for(const y in d){const b=d[y];if(b.state!=="loaded"&&b.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const a=this._getTransitionParameters();for(const b of t){if(this._validate(ei,"lights",b))return;switch(b.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(b),S.updateTransitions(a)}else this.ambientLight=new jr(b,Ja||(Ja=new n.a9({color:new n.aa(n.a6.properties_light_ambient.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(b),S.updateTransitions(a)}else this.directionalLight=new jr(b,ss||(ss=new n.a9({direction:new n.ap(n.a6.properties_light_directional.direction),color:new n.aa(n.a6.properties_light_directional.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_directional.intensity),"cast-shadows":new n.aa(n.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new n.aa(n.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.aa(n.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(a,{worldview:this.map.getWorldview()}),y=new n.ac(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,a=this.ambientLight;if(!t||!a)return;const d=X=>.2126*(X[0]<=.03928?X[0]/12.92:Math.pow((X[0]+.055)/1.055,2.4))+.7152*(X[1]<=.03928?X[1]/12.92:Math.pow((X[1]+.055)/1.055,2.4))+.0722*(X[2]<=.03928?X[2]/12.92:Math.pow((X[2]+.055)/1.055,2.4)),y=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),b=t.properties.get("intensity"),S=t.properties.get("direction"),M=1-n.d4(S.x,S.y,S.z)[2]/90,R=d(y)*b*M,N=a.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),U=a.properties.get("intensity"),Y=d(N)*U;return Number(((R+Y)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(n.dr(t)){const a=n.ds(t),d=this.fragments.find((({id:b})=>b===a));if(!d)return;const y=n.dq(t);return d.style.getFragmentStyle(y)}{const a=this.fragments.find((({id:d})=>d===t));return a?a.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const a={},d=(y,b="")=>`${y}::${b}`;this._featuresetSelectors={};for(const y in t){const b=this._featuresetSelectors[y]=[];for(const S of t[y].selectors){if(S.featureNamespace){const R=this.getOwnLayer(S.layer);if(!R){n.w(`Layer is undefined for selector: ${S.layer}`);continue}const N=d(R.source,R.sourceLayer);if(N in a&&a[N]!==S.featureNamespace){n.w(`"featureNamespace ${S.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}a[N]=S.featureNamespace}let M;if(S.properties)for(const R in S.properties){const N=n.U(S.properties[R]);N.result==="success"&&(M=M||{},M[R]=N.value)}b.push({layerId:S.layer,namespace:S.featureNamespace,properties:M,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const a=this.getFragmentStyle(t);if(!a||!a.stylesheet.featuresets)return[];const d=[];for(const y in a.stylesheet.featuresets)d.push({featuresetId:y,importId:a.scope?a.scope:void 0});return d}getFeaturesetLayers(t,a){const d=this.getFragmentStyle(a),y=d.stylesheet.featuresets;if(!y||!y[t])return this.fire(new n.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const b=[];for(const S of y[t].selectors){const M=d.getOwnLayer(S.layer);M&&b.push(M)}return b}getConfigProperty(t,a){const d=this.getFragmentStyle(t);if(!d)return null;const y=n.B(a,d.scope),b=d.options.get(y),S=b?b.value||b.default:null;return S?S.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,a){const d=n.B(t,a);return this._mergedIndoor[d]}setIndoorData(t,a){this.map.indoor.setIndoorData(a)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,a,d){const y=this.getFragmentStyle(t);if(!y)return;const b=y.stylesheet.schema;if(!b||!b[a])return;const S=n.U(d);if(S.result!=="success")return void _u(this,S.value);const M=S.value.expression,R=n.B(a,y.scope),N=y.options.get(R);if(!N)return;let U;const{minValue:Y,maxValue:X,stepValue:Q,type:ae,values:ie}=b[a],_e=n.U(b[a].default);_e.result==="success"&&(U=_e.value.expression),U?(this.options.set(R,Object.assign({},N,{value:M,default:U,minValue:Y,maxValue:X,stepValue:Q,type:ae,values:ie})),this.updateConfigDependencies(a)):this.fire(new n.y(new Error(`No schema defined for the config option "${a}" in the "${t}" fragment.`)))}getConfig(t){const a=this.getFragmentStyle(t);if(!a)return null;const d=a.stylesheet.schema;if(!d)return null;const y={};for(const b in d){const S=n.B(b,a.scope),M=a.options.get(S),R=M?M.value||M.default:null;y[b]=R?R.serialize():null}return y}setConfig(t,a){const d=this.getFragmentStyle(t);d&&(d.updateConfig(a,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const a=this.getFragmentStyle(t);return a?a.stylesheet.schema:null}setSchema(t,a){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=a,d.updateConfig(d._config,a),this.updateConfigDependencies())}updateConfig(t,a){if(this._config=t,t||a)if(a)for(const d in a){let y,b;const S=n.U(a[d].default);if(S.result==="success"&&(y=S.value.expression),t&&t[d]!==void 0){const X=n.U(t[d]);X.result==="success"&&(b=X.value.expression)}const{minValue:M,maxValue:R,stepValue:N,type:U,values:Y}=a[d];if(y){const X=n.B(d,this.scope);this.options.set(X,{default:y,value:b,minValue:M,maxValue:R,stepValue:N,type:U,values:Y})}else this.fire(new n.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new n.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,a=(()=>!0)){for(const d of t){const y=this.getLayer(d);y&&a(y)&&(y.possiblyEvaluateVisibility(),this._updateLayer(y),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,(a=>!t||a.expressionDependencies.configDependencies.has(t))),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((a=>{const d=a._styleColorTheme.colorThemeOverride?a._styleColorTheme.colorThemeOverride:a._styleColorTheme.colorTheme;if(d){const y=a._evaluateColorThemeData(d);(!a._styleColorTheme.lut&&y!==""||a._styleColorTheme.lut&&y!==a._styleColorTheme.lut.data)&&a.setColorTheme(d)}})),this._changes.setDirty()}addLayer(t,a,d={}){this._checkLoaded();const y=t.id;if(this._layers[y])return void this.fire(new n.y(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(t.type==="custom"){if(_u(this,n.dt(t)))return;b=n.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(y,t.source),t=n.dp(t),t=Object.assign(t,{source:y})),this._validate(kn,`layers.${y}`,t,{arrayIndex:-1},d))return;b=n.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}})}const S=n.B(b.source,b.scope);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(S),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(S);let M=this._order.length;if(a){const Y=this._order.indexOf(a);if(Y===-1)return void this.fire(new n.y(new Error(`Layer with id "${a}" does not exist on this map.`)));b.slot===this._layers[a].slot?M=Y:n.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const R=this.getOwnLayerSourceCache(b),N=!!this.directionalLight&&this.directionalLight.shadowsEnabled();R&&b.canCastShadows()&&N&&(R.castsShadows=!0);const U=this._changes.getRemovedLayer(b);if(U&&b.source&&R&&b.type!=="custom"){this._changes.discardLayerRemoval(b);const Y=n.B(b.source,b.scope);U.type!==b.type?this._changes.updateSourceCache(Y,"clear"):(this._changes.updateSourceCache(Y,"reload"),R.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),b.scope=this.scope,this.mergeLayers()}moveLayer(t,a){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===a)return;const y=this._order.indexOf(t);this._order.splice(y,1);let b=this._order.length;if(a){const S=this._order.indexOf(a);if(S===-1)return void this.fire(new n.y(new Error(`Layer with id "${a}" does not exist on this map.`)));d.slot===this._layers[a].slot?b=S:n.w(`Layer with id "${a}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(b,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const a=this._checkLayer(t);if(!a)return;a.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(a.fqid),this._indoorDependentLayers.delete(a.fqid),this._changes.removeLayer(a);const y=this.getOwnLayerSourceCache(a);if(y&&y.castsShadows){let b=!1;for(const S in this._layers)if(this._layers[S].source===a.source&&this._layers[S].canCastShadows()){b=!0;break}y.castsShadows=b}a.onRemove&&a.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const a in this._layers)if(this._layers[a].type===t)return!0;return!1}setLayerZoomRange(t,a,d){this._checkLoaded();const y=this._checkLayer(t);y&&(y.minzoom===a&&y.maxzoom===d||(a!=null&&(y.minzoom=a),d!=null&&(y.maxzoom=d),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,a){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==a&&(d.slot=a,this._updateLayer(d))}setFilter(t,a,d={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!n.by(y.filter,a))return a==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(hr,`layers.${y.id}.filter`,a,{layerType:y.type},d)||(y.filter=n.dp(a),this._updateLayer(y)))}getFilter(t){const a=this._checkLayer(t);if(a)return n.dp(a.filter)}setLayoutProperty(t,a,d,y={}){this._checkLoaded();const b=this._checkLayer(t);if(b&&!n.by(b.getLayoutProperty(a),d)){if(d!=null&&(!y||y.validate!==!1)&&_u(b,lt.call(mt,{key:`layers.${t}.layout.${a}`,layerType:b.type,objectKey:a,value:d,styleSpec:n.a6,style:{glyphs:!0,sprite:!0}})))return;b.setLayoutProperty(a,d),b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),this._updateLayer(b)}}setLayerProperty(t,a,d,y={}){this._checkLoaded();const b=this._checkLayer(t);b&&(a==="appearances"?(b.setAppearances(d),this._changes.setDirty()):b.isPaintProperty(a)?this.setPaintProperty(t,a,d,y):this.setLayoutProperty(t,a,d,y))}getLayoutProperty(t,a){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(a)}setPaintProperty(t,a,d,y={}){this._checkLoaded();const b=this._checkLayer(t);if(!b||n.by(b.getPaintProperty(a),d)||d!=null&&(!y||y.validate!==!1)&&_u(b,Tr.call(mt,{key:`layers.${t}.paint.${a}`,layerType:b.type,objectKey:a,value:d,styleSpec:n.a6})))return;const S=b.setPaintProperty(a,d);b.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(b.fqid),b.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(b.fqid),S&&this._updateLayer(b),this._changes.updatePaintProperties(b)}getPaintProperty(t,a){const d=this._checkLayer(t);if(d)return d.getPaintProperty(a)}setFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:N}=t.target,U=this.getFragmentStyle(N),Y=U.getFeaturesetLayers(R);for(const{source:X,sourceLayer:Q}of Y)U.setFeatureState({id:t.id,source:X,sourceLayer:Q},a)}else if("layerId"in t.target){const{layerId:R}=t.target,N=this.getLayer(R);this.setFeatureState({id:t.id,source:N.source,sourceLayer:N.sourceLayer},a)}return}const d=t.source,y=t.sourceLayer,b=this._checkSource(d);if(!b)return;const S=b.type;if(S==="geojson"&&y)return void this.fire(new n.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!y)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided.")));const M=this.getOwnSourceCaches(d);for(const R of M)R.setFeatureState(y,t.id,a)}removeFeatureState(t,a){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:R,importId:N}=t.target,U=this.getFragmentStyle(N),Y=U.getFeaturesetLayers(R);for(const{source:X,sourceLayer:Q}of Y)U.removeFeatureState({id:t.id,source:X,sourceLayer:Q},a)}else if("layerId"in t.target){const{layerId:R}=t.target,N=this.getLayer(R);this.removeFeatureState({id:t.id,source:N.source,sourceLayer:N.sourceLayer},a)}return}const d=t.source,y=this._checkSource(d);if(!y)return;const b=y.type,S=b==="vector"?t.sourceLayer:void 0;if(b==="vector"&&!S)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(a&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.y(new Error("A feature id is required to remove its specific state property.")));const M=this.getOwnSourceCaches(d);for(const R of M)R.removeFeatureState(S,t.id,a)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let b;if("featuresetId"in t.target){const{featuresetId:S,importId:M}=t.target,R=this.getFragmentStyle(M),N=R.getFeaturesetLayers(S);for(const{source:U,sourceLayer:Y}of N){const X=R.getFeatureState({id:t.id,source:U,sourceLayer:Y});if(X&&!b)b=X;else if(!n.by(b,X))return void this.fire(new n.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:S}=t.target,M=this.getLayer(S);b=this.getFeatureState({id:t.id,source:M.source,sourceLayer:M.sourceLayer})}return b}const a=t.source,d=t.sourceLayer,y=this._checkSource(a);if(y){if(y.type!=="vector"||d)return t.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(a)[0].getFeatureState(d,t.id);this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),a=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:a,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(d=>d!==void 0))}_updateFilteredLayers(t){for(const a of Object.values(this._mergedLayers))t(a)&&this._updateLayer(a)}_updateLayer(t){this._changes.updateLayer(t);const a=this.getLayerSourceCache(t),d=n.B(t.source,t.scope),y=this._changes.getUpdatedSourceCaches();t.source&&!y[d]&&a&&a.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),a.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const a=M=>this._mergedLayers[M].is3D(!!this.terrain),d=this.order,y={},b=[];for(let M=d.length-1;M>=0;M--){const R=d[M];if(a(R)){y[R]=M;for(const N of t){const U=N[R];if(U)for(const Y of U)b.push(Y)}}}b.sort(((M,R)=>R.intersectionZ-M.intersectionZ));const S=[];for(let M=d.length-1;M>=0;M--){const R=d[M];if(a(R))for(let N=b.length-1;N>=0;N--){const U=b[N].feature;if(U.layer&&y[U.layer.id]<M)break;S.push(U),b.pop()}else for(const N of t){const U=N[R];if(U)for(const Y of U)S.push(Y.feature)}}return S}queryRasterValue(t,a,d){const y=this.getOwnSource(t);return y?y.type!=="raster-array"?(this.fire(new n.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):y.queryRasterArrayValue(a,d):(this.fire(new n.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,a,d){let y;a&&!Array.isArray(a)&&a.filter&&(this._validate(hr,"queryRenderedFeatures.filter",a.filter,null,a),y=n.b6(a.filter));const b={},S=U=>{if(Df.has(U.type))return;const Y=this.getOwnLayerSourceCache(U),X=b[Y.id]=b[Y.id]||{sourceCache:Y,layers:{},has3DLayers:!1};U.is3D(!!this.terrain)&&(X.has3DLayers=!0),X.layers[U.fqid]=X.layers[U.fqid]||{styleLayer:U,targets:[]},X.layers[U.fqid].targets.push({filter:y})};if(a&&a.layers){if(!Array.isArray(a.layers))return this.fire(new n.y(new Error("parameters.layers must be an Array."))),[];for(const U of a.layers){const Y=this._layers[U];if(!Y)return this.fire(new n.y(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];S(Y)}}else for(const U in this._layers)S(this._layers[U]);const M=this._queryRenderedFeatures(t,b,d),R=this._flattenAndSortRenderedFeatures(M),N=[];for(const U of R)n.dw(U.layer.id)===this.scope&&N.push(U);return N}queryRenderedFeatureset(t,a,d){let y;a&&!Array.isArray(a)&&a.filter&&(this._validate(hr,"queryRenderedFeatures.filter",a.filter,null,a),y=n.b6(a.filter));const b="mock",S=[];if(a&&a.target)S.push(Object.assign({},a,{targetId:b,filter:y}));else{const U=this.getFeaturesetDescriptors();for(const Y of U)S.push({targetId:b,filter:y,target:Y});for(const{style:Y}of this.fragments){const X=Y.getFeaturesetDescriptors();for(const Q of X)S.push({targetId:b,filter:y,target:Q})}}const M=this.queryRenderedTargets(t,S,d),R=[],N=new Set;for(const U of M)for(const Y of U.variants[b])Mh(Y,U,N)||R.push(new n.dx(U,Y));return R}queryRenderedTargets(t,a,d){const y={},b=(M,R,N,U)=>{const Y=y[R.id]=y[R.id]||{sourceCache:R,layers:{},has3DLayers:!1};if(Y.layers[M.fqid]=Y.layers[M.fqid]||{styleLayer:M,targets:[]},M.is3D(!!this.terrain)&&(Y.has3DLayers=!0),!U)return N.uniqueFeatureID=!1,void Y.layers[M.fqid].targets.push(N);Y.layers[M.fqid].targets.push(Object.assign({},N,{namespace:U.namespace,properties:U.properties,uniqueFeatureID:U.uniqueFeatureID}))};for(const M of a)if("featuresetId"in M.target){const{featuresetId:R,importId:N}=M.target,U=this.getFragmentStyle(N);if(!U||!U._featuresetSelectors)continue;const Y=U._featuresetSelectors[R];if(!Y){this.fire(new n.y(new Error(`The featureset '${R}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const X of Y){const Q=U.getOwnLayer(X.layerId);Q&&!Df.has(Q.type)&&b(Q,U.getOwnLayerSourceCache(Q),M,X)}}else if("layerId"in M.target){const{layerId:R}=M.target,N=this.getLayer(R);if(!N||Df.has(N.type))continue;b(N,this.getLayerSourceCache(N),M)}const S=this._queryRenderedFeatures(t,y,d);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(t,a,d){const y=[],b=!!this.map._showQueryGeometry,S=da.createFromScreenPoints(t,d);for(const M in a){const R=ou(S,a[M],this._availableImages,d,b);Object.keys(R).length&&y.push(R)}if(this.placement)for(const M in a){if(!a[M].sourceCache._onlySymbols)continue;const R=Jh(S.screenGeometry,a[M],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(R).length&&y.push(R)}return y}querySourceFeatures(t,a){const d=a&&a.filter;d&&this._validate(hr,"querySourceFeatures.filter",d,null,a);let y=[];const b=this.getOwnSourceCaches(t);for(const S of b)y=y.concat(Qh(S,a));return y}addSourceType(t,a,d){return kl.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(kl.setSourceType(t,a),a.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:a.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,a,d={}){this._checkLoaded();const y=this.light.getLight();let b=!1;for(const M in t)if(!n.by(t[M],y[M])){b=!0;break}if(!b)return;const S=this._getTransitionParameters();this.light.setLight(t,a,d),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,a=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),a===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const y=!("source"in t)||t.source==null;if(a===1){if(this.disableElevatedTerrain)return;if("source"in d&&typeof d.source=="object"){const M="terrain-dem-src";this.addSource(M,d.source),d=n.dp(d),d=Object.assign(d,{source:M})}const b=Object.assign({},d),S={};if(this.terrain&&y){b.source=this.terrain.get().source;const M=this.terrain?this.getFragmentStyle(this.terrain.scope):null;M&&(S.style=M.serialize())}if(this._validate(Pt,"terrain",b,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&a!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,a),this.fire(new n.z("data",{dataType:"style"}))}else{const b=this.terrain,S=b.get();for(const M of Object.keys(n.a6.terrain))!d.hasOwnProperty(M)&&n.a6.terrain[M].default&&(d[M]=n.a6.terrain[M].default);for(const M in t)if(!n.by(t[M],S[M])){b.set(t,this.options),this.stylesheet.terrain=t;const R=this._getTransitionParameters({duration:0});b.updateTransitions(R),this.fire(new n.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const a=this.fog=new Nn(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_createSnow(t){const a=this.snow=new js(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_createRain(t){const a=this.rain=new ea(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const t of this.map._markers)t._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const a=this.fog;if(!n.by(a.get(),t)){a.set(t,this.options),this.stylesheet.fog=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const a=this.snow;if(!n.by(a.get(),t)){a.set(t,this.options),this.stylesheet.snow=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const a=this.rain;if(!n.by(a.get(),t)){a.set(t,this.options),this.stylesheet.rain=a.get();const d=this._getTransitionParameters({duration:0});a.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},a=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!a)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(a);this._loadColorTheme(d).then((()=>{this.fire(new n.z("colorthemeset")),t()})).catch((y=>{n.w(`Couldn't set color theme: ${y}`)}))}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,a){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=a,d._reloadColorTheme())}_getTransitionParameters(t){return{now:n.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],a=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):a.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...a)}_createTerrain(t,a){const d=this.terrain=new ot(t,a,this.scope,this.options,this.map.getWorldview());a===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});d.updateTransitions(y)}_force3DLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="fill-extrusion"&&this._updateLayer(a)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const a=this._layers[t];a.type==="symbol"&&this._updateLayer(a)}}_validate(t,a,d,y,b={}){if(b&&b.validate===!1)return!1;const S=Object.assign({},this.serialize());return _u(this,t.call(mt,Object.assign({key:a,style:S,value:d,styleSpec:n.a6},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const a=this.getSourceCaches(t);for(const d of a)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const a=this._mergedLayers[t];a._clear&&a._clear()}}reloadSource(t){const a=this.getSourceCaches(t);for(const d of a)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((t=>{t.modelManager.reloadModels(t.scope)}))}updateSources(t){let a;this.directionalLight&&(a=fu(this.directionalLight));const d=new Set,y=new Set;for(const b in this._mergedLayers){const S=this._mergedLayers[b];S.type==="building"&&d.add(S.source),S.hasElevation()&&!y.has(S.source)&&y.add(S.source)}for(const b in this._mergedSourceCaches){const S=this._mergedSourceCaches[b],M=y.has(S._source.id);d.has(S._source.id)&&(S._source.reparseOverscaled=!1),S.update(t,void 0,void 0,a,M)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const a=this._sourceCaches[t];a.resume(),a.reload()}}_updatePlacement(t,a,d,y,b,S,M=!1){let R=!1,N=!1;const U={},Y={};for(const ie of this._mergedOrder){const _e=this._mergedLayers[ie];if(_e.type!=="symbol")continue;const fe=n.B(_e.source,_e.scope);let Te=U[fe];if(!Te){const Se=this.getLayerSourceCache(_e);if(!Se)continue;const Ze=Se.getRenderableIds(!0).map((Ve=>Se.getTileByID(Ve)));Y[fe]=Ze.slice(),Te=U[fe]=Ze.sort(((Ve,Ge)=>Ge.tileID.overscaledZ-Ve.tileID.overscaledZ||(Ve.tileID.isLessThan(Ge.tileID)?-1:1)))}const De=this.crossTileSymbolIndex.addLayer(_e,Te,a.center.lng,a.projection);R=R||De}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),M=M||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new n.z("neworder"));const X=!!(this.placement&&!a.equals(this.placement.transform)),Q=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!S||this.placement.lastReplacementSourceUpdateTime!==S.updateTime)),ae=(X||Q||R||this.placement&&this.placement.isStale())&&y===0;if((M||!this.pauseablePlacement||ae||y!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.o.now(),a.zoom))&&(this.pauseablePlacement=new no(a,this._mergedOrder,M||y===0,d,y,b,this.placement,this.fog&&a.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,U,Y,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.o.now()),N=!0),R&&this.pauseablePlacement.placement.setStale()),N||R){this._buildingIndex.onNewFrame(a.zoom);for(let ie=0;ie<this._mergedOrder.length;ie++){const _e=this._mergedLayers[this._mergedOrder[ie]];if(_e.type!=="symbol"||_e.visibility==="none")continue;const fe=this.isLayerClipped(_e);this.placement.updateLayerOpacities(_e,U[n.B(_e.source,_e.scope)],ie,fe?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,a){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex((({id:b})=>b===t.id))!==-1)return void this.fire(new n.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!a)return d.push(t),this._loadImports([t],!0);const y=d.findIndex((({id:b})=>b===a));return y===-1&&this.fire(new n.y(new Error(`Import with id "${a}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,y).concat(t).concat(d.slice(y)),this._loadImports([t],!0,a)}updateImport(t,a){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);return y===-1?this:typeof a=="string"?(this.setImportUrl(t,a),this):(a.url&&a.url!==d[y].url&&this.setImportUrl(t,a.url),n.by(a.config,d[y].config)||this.setImportConfig(t,a.config,a.data.schema),n.by(a.data,d[y].data)||this.setImportData(t,a.data),this)}moveImport(t,a){this._checkLoaded();let d=this.stylesheet.imports||[];const y=this.getImportIndex(t);if(y===-1)return this;const b=this.getImportIndex(a);if(b===-1)return this;const S=d[y],M=this.fragments[y];return d=d.filter((({id:R})=>R!==t)),this.fragments=this.fragments.filter((({id:R})=>R!==t)),this.stylesheet.imports=d.slice(0,b).concat(S).concat(d.slice(b)),this.fragments=this.fragments.slice(0,b).concat(M).concat(this.fragments.slice(b)),this.mergeLayers(),this}setImportUrl(t,a){this._checkLoaded();const d=this.stylesheet.imports||[],y=this.getImportIndex(t);if(y===-1)return this;d[y].url=a;const b=this.fragments[y];return b.style=this._createFragmentStyle(d[y]),b.style.on("style.import.load",(()=>this.mergeAll())),b.style.loadURL(a),this}setImportData(t,a){this._checkLoaded();const d=this.getImportIndex(t),y=this.stylesheet.imports||[];return d===-1?this:a?(this.fragments[d].style.setState(a),this._reloadImports(),this):(delete y[d].data,this.setImportUrl(t,y[d].url))}setImportConfig(t,a,d){this._checkLoaded();const y=this.getImportIndex(t),b=this.stylesheet.imports||[];if(y===-1)return this;a?b[y].config=a:delete b[y].config;const S=this.fragments[y];d&&S.style.stylesheet&&(S.style.stylesheet.schema=d);const M=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=a,S.style.updateConfig(a,M),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const a=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(a.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const a=(this.stylesheet.imports||[]).findIndex((d=>d.id===t));return a===-1&&this.fire(new n.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),a}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const a in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[a];d&&t.push(d.getSource())}return t}getSource(t,a){const d=this.getSourceCache(t,a);return d&&d.getSource()}getLayerSource(t){const a=this.getLayerSourceCache(t);return a&&a.getSource()}getSourceCache(t,a){const d=n.B(t,a);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const a=n.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[a]:this._mergedOtherSourceCaches[a]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const a=[];return this._mergedOtherSourceCaches[t]&&a.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&a.push(this._mergedSymbolSourceCaches[t]),a}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const a in t){const d=t[a];d==="reload"?this.reloadSource(a):d==="clear"&&this.clearSource(a)}}updateLayers(t){const a=this._changes.getUpdatedPaintProperties();for(const d of a){const y=this.getLayer(d);y&&y.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,a,d){this.imageManager.getImages(a.images,a.scope,d),this._updateTilesForChangedImages();const y=S=>{if(S){const M=a.images.map((R=>n.I.toString(R)));S.setDependencies(a.tileID.key,a.type,M)}},b=n.B(a.source,a.scope);y(this._mergedOtherSourceCaches[b]),y(this._mergedSymbolSourceCaches[b]),a.images.some((S=>S.iconsetId))&&this.fire(new n.z("data",{dataType:"style"}))}rasterizeImages(t,a,d){this.imageManager.rasterizeImages(a,d)}getGlyphs(t,a,d){this.glyphManager.getGlyphs(a.stacks,d)}getResource(t,a,d){return n.dz(a,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const a=[];return this._otherSourceCaches[t]&&a.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&a.push(this._symbolSourceCaches[t]),a}_isSourceCacheLoaded(t){const a=this.getOwnSourceCaches(t);return a.length===0?(this.fire(new n.y(new Error(`There is no source with ID '${t}'`))),!1):a.every((d=>d.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,a){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),y=t.type==="building";if(t.is3D(!!this.terrain)){if(d||y||a&&a.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((t=>{t.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}kl.getSourceType=function(h){return Mc[h]},kl.setSourceType=function(h,t){Mc[h]=t},kl.registerForPluginStateChange=n.dA;class ud extends n.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},n.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[a,d]of Object.entries(t.buildings))if(this._buildings[a])for(const y of d.floorIds)this._buildings[a].floors[y]||(this._buildings[a].floors[y]=d.floors[y]);else this._buildings[a]=d;for(const a of t.activeFloors)this._activeFloors.add(a);this._updateIndoorSelector()}getIndoorTileOptions(t,a){const d=this._style.getIndoorSourceLayers(t,a);return d&&this._indoorState?{sourceLayers:d,indoorState:this._indoorState}:null}_updateUI(t,a,d){const y=(function(b,S,M,R){let N=null,U=Number.MAX_SAFE_INTEGER;if(R<16)return null;for(const[Y,X]of Object.entries(b)){const Q=X.center;if(Q){const ae=S.distanceTo(n.aT.convert(Q));ae<U&&M.contains(Q)&&(U=ae,N=Y)}}return N})(this._buildings,a,d,t);y!==this._closestBuildingId&&(this._closestBuildingId=y,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,a=this._closestBuildingId,d=a&&t?t[a]:void 0;if(!d)return void this.fire(new n.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let y=null;for(const S of d.floorIds)if(this._activeFloors&&this._activeFloors.has(S)){y=S;break}const b=Array.from(d.floorIds).map((S=>({id:S,name:d.floors[S].name,zIndex:d.floors[S].zIndex}))).sort(((S,M)=>M.zIndex-S.zIndex));this.fire(new n.z("selector-update",{selectedFloorId:y,activeFloorsVisible:this._activeFloorsVisible,floors:b}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Gs=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,hc=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,dc=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,oh="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",os=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,Ol=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,pi=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,kh=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,gu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,hd=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,Bu=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const yl=/#include\s+"([^"]+)"/g,yu=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,xl=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Fu=new Set(["ifdef","ifndef","elif","if","defined"]),vl=new Set;Zo(Gs,vl),Zo(dc,vl),Zo(hc,vl);const Nu={"_prelude_fog.vertex.glsl":Ol,"_prelude_terrain.vertex.glsl":os,"_prelude_shadow.vertex.glsl":hd,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":pi,"_prelude_shadow.fragment.glsl":Bu,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":kh,"_prelude_raster_particle.glsl":gu},Oh={};Or("",os),Or(pi,Ol),Or(Bu,hd),Or(kh,""),Or(gu,"");const Oc=Or(hc,dc),Bh=Gs,Wd=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",Bh,Oc.fragmentSource].join(`
`),Yd=["precision highp float;",Bh,Oc.vertexSource].join(`
`);var Kd={background:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Or(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Or(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Or("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Or(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Or(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Or("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Or("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Or("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Or(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Or(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Or(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Or(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Or(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Or(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Or("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Or("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Or(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Or(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Or("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Or(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,oh),skyboxGradient:Or(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,oh),skyboxCapture:Or(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Or(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Or(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Or(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Or(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Or("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Or("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Or("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Or("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Zo(h,t){const a=h.split(`
`);for(let d of a){if(d=d.trimStart(),d[0]!=="#"||!d.includes("if")||d.startsWith("#endif"))continue;const y=d.match(xl);if(y)for(const b of y)Fu.has(b)||t.add(b)}}function Or(h,t){const a=new Set,d=[],y=[];h=h.replace(yl,((S,M)=>(y.push(M),""))),t=t.replace(yl,((S,M)=>(d.push(M),"")));let b=new Set(vl);Zo(h,b),Zo(t,b);for(const S of[...d,...y])Oh[S]||(Oh[S]=new Set,Zo(Nu[S],Oh[S])),b=new Set([...b,...Oh[S]]);return{fragmentSource:h=h.replace(yu,((S,M,R,N,U)=>(a.add(U),M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
in ${R} ${N} ${U};
#else
uniform ${R} ${N} u_${U};
#endif
`:M==="initialize"?`
#ifdef HAS_UNIFORM_u_${U}
    ${R} ${N} ${U} = u_${U};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${R} ${N} ${U};
#endif
`:M==="initialize-attribute"?"":void 0))),vertexSource:t=t.replace(yu,((S,M,R,N,U)=>{const Y=`MATERIAL_ATTRIBUTE_OFFSET_${U}`,X=N==="float"?"vec2":N,Q=`GET_ATTRIBUTE_${X}(a_${U}, materialInfo, ${Y})`,ae=U.match(/color/)?"color":X;return M==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${U}
in ${R} ${N} a_${U};
#endif
`:a.has(U)?M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
    #if !defined(${Y})
        in ${R} ${X} a_${U};
    #endif
out ${R} ${N} ${U};
#else
uniform ${R} ${N} u_${U};
#endif
`:M==="initialize"?ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${R} ${N} ${U} = u_${U};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${U})
    #ifdef ${Y}
        ${U} = unpack_mix_${ae}(${Q}, u_${U}_t);
    #else
        ${U} = unpack_mix_${ae}(a_${U}, u_${U}_t);
    #endif
#else
    ${R} ${N} ${U} = u_${U};
#endif
`:M==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    in ${R} ${N} a_${U};
    out ${R} ${N} ${U};
#endif
`:M==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${U} = a_${U};
#endif
`:void 0:M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
    #if !defined(${Y})
        in ${R} ${X} a_${U};
    #endif
#else
uniform ${R} ${N} u_${U};
#endif
`:M==="define-instanced"?ae==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${U}0;
in vec4 a_${U}1;
in vec4 a_${U}2;
in vec4 a_${U}3;
#else
uniform ${R} ${N} u_${U};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${R} ${X} a_${U};
#else
uniform ${R} ${N} u_${U};
#endif
`:M==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${U}
    ${R} ${N} ${U} = a_${U};
#endif
`:ae==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    #ifdef ${Y}
        ${R} ${N} ${U} = ${Q};
    #else
        ${R} ${N} ${U} = a_${U};
    #endif
#else
    ${R} ${N} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    #ifdef ${Y}
        ${R} ${N} ${U} = unpack_mix_${ae}(${Q}, u_${U}_t);
    #else
        ${R} ${N} ${U} = unpack_mix_${ae}(a_${U}, u_${U}_t);
    #endif
#else
    ${R} ${N} ${U} = u_${U};
#endif
`})),usedDefines:b,vertexIncludes:d,fragmentIncludes:y}}class Fh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,a,d,y,b,S,M,R){this.context=t;let N=this.boundPaintVertexBuffers.length!==y.length;for(let Y=0;!N&&Y<y.length;Y++)this.boundPaintVertexBuffers[Y]!==y[Y]&&(N=!0);let U=this.boundDynamicVertexBuffers.length!==M.length;for(let Y=0;!U&&Y<M.length;Y++)this.boundDynamicVertexBuffers[Y]!==M[Y]&&(U=!0);if(!this.vao||this.boundProgram!==a||this.boundLayoutVertexBuffer!==d||N||U||this.boundIndexBuffer!==b||this.boundVertexOffset!==S)this.freshBind(a,d,y,b,S,M,R);else{t.bindVertexArrayOES.set(this.vao);for(const Y of M)Y&&(Y.bind(),R&&Y.instanceCount&&Y.setVertexAttribDivisor(t.gl,a,R));b&&b.dynamicDraw&&b.bind()}}freshBind(t,a,d,y,b,S,M){const R=this.context,N=R.gl;this.vao&&this.destroy(),this.vao=R.gl.createVertexArray(),R.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=a,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=S,a.enableAttributes(N,t),a.bind(),a.setVertexAttribPointers(N,t,b);for(const U of d)U.enableAttributes(N,t),U.bind(),U.setVertexAttribPointers(N,t,b);for(const U of S)U&&(U.enableAttributes(N,t),U.bind(),U.setVertexAttribPointers(N,t,b),M&&U.instanceCount&&U.setVertexAttribDivisor(N,t,M));y&&y.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function dd(h,t){const a=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new n.ae(0,d/a).toLngLat().lat,new n.ae(0,(d+1)/a).toLngLat().lat]}function Jd(h,t,a,d,y,b,S){const M=h.context,R=M.gl,N=a.hillshadeFBO;if(!N)return;h.prepareDrawTile();const U=h.isTileAffectedByFog(t),Y=[];h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&Y.push("USE_MRT1");const X=h.getOrCreateProgram("hillshade",{overrideFog:U,defines:Y});M.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,N.colorAttachment0.get());const Q=((fe,Te,De,Se)=>{const Ze=De.paint.get("hillshade-shadow-color"),Ve=De.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Ge=De.paint.get("hillshade-highlight-color"),Fe=De.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",Oe=De.paint.get("hillshade-accent-color"),it=De.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ft=De.paint.get("hillshade-emissive-strength");let ht=n.an(De.paint.get("hillshade-illumination-direction"));if(De.paint.get("hillshade-illumination-anchor")==="viewport")ht-=fe.transform.angle;else if(fe.style&&fe.style.enable3dLights()&&fe.style.directionalLight){const It=fe.style.directionalLight.properties.get("direction"),zt=n.d4(It.x,It.y,It.z);ht=n.an(zt[1])}const St=!fe.options.moving;return{u_matrix:Se||fe.transform.calculateProjMatrix(Te.tileID.toUnwrapped(),St),u_image:0,u_latrange:dd(0,Te.tileID),u_light:[De.paint.get("hillshade-exaggeration"),ht],u_shadow:Ze.toPremultipliedRenderColor(Ve?null:De.lut),u_highlight:Ge.toPremultipliedRenderColor(Fe?null:De.lut),u_emissive_strength:ft,u_accent:Oe.toPremultipliedRenderColor(it?null:De.lut)}})(h,a,d,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(M,X,t.toUnwrapped());const{tileBoundsBuffer:ae,tileBoundsIndexBuffer:ie,tileBoundsSegments:_e}=h.getTileBoundsBuffers(a);X.draw(h,R.TRIANGLES,y,b,S,jn.disabled,Q,d.id,ae,ie,_e)}function Ao(h,t,a){if(!t.needsDEMTextureUpload)return;const d=h.context,y=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(a.stride);const b=a.getPixels();t.demTexture?t.demTexture.update(b,{premultiply:!1}):t.demTexture=new n.T(d,b,y.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function Xo(h,t,a){const d=h.context,y=d.gl;if(!t.dem)return;const b=t.dem;if(d.activeTexture.set(y.TEXTURE1),Ao(h,t,b),!t.demTexture)return;t.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const S=b.dim;d.activeTexture.set(y.TEXTURE0);let M=t.hillshadeFBO;if(!M){const X=new n.T(d,{width:S,height:S,data:null},y.RGBA8);X.bind(y.LINEAR,y.CLAMP_TO_EDGE),M=t.hillshadeFBO=d.createFramebuffer(S,S,1,"renderbuffer"),M.colorAttachment0.set(X.texture)}d.bindFramebuffer.set(M.framebuffer),d.viewport.set([0,0,S,S]);const{tileBoundsBuffer:R,tileBoundsIndexBuffer:N,tileBoundsSegments:U}=h.getMercatorTileBoundsBuffers(),Y=[];h.linearFloatFilteringSupported()&&Y.push("TERRAIN_DEM_FLOAT_FORMAT"),h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&Y.push("USE_MRT1"),h.getOrCreateProgram("hillshadePrepare",{defines:Y}).draw(h,y.TRIANGLES,xn.disabled,Un.disabled,cr.unblended,jn.disabled,((X,Q)=>{const ae=Q.stride,ie=n.bC();return n.ce(ie,0,n.al,-n.al,0,0,1),n.br(ie,ie,[0,-n.al,0]),{u_matrix:ie,u_image:1,u_dimension:[ae,ae],u_zoom:X.overscaledZ}})(t.tileID,b),a.id,R,N,U),t.needsHillshadePrepare=!1}class Ra{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class sl extends Ra{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Bl extends Ra{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Vu extends Ra{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Rf extends Ra{getDefault(){return[!0,!0,!0,!0]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Qd extends Ra{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class lh extends Ra{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Nh extends Ra{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const a=this.current;(t.func!==a.func||t.ref!==a.ref||t.mask!==a.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class mo extends Ra{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class ja extends Ra{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.current=t,this.dirty=!1}}class fn extends Ra{getDefault(){return[0,1]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Wc extends Ra{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST),this.current=t,this.dirty=!1}}class fc extends Ra{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Vh extends Ra{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.BLEND):a.disable(a.BLEND),this.current=t,this.dirty=!1}}class Ql extends Ra{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ch extends Ra{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const a=this.current;(t.r!==a.r||t.g!==a.g||t.b!==a.b||t.a!==a.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ef extends Ra{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Ia extends Ra{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;t?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE),this.current=t,this.dirty=!1}}class Yc extends Ra{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class tp extends Ra{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let fd=class extends Ra{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class ip extends Ra{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Fl extends Ra{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const a=this.current;(t[0]!==a[0]||t[1]!==a[1]||t[2]!==a[2]||t[3]!==a[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Uu extends Ra{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class uh extends Ra{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindRenderbuffer(a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class hh extends Ra{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindTexture(a.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class zp extends Ra{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.bindBuffer(a.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class zd extends Ra{getDefault(){return null}set(t){const a=this.gl;a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class pd extends Ra{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class tf extends Ra{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Wo extends Ra{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class ka extends Ra{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const a=this.gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xu extends Ra{constructor(t,a){super(t),this.context=t,this.parent=a}getDefault(){return null}}class md extends xu{constructor(t,a,d=0){super(t,a),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+d}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachmentPoint,a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Uh extends xu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,this.attachment(),a.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class nf extends xu{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const a=this.gl;a.framebufferTexture2D(a.FRAMEBUFFER,this.attachment(),a.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class rf extends Uh{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ls=(h,t,a,d)=>({u_matrix:h,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:a,u_emissive_texture_available:d}),pc=(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:a,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_image1:1,u_frustum_tl:S,u_frustum_tr:M,u_frustum_br:R,u_frustum_bl:N,u_globe_pos:U,u_globe_radius:Y,u_viewport:X,u_grid_matrix:_e?Float32Array.from(_e):new Float32Array(9),u_skirt_height:Q,u_far_z_cutoff:ae,u_emissive_texture_available:ie});function Kc(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const Xn=new class{constructor(){this.operations={}}newMorphing(h,t,a,d,y){if(h in this.operations){const b=this.operations[h];b.to.tileID.key!==a.tileID.key&&(b.queued=a)}else this.operations[h]={startTime:d,phase:0,duration:y,from:t,to:a,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const a=this.operations[t];for(a.phase=(h-a.startTime)/a.duration;a.phase>=1||!this._validOp(a);)if(!this._nextOp(a,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Pr={0:null,1:"TERRAIN_VERTEX_MORPHING"};function vu(h,t,a){if(t===0)return 0;const d=t<1&&a===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*d}function ju(h,t){const a=1<<h.z;return!t&&(h.x===0||h.x===a-1)||h.y===0||h.y===a-1}function _d(h,t){if(!h.style||!h.style.enable3dLights())return;const a=h.context,d=a.gl;a.activeTexture.set(d.TEXTURE1),t?t.bind(d.LINEAR,d.CLAMP_TO_EDGE):h.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}const L=h=>({u_matrix:h});function o(h,t,a,d,y){if(y>0){const b=n.o.now(),S=(b-h.timeAdded)/y,M=t?(b-t.timeAdded)/y:-1,R=a.getSource(),N=d.coveringZoomLevel({tileSize:R.tileSize,roundZoom:R.roundZoom}),U=!t||Math.abs(t.tileID.overscaledZ-N)>Math.abs(h.tileID.overscaledZ-N),Y=U&&h.refreshedUponExpiration?1:n.aA(U?S:1-M,0,1);return t?{opacity:1,mix:1-Y,isFading:S<1}:{opacity:Y,mix:0,isFading:S<1}}return{opacity:1,mix:0,isFading:!1}}class x extends Go{constructor(t){const a=Ks("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",a,!1),a.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,a){t.state="loaded",a(null)}}class A extends Go{constructor(t){const a=Ks("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",a,!1),a.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,a,d){if(t.freezeTileCoverage)return;this.transform=t;const y=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const M=new Cu(S,this._source.tileSize*S.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);M.state="loaded",this._tiles[S.key]=M}return b}),{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(t){const a=this.proxyCachedFBO[t];if(a!==void 0){const d=Object.values(a);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach((t=>t.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class I extends n.aQ{constructor(t,a,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=a,this.projMatrix=d}}class P extends n.bV{constructor(t,a){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,y,b]=(function(R){const N=new n.bd,U=new n.b0,Y=131;N.reserve(17161),U.reserve(33800);const X=n.al/128,Q=n.al+X/2,ae=Q+X;for(let _e=-X;_e<ae;_e+=X)for(let fe=-X;fe<ae;fe+=X){const Te=fe<0||fe>Q||_e<0||_e>Q?24575:0,De=n.aA(Math.round(fe),0,n.al),Se=n.aA(Math.round(_e),0,n.al);N.emplaceBack(De+Te,Se)}const ie=(_e,fe)=>{const Te=fe*Y+_e;U.emplaceBack(Te+1,Te,Te+Y),U.emplaceBack(Te+Y,Te+Y+1,Te+1)};for(let _e=1;_e<129;_e++)for(let fe=1;fe<129;fe++)ie(fe,_e);return[0,129].forEach((_e=>{for(let fe=0;fe<130;fe++)ie(fe,_e),ie(_e,fe)})),[N,U,32768]})(),S=t.context;this.gridBuffer=S.createVertexBuffer(d,n.bf.members),this.gridIndexBuffer=S.createIndexBuffer(y),this.gridSegments=n.bg.simpleSegment(0,0,d.length,y.length),this.gridNoSkirtSegments=n.bg.simpleSegment(0,0,d.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new A(a.map),this.orthoMatrix=n.bC(),n.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.al,0,n.al,0,1);const M=S.gl;this._overlapStencilMode=new Un({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=a,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new x(a.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(t,a,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const y=t.terrain.properties,b=t.terrain.drapeRenderMode===0,S=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.o.now();const M=t.terrain&&t.terrain.scope,R=y.get("source"),N=b?this._mockSourceCache:t.getSourceCache(R,M);if(!N)return void n.w(`Couldn't find terrain source "${R}".`);if(this.sourceCache=N,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(a):y.get("exaggeration"),!a.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const U=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Y=this.getScaledDemTileSize();this.sourceCache.update(a,Y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,U(),this._initializing=!0),U(),a.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(a),this._emptyDEMTextureDirty=!0,this._previousZoom=a.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const a=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const y=a!=null?d-a:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const b=t.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(b);let M=b-this._previousZoom;const R=this._previousUpdateTimestamp;let N=b;this._evaluationZoom!=null&&(N=this._evaluationZoom,Math.abs(b-N)>.5&&(M=.5*(b-N+M)),M*y<0&&(N+=M)),this._evaluationZoom=N;const U=S.getExaggeration(N),Y=U===S.getExaggeration(Math.max(0,N-.1));if(Y&&Math.abs(U-this._exaggeration)<.01)return U;let X=Math.min(.1,.00375*(this._updateTimestamp-R));return(Y||U<.1||Math.abs(M)<1e-4)&&(X=Math.min(.2,4*X)),n.ak(this._exaggeration,U,X)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((t=>t.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const a=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(n.ae.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=a.getIds().map((R=>{const N=a.getTileByID(R).tileID;return N.projMatrix=d.calculateProjMatrix(N.toUnwrapped()),N}));(function(R,N){const U=N.transform.pointCoordinate(N.transform.getCameraPoint()),Y=new n.P(U.x,U.y);R.sort(((X,Q)=>{if(Q.overscaledZ-X.overscaledZ)return Q.overscaledZ-X.overscaledZ;const ae=new n.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),ie=new n.P(Q.canonical.x+(1<<Q.canonical.z)*Q.wrap,Q.canonical.y),_e=Y.mult(1<<X.canonical.z);return _e.x-=.5,_e.y-=.5,_e.distSqr(ae)-_e.distSqr(ie)}))})(y,this.painter);const b=this.proxyToSource||{};this.proxyToSource={},y.forEach((R=>{this.proxyToSource[R.key]={}})),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const R in S){const N=S[R];if(!N.used||(N!==this.sourceCache&&this.resetTileLookupCache(N.id),this._setupProxiedCoordsForOrtho(N,t[R],b),N.usedForTerrain))continue;const U=t[R];N.getSource().reparseOverscaled&&this._assignTerrainTiles(U)}this.proxiedCoords[a.id]=y.map((R=>new I(R,R.key,this.orthoMatrix))),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1;const M={};this._visibleDemTiles=[];for(const R of this.proxyCoords){const N=this.terrainTileForTile[R.key];if(!N)continue;const U=N.tileID.key;U in M||(this._visibleDemTiles.push(N),M[U]=U)}}_assignTerrainTiles(t){this._initializing||t.forEach((a=>{if(this.terrainTileForTile[a.key])return;const d=this._findTileCoveringTileID(a,this.sourceCache);d&&(this.terrainTileForTile[a.key]=d)}))}_prepareDEMTextures(){const t=this.painter.context,a=t.gl;for(const d in this.terrainTileForTile){const y=this.terrainTileForTile[d],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(t.activeTexture.set(a.TEXTURE1),Ao(this.painter,y,b))}}_prepareDemTileUniforms(t,a,d,y){if(!a||a.demTexture==null)return!1;const b=t.tileID.canonical,S=Math.pow(2,a.tileID.canonical.z-b.z),M=y||"";return d[`u_dem_tl${M}`]=[b.x*S%1,b.y*S%1],d[`u_dem_scale${M}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const a=this._visibleDemTiles.reduce(((d,y)=>{if(!y.dem)return d;const b=y.dem.tree.minimums[0];return b>0&&t++,d+b}),0);return t?a/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,a=t.gl;t.activeTexture.set(a.TEXTURE2);const d=this._getLoadedAreaMinimum(),y=new n.dL({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new n.T(t,y,a.R32F,{premultiply:!1}),b}setupElevationDraw(t,a,d){const y=this.painter.context,b=y.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let M=null,R=null,N=1;if(d&&d.morphing&&this._useVertexMorphing){const Q=d.morphing.srcDemTile,ae=d.morphing.dstDemTile;N=d.morphing.phase,Q&&ae&&(this._prepareDemTileUniforms(t,Q,S,"_prev")&&(R=Q),this._prepareDemTileUniforms(t,ae,S)&&(M=ae))}const U=Q=>Q&&Q.demTexture&&this.painter.linearFloatFilteringSupported()?b.LINEAR:b.NEAREST;let Y=null;var X;if(this.enabled?R&&M?(Y=M.demTexture,y.activeTexture.set(b.TEXTURE4),R.demTexture.bind(U(R),b.CLAMP_TO_EDGE),S.u_dem_lerp=N):(M=this.terrainTileForTile[t.tileID.key],Y=this._prepareDemTileUniforms(t,M,S)?M.demTexture:this.emptyDEMTexture):Y=this.emptyDEMTexture,y.activeTexture.set(b.TEXTURE2),Y&&(S.u_dem_size=(X=Y).size[0]===1?1:X.size[0]-2,Y.bind(U(M),b.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,a,S),d&&d.useMeterToDem&&M){const Q=(1<<M.tileID.canonical.z)*n.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=Q}if(d&&d.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),a.setTerrainUniformValues(y,S),this.painter.transform.projection.name==="globe"){const Q=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);a.setGlobeUniformValues(y,Q)}}globeUniformValues(t,a,d){const y=t.projection;return{u_tile_tl_up:y.upVector(a,0,0),u_tile_tr_up:y.upVector(a,n.al,0),u_tile_br_up:y.upVector(a,n.al,n.al),u_tile_bl_up:y.upVector(a,0,n.al),u_tile_up_scale:d?n.dM(1):y.upVectorScale(a,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const a=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),a.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(y,b,S,M,R){if(y.transform.projection.name==="globe")(function(N,U,Y,X,Q){const ae=N.context,ie=ae.gl;let _e,fe;const Te=N.transform,De=n.dE(N,ae,Te),Se=(St,It)=>{if(fe===It)return;const zt=[Pr[It],"PROJECTION_GLOBE_VIEW"];De&&zt.push("CUSTOM_ANTIALIASING");const Jt=N.isTileAffectedByFog(St);_e=N.getOrCreateProgram("globeRaster",{defines:zt,overrideFog:Jt}),fe=It},Ze=N.colorModeForRenderPass(),Ve=new xn(ie.LEQUAL,xn.ReadWrite,N.depthRangeFor3D);Xn.update(Q);const Ge=n.dF(Te),Fe=[n.aF(Te.center.lng),n.aJ(Te.center.lat)],Oe=N.globeSharedBuffers,it=[Te.width*n.o.devicePixelRatio,Te.height*n.o.devicePixelRatio],ft=Float32Array.from(Te.globeMatrix),ht={useDenormalizedUpVectorScale:!0};{const St=N.transform,It=vu(St.zoom,U.exaggeration(),U.sourceCache._source.tileSize);fe=-1;const zt=ie.TRIANGLES;for(const Jt of X){const gt=Y.getTile(Jt),nt=Un.disabled,Bt=U.prevTerrainTileForTile[Jt.key],Dt=U.terrainTileForTile[Jt.key];Kc(Bt,Dt)&&Xn.newMorphing(Jt.key,Bt,Dt,Q,250),_d(N,gt.emissiveTexture),ae.activeTexture.set(ie.TEXTURE0),gt.texture&&gt.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const li=Xn.getMorphValuesForProxy(Jt.key),Ei=li?1:0;li&&Object.assign(ht,{morphing:{srcDemTile:li.from,dstDemTile:li.to,phase:n.dD(li.phase)}});const Ri=n.dG(Jt.canonical),Ti=n.dH(Ri.getCenter().lat),mi=n.dI(Jt.canonical,Ri,Ti,St.worldSize/St._pixelsPerMercatorPixel),pn=n.bk(n.dJ(Jt.canonical)),en=N.emissiveMode==="mrt-fallback"?1:0,ji=pc(St.expandedFarZProjMatrix,ft,Ge,pn,n.aj(St.zoom),Fe,St.frustumCorners.TL,St.frustumCorners.TR,St.frustumCorners.BR,St.frustumCorners.BL,St.globeCenterInViewSpace,St.globeRadius,it,It,St._farZ,en,mi);if(Se(Jt,Ei),_e&&(U.setupElevationDraw(gt,_e,ht),N.uploadCommonUniforms(ae,_e,Jt.toUnwrapped()),Oe)){const[Qi,vn,rr]=Oe.getGridBuffers(Ti,It!==0);_e.draw(N,zt,Ve,nt,Ze,jn.backCCW,ji,"globe_raster",Qi,vn,rr)}}}if(Oe&&(N.renderDefaultNorthPole||N.renderDefaultSouthPole)){const St=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];De&&St.push("CUSTOM_ANTIALIASING"),_e=N.getOrCreateProgram("globeRaster",{defines:St});for(const It of X){const{x:zt,y:Jt,z:gt}=It.canonical,nt=Jt===0,Bt=Jt===(1<<gt)-1,[Dt,li,Ei,Ri]=Oe.getPoleBuffers(gt,!1);if(Ri&&(nt||Bt)){const Ti=Y.getTile(It);_d(N,Ti.emissiveTexture),ae.activeTexture.set(ie.TEXTURE0),Ti.texture&&Ti.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);let mi=n.dK(gt,zt,Te);const pn=n.bk(n.dJ(It.canonical)),en=N.emissiveMode==="mrt-fallback"?1:0,ji=(Qi,vn)=>Qi.draw(N,ie.TRIANGLES,Ve,Un.disabled,Ze,jn.disabled,pc(Te.expandedFarZProjMatrix,mi,mi,pn,0,Fe,Te.frustumCorners.TL,Te.frustumCorners.TR,Te.frustumCorners.BR,Te.frustumCorners.BL,Te.globeCenterInViewSpace,Te.globeRadius,it,0,Te._farZ,en),"globe_pole_raster",vn,Ei,Ri);U.setupElevationDraw(Ti,_e,ht),N.uploadCommonUniforms(ae,_e,It.toUnwrapped()),nt&&N.renderDefaultNorthPole&&ji(_e,Dt),Bt&&N.renderDefaultSouthPole&&(mi=n.cS(n.bC(),mi,[1,-1,1]),ji(_e,li))}}}})(y,b,S,M,R);else{const N=y.context,U=N.gl;let Y,X;const Q=y.shadowRenderer,ae=sh(y,y.longestCutoffRange),ie=Ze=>{if(X===Ze)return;const Ve=[];Ve.push(Pr[Ze]),ae.shouldRenderCutoff&&Ve.push("RENDER_CUTOFF"),Q&&(Ve.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&Ve.push("NORMAL_OFFSET")),Y=y.getOrCreateProgram("terrainRaster",{defines:Ve}),X=Ze},_e=y.colorModeForRenderPass(),fe=new xn(U.LEQUAL,xn.ReadWrite,y.depthRangeFor3D);Xn.update(R);const Te=y.transform,De=vu(Te.zoom,b.exaggeration(),b.sourceCache._source.tileSize);let Se=[0,0,0];if(Q){const Ze=y.style.directionalLight,Ve=y.style.ambientLight;Ze&&Ve&&(Se=Lc(y.style,Ze,Ve))}{X=-1;const Ze=U.TRIANGLES,[Ve,Ge]=[b.gridIndexBuffer,b.gridSegments];for(const Fe of M){const Oe=S.getTile(Fe),it=Un.disabled,ft=b.prevTerrainTileForTile[Fe.key],ht=b.terrainTileForTile[Fe.key];Kc(ft,ht)&&Xn.newMorphing(Fe.key,ft,ht,R,250),_d(y,Oe.emissiveTexture),N.activeTexture.set(U.TEXTURE0),Oe.texture&&Oe.texture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const St=Xn.getMorphValuesForProxy(Fe.key),It=St?1:0;let zt;St&&(zt={morphing:{srcDemTile:St.from,dstDemTile:St.to,phase:n.dD(St.phase)}});const Jt=y.emissiveMode==="mrt-fallback"?1:0,gt=ls(Fe.projMatrix,ju(Fe.canonical,Te.renderWorldCopies)?De/10:De,Se,Jt);if(ie(It),!Y)continue;b.setupElevationDraw(Oe,Y,zt);const nt=Fe.toUnwrapped();Q&&Q.setupShadows(nt,Y),y.uploadCommonUniforms(N,Y,nt,null,ae),Y.draw(y,Ze,fe,it,_e,jn.backCCW,gt,"terrain_raster",b.gridBuffer,Ve,Ge)}}}})(a,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,a.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const a=this.painter,d=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],S=this._drapedRenderBatches.shift(),M=a.style.order,R=[];this._updateFBOs(a.emissiveMode==="mrt-fallback");let N=0;for(const U of b){const Y=y.getTileByID(U.proxyTileKey),X=y.proxyCachedFBO[U.key]?y.proxyCachedFBO[U.key][t]:void 0,Q=X!==void 0?y.renderCache[X]:this.pool[N++],ae=X!==void 0;if(Y.texture=Q.tex,Y.emissiveTexture=Q.emissiveTex,ae&&!Q.dirty){R.push(Y.tileID);continue}d.bindFramebuffer.set(Q.fb.framebuffer);const ie=d.gl;let _e;ie.drawBuffers(a.emissiveMode==="mrt-fallback"?[ie.COLOR_ATTACHMENT0,ie.COLOR_ATTACHMENT1]:[ie.COLOR_ATTACHMENT0]),this.renderedToTile=!1,Q.dirty&&(d.clear({color:n.ao.transparent,stencil:0}),Q.dirty=!1);for(let fe=S.start;fe<=S.end;++fe){const Te=a.style._mergedLayers[M[fe]];if(Te.isHidden(a.transform.zoom))continue;const De=a.style.getLayerSourceCache(Te),Se=De?this.proxyToSource[U.key][De.id]:[U];if(!Se)continue;const Ze=Se;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),_e!==(De?De.id:null)&&(this._setupStencil(Q,Se,Te,De),_e=De?De.id:null),a.renderLayer(a,De,Te,Ze)}if(ie.drawBuffers([ie.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const fe of this._pendingGroundEffectLayers){const Te=a.style._mergedLayers[M[fe]];if(Te.isHidden(a.transform.zoom))continue;const De=a.style.getLayerSourceCache(Te),Se=De?this.proxyToSource[U.key][De.id]:[U];if(!Se)continue;const Ze=Se;d.viewport.set([0,0,Q.fb.width,Q.fb.height]),_e!==(De?De.id:null)&&(this._setupStencil(Q,Se,Te,De),_e=De?De.id:null),a.renderLayer(a,De,Te,Ze)}this.renderedToTile?(Q.dirty=!0,R.push(Y.tileID)):ae||--N,N===5&&(N=0,this.renderToBackBuffer(R))}return this.renderToBackBuffer(R),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,a.width,a.height]),S.end+1}postRender(){}isLayerOrderingCorrect(t){const a=t.order.length;let d=-1,y=a;for(let b=0;b<a;++b)this._style.isLayerDraped(t._mergedLayers[t.order[b]])?d=Math.max(d,b):y=Math.min(y,b);return y>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter((a=>a.dem)).forEach((a=>{t=Math.min(t,a.dem.tree.minimums[0])})),t===0?t:(t-30)*this._exaggeration}raycast(t,a,d){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter((b=>b.dem)).map((b=>{const S=b.tileID,M=1<<S.overscaledZ,{x:R,y:N}=S.canonical,U=R/M,Y=(R+1)/M,X=N/M,Q=(N+1)/M;return{minx:U,miny:X,maxx:Y,maxy:Q,t:b.dem.tree.raycastRoot(U,X,Y,Q,t,a,d),tile:b}}));y.sort(((b,S)=>(b.t!==null?b.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE)));for(const b of y){if(b.t==null)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,t,a,d);if(S!=null)return S}return null}_createFBO(){const t=this.painter.context,a=t.gl,d=this.drapeBufferSize;t.activeTexture.set(a.TEXTURE0);const y=new n.T(t,{width:d[0],height:d[1],data:null},a.RGBA8);y.bind(a.LINEAR,a.CLAMP_TO_EDGE);const b=t.createFramebuffer(d[0],d[1],1,null);let S;return b.colorAttachment0.set(y.texture),this._emissiveTexture&&(S=new n.T(t,{width:d[0],height:d[1],data:null},a.R8),S.bind(a.LINEAR,a.CLAMP_TO_EDGE),b.createColorAttachment(t,1),b.colorAttachment1.set(S.texture)),b.depthAttachment=new rf(t,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&a.texParameterf(a.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:b,tex:y,emissiveTex:S,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const a of this.pool)this._updateFBO(a,t);for(const a of this.proxySourceCache.renderCache)this._updateFBO(a,t);this._emissiveTexture=t}}_updateFBO(t,a){const d=t.fb,y=this.painter.context,b=y.gl,S=this.drapeBufferSize;if(a){const M=new n.T(y,{width:S[0],height:S[1],data:null},b.R8);M.bind(b.LINEAR,b.CLAMP_TO_EDGE),t.emissiveTex=M,d.createColorAttachment(y,1),d.colorAttachment1.set(M.texture)}else t.emissiveTex=void 0,d.removeColorAttachment(y,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some((t=>{const a=this._style._mergedLayers[t],d=a.isHidden(this.painter.transform.zoom);return a.type==="hillshade"||a.type==="custom"?!d&&a.shouldRedrape():!d&&a.hasTransition()}))}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof nh){t=!0;break}if(!t)return;const a={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(y);if(!b||a[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="line")continue;const S=y.widthExpression(),M=y.emissiveStrengthExpression();if(S instanceof n.ad||M instanceof n.ad){a[b.id]=!0;for(const R of this.proxyCoords){const N=this.proxyToSource[R.key][b.id];if(N)for(const U of N)this._clearRenderCacheForTile(b.id,U)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof es){t=!0;break}if(!t)return;const a={};for(let d=0;d<this._style.order.length;++d){const y=this._style._mergedLayers[this._style.order[d]],b=this._style.getLayerSourceCache(y);if(!b||a[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const S=y.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const R=this.proxyToSource[M.key][b.id];if(R)for(const N of R){const U=o(b.getTile(N),b.findLoadedParent(N,0),b,this.painter.transform,S);(U.opacity!==1||U.mix!==0)&&this._clearRenderCacheForTile(b.id,N)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,a=t.length;if(a===0)return;const d=[];this._pendingGroundEffectLayers=[];let y,b=0,S=this._style._mergedLayers[t[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<a;)S=this._style._mergedLayers[t[b]];for(;b<a;++b){const M=this._style._mergedLayers[t[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?y===void 0&&(y=b):(M.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(b),y!==void 0&&(d.push({start:y,end:b-1}),y=void 0)))}if(y!==void 0&&d.push({start:y,end:b-1}),d.length!==0){const M=d[d.length-1];this._pendingGroundEffectLayers.every((R=>R>M.end))||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const a=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,a.renderCache.length>a.renderCachePool.length){const S=Object.values(a.proxyCachedFBO);a.proxyCachedFBO={};for(let M=0;M<S.length;++M){const R=Object.values(S[M]);a.renderCachePool.push(...R)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,y=this._tilesDirty;for(let S=d.length-1;S>=0;S--){const M=d[S];if(a.getTileByID(M.key),a.proxyCachedFBO[M.key]!==void 0){const R=t[M.key],N=this.proxyToSource[M.key];let U=0;for(const Y in N){const X=N[Y],Q=R[Y];if(!Q||Q.length!==X.length||X.some(((ae,ie)=>ae!==Q[ie]||y[Y]&&y[Y].hasOwnProperty(ae.key)))){U=-1;break}++U}for(const Y in a.proxyCachedFBO[M.key])a.renderCache[a.proxyCachedFBO[M.key][Y]].dirty=U<0||U!==Object.values(R).length}}const b=[...this._drapedRenderBatches];b.sort(((S,M)=>M.end-M.start-(S.end-S.start)));for(const S of b)for(const M of d){if(a.proxyCachedFBO[M.key])continue;let R=a.renderCachePool.pop();R===void 0&&a.renderCache.length<50&&(R=a.renderCache.length,a.renderCache.push(this._createFBO())),R!==void 0&&(a.proxyCachedFBO[M.key]={},a.proxyCachedFBO[M.key][S.start]=R,a.renderCache[R].dirty=!0)}this._tilesDirty={}}_setupStencil(t,a,d,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(a.length<=1)return void(this._overlapStencilType=!1);let M;if(d.isTileClipped())M=a.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(a[0].overscaledZ>a[a.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(a,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Un.disabled}_renderTileClippingMasks(t,a){const d=this.painter,y=this.painter.context,b=y.gl;d._tileClippingMaskIDs={},y.setColorMode(cr.disabled),y.setDepthMode(xn.disabled);const S=d.getOrCreateProgram("clippingMask");for(const M of t){const R=d._tileClippingMaskIDs[M.key]=--a;S.draw(d,b.TRIANGLES,xn.disabled,new Un({func:b.ALWAYS,mask:0},R,255,b.KEEP,b.KEEP,b.REPLACE),cr.disabled,jn.disabled,L(M.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const a=this.painter.transform;if(t.x<0||t.x>a.width||t.y<0||t.y>a.height)return null;const d=[t.x,t.y,1,1];n.aC(d,d,a.pixelMatrixInverse),n.cK(d,d,1/d[3]),d[0]/=a.worldSize,d[1]/=a.worldSize;const y=a._camera.position,b=n.cf(1,a.center.lat),S=[y[0],y[1],y[2]/b,0],M=n.da([],d.slice(0,3),S);n.aw(M,M);const R=this.raycast(S,M,this._exaggeration);return R!==null&&R?(n.bH(S,S,M,R),S[3]=S[2],S[2]*=b,S):null}_setupProxiedCoordsForOrtho(t,a,d){if(t.getSource()instanceof n.aU)return this._setupProxiedCoordsForImageSource(t,a,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords;for(let R=0;R<b.length;R++){const N=b[R],U=this._findTileCoveringTileID(N,t);if(U){const Y=this._createProxiedId(N,U,d[N.key]&&d[N.key][t.id]);y.push(Y),this.proxyToSource[N.key][t.id]=[Y]}}let S=!1;const M=new Set;for(let R=0;R<a.length;R++){const N=t.getTile(a[R]);if(!N||!N.hasData())continue;const U=this._findTileCoveringTileID(N.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==N.tileID.canonical.z){const Y=this.proxyToSource[U.tileID.key][t.id],X=this._createProxiedId(U.tileID,N,d[U.tileID.key]&&d[U.tileID.key][t.id]);Y?Y.splice(Y.length-1,0,X):this.proxyToSource[U.tileID.key][t.id]=[X];const Q=this.proxyToSource[U.tileID.key][t.id];M.has(Q)||M.add(Q),y.push(X),S=!0}}if(this._sourceTilesOverlap[t.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const R of M)R.sort(((N,U)=>U.overscaledZ-N.overscaledZ))}_setupProxiedCoordsForImageSource(t,a,d){if(!t.getSource().loaded())return;const y=this.proxiedCoords[t.id]=[],b=this.proxyCoords,S=t.getSource(),M=S.tileID;if(!M)return;const R=new n.P(M.x,M.y)._div(1<<M.z),N=S.coordinates.map(n.ae.fromLngLat).reduce(((Y,X)=>(Y.min.x=Math.min(Y.min.x,X.x-R.x),Y.min.y=Math.min(Y.min.y,X.y-R.y),Y.max.x=Math.max(Y.max.x,X.x-R.x),Y.max.y=Math.max(Y.max.y,X.y-R.y),Y)),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(Y,X)=>{const Q=Y.wrap+Y.canonical.x/(1<<Y.canonical.z),ae=Y.canonical.y/(1<<Y.canonical.z),ie=n.al/(1<<Y.canonical.z),_e=X.wrap+X.canonical.x/(1<<X.canonical.z),fe=X.canonical.y/(1<<X.canonical.z);return Q+ie<_e+N.min.x||Q>_e+N.max.x||ae+ie<fe+N.min.y||ae>fe+N.max.y};for(let Y=0;Y<b.length;Y++){const X=b[Y];for(let Q=0;Q<a.length;Q++){const ae=t.getTile(a[Q]);if(!ae||!ae.hasData()||U(X,ae.tileID))continue;const ie=this._createProxiedId(X,ae,d[X.key]&&d[X.key][t.id]),_e=this.proxyToSource[X.key][t.id];_e?_e.push(ie):this.proxyToSource[X.key][t.id]=[ie],y.push(ie)}}}_createProxiedId(t,a,d){let y=this.orthoMatrix;if(d){const b=d.find((S=>S.key===a.tileID.key));if(b)return b}if(a.tileID.key!==t.key){const b=t.canonical.z-a.tileID.canonical.z;let S,M,R;y=n.bC();const N=a.tileID.wrap-t.wrap<<t.overscaledZ;b>0?(S=n.al>>b,M=S*((a.tileID.canonical.x<<b)-t.canonical.x+N),R=S*((a.tileID.canonical.y<<b)-t.canonical.y)):(S=n.al<<-b,M=n.al*(a.tileID.canonical.x-(t.canonical.x+N<<-b)),R=n.al*(a.tileID.canonical.y-(t.canonical.y<<-b))),n.ce(y,0,S,0,S,0,1),n.br(y,y,[M,R,0])}return new I(a.tileID,t.key,y)}_findTileCoveringTileID(t,a){let d=a.getTile(t);if(d&&d.hasData())return d;const y=this._findCoveringTileCache[a.id],b=y[t.key];if(d=b?a.getTileByID(b):null,d&&d.hasData()||b===null)return d;let S=d?d.tileID:t,M=S.overscaledZ;const R=a.getSource().minzoom,N=[];if(!b){const Y=a.getSource().maxzoom;if(t.canonical.z>=Y){const X=t.canonical.z-Y;a.getSource().reparseOverscaled?(M=Math.max(t.canonical.z+2,a.transform.tileZoom),S=new n.aQ(M,t.wrap,Y,t.canonical.x>>X,t.canonical.y>>X)):X!==0&&(M=Y,S=new n.aQ(M,t.wrap,Y,t.canonical.x>>X,t.canonical.y>>X))}S.key!==t.key&&(N.push(S.key),d=a.getTile(S))}const U=Y=>{N.forEach((X=>{y[X]=Y})),N.length=0};for(M-=1;M>=R&&(!d||!d.hasData());M--){d&&U(d.tileID.key);const Y=S.calculateScaledKey(M);if(d=a.getTileByID(Y),d&&d.hasData())break;const X=y[Y];if(X===null)break;X===void 0?N.push(Y):d=a.getTileByID(X)}return U(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,a){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[a.key]=!0}}function H(h,t,a){const d=(function(M,R,N){const U=n.bJ(R,M),Y=n.bJ(N,[.2126,.7152,.0722]),X=(ae,ie,_e)=>(1-_e)*ae+_e*ie,Q=X(1-.3*Math.min(Y,1),1,Math.min(U+1,1));return X(.92,1,Math.asin(n.aA(R[2],-1,1))/Math.PI+.5)*Q})(h,[0,0,1],t),y=[0,0,0];n.c5(y,a.slice(0,3),d);const b=[0,0,0];n.c5(b,t.slice(0,3),h[2]);const S=[0,0,0];return n.d8(S,y,b),n.db(S)}const K=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ne=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class he{static cacheKey(t,a,d,y){const b=[a];y&&b.push(y.cacheKey);for(const S of d)t.usedDefines.has(S)&&b.push(S);return b.join("/")}constructor(t,a,d,y,b,S){const M=t.gl;this.program=M.createProgram(),this.configuration=y,this.name=a,this.fixedDefines=[...S];const R=`#version 300 es
${(y?y.defines():[]).concat(S.map((ie=>`#define ${ie}`))).join(`
`)}`,N=[R,Wd];for(const ie of d.fragmentIncludes)N.push(Nu[ie]);N.push(d.fragmentSource);const U=N.join(`
`),Y=[R,Yd];for(const ie of d.vertexIncludes)Y.push(Nu[ie]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&Y.push("uniform int u_instanceID;"),Y.push(d.vertexSource);let X=Y.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(X=X.replaceAll("gl_InstanceID","u_instanceID"));const Q=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(Q,U),M.compileShader(Q),M.attachShader(this.program,Q);const ae=M.createShader(M.VERTEX_SHADER);M.isContextLost()?this.failedToCreate=!0:(M.shaderSource(ae,X),M.compileShader(ae),M.attachShader(this.program,ae),this.attributes={},M.linkProgram(this.program),M.deleteShader(ae),M.deleteShader(Q),this.fixedUniforms=b(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=y?y.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ie=>({u_instanceID:new n.ch(ie)}))(t)),(S.includes("TERRAIN")||a.includes("symbol")||a.includes("circle"))&&(this.terrainUniforms=(ie=>({u_dem:new n.ch(ie),u_dem_prev:new n.ch(ie),u_dem_tl:new n.ck(ie),u_dem_scale:new n.cj(ie),u_dem_tl_prev:new n.ck(ie),u_dem_scale_prev:new n.cj(ie),u_dem_size:new n.cj(ie),u_dem_lerp:new n.cj(ie),u_exaggeration:new n.cj(ie),u_depth:new n.ch(ie),u_depth_size_inv:new n.ck(ie),u_depth_range_unpack:new n.ck(ie),u_occluder_half_size:new n.cj(ie),u_occlusion_depth_offset:new n.cj(ie),u_meter_to_dem:new n.cj(ie),u_label_plane_matrix_inv:new n.cl(ie)}))(t)),S.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new n.ci(ie),u_tile_tr_up:new n.ci(ie),u_tile_br_up:new n.ci(ie),u_tile_bl_up:new n.ci(ie),u_tile_up_scale:new n.cj(ie)}))(t)),S.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new n.cl(ie),u_fog_range:new n.ck(ie),u_fog_color:new n.d3(ie),u_fog_horizon_blend:new n.cj(ie),u_fog_vertical_limit:new n.ck(ie),u_fog_temporal_offset:new n.cj(ie),u_frustum_tl:new n.ci(ie),u_frustum_tr:new n.ci(ie),u_frustum_br:new n.ci(ie),u_frustum_bl:new n.ci(ie),u_globe_pos:new n.ci(ie),u_globe_radius:new n.cj(ie),u_globe_transition:new n.cj(ie),u_is_globe:new n.ch(ie),u_viewport:new n.ck(ie)}))(t)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new n.d3(ie)}))(t)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new n.ci(ie),u_lighting_directional_dir:new n.ci(ie),u_lighting_directional_color:new n.ci(ie),u_ground_radiance:new n.ci(ie)}))(t)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new n.cl(ie),u_light_matrix_1:new n.cl(ie),u_fade_range:new n.ck(ie),u_shadow_normal_offset:new n.ci(ie),u_shadow_intensity:new n.cj(ie),u_shadow_texel_size:new n.cj(ie),u_shadow_map_resolution:new n.cj(ie),u_shadow_direction:new n.ci(ie),u_shadow_bias:new n.ci(ie),u_shadowmap_0:new n.ch(ie),u_shadowmap_1:new n.ch(ie)}))(t)))}getAttributeLocation(t,a){let d=this.attributes[a];return d===void 0&&(d=this.attributes[a]=t.getAttribLocation(this.program,a)),d}setTerrainUniformValues(t,a){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y]&&d[y].set(this.program,y,a[y])}}setGlobeUniformValues(t,a){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y]&&d[y].set(this.program,y,a[y])}}setFogUniformValues(t,a){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y].set(this.program,y,a[y])}}setCutoffUniformValues(t,a){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y].set(this.program,y,a[y])}}setLightsUniformValues(t,a){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const y in a)d[y].set(this.program,y,a[y])}}setShadowUniformValues(t,a){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const y in a)d[y].set(this.program,y,a[y])}_drawDebugWireframe(t,a,d,y,b,S,M,R,N,U){const Y=t.options.wireframe;if(Y.terrain===!1&&Y.layers2D===!1&&Y.layers3D===!1)return;const X=t.context;if(!(!(!Y.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Y.layers2D||t._terrain&&t._terrain.renderingToTexture||!K.includes(this.name))||!(!Y.layers3D||!ne.includes(this.name))))return;const Q=X.gl,ae=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,b,X);if(!ae)return;const ie=[...this.fixedDefines,"DEBUG_WIREFRAME"],_e=t.getOrCreateProgram(this.name,{config:this.configuration,defines:ie});X.program.set(_e.program);const fe=(Se,Ze,Ve)=>{if(Ze[Se]&&Ve[Se])for(const Ge in Ze[Se])Ve[Se][Ge]&&Ve[Se][Ge].set(Ve.program,Ge,Ze[Se][Ge].current)};N&&N.setUniforms(_e.program,X,_e.binderUniforms,M,{zoom:R}),fe("fixedUniforms",this,_e),fe("terrainUniforms",this,_e),fe("globeUniforms",this,_e),fe("fogUniforms",this,_e),fe("lightsUniforms",this,_e),fe("shadowUniforms",this,_e),ae.bind(),X.setColorMode(new cr([Q.ONE,Q.ONE_MINUS_SRC_ALPHA,Q.ZERO,Q.ONE],n.ao.transparent,[!0,!0,!0,!1])),X.setDepthMode(new xn(a.func===Q.LESS?Q.LEQUAL:a.func,xn.ReadOnly,a.range)),X.setStencilMode(Un.disabled);const Te=3*S.primitiveLength*2,De=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const Se=U||1;for(let Ze=0;Ze<Se;++Ze)_e.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Ze),Q.drawElements(Q.LINES,Te,Q.UNSIGNED_SHORT,De)}else U&&U>1?Q.drawElementsInstanced(Q.LINES,Te,Q.UNSIGNED_SHORT,De,U):Q.drawElements(Q.LINES,Te,Q.UNSIGNED_SHORT,De);b.bind(),X.program.set(this.program),X.setDepthMode(a),X.setStencilMode(d),X.setColorMode(y)}checkUniforms(t,a,d){if(this.fixedDefines.includes(a)){for(const y of Object.keys(d))if(!d[y].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${y} not set but required by ${a} being defined`)}}draw(t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e){const fe=t.context,Te=fe.gl;if(this.failedToCreate)return;fe.program.set(this.program),fe.setDepthMode(d),fe.setStencilMode(y),fe.setColorMode(b),fe.setCullFace(S);for(const[Fe,Oe]of this.fixedUniformsEntries)Oe.set(this.program,Fe,M[Fe]);ae&&ae.setUniforms(this.program,fe,this.binderUniforms,X,{zoom:Q});const De={[Te.POINTS]:1,[Te.LINES]:2,[Te.TRIANGLES]:3,[Te.LINE_STRIP]:1}[a];this.checkUniforms(R,"RENDER_SHADOWS",this.shadowUniforms);const Se=ie||[],Ze=ae?ae.getPaintVertexBuffers():[],Ve=a===Te.TRIANGLES&&U,Ge=_e&&_e>0?1:void 0;for(const Fe of Y.get()){const Oe=Fe.vaos||(Fe.vaos={});if((Oe[R]||(Oe[R]=new Fh)).bind(fe,this,N,Ze,U,Fe.vertexOffset,Se,Ge),this.forceManualRenderingForInstanceIDShaders){const it=_e||1;for(let ft=0;ft<it;++ft)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ft),U?Te.drawElements(a,Fe.primitiveLength*De,Te.UNSIGNED_SHORT,Fe.primitiveOffset*De*2):Te.drawArrays(a,Fe.vertexOffset,Fe.vertexLength)}else _e&&_e>1?Te.drawElementsInstanced(a,Fe.primitiveLength*De,Te.UNSIGNED_SHORT,Fe.primitiveOffset*De*2,_e):U?Te.drawElements(a,Fe.primitiveLength*De,Te.UNSIGNED_SHORT,Fe.primitiveOffset*De*2):Te.drawArrays(a,Fe.vertexOffset,Fe.vertexLength);Ve&&this._drawDebugWireframe(t,d,y,b,U,Fe,X,Q,ae,_e)}}}function be(h,t,a=0){const d=Math.pow(2,t.tileID.overscaledZ),y=t.tileSize*Math.pow(2,h.transform.tileZoom)/d,b=y*(t.tileID.canonical.x+t.tileID.wrap*d),S=y*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ay(t,1,h.transform.tileZoom),u_pixel_coord_upper:[b>>16,S>>16],u_pixel_coord_lower:[65535&b,65535&S],u_pattern_transition:a}}const we={terrain:0,flat:1},Be=n.bC(),Ye=(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e,fe)=>{const Te=t.style.light,De=Te.properties.get("position"),Se=[De.x,De.y,De.z],Ze=n.dO();Te.properties.get("anchor")==="viewport"&&(n.dP(Ze,-t.transform.angle),n.dQ(Se,Se,Ze));const Ve=Te.properties.get("color").toPremultipliedRenderColor(null),Ge=t.transform,Fe={u_matrix:h,u_lightpos:Se,u_lightintensity:Te.properties.get("intensity"),u_lightcolor:[Ve.r,Ve.g,Ve.b],u_vertical_gradient:+a,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Be,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:we[N],u_base_type:we[U],u_ao:y,u_edge_radius:b,u_width_scale:S,u_flood_light_color:ae,u_vertical_scale:ie,u_flood_light_intensity:_e,u_ground_shadow_factor:fe};return Ge.projection.name==="globe"&&(Fe.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],Fe.u_zoom_transition=Y,Fe.u_inv_rot_matrix=Q,Fe.u_merc_center=X,Fe.u_up_dir=Ge.projection.upVector(new n.cD(0,0,0),X[0]*n.al,X[1]*n.al),Fe.u_height_lift=R),Fe},st=(h,t,a,d,y,b)=>({u_matrix:h,u_edge_radius:t,u_width_scale:a,u_vertical_scale:d,u_height_type:we[y],u_base_type:we[b]}),vt=(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e,fe)=>{const Te=Ye(h,t,a,d,y,b,S,M,N,U,Y,X,Q,ae,ie,_e,1,[0,0,0]),De={u_height_factor:-Math.pow(2,M.overscaledZ)/R.tileSize/8};return Object.assign(Te,be(t,R,fe),De)},Et=(h,t,a,d,y,b,S,M,R,N,U)=>({u_matrix:t,u_opacity:a,u_ao_pass:d?1:0,u_meter_to_tile:y,u_ao:b,u_flood_light_intensity:S,u_flood_light_color:M,u_attenuation:R,u_edge_radius:N,u_fb:0,u_fb_size:U,u_dynamic_offset:1}),Ct=(h,t,a)=>({u_matrix:h,u_emissive_strength:t,u_ground_shadow_factor:a}),Lt=(h,t,a,d,y,b=0)=>Object.assign(Ct(h,t,y),be(a,d,b)),_t=(h,t,a,d)=>({u_matrix:h,u_world:a,u_emissive_strength:t,u_ground_shadow_factor:d}),Ht=(h,t,a,d,y,b,S=0)=>Object.assign(Lt(h,t,a,d,b,S),{u_world:y}),Qt=(h,t)=>({u_matrix:h,u_ground_shadow_factor:t}),oi=(h,t,a,d,y)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:a,u_height_scale:d,u_reset_depth:y}),$i=(h,t,a,d,y,b,S,M,R)=>({u_matrix:h,u_normal_matrix:t,u_opacity:a,u_faux_facade_ao_intensity:d,u_camera_pos:y,u_tile_to_meter:b,u_facade_emissive_chance:S,u_flood_light_color:M,u_flood_light_intensity:R}),An=h=>({u_matrix:h}),Mn=h=>({u_matrix:h}),Zn=(h,t,a,d,y,b,S,M)=>{const R=n.al/b.tileSize;return{u_matrix:h,u_inv_rot_matrix:t,u_camera_to_center_distance:a.getCameraToCenterDistance(M),u_extrude_scale:[a.pixelsToGLUnits[0]/R,a.pixelsToGLUnits[1]/R],u_zoom_transition:d,u_tile_id:S,u_merc_center:y}},Ln=(h,t,a=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:a}),zn=n.bC(),ir=(h,t,a,d,y,b,S)=>{const M=h.transform,R=M.projection.name==="globe",N=R?n.dR(M.zoom,t.canonical)*M._pixelsPerMercatorPixel:n.ay(a,1,b),U={u_matrix:t.projMatrix,u_extrude_scale:N,u_intensity:S,u_inv_rot_matrix:zn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(R){U.u_inv_rot_matrix=d,U.u_merc_center=y,U.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],U.u_zoom_transition=n.aj(M.zoom);const Y=y[0]*n.al,X=y[1]*n.al;U.u_up_dir=M.projection.upVector(new n.cD(0,0,0),Y,X)}return U};function $r(h,[t,a,d,y],[b,S]){if(b===S)return[0,0,0,0];const M=255*(h-1)/(h*(S-b));return[t*M,a*M,d*M,y*M]}function On(h,t,[a,d]){return a===d?0:.5/h+(t-a)*(h-1)/(h*(d-a))}const qn=(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e,fe,Te,De,Se)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:N,u_fade_t:U.mix,u_opacity:U.opacity*Y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Y.paint.get("raster-brightness-min"),u_brightness_high:Y.paint.get("raster-brightness-max"),u_saturation_factor:n.dT(Y.paint.get("raster-saturation")),u_contrast_factor:n.dS(Y.paint.get("raster-contrast")),u_spin_weights:Yr(Y.paint.get("raster-hue-rotate")),u_perspective_transform:X,u_raster_elevation:Q,u_zoom_transition:S,u_merc_center:M,u_cutoff_params:R,u_colorization_mix:$r(n.dU,ie,fe),u_colorization_offset:On(n.dU,_e,fe),u_color_ramp:ae,u_texture_offset:[De/(Te+2*De),Te/(Te+2*De)],u_texture_res:[Te+2*De,Te+2*De],u_emissive_strength:Se});function Yr(h){h*=Math.PI/180;const t=Math.sin(h),a=Math.cos(h);return[(2*a+1)/3,(-Math.sqrt(3)*t-a+1)/3,(Math.sqrt(3)*t-a+1)/3]}const Qa=.05,Ma=(h,t,a,d,y,b,S,M,R,N,U,Y)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:a,u_merc_matrix:d,u_grid_matrix:y,u_tl_parent:b,u_scale_parent:N,u_fade_t:U.mix,u_opacity:U.opacity,u_image0:0,u_image1:1,u_raster_elevation:Y,u_zoom_transition:S,u_merc_center:M,u_cutoff_params:R}),Za=(h,t,a,d,y,b,S,M,R,N)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:a,u_velocity:d,u_color_ramp:b,u_velocity_res:y,u_max_speed:S,u_uv_offset:M,u_data_scale:[255*R[0],255*R[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qa,Qa]}),Ls=(h,t,a,d,y,b,S,M,R,N)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:a,u_velocity_res:d,u_max_speed:y,u_speed_factor:b,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:M,u_data_scale:[255*R[0],255*R[1]],u_data_offset:N,u_particle_pos_scale:1.1,u_particle_pos_offset:[Qa,Qa]}),ol=n.bC(),mc=(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e,fe,Te,De,Se,Ze,Ve,Ge)=>{const Fe=y.transform,Oe={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:Fe.getCameraToCenterDistance(Te),u_rotate_symbol:+a,u_aspect_ratio:Fe.width/Fe.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:M,u_is_text:+N,u_elevation_from_sea:R?1:0,u_pitch_with_map:+d,u_texsize:U,u_texsize_icon:Y,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ol,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ol,u_up_vector:[0,-1,0],u_color_adj_mat:Ze,u_icon_transition:Ve||0,u_gamma_scale:d?y.transform.getCameraToCenterDistance(Te)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:n.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Ge||1,u_ground_shadow_factor:De,u_inv_matrix:n.bl(n.bC(),S),u_normal_scale:Se,u_lutTexture:ds.LUT};return Te.name==="globe"&&(Oe.u_tile_id=[Q.canonical.x,Q.canonical.y,1<<Q.canonical.z],Oe.u_zoom_transition=ae,Oe.u_inv_rot_matrix=_e,Oe.u_merc_center=ie,Oe.u_camera_forward=Fe._camera.forward(),Oe.u_ecef_origin=n.dV(Fe.globeMatrix,Q.toUnwrapped()),Oe.u_tile_matrix=Float32Array.from(Fe.globeMatrix),Oe.u_up_vector=fe),Oe},ks=(h,t,a,d)=>({u_matrix:h,u_emissive_strength:t,u_opacity:a,u_color:d}),Lo=(h,t,a,d,y,b,S,M,R)=>Object.assign((function(N,U,Y,X,Q,ae){const{width:ie,height:_e}=X.imageManager.getPixelSize(U),fe=Math.pow(2,ae.tileID.overscaledZ),Te=ae.tileSize*Math.pow(2,X.transform.tileZoom)/fe,De=Te*(ae.tileID.canonical.x+ae.tileID.wrap*fe),Se=Te*ae.tileID.canonical.y;return{u_image:0,u_pattern_tl:Y.tl,u_pattern_br:Y.br,u_texsize:[ie,_e],u_pattern_size:Y.displaySize,u_pattern_units_to_pixels:Q?[X.transform.width,-1*X.transform.height]:[1/n.ay(ae,1,X.transform.tileZoom),1/n.ay(ae,1,X.transform.tileZoom)],u_pixel_coord_upper:[De>>16,Se>>16],u_pixel_coord_lower:[65535&De,65535&Se]}})(0,b,S,d,M,R),{u_matrix:h,u_emissive_strength:t,u_opacity:a}),Os=new Float32Array(n.bA([])),Ms=(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q=[0,0,0],ae,ie,_e)=>{const fe=y.style.light,Te=fe.properties.get("position"),De=[-Te.x,-Te.y,Te.z],Se=n.dO();fe.properties.get("anchor")==="viewport"&&(n.dP(Se,-y.transform.angle),n.dQ(De,De,Se));const Ze=U.alphaMode==="MASK",Ve=fe.properties.get("color").toNonPremultipliedRenderColor(null),Ge=X.paint.get("model-ambient-occlusion-intensity"),Fe=X.paint.get("model-color").constantOr(n.ao.white).toNonPremultipliedRenderColor(null);return Fe.a=X.paint.get("model-color-mix-intensity").constantOr(0),_e&&(Fe.r=_e[0],Fe.g=_e[1],Fe.b=_e[2],Fe.a=_e[3]),ie&&(Fe.r=ie.color.r,Fe.g=ie.color.g,Fe.b=ie.color.b,Fe.a=ie.colorMix,Y=ie.emissionStrength,b*=ie.opacity),{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:a,u_node_matrix:d||Os,u_lightpos:De,u_lightintensity:fe.properties.get("intensity"),u_lightcolor:[Ve.r,Ve.g,Ve.b],u_camera_pos:Q,u_opacity:b,u_baseTextureIsAlpha:0,u_alphaMask:+Ze,u_alphaCutoff:U.alphaCutoff,u_baseColorFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:M.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:R,u_roughnessFactor:N,u_baseColorTexture:ds.BaseColor,u_metallicRoughnessTexture:ds.MetallicRoughness,u_normalTexture:ds.Normal,u_occlusionTexture:ds.Occlusion,u_emissionTexture:ds.Emission,u_lutTexture:ds.LUT,u_color_mix:Fe.toArray01(),u_aoIntensity:Ge,u_emissive_strength:Y,u_occlusionTextureTransform:ae||[0,0,0,0]}},Co=(h,t=Os,a=Os)=>({u_matrix:h,u_instance:t,u_node_matrix:a}),_c={fillExtrusion:h=>({u_matrix:new n.cl(h),u_lightpos:new n.ci(h),u_lightintensity:new n.cj(h),u_lightcolor:new n.ci(h),u_vertical_gradient:new n.cj(h),u_opacity:new n.cj(h),u_edge_radius:new n.cj(h),u_width_scale:new n.cj(h),u_ao:new n.ck(h),u_height_type:new n.ch(h),u_base_type:new n.ch(h),u_tile_id:new n.ci(h),u_zoom_transition:new n.cj(h),u_inv_rot_matrix:new n.cl(h),u_merc_center:new n.ck(h),u_up_dir:new n.ci(h),u_height_lift:new n.cj(h),u_flood_light_color:new n.ci(h),u_vertical_scale:new n.cj(h),u_flood_light_intensity:new n.cj(h),u_ground_shadow_factor:new n.ci(h)}),fillExtrusionDepth:h=>({u_matrix:new n.cl(h),u_edge_radius:new n.cj(h),u_width_scale:new n.cj(h),u_vertical_scale:new n.cj(h),u_height_type:new n.ch(h),u_base_type:new n.ch(h)}),fillExtrusionPattern:h=>({u_matrix:new n.cl(h),u_lightpos:new n.ci(h),u_lightintensity:new n.cj(h),u_lightcolor:new n.ci(h),u_vertical_gradient:new n.cj(h),u_height_factor:new n.cj(h),u_edge_radius:new n.cj(h),u_width_scale:new n.cj(h),u_ao:new n.ck(h),u_height_type:new n.ch(h),u_base_type:new n.ch(h),u_tile_id:new n.ci(h),u_zoom_transition:new n.cj(h),u_inv_rot_matrix:new n.cl(h),u_merc_center:new n.ck(h),u_up_dir:new n.ci(h),u_height_lift:new n.cj(h),u_image:new n.ch(h),u_texsize:new n.ck(h),u_pixel_coord_upper:new n.ck(h),u_pixel_coord_lower:new n.ck(h),u_tile_units_to_pixels:new n.cj(h),u_opacity:new n.cj(h),u_pattern_transition:new n.cj(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new n.cl(h),u_opacity:new n.cj(h),u_ao_pass:new n.cj(h),u_meter_to_tile:new n.cj(h),u_ao:new n.ck(h),u_flood_light_intensity:new n.cj(h),u_flood_light_color:new n.ci(h),u_attenuation:new n.cj(h),u_edge_radius:new n.cj(h),u_fb:new n.ch(h),u_fb_size:new n.cj(h),u_dynamic_offset:new n.cj(h)}),fill:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_ground_shadow_factor:new n.ci(h)}),fillPattern:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_image:new n.ch(h),u_texsize:new n.ck(h),u_pixel_coord_upper:new n.ck(h),u_pixel_coord_lower:new n.ck(h),u_tile_units_to_pixels:new n.cj(h),u_ground_shadow_factor:new n.ci(h),u_pattern_transition:new n.cj(h)}),fillOutline:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_world:new n.ck(h),u_ground_shadow_factor:new n.ci(h)}),fillOutlinePattern:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_world:new n.ck(h),u_image:new n.ch(h),u_texsize:new n.ck(h),u_pixel_coord_upper:new n.ck(h),u_pixel_coord_lower:new n.ck(h),u_tile_units_to_pixels:new n.cj(h),u_ground_shadow_factor:new n.ci(h),u_pattern_transition:new n.cj(h)}),building:h=>({u_matrix:new n.cl(h),u_normal_matrix:new n.cl(h),u_opacity:new n.cj(h),u_faux_facade_ao_intensity:new n.cj(h),u_camera_pos:new n.ci(h),u_tile_to_meter:new n.cj(h),u_facade_emissive_chance:new n.cj(h),u_flood_light_color:new n.ci(h),u_flood_light_intensity:new n.cj(h)}),buildingBloom:h=>({u_matrix:new n.cl(h)}),buildingDepth:h=>({u_matrix:new n.cl(h)}),elevatedStructuresDepth:h=>({u_matrix:new n.cl(h),u_depth_bias:new n.cj(h)}),elevatedStructures:h=>({u_matrix:new n.cl(h),u_ground_shadow_factor:new n.ci(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new n.cl(h),u_camera_pos:new n.ci(h),u_depth_bias:new n.cj(h),u_height_scale:new n.cj(h),u_reset_depth:new n.cj(h)}),circle:n.dY,collisionBox:h=>({u_matrix:new n.cl(h),u_inv_rot_matrix:new n.cl(h),u_camera_to_center_distance:new n.cj(h),u_extrude_scale:new n.ck(h),u_zoom_transition:new n.cj(h),u_merc_center:new n.ck(h),u_tile_id:new n.ci(h)}),collisionCircle:h=>({u_matrix:new n.cl(h),u_inv_matrix:new n.cl(h),u_camera_to_center_distance:new n.cj(h),u_viewport_size:new n.ck(h)}),debug:h=>({u_color:new n.dB(h),u_matrix:new n.cl(h),u_overlay:new n.ch(h),u_overlay_scale:new n.cj(h)}),clippingMask:h=>({u_matrix:new n.cl(h)}),heatmap:h=>({u_extrude_scale:new n.cj(h),u_intensity:new n.cj(h),u_matrix:new n.cl(h),u_inv_rot_matrix:new n.cl(h),u_merc_center:new n.ck(h),u_tile_id:new n.ci(h),u_zoom_transition:new n.cj(h),u_up_dir:new n.ci(h)}),heatmapTexture:h=>({u_image:new n.ch(h),u_color_ramp:new n.ch(h),u_opacity:new n.cj(h)}),hillshade:h=>({u_matrix:new n.cl(h),u_image:new n.ch(h),u_latrange:new n.ck(h),u_light:new n.ck(h),u_shadow:new n.dB(h),u_highlight:new n.dB(h),u_emissive_strength:new n.cj(h),u_accent:new n.dB(h)}),hillshadePrepare:h=>({u_matrix:new n.cl(h),u_image:new n.ch(h),u_dimension:new n.ck(h),u_zoom:new n.cj(h)}),line:n.dX,linePattern:n.dW,raster:h=>({u_matrix:new n.cl(h),u_normalize_matrix:new n.cl(h),u_globe_matrix:new n.cl(h),u_merc_matrix:new n.cl(h),u_grid_matrix:new n.dC(h),u_tl_parent:new n.ck(h),u_scale_parent:new n.cj(h),u_fade_t:new n.cj(h),u_opacity:new n.cj(h),u_image0:new n.ch(h),u_image1:new n.ch(h),u_brightness_low:new n.cj(h),u_brightness_high:new n.cj(h),u_saturation_factor:new n.cj(h),u_contrast_factor:new n.cj(h),u_spin_weights:new n.ci(h),u_perspective_transform:new n.ck(h),u_raster_elevation:new n.cj(h),u_zoom_transition:new n.cj(h),u_merc_center:new n.ck(h),u_cutoff_params:new n.d3(h),u_colorization_mix:new n.d3(h),u_colorization_offset:new n.cj(h),u_color_ramp:new n.ch(h),u_texture_offset:new n.ck(h),u_texture_res:new n.ck(h),u_emissive_strength:new n.cj(h)}),rasterParticle:h=>({u_matrix:new n.cl(h),u_normalize_matrix:new n.cl(h),u_globe_matrix:new n.cl(h),u_merc_matrix:new n.cl(h),u_grid_matrix:new n.dC(h),u_tl_parent:new n.ck(h),u_scale_parent:new n.cj(h),u_fade_t:new n.cj(h),u_opacity:new n.cj(h),u_image0:new n.ch(h),u_image1:new n.ch(h),u_raster_elevation:new n.cj(h),u_zoom_transition:new n.cj(h),u_merc_center:new n.ck(h),u_cutoff_params:new n.d3(h)}),rasterParticleTexture:h=>({u_texture:new n.ch(h),u_opacity:new n.cj(h)}),rasterParticleDraw:h=>({u_particle_texture:new n.ch(h),u_particle_texture_side_len:new n.cj(h),u_tile_offset:new n.ck(h),u_velocity:new n.ch(h),u_color_ramp:new n.ch(h),u_velocity_res:new n.ck(h),u_max_speed:new n.cj(h),u_uv_offset:new n.ck(h),u_data_scale:new n.ck(h),u_data_offset:new n.cj(h),u_particle_pos_scale:new n.cj(h),u_particle_pos_offset:new n.ck(h)}),rasterParticleUpdate:h=>({u_particle_texture:new n.ch(h),u_particle_texture_side_len:new n.cj(h),u_velocity:new n.ch(h),u_velocity_res:new n.ck(h),u_max_speed:new n.cj(h),u_speed_factor:new n.cj(h),u_reset_rate:new n.cj(h),u_rand_seed:new n.cj(h),u_uv_offset:new n.ck(h),u_data_scale:new n.ck(h),u_data_offset:new n.cj(h),u_particle_pos_scale:new n.cj(h),u_particle_pos_offset:new n.ck(h)}),symbol:h=>({u_is_size_zoom_constant:new n.ch(h),u_is_size_feature_constant:new n.ch(h),u_size_t:new n.cj(h),u_size:new n.cj(h),u_camera_to_center_distance:new n.cj(h),u_rotate_symbol:new n.ch(h),u_aspect_ratio:new n.cj(h),u_fade_change:new n.cj(h),u_matrix:new n.cl(h),u_label_plane_matrix:new n.cl(h),u_coord_matrix:new n.cl(h),u_is_text:new n.ch(h),u_elevation_from_sea:new n.ch(h),u_pitch_with_map:new n.ch(h),u_texsize:new n.ck(h),u_texsize_icon:new n.ck(h),u_texture:new n.ch(h),u_texture_icon:new n.ch(h),u_gamma_scale:new n.cj(h),u_device_pixel_ratio:new n.cj(h),u_tile_id:new n.ci(h),u_zoom_transition:new n.cj(h),u_inv_rot_matrix:new n.cl(h),u_merc_center:new n.ck(h),u_camera_forward:new n.ci(h),u_tile_matrix:new n.cl(h),u_up_vector:new n.ci(h),u_ecef_origin:new n.ci(h),u_is_halo:new n.ch(h),u_icon_transition:new n.cj(h),u_color_adj_mat:new n.cl(h),u_scale_factor:new n.cj(h),u_ground_shadow_factor:new n.ci(h),u_inv_matrix:new n.cl(h),u_normal_scale:new n.cj(h),u_lutTexture:new n.ch(h)}),background:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_opacity:new n.cj(h),u_color:new n.dB(h)}),backgroundPattern:h=>({u_matrix:new n.cl(h),u_emissive_strength:new n.cj(h),u_opacity:new n.cj(h),u_image:new n.ch(h),u_pattern_tl:new n.ck(h),u_pattern_br:new n.ck(h),u_texsize:new n.ck(h),u_pattern_size:new n.ck(h),u_pixel_coord_upper:new n.ck(h),u_pixel_coord_lower:new n.ck(h),u_pattern_units_to_pixels:new n.ck(h)}),terrainRaster:h=>({u_matrix:new n.cl(h),u_image0:new n.ch(h),u_image1:new n.ch(h),u_skirt_height:new n.cj(h),u_ground_shadow_factor:new n.ci(h),u_emissive_texture_available:new n.cj(h)}),skybox:h=>({u_matrix:new n.cl(h),u_sun_direction:new n.ci(h),u_cubemap:new n.ch(h),u_opacity:new n.cj(h),u_temporal_offset:new n.cj(h)}),skyboxGradient:h=>({u_matrix:new n.cl(h),u_color_ramp:new n.ch(h),u_center_direction:new n.ci(h),u_radius:new n.cj(h),u_opacity:new n.cj(h),u_temporal_offset:new n.cj(h)}),skyboxCapture:h=>({u_matrix_3f:new n.dC(h),u_sun_direction:new n.ci(h),u_sun_intensity:new n.cj(h),u_color_tint_r:new n.d3(h),u_color_tint_m:new n.d3(h),u_luminance:new n.cj(h)}),globeRaster:h=>({u_proj_matrix:new n.cl(h),u_globe_matrix:new n.cl(h),u_normalize_matrix:new n.cl(h),u_merc_matrix:new n.cl(h),u_zoom_transition:new n.cj(h),u_merc_center:new n.ck(h),u_image0:new n.ch(h),u_image1:new n.ch(h),u_grid_matrix:new n.dC(h),u_skirt_height:new n.cj(h),u_far_z_cutoff:new n.cj(h),u_frustum_tl:new n.ci(h),u_frustum_tr:new n.ci(h),u_frustum_br:new n.ci(h),u_frustum_bl:new n.ci(h),u_globe_pos:new n.ci(h),u_globe_radius:new n.cj(h),u_viewport:new n.ck(h),u_emissive_texture_available:new n.cj(h)}),globeAtmosphere:h=>({u_frustum_tl:new n.ci(h),u_frustum_tr:new n.ci(h),u_frustum_br:new n.ci(h),u_frustum_bl:new n.ci(h),u_horizon:new n.cj(h),u_transition:new n.cj(h),u_fadeout_range:new n.cj(h),u_atmosphere_fog_color:new n.d3(h),u_high_color:new n.d3(h),u_space_color:new n.d3(h),u_temporal_offset:new n.cj(h),u_horizon_angle:new n.cj(h)}),model:h=>({u_matrix:new n.cl(h),u_lighting_matrix:new n.cl(h),u_normal_matrix:new n.cl(h),u_node_matrix:new n.cl(h),u_lightpos:new n.ci(h),u_lightintensity:new n.cj(h),u_lightcolor:new n.ci(h),u_camera_pos:new n.ci(h),u_opacity:new n.cj(h),u_baseColorFactor:new n.d3(h),u_emissiveFactor:new n.d3(h),u_metallicFactor:new n.cj(h),u_roughnessFactor:new n.cj(h),u_baseTextureIsAlpha:new n.ch(h),u_alphaMask:new n.ch(h),u_alphaCutoff:new n.cj(h),u_baseColorTexture:new n.ch(h),u_metallicRoughnessTexture:new n.ch(h),u_normalTexture:new n.ch(h),u_occlusionTexture:new n.ch(h),u_emissionTexture:new n.ch(h),u_lutTexture:new n.ch(h),u_color_mix:new n.d3(h),u_aoIntensity:new n.cj(h),u_emissive_strength:new n.cj(h),u_occlusionTextureTransform:new n.d3(h)}),modelDepth:h=>({u_matrix:new n.cl(h),u_instance:new n.cl(h),u_node_matrix:new n.cl(h)}),groundShadow:h=>({u_matrix:new n.cl(h),u_ground_shadow_factor:new n.ci(h)}),stars:h=>({u_matrix:new n.cl(h),u_up:new n.ci(h),u_right:new n.ci(h),u_intensity_multiplier:new n.cj(h)}),snowParticle:h=>({u_modelview:new n.cl(h),u_projection:new n.cl(h),u_time:new n.cj(h),u_cam_pos:new n.ci(h),u_velocityConeAperture:new n.cj(h),u_velocity:new n.cj(h),u_horizontalOscillationRadius:new n.cj(h),u_horizontalOscillationRate:new n.cj(h),u_boxSize:new n.cj(h),u_billboardSize:new n.cj(h),u_simpleShapeParameters:new n.ck(h),u_screenSize:new n.ck(h),u_thinningCenterPos:new n.ck(h),u_thinningShape:new n.ci(h),u_thinningAffectedRatio:new n.cj(h),u_thinningParticleOffset:new n.cj(h),u_particleColor:new n.d3(h),u_direction:new n.ci(h)}),rainParticle:h=>({u_modelview:new n.cl(h),u_projection:new n.cl(h),u_time:new n.cj(h),u_cam_pos:new n.ci(h),u_texScreen:new n.ch(h),u_velocityConeAperture:new n.cj(h),u_velocity:new n.cj(h),u_boxSize:new n.cj(h),u_rainDropletSize:new n.ck(h),u_distortionStrength:new n.cj(h),u_rainDirection:new n.ci(h),u_color:new n.d3(h),u_screenSize:new n.ck(h),u_thinningCenterPos:new n.ck(h),u_thinningShape:new n.ci(h),u_thinningAffectedRatio:new n.cj(h),u_thinningParticleOffset:new n.cj(h),u_shapeDirectionalPower:new n.cj(h),u_shapeNormalPower:new n.cj(h),u_mode:new n.cj(h)}),vignette:h=>({u_vignetteShape:new n.ci(h),u_vignetteColor:new n.d3(h)}),occlusion:h=>({u_matrix:new n.cl(h),u_anchorPos:new n.ci(h),u_screenSizePx:new n.ck(h),u_occluderSizePx:new n.ck(h),u_color:new n.d3(h)})};class Nl{constructor(t,a,d,y){this.id=Nl.uniqueIdxCounter,Nl.uniqueIdxCounter++,this.context=t;const b=t.gl;this.buffer=b.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||y||a.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Nl.uniqueIdxCounter,Nl.uniqueIdxCounter++;const a=this.context.gl;this.context.unbindVAO(),this.bind(),a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Nl.uniqueIdxCounter=0;const Jc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hl{constructor(t,a,d,y,b,S){this.length=a.length,this.attributes=d,this.itemSize=a.bytesPerElement,this.dynamicDraw=y,this.instanceCount=S,this.context=t;const M=t.gl;this.buffer=M.createBuffer(),t.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,a.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||b||a.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const a=this.context.gl;this.bind(),a.bufferSubData(a.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,a){for(let d=0;d<this.attributes.length;d++){const y=a.getAttributeLocation(t,this.attributes[d].name);y!==-1&&t.enableVertexAttribArray(y)}}setVertexAttribPointers(t,a,d){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],S=a.getAttributeLocation(t,b.name);S!==-1&&t.vertexAttribPointer(S,b.components,t[Jc[b.type]],!1,this.itemSize,b.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,a,d){for(let y=0;y<this.attributes.length;y++){const b=a.getAttributeLocation(t,this.attributes[y].name);b!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(b,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Cs{constructor(t,a,d,y,b){this.context=t,this.width=a,this.height=d;const S=this.framebuffer=t.gl.createFramebuffer();y>0&&(this.colorAttachment0=new md(t,S,0)),y>1&&(this.colorAttachment1=new md(t,S,1)),b&&(this.depthAttachmentType=b,this.depthAttachment=b==="renderbuffer"?new Uh(t,S):new nf(t,S))}createColorAttachment(t,a){a===0?this.colorAttachment0=new md(t,this.framebuffer,0):a===1&&(this.colorAttachment1=new md(t,this.framebuffer,1))}removeColorAttachment(t,a){const d=this.context.gl;let y;a===0?(y=this.colorAttachment0.get(),this.colorAttachment0=void 0):a===1&&(y=this.colorAttachment1.get(),this.colorAttachment1=void 0),y&&d.deleteTexture(y)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const a=this.colorAttachment0.get();a&&t.deleteTexture(a)}if(this.colorAttachment1){const a=this.colorAttachment1.get();a&&t.deleteTexture(a)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const a=this.depthAttachment.get();a&&t.deleteRenderbuffer(a)}else{const a=this.depthAttachment.get();a&&t.deleteTexture(a)}t.deleteFramebuffer(this.framebuffer)}}class bu{constructor(t,a){this.gl=t,this.clearColor=new sl(this),this.clearDepth=new Bl(this),this.clearStencil=new Vu(this),this.colorMask=new Rf(this),this.depthMask=new Qd(this),this.stencilMask=new lh(this),this.stencilFunc=new Nh(this),this.stencilOp=new mo(this),this.stencilTest=new ja(this),this.depthRange=new fn(this),this.depthTest=new Wc(this),this.depthFunc=new fc(this),this.blend=new Vh(this),this.blendFunc=new Ql(this),this.blendColor=new ch(this),this.blendEquation=new ef(this),this.cullFace=new Ia(this),this.cullFaceSide=new Yc(this),this.frontFace=new tp(this),this.program=new fd(this),this.activeTexture=new ip(this),this.viewport=new Fl(this),this.bindFramebuffer=new Uu(this),this.bindRenderbuffer=new uh(this),this.bindTexture=new hh(this),this.bindVertexBuffer=new zp(this),this.bindElementBuffer=new zd(this),this.bindVertexArrayOES=new pd(this),this.pixelStoreUnpack=new tf(this),this.pixelStoreUnpackPremultiplyAlpha=new Wo(this),this.pixelStoreUnpackFlipY=new ka(this),this.options=a?Object.assign({},a):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=a&&!!a.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,a,d){return new Nl(this,t,a,d)}createVertexBuffer(t,a,d,y,b){return new hl(this,t,a,d,y,b)}createRenderbuffer(t,a,d){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,t,a,d),this.bindRenderbuffer.set(null),b}createFramebuffer(t,a,d,y){return new Cs(this,t,a,d,y)}clear({color:t,depth:a,stencil:d,colorMask:y}){const b=this.gl;let S=0;t&&(S|=b.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),a!==void 0&&(S|=b.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(a),this.depthMask.set(!0)),d!==void 0&&(S|=b.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),b.clear(S)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.by(t.blendFunction,cr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Vl;function di(h,t,a,d,y,b,S){const M=h.context,R=M.gl,N=h.transform,U=[n.aF(N.center.lng),n.aJ(N.center.lat)],Y=a.layout.get("symbol-placement"),X=a.layout.get("text-variable-anchor"),Q=a.layout.get("icon-rotation-alignment")==="map",ae=a.layout.get("text-rotation-alignment")==="map",ie=Y!=="point",_e=[];let fe=0,Te=0;for(let Oe=0;Oe<d.length;Oe++){const it=d[Oe],ft=t.getTile(it),ht=ft.getBucket(a);if(!ht)continue;const St=ht.getProjection().createInversionMatrix(N,it.canonical),It=[],zt=ns(it,ht,N),Jt=!S&&Q&&ie,gt=S&&ae&&ie,nt=X&&ht.hasTextData(),Bt=ht.hasIconTextFit()&&nt&&ht.hasIconData(),Dt=Jt||gt||S&&nt||Bt,li=ht.projection.name==="globe",Ei=li?n.aj(N.zoom):0;li&&(It.push("PROJECTION_GLOBE_VIEW"),Dt&&It.push("PROJECTED_POS_ON_VIEWPORT"));const Ri=h.getOrCreateProgram("collisionBox",{defines:It});let Ti=zt;y[0]===0&&y[1]===0||(Ti=h.translatePosMatrix(zt,ft,y,b));const mi=S?ht.textCollisionBox:ht.iconCollisionBox,pn=ht.collisionCircleArray;if(pn.length>0){const ji=n.bC(),Qi=Ti;n.cP(ji,ht.placementInvProjMatrix,N.glCoordMatrix),n.cP(ji,ji,ht.placementViewportMatrix),_e.push({circleArray:pn,circleOffset:Te,transform:Qi,invTransform:ji,projection:ht.getProjection()}),fe+=pn.length/4,Te=fe}if(!mi)continue;h.terrain&&h.terrain.setupElevationDraw(ft,Ri);const en=li?[it.canonical.x,it.canonical.y,1<<it.canonical.z]:[0,0,0];Ri.draw(h,R.LINES,xn.disabled,Un.disabled,h.colorModeForRenderPass(),jn.disabled,Zn(Ti,St,N,Ei,U,ft,en,ht.getProjection()),a.id,mi.layoutVertexBuffer,mi.indexBuffer,mi.segments,null,N.zoom,null,[mi.collisionVertexBuffer,mi.collisionVertexBufferExt])}if(!S||!_e.length)return;const De=h.getOrCreateProgram("collisionCircle"),Se=new n.dZ;Se.resize(4*fe),Se._trim();let Ze=0;for(const Oe of _e)for(let it=0;it<Oe.circleArray.length/4;it++){const ft=4*it,ht=Oe.circleArray[ft+0],St=Oe.circleArray[ft+1],It=Oe.circleArray[ft+2],zt=Oe.circleArray[ft+3];Se.emplace(Ze++,ht,St,It,zt,0),Se.emplace(Ze++,ht,St,It,zt,1),Se.emplace(Ze++,ht,St,It,zt,2),Se.emplace(Ze++,ht,St,It,zt,3)}(!Vl||Vl.length<2*fe)&&(Vl=(function(Oe){const it=2*Oe,ft=new n.b0;ft.resize(it),ft._trim();for(let ht=0;ht<it;ht++){const St=6*ht;ft.uint16[St+0]=4*ht+0,ft.uint16[St+1]=4*ht+1,ft.uint16[St+2]=4*ht+2,ft.uint16[St+3]=4*ht+2,ft.uint16[St+4]=4*ht+3,ft.uint16[St+5]=4*ht+0}return ft})(fe));const Ve=M.createIndexBuffer(Vl,!0),Ge=M.createVertexBuffer(Se,n.d_.members,!0);for(const Oe of _e){const it={u_matrix:Oe.transform,u_inv_matrix:Oe.invTransform,u_camera_to_center_distance:(Fe=N).getCameraToCenterDistance(Oe.projection),u_viewport_size:[Fe.width,Fe.height]};De.draw(h,R.TRIANGLES,xn.disabled,Un.disabled,h.colorModeForRenderPass(),jn.disabled,it,a.id,Ge,Ve,n.bg.simpleSegment(0,2*Oe.circleOffset,Oe.circleArray.length,Oe.circleArray.length/2),null,N.zoom)}var Fe;Ge.destroy(),Ve.destroy()}const Oa=n.bC();function fs(h){const t=h._camera.getWorldToCamera(h.worldSize,1),a=n.aB([],t,h.globeMatrix);n.bl(a,a);const d=[0,0,0],y=[0,1,0,0];return n.aC(y,y,a),d[0]=y[0],d[1]=y[1],d[2]=y[2],n.aw(d,d),d}function Yo({width:h,height:t,anchor:a,textOffset:d,textScale:y},b){const{horizontalAlign:S,verticalAlign:M}=n.c1(a),R=-(S-.5)*h,N=-(M-.5)*t,U=n.c2(a,d);return new n.P((R/y+U[0])*b,(N/y+U[1])*b)}function mn(h,t,a,d,y,b,S,M,R,N){const U=h.text.placedSymbolArray,Y=h.text.dynamicLayoutVertexArray,X=h.icon.dynamicLayoutVertexArray,Q={},ae=h.getProjection(),ie=Dl(S,ae,y),_e=y.elevation,fe=ae.upVectorScale(S.canonical,y.center.lat,y.worldSize).metersToTile;Y.clear();for(let Te=0;Te<U.length;Te++){const De=U.get(Te),{tileAnchorX:Se,tileAnchorY:Ze,numGlyphs:Ve}=De,Ge=De.hidden||!De.crossTileID||h.allowVerticalPlacement&&!De.placedOrientation?null:d[De.crossTileID];if(Ge){let Fe=0,Oe=0,it=0;const ft=h.elevationType==="road";if(_e||ft){const Dt=ft?h.getElevationFeatureForText(Te):null,li=n.bV.getAtTileOffset(S,new n.P(Se,Ze),_e,Dt),[Ei,Ri,Ti]=ae.upVector(S.canonical,Se,Ze);Fe=li*Ei*fe,Oe=li*Ri*fe,it=li*Ti*fe}let[ht,St,It,zt]=qc(De.projectedAnchorX+Fe,De.projectedAnchorY+Oe,De.projectedAnchorZ+it,a?ie:b);const Jt=Ta(y.getCameraToCenterDistance(ae),zt);let gt=n.bM(h.textSizeData,R,De)*Jt/n.bY;a&&(gt*=h.tilePixelRatio/M);const nt=Yo(Ge,gt);a?({x:ht,y:St,z:It}=ae.projectTilePoint(Se+nt.x,Ze+nt.y,S.canonical),[ht,St,It]=qc(ht+Fe,St+Oe,It+it,b)):(t&&nt._rotate(-y.angle),ht+=nt.x,St+=nt.y,It=0);const Bt=h.allowVerticalPlacement&&De.placedOrientation===n.bL.vertical?Math.PI/2:0;for(let Dt=0;Dt<Ve;Dt++)n.bO(Y,ht,St,It,Bt);N&&De.associatedIconIndex>=0&&(Q[De.associatedIconIndex]={x:ht,y:St,z:It,angle:Bt})}else Dc(Ve,Y)}if(N){X.clear();const Te=h.icon.placedSymbolArray;for(let De=0;De<Te.length;De++){const Se=Te.get(De),{numGlyphs:Ze}=Se,Ve=Q[De];if(Se.hidden||!Ve)Dc(Ze,X);else{const{x:Ge,y:Fe,z:Oe,angle:it}=Ve;for(let ft=0;ft<Ze;ft++)n.bO(X,Ge,Fe,Oe,it)}}h.icon.dynamicLayoutVertexBuffer.updateData(X)}h.text.dynamicLayoutVertexBuffer.updateData(Y)}function _o(h,t,a,d,y,b,S={}){const M=a.paint.get("icon-translate"),R=a.paint.get("text-translate"),N=a.paint.get("icon-translate-anchor"),U=a.paint.get("text-translate-anchor"),Y=a.layout.get("icon-rotation-alignment"),X=a.layout.get("text-rotation-alignment"),Q=a.layout.get("icon-pitch-alignment"),ae=a.layout.get("text-pitch-alignment"),ie=a.layout.get("icon-keep-upright"),_e=a.layout.get("text-keep-upright"),fe=a.paint.get("icon-color-saturation"),Te=a.paint.get("icon-color-contrast"),De=a.paint.get("icon-color-brightness-min"),Se=a.paint.get("icon-color-brightness-max"),Ze=a.layout.get("symbol-elevation-reference")==="sea",Ve=a.layout.get("icon-image-use-theme")==="none",Ge=h.context,Fe=Ge.gl,Oe=h.transform,it=Y==="map",ft=X==="map",ht=Q==="map",St=ae==="map",It=a.layout.get("symbol-sort-key").constantOr(1)!==void 0;let zt=!1;const Jt=h.depthModeForSublayer(0,xn.ReadOnly),gt=new xn(h.context.gl.LEQUAL,xn.ReadOnly,h.depthRangeFor3D),nt=[n.aF(Oe.center.lng),n.aJ(Oe.center.lat)],Bt=a.layout.get("text-variable-anchor"),Dt=Oe.projection.name==="globe",li=[],Ei=[0,-1,0];for(const Ri of d){const Ti=t.getTile(Ri),mi=Ti.getBucket(a);if(!mi||mi.projection.name==="mercator"&&Dt||mi.fullyClipped)continue;const pn=mi.projection.name==="globe",en=pn?n.aj(Oe.zoom):0,ji=Dl(Ri,mi.getProjection(),Oe),Qi=Oe.calculatePixelsToTileUnitsMatrix(Ti),vn=Bt&&mi.hasTextData(),rr=mi.hasIconTextFit()&&vn&&mi.hasIconData(),Br=mi.getProjection().createInversionMatrix(Oe,Ri.canonical),ba=(1<<Ti.tileID.canonical.z)*n.al/h.transform.worldSize,_n=ya=>{let Sr=[0,0,0];if(ya){const gr=h.style.directionalLight,fa=h.style.ambientLight;gr&&fa&&(Sr=Lc(h.style,gr,fa))}return Sr},aa=ya=>{Oe.depthOcclusionForSymbolsAndCircles&&(a.hasOcclusionOpacityProperties||h.terrain)&&(ya.push("DEPTH_D24"),ya.push("DEPTH_OCCLUSION"))},Qn=ya=>{a.lut&&!Ve&&(a.lut.texture||(a.lut.texture=new n.d$(h.context,a.lut.image,[a.lut.image.height,a.lut.image.height,a.lut.image.height],Ge.gl.RGBA8)),Ge.activeTexture.set(Ge.gl.TEXTURE0+ds.LUT),a.lut.texture&&a.lut.texture.bind(Ge.gl.LINEAR,Ge.gl.CLAMP_TO_EDGE),ya.push("APPLY_LUT_ON_GPU"))},yr=()=>{const ya=it&&a.layout.get("symbol-placement")!=="point",Sr=[];aa(Sr),Qn(Sr);const gr=ya||rr,fa=mi.elevationType==="road",bs=h.shadowRenderer,ws=fa&&ht&&!!bs&&bs.enabled,qa=_n(ws),Bo=fa&&ht&&!h.terrain?gt:Jt,Qo=a.paint.get("icon-image-cross-fade");h.terrainRenderModeElevated()&&ht&&Sr.push("PITCH_WITH_MAP_TERRAIN"),pn&&(Sr.push("PROJECTION_GLOBE_VIEW"),gr&&Sr.push("PROJECTED_POS_ON_VIEWPORT")),Qo>0&&mi.hasAnySecondaryIcon&&Sr.push("ICON_TRANSITION"),!mi.icon.zOffsetVertexBuffer||fa&&h.terrain||Sr.push("Z_OFFSET"),fe===0&&Te===0&&De===0&&Se===1||Sr.push("COLOR_ADJUSTMENT"),mi.sdfIcons&&Sr.push("RENDER_SDF"),ws&&Sr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),fa&&ht&&!h.terrain&&mi.icon.orientationVertexBuffer&&Sr.push("ELEVATED_ROADS");const oo=mi.icon.programConfigurations.get(a.id),Ho=h.getOrCreateProgram("symbol",{config:oo,defines:Sr}),jl=Ti.imageAtlasTexture?Ti.imageAtlasTexture.size:[0,0],fl=mi.iconSizeData,eu=n.bK(fl,Oe.zoom),Yu=ht||!Oe.isOrthographic,ic=Rl(ji,Ti.tileID.canonical,ht,it,Oe,mi.getProjection(),Qi),Fs=Id(ji,Ti.tileID.canonical,ht,it,Oe,mi.getProjection(),Qi),lo=h.translatePosMatrix(Fs,Ti,M,N,!0),Na=h.translatePosMatrix(ji,Ti,M,N),Ns=gr?Oa:ic,zs=it&&!ht&&!ya;let Ts=Ei;!Dt&&!Oe.mercatorFromTransition||it||(Ts=fs(Oe));const nc=pn?Ts:Ei,Ud=a.getColorAdjustmentMatrix(fe,Te,De,Se),Ku=mc(fl.kind,eu,zs,ht,h,Na,Ns,lo,Ze,!1,jl,[0,0],0,Ri,en,nt,Br,nc,mi.getProjection(),qa,ba,Ud,Qo,null),vf=Ti.imageAtlasTexture?Ti.imageAtlasTexture:null,Wh=a.layout.get("icon-size").constantOr(0)!==1||mi.iconsNeedLinear,vh=mi.sdfIcons||h.options.rotating||h.options.zooming||Wh||Yu?Fe.LINEAR:Fe.NEAREST,bh=mi.sdfIcons&&a.paint.get("icon-halo-width").constantOr(1)!==0,bf=h.terrain&&ht&&ya?n.bl(n.bC(),ic):Oa;if(ya&&mi.icon){const el=n.bV.getAtTileOffsetFunc(Ri,Oe.center.lat,Oe.worldSize,mi.getProjection()),Iu=Ad(ji,Ti.tileID.canonical,ht,it,Oe,mi.getProjection(),Qi),Ju=a.layout.get("icon-size-scale-range"),cs=n.aA(h.scaleFactor,Ju[0],Ju[1]);Ip(mi,ji,h,!1,Iu,Fs,ht,ie,el,Ri,cs)}return{program:Ho,buffers:mi.icon,uniformValues:Ku,atlasTexture:vf,atlasTextureIcon:null,atlasInterpolation:vh,atlasInterpolationIcon:null,isSDF:mi.sdfIcons,hasHalo:bh,depthMode:Bo,tile:Ti,renderWithShadows:ws,labelPlaneMatrixInv:bf}},Gr=()=>{const ya=ft&&a.layout.get("symbol-placement")!=="point",Sr=[],gr=ya||Bt||rr,fa=mi.elevationType==="road",bs=h.shadowRenderer,ws=fa&&St&&!!bs&&bs.enabled,qa=_n(ws),Bo=fa&&St&&!h.terrain?gt:Jt;h.terrainRenderModeElevated()&&St&&Sr.push("PITCH_WITH_MAP_TERRAIN"),pn&&(Sr.push("PROJECTION_GLOBE_VIEW"),gr&&Sr.push("PROJECTED_POS_ON_VIEWPORT")),!mi.text.zOffsetVertexBuffer||fa&&h.terrain||Sr.push("Z_OFFSET"),mi.iconsInText&&Sr.push("RENDER_TEXT_AND_SYMBOL"),Sr.push("RENDER_SDF"),ws&&Sr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),fa&&St&&!h.terrain&&mi.text.orientationVertexBuffer&&Sr.push("ELEVATED_ROADS"),aa(Sr);const Qo=mi.text.programConfigurations.get(a.id),oo=h.getOrCreateProgram("symbol",{config:Qo,defines:Sr});let Ho,jl=[0,0],fl=null;const eu=mi.textSizeData;mi.iconsInText&&(jl=Ti.imageAtlasTexture?Ti.imageAtlasTexture.size:[0,0],fl=Ti.imageAtlasTexture?Ti.imageAtlasTexture:null,Ho=St||!Oe.isOrthographic||h.options.rotating||h.options.zooming||eu.kind==="composite"||eu.kind==="camera"?Fe.LINEAR:Fe.NEAREST);const Yu=Ti.glyphAtlasTexture?Ti.glyphAtlasTexture.size:[0,0],ic=a.layout.get("text-size-scale-range"),Fs=n.aA(h.scaleFactor,ic[0],ic[1]),lo=n.bK(eu,Oe.zoom,Fs),Na=Rl(ji,Ti.tileID.canonical,St,ft,Oe,mi.getProjection(),Qi),Ns=Id(ji,Ti.tileID.canonical,St,ft,Oe,mi.getProjection(),Qi),zs=h.translatePosMatrix(Ns,Ti,R,U,!0),Ts=h.translatePosMatrix(ji,Ti,R,U),nc=gr?Oa:Na,Ud=ft&&!St&&!ya;let Ku=Ei;!Dt&&!Oe.mercatorFromTransition||ft||(Ku=fs(Oe));const vf=mc(eu.kind,lo,Ud,St,h,Ts,nc,zs,Ze,!0,Yu,jl,0,Ri,en,nt,Br,pn?Ku:Ei,mi.getProjection(),qa,ba,null,null,Fs),Wh=Ti.glyphAtlasTexture?Ti.glyphAtlasTexture:null,vh=Fe.LINEAR,bh=a.paint.get("text-halo-width").constantOr(1)!==0,bf=h.terrain&&St&&ya?n.bl(n.bC(),Na):Oa;if(ya&&mi.text){const el=n.bV.getAtTileOffsetFunc(Ri,Oe.center.lat,Oe.worldSize,mi.getProjection()),Iu=Ad(ji,Ti.tileID.canonical,St,ft,Oe,mi.getProjection(),Qi);Ip(mi,ji,h,!0,Iu,Ns,St,_e,el,Ri,Fs)}return{program:oo,buffers:mi.text,uniformValues:vf,atlasTexture:Wh,atlasTextureIcon:fl,atlasInterpolation:vh,atlasInterpolationIcon:Ho,isSDF:!0,hasHalo:bh,depthMode:Bo,tile:Ti,renderWithShadows:ws,labelPlaneMatrixInv:bf}},Kr=mi.icon.segments.get().length,qr=mi.text.segments.get().length,mr=Kr&&!S.onlyText?yr():null,wa=qr&&!S.onlyIcons?Gr():null,Bs=a.paint.get("icon-opacity").constantOr(1),Ga=a.paint.get("text-opacity").constantOr(1);if(It&&mi.canOverlap){zt=!0;const ya=Bs&&!S.onlyText?mi.icon.segments.get():[],Sr=Ga&&!S.onlyIcons?mi.text.segments.get():[];for(const gr of ya)li.push({segments:new n.bg([gr]),sortKey:gr.sortKey,state:mr});for(const gr of Sr)li.push({segments:new n.bg([gr]),sortKey:gr.sortKey,state:wa})}else S.onlyText||li.push({segments:Bs?mi.icon.segments:new n.bg([]),sortKey:0,state:mr}),S.onlyIcons||li.push({segments:Ga?mi.text.segments:new n.bg([]),sortKey:0,state:wa})}zt&&li.sort(((Ri,Ti)=>Ri.sortKey-Ti.sortKey));for(const Ri of li){const Ti=Ri.state;if(Ti)if(h.terrain?h.terrain.setupElevationDraw(Ti.tile,Ti.program,{useDepthForOcclusion:Oe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ti.labelPlaneMatrixInv}):h.setupDepthForOcclusion(Oe.depthOcclusionForSymbolsAndCircles,Ti.program),Ge.activeTexture.set(Fe.TEXTURE0),Ti.atlasTexture&&Ti.atlasTexture.bind(Ti.atlasInterpolation,Fe.CLAMP_TO_EDGE,!0),Ti.atlasTextureIcon&&(Ge.activeTexture.set(Fe.TEXTURE1),Ti.atlasTextureIcon&&Ti.atlasTextureIcon.bind(Ti.atlasInterpolationIcon,Fe.CLAMP_TO_EDGE,!0)),Ti.renderWithShadows&&h.shadowRenderer.setupShadows(Ti.tile.tileID.toUnwrapped(),Ti.program,"vector-tile"),h.uploadCommonLightUniforms(h.context,Ti.program),Ti.hasHalo){const mi=Ti.uniformValues;mi.u_is_halo=1,bl(Ti.buffers,Ri.segments,a,h,Ti.program,Ti.depthMode,y,b,mi,2),mi.u_is_halo=0}else{if(Ti.isSDF){const mi=Ti.uniformValues;Ti.hasHalo&&(mi.u_is_halo=1,bl(Ti.buffers,Ri.segments,a,h,Ti.program,Ti.depthMode,y,b,mi,1)),mi.u_is_halo=0}bl(Ti.buffers,Ri.segments,a,h,Ti.program,Ti.depthMode,y,b,Ti.uniformValues,1)}}}function bl(h,t,a,d,y,b,S,M,R,N){const U=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer,h.orientationVertexBuffer];y.draw(d,d.context.gl.TRIANGLES,b,S,M,jn.disabled,R,a.id,h.layoutVertexBuffer,h.indexBuffer,t,a.paint,d.transform.zoom,h.programConfigurations.get(a.id),U,N)}function Ba(h,t){const a=1<<h.canonical.z,d=(t.x*a-h.canonical.x-h.wrap*a)*n.al,y=(t.y*a-h.canonical.y)*n.al,b=n.e8(t.z,t.y);return n.d5(d,y,b)}function gc(h,t,a,d,y){if(!a.layout||a.layout.get("fill-elevation-reference")==="none"||a.paint.get("fill-opacity").constantOr(1)===0)return;const b=h.context.gl,S=new xn(h.context.gl.LEQUAL,xn.ReadWrite,h.depthRangeFor3D),M=new xn(h.context.gl.GREATER,xn.ReadWrite,h.depthRangeFor3D),R=(function(Q){let ae=.01;return Q.isOrthographic&&(ae=n.ak(1e-4,ae,n.d0(Q.pitch>=uc?1:Q.pitch/uc))),2*ae})(h.transform),N=h.transform.getFreeCameraOptions().position,U="elevatedStructuresDepthReconstruct",Y=h.getOrCreateProgram(U,{defines:["DEPTH_RECONSTRUCTION"]}),X=h.getOrCreateProgram(U);for(const Q of d){const ae=t.getTile(Q),ie=ae.getBucket(a);if(!ie)continue;const _e=ie.elevatedStructures;if(!_e)continue;const fe=ie.elevationBufferData.heightRange,Te=Ba(Q.toUnwrapped(),N),De=h.translatePosMatrix(Q.projMatrix,ae,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));let Se,Ze,Ve,Ge;if(y==="initialize"){if(!fe||fe.min>=1||_e.depthSegments.segments[0].primitiveLength===0)continue;Se=oi(De,Te,R,1,0),Ze=S,Ve=_e.depthSegments,Ge=Y}else if(y==="reset"){if(!fe||fe.min>=0||_e.maskSegments.segments[0].primitiveLength===0)continue;Se=oi(De,Te,0,0,1),Ze=M,Ve=_e.maskSegments,Ge=Y}else if(y==="geometry"){if(_e.depthSegments.segments[0].primitiveLength===0)continue;Se=oi(De,Te,R,1,0),Ze=S,Ve=_e.depthSegments,Ge=X}Ge.draw(h,b.TRIANGLES,Ze,Un.disabled,cr.disabled,jn.disabled,Se,a.id,_e.vertexBuffer,_e.indexBuffer,Ve,a.paint,h.transform.zoom)}}function jh(h,t,a,d){const{painter:y,sourceCache:b,layer:S,coords:M,colorMode:R,elevationType:N,terrainEnabled:U,pass:Y}=h,X=y.context.gl,Q=S.paint.get("fill-pattern"),ae=S.paint.get("fill-pattern-cross-fade"),ie=Q.constantOr(null);let _e=N;N!=="road"||t&&!U||(_e="none");const fe=_e==="road",Te=h.painter.shadowRenderer,De=fe&&!!Te&&Te.enabled,Se=new xn(y.context.gl.LEQUAL,xn.ReadOnly,y.depthRangeFor3D);let Ze=[0,0,0];if(De){const Oe=y.style.directionalLight,it=y.style.ambientLight;Oe&&it&&(Ze=Lc(y.style,Oe,it))}const Ve=Q&&Q.constantOr(1),Ge=y.terrain&&y.terrain.renderingToTexture,Fe=(Oe,it)=>{let ft,ht,St,It,zt;it?(ft=Ve&&!S.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",St=X.LINES):(ft=Ve?"fillPattern":"fill",St=X.TRIANGLES);for(const Jt of M){const gt=b.getTile(Jt);if(Ve&&!gt.patternsLoaded())continue;const nt=gt.getBucket(S);if(!nt)continue;const Bt=t?nt.elevationBufferData:nt.bufferData;if(Bt.isEmpty())continue;y.prepareDrawTile();const Dt=Bt.programConfigurations.get(S.id),li=y.isTileAffectedByFog(Jt),Ei=[],Ri=[];fe&&(Ei.push("ELEVATED_ROADS"),Ri.push(Bt.elevatedLayoutVertexBuffer)),De&&Ei.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ge&&a&&Ei.push("USE_MRT1"),Ve&&(y.context.activeTexture.set(X.TEXTURE0),gt.imageAtlasTexture&&gt.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Dt.updatePaintBuffers());let Ti=!1;if(ie&&gt.imageAtlas){const Qi=gt.imageAtlas,vn=n.e3.from(ie),rr=vn.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),Br=vn.getSecondary(),ba=Qi.patternPositions.get(rr),_n=Br?Qi.patternPositions.get(Br.scaleSelf(n.o.devicePixelRatio).toString()):null;Ti=!!ba&&!!_n,ba&&Dt.setConstantPatternPositions(ba,_n)}ae>0&&(Ti||Dt.getPatternTransitionVertexBuffer("fill-pattern"))&&Ei.push("FILL_PATTERN_TRANSITION");const mi=y.getOrCreateProgram(ft,{config:Dt,overrideFog:li,defines:Ei}),pn=y.translatePosMatrix(Jt.projMatrix,gt,S.paint.get("fill-translate"),S.paint.get("fill-translate-anchor"));De&&Te.setupShadows(gt.tileID.toUnwrapped(),mi,"vector-tile");const en=S.paint.get("fill-emissive-strength");if(it){It=Bt.lineIndexBuffer,zt=Bt.lineSegments;const Qi=y.terrain&&y.terrain.renderingToTexture?y.terrain.drapeBufferSize:[X.drawingBufferWidth,X.drawingBufferHeight];ht=ft==="fillOutlinePattern"&&Ve?Ht(pn,en,y,gt,Qi,Ze,ae):_t(pn,en,Qi,Ze)}else It=Bt.indexBuffer,zt=Bt.triangleSegments,ht=Ve?Lt(pn,en,y,gt,Ze,ae):Ct(pn,en,Ze);y.uploadCommonUniforms(y.context,mi,Jt.toUnwrapped());let ji=Oe;(N==="road"&&!U||N==="offset")&&(ji=Se),mi.draw(y,St,ji,d||y.stencilModeForClipping(Jt),R,jn.disabled,ht,S.id,Bt.layoutVertexBuffer,It,zt,S.paint,y.transform.zoom,Dt,Ri)}};y.renderPass===Y&&Fe(y.depthModeForSublayer(1,y.renderPass==="opaque"?xn.ReadWrite:xn.ReadOnly),!1),_e==="none"&&y.renderPass==="translucent"&&S.paint.get("fill-antialias")&&Fe(y.depthModeForSublayer(S.getPaintProperty("fill-outline-color")?2:0,xn.ReadOnly),!0)}function $s(h,t,a,d,y,b,S,M){a.resetLayerRenderingStats(h);const R=h.context,N=R.gl,U=h.transform,Y=a.paint.get("fill-extrusion-pattern"),X=a.paint.get("fill-extrusion-pattern-cross-fade"),Q=Y.constantOr(null),ae=Y.constantOr(1),ie=a.paint.get("fill-extrusion-opacity"),_e=h.style.enable3dLights(),fe=a.paint.get(_e&&!ae?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Te=[a.paint.get("fill-extrusion-ambient-occlusion-intensity"),fe],De=a.layout.get("fill-extrusion-edge-radius"),Se=De>0&&!a.paint.get("fill-extrusion-rounded-roof"),Ze=Se?0:De,Ve=U.projection.name==="globe"?n.eb():0,Ge=U.projection.name==="globe",Fe=Ge?n.aj(U.zoom):0,Oe=[n.aF(U.center.lng),n.aJ(U.center.lat)],it=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ft=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(it?null:a.lut).toArray01().slice(0,3),ht=a.paint.get("fill-extrusion-flood-light-intensity"),St=a.paint.get("fill-extrusion-vertical-scale"),It=a.paint.get("fill-extrusion-line-width").constantOr(1)!==0,zt=a.paint.get("fill-extrusion-height-alignment"),Jt=a.paint.get("fill-extrusion-base-alignment"),gt=sh(h,a.paint.get("fill-extrusion-cutoff-fade-range")),nt=[];let Bt;Ge&&nt.push("PROJECTION_GLOBE_VIEW"),Te[0]>0&&nt.push("FAUX_AO"),Se&&nt.push("ZERO_ROOF_RADIUS"),M&&nt.push("HAS_CENTROID"),ht>0&&nt.push("FLOOD_LIGHT"),gt.shouldRenderCutoff&&nt.push("RENDER_CUTOFF"),It&&nt.push("RENDER_WALL_MODE");const Dt=h.renderPass==="shadow",li=h.shadowRenderer,Ei=Dt&&!!li,Ri=Dt?jn.disabled:jn.backCCW;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let Ti=[0,0,0];if(li){const en=h.style.directionalLight,ji=h.style.ambientLight;en&&ji&&(Ti=Lc(h.style,en,ji)),Dt||(nt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),li.useNormalOffset&&nt.push("NORMAL_OFFSET")),Bt=nt.concat(["SHADOWS_SINGLE_CASCADE"])}const mi=Ei?"fillExtrusionDepth":ae?"fillExtrusionPattern":"fillExtrusion",pn=a.getLayerRenderingStats();for(const en of d){const ji=t.getTile(en),Qi=ji.getBucket(a);if(!Qi||Qi.projection.name!==U.projection.name)continue;let vn=!1;li&&(vn=li.getMaxCascadeForTile(en.toUnwrapped())===0);const rr=h.isTileAffectedByFog(en),Br=Qi.programConfigurations.get(a.id);let ba=!1;if(Q&&ji.imageAtlas){const qr=ji.imageAtlas,mr=n.e3.from(Q),wa=mr.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),Bs=mr.getSecondary(),Ga=qr.patternPositions.get(wa),ya=Bs?qr.patternPositions.get(Bs.scaleSelf(n.o.devicePixelRatio).toString()):null;ba=!!Ga&&!!ya,Ga&&Br.setConstantPatternPositions(Ga,ya)}X>0&&(ba||Br.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&nt.push("FILL_EXTRUSION_PATTERN_TRANSITION");const _n=h.getOrCreateProgram(mi,{config:Br,defines:vn?Bt:nt,overrideFog:rr});if(h.terrain&&h.terrain.setupElevationDraw(ji,_n,{useMeterToDem:!0}),!Qi.centroidVertexBuffer){const qr=_n.getAttributeLocation(N,"a_centroid_pos");qr!==-1&&N.vertexAttrib2f(qr,0,0)}!Dt&&li&&li.setupShadows(ji.tileID.toUnwrapped(),_n,"vector-tile"),ae&&(h.context.activeTexture.set(N.TEXTURE0),ji.imageAtlasTexture&&ji.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),Br.updatePaintBuffers());const aa=a.paint.get("fill-extrusion-vertical-gradient"),Qn=1/Qi.tileToMeter;let yr;if(Dt&&li){if(yc(ji.tileID,Qi.maxHeight,h))continue;const qr=li.calculateShadowPassMatrixFromTile(ji.tileID.toUnwrapped());yr=st(qr,Ze,Qn,St,zt,Jt)}else{const qr=h.translatePosMatrix(en.expandedProjMatrix,ji,a.paint.get("fill-extrusion-translate"),a.paint.get("fill-extrusion-translate-anchor")),mr=U.projection.createInversionMatrix(U,en.canonical);yr=ae?vt(qr,h,aa,ie,Te,Ze,Qn,en,ji,Ve,zt,Jt,Fe,Oe,mr,ft,St,X):Ye(qr,h,aa,ie,Te,Ze,Qn,en,Ve,zt,Jt,Fe,Oe,mr,ft,St,ht,Ti)}h.uploadCommonUniforms(R,_n,en.toUnwrapped(),null,gt);let Gr=Qi.segments;if(U.projection.name==="mercator"&&!Dt&&(Gr=Qi.getVisibleSegments(ji.tileID,h.terrain,h.transform.getFrustum(0)),!Gr.get().length))continue;if(pn)if(Dt)for(const qr of Gr.get())pn.numRenderedVerticesInShadowPass+=qr.primitiveLength;else for(const qr of Gr.get())pn.numRenderedVerticesInTransparentPass+=qr.primitiveLength;const Kr=[];(h.terrain||M)&&Kr.push(Qi.centroidVertexBuffer),Ge&&Kr.push(Qi.layoutVertexExtBuffer),It&&Kr.push(Qi.wallVertexBuffer),_n.draw(h,R.gl.TRIANGLES,y,b,S,Ri,yr,a.id,Qi.layoutVertexBuffer,Qi.indexBuffer,Gr,a.paint,h.transform.zoom,Br,Kr)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}class af{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Gu(h,t,a,d,y,b,S,M,R,N,U,Y,X,Q,ae,ie,_e,fe,Te,De){const Se=t.context,Ze=Se.gl,Ve=t.transform,Ge=t.transform.zoom,Fe=[],Oe=h.translate,it=h.translateAnchor,ft=h.edgeRadius,ht=sh(t,h.cutoffFadeRange);U==="clear"?(Fe.push("CLEAR_SUBPASS"),De&&(Fe.push("CLEAR_FROM_TEXTURE"),Se.activeTexture.set(Ze.TEXTURE0),De.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE))):U==="sdf"?Fe.push("SDF_SUBPASS"):U==="emissive"&&(Fe.push("USE_MRT1"),Se.activeTexture.set(Ze.TEXTURE0),De.bind(Ze.LINEAR,Ze.CLAMP_TO_EDGE)),fe&&Fe.push("HAS_CENTROID"),ht.shouldRenderCutoff&&Fe.push("RENDER_CUTOFF");const St=(It,zt,Jt,gt,nt)=>{let Bt=Fe;zt.groundRadiusBuffer!=null&&(Bt=Fe.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Dt=zt.programConfigurations.get(d.id),li=t.isTileAffectedByFog(It),Ei=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Dt,defines:Bt,overrideFog:li}),Ri=Et(t,gt,Y,N,nt,[X,Q*nt],ae,ie,_e,Ge>=17?0:ft*nt,De?De.size[0]:0),Ti=[];fe&&Ti.push(zt.hiddenByLandmarkVertexBuffer),zt.groundRadiusBuffer!=null&&Ti.push(zt.groundRadiusBuffer),t.uploadCommonUniforms(Se,Ei,It.toUnwrapped(),null,ht),Ei.draw(t,Se.gl.TRIANGLES,b,S,M,R,Ri,d.id,zt.vertexBuffer,zt.indexBuffer,Jt,d.paint,Ge,Dt,Ti)};for(const It of y){const zt=a.getTile(It),Jt=zt.getBucket(d);if(!Jt||Jt.projection.name!==Ve.projection.name||!Jt.groundEffect||Jt.groundEffect&&!Jt.groundEffect.hasData())continue;const gt=Jt.groundEffect,nt=1/Jt.tileToMeter;{const Bt=t.translatePosMatrix(It.projMatrix,zt,Oe,it),Dt=gt.getDefaultSegment();St(It,gt,Dt,Bt,nt)}if(Te)for(let Bt=0;Bt<4;Bt++){const Dt=n.e9[Bt](It),li=a.getTile(Dt);if(!li)continue;const Ei=li.getBucket(d);if(!Ei||Ei.projection.name!==Ve.projection.name||!Ei.groundEffect||Ei.groundEffect&&!Ei.groundEffect.hasData())continue;const Ri=Ei.groundEffect;let Ti,mi;Bt===0?(Ti=[-n.al,0,0],mi=1):Bt===1?(Ti=[n.al,0,0],mi=0):Bt===2?(Ti=[0,-n.al,0],mi=3):(Ti=[0,n.al,0],mi=2);const pn=Ri.regionSegments[mi];if(!pn)continue;const en=new Float32Array(16);n.br(en,It.projMatrix,Ti),St(It,Ri,pn,t.translatePosMatrix(en,zt,Oe,it),nt)}}}function Dp(h,t,a,d,y,b,S){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const M=b?b.findDEMTileFor(a):null;if(!(M&&M.dem||S))return;b&&M&&M.dem&&d.selfDEMTileTimestamp!==M.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=M.dem._timestamp);const R=fe=>new n.P(Math.ceil((fe+n.ed)*n.ee),0),N=fe=>{const Te=t.getSource().minzoom,De=Ze=>{const Ve=t.getTileByID(Ze);if(Ve&&Ve.hasData())return Ve.getBucket(y)},Se=[0,-1,1];for(const Ze of Se){if(fe.overscaledZ+Ze<Te)continue;const Ve=De(fe.calculateScaledKey(fe.overscaledZ+Ze));if(Ve)return Ve}},U=[0,0,0],Y=(fe,Te)=>(U[0]=Math.min(fe.min.y,Te.min.y),U[1]=Math.max(fe.max.y,Te.max.y),U[2]=n.al-Te.min.x>fe.max.x?Te.min.x-n.al:fe.max.x,U),X=(fe,Te)=>(U[0]=Math.min(fe.min.x,Te.min.x),U[1]=Math.max(fe.max.x,Te.max.x),U[2]=n.al-Te.min.y>fe.max.y?Te.min.y-n.al:fe.max.y,U),Q=[(fe,Te)=>Y(fe,Te),(fe,Te)=>Y(Te,fe),(fe,Te)=>X(fe,Te),(fe,Te)=>X(Te,fe)],ae=(fe,Te,De,Se,Ze,Ve,Ge)=>{if(!b)return 0;const Fe=[[Ve?De:fe,Ve?fe:De,0],[Ve?De:Te,Ve?Te:De,0]],Oe=Ge<0?n.al+Ge:Ge,it=[Ve?Oe:(fe+Te)/2,Ve?(fe+Te)/2:Oe,0];return De===0&&Ge<0||De!==0&&Ge>0?b.getForTilePoints(Ze,[it],!0,Se):Fe.push(it),b.getForTilePoints(a,Fe,!0,M),Math.max(Fe[0][2],Fe[1][2],it[2])/b.exaggeration()};for(let fe=0;fe<4;fe++){const Te=d.borderFeatureIndices[fe];if(Te.length===0)continue;const De=n.e9[fe](a),Se=N(De);if(!(Se&&Se instanceof n.ea))continue;const Ze=b?b.findDEMTileFor(De):null;if(!(Ze&&Ze.dem||S)||(b&&Ze&&Ze.dem&&d.borderDEMTileTimestamp[fe]!==Ze.dem._timestamp&&(d.borderDoneWithNeighborZ[fe]=-1,d.borderDEMTileTimestamp[fe]=Ze.dem._timestamp),d.borderDoneWithNeighborZ[fe]===Se.canonical.z))continue;Se.centroidVertexArray.length===0&&Se.createCentroidsBuffer();const Ve=(fe<2?1:5)-fe,Ge=Se.borderDoneWithNeighborZ[Ve]!==d.canonical.z,Fe=Se.borderFeatureIndices[Ve];let Oe=0;if(d.canonical.z!==Se.canonical.z){for(const it of Te)d.showCentroid(d.featuresOnBorder[it]);if(Ge)for(const it of Fe)Se.showCentroid(Se.featuresOnBorder[it]);d.borderDoneWithNeighborZ[fe]=Se.canonical.z,Se.borderDoneWithNeighborZ[Ve]=d.canonical.z}for(const it of Te){const ft=d.featuresOnBorder[it],ht=d.centroidData[ft.centroidDataIndex],St=ft.borders[fe];let It;for(;Oe<Fe.length;){It=Se.featuresOnBorder[Fe[Oe]];const zt=It.borders[Ve];if(zt[1]>St[0]+3||zt[0]>St[0]-3)break;Se.showCentroid(It),Oe++}if(It&&Oe<Fe.length){const zt=Oe;let Jt=0;for(;!(It.borders[Ve][0]>St[1]-3)&&(Jt++,++Oe!==Fe.length);)It=Se.featuresOnBorder[Fe[Oe]];It=Se.featuresOnBorder[Fe[zt]];let gt=!1;if(Jt>=1){const Dt=It.borders[Ve];Math.abs(St[0]-Dt[0])<3&&Math.abs(St[1]-Dt[1])<3&&(Jt=1,gt=!0,Oe=zt+1)}else if(Jt===0){d.showCentroid(ft);continue}const nt=Se.centroidData[It.centroidDataIndex];S&&gt&&(((ie=ht).flags|(_e=nt).flags)&n.ec?(ie.flags|=n.ec,_e.flags|=n.ec):(ie.flags&=~n.ec,_e.flags&=~n.ec));const Bt=ft.intersectsCount()>1||It.intersectsCount()>1;if(Jt>1)Oe=zt,ht.centroidXY=nt.centroidXY=new n.P(0,0);else if(Ze&&Ze.dem&&!Bt){const Dt=Q[fe](ht,nt),li=fe%2?n.al-1:0,Ei=ae(Dt[0],Math.min(n.al-1,Dt[1]),li,Ze,De,fe<2,Dt[2]);ht.centroidXY=nt.centroidXY=R(Ei)}else Bt?ht.centroidXY=nt.centroidXY=new n.P(0,0):(ht.centroidXY=d.encodeBorderCentroid(ft),nt.centroidXY=Se.encodeBorderCentroid(It));d.writeCentroidToBuffer(ht),Se.writeCentroidToBuffer(nt)}else d.showCentroid(ft)}d.borderDoneWithNeighborZ[fe]=Se.canonical.z,Se.borderDoneWithNeighborZ[Ve]=d.canonical.z}var ie,_e;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const qo=[1,0,0],np=[0,1,0],Ko=[0,0,1];function yc(h,t,a){const d=a.transform,y=a.shadowRenderer;if(!y)return!0;const b=h.toUnwrapped(),S=d.tileSize*y._cascades[a.currentShadowCascade].scale;let M=t;if(d.elevation){const ie=d.elevation.getMinMaxForTile(h);ie&&(M+=ie.max)}const R=[...y.shadowDirection];R[2]=-R[2];const N=y.computeSimplifiedTileShadowVolume(b,M,S,R);if(!N)return!1;const U=[qo,np,Ko,R,[R[0],0,R[2]],[0,R[1],R[2]]],Y=d.projection.name==="globe",X=d.scaleZoom(S),Q=n.cB.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,X,!Y),ae=y.getCurrentCascadeFrustum();return Q.intersectsPrecise(N.vertices,N.planes,U)===0||ae.intersectsPrecise(N.vertices,N.planes,U)===0}function dh(h){const{painter:t,source:a,layer:d,coords:y}=h;let b=h.defines;const S=t.context,M=t.renderPass==="shadow",R=t.renderPass==="light-beam",N=t.shadowRenderer,U=n.ef(t.transform.center.lat,t.transform.zoom),Y=sh(t,d.paint.get("building-cutoff-fade-range"));Y.shouldRenderCutoff&&(b=b.concat("RENDER_CUTOFF")),h.floodLightIntensity>0&&(b=b.concat("FLOOD_LIGHT"));for(const X of y){const Q=a.getTile(X),ae=Q.getBucket(d);if(!ae)continue;N&&N.getMaxCascadeForTile(X.toUnwrapped())===0&&(b=b.concat("SHADOWS_SINGLE_CASCADE"));const ie=ae.programConfigurations.get(d.id);let _e,fe,Te,De=t.translatePosMatrix(X.expandedProjMatrix,Q,[0,0],"map");if(De=n.cS(n.bC(),De,[1,1,h.verticalScale]),M&&N){if(yc(Q.tileID,ae.maxHeight*U,t))continue;let Ze=N.calculateShadowPassMatrixFromTile(Q.tileID.toUnwrapped());Ze=n.cS(n.bC(),Ze,[1,1,h.verticalScale]),Te=Mn(Ze),_e=fe=t.getOrCreateProgram("buildingDepth",{config:ie,defines:b,overrideFog:!1})}else if(R)_e=fe=t.getOrCreateProgram("buildingBloom",{config:ie,defines:b,overrideFog:!1}),Te=An(De);else{const Ze=t.transform.calculatePosMatrix(X.toUnwrapped(),t.transform.worldSize);n.cS(Ze,Ze,[1,1,h.verticalScale]);const Ve=n.bC();n.cS(Ve,Ze,[1,-1,1/U]),n.bl(Ve,Ve),n.eg(Ve,Ve);const Ge=t.transform.getFreeCameraOptions().position,Fe=1<<X.canonical.z;if(Te=$i(De,Ve,h.opacity,h.facadeAOIntensity,[((Ge.x-X.wrap)*Fe-X.canonical.x)*n.al,(Ge.y*Fe-X.canonical.y)*n.al,Ge.z*Fe*n.al],ae.tileToMeter,h.facadeEmissiveChance,h.floodLightColor,h.floodLightIntensity),fe=t.getOrCreateProgram("building",{config:ie,defines:b,overrideFog:!1}),h.depthOnly===!0)_e=fe;else{const Oe=b.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);_e=t.getOrCreateProgram("building",{config:ie,defines:Oe,overrideFog:!1})}N&&(N.setupShadowsFromMatrix(Ze,fe,!0),_e!==fe&&N.setupShadowsFromMatrix(Ze,_e,!0))}const Se=(Ze,Ve)=>{if(R){const Ge=Ze.entranceBloom;Ve.draw(t,S.gl.TRIANGLES,h.depthMode,Un.disabled,h.blendMode,jn.disabled,Te,d.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segmentsBucket,d.paint,t.transform.zoom,ie,[Ge.layoutAttenuationBuffer,Ge.layoutColorBuffer])}else{const Ge=Ze.segmentsBucket;let Fe=[Ze.layoutNormalBuffer,Ze.layoutCentroidBuffer,Ze.layoutColorBuffer,Ze.layoutFloodLightDataBuffer];Ze.layoutFacadePaintBuffer&&(Fe=Fe.concat([Ze.layoutFacadeDataBuffer,Ze.layoutFacadeVerticalRangeBuffer,Ze.layoutFacadePaintBuffer])),Ve.draw(t,S.gl.TRIANGLES,h.depthMode,Un.disabled,h.blendMode,M?jn.disabled:jn.backCW,Te,d.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ge,d.paint,t.transform.zoom,ie,Fe)}};t.uploadCommonUniforms(S,fe,X.toUnwrapped(),null,Y),ae.buildingWithoutFacade&&Se(ae.buildingWithoutFacade,fe),ae.buildingWithFacade&&(_e!==fe&&t.uploadCommonUniforms(S,_e,X.toUnwrapped(),null,Y),Se(ae.buildingWithFacade,_e))}}function Jo(h,t,a,d,y,b,S,M,R,N,U,Y,X){const Q=h.context.gl,ae=h.depthModeForSublayer(1,xn.ReadOnly,Q.LEQUAL,!0),ie=.1*(1-(_e=U))+3*_e;var _e;const fe=h._showOverdrawInspector,Te=Y,De=new af;fe||Gu(De,h,t,a,d,ae,new Un({func:Q.ALWAYS,mask:255},255,255,Q.KEEP,Q.KEEP,Q.REPLACE),new cr([Q.ONE,Q.ONE,Q.ONE,Q.ONE],n.ao.transparent,[!1,!1,!1,!0],Q.MIN),jn.disabled,y,"sdf",b,S,M,R,N,ie,Te,!1);{const Se=fe?Un.disabled:new Un({func:Q.EQUAL,mask:255},255,255,Q.KEEP,Q.DECR,Q.DECR),Ze=fe?h.colorModeForRenderPass():new cr([Q.ONE_MINUS_DST_ALPHA,Q.DST_ALPHA,Q.ONE,Q.ONE],n.ao.transparent,[!0,!0,!0,!0]);Gu(De,h,t,a,d,ae,Se,Ze,jn.disabled,y,"color",b,S,M,R,N,ie,Te,!1)}}function Qs(h){return[h[0]*n.eh,h[1]*n.eh,h[2]*n.eh,0]}function wu(h,t,a,d,y,b,S,M,R){const N=d.getSource(),U=a.globeSharedBuffers;if(!U)return;let Y,X,Q;if(t&&(Y=d.getTile(t)),N instanceof n.aU?(X=N.texture,Q=n.dK(0,0,a.transform)):Y&&t&&(X=Y.texture,Q=n.dK(t.canonical.z,t.canonical.x,a.transform)),!X||!Q)return;h||(Q=n.cS(n.bC(),Q,[1,-1,1]));const ae=a.context,ie=ae.gl,_e=y.paint.get("raster-resampling")==="nearest"?ie.NEAREST:ie.LINEAR,fe=a.colorModeForDrapableLayerRenderPass(b),Te=S.defines;Te.push("GLOBE_POLES");const De=new xn(ie.LEQUAL,xn.ReadWrite,a.depthRangeFor3D),Se=Float32Array.from(a.transform.expandedFarZProjMatrix),Ze=Float32Array.from(n.bk(n.dJ(new n.cD(0,0,0))));a.terrain&&a.terrain.prepareDrawTile(),ae.activeTexture.set(ie.TEXTURE0),X.bind(_e,ie.CLAMP_TO_EDGE),ae.activeTexture.set(ie.TEXTURE1),X.bind(_e,ie.CLAMP_TO_EDGE),"useMipmap"in X&&ae.extTextureFilterAnisotropic&&a.transform.pitch>20&&ie.texParameterf(ie.TEXTURE_2D,ae.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ae.extTextureFilterAnisotropicMax);const[Ve,Ge,Fe,Oe]=t?U.getPoleBuffers(t.canonical.z,!1):U.getPoleBuffers(0,!0),it=y.paint.get("raster-elevation");let ft;h?(ft=Ve,a.renderDefaultNorthPole=it!==0):(ft=Ge,a.renderDefaultSouthPole=it!==0);const ht=Qs(S.mix),St=((zt,Jt,gt,nt,Bt,Dt,li,Ei,Ri,Ti,mi,pn,en)=>qn(zt,Jt,gt,new Float32Array(16),new Float32Array(9),[0,0],nt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Dt,[0,0],Ei,2,Ti,mi,pn,1,0,en))(Se,Ze,Q,n.aj(a.transform.zoom),0,y,0,it,0,ht,S.offset,S.range,b),It=a.getOrCreateProgram("raster",{defines:Te});a.uploadCommonUniforms(ae,It,null),It.draw(a,ie.TRIANGLES,De,R,fe,M,St,y.id,ft,Fe,Oe)}function Dd(h){const t=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-t,y=.2*h.height,b=t+y;return[t,a,(b-y-t)/d,(b-t)/d]}function qu(h,t,a,d){if(h)return t instanceof _a&&h instanceof Ch?t.getTextureDescriptor(h,a,!0):{texture:h.texture,mix:Qs(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Xa=n.ei([{name:"a_index",type:"Int16",components:1}]);class fh{constructor(t,a,d,y){const b={width:d[0],height:d[1],data:null},S=t.gl;this.targetColorTexture=new n.T(t,b,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,b,S.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(a,y),this.lastInvalidatedAt=0}updateParticleTexture(t,a){if(this.particleTextureDimension===a.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,y=a.width*a.height;this.particleTexture0=new n.T(this.context,a,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,a,d.RGBA8,{premultiply:!1,useMipmap:!1});const b=new n.ej;b.reserve(y);for(let S=0;S<y;S++)b.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(b,Xa.members,!0),this.particleSegment=n.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=a.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function sf(h,t,a){if(!h)return null;const d=t.getTextureDescriptor(h,a,!0);if(!d)return null;let{texture:y,mix:b,offset:S,tileSize:M,buffer:R,format:N}=d;if(!y||!N)return null;let U=!1;return N==="uint32"&&(U=!0,b[3]=0,b=$r(n.ek,b,[0,a.paint.get("raster-particle-max-speed")]),S=On(n.ek,S,[0,a.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[R/(M+2*R),M/(M+2*R)],tileSize:M,scalarData:U,scale:b,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[N]]}}function of(h){const t=h._nearZ,a=h.projection.farthestPixelDistance(h),d=a-t,y=.2*h.height,b=t+y;return[t,a,(b-y-t)/d,(b-t)/d]}const Rd=new n.ao(1,0,0,1),Gh=new n.ao(0,1,0,1),Hu=new n.ao(0,0,1,1),Qc=new n.ao(1,0,1,1),Pd=new n.ao(0,1,1,1);function xi(h,t,a,d,y,b){for(let S=0;S<a.length;S++)if(y){const N=new n.ao(d.r*.8,d.g*.8,d.b*.8,1);Fi(h,t,a[S],d,-1,-1,b),Fi(h,t,a[S],d,-1,1,b),Fi(h,t,a[S],d,1,1,b),Fi(h,t,a[S],d,1,-1,b),Fi(h,t,a[S],N,0,0,b)}else Fi(h,t,a[S],d,0,0,b)}function Fi(h,t,a,d,y,b,S){const M=h.context,R=h.transform,N=M.gl,U=R.projection.name==="globe",Y=U?["PROJECTION_GLOBE_VIEW"]:[];let X=n.bz(a.projMatrix);if(U&&n.aj(R.zoom)>0){const ht=n.bj(a.canonical,R),St=n.el(ht);X=n.aB(new Float32Array(16),R.globeMatrix,St),n.aB(X,R.projMatrix,X)}const Q=n.bC();Q[12]+=2*y/(n.o.devicePixelRatio*R.width),Q[13]+=2*b/(n.o.devicePixelRatio*R.height),n.aB(X,Q,X);const ae=h.getOrCreateProgram("debug",{defines:Y}),ie=t.getTileByID(a.key);h.terrain&&h.terrain.setupElevationDraw(ie,ae);const _e=xn.disabled,fe=Un.disabled,Te=h.colorModeForRenderPass(),De="$debug";M.activeTexture.set(N.TEXTURE0),h.emptyTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),U?ie._makeGlobeTileDebugBuffers(h.context,R):ie._makeDebugTileBoundsBuffers(h.context,R.projection);const Se=ie._tileDebugBuffer||h.debugBuffer,Ze=ie._tileDebugIndexBuffer||h.debugIndexBuffer,Ve=ie._tileDebugSegments||h.debugSegments;if(ae.draw(h,N.LINE_STRIP,_e,fe,Te,jn.disabled,Ln(X,d.toPremultipliedRenderColor(null)),De,Se,Ze,Ve,null,null,null,[ie._globeTileDebugBorderBuffer]),S){const ht=ie.latestRawTileData,St=Math.floor((ht&&ht.byteLength||0)/1024);let It=a.canonical.toString();a.overscaledZ!==a.canonical.z&&(It+=` => ${a.overscaledZ}`),It+=` ${ie.state}`,It+=` ${St}kb`,(function(zt,Jt){zt.initDebugOverlayCanvas();const gt=zt.debugOverlayCanvas,nt=zt.context.gl,Bt=zt.debugOverlayCanvas.getContext("2d");Bt.clearRect(0,0,gt.width,gt.height),Bt.shadowColor="white",Bt.shadowBlur=2,Bt.lineWidth=1.5,Bt.strokeStyle="white",Bt.textBaseline="top",Bt.font="bold 36px Open Sans, sans-serif",Bt.fillText(Jt,5,5),Bt.strokeText(Jt,5,5),zt.debugOverlayTexture.update(gt),zt.debugOverlayTexture.bind(nt.LINEAR,nt.CLAMP_TO_EDGE)})(h,It)}const Ge=t.getTile(a).tileSize,Fe=512/Math.min(Ge,512)*(a.overscaledZ/R.zoom)*.5,Oe=ie._tileDebugTextBuffer||h.debugBuffer,it=ie._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,ft=ie._tileDebugTextSegments||h.debugSegments;ae.draw(h,N.TRIANGLES,_e,fe,cr.alphaBlended,jn.disabled,Ln(X,n.ao.transparent.toPremultipliedRenderColor(null),Fe),De,Oe,it,ft,null,null,null,[ie._globeTileDebugTextBuffer])}function gd(h,t,a,d){xt(h,0,t+a/2,h.transform.width,a,d)}function ca(h,t,a,d){xt(h,t-a/2,0,a,h.transform.height,d)}function xt(h,t,a,d,y,b){const S=h.context,M=S.gl;M.enable(M.SCISSOR_TEST),M.scissor(t*n.o.devicePixelRatio,a*n.o.devicePixelRatio,d*n.o.devicePixelRatio,y*n.o.devicePixelRatio),S.clear({color:b}),M.disable(M.SCISSOR_TEST)}const hm=n.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:qh}=hm;function xc(h,t,a,d){h.emplaceBack(t,a,d)}class Ld{constructor(t){this.vertexArray=new n.em,this.indices=new n.b0,xc(this.vertexArray,-1,-1,1),xc(this.vertexArray,1,-1,1),xc(this.vertexArray,-1,1,1),xc(this.vertexArray,1,1,1),xc(this.vertexArray,-1,-1,-1),xc(this.vertexArray,1,-1,-1),xc(this.vertexArray,-1,1,-1),xc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,qh),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.bg.simpleSegment(0,0,36,12)}}function yd(h,t,a,d,y,b){const S=h.context.gl,M=t.paint.get("sky-atmosphere-color"),R=t.paint.get("sky-atmosphere-halo-color"),N=t.paint.get("sky-atmosphere-sun-intensity"),U=((Y,X,Q,ae,ie)=>({u_matrix_3f:Y,u_sun_direction:X,u_sun_intensity:Q,u_color_tint_r:[ae.r,ae.g,ae.b,ae.a],u_color_tint_m:[ie.r,ie.g,ie.b,ie.a],u_luminance:5e-5}))(n.eo(n.dO(),d),y,N,M.toPremultipliedRenderColor(null),R.toPremultipliedRenderColor(null));S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,t.skyboxTexture,0),a.draw(h,S.TRIANGLES,xn.disabled,Un.disabled,cr.unblended,jn.frontCW,U,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const dm=n.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Pf{constructor(t){const a=new n.ep;a.emplaceBack(-1,1,1,0,0),a.emplaceBack(1,1,1,1,0),a.emplaceBack(1,-1,1,1,1),a.emplaceBack(-1,-1,1,0,1);const d=new n.b0;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(a,dm.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=n.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Om=n.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class c_{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class fm{constructor(t){this.colorModeAlphaBlendedWriteRGB=new cr([1,Mo,1,Mo],n.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new cr([1,0,1,0],n.ao.transparent,[!1,!1,!1,!0]),this.params=new c_,this.updateNeeded=!0}update(t){const a=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Pf(a);const d=this.params.sizeRange,y=this.params.intensityRange,b=(function(U){const Y=n.eq(30),X=[];for(let Q=0;Q<U;++Q){const ae=2*Math.PI*Y(),ie=Math.acos(1-2*Y())-.5*Math.PI;X.push(n.d5(Math.cos(ie)*Math.cos(ae),Math.cos(ie)*Math.sin(ae),Math.sin(ie)))}return X})(this.params.starsCount),S=n.eq(300),M=new n.er,R=new n.b0;let N=0;for(let U=0;U<b.length;++U){const Y=n.c5([],b[U],200),X=Math.max(0,1+.01*d*(1*S()-.5)),Q=Math.max(0,1+.01*y*(1*S()-.5));M.emplaceBack(Y[0],Y[1],Y[2],-1,-1,X,Q),M.emplaceBack(Y[0],Y[1],Y[2],1,-1,X,Q),M.emplaceBack(Y[0],Y[1],Y[2],1,1,X,Q),M.emplaceBack(Y[0],Y[1],Y[2],-1,1,X,Q),R.emplaceBack(N+0,N+1,N+2),R.emplaceBack(N+0,N+2,N+3),N+=4}this.starsVx=a.createVertexBuffer(M,Om.members),this.starsIdx=a.createIndexBuffer(R),this.starsSegments=n.bg.simpleSegment(0,0,M.length,R.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,a){const d=t.context,y=d.gl,b=t.transform,S=new xn(y.LEQUAL,xn.ReadOnly,[0,1]),M=n.aj(b.zoom),R=t.style.getLut(a.scope),N=a.properties.get("color-use-theme")==="none",U=a.properties.get("color").toNonPremultipliedRenderColor(N?null:R),Y=a.properties.get("high-color-use-theme")==="none",X=a.properties.get("high-color").toNonPremultipliedRenderColor(Y?null:R),Q=a.properties.get("space-color-use-theme")==="none",ae=a.properties.get("space-color").toNonPremultipliedRenderColor(Q?null:R),ie=5e-4,_e=n.es(a.properties.get("horizon-blend"),0,1,ie,.25),fe=n.dE(t,d,b)&&_e===ie?b.worldSize/(2*Math.PI*1.025)-1:b.globeRadius,Te=t.frameCounter/1e3%1,De=n.ag(b.globeCenterInViewSpace),Se=Math.sqrt(Math.pow(De,2)-Math.pow(fe,2)),Ze=Math.acos(Se/De),Ve=Ge=>{const Fe=b.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Ge&&Fe.push("ALPHA_PASS");const Oe=t.getOrCreateProgram("globeAtmosphere",{defines:Fe}),it=((ht,St,It,zt,Jt,gt,nt,Bt,Dt,li,Ei,Ri)=>({u_frustum_tl:ht,u_frustum_tr:St,u_frustum_br:It,u_frustum_bl:zt,u_horizon:Jt,u_transition:gt,u_fadeout_range:nt,u_atmosphere_fog_color:Bt.toArray01(),u_high_color:Dt.toArray01(),u_space_color:li.toArray01(),u_temporal_offset:Ei,u_horizon_angle:Ri}))(b.frustumCorners.TL,b.frustumCorners.TR,b.frustumCorners.BR,b.frustumCorners.BL,b.frustumCorners.horizon,M,_e,U,X,ae,Te,Ze);t.uploadCommonUniforms(d,Oe);const ft=this.atmosphereBuffer;ft&&Oe.draw(t,y.TRIANGLES,S,Un.disabled,Ge?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,jn.backCW,it,Ge?"atmosphere_glow_alpha":"atmosphere_glow",ft.vertexBuffer,ft.indexBuffer,ft.segments)};Ve(!1),Ve(!0)}drawStars(t,a){const d=n.aA(a.properties.get("star-intensity"),0,1);if(d===0)return;const y=t.context,b=y.gl,S=t.transform,M=t.getOrCreateProgram("stars"),R=n.c7([]);n.c9(R,R,-S._pitch),n.c8(R,R,-S.angle),n.c9(R,R,n.an(S._center.lat)),n.et(R,R,-n.an(S._center.lng));const N=n.cc(new Float32Array(16),R),U=n.aB([],S.starsProjMatrix,N),Y=n.eo([],N),X=n.eu([],Y),Q=[0,1,0];n.dQ(Q,Q,X),n.c5(Q,Q,this.params.sizeMultiplier);const ae=[1,0,0];n.dQ(ae,ae,X),n.c5(ae,ae,this.params.sizeMultiplier);const ie=(_e=Q,fe=ae,Te=d,{u_matrix:Float32Array.from(U),u_up:_e,u_right:fe,u_intensity_multiplier:Te});var _e,fe,Te;t.uploadCommonUniforms(y,M),this.starsVx&&this.starsIdx&&M.draw(t,b.TRIANGLES,xn.disabled,Un.disabled,this.colorModeAlphaBlendedWriteRGB,jn.disabled,ie,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Rp{constructor(){this.visibleTiles=[]}updateBorders(t,a){const d=[],y=[],b=t._getRenderableCoordinates(!1,!0);for(const R of b){const N=t.getTile(R);if(!N.hasData())continue;const U=N.getBucket(a);U&&(U.isEmpty()||(d.push(R.key),y.push({bucket:U,tileID:R.canonical})))}let S=d.length!==this.visibleTiles.length;if(!S){d.sort();for(let R=0;R<d.length;R++)if(d[R]!==this.visibleTiles[R]){S=!0;break}}if(!S)return;const M=new Set;this.visibleTiles=d,y.sort(((R,N)=>R.tileID.z-N.tileID.z||R.tileID.x-N.tileID.x||R.tileID.y-N.tileID.y));for(const R of y){const N=new Array,U=new Array,Y=R.bucket;for(const X of Y.featuresOnBorder)M.has(X.featureId)?U.push(X.footprintIndex):(M.add(X.featureId),N.push(X.footprintIndex));Y.updateFootprintHiddenFlags(N,n.ev,!1),Y.updateFootprintHiddenFlags(U,n.ev,!0)}}}function Hh(h,t){const a=[...h],d=t.cameraWorldSizeForFog/t.worldSize,y=n.bA([]);return n.cS(y,y,[d,d,1]),n.aB(a,y,a),n.aB(a,t.worldToFogMatrix,a),a}function rp(h,t,a,d,y){const b=a.material,S=d.context,{baseColorTexture:M,metallicRoughnessTexture:R}=b.pbrMetallicRoughness,{normalTexture:N,occlusionTexture:U,emissionTexture:Y}=b;function X(ae,ie,_e){if(ae&&(h.push(ie),S.activeTexture.set(S.gl.TEXTURE0+_e),ae.gfxTexture)){const{minFilter:fe,magFilter:Te,wrapS:De,wrapT:Se}=ae.sampler;ae.gfxTexture.bindExtraParam(fe,Te,De,Se)}}X(M,"HAS_TEXTURE_u_baseColorTexture",ds.BaseColor),X(R,"HAS_TEXTURE_u_metallicRoughnessTexture",ds.MetallicRoughness),X(N,"HAS_TEXTURE_u_normalTexture",ds.Normal),X(U,"HAS_TEXTURE_u_occlusionTexture",ds.Occlusion),X(Y,"HAS_TEXTURE_u_emissionTexture",ds.Emission),y&&(y.texture||(y.texture=new n.d$(d.context,y.image,[y.image.height,y.image.height,y.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+ds.LUT),y.texture&&y.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),a.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(a.texcoordBuffer)),a.colorBuffer&&(h.push(a.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(a.colorBuffer)),a.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(a.normalBuffer)),a.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(a.pbrBuffer)),b.alphaMode!=="OPAQUE"&&b.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),b.defined||h.push("DIFFUSE_SHADED");const Q=d.shadowRenderer;Q&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),Q.useNormalOffset&&h.push("NORMAL_OFFSET"))}function lf(h,t,a,d,y,b){const S=h.modelOpacity,M=t.context,R=new xn(t.context.gl.LEQUAL,h.isLightMesh?xn.ReadOnly:xn.ReadWrite,t.depthRangeFor3D),N=t.transform,U=h.mesh,Y=U.material,X=Y.pbrMetallicRoughness,Q=t.style.fog;let ae;ae=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:n.aB([],d.zScaleMatrix,h.nodeModelMatrix),n.aB(ae,d.negCameraPosMatrix,ae);const ie=n.bl([],ae);n.eg(ie,ie);const _e=a.paint.get("model-color-use-theme").constantOr("default")==="none",fe=a.paint.get("model-emissive-strength").constantOr(0),Te=Ms(new Float32Array(h.worldViewProjection),new Float32Array(ae),new Float32Array(ie),null,t,S,X.baseColorFactor,Y.emissiveFactor,X.metallicFactor,X.roughnessFactor,Y,fe,a,void 0,void 0,h.materialOverride,h.modelColor),De={defines:[]},Se=[],Ze=t.shadowRenderer;Ze&&(Ze.useNormalOffset=!1),rp(De.defines,Se,U,t,_e?null:a.lut);let Ve=null;if(Q){const Oe=Hh(h.nodeModelMatrix,t.transform);if(Ve=new Float32Array(Oe),N.projection.name!=="globe"){const it=U.aabb.min,ft=U.aabb.max,[ht,St]=Q.getOpacityForBounds(Oe,it[0],it[1],ft[0],ft[1]);De.overrideFog=ht>=qt||St>=qt}}const Ge=sh(t,a.paint.get("model-cutoff-fade-range"));Ge.shouldRenderCutoff&&De.defines.push("RENDER_CUTOFF");const Fe=t.getOrCreateProgram("model",De);t.uploadCommonUniforms(M,Fe,null,Ve,Ge),t.renderPass!=="shadow"&&Ze&&Ze.setupShadowsFromMatrix(h.nodeModelMatrix,Fe),Fe.draw(t,M.gl.TRIANGLES,R,y,b,U.material.doubleSided?jn.disabled:jn.backCCW,Te,a.id,U.vertexBuffer,U.indexBuffer,U.segments,a.paint,t.transform.zoom,void 0,Se)}function $u(h,t){return h.style._importedAsBasemap?"basemap":t.scope}function cf(h,t,a,d,y,b,S,M,R,N){const U=h.transform,Y=!!t.isGeometryBloom&&t.isGeometryBloom;if(Y&&h.renderPass==="shadow")return;const X=U.projection.name==="globe"?n.eD(a,U):[...a];n.aB(X,X,t.globalMatrix);const Q=n.aB([],d,X);if(t.meshes)for(const ae of t.meshes){const ie=M.get(ae.material.name);if(ie&&ie.opacity<=0)continue;if(ae.material.alphaMode!=="BLEND"){S.push({mesh:ae,depth:0,modelIndex:y,worldViewProjection:Q,nodeModelMatrix:X,isLightMesh:Y,materialOverride:ie,modelOpacity:R,modelColor:N});continue}const _e=n.af([],ae.centroid,Q);!U.isOrthographic&&_e[2]<=0||b.push({mesh:ae,depth:_e[2],modelIndex:y,worldViewProjection:Q,nodeModelMatrix:X,isLightMesh:Y,materialOverride:ie,modelOpacity:R,modelColor:N})}if(t.children)for(const ae of t.children)cf(h,ae,a,d,y,b,S,M,R,N)}function vc(h,t,a,d){const y=a.shadowRenderer;if(!y)return;const b=y.getShadowPassDepthMode(),S=y.getShadowPassColorMode(),M=y.calculateShadowPassMatrixFromMatrix(t),R=Co(M);a.getOrCreateProgram("modelDepth",{defines:a._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(a,a.context.gl.TRIANGLES,b,Un.disabled,S,jn.disabled,R,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,a.transform.zoom,void 0,void 0)}function Pp(h,t,a,d,y,b){for(const S of y){const M=Object.assign({},d);M.part=S;const R={type:"Unknown",id:t,properties:M},N={orientation:h.paint.get("model-rotation").evaluate(R,a)};b.set(S,N)}}function ap(h,t,a,d,y,b){for(const S of y){const M=Object.assign({},d);M.part=S;const R={type:"Unknown",id:t,properties:M},N={color:h.paint.get("model-color").evaluate(R,a),colorMix:h.paint.get("model-color-mix-intensity").evaluate(R,a),opacity:h.paint.get("model-opacity").evaluate(R,a),emissionStrength:h.paint.get("model-emissive-strength").evaluate(R,a)};b.set(S,N)}}function pm(h,t,a,d,y){let b=!1;for(const M of d)M.modelOpacity!==1&&(lf(M,h,t,y[M.modelIndex],Un.disabled,cr.disabled),b=!0);for(const M of d)lf(M,h,t,y[M.modelIndex],M.modelOpacity!==1?h.stencilModeFor3D():Un.disabled,h.colorModeForRenderPass());b&&h.resetStencilClippingMasks();const S=cr.additive;for(const M of a)lf(M,h,t,y[M.modelIndex],Un.disabled,M.isLightMesh?S:h.colorModeForRenderPass())}function mm(h,t,a){const d=t.updateZoomBasedPaintProperties(),y=(function(b,S,M){let R,N,U,Y=b.terrain?b.terrain.exaggeration():0;if(b.terrain&&Y>0){const X=b.terrain,Q=X.findDEMTileFor(M);Q&&Q.dem?R=n.eF.create(X,M,Q):Y=0}if(Y===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),Y===S.validForExaggeration&&(Y===0||R&&R._demTile&&R._demTile.tileID===S.validForDEMTile.id&&R._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const X in S.instancesPerModel){const Q=S.instancesPerModel[X];for(let ae=0;ae<Q.instancedDataArray.length;++ae){const ie=(R?Y*R.getElevationAt(0|Q.instancedDataArray.float32[16*ae],0|Q.instancedDataArray.float32[16*ae+1],!0,!0):0)+Q.instancesEvaluatedElevation[ae];Q.instancedDataArray.float32[16*ae+6]=ie,N=N?Math.min(S.terrainElevationMin,ie):ie,U=U?Math.max(S.terrainElevationMax,ie):ie}}return S.terrainElevationMin=N||0,S.terrainElevationMax=U||0,S.validForExaggeration=Y,S.validForDEMTile=R&&R._demTile?{id:R._demTile.tileID,timestamp:R._dem._timestamp}:{id:void 0,timestamp:0},!0})(h,t,a);(d||y)&&(t.uploaded=!1,t.upload(h.context))}const $h={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.d9([0,0,0],[n.al,n.al,0])};function Zs(h,t){const a=1<<h.canonical.z,d=t.getFreeCameraOptions().position,y=t.elevation,b=h.canonical.x/a,S=(h.canonical.x+1)/a,M=h.canonical.y/a,R=(h.canonical.y+1)/a;let N=t._centerAltitude;if(y){const Q=y.getMinMaxForTile(h);Q&&Q.max>N&&(N=Q.max)}const U=n.aA(d.x,b,S)-d.x,Y=n.aA(d.y,M,R)-d.y,X=n.cf(N,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(U*U+Y*Y+X*X))}function kd(h,t,a,d,y,b,S){const M=h.context,R=h.renderPass==="shadow",N=h.shadowRenderer,U=R&&N?N.getShadowPassDepthMode():new xn(M.gl.LEQUAL,xn.ReadWrite,h.depthRangeFor3D),Y=h.isTileAffectedByFog(b),X=h.transform.projection.name==="globe";if(a.meshes)for(const Q of a.meshes){const ae=X?[]:["MODEL_POSITION_ON_GPU"],ie=[];let _e,fe,Te;const De=!X&&d.instancedDataArray.length>20;De&&ae.push("INSTANCED_ARRAYS");const Se=sh(h,t.paint.get("model-cutoff-fade-range"));if(Se.shouldRenderCutoff&&ae.push("RENDER_CUTOFF"),R&&N)_e=h.getOrCreateProgram("modelDepth",{defines:ae}),fe=Co(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(a.globalMatrix)),Te=N.getShadowPassColorMode();else{rp(ae,ie,Q,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),_e=h.getOrCreateProgram("model",{defines:ae,overrideFog:Y});const Ve=Q.material,Ge=Ve.pbrMetallicRoughness,Fe=t.paint.get("model-opacity").constantOr(1),Oe=t.paint.get("model-emissive-strength").constantOr(0);fe=Ms(b.expandedProjMatrix,Float32Array.from(a.globalMatrix),new Float32Array(16),null,h,Fe,Ge.baseColorFactor,Ve.emissiveFactor,Ge.metallicFactor,Ge.roughnessFactor,Ve,Oe,t,y),N&&(S.shadowUniformsInitialized?_e.setShadowUniformValues(M,N.getShadowUniformValues()):(N.setupShadows(b.toUnwrapped(),_e,"model-tile"),S.shadowUniformsInitialized=!0)),Te=Se.shouldRenderCutoff||Fe<1||Ve.alphaMode!=="OPAQUE"?cr.alphaBlended:cr.unblended}h.uploadCommonUniforms(M,_e,b.toUnwrapped(),null,Se);const Ze=Q.material.doubleSided?jn.disabled:jn.backCCW;if(De)ie.push(d.instancedDataBuffer),_e.draw(h,M.gl.TRIANGLES,U,Un.disabled,Te,Ze,fe,t.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,t.paint,h.transform.zoom,void 0,ie,d.instancedDataArray.length);else{const Ve=R?"u_instance":"u_normal_matrix";for(let Ge=0;Ge<d.instancedDataArray.length;++Ge)fe[Ve]=new Float32Array(d.instancedDataArray.arrayBuffer,64*Ge,16),_e.draw(h,M.gl.TRIANGLES,U,Un.disabled,Te,Ze,fe,t.id,Q.vertexBuffer,Q.indexBuffer,Q.segments,t.paint,h.transform.zoom,void 0,ie)}}if(a.children)for(const Q of a.children)kd(h,t,Q,d,y,b,S)}const uf=[1,-1,1];function Bm(h,t,a,d){if(!a.modelManager)return!0;const y=a.modelManager;if(!a.shadowRenderer)return!0;const b=a.shadowRenderer,S=t.aabb;let M=!0,R=h.maxHeight;if(R===0){let U=0;for(const Y in h.instancesPerModel){const X=y.getModel(Y,d);X?U=Math.max(U,Math.max(Math.max(X.aabb.max[0],X.aabb.max[1]),X.aabb.max[2])):M=!1}R=h.maxScale*U*1.41+h.maxVerticalOffset,M&&(h.maxHeight=R)}S.max[2]=R,S.min[2]+=h.terrainElevationMin,S.max[2]+=h.terrainElevationMax,n.af(S.min,S.min,t.tileMatrix),n.af(S.max,S.max,t.tileMatrix);const N=S.intersects(b.getCurrentCascadeFrustum());return a.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=N===2),N===0}function Wa(h,t){const a=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],y=h.uniformValues.u_cutoff_params[2],b=h.uniformValues.u_cutoff_params[3];return d===a||b===y?1:n.aA(((t-a)/(d-a)-y)/(b-y),0,1)}function Zr(h,t,a,d){if(t.pitch<20)return 1;const y=t.getWorldToCameraMatrix();n.aB(y,y,h);const b=n.bU(a.min[0],a.min[1],a.min[2],1);let S=n.aC(n.eG(),b,y),M=S,R=S;b[1]=a.max[1],S=n.aC(n.eG(),b,y),M=S[1]<M[1]?S:M,R=S[1]>R[1]?S:R,b[0]=a.max[0],S=n.aC(n.eG(),b,y),M=S[1]<M[1]?S:M,R=S[1]>R[1]?S:R,b[1]=a.min[1],S=n.aC(n.eG(),b,y),M=S[1]<M[1]?S:M,R=S[1]>R[1]?S:R;const N=n.aA(d[0],0,1),U=100*t.pixelsPerMeter*n.aA(d[1],0,1),Y=n.aA(d[2],0,1),X=n.eH(n.eG(),M,R,N),Q=Math.tan(.5*t.fovX),ae=-X[2]*Q;if(U===0)return X[1]<-Math.abs(ae)?Y:1;const ie=(-Math.abs(ae)-X[1])/U,_e=(Te,De,Se)=>(1-Se)*Te+Se*De,fe=n.aA(_e(1,Y,ie),Y,1);return _e(1,fe,n.aA((t.pitch-20)/20,0,1))}class sp{}class hf{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,a,d){{const Y=this._storage.get(a.id);if(Y)return Y.lastUsedFrameIdx=t,Y.buf}const y=d.gl,b=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),S=new ArrayBuffer(b),M=new Int16Array(S);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const R=new n.eJ;for(let Y=0;Y<b/2;Y+=3){const X=M[Y],Q=M[Y+1],ae=M[Y+2];R.emplaceBack(X,Q),R.emplaceBack(Q,ae),R.emplaceBack(ae,X)}const N=d.bindVertexArrayOES.current,U=new sp;return U.buf=new Nl(d,R),U.lastUsedFrameIdx=t,this._storage.set(a.id,U),d.bindVertexArrayOES.set(N),U.buf}update(t){for(const[a,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(a))}destroy(){for(const[t,a]of this._storage)a.buf.destroy(),this._storage.delete(t)}}class Od{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const df=n.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Zh{constructor(t){this.revealStart=11,this.revealRange=2}}const Lp=n.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class op{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,a){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new n.eK,M=new n.b0;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),M.emplaceBack(0,1,2),M.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(S,Lp.members),this.vignetteIdx=t.context.createIndexBuffer(M)}const y=n.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const S={u_vignetteShape:(b={vignetteShape:[a.start,a.range,Math.pow(10,a.fadePower)],vignetteColor:[a.color.r,a.color.g,a.color.b,a.color.a*a.strength]}).vignetteShape,u_vignetteColor:b.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,xn.disabled,Un.disabled,cr.alphaBlended,jn.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,y)}var b}}class kp{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,a){const d=t.getFreeCameraOptions().position,y=d.toAltitude(),b=d.toLngLat(),S=n.an(b.lng),M=n.an(b.lat),R=t.pixelsPerMeter/a,N=S*n.eM,U=n.eM*Math.log(Math.tan(Math.PI/4+M/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const Y=-this._offsetYPrev+U,X=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+N)*R,this._accumulatedOffsetY+=Y*R,this._accumulatedElevation+=X*R,this._offsetXPrev=N,this._offsetYPrev=U,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function lp(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function bc(h){const t=n.eq(1323123451230),a=[];for(let d=0;d<h;++d){const y=2*t()-1,b=2*t()-1,S=2*t()-1;a.push(n.d5(y,b,S))}return a}function go(h,t,a,d,y){const b=n.aA((y-a)/(d-a),0,1);return(1-b)*h+b*t}class ph{constructor(t){this._movement=new kp,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new op,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,a){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const y=d.starsProjMatrix,b=n.c7([]);n.c9(b,b,n.an(90)-d._pitch),n.c8(b,b,-d.angle);const S=n.cc(new Float32Array(16),b),M=n.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),R=n.eg([],M),N=n.aB([],R,S),U=Date.now()/1e3;return this._accumulatedTimeFromStart+=(U-this._prevTime)*a,this._prevTime=U,{projectionMatrix:y,modelviewMatrix:N}}}class ff extends ph{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Zh("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const d=bc(this.particlesCount),y=new n.eN,b=new n.b0;let S=0;const M=n.eq(1323123451230);for(let R=0;R<d.length;++R){const N=d[R],U=[2*M()-1,M(),M(),M()];y.emplaceBack(N[0],N[1],N[2],-1,-1,...U),y.emplaceBack(N[0],N[1],N[2],1,-1,...U),y.emplaceBack(N[0],N[1],N[2],1,1,...U),y.emplaceBack(N[0],N[1],N[2],-1,1,...U),b.emplaceBack(S+0,S+1,S+2),b.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=a.createVertexBuffer(y,df.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const a=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(a.revealStart>d)return;const y=go(0,1,a.revealStart,a.revealStart+a.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const b=structuredClone(this._params);let S=[-b.direction.x,b.direction.y,-100];n.aw(S,S);const M=structuredClone(this._vignetteParams);M.strength*=y,b.overrideStyleParameters||(b.intensity=t.style.rain.state.density,b.timeFactor=t.style.rain.state.intensity,b.color=structuredClone(t.style.rain.state.color),S=structuredClone(t.style.rain.state.direction),b.screenThinning.intensity=t.style.rain.state.centerThinning,b.dropletSizeX=t.style.rain.state.dropletSize[0],b.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],b.distortionStrength=100*t.style.rain.state.distortionStrength,M.strength=1,M.color=structuredClone(t.style.rain.state.vignetteColor));const R=this.updateOnRender(t,b.timeFactor),N=t.context,U=N.gl,Y=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new n.T(N,{width:t.width,height:t.height,data:null},U.RGBA8)),b.distortionStrength>0&&(N.activeTexture.set(U.TEXTURE0),this.screenTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),U.copyTexSubImage2D(U.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const X=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(N,X),N.activeTexture.set(U.TEXTURE0),this.screenTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE);const Q=[b.color.r,b.color.g,b.color.b,b.color.a],ae=(ie,_e)=>{const fe=lp(this._movement.getPosition(),ie),Te=b.dropletSizeX,De=b.dropletSizeX*b.dropletSizeYScale,Se=t.width/2,Ze=t.height/2,Ve=go(0,b.screenThinning.start,0,1,b.screenThinning.intensity),Ge=go(.001,b.screenThinning.range,0,1,b.screenThinning.intensity),Fe=go(0,b.screenThinning.particleOffset,0,1,b.screenThinning.intensity),Oe=(it={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:fe,velocityConeAperture:b.velocityConeAperture,velocity:b.velocity,boxSize:ie,rainDropletSize:[Te,De],distortionStrength:b.distortionStrength,rainDirection:S,color:Q,screenSize:[Y.width,Y.height],thinningCenterPos:[Se,Ze],thinningShape:[Ve,Ge,Math.pow(10,b.screenThinning.fadePower)],thinningAffectedRatio:b.screenThinning.affectedRatio,thinningParticleOffset:Fe,shapeDirectionalPower:b.shapeDirPower,shapeNormalPower:b.shapeNormalPower,mode:_e?0:1},{u_modelview:Float32Array.from(it.modelview),u_projection:Float32Array.from(it.projection),u_time:it.time,u_cam_pos:it.camPos,u_texScreen:0,u_velocityConeAperture:it.velocityConeAperture,u_velocity:it.velocity,u_boxSize:it.boxSize,u_rainDropletSize:it.rainDropletSize,u_distortionStrength:it.distortionStrength,u_rainDirection:it.rainDirection,u_color:it.color,u_screenSize:it.screenSize,u_thinningCenterPos:it.thinningCenterPos,u_thinningShape:it.thinningShape,u_thinningAffectedRatio:it.thinningAffectedRatio,u_thinningParticleOffset:it.thinningParticleOffset,u_shapeDirectionalPower:it.shapeDirectionalPower,u_shapeNormalPower:it.shapeNormalPower,u_mode:it.mode});var it;const ft=Math.round(b.intensity*this.particlesCount),ht=n.bg.simpleSegment(0,0,4*ft,2*ft);X.draw(t,U.TRIANGLES,xn.disabled,Un.disabled,cr.alphaBlended,jn.disabled,Oe,"rain_particles",this.particlesVx,this.particlesIdx,ht)};b.distortionStrength>0&&ae(b.boxSize,!0),ae(b.boxSize,!1),this._vignette.draw(t,M)}}const cp=n.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Op extends ph{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Zh("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const a=t.context;if(!this.particlesVx){const d=bc(this.particlesCount),y=new n.eO,b=new n.b0;let S=0;const M=n.eq(1323123451230);for(let R=0;R<d.length;++R){const N=d[R],U=M(),Y=M(),X=M(),Q=[R/d.length,U,Y,X],ae=[M(),M()];y.emplaceBack(N[0],N[1],N[2],-1,-1,...Q,...ae),y.emplaceBack(N[0],N[1],N[2],1,-1,...Q,...ae),y.emplaceBack(N[0],N[1],N[2],1,1,...Q,...ae),y.emplaceBack(N[0],N[1],N[2],-1,1,...Q,...ae),b.emplaceBack(S+0,S+1,S+2),b.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=a.createVertexBuffer(y,cp.members),this.particlesIdx=a.createIndexBuffer(b)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const a=structuredClone(this._params);let d=[-a.direction.x,a.direction.y,-100];n.aw(d,d);const y=structuredClone(this._vignetteParams),b=a.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=t.transform.zoom;if(b.revealStart>S)return;const M=go(0,1,b.revealStart,b.revealStart+b.revealRange,S);y.strength*=M,a.overrideStyleParameters||(a.intensity=t.style.snow.state.density,a.timeFactor=t.style.snow.state.intensity,a.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),a.screenThinning.intensity=t.style.snow.state.centerThinning,a.billboardSize=2.79*t.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(t.style.snow.state.vignetteColor));const R=this.updateOnRender(t,a.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const N=t.context,U=N.gl,Y=t.transform,X=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(N,X),((Q,ae,ie)=>{const _e=lp(this._movement.getPosition(),Q),fe=Y.width/2,Te=Y.height/2,De=go(0,ie.screenThinning.start,0,1,ie.screenThinning.intensity),Se=go(.001,ie.screenThinning.range,0,1,ie.screenThinning.intensity),Ze=go(0,ie.screenThinning.particleOffset,0,1,ie.screenThinning.intensity),Ve=(Ge={modelview:R.modelviewMatrix,projection:R.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:_e,velocityConeAperture:ie.velocityConeAperture,velocity:ie.velocity,horizontalOscillationRadius:ie.horizontalOscillationRadius,horizontalOscillationRate:ie.horizontalOscillationRate,boxSize:Q,billboardSize:1*ie.billboardSize,simpleShapeParameters:[ie.shapeFadeStart,ie.shapeFadePower],screenSize:[Y.width,Y.height],thinningCenterPos:[fe,Te],thinningShape:[De,Se,Math.pow(10,ie.screenThinning.fadePower)],thinningAffectedRatio:ie.screenThinning.affectedRatio,thinningParticleOffset:Ze,color:[ie.color.r,ie.color.g,ie.color.b,ie.color.a],direction:d},{u_modelview:Float32Array.from(Ge.modelview),u_projection:Float32Array.from(Ge.projection),u_time:Ge.time,u_cam_pos:Ge.camPos,u_velocityConeAperture:Ge.velocityConeAperture,u_velocity:Ge.velocity,u_horizontalOscillationRadius:Ge.horizontalOscillationRadius,u_horizontalOscillationRate:Ge.horizontalOscillationRate,u_boxSize:Ge.boxSize,u_billboardSize:Ge.billboardSize,u_simpleShapeParameters:Ge.simpleShapeParameters,u_screenSize:Ge.screenSize,u_thinningCenterPos:Ge.thinningCenterPos,u_thinningShape:Ge.thinningShape,u_thinningAffectedRatio:Ge.thinningAffectedRatio,u_thinningParticleOffset:Ge.thinningParticleOffset,u_particleColor:Ge.color,u_direction:Ge.direction});var Ge;const Fe=Math.round(ie.intensity*this.particlesCount),Oe=n.bg.simpleSegment(0,0,4*Fe,2*Fe);this.particlesVx&&this.particlesIdx&&X.draw(t,U.TRIANGLES,xn.disabled,Un.disabled,cr.alphaBlended,jn.disabled,Ve,"snow_particles",this.particlesVx,this.particlesIdx,Oe)})(a.boxSize,0,a),this._vignette.draw(t,y)}}const Bd={symbol:function(h,t,a,d,y){if(h.renderPass!=="translucent")return;const b=Un.disabled,S=h.colorModeForRenderPass(),M=a.layout.get("text-variable-anchor"),R=a.layout.get("text-size-scale-range"),N=n.aA(h.scaleFactor,R[0],R[1]);M&&(function(X,Q,ae,ie,_e,fe,Te,De){const Se=Q.transform,Ze=_e==="map",Ve=fe==="map";for(const Ge of X){const Fe=ie.getTile(Ge),Oe=Fe.getBucket(ae);if(!Oe||!Oe.text||!Oe.text.segments.get().length)continue;const it=n.bK(Oe.textSizeData,Se.zoom,De),ft=Dl(Ge,Oe.getProjection(),Se),ht=Se.calculatePixelsToTileUnitsMatrix(Fe),St=Rl(ft,Fe.tileID.canonical,Ve,Ze,Se,Oe.getProjection(),ht),It=Oe.hasIconTextFit()&&Oe.hasIconData();it&&mn(Oe,Ze,Ve,Te,Se,St,Ge,Math.pow(2,Se.zoom-Fe.tileID.overscaledZ),it,It)}})(d,h,a,t,a.layout.get("text-rotation-alignment"),a.layout.get("text-pitch-alignment"),y,N);const U=a.paint.get("icon-opacity").constantOr(1)!==0,Y=a.paint.get("text-opacity").constantOr(1)!==0;a.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(U||Y)?_o(h,t,a,d,b,S):(U&&_o(h,t,a,d,b,S,{onlyIcons:!0}),Y&&_o(h,t,a,d,b,S,{onlyText:!0})),t.map.showCollisionBoxes&&(di(h,t,a,d,a.paint.get("text-translate"),a.paint.get("text-translate-anchor"),!0),di(h,t,a,d,a.paint.get("icon-translate"),a.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,a,d){if(h.renderPass!=="translucent")return;const y=a.paint.get("circle-opacity"),b=a.paint.get("circle-stroke-width"),S=a.paint.get("circle-stroke-opacity"),M=a.layout.get("circle-sort-key").constantOr(1)!==void 0,R=a.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(b.constantOr(1)===0||S.constantOr(1)===0))return;const N=h.context,U=N.gl,Y=h.transform,X=!(!h.terrain||!h.terrain.enabled),Q=a.layout.get("circle-elevation-reference"),ae=h.depthModeForSublayer(0,xn.ReadOnly),ie=new xn(h.context.gl.LEQUAL,xn.ReadOnly,h.depthRangeFor3D),_e=Q==="none"||X?ae:ie,fe=Un.disabled,Te=h.colorModeForDrapableLayerRenderPass(R),De=Y.projection.name==="globe",Se=[n.aF(Y.center.lng),n.aJ(Y.center.lat)],Ze=[];for(let Ge=0;Ge<d.length;Ge++){const Fe=d[Ge],Oe=t.getTile(Fe),it=Oe.getBucket(a);if(!it||it.projection.name!==Y.projection.name)continue;const ft=it.programConfigurations.get(a.id),ht=it.layoutVertexBuffer,St=it.globeExtVertexBuffer,It=it.indexBuffer,zt=n.e0(a),Jt=[St],gt=h.isTileAffectedByFog(Fe);De&&zt.push("PROJECTION_GLOBE_VIEW"),zt.push("DEPTH_D24"),h.terrain&&Y.depthOcclusionForSymbolsAndCircles&&zt.push("DEPTH_OCCLUSION"),it.hasElevation&&!h.terrain&&(zt.push("ELEVATED_ROADS"),Jt.push(it.elevatedLayoutVertexBuffer));const nt=h.getOrCreateProgram("circle",{config:ft,defines:zt,overrideFog:gt}),Bt=Y.projection.createInversionMatrix(Y,Fe.canonical),Dt={programConfiguration:ft,program:nt,layoutVertexBuffer:ht,dynamicBuffers:Jt,indexBuffer:It,uniformValues:n.e1(h,Fe,Oe,Bt,Se,a),tile:Oe};if(M){const li=it.segments.get();for(const Ei of li)Ze.push({segments:new n.bg([Ei]),sortKey:Ei.sortKey,state:Dt})}else Ze.push({segments:it.segments,sortKey:0,state:Dt})}M&&Ze.sort(((Ge,Fe)=>Ge.sortKey-Fe.sortKey));const Ve={useDepthForOcclusion:Y.depthOcclusionForSymbolsAndCircles};for(const Ge of Ze){const{programConfiguration:Fe,program:Oe,layoutVertexBuffer:it,dynamicBuffers:ft,indexBuffer:ht,uniformValues:St,tile:It}=Ge.state,zt=Ge.segments;h.terrain&&h.terrain.setupElevationDraw(It,Oe,Ve),h.uploadCommonUniforms(N,Oe,It.tileID.toUnwrapped()),Oe.draw(h,U.TRIANGLES,_e,fe,Te,jn.disabled,St,a.id,it,ht,zt,a.paint,Y.zoom,Fe,ft)}},heatmap:function(h,t,a,d){if(a.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const y=h.context,b=y.gl,S=Un.disabled,M=new cr([b.ONE,b.ONE,b.ONE,b.ONE],n.ao.transparent,[!0,!0,!0,!0]);(function(Q,ae,ie,_e){const fe=Q.gl,Te=ae.width*_e,De=ae.height*_e;Q.activeTexture.set(fe.TEXTURE1),Q.viewport.set([0,0,Te,De]);let Se=ie.heatmapFbo;if(!Se||Se&&(Se.width!==Te||Se.height!==De)){Se&&Se.destroy();const Ze=fe.createTexture();fe.bindTexture(fe.TEXTURE_2D,Ze),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MAG_FILTER,fe.LINEAR),Se=ie.heatmapFbo=Q.createFramebuffer(Te,De,1,null),(function(Ve,Ge,Fe,Oe,it,ft){const ht=Ve.gl;ht.texImage2D(ht.TEXTURE_2D,0,Ve.extRenderToTextureHalfFloat?ht.RGBA16F:ht.RGBA,it,ft,0,ht.RGBA,Ve.extRenderToTextureHalfFloat?ht.HALF_FLOAT:ht.UNSIGNED_BYTE,null),Oe.colorAttachment0.set(Fe)})(Q,0,Ze,Se,Te,De)}else fe.bindTexture(fe.TEXTURE_2D,Se.colorAttachment0.get()),Q.bindFramebuffer.set(Se.framebuffer)})(y,h,a,h.transform.projection.name==="globe"?.5:.25),y.clear({color:n.ao.transparent});const R=h.transform,N=R.projection.name==="globe",U=N?["PROJECTION_GLOBE_VIEW"]:[],Y=N?jn.frontCCW:jn.disabled,X=[n.aF(R.center.lng),n.aJ(R.center.lat)];for(let Q=0;Q<d.length;Q++){const ae=d[Q];if(t.hasRenderableParent(ae))continue;const ie=t.getTile(ae),_e=ie.getBucket(a);if(!_e||_e.projection.name!==R.projection.name)continue;const fe=h.isTileAffectedByFog(ae),Te=_e.programConfigurations.get(a.id),De=h.getOrCreateProgram("heatmap",{config:Te,defines:U,overrideFog:fe}),{zoom:Se}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ie,De),h.uploadCommonUniforms(y,De,ae.toUnwrapped());const Ze=R.projection.createInversionMatrix(R,ae.canonical);De.draw(h,b.TRIANGLES,xn.disabled,S,M,Y,ir(h,ae,ie,Ze,X,Se,a.paint.get("heatmap-intensity")),a.id,_e.layoutVertexBuffer,_e.indexBuffer,_e.segments,a.paint,h.transform.zoom,Te,N?[_e.globeExtVertexBuffer]:null)}y.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),(function(y,b){const S=y.context,M=S.gl,R=b.heatmapFbo;if(!R)return;S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,R.colorAttachment0.get()),S.activeTexture.set(M.TEXTURE1);let N=b.colorRampTexture;N||(N=b.colorRampTexture=new n.T(S,b.colorRamp,M.RGBA8)),N.bind(M.LINEAR,M.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,M.TRIANGLES,xn.disabled,Un.disabled,y.colorModeForRenderPass(),jn.disabled,((U,Y,X,Q)=>({u_image:0,u_color_ramp:1,u_opacity:Y.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)})(h,a))},line:function(h,t,a,d){if(h.renderPass!=="translucent")return;const y=a.paint.get("line-opacity"),b=a.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const S=a.paint.get("line-emissive-strength").isConstant(),M=a.paint.get("line-emissive-strength").constantOr(0),R=a.paint.get("line-occlusion-opacity"),N=a.layout.get("line-elevation-reference"),U=a.layout.get("line-width-unit")==="meters",Y=N==="sea",X=!(!h.terrain||!h.terrain.enabled),Q=h.context,ae=Q.gl;if(a.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const ie=a.layout.get("line-cross-slope"),_e=ie!==void 0,fe=ie<1,Te=h.colorModeForDrapableLayerRenderPass(S?M:null),De=h.terrain&&h.terrain.renderingToTexture,Se=De?1:n.o.devicePixelRatio,Ze=a.paint.get("line-dasharray"),Ve=Ze.constantOr(1),Ge=a.layout.get("line-cap"),Fe=Ze.constantOr(null),Oe=Ge.constantOr(null),it=a.paint.get("line-pattern"),ft=it.constantOr(1),ht=a.paint.get("line-pattern-cross-fade"),St=it.constantOr(null),It=a.paint.get("line-opacity").constantOr(1);let zt=!ft&&It!==1||h.depthOcclusion&&R>0&&R<1;const Jt=a.paint.get("line-gradient"),gt=ft?"linePattern":"line",nt=n.e2(a);let Bt;if(De&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(zt=!1),R!==0&&h.depthOcclusion){const Ri=a.paint._values["line-opacity"];Ri&&Ri.value&&Ri.value.kind==="constant"?Bt=Ri.value:n.w(`Occlusion opacity for layer ${a.id} is supported only when line-opacity isn't data-driven.`)}b.value.kind!=="constant"&&b.value.isLineProgressConstant===!1&&nt.push("VARIABLE_LINE_WIDTH"),De&&(h.emissiveMode!=="dual-source-blending"||S?h.emissiveMode==="mrt-fallback"&&nt.push("USE_MRT1"):nt.push("DUAL_SOURCE_BLENDING"));const Dt=(Ri,Ti,mi,pn,en,ji)=>{for(const Qi of Ri){const vn=t.getTile(Qi);if(ft&&!vn.patternsLoaded())continue;const rr=vn.getBucket(a);if(!rr||rr.elevationType!=="none"&&!en||rr.elevationType==="none"&&en)continue;h.prepareDrawTile();const Br=[...Ti],ba=h.shadowRenderer,_n=rr.elevationType==="road"&&!!ba&&ba.enabled;let aa=[0,0,0];if(_n){const gr=h.style.directionalLight,fa=h.style.ambientLight;gr&&fa&&(aa=Lc(h.style,gr,fa)),Br.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const Qn=rr.programConfigurations.get(a.id);let yr=!1;if(St&&vn.imageAtlas){const gr=n.e3.from(St),fa=gr.getPrimary().scaleSelf(Se).toString(),bs=vn.imageAtlas.patternPositions.get(fa),ws=gr.getSecondary(),qa=ws?vn.imageAtlas.patternPositions.get(ws.scaleSelf(Se).toString()):null;yr=!!bs&&!!qa,bs&&Qn.setConstantPatternPositions(bs,qa)}ht>0&&(yr||Qn.getPatternTransitionVertexBuffer("line-pattern"))&&Br.push("LINE_PATTERN_TRANSITION");const Gr=h.isTileAffectedByFog(Qi),Kr=h.getOrCreateProgram(gt,{config:Qn,defines:Br,overrideFog:Gr});if(!ft&&Fe&&Oe&&vn.lineAtlas){const gr=vn.lineAtlas.getDash(Fe,Oe);gr&&Qn.setConstantPatternPositions(gr)}_n&&ba.setupShadows(vn.tileID.toUnwrapped(),Kr,"vector-tile");let[qr,mr]=a.paint.get("line-trim-offset");(Oe==="round"||Oe==="square")&&qr!==mr&&(qr===0&&(qr-=1),mr===1&&(mr+=1));const wa=De?Qi.projMatrix:null,Bs=U?1/rr.tileToMeter/n.ay(vn,1,h.transform.zoom):1,Ga=U?1/rr.tileToMeter/n.ay(vn,1,Math.floor(h.transform.zoom)):1,ya=ft?n.e4(h,vn,a,wa,Se,Bs,Ga,[qr,mr],aa,ht):n.e5(h,vn,a,wa,rr.lineClipsArray.length,Se,Bs,Ga,[qr,mr],aa);if(Jt){const gr=rr.gradients[a.id];let fa=gr.texture;if(a.gradientVersion!==gr.version){let bs=256;if(a.stepInterpolant){const ws=t.getSource().maxzoom,qa=Qi.canonical.z===ws?Math.ceil(1<<h.transform.maxZoom-Qi.canonical.z):1;bs=n.aA(n.e6(rr.maxLineLength/n.al*1024*qa),256,Q.maxTextureSize)}gr.gradient=n.e7({expression:a.gradientExpression(),evaluationKey:"lineProgress",resolution:bs,image:gr.gradient||void 0,clips:rr.lineClipsArray}),gr.texture?gr.texture.update(gr.gradient):gr.texture=new n.T(Q,gr.gradient,ae.RGBA8),gr.version=a.gradientVersion,fa=gr.texture}Q.activeTexture.set(ae.TEXTURE1),fa.bind(a.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}Ve&&(Q.activeTexture.set(ae.TEXTURE0),vn.lineAtlasTexture&&vn.lineAtlasTexture.bind(ae.LINEAR,ae.REPEAT),Qn.updatePaintBuffers()),ft&&(Q.activeTexture.set(ae.TEXTURE0),vn.imageAtlasTexture&&vn.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Qn.updatePaintBuffers()),en&&!Y&&h.terrain.setupElevationDraw(vn,Kr),h.uploadCommonUniforms(Q,Kr,Qi.toUnwrapped());const Sr=gr=>{Bt!=null&&(Bt.value=It*R),Kr.draw(h,ae.TRIANGLES,mi,gr,Te,jn.disabled,ya,a.id,rr.layoutVertexBuffer,rr.indexBuffer,rr.segments,a.paint,h.transform.zoom,Qn,[rr.layoutVertexBuffer2,rr.patternVertexBuffer,rr.zOffsetVertexBuffer]),Bt!=null&&(Bt.value=It)};if(zt&&!en){const gr=h.stencilModeForClipping(Qi).ref;gr===0&&De&&Q.clear({stencil:0});const fa={func:ae.EQUAL,mask:255};ya.u_alpha_discard_threshold=.8,Sr(new Un(fa,gr,255,ae.KEEP,ae.KEEP,ae.INVERT)),ya.u_alpha_discard_threshold=0,Sr(new Un(fa,gr,255,ae.KEEP,ae.KEEP,ae.KEEP))}else ya.u_alpha_discard_threshold=zt&&en&&ji?.8:0,Sr(en?pn:h.stencilModeForClipping(Qi))}};let li=h.depthModeForSublayer(0,xn.ReadOnly);const Ei=new xn(h.depthOcclusion?ae.GREATER:ae.LEQUAL,xn.ReadOnly,h.depthRangeFor3D);if(a.hasNonElevatedBuckets){const Ri=!De&&h.terrain;R!==0&&Ri?n.w(`Occlusion opacity for layer ${a.id} is supported on terrain only if the layer has line-z-offset enabled.`):Ri?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${a.id}.`):Dt(d,nt,li,Un.disabled,!1,!0)}if(a.hasElevatedBuckets){N==="hd-road-markup"?X||(li=Ei,nt.push("ELEVATED_ROADS")):(nt.push("ELEVATED"),li=Ei,_e&&nt.push(fe?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),Y&&nt.push("ELEVATION_REFERENCE_SEA"));const Ri=zt?h.stencilModeFor3D():Un.disabled;h.forceTerrainMode=!0,Dt(d,nt,li,Ri,!0,!0),zt&&Dt(d,nt,li,Ri,!0,!1),h.forceTerrainMode=!1}zt&&(h.resetStencilClippingMasks(),De&&Q.clear({stencil:0})),R===0||h.depthOcclusion||De||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,a,d){const y=a.paint.get("fill-color"),b=a.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const S=a.paint.get("fill-emissive-strength"),M=h.colorModeForDrapableLayerRenderPass(S),R=a.paint.get("fill-pattern"),N=h.opaquePassEnabledForLayer()&&!R.constantOr(1)&&y.constantOr(n.ao.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";let U="none";a.layout.get("fill-elevation-reference")!=="none"?U="road":a.paint.get("fill-z-offset").constantOr(1)!==0&&(U="offset");const Y=!(!h.terrain||!h.terrain.enabled),X={painter:h,sourceCache:t,layer:a,coords:d,colorMode:M,elevationType:U,terrainEnabled:Y,pass:N};if(h.renderPass==="shadow")return void(h.shadowRenderer&&U==="road"&&!Y&&(function(ae){const{painter:ie,sourceCache:_e,layer:fe,coords:Te}=ae,De=ie.context.gl,Se=ae.painter.shadowRenderer;for(const Ze of Te){const Ve=_e.getTile(Ze),Ge=Ve.getBucket(fe);if(!Ge)continue;const Fe=Ge.elevatedStructures;if(!Fe||!Fe.shadowCasterSegments||Fe.shadowCasterSegments.segments[0].primitiveLength===0)continue;ie.prepareDrawTile();const Oe=Ge.bufferData.programConfigurations.get(fe.id),it=ie.isTileAffectedByFog(Ze),ft=ie.getOrCreateProgram("elevatedStructuresDepth",{config:Oe,overrideFog:it}),ht=Se.calculateShadowPassMatrixFromTile(Ve.tileID.toUnwrapped());ie.uploadCommonUniforms(ie.context,ft,Ze.toUnwrapped());const St={u_matrix:ht,u_depth_bias:0};ft.draw(ie,De.TRIANGLES,Se.getShadowPassDepthMode(),Un.disabled,Se.getShadowPassColorMode(),jn.disabled,St,fe.id,Fe.vertexBuffer,Fe.indexBuffer,Fe.shadowCasterSegments,fe.paint,ie.transform.zoom,Oe)}})(X));const Q=h.emissiveMode==="mrt-fallback";if(U!=="offset"){if(jh(X,!1,Q),U==="road"){const ae=!Y&&h.renderPass==="translucent";ae&&gc(h,t,a,d,"geometry"),jh(X,!0,Q,Un.disabled),ae&&(function(ie){const{painter:_e,sourceCache:fe,layer:Te,coords:De,colorMode:Se}=ie,Ze=_e.context.gl,Ve=ie.painter.shadowRenderer,Ge=!!Ve&&Ve.enabled,Fe=new xn(_e.context.gl.LEQUAL,xn.ReadOnly,_e.depthRangeFor3D);let Oe=[0,0,0];if(Ge){const ft=_e.style.directionalLight,ht=_e.style.ambientLight;ft&&ht&&(Oe=Lc(_e.style,ft,ht))}const it=ft=>{for(const ht of De){const St=fe.getTile(ht),It=St.getBucket(Te);if(!It)continue;const zt=It.elevatedStructures;if(!zt)continue;let Jt,gt;if(ft?(Jt=zt.renderableBridgeSegments,gt=zt.bridgeProgramConfigurations.get(Te.id)):(Jt=zt.renderableTunnelSegments,gt=zt.tunnelProgramConfigurations.get(Te.id)),!Jt||Jt.segments[0].primitiveLength===0)continue;gt.updatePaintBuffers(),_e.prepareDrawTile();const nt=_e.isTileAffectedByFog(ht),Bt=[];Ge&&Bt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Dt=_e.getOrCreateProgram("elevatedStructures",{config:gt,overrideFog:nt,defines:Bt}),li=_e.translatePosMatrix(ht.projMatrix,St,Te.paint.get("fill-translate"),Te.paint.get("fill-translate-anchor"));Ge&&Ve.setupShadows(St.tileID.toUnwrapped(),Dt,"vector-tile");const Ei=Qt(li,Oe);_e.uploadCommonUniforms(_e.context,Dt,ht.toUnwrapped()),Dt.draw(_e,Ze.TRIANGLES,Fe,Un.disabled,Se,jn.backCCW,Ei,Te.id,zt.vertexBuffer,zt.indexBuffer,Jt,Te.paint,_e.transform.zoom,gt,[zt.vertexBufferNormal])}};it(!0),it(!1)})(X)}}else jh(X,!1,Q,h.stencilModeFor3D())},"fill-extrusion":function(h,t,a,d){const y=a.paint.get("fill-extrusion-opacity"),b=h.context,S=b.gl,M=h.terrain,R=M&&M.renderingToTexture;if(y===0)return;const N=h.emissiveMode==="mrt-fallback",U=h.conflationActive&&h.style.isLayerClipped(a,t.getSource()),Y=h.style.order.indexOf(a.fqid);if(U&&(function(X,Q,ae,ie,_e){for(const fe of ie){const Te=Q.getTile(fe).getBucket(ae);Te&&(Te.updateReplacement(fe,X.replacementSource,_e),Te.uploadCentroid(X.context))}})(h,t,a,d,Y),M||U)for(const X of d){const Q=t.getTile(X).getBucket(a);Q&&Dp(h.context,t,X,Q,a,M,U)}if(h.renderPass==="shadow"&&h.shadowRenderer){const X=h.shadowRenderer;if(M&&y<.65&&a._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.ad)return;const Q=X.getShadowPassDepthMode(),ae=X.getShadowPassColorMode();$s(h,t,a,d,Q,Un.disabled,ae,U)}else if(h.renderPass==="translucent"){const X=!a.paint.get("fill-extrusion-pattern").constantOr(1),Q=a.paint.get("fill-extrusion-color").constantOr(n.ao.white);if(!R&&Q.a!==0){const ae=new xn(h.context.gl.LEQUAL,xn.ReadWrite,h.depthRangeFor3D);y===1&&X?$s(h,t,a,d,ae,Un.disabled,cr.unblended,U):($s(h,t,a,d,ae,Un.disabled,cr.disabled,U),$s(h,t,a,d,ae,h.stencilModeFor3D(),h.colorModeForRenderPass(),U),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&X&&(!M&&h.transform.projection.name!=="globe"||R)){const ae=a.paint.get("fill-extrusion-opacity"),ie=a.paint.get("fill-extrusion-ambient-occlusion-intensity"),_e=a.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),fe=a.paint.get("fill-extrusion-flood-light-intensity"),Te=a.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",De=a.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Te?null:a.lut).toArray01().slice(0,3),Se=ie>0&&_e>0,Ze=fe>0,Ve=(Oe,it,ft)=>(1-ft)*Oe+ft*it,Ge=new af;Ge.translate=a.paint.get("fill-extrusion-translate"),Ge.translateAnchor=a.paint.get("fill-extrusion-translate-anchor"),Ge.edgeRadius=a.layout.get("fill-extrusion-edge-radius"),Ge.cutoffFadeRange=a.paint.get("fill-extrusion-cutoff-fade-range");const Fe=Oe=>{const it=h.depthModeForSublayer(1,xn.ReadOnly,S.LEQUAL,!0),ft=a.paint.get(Oe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ht=Ve(.1,3,ft),St=h._showOverdrawInspector;if(!St){const It=new Un({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),zt=new cr([S.ONE,S.ONE,S.ONE,S.ONE],n.ao.transparent,[!1,!1,!1,!0],S.MIN);Gu(Ge,h,t,a,d,it,It,zt,jn.disabled,Oe,"sdf",ae,ie,_e,fe,De,ht,U,!1)}{const It=St?Un.disabled:new Un({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),zt=St?h.colorModeForRenderPass():new cr([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],n.ao.transparent,[!0,!0,!0,!0]);Gu(Ge,h,t,a,d,it,It,zt,jn.disabled,Oe,"color",ae,ie,_e,fe,De,ht,U,!1)}};if(R){const Oe=()=>{const ft=M.drapeBufferSize[0],ht=M.drapeBufferSize[1];let St=M.framebufferCopyTexture;return St&&(!St||St.size[0]===ft&&St.size[1]===ht)||(St&&St.destroy(),St=M.framebufferCopyTexture=new n.T(b,new n.q({width:ft,height:ht}),S.RGBA8)),St.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,ft,ht),St},it=(ft,ht,St)=>{const It=h.depthModeForSublayer(1,xn.ReadOnly,S.LEQUAL,!1),zt=a.paint.get(ft?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Jt=Ve(.1,3,zt);{const gt=new cr([S.ONE,S.ONE,S.ONE,S.ONE],n.ao.transparent,[!1,!1,!1,!0]);Gu(Ge,h,t,a,d,It,Un.disabled,gt,jn.disabled,ft,"clear",ae,ie,_e,fe,De,Jt,U,ht)}{const gt=new Un({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),nt=new cr([S.ONE,S.ONE,S.ONE,S.ONE],n.ao.transparent,[!1,!1,!1,!0],S.MIN);Gu(Ge,h,t,a,d,It,gt,nt,jn.disabled,ft,"sdf",ae,ie,_e,fe,De,Jt,U,ht)}N&&!ft&&(St=Oe());{const gt=ft?S.ZERO:S.ONE_MINUS_DST_ALPHA,nt=new Un({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),Bt=new cr([gt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],n.ao.transparent,[!0,!0,!0,!0]);Gu(Ge,h,t,a,d,It,nt,Bt,jn.disabled,ft,"color",ae,ie,_e,fe,De,Jt,U,ht)}if(!N||ft){const gt=new cr([S.ONE,S.ONE,S.ONE,ft?S.ZERO:S.ONE],n.ao.transparent,[!1,!1,!1,!0],ft?S.FUNC_ADD:S.MAX);Gu(Ge,h,t,a,d,It,Un.disabled,gt,jn.disabled,ft,"clear",ae,ie,_e,fe,De,Jt,U,ht,St)}else{S.drawBuffers([S.NONE,S.COLOR_ATTACHMENT1]);const gt=new Un({func:S.EQUAL,mask:255},254,255,S.KEEP,S.DECR,S.DECR),nt=new cr([S.ONE,S.ONE,S.ONE,S.ONE],n.ao.transparent,[!0,!1,!1,!1],S.MAX);Gu(Ge,h,t,a,d,It,gt,nt,jn.disabled,ft,"emissive",ae,ie,_e,fe,De,Jt,U,ht,St),S.drawBuffers([S.COLOR_ATTACHMENT0])}};if(Se||Ze){let ft;h.prepareDrawTile(),N&&!Se||(ft=Oe()),Se&&it(!0,!1,ft),Ze&&it(!1,!0,ft)}}else Se&&Fe(!0),Ze&&Fe(!1),(Se||Ze)&&h.resetStencilClippingMasks()}}},building:function(h,t,a,d){h.currentLayer<h.firstLightBeamLayer&&(h.firstLightBeamLayer=h.currentLayer);const y=a.paint.get("building-ambient-occlusion-ground-intensity"),b=a.paint.get("building-ambient-occlusion-ground-radius"),S=a.paint.get("building-ambient-occlusion-ground-attenuation"),M=a.paint.get("building-opacity");if(M<=0)return;let R=y>0&&b>0,N=!0;const U=a.paint.get("building-vertical-scale");if(U<=0)return;h.shadowRenderer||(N=!1);const Y=h.conflationActive&&h.style.isLayerClipped(a,t.getSource()),X=h.style.order.indexOf(a.fqid);if((function(Q,ae,ie,_e,fe,Te){for(const De of Te){const Se=ae.getTile(De).getBucket(ie);Se&&(fe&&Se.updateReplacement(De,Q.replacementSource,_e),Se.uploadUpdatedIndexBuffer(Q.context))}})(h,t,a,X,Y,d),(function(Q,ae,ie,_e){for(const fe of _e){const Te=ae.getTile(fe).getBucket(ie);Te&&Te.needsEvaluation()&&Te.uploadUpdatedColorBuffer(Q.context)}})(h,t,a,d),a.resetLayerRenderingStats(h),h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0),h.renderPass==="shadow"&&h.shadowRenderer){const Q=h.shadowRenderer,ae=[],ie=Q.getShadowPassDepthMode();dh({painter:h,source:t,layer:a,coords:d,defines:ae,blendMode:Q.getShadowPassColorMode(),depthMode:ie,opacity:M,verticalScale:U,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(h.renderPass==="translucent"){let Q=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];N&&(Q=Q.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),h.shadowRenderer&&h.shadowRenderer.useNormalOffset&&(Q=Q.concat("NORMAL_OFFSET"));const ae=a.paint.get("building-facade-emissive-chance"),ie=a.paint.get("building-ambient-occlusion-intensity"),_e=a.paint.get("building-flood-light-intensity"),fe=a.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Te=a.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(fe?null:a.lut).toArray01().slice(0,3),De=a.paint.get("building-flood-light-ground-attenuation"),Se=_e>0,Ze=new xn(h.context.gl.LEQUAL,xn.ReadWrite,h.depthRangeFor3D);M<1&&dh({painter:h,source:t,layer:a,coords:d,defines:Q,blendMode:cr.disabled,depthMode:Ze,opacity:M,verticalScale:U,facadeEmissiveChance:ae,facadeAOIntensity:ie,floodLightIntensity:_e,floodLightColor:Te,depthOnly:!0});const Ve=h.colorModeForRenderPass();dh({painter:h,source:t,layer:a,coords:d,defines:Q,blendMode:Ve,depthMode:Ze,opacity:M,verticalScale:U,facadeEmissiveChance:ae,facadeAOIntensity:ie,floodLightIntensity:_e,floodLightColor:Te}),R&&Jo(h,t,a,d,!0,M,y,b,_e,Te,S,Y),Se&&Jo(h,t,a,d,!1,M,y,b,_e,Te,De,Y)}else if(h.renderPass==="light-beam"){const Q=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],ae=new xn(h.context.gl.LEQUAL,xn.ReadOnly,h.depthRangeFor3D);dh({painter:h,source:t,layer:a,coords:d,defines:Q,blendMode:cr.alphaBlended,depthMode:ae,opacity:M,verticalScale:U,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1),h.resetStencilClippingMasks()},hillshade:function(h,t,a,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const y=h.context,b=h.terrain&&h.terrain.renderingToTexture,[S,M]=h.renderPass!=="translucent"||b?[{},d]:h.stencilConfigForOverlap(d);for(const R of M){const N=t.getTile(R);if(N.needsHillshadePrepare&&h.renderPass==="offscreen")Xo(h,N,a);else if(h.renderPass==="translucent"){const U=h.depthModeForSublayer(0,xn.ReadOnly),Y=a.paint.get("hillshade-emissive-strength"),X=h.colorModeForDrapableLayerRenderPass(Y),Q=b&&h.terrain?h.terrain.stencilModeForRTTOverlap(R):S[R.overscaledZ];Jd(h,R,N,a,U,Q,X)}}y.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,a,d,y,b){if(h.renderPass!=="translucent"||a.paint.get("raster-opacity")===0)return;const S=h.transform.projection.name==="globe",M=a.paint.get("raster-elevation")!==0,R=M&&S;if(h.renderElevatedRasterBackface&&!R)return;const N=h.context,U=N.gl,Y=t.getSource(),X=(function(Ve,Ge,Fe,Oe,it){const ft=Ge.paint.get("raster-color"),ht=Ve.type==="raster-array",St=[],It=Ge.paint.get("raster-resampling"),zt=Ge.paint.get("raster-color-mix");let Jt=Ge.paint.get("raster-color-range");const gt=[zt[0],zt[1],zt[2],0],nt=zt[3];let Bt=It==="nearest"?Oe.NEAREST:Oe.LINEAR;if(ht&&(St.push("RASTER_ARRAY"),ft||St.push("RASTER_COLOR"),It==="linear"&&St.push("RASTER_ARRAY_LINEAR"),Bt=Oe.NEAREST,!Jt&&Ve.rasterLayers)){const Dt=Ve.rasterLayers.find((({id:li})=>li===Ge.sourceLayer));Dt&&Dt.fields&&Dt.fields.range&&(Jt=Dt.fields.range)}if(Jt=Jt||[0,1],ft){St.push("RASTER_COLOR"),Fe.activeTexture.set(Oe.TEXTURE2),Ge.updateColorRamp(Jt);let Dt=Ge.colorRampTexture;Dt||(Dt=Ge.colorRampTexture=new n.T(Fe,Ge.colorRamp,Oe.RGBA8)),Dt.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}return it&&St.push("USE_MRT1"),{mix:gt,range:Jt,offset:nt,defines:St,resampling:Bt}})(Y,a,N,U,h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback");if(Y instanceof n.aU&&!d.length&&!S)return;const Q=a.paint.get("raster-emissive-strength"),ae=h.colorModeForDrapableLayerRenderPass(Q),ie=h.terrain&&h.terrain.renderingToTexture,_e=!h.options.moving,fe=a.paint.get("raster-resampling")==="nearest"?U.NEAREST:U.LINEAR;if(Y instanceof n.aU&&!d.length&&(Y.onNorthPole||Y.onSouthPole)){const Ve=M?h.stencilModeFor3D():Un.disabled;return void wu(!!Y.onNorthPole,null,h,t,a,Q,X,jn.disabled,Ve)}if(!d.length)return;const[Te,De]=Y instanceof n.aU||ie?[{},d]:h.stencilConfigForOverlap(d),Se=De[De.length-1].overscaledZ;R&&X.defines.push("PROJECTION_GLOBE_VIEW"),M&&X.defines.push("RENDER_CUTOFF");const Ze=(Ve,Ge,Fe)=>{for(const Oe of Ve){const it=Oe.toUnwrapped(),ft=t.getTile(Oe);if(ie&&(!ft||!ft.hasData()))continue;N.activeTexture.set(U.TEXTURE0);const ht=qu(ft,Y,a,X);if(!ht||!ht.texture)continue;const{texture:St,mix:It,offset:zt,tileSize:Jt,buffer:gt}=ht;let nt,Bt;ie?(nt=xn.disabled,Bt=Oe.projMatrix):M?(nt=new xn(U.LEQUAL,xn.ReadWrite,h.depthRangeFor3D),Bt=S?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(it,_e)):(nt=h.depthModeForSublayer(Oe.overscaledZ-Se,a.paint.get("raster-opacity")===1?xn.ReadWrite:xn.ReadOnly,U.LESS),Bt=h.transform.calculateProjMatrix(it,_e));const Dt=h.terrain&&ie?h.terrain.stencilModeForRTTOverlap(Oe):Te[Oe.overscaledZ],li=b?0:a.paint.get("raster-fade-duration");ft.registerFadeDuration(li);const Ei=t.findLoadedParent(Oe,0),Ri=o(ft,Ei,t,h.transform,li);let Ti,mi;!Ri.isFading&&ft.refreshedUponExpiration&&(ft.refreshedUponExpiration=!1),h.terrain&&h.terrain.prepareDrawTile(),N.activeTexture.set(U.TEXTURE0),St.bind(fe,U.CLAMP_TO_EDGE),N.activeTexture.set(U.TEXTURE1),Ei?(Ei.texture&&Ei.texture.bind(fe,U.CLAMP_TO_EDGE),Ti=Math.pow(2,Ei.tileID.overscaledZ-ft.tileID.overscaledZ),mi=[ft.tileID.canonical.x*Ti%1,ft.tileID.canonical.y*Ti%1]):St.bind(fe,U.CLAMP_TO_EDGE),"useMipmap"in St&&N.extTextureFilterAnisotropic&&h.transform.pitch>20&&U.texParameterf(U.TEXTURE_2D,N.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,N.extTextureFilterAnisotropicMax);const pn=h.transform;let en;const ji=M?Dd(pn):[0,0,0,0];let Qi,vn,rr,Br,ba,_n=0;if(R&&Y instanceof n.aU&&Y.coordinates.length>3)Qi=Float32Array.from(n.bk(n.dJ(new n.cD(0,0,0)))),vn=Float32Array.from(pn.globeMatrix),rr=Float32Array.from(n.dF(pn)),Br=[n.aF(pn.center.lng),n.aJ(pn.center.lat)],en=Y.elevatedGlobePerspectiveTransform,ba=Y.elevatedGlobeGridMatrix||new Float32Array(9);else if(R){const Gr=n.dG(Oe.canonical);_n=n.dH(Gr.getCenter().lat),Qi=Float32Array.from(n.bk(n.dJ(Oe.canonical))),vn=Float32Array.from(pn.globeMatrix),rr=Float32Array.from(n.dF(pn)),Br=[n.aF(pn.center.lng),n.aJ(pn.center.lat)],en=[0,0],ba=Float32Array.from(n.dI(Oe.canonical,Gr,_n,pn.worldSize/pn._pixelsPerMercatorPixel))}else en=Y instanceof n.aU?Y.perspectiveTransform:[0,0],Qi=new Float32Array(16),vn=new Float32Array(9),rr=new Float32Array(16),Br=[0,0],ba=new Float32Array(9);const aa=qn(Bt,Qi,vn,rr,ba,mi||[0,0],n.aj(h.transform.zoom),Br,ji,Ti||1,Ri,a,en,M?a.paint.get("raster-elevation"):0,2,It,zt,X.range,Jt,gt,Q),Qn=h.isTileAffectedByFog(Oe),yr=h.getOrCreateProgram("raster",{defines:X.defines,overrideFog:Qn});if(h.uploadCommonUniforms(N,yr,it),Y instanceof n.aU){const Gr=Y.elevatedGlobeVertexBuffer,Kr=Y.elevatedGlobeIndexBuffer;if(ie||!S)Y.boundsBuffer&&Y.boundsSegments&&yr.draw(h,U.TRIANGLES,nt,Un.disabled,ae,jn.disabled,aa,a.id,Y.boundsBuffer,h.quadTriangleIndexBuffer,Y.boundsSegments);else if(Gr&&Kr){const qr=pn.zoom<=n.c_?Y.elevatedGlobeSegments:Y.getSegmentsForLongitude(pn.center.lng);qr&&yr.draw(h,U.TRIANGLES,nt,Un.disabled,ae,Ge,aa,a.id,Gr,Kr,qr)}}else if(R){nt=new xn(U.LEQUAL,xn.ReadOnly,h.depthRangeFor3D);const Gr=h.globeSharedBuffers;if(Gr){const[Kr,qr,mr]=Gr.getGridBuffers(_n,!1);yr.draw(h,U.TRIANGLES,nt,Fe||Dt,h.colorModeForRenderPass(),Ge,aa,a.id,Kr,qr,mr)}}else{const{tileBoundsBuffer:Gr,tileBoundsIndexBuffer:Kr,tileBoundsSegments:qr}=h.getTileBoundsBuffers(ft);yr.draw(h,U.TRIANGLES,nt,Dt,ae,jn.disabled,aa,a.id,Gr,Kr,qr)}}if(!(Y instanceof n.aU)&&R)for(const Oe of Ve){const it=Oe.canonical.y===(1<<Oe.canonical.z)-1;Oe.canonical.y===0&&wu(!0,Oe,h,t,a,Q,X,Ge,Fe||Un.disabled),it&&wu(!1,Oe,h,t,a,Q,X,Ge===jn.frontCW?jn.backCW:jn.frontCW,Fe||Un.disabled)}};R?Ze(De,h.renderElevatedRasterBackface?jn.backCW:jn.frontCW,h.stencilModeFor3D()):Ze(De,jn.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,a,d,y,b){h.renderPass==="offscreen"&&(function(S,M,R,N){if(!N.length)return;const U=S.context,Y=U.gl,X=M.getSource();if(!(X instanceof _a))return;const Q=Math.ceil(Math.sqrt(R.paint.get("raster-particle-count")));let ae=R.particlePositionRGBAImage;if(!ae||ae.width!==Q){const De=(function(Se){const Ze=Se*Se,Ve=new Uint8Array(4*Ze),Ge=function(Oe){return Oe|=0,Oe=Math.imul(2747636419^Oe,2654435769),Oe=Math.imul(Oe^Oe>>>16,2654435769),((Oe=Math.imul(Oe^Oe>>>16,2654435769))>>>0)/4294967296},Fe=1/1.1;for(let Oe=0;Oe<Ze;Oe++){const it=Fe*(Ge(2*Oe+0)+Qa),ft=Fe*(Ge(2*Oe+1)+Qa),ht=255*it%1,St=255*ft%1,It=ht,zt=ft-St/255,Jt=St;Ve[4*Oe+0]=255*(it-ht/255),Ve[4*Oe+1]=255*It,Ve[4*Oe+2]=255*zt,Ve[4*Oe+3]=255*Jt}return Ve})(Q);ae=R.particlePositionRGBAImage=new n.q({width:Q,height:Q},De)}let ie=R.particleFramebuffer;ie?ie.width!==Q&&(ie.destroy(),ie=R.particleFramebuffer=U.createFramebuffer(Q,Q,1,null)):ie=R.particleFramebuffer=U.createFramebuffer(Q,Q,1,null);const _e=[];for(const De of N){const Se=M.getTile(De);if(!(Se instanceof Ch))continue;const Ze=sf(Se,X,R);if(!Ze)continue;const Ve=[Se.tileSize,Se.tileSize];let Ge=R.tileFramebuffer;Ge||(Ge=R.tileFramebuffer=U.createFramebuffer(Ve[0],Ve[1],1,null));let Fe=Se.rasterParticleState;Fe||(Fe=Se.rasterParticleState=new fh(U,De,Ve,ae));const Oe=Fe.update(R.lastInvalidatedAt);Fe.particleTextureDimension!==Q&&Fe.updateParticleTexture(De,ae);const it=Fe.targetColorTexture;Fe.targetColorTexture=Fe.backgroundColorTexture,Fe.backgroundColorTexture=it;const ft=Fe.particleTexture0;Fe.particleTexture0=Fe.particleTexture1,Fe.particleTexture1=ft,_e.push([De,Ze,Fe,Oe])}if(_e.length===0)return;const fe=n.o.now(),Te=R.previousDrawTimestamp?.001*(fe-R.previousDrawTimestamp):.0167;if(R.previousDrawTimestamp=fe,R.hasColorMap()){U.activeTexture.set(Y.TEXTURE0+2);let De=R.colorRampTexture;De||(De=R.colorRampTexture=new n.T(U,R.colorRamp,Y.RGBA8)),De.bind(Y.LINEAR,Y.CLAMP_TO_EDGE)}U.bindFramebuffer.set(R.tileFramebuffer.framebuffer),(function(De,Se,Ze){const Ve=De.context,Ge=Ve.gl,Fe=Se.tileFramebuffer;Ve.activeTexture.set(Ge.TEXTURE0);const Oe={u_texture:0,u_opacity:1.05*(ft=Se.paint.get("raster-particle-fade-opacity-factor"))/(ft+.05)},it=De.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var ft;for(const ht of Ze){const[,,St,It]=ht;Fe.colorAttachment0.set(St.targetColorTexture.texture),Ve.viewport.set([0,0,Fe.width,Fe.height]),Ve.clear({color:n.ao.transparent}),It&&(St.backgroundColorTexture.bind(Ge.NEAREST,Ge.CLAMP_TO_EDGE),it.draw(De,Ge.TRIANGLES,xn.disabled,Un.disabled,cr.alphaBlended,jn.disabled,Oe,Se.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments))}})(S,R,_e),(function(De,Se,Ze,Ve){const Ge=De.context,Fe=Ge.gl,Oe=Ze.tileFramebuffer,it=De.transform.projection.name==="globe",ft=Ze.paint.get("raster-particle-max-speed");for(const ht of Ve){const[St,It,zt]=ht;Ge.activeTexture.set(Fe.TEXTURE0+0),It.texture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Oe.colorAttachment0.set(zt.targetColorTexture.texture);const Jt=De.getOrCreateProgram("rasterParticleDraw",{defines:It.defines,overrideFog:!1});Ge.activeTexture.set(Fe.TEXTURE0+1);const gt=It.scalarData?[]:[0,1,2,3].map((Dt=>n.e9[Dt](St)));gt.push(St);const nt=St.canonical.x,Bt=St.canonical.y;for(const Dt of gt){const li=Se.getTile(it?Dt.wrapped():Dt);if(!li)continue;const Ei=li.rasterParticleState;if(!Ei)continue;const Ri=Dt.canonical.x+(1<<Dt.canonical.z)*(Dt.wrap-St.wrap),Ti=Dt.canonical.y;Ei.particleTexture0.bind(Fe.NEAREST,Fe.CLAMP_TO_EDGE);const mi=Za(1,Ei.particleTexture0.size[0],[Ri-nt,Ti-Bt],0,It.texture.size,2,ft,It.textureOffset,It.scale,It.offset);Jt.draw(De,Fe.POINTS,xn.disabled,Un.disabled,cr.alphaBlended,jn.disabled,mi,Ze.id,Ei.particleIndexBuffer,void 0,Ei.particleSegment)}}})(S,M,R,_e),U.bindFramebuffer.set(R.particleFramebuffer.framebuffer),(function(De,Se,Ze,Ve){const Ge=De.context,Fe=Ge.gl,Oe=Se.paint.get("raster-particle-max-speed"),it=Ve*Se.paint.get("raster-particle-speed-factor")*.15,ft=(function(St){return Math.pow(St,6)})(.01+1*Se.paint.get("raster-particle-reset-rate-factor")),ht=Se.particleFramebuffer;Ge.viewport.set([0,0,ht.width,ht.height]);for(const St of Ze){const[,It,zt]=St;Ge.activeTexture.set(Fe.TEXTURE0+0),It.texture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE),Ge.activeTexture.set(Fe.TEXTURE0+1);const Jt=zt.particleTexture0;Jt.bind(Fe.NEAREST,Fe.CLAMP_TO_EDGE);const gt=Ls(1,Jt.size[0],0,It.texture.size,Oe,it,ft,It.textureOffset,It.scale,It.offset);ht.colorAttachment0.set(zt.particleTexture1.texture),Ge.clear({color:n.ao.transparent}),De.getOrCreateProgram("rasterParticleUpdate",{defines:It.defines}).draw(De,Fe.TRIANGLES,xn.disabled,Un.disabled,cr.unblended,jn.disabled,gt,Se.id,De.viewportBuffer,De.quadTriangleIndexBuffer,De.viewportSegments)}})(S,R,_e,Te)})(h,t,a,d),h.renderPass==="translucent"&&((function(S,M,R,N,U){const Y=S.context,X=Y.gl,Q=M.getSource().tileSize,ae=5*(1-n.ah(n.cL,n.cL+1,S.transform.zoom))*Q+R.paint.get("raster-particle-elevation"),ie=!S.options.moving,_e=S.transform.projection.name==="globe";if(!N.length)return;const[fe,Te]=S.stencilConfigForOverlap(N),De=[];_e&&De.push("PROJECTION_GLOBE_VIEW");const Se=S.stencilModeFor3D();for(const Ze of Te){const Ve=Ze.toUnwrapped(),Ge=M.getTile(Ze);if(!Ge.rasterParticleState)continue;const Fe=Ge.rasterParticleState,Oe=100;Ge.registerFadeDuration(Oe);const it=M.findLoadedParent(Ze,0),ft=o(Ge,it,M,S.transform,Oe);let ht,St;S.terrain&&S.terrain.prepareDrawTile(),Y.activeTexture.set(X.TEXTURE0),Fe.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),Y.activeTexture.set(X.TEXTURE1),it&&it.rasterParticleState?(it.rasterParticleState.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ht=Math.pow(2,it.tileID.overscaledZ-Ge.tileID.overscaledZ),St=[Ge.tileID.canonical.x*ht%1,Ge.tileID.canonical.y*ht%1]):Fe.targetColorTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE);const It=_e?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Ve,ie),zt=S.transform,Jt=of(zt),gt=n.dG(Ze.canonical),nt=n.dH(gt.getCenter().lat);let Bt,Dt,li,Ei,Ri;_e?(Bt=Float32Array.from(n.bk(n.dJ(Ze.canonical))),Dt=Float32Array.from(zt.globeMatrix),li=Float32Array.from(n.dF(zt)),Ei=[n.aF(zt.center.lng),n.aJ(zt.center.lat)],Ri=Float32Array.from(n.dI(Ze.canonical,gt,nt,zt.worldSize/zt._pixelsPerMercatorPixel))):(Bt=new Float32Array(16),Dt=new Float32Array(9),li=new Float32Array(16),Ei=[0,0],Ri=new Float32Array(9));const Ti=Ma(It,Bt,Dt,li,Ri,St||[0,0],n.aj(S.transform.zoom),Ei,Jt,ht||1,ft,ae),mi=S.isTileAffectedByFog(Ze),pn=S.getOrCreateProgram("rasterParticle",{defines:De,overrideFog:mi});if(S.uploadCommonUniforms(Y,pn,Ve),_e){const en=new xn(X.LEQUAL,xn.ReadOnly,S.depthRangeFor3D),ji=0,Qi=S.globeSharedBuffers;if(Qi){const[vn,rr,Br]=Qi.getGridBuffers(nt,ji!==0);pn.draw(S,X.TRIANGLES,en,Se,cr.alphaBlended,S.renderElevatedRasterBackface?jn.frontCCW:jn.backCCW,Ti,R.id,vn,rr,Br)}}else{const en=S.depthModeForSublayer(0,xn.ReadOnly),ji=fe[Ze.overscaledZ],{tileBoundsBuffer:Qi,tileBoundsIndexBuffer:vn,tileBoundsSegments:rr}=S.getTileBoundsBuffers(Ge);pn.draw(S,X.TRIANGLES,en,ji,cr.alphaBlended,jn.disabled,Ti,R.id,Qi,vn,rr)}}S.resetStencilClippingMasks()})(h,t,a,d),h.style.map.triggerRepaint())},background:function(h,t,a,d){const y=a.paint.get("background-color"),b=a.paint.get("background-color-use-theme").constantOr("default")==="none",S=a.paint.get("background-opacity"),M=a.paint.get("background-emissive-strength"),R=a.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const N=h.context,U=N.gl,Y=h.transform,X=Y.tileSize,Q=a.paint.get("background-pattern");let ae;if(Q!==void 0&&(Q===null||(ae=h.imageManager.getPattern(n.I.from(Q.toString()),a.scope,h.style.getLut(a.scope)),!ae)))return;const ie=!Q&&y.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==ie)return;const _e=Un.disabled,fe=h.depthModeForSublayer(0,ie==="opaque"?xn.ReadWrite:xn.ReadOnly),Te=h.colorModeForDrapableLayerRenderPass(M),De=Q?"backgroundPattern":"background";let Se,Ze=d;Ze||(Se=h.getBackgroundTiles(),Ze=Object.values(Se).map((Ge=>Ge.tileID))),Q&&(N.activeTexture.set(U.TEXTURE0),h.imageManager.bind(h.context,a.scope));const Ve=[];if(h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&Ve.push("USE_MRT1"),R){const Ge=h.getOrCreateProgram(De,{overrideFog:!1,overrideRtt:!0,defines:Ve}),Fe=new Float32Array(n.bA([])),Oe=new n.aQ(0,0,0,0,0),it=Q?Lo(Fe,M,S,h,0,a.scope,ae,R,{tileID:Oe,tileSize:X}):ks(Fe,M,S,y.toPremultipliedRenderColor(b?null:a.lut));Ge.draw(h,U.TRIANGLES,fe,_e,Te,jn.disabled,it,a.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}else for(const Ge of Ze){const Fe=h.isTileAffectedByFog(Ge),Oe=h.getOrCreateProgram(De,{overrideFog:Fe,defines:Ve}),it=Ge.toUnwrapped(),ft=d?Ge.projMatrix:h.transform.calculateProjMatrix(it);h.prepareDrawTile();const ht=t?t.getTile(Ge):Se?Se[Ge.key]:new Cu(Ge,X,Y.zoom,h),St=Q?Lo(ft,M,S,h,0,a.scope,ae,R,{tileID:Ge,tileSize:X}):ks(ft,M,S,y.toPremultipliedRenderColor(b?null:a.lut));h.uploadCommonUniforms(N,Oe,it);const{tileBoundsBuffer:It,tileBoundsIndexBuffer:zt,tileBoundsSegments:Jt}=h.getTileBoundsBuffers(ht);Oe.draw(h,U.TRIANGLES,fe,_e,Te,jn.disabled,St,a.id,It,zt,Jt)}},sky:function(h,t,a){const d=h._atmosphere?n.aj(h.transform.zoom):1,y=a.paint.get("sky-opacity")*d;if(y===0)return;const b=h.context,S=a.paint.get("sky-type"),M=new xn(b.gl.LEQUAL,xn.ReadOnly,[0,1]),R=h.frameCounter/1e3%1;S==="atmosphere"?h.renderPass==="offscreen"?a.needsSkyboxCapture(h)&&((function(N,U,Y,X){const Q=N.context,ae=Q.gl;let ie=U.skyboxFbo;if(!ie){ie=U.skyboxFbo=Q.createFramebuffer(32,32,1,null),U.skyboxGeometry=new Ld(Q),U.skyboxTexture=Q.gl.createTexture(),ae.bindTexture(ae.TEXTURE_CUBE_MAP,U.skyboxTexture),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_S,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_WRAP_T,ae.CLAMP_TO_EDGE),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MIN_FILTER,ae.LINEAR),ae.texParameteri(ae.TEXTURE_CUBE_MAP,ae.TEXTURE_MAG_FILTER,ae.LINEAR);for(let De=0;De<6;++De)ae.texImage2D(ae.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,ae.RGBA,32,32,0,ae.RGBA,ae.UNSIGNED_BYTE,null)}Q.bindFramebuffer.set(ie.framebuffer),Q.viewport.set([0,0,32,32]);const _e=U.getCenter(N,!0),fe=N.getOrCreateProgram("skyboxCapture"),Te=new Float64Array(16);n.bA(Te),n.en(Te,Te,.5*-Math.PI),yd(N,U,fe,Te,_e,0),n.bA(Te),n.en(Te,Te,.5*Math.PI),yd(N,U,fe,Te,_e,1),n.bA(Te),n.cU(Te,Te,.5*-Math.PI),yd(N,U,fe,Te,_e,2),n.bA(Te),n.cU(Te,Te,.5*Math.PI),yd(N,U,fe,Te,_e,3),n.bA(Te),yd(N,U,fe,Te,_e,4),n.bA(Te),n.en(Te,Te,Math.PI),yd(N,U,fe,Te,_e,5),Q.viewport.set([0,0,N.width,N.height])})(h,a),a.markSkyboxValid(h)):h.renderPass==="sky"&&(function(N,U,Y,X,Q){const ae=N.context,ie=ae.gl,_e=N.transform,fe=N.getOrCreateProgram("skybox");ae.activeTexture.set(ie.TEXTURE0),ie.bindTexture(ie.TEXTURE_CUBE_MAP,U.skyboxTexture);const Te=((De,Se,Ze,Ve,Ge)=>({u_matrix:De,u_sun_direction:Se,u_cubemap:0,u_opacity:Ve,u_temporal_offset:Ge}))(_e.skyboxMatrix,U.getCenter(N,!1),0,X,Q);N.uploadCommonUniforms(ae,fe),fe.draw(N,ie.TRIANGLES,Y,Un.disabled,N.colorModeForRenderPass(),jn.backCW,Te,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)})(h,a,M,y,R):S==="gradient"&&h.renderPass==="sky"&&(function(N,U,Y,X,Q){const ae=N.context,ie=ae.gl,_e=N.transform,fe=N.getOrCreateProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Ld(ae)),ae.activeTexture.set(ie.TEXTURE0);let Te=U.colorRampTexture;Te||(Te=U.colorRampTexture=new n.T(ae,U.colorRamp,ie.RGBA8)),Te.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const De=((Se,Ze,Ve,Ge,Fe)=>({u_matrix:Se,u_color_ramp:0,u_center_direction:Ze,u_radius:n.an(Ve),u_opacity:Ge,u_temporal_offset:Fe}))(_e.skyboxMatrix,U.getCenter(N,!1),U.paint.get("sky-gradient-radius"),X,Q);N.uploadCommonUniforms(ae,fe),fe.draw(N,ie.TRIANGLES,Y,Un.disabled,N.colorModeForRenderPass(),jn.backCW,De,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)})(h,a,M,y,R)},custom:function(h,t,a,d){const y=h.context,b=a.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&a.isDraped(t)){if(h.renderPass==="offscreen"){const S=b.prerender;if(S){if(h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const M=h.transform.pointMerc;S.call(b,y.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.aj(h.transform.zoom),[M.x,M.y],h.transform.pixelsPerMeterRatio)}else S.call(b,y.gl,h.transform.customLayerMatrix());y.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const M=b.renderToTile;if(M){const R=d[0].canonical,N={x:R.x+d[0].wrap*(b.wrapTileId?0:1<<R.z),y:R.y,z:R.z};y.setDepthMode(xn.disabled),y.setStencilMode(Un.disabled),y.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),M.call(b,y.gl,N),y.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),y.setColorMode(h.colorModeForRenderPass()),y.setStencilMode(Un.disabled);const S=b.renderingMode==="3d"?new xn(h.context.gl.LEQUAL,xn.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,xn.ReadOnly);if(y.setDepthMode(S),h.transform.projection.name==="globe"){const M=h.transform.pointMerc;b.render(y.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),n.aj(h.transform.zoom),[M.x,M.y],h.transform.pixelsPerMeterRatio)}else b.render(y.gl,h.transform.customLayerMatrix());y.setDirty(),h.setBaseState(),y.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,a,d){if(h.renderPass==="opaque")return;const y=a.paint.get("model-opacity").constantOr(1),b=a.paint.get("model-elevation-reference"),S=b==="ground",M=b==="ground";if(y===0)return;const R=a.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!R||h.terrain&&y<.65&&a._transitionablePaint._values["model-opacity"].value.expression instanceof n.ad))return;const N=h.shadowRenderer,U=a.paint.get("model-receive-shadows");N&&(N.useNormalOffset=!0,U||(N.enabled=!1));const Y=()=>{N&&(N.useNormalOffset=!0,U||(N.enabled=!0))},X=t.getSource();if(h.renderPass==="light-beam"&&X.type!=="batched-model")return;if(X.type==="vector"||X.type==="geojson")return(function(Se,Ze,Ve,Ge,Fe){const Oe=Se.transform,it=Oe.projection.name==="globe",ft=Oe.getFreeCameraOptions().position;if(!Se.modelManager)return;const ht=Se.modelManager;Ve.modelManager=ht;const St=Se.shadowRenderer;if(!Ve._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const It=Ve._unevaluatedLayout._values["model-id"],zt=Object.assign({},Ve.layout.get("model-id").parameters),Jt=Se.style.order.indexOf(Ve.fqid),gt=Ve.paint.get("model-opacity").constantOr(1);for(const nt of Ge){const Bt=Ze.getTile(nt).getBucket(Ve);if(!Bt||Bt.projection.name!==Oe.projection.name)continue;const Dt=Bt.getModelUris();if(Dt&&!Bt.modelsRequested&&(ht.addModelsFromBucket(Dt,Fe),Bt.modelsRequested=!0),it)zt.zoom=nt.overscaledZ;else{const ji=Zs(nt,Oe);zt.zoom=ji}const li=It.possiblyEvaluate(zt);if(mm(Se,Bt,nt),$h.shadowUniformsInitialized=!1,$h.useSingleShadowCascade=!!St&&St.getMaxCascadeForTile(nt.toUnwrapped())===0,Se.renderPass==="shadow"&&St){if(Se.currentShadowCascade===1&&Bt.isInsideFirstShadowMapFrustum)continue;const ji=Oe.calculatePosMatrix(nt.toUnwrapped(),Oe.worldSize);if($h.tileMatrix.set(ji),$h.shadowTileMatrix=Float32Array.from(St.calculateShadowPassMatrixFromMatrix(ji)),$h.aabb.min=[0,0,0],$h.aabb.max[0]=$h.aabb.max[1]=n.al,$h.aabb.max[2]=0,Bm(Bt,$h,Se,Ve.scope))continue}const Ei=1<<nt.canonical.z,Ri=[((ft.x-nt.wrap)*Ei-nt.canonical.x)*n.al,(ft.y*Ei-nt.canonical.y)*n.al,ft.z*Ei*n.al];Se.conflationActive&&Object.keys(Bt.instancesPerModel).length>0&&Se.style.isLayerClipped(Ve,Ze.getSource())&&Bt.updateReplacement(nt,Se.replacementSource,Jt,Ve.scope)&&(Bt.uploaded=!1,Bt.upload(Se.context));let Ti=0;const mi=new Array,pn=new Array,en=new Array;for(let ji in Bt.instancesPerModel){const Qi=Bt.instancesPerModel[ji];Qi.features.length>0&&!it&&(ji=li.evaluate(Qi.features[0].feature,{}));const vn=ht.getModel(ji,Fe);if(vn||ht.hasURLBeenRequested(ji)||Bt.modelUris.includes(ji)||(Bt.modelUris.push(ji),Bt.modelsRequested=!1),vn&&vn.uploaded)if(it){const rr=n.c5([],[ft.x,ft.y,ft.z],Se.transform.worldSize);n.ew(rr,rr);for(let Br=0;Br<Qi.instancedDataArray.length;++Br){const ba=[0,0,0],_n=[1,1,1],aa=n.ex(),Qn=Qi.tileCoordinatesForInstance(Br),yr=Qi.transformForInstance(Br);n.ey(_n,yr),n.ez(aa,yr),n.eA(ba,aa);const Gr=Qi.translationForInstance(Br),Kr=new n.aT(0,0);n.eB(Bt.canonical,Kr,Qn.x,Qn.y);const qr=n.bC();n.eC(qr,vn,Se.transform,Kr,ba,_n,Gr,!0,!1,!1);const mr=Qi.colorForInstance(Br),wa=n.bA([]),Bs=n.ef(Kr.lat,Se.transform.zoom),Ga=n.bq([],[1,1,1/Bs]);n.br(wa,wa,rr),en.push({zScaleMatrix:Ga,negCameraPosMatrix:wa});for(const ya of vn.nodes)cf(Se,ya,qr,Se.transform.expandedFarZProjMatrix,Ti,mi,pn,vn.materialOverrides,gt,mr);++Ti}}else for(const rr of vn.nodes)kd(Se,Ve,rr,Qi,Ri,nt,$h)}if(it)if(Se.renderPass==="shadow"){for(const ji of pn)vc(ji.mesh,ji.nodeModelMatrix,Se,Ve);for(const ji of mi)vc(ji.mesh,ji.nodeModelMatrix,Se,Ve)}else pm(Se,Ve,mi,pn,en)}})(h,t,a,d,$u(h,a)),void Y();if(!X.loaded())return;if(X.type==="batched-model")return(function(Se,Ze,Ve,Ge){Ve.resetLayerRenderingStats(Se);const Fe=Se.context,Oe=Se.transform,it=Se.style.fog,ft=Se.shadowRenderer;if(Oe.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${Oe.projection.name} projection is not yet implemented`);const ht=Se.transform.getFreeCameraOptions().position,St=n.c5([],[ht.x,ht.y,ht.z],Se.transform.worldSize),It=n.ew([],St),zt=n.bA([]),Jt=n.ef(Oe.center.lat,Oe.zoom),gt=n.bq([],[1,1,1/Jt]);n.br(zt,zt,It);const nt=Ve.paint.get("model-opacity").constantOr(1),Bt=new xn(Fe.gl.LEQUAL,xn.ReadWrite,Se.depthRangeFor3D),Dt=new xn(Fe.gl.LEQUAL,xn.ReadOnly,Se.depthRangeFor3D),li=new n.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ei=Se.renderPass==="shadow",Ri=Ei&&ft?ft.getCurrentCascadeFrustum():Oe.getFrustum(Oe.scaleZoom(Oe.worldSize)),Ti=Ve.paint.get("model-front-cutoff"),mi=Ti[2]<1,pn=sh(Se,Ve.paint.get("model-cutoff-fade-range")),en=Ve.getLayerRenderingStats();(function(ji,Qi,vn,rr){const Br=ji.terrain?ji.terrain.exaggeration():0,ba=ji.transform.zoom;for(const _n of rr){const aa=Qi.getTile(_n).getBucket(vn);aa&&(aa.setFilter(vn.filter),ji.conflationActive&&aa.updateReplacement(_n,ji.replacementSource),aa.evaluateTransform(ji,vn),ji.terrain&&Br>0&&aa.elevationUpdate(ji.terrain,Br,_n,vn.source),aa.needsReEvaluation(ji,ba,vn)&&aa.evaluate(vn))}})(Se,Ze,Ve,Ge),(function(){let ji,Qi,vn;mi?(ji=Ge.length-1,Qi=-1,vn=-1):(ji=0,Qi=Ge.length,vn=1);const rr=new Float64Array(16),Br=n.cA(),ba=new n.P(0,0);for(let _n=ji;_n!==Qi;_n+=vn){const aa=Ge[_n],Qn=Ze.getTile(aa).getBucket(Ve);if(!Qn||!Qn.uploaded)continue;let yr=!1;ft&&(yr=ft.getMaxCascadeForTile(aa.toUnwrapped())===0);const Gr=Oe.calculatePosMatrix(aa.toUnwrapped(),Oe.worldSize),Kr=Qn.modelTraits;!Ei&&mi&&(n.bl(rr,Gr),n.af(Br,St,rr),ba.x=Br[0],ba.y=Br[1]);const qr=[];Qn.setFilter(Ve.filter);for(const mr of Qn.getNodesInfo()){if(mr.hiddenByReplacement||!mr.node.meshes)continue;const wa=mr.node;let Bs=0;Se.terrain&&wa.elevation&&(Bs=wa.elevation*Se.terrain.exaggeration());const Ga=(()=>{const Ho=mr.aabb;return li.min=[...Ho.min],li.max=[...Ho.max],li.min[2]+=Bs,li.max[2]+=Bs,n.af(li.min,li.min,Gr),n.af(li.max,li.max,Gr),li})(),ya=mr.evaluatedScale;if(ya[0]<=1&&ya[1]<=1&&ya[2]<=1&&Ga.intersects(Ri)===0)continue;if(!Ei&&mi){const Ho=.16666666666666666;mr.cameraCollisionOpacity=St[0]>Ga.min[0]&&St[0]<Ga.max[0]&&St[1]>Ga.min[1]&&St[1]<Ga.max[1]&&St[2]*Jt<Ga.max[2]&&wa.footprint&&n.c0(ba,wa.footprint)?Math.max(mr.cameraCollisionOpacity-Ho,0):Math.min(1,mr.cameraCollisionOpacity+Ho)}const Sr=[...Gr],gr=1/n.d7(aa.canonical),fa=wa.anchor?wa.anchor[0]:0,bs=wa.anchor?wa.anchor[1]:0;n.br(Sr,Sr,[fa*(ya[0]-1)+mr.evaluatedTranslation[0]*gr,bs*(ya[1]-1)+mr.evaluatedTranslation[1]*gr,Bs+mr.evaluatedTranslation[2]]),n.cq(ya,n.eE)||n.cS(Sr,Sr,ya);const ws=n.aB([],Sr,wa.globalMatrix),qa=n.aB([],Oe.expandedFarZProjMatrix,ws),Bo=n.aB([],Oe.expandedFarZProjMatrix,Sr),Qo=n.aC([],[fa,bs,Bs,1],qa)[2];wa.hidden=!1;let oo=nt;Ei||(mi&&(oo*=mr.cameraCollisionOpacity,oo*=Zr(Sr,Oe,mr.aabb,Ti)),oo*=Wa(pn,Qo)),oo!==0?qr.push({nodeInfo:mr,depth:Qo,opacity:oo,wvpForNode:qa,wvpForTile:Bo,nodeModelMatrix:ws,tileModelMatrix:Sr}):wa.hidden=!0}Ei||qr.sort(((mr,wa)=>!mi||mr.opacity===1&&wa.opacity===1?mr.depth<wa.depth?-1:1:mr.opacity===1?-1:wa.opacity===1?1:mr.depth>wa.depth?-1:1));for(const mr of qr){const wa=mr.nodeInfo,Bs=wa.node;let Ga=n.aB([],gt,mr.tileModelMatrix);n.aB(Ga,zt,Ga);const ya=n.bl([],Ga);n.eg(ya,ya),n.cS(ya,ya,uf),Ga=n.aB(Ga,Ga,Bs.globalMatrix);const Sr=Se.renderPass==="light-beam",gr=Ve.paint.get("model-color-use-theme").constantOr("default")==="none",fa=Kr&n.eI.HasMapboxMeshFeatures,bs=fa?0:wa.evaluatedRMEA[0][2];for(let ws=0;ws<Bs.meshes.length;++ws){const qa=Bs.meshes[ws],Bo=ws===Bs.lightMeshIndex;let Qo=mr.wvpForNode;if(Bo){if(!Sr&&!Se.terrain&&Se.shadowRenderer){Se.currentLayer<Se.firstLightBeamLayer&&(Se.firstLightBeamLayer=Se.currentLayer);continue}Qo=mr.wvpForTile}else if(Sr)continue;const oo={defines:[]},Ho=[];if(!Ei&&ft&&(ft.useNormalOffset=!!qa.normalBuffer),rp(oo.defines,Ho,qa,Se,gr?null:Ve.lut),fa||oo.defines.push("DIFFUSE_SHADED"),yr&&oo.defines.push("SHADOWS_SINGLE_CASCADE"),en&&(Ei?en.numRenderedVerticesInShadowPass+=qa.vertexArray.length:en.numRenderedVerticesInTransparentPass+=qa.vertexArray.length),Ei){vc(qa,mr.nodeModelMatrix,Se,Ve);continue}let jl=null;if(it){const lo=Hh(mr.nodeModelMatrix,Se.transform);if(jl=new Float32Array(lo),Oe.projection.name!=="globe"){const Na=qa.aabb.min,Ns=qa.aabb.max,[zs,Ts]=it.getOpacityForBounds(lo,Na[0],Na[1],Ns[0],Ns[1]);oo.overrideFog=zs>=qt||Ts>=qt}}const fl=qa.material;let eu;fl.occlusionTexture&&fl.occlusionTexture.offsetScale&&(eu=fl.occlusionTexture.offsetScale,oo.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Yu=Se.getOrCreateProgram("model",oo);!Ei&&ft&&ft.setupShadowsFromMatrix(mr.tileModelMatrix,Yu,ft.useNormalOffset),Se.uploadCommonUniforms(Fe,Yu,null,jl);const ic=fl.pbrMetallicRoughness;ic.metallicFactor=.9,ic.roughnessFactor=.5;const Fs=Ms(new Float32Array(Qo),new Float32Array(Ga),new Float32Array(ya),new Float32Array(Bs.globalMatrix),Se,mr.opacity,ic.baseColorFactor,fl.emissiveFactor,ic.metallicFactor,ic.roughnessFactor,fl,bs,Ve,[0,0,0],eu);!Bo&&(wa.hasTranslucentParts||mr.opacity<1)&&Yu.draw(Se,Fe.gl.TRIANGLES,Bt,Un.disabled,cr.disabled,jn.backCCW,Fs,Ve.id,qa.vertexBuffer,qa.indexBuffer,qa.segments,Ve.paint,Se.transform.zoom,void 0,Ho),Yu.draw(Se,Fe.gl.TRIANGLES,Bo?Dt:Bt,Un.disabled,Bo||mr.opacity<1||wa.hasTranslucentParts?cr.alphaBlended:cr.unblended,jn.backCCW,Fs,Ve.id,qa.vertexBuffer,qa.indexBuffer,qa.segments,Ve.paint,Se.transform.zoom,void 0,Ho)}}}})()})(h,t,a,d),void Y();if(X.type!=="model")return;const Q=X.getModels(),ae=[],ie=h.transform.getFreeCameraOptions().position,_e=n.c5([],[ie.x,ie.y,ie.z],h.transform.worldSize);n.ew(_e,_e);const fe=[],Te=[];let De=0;for(const Se of Q){const Ze=t.getFeatureState("",Se.id),Ve={type:"Unknown",id:Se.id,properties:Se.featureProperties},Ge=a.paint.get("model-rotation").evaluate(Ve,Ze),Fe=a.paint.get("model-scale").evaluate(Ve,Ze),Oe=a.paint.get("model-translation").evaluate(Ve,Ze),it=a.paint.get("model-opacity").evaluate(Ve,Ze);Pp(a,Se.id,Ze,Se.featureProperties,Se.nodeOverrideNames,Se.nodeOverrides),ap(a,Se.id,Ze,Se.featureProperties,Se.materialOverrideNames,Se.materialOverrides),Se.nodeOverrides.size>0&&Se.computeBoundsAndApplyParent(),Se.computeModelMatrix(h,Ge,Fe,Oe,M,S,!1);const ft=n.bA([]),ht=n.ef(Se.position.lat,h.transform.zoom),St=n.bq([],[1,1,1/ht]);n.br(ft,ft,_e),ae.push({zScaleMatrix:St,negCameraPosMatrix:ft});for(const It of Se.nodes)cf(h,It,Se.matrix,h.transform.expandedFarZProjMatrix,De,fe,Te,Se.materialOverrides,it);De++}if(fe.sort(((Se,Ze)=>Ze.depth-Se.depth)),h.renderPass!=="shadow")pm(h,a,fe,Te,ae),Y();else{for(const Se of Te)vc(Se.mesh,Se.nodeModelMatrix,h,a);for(const Se of fe)vc(Se.mesh,Se.nodeModelMatrix,h,a);Y()}}},pf={line:function(h,t,a){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const y of d){const b=t.getTile(y).getBucket(h);if(b&&(b.elevationType!=="none"?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,a){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(a.modelManager&&a.modelManager.upload(a,$u(a,h)));if(d.type==="batched-model"||d.type!=="model")return;const y=d.getModels();for(const b of y)b.upload(a.context)},raster:function(h,t,a){const d=t.getSource();if(!(d instanceof _a&&d.loaded()))return;const y=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const b=h.paint.get("raster-array-band")||d.getInitialBand(y);if(b==null)return;const S=t.getIds().map((M=>t.getTileByID(M)));for(const M of S)M.updateNeeded(h.id,b)&&d.prepareTile(M,y,h.id,b)},"raster-particle":function(h,t,a){const d=t.getSource();if(!(d instanceof _a&&d.loaded()))return;const y=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!y)return;const b=h.paint.get("raster-particle-array-band")||d.getInitialBand(y);if(b==null)return;const S=t.getIds().map((M=>t.getTileByID(M)));for(const M of S)M.updateNeeded(h.id,b)&&d.prepareTile(M,y,h.id,b)}},Tu={fill:gc},up={fill:function(h,t,a,d){if(!a.layout||a.layout.get("fill-elevation-reference")==="none"||a.paint.get("fill-opacity").constantOr(1)===0)return;const y=h.context.gl,b=new xn(y.LEQUAL,xn.ReadOnly,h.depthRangeFor3D),S=new Un({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),M=h.transform.getFreeCameraOptions().position,R=h.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const N of d){const U=t.getTile(N),Y=U.getBucket(a);if(!Y)continue;const X=Y.elevatedStructures;if(!X||X.depthSegments.segments[0].primitiveLength===0)continue;const Q=Ba(N.toUnwrapped(),M),ae=h.translatePosMatrix(N.projMatrix,U,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor")),ie=oi(ae,Q,0,1,0);R.draw(h,y.TRIANGLES,b,S,cr.disabled,jn.disabled,ie,a.id,X.vertexBuffer,X.indexBuffer,X.depthSegments,a.paint,h.transform.zoom)}}};class hp{constructor(t,a,d,y,b){this.context=new bu(t,a),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=n.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const R of S)this._debugParams.enabledLayers[R]=!0;for(const R of S);this.occlusionParams=new Od,this.setup(),this.numSublayers=Go.maxUnderzooming+Go.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new du(this),this._wireframeDebugCache=new hf,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const M=new n.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,M,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=b,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,a){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new P(this,t));const y=this._terrain;this.transform.elevation=d?y:null,y.update(t,this.transform,a),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(t){const a=t.fog;if(!a||this.transform.projection.name==="globe"||a.getOpacity(this.transform.pitch)<1||a.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,y]=a.getFovAdjustedRange(this.transform._fov);if(d>y)return void(this.transform.fogCullDistSq=null);const b=d+.78*(y-d);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new P(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,a){if(this.width=t*n.o.devicePixelRatio,this.height=a*n.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,a=new n.bd;a.emplaceBack(0,0),a.emplaceBack(n.al,0),a.emplaceBack(0,n.al),a.emplaceBack(n.al,n.al),this.tileExtentBuffer=t.createVertexBuffer(a,n.bf.members),this.tileExtentSegments=n.bg.simpleSegment(0,0,4,2);const d=new n.bd;d.emplaceBack(0,0),d.emplaceBack(n.al,0),d.emplaceBack(0,n.al),d.emplaceBack(n.al,n.al),this.debugBuffer=t.createVertexBuffer(d,n.bf.members),this.debugSegments=n.bg.simpleSegment(0,0,4,5);const y=new n.bd;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(y,n.bf.members),this.viewportSegments=n.bg.simpleSegment(0,0,4,2);const b=new n.b1;b.emplaceBack(0,0,0,0),b.emplaceBack(n.al,0,n.al,0),b.emplaceBack(0,n.al,0,n.al),b.emplaceBack(n.al,n.al,n.al,n.al),this.mercatorBoundsBuffer=t.createVertexBuffer(b,n.bi.members),this.mercatorBoundsSegments=n.bg.simpleSegment(0,0,4,2);const S=new n.b0;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S);const M=new n.be;for(const N of[0,1,3,2,0])M.emplaceBack(N);this.debugIndexBuffer=t.createIndexBuffer(M),this.emptyTexture=new n.T(t,new n.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.bC();const R=this.context.gl;this.stencilClearMode=new Un({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,xn.disabled,this.stencilClearMode,cr.disabled,jn.disabled,L(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,a,d){if(!a||this.currentStencilSource===a.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const R of d)if(this._tileClippingMaskIDs[R.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=a.id;const y=this.context,b=y.gl;this.nextStencilID+d.length>256&&this.clearStencil(),y.setColorMode(cr.disabled),y.setDepthMode(xn.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of d){const R=a.getTile(M),N=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:U,tileBoundsIndexBuffer:Y,tileBoundsSegments:X}=this.getTileBoundsBuffers(R);S.draw(this,b.TRIANGLES,xn.disabled,new Un({func:b.ALWAYS,mask:0},N,255,b.KEEP,b.KEEP,b.REPLACE),cr.disabled,jn.disabled,L(M.projMatrix),"$clipping",U,Y,X)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,a=this.context.gl;return new Un({func:a.NOTEQUAL,mask:255},t,255,a.KEEP,a.KEEP,a.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const a=this.context.gl;return new Un({func:a.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,a.KEEP,a.KEEP,a.REPLACE)}stencilConfigForOverlap(t){const a=this.context.gl,d=t.sort(((S,M)=>M.overscaledZ-S.overscaledZ)),y=d[d.length-1].overscaledZ,b=d[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let M=0;M<b;M++)S[M+y]=new Un({func:a.GEQUAL,mask:255},M+this.nextStencilID,255,a.KEEP,a.KEEP,a.REPLACE);return this.nextStencilID+=b,[S,d]}return[{[y]:Un.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new cr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?cr.unblended:cr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const a=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new cr([a.ONE,a.ONE_MINUS_SRC_ALPHA,a.CONSTANT_ALPHA,a.ONE_MINUS_SRC_ALPHA],new n.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new cr([a.ONE,a.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,a.ONE_MINUS_SRC_ALPHA],n.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,a,d,y=!1){if(this.depthOcclusion)return new xn(this.context.gl.GREATER,xn.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return xn.disabled;const b=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new xn(d||this.context.gl.LEQUAL,a,[b,b])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,a=Math.ceil(this.width),d=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),b=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===a&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),a!==0&&d!==0&&(this.depthFBO=new Cs(this.context,a,d,0,"texture"),this.depthTexture=new n.T(this.context,{width:a,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),t.bindTexture(t.TEXTURE_2D,b),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,a,d,0,0,a,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((t,a)=>t+a/this._fpsHistory.length),0))}render(t,a){const d=n.o.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=a;const y=this.style._mergedLayers,b=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(b).filter((gt=>{const nt=y[gt];return!(nt.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[nt.type]}));let M=S(),R=!1,N=!1,U=null,Y=0,X=!1;for(const gt of M){const nt=y[gt];nt.visibility!=="none"&&(nt.type==="circle"?R=!0:nt.type==="building"?(U=nt,++Y):nt.type==="symbol"&&(nt.hasOcclusionOpacityProperties?N=!0:R=!0))}this.updateEmissiveMode();let Q=M.map((gt=>y[gt]));const ae=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.o.now()),this.imageManager.beginFrame();for(const gt in ae){const nt=ae[gt];nt.used&&(nt.prepare(this.context),nt.getSource().usedInConflation&&++Y)}let ie=!1;for(const gt of Q)gt.isHidden(this.transform.zoom)||(gt.type==="clip"&&(ie=!0),this.prepareLayer(gt));const _e={},fe={},Te={},De={},Se={};for(const gt in ae){const nt=ae[gt];_e[gt]=nt.getVisibleCoordinates(),fe[gt]=_e[gt].slice().reverse(),Te[gt]=nt.getVisibleCoordinates(!0).reverse(),De[gt]=nt.getShadowCasterCoordinates(),Se[gt]=nt.sortCoordinatesByDistance(_e[gt])}const Ze=gt=>{const nt=this.style.getLayerSourceCache(gt);return nt&&nt.used?nt.getSource():null};if(Y||ie||this._clippingActiveLastFrame){const gt=[],nt=[];let Bt=0;for(const Dt of Q)this.isSourceForClippingOrConflation(Dt,Ze(Dt))&&(gt.push(Dt),nt.push(Bt)),Bt++;if(gt&&(ie||gt.length>1)||this._clippingActiveLastFrame){ie=!1;const Dt=[];for(let li=0;li<gt.length;li++){const Ei=gt[li],Ri=nt[li],Ti=this.style.getLayerSourceCache(Ei);if(!Ti||!Ti.used||!Ti.getSource().usedInConflation&&Ei.type!=="clip"&&Ei.type!=="building")continue;let mi=n.eQ,pn=n.b_.None;const en=[];let ji=!0;if(Ei.type==="building")mi=n.eS;else if(Ei.type==="clip"){mi=Ri;for(const Qi of Ei.layout.get("clip-layer-types"))pn|=Qi==="model"?n.b_.Model:Qi==="symbol"?n.b_.Symbol:n.b_.FillExtrusion;for(const Qi of Ei.layout.get("clip-layer-scope"))en.push(Qi);Ei.isHidden(this.transform.zoom)?ji=!1:ie=!0}ji&&Dt.push({layer:Ei.fqid,cache:Ti,order:mi,clipMask:pn,clipScope:en})}this.replacementSource.setSources(Dt),X=!0}}this._clippingActiveLastFrame=ie,X||this.replacementSource.clear(),this.conflationActive=X,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let gt=0;gt<Q.length;gt++){const nt=Q[gt];if(nt.visibility==="none")continue;const Bt=nt.cutoffRange();if(this.longestCutoffRange=Math.max(Bt,this.longestCutoffRange),Bt>0){const Dt=Ze(nt);Dt&&(this.minCutoffZoom=Math.max(Dt.minzoom,this.minCutoffZoom)),nt.minzoom&&(this.minCutoffZoom=Math.max(nt.minzoom,this.minCutoffZoom))}nt.is3D(b)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=gt),this._lastOcclusionLayer=gt)}const Ve=this.style&&this.style.fog;Ve?(this._fogVisible=Ve.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Ve.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Te),this.opaquePassCutoff=0,M=S(),Q=M.map((gt=>y[gt])));const Ge=this._shadowRenderer;if(Ge){Ge.updateShadowParameters(this.transform,this.style.directionalLight);for(const gt in ae)for(const nt of _e[gt]){let Bt={min:0,max:0};this.terrain&&(Bt=this.terrain.getMinMaxForTile(nt)||Bt),Ge.addShadowReceiver(nt.toUnwrapped(),Bt.min,Bt.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new fm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const Fe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),Oe=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(Fe&&!this._snow&&(this._snow=new Op(this)),!Fe&&this._snow&&(this._snow.destroy(),delete this._snow),Oe&&!this._rain&&(this._rain=new ff(this)),!Oe&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),U){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Rp);const gt=this.style.getLayerSourceCache(U);this.buildingTileBorderManager.updateBorders(gt,U)}if(!Yt.has(this.context.gl))return;this.renderPass="offscreen";for(const gt of Q){const nt=t.getLayerSourceCache(gt);if(!gt.hasOffscreenPass()||gt.isHidden(this.transform.zoom))continue;const Bt=nt?fe[nt.id]:void 0;(gt.type==="custom"||gt.type==="raster"||gt.type==="raster-particle"||gt.isSky()||Bt&&Bt.length)&&this.renderLayer(this,nt,gt,Bt)}this.depthRangeFor3D=[0,1-(Q.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,De)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const it=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ft=(()=>{if(a.showOverdrawInspector)return n.ao.black;const gt=this.style.fog;if(gt&&this.transform.projection.supportsFog){const nt=this.style.getLut(gt.scope);if(!it){const Bt=gt.properties.get("color-use-theme")==="none",Dt=gt.properties.get("color").toNonPremultipliedRenderColor(Bt?null:nt).toArray01();return new n.ao(...Dt)}if(it){const Bt=gt.properties.get("space-color-use-theme")==="none",Dt=gt.properties.get("space-color").toNonPremultipliedRenderColor(Bt?null:nt).toArray01();return new n.ao(...Dt)}}return n.ao.transparent})();if(this.context.clear({color:ft,depth:1}),this.clearStencil(),this._showOverdrawInspector=a.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&it&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const gt=Q[this.currentLayer],nt=t.getLayerSourceCache(gt);if(gt.isSky())continue;const Bt=nt?(gt.is3D(b)?Se:fe)[nt.id]:void 0;this._renderTileClippingMasks(gt,nt,Bt),this.renderLayer(this,nt,gt,Bt)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&it&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const gt=Q[this.currentLayer],nt=t.getLayerSourceCache(gt);gt.isSky()&&this.renderLayer(this,nt,gt,nt?fe[nt.id]:void 0)}function ht(gt,nt){let Bt;return nt&&(Bt=(gt.type==="symbol"?Te:gt.is3D(b)?Se:fe)[nt.id]),Bt}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const gt=Q[this.currentLayer];if(gt.type==="raster"||gt.type==="raster-particle"){const nt=t.getLayerSourceCache(gt);this.renderLayer(this,nt,gt,ht(gt,nt))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let St=0;Ge&&(St=Ge.getShadowCastingLayerCount());let It=!1,zt=-1;for(let gt=0;gt<M.length;++gt){const nt=Q[gt];nt.isHidden(this.transform.zoom)||nt.is3D(b)&&(zt=gt)}N&&zt===-1&&(R=!0);let Jt=!1;for(;this.currentLayer<M.length;){const gt=Q[this.currentLayer],nt=t.getLayerSourceCache(gt);if(gt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(gt)){if(gt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!Jt&&gt.is3D(b)&&!b){const Bt=this.currentLayer,Dt=li=>{for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const Ei=Q[this.currentLayer];if(Tu[Ei.type]){const Ri=this.style.getLayerSourceCache(Ei);Tu[Ei.type](this,Ri,Ei,ht(Ei,Ri),li)}}};Dt("initialize"),Dt("reset"),this.currentLayer=Bt,Jt=!0}if(R&&!It&&this.terrain&&!this.transform.isOrthographic&&(It=!0,this.blitDepth()),N&&zt!==-1&&this.currentLayer===zt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(gt,nt,nt?_e[nt.id]:void 0),this.renderLayer(this,nt,gt,ht(gt,nt)),!this.terrain&&Ge&&St>0&&gt.hasShadowPass()&&--St==0){{this.clearStencil(),this.resetStencilClippingMasks();const Bt=this.currentLayer;for(this.currentLayer=0;this.currentLayer<Q.length;this.currentLayer++){const Dt=Q[this.currentLayer];if(up[Dt.type]){const li=this.style.getLayerSourceCache(Dt);up[Dt.type](this,li,Dt,ht(Dt,li))}}this.currentLayer=Bt}if(Ge.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Bt=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Bt;this.currentLayer++){const Dt=Q[this.currentLayer];if(!Dt.hasLightBeamPass())continue;const li=t.getLayerSourceCache(Dt);this.renderLayer(this,li,Dt,li?fe[li.id]:void 0)}this.currentLayer=Bt,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Bt=this.currentLayer;this.depthOcclusion=!0;for(const Dt of this.layersWithOcclusionOpacity){this.currentLayer=Dt;const li=Q[this.currentLayer],Ei=t.getLayerSourceCache(li),Ri=Ei?fe[Ei.id]:void 0;this.terrain||this._renderTileClippingMasks(li,Ei,Ei?_e[Ei.id]:void 0),this.renderLayer(this,Ei,li,Ri)}this.depthOcclusion=!1,this.currentLayer=Bt,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let gt=null;Q.forEach((nt=>{const Bt=t.getLayerSourceCache(nt);Bt&&!nt.isHidden(this.transform.zoom)&&Bt.getVisibleCoordinates().length&&(!gt||gt.getSource().maxzoom<Bt.getSource().maxzoom)&&(gt=Bt)})),gt&&this.options.showTileBoundaries&&xi(this,gt,gt.getVisibleCoordinates(),n.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&xi(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(gt){const nt=gt.transform.padding;gd(gt,gt.transform.height-(nt.top||0),3,Rd),gd(gt,nt.bottom||0,3,Gh),ca(gt,nt.left||0,3,Hu),ca(gt,gt.transform.width-(nt.right||0),3,Qc);const Bt=gt.transform.centerPoint;(function(Dt,li,Ei,Ri){xt(Dt,li-1,Ei-10,2,20,Ri),xt(Dt,li-10,Ei-1,20,2,Ri)})(gt,Bt.x,gt.transform.height-Bt.y,Pd)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),X||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:a}=this.transform.projection,d=!a||!a.includes(t.type);if(pf[t.type]&&(d||this.terrain&&t.type==="custom")){const y=this.style.getLayerSourceCache(t);pf[t.type](t,y,this)}this.gpuTimingEnd()}renderLayer(t,a,d,y){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||y&&y.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Bd[d.type](t,a,d,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const a=this.context.extTimerQuery,d=this.context.gl;let y=this.gpuTimers[t.id];y||(y=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),y.calls++,d.beginQuery(a.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,a=this.context.gl,d=a.createQuery();this.deferredRenderGpuTimeQueries.push(d),a.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const a={};for(const d in t){const y=t[d],b=this.context.extTimerQuery,S=b.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;b.deleteQueryEXT(y.query),a[d]=S}return a}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const a=this.context.gl;let d=0;for(const y of t)d+=a.getQueryParameter(y,a.QUERY_RESULT)/1e6,a.deleteQuery(y);return d}translatePosMatrix(t,a,d,y,b){if(!d[0]&&!d[1])return t;const S=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(S){const N=Math.sin(S),U=Math.cos(S);d=[d[0]*U-d[1]*N,d[0]*N+d[1]*U]}const M=[b?d[0]:n.ay(a,d[0],this.transform.zoom),b?d[1]:n.ay(a,d[1],this.transform.zoom),0],R=new Float32Array(16);return n.br(R,t,M),R}saveTileTexture(t){if(t.context!==this.context)return;const a=t.size[0],d=this._tileTextures[a];d?d.push(t):this._tileTextures[a]=[t]}getTileTexture(t){const a=this._tileTextures[t];return a&&a.length>0?a.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,a,d){const y=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,b=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(b.push("LIGHTING_3D_MODE"),b.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||b.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||b.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(b.push("TERRAIN"),this.linearFloatFilteringSupported()&&b.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&b.push("GLOBE"),!this._fogVisible||y||a!==void 0&&!a||b.push("FOG","FOG_DITHERING"),y&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}getOrCreateProgram(t,a){this.cache=this.cache||{};const d=a&&a.defines||[],y=a&&a.config,b=this.currentGlobalDefines(t,a&&a.overrideFog,a&&a.overrideRtt).concat(d),S=he.cacheKey(Kd[t],t,b,y);return this.cache[S]||(this.cache[S]=new he(this.context,t,Kd[t],y,_c[t],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,a){if(this.style.enable3dLights()){const d=this.style.directionalLight,y=this.style.ambientLight;if(d&&y){const b=((S,M,R)=>{const N=S.properties.get("direction"),U=S.properties.get("color-use-theme")==="none",Y=S.properties.get("color").toNonPremultipliedRenderColor(U?null:R.getLut(S.scope)).toArray01(),X=S.properties.get("intensity"),Q=M.properties.get("color-use-theme")==="none",ae=M.properties.get("color").toNonPremultipliedRenderColor(Q?null:R.getLut(M.scope)).toArray01(),ie=M.properties.get("intensity"),_e=[N.x,N.y,N.z],fe=n.dN(ae,ie),Te=n.dN(Y,X);return{u_lighting_ambient_color:fe,u_lighting_directional_dir:_e,u_lighting_directional_color:Te,u_ground_radiance:H(_e,Te,fe)}})(d,y,this.style);a.setLightsUniformValues(t,b)}}}uploadCommonUniforms(t,a,d,y,b){if(this.uploadCommonLightUniforms(t,a),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const M=S.getOpacity(this.transform.pitch),R=((N,U,Y,X,Q,ae,ie,_e,fe,Te,De,Se)=>{const Ze=N.transform,Ve=U.properties.get("color-use-theme")==="none",Ge=U.properties.get("color").toNonPremultipliedRenderColor(Ve?null:N.style.getLut(U.scope)).toArray01();Ge[3]=X;const Fe=N.frameCounter/1e3%1,[Oe,it]=U.properties.get("vertical-range");return{u_fog_matrix:Y?Ze.calculateFogTileMatrix(Y):Se||N.identityMat,u_fog_range:U.getFovAdjustedRange(Ze._fov),u_fog_color:Ge,u_fog_horizon_blend:U.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Oe,it),it],u_fog_temporal_offset:Fe,u_frustum_tl:Q,u_frustum_tr:ae,u_frustum_br:ie,u_frustum_bl:_e,u_globe_pos:fe,u_globe_radius:Te,u_viewport:De,u_globe_transition:n.aj(Ze.zoom),u_is_globe:+(Ze.projection.name==="globe")}})(this,S,d,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.o.devicePixelRatio,this.transform.height*n.o.devicePixelRatio],y);a.setFogUniformValues(t,R)}b&&a.setCutoffUniformValues(t,b.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,a=t.createTexture();return t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),a}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,a=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const y of d)a[y.key]=t[y.key]||new Cu(y,512,this.transform.tileZoom,this,void 0,this.worldview);return a}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,a){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!a||a.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let a=this._cachedTileFogOpacities[t.key];return a||(this._cachedTileFogOpacities[t.key]=a=this.style.fog.getOpacityForTile(t)),a[0]>=qt||a[1]>=qt}setupDepthForOcclusion(t,a,d){const y=this.context,b=y.gl,S=!!d;var M;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(b.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((M=this.depthRangeFor3D)[1]-M[0]),-1-2*M[0]/(M[1]-M[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),y.activeTexture.set(b.TEXTURE0),S||a.setTerrainUniformValues(y,d)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Lf(h,t){let a=!1,d=null;const y=()=>{d=null,a&&(h(),d=setTimeout(y,t),a=!1)};return()=>(a=!0,d||y(),d)}class Xh{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Lf(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const a=ao(t);if(this._hashName){const d=this._hashName;let y=!1;const b=location.hash.slice(1).split("&").map((S=>{const M=S.split("=")[0];return M===d?(y=!0,`${M}=${a}`):S})).filter((S=>S));return y||b.push(`${d}=${a}`),`#${b.join("&")}`}return`#${a}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let a;return t.split("&").map((d=>d.split("="))).forEach((d=>{d[0]===this._hashName&&(a=d)})),(a&&a[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const a=this._getCurrentHash();if(a.length>=3&&!a.some((d=>isNaN(Number(d))))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(a[3]||0):t.getBearing();return t.jumpTo({center:[+a[2],+a[1]],zoom:+a[0],bearing:d,pitch:+(a[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ao(h,t){const a=h.getCenter(),d=Math.round(100*h.getZoom())/100,y=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),S=Math.round(a.lng*b)/b,M=Math.round(a.lat*b)/b,R=h.getBearing(),N=h.getPitch();let U=t?`/${S}/${M}/${d}`:`${d}/${M}/${S}`;return(R||N)&&(U+="/"+Math.round(10*R)/10),N&&(U+=`/${Math.round(N)}`),U}const kf={linearity:.3,easing:n.eT(0,0,.3,1)},Fd=Object.assign({deceleration:2500,maxSpeed:1400},kf),_m=Object.assign({deceleration:20,maxSpeed:1400},kf),mf=Object.assign({deceleration:1e3,maxSpeed:360},kf),gm=Object.assign({deceleration:1e3,maxSpeed:90},kf);class dp{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,a=n.o.now();for(;t.length>0&&a-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const a={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)a.zoom+=b.zoomDelta||0,a.bearing+=b.bearingDelta||0,a.pitch+=b.pitchDelta||0,b.panDelta&&a.pan._add(b.panDelta),b.around&&(a.around=b.around),b.pinchAround&&(a.pinchAround=b.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(a.pan.mag()){const b=Su(a.pan.mag(),d,Object.assign({},Fd,t||{}));y.offset=a.pan.mult(b.amount/a.pan.mag()),y.center=this._map.transform.center,Of(y,b)}if(a.zoom){const b=Su(a.zoom,d,_m);y.zoom=this._map.transform.zoom+b.amount,Of(y,b)}if(a.bearing){const b=Su(a.bearing,d,mf);y.bearing=this._map.transform.bearing+n.aA(b.amount,-179,179),Of(y,b)}if(a.pitch){const b=Su(a.pitch,d,gm);y.pitch=this._map.transform.pitch+b.amount,Of(y,b)}if(y.zoom||y.bearing){const b=a.pinchAround===void 0?a.around:a.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Of(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Su(h,t,a){const{maxSpeed:d,linearity:y,deceleration:b}=a,S=n.aA(h*y/(t/1e3),-d,d),M=Math.abs(S)/(b*y);return{easing:a.easing,duration:1e3*M,amount:S*(M/2)}}class Bc extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d,y={}){const b=Ot(a.getCanvasContainer(),d),S=a.unproject(b);super(t,Object.assign({point:b,lngLat:S,originalEvent:d},y)),this._defaultPrevented=!1,this.target=a}}class Eu extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a,d){const y=t==="touchend"?d.changedTouches:d.touches,b=Vt(a.getCanvasContainer(),y),S=b.map((R=>a.unproject(R))),M=b.reduce(((R,N,U,Y)=>R.add(N.div(Y.length))),new n.P(0,0));super(t,{points:b,point:M,lngLats:S,lngLat:a.unproject(M),originalEvent:d}),this._defaultPrevented=!1}}class Fm extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,a){super("wheel",{originalEvent:a}),this._defaultPrevented=!1}}class yo{constructor(t,a){this._map=t,this._clickTolerance=a.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Fm(this._map,t))}mousedown(t,a){return this._mousedownPos=a,this._firePreventable(new Bc(t.type,this._map,t))}mouseup(t){this._map.fire(new Bc(t.type,this._map,t))}preclick(t){const a=new MouseEvent("preclick",t);this._map.fire(new Bc(a.type,this._map,a))}click(t,a){this._mousedownPos&&this._mousedownPos.dist(a)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Bc(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Bc(t.type,this._map,t))}mouseover(t){this._map.fire(new Bc(t.type,this._map,t))}mouseout(t){this._map.fire(new Bc(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Eu(t.type,this._map,t))}touchmove(t){this._map.fire(new Eu(t.type,this._map,t))}touchend(t){this._map.fire(new Eu(t.type,this._map,t))}touchcancel(t){this._map.fire(new Eu(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ko{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Bc(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Bc("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Bc(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class dl{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=a.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,a){this.isEnabled()&&t.shiftKey&&t.button===0&&(Vn(),this._startPos=this._lastPos=a,this._active=!0)}mousemoveWindow(t,a){if(!this._active)return;const d=a,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(d)||!this._box&&d.dist(y)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=Vi("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const S=Math.min(y.x,d.x),M=Math.max(y.x,d.x),R=Math.min(y.y,d.y),N=Math.max(y.y,d.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${S}px,${R}px)`,this._box.style.width=M-S+"px",this._box.style.height=N-R+"px")}))}mouseupWindow(t,a){if(!this._active)return;const d=this._startPos,y=a;if(d&&t.button===0){if(this.reset(),qi(),d.x!==y.x||d.y!==y.y)return this._map.fire(new n.z("boxzoomend",{originalEvent:t})),{cameraAnimation:b=>b.fitScreenCoordinates(d,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Oi(),delete this._startPos,delete this._lastPos}_fireEvent(t,a){return this._map.fire(new n.z(t,{originalEvent:a}))}}function _f(h,t){const a={};for(let d=0;d<h.length;d++)a[h[d].identifier]=t[d];return a}class fp{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,a,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=(function(y){const b=new n.P(0,0);for(const S of y)b._add(S);return b.div(y.length)})(a),this.touches=_f(d,a)))}touchmove(t,a,d){if(this.aborted||!this.centroid)return;const y=_f(d,a);for(const b in this.touches){const S=y[b];(!S||S.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(t,a,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Nd{constructor(t){this.singleTap=new fp(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,a,d){this.singleTap.touchstart(t,a,d)}touchmove(t,a,d){this.singleTap.touchmove(t,a,d)}touchend(t,a,d){const y=this.singleTap.touchend(t,a,d);if(y){const b=t.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(b&&S||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class ym{constructor(){this._zoomIn=new Nd({numTouches:1,numTaps:2}),this._zoomOut=new Nd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,a,d){this._zoomIn.touchstart(t,a,d),this._zoomOut.touchstart(t,a,d)}touchmove(t,a,d){this._zoomIn.touchmove(t,a,d),this._zoomOut.touchmove(t,a,d)}touchend(t,a,d){const y=this._zoomIn.touchend(t,a,d),b=this._zoomOut.touchend(t,a,d);return y?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:t})}):b?(this._active=!0,t.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Bf={0:1,2:2},gf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Vd{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,a){return!1}_move(t,a){return{}}mousedown(t,a){if(this._lastPoint)return;const d=Hi(t);this._correctButton(t,d)&&(this._lastPoint=a,this._eventButton=d)}mousemoveWindow(t,a){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&(function(y,b){const S=Bf[b];return y.buttons===void 0||(y.buttons&S)!==S})(t,this._eventButton))this.reset();else if(this._moved||!(a.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=a,this._move(d,a)}}mouseupWindow(t){this._lastPoint&&Hi(t)===this._eventButton&&(this._moved&&qi(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bp extends Vd{mousedown(t,a){super.mousedown(t,a),this._lastPoint&&(this._active=!0)}_correctButton(t,a){return a===0&&!t.ctrlKey}_move(t,a){return{around:a,panDelta:a.sub(t)}}}class Fp extends Vd{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?gf[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const d=.8*(a.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class yf extends Vd{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?gf[t.pitchRotateKey]:void 0}_correctButton(t,a){return this._pitchRotateKey?a===0&&t[this._pitchRotateKey]:a===0&&t.ctrlKey||a===2}_move(t,a){const d=-.5*(a.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Np{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=a.clickTolerance||1,this.reset(),n.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,a,d){return this._calculateTransform(t,a,d)}touchmove(t,a,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!n.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,a,d)}}touchend(t,a,d){this._calculateTransform(t,a,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,a,d){d.length>0&&(this._active=!0);const y=_f(d,a),b=new n.P(0,0),S=new n.P(0,0);let M=0;for(const N in y){const U=y[N],Y=this._touches[N];Y&&(b._add(U),S._add(U.sub(Y)),M++,y[N]=U)}if(this._touches=y,M<this._minTouches||!S.mag())return;const R=S.div(M);return this._sum._add(R),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:R}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Vi("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class pp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,a,d){return{}}touchstart(t,a,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([a[0],a[1]]))}touchmove(t,a,d){const y=this._firstTwoTouches;if(!y)return;t.preventDefault();const[b,S]=y,M=mp(d,a,b),R=mp(d,a,S);if(!M||!R)return;const N=this._aroundCenter?null:M.add(R).div(2);return this._move([M,R],N,t)}touchend(t,a,d){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,S=mp(d,a,y),M=mp(d,a,b);S&&M||(this._active&&qi(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function mp(h,t,a){for(let d=0;d<h.length;d++)if(h[d].identifier===a)return t[d]}function Nm(h,t){return Math.log2(h/t)}class Vm extends pp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,a){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Nm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nm(this._distance,d),pinchAround:a}}}function xm(h,t){return 180*h.angleWith(t)/Math.PI}class xs extends pp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,a){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xm(this._vector,d),pinchAround:a}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const a=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const y=xm(t,d);return Math.abs(y)<a}}function mh(h){return Math.abs(h.y)>Math.abs(h.x)}class Um extends pp{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,mh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,a,d){const y=this._lastPoints;if(!y)return;const b=t[0].sub(y[0]),S=t[1].sub(y[1]);return this._map._cooperativeGestures&&!n.eU()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(t,a,d){if(this._valid!==void 0)return this._valid;const y=t.mag()>=2,b=a.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const S=t.y>0==a.y>0;return mh(t)&&mh(a)&&S}}const Vp={panStep:100,bearingStep:15,pitchStep:10};class xf{constructor(){const t=Vp;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let a=0,d=0,y=0,b=0,S=0;switch(t.keyCode){case 61:case 107:case 171:case 187:a=1;break;case 189:case 109:case 173:a=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),b=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),b=1);break;case 38:t.shiftKey?y=1:(t.preventDefault(),S=-1);break;case 40:t.shiftKey?y=-1:(t.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,y=0),{cameraAnimation:M=>{const R=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:_p,zoom:a?Math.round(R)+a*(t.shiftKey?2:1):R,bearing:M.getBearing()+d*this._bearingStep,pitch:M.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:M.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _p(h){return h*(2-h)}const Up=4.000244140625,vm=1/450;class Zu{constructor(t,a){this._map=t,this._el=t.getCanvasContainer(),this._handler=a,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=vm,n.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let a=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=n.o.now(),y=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,a!==0&&a%Up==0?this._type="wheel":a!==0&&Math.abs(a)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=a,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(y*a)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,a+=this._lastValue)),t.shiftKey&&a&&(a/=4),this._type&&(this._lastWheelEvent=t,this._delta-=a,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const a=Ot(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:a,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const a=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const N=this._type==="wheel"&&Math.abs(this._delta)>Up?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*N)));this._delta<0&&U!==0&&(U=1/U);const Y=a(),X=Math.pow(2,Y),Q=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):X;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(Q*U))),this._type==="wheel"&&(this._startZoom=Y,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a(),y=this._startZoom,b=this._easing;let S,M=!1;if(this._type==="wheel"&&y&&b){const N=Math.min((n.o.now()-this._lastWheelEventTime)/200,1),U=b(N);S=n.ak(y,d,U),N<1?this._frameId||(this._frameId=!0):M=!0}else S=d,M=!0;this._active=!0,M&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let R=S-a();return R*this._lastDelta<0&&(R=0),{noInertia:!0,needsRenderFrame:!M,zoomDelta:R,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let a=n.eV;if(this._prevEase){const d=this._prevEase,y=(n.o.now()-d.start)/d.duration,b=d.easing(y+.01)-d.easing(y),S=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-S*S);a=n.eT(S,M,.25,1)}return this._prevEase={start:n.o.now(),duration:t,easing:a},a}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Vi("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class _h{constructor(t,a){this._clickZoom=t,this._tapZoom=a}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class bm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,a){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(a)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oo{constructor(){this._tap=new Nd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,a,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=a[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,a,d))}touchmove(t,a,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const y=a[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,t.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(t,a,d)}touchend(t,a,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,a,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ec{constructor(t,a,d){this._el=t,this._mousePan=a,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ff{constructor(t,a,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=a,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nf{constructor(t,a,d,y){this._el=t,this._touchZoom=a,this._touchRotate=d,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gh=h=>h.zoom||h.drag||h.pitch||h.rotate;class Vf extends n.z{}class so{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,a){const d=n.av([],a,t);this.radius=n.ag(d[2]<0?n.eX([],d,this.constants):[d[0],d[1],0])}projectRay(t){n.eX(t,t,this.constants),n.aw(t,t),n.eY(t,t,this.constants);const a=n.c5([],t,this.radius);if(a[2]>0){const d=n.c5([],[0,0,1],n.bJ(a,[0,0,1])),y=n.c5([],n.aw([],[a[0],a[1],0]),this.radius),b=n.d8([],a,n.c5([],n.av([],n.d8([],y,d),a),2));a[0]=b[0],a[1]=b[1]}return a}}function wm(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class u_{constructor(t,a){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new dp(t),this._bearingSnap=a.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new so,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(a),n.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,b,S]of this._listeners){const M=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(b,M,S)}}destroy(){for(const[t,a,d]of this._listeners){const y=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(a,y,d)}}_addDefaultHandlers(t){const a=this._map,d=a.getCanvasContainer();this._add("mapEvent",new yo(a,t));const y=a.boxZoom=new dl(a,t);this._add("boxZoom",y);const b=new ym,S=new bm;a.doubleClickZoom=new _h(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const M=new Oo;this._add("tapDragZoom",M);const R=a.touchPitch=new Um(a);this._add("touchPitch",R);const N=new Fp(t),U=new yf(t);a.dragRotate=new Ff(t,N,U),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",U,["mouseRotate"]);const Y=new Bp(t),X=new Np(a,t);a.dragPan=new ec(d,Y,X),this._add("mousePan",Y),this._add("touchPan",X,["touchZoom","touchRotate"]);const Q=new xs,ae=new Vm;a.touchZoomRotate=new Nf(d,ae,Q,M),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ko(a));const ie=a.scrollZoom=new Zu(a,this);this._add("scrollZoom",ie,["mousePan"]);const _e=a.keyboard=new xf;this._add("keyboard",_e);for(const fe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[fe]&&a[fe].enable(t[fe])}_add(t,a,d){this._handlers.push({handlerName:t,handler:a,allowed:d}),this._handlersById[t]=a}stop(t){if(!this._updatingCamera){for(const{handler:a}of this._handlers)a.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,a,d){for(const y in t)if(y!==d&&(!a||a.indexOf(y)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const a=[];for(const d of t)this._el.contains(d.target)&&a.push(d);return a}handleEvent(t,a){this._updatingCamera=!0;const d=t.type==="renderFrame",y=d?void 0:t,b={needsRenderFrame:!1},S={},M={},R=t.touches?this._getMapTouches(t.touches):void 0,N=R?Vt(this._el,R):d?void 0:Ot(this._el,t);for(const{handlerName:X,handler:Q,allowed:ae}of this._handlers){if(!Q.isEnabled())continue;let ie;this._blockedByActive(M,ae,X)?Q.reset():Q[a||t.type]&&(ie=Q[a||t.type](t,N,R),this.mergeHandlerResult(b,S,ie,X,y),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||Q.isActive())&&(M[X]=Q)}const U={};for(const X in this._previousActiveHandlers)M[X]||(U[X]=y);this._previousActiveHandlers=M,(Object.keys(U).length||wm(b))&&(this._changes.push([b,S,U]),this._triggerRenderFrame()),(Object.keys(M).length||wm(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Y}=b;Y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Y(this._map))}mergeHandlerResult(t,a,d,y,b){if(!d)return;Object.assign(t,d);const S={handlerName:y,originalEvent:d.originalEvent||b};d.zoomDelta!==void 0&&(a.zoom=S),d.panDelta!==void 0&&(a.drag=S),d.pitchDelta!==void 0&&(a.pitch=S),d.bearingDelta!==void 0&&(a.rotate=S)}_applyChanges(){const t={},a={},d={};for(const[y,b,S]of this._changes)y.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(y.panDelta)),y.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(t.around=y.around),y.aroundCoord!==void 0&&(t.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(t.pinchAround=y.pinchAround),y.noInertia&&(t.noInertia=y.noInertia),Object.assign(a,b),Object.assign(d,S);this._updateMapTransform(t,a,d),this._changes=[]}_updateMapTransform(t,a,d){const y=this._map,b=y.transform,S=Te=>[Te.x,Te.y,Te.z];if((Te=>{const De=this._eventsInProgress.drag;return De&&!this._handlersById[De.handlerName].isActive()})()&&!wm(t)){const Te=b.zoom;b.cameraElevationReference="sea",this._originalZoom!=null&&b._orthographicProjectionAtLowPitch&&b.projection.name!=="globe"&&b.pitch===0?(b.cameraElevationReference="ground",b.zoom=this._originalZoom):(b.recenterOnTerrain(),b.cameraElevationReference="ground"),Te!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!wm(t))return void this._fireEvents(a,d,!0);let{panDelta:M,zoomDelta:R,bearingDelta:N,pitchDelta:U,around:Y,aroundCoord:X,pinchAround:Q}=t;b._isCameraConstrained&&(R>0&&(R=0),b._isCameraConstrained=!1),Q!==void 0&&(Y=Q),(R||(Te=>a[Te]&&!this._eventsInProgress[Te])("drag"))&&Y&&(this._dragOrigin=S(b.pointCoordinate3D(Y)),this._originalZoom=b.zoom,this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),Y=Y||y.transform.centerPoint,N&&(b.bearing+=N),U&&(b.pitch+=U),b._updateCameraState();const ae=[0,0,0];if(M)if(b.projection.name==="mercator"){const Te=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(Y).dir),De=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(Y.sub(M)).dir);ae[0]=De[0]-Te[0],ae[1]=De[1]-Te[1]}else{const Te=b.pointCoordinate(Y);if(b.projection.name==="globe"){M=M.rotate(-b.angle);const De=b._pixelsPerMercatorPixel/b.worldSize;ae[0]=-M.x*n.eW(n.a$(Te.y))*De,ae[1]=-M.y*n.eW(b.center.lat)*De}else{const De=b.pointCoordinate(Y.sub(M));Te&&De&&(ae[0]=De.x-Te.x,ae[1]=De.y-Te.y)}}const ie=b.zoom,_e=[0,0,0];if(R){const Te=S(X||b.pointCoordinate3D(Y)),De={dir:n.aw([],n.av([],Te,b._camera.position))};if(De.dir[2]<0){const Se=b.zoomDeltaToMovement(Te,R);n.c5(_e,De.dir,Se)}}const fe=n.d8(ae,ae,_e);b._translateCameraConstrained(fe),R&&Math.abs(b.zoom-ie)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(a,d,!0)}_fireEvents(t,a,d){const y=gh(this._eventsInProgress),b=gh(t),S={};for(const U in t){const{originalEvent:Y}=t[U];this._eventsInProgress[U]||(S[`${U}start`]=Y),this._eventsInProgress[U]=t[U]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const U in S)this._fireEvent(U,S[U]);b&&this._fireEvent("move",b.originalEvent);for(const U in t){const{originalEvent:Y}=t[U];this._fireEvent(U,Y)}const M={};let R;for(const U in this._eventsInProgress){const{handlerName:Y,originalEvent:X}=this._eventsInProgress[U];this._handlersById[Y].isActive()||(delete this._eventsInProgress[U],R=a[Y]||X,M[`${U}end`]=R)}for(const U in M)this._fireEvent(U,M[U]);const N=gh(this._eventsInProgress);if(d&&(y||b)&&!N){this._updatingCamera=!0;const U=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;U?(Y(U.bearing||this._map.getBearing())&&(U.bearing=0),this._map.easeTo(U,{originalEvent:R})):(this._map.fire(new n.z("moveend",{originalEvent:R})),Y(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,a){this._map.fire(new n.z(t,a?{originalEvent:a}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((t=>{this._frameId=void 0,this.handleEvent(new Vf("renderFrame",{timeStamp:t})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const jp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Uf extends n.E{constructor(t,a){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=a.bearingSnap,this._respectPrefersReducedMotion=a.respectPrefersReducedMotion!==!1,n.aY(["_renderFrameCallback"],this)}getCenter(){return new n.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,a){return this.jumpTo({center:t},a)}panBy(t,a,d){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},a),d)}panTo(t,a,d){return this.easeTo(Object.assign({center:t},a),d)}getZoom(){return this.transform.zoom}setZoom(t,a){return this.jumpTo({zoom:t},a),this}zoomTo(t,a,d){return this.easeTo(Object.assign({zoom:t},a),d)}zoomIn(t,a){return this.zoomTo(this.getZoom()+1,t,a),this}zoomOut(t,a){return this.zoomTo(this.getZoom()-1,t,a),this}getBearing(){return this.transform.bearing}setBearing(t,a){return this.jumpTo({bearing:t},a),this}getPadding(){return this.transform.padding}setPadding(t,a){return this.jumpTo({padding:t},a),this}rotateTo(t,a,d){return this.easeTo(Object.assign({bearing:t},a),d)}resetNorth(t,a){return this.rotateTo(0,Object.assign({duration:1e3},t),a),this}resetNorthPitch(t,a){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),a),this}snapToNorth(t,a){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,a):this}getPitch(){return this.transform.pitch}setPitch(t,a){return this.jumpTo({pitch:t},a),this}cameraForBounds(t,a){t=n.aI.convert(t);const d=a&&a.bearing||0,y=a&&a.pitch||0,b=t.getNorthWest(),S=t.getSouthEast();return this._cameraForBounds(this.transform,b,S,d,y,a)}_extendPadding(t){const a={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},a,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},a,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,a){const d=a.max[0]-a.min[0],y=a.max[1]-a.min[1];return d/y>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):y/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,a,d,y,b,S){const M=t.clone(),R=this._extendCameraOptions(S);M.bearing=y,M.pitch=b;const N=n.aT.convert(a),U=n.aT.convert(d),Y=.5*(N.lat+U.lat),X=.5*(N.lng+U.lng),Q=n.eZ(Y,X),ae=n.aw([],Q),ie=n.aw([],n.bI([],ae,[0,1,0])),_e=n.bI([],ie,ae),fe=[ie[0],ie[1],ie[2],0,_e[0],_e[1],_e[2],0,ae[0],ae[1],ae[2],0,0,0,0,1],Te=[Q,n.eZ(N.lat,N.lng),n.eZ(U.lat,N.lng),n.eZ(U.lat,U.lng),n.eZ(N.lat,U.lng),n.eZ(Y,N.lng),n.eZ(Y,U.lng),n.eZ(N.lat,X),n.eZ(U.lat,X)];let De=n.d9.fromPoints(Te.map((Dt=>[n.bJ(ie,Dt),n.bJ(_e,Dt),n.bJ(ae,Dt)])));const Se=n.af([],De.center,fe);n.e_(Se)===0&&n.e$(Se,0,0,1),n.aw(Se,Se),n.c5(Se,Se,n.aD),M.center=n.f0(Se);const Ze=M.getWorldToCameraMatrix(),Ve=n.bl(new Float64Array(16),Ze);De=n.d9.applyTransform(De,n.aB([],Ze,fe));const Ge=this._extendAABB(De,M,R,y);if(!Ge)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");De=Ge,n.af(Se,Se,Ze);const Fe=.5*(De.max[2]-De.min[2]),Oe=this._minimumAABBFrustumDistance(M,De),it=n.c5([],[0,0,1],Fe),ft=n.d8(it,Se,it),ht=Oe+(M.pitch===0?0:n.bG(Se,ft)),St=M.globeCenterInViewSpace,It=n.av([],Se,[St[0],St[1],St[2]]);n.aw(It,It),n.c5(It,It,ht);const zt=n.d8([],Se,It);n.af(zt,zt,Ve);const Jt=n.eM/n.aD,gt=n.ag(zt),nt=n.cf(Math.max(gt*Jt-n.eM,Number.EPSILON),0),Bt=Math.min(M.zoomFromMercatorZAdjusted(nt),R.maxZoom);return Bt>.5*(n.c_+n.cL)?(M.setProjection({name:"mercator"}),M.zoom=Bt,this._cameraForBounds(M,a,d,y,b,S)):{center:M.center,zoom:Bt,bearing:y,pitch:b}}_extendAABB(t,a,d,y){const b=.5*((d.padding.left||0)+(d.padding.right||0)),S=.5*((d.padding.top||0)+(d.padding.bottom||0)),M=S,R=b,N=b,U=S,Y=a.width-(R+N),X=a.height-(M+U),Q=n.av([],t.max,t.min),ae=Math.min(Y/Q[0],X/Q[1]),ie=Math.min(a.scaleZoom(a.scale*ae),d.maxZoom);if(isNaN(ie))return null;const _e=a.scale/a.zoomScale(ie),fe=new n.d9([t.min[0]-R*_e,t.min[1]-U*_e,t.min[2]],[t.max[0]+N*_e,t.max[1]+M*_e,t.max[2]]),Te=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new n.P(d.offset.x,d.offset.y):n.P.convert(d.offset)).rotate(-n.an(y));return fe.center[0]-=Te.x*_e,fe.center[1]+=Te.y*_e,fe}queryTerrainElevation(t,a){const d=this.transform.elevation;return d?(a=Object.assign({},{exaggerated:!0},a),d.getAtPoint(n.ae.fromLngLat(t),null,a.exaggerated)):null}_cameraForBounds(t,a,d,y,b,S){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,a,d,y,b,S);const M=t.clone(),R=this._extendCameraOptions(S);M.bearing=y,M.pitch=b;const N=n.aT.convert(a),U=n.aT.convert(d),Y=new n.aT(N.lng,U.lat),X=new n.aT(U.lng,N.lat),Q=M.project(N),ae=M.project(U),ie=this.queryTerrainElevation(N),_e=this.queryTerrainElevation(U),fe=this.queryTerrainElevation(Y),Te=this.queryTerrainElevation(X),De=[[Q.x,Q.y,Math.min(ie||0,_e||0,fe||0,Te||0)],[ae.x,ae.y,Math.max(ie||0,_e||0,fe||0,Te||0)]];let Se=n.d9.fromPoints(De);const Ze=M.getWorldToCameraMatrix(),Ve=n.bl(new Float64Array(16),Ze);Se=n.d9.applyTransform(Se,Ze);const Ge=this._extendAABB(Se,M,R,y);if(!Ge)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Se=Ge;const Fe=.5*n.av([],Se.max,Se.min)[2],Oe=this._minimumAABBFrustumDistance(M,Se),it=[0,0,1,0];n.aC(it,it,Ze),n.f1(it,it);const ft=n.c5([],it,Oe+Fe),ht=n.d8([],Se.center,ft);n.af(Se.center,Se.center,Ve),n.af(ht,ht,Ve);const St=M.unproject(new n.P(Se.center[0],Se.center[1])),It=n.f2(M.projection,St),zt=Math.pow(2,It),Jt=Math.min(M._zoomFromMercatorZ(ht[2]*M.pixelsPerMeter*zt/M.worldSize),R.maxZoom);return M.mercatorFromTransition&&Jt<.5*(n.c_+n.cL)?(M.setProjection({name:"globe"}),M.zoom=Jt,this._cameraForBounds(M,a,d,y,b,S)):{center:St,zoom:Jt,bearing:y,pitch:b}}fitBounds(t,a,d){const y=this.cameraForBounds(t,a);return this._fitInternal(y,a,d)}fitScreenCoordinates(t,a,d,y,b){const S=n.P.convert(t),M=n.P.convert(a),R=new n.P(Math.min(S.x,M.x),Math.min(S.y,M.y)),N=new n.P(Math.max(S.x,M.x),Math.max(S.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,M))return this;const U=this.transform.pointLocation3D(R),Y=this.transform.pointLocation3D(N),X=this.transform.pointLocation3D(new n.P(R.x,N.y)),Q=this.transform.pointLocation3D(new n.P(N.x,R.y)),ae=[Math.min(U.lng,Y.lng,X.lng,Q.lng),Math.min(U.lat,Y.lat,X.lat,Q.lat)],ie=[Math.max(U.lng,Y.lng,X.lng,Q.lng),Math.max(U.lat,Y.lat,X.lat,Q.lat)],_e=y&&y.pitch?y.pitch:this.getPitch(),fe=this._cameraForBounds(this.transform,ae,ie,d,_e,y);return this._fitInternal(fe,y,b)}_fitInternal(t,a,d){return t?(a=Object.assign(t,a)).linear?this.easeTo(a,d):this.flyTo(a,d):this}jumpTo(t,a){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,S=!1;"zoom"in t&&d.zoom!==+t.zoom&&(y=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=n.aT.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(b=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(S=!0,d.pitch=+t.pitch);const M=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(M))if(t.retainPadding===!1){const R=d.clone();R.padding=M,d.setLocationAtPoint(d.center,R.centerPoint)}else d.padding=M;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new n.z("movestart",a)).fire(new n.z("move",a)),y&&this.fire(new n.z("zoomstart",a)).fire(new n.z("zoom",a)).fire(new n.z("zoomend",a)),b&&this.fire(new n.z("rotatestart",a)).fire(new n.z("rotate",a)).fire(new n.z("rotateend",a)),S&&this.fire(new n.z("pitchstart",a)).fire(new n.z("pitch",a)).fire(new n.z("pitchend",a)),this.fire(new n.z("moveend",a)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(jp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,a){const d=this.transform;if(!d.projection.supportsFreeCamera)return n.w(jp),this;this.stop();const y=d.zoom,b=d.pitch,S=d.bearing;d.setFreeCameraOptions(t);const M=y!==d.zoom,R=b!==d.pitch,N=S!==d.bearing;return this.fire(new n.z("movestart",a)).fire(new n.z("move",a)),M&&this.fire(new n.z("zoomstart",a)).fire(new n.z("zoom",a)).fire(new n.z("zoomend",a)),N&&this.fire(new n.z("rotatestart",a)).fire(new n.z("rotate",a)).fire(new n.z("rotateend",a)),R&&this.fire(new n.z("pitchstart",a)).fire(new n.z("pitch",a)).fire(new n.z("pitchend",a)),this.fire(new n.z("moveend",a)),this}easeTo(t,a){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:n.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),M=this.getPadding(),R="zoom"in t?+t.zoom:y,N="bearing"in t?this._normalizeBearing(t.bearing,b):b,U="pitch"in t?+t.pitch:S,Y=this._extendPadding(t.padding),X=n.P.convert(t.offset);let Q,ae,ie;if(d.projection.name==="globe"){const it=n.ae.fromLngLat(d.center),ft=X.rotate(-d.angle);it.x+=ft.x/d.worldSize,it.y+=ft.y/d.worldSize;const ht=it.toLngLat(),St=n.aT.convert(t.center||ht);this._normalizeCenter(St),Q=d.centerPoint.add(ft),ae=new n.P(it.x,it.y).mult(d.worldSize),ie=new n.P(n.aF(St.lng),n.aJ(St.lat)).mult(d.worldSize).sub(ae)}else{Q=d.centerPoint.add(X);const it=d.pointLocation(Q),ft=n.aT.convert(t.center||it);this._normalizeCenter(ft),ae=d.project(it),ie=d.project(ft).sub(ae)}const _e=d.zoomScale(R-y);let fe,Te;t.around&&(fe=n.aT.convert(t.around),Te=d.locationPoint(fe));const De=this._zooming||R!==y,Se=this._rotating||b!==N,Ze=this._pitching||U!==S,Ve=!d.isPaddingEqual(Y),Ge=t.retainPadding===!1?d.clone():d,Fe=it=>ft=>{if(De&&(it.zoom=n.ak(y,R,ft)),Se&&(it.bearing=n.ak(b,N,ft)),Ze&&(it.pitch=n.ak(S,U,ft)),Ve&&(Ge.interpolatePadding(M,Y,ft),Q=Ge.centerPoint.add(X)),fe)it.setLocationAtPoint(fe,Te);else{const ht=it.zoomScale(it.zoom-y),St=R>y?Math.min(2,_e):Math.max(.5,_e),It=Math.pow(St,1-ft),zt=it.unproject(ae.add(ie.mult(ft*It)).mult(ht));it.setLocationAtPoint(it.renderWorldCopies?zt.wrap():zt,Q)}return t.preloadOnly||this._fireMoveEvents(a),it};if(t.preloadOnly){const it=this._emulate(Fe,t.duration,d);return this._preloadTiles(it),this}const Oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=De,this._rotating=Se,this._pitching=Ze,this._padding=Ve,this._easeId=t.easeId,this._prepareEase(a,t.noMoveStart,Oe),this._ease(Fe(d),(it=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(a,it)}),t),this}_prepareEase(t,a,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),a||d.moving||this.fire(new n.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new n.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new n.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new n.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.z("move",t)),this._zooming&&this.fire(new n.z("zoom",t)),this._rotating&&this.fire(new n.z("rotate",t)),this._pitching&&this.fire(new n.z("pitch",t))}_afterEase(t,a){if(this._easeId&&a&&this._easeId===a)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new n.z("zoomend",t)),y&&this.fire(new n.z("rotateend",t)),b&&this.fire(new n.z("pitchend",t)),this.fire(new n.z("moveend",t))}flyTo(t,a){if(this._prefersReducedMotion(t)){const Dt=n.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Dt,a)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:n.eV},t);const d=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),M=this.getPadding(),R="zoom"in t?n.aA(+t.zoom,d.minZoom,d.maxZoom):y,N="bearing"in t?this._normalizeBearing(t.bearing,b):b,U="pitch"in t?+t.pitch:S,Y=this._extendPadding(t.padding),X=d.zoomScale(R-y),Q=n.P.convert(t.offset);let ae=d.centerPoint.add(Q);const ie=d.pointLocation(ae),_e=n.aT.convert(t.center||ie);this._normalizeCenter(_e);const fe=d.project(ie),Te=d.project(_e).sub(fe);let De=t.curve;const Se=Math.max(d.width,d.height),Ze=Se/X,Ve=Te.mag();if("minZoom"in t){const Dt=n.aA(Math.min(t.minZoom,y,R),d.minZoom,d.maxZoom),li=Se/d.zoomScale(Dt-y);De=Math.sqrt(li/Ve*2)}const Ge=De*De;function Fe(Dt){const li=(Ze*Ze-Se*Se+(Dt?-1:1)*Ge*Ge*Ve*Ve)/(2*(Dt?Ze:Se)*Ge*Ve);return Math.log(Math.sqrt(li*li+1)-li)}function Oe(Dt){return(Math.exp(Dt)-Math.exp(-Dt))/2}function it(Dt){return(Math.exp(Dt)+Math.exp(-Dt))/2}const ft=Fe(0);let ht=function(Dt){return it(ft)/it(ft+De*Dt)},St=function(Dt){return Se*((it(ft)*(Oe(li=ft+De*Dt)/it(li))-Oe(ft))/Ge)/Ve;var li},It=(Fe(1)-ft)/De;if(Math.abs(Ve)<1e-6||!isFinite(It)){if(Math.abs(Se-Ze)<1e-6)return this.easeTo(t,a);const Dt=Ze<Se?-1:1;It=Math.abs(Math.log(Ze/Se))/De,St=function(){return 0},ht=function(li){return Math.exp(Dt*De*li)}}t.duration="duration"in t?+t.duration:1e3*It/("screenSpeed"in t?+t.screenSpeed/De:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const zt=b!==N,Jt=U!==S,gt=!d.isPaddingEqual(Y),nt=t.retainPadding===!1?d.clone():d,Bt=Dt=>li=>{const Ei=li*It,Ri=1/ht(Ei);Dt.zoom=li===1?R:y+Dt.scaleZoom(Ri),zt&&(Dt.bearing=n.ak(b,N,li)),Jt&&(Dt.pitch=n.ak(S,U,li)),gt&&(nt.interpolatePadding(M,Y,li),ae=nt.centerPoint.add(Q));const Ti=li===1?_e:Dt.unproject(fe.add(Te.mult(St(Ei))).mult(Ri));return Dt.setLocationAtPoint(Dt.renderWorldCopies?Ti.wrap():Ti,ae),Dt._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(a),Dt};if(t.preloadOnly){const Dt=this._emulate(Bt,t.duration,d);return this._preloadTiles(Dt),this}return this._zooming=!0,this._rotating=zt,this._pitching=Jt,this._padding=gt,this._prepareEase(a,!1),this._ease(Bt(d),(()=>this._afterEase(a)),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,a){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,a)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,a,d){d.animate===!1||d.duration===0?(t(1),a()):(this._easeStart=n.o.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=a,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.o.now()-this._easeStart)/this._easeOptions.duration,1),a=this._onEaseFrame;a&&a(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,a){t=n.bT(t,-180,180);const d=Math.abs(t-a);return Math.abs(t-360-a)<d&&(t-=360),Math.abs(t+360-a)<d&&(t+=360),t}_normalizeCenter(t){const a=this.transform;if(a.maxBounds||a.projection.name!=="globe"&&!a.renderWorldCopies)return;const d=t.lng-a.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,a,d){const y=Math.ceil(15*a/1e3),b=[],S=t(d.clone());for(let M=0;M<=y;M++){const R=S(M/y);b.push(R.clone())}return b}_preloadTiles(t,a){}}class Fc{constructor(t={}){this.options=t,n.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const a=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Vi("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const y=Vi("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",d),this._innerContainer=Vi("div","mapboxgl-ctrl-attrib-inner",this._container),a&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),a===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const a=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){const d=a.reduce(((y,b,S)=>(b.value&&(y+=`${b.key}=${b.value}${S<a.length-1?"&":""}`),y)),"?");t.href=`${n.e.FEEDBACK_URL}/${d}#${ao(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const a=this._map.style._mergedSourceCaches;for(const y in a){const b=a[y];if(b.used){const S=b.getSource();S.attribution&&t.indexOf(S.attribution)<0&&t.push(S.attribution)}}t.sort(((y,b)=>y.length-b.length)),t=t.filter(((y,b)=>{for(let S=b+1;S<t.length;S++)if(t[S].indexOf(y)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.map((y=>(function(b){const S=new DOMParser().parseFromString(b,"text/html");return Array.from(S.body.querySelectorAll("*")).forEach((M=>{const R=M.textContent||"";if(M.tagName!=="A")return void M.replaceWith(S.createTextNode(R));const N=M.getAttribute("href");if(!N||!/^(https?:|mailto:)/i.test(N))return void M.replaceWith(S.createTextNode(R));const U=S.createElement("a");U.href=N,U.textContent=R,U.rel="noopener nofollow";const Y=M.getAttribute("class");Y&&(U.className=Y),M.replaceWith(U)})),S.body.innerHTML})(y))).join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class jf{constructor(){n.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=Vi("div","mapboxgl-ctrl");const a=Vi("a","mapboxgl-ctrl-logo");return a.target="_blank",a.rel="noopener nofollow",a.href="https://www.mapbox.com/",a.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),a.setAttribute("rel","noopener nofollow"),this._container.appendChild(a),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const a in t){const d=t[a].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const a=t[0];this._map.getCanvasContainer().offsetWidth<250?a.classList.add("mapboxgl-compact"):a.classList.remove("mapboxgl-compact")}}}class Gf{constructor(){n.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",(a=>this._onIndoorUpdate(a))),this._container}_createButton(t,a){const d=Vi("button",t,this._container);return d.type="button",d.addEventListener("click",a),d}_createSeparator(){return Vi("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,a){this._map&&(t.setAttribute("aria-label",a),t.textContent=a)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const a=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",a&&Array.from(this._container.children).forEach((d=>d.remove())),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",(()=>{const a=this._map;this._model&&a&&a._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)}));Vi("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,a){for(let d=0;d<t.length;d++){const y=t[d],b=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(y.id)}));this._setButtonTitle(b,y.zIndex.toString()),this._model&&y.id===this._model.selectedFloorId&&a&&b.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(b),d<t.length-1&&this._createSeparator()}}}class Xu{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const a=++this._id;return this._queue.push({callback:t,id:a,cancelled:!1}),a}remove(t){const a=this._currentlyRunning,d=a?this._queue.concat(a):this._queue;for(const y of d)if(y.id===t)return void(y.cancelled=!0)}run(t=0){const a=this._currentlyRunning=this._queue;this._queue=[];for(const d of a)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class tc{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const a=n.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-a)+this._end*a}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,a,d){this._start=this.getValue(a),this._end=t,this._startTime=a,this._endTime=a+d}}const xd={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class vd extends n.z{constructor(t,a,d,y){const{point:b,lngLat:S,originalEvent:M,target:R}=t;super(t.type,{point:b,lngLat:S,originalEvent:M,target:R}),this.preventDefault=()=>{t.preventDefault()},this.id=a,this.interaction=d,this.feature=y}}class yh{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,a){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=a.filter;let y=a.type;d&&this.filters.set(t,n.b6(d)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const b=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,a)):b.size===0&&this.map.on(y,this.handleType),b.size===0&&this.interactionsByType.set(y,b),b.set(t,a),this.typeById.set(t,y)}get(t){const a=this.typeById.get(t);if(!a)return;const d=this.interactionsByType.get(a);return d?d.get(t):void 0}remove(t){const a=this.typeById.get(t);if(!a)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(a);d&&(d.delete(t),a==="mouseenter"||a==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(a,this.handleType))}queryTargets(t,a){const d=[];for(const[y,b]of a)b.target&&d.push({targetId:y,target:b.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const a=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());a.length&&(t.type="mouseenter",this.handleType(t,a));const d=new Map;for(const[y,{feature:b}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||d.set(b.id,b);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const a=Array.from(this.hoveredFeatures.values()).map((({feature:d})=>d));a.length&&(t.type="mouseleave",this.handleType(t,a)),this.hoveredFeatures.clear()}handleType(t,a){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void n.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(t.type)).reverse(),b=!!a;a=a||this.queryTargets(t.point,y);let S=!1;const M=new Set;for(const R of a){for(const[N,U]of y){if(!U.target)continue;const Y=R.variants?R.variants[N]:null;if(Y){for(const X of Y){if(Mh(X,R,M,N))continue;const Q=new n.dx(R,X),ae=jc(X,R,N);b&&Q.id!==void 0&&(Q.state=this.map.getFeatureState(Q));const ie=d?this.prevHoveredFeatures.get(ae):null,_e=new vd(t,N,U,Q),fe=ie?ie.stop:U.handler(_e);if(d&&this.hoveredFeatures.set(ae,{feature:R,stop:fe}),fe!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[R,N]of y){const{handler:U,target:Y}=N;if(!Y&&U(new vd(t,R,N,null))!==!1)break}}}function Tm(h,t){if(Array.isArray(h)&&Array.isArray(t)){const a=new Set(h),d=new Set(t);return a.size===d.size&&h.every((y=>d.has(y)))}return n.by(h,t)}const Gp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},qp={showCompass:!0,showZoom:!0,visualizePitch:!1};class jm{constructor(t,a,d=!1){this._clickTolerance=10,this.element=a,this.mouseRotate=new Fp({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new yf({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),a.addEventListener("mousedown",this.mousedown),a.addEventListener("touchstart",this.touchstart,{passive:!1}),a.addEventListener("touchmove",this.touchmove),a.addEventListener("touchend",this.touchend),a.addEventListener("touchcancel",this.reset)}down(t,a){this.mouseRotate.mousedown(t,a),this.mousePitch&&this.mousePitch.mousedown(t,a),Vn()}move(t,a){const d=this.map,y=this.mouseRotate.mousemoveWindow(t,a),b=y&&y.bearingDelta;if(b&&d.setBearing(d.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(t,a),M=S&&S.pitchDelta;M&&d.setPitch(d.getPitch()+M)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Oi(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),Ot(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,Ot(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Vt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Vt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function xh(h,t,a){if(h=new n.aT(h.lng,h.lat),t){const d=new n.aT(h.lng-360,h.lat),y=new n.aT(h.lng+360,h.lat),b=360*Math.ceil(Math.abs(h.lng-a.center.lng)/360),S=a.locationPoint3D(h).distSqr(t),M=t.x<0||t.y<0||t.x>a.width||t.y>a.height;a.locationPoint3D(d).distSqr(t)<S&&(M||Math.abs(d.lng-a.center.lng)<b)?h=d:a.locationPoint3D(y).distSqr(t)<S&&(M||Math.abs(y.lng-a.center.lng)<b)&&(h=y)}for(;Math.abs(h.lng-a.center.lng)>180;){const d=a.locationPoint3D(h);if(d.x>=0&&d.y>=0&&d.x<=a.width&&d.y<=a.height)break;h.lng>a.center.lng?h.lng-=360:h.lng+=360}return h}const ps={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},wc={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Hp extends n.E{constructor(t,a){super(),(t instanceof HTMLElement||a)&&(t=Object.assign({element:t},a)),n.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:y="#3FB1CE",scale:b=1,draggable:S=!1,clickTolerance:M=0,rotation:R=wc.rotation,rotationAlignment:N=wc.rotationAlignment,pitchAlignment:U=wc.pitchAlignment,occludedOpacity:Y=wc.occludedOpacity,altitude:X=wc.altitude}=t||{};this._anchor=d,this._color=y,this._scale=b,this._draggable=S,this._clickTolerance=M,this._rotation=R,this._rotationAlignment=N,this._pitchAlignment=U,this._occludedOpacity=Y,this._altitude=X,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=n.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(ie=>{ie.preventDefault()})),this._element.addEventListener("mousedown",(ie=>{ie.preventDefault()}));const Q=this._element.classList;for(const ie in ps)Q.remove(`mapboxgl-marker-anchor-${ie}`);Q.add(`mapboxgl-marker-anchor-${this._anchor}`);const ae=t&&t.className?t.className.trim().split(/\s+/):[];Q.add(...ae),this._popup=null}_createDefaultMarker(){const t=Vi("div"),a=Wi("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=Wi("radialGradient",{id:"shadowGradient"},Wi("defs",{},a));Wi("stop",{offset:"10%","stop-opacity":.4},d),Wi("stop",{offset:"100%","stop-opacity":.05},d),Wi("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},a)}return Wi("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},a),Wi("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},a),Wi("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},a),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||wc.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const a=t.code,d=t.charCode||t.keyCode;a!=="Space"&&a!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const a=t.originalEvent.target,d=this._element;this._popup&&(a===d||d.contains(a))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,a=this._pos;if(!t||!a)return!1;const d=t.unproject(a,this._altitude),y=t.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(d)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const a=this._pos;if(!a||a.x<0||a.x>t.transform.width||a.y<0||a.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(a,this._altitude);let y;t._showingGlobe()&&n.f5(t.transform,this._lngLat)?y=0:(y=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const a=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ps[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${a.x}px,${a.y}px)
        `}_calculateXYTransform(){const t=this._pos,a=this._map,d=this.getPitchAlignment();if(!a||!t||d!=="map")return"";if(!a._showingGlobe()){const R=a.getPitch();return R?`rotateX(${R}deg)`:""}const y=n.cX(n.f6(a.transform,this._lngLat)),b=t.sub(n.f7(a.transform)),S=Math.abs(b.x)+Math.abs(b.y);if(S===0)return"";const M=y/S;return`rotateX(${-b.y*M}deg) rotateY(${b.x*M}deg)`}_calculateZTransform(){const t=this._pos,a=this._map;if(!a||!t)return"";let d=0;const y=this.getRotationAlignment();if(y==="map")if(a._showingGlobe()){const b=a.project(new n.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=a.project(new n.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(b);d=n.cX(Math.atan2(S.y,S.x))-90}else d=-a.getBearing();else if(y==="horizon"){const b=n.ah(4,6,a.getZoom()),S=n.f7(a.transform);S.y+=b*a.transform.height;const M=t.sub(S),R=n.cX(Math.atan2(M.y,M.x));d=(R>90?R-270:R+90)*(1-b)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const a=this._map;a&&(a.transform.renderWorldCopies&&(this._lngLat=xh(this._lngLat,this._pos,a.transform)),this._pos=a.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),a._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(a._showingGlobe()||a.getTerrain()||a.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const a=this._map;if(!a)return;const d=this._pointerdownPos,y=this._positionDelta;if(d&&y){if(!this._isDragging){const b=this._clickTolerance||a._clickTolerance;if(t.point.dist(d)<b)return;this._isDragging=!0}this._pos=t.point.sub(y),this._lngLat=a.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.z("dragstart"))),this.fire(new n.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.z("dragend")),this._state="inactive"}_addDragHandler(t){const a=this._map,d=this._pos;a&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",a.on("mousemove",this._onMove),a.on("touchmove",this._onMove),a.once("mouseup",this._onUp),a.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const a=this._map;return a&&(t?(a.on("mousedown",this._addDragHandler),a.on("touchstart",this._addDragHandler)):(a.off("mousedown",this._addDragHandler),a.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||wc.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||wc.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||wc.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||wc.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ul={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},gp={maxWidth:100,unit:"metric"},Sm={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Wu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},vs=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function wl(h=new n.P(0,0),t="bottom"){if(typeof h=="number"){const a=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new n.P(0,h);case"top-left":return new n.P(a,a);case"top-right":return new n.P(-a,a);case"bottom":return new n.P(0,-h);case"bottom-left":return new n.P(a,-a);case"bottom-right":return new n.P(-a,-a);case"left":return new n.P(h,0);case"right":return new n.P(-h,0)}return new n.P(0,0)}return h instanceof n.P||Array.isArray(h)?n.P.convert(h):n.P.convert(h[t]||[0,0])}return{version:tt,supported:on.supported,setRTLTextPlugin:n.fb,getRTLTextPluginStatus:n.fa,Map:class extends Uf{constructor(h){Rt.mark(ke.create);const t=h;if((h=Object.assign({},Gp,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&n.f3(window)&&(h.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Qf(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new Xu,this._domRenderTaskQueue=new Xu,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.b2(),this._locale=Object.assign({},xd,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new tc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new Hr(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const a=document.getElementById(h.container);if(!a)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=a}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,n.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new u_(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||n.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new Xh(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const a=h.bounds;a&&(this.resize(),this.fitBounds(a,Object.assign({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new Fc({customAttribution:h.customAttribution})),this._logoControl=new jf,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()})),this.on("data",(a=>{this._update(a.dataType==="style"),this.fire(new n.z(`${a.dataType}data`,a))})),this.on("dataloading",(a=>{this.fire(new n.z(`${a.dataType}dataloading`,a))})),this._interactions=new yh(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new n.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const a=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(a,d.firstChild):d.appendChild(a),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new n.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new n.z("movestart",h)).fire(new n.z("move",h)),this.fire(new n.z("resize",h)),t&&this.fire(new n.z("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(n.aI.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this._scaleFactorChanged=!0,this.style._updateFilteredLayers((t=>t.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map((t=>t==="auto"?navigator.language:t)):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const a of this._controls)a._setLanguage&&a._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let a;t==="globe"&&h.zoom>=n.cL?(h.setMercatorFromTransition(),a=!0):t==="mercator"&&h.zoom<n.cL&&(h.setProjection({name:"globe"}),a=!0),a&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;const a=this.transform.mercatorFromTransition;t=h.name==="globe"&&this.transform.zoom>=n.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate();const d=this.transform.getProjection().name==="mercator"&&a!==this.transform.mercatorFromTransition;return(t||d)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(n.aT.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(n.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,a){const d=y=>{let b=[];if(Array.isArray(t)){const S=t.filter((M=>this.getLayer(M)));b=S.length?this.queryRenderedFeatures(y,{layers:S}):[]}else b=this.queryRenderedFeatures(y,{target:t});return b};if(h==="mouseenter"||h==="mouseover"){let y=!1;return{listener:a,targets:t,delegates:{mousemove:S=>{const M=d(S.point);M.length?y||(y=!0,a.call(this,new Bc(h,this,S.originalEvent,{features:M}))):y=!1},mouseout:()=>{y=!1}}}}if(h==="mouseleave"||h==="mouseout"){let y=!1;return{listener:a,targets:t,delegates:{mousemove:M=>{d(M.point).length?y=!0:y&&(y=!1,a.call(this,new Bc(h,this,M.originalEvent)))},mouseout:M=>{y&&(y=!1,a.call(this,new Bc(h,this,M.originalEvent)))}}}}{const y=b=>{const S=d(b.point);S.length&&(b.features=S,a.call(this,b),delete b.features)};return{listener:a,targets:t,delegates:{[h]:y}}}}on(h,t,a){if(typeof t=="function"||a===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,a);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const y in d.delegates)this.on(y,d.delegates[y]);return this}once(h,t,a){if(typeof t=="function"||a===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,a);for(const y in d.delegates)this.once(y,d.delegates[y]);return this}off(h,t,a){if(typeof t=="function"||a===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(y=>{for(let b=0;b<y.length;b++){const S=y[b];if(S.listener===a&&Tm(S.targets,t)){for(const M in S.delegates)this.off(M,S.delegates[M]);return y.splice(b,1),this}}})(d),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof n.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const b=this.style.queryRenderedFeatures(h,void 0,this.transform),S=this.style.queryRenderedFeatureset(h,void 0,this.transform);return b.concat(S)}let a=!0;if(t.target&&(a=this._isTargetValid(t.target),a&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const b of t.layers)if(!this._isValidId(b)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let y=[];return d&&(y=y.concat(this.style.queryRenderedFeatures(h,t,this.transform))),a&&(y=y.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),y}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}queryRasterValue(h,t,a){return this._isValidId(h)?this.style.queryRasterValue(h,t,a):Promise.resolve(null)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,((a,d)=>{if(a){const y=typeof a=="string"?a:a instanceof Error?a.message:a.error;n.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(h,t)}else d&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const a=Object.assign({},t);t&&t.config&&(a.initialConfig=t.config,delete a.config),this.style=new kl(this,a).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new kl(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new n.y(new Error("IDs can't be empty."))),!1):!n.dr(h)||(this.fire(new n.y(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,a){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,a)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:a=1,sdf:d=!1,stretchX:y,stretchY:b,content:S}={}){this._lazyInitEmptyStyle();const M=n.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:R,height:N,data:U}=n.o.getImageData(t);this.style.addImage(M,{data:new n.q({width:R,height:N},U),pixelRatio:a,stretchX:y,stretchY:b,content:S,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new n.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:R,height:N}=t,U=t;this.style.addImage(M,{data:new n.q({width:R,height:N},new Uint8Array(U.data)),pixelRatio:a,stretchX:y,stretchY:b,content:S,sdf:d,usvg:!1,version:0,userImage:U}),U.onAdd&&U.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const a=n.I.from(h),d=this.style.getImage(a);if(!d)return void this.fire(new n.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.o.getImageData(t):t,{width:b,height:S,data:M}=y;if(b===void 0||S===void 0)return void this.fire(new n.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(b!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||S!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new n.y(new Error(`The width and height of the updated image (${b}, ${S})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const R=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let N=!1;d.usvg?(d.data=new n.q({width:b,height:S},new Uint8Array(M)),d.usvg=!1,d.icon=void 0,N=!0):d.data.replace(M,R),this.style.updateImage(a,d,N)}hasImage(h){return h?!!this.style&&!!this.style.getImage(n.I.from(h)):(this.fire(new n.y(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(n.I.from(h))}loadImage(h,t){n.n(this._requestManager.transformRequest(h,n.R.Image),((a,d)=>{t(a,d instanceof HTMLImageElement?n.o.getImageData(d):d)}))}listImages(){return this.style.listImages().map((h=>h.name))}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new n.y(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t).catch((a=>this.fire(new n.y(new Error("Failed to add import",a))))),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,a){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,a),this._update(!0)):this}setFilter(h,t,a={}){return this._isValidId(h)?(this.style.setFilter(h,t,a),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,a,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,a,d),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,a,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,a,d),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}setLayerProperty(h,t,a,d={}){return this._isValidId(h)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(h,t,a,d),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,a){return this.style.setConfigProperty(h,t,a),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.aT.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_selectIndoorFloor(h){this.indoor.selectFloor(h)}_setIndoorActiveFloorsVisibility(h){this.indoor.setActiveFloorsVisibility(h)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Gf),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let a,d,y,b=this._container;for(;b&&(!d||!y);){const S=window.getComputedStyle(b).transform;S&&S!=="none"&&(a=S.match(/matrix.*\((.+)\)/)[1].split(", "),a[0]&&a[0]!=="0"&&a[0]!=="1"&&(d=a[0]),a[3]&&a[3]!=="0"&&a[3]!=="1"&&(y=a[3])),b=b.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=y?Math.abs(t/y):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new ud(this.style),this.on("load",(()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})),this.on("idle",(()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}))})))}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Vi("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=Vi("div","mapboxgl-canvas-container",h);this._canvas=Vi("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const a=this._controlContainer=Vi("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((y=>{d[y]=Vi("div",`mapboxgl-ctrl-${y}`,a)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const a=n.o.devicePixelRatio||1;this._canvas.width=a*Math.ceil(h),this._canvas.height=a*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=Object.assign({},on.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(Ha(t,!0),this.painter=new hp(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",(a=>{a.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),n.k.testSupport(t)):this.fire(new n.y(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.z("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new n.z("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new n.z("renderstart")),++this._frameId;const a=this.painter.context.extTimerQuery,d=n.o.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=y.createQuery(),y.beginQuery(a.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,U=this.transform.pitch,Y=n.o.now(),X=new n.ac(N,{now:Y,fadeDuration:b,pitch:U,transition:this.style.transition,worldview:this._worldview});this.style.update(X)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(d);const M=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),M&&(this._placementDirty=M.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Rt.mark(ke.load),this.fire(new n.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const N=n.o.now()-d;y.endQuery(a.TIME_ELAPSED_EXT),setTimeout((()=>{const U=y.getQueryParameter(t,y.QUERY_RESULT)/1e6;y.deleteQuery(t),this.fire(new n.z("gpu-timing-frame",{cpuTime:N,gpuTime:U}))}),50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout((()=>{const U=this.painter.queryGpuTimers(N);this.fire(new n.z("gpu-timing-layer",{layerTimes:U}))}),50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const U=this.painter.queryGpuTimeDeferredRender(N);this.fire(new n.z("gpu-timing-deferred-render",{gpuTime:U}))}),50)}const R=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(R||this._repaint)this.triggerRepaint();else{const N=this.idle();if(N&&(S=this._updateAverageElevation(d,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new n.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const U=this._calculateSpeedIndex();this.fire(new n.z("speedindexcompleted",{speedIndex:U})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||R||(this._fullyLoaded=!0,Rt.mark(ke.fullLoad),this._performanceMetricsCollection&&ra(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const a=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&a(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const y=this.transform.averageElevation;let b=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(b)?b=0:this._averageElevationLastSampledAt=h;const S=Math.abs(y-b);if(S>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(b),a(b);this._averageElevation.easeTo(b,h,300)}else if(S>1e-4)return this._averageElevation.jumpTo(b),a(b)}return!!this._averageElevation.isEasing(h)&&a(this._averageElevation.getValue(h))}_authenticate(){Da(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(h=>{if(h&&(h.message===an||h.status===401)){const t=this.painter.context.gl;Ha(t,!1),this._logoControl instanceof jf&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),Jn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Mr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Cn(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Ir(this._requestManager._customAccessToken)}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const a=this.painter.context.gl,d=a.createFramebuffer();function y(b){a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,b,0);const S=new Uint8Array(a.drawingBufferWidth*a.drawingBufferHeight*4);return a.readPixels(0,0,a.drawingBufferWidth,a.drawingBufferHeight,a.RGBA,a.UNSIGNED_BYTE,S),S}return a.bindFramebuffer(a.FRAMEBUFFER,d),this._canvasPixelComparison(y(h),t.canvasCopies.map(y),t.timeStamps)}_canvasPixelComparison(h,t,a){let d=a[1]-a[0];const y=h.length/4;for(let b=0;b<t.length;b++){const S=t[b];let M=0;for(let R=0;R<S.length;R+=4)S[R]===h[R]&&S[R+1]===h[R+1]&&S[R+2]===h[R+2]&&S[R+3]===h[R+3]&&(M+=1);d+=(a[b+2]-a[b+1])*(1-M/y)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Yt.delete(this.painter.context.gl),Aa.remove(),ln.remove(),this._removed=!0,this.fire(new n.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=n.o.frame((t=>{const a=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,a&&this._render(t)})))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return n.bw(t,((a,d)=>a._preloadTiles(h,d)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this.style&&h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,t){n.f4(h,t)}get version(){return tt}},NavigationControl:class{constructor(h={}){this.options=Object.assign({},qp,h),this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this.options.showZoom&&(n.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(t=>{this._map&&this._map.zoomIn({},{originalEvent:t})})),Vi("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(t=>{this._map&&this._map.zoomOut({},{originalEvent:t})})),Vi("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(t=>{const a=this._map;a&&(this.options.visualizePitch?a.resetNorthPitch({},{originalEvent:t}):a.resetNorth({},{originalEvent:t}))})),this._compassIcon=Vi("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),a=t===h.getMaxZoom(),d=t===h.getMinZoom();this._zoomInButton.disabled=a,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",a.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=t)}))}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new jm(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const a=Vi("button",h,this._container);return a.type="button",a.addEventListener("click",t),a}_setButtonTitle(h,t){if(!this._map)return;const a=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",a),h.firstElementChild&&h.firstElementChild.setAttribute("title",a)}},GeolocateControl:class extends n.E{constructor(h={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},Ul,h),n.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Lf(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(a=!!this.options.geolocation)=>{this._supportsGeolocation=a,h(a)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((a=>t(a.state!=="denied"))).catch((()=>t())):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),a=h.coords;return!!t&&(a.longitude<t.getWest()||a.longitude>t.getEast()||a.latitude<t.getSouth()||a.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new n.z("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("geolocate",Object.assign({coords:h.coords,timestamp:h.timestamp},h.toJSON?{toJSON:h.toJSON.bind(h)}:{}))),this._finish()}}_updateCamera(h){const t=new n.aT(h.coords.longitude,h.coords.latitude),a=h.coords.accuracy,d=this._map.getBearing(),y=Object.assign({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(a),y,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new n.aT(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=n.cf(1,h._center.lat)*h.worldSize,a=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${a}px`,this._circleElement.style.height=`${a}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(t=>t.preventDefault())),this._geolocateButton=Vi("button","mapboxgl-ctrl-geolocate",this._container),Vi("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Vi("div","mapboxgl-user-location"),this._dotElement.appendChild(Vi("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Vi("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Hp({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Vi("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hp({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.z("trackuserlocationend")))}))}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((t=>{t==="granted"&&h()})).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fc,ScaleControl:class{constructor(h={}){this.options=Object.assign({},gp,h),n.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,a=t._containerHeight/2,d=t._containerWidth/2-h/2,y=t.unproject([d,a]),b=t.unproject([d+h,a]),S=y.distanceTo(b);if(this.options.unit==="imperial"){const M=3.2808*S;M>5280?this._setScale(h,M/5280,"mile"):this._setScale(h,M,"foot")}else this.options.unit==="nautical"?this._setScale(h,S/1852,"nautical-mile"):S>=1e3?this._setScale(h,S/1e3,"kilometer"):this._setScale(h,S,"meter")}_setScale(h,t,a){this._map._requestDomTask((()=>{const d=(function(b){const S=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/S;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:(function(R){const N=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*N)/N})(M),S*M})(t),y=d/t;this._container.innerHTML=a!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:a}).format(d):`${d}&nbsp;${Sm[a]}`,this._container.style.width=h*y+"px"}))}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:n.w("Full screen control 'container' must be a DOM element.")),n.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Vi("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Vi("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Vi("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Gf,Popup:class extends n.E{constructor(h){super(),this.options=Object.assign(Object.create(Wu),h),this._altitude=this.options.altitude,n.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new n.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new n.z("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=n.aT.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),a=document.createElement("body");let d;for(a.innerHTML=h;d=a.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=Vi("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const a=this._closeButton=Vi("button","mapboxgl-popup-close-button",t);a.type="button",a.setAttribute("aria-label","Close popup"),a.innerHTML='<span aria-hidden="true">&#215;</span>',a.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,a=this._container,d=this._pos;if(!t||!a||!d)return"bottom";const y=a.offsetWidth,b=a.offsetHeight,S=d.x<y/2,M=d.x>t.transform.width-y/2;if(d.y+h<b)return S?"top-left":M?"top-right":"top";if(d.y>t.transform.height-b){if(S)return"bottom-left";if(M)return"bottom-right"}return S?"left":M?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,a=this._content;if(!t||!this._lngLat&&!this._trackPointer||!a)return;let d=this._container;if(d||(d=this._container=Vi("div","mapboxgl-popup",t.getContainer()),this._tip=Vi("div","mapboxgl-popup-tip",d),d.appendChild(a)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=xh(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const y=this._pos=this._trackPointer&&h instanceof n.P?h:t.project(this._lngLat,this._altitude),b=wl(this.options.offset),S=this._anchor=this._getAnchor(b.y),M=wl(this.options.offset,S),R=y.add(M).round();t._requestDomTask((()=>{this._container&&S&&(this._container.style.transform=`${ps[S]} translate(${R.x}px,${R.y}px)`)}))}if(!this._marker&&t._showingGlobe()){const y=n.f5(t.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(vs);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Hp,Style:kl,LngLat:n.aT,LngLatBounds:n.aI,Point:n.P,MercatorCoordinate:n.ae,FreeCameraOptions:$o,Evented:n.E,config:n.e,prewarm:n.f9,clearPrewarmedResources:n.f8,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(h){n.e.ACCESS_TOKEN=h},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(h){n.e.API_URL=h},get workerCount(){return n.fi.workerCount},set workerCount(h){n.fi.workerCount=h},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){n.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){n.fh(h)},get workerUrl(){return n.fg.workerUrl},set workerUrl(h){n.fg.workerUrl=h},get workerClass(){return n.fg.workerClass},set workerClass(h){n.fg.workerClass=h},get workerParams(){return n.fg.workerParams},set workerParams(h){n.fg.workerParams=h},get dracoUrl(){return n.ff()},set dracoUrl(h){n.fe(h)},get meshoptUrl(){return n.fd()},set meshoptUrl(h){n.fc(h)},setNow:n.o.setNow,restoreNow:n.o.restoreNow}}));var le=Me;return le}))})(Gy)),Gy.exports}var ow=EA();const lw=Kg(ow),AA=D1({__proto__:null,default:lw},[ow]),IA="/p87/assets/busstop-5_Cm25Sp.svg",MA="/p87/assets/brtstop-CDNLqygK.svg",CA="/p87/assets/flamingo-C0GlxpRz.svg",zA="data:text/csv;base64,cG9pX2NvZGUsc3RvcF9uYW1lLHBvaV9sYXQscG9pX2xvbg0KMTIzNDUsRmxhbWluZ29zLDQzLjA3NTA4MywtODkuNDAxMTcz";async function nv(J,ue,me){J.hasImage(ue)||await new Promise((ce,Me)=>{const Pe=new Image;Pe.crossOrigin="anonymous",Pe.onload=()=>{try{J.hasImage(ue)||J.addImage(ue,Pe,{pixelRatio:2}),ce()}catch(le){Me(le)}},Pe.onerror=le=>{Me(le||new Error(`Failed to load icon: ${ue}`))},Pe.src=me})}async function DA(){const J=await fetch(zA);if(!J.ok)throw new Error(`Failed to load POI CSV: ${J.status} ${J.statusText}`);const me=(await J.text()).trim().split(/\r?\n/);if(me.length<2)return[];const[ce,...Me]=me,Pe=ce.split(",");return Me.map(n=>n.trim()).filter(Boolean).map(n=>{const tt=n.split(","),ke={};return Pe.forEach((Rt,ut)=>{ke[Rt]=tt[ut]}),ke})}function RA(J){let ue=0;for(let me=0;me<J.length;me++){const ce=J.charCodeAt(me);ue=(ue<<5)-ue+ce,ue=ue&ue}return Math.abs(ue)}function PA({stops:J=[],onStopClick:ue,selectMode:me=!1}){const ce=bA(),[Me,Pe]=Ft.useState(null);return Ft.useEffect(()=>{let le=!0;const n=ce?.current?.getMap?.()??ce?.current??ce;if(!n)return;const tt="stops-source",ke="stops-layer",Rt="busstop-icon",ut="brtstop-icon",bt="flamingo-icon",rn=()=>{Pe(n.getZoom())},on=async()=>{try{if(await Promise.all([nv(n,Rt,IA),nv(n,ut,MA),nv(n,bt,CA)]),!le)return;const Vi=(J||[]).map(Oi=>{const Hn=Oi.stop_id??Oi.stop_code??"",qi=String(Hn),Ot=qi.length===5?ut:Rt,Vt=RA(qi)%100;return{type:"Feature",geometry:{type:"Point",coordinates:[Number(Oi.stop_lon),Number(Oi.stop_lat)]},properties:{id:qi,name:Oi.stop_name,code:Oi.stop_code,icon:Ot,priority:Vt}}}),Wi=await DA();if(!le)return;const Ci=Wi.filter(Oi=>Oi.poi_code==="123456").map(Oi=>({type:"Feature",geometry:{type:"Point",coordinates:[Number(Oi.poi_lon),Number(Oi.poi_lat)]},properties:{id:Oi.poi_code,name:Oi.stop_name,code:Oi.poi_code,icon:bt,priority:0}})),Ji={type:"FeatureCollection",features:[...Vi,...Ci]};if(!n.isStyleLoaded()){console.warn("Style not loaded yet, skipping addSource");return}const Vn=n.getSource(tt);Vn&&typeof Vn.setData=="function"?Vn.setData(Ji):n.getSource(tt)||n.addSource(tt,{type:"geojson",data:Ji}),n.getLayer(ke)?(n.setLayoutProperty(ke,"icon-size",["interpolate",["linear"],["zoom"],12,me?.4:.3,16,["case",["==",["get","icon"],ut],me?1.2:1,["==",["get","icon"],bt],me?1.8:1.5,me?.6:.5],19,["case",["==",["get","icon"],ut],me?1.2:1,["==",["get","icon"],bt],me?1.8:1.5,me?.6:.5]]),n.setLayoutProperty(ke,"icon-opacity",me?.9:1)):(n.addLayer({id:ke,type:"symbol",source:tt,minzoom:12,maxzoom:19,layout:{"icon-image":["get","icon"],"icon-size":["interpolate",["linear"],["zoom"],12,me?.4:.3,16,["case",["==",["get","icon"],ut],me?1.2:1,["==",["get","icon"],bt],me?1.8:1.5,me?.6:.5],19,["case",["==",["get","icon"],ut],me?1.2:1,["==",["get","icon"],bt],me?1.8:1.5,me?.6:.5]],"icon-allow-overlap":!0,"icon-ignore-placement":!0,"icon-opacity":me?.9:1},filter:["any",["==",["get","icon"],bt],["all",[">=",["zoom"],15]],["all",[">=",["zoom"],14],["<",["zoom"],15],["<",["get","priority"],50]],["all",[">=",["zoom"],13],["<",["zoom"],14],["<",["get","priority"],10]],["all",[">=",["zoom"],12],["<",["zoom"],13],["<",["get","priority"],5]]]}),n.on("click",ke,Oi=>{if(!Oi.features||!Oi.features[0])return;const Hn=Oi.features[0].geometry.coordinates.slice(),{name:qi,code:Ot,id:Vt}=Oi.features[0].properties;if(me&&ue){ue(Vt||Ot);return}new lw.Popup().setLngLat(Hn).setHTML(`<b>${qi}</b><br/>Code: ${Ot}`).addTo(n),ue&&ue(Vt||Ot)}),n.on("mouseenter",ke,()=>{n.getCanvas().style.cursor="pointer"}),n.on("mouseleave",ke,()=>{n.getCanvas().style.cursor=""}))}catch(Vi){console.error("Error loading stop icons / POIs:",Vi)}};return rn(),n.on("zoom",rn),n.on("zoomend",rn),n.loaded()&&n.isStyleLoaded()?on():(n.once("load",on),n.once("styledata",()=>{le&&on()})),()=>{if(le=!1,!!n)try{if(n.off("zoom",rn),n.off("zoomend",rn),!n.isStyleLoaded())return;n.getLayer(ke)&&n.removeLayer(ke),n.getSource(tt)&&n.removeSource(tt),n.hasImage(Rt)&&n.removeImage(Rt),n.hasImage(ut)&&n.removeImage(ut),n.hasImage(bt)&&n.removeImage(bt)}catch(Vi){console.warn("Cleanup warning:",Vi)}}},[ce,J,ue,me]),Me!==null?Ae.jsx("div",{style:{position:"absolute",top:"10px",right:"10px",backgroundColor:me?"rgba(139, 92, 246, 0.9)":"rgba(255, 255, 255, 0.9)",color:me?"white":"black",padding:"8px 12px",borderRadius:"4px",boxShadow:"0 2px 4px rgba(0,0,0,0.2)",fontFamily:"monospace",fontSize:"14px",fontWeight:"bold",zIndex:1e3,pointerEvents:"none"},children:me?"SELECT MODE":`Zoom: ${Me.toFixed(2)}`}):null}function cw(){return ew()}const LA=J1(()=>Promise.resolve().then(()=>BA),void 0);Ft.forwardRef(function(ue,me){return tw(ue,me,LA)});const w1=iw,T1=nw;var qy={exports:{}};var kA=qy.exports,S1;function OA(){return S1||(S1=1,(function(J,ue){(function(me,ce){J.exports=ce()})(kA,(function(){var me={},ce={};function Me(le,n,tt){if(ce[le]=tt,le==="index"){var ke="var sharedModule = {}; ("+ce.shared+")(sharedModule); ("+ce.worker+")(sharedModule);",Rt={};return ce.shared(Rt),ce.index(me,Rt),typeof window<"u"&&me.setWorkerUrl(window.URL.createObjectURL(new Blob([ke],{type:"text/javascript"}))),me}}Me("shared",["exports"],(function(le){function n(f,l,g,T){return new(g||(g=Promise))((function(z,O){function B(re){try{Z(T.next(re))}catch(de){O(de)}}function q(re){try{Z(T.throw(re))}catch(de){O(de)}}function Z(re){var de;re.done?z(re.value):(de=re.value,de instanceof g?de:new g((function(ye){ye(de)}))).then(B,q)}Z((T=T.apply(f,l||[])).next())}))}function tt(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}typeof SuppressedError=="function"&&SuppressedError;var ke=Rt;function Rt(f,l){this.x=f,this.y=l}Rt.prototype={clone:function(){return new Rt(this.x,this.y)},add:function(f){return this.clone()._add(f)},sub:function(f){return this.clone()._sub(f)},multByPoint:function(f){return this.clone()._multByPoint(f)},divByPoint:function(f){return this.clone()._divByPoint(f)},mult:function(f){return this.clone()._mult(f)},div:function(f){return this.clone()._div(f)},rotate:function(f){return this.clone()._rotate(f)},rotateAround:function(f,l){return this.clone()._rotateAround(f,l)},matMult:function(f){return this.clone()._matMult(f)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(f){return this.x===f.x&&this.y===f.y},dist:function(f){return Math.sqrt(this.distSqr(f))},distSqr:function(f){var l=f.x-this.x,g=f.y-this.y;return l*l+g*g},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(f){return Math.atan2(this.y-f.y,this.x-f.x)},angleWith:function(f){return this.angleWithSep(f.x,f.y)},angleWithSep:function(f,l){return Math.atan2(this.x*l-this.y*f,this.x*f+this.y*l)},_matMult:function(f){var l=f[2]*this.x+f[3]*this.y;return this.x=f[0]*this.x+f[1]*this.y,this.y=l,this},_add:function(f){return this.x+=f.x,this.y+=f.y,this},_sub:function(f){return this.x-=f.x,this.y-=f.y,this},_mult:function(f){return this.x*=f,this.y*=f,this},_div:function(f){return this.x/=f,this.y/=f,this},_multByPoint:function(f){return this.x*=f.x,this.y*=f.y,this},_divByPoint:function(f){return this.x/=f.x,this.y/=f.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var f=this.y;return this.y=this.x,this.x=-f,this},_rotate:function(f){var l=Math.cos(f),g=Math.sin(f),T=g*this.x+l*this.y;return this.x=l*this.x-g*this.y,this.y=T,this},_rotateAround:function(f,l){var g=Math.cos(f),T=Math.sin(f),z=l.y+T*(this.x-l.x)+g*(this.y-l.y);return this.x=l.x+g*(this.x-l.x)-T*(this.y-l.y),this.y=z,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Rt.convert=function(f){return f instanceof Rt?f:Array.isArray(f)?new Rt(f[0],f[1]):f};var ut=tt(ke),bt=rn;function rn(f,l,g,T){this.cx=3*f,this.bx=3*(g-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(T-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=l,this.p2x=g,this.p2y=T}rn.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,l){if(l===void 0&&(l=1e-6),f<0)return 0;if(f>1)return 1;for(var g=f,T=0;T<8;T++){var z=this.sampleCurveX(g)-f;if(Math.abs(z)<l)return g;var O=this.sampleCurveDerivativeX(g);if(Math.abs(O)<1e-6)break;g-=z/O}var B=0,q=1;for(g=f,T=0;T<20&&(z=this.sampleCurveX(g),!(Math.abs(z-f)<l));T++)f>z?B=g:q=g,g=.5*(q-B)+B;return g},solve:function(f,l){return this.sampleCurveY(this.solveCurveX(f,l))}};var on=tt(bt);let Vi,Wi;function Tn(){return Vi==null&&(Vi=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),Vi}function Ci(){if(Wi==null&&(Wi=!1,Tn())){const l=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(l){for(let T=0;T<25;T++){const z=4*T;l.fillStyle=`rgb(${z},${z+1},${z+2})`,l.fillRect(T%5,Math.floor(T/5),1,1)}const g=l.getImageData(0,0,5,5).data;for(let T=0;T<100;T++)if(T%4!=3&&g[T]!==T){Wi=!0;break}}}return Wi||!1}function Ji(f,l,g,T){const z=new on(f,l,g,T);return O=>z.solve(O)}const Vn=Ji(.25,.1,.25,1);function Oi(f,l,g){return Math.min(g,Math.max(l,f))}function Hn(f,l,g){const T=g-l,z=((f-l)%T+T)%T+l;return z===l?g:z}function qi(f,...l){for(const g of l)for(const T in g)f[T]=g[T];return f}let Ot=1;function Vt(f,l,g){const T={};for(const z in f)T[z]=l.call(this,f[z],z,f);return T}function Hi(f,l,g){const T={};for(const z in f)l.call(this,f[z],z,f)&&(T[z]=f[z]);return T}function dn(f){return Array.isArray(f)?f.map(dn):typeof f=="object"&&f?Vt(f,dn):f}const Ui={};function an(f){Ui[f]||(typeof console<"u"&&console.warn(f),Ui[f]=!0)}function Hr(f,l,g){return(g.y-f.y)*(l.x-f.x)>(l.y-f.y)*(g.x-f.x)}function Qr(f){return typeof WorkerGlobalScope<"u"&&f!==void 0&&f instanceof WorkerGlobalScope}let ui=null;function Si(f){return typeof ImageBitmap<"u"&&f instanceof ImageBitmap}const yn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Rn(f,l,g,T,z){return n(this,void 0,void 0,(function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const O=new VideoFrame(f,{timestamp:0});try{const B=O?.format;if(!B||!B.startsWith("BGR")&&!B.startsWith("RGB"))throw new Error(`Unrecognized format ${B}`);const q=B.startsWith("BGR"),Z=new Uint8ClampedArray(T*z*4);if(yield O.copyTo(Z,(function(re,de,ye,Ee,Le){const qe=4*Math.max(-de,0),Ke=(Math.max(0,ye)-ye)*Ee*4+qe,yt=4*Ee,Mt=Math.max(0,de),si=Math.max(0,ye);return{rect:{x:Mt,y:si,width:Math.min(re.width,de+Ee)-Mt,height:Math.min(re.height,ye+Le)-si},layout:[{offset:Ke,stride:yt}]}})(f,l,g,T,z)),q)for(let re=0;re<Z.length;re+=4){const de=Z[re];Z[re]=Z[re+2],Z[re+2]=de}return Z}finally{O.close()}}))}let wr,Tt;const jt="AbortError";function ai(){return new Error(jt)}const ln={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Jn(f){return ln.REGISTERED_PROTOCOLS[f.substring(0,f.indexOf("://"))]}const _r="global-dispatcher";class Mr extends Error{constructor(l,g,T,z){super(`AJAXError: ${g} (${l}): ${T}`),this.status=l,this.statusText=g,this.url=T,this.body=z}}const pr=()=>Qr(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Cn=function(f,l){if(/:\/\//.test(f.url)&&!/^https?:|^file:/.test(f.url)){const T=Jn(f.url);if(T)return T(f,l);if(Qr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,targetMapId:_r},l)}if(!(/^file:/.test(g=f.url)||/^file:/.test(pr())&&!/^\w+:/.test(g))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return(function(T,z){return n(this,void 0,void 0,(function*(){const O=new Request(T.url,{method:T.method||"GET",body:T.body,credentials:T.credentials,headers:T.headers,cache:T.cache,referrer:pr(),signal:z.signal});T.type!=="json"||O.headers.has("Accept")||O.headers.set("Accept","application/json");const B=yield fetch(O);if(!B.ok){const re=yield B.blob();throw new Mr(B.status,B.statusText,T.url,re)}let q;q=T.type==="arrayBuffer"||T.type==="image"?B.arrayBuffer():T.type==="json"?B.json():B.text();const Z=yield q;if(z.signal.aborted)throw ai();return{data:Z,cacheControl:B.headers.get("Cache-Control"),expires:B.headers.get("Expires")}}))})(f,l);if(Qr(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:f,mustQueue:!0,targetMapId:_r},l)}var g;return(function(T,z){return new Promise(((O,B)=>{var q;const Z=new XMLHttpRequest;Z.open(T.method||"GET",T.url,!0),T.type!=="arrayBuffer"&&T.type!=="image"||(Z.responseType="arraybuffer");for(const re in T.headers)Z.setRequestHeader(re,T.headers[re]);T.type==="json"&&(Z.responseType="text",!((q=T.headers)===null||q===void 0)&&q.Accept||Z.setRequestHeader("Accept","application/json")),Z.withCredentials=T.credentials==="include",Z.onerror=()=>{B(new Error(Z.statusText))},Z.onload=()=>{if(!z.signal.aborted)if((Z.status>=200&&Z.status<300||Z.status===0)&&Z.response!==null){let re=Z.response;if(T.type==="json")try{re=JSON.parse(Z.response)}catch(de){return void B(de)}O({data:re,cacheControl:Z.getResponseHeader("Cache-Control"),expires:Z.getResponseHeader("Expires")})}else{const re=new Blob([Z.response],{type:Z.getResponseHeader("Content-Type")});B(new Mr(Z.status,Z.statusText,T.url,re))}},z.signal.addEventListener("abort",(()=>{Z.abort(),B(ai())})),Z.send(T.body)}))})(f,l)};function Cr(f){if(!f||f.indexOf("://")<=0||f.indexOf("data:image/")===0||f.indexOf("blob:")===0)return!0;const l=new URL(f),g=window.location;return l.protocol===g.protocol&&l.host===g.host}function Ir(f,l,g){g[f]&&g[f].indexOf(l)!==-1||(g[f]=g[f]||[],g[f].push(l))}function Fa(f,l,g){if(g&&g[f]){const T=g[f].indexOf(l);T!==-1&&g[f].splice(T,1)}}class ra{constructor(l,g={}){qi(this,g),this.type=l}}class Aa extends ra{constructor(l,g={}){super("error",qi({error:l},g))}}class Da{on(l,g){return this._listeners=this._listeners||{},Ir(l,g,this._listeners),this}off(l,g){return Fa(l,g,this._listeners),Fa(l,g,this._oneTimeListeners),this}once(l,g){return g?(this._oneTimeListeners=this._oneTimeListeners||{},Ir(l,g,this._oneTimeListeners),this):new Promise((T=>this.once(l,T)))}fire(l,g){typeof l=="string"&&(l=new ra(l,g||{}));const T=l.type;if(this.listens(T)){l.target=this;const z=this._listeners&&this._listeners[T]?this._listeners[T].slice():[];for(const q of z)q.call(this,l);const O=this._oneTimeListeners&&this._oneTimeListeners[T]?this._oneTimeListeners[T].slice():[];for(const q of O)Fa(T,q,this._oneTimeListeners),q.call(this,l);const B=this._eventedParent;B&&(qi(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),B.fire(l))}else l instanceof Aa&&console.error(l.error);return this}listens(l){return this._listeners&&this._listeners[l]&&this._listeners[l].length>0||this._oneTimeListeners&&this._oneTimeListeners[l]&&this._oneTimeListeners[l].length>0||this._eventedParent&&this._eventedParent.listens(l)}setEventedParent(l,g){return this._eventedParent=l,this._eventedParentData=g,this}}var Yt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Ha=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function zr(f,l){const g={};for(const T in f)T!=="ref"&&(g[T]=f[T]);return Ha.forEach((T=>{T in l&&(g[T]=l[T])})),g}function Dr(f,l){if(Array.isArray(f)){if(!Array.isArray(l)||f.length!==l.length)return!1;for(let g=0;g<f.length;g++)if(!Dr(f[g],l[g]))return!1;return!0}if(typeof f=="object"&&f!==null&&l!==null){if(typeof l!="object"||Object.keys(f).length!==Object.keys(l).length)return!1;for(const g in f)if(!Dr(f[g],l[g]))return!1;return!0}return f===l}function ma(f,l){f.push(l)}function rl(f,l,g){ma(g,{command:"addSource",args:[f,l[f]]})}function ho(f,l,g){ma(l,{command:"removeSource",args:[f]}),g[f]=!0}function Vo(f,l,g,T){ho(f,g,T),rl(f,l,g)}function la(f,l,g){let T;for(T in f[g])if(Object.prototype.hasOwnProperty.call(f[g],T)&&T!=="data"&&!Dr(f[g][T],l[g][T]))return!1;for(T in l[g])if(Object.prototype.hasOwnProperty.call(l[g],T)&&T!=="data"&&!Dr(f[g][T],l[g][T]))return!1;return!0}function Vs(f,l,g,T,z,O){f=f||{},l=l||{};for(const B in f)Object.prototype.hasOwnProperty.call(f,B)&&(Dr(f[B],l[B])||g.push({command:O,args:[T,B,l[B],z]}));for(const B in l)Object.prototype.hasOwnProperty.call(l,B)&&!Object.prototype.hasOwnProperty.call(f,B)&&(Dr(f[B],l[B])||g.push({command:O,args:[T,B,l[B],z]}))}function qs(f){return f.id}function Us(f,l){return f[l.id]=l,f}class cn{constructor(l,g,T,z){this.message=(l?`${l}: `:"")+T,z&&(this.identifier=z),g!=null&&g.__line__&&(this.line=g.__line__)}}function Ws(f,...l){for(const g of l)for(const T in g)f[T]=g[T];return f}class To extends Error{constructor(l,g){super(g),this.message=g,this.key=l}}class Do{constructor(l,g=[]){this.parent=l,this.bindings={};for(const[T,z]of g)this.bindings[T]=z}concat(l){return new Do(this,l)}get(l){if(this.bindings[l])return this.bindings[l];if(this.parent)return this.parent.get(l);throw new Error(`${l} not found in scope.`)}has(l){return!!this.bindings[l]||!!this.parent&&this.parent.has(l)}}const So={kind:"null"},Sn={kind:"number"},tr={kind:"string"},ar={kind:"boolean"},Hs={kind:"color"},pl={kind:"object"},Xr={kind:"value"},ml={kind:"collator"},Uo={kind:"formatted"},lc={kind:"padding"},ul={kind:"resolvedImage"},dt={kind:"variableAnchorOffsetCollection"};function Ce(f,l){return{kind:"array",itemType:f,N:l}}function Re(f){if(f.kind==="array"){const l=Re(f.itemType);return typeof f.N=="number"?`array<${l}, ${f.N}>`:f.itemType.kind==="value"?"array":`array<${l}>`}return f.kind}const Qe=[So,Sn,tr,ar,Hs,Uo,pl,Ce(Xr),lc,ul,dt];function mt(f,l){if(l.kind==="error")return null;if(f.kind==="array"){if(l.kind==="array"&&(l.N===0&&l.itemType.kind==="value"||!mt(f.itemType,l.itemType))&&(typeof f.N!="number"||f.N===l.N))return null}else{if(f.kind===l.kind)return null;if(f.kind==="value"){for(const g of Qe)if(!mt(g,l))return null}}return`Expected ${Re(f)} but found ${Re(l)} instead.`}function Nt(f,l){return l.some((g=>g.kind===f.kind))}function je(f,l){return l.some((g=>g==="null"?f===null:g==="array"?Array.isArray(f):g==="object"?f&&!Array.isArray(f)&&typeof f=="object":g===typeof f))}function ei(f,l){return f.kind==="array"&&l.kind==="array"?f.itemType.kind===l.itemType.kind&&typeof f.N=="number":f.kind===l.kind}const Pt=.96422,Di=.82521,fi=4/29,hi=6/29,kn=3*hi*hi,hr=hi*hi*hi,Tr=Math.PI/180,lt=180/Math.PI;function te(f){return(f%=360)<0&&(f+=360),f}function pe([f,l,g,T]){let z,O;const B=et((.2225045*(f=ze(f))+.7168786*(l=ze(l))+.0606169*(g=ze(g)))/1);f===l&&l===g?z=O=B:(z=et((.4360747*f+.3850649*l+.1430804*g)/Pt),O=et((.0139322*f+.0971045*l+.7141733*g)/Di));const q=116*B-16;return[q<0?0:q,500*(z-B),200*(B-O),T]}function ze(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)}function et(f){return f>hr?Math.pow(f,1/3):f/kn+fi}function Xe([f,l,g,T]){let z=(f+16)/116,O=isNaN(l)?z:z+l/500,B=isNaN(g)?z:z-g/200;return z=1*wt(z),O=Pt*wt(O),B=Di*wt(B),[rt(3.1338561*O-1.6168667*z-.4906146*B),rt(-.9787684*O+1.9161415*z+.033454*B),rt(.0719453*O-.2289914*z+1.4052427*B),T]}function rt(f){return(f=f<=.00304?12.92*f:1.055*Math.pow(f,1/2.4)-.055)<0?0:f>1?1:f}function wt(f){return f>hi?f*f*f:kn*(f-fi)}function ot(f){return parseInt(f.padEnd(2,f),16)/255}function At(f,l){return ti(l?f/100:f,0,1)}function ti(f,l,g){return Math.min(Math.max(l,f),g)}function qt(f){return!f.some(Number.isNaN)}const Yi={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ki{constructor(l,g,T,z=1,O=!0){this.r=l,this.g=g,this.b=T,this.a=z,O||(this.r*=z,this.g*=z,this.b*=z,z||this.overwriteGetter("rgb",[l,g,T,z]))}static parse(l){if(l instanceof Ki)return l;if(typeof l!="string")return;const g=(function(T){if((T=T.toLowerCase().trim())==="transparent")return[0,0,0,0];const z=Yi[T];if(z){const[B,q,Z]=z;return[B/255,q/255,Z/255,1]}if(T.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(T)){const B=T.length<6?1:2;let q=1;return[ot(T.slice(q,q+=B)),ot(T.slice(q,q+=B)),ot(T.slice(q,q+=B)),ot(T.slice(q,q+B)||"ff")]}if(T.startsWith("rgb")){const B=T.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(B){const[q,Z,re,de,ye,Ee,Le,qe,Ke,yt,Mt,si]=B,Ut=[de||" ",Le||" ",yt].join("");if(Ut==="  "||Ut==="  /"||Ut===",,"||Ut===",,,"){const ii=[re,Ee,Ke].join(""),Pi=ii==="%%%"?100:ii===""?255:0;if(Pi){const gn=[ti(+Z/Pi,0,1),ti(+ye/Pi,0,1),ti(+qe/Pi,0,1),Mt?At(+Mt,si):1];if(qt(gn))return gn}}return}}const O=T.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(O){const[B,q,Z,re,de,ye,Ee,Le,qe]=O,Ke=[Z||" ",de||" ",Ee].join("");if(Ke==="  "||Ke==="  /"||Ke===",,"||Ke===",,,"){const yt=[+q,ti(+re,0,100),ti(+ye,0,100),Le?At(+Le,qe):1];if(qt(yt))return(function([Mt,si,Ut,ii]){function Pi(gn){const Wn=(gn+Mt/30)%12,Er=si*Math.min(Ut,1-Ut);return Ut-Er*Math.max(-1,Math.min(Wn-3,9-Wn,1))}return Mt=te(Mt),si/=100,Ut/=100,[Pi(0),Pi(8),Pi(4),ii]})(yt)}}})(l);return g?new Ki(...g,!1):void 0}get rgb(){const{r:l,g,b:T,a:z}=this,O=z||1/0;return this.overwriteGetter("rgb",[l/O,g/O,T/O,z])}get hcl(){return this.overwriteGetter("hcl",(function(l){const[g,T,z,O]=pe(l),B=Math.sqrt(T*T+z*z);return[Math.round(1e4*B)?te(Math.atan2(z,T)*lt):NaN,B,g,O]})(this.rgb))}get lab(){return this.overwriteGetter("lab",pe(this.rgb))}overwriteGetter(l,g){return Object.defineProperty(this,l,{value:g}),g}toString(){const[l,g,T,z]=this.rgb;return`rgba(${[l,g,T].map((O=>Math.round(255*O))).join(",")},${z})`}}Ki.black=new Ki(0,0,0,1),Ki.white=new Ki(1,1,1,1),Ki.transparent=new Ki(0,0,0,0),Ki.red=new Ki(1,0,0,1);class Bi{constructor(l,g,T){this.sensitivity=l?g?"variant":"case":g?"accent":"base",this.locale=T,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(l,g){return this.collator.compare(l,g)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dr{constructor(l,g,T,z,O){this.text=l,this.image=g,this.scale=T,this.fontStack=z,this.textColor=O}}class $n{constructor(l){this.sections=l}static fromString(l){return new $n([new dr(l,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((l=>l.text.length!==0||l.image&&l.image.name.length!==0))}static factory(l){return l instanceof $n?l:$n.fromString(l)}toString(){return this.sections.length===0?"":this.sections.map((l=>l.text)).join("")}}class Nn{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof Nn)return l;if(typeof l=="number")return new Nn([l,l,l,l]);if(Array.isArray(l)&&!(l.length<1||l.length>4)){for(const g of l)if(typeof g!="number")return;switch(l.length){case 1:l=[l[0],l[0],l[0],l[0]];break;case 2:l=[l[0],l[1],l[0],l[1]];break;case 3:l=[l[0],l[1],l[2],l[1]]}return new Nn(l)}}toString(){return JSON.stringify(this.values)}}const Ur=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class La{constructor(l){this.values=l.slice()}static parse(l){if(l instanceof La)return l;if(Array.isArray(l)&&!(l.length<1)&&l.length%2==0){for(let g=0;g<l.length;g+=2){const T=l[g],z=l[g+1];if(typeof T!="string"||!Ur.has(T)||!Array.isArray(z)||z.length!==2||typeof z[0]!="number"||typeof z[1]!="number")return}return new La(l)}}toString(){return JSON.stringify(this.values)}}class Ja{constructor(l){this.name=l.name,this.available=l.available}toString(){return this.name}static fromString(l){return l?new Ja({name:l,available:!1}):null}}function ss(f,l,g,T){return typeof f=="number"&&f>=0&&f<=255&&typeof l=="number"&&l>=0&&l<=255&&typeof g=="number"&&g>=0&&g<=255?T===void 0||typeof T=="number"&&T>=0&&T<=1?null:`Invalid rgba value [${[f,l,g,T].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof T=="number"?[f,l,g,T]:[f,l,g]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function js(f){if(f===null||typeof f=="string"||typeof f=="boolean"||typeof f=="number"||f instanceof Ki||f instanceof Bi||f instanceof $n||f instanceof Nn||f instanceof La||f instanceof Ja)return!0;if(Array.isArray(f)){for(const l of f)if(!js(l))return!1;return!0}if(typeof f=="object"){for(const l in f)if(!js(f[l]))return!1;return!0}return!1}function ea(f){if(f===null)return So;if(typeof f=="string")return tr;if(typeof f=="boolean")return ar;if(typeof f=="number")return Sn;if(f instanceof Ki)return Hs;if(f instanceof Bi)return ml;if(f instanceof $n)return Uo;if(f instanceof Nn)return lc;if(f instanceof La)return dt;if(f instanceof Ja)return ul;if(Array.isArray(f)){const l=f.length;let g;for(const T of f){const z=ea(T);if(g){if(g===z)continue;g=Xr;break}g=z}return Ce(g||Xr,l)}return pl}function jr(f){const l=typeof f;return f===null?"":l==="string"||l==="number"||l==="boolean"?String(f):f instanceof Ki||f instanceof $n||f instanceof Nn||f instanceof La||f instanceof Ja?f.toString():JSON.stringify(f)}class da{constructor(l,g){this.type=l,this.value=g}static parse(l,g){if(l.length!==2)return g.error(`'literal' expression requires exactly one argument, but found ${l.length-1} instead.`);if(!js(l[1]))return g.error("invalid value");const T=l[1];let z=ea(T);const O=g.expectedType;return z.kind!=="array"||z.N!==0||!O||O.kind!=="array"||typeof O.N=="number"&&O.N!==0||(z=O),new da(z,T)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class lr{constructor(l){this.name="ExpressionEvaluationError",this.message=l}toJSON(){return this.message}}const Rr={string:tr,number:Sn,boolean:ar,object:pl};class $a{constructor(l,g){this.type=l,this.args=g}static parse(l,g){if(l.length<2)return g.error("Expected at least one argument.");let T,z=1;const O=l[0];if(O==="array"){let q,Z;if(l.length>2){const re=l[1];if(typeof re!="string"||!(re in Rr)||re==="object")return g.error('The item type argument of "array" must be one of string, number, boolean',1);q=Rr[re],z++}else q=Xr;if(l.length>3){if(l[2]!==null&&(typeof l[2]!="number"||l[2]<0||l[2]!==Math.floor(l[2])))return g.error('The length argument to "array" must be a positive integer literal',2);Z=l[2],z++}T=Ce(q,Z)}else{if(!Rr[O])throw new Error(`Types doesn't contain name = ${O}`);T=Rr[O]}const B=[];for(;z<l.length;z++){const q=g.parse(l[z],z,Xr);if(!q)return null;B.push(q)}return new $a(T,B)}evaluate(l){for(let g=0;g<this.args.length;g++){const T=this.args[g].evaluate(l);if(!mt(this.type,ea(T)))return T;if(g===this.args.length-1)throw new lr(`Expected value to be of type ${Re(this.type)}, but found ${Re(ea(T))} instead.`)}throw new Error}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}const Ro={"to-boolean":ar,"to-color":Hs,"to-number":Sn,"to-string":tr};class Ys{constructor(l,g){this.type=l,this.args=g}static parse(l,g){if(l.length<2)return g.error("Expected at least one argument.");const T=l[0];if(!Ro[T])throw new Error(`Can't parse ${T} as it is not part of the known types`);if((T==="to-boolean"||T==="to-string")&&l.length!==2)return g.error("Expected one argument.");const z=Ro[T],O=[];for(let B=1;B<l.length;B++){const q=g.parse(l[B],B,Xr);if(!q)return null;O.push(q)}return new Ys(z,O)}evaluate(l){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(l);case"color":{let g,T;for(const z of this.args){if(g=z.evaluate(l),T=null,g instanceof Ki)return g;if(typeof g=="string"){const O=l.parseColor(g);if(O)return O}else if(Array.isArray(g)&&(T=g.length<3||g.length>4?`Invalid rbga value ${JSON.stringify(g)}: expected an array containing either three or four numeric values.`:ss(g[0],g[1],g[2],g[3]),!T))return new Ki(g[0]/255,g[1]/255,g[2]/255,g[3])}throw new lr(T||`Could not parse color from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"padding":{let g;for(const T of this.args){g=T.evaluate(l);const z=Nn.parse(g);if(z)return z}throw new lr(`Could not parse padding from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"variableAnchorOffsetCollection":{let g;for(const T of this.args){g=T.evaluate(l);const z=La.parse(g);if(z)return z}throw new lr(`Could not parse variableAnchorOffsetCollection from value '${typeof g=="string"?g:JSON.stringify(g)}'`)}case"number":{let g=null;for(const T of this.args){if(g=T.evaluate(l),g===null)return 0;const z=Number(g);if(!isNaN(z))return z}throw new lr(`Could not convert ${JSON.stringify(g)} to number.`)}case"formatted":return $n.fromString(jr(this.args[0].evaluate(l)));case"resolvedImage":return Ja.fromString(jr(this.args[0].evaluate(l)));default:return jr(this.args[0].evaluate(l))}}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}const _l=["Unknown","Point","LineString","Polygon"];class nh{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?_l[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(l){let g=this._parseColorCache[l];return g||(g=this._parseColorCache[l]=Ki.parse(l)),g}}class es{constructor(l,g,T=[],z,O=new Do,B=[]){this.registry=l,this.path=T,this.key=T.map((q=>`[${q}]`)).join(""),this.scope=O,this.errors=B,this.expectedType=z,this._isConstant=g}parse(l,g,T,z,O={}){return g?this.concat(g,T,z)._parse(l,O):this._parse(l,O)}_parse(l,g){function T(z,O,B){return B==="assert"?new $a(O,[z]):B==="coerce"?new Ys(O,[z]):z}if(l!==null&&typeof l!="string"&&typeof l!="boolean"&&typeof l!="number"||(l=["literal",l]),Array.isArray(l)){if(l.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const z=l[0];if(typeof z!="string")return this.error(`Expression name must be a string, but found ${typeof z} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const O=this.registry[z];if(O){let B=O.parse(l,this);if(!B)return null;if(this.expectedType){const q=this.expectedType,Z=B.type;if(q.kind!=="string"&&q.kind!=="number"&&q.kind!=="boolean"&&q.kind!=="object"&&q.kind!=="array"||Z.kind!=="value")if(q.kind!=="color"&&q.kind!=="formatted"&&q.kind!=="resolvedImage"||Z.kind!=="value"&&Z.kind!=="string")if(q.kind!=="padding"||Z.kind!=="value"&&Z.kind!=="number"&&Z.kind!=="array")if(q.kind!=="variableAnchorOffsetCollection"||Z.kind!=="value"&&Z.kind!=="array"){if(this.checkSubtype(q,Z))return null}else B=T(B,q,g.typeAnnotation||"coerce");else B=T(B,q,g.typeAnnotation||"coerce");else B=T(B,q,g.typeAnnotation||"coerce");else B=T(B,q,g.typeAnnotation||"assert")}if(!(B instanceof da)&&B.type.kind!=="resolvedImage"&&this._isConstant(B)){const q=new nh;try{B=new da(B.type,B.evaluate(q))}catch(Z){return this.error(Z.message),null}}return B}return this.error(`Unknown expression "${z}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(l===void 0?"'undefined' value invalid. Use null instead.":typeof l=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof l} instead.`)}concat(l,g,T){const z=typeof l=="number"?this.path.concat(l):this.path,O=T?this.scope.concat(T):this.scope;return new es(this.registry,this._isConstant,z,g||null,O,this.errors)}error(l,...g){const T=`${this.key}${g.map((z=>`[${z}]`)).join("")}`;this.errors.push(new To(T,l))}checkSubtype(l,g){const T=mt(l,g);return T&&this.error(T),T}}class jo{constructor(l,g){this.type=g.type,this.bindings=[].concat(l),this.result=g}evaluate(l){return this.result.evaluate(l)}eachChild(l){for(const g of this.bindings)l(g[1]);l(this.result)}static parse(l,g){if(l.length<4)return g.error(`Expected at least 3 arguments, but found ${l.length-1} instead.`);const T=[];for(let O=1;O<l.length-1;O+=2){const B=l[O];if(typeof B!="string")return g.error(`Expected string, but found ${typeof B} instead.`,O);if(/[^a-zA-Z0-9_]/.test(B))return g.error("Variable names must contain only alphanumeric characters or '_'.",O);const q=g.parse(l[O+1],O+1);if(!q)return null;T.push([B,q])}const z=g.parse(l[l.length-1],l.length-1,g.expectedType,T);return z?new jo(T,z):null}outputDefined(){return this.result.outputDefined()}}class _a{constructor(l,g){this.type=g.type,this.name=l,this.boundExpression=g}static parse(l,g){if(l.length!==2||typeof l[1]!="string")return g.error("'var' expression requires exactly one string literal argument.");const T=l[1];return g.scope.has(T)?new _a(T,g.scope.get(T)):g.error(`Unknown variable "${T}". Make sure "${T}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(l){return this.boundExpression.evaluate(l)}eachChild(){}outputDefined(){return!1}}class Mc{constructor(l,g,T){this.type=l,this.index=g,this.input=T}static parse(l,g){if(l.length!==3)return g.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const T=g.parse(l[1],1,Sn),z=g.parse(l[2],2,Ce(g.expectedType||Xr));return T&&z?new Mc(z.type.itemType,T,z):null}evaluate(l){const g=this.index.evaluate(l),T=this.input.evaluate(l);if(g<0)throw new lr(`Array index out of bounds: ${g} < 0.`);if(g>=T.length)throw new lr(`Array index out of bounds: ${g} > ${T.length-1}.`);if(g!==Math.floor(g))throw new lr(`Array index must be an integer, but found ${g} instead.`);return T[g]}eachChild(l){l(this.index),l(this.input)}outputDefined(){return!1}}class Ks{constructor(l,g){this.type=ar,this.needle=l,this.haystack=g}static parse(l,g){if(l.length!==3)return g.error(`Expected 2 arguments, but found ${l.length-1} instead.`);const T=g.parse(l[1],1,Xr),z=g.parse(l[2],2,Xr);return T&&z?Nt(T.type,[ar,tr,Sn,So,Xr])?new Ks(T,z):g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Re(T.type)} instead`):null}evaluate(l){const g=this.needle.evaluate(l),T=this.haystack.evaluate(l);if(!T)return!1;if(!je(g,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${Re(ea(g))} instead.`);if(!je(T,["string","array"]))throw new lr(`Expected second argument to be of type array or string, but found ${Re(ea(T))} instead.`);return T.indexOf(g)>=0}eachChild(l){l(this.needle),l(this.haystack)}outputDefined(){return!0}}class jc{constructor(l,g,T){this.type=Sn,this.needle=l,this.haystack=g,this.fromIndex=T}static parse(l,g){if(l.length<=2||l.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const T=g.parse(l[1],1,Xr),z=g.parse(l[2],2,Xr);if(!T||!z)return null;if(!Nt(T.type,[ar,tr,Sn,So,Xr]))return g.error(`Expected first argument to be of type boolean, string, number or null, but found ${Re(T.type)} instead`);if(l.length===4){const O=g.parse(l[3],3,Sn);return O?new jc(T,z,O):null}return new jc(T,z)}evaluate(l){const g=this.needle.evaluate(l),T=this.haystack.evaluate(l);if(!je(g,["boolean","string","number","null"]))throw new lr(`Expected first argument to be of type boolean, string, number or null, but found ${Re(ea(g))} instead.`);let z;if(this.fromIndex&&(z=this.fromIndex.evaluate(l)),je(T,["string"])){const O=T.indexOf(g,z);return O===-1?-1:[...T.slice(0,O)].length}if(je(T,["array"]))return T.indexOf(g,z);throw new lr(`Expected second argument to be of type array or string, but found ${Re(ea(T))} instead.`)}eachChild(l){l(this.needle),l(this.haystack),this.fromIndex&&l(this.fromIndex)}outputDefined(){return!1}}class Mh{constructor(l,g,T,z,O,B){this.inputType=l,this.type=g,this.input=T,this.cases=z,this.outputs=O,this.otherwise=B}static parse(l,g){if(l.length<5)return g.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if(l.length%2!=1)return g.error("Expected an even number of arguments.");let T,z;g.expectedType&&g.expectedType.kind!=="value"&&(z=g.expectedType);const O={},B=[];for(let re=2;re<l.length-1;re+=2){let de=l[re];const ye=l[re+1];Array.isArray(de)||(de=[de]);const Ee=g.concat(re);if(de.length===0)return Ee.error("Expected at least one branch label.");for(const qe of de){if(typeof qe!="number"&&typeof qe!="string")return Ee.error("Branch labels must be numbers or strings.");if(typeof qe=="number"&&Math.abs(qe)>Number.MAX_SAFE_INTEGER)return Ee.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof qe=="number"&&Math.floor(qe)!==qe)return Ee.error("Numeric branch labels must be integer values.");if(T){if(Ee.checkSubtype(T,ea(qe)))return null}else T=ea(qe);if(O[String(qe)]!==void 0)return Ee.error("Branch labels must be unique.");O[String(qe)]=B.length}const Le=g.parse(ye,re,z);if(!Le)return null;z=z||Le.type,B.push(Le)}const q=g.parse(l[1],1,Xr);if(!q)return null;const Z=g.parse(l[l.length-1],l.length-1,z);return Z?q.type.kind!=="value"&&g.concat(1).checkSubtype(T,q.type)?null:new Mh(T,z,q,O,B,Z):null}evaluate(l){const g=this.input.evaluate(l);return(ea(g)===this.inputType&&this.outputs[this.cases[g]]||this.otherwise).evaluate(l)}eachChild(l){l(this.input),this.outputs.forEach(l),l(this.otherwise)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))&&this.otherwise.outputDefined()}}class ou{constructor(l,g,T){this.type=l,this.branches=g,this.otherwise=T}static parse(l,g){if(l.length<4)return g.error(`Expected at least 3 arguments, but found only ${l.length-1}.`);if(l.length%2!=0)return g.error("Expected an odd number of arguments.");let T;g.expectedType&&g.expectedType.kind!=="value"&&(T=g.expectedType);const z=[];for(let B=1;B<l.length-1;B+=2){const q=g.parse(l[B],B,ar);if(!q)return null;const Z=g.parse(l[B+1],B+1,T);if(!Z)return null;z.push([q,Z]),T=T||Z.type}const O=g.parse(l[l.length-1],l.length-1,T);if(!O)return null;if(!T)throw new Error("Can't infer output type");return new ou(T,z,O)}evaluate(l){for(const[g,T]of this.branches)if(g.evaluate(l))return T.evaluate(l);return this.otherwise.evaluate(l)}eachChild(l){for(const[g,T]of this.branches)l(g),l(T);l(this.otherwise)}outputDefined(){return this.branches.every((([l,g])=>g.outputDefined()))&&this.otherwise.outputDefined()}}class Jh{constructor(l,g,T,z){this.type=l,this.input=g,this.beginIndex=T,this.endIndex=z}static parse(l,g){if(l.length<=2||l.length>=5)return g.error(`Expected 3 or 4 arguments, but found ${l.length-1} instead.`);const T=g.parse(l[1],1,Xr),z=g.parse(l[2],2,Sn);if(!T||!z)return null;if(!Nt(T.type,[Ce(Xr),tr,Xr]))return g.error(`Expected first argument to be of type array or string, but found ${Re(T.type)} instead`);if(l.length===4){const O=g.parse(l[3],3,Sn);return O?new Jh(T.type,T,z,O):null}return new Jh(T.type,T,z)}evaluate(l){const g=this.input.evaluate(l),T=this.beginIndex.evaluate(l);let z;if(this.endIndex&&(z=this.endIndex.evaluate(l)),je(g,["string"]))return[...g].slice(T,z).join("");if(je(g,["array"]))return g.slice(T,z);throw new lr(`Expected first argument to be of type array or string, but found ${Re(ea(g))} instead.`)}eachChild(l){l(this.input),l(this.beginIndex),this.endIndex&&l(this.endIndex)}outputDefined(){return!1}}function Qh(f,l){const g=f.length-1;let T,z,O=0,B=g,q=0;for(;O<=B;)if(q=Math.floor((O+B)/2),T=f[q],z=f[q+1],T<=l){if(q===g||l<z)return q;O=q+1}else{if(!(T>l))throw new lr("Input is not a number.");B=q-1}return 0}class Mu{constructor(l,g,T){this.type=l,this.input=g,this.labels=[],this.outputs=[];for(const[z,O]of T)this.labels.push(z),this.outputs.push(O)}static parse(l,g){if(l.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return g.error("Expected an even number of arguments.");const T=g.parse(l[1],1,Sn);if(!T)return null;const z=[];let O=null;g.expectedType&&g.expectedType.kind!=="value"&&(O=g.expectedType);for(let B=1;B<l.length;B+=2){const q=B===1?-1/0:l[B],Z=l[B+1],re=B,de=B+1;if(typeof q!="number")return g.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',re);if(z.length&&z[z.length-1][0]>=q)return g.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',re);const ye=g.parse(Z,de,O);if(!ye)return null;O=O||ye.type,z.push([q,ye])}return new Mu(O,T,z)}evaluate(l){const g=this.labels,T=this.outputs;if(g.length===1)return T[0].evaluate(l);const z=this.input.evaluate(l);if(z<=g[0])return T[0].evaluate(l);const O=g.length;return z>=g[O-1]?T[O-1].evaluate(l):T[Qh(g,z)].evaluate(l)}eachChild(l){l(this.input);for(const g of this.outputs)l(g)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))}}function Gc(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var cc=lu;function lu(f,l,g,T){this.cx=3*f,this.bx=3*(g-f)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*l,this.by=3*(T-l)-this.cy,this.ay=1-this.cy-this.by,this.p1x=f,this.p1y=l,this.p2x=g,this.p2y=T}lu.prototype={sampleCurveX:function(f){return((this.ax*f+this.bx)*f+this.cx)*f},sampleCurveY:function(f){return((this.ay*f+this.by)*f+this.cy)*f},sampleCurveDerivativeX:function(f){return(3*this.ax*f+2*this.bx)*f+this.cx},solveCurveX:function(f,l){if(l===void 0&&(l=1e-6),f<0)return 0;if(f>1)return 1;for(var g=f,T=0;T<8;T++){var z=this.sampleCurveX(g)-f;if(Math.abs(z)<l)return g;var O=this.sampleCurveDerivativeX(g);if(Math.abs(O)<1e-6)break;g-=z/O}var B=0,q=1;for(g=f,T=0;T<20&&(z=this.sampleCurveX(g),!(Math.abs(z-f)<l));T++)f>z?B=g:q=g,g=.5*(q-B)+B;return g},solve:function(f,l){return this.sampleCurveY(this.solveCurveX(f,l))}};var Cc=Gc(cc);function fo(f,l,g){return f+g*(l-f)}function Xl(f,l,g){return f.map(((T,z)=>fo(T,l[z],g)))}const Po={number:fo,color:function(f,l,g,T="rgb"){switch(T){case"rgb":{const[z,O,B,q]=Xl(f.rgb,l.rgb,g);return new Ki(z,O,B,q,!1)}case"hcl":{const[z,O,B,q]=f.hcl,[Z,re,de,ye]=l.hcl;let Ee,Le;if(isNaN(z)||isNaN(Z))isNaN(z)?isNaN(Z)?Ee=NaN:(Ee=Z,B!==1&&B!==0||(Le=re)):(Ee=z,de!==1&&de!==0||(Le=O));else{let si=Z-z;Z>z&&si>180?si-=360:Z<z&&z-Z>180&&(si+=360),Ee=z+g*si}const[qe,Ke,yt,Mt]=(function([si,Ut,ii,Pi]){return si=isNaN(si)?0:si*Tr,Xe([ii,Math.cos(si)*Ut,Math.sin(si)*Ut,Pi])})([Ee,Le??fo(O,re,g),fo(B,de,g),fo(q,ye,g)]);return new Ki(qe,Ke,yt,Mt,!1)}case"lab":{const[z,O,B,q]=Xe(Xl(f.lab,l.lab,g));return new Ki(z,O,B,q,!1)}}},array:Xl,padding:function(f,l,g){return new Nn(Xl(f.values,l.values,g))},variableAnchorOffsetCollection:function(f,l,g){const T=f.values,z=l.values;if(T.length!==z.length)throw new lr(`Cannot interpolate values of different length. from: ${f.toString()}, to: ${l.toString()}`);const O=[];for(let B=0;B<T.length;B+=2){if(T[B]!==z[B])throw new lr(`Cannot interpolate values containing mismatched anchors. from[${B}]: ${T[B]}, to[${B}]: ${z[B]}`);O.push(T[B]);const[q,Z]=T[B+1],[re,de]=z[B+1];O.push([fo(q,re,g),fo(Z,de,g)])}return new La(O)}};class Eo{constructor(l,g,T,z,O){this.type=l,this.operator=g,this.interpolation=T,this.input=z,this.labels=[],this.outputs=[];for(const[B,q]of O)this.labels.push(B),this.outputs.push(q)}static interpolationFactor(l,g,T,z){let O=0;if(l.name==="exponential")O=cu(g,l.base,T,z);else if(l.name==="linear")O=cu(g,1,T,z);else if(l.name==="cubic-bezier"){const B=l.controlPoints;O=new Cc(B[0],B[1],B[2],B[3]).solve(cu(g,1,T,z))}return O}static parse(l,g){let[T,z,O,...B]=l;if(!Array.isArray(z)||z.length===0)return g.error("Expected an interpolation type expression.",1);if(z[0]==="linear")z={name:"linear"};else if(z[0]==="exponential"){const re=z[1];if(typeof re!="number")return g.error("Exponential interpolation requires a numeric base.",1,1);z={name:"exponential",base:re}}else{if(z[0]!=="cubic-bezier")return g.error(`Unknown interpolation type ${String(z[0])}`,1,0);{const re=z.slice(1);if(re.length!==4||re.some((de=>typeof de!="number"||de<0||de>1)))return g.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);z={name:"cubic-bezier",controlPoints:re}}}if(l.length-1<4)return g.error(`Expected at least 4 arguments, but found only ${l.length-1}.`);if((l.length-1)%2!=0)return g.error("Expected an even number of arguments.");if(O=g.parse(O,2,Sn),!O)return null;const q=[];let Z=null;T==="interpolate-hcl"||T==="interpolate-lab"?Z=Hs:g.expectedType&&g.expectedType.kind!=="value"&&(Z=g.expectedType);for(let re=0;re<B.length;re+=2){const de=B[re],ye=B[re+1],Ee=re+3,Le=re+4;if(typeof de!="number")return g.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Ee);if(q.length&&q[q.length-1][0]>=de)return g.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Ee);const qe=g.parse(ye,Le,Z);if(!qe)return null;Z=Z||qe.type,q.push([de,qe])}return ei(Z,Sn)||ei(Z,Hs)||ei(Z,lc)||ei(Z,dt)||ei(Z,Ce(Sn))?new Eo(Z,T,z,O,q):g.error(`Type ${Re(Z)} is not interpolatable.`)}evaluate(l){const g=this.labels,T=this.outputs;if(g.length===1)return T[0].evaluate(l);const z=this.input.evaluate(l);if(z<=g[0])return T[0].evaluate(l);const O=g.length;if(z>=g[O-1])return T[O-1].evaluate(l);const B=Qh(g,z),q=Eo.interpolationFactor(this.interpolation,z,g[B],g[B+1]),Z=T[B].evaluate(l),re=T[B+1].evaluate(l);switch(this.operator){case"interpolate":return Po[this.type.kind](Z,re,q);case"interpolate-hcl":return Po.color(Z,re,q,"hcl");case"interpolate-lab":return Po.color(Z,re,q,"lab")}}eachChild(l){l(this.input);for(const g of this.outputs)l(g)}outputDefined(){return this.outputs.every((l=>l.outputDefined()))}}function cu(f,l,g,T){const z=T-g,O=f-g;return z===0?0:l===1?O/z:(Math.pow(l,O)-1)/(Math.pow(l,z)-1)}class Cu{constructor(l,g){this.type=l,this.args=g}static parse(l,g){if(l.length<2)return g.error("Expectected at least one argument.");let T=null;const z=g.expectedType;z&&z.kind!=="value"&&(T=z);const O=[];for(const q of l.slice(1)){const Z=g.parse(q,1+O.length,T,void 0,{typeAnnotation:"omit"});if(!Z)return null;T=T||Z.type,O.push(Z)}if(!T)throw new Error("No output type");const B=z&&O.some((q=>mt(z,q.type)));return new Cu(B?Xr:T,O)}evaluate(l){let g,T=null,z=0;for(const O of this.args)if(z++,T=O.evaluate(l),T&&T instanceof Ja&&!T.available&&(g||(g=T.name),T=null,z===this.args.length&&(T=g)),T!==null)break;return T}eachChild(l){this.args.forEach(l)}outputDefined(){return this.args.every((l=>l.outputDefined()))}}function Ch(f,l){return f==="=="||f==="!="?l.kind==="boolean"||l.kind==="string"||l.kind==="number"||l.kind==="null"||l.kind==="value":l.kind==="string"||l.kind==="number"||l.kind==="value"}function Kf(f,l,g,T){return T.compare(l,g)===0}function zc(f,l,g){const T=f!=="=="&&f!=="!=";return class uw{constructor(O,B,q){this.type=ar,this.lhs=O,this.rhs=B,this.collator=q,this.hasUntypedArgument=O.type.kind==="value"||B.type.kind==="value"}static parse(O,B){if(O.length!==3&&O.length!==4)return B.error("Expected two or three arguments.");const q=O[0];let Z=B.parse(O[1],1,Xr);if(!Z)return null;if(!Ch(q,Z.type))return B.concat(1).error(`"${q}" comparisons are not supported for type '${Re(Z.type)}'.`);let re=B.parse(O[2],2,Xr);if(!re)return null;if(!Ch(q,re.type))return B.concat(2).error(`"${q}" comparisons are not supported for type '${Re(re.type)}'.`);if(Z.type.kind!==re.type.kind&&Z.type.kind!=="value"&&re.type.kind!=="value")return B.error(`Cannot compare types '${Re(Z.type)}' and '${Re(re.type)}'.`);T&&(Z.type.kind==="value"&&re.type.kind!=="value"?Z=new $a(re.type,[Z]):Z.type.kind!=="value"&&re.type.kind==="value"&&(re=new $a(Z.type,[re])));let de=null;if(O.length===4){if(Z.type.kind!=="string"&&re.type.kind!=="string"&&Z.type.kind!=="value"&&re.type.kind!=="value")return B.error("Cannot use collator to compare non-string types.");if(de=B.parse(O[3],3,ml),!de)return null}return new uw(Z,re,de)}evaluate(O){const B=this.lhs.evaluate(O),q=this.rhs.evaluate(O);if(T&&this.hasUntypedArgument){const Z=ea(B),re=ea(q);if(Z.kind!==re.kind||Z.kind!=="string"&&Z.kind!=="number")throw new lr(`Expected arguments for "${f}" to be (string, string) or (number, number), but found (${Z.kind}, ${re.kind}) instead.`)}if(this.collator&&!T&&this.hasUntypedArgument){const Z=ea(B),re=ea(q);if(Z.kind!=="string"||re.kind!=="string")return l(O,B,q)}return this.collator?g(O,B,q,this.collator.evaluate(O)):l(O,B,q)}eachChild(O){O(this.lhs),O(this.rhs),this.collator&&O(this.collator)}outputDefined(){return!0}}}const Go=zc("==",(function(f,l,g){return l===g}),Kf),Ed=zc("!=",(function(f,l,g){return l!==g}),(function(f,l,g,T){return!Kf(0,l,g,T)})),uu=zc("<",(function(f,l,g){return l<g}),(function(f,l,g,T){return T.compare(l,g)<0})),Wl=zc(">",(function(f,l,g){return l>g}),(function(f,l,g,T){return T.compare(l,g)>0})),Ep=zc("<=",(function(f,l,g){return l<=g}),(function(f,l,g,T){return T.compare(l,g)<=0})),Hd=zc(">=",(function(f,l,g){return l>=g}),(function(f,l,g,T){return T.compare(l,g)>=0}));class rh{constructor(l,g,T){this.type=ml,this.locale=T,this.caseSensitive=l,this.diacriticSensitive=g}static parse(l,g){if(l.length!==2)return g.error("Expected one argument.");const T=l[1];if(typeof T!="object"||Array.isArray(T))return g.error("Collator options argument must be an object.");const z=g.parse(T["case-sensitive"]!==void 0&&T["case-sensitive"],1,ar);if(!z)return null;const O=g.parse(T["diacritic-sensitive"]!==void 0&&T["diacritic-sensitive"],1,ar);if(!O)return null;let B=null;return T.locale&&(B=g.parse(T.locale,1,tr),!B)?null:new rh(z,O,B)}evaluate(l){return new Bi(this.caseSensitive.evaluate(l),this.diacriticSensitive.evaluate(l),this.locale?this.locale.evaluate(l):null)}eachChild(l){l(this.caseSensitive),l(this.diacriticSensitive),this.locale&&l(this.locale)}outputDefined(){return!1}}class Wr{constructor(l,g,T,z,O){this.type=tr,this.number=l,this.locale=g,this.currency=T,this.minFractionDigits=z,this.maxFractionDigits=O}static parse(l,g){if(l.length!==3)return g.error("Expected two arguments.");const T=g.parse(l[1],1,Sn);if(!T)return null;const z=l[2];if(typeof z!="object"||Array.isArray(z))return g.error("NumberFormat options argument must be an object.");let O=null;if(z.locale&&(O=g.parse(z.locale,1,tr),!O))return null;let B=null;if(z.currency&&(B=g.parse(z.currency,1,tr),!B))return null;let q=null;if(z["min-fraction-digits"]&&(q=g.parse(z["min-fraction-digits"],1,Sn),!q))return null;let Z=null;return z["max-fraction-digits"]&&(Z=g.parse(z["max-fraction-digits"],1,Sn),!Z)?null:new Wr(T,O,B,q,Z)}evaluate(l){return new Intl.NumberFormat(this.locale?this.locale.evaluate(l):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(l):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(l):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(l):void 0}).format(this.number.evaluate(l))}eachChild(l){l(this.number),this.locale&&l(this.locale),this.currency&&l(this.currency),this.minFractionDigits&&l(this.minFractionDigits),this.maxFractionDigits&&l(this.maxFractionDigits)}outputDefined(){return!1}}class ah{constructor(l){this.type=Uo,this.sections=l}static parse(l,g){if(l.length<2)return g.error("Expected at least one argument.");const T=l[1];if(!Array.isArray(T)&&typeof T=="object")return g.error("First argument must be an image or text section.");const z=[];let O=!1;for(let B=1;B<=l.length-1;++B){const q=l[B];if(O&&typeof q=="object"&&!Array.isArray(q)){O=!1;let Z=null;if(q["font-scale"]&&(Z=g.parse(q["font-scale"],1,Sn),!Z))return null;let re=null;if(q["text-font"]&&(re=g.parse(q["text-font"],1,Ce(tr)),!re))return null;let de=null;if(q["text-color"]&&(de=g.parse(q["text-color"],1,Hs),!de))return null;const ye=z[z.length-1];ye.scale=Z,ye.font=re,ye.textColor=de}else{const Z=g.parse(l[B],1,Xr);if(!Z)return null;const re=Z.type.kind;if(re!=="string"&&re!=="value"&&re!=="null"&&re!=="resolvedImage")return g.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");O=!0,z.push({content:Z,scale:null,font:null,textColor:null})}}return new ah(z)}evaluate(l){return new $n(this.sections.map((g=>{const T=g.content.evaluate(l);return ea(T)===ul?new dr("",T,null,null,null):new dr(jr(T),null,g.scale?g.scale.evaluate(l):null,g.font?g.font.evaluate(l).join(","):null,g.textColor?g.textColor.evaluate(l):null)})))}eachChild(l){for(const g of this.sections)l(g.content),g.scale&&l(g.scale),g.font&&l(g.font),g.textColor&&l(g.textColor)}outputDefined(){return!1}}class $d{constructor(l){this.type=ul,this.input=l}static parse(l,g){if(l.length!==2)return g.error("Expected two arguments.");const T=g.parse(l[1],1,tr);return T?new $d(T):g.error("No image name provided.")}evaluate(l){const g=this.input.evaluate(l),T=Ja.fromString(g);return T&&l.availableImages&&(T.available=l.availableImages.indexOf(g)>-1),T}eachChild(l){l(this.input)}outputDefined(){return!1}}class Cl{constructor(l){this.type=Sn,this.input=l}static parse(l,g){if(l.length!==2)return g.error(`Expected 1 argument, but found ${l.length-1} instead.`);const T=g.parse(l[1],1);return T?T.type.kind!=="array"&&T.type.kind!=="string"&&T.type.kind!=="value"?g.error(`Expected argument of type string or array, but found ${Re(T.type)} instead.`):new Cl(T):null}evaluate(l){const g=this.input.evaluate(l);if(typeof g=="string")return[...g].length;if(Array.isArray(g))return g.length;throw new lr(`Expected value to be of type string or array, but found ${Re(ea(g))} instead.`)}eachChild(l){l(this.input)}outputDefined(){return!1}}const zl=8192;function zu(f,l){const g=(180+f[0])/360,T=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f[1]*Math.PI/360)))/360,z=Math.pow(2,l.z);return[Math.round(g*z*zl),Math.round(T*z*zl)]}function Du(f,l){const g=Math.pow(2,l.z);return[(z=(f[0]/zl+l.x)/g,360*z-180),(T=(f[1]/zl+l.y)/g,360/Math.PI*Math.atan(Math.exp((180-360*T)*Math.PI/180))-90)];var T,z}function Ru(f,l){f[0]=Math.min(f[0],l[0]),f[1]=Math.min(f[1],l[1]),f[2]=Math.max(f[2],l[0]),f[3]=Math.max(f[3],l[1])}function hu(f,l){return!(f[0]<=l[0]||f[2]>=l[2]||f[1]<=l[1]||f[3]>=l[3])}function ns(f,l,g){const T=f[0]-l[0],z=f[1]-l[1],O=f[0]-g[0],B=f[1]-g[1];return T*B-O*z==0&&T*O<=0&&z*B<=0}function Dl(f,l,g,T){return(z=[T[0]-g[0],T[1]-g[1]])[0]*(O=[l[0]-f[0],l[1]-f[1]])[1]-z[1]*O[0]!=0&&!(!Ad(f,l,g,T)||!Ad(g,T,f,l));var z,O}function ed(f,l,g){for(const T of g)for(let z=0;z<T.length-1;++z)if(Dl(f,l,T[z],T[z+1]))return!0;return!1}function zh(f,l,g=!1){let T=!1;for(const q of l)for(let Z=0;Z<q.length-1;Z++){if(ns(f,q[Z],q[Z+1]))return g;(O=q[Z])[1]>(z=f)[1]!=(B=q[Z+1])[1]>z[1]&&z[0]<(B[0]-O[0])*(z[1]-O[1])/(B[1]-O[1])+O[0]&&(T=!T)}var z,O,B;return T}function td(f,l){for(const g of l)if(zh(f,g))return!0;return!1}function id(f,l){for(const g of f)if(!zh(g,l))return!1;for(let g=0;g<f.length-1;++g)if(ed(f[g],f[g+1],l))return!1;return!0}function Rl(f,l){for(const g of l)if(id(f,g))return!0;return!1}function Ad(f,l,g,T){const z=T[0]-g[0],O=T[1]-g[1],B=(f[0]-g[0])*O-z*(f[1]-g[1]),q=(l[0]-g[0])*O-z*(l[1]-g[1]);return B>0&&q<0||B<0&&q>0}function Id(f,l,g){const T=[];for(let z=0;z<f.length;z++){const O=[];for(let B=0;B<f[z].length;B++){const q=zu(f[z][B],g);Ru(l,q),O.push(q)}T.push(O)}return T}function qc(f,l,g){const T=[];for(let z=0;z<f.length;z++){const O=Id(f[z],l,g);T.push(O)}return T}function Ta(f,l,g,T){if(f[0]<g[0]||f[0]>g[2]){const z=.5*T;let O=f[0]-g[0]>z?-T:g[0]-f[0]>z?T:0;O===0&&(O=f[0]-g[2]>z?-T:g[2]-f[0]>z?T:0),f[0]+=O}Ru(l,f)}function Ap(f,l,g,T){const z=Math.pow(2,T.z)*zl,O=[T.x*zl,T.y*zl],B=[];for(const q of f)for(const Z of q){const re=[Z.x+O[0],Z.y+O[1]];Ta(re,l,g,z),B.push(re)}return B}function Ip(f,l,g,T){const z=Math.pow(2,T.z)*zl,O=[T.x*zl,T.y*zl],B=[];for(const Z of f){const re=[];for(const de of Z){const ye=[de.x+O[0],de.y+O[1]];Ru(l,ye),re.push(ye)}B.push(re)}if(l[2]-l[0]<=z/2){(q=l)[0]=q[1]=1/0,q[2]=q[3]=-1/0;for(const Z of B)for(const re of Z)Ta(re,l,g,z)}var q;return B}class Dh{constructor(l,g){this.type=ar,this.geojson=l,this.geometries=g}static parse(l,g){if(l.length!==2)return g.error(`'within' expression requires exactly one argument, but found ${l.length-1} instead.`);if(js(l[1])){const T=l[1];if(T.type==="FeatureCollection"){const z=[];for(const O of T.features){const{type:B,coordinates:q}=O.geometry;B==="Polygon"&&z.push(q),B==="MultiPolygon"&&z.push(...q)}if(z.length)return new Dh(T,{type:"MultiPolygon",coordinates:z})}else if(T.type==="Feature"){const z=T.geometry.type;if(z==="Polygon"||z==="MultiPolygon")return new Dh(T,T.geometry)}else if(T.type==="Polygon"||T.type==="MultiPolygon")return new Dh(T,T)}return g.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return(function(g,T){const z=[1/0,1/0,-1/0,-1/0],O=[1/0,1/0,-1/0,-1/0],B=g.canonicalID();if(T.type==="Polygon"){const q=Id(T.coordinates,O,B),Z=Ap(g.geometry(),z,O,B);if(!hu(z,O))return!1;for(const re of Z)if(!zh(re,q))return!1}if(T.type==="MultiPolygon"){const q=qc(T.coordinates,O,B),Z=Ap(g.geometry(),z,O,B);if(!hu(z,O))return!1;for(const re of Z)if(!td(re,q))return!1}return!0})(l,this.geometries);if(l.geometryType()==="LineString")return(function(g,T){const z=[1/0,1/0,-1/0,-1/0],O=[1/0,1/0,-1/0,-1/0],B=g.canonicalID();if(T.type==="Polygon"){const q=Id(T.coordinates,O,B),Z=Ip(g.geometry(),z,O,B);if(!hu(z,O))return!1;for(const re of Z)if(!id(re,q))return!1}if(T.type==="MultiPolygon"){const q=qc(T.coordinates,O,B),Z=Ip(g.geometry(),z,O,B);if(!hu(z,O))return!1;for(const re of Z)if(!Rl(re,q))return!1}return!0})(l,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Gn=class{constructor(f=[],l=((g,T)=>g<T?-1:g>T?1:0)){if(this.data=f,this.length=this.data.length,this.compare=l,this.length>0)for(let g=(this.length>>1)-1;g>=0;g--)this._down(g)}push(f){this.data.push(f),this._up(this.length++)}pop(){if(this.length===0)return;const f=this.data[0],l=this.data.pop();return--this.length>0&&(this.data[0]=l,this._down(0)),f}peek(){return this.data[0]}_up(f){const{data:l,compare:g}=this,T=l[f];for(;f>0;){const z=f-1>>1,O=l[z];if(g(T,O)>=0)break;l[f]=O,f=z}l[f]=T}_down(f){const{data:l,compare:g}=this,T=this.length>>1,z=l[f];for(;f<T;){let O=1+(f<<1);const B=O+1;if(B<this.length&&g(l[B],l[O])<0&&(O=B),g(l[O],z)>=0)break;l[f]=l[O],f=O}l[f]=z}};function Mp(f,l,g,T,z){Zd(f,l,g,T||f.length-1,z||nd)}function Zd(f,l,g,T,z){for(;T>g;){if(T-g>600){var O=T-g+1,B=l-g+1,q=Math.log(O),Z=.5*Math.exp(2*q/3),re=.5*Math.sqrt(q*Z*(O-Z)/O)*(B-O/2<0?-1:1);Zd(f,l,Math.max(g,Math.floor(l-B*Z/O+re)),Math.min(T,Math.floor(l+(O-B)*Z/O+re)),z)}var de=f[l],ye=g,Ee=T;for(Yl(f,g,l),z(f[T],de)>0&&Yl(f,g,T);ye<Ee;){for(Yl(f,ye,Ee),ye++,Ee--;z(f[ye],de)<0;)ye++;for(;z(f[Ee],de)>0;)Ee--}z(f[g],de)===0?Yl(f,g,Ee):Yl(f,++Ee,T),Ee<=l&&(g=Ee+1),l<=Ee&&(T=Ee-1)}}function Yl(f,l,g){var T=f[l];f[l]=f[g],f[g]=T}function nd(f,l){return f<l?-1:f>l?1:0}function Dc(f,l){if(f.length<=1)return[f];const g=[];let T,z;for(const O of f){const B=ta(O);B!==0&&(O.area=Math.abs(B),z===void 0&&(z=B<0),z===B<0?(T&&g.push(T),T=[O]):T.push(O))}if(T&&g.push(T),l>1)for(let O=0;O<g.length;O++)g[O].length<=l||(Mp(g[O],l,1,g[O].length-1,En),g[O]=g[O].slice(0,l));return g}function En(f,l){return l.area-f.area}function ta(f){let l=0;for(let g,T,z=0,O=f.length,B=O-1;z<O;B=z++)g=f[z],T=f[B],l+=(T.x-g.x)*(g.y+T.y);return l}const Sa=1/298.257223563,Kl=Sa*(2-Sa),Pu=Math.PI/180;class va{constructor(l){const g=6378.137*Pu*1e3,T=Math.cos(l*Pu),z=1/(1-Kl*(1-T*T)),O=Math.sqrt(z);this.kx=g*O*T,this.ky=g*O*z*(1-Kl)}distance(l,g){const T=this.wrap(l[0]-g[0])*this.kx,z=(l[1]-g[1])*this.ky;return Math.sqrt(T*T+z*z)}pointOnLine(l,g){let T,z,O,B,q=1/0;for(let Z=0;Z<l.length-1;Z++){let re=l[Z][0],de=l[Z][1],ye=this.wrap(l[Z+1][0]-re)*this.kx,Ee=(l[Z+1][1]-de)*this.ky,Le=0;ye===0&&Ee===0||(Le=(this.wrap(g[0]-re)*this.kx*ye+(g[1]-de)*this.ky*Ee)/(ye*ye+Ee*Ee),Le>1?(re=l[Z+1][0],de=l[Z+1][1]):Le>0&&(re+=ye/this.kx*Le,de+=Ee/this.ky*Le)),ye=this.wrap(g[0]-re)*this.kx,Ee=(g[1]-de)*this.ky;const qe=ye*ye+Ee*Ee;qe<q&&(q=qe,T=re,z=de,O=Z,B=Le)}return{point:[T,z],index:O,t:Math.max(0,Math.min(1,B))}}wrap(l){for(;l<-180;)l+=360;for(;l>180;)l-=360;return l}}function If(f,l){return l[0]-f[0]}function rd(f){return f[1]-f[0]+1}function Hc(f,l){return f[1]>=f[0]&&f[1]<l}function al(f,l){if(f[0]>f[1])return[null,null];const g=rd(f);if(l){if(g===2)return[f,null];const z=Math.floor(g/2);return[[f[0],f[0]+z],[f[0]+z,f[1]]]}if(g===1)return[f,null];const T=Math.floor(g/2)-1;return[[f[0],f[0]+T],[f[0]+T+1,f[1]]]}function io(f,l){if(!Hc(l,f.length))return[1/0,1/0,-1/0,-1/0];const g=[1/0,1/0,-1/0,-1/0];for(let T=l[0];T<=l[1];++T)Ru(g,f[T]);return g}function Cp(f){const l=[1/0,1/0,-1/0,-1/0];for(const g of f)for(const T of g)Ru(l,T);return l}function $c(f){return f[0]!==-1/0&&f[1]!==-1/0&&f[2]!==1/0&&f[3]!==1/0}function Rh(f,l,g){if(!$c(f)||!$c(l))return NaN;let T=0,z=0;return f[2]<l[0]&&(T=l[0]-f[2]),f[0]>l[2]&&(T=f[0]-l[2]),f[1]>l[3]&&(z=f[1]-l[3]),f[3]<l[1]&&(z=l[1]-f[3]),g.distance([0,0],[T,z])}function Lu(f,l,g){const T=g.pointOnLine(l,f);return g.distance(f,T.point)}function Md(f,l,g,T,z){const O=Math.min(Lu(f,[g,T],z),Lu(l,[g,T],z)),B=Math.min(Lu(g,[f,l],z),Lu(T,[f,l],z));return Math.min(O,B)}function Jf(f,l,g,T,z){if(!Hc(l,f.length)||!Hc(T,g.length))return 1/0;let O=1/0;for(let B=l[0];B<l[1];++B){const q=f[B],Z=f[B+1];for(let re=T[0];re<T[1];++re){const de=g[re],ye=g[re+1];if(Dl(q,Z,de,ye))return 0;O=Math.min(O,Md(q,Z,de,ye,z))}}return O}function po(f,l,g,T,z){if(!Hc(l,f.length)||!Hc(T,g.length))return NaN;let O=1/0;for(let B=l[0];B<=l[1];++B)for(let q=T[0];q<=T[1];++q)if(O=Math.min(O,z.distance(f[B],g[q])),O===0)return O;return O}function Pl(f,l,g){if(zh(f,l,!0))return 0;let T=1/0;for(const z of l){const O=z[0],B=z[z.length-1];if(O!==B&&(T=Math.min(T,Lu(f,[B,O],g)),T===0))return T;const q=g.pointOnLine(z,f);if(T=Math.min(T,g.distance(f,q.point)),T===0)return T}return T}function ga(f,l,g,T){if(!Hc(l,f.length))return NaN;for(let O=l[0];O<=l[1];++O)if(zh(f[O],g,!0))return 0;let z=1/0;for(let O=l[0];O<l[1];++O){const B=f[O],q=f[O+1];for(const Z of g)for(let re=0,de=Z.length,ye=de-1;re<de;ye=re++){const Ee=Z[ye],Le=Z[re];if(Dl(B,q,Ee,Le))return 0;z=Math.min(z,Md(B,q,Ee,Le,T))}}return z}function Io(f,l){for(const g of f)for(const T of g)if(zh(T,l,!0))return!0;return!1}function Is(f,l,g,T=1/0){const z=Cp(f),O=Cp(l);if(T!==1/0&&Rh(z,O,g)>=T)return T;if(hu(z,O)){if(Io(f,l))return 0}else if(Io(l,f))return 0;let B=1/0;for(const q of f)for(let Z=0,re=q.length,de=re-1;Z<re;de=Z++){const ye=q[de],Ee=q[Z];for(const Le of l)for(let qe=0,Ke=Le.length,yt=Ke-1;qe<Ke;yt=qe++){const Mt=Le[yt],si=Le[qe];if(Dl(ye,Ee,Mt,si))return 0;B=Math.min(B,Md(ye,Ee,Mt,si,g))}}return B}function ys(f,l,g,T,z,O){if(!O)return;const B=Rh(io(T,O),z,g);B<l&&f.push([B,O,[0,0]])}function no(f,l,g,T,z,O,B){if(!O||!B)return;const q=Rh(io(T,O),io(z,B),g);q<l&&f.push([q,O,B])}function Ll(f,l,g,T,z=1/0){let O=Math.min(T.distance(f[0],g[0][0]),z);if(O===0)return O;const B=new Gn([[0,[0,f.length-1],[0,0]]],If),q=Cp(g);for(;B.length>0;){const Z=B.pop();if(Z[0]>=O)continue;const re=Z[1],de=l?50:100;if(rd(re)<=de){if(!Hc(re,f.length))return NaN;if(l){const ye=ga(f,re,g,T);if(isNaN(ye)||ye===0)return ye;O=Math.min(O,ye)}else for(let ye=re[0];ye<=re[1];++ye){const Ee=Pl(f[ye],g,T);if(O=Math.min(O,Ee),O===0)return 0}}else{const ye=al(re,l);ys(B,O,T,f,q,ye[0]),ys(B,O,T,f,q,ye[1])}}return O}function Rc(f,l,g,T,z,O=1/0){let B=Math.min(O,z.distance(f[0],g[0]));if(B===0)return B;const q=new Gn([[0,[0,f.length-1],[0,g.length-1]]],If);for(;q.length>0;){const Z=q.pop();if(Z[0]>=B)continue;const re=Z[1],de=Z[2],ye=l?50:100,Ee=T?50:100;if(rd(re)<=ye&&rd(de)<=Ee){if(!Hc(re,f.length)&&Hc(de,g.length))return NaN;let Le;if(l&&T)Le=Jf(f,re,g,de,z),B=Math.min(B,Le);else if(l&&!T){const qe=f.slice(re[0],re[1]+1);for(let Ke=de[0];Ke<=de[1];++Ke)if(Le=Lu(g[Ke],qe,z),B=Math.min(B,Le),B===0)return B}else if(!l&&T){const qe=g.slice(de[0],de[1]+1);for(let Ke=re[0];Ke<=re[1];++Ke)if(Le=Lu(f[Ke],qe,z),B=Math.min(B,Le),B===0)return B}else Le=po(f,re,g,de,z),B=Math.min(B,Le)}else{const Le=al(re,l),qe=al(de,T);no(q,B,z,f,g,Le[0],qe[0]),no(q,B,z,f,g,Le[0],qe[1]),no(q,B,z,f,g,Le[1],qe[0]),no(q,B,z,f,g,Le[1],qe[1])}}return B}function Js(f){return f.type==="MultiPolygon"?f.coordinates.map((l=>({type:"Polygon",coordinates:l}))):f.type==="MultiLineString"?f.coordinates.map((l=>({type:"LineString",coordinates:l}))):f.type==="MultiPoint"?f.coordinates.map((l=>({type:"Point",coordinates:l}))):[f]}class Zc{constructor(l,g){this.type=Sn,this.geojson=l,this.geometries=g}static parse(l,g){if(l.length!==2)return g.error(`'distance' expression requires exactly one argument, but found ${l.length-1} instead.`);if(js(l[1])){const T=l[1];if(T.type==="FeatureCollection")return new Zc(T,T.features.map((z=>Js(z.geometry))).flat());if(T.type==="Feature")return new Zc(T,Js(T.geometry));if("type"in T&&"coordinates"in T)return new Zc(T,Js(T))}return g.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(l){if(l.geometry()!=null&&l.canonicalID()!=null){if(l.geometryType()==="Point")return(function(g,T){const z=g.geometry(),O=z.flat().map((Z=>Du([Z.x,Z.y],g.canonical)));if(z.length===0)return NaN;const B=new va(O[0][1]);let q=1/0;for(const Z of T){switch(Z.type){case"Point":q=Math.min(q,Rc(O,!1,[Z.coordinates],!1,B,q));break;case"LineString":q=Math.min(q,Rc(O,!1,Z.coordinates,!0,B,q));break;case"Polygon":q=Math.min(q,Ll(O,!1,Z.coordinates,B,q))}if(q===0)return q}return q})(l,this.geometries);if(l.geometryType()==="LineString")return(function(g,T){const z=g.geometry(),O=z.flat().map((Z=>Du([Z.x,Z.y],g.canonical)));if(z.length===0)return NaN;const B=new va(O[0][1]);let q=1/0;for(const Z of T){switch(Z.type){case"Point":q=Math.min(q,Rc(O,!0,[Z.coordinates],!1,B,q));break;case"LineString":q=Math.min(q,Rc(O,!0,Z.coordinates,!0,B,q));break;case"Polygon":q=Math.min(q,Ll(O,!0,Z.coordinates,B,q))}if(q===0)return q}return q})(l,this.geometries);if(l.geometryType()==="Polygon")return(function(g,T){const z=g.geometry();if(z.length===0||z[0].length===0)return NaN;const O=Dc(z,0).map((Z=>Z.map((re=>re.map((de=>Du([de.x,de.y],g.canonical))))))),B=new va(O[0][0][0][1]);let q=1/0;for(const Z of T)for(const re of O){switch(Z.type){case"Point":q=Math.min(q,Ll([Z.coordinates],!1,re,B,q));break;case"LineString":q=Math.min(q,Ll(Z.coordinates,!0,re,B,q));break;case"Polygon":q=Math.min(q,Is(re,Z.coordinates,B,q))}if(q===0)return q}return q})(l,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Jl={"==":Go,"!=":Ed,">":Wl,"<":uu,">=":Hd,"<=":Ep,array:$a,at:Mc,boolean:$a,case:ou,coalesce:Cu,collator:rh,format:ah,image:$d,in:Ks,"index-of":jc,interpolate:Eo,"interpolate-hcl":Eo,"interpolate-lab":Eo,length:Cl,let:jo,literal:da,match:Mh,number:$a,"number-format":Wr,object:$a,slice:Jh,step:Mu,string:$a,"to-boolean":Ys,"to-color":Ys,"to-number":Ys,"to-string":Ys,var:_a,within:Dh,distance:Zc};class Mo{constructor(l,g,T,z){this.name=l,this.type=g,this._evaluate=T,this.args=z}evaluate(l){return this._evaluate(l,this.args)}eachChild(l){this.args.forEach(l)}outputDefined(){return!1}static parse(l,g){const T=l[0],z=Mo.definitions[T];if(!z)return g.error(`Unknown expression "${T}". If you wanted a literal array, use ["literal", [...]].`,0);const O=Array.isArray(z)?z[0]:z.type,B=Array.isArray(z)?[[z[1],z[2]]]:z.overloads,q=B.filter((([re])=>!Array.isArray(re)||re.length===l.length-1));let Z=null;for(const[re,de]of q){Z=new es(g.registry,ku,g.path,null,g.scope);const ye=[];let Ee=!1;for(let Le=1;Le<l.length;Le++){const qe=l[Le],Ke=Array.isArray(re)?re[Le-1]:re.type,yt=Z.parse(qe,1+ye.length,Ke);if(!yt){Ee=!0;break}ye.push(yt)}if(!Ee)if(Array.isArray(re)&&re.length!==ye.length)Z.error(`Expected ${re.length} arguments, but found ${ye.length} instead.`);else{for(let Le=0;Le<ye.length;Le++){const qe=Array.isArray(re)?re[Le]:re.type,Ke=ye[Le];Z.concat(Le+1).checkSubtype(qe,Ke.type)}if(Z.errors.length===0)return new Mo(T,O,de,ye)}}if(q.length===1)g.errors.push(...Z.errors);else{const re=(q.length?q:B).map((([ye])=>{return Ee=ye,Array.isArray(Ee)?`(${Ee.map(Re).join(", ")})`:`(${Re(Ee.type)}...)`;var Ee})).join(" | "),de=[];for(let ye=1;ye<l.length;ye++){const Ee=g.parse(l[ye],1+de.length);if(!Ee)return null;de.push(Re(Ee.type))}g.error(`Expected arguments of type ${re}, but found (${de.join(", ")}) instead.`)}return null}static register(l,g){Mo.definitions=g;for(const T in g)l[T]=Mo}}function cr(f,[l,g,T,z]){l=l.evaluate(f),g=g.evaluate(f),T=T.evaluate(f);const O=z?z.evaluate(f):1,B=ss(l,g,T,O);if(B)throw new lr(B);return new Ki(l/255,g/255,T/255,O,!1)}function xn(f,l){return f in l}function ad(f,l){const g=l[f];return g===void 0?null:g}function Un(f){return{type:f}}function ku(f){if(f instanceof _a)return ku(f.boundExpression);if(f instanceof Mo&&f.name==="error"||f instanceof rh||f instanceof Dh||f instanceof Zc)return!1;const l=f instanceof Ys||f instanceof $a;let g=!0;return f.eachChild((T=>{g=l?g&&ku(T):g&&T instanceof da})),!!g&&Ph(f)&&Pc(f,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ph(f){if(f instanceof Mo&&(f.name==="get"&&f.args.length===1||f.name==="feature-state"||f.name==="has"&&f.args.length===1||f.name==="properties"||f.name==="geometry-type"||f.name==="id"||/^filter-/.test(f.name))||f instanceof Dh||f instanceof Zc)return!1;let l=!0;return f.eachChild((g=>{l&&!Ph(g)&&(l=!1)})),l}function jn(f){if(f instanceof Mo&&f.name==="feature-state")return!1;let l=!0;return f.eachChild((g=>{l&&!jn(g)&&(l=!1)})),l}function Pc(f,l){if(f instanceof Mo&&l.indexOf(f.name)>=0)return!1;let g=!0;return f.eachChild((T=>{g&&!Pc(T,l)&&(g=!1)})),g}function Xd(f){return{result:"success",value:f}}function Lh(f){return{result:"error",value:f}}function $o(f){return f["property-type"]==="data-driven"||f["property-type"]==="cross-faded-data-driven"}function Mf(f){return!!f.expression&&f.expression.parameters.indexOf("zoom")>-1}function ds(f){return!!f.expression&&f.expression.interpolated}function Ua(f){return f instanceof Number?"number":f instanceof String?"string":f instanceof Boolean?"boolean":Array.isArray(f)?"array":f===null?"null":typeof f}function uc(f){return typeof f=="object"&&f!==null&&!Array.isArray(f)}function Qf(f){return f}function sh(f,l){const g=l.type==="color",T=f.stops&&typeof f.stops[0][0]=="object",z=T||!(T||f.property!==void 0),O=f.type||(ds(l)?"exponential":"interval");if(g||l.type==="padding"){const de=g?Ki.parse:Nn.parse;(f=Ws({},f)).stops&&(f.stops=f.stops.map((ye=>[ye[0],de(ye[1])]))),f.default=de(f.default?f.default:l.default)}if(f.colorSpace&&(B=f.colorSpace)!=="rgb"&&B!=="hcl"&&B!=="lab")throw new Error(`Unknown color space: "${f.colorSpace}"`);var B;let q,Z,re;if(O==="exponential")q=du;else if(O==="interval")q=ep;else if(O==="categorical"){q=sd,Z=Object.create(null);for(const de of f.stops)Z[de[0]]=de[1];re=typeof f.stops[0][0]}else{if(O!=="identity")throw new Error(`Unknown function type "${O}"`);q=od}if(T){const de={},ye=[];for(let qe=0;qe<f.stops.length;qe++){const Ke=f.stops[qe],yt=Ke[0].zoom;de[yt]===void 0&&(de[yt]={zoom:yt,type:f.type,property:f.property,default:f.default,stops:[]},ye.push(yt)),de[yt].stops.push([Ke[0].value,Ke[1]])}const Ee=[];for(const qe of ye)Ee.push([de[qe].zoom,sh(de[qe],l)]);const Le={name:"linear"};return{kind:"composite",interpolationType:Le,interpolationFactor:Eo.interpolationFactor.bind(void 0,Le),zoomStops:Ee.map((qe=>qe[0])),evaluate:({zoom:qe},Ke)=>du({stops:Ee,base:f.base},l,qe).evaluate(qe,Ke)}}if(z){const de=O==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:de,interpolationFactor:Eo.interpolationFactor.bind(void 0,de),zoomStops:f.stops.map((ye=>ye[0])),evaluate:({zoom:ye})=>q(f,l,ye,Z,re)}}return{kind:"source",evaluate(de,ye){const Ee=ye&&ye.properties?ye.properties[f.property]:void 0;return Ee===void 0?gl(f.default,l.default):q(f,l,Ee,Z,re)}}}function gl(f,l,g){return f!==void 0?f:l!==void 0?l:g!==void 0?g:void 0}function sd(f,l,g,T,z){return gl(typeof g===z?T[g]:void 0,f.default,l.default)}function ep(f,l,g){if(Ua(g)!=="number")return gl(f.default,l.default);const T=f.stops.length;if(T===1||g<=f.stops[0][0])return f.stops[0][1];if(g>=f.stops[T-1][0])return f.stops[T-1][1];const z=Qh(f.stops.map((O=>O[0])),g);return f.stops[z][1]}function du(f,l,g){const T=f.base!==void 0?f.base:1;if(Ua(g)!=="number")return gl(f.default,l.default);const z=f.stops.length;if(z===1||g<=f.stops[0][0])return f.stops[0][1];if(g>=f.stops[z-1][0])return f.stops[z-1][1];const O=Qh(f.stops.map((de=>de[0])),g),B=(function(de,ye,Ee,Le){const qe=Le-Ee,Ke=de-Ee;return qe===0?0:ye===1?Ke/qe:(Math.pow(ye,Ke)-1)/(Math.pow(ye,qe)-1)})(g,T,f.stops[O][0],f.stops[O+1][0]),q=f.stops[O][1],Z=f.stops[O+1][1],re=Po[l.type]||Qf;return typeof q.evaluate=="function"?{evaluate(...de){const ye=q.evaluate.apply(void 0,de),Ee=Z.evaluate.apply(void 0,de);if(ye!==void 0&&Ee!==void 0)return re(ye,Ee,B,f.colorSpace)}}:re(q,Z,B,f.colorSpace)}function od(f,l,g){switch(l.type){case"color":g=Ki.parse(g);break;case"formatted":g=$n.fromString(g.toString());break;case"resolvedImage":g=Ja.fromString(g.toString());break;case"padding":g=Nn.parse(g);break;default:Ua(g)===l.type||l.type==="enum"&&l.values[g]||(g=void 0)}return gl(g,f.default,l.default)}Mo.register(Jl,{error:[{kind:"error"},[tr],(f,[l])=>{throw new lr(l.evaluate(f))}],typeof:[tr,[Xr],(f,[l])=>Re(ea(l.evaluate(f)))],"to-rgba":[Ce(Sn,4),[Hs],(f,[l])=>{const[g,T,z,O]=l.evaluate(f).rgb;return[255*g,255*T,255*z,O]}],rgb:[Hs,[Sn,Sn,Sn],cr],rgba:[Hs,[Sn,Sn,Sn,Sn],cr],has:{type:ar,overloads:[[[tr],(f,[l])=>xn(l.evaluate(f),f.properties())],[[tr,pl],(f,[l,g])=>xn(l.evaluate(f),g.evaluate(f))]]},get:{type:Xr,overloads:[[[tr],(f,[l])=>ad(l.evaluate(f),f.properties())],[[tr,pl],(f,[l,g])=>ad(l.evaluate(f),g.evaluate(f))]]},"feature-state":[Xr,[tr],(f,[l])=>ad(l.evaluate(f),f.featureState||{})],properties:[pl,[],f=>f.properties()],"geometry-type":[tr,[],f=>f.geometryType()],id:[Xr,[],f=>f.id()],zoom:[Sn,[],f=>f.globals.zoom],"heatmap-density":[Sn,[],f=>f.globals.heatmapDensity||0],"line-progress":[Sn,[],f=>f.globals.lineProgress||0],accumulated:[Xr,[],f=>f.globals.accumulated===void 0?null:f.globals.accumulated],"+":[Sn,Un(Sn),(f,l)=>{let g=0;for(const T of l)g+=T.evaluate(f);return g}],"*":[Sn,Un(Sn),(f,l)=>{let g=1;for(const T of l)g*=T.evaluate(f);return g}],"-":{type:Sn,overloads:[[[Sn,Sn],(f,[l,g])=>l.evaluate(f)-g.evaluate(f)],[[Sn],(f,[l])=>-l.evaluate(f)]]},"/":[Sn,[Sn,Sn],(f,[l,g])=>l.evaluate(f)/g.evaluate(f)],"%":[Sn,[Sn,Sn],(f,[l,g])=>l.evaluate(f)%g.evaluate(f)],ln2:[Sn,[],()=>Math.LN2],pi:[Sn,[],()=>Math.PI],e:[Sn,[],()=>Math.E],"^":[Sn,[Sn,Sn],(f,[l,g])=>Math.pow(l.evaluate(f),g.evaluate(f))],sqrt:[Sn,[Sn],(f,[l])=>Math.sqrt(l.evaluate(f))],log10:[Sn,[Sn],(f,[l])=>Math.log(l.evaluate(f))/Math.LN10],ln:[Sn,[Sn],(f,[l])=>Math.log(l.evaluate(f))],log2:[Sn,[Sn],(f,[l])=>Math.log(l.evaluate(f))/Math.LN2],sin:[Sn,[Sn],(f,[l])=>Math.sin(l.evaluate(f))],cos:[Sn,[Sn],(f,[l])=>Math.cos(l.evaluate(f))],tan:[Sn,[Sn],(f,[l])=>Math.tan(l.evaluate(f))],asin:[Sn,[Sn],(f,[l])=>Math.asin(l.evaluate(f))],acos:[Sn,[Sn],(f,[l])=>Math.acos(l.evaluate(f))],atan:[Sn,[Sn],(f,[l])=>Math.atan(l.evaluate(f))],min:[Sn,Un(Sn),(f,l)=>Math.min(...l.map((g=>g.evaluate(f))))],max:[Sn,Un(Sn),(f,l)=>Math.max(...l.map((g=>g.evaluate(f))))],abs:[Sn,[Sn],(f,[l])=>Math.abs(l.evaluate(f))],round:[Sn,[Sn],(f,[l])=>{const g=l.evaluate(f);return g<0?-Math.round(-g):Math.round(g)}],floor:[Sn,[Sn],(f,[l])=>Math.floor(l.evaluate(f))],ceil:[Sn,[Sn],(f,[l])=>Math.ceil(l.evaluate(f))],"filter-==":[ar,[tr,Xr],(f,[l,g])=>f.properties()[l.value]===g.value],"filter-id-==":[ar,[Xr],(f,[l])=>f.id()===l.value],"filter-type-==":[ar,[tr],(f,[l])=>f.geometryType()===l.value],"filter-<":[ar,[tr,Xr],(f,[l,g])=>{const T=f.properties()[l.value],z=g.value;return typeof T==typeof z&&T<z}],"filter-id-<":[ar,[Xr],(f,[l])=>{const g=f.id(),T=l.value;return typeof g==typeof T&&g<T}],"filter->":[ar,[tr,Xr],(f,[l,g])=>{const T=f.properties()[l.value],z=g.value;return typeof T==typeof z&&T>z}],"filter-id->":[ar,[Xr],(f,[l])=>{const g=f.id(),T=l.value;return typeof g==typeof T&&g>T}],"filter-<=":[ar,[tr,Xr],(f,[l,g])=>{const T=f.properties()[l.value],z=g.value;return typeof T==typeof z&&T<=z}],"filter-id-<=":[ar,[Xr],(f,[l])=>{const g=f.id(),T=l.value;return typeof g==typeof T&&g<=T}],"filter->=":[ar,[tr,Xr],(f,[l,g])=>{const T=f.properties()[l.value],z=g.value;return typeof T==typeof z&&T>=z}],"filter-id->=":[ar,[Xr],(f,[l])=>{const g=f.id(),T=l.value;return typeof g==typeof T&&g>=T}],"filter-has":[ar,[Xr],(f,[l])=>l.value in f.properties()],"filter-has-id":[ar,[],f=>f.id()!==null&&f.id()!==void 0],"filter-type-in":[ar,[Ce(tr)],(f,[l])=>l.value.indexOf(f.geometryType())>=0],"filter-id-in":[ar,[Ce(Xr)],(f,[l])=>l.value.indexOf(f.id())>=0],"filter-in-small":[ar,[tr,Ce(Xr)],(f,[l,g])=>g.value.indexOf(f.properties()[l.value])>=0],"filter-in-large":[ar,[tr,Ce(Xr)],(f,[l,g])=>(function(T,z,O,B){for(;O<=B;){const q=O+B>>1;if(z[q]===T)return!0;z[q]>T?B=q-1:O=q+1}return!1})(f.properties()[l.value],g.value,0,g.value.length-1)],all:{type:ar,overloads:[[[ar,ar],(f,[l,g])=>l.evaluate(f)&&g.evaluate(f)],[Un(ar),(f,l)=>{for(const g of l)if(!g.evaluate(f))return!1;return!0}]]},any:{type:ar,overloads:[[[ar,ar],(f,[l,g])=>l.evaluate(f)||g.evaluate(f)],[Un(ar),(f,l)=>{for(const g of l)if(g.evaluate(f))return!0;return!1}]]},"!":[ar,[ar],(f,[l])=>!l.evaluate(f)],"is-supported-script":[ar,[tr],(f,[l])=>{const g=f.globals&&f.globals.isSupportedScript;return!g||g(l.evaluate(f))}],upcase:[tr,[tr],(f,[l])=>l.evaluate(f).toUpperCase()],downcase:[tr,[tr],(f,[l])=>l.evaluate(f).toLowerCase()],concat:[tr,Un(Xr),(f,l)=>l.map((g=>jr(g.evaluate(f)))).join("")],"resolved-locale":[tr,[ml],(f,[l])=>l.evaluate(f).resolvedLocale()]});class fu{constructor(l,g){var T;this.expression=l,this._warningHistory={},this._evaluator=new nh,this._defaultValue=g?(T=g).type==="color"&&uc(T.default)?new Ki(0,0,0,0):T.type==="color"?Ki.parse(T.default)||null:T.type==="padding"?Nn.parse(T.default)||null:T.type==="variableAnchorOffsetCollection"?La.parse(T.default)||null:T.default===void 0?null:T.default:null,this._enumValues=g&&g.type==="enum"?g.values:null}evaluateWithoutErrorHandling(l,g,T,z,O,B){return this._evaluator.globals=l,this._evaluator.feature=g,this._evaluator.featureState=T,this._evaluator.canonical=z,this._evaluator.availableImages=O||null,this._evaluator.formattedSection=B,this.expression.evaluate(this._evaluator)}evaluate(l,g,T,z,O,B){this._evaluator.globals=l,this._evaluator.feature=g||null,this._evaluator.featureState=T||null,this._evaluator.canonical=z,this._evaluator.availableImages=O||null,this._evaluator.formattedSection=B||null;try{const q=this.expression.evaluate(this._evaluator);if(q==null||typeof q=="number"&&q!=q)return this._defaultValue;if(this._enumValues&&!(q in this._enumValues))throw new lr(`Expected value to be one of ${Object.keys(this._enumValues).map((Z=>JSON.stringify(Z))).join(", ")}, but found ${JSON.stringify(q)} instead.`);return q}catch(q){return this._warningHistory[q.message]||(this._warningHistory[q.message]=!0,typeof console<"u"&&console.warn(q.message)),this._defaultValue}}}function Lc(f){return Array.isArray(f)&&f.length>0&&typeof f[0]=="string"&&f[0]in Jl}function kc(f,l){const g=new es(Jl,ku,[],l?(function(z){const O={color:Hs,string:tr,number:Sn,enum:tr,boolean:ar,formatted:Uo,padding:lc,resolvedImage:ul,variableAnchorOffsetCollection:dt};return z.type==="array"?Ce(O[z.value]||Xr,z.length):O[z.type]})(l):void 0),T=g.parse(f,void 0,void 0,void 0,l&&l.type==="string"?{typeAnnotation:"coerce"}:void 0);return T?Xd(new fu(T,l)):Lh(g.errors)}class pu{constructor(l,g){this.kind=l,this._styleExpression=g,this.isStateDependent=l!=="constant"&&!jn(g.expression)}evaluateWithoutErrorHandling(l,g,T,z,O,B){return this._styleExpression.evaluateWithoutErrorHandling(l,g,T,z,O,B)}evaluate(l,g,T,z,O,B){return this._styleExpression.evaluate(l,g,T,z,O,B)}}class Xc{constructor(l,g,T,z){this.kind=l,this.zoomStops=T,this._styleExpression=g,this.isStateDependent=l!=="camera"&&!jn(g.expression),this.interpolationType=z}evaluateWithoutErrorHandling(l,g,T,z,O,B){return this._styleExpression.evaluateWithoutErrorHandling(l,g,T,z,O,B)}evaluate(l,g,T,z,O,B){return this._styleExpression.evaluate(l,g,T,z,O,B)}interpolationFactor(l,g,T){return this.interpolationType?Eo.interpolationFactor(this.interpolationType,l,g,T):0}}function Cf(f,l){const g=kc(f,l);if(g.result==="error")return g;const T=g.value.expression,z=Ph(T);if(!z&&!$o(l))return Lh([new To("","data expressions not supported")]);const O=Pc(T,["zoom"]);if(!O&&!Mf(l))return Lh([new To("","zoom expressions not supported")]);const B=mu(T);return B||O?B instanceof To?Lh([B]):B instanceof Eo&&!ds(l)?Lh([new To("",'"interpolate" expressions cannot be used with this property')]):Xd(B?new Xc(z?"camera":"composite",g.value,B.labels,B instanceof Eo?B.interpolation:void 0):new pu(z?"constant":"source",g.value)):Lh([new To("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ld{constructor(l,g){this._parameters=l,this._specification=g,Ws(this,sh(this._parameters,this._specification))}static deserialize(l){return new ld(l._parameters,l._specification)}static serialize(l){return{_parameters:l._parameters,_specification:l._specification}}}function mu(f){let l=null;if(f instanceof jo)l=mu(f.result);else if(f instanceof Cu){for(const g of f.args)if(l=mu(g),l)break}else(f instanceof Mu||f instanceof Eo)&&f.input instanceof Mo&&f.input.name==="zoom"&&(l=f);return l instanceof To||f.eachChild((g=>{const T=mu(g);T instanceof To?l=T:!l&&T?l=new To("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):l&&T&&l!==T&&(l=new To("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),l}function Cd(f){if(f===!0||f===!1)return!0;if(!Array.isArray(f)||f.length===0)return!1;switch(f[0]){case"has":return f.length>=2&&f[1]!=="$id"&&f[1]!=="$type";case"in":return f.length>=3&&(typeof f[1]!="string"||Array.isArray(f[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return f.length!==3||Array.isArray(f[1])||Array.isArray(f[2]);case"any":case"all":for(const l of f.slice(1))if(!Cd(l)&&typeof l!="boolean")return!1;return!0;default:return!0}}const _u={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zf(f){if(f==null)return{filter:()=>!0,needGeometry:!1};Cd(f)||(f=Ou(f));const l=kc(f,_u);if(l.result==="error")throw new Error(l.value.map((g=>`${g.key}: ${g.message}`)).join(", "));return{filter:(g,T,z)=>l.value.evaluate(g,T,{},z),needGeometry:Df(f)}}function um(f,l){return f<l?-1:f>l?1:0}function Df(f){if(!Array.isArray(f))return!1;if(f[0]==="within"||f[0]==="distance")return!0;for(let l=1;l<f.length;l++)if(Df(f[l]))return!0;return!1}function Ou(f){if(!f)return!0;const l=f[0];return f.length<=1?l!=="any":l==="=="?cd(f[1],f[2],"=="):l==="!="?Gs(cd(f[1],f[2],"==")):l==="<"||l===">"||l==="<="||l===">="?cd(f[1],f[2],l):l==="any"?(g=f.slice(1),["any"].concat(g.map(Ou))):l==="all"?["all"].concat(f.slice(1).map(Ou)):l==="none"?["all"].concat(f.slice(1).map(Ou).map(Gs)):l==="in"?kl(f[1],f.slice(2)):l==="!in"?Gs(kl(f[1],f.slice(2))):l==="has"?ud(f[1]):l!=="!has"||Gs(ud(f[1]));var g}function cd(f,l,g){switch(f){case"$type":return[`filter-type-${g}`,l];case"$id":return[`filter-id-${g}`,l];default:return[`filter-${g}`,f,l]}}function kl(f,l){if(l.length===0)return!1;switch(f){case"$type":return["filter-type-in",["literal",l]];case"$id":return["filter-id-in",["literal",l]];default:return l.length>200&&!l.some((g=>typeof g!=typeof l[0]))?["filter-in-large",f,["literal",l.sort(um)]]:["filter-in-small",f,["literal",l]]}}function ud(f){switch(f){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",f]}}function Gs(f){return["!",f]}function hc(f){const l=typeof f;if(l==="number"||l==="boolean"||l==="string"||f==null)return JSON.stringify(f);if(Array.isArray(f)){let z="[";for(const O of f)z+=`${hc(O)},`;return`${z}]`}const g=Object.keys(f).sort();let T="{";for(let z=0;z<g.length;z++)T+=`${JSON.stringify(g[z])}:${hc(f[g[z]])},`;return`${T}}`}function dc(f){let l="";for(const g of Ha)l+=`/${hc(f[g])}`;return l}function oh(f){const l=f.value;return l?[new cn(f.key,l,"constants have been deprecated as of v8")]:[]}function os(f){return f instanceof Number||f instanceof String||f instanceof Boolean?f.valueOf():f}function Ol(f){if(Array.isArray(f))return f.map(Ol);if(f instanceof Object&&!(f instanceof Number||f instanceof String||f instanceof Boolean)){const l={};for(const g in f)l[g]=Ol(f[g]);return l}return os(f)}function pi(f){const l=f.key,g=f.value,T=f.valueSpec||{},z=f.objectElementValidators||{},O=f.style,B=f.styleSpec,q=f.validateSpec;let Z=[];const re=Ua(g);if(re!=="object")return[new cn(l,g,`object expected, ${re} found`)];for(const de in g){const ye=de.split(".")[0],Ee=T[ye]||T["*"];let Le;if(z[ye])Le=z[ye];else if(T[ye])Le=q;else if(z["*"])Le=z["*"];else{if(!T["*"]){Z.push(new cn(l,g[de],`unknown property "${de}"`));continue}Le=q}Z=Z.concat(Le({key:(l&&`${l}.`)+de,value:g[de],valueSpec:Ee,style:O,styleSpec:B,object:g,objectKey:de,validateSpec:q},g))}for(const de in T)z[de]||T[de].required&&T[de].default===void 0&&g[de]===void 0&&Z.push(new cn(l,g,`missing required property "${de}"`));return Z}function kh(f){const l=f.value,g=f.valueSpec,T=f.style,z=f.styleSpec,O=f.key,B=f.arrayElementValidator||f.validateSpec;if(Ua(l)!=="array")return[new cn(O,l,`array expected, ${Ua(l)} found`)];if(g.length&&l.length!==g.length)return[new cn(O,l,`array length ${g.length} expected, length ${l.length} found`)];if(g["min-length"]&&l.length<g["min-length"])return[new cn(O,l,`array length at least ${g["min-length"]} expected, length ${l.length} found`)];let q={type:g.value,values:g.values};z.$version<7&&(q.function=g.function),Ua(g.value)==="object"&&(q=g.value);let Z=[];for(let re=0;re<l.length;re++)Z=Z.concat(B({array:l,arrayIndex:re,value:l[re],valueSpec:q,validateSpec:f.validateSpec,style:T,styleSpec:z,key:`${O}[${re}]`}));return Z}function gu(f){const l=f.key,g=f.value,T=f.valueSpec;let z=Ua(g);return z==="number"&&g!=g&&(z="NaN"),z!=="number"?[new cn(l,g,`number expected, ${z} found`)]:"minimum"in T&&g<T.minimum?[new cn(l,g,`${g} is less than the minimum value ${T.minimum}`)]:"maximum"in T&&g>T.maximum?[new cn(l,g,`${g} is greater than the maximum value ${T.maximum}`)]:[]}function hd(f){const l=f.valueSpec,g=os(f.value.type);let T,z,O,B={};const q=g!=="categorical"&&f.value.property===void 0,Z=!q,re=Ua(f.value.stops)==="array"&&Ua(f.value.stops[0])==="array"&&Ua(f.value.stops[0][0])==="object",de=pi({key:f.key,value:f.value,valueSpec:f.styleSpec.function,validateSpec:f.validateSpec,style:f.style,styleSpec:f.styleSpec,objectElementValidators:{stops:function(Le){if(g==="identity")return[new cn(Le.key,Le.value,'identity function may not have a "stops" property')];let qe=[];const Ke=Le.value;return qe=qe.concat(kh({key:Le.key,value:Ke,valueSpec:Le.valueSpec,validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec,arrayElementValidator:ye})),Ua(Ke)==="array"&&Ke.length===0&&qe.push(new cn(Le.key,Ke,"array must have at least one stop")),qe},default:function(Le){return Le.validateSpec({key:Le.key,value:Le.value,valueSpec:l,validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec})}}});return g==="identity"&&q&&de.push(new cn(f.key,f.value,'missing required property "property"')),g==="identity"||f.value.stops||de.push(new cn(f.key,f.value,'missing required property "stops"')),g==="exponential"&&f.valueSpec.expression&&!ds(f.valueSpec)&&de.push(new cn(f.key,f.value,"exponential functions not supported")),f.styleSpec.$version>=8&&(Z&&!$o(f.valueSpec)?de.push(new cn(f.key,f.value,"property functions not supported")):q&&!Mf(f.valueSpec)&&de.push(new cn(f.key,f.value,"zoom functions not supported"))),g!=="categorical"&&!re||f.value.property!==void 0||de.push(new cn(f.key,f.value,'"property" property is required')),de;function ye(Le){let qe=[];const Ke=Le.value,yt=Le.key;if(Ua(Ke)!=="array")return[new cn(yt,Ke,`array expected, ${Ua(Ke)} found`)];if(Ke.length!==2)return[new cn(yt,Ke,`array length 2 expected, length ${Ke.length} found`)];if(re){if(Ua(Ke[0])!=="object")return[new cn(yt,Ke,`object expected, ${Ua(Ke[0])} found`)];if(Ke[0].zoom===void 0)return[new cn(yt,Ke,"object stop key must have zoom")];if(Ke[0].value===void 0)return[new cn(yt,Ke,"object stop key must have value")];if(O&&O>os(Ke[0].zoom))return[new cn(yt,Ke[0].zoom,"stop zoom values must appear in ascending order")];os(Ke[0].zoom)!==O&&(O=os(Ke[0].zoom),z=void 0,B={}),qe=qe.concat(pi({key:`${yt}[0]`,value:Ke[0],valueSpec:{zoom:{}},validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec,objectElementValidators:{zoom:gu,value:Ee}}))}else qe=qe.concat(Ee({key:`${yt}[0]`,value:Ke[0],validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec},Ke));return Lc(Ol(Ke[1]))?qe.concat([new cn(`${yt}[1]`,Ke[1],"expressions are not allowed in function stops.")]):qe.concat(Le.validateSpec({key:`${yt}[1]`,value:Ke[1],valueSpec:l,validateSpec:Le.validateSpec,style:Le.style,styleSpec:Le.styleSpec}))}function Ee(Le,qe){const Ke=Ua(Le.value),yt=os(Le.value),Mt=Le.value!==null?Le.value:qe;if(T){if(Ke!==T)return[new cn(Le.key,Mt,`${Ke} stop domain type must match previous stop domain type ${T}`)]}else T=Ke;if(Ke!=="number"&&Ke!=="string"&&Ke!=="boolean")return[new cn(Le.key,Mt,"stop domain value must be a number, string, or boolean")];if(Ke!=="number"&&g!=="categorical"){let si=`number expected, ${Ke} found`;return $o(l)&&g===void 0&&(si+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new cn(Le.key,Mt,si)]}return g!=="categorical"||Ke!=="number"||isFinite(yt)&&Math.floor(yt)===yt?g!=="categorical"&&Ke==="number"&&z!==void 0&&yt<z?[new cn(Le.key,Mt,"stop domain values must appear in ascending order")]:(z=yt,g==="categorical"&&yt in B?[new cn(Le.key,Mt,"stop domain values must be unique")]:(B[yt]=!0,[])):[new cn(Le.key,Mt,`integer expected, found ${yt}`)]}}function Bu(f){const l=(f.expressionContext==="property"?Cf:kc)(Ol(f.value),f.valueSpec);if(l.result==="error")return l.value.map((T=>new cn(`${f.key}${T.key}`,f.value,T.message)));const g=l.value.expression||l.value._styleExpression.expression;if(f.expressionContext==="property"&&f.propertyKey==="text-font"&&!g.outputDefined())return[new cn(f.key,f.value,`Invalid data expression for "${f.propertyKey}". Output values must be contained as literals within the expression.`)];if(f.expressionContext==="property"&&f.propertyType==="layout"&&!jn(g))return[new cn(f.key,f.value,'"feature-state" data expressions are not supported with layout properties.')];if(f.expressionContext==="filter"&&!jn(g))return[new cn(f.key,f.value,'"feature-state" data expressions are not supported with filters.')];if(f.expressionContext&&f.expressionContext.indexOf("cluster")===0){if(!Pc(g,["zoom","feature-state"]))return[new cn(f.key,f.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(f.expressionContext==="cluster-initial"&&!Ph(g))return[new cn(f.key,f.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function yl(f){const l=f.key,g=f.value,T=f.valueSpec,z=[];return Array.isArray(T.values)?T.values.indexOf(os(g))===-1&&z.push(new cn(l,g,`expected one of [${T.values.join(", ")}], ${JSON.stringify(g)} found`)):Object.keys(T.values).indexOf(os(g))===-1&&z.push(new cn(l,g,`expected one of [${Object.keys(T.values).join(", ")}], ${JSON.stringify(g)} found`)),z}function yu(f){return Cd(Ol(f.value))?Bu(Ws({},f,{expressionContext:"filter",valueSpec:{value:"boolean"}})):xl(f)}function xl(f){const l=f.value,g=f.key;if(Ua(l)!=="array")return[new cn(g,l,`array expected, ${Ua(l)} found`)];const T=f.styleSpec;let z,O=[];if(l.length<1)return[new cn(g,l,"filter array must have at least 1 element")];switch(O=O.concat(yl({key:`${g}[0]`,value:l[0],valueSpec:T.filter_operator,style:f.style,styleSpec:f.styleSpec})),os(l[0])){case"<":case"<=":case">":case">=":l.length>=2&&os(l[1])==="$type"&&O.push(new cn(g,l,`"$type" cannot be use with operator "${l[0]}"`));case"==":case"!=":l.length!==3&&O.push(new cn(g,l,`filter array for operator "${l[0]}" must have 3 elements`));case"in":case"!in":l.length>=2&&(z=Ua(l[1]),z!=="string"&&O.push(new cn(`${g}[1]`,l[1],`string expected, ${z} found`)));for(let B=2;B<l.length;B++)z=Ua(l[B]),os(l[1])==="$type"?O=O.concat(yl({key:`${g}[${B}]`,value:l[B],valueSpec:T.geometry_type,style:f.style,styleSpec:f.styleSpec})):z!=="string"&&z!=="number"&&z!=="boolean"&&O.push(new cn(`${g}[${B}]`,l[B],`string, number, or boolean expected, ${z} found`));break;case"any":case"all":case"none":for(let B=1;B<l.length;B++)O=O.concat(xl({key:`${g}[${B}]`,value:l[B],style:f.style,styleSpec:f.styleSpec}));break;case"has":case"!has":z=Ua(l[1]),l.length!==2?O.push(new cn(g,l,`filter array for "${l[0]}" operator must have 2 elements`)):z!=="string"&&O.push(new cn(`${g}[1]`,l[1],`string expected, ${z} found`))}return O}function Fu(f,l){const g=f.key,T=f.validateSpec,z=f.style,O=f.styleSpec,B=f.value,q=f.objectKey,Z=O[`${l}_${f.layerType}`];if(!Z)return[];const re=q.match(/^(.*)-transition$/);if(l==="paint"&&re&&Z[re[1]]&&Z[re[1]].transition)return T({key:g,value:B,valueSpec:O.transition,style:z,styleSpec:O});const de=f.valueSpec||Z[q];if(!de)return[new cn(g,B,`unknown property "${q}"`)];let ye;if(Ua(B)==="string"&&$o(de)&&!de.tokens&&(ye=/^{([^}]+)}$/.exec(B)))return[new cn(g,B,`"${q}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(ye[1])} }\`.`)];const Ee=[];return f.layerType==="symbol"&&(q==="text-field"&&z&&!z.glyphs&&Ee.push(new cn(g,B,'use of "text-field" requires a style "glyphs" property')),q==="text-font"&&uc(Ol(B))&&os(B.type)==="identity"&&Ee.push(new cn(g,B,'"text-font" does not support identity functions'))),Ee.concat(T({key:f.key,value:B,valueSpec:de,style:z,styleSpec:O,expressionContext:"property",propertyType:l,propertyKey:q}))}function vl(f){return Fu(f,"paint")}function Nu(f){return Fu(f,"layout")}function Oh(f){let l=[];const g=f.value,T=f.key,z=f.style,O=f.styleSpec;g.type||g.ref||l.push(new cn(T,g,'either "type" or "ref" is required'));let B=os(g.type);const q=os(g.ref);if(g.id){const Z=os(g.id);for(let re=0;re<f.arrayIndex;re++){const de=z.layers[re];os(de.id)===Z&&l.push(new cn(T,g.id,`duplicate layer id "${g.id}", previously used at line ${de.id.__line__}`))}}if("ref"in g){let Z;["type","source","source-layer","filter","layout"].forEach((re=>{re in g&&l.push(new cn(T,g[re],`"${re}" is prohibited for ref layers`))})),z.layers.forEach((re=>{os(re.id)===q&&(Z=re)})),Z?Z.ref?l.push(new cn(T,g.ref,"ref cannot reference another ref layer")):B=os(Z.type):l.push(new cn(T,g.ref,`ref layer "${q}" not found`))}else if(B!=="background")if(g.source){const Z=z.sources&&z.sources[g.source],re=Z&&os(Z.type);Z?re==="vector"&&B==="raster"?l.push(new cn(T,g.source,`layer "${g.id}" requires a raster source`)):re!=="raster-dem"&&B==="hillshade"?l.push(new cn(T,g.source,`layer "${g.id}" requires a raster-dem source`)):re==="raster"&&B!=="raster"?l.push(new cn(T,g.source,`layer "${g.id}" requires a vector source`)):re!=="vector"||g["source-layer"]?re==="raster-dem"&&B!=="hillshade"?l.push(new cn(T,g.source,"raster-dem source can only be used with layer type 'hillshade'.")):B!=="line"||!g.paint||!g.paint["line-gradient"]||re==="geojson"&&Z.lineMetrics||l.push(new cn(T,g,`layer "${g.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):l.push(new cn(T,g,`layer "${g.id}" must specify a "source-layer"`)):l.push(new cn(T,g.source,`source "${g.source}" not found`))}else l.push(new cn(T,g,'missing required property "source"'));return l=l.concat(pi({key:T,value:g,valueSpec:O.layer,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,objectElementValidators:{"*":()=>[],type:()=>f.validateSpec({key:`${T}.type`,value:g.type,valueSpec:O.layer.type,style:f.style,styleSpec:f.styleSpec,validateSpec:f.validateSpec,object:g,objectKey:"type"}),filter:yu,layout:Z=>pi({layer:g,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,validateSpec:Z.validateSpec,objectElementValidators:{"*":re=>Nu(Ws({layerType:B},re))}}),paint:Z=>pi({layer:g,key:Z.key,value:Z.value,style:Z.style,styleSpec:Z.styleSpec,validateSpec:Z.validateSpec,objectElementValidators:{"*":re=>vl(Ws({layerType:B},re))}})}})),l}function Oc(f){const l=f.value,g=f.key,T=Ua(l);return T!=="string"?[new cn(g,l,`string expected, ${T} found`)]:[]}const Bh={promoteId:function({key:f,value:l}){if(Ua(l)==="string")return Oc({key:f,value:l});{const g=[];for(const T in l)g.push(...Oc({key:`${f}.${T}`,value:l[T]}));return g}}};function Wd(f){const l=f.value,g=f.key,T=f.styleSpec,z=f.style,O=f.validateSpec;if(!l.type)return[new cn(g,l,'"type" is required')];const B=os(l.type);let q;switch(B){case"vector":case"raster":return q=pi({key:g,value:l,valueSpec:T[`source_${B.replace("-","_")}`],style:f.style,styleSpec:T,objectElementValidators:Bh,validateSpec:O}),q;case"raster-dem":return q=(function(Z){var re;const de=(re=Z.sourceName)!==null&&re!==void 0?re:"",ye=Z.value,Ee=Z.styleSpec,Le=Ee.source_raster_dem,qe=Z.style;let Ke=[];const yt=Ua(ye);if(ye===void 0)return Ke;if(yt!=="object")return Ke.push(new cn("source_raster_dem",ye,`object expected, ${yt} found`)),Ke;const Mt=os(ye.encoding)==="custom",si=["redFactor","greenFactor","blueFactor","baseShift"],Ut=Z.value.encoding?`"${Z.value.encoding}"`:"Default";for(const ii in ye)!Mt&&si.includes(ii)?Ke.push(new cn(ii,ye[ii],`In "${de}": "${ii}" is only valid when "encoding" is set to "custom". ${Ut} encoding found`)):Le[ii]?Ke=Ke.concat(Z.validateSpec({key:ii,value:ye[ii],valueSpec:Le[ii],validateSpec:Z.validateSpec,style:qe,styleSpec:Ee})):Ke.push(new cn(ii,ye[ii],`unknown property "${ii}"`));return Ke})({sourceName:g,value:l,style:f.style,styleSpec:T,validateSpec:O}),q;case"geojson":if(q=pi({key:g,value:l,valueSpec:T.source_geojson,style:z,styleSpec:T,validateSpec:O,objectElementValidators:Bh}),l.cluster)for(const Z in l.clusterProperties){const[re,de]=l.clusterProperties[Z],ye=typeof re=="string"?[re,["accumulated"],["get",Z]]:re;q.push(...Bu({key:`${g}.${Z}.map`,value:de,expressionContext:"cluster-map"})),q.push(...Bu({key:`${g}.${Z}.reduce`,value:ye,expressionContext:"cluster-reduce"}))}return q;case"video":return pi({key:g,value:l,valueSpec:T.source_video,style:z,validateSpec:O,styleSpec:T});case"image":return pi({key:g,value:l,valueSpec:T.source_image,style:z,validateSpec:O,styleSpec:T});case"canvas":return[new cn(g,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yl({key:`${g}.type`,value:l.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]}})}}function Yd(f){const l=f.value,g=f.styleSpec,T=g.light,z=f.style;let O=[];const B=Ua(l);if(l===void 0)return O;if(B!=="object")return O=O.concat([new cn("light",l,`object expected, ${B} found`)]),O;for(const q in l){const Z=q.match(/^(.*)-transition$/);O=O.concat(Z&&T[Z[1]]&&T[Z[1]].transition?f.validateSpec({key:q,value:l[q],valueSpec:g.transition,validateSpec:f.validateSpec,style:z,styleSpec:g}):T[q]?f.validateSpec({key:q,value:l[q],valueSpec:T[q],validateSpec:f.validateSpec,style:z,styleSpec:g}):[new cn(q,l[q],`unknown property "${q}"`)])}return O}function Kd(f){const l=f.value,g=f.styleSpec,T=g.sky,z=f.style,O=Ua(l);if(l===void 0)return[];if(O!=="object")return[new cn("sky",l,`object expected, ${O} found`)];let B=[];for(const q in l)B=B.concat(T[q]?f.validateSpec({key:q,value:l[q],valueSpec:T[q],style:z,styleSpec:g}):[new cn(q,l[q],`unknown property "${q}"`)]);return B}function Zo(f){const l=f.value,g=f.styleSpec,T=g.terrain,z=f.style;let O=[];const B=Ua(l);if(l===void 0)return O;if(B!=="object")return O=O.concat([new cn("terrain",l,`object expected, ${B} found`)]),O;for(const q in l)O=O.concat(T[q]?f.validateSpec({key:q,value:l[q],valueSpec:T[q],validateSpec:f.validateSpec,style:z,styleSpec:g}):[new cn(q,l[q],`unknown property "${q}"`)]);return O}function Or(f){let l=[];const g=f.value,T=f.key;if(Array.isArray(g)){const z=[],O=[];for(const B in g)g[B].id&&z.includes(g[B].id)&&l.push(new cn(T,g,`all the sprites' ids must be unique, but ${g[B].id} is duplicated`)),z.push(g[B].id),g[B].url&&O.includes(g[B].url)&&l.push(new cn(T,g,`all the sprites' URLs must be unique, but ${g[B].url} is duplicated`)),O.push(g[B].url),l=l.concat(pi({key:`${T}[${B}]`,value:g[B],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:f.validateSpec}));return l}return Oc({key:T,value:g})}const Fh={"*":()=>[],array:kh,boolean:function(f){const l=f.value,g=f.key,T=Ua(l);return T!=="boolean"?[new cn(g,l,`boolean expected, ${T} found`)]:[]},number:gu,color:function(f){const l=f.key,g=f.value,T=Ua(g);return T!=="string"?[new cn(l,g,`color expected, ${T} found`)]:Ki.parse(String(g))?[]:[new cn(l,g,`color expected, "${g}" found`)]},constants:oh,enum:yl,filter:yu,function:hd,layer:Oh,object:pi,source:Wd,light:Yd,sky:Kd,terrain:Zo,projection:function(f){const l=f.value,g=f.styleSpec,T=g.projection,z=f.style,O=Ua(l);if(l===void 0)return[];if(O!=="object")return[new cn("projection",l,`object expected, ${O} found`)];let B=[];for(const q in l)B=B.concat(T[q]?f.validateSpec({key:q,value:l[q],valueSpec:T[q],style:z,styleSpec:g}):[new cn(q,l[q],`unknown property "${q}"`)]);return B},string:Oc,formatted:function(f){return Oc(f).length===0?[]:Bu(f)},resolvedImage:function(f){return Oc(f).length===0?[]:Bu(f)},padding:function(f){const l=f.key,g=f.value;if(Ua(g)==="array"){if(g.length<1||g.length>4)return[new cn(l,g,`padding requires 1 to 4 values; ${g.length} values found`)];const T={type:"number"};let z=[];for(let O=0;O<g.length;O++)z=z.concat(f.validateSpec({key:`${l}[${O}]`,value:g[O],validateSpec:f.validateSpec,valueSpec:T}));return z}return gu({key:l,value:g,valueSpec:{}})},variableAnchorOffsetCollection:function(f){const l=f.key,g=f.value,T=Ua(g),z=f.styleSpec;if(T!=="array"||g.length<1||g.length%2!=0)return[new cn(l,g,"variableAnchorOffsetCollection requires a non-empty array of even length")];let O=[];for(let B=0;B<g.length;B+=2)O=O.concat(yl({key:`${l}[${B}]`,value:g[B],valueSpec:z.layout_symbol["text-anchor"]})),O=O.concat(kh({key:`${l}[${B+1}]`,value:g[B+1],valueSpec:{length:2,value:"number"},validateSpec:f.validateSpec,style:f.style,styleSpec:z}));return O},sprite:Or};function dd(f){const l=f.value,g=f.valueSpec,T=f.styleSpec;return f.validateSpec=dd,g.expression&&uc(os(l))?hd(f):g.expression&&Lc(Ol(l))?Bu(f):g.type&&Fh[g.type]?Fh[g.type](f):pi(Ws({},f,{valueSpec:g.type?T[g.type]:g}))}function Jd(f){const l=f.value,g=f.key,T=Oc(f);return T.length||(l.indexOf("{fontstack}")===-1&&T.push(new cn(g,l,'"glyphs" url must include a "{fontstack}" token')),l.indexOf("{range}")===-1&&T.push(new cn(g,l,'"glyphs" url must include a "{range}" token'))),T}function Ao(f,l=Yt){let g=[];return g=g.concat(dd({key:"",value:f,valueSpec:l.$root,styleSpec:l,style:f,validateSpec:dd,objectElementValidators:{glyphs:Jd,"*":()=>[]}})),f.constants&&(g=g.concat(oh({key:"constants",value:f.constants}))),Ra(g)}function Xo(f){return function(l){return f({...l,validateSpec:dd})}}function Ra(f){return[].concat(f).sort(((l,g)=>l.line-g.line))}function sl(f){return function(...l){return Ra(f.apply(this,l))}}Ao.source=sl(Xo(Wd)),Ao.sprite=sl(Xo(Or)),Ao.glyphs=sl(Xo(Jd)),Ao.light=sl(Xo(Yd)),Ao.sky=sl(Xo(Kd)),Ao.terrain=sl(Xo(Zo)),Ao.layer=sl(Xo(Oh)),Ao.filter=sl(Xo(yu)),Ao.paintProperty=sl(Xo(vl)),Ao.layoutProperty=sl(Xo(Nu));const Bl=Ao,Vu=Bl.light,Rf=Bl.sky,Qd=Bl.paintProperty,lh=Bl.layoutProperty;function Nh(f,l){let g=!1;if(l&&l.length)for(const T of l)f.fire(new Aa(new Error(T.message))),g=!0;return g}class mo{constructor(l,g,T){const z=this.cells=[];if(l instanceof ArrayBuffer){this.arrayBuffer=l;const B=new Int32Array(this.arrayBuffer);l=B[0],this.d=(g=B[1])+2*(T=B[2]);for(let Z=0;Z<this.d*this.d;Z++){const re=B[3+Z],de=B[3+Z+1];z.push(re===de?null:B.subarray(re,de))}const q=B[3+z.length+1];this.keys=B.subarray(B[3+z.length],q),this.bboxes=B.subarray(q),this.insert=this._insertReadonly}else{this.d=g+2*T;for(let B=0;B<this.d*this.d;B++)z.push([]);this.keys=[],this.bboxes=[]}this.n=g,this.extent=l,this.padding=T,this.scale=g/l,this.uid=0;const O=T/g*l;this.min=-O,this.max=l+O}insert(l,g,T,z,O){this._forEachCell(g,T,z,O,this._insertCell,this.uid++,void 0,void 0),this.keys.push(l),this.bboxes.push(g),this.bboxes.push(T),this.bboxes.push(z),this.bboxes.push(O)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(l,g,T,z,O,B){this.cells[O].push(B)}query(l,g,T,z,O){const B=this.min,q=this.max;if(l<=B&&g<=B&&q<=T&&q<=z&&!O)return Array.prototype.slice.call(this.keys);{const Z=[];return this._forEachCell(l,g,T,z,this._queryCell,Z,{},O),Z}}_queryCell(l,g,T,z,O,B,q,Z){const re=this.cells[O];if(re!==null){const de=this.keys,ye=this.bboxes;for(let Ee=0;Ee<re.length;Ee++){const Le=re[Ee];if(q[Le]===void 0){const qe=4*Le;(Z?Z(ye[qe+0],ye[qe+1],ye[qe+2],ye[qe+3]):l<=ye[qe+2]&&g<=ye[qe+3]&&T>=ye[qe+0]&&z>=ye[qe+1])?(q[Le]=!0,B.push(de[Le])):q[Le]=!1}}}}_forEachCell(l,g,T,z,O,B,q,Z){const re=this._convertToCellCoord(l),de=this._convertToCellCoord(g),ye=this._convertToCellCoord(T),Ee=this._convertToCellCoord(z);for(let Le=re;Le<=ye;Le++)for(let qe=de;qe<=Ee;qe++){const Ke=this.d*qe+Le;if((!Z||Z(this._convertFromCellCoord(Le),this._convertFromCellCoord(qe),this._convertFromCellCoord(Le+1),this._convertFromCellCoord(qe+1)))&&O.call(this,l,g,T,z,Ke,B,q,Z))return}}_convertFromCellCoord(l){return(l-this.padding)/this.scale}_convertToCellCoord(l){return Math.max(0,Math.min(this.d-1,Math.floor(l*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const l=this.cells,g=3+this.cells.length+1+1;let T=0;for(let B=0;B<this.cells.length;B++)T+=this.cells[B].length;const z=new Int32Array(g+T+this.keys.length+this.bboxes.length);z[0]=this.extent,z[1]=this.n,z[2]=this.padding;let O=g;for(let B=0;B<l.length;B++){const q=l[B];z[3+B]=O,z.set(q,O),O+=q.length}return z[3+l.length]=O,z.set(this.keys,O),O+=this.keys.length,z[3+l.length+1]=O,z.set(this.bboxes,O),O+=this.bboxes.length,z.buffer}static serialize(l,g){const T=l.toArrayBuffer();return g&&g.push(T),{buffer:T}}static deserialize(l){return new mo(l.buffer)}}const ja={};function fn(f,l,g={}){if(ja[f])throw new Error(`${f} is already registered.`);Object.defineProperty(l,"_classRegistryKey",{value:f,writeable:!1}),ja[f]={klass:l,omit:g.omit||[],shallow:g.shallow||[]}}fn("Object",Object),fn("TransferableGridIndex",mo),fn("Color",Ki),fn("Error",Error),fn("AJAXError",Mr),fn("ResolvedImage",Ja),fn("StylePropertyFunction",ld),fn("StyleExpression",fu,{omit:["_evaluator"]}),fn("ZoomDependentExpression",Xc),fn("ZoomConstantExpression",pu),fn("CompoundExpression",Mo,{omit:["_evaluate"]});for(const f in Jl)Jl[f]._classRegistryKey||fn(`Expression_${f}`,Jl[f]);function Wc(f){return f&&typeof ArrayBuffer<"u"&&(f instanceof ArrayBuffer||f.constructor&&f.constructor.name==="ArrayBuffer")}function fc(f){return f.$name||f.constructor._classRegistryKey}function Vh(f){return!(function(l){if(l===null||typeof l!="object")return!1;const g=fc(l);return!(!g||g==="Object")})(f)&&(f==null||typeof f=="boolean"||typeof f=="number"||typeof f=="string"||f instanceof Boolean||f instanceof Number||f instanceof String||f instanceof Date||f instanceof RegExp||f instanceof Blob||f instanceof Error||Wc(f)||Si(f)||ArrayBuffer.isView(f)||f instanceof ImageData)}function Ql(f,l){if(Vh(f))return(Wc(f)||Si(f))&&l&&l.push(f),ArrayBuffer.isView(f)&&l&&l.push(f.buffer),f instanceof ImageData&&l&&l.push(f.data.buffer),f;if(Array.isArray(f)){const O=[];for(const B of f)O.push(Ql(B,l));return O}if(typeof f!="object")throw new Error("can't serialize object of type "+typeof f);const g=fc(f);if(!g)throw new Error(`can't serialize object of unregistered class ${f.constructor.name}`);if(!ja[g])throw new Error(`${g} is not registered.`);const{klass:T}=ja[g],z=T.serialize?T.serialize(f,l):{};if(T.serialize){if(l&&z===l[l.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const O in f){if(!f.hasOwnProperty(O)||ja[g].omit.indexOf(O)>=0)continue;const B=f[O];z[O]=ja[g].shallow.indexOf(O)>=0?B:Ql(B,l)}f instanceof Error&&(z.message=f.message)}if(z.$name)throw new Error("$name property is reserved for worker serialization logic.");return g!=="Object"&&(z.$name=g),z}function ch(f){if(Vh(f))return f;if(Array.isArray(f))return f.map(ch);if(typeof f!="object")throw new Error("can't deserialize object of type "+typeof f);const l=fc(f)||"Object";if(!ja[l])throw new Error(`can't deserialize unregistered class ${l}`);const{klass:g}=ja[l];if(!g)throw new Error(`can't deserialize unregistered class ${l}`);if(g.deserialize)return g.deserialize(f);const T=Object.create(g.prototype);for(const z of Object.keys(f)){if(z==="$name")continue;const O=f[z];T[z]=ja[l].shallow.indexOf(z)>=0?O:ch(O)}return T}class ef{constructor(){this.first=!0}update(l,g){const T=Math.floor(l);return this.first?(this.first=!1,this.lastIntegerZoom=T,this.lastIntegerZoomTime=0,this.lastZoom=l,this.lastFloorZoom=T,!0):(this.lastFloorZoom>T?(this.lastIntegerZoom=T+1,this.lastIntegerZoomTime=g):this.lastFloorZoom<T&&(this.lastIntegerZoom=T,this.lastIntegerZoomTime=g),l!==this.lastZoom&&(this.lastZoom=l,this.lastFloorZoom=T,!0))}}const Ia={"Latin-1 Supplement":f=>f>=128&&f<=255,"Hangul Jamo":f=>f>=4352&&f<=4607,Khmer:f=>f>=6016&&f<=6143,"General Punctuation":f=>f>=8192&&f<=8303,"Letterlike Symbols":f=>f>=8448&&f<=8527,"Number Forms":f=>f>=8528&&f<=8591,"Miscellaneous Technical":f=>f>=8960&&f<=9215,"Control Pictures":f=>f>=9216&&f<=9279,"Optical Character Recognition":f=>f>=9280&&f<=9311,"Enclosed Alphanumerics":f=>f>=9312&&f<=9471,"Geometric Shapes":f=>f>=9632&&f<=9727,"Miscellaneous Symbols":f=>f>=9728&&f<=9983,"Miscellaneous Symbols and Arrows":f=>f>=11008&&f<=11263,"Ideographic Description Characters":f=>f>=12272&&f<=12287,"CJK Symbols and Punctuation":f=>f>=12288&&f<=12351,Katakana:f=>f>=12448&&f<=12543,Kanbun:f=>f>=12688&&f<=12703,"CJK Strokes":f=>f>=12736&&f<=12783,"Enclosed CJK Letters and Months":f=>f>=12800&&f<=13055,"CJK Compatibility":f=>f>=13056&&f<=13311,"Yijing Hexagram Symbols":f=>f>=19904&&f<=19967,"Private Use Area":f=>f>=57344&&f<=63743,"Vertical Forms":f=>f>=65040&&f<=65055,"CJK Compatibility Forms":f=>f>=65072&&f<=65103,"Small Form Variants":f=>f>=65104&&f<=65135,"Halfwidth and Fullwidth Forms":f=>f>=65280&&f<=65519};function Yc(f){for(const l of f)if(uh(l.charCodeAt(0)))return!0;return!1}function tp(f){for(const l of f)if(!Fl(l.charCodeAt(0)))return!1;return!0}function fd(f){const l=f.map((g=>{try{return new RegExp(`\\p{sc=${g}}`,"u").source}catch{return null}})).filter((g=>g));return new RegExp(l.join("|"),"u")}const ip=fd(["Arab","Dupl","Mong","Ougr","Syrc"]);function Fl(f){return!ip.test(String.fromCodePoint(f))}const Uu=fd(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function uh(f){return!(f!==746&&f!==747&&(f<4352||!(Ia["CJK Compatibility Forms"](f)&&!(f>=65097&&f<=65103)||Ia["CJK Compatibility"](f)||Ia["CJK Strokes"](f)||!(!Ia["CJK Symbols and Punctuation"](f)||f>=12296&&f<=12305||f>=12308&&f<=12319||f===12336)||Ia["Enclosed CJK Letters and Months"](f)||Ia["Ideographic Description Characters"](f)||Ia.Kanbun(f)||Ia.Katakana(f)&&f!==12540||!(!Ia["Halfwidth and Fullwidth Forms"](f)||f===65288||f===65289||f===65293||f>=65306&&f<=65310||f===65339||f===65341||f===65343||f>=65371&&f<=65503||f===65507||f>=65512&&f<=65519)||!(!Ia["Small Form Variants"](f)||f>=65112&&f<=65118||f>=65123&&f<=65126)||Ia["Vertical Forms"](f)||Ia["Yijing Hexagram Symbols"](f)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(f))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(f))||Uu.test(String.fromCodePoint(f)))))}function hh(f){return!(uh(f)||(function(l){return!!(Ia["Latin-1 Supplement"](l)&&(l===167||l===169||l===174||l===177||l===188||l===189||l===190||l===215||l===247)||Ia["General Punctuation"](l)&&(l===8214||l===8224||l===8225||l===8240||l===8241||l===8251||l===8252||l===8258||l===8263||l===8264||l===8265||l===8273)||Ia["Letterlike Symbols"](l)||Ia["Number Forms"](l)||Ia["Miscellaneous Technical"](l)&&(l>=8960&&l<=8967||l>=8972&&l<=8991||l>=8996&&l<=9e3||l===9003||l>=9085&&l<=9114||l>=9150&&l<=9165||l===9167||l>=9169&&l<=9179||l>=9186&&l<=9215)||Ia["Control Pictures"](l)&&l!==9251||Ia["Optical Character Recognition"](l)||Ia["Enclosed Alphanumerics"](l)||Ia["Geometric Shapes"](l)||Ia["Miscellaneous Symbols"](l)&&!(l>=9754&&l<=9759)||Ia["Miscellaneous Symbols and Arrows"](l)&&(l>=11026&&l<=11055||l>=11088&&l<=11097||l>=11192&&l<=11243)||Ia["CJK Symbols and Punctuation"](l)||Ia.Katakana(l)||Ia["Private Use Area"](l)||Ia["CJK Compatibility Forms"](l)||Ia["Small Form Variants"](l)||Ia["Halfwidth and Fullwidth Forms"](l)||l===8734||l===8756||l===8757||l>=9984&&l<=10087||l>=10102&&l<=10131||l===65532||l===65533)})(f))}const zp=fd(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function zd(f){return zp.test(String.fromCodePoint(f))}function pd(f,l){return!(!l&&zd(f)||f>=2304&&f<=3583||f>=3840&&f<=4255||Ia.Khmer(f))}function tf(f){for(const l of f)if(zd(l.charCodeAt(0)))return!0;return!1}const Wo=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(f){this.pluginStatus=f.pluginStatus,this.pluginURL=f.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(f){this.applyArabicShaping=f.applyArabicShaping,this.processBidirectionalText=f.processBidirectionalText,this.processStyledBidirectionalText=f.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ka{constructor(l,g){this.zoom=l,g?(this.now=g.now,this.fadeDuration=g.fadeDuration,this.zoomHistory=g.zoomHistory,this.transition=g.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new ef,this.transition={})}isSupportedScript(l){return(function(g,T){for(const z of g)if(!pd(z.charCodeAt(0),T))return!1;return!0})(l,Wo.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const l=this.zoom,g=l-Math.floor(l),T=this.crossFadingFactor();return l>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:g+(1-g)*T}:{fromScale:.5,toScale:1,t:1-(1-T)*g}}}class xu{constructor(l,g){this.property=l,this.value=g,this.expression=(function(T,z){if(uc(T))return new ld(T,z);if(Lc(T)){const O=Cf(T,z);if(O.result==="error")throw new Error(O.value.map((B=>`${B.key}: ${B.message}`)).join(", "));return O.value}{let O=T;return z.type==="color"&&typeof T=="string"?O=Ki.parse(T):z.type!=="padding"||typeof T!="number"&&!Array.isArray(T)?z.type==="variableAnchorOffsetCollection"&&Array.isArray(T)&&(O=La.parse(T)):O=Nn.parse(T),{kind:"constant",evaluate:()=>O}}})(g===void 0?l.specification.default:g,l.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(l,g,T){return this.property.possiblyEvaluate(this,l,g,T)}}class md{constructor(l){this.property=l,this.value=new xu(l,void 0)}transitioned(l,g){return new nf(this.property,this.value,g,qi({},l.transition,this.transition),l.now)}untransitioned(){return new nf(this.property,this.value,null,{},0)}}class Uh{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitionablePropertyValues)}getValue(l){return dn(this._values[l].value.value)}setValue(l,g){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new md(this._values[l].property)),this._values[l].value=new xu(this._values[l].property,g===null?void 0:dn(g))}getTransition(l){return dn(this._values[l].transition)}setTransition(l,g){Object.prototype.hasOwnProperty.call(this._values,l)||(this._values[l]=new md(this._values[l].property)),this._values[l].transition=dn(g)||void 0}serialize(){const l={};for(const g of Object.keys(this._values)){const T=this.getValue(g);T!==void 0&&(l[g]=T);const z=this.getTransition(g);z!==void 0&&(l[`${g}-transition`]=z)}return l}transitioned(l,g){const T=new rf(this._properties);for(const z of Object.keys(this._values))T._values[z]=this._values[z].transitioned(l,g._values[z]);return T}untransitioned(){const l=new rf(this._properties);for(const g of Object.keys(this._values))l._values[g]=this._values[g].untransitioned();return l}}class nf{constructor(l,g,T,z,O){this.property=l,this.value=g,this.begin=O+z.delay||0,this.end=this.begin+z.duration||0,l.specification.transition&&(z.delay||z.duration)&&(this.prior=T)}possiblyEvaluate(l,g,T){const z=l.now||0,O=this.value.possiblyEvaluate(l,g,T),B=this.prior;if(B){if(z>this.end)return this.prior=null,O;if(this.value.isDataDriven())return this.prior=null,O;if(z<this.begin)return B.possiblyEvaluate(l,g,T);{const q=(z-this.begin)/(this.end-this.begin);return this.property.interpolate(B.possiblyEvaluate(l,g,T),O,(function(Z){if(Z<=0)return 0;if(Z>=1)return 1;const re=Z*Z,de=re*Z;return 4*(Z<.5?de:3*(Z-re)+de-.75)})(q))}}return O}}class rf{constructor(l){this._properties=l,this._values=Object.create(l.defaultTransitioningPropertyValues)}possiblyEvaluate(l,g,T){const z=new Kc(this._properties);for(const O of Object.keys(this._values))z._values[O]=this._values[O].possiblyEvaluate(l,g,T);return z}hasTransition(){for(const l of Object.keys(this._values))if(this._values[l].prior)return!0;return!1}}class ls{constructor(l){this._properties=l,this._values=Object.create(l.defaultPropertyValues)}hasValue(l){return this._values[l].value!==void 0}getValue(l){return dn(this._values[l].value)}setValue(l,g){this._values[l]=new xu(this._values[l].property,g===null?void 0:dn(g))}serialize(){const l={};for(const g of Object.keys(this._values)){const T=this.getValue(g);T!==void 0&&(l[g]=T)}return l}possiblyEvaluate(l,g,T){const z=new Kc(this._properties);for(const O of Object.keys(this._values))z._values[O]=this._values[O].possiblyEvaluate(l,g,T);return z}}class pc{constructor(l,g,T){this.property=l,this.value=g,this.parameters=T}isConstant(){return this.value.kind==="constant"}constantOr(l){return this.value.kind==="constant"?this.value.value:l}evaluate(l,g,T,z){return this.property.evaluate(this.value,this.parameters,l,g,T,z)}}class Kc{constructor(l){this._properties=l,this._values=Object.create(l.defaultPossiblyEvaluatedValues)}get(l){return this._values[l]}}class Xn{constructor(l){this.specification=l}possiblyEvaluate(l,g){if(l.isDataDriven())throw new Error("Value should not be data driven");return l.expression.evaluate(g)}interpolate(l,g,T){const z=Po[this.specification.type];return z?z(l,g,T):l}}class Pr{constructor(l,g){this.specification=l,this.overrides=g}possiblyEvaluate(l,g,T,z){return new pc(this,l.expression.kind==="constant"||l.expression.kind==="camera"?{kind:"constant",value:l.expression.evaluate(g,null,{},T,z)}:l.expression,g)}interpolate(l,g,T){if(l.value.kind!=="constant"||g.value.kind!=="constant")return l;if(l.value.value===void 0||g.value.value===void 0)return new pc(this,{kind:"constant",value:void 0},l.parameters);const z=Po[this.specification.type];if(z){const O=z(l.value.value,g.value.value,T);return new pc(this,{kind:"constant",value:O},l.parameters)}return l}evaluate(l,g,T,z,O,B){return l.kind==="constant"?l.value:l.evaluate(g,T,z,O,B)}}class vu extends Pr{possiblyEvaluate(l,g,T,z){if(l.value===void 0)return new pc(this,{kind:"constant",value:void 0},g);if(l.expression.kind==="constant"){const O=l.expression.evaluate(g,null,{},T,z),B=l.property.specification.type==="resolvedImage"&&typeof O!="string"?O.name:O,q=this._calculate(B,B,B,g);return new pc(this,{kind:"constant",value:q},g)}if(l.expression.kind==="camera"){const O=this._calculate(l.expression.evaluate({zoom:g.zoom-1}),l.expression.evaluate({zoom:g.zoom}),l.expression.evaluate({zoom:g.zoom+1}),g);return new pc(this,{kind:"constant",value:O},g)}return new pc(this,l.expression,g)}evaluate(l,g,T,z,O,B){if(l.kind==="source"){const q=l.evaluate(g,T,z,O,B);return this._calculate(q,q,q,g)}return l.kind==="composite"?this._calculate(l.evaluate({zoom:Math.floor(g.zoom)-1},T,z),l.evaluate({zoom:Math.floor(g.zoom)},T,z),l.evaluate({zoom:Math.floor(g.zoom)+1},T,z),g):l.value}_calculate(l,g,T,z){return z.zoom>z.zoomHistory.lastIntegerZoom?{from:l,to:g}:{from:T,to:g}}interpolate(l){return l}}class ju{constructor(l){this.specification=l}possiblyEvaluate(l,g,T,z){if(l.value!==void 0){if(l.expression.kind==="constant"){const O=l.expression.evaluate(g,null,{},T,z);return this._calculate(O,O,O,g)}return this._calculate(l.expression.evaluate(new ka(Math.floor(g.zoom-1),g)),l.expression.evaluate(new ka(Math.floor(g.zoom),g)),l.expression.evaluate(new ka(Math.floor(g.zoom+1),g)),g)}}_calculate(l,g,T,z){return z.zoom>z.zoomHistory.lastIntegerZoom?{from:l,to:g}:{from:T,to:g}}interpolate(l){return l}}class _d{constructor(l){this.specification=l}possiblyEvaluate(l,g,T,z){return!!l.expression.evaluate(g,null,{},T,z)}interpolate(){return!1}}class L{constructor(l){this.properties=l,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const g in l){const T=l[g];T.specification.overridable&&this.overridableProperties.push(g);const z=this.defaultPropertyValues[g]=new xu(T,void 0),O=this.defaultTransitionablePropertyValues[g]=new md(T);this.defaultTransitioningPropertyValues[g]=O.untransitioned(),this.defaultPossiblyEvaluatedValues[g]=z.possiblyEvaluate({})}}}fn("DataDrivenProperty",Pr),fn("DataConstantProperty",Xn),fn("CrossFadedDataDrivenProperty",vu),fn("CrossFadedProperty",ju),fn("ColorRampProperty",_d);const o="-transition";class x extends Da{constructor(l,g){if(super(),this.id=l.id,this.type=l.type,this._featureFilter={filter:()=>!0,needGeometry:!1},l.type!=="custom"&&(this.metadata=l.metadata,this.minzoom=l.minzoom,this.maxzoom=l.maxzoom,l.type!=="background"&&(this.source=l.source,this.sourceLayer=l["source-layer"],this.filter=l.filter),g.layout&&(this._unevaluatedLayout=new ls(g.layout)),g.paint)){this._transitionablePaint=new Uh(g.paint);for(const T in l.paint)this.setPaintProperty(T,l.paint[T],{validate:!1});for(const T in l.layout)this.setLayoutProperty(T,l.layout[T],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Kc(g.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(l){return l==="visibility"?this.visibility:this._unevaluatedLayout.getValue(l)}setLayoutProperty(l,g,T={}){g!=null&&this._validate(lh,`layers.${this.id}.layout.${l}`,l,g,T)||(l!=="visibility"?this._unevaluatedLayout.setValue(l,g):this.visibility=g)}getPaintProperty(l){return l.endsWith(o)?this._transitionablePaint.getTransition(l.slice(0,-11)):this._transitionablePaint.getValue(l)}setPaintProperty(l,g,T={}){if(g!=null&&this._validate(Qd,`layers.${this.id}.paint.${l}`,l,g,T))return!1;if(l.endsWith(o))return this._transitionablePaint.setTransition(l.slice(0,-11),g||void 0),!1;{const z=this._transitionablePaint._values[l],O=z.property.specification["property-type"]==="cross-faded-data-driven",B=z.value.isDataDriven(),q=z.value;this._transitionablePaint.setValue(l,g),this._handleSpecialPaintPropertyUpdate(l);const Z=this._transitionablePaint._values[l].value;return Z.isDataDriven()||B||O||this._handleOverridablePaintPropertyUpdate(l,q,Z)}}_handleSpecialPaintPropertyUpdate(l){}_handleOverridablePaintPropertyUpdate(l,g,T){return!1}isHidden(l){return!!(this.minzoom&&l<this.minzoom)||!!(this.maxzoom&&l>=this.maxzoom)||this.visibility==="none"}updateTransitions(l){this._transitioningPaint=this._transitionablePaint.transitioned(l,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(l,g){l.getCrossfadeParameters&&(this._crossfadeParameters=l.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(l,void 0,g)),this.paint=this._transitioningPaint.possiblyEvaluate(l,void 0,g)}serialize(){const l={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(l.layout=l.layout||{},l.layout.visibility=this.visibility),Hi(l,((g,T)=>!(g===void 0||T==="layout"&&!Object.keys(g).length||T==="paint"&&!Object.keys(g).length)))}_validate(l,g,T,z,O={}){return(!O||O.validate!==!1)&&Nh(this,l.call(Bl,{key:g,layerType:this.type,objectKey:T,value:z,styleSpec:Yt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const l in this.paint._values){const g=this.paint.get(l);if(g instanceof pc&&$o(g.property.specification)&&(g.value.kind==="source"||g.value.kind==="composite")&&g.value.isStateDependent)return!0}return!1}}const A={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class I{constructor(l,g){this._structArray=l,this._pos1=g*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class P{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(l,g){return l._trim(),g&&(l.isTransferred=!0,g.push(l.arrayBuffer)),{length:l.length,arrayBuffer:l.arrayBuffer}}static deserialize(l){const g=Object.create(this.prototype);return g.arrayBuffer=l.arrayBuffer,g.length=l.length,g.capacity=l.arrayBuffer.byteLength/g.bytesPerElement,g._refreshViews(),g}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(l){this.reserve(l),this.length=l}reserve(l){if(l>this.capacity){this.capacity=Math.max(l,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const g=this.uint8;this._refreshViews(),g&&this.uint8.set(g)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function H(f,l=1){let g=0,T=0;return{members:f.map((z=>{const O=A[z.type].BYTES_PER_ELEMENT,B=g=K(g,Math.max(l,O)),q=z.components||1;return T=Math.max(T,O),g+=O*q,{name:z.name,type:z.type,components:q,offset:B}})),size:K(g,Math.max(T,l)),alignment:l}}function K(f,l){return Math.ceil(f/l)*l}class ne extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g){const T=this.length;return this.resize(T+1),this.emplace(T,l,g)}emplace(l,g,T){const z=2*l;return this.int16[z+0]=g,this.int16[z+1]=T,l}}ne.prototype.bytesPerElement=4,fn("StructArrayLayout2i4",ne);class he extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const O=3*l;return this.int16[O+0]=g,this.int16[O+1]=T,this.int16[O+2]=z,l}}he.prototype.bytesPerElement=6,fn("StructArrayLayout3i6",he);class be extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z){const O=this.length;return this.resize(O+1),this.emplace(O,l,g,T,z)}emplace(l,g,T,z,O){const B=4*l;return this.int16[B+0]=g,this.int16[B+1]=T,this.int16[B+2]=z,this.int16[B+3]=O,l}}be.prototype.bytesPerElement=8,fn("StructArrayLayout4i8",be);class we extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B){const q=this.length;return this.resize(q+1),this.emplace(q,l,g,T,z,O,B)}emplace(l,g,T,z,O,B,q){const Z=6*l;return this.int16[Z+0]=g,this.int16[Z+1]=T,this.int16[Z+2]=z,this.int16[Z+3]=O,this.int16[Z+4]=B,this.int16[Z+5]=q,l}}we.prototype.bytesPerElement=12,fn("StructArrayLayout2i4i12",we);class Be extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B){const q=this.length;return this.resize(q+1),this.emplace(q,l,g,T,z,O,B)}emplace(l,g,T,z,O,B,q){const Z=4*l,re=8*l;return this.int16[Z+0]=g,this.int16[Z+1]=T,this.uint8[re+4]=z,this.uint8[re+5]=O,this.uint8[re+6]=B,this.uint8[re+7]=q,l}}Be.prototype.bytesPerElement=8,fn("StructArrayLayout2i4ub8",Be);class Ye extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g){const T=this.length;return this.resize(T+1),this.emplace(T,l,g)}emplace(l,g,T){const z=2*l;return this.float32[z+0]=g,this.float32[z+1]=T,l}}Ye.prototype.bytesPerElement=8,fn("StructArrayLayout2f8",Ye);class st extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B,q,Z,re,de){const ye=this.length;return this.resize(ye+1),this.emplace(ye,l,g,T,z,O,B,q,Z,re,de)}emplace(l,g,T,z,O,B,q,Z,re,de,ye){const Ee=10*l;return this.uint16[Ee+0]=g,this.uint16[Ee+1]=T,this.uint16[Ee+2]=z,this.uint16[Ee+3]=O,this.uint16[Ee+4]=B,this.uint16[Ee+5]=q,this.uint16[Ee+6]=Z,this.uint16[Ee+7]=re,this.uint16[Ee+8]=de,this.uint16[Ee+9]=ye,l}}st.prototype.bytesPerElement=20,fn("StructArrayLayout10ui20",st);class vt extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B,q,Z,re,de,ye,Ee){const Le=this.length;return this.resize(Le+1),this.emplace(Le,l,g,T,z,O,B,q,Z,re,de,ye,Ee)}emplace(l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le){const qe=12*l;return this.int16[qe+0]=g,this.int16[qe+1]=T,this.int16[qe+2]=z,this.int16[qe+3]=O,this.uint16[qe+4]=B,this.uint16[qe+5]=q,this.uint16[qe+6]=Z,this.uint16[qe+7]=re,this.int16[qe+8]=de,this.int16[qe+9]=ye,this.int16[qe+10]=Ee,this.int16[qe+11]=Le,l}}vt.prototype.bytesPerElement=24,fn("StructArrayLayout4i4ui4i24",vt);class Et extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const O=3*l;return this.float32[O+0]=g,this.float32[O+1]=T,this.float32[O+2]=z,l}}Et.prototype.bytesPerElement=12,fn("StructArrayLayout3f12",Et);class Ct extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(l){const g=this.length;return this.resize(g+1),this.emplace(g,l)}emplace(l,g){return this.uint32[1*l+0]=g,l}}Ct.prototype.bytesPerElement=4,fn("StructArrayLayout1ul4",Ct);class Lt extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B,q,Z,re){const de=this.length;return this.resize(de+1),this.emplace(de,l,g,T,z,O,B,q,Z,re)}emplace(l,g,T,z,O,B,q,Z,re,de){const ye=10*l,Ee=5*l;return this.int16[ye+0]=g,this.int16[ye+1]=T,this.int16[ye+2]=z,this.int16[ye+3]=O,this.int16[ye+4]=B,this.int16[ye+5]=q,this.uint32[Ee+3]=Z,this.uint16[ye+8]=re,this.uint16[ye+9]=de,l}}Lt.prototype.bytesPerElement=20,fn("StructArrayLayout6i1ul2ui20",Lt);class _t extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B){const q=this.length;return this.resize(q+1),this.emplace(q,l,g,T,z,O,B)}emplace(l,g,T,z,O,B,q){const Z=6*l;return this.int16[Z+0]=g,this.int16[Z+1]=T,this.int16[Z+2]=z,this.int16[Z+3]=O,this.int16[Z+4]=B,this.int16[Z+5]=q,l}}_t.prototype.bytesPerElement=12,fn("StructArrayLayout2i2i2i12",_t);class Ht extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O){const B=this.length;return this.resize(B+1),this.emplace(B,l,g,T,z,O)}emplace(l,g,T,z,O,B){const q=4*l,Z=8*l;return this.float32[q+0]=g,this.float32[q+1]=T,this.float32[q+2]=z,this.int16[Z+6]=O,this.int16[Z+7]=B,l}}Ht.prototype.bytesPerElement=16,fn("StructArrayLayout2f1f2i16",Ht);class Qt extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B){const q=this.length;return this.resize(q+1),this.emplace(q,l,g,T,z,O,B)}emplace(l,g,T,z,O,B,q){const Z=16*l,re=4*l,de=8*l;return this.uint8[Z+0]=g,this.uint8[Z+1]=T,this.float32[re+1]=z,this.float32[re+2]=O,this.int16[de+6]=B,this.int16[de+7]=q,l}}Qt.prototype.bytesPerElement=16,fn("StructArrayLayout2ub2f2i16",Qt);class oi extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const O=3*l;return this.uint16[O+0]=g,this.uint16[O+1]=T,this.uint16[O+2]=z,l}}oi.prototype.bytesPerElement=6,fn("StructArrayLayout3ui6",oi);class $i extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le,qe,Ke,yt,Mt){const si=this.length;return this.resize(si+1),this.emplace(si,l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le,qe,Ke,yt,Mt)}emplace(l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le,qe,Ke,yt,Mt,si){const Ut=24*l,ii=12*l,Pi=48*l;return this.int16[Ut+0]=g,this.int16[Ut+1]=T,this.uint16[Ut+2]=z,this.uint16[Ut+3]=O,this.uint32[ii+2]=B,this.uint32[ii+3]=q,this.uint32[ii+4]=Z,this.uint16[Ut+10]=re,this.uint16[Ut+11]=de,this.uint16[Ut+12]=ye,this.float32[ii+7]=Ee,this.float32[ii+8]=Le,this.uint8[Pi+36]=qe,this.uint8[Pi+37]=Ke,this.uint8[Pi+38]=yt,this.uint32[ii+10]=Mt,this.int16[Ut+22]=si,l}}$i.prototype.bytesPerElement=48,fn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",$i);class An extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le,qe,Ke,yt,Mt,si,Ut,ii,Pi,gn,Wn,Er,Fn,In,xr,or){const nr=this.length;return this.resize(nr+1),this.emplace(nr,l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le,qe,Ke,yt,Mt,si,Ut,ii,Pi,gn,Wn,Er,Fn,In,xr,or)}emplace(l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le,qe,Ke,yt,Mt,si,Ut,ii,Pi,gn,Wn,Er,Fn,In,xr,or,nr){const Gi=32*l,sr=16*l;return this.int16[Gi+0]=g,this.int16[Gi+1]=T,this.int16[Gi+2]=z,this.int16[Gi+3]=O,this.int16[Gi+4]=B,this.int16[Gi+5]=q,this.int16[Gi+6]=Z,this.int16[Gi+7]=re,this.uint16[Gi+8]=de,this.uint16[Gi+9]=ye,this.uint16[Gi+10]=Ee,this.uint16[Gi+11]=Le,this.uint16[Gi+12]=qe,this.uint16[Gi+13]=Ke,this.uint16[Gi+14]=yt,this.uint16[Gi+15]=Mt,this.uint16[Gi+16]=si,this.uint16[Gi+17]=Ut,this.uint16[Gi+18]=ii,this.uint16[Gi+19]=Pi,this.uint16[Gi+20]=gn,this.uint16[Gi+21]=Wn,this.uint16[Gi+22]=Er,this.uint32[sr+12]=Fn,this.float32[sr+13]=In,this.float32[sr+14]=xr,this.uint16[Gi+30]=or,this.uint16[Gi+31]=nr,l}}An.prototype.bytesPerElement=64,fn("StructArrayLayout8i15ui1ul2f2ui64",An);class Mn extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l){const g=this.length;return this.resize(g+1),this.emplace(g,l)}emplace(l,g){return this.float32[1*l+0]=g,l}}Mn.prototype.bytesPerElement=4,fn("StructArrayLayout1f4",Mn);class Zn extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const O=3*l;return this.uint16[6*l+0]=g,this.float32[O+1]=T,this.float32[O+2]=z,l}}Zn.prototype.bytesPerElement=12,fn("StructArrayLayout1ui2f12",Zn);class Ln extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g,T){const z=this.length;return this.resize(z+1),this.emplace(z,l,g,T)}emplace(l,g,T,z){const O=4*l;return this.uint32[2*l+0]=g,this.uint16[O+2]=T,this.uint16[O+3]=z,l}}Ln.prototype.bytesPerElement=8,fn("StructArrayLayout1ul2ui8",Ln);class zn extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l,g){const T=this.length;return this.resize(T+1),this.emplace(T,l,g)}emplace(l,g,T){const z=2*l;return this.uint16[z+0]=g,this.uint16[z+1]=T,l}}zn.prototype.bytesPerElement=4,fn("StructArrayLayout2ui4",zn);class ir extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(l){const g=this.length;return this.resize(g+1),this.emplace(g,l)}emplace(l,g){return this.uint16[1*l+0]=g,l}}ir.prototype.bytesPerElement=2,fn("StructArrayLayout1ui2",ir);class $r extends P{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(l,g,T,z){const O=this.length;return this.resize(O+1),this.emplace(O,l,g,T,z)}emplace(l,g,T,z,O){const B=4*l;return this.float32[B+0]=g,this.float32[B+1]=T,this.float32[B+2]=z,this.float32[B+3]=O,l}}$r.prototype.bytesPerElement=16,fn("StructArrayLayout4f16",$r);class On extends I{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ut(this.anchorPointX,this.anchorPointY)}}On.prototype.size=20;class qn extends Lt{get(l){return new On(this,l)}}fn("CollisionBoxArray",qn);class Yr extends I{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(l){this._structArray.uint8[this._pos1+37]=l}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(l){this._structArray.uint8[this._pos1+38]=l}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(l){this._structArray.uint32[this._pos4+10]=l}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Yr.prototype.size=48;class Qa extends $i{get(l){return new Yr(this,l)}}fn("PlacedSymbolArray",Qa);class Ma extends I{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(l){this._structArray.uint32[this._pos4+12]=l}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}Ma.prototype.size=64;class Za extends An{get(l){return new Ma(this,l)}}fn("SymbolInstanceArray",Za);class Ls extends Mn{getoffsetX(l){return this.float32[1*l+0]}}fn("GlyphOffsetArray",Ls);class ol extends he{getx(l){return this.int16[3*l+0]}gety(l){return this.int16[3*l+1]}gettileUnitDistanceFromAnchor(l){return this.int16[3*l+2]}}fn("SymbolLineVertexArray",ol);class mc extends I{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}mc.prototype.size=12;class ks extends Zn{get(l){return new mc(this,l)}}fn("TextAnchorOffsetArray",ks);class Lo extends I{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}Lo.prototype.size=8;class Os extends Ln{get(l){return new Lo(this,l)}}fn("FeatureIndexArray",Os);class Ms extends ne{}class Co extends ne{}class _c extends ne{}class Nl extends we{}class Jc extends Be{}class hl extends Ye{}class Cs extends st{}class bu extends vt{}class Vl extends Et{}class di extends Ct{}class Oa extends _t{}class fs extends Qt{}class Yo extends oi{}class mn extends zn{}const _o=H([{name:"a_pos",components:2,type:"Int16"}],4),{members:bl}=_o;class Ba{constructor(l=[]){this.segments=l}prepareSegment(l,g,T,z){let O=this.segments[this.segments.length-1];return l>Ba.MAX_VERTEX_ARRAY_LENGTH&&an(`Max vertices per segment is ${Ba.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${l}`),(!O||O.vertexLength+l>Ba.MAX_VERTEX_ARRAY_LENGTH||O.sortKey!==z)&&(O={vertexOffset:g.length,primitiveOffset:T.length,vertexLength:0,primitiveLength:0},z!==void 0&&(O.sortKey=z),this.segments.push(O)),O}get(){return this.segments}destroy(){for(const l of this.segments)for(const g in l.vaos)l.vaos[g].destroy()}static simpleSegment(l,g,T,z){return new Ba([{vertexOffset:l,primitiveOffset:g,vertexLength:T,primitiveLength:z,vaos:{},sortKey:0}])}}function gc(f,l){return 256*(f=Oi(Math.floor(f),0,255))+Oi(Math.floor(l),0,255)}Ba.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,fn("SegmentVector",Ba);const jh=H([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var $s={exports:{}},af={exports:{}};af.exports=function(f,l){var g,T,z,O,B,q,Z,re;for(T=f.length-(g=3&f.length),z=l,B=3432918353,q=461845907,re=0;re<T;)Z=255&f.charCodeAt(re)|(255&f.charCodeAt(++re))<<8|(255&f.charCodeAt(++re))<<16|(255&f.charCodeAt(++re))<<24,++re,z=27492+(65535&(O=5*(65535&(z=(z^=Z=(65535&(Z=(Z=(65535&Z)*B+(((Z>>>16)*B&65535)<<16)&4294967295)<<15|Z>>>17))*q+(((Z>>>16)*q&65535)<<16)&4294967295)<<13|z>>>19))+((5*(z>>>16)&65535)<<16)&4294967295))+((58964+(O>>>16)&65535)<<16);switch(Z=0,g){case 3:Z^=(255&f.charCodeAt(re+2))<<16;case 2:Z^=(255&f.charCodeAt(re+1))<<8;case 1:z^=Z=(65535&(Z=(Z=(65535&(Z^=255&f.charCodeAt(re)))*B+(((Z>>>16)*B&65535)<<16)&4294967295)<<15|Z>>>17))*q+(((Z>>>16)*q&65535)<<16)&4294967295}return z^=f.length,z=2246822507*(65535&(z^=z>>>16))+((2246822507*(z>>>16)&65535)<<16)&4294967295,z=3266489909*(65535&(z^=z>>>13))+((3266489909*(z>>>16)&65535)<<16)&4294967295,(z^=z>>>16)>>>0};var Gu=af.exports,Dp={exports:{}};Dp.exports=function(f,l){for(var g,T=f.length,z=l^T,O=0;T>=4;)g=1540483477*(65535&(g=255&f.charCodeAt(O)|(255&f.charCodeAt(++O))<<8|(255&f.charCodeAt(++O))<<16|(255&f.charCodeAt(++O))<<24))+((1540483477*(g>>>16)&65535)<<16),z=1540483477*(65535&z)+((1540483477*(z>>>16)&65535)<<16)^(g=1540483477*(65535&(g^=g>>>24))+((1540483477*(g>>>16)&65535)<<16)),T-=4,++O;switch(T){case 3:z^=(255&f.charCodeAt(O+2))<<16;case 2:z^=(255&f.charCodeAt(O+1))<<8;case 1:z=1540483477*(65535&(z^=255&f.charCodeAt(O)))+((1540483477*(z>>>16)&65535)<<16)}return z=1540483477*(65535&(z^=z>>>13))+((1540483477*(z>>>16)&65535)<<16),(z^=z>>>15)>>>0};var qo=Gu,np=Dp.exports;$s.exports=qo,$s.exports.murmur3=qo,$s.exports.murmur2=np;var Ko=tt($s.exports);class yc{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(l,g,T,z){this.ids.push(dh(l)),this.positions.push(g,T,z)}getPositions(l){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const g=dh(l);let T=0,z=this.ids.length-1;for(;T<z;){const B=T+z>>1;this.ids[B]>=g?z=B:T=B+1}const O=[];for(;this.ids[T]===g;)O.push({index:this.positions[3*T],start:this.positions[3*T+1],end:this.positions[3*T+2]}),T++;return O}static serialize(l,g){const T=new Float64Array(l.ids),z=new Uint32Array(l.positions);return Jo(T,z,0,T.length-1),g&&g.push(T.buffer,z.buffer),{ids:T,positions:z}}static deserialize(l){const g=new yc;return g.ids=l.ids,g.positions=l.positions,g.indexed=!0,g}}function dh(f){const l=+f;return!isNaN(l)&&l<=Number.MAX_SAFE_INTEGER?l:Ko(String(f))}function Jo(f,l,g,T){for(;g<T;){const z=f[g+T>>1];let O=g-1,B=T+1;for(;;){do O++;while(f[O]<z);do B--;while(f[B]>z);if(O>=B)break;Qs(f,O,B),Qs(l,3*O,3*B),Qs(l,3*O+1,3*B+1),Qs(l,3*O+2,3*B+2)}B-g<T-B?(Jo(f,l,g,B),g=B+1):(Jo(f,l,B+1,T),T=B)}}function Qs(f,l,g){const T=f[l];f[l]=f[g],f[g]=T}fn("FeaturePositionMap",yc);class wu{constructor(l,g){this.gl=l.gl,this.location=g}}class Dd extends wu{constructor(l,g){super(l,g),this.current=0}set(l){this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class qu extends wu{constructor(l,g){super(l,g),this.current=[0,0,0,0]}set(l){l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3]))}}class Xa extends wu{constructor(l,g){super(l,g),this.current=Ki.transparent}set(l){l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a))}}const fh=new Float32Array(16);function sf(f){return[gc(255*f.r,255*f.g),gc(255*f.b,255*f.a)]}class of{constructor(l,g,T){this.value=l,this.uniformNames=g.map((z=>`u_${z}`)),this.type=T}setUniform(l,g,T){l.set(T.constantOr(this.value))}getBinding(l,g,T){return this.type==="color"?new Xa(l,g):new Dd(l,g)}}class Rd{constructor(l,g){this.uniformNames=g.map((T=>`u_${T}`)),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(l,g){this.pixelRatioFrom=g.pixelRatio,this.pixelRatioTo=l.pixelRatio,this.patternFrom=g.tlbr,this.patternTo=l.tlbr}setUniform(l,g,T,z){const O=z==="u_pattern_to"?this.patternTo:z==="u_pattern_from"?this.patternFrom:z==="u_pixel_ratio_to"?this.pixelRatioTo:z==="u_pixel_ratio_from"?this.pixelRatioFrom:null;O&&l.set(O)}getBinding(l,g,T){return T.substr(0,9)==="u_pattern"?new qu(l,g):new Dd(l,g)}}class Gh{constructor(l,g,T,z){this.expression=l,this.type=T,this.maxValue=0,this.paintVertexAttributes=g.map((O=>({name:`a_${O}`,type:"Float32",components:T==="color"?2:1,offset:0}))),this.paintVertexArray=new z}populatePaintArray(l,g,T,z,O){const B=this.paintVertexArray.length,q=this.expression.evaluate(new ka(0),g,{},z,[],O);this.paintVertexArray.resize(l),this._setPaintValue(B,l,q)}updatePaintArray(l,g,T,z){const O=this.expression.evaluate({zoom:0},T,z);this._setPaintValue(l,g,O)}_setPaintValue(l,g,T){if(this.type==="color"){const z=sf(T);for(let O=l;O<g;O++)this.paintVertexArray.emplace(O,z[0],z[1])}else{for(let z=l;z<g;z++)this.paintVertexArray.emplace(z,T);this.maxValue=Math.max(this.maxValue,Math.abs(T))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Hu{constructor(l,g,T,z,O,B){this.expression=l,this.uniformNames=g.map((q=>`u_${q}_t`)),this.type=T,this.useIntegerZoom=z,this.zoom=O,this.maxValue=0,this.paintVertexAttributes=g.map((q=>({name:`a_${q}`,type:"Float32",components:T==="color"?4:2,offset:0}))),this.paintVertexArray=new B}populatePaintArray(l,g,T,z,O){const B=this.expression.evaluate(new ka(this.zoom),g,{},z,[],O),q=this.expression.evaluate(new ka(this.zoom+1),g,{},z,[],O),Z=this.paintVertexArray.length;this.paintVertexArray.resize(l),this._setPaintValue(Z,l,B,q)}updatePaintArray(l,g,T,z){const O=this.expression.evaluate({zoom:this.zoom},T,z),B=this.expression.evaluate({zoom:this.zoom+1},T,z);this._setPaintValue(l,g,O,B)}_setPaintValue(l,g,T,z){if(this.type==="color"){const O=sf(T),B=sf(z);for(let q=l;q<g;q++)this.paintVertexArray.emplace(q,O[0],O[1],B[0],B[1])}else{for(let O=l;O<g;O++)this.paintVertexArray.emplace(O,T,z);this.maxValue=Math.max(this.maxValue,Math.abs(T),Math.abs(z))}}upload(l){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=l.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(l,g){const T=this.useIntegerZoom?Math.floor(g.zoom):g.zoom,z=Oi(this.expression.interpolationFactor(T,this.zoom,this.zoom+1),0,1);l.set(z)}getBinding(l,g,T){return new Dd(l,g)}}class Qc{constructor(l,g,T,z,O,B){this.expression=l,this.type=g,this.useIntegerZoom=T,this.zoom=z,this.layerId=B,this.zoomInPaintVertexArray=new O,this.zoomOutPaintVertexArray=new O}populatePaintArray(l,g,T){const z=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(l),this.zoomOutPaintVertexArray.resize(l),this._setPaintValues(z,l,g.patterns&&g.patterns[this.layerId],T)}updatePaintArray(l,g,T,z,O){this._setPaintValues(l,g,T.patterns&&T.patterns[this.layerId],O)}_setPaintValues(l,g,T,z){if(!z||!T)return;const{min:O,mid:B,max:q}=T,Z=z[O],re=z[B],de=z[q];if(Z&&re&&de)for(let ye=l;ye<g;ye++)this.zoomInPaintVertexArray.emplace(ye,re.tl[0],re.tl[1],re.br[0],re.br[1],Z.tl[0],Z.tl[1],Z.br[0],Z.br[1],re.pixelRatio,Z.pixelRatio),this.zoomOutPaintVertexArray.emplace(ye,re.tl[0],re.tl[1],re.br[0],re.br[1],de.tl[0],de.tl[1],de.br[0],de.br[1],re.pixelRatio,de.pixelRatio)}upload(l){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=l.createVertexBuffer(this.zoomInPaintVertexArray,jh.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=l.createVertexBuffer(this.zoomOutPaintVertexArray,jh.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Pd{constructor(l,g,T){this.binders={},this._buffers=[];const z=[];for(const O in l.paint._values){if(!T(O))continue;const B=l.paint.get(O);if(!(B instanceof pc&&$o(B.property.specification)))continue;const q=Fi(O,l.type),Z=B.value,re=B.property.specification.type,de=B.property.useIntegerZoom,ye=B.property.specification["property-type"],Ee=ye==="cross-faded"||ye==="cross-faded-data-driven";if(Z.kind==="constant")this.binders[O]=Ee?new Rd(Z.value,q):new of(Z.value,q,re),z.push(`/u_${O}`);else if(Z.kind==="source"||Ee){const Le=gd(O,re,"source");this.binders[O]=Ee?new Qc(Z,re,de,g,Le,l.id):new Gh(Z,q,re,Le),z.push(`/a_${O}`)}else{const Le=gd(O,re,"composite");this.binders[O]=new Hu(Z,q,re,de,g,Le),z.push(`/z_${O}`)}}this.cacheKey=z.sort().join("")}getMaxValue(l){const g=this.binders[l];return g instanceof Gh||g instanceof Hu?g.maxValue:0}populatePaintArrays(l,g,T,z,O){for(const B in this.binders){const q=this.binders[B];(q instanceof Gh||q instanceof Hu||q instanceof Qc)&&q.populatePaintArray(l,g,T,z,O)}}setConstantPatternPositions(l,g){for(const T in this.binders){const z=this.binders[T];z instanceof Rd&&z.setConstantPatternPositions(l,g)}}updatePaintArrays(l,g,T,z,O){let B=!1;for(const q in l){const Z=g.getPositions(q);for(const re of Z){const de=T.feature(re.index);for(const ye in this.binders){const Ee=this.binders[ye];if((Ee instanceof Gh||Ee instanceof Hu||Ee instanceof Qc)&&Ee.expression.isStateDependent===!0){const Le=z.paint.get(ye);Ee.expression=Le.value,Ee.updatePaintArray(re.start,re.end,de,l[q],O),B=!0}}}}return B}defines(){const l=[];for(const g in this.binders){const T=this.binders[g];(T instanceof of||T instanceof Rd)&&l.push(...T.uniformNames.map((z=>`#define HAS_UNIFORM_${z}`)))}return l}getBinderAttributes(){const l=[];for(const g in this.binders){const T=this.binders[g];if(T instanceof Gh||T instanceof Hu)for(let z=0;z<T.paintVertexAttributes.length;z++)l.push(T.paintVertexAttributes[z].name);else if(T instanceof Qc)for(let z=0;z<jh.members.length;z++)l.push(jh.members[z].name)}return l}getBinderUniforms(){const l=[];for(const g in this.binders){const T=this.binders[g];if(T instanceof of||T instanceof Rd||T instanceof Hu)for(const z of T.uniformNames)l.push(z)}return l}getPaintVertexBuffers(){return this._buffers}getUniforms(l,g){const T=[];for(const z in this.binders){const O=this.binders[z];if(O instanceof of||O instanceof Rd||O instanceof Hu){for(const B of O.uniformNames)if(g[B]){const q=O.getBinding(l,g[B],B);T.push({name:B,property:z,binding:q})}}}return T}setUniforms(l,g,T,z){for(const{name:O,property:B,binding:q}of g)this.binders[B].setUniform(q,z,T.get(B),O)}updatePaintBuffers(l){this._buffers=[];for(const g in this.binders){const T=this.binders[g];if(l&&T instanceof Qc){const z=l.fromScale===2?T.zoomInPaintVertexBuffer:T.zoomOutPaintVertexBuffer;z&&this._buffers.push(z)}else(T instanceof Gh||T instanceof Hu)&&T.paintVertexBuffer&&this._buffers.push(T.paintVertexBuffer)}}upload(l){for(const g in this.binders){const T=this.binders[g];(T instanceof Gh||T instanceof Hu||T instanceof Qc)&&T.upload(l)}this.updatePaintBuffers()}destroy(){for(const l in this.binders){const g=this.binders[l];(g instanceof Gh||g instanceof Hu||g instanceof Qc)&&g.destroy()}}}class xi{constructor(l,g,T=(()=>!0)){this.programConfigurations={};for(const z of l)this.programConfigurations[z.id]=new Pd(z,g,T);this.needsUpload=!1,this._featureMap=new yc,this._bufferOffset=0}populatePaintArrays(l,g,T,z,O,B){for(const q in this.programConfigurations)this.programConfigurations[q].populatePaintArrays(l,g,z,O,B);g.id!==void 0&&this._featureMap.add(g.id,T,this._bufferOffset,l),this._bufferOffset=l,this.needsUpload=!0}updatePaintArrays(l,g,T,z){for(const O of T)this.needsUpload=this.programConfigurations[O.id].updatePaintArrays(l,this._featureMap,g,O,z)||this.needsUpload}get(l){return this.programConfigurations[l]}upload(l){if(this.needsUpload){for(const g in this.programConfigurations)this.programConfigurations[g].upload(l);this.needsUpload=!1}}destroy(){for(const l in this.programConfigurations)this.programConfigurations[l].destroy()}}function Fi(f,l){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[f]||[f.replace(`${l}-`,"").replace(/-/g,"_")]}function gd(f,l,g){const T={color:{source:Ye,composite:$r},number:{source:Mn,composite:Ye}},z=(function(O){return{"line-pattern":{source:Cs,composite:Cs},"fill-pattern":{source:Cs,composite:Cs},"fill-extrusion-pattern":{source:Cs,composite:Cs}}[O]})(f);return z&&z[g]||T[l][g]}fn("ConstantBinder",of),fn("CrossFadedConstantBinder",Rd),fn("SourceExpressionBinder",Gh),fn("CrossFadedCompositeBinder",Qc),fn("CompositeExpressionBinder",Hu),fn("ProgramConfiguration",Pd,{omit:["_buffers"]}),fn("ProgramConfigurationSet",xi);const ca=8192,xt=Math.pow(2,14)-1,hm=-xt-1;function qh(f){const l=ca/f.extent,g=f.loadGeometry();for(let T=0;T<g.length;T++){const z=g[T];for(let O=0;O<z.length;O++){const B=z[O],q=Math.round(B.x*l),Z=Math.round(B.y*l);B.x=Oi(q,hm,xt),B.y=Oi(Z,hm,xt),(q<B.x||q>B.x+1||Z<B.y||Z>B.y+1)&&an("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return g}function xc(f,l){return{type:f.type,id:f.id,properties:f.properties,geometry:l?qh(f):[]}}function Ld(f,l,g,T,z){f.emplaceBack(2*l+(T+1)/2,2*g+(z+1)/2)}class yd{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Co,this.indexArray=new Yo,this.segments=new Ba,this.programConfigurations=new xi(l.layers,l.zoom),this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(l,g,T){const z=this.layers[0],O=[];let B=null,q=!1;z.type==="circle"&&(B=z.layout.get("circle-sort-key"),q=!B.isConstant());for(const{feature:Z,id:re,index:de,sourceLayerIndex:ye}of l){const Ee=this.layers[0]._featureFilter.needGeometry,Le=xc(Z,Ee);if(!this.layers[0]._featureFilter.filter(new ka(this.zoom),Le,T))continue;const qe=q?B.evaluate(Le,{},T):void 0,Ke={id:re,properties:Z.properties,type:Z.type,sourceLayerIndex:ye,index:de,geometry:Ee?Le.geometry:qh(Z),patterns:{},sortKey:qe};O.push(Ke)}q&&O.sort(((Z,re)=>Z.sortKey-re.sortKey));for(const Z of O){const{geometry:re,index:de,sourceLayerIndex:ye}=Z,Ee=l[de].feature;this.addFeature(Z,re,de,T),g.featureIndex.insert(Ee,re,de,ye,this.index)}}update(l,g,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,g,this.stateDependentLayers,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,bl),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(l,g,T,z){for(const O of g)for(const B of O){const q=B.x,Z=B.y;if(q<0||q>=ca||Z<0||Z>=ca)continue;const re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,l.sortKey),de=re.vertexLength;Ld(this.layoutVertexArray,q,Z,-1,-1),Ld(this.layoutVertexArray,q,Z,1,-1),Ld(this.layoutVertexArray,q,Z,1,1),Ld(this.layoutVertexArray,q,Z,-1,1),this.indexArray.emplaceBack(de,de+1,de+2),this.indexArray.emplaceBack(de,de+3,de+2),re.vertexLength+=4,re.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,{},z)}}function dm(f,l){for(let g=0;g<f.length;g++)if($u(l,f[g]))return!0;for(let g=0;g<l.length;g++)if($u(f,l[g]))return!0;return!!fm(f,l)}function Pf(f,l,g){return!!$u(f,l)||!!Hh(l,f,g)}function Om(f,l){if(f.length===1)return lf(l,f[0]);for(let g=0;g<l.length;g++){const T=l[g];for(let z=0;z<T.length;z++)if($u(f,T[z]))return!0}for(let g=0;g<f.length;g++)if(lf(l,f[g]))return!0;for(let g=0;g<l.length;g++)if(fm(f,l[g]))return!0;return!1}function c_(f,l,g){if(f.length>1){if(fm(f,l))return!0;for(let T=0;T<l.length;T++)if(Hh(l[T],f,g))return!0}for(let T=0;T<f.length;T++)if(Hh(f[T],l,g))return!0;return!1}function fm(f,l){if(f.length===0||l.length===0)return!1;for(let g=0;g<f.length-1;g++){const T=f[g],z=f[g+1];for(let O=0;O<l.length-1;O++)if(Rp(T,z,l[O],l[O+1]))return!0}return!1}function Rp(f,l,g,T){return Hr(f,g,T)!==Hr(l,g,T)&&Hr(f,l,g)!==Hr(f,l,T)}function Hh(f,l,g){const T=g*g;if(l.length===1)return f.distSqr(l[0])<T;for(let z=1;z<l.length;z++)if(rp(f,l[z-1],l[z])<T)return!0;return!1}function rp(f,l,g){const T=l.distSqr(g);if(T===0)return f.distSqr(l);const z=((f.x-l.x)*(g.x-l.x)+(f.y-l.y)*(g.y-l.y))/T;return f.distSqr(z<0?l:z>1?g:g.sub(l)._mult(z)._add(l))}function lf(f,l){let g,T,z,O=!1;for(let B=0;B<f.length;B++){g=f[B];for(let q=0,Z=g.length-1;q<g.length;Z=q++)T=g[q],z=g[Z],T.y>l.y!=z.y>l.y&&l.x<(z.x-T.x)*(l.y-T.y)/(z.y-T.y)+T.x&&(O=!O)}return O}function $u(f,l){let g=!1;for(let T=0,z=f.length-1;T<f.length;z=T++){const O=f[T],B=f[z];O.y>l.y!=B.y>l.y&&l.x<(B.x-O.x)*(l.y-O.y)/(B.y-O.y)+O.x&&(g=!g)}return g}function cf(f,l,g){const T=g[0],z=g[2];if(f.x<T.x&&l.x<T.x||f.x>z.x&&l.x>z.x||f.y<T.y&&l.y<T.y||f.y>z.y&&l.y>z.y)return!1;const O=Hr(f,l,g[0]);return O!==Hr(f,l,g[1])||O!==Hr(f,l,g[2])||O!==Hr(f,l,g[3])}function vc(f,l,g){const T=l.paint.get(f).value;return T.kind==="constant"?T.value:g.programConfigurations.get(l.id).getMaxValue(f)}function Pp(f){return Math.sqrt(f[0]*f[0]+f[1]*f[1])}function ap(f,l,g,T,z){if(!l[0]&&!l[1])return f;const O=ut.convert(l)._mult(z);g==="viewport"&&O._rotate(-T);const B=[];for(let q=0;q<f.length;q++)B.push(f[q].sub(O));return B}let pm,mm;fn("CircleBucket",yd,{omit:["layers"]});var $h={get paint(){return mm=mm||new L({"circle-radius":new Pr(Yt.paint_circle["circle-radius"]),"circle-color":new Pr(Yt.paint_circle["circle-color"]),"circle-blur":new Pr(Yt.paint_circle["circle-blur"]),"circle-opacity":new Pr(Yt.paint_circle["circle-opacity"]),"circle-translate":new Xn(Yt.paint_circle["circle-translate"]),"circle-translate-anchor":new Xn(Yt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xn(Yt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xn(Yt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Pr(Yt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Pr(Yt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Pr(Yt.paint_circle["circle-stroke-opacity"])})},get layout(){return pm=pm||new L({"circle-sort-key":new Pr(Yt.layout_circle["circle-sort-key"])})}},Zs=1e-6,kd=typeof Float32Array<"u"?Float32Array:Array;function uf(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=1,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=1,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f}function Bm(f,l,g){var T=l[0],z=l[1],O=l[2],B=l[3],q=l[4],Z=l[5],re=l[6],de=l[7],ye=l[8],Ee=l[9],Le=l[10],qe=l[11],Ke=l[12],yt=l[13],Mt=l[14],si=l[15],Ut=g[0],ii=g[1],Pi=g[2],gn=g[3];return f[0]=Ut*T+ii*q+Pi*ye+gn*Ke,f[1]=Ut*z+ii*Z+Pi*Ee+gn*yt,f[2]=Ut*O+ii*re+Pi*Le+gn*Mt,f[3]=Ut*B+ii*de+Pi*qe+gn*si,f[4]=(Ut=g[4])*T+(ii=g[5])*q+(Pi=g[6])*ye+(gn=g[7])*Ke,f[5]=Ut*z+ii*Z+Pi*Ee+gn*yt,f[6]=Ut*O+ii*re+Pi*Le+gn*Mt,f[7]=Ut*B+ii*de+Pi*qe+gn*si,f[8]=(Ut=g[8])*T+(ii=g[9])*q+(Pi=g[10])*ye+(gn=g[11])*Ke,f[9]=Ut*z+ii*Z+Pi*Ee+gn*yt,f[10]=Ut*O+ii*re+Pi*Le+gn*Mt,f[11]=Ut*B+ii*de+Pi*qe+gn*si,f[12]=(Ut=g[12])*T+(ii=g[13])*q+(Pi=g[14])*ye+(gn=g[15])*Ke,f[13]=Ut*z+ii*Z+Pi*Ee+gn*yt,f[14]=Ut*O+ii*re+Pi*Le+gn*Mt,f[15]=Ut*B+ii*de+Pi*qe+gn*si,f}Math.hypot||(Math.hypot=function(){for(var f=0,l=arguments.length;l--;)f+=arguments[l]*arguments[l];return Math.sqrt(f)});var Wa,Zr=Bm;function sp(f,l,g){var T=l[0],z=l[1],O=l[2],B=l[3];return f[0]=g[0]*T+g[4]*z+g[8]*O+g[12]*B,f[1]=g[1]*T+g[5]*z+g[9]*O+g[13]*B,f[2]=g[2]*T+g[6]*z+g[10]*O+g[14]*B,f[3]=g[3]*T+g[7]*z+g[11]*O+g[15]*B,f}Wa=new kd(4),kd!=Float32Array&&(Wa[0]=0,Wa[1]=0,Wa[2]=0,Wa[3]=0);class hf extends x{constructor(l){super(l,$h)}createBucket(l){return new yd(l)}queryRadius(l){const g=l;return vc("circle-radius",this,g)+vc("circle-stroke-width",this,g)+Pp(this.paint.get("circle-translate"))}queryIntersectsFeature(l,g,T,z,O,B,q,Z){const re=ap(l,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),B.angle,q),de=this.paint.get("circle-radius").evaluate(g,T)+this.paint.get("circle-stroke-width").evaluate(g,T),ye=this.paint.get("circle-pitch-alignment")==="map",Ee=ye?re:(function(qe,Ke){return qe.map((yt=>Od(yt,Ke)))})(re,Z),Le=ye?de*q:de;for(const qe of z)for(const Ke of qe){const yt=ye?Ke:Od(Ke,Z);let Mt=Le;const si=sp([],[Ke.x,Ke.y,0,1],Z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Mt*=si[3]/B.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Mt*=B.cameraToCenterDistance/si[3]),Pf(Ee,yt,Mt))return!0}return!1}}function Od(f,l){const g=sp([],[f.x,f.y,0,1],l);return new ut(g[0]/g[3],g[1]/g[3])}class df extends yd{}let Zh;fn("HeatmapBucket",df,{omit:["layers"]});var Lp={get paint(){return Zh=Zh||new L({"heatmap-radius":new Pr(Yt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Pr(Yt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xn(Yt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _d(Yt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xn(Yt.paint_heatmap["heatmap-opacity"])})}};function op(f,{width:l,height:g},T,z){if(z){if(z instanceof Uint8ClampedArray)z=new Uint8Array(z.buffer);else if(z.length!==l*g*T)throw new RangeError(`mismatched image size. expected: ${z.length} but got: ${l*g*T}`)}else z=new Uint8Array(l*g*T);return f.width=l,f.height=g,f.data=z,f}function kp(f,{width:l,height:g},T){if(l===f.width&&g===f.height)return;const z=op({},{width:l,height:g},T);lp(f,z,{x:0,y:0},{x:0,y:0},{width:Math.min(f.width,l),height:Math.min(f.height,g)},T),f.width=l,f.height=g,f.data=z.data}function lp(f,l,g,T,z,O){if(z.width===0||z.height===0)return l;if(z.width>f.width||z.height>f.height||g.x>f.width-z.width||g.y>f.height-z.height)throw new RangeError("out of range source coordinates for image copy");if(z.width>l.width||z.height>l.height||T.x>l.width-z.width||T.y>l.height-z.height)throw new RangeError("out of range destination coordinates for image copy");const B=f.data,q=l.data;if(B===q)throw new Error("srcData equals dstData, so image is already copied");for(let Z=0;Z<z.height;Z++){const re=((g.y+Z)*f.width+g.x)*O,de=((T.y+Z)*l.width+T.x)*O;for(let ye=0;ye<z.width*O;ye++)q[de+ye]=B[re+ye]}return l}class bc{constructor(l,g){op(this,l,1,g)}resize(l){kp(this,l,1)}clone(){return new bc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,g,T,z,O){lp(l,g,T,z,O,1)}}class go{constructor(l,g){op(this,l,4,g)}resize(l){kp(this,l,4)}replace(l,g){g?this.data.set(l):this.data=l instanceof Uint8ClampedArray?new Uint8Array(l.buffer):l}clone(){return new go({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(l,g,T,z,O){lp(l,g,T,z,O,4)}}function ph(f){const l={},g=f.resolution||256,T=f.clips?f.clips.length:1,z=f.image||new go({width:g,height:T});if(Math.log(g)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${g}`);const O=(B,q,Z)=>{l[f.evaluationKey]=Z;const re=f.expression.evaluate(l);z.data[B+q+0]=Math.floor(255*re.r/re.a),z.data[B+q+1]=Math.floor(255*re.g/re.a),z.data[B+q+2]=Math.floor(255*re.b/re.a),z.data[B+q+3]=Math.floor(255*re.a)};if(f.clips)for(let B=0,q=0;B<T;++B,q+=4*g)for(let Z=0,re=0;Z<g;Z++,re+=4){const de=Z/(g-1),{start:ye,end:Ee}=f.clips[B];O(q,re,ye*(1-de)+Ee*de)}else for(let B=0,q=0;B<g;B++,q+=4)O(0,q,B/(g-1));return z}fn("AlphaImage",bc),fn("RGBAImage",go);const ff="big-fb";class cp extends x{createBucket(l){return new df(l)}constructor(l){super(l,Lp),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(l){l==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ph({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(ff)&&this.heatmapFbos.delete(ff)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Op;var Bd={get paint(){return Op=Op||new L({"hillshade-illumination-direction":new Xn(Yt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xn(Yt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xn(Yt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xn(Yt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xn(Yt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xn(Yt.paint_hillshade["hillshade-accent-color"])})}};class pf extends x{constructor(l){super(l,Bd)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const Tu=H([{name:"a_pos",components:2,type:"Int16"}],4),{members:up}=Tu;function hp(f,l,g=2){const T=l&&l.length,z=T?l[0]*g:f.length;let O=Lf(f,0,z,g,!0);const B=[];if(!O||O.next===O.prev)return B;let q,Z,re;if(T&&(O=(function(de,ye,Ee,Le){const qe=[];for(let Ke=0,yt=ye.length;Ke<yt;Ke++){const Mt=Lf(de,ye[Ke]*Le,Ke<yt-1?ye[Ke+1]*Le:de.length,Le,!1);Mt===Mt.next&&(Mt.steiner=!0),qe.push(Bc(Mt))}qe.sort(gm);for(let Ke=0;Ke<qe.length;Ke++)Ee=dp(qe[Ke],Ee);return Ee})(f,l,O,g)),f.length>80*g){q=1/0,Z=1/0;let de=-1/0,ye=-1/0;for(let Ee=g;Ee<z;Ee+=g){const Le=f[Ee],qe=f[Ee+1];Le<q&&(q=Le),qe<Z&&(Z=qe),Le>de&&(de=Le),qe>ye&&(ye=qe)}re=Math.max(de-q,ye-Z),re=re!==0?32767/re:0}return ao(O,B,g,q,Z,re,0),B}function Lf(f,l,g,T,z){let O;if(z===(function(B,q,Z,re){let de=0;for(let ye=q,Ee=Z-re;ye<Z;ye+=re)de+=(B[Ee]-B[ye])*(B[ye+1]+B[Ee+1]),Ee=ye;return de})(f,l,g,T)>0)for(let B=l;B<g;B+=T)O=Bf(B/T|0,f[B],f[B+1],O);else for(let B=g-T;B>=l;B-=T)O=Bf(B/T|0,f[B],f[B+1],O);return O&&ko(O,O.next)&&(gf(O),O=O.next),O}function Xh(f,l){if(!f)return f;l||(l=f);let g,T=f;do if(g=!1,T.steiner||!ko(T,T.next)&&yo(T.prev,T,T.next)!==0)T=T.next;else{if(gf(T),T=l=T.prev,T===T.next)break;g=!0}while(g||T!==l);return l}function ao(f,l,g,T,z,O,B){if(!f)return;!B&&O&&(function(Z,re,de,ye){let Ee=Z;do Ee.z===0&&(Ee.z=Su(Ee.x,Ee.y,re,de,ye)),Ee.prevZ=Ee.prev,Ee.nextZ=Ee.next,Ee=Ee.next;while(Ee!==Z);Ee.prevZ.nextZ=null,Ee.prevZ=null,(function(Le){let qe,Ke=1;do{let yt,Mt=Le;Le=null;let si=null;for(qe=0;Mt;){qe++;let Ut=Mt,ii=0;for(let gn=0;gn<Ke&&(ii++,Ut=Ut.nextZ,Ut);gn++);let Pi=Ke;for(;ii>0||Pi>0&&Ut;)ii!==0&&(Pi===0||!Ut||Mt.z<=Ut.z)?(yt=Mt,Mt=Mt.nextZ,ii--):(yt=Ut,Ut=Ut.nextZ,Pi--),si?si.nextZ=yt:Le=yt,yt.prevZ=si,si=yt;Mt=Ut}si.nextZ=null,Ke*=2}while(qe>1)})(Ee)})(f,T,z,O);let q=f;for(;f.prev!==f.next;){const Z=f.prev,re=f.next;if(O?Fd(f,T,z,O):kf(f))l.push(Z.i,f.i,re.i),gf(f),f=re.next,q=re.next;else if((f=re)===q){B?B===1?ao(f=_m(Xh(f),l),l,g,T,z,O,2):B===2&&mf(f,l,g,T,z,O):ao(Xh(f),l,g,T,z,O,1);break}}}function kf(f){const l=f.prev,g=f,T=f.next;if(yo(l,g,T)>=0)return!1;const z=l.x,O=g.x,B=T.x,q=l.y,Z=g.y,re=T.y,de=z<O?z<B?z:B:O<B?O:B,ye=q<Z?q<re?q:re:Z<re?Z:re,Ee=z>O?z>B?z:B:O>B?O:B,Le=q>Z?q>re?q:re:Z>re?Z:re;let qe=T.next;for(;qe!==l;){if(qe.x>=de&&qe.x<=Ee&&qe.y>=ye&&qe.y<=Le&&Eu(z,q,O,Z,B,re,qe.x,qe.y)&&yo(qe.prev,qe,qe.next)>=0)return!1;qe=qe.next}return!0}function Fd(f,l,g,T){const z=f.prev,O=f,B=f.next;if(yo(z,O,B)>=0)return!1;const q=z.x,Z=O.x,re=B.x,de=z.y,ye=O.y,Ee=B.y,Le=q<Z?q<re?q:re:Z<re?Z:re,qe=de<ye?de<Ee?de:Ee:ye<Ee?ye:Ee,Ke=q>Z?q>re?q:re:Z>re?Z:re,yt=de>ye?de>Ee?de:Ee:ye>Ee?ye:Ee,Mt=Su(Le,qe,l,g,T),si=Su(Ke,yt,l,g,T);let Ut=f.prevZ,ii=f.nextZ;for(;Ut&&Ut.z>=Mt&&ii&&ii.z<=si;){if(Ut.x>=Le&&Ut.x<=Ke&&Ut.y>=qe&&Ut.y<=yt&&Ut!==z&&Ut!==B&&Eu(q,de,Z,ye,re,Ee,Ut.x,Ut.y)&&yo(Ut.prev,Ut,Ut.next)>=0||(Ut=Ut.prevZ,ii.x>=Le&&ii.x<=Ke&&ii.y>=qe&&ii.y<=yt&&ii!==z&&ii!==B&&Eu(q,de,Z,ye,re,Ee,ii.x,ii.y)&&yo(ii.prev,ii,ii.next)>=0))return!1;ii=ii.nextZ}for(;Ut&&Ut.z>=Mt;){if(Ut.x>=Le&&Ut.x<=Ke&&Ut.y>=qe&&Ut.y<=yt&&Ut!==z&&Ut!==B&&Eu(q,de,Z,ye,re,Ee,Ut.x,Ut.y)&&yo(Ut.prev,Ut,Ut.next)>=0)return!1;Ut=Ut.prevZ}for(;ii&&ii.z<=si;){if(ii.x>=Le&&ii.x<=Ke&&ii.y>=qe&&ii.y<=yt&&ii!==z&&ii!==B&&Eu(q,de,Z,ye,re,Ee,ii.x,ii.y)&&yo(ii.prev,ii,ii.next)>=0)return!1;ii=ii.nextZ}return!0}function _m(f,l){let g=f;do{const T=g.prev,z=g.next.next;!ko(T,z)&&dl(T,g,g.next,z)&&Nd(T,z)&&Nd(z,T)&&(l.push(T.i,g.i,z.i),gf(g),gf(g.next),g=f=z),g=g.next}while(g!==f);return Xh(g)}function mf(f,l,g,T,z,O){let B=f;do{let q=B.next.next;for(;q!==B.prev;){if(B.i!==q.i&&Fm(B,q)){let Z=ym(B,q);return B=Xh(B,B.next),Z=Xh(Z,Z.next),ao(B,l,g,T,z,O,0),void ao(Z,l,g,T,z,O,0)}q=q.next}B=B.next}while(B!==f)}function gm(f,l){return f.x-l.x}function dp(f,l){const g=(function(z,O){let B=O;const q=z.x,Z=z.y;let re,de=-1/0;do{if(Z<=B.y&&Z>=B.next.y&&B.next.y!==B.y){const Ke=B.x+(Z-B.y)*(B.next.x-B.x)/(B.next.y-B.y);if(Ke<=q&&Ke>de&&(de=Ke,re=B.x<B.next.x?B:B.next,Ke===q))return re}B=B.next}while(B!==O);if(!re)return null;const ye=re,Ee=re.x,Le=re.y;let qe=1/0;B=re;do{if(q>=B.x&&B.x>=Ee&&q!==B.x&&Eu(Z<Le?q:de,Z,Ee,Le,Z<Le?de:q,Z,B.x,B.y)){const Ke=Math.abs(Z-B.y)/(q-B.x);Nd(B,z)&&(Ke<qe||Ke===qe&&(B.x>re.x||B.x===re.x&&Of(re,B)))&&(re=B,qe=Ke)}B=B.next}while(B!==ye);return re})(f,l);if(!g)return l;const T=ym(g,f);return Xh(T,T.next),Xh(g,g.next)}function Of(f,l){return yo(f.prev,f,l.prev)<0&&yo(l.next,f,f.next)<0}function Su(f,l,g,T,z){return(f=1431655765&((f=858993459&((f=252645135&((f=16711935&((f=(f-g)*z|0)|f<<8))|f<<4))|f<<2))|f<<1))|(l=1431655765&((l=858993459&((l=252645135&((l=16711935&((l=(l-T)*z|0)|l<<8))|l<<4))|l<<2))|l<<1))<<1}function Bc(f){let l=f,g=f;do(l.x<g.x||l.x===g.x&&l.y<g.y)&&(g=l),l=l.next;while(l!==f);return g}function Eu(f,l,g,T,z,O,B,q){return(z-B)*(l-q)>=(f-B)*(O-q)&&(f-B)*(T-q)>=(g-B)*(l-q)&&(g-B)*(O-q)>=(z-B)*(T-q)}function Fm(f,l){return f.next.i!==l.i&&f.prev.i!==l.i&&!(function(g,T){let z=g;do{if(z.i!==g.i&&z.next.i!==g.i&&z.i!==T.i&&z.next.i!==T.i&&dl(z,z.next,g,T))return!0;z=z.next}while(z!==g);return!1})(f,l)&&(Nd(f,l)&&Nd(l,f)&&(function(g,T){let z=g,O=!1;const B=(g.x+T.x)/2,q=(g.y+T.y)/2;do z.y>q!=z.next.y>q&&z.next.y!==z.y&&B<(z.next.x-z.x)*(q-z.y)/(z.next.y-z.y)+z.x&&(O=!O),z=z.next;while(z!==g);return O})(f,l)&&(yo(f.prev,f,l.prev)||yo(f,l.prev,l))||ko(f,l)&&yo(f.prev,f,f.next)>0&&yo(l.prev,l,l.next)>0)}function yo(f,l,g){return(l.y-f.y)*(g.x-l.x)-(l.x-f.x)*(g.y-l.y)}function ko(f,l){return f.x===l.x&&f.y===l.y}function dl(f,l,g,T){const z=fp(yo(f,l,g)),O=fp(yo(f,l,T)),B=fp(yo(g,T,f)),q=fp(yo(g,T,l));return z!==O&&B!==q||!(z!==0||!_f(f,g,l))||!(O!==0||!_f(f,T,l))||!(B!==0||!_f(g,f,T))||!(q!==0||!_f(g,l,T))}function _f(f,l,g){return l.x<=Math.max(f.x,g.x)&&l.x>=Math.min(f.x,g.x)&&l.y<=Math.max(f.y,g.y)&&l.y>=Math.min(f.y,g.y)}function fp(f){return f>0?1:f<0?-1:0}function Nd(f,l){return yo(f.prev,f,f.next)<0?yo(f,l,f.next)>=0&&yo(f,f.prev,l)>=0:yo(f,l,f.prev)<0||yo(f,f.next,l)<0}function ym(f,l){const g=Vd(f.i,f.x,f.y),T=Vd(l.i,l.x,l.y),z=f.next,O=l.prev;return f.next=l,l.prev=f,g.next=z,z.prev=g,T.next=g,g.prev=T,O.next=T,T.prev=O,T}function Bf(f,l,g,T){const z=Vd(f,l,g);return T?(z.next=T.next,z.prev=T,T.next.prev=z,T.next=z):(z.prev=z,z.next=z),z}function gf(f){f.next.prev=f.prev,f.prev.next=f.next,f.prevZ&&(f.prevZ.nextZ=f.nextZ),f.nextZ&&(f.nextZ.prevZ=f.prevZ)}function Vd(f,l,g){return{i:f,x:l,y:g,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Bp(f,l,g){const T=g.patternDependencies;let z=!1;for(const O of l){const B=O.paint.get(`${f}-pattern`);B.isConstant()||(z=!0);const q=B.constantOr(null);q&&(z=!0,T[q.to]=!0,T[q.from]=!0)}return z}function Fp(f,l,g,T,z){const O=z.patternDependencies;for(const B of l){const q=B.paint.get(`${f}-pattern`).value;if(q.kind!=="constant"){let Z=q.evaluate({zoom:T-1},g,{},z.availableImages),re=q.evaluate({zoom:T},g,{},z.availableImages),de=q.evaluate({zoom:T+1},g,{},z.availableImages);Z=Z&&Z.name?Z.name:Z,re=re&&re.name?re.name:re,de=de&&de.name?de.name:de,O[Z]=!0,O[re]=!0,O[de]=!0,g.patterns[B.id]={min:Z,mid:re,max:de}}}return g}class yf{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new _c,this.indexArray=new Yo,this.indexArray2=new mn,this.programConfigurations=new xi(l.layers,l.zoom),this.segments=new Ba,this.segments2=new Ba,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(l,g,T){this.hasPattern=Bp("fill",this.layers,g);const z=this.layers[0].layout.get("fill-sort-key"),O=!z.isConstant(),B=[];for(const{feature:q,id:Z,index:re,sourceLayerIndex:de}of l){const ye=this.layers[0]._featureFilter.needGeometry,Ee=xc(q,ye);if(!this.layers[0]._featureFilter.filter(new ka(this.zoom),Ee,T))continue;const Le=O?z.evaluate(Ee,{},T,g.availableImages):void 0,qe={id:Z,properties:q.properties,type:q.type,sourceLayerIndex:de,index:re,geometry:ye?Ee.geometry:qh(q),patterns:{},sortKey:Le};B.push(qe)}O&&B.sort(((q,Z)=>q.sortKey-Z.sortKey));for(const q of B){const{geometry:Z,index:re,sourceLayerIndex:de}=q;if(this.hasPattern){const ye=Fp("fill",this.layers,q,this.zoom,g);this.patternFeatures.push(ye)}else this.addFeature(q,Z,re,T,{});g.featureIndex.insert(l[re].feature,Z,re,de,this.index)}}update(l,g,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,g,this.stateDependentLayers,T)}addFeatures(l,g,T){for(const z of this.patternFeatures)this.addFeature(z,z.geometry,z.index,g,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,up),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.indexBuffer2=l.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(l,g,T,z,O){for(const B of Dc(g,500)){let q=0;for(const Le of B)q+=Le.length;const Z=this.segments.prepareSegment(q,this.layoutVertexArray,this.indexArray),re=Z.vertexLength,de=[],ye=[];for(const Le of B){if(Le.length===0)continue;Le!==B[0]&&ye.push(de.length/2);const qe=this.segments2.prepareSegment(Le.length,this.layoutVertexArray,this.indexArray2),Ke=qe.vertexLength;this.layoutVertexArray.emplaceBack(Le[0].x,Le[0].y),this.indexArray2.emplaceBack(Ke+Le.length-1,Ke),de.push(Le[0].x),de.push(Le[0].y);for(let yt=1;yt<Le.length;yt++)this.layoutVertexArray.emplaceBack(Le[yt].x,Le[yt].y),this.indexArray2.emplaceBack(Ke+yt-1,Ke+yt),de.push(Le[yt].x),de.push(Le[yt].y);qe.vertexLength+=Le.length,qe.primitiveLength+=Le.length}const Ee=hp(de,ye);for(let Le=0;Le<Ee.length;Le+=3)this.indexArray.emplaceBack(re+Ee[Le],re+Ee[Le+1],re+Ee[Le+2]);Z.vertexLength+=q,Z.primitiveLength+=Ee.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,O,z)}}let Np,pp;fn("FillBucket",yf,{omit:["layers","patternFeatures"]});var mp={get paint(){return pp=pp||new L({"fill-antialias":new Xn(Yt.paint_fill["fill-antialias"]),"fill-opacity":new Pr(Yt.paint_fill["fill-opacity"]),"fill-color":new Pr(Yt.paint_fill["fill-color"]),"fill-outline-color":new Pr(Yt.paint_fill["fill-outline-color"]),"fill-translate":new Xn(Yt.paint_fill["fill-translate"]),"fill-translate-anchor":new Xn(Yt.paint_fill["fill-translate-anchor"]),"fill-pattern":new vu(Yt.paint_fill["fill-pattern"])})},get layout(){return Np=Np||new L({"fill-sort-key":new Pr(Yt.layout_fill["fill-sort-key"])})}};class Nm extends x{constructor(l){super(l,mp)}recalculate(l,g){super.recalculate(l,g);const T=this.paint._values["fill-outline-color"];T.value.kind==="constant"&&T.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(l){return new yf(l)}queryRadius(){return Pp(this.paint.get("fill-translate"))}queryIntersectsFeature(l,g,T,z,O,B,q){return Om(ap(l,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),B.angle,q),z)}isTileClipped(){return!0}}const Vm=H([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),xm=H([{name:"a_centroid",components:2,type:"Int16"}],4),{members:xs}=Vm;var mh={},Um=ke,Vp=xf;function xf(f,l,g,T,z){this.properties={},this.extent=g,this.type=0,this._pbf=f,this._geometry=-1,this._keys=T,this._values=z,f.readFields(_p,this,l)}function _p(f,l,g){f==1?l.id=g.readVarint():f==2?(function(T,z){for(var O=T.readVarint()+T.pos;T.pos<O;){var B=z._keys[T.readVarint()],q=z._values[T.readVarint()];z.properties[B]=q}})(g,l):f==3?l.type=g.readVarint():f==4&&(l._geometry=g.pos)}function Up(f){for(var l,g,T=0,z=0,O=f.length,B=O-1;z<O;B=z++)T+=((g=f[B]).x-(l=f[z]).x)*(l.y+g.y);return T}xf.types=["Unknown","Point","LineString","Polygon"],xf.prototype.loadGeometry=function(){var f=this._pbf;f.pos=this._geometry;for(var l,g=f.readVarint()+f.pos,T=1,z=0,O=0,B=0,q=[];f.pos<g;){if(z<=0){var Z=f.readVarint();T=7&Z,z=Z>>3}if(z--,T===1||T===2)O+=f.readSVarint(),B+=f.readSVarint(),T===1&&(l&&q.push(l),l=[]),l.push(new Um(O,B));else{if(T!==7)throw new Error("unknown command "+T);l&&l.push(l[0].clone())}}return l&&q.push(l),q},xf.prototype.bbox=function(){var f=this._pbf;f.pos=this._geometry;for(var l=f.readVarint()+f.pos,g=1,T=0,z=0,O=0,B=1/0,q=-1/0,Z=1/0,re=-1/0;f.pos<l;){if(T<=0){var de=f.readVarint();g=7&de,T=de>>3}if(T--,g===1||g===2)(z+=f.readSVarint())<B&&(B=z),z>q&&(q=z),(O+=f.readSVarint())<Z&&(Z=O),O>re&&(re=O);else if(g!==7)throw new Error("unknown command "+g)}return[B,Z,q,re]},xf.prototype.toGeoJSON=function(f,l,g){var T,z,O=this.extent*Math.pow(2,g),B=this.extent*f,q=this.extent*l,Z=this.loadGeometry(),re=xf.types[this.type];function de(Le){for(var qe=0;qe<Le.length;qe++){var Ke=Le[qe];Le[qe]=[360*(Ke.x+B)/O-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ke.y+q)/O)*Math.PI/180))-90]}}switch(this.type){case 1:var ye=[];for(T=0;T<Z.length;T++)ye[T]=Z[T][0];de(Z=ye);break;case 2:for(T=0;T<Z.length;T++)de(Z[T]);break;case 3:for(Z=(function(Le){var qe=Le.length;if(qe<=1)return[Le];for(var Ke,yt,Mt=[],si=0;si<qe;si++){var Ut=Up(Le[si]);Ut!==0&&(yt===void 0&&(yt=Ut<0),yt===Ut<0?(Ke&&Mt.push(Ke),Ke=[Le[si]]):Ke.push(Le[si]))}return Ke&&Mt.push(Ke),Mt})(Z),T=0;T<Z.length;T++)for(z=0;z<Z[T].length;z++)de(Z[T][z])}Z.length===1?Z=Z[0]:re="Multi"+re;var Ee={type:"Feature",geometry:{type:re,coordinates:Z},properties:this.properties};return"id"in this&&(Ee.id=this.id),Ee};var vm=Vp,Zu=_h;function _h(f,l){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=f,this._keys=[],this._values=[],this._features=[],f.readFields(bm,this,l),this.length=this._features.length}function bm(f,l,g){f===15?l.version=g.readVarint():f===1?l.name=g.readString():f===5?l.extent=g.readVarint():f===2?l._features.push(g.pos):f===3?l._keys.push(g.readString()):f===4&&l._values.push((function(T){for(var z=null,O=T.readVarint()+T.pos;T.pos<O;){var B=T.readVarint()>>3;z=B===1?T.readString():B===2?T.readFloat():B===3?T.readDouble():B===4?T.readVarint64():B===5?T.readVarint():B===6?T.readSVarint():B===7?T.readBoolean():null}return z})(g))}_h.prototype.feature=function(f){if(f<0||f>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[f];var l=this._pbf.readVarint()+this._pbf.pos;return new vm(this._pbf,l,this.extent,this._keys,this._values)};var Oo=Zu;function ec(f,l,g){if(f===3){var T=new Oo(g,g.readVarint()+g.pos);T.length&&(l[T.name]=T)}}mh.VectorTile=function(f,l){this.layers=f.readFields(ec,{},l)},mh.VectorTileFeature=Vp,mh.VectorTileLayer=Zu;const Ff=mh.VectorTileFeature.types,Nf=Math.pow(2,13);function gh(f,l,g,T,z,O,B,q){f.emplaceBack(l,g,2*Math.floor(T*Nf)+B,z*Nf*2,O*Nf*2,Math.round(q))}class Vf{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=l.index,this.hasPattern=!1,this.layoutVertexArray=new Nl,this.centroidVertexArray=new Ms,this.indexArray=new Yo,this.programConfigurations=new xi(l.layers,l.zoom),this.segments=new Ba,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(l,g,T){this.features=[],this.hasPattern=Bp("fill-extrusion",this.layers,g);for(const{feature:z,id:O,index:B,sourceLayerIndex:q}of l){const Z=this.layers[0]._featureFilter.needGeometry,re=xc(z,Z);if(!this.layers[0]._featureFilter.filter(new ka(this.zoom),re,T))continue;const de={id:O,sourceLayerIndex:q,index:B,geometry:Z?re.geometry:qh(z),properties:z.properties,type:z.type,patterns:{}};this.hasPattern?this.features.push(Fp("fill-extrusion",this.layers,de,this.zoom,g)):this.addFeature(de,de.geometry,B,T,{}),g.featureIndex.insert(z,de.geometry,B,q,this.index,!0)}}addFeatures(l,g,T){for(const z of this.features){const{geometry:O}=z;this.addFeature(z,O,z.index,g,T)}}update(l,g,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,g,this.stateDependentLayers,T)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,xs),this.centroidVertexBuffer=l.createVertexBuffer(this.centroidVertexArray,xm.members,!0),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(l,g,T,z,O){for(const B of Dc(g,500)){const q={x:0,y:0,vertexCount:0};let Z=0;for(const qe of B)Z+=qe.length;let re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const qe of B){if(qe.length===0||wm(qe))continue;let Ke=0;for(let yt=0;yt<qe.length;yt++){const Mt=qe[yt];if(yt>=1){const si=qe[yt-1];if(!so(Mt,si)){re.vertexLength+4>Ba.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ut=Mt.sub(si)._perp()._unit(),ii=si.dist(Mt);Ke+ii>32768&&(Ke=0),gh(this.layoutVertexArray,Mt.x,Mt.y,Ut.x,Ut.y,0,0,Ke),gh(this.layoutVertexArray,Mt.x,Mt.y,Ut.x,Ut.y,0,1,Ke),q.x+=2*Mt.x,q.y+=2*Mt.y,q.vertexCount+=2,Ke+=ii,gh(this.layoutVertexArray,si.x,si.y,Ut.x,Ut.y,0,0,Ke),gh(this.layoutVertexArray,si.x,si.y,Ut.x,Ut.y,0,1,Ke),q.x+=2*si.x,q.y+=2*si.y,q.vertexCount+=2;const Pi=re.vertexLength;this.indexArray.emplaceBack(Pi,Pi+2,Pi+1),this.indexArray.emplaceBack(Pi+1,Pi+2,Pi+3),re.vertexLength+=4,re.primitiveLength+=2}}}}if(re.vertexLength+Z>Ba.MAX_VERTEX_ARRAY_LENGTH&&(re=this.segments.prepareSegment(Z,this.layoutVertexArray,this.indexArray)),Ff[l.type]!=="Polygon")continue;const de=[],ye=[],Ee=re.vertexLength;for(const qe of B)if(qe.length!==0){qe!==B[0]&&ye.push(de.length/2);for(let Ke=0;Ke<qe.length;Ke++){const yt=qe[Ke];gh(this.layoutVertexArray,yt.x,yt.y,0,0,1,1,0),q.x+=yt.x,q.y+=yt.y,q.vertexCount+=1,de.push(yt.x),de.push(yt.y)}}const Le=hp(de,ye);for(let qe=0;qe<Le.length;qe+=3)this.indexArray.emplaceBack(Ee+Le[qe],Ee+Le[qe+2],Ee+Le[qe+1]);re.primitiveLength+=Le.length/3,re.vertexLength+=Z;for(let qe=0;qe<q.vertexCount;qe++){const Ke=Math.floor(q.x/q.vertexCount),yt=Math.floor(q.y/q.vertexCount);this.centroidVertexArray.emplaceBack(Ke,yt)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,O,z)}}function so(f,l){return f.x===l.x&&(f.x<0||f.x>ca)||f.y===l.y&&(f.y<0||f.y>ca)}function wm(f){return f.every((l=>l.x<0))||f.every((l=>l.x>ca))||f.every((l=>l.y<0))||f.every((l=>l.y>ca))}let u_;fn("FillExtrusionBucket",Vf,{omit:["layers","features"]});var jp={get paint(){return u_=u_||new L({"fill-extrusion-opacity":new Xn(Yt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Pr(Yt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xn(Yt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xn(Yt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vu(Yt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Pr(Yt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Pr(Yt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Xn(Yt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Uf extends x{constructor(l){super(l,jp)}createBucket(l){return new Vf(l)}queryRadius(){return Pp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(l,g,T,z,O,B,q,Z){const re=ap(l,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),B.angle,q),de=this.paint.get("fill-extrusion-height").evaluate(g,T),ye=this.paint.get("fill-extrusion-base").evaluate(g,T),Ee=(function(qe,Ke,yt,Mt){const si=[];for(const Ut of qe){const ii=[Ut.x,Ut.y,0,1];sp(ii,ii,Ke),si.push(new ut(ii[0]/ii[3],ii[1]/ii[3]))}return si})(re,Z),Le=(function(qe,Ke,yt,Mt){const si=[],Ut=[],ii=Mt[8]*Ke,Pi=Mt[9]*Ke,gn=Mt[10]*Ke,Wn=Mt[11]*Ke,Er=Mt[8]*yt,Fn=Mt[9]*yt,In=Mt[10]*yt,xr=Mt[11]*yt;for(const or of qe){const nr=[],Gi=[];for(const sr of or){const vr=sr.x,ia=sr.y,ms=Mt[0]*vr+Mt[4]*ia+Mt[12],eo=Mt[1]*vr+Mt[5]*ia+Mt[13],Sl=Mt[2]*vr+Mt[6]*ia+Mt[14],Nc=Mt[3]*vr+Mt[7]*ia+Mt[15],rc=Sl+gn,ql=Nc+Wn,iu=ms+Er,Sc=eo+Fn,tl=Sl+In,il=Nc+xr,ac=new ut((ms+ii)/ql,(eo+Pi)/ql);ac.z=rc/ql,nr.push(ac);const nu=new ut(iu/il,Sc/il);nu.z=tl/il,Gi.push(nu)}si.push(nr),Ut.push(Gi)}return[si,Ut]})(z,ye,de,Z);return(function(qe,Ke,yt){let Mt=1/0;Om(yt,Ke)&&(Mt=jf(yt,Ke[0]));for(let si=0;si<Ke.length;si++){const Ut=Ke[si],ii=qe[si];for(let Pi=0;Pi<Ut.length-1;Pi++){const gn=Ut[Pi],Wn=[gn,Ut[Pi+1],ii[Pi+1],ii[Pi],gn];dm(yt,Wn)&&(Mt=Math.min(Mt,jf(yt,Wn)))}}return Mt!==1/0&&Mt})(Le[0],Le[1],Ee)}}function Fc(f,l){return f.x*l.x+f.y*l.y}function jf(f,l){if(f.length===1){let g=0;const T=l[g++];let z;for(;!z||T.equals(z);)if(z=l[g++],!z)return 1/0;for(;g<l.length;g++){const O=l[g],B=f[0],q=z.sub(T),Z=O.sub(T),re=B.sub(T),de=Fc(q,q),ye=Fc(q,Z),Ee=Fc(Z,Z),Le=Fc(re,q),qe=Fc(re,Z),Ke=de*Ee-ye*ye,yt=(Ee*Le-ye*qe)/Ke,Mt=(de*qe-ye*Le)/Ke,si=T.z*(1-yt-Mt)+z.z*yt+O.z*Mt;if(isFinite(si))return si}return 1/0}{let g=1/0;for(const T of l)g=Math.min(g,T.z);return g}}const Gf=H([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Xu}=Gf,tc=H([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:xd}=tc,vd=mh.VectorTileFeature.types,yh=Math.cos(Math.PI/180*37.5),Tm=Math.pow(2,14)/.5;class Gp{constructor(l){this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((g=>g.id)),this.index=l.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((g=>{this.gradients[g.id]={}})),this.layoutVertexArray=new Jc,this.layoutVertexArray2=new hl,this.indexArray=new Yo,this.programConfigurations=new xi(l.layers,l.zoom),this.segments=new Ba,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((g=>g.isStateDependent())).map((g=>g.id))}populate(l,g,T){this.hasPattern=Bp("line",this.layers,g);const z=this.layers[0].layout.get("line-sort-key"),O=!z.isConstant(),B=[];for(const{feature:q,id:Z,index:re,sourceLayerIndex:de}of l){const ye=this.layers[0]._featureFilter.needGeometry,Ee=xc(q,ye);if(!this.layers[0]._featureFilter.filter(new ka(this.zoom),Ee,T))continue;const Le=O?z.evaluate(Ee,{},T):void 0,qe={id:Z,properties:q.properties,type:q.type,sourceLayerIndex:de,index:re,geometry:ye?Ee.geometry:qh(q),patterns:{},sortKey:Le};B.push(qe)}O&&B.sort(((q,Z)=>q.sortKey-Z.sortKey));for(const q of B){const{geometry:Z,index:re,sourceLayerIndex:de}=q;if(this.hasPattern){const ye=Fp("line",this.layers,q,this.zoom,g);this.patternFeatures.push(ye)}else this.addFeature(q,Z,re,T,{});g.featureIndex.insert(l[re].feature,Z,re,de,this.index)}}update(l,g,T){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(l,g,this.stateDependentLayers,T)}addFeatures(l,g,T){for(const z of this.patternFeatures)this.addFeature(z,z.geometry,z.index,g,T)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(l){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=l.createVertexBuffer(this.layoutVertexArray2,xd)),this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,Xu),this.indexBuffer=l.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(l),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(l){if(l.properties&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(l.properties,"mapbox_clip_end"))return{start:+l.properties.mapbox_clip_start,end:+l.properties.mapbox_clip_end}}addFeature(l,g,T,z,O){const B=this.layers[0].layout,q=B.get("line-join").evaluate(l,{}),Z=B.get("line-cap"),re=B.get("line-miter-limit"),de=B.get("line-round-limit");this.lineClips=this.lineFeatureClips(l);for(const ye of g)this.addLine(ye,l,q,Z,re,de);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,l,T,O,z)}addLine(l,g,T,z,O,B){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Mt=0;Mt<l.length-1;Mt++)this.totalDistance+=l[Mt].dist(l[Mt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const q=vd[g.type]==="Polygon";let Z=l.length;for(;Z>=2&&l[Z-1].equals(l[Z-2]);)Z--;let re=0;for(;re<Z-1&&l[re].equals(l[re+1]);)re++;if(Z<(q?3:2))return;T==="bevel"&&(O=1.05);const de=this.overscaling<=16?15*ca/(512*this.overscaling):0,ye=this.segments.prepareSegment(10*Z,this.layoutVertexArray,this.indexArray);let Ee,Le,qe,Ke,yt;this.e1=this.e2=-1,q&&(Ee=l[Z-2],yt=l[re].sub(Ee)._unit()._perp());for(let Mt=re;Mt<Z;Mt++){if(qe=Mt===Z-1?q?l[re+1]:void 0:l[Mt+1],qe&&l[Mt].equals(qe))continue;yt&&(Ke=yt),Ee&&(Le=Ee),Ee=l[Mt],yt=qe?qe.sub(Ee)._unit()._perp():Ke,Ke=Ke||yt;let si=Ke.add(yt);si.x===0&&si.y===0||si._unit();const Ut=Ke.x*yt.x+Ke.y*yt.y,ii=si.x*yt.x+si.y*yt.y,Pi=ii!==0?1/ii:1/0,gn=2*Math.sqrt(2-2*ii),Wn=ii<yh&&Le&&qe,Er=Ke.x*yt.y-Ke.y*yt.x>0;if(Wn&&Mt>re){const xr=Ee.dist(Le);if(xr>2*de){const or=Ee.sub(Ee.sub(Le)._mult(de/xr)._round());this.updateDistance(Le,or),this.addCurrentVertex(or,Ke,0,0,ye),Le=or}}const Fn=Le&&qe;let In=Fn?T:q?"butt":z;if(Fn&&In==="round"&&(Pi<B?In="miter":Pi<=2&&(In="fakeround")),In==="miter"&&Pi>O&&(In="bevel"),In==="bevel"&&(Pi>2&&(In="flipbevel"),Pi<O&&(In="miter")),Le&&this.updateDistance(Le,Ee),In==="miter")si._mult(Pi),this.addCurrentVertex(Ee,si,0,0,ye);else if(In==="flipbevel"){if(Pi>100)si=yt.mult(-1);else{const xr=Pi*Ke.add(yt).mag()/Ke.sub(yt).mag();si._perp()._mult(xr*(Er?-1:1))}this.addCurrentVertex(Ee,si,0,0,ye),this.addCurrentVertex(Ee,si.mult(-1),0,0,ye)}else if(In==="bevel"||In==="fakeround"){const xr=-Math.sqrt(Pi*Pi-1),or=Er?xr:0,nr=Er?0:xr;if(Le&&this.addCurrentVertex(Ee,Ke,or,nr,ye),In==="fakeround"){const Gi=Math.round(180*gn/Math.PI/20);for(let sr=1;sr<Gi;sr++){let vr=sr/Gi;if(vr!==.5){const ms=vr-.5;vr+=vr*ms*(vr-1)*((1.0904+Ut*(Ut*(3.55645-1.43519*Ut)-3.2452))*ms*ms+(.848013+Ut*(.215638*Ut-1.06021)))}const ia=yt.sub(Ke)._mult(vr)._add(Ke)._unit()._mult(Er?-1:1);this.addHalfVertex(Ee,ia.x,ia.y,!1,Er,0,ye)}}qe&&this.addCurrentVertex(Ee,yt,-or,-nr,ye)}else if(In==="butt")this.addCurrentVertex(Ee,si,0,0,ye);else if(In==="square"){const xr=Le?1:-1;this.addCurrentVertex(Ee,si,xr,xr,ye)}else In==="round"&&(Le&&(this.addCurrentVertex(Ee,Ke,0,0,ye),this.addCurrentVertex(Ee,Ke,1,1,ye,!0)),qe&&(this.addCurrentVertex(Ee,yt,-1,-1,ye,!0),this.addCurrentVertex(Ee,yt,0,0,ye)));if(Wn&&Mt<Z-1){const xr=Ee.dist(qe);if(xr>2*de){const or=Ee.add(qe.sub(Ee)._mult(de/xr)._round());this.updateDistance(Ee,or),this.addCurrentVertex(or,yt,0,0,ye),Ee=or}}}}addCurrentVertex(l,g,T,z,O,B=!1){const q=g.y*z-g.x,Z=-g.y-g.x*z;this.addHalfVertex(l,g.x+g.y*T,g.y-g.x*T,B,!1,T,O),this.addHalfVertex(l,q,Z,B,!0,-z,O),this.distance>Tm/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(l,g,T,z,O,B))}addHalfVertex({x:l,y:g},T,z,O,B,q,Z){const re=.5*(this.lineClips?this.scaledDistance*(Tm-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((l<<1)+(O?1:0),(g<<1)+(B?1:0),Math.round(63*T)+128,Math.round(63*z)+128,1+(q===0?0:q<0?-1:1)|(63&re)<<2,re>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const de=Z.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,de),Z.primitiveLength++),B?this.e2=de:this.e1=de}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(l,g){this.distance+=l.dist(g),this.updateScaledDistance()}}let qp,jm;fn("LineBucket",Gp,{omit:["layers","patternFeatures"]});var xh={get paint(){return jm=jm||new L({"line-opacity":new Pr(Yt.paint_line["line-opacity"]),"line-color":new Pr(Yt.paint_line["line-color"]),"line-translate":new Xn(Yt.paint_line["line-translate"]),"line-translate-anchor":new Xn(Yt.paint_line["line-translate-anchor"]),"line-width":new Pr(Yt.paint_line["line-width"]),"line-gap-width":new Pr(Yt.paint_line["line-gap-width"]),"line-offset":new Pr(Yt.paint_line["line-offset"]),"line-blur":new Pr(Yt.paint_line["line-blur"]),"line-dasharray":new ju(Yt.paint_line["line-dasharray"]),"line-pattern":new vu(Yt.paint_line["line-pattern"]),"line-gradient":new _d(Yt.paint_line["line-gradient"])})},get layout(){return qp=qp||new L({"line-cap":new Xn(Yt.layout_line["line-cap"]),"line-join":new Pr(Yt.layout_line["line-join"]),"line-miter-limit":new Xn(Yt.layout_line["line-miter-limit"]),"line-round-limit":new Xn(Yt.layout_line["line-round-limit"]),"line-sort-key":new Pr(Yt.layout_line["line-sort-key"])})}};class ps extends Pr{possiblyEvaluate(l,g){return g=new ka(Math.floor(g.zoom),{now:g.now,fadeDuration:g.fadeDuration,zoomHistory:g.zoomHistory,transition:g.transition}),super.possiblyEvaluate(l,g)}evaluate(l,g,T,z){return g=qi({},g,{zoom:Math.floor(g.zoom)}),super.evaluate(l,g,T,z)}}let wc;class Hp extends x{constructor(l){super(l,xh),this.gradientVersion=0,wc||(wc=new ps(xh.paint.properties["line-width"].specification),wc.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(l){if(l==="line-gradient"){const g=this.gradientExpression();this.stepInterpolant=!!(function(T){return T._styleExpression!==void 0})(g)&&g._styleExpression.expression instanceof Mu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(l,g){super.recalculate(l,g),this.paint._values["line-floorwidth"]=wc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,l)}createBucket(l){return new Gp(l)}queryRadius(l){const g=l,T=Ul(vc("line-width",this,g),vc("line-gap-width",this,g)),z=vc("line-offset",this,g);return T/2+Math.abs(z)+Pp(this.paint.get("line-translate"))}queryIntersectsFeature(l,g,T,z,O,B,q){const Z=ap(l,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),B.angle,q),re=q/2*Ul(this.paint.get("line-width").evaluate(g,T),this.paint.get("line-gap-width").evaluate(g,T)),de=this.paint.get("line-offset").evaluate(g,T);return de&&(z=(function(ye,Ee){const Le=[];for(let qe=0;qe<ye.length;qe++){const Ke=ye[qe],yt=[];for(let Mt=0;Mt<Ke.length;Mt++){const si=Ke[Mt-1],Ut=Ke[Mt],ii=Ke[Mt+1],Pi=Mt===0?new ut(0,0):Ut.sub(si)._unit()._perp(),gn=Mt===Ke.length-1?new ut(0,0):ii.sub(Ut)._unit()._perp(),Wn=Pi._add(gn)._unit(),Er=Wn.x*gn.x+Wn.y*gn.y;Er!==0&&Wn._mult(1/Er),yt.push(Wn._mult(Ee)._add(Ut))}Le.push(yt)}return Le})(z,de*q)),(function(ye,Ee,Le){for(let qe=0;qe<Ee.length;qe++){const Ke=Ee[qe];if(ye.length>=3){for(let yt=0;yt<Ke.length;yt++)if($u(ye,Ke[yt]))return!0}if(c_(ye,Ke,Le))return!0}return!1})(Z,z,re)}isTileClipped(){return!0}}function Ul(f,l){return l>0?l+2*f:f}const gp=H([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sm=H([{name:"a_projected_pos",components:3,type:"Float32"}],4);H([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Wu=H([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);H([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vs=H([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),wl=H([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Au(f,l,g){return f.sections.forEach((T=>{T.text=(function(z,O,B){const q=O.layout.get("text-transform").evaluate(B,{});return q==="uppercase"?z=z.toLocaleUpperCase():q==="lowercase"&&(z=z.toLocaleLowerCase()),Wo.applyArabicShaping&&(z=Wo.applyArabicShaping(z)),z})(T.text,l,g)})),f}H([{name:"triangle",components:3,type:"Uint16"}]),H([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),H([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),H([{type:"Float32",name:"offsetX"}]),H([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),H([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const h={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var t=24,a=b,d=function(f,l,g,T,z){var O,B,q=8*z-T-1,Z=(1<<q)-1,re=Z>>1,de=-7,ye=z-1,Ee=-1,Le=f[l+ye];for(ye+=Ee,O=Le&(1<<-de)-1,Le>>=-de,de+=q;de>0;O=256*O+f[l+ye],ye+=Ee,de-=8);for(B=O&(1<<-de)-1,O>>=-de,de+=T;de>0;B=256*B+f[l+ye],ye+=Ee,de-=8);if(O===0)O=1-re;else{if(O===Z)return B?NaN:1/0*(Le?-1:1);B+=Math.pow(2,T),O-=re}return(Le?-1:1)*B*Math.pow(2,O-T)},y=function(f,l,g,T,z,O){var B,q,Z,re=8*O-z-1,de=(1<<re)-1,ye=de>>1,Ee=z===23?Math.pow(2,-24)-Math.pow(2,-77):0,Le=0,qe=1,Ke=l<0||l===0&&1/l<0?1:0;for(l=Math.abs(l),isNaN(l)||l===1/0?(q=isNaN(l)?1:0,B=de):(B=Math.floor(Math.log(l)/Math.LN2),l*(Z=Math.pow(2,-B))<1&&(B--,Z*=2),(l+=B+ye>=1?Ee/Z:Ee*Math.pow(2,1-ye))*Z>=2&&(B++,Z/=2),B+ye>=de?(q=0,B=de):B+ye>=1?(q=(l*Z-1)*Math.pow(2,z),B+=ye):(q=l*Math.pow(2,ye-1)*Math.pow(2,z),B=0));z>=8;f[g+Le]=255&q,Le+=qe,q/=256,z-=8);for(B=B<<z|q,re+=z;re>0;f[g+Le]=255&B,Le+=qe,B/=256,re-=8);f[g+Le-qe]|=128*Ke};function b(f){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(f)?f:new Uint8Array(f||0),this.pos=0,this.type=0,this.length=this.buf.length}b.Varint=0,b.Fixed64=1,b.Bytes=2,b.Fixed32=5;var S=4294967296,M=1/S,R=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function N(f){return f.type===b.Bytes?f.readVarint()+f.pos:f.pos+1}function U(f,l,g){return g?4294967296*l+(f>>>0):4294967296*(l>>>0)+(f>>>0)}function Y(f,l,g){var T=l<=16383?1:l<=2097151?2:l<=268435455?3:Math.floor(Math.log(l)/(7*Math.LN2));g.realloc(T);for(var z=g.pos-1;z>=f;z--)g.buf[z+T]=g.buf[z]}function X(f,l){for(var g=0;g<f.length;g++)l.writeVarint(f[g])}function Q(f,l){for(var g=0;g<f.length;g++)l.writeSVarint(f[g])}function ae(f,l){for(var g=0;g<f.length;g++)l.writeFloat(f[g])}function ie(f,l){for(var g=0;g<f.length;g++)l.writeDouble(f[g])}function _e(f,l){for(var g=0;g<f.length;g++)l.writeBoolean(f[g])}function fe(f,l){for(var g=0;g<f.length;g++)l.writeFixed32(f[g])}function Te(f,l){for(var g=0;g<f.length;g++)l.writeSFixed32(f[g])}function De(f,l){for(var g=0;g<f.length;g++)l.writeFixed64(f[g])}function Se(f,l){for(var g=0;g<f.length;g++)l.writeSFixed64(f[g])}function Ze(f,l){return(f[l]|f[l+1]<<8|f[l+2]<<16)+16777216*f[l+3]}function Ve(f,l,g){f[g]=l,f[g+1]=l>>>8,f[g+2]=l>>>16,f[g+3]=l>>>24}function Ge(f,l){return(f[l]|f[l+1]<<8|f[l+2]<<16)+(f[l+3]<<24)}b.prototype={destroy:function(){this.buf=null},readFields:function(f,l,g){for(g=g||this.length;this.pos<g;){var T=this.readVarint(),z=T>>3,O=this.pos;this.type=7&T,f(z,l,this),this.pos===O&&this.skip(T)}return l},readMessage:function(f,l){return this.readFields(f,l,this.readVarint()+this.pos)},readFixed32:function(){var f=Ze(this.buf,this.pos);return this.pos+=4,f},readSFixed32:function(){var f=Ge(this.buf,this.pos);return this.pos+=4,f},readFixed64:function(){var f=Ze(this.buf,this.pos)+Ze(this.buf,this.pos+4)*S;return this.pos+=8,f},readSFixed64:function(){var f=Ze(this.buf,this.pos)+Ge(this.buf,this.pos+4)*S;return this.pos+=8,f},readFloat:function(){var f=d(this.buf,this.pos,!0,23,4);return this.pos+=4,f},readDouble:function(){var f=d(this.buf,this.pos,!0,52,8);return this.pos+=8,f},readVarint:function(f){var l,g,T=this.buf;return l=127&(g=T[this.pos++]),g<128?l:(l|=(127&(g=T[this.pos++]))<<7,g<128?l:(l|=(127&(g=T[this.pos++]))<<14,g<128?l:(l|=(127&(g=T[this.pos++]))<<21,g<128?l:(function(z,O,B){var q,Z,re=B.buf;if(q=(112&(Z=re[B.pos++]))>>4,Z<128||(q|=(127&(Z=re[B.pos++]))<<3,Z<128)||(q|=(127&(Z=re[B.pos++]))<<10,Z<128)||(q|=(127&(Z=re[B.pos++]))<<17,Z<128)||(q|=(127&(Z=re[B.pos++]))<<24,Z<128)||(q|=(1&(Z=re[B.pos++]))<<31,Z<128))return U(z,q,O);throw new Error("Expected varint not more than 10 bytes")})(l|=(15&(g=T[this.pos]))<<28,f,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var f=this.readVarint();return f%2==1?(f+1)/-2:f/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var f=this.readVarint()+this.pos,l=this.pos;return this.pos=f,f-l>=12&&R?(function(g,T,z){return R.decode(g.subarray(T,z))})(this.buf,l,f):(function(g,T,z){for(var O="",B=T;B<z;){var q,Z,re,de=g[B],ye=null,Ee=de>239?4:de>223?3:de>191?2:1;if(B+Ee>z)break;Ee===1?de<128&&(ye=de):Ee===2?(192&(q=g[B+1]))==128&&(ye=(31&de)<<6|63&q)<=127&&(ye=null):Ee===3?(Z=g[B+2],(192&(q=g[B+1]))==128&&(192&Z)==128&&((ye=(15&de)<<12|(63&q)<<6|63&Z)<=2047||ye>=55296&&ye<=57343)&&(ye=null)):Ee===4&&(Z=g[B+2],re=g[B+3],(192&(q=g[B+1]))==128&&(192&Z)==128&&(192&re)==128&&((ye=(15&de)<<18|(63&q)<<12|(63&Z)<<6|63&re)<=65535||ye>=1114112)&&(ye=null)),ye===null?(ye=65533,Ee=1):ye>65535&&(ye-=65536,O+=String.fromCharCode(ye>>>10&1023|55296),ye=56320|1023&ye),O+=String.fromCharCode(ye),B+=Ee}return O})(this.buf,l,f)},readBytes:function(){var f=this.readVarint()+this.pos,l=this.buf.subarray(this.pos,f);return this.pos=f,l},readPackedVarint:function(f,l){if(this.type!==b.Bytes)return f.push(this.readVarint(l));var g=N(this);for(f=f||[];this.pos<g;)f.push(this.readVarint(l));return f},readPackedSVarint:function(f){if(this.type!==b.Bytes)return f.push(this.readSVarint());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readSVarint());return f},readPackedBoolean:function(f){if(this.type!==b.Bytes)return f.push(this.readBoolean());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readBoolean());return f},readPackedFloat:function(f){if(this.type!==b.Bytes)return f.push(this.readFloat());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readFloat());return f},readPackedDouble:function(f){if(this.type!==b.Bytes)return f.push(this.readDouble());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readDouble());return f},readPackedFixed32:function(f){if(this.type!==b.Bytes)return f.push(this.readFixed32());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readFixed32());return f},readPackedSFixed32:function(f){if(this.type!==b.Bytes)return f.push(this.readSFixed32());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readSFixed32());return f},readPackedFixed64:function(f){if(this.type!==b.Bytes)return f.push(this.readFixed64());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readFixed64());return f},readPackedSFixed64:function(f){if(this.type!==b.Bytes)return f.push(this.readSFixed64());var l=N(this);for(f=f||[];this.pos<l;)f.push(this.readSFixed64());return f},skip:function(f){var l=7&f;if(l===b.Varint)for(;this.buf[this.pos++]>127;);else if(l===b.Bytes)this.pos=this.readVarint()+this.pos;else if(l===b.Fixed32)this.pos+=4;else{if(l!==b.Fixed64)throw new Error("Unimplemented type: "+l);this.pos+=8}},writeTag:function(f,l){this.writeVarint(f<<3|l)},realloc:function(f){for(var l=this.length||16;l<this.pos+f;)l*=2;if(l!==this.length){var g=new Uint8Array(l);g.set(this.buf),this.buf=g,this.length=l}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(f){this.realloc(4),Ve(this.buf,f,this.pos),this.pos+=4},writeSFixed32:function(f){this.realloc(4),Ve(this.buf,f,this.pos),this.pos+=4},writeFixed64:function(f){this.realloc(8),Ve(this.buf,-1&f,this.pos),Ve(this.buf,Math.floor(f*M),this.pos+4),this.pos+=8},writeSFixed64:function(f){this.realloc(8),Ve(this.buf,-1&f,this.pos),Ve(this.buf,Math.floor(f*M),this.pos+4),this.pos+=8},writeVarint:function(f){(f=+f||0)>268435455||f<0?(function(l,g){var T,z;if(l>=0?(T=l%4294967296|0,z=l/4294967296|0):(z=~(-l/4294967296),4294967295^(T=~(-l%4294967296))?T=T+1|0:(T=0,z=z+1|0)),l>=18446744073709552e3||l<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");g.realloc(10),(function(O,B,q){q.buf[q.pos++]=127&O|128,O>>>=7,q.buf[q.pos++]=127&O|128,O>>>=7,q.buf[q.pos++]=127&O|128,O>>>=7,q.buf[q.pos++]=127&O|128,q.buf[q.pos]=127&(O>>>=7)})(T,0,g),(function(O,B){var q=(7&O)<<4;B.buf[B.pos++]|=q|((O>>>=3)?128:0),O&&(B.buf[B.pos++]=127&O|((O>>>=7)?128:0),O&&(B.buf[B.pos++]=127&O|((O>>>=7)?128:0),O&&(B.buf[B.pos++]=127&O|((O>>>=7)?128:0),O&&(B.buf[B.pos++]=127&O|((O>>>=7)?128:0),O&&(B.buf[B.pos++]=127&O)))))})(z,g)})(f,this):(this.realloc(4),this.buf[this.pos++]=127&f|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=127&(f>>>=7)|(f>127?128:0),f<=127||(this.buf[this.pos++]=f>>>7&127))))},writeSVarint:function(f){this.writeVarint(f<0?2*-f-1:2*f)},writeBoolean:function(f){this.writeVarint(!!f)},writeString:function(f){f=String(f),this.realloc(4*f.length),this.pos++;var l=this.pos;this.pos=(function(T,z,O){for(var B,q,Z=0;Z<z.length;Z++){if((B=z.charCodeAt(Z))>55295&&B<57344){if(!q){B>56319||Z+1===z.length?(T[O++]=239,T[O++]=191,T[O++]=189):q=B;continue}if(B<56320){T[O++]=239,T[O++]=191,T[O++]=189,q=B;continue}B=q-55296<<10|B-56320|65536,q=null}else q&&(T[O++]=239,T[O++]=191,T[O++]=189,q=null);B<128?T[O++]=B:(B<2048?T[O++]=B>>6|192:(B<65536?T[O++]=B>>12|224:(T[O++]=B>>18|240,T[O++]=B>>12&63|128),T[O++]=B>>6&63|128),T[O++]=63&B|128)}return O})(this.buf,f,this.pos);var g=this.pos-l;g>=128&&Y(l,g,this),this.pos=l-1,this.writeVarint(g),this.pos+=g},writeFloat:function(f){this.realloc(4),y(this.buf,f,this.pos,!0,23,4),this.pos+=4},writeDouble:function(f){this.realloc(8),y(this.buf,f,this.pos,!0,52,8),this.pos+=8},writeBytes:function(f){var l=f.length;this.writeVarint(l),this.realloc(l);for(var g=0;g<l;g++)this.buf[this.pos++]=f[g]},writeRawMessage:function(f,l){this.pos++;var g=this.pos;f(l,this);var T=this.pos-g;T>=128&&Y(g,T,this),this.pos=g-1,this.writeVarint(T),this.pos+=T},writeMessage:function(f,l,g){this.writeTag(f,b.Bytes),this.writeRawMessage(l,g)},writePackedVarint:function(f,l){l.length&&this.writeMessage(f,X,l)},writePackedSVarint:function(f,l){l.length&&this.writeMessage(f,Q,l)},writePackedBoolean:function(f,l){l.length&&this.writeMessage(f,_e,l)},writePackedFloat:function(f,l){l.length&&this.writeMessage(f,ae,l)},writePackedDouble:function(f,l){l.length&&this.writeMessage(f,ie,l)},writePackedFixed32:function(f,l){l.length&&this.writeMessage(f,fe,l)},writePackedSFixed32:function(f,l){l.length&&this.writeMessage(f,Te,l)},writePackedFixed64:function(f,l){l.length&&this.writeMessage(f,De,l)},writePackedSFixed64:function(f,l){l.length&&this.writeMessage(f,Se,l)},writeBytesField:function(f,l){this.writeTag(f,b.Bytes),this.writeBytes(l)},writeFixed32Field:function(f,l){this.writeTag(f,b.Fixed32),this.writeFixed32(l)},writeSFixed32Field:function(f,l){this.writeTag(f,b.Fixed32),this.writeSFixed32(l)},writeFixed64Field:function(f,l){this.writeTag(f,b.Fixed64),this.writeFixed64(l)},writeSFixed64Field:function(f,l){this.writeTag(f,b.Fixed64),this.writeSFixed64(l)},writeVarintField:function(f,l){this.writeTag(f,b.Varint),this.writeVarint(l)},writeSVarintField:function(f,l){this.writeTag(f,b.Varint),this.writeSVarint(l)},writeStringField:function(f,l){this.writeTag(f,b.Bytes),this.writeString(l)},writeFloatField:function(f,l){this.writeTag(f,b.Fixed32),this.writeFloat(l)},writeDoubleField:function(f,l){this.writeTag(f,b.Fixed64),this.writeDouble(l)},writeBooleanField:function(f,l){this.writeVarintField(f,!!l)}};var Fe=tt(a);const Oe=3;function it(f,l,g){f===1&&g.readMessage(ft,l)}function ft(f,l,g){if(f===3){const{id:T,bitmap:z,width:O,height:B,left:q,top:Z,advance:re}=g.readMessage(ht,{});l.push({id:T,bitmap:new bc({width:O+2*Oe,height:B+2*Oe},z),metrics:{width:O,height:B,left:q,top:Z,advance:re}})}}function ht(f,l,g){f===1?l.id=g.readVarint():f===2?l.bitmap=g.readBytes():f===3?l.width=g.readVarint():f===4?l.height=g.readVarint():f===5?l.left=g.readSVarint():f===6?l.top=g.readSVarint():f===7&&(l.advance=g.readVarint())}const St=Oe;function It(f){let l=0,g=0;for(const B of f)l+=B.w*B.h,g=Math.max(g,B.w);f.sort(((B,q)=>q.h-B.h));const T=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(l/.95)),g),h:1/0}];let z=0,O=0;for(const B of f)for(let q=T.length-1;q>=0;q--){const Z=T[q];if(!(B.w>Z.w||B.h>Z.h)){if(B.x=Z.x,B.y=Z.y,O=Math.max(O,B.y+B.h),z=Math.max(z,B.x+B.w),B.w===Z.w&&B.h===Z.h){const re=T.pop();q<T.length&&(T[q]=re)}else B.h===Z.h?(Z.x+=B.w,Z.w-=B.w):B.w===Z.w?(Z.y+=B.h,Z.h-=B.h):(T.push({x:Z.x+B.w,y:Z.y,w:Z.w-B.w,h:B.h}),Z.y+=B.h,Z.h-=B.h);break}}return{w:z,h:O,fill:l/(z*O)||0}}const zt=1;class Jt{constructor(l,{pixelRatio:g,version:T,stretchX:z,stretchY:O,content:B,textFitWidth:q,textFitHeight:Z}){this.paddedRect=l,this.pixelRatio=g,this.stretchX=z,this.stretchY=O,this.content=B,this.version=T,this.textFitWidth=q,this.textFitHeight=Z}get tl(){return[this.paddedRect.x+zt,this.paddedRect.y+zt]}get br(){return[this.paddedRect.x+this.paddedRect.w-zt,this.paddedRect.y+this.paddedRect.h-zt]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*zt)/this.pixelRatio,(this.paddedRect.h-2*zt)/this.pixelRatio]}}class gt{constructor(l,g){const T={},z={};this.haveRenderCallbacks=[];const O=[];this.addImages(l,T,O),this.addImages(g,z,O);const{w:B,h:q}=It(O),Z=new go({width:B||1,height:q||1});for(const re in l){const de=l[re],ye=T[re].paddedRect;go.copy(de.data,Z,{x:0,y:0},{x:ye.x+zt,y:ye.y+zt},de.data)}for(const re in g){const de=g[re],ye=z[re].paddedRect,Ee=ye.x+zt,Le=ye.y+zt,qe=de.data.width,Ke=de.data.height;go.copy(de.data,Z,{x:0,y:0},{x:Ee,y:Le},de.data),go.copy(de.data,Z,{x:0,y:Ke-1},{x:Ee,y:Le-1},{width:qe,height:1}),go.copy(de.data,Z,{x:0,y:0},{x:Ee,y:Le+Ke},{width:qe,height:1}),go.copy(de.data,Z,{x:qe-1,y:0},{x:Ee-1,y:Le},{width:1,height:Ke}),go.copy(de.data,Z,{x:0,y:0},{x:Ee+qe,y:Le},{width:1,height:Ke})}this.image=Z,this.iconPositions=T,this.patternPositions=z}addImages(l,g,T){for(const z in l){const O=l[z],B={x:0,y:0,w:O.data.width+2*zt,h:O.data.height+2*zt};T.push(B),g[z]=new Jt(B,O),O.hasRenderCallback&&this.haveRenderCallbacks.push(z)}}patchUpdatedImages(l,g){l.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const T in l.updatedImages)this.patchUpdatedImage(this.iconPositions[T],l.getImage(T),g),this.patchUpdatedImage(this.patternPositions[T],l.getImage(T),g)}patchUpdatedImage(l,g,T){if(!l||!g||l.version===g.version)return;l.version=g.version;const[z,O]=l.tl;T.update(g.data,void 0,{x:z,y:O})}}var nt;fn("ImagePosition",Jt),fn("ImageAtlas",gt),le.ah=void 0,(nt=le.ah||(le.ah={}))[nt.none=0]="none",nt[nt.horizontal=1]="horizontal",nt[nt.vertical=2]="vertical",nt[nt.horizontalOnly=3]="horizontalOnly";const Bt=-17;class Dt{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(l,g){const T=new Dt;return T.scale=l||1,T.fontStack=g,T}static forImage(l){const g=new Dt;return g.imageName=l,g}}class li{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(l,g){const T=new li;for(let z=0;z<l.sections.length;z++){const O=l.sections[z];O.image?T.addImageSection(O):T.addTextSection(O,g)}return T}length(){return this.text.length}getSection(l){return this.sections[this.sectionIndex[l]]}getSectionIndex(l){return this.sectionIndex[l]}getCharCode(l){return this.text.charCodeAt(l)}verticalizePunctuation(){this.text=(function(l){let g="";for(let T=0;T<l.length;T++){const z=l.charCodeAt(T+1)||null,O=l.charCodeAt(T-1)||null;g+=z&&hh(z)&&!h[l[T+1]]||O&&hh(O)&&!h[l[T-1]]||!h[l[T]]?l[T]:h[l[T]]}return g})(this.text)}trim(){let l=0;for(let T=0;T<this.text.length&&Ri[this.text.charCodeAt(T)];T++)l++;let g=this.text.length;for(let T=this.text.length-1;T>=0&&T>=l&&Ri[this.text.charCodeAt(T)];T--)g--;this.text=this.text.substring(l,g),this.sectionIndex=this.sectionIndex.slice(l,g)}substring(l,g){const T=new li;return T.text=this.text.substring(l,g),T.sectionIndex=this.sectionIndex.slice(l,g),T.sections=this.sections,T}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((l,g)=>Math.max(l,this.sections[g].scale)),0)}addTextSection(l,g){this.text+=l.text,this.sections.push(Dt.forText(l.scale,l.fontStack||g));const T=this.sections.length-1;for(let z=0;z<l.text.length;++z)this.sectionIndex.push(T)}addImageSection(l){const g=l.image?l.image.name:"";if(g.length===0)return void an("Can't add FormattedSection with an empty image.");const T=this.getNextImageSectionCharCode();T?(this.text+=String.fromCharCode(T),this.sections.push(Dt.forImage(g)),this.sectionIndex.push(this.sections.length-1)):an("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ei(f,l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le,qe){const Ke=li.fromFeature(f,z);let yt;ye===le.ah.vertical&&Ke.verticalizePunctuation();const{processBidirectionalText:Mt,processStyledBidirectionalText:si}=Wo;if(Mt&&Ke.sections.length===1){yt=[];const Pi=Mt(Ke.toString(),rr(Ke,re,O,l,T,Le));for(const gn of Pi){const Wn=new li;Wn.text=gn,Wn.sections=Ke.sections;for(let Er=0;Er<gn.length;Er++)Wn.sectionIndex.push(0);yt.push(Wn)}}else if(si){yt=[];const Pi=si(Ke.text,Ke.sectionIndex,rr(Ke,re,O,l,T,Le));for(const gn of Pi){const Wn=new li;Wn.text=gn[0],Wn.sectionIndex=gn[1],Wn.sections=Ke.sections,yt.push(Wn)}}else yt=(function(Pi,gn){const Wn=[],Er=Pi.text;let Fn=0;for(const In of gn)Wn.push(Pi.substring(Fn,In)),Fn=In;return Fn<Er.length&&Wn.push(Pi.substring(Fn,Er.length)),Wn})(Ke,rr(Ke,re,O,l,T,Le));const Ut=[],ii={positionedLines:Ut,text:Ke.toString(),top:de[1],bottom:de[1],left:de[0],right:de[0],writingMode:ye,iconsInText:!1,verticalizable:!1};return(function(Pi,gn,Wn,Er,Fn,In,xr,or,nr,Gi,sr,vr){let ia=0,ms=Bt,eo=0,Sl=0;const Nc=or==="right"?1:or==="left"?0:.5;let rc=0;for(const il of Fn){il.trim();const ac=il.getMaxScale(),nu=(ac-1)*t,Ec={positionedGlyphs:[],lineOffset:0};Pi.positionedLines[rc]=Ec;const Hl=Ec.positionedGlyphs;let El=0;if(!il.length()){ms+=In,++rc;continue}for(let Qu=0;Qu<il.length();Qu++){const rs=il.getSection(Qu),Ds=il.getSectionIndex(Qu),vo=il.getCharCode(Qu);let Vc=0,bo=null,Zf=null,eh=null,Th=t;const Sh=!(nr===le.ah.horizontal||!sr&&!uh(vo)||sr&&(Ri[vo]||(ql=vo,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(ql)))));if(rs.imageName){const Yh=Er[rs.imageName];if(!Yh)continue;eh=rs.imageName,Pi.iconsInText=Pi.iconsInText||!0,Zf=Yh.paddedRect;const Al=Yh.displaySize;rs.scale=rs.scale*t/vr,bo={width:Al[0],height:Al[1],left:zt,top:-St,advance:Sh?Al[1]:Al[0]},Vc=nu+(t-Al[1]*rs.scale),Th=bo.advance;const Sf=Sh?Al[0]*rs.scale-t*ac:Al[1]*rs.scale-t*ac;Sf>0&&Sf>El&&(El=Sf)}else{const Yh=Wn[rs.fontStack],Al=Yh&&Yh[vo];if(Al&&Al.rect)Zf=Al.rect,bo=Al.metrics;else{const Sf=gn[rs.fontStack],vp=Sf&&Sf[vo];if(!vp)continue;bo=vp.metrics}Vc=(ac-rs.scale)*t}Sh?(Pi.verticalizable=!0,Hl.push({glyph:vo,imageName:eh,x:ia,y:ms+Vc,vertical:Sh,scale:rs.scale,fontStack:rs.fontStack,sectionIndex:Ds,metrics:bo,rect:Zf}),ia+=Th*rs.scale+Gi):(Hl.push({glyph:vo,imageName:eh,x:ia,y:ms+Vc,vertical:Sh,scale:rs.scale,fontStack:rs.fontStack,sectionIndex:Ds,metrics:bo,rect:Zf}),ia+=bo.advance*rs.scale+Gi)}Hl.length!==0&&(eo=Math.max(ia-Gi,eo),ba(Hl,0,Hl.length-1,Nc,El)),ia=0;const wh=In*ac+El;Ec.lineOffset=Math.max(El,nu),ms+=wh,Sl=Math.max(wh,Sl),++rc}var ql;const iu=ms-Bt,{horizontalAlign:Sc,verticalAlign:tl}=Br(xr);(function(il,ac,nu,Ec,Hl,El,wh,Qu,rs){const Ds=(ac-nu)*Hl;let vo=0;vo=El!==wh?-Qu*Ec-Bt:(-Ec*rs+.5)*wh;for(const Vc of il)for(const bo of Vc.positionedGlyphs)bo.x+=Ds,bo.y+=vo})(Pi.positionedLines,Nc,Sc,tl,eo,Sl,In,iu,Fn.length),Pi.top+=-tl*iu,Pi.bottom=Pi.top+iu,Pi.left+=-Sc*eo,Pi.right=Pi.left+eo})(ii,l,g,T,yt,B,q,Z,ye,re,Ee,qe),!(function(Pi){for(const gn of Pi)if(gn.positionedGlyphs.length!==0)return!1;return!0})(Ut)&&ii}const Ri={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ti={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},mi={40:!0};function pn(f,l,g,T,z,O){if(l.imageName){const B=T[l.imageName];return B?B.displaySize[0]*l.scale*t/O+z:0}{const B=g[l.fontStack],q=B&&B[f];return q?q.metrics.advance*l.scale+z:0}}function en(f,l,g,T){const z=Math.pow(f-l,2);return T?f<l?z/2:2*z:z+Math.abs(g)*g}function ji(f,l,g){let T=0;return f===10&&(T-=1e4),g&&(T+=150),f!==40&&f!==65288||(T+=50),l!==41&&l!==65289||(T+=50),T}function Qi(f,l,g,T,z,O){let B=null,q=en(l,g,z,O);for(const Z of T){const re=en(l-Z.x,g,z,O)+Z.badness;re<=q&&(B=Z,q=re)}return{index:f,x:l,priorBreak:B,badness:q}}function vn(f){return f?vn(f.priorBreak).concat(f.index):[]}function rr(f,l,g,T,z,O){if(!f)return[];const B=[],q=(function(ye,Ee,Le,qe,Ke,yt){let Mt=0;for(let si=0;si<ye.length();si++){const Ut=ye.getSection(si);Mt+=pn(ye.getCharCode(si),Ut,qe,Ke,Ee,yt)}return Mt/Math.max(1,Math.ceil(Mt/Le))})(f,l,g,T,z,O),Z=f.text.indexOf("")>=0;let re=0;for(let ye=0;ye<f.length();ye++){const Ee=f.getSection(ye),Le=f.getCharCode(ye);if(Ri[Le]||(re+=pn(Le,Ee,T,z,l,O)),ye<f.length()-1){const qe=!((de=Le)<11904)&&(!!Ia["CJK Compatibility Forms"](de)||!!Ia["CJK Compatibility"](de)||!!Ia["CJK Strokes"](de)||!!Ia["CJK Symbols and Punctuation"](de)||!!Ia["Enclosed CJK Letters and Months"](de)||!!Ia["Halfwidth and Fullwidth Forms"](de)||!!Ia["Ideographic Description Characters"](de)||!!Ia["Vertical Forms"](de)||Uu.test(String.fromCodePoint(de)));(Ti[Le]||qe||Ee.imageName||ye!==f.length()-2&&mi[f.getCharCode(ye+1)])&&B.push(Qi(ye+1,re,q,B,ji(Le,f.getCharCode(ye+1),qe&&Z),!1))}}var de;return vn(Qi(f.length(),re,q,B,0,!0))}function Br(f){let l=.5,g=.5;switch(f){case"right":case"top-right":case"bottom-right":l=1;break;case"left":case"top-left":case"bottom-left":l=0}switch(f){case"bottom":case"bottom-right":case"bottom-left":g=1;break;case"top":case"top-right":case"top-left":g=0}return{horizontalAlign:l,verticalAlign:g}}function ba(f,l,g,T,z){if(!T&&!z)return;const O=f[g],B=(f[g].x+O.metrics.advance*O.scale)*T;for(let q=l;q<=g;q++)f[q].x-=B,f[q].y+=z}function _n(f,l,g){const{horizontalAlign:T,verticalAlign:z}=Br(g),O=l[0]-f.displaySize[0]*T,B=l[1]-f.displaySize[1]*z;return{image:f,top:B,bottom:B+f.displaySize[1],left:O,right:O+f.displaySize[0]}}function aa(f){var l,g;let T=f.left,z=f.top,O=f.right-T,B=f.bottom-z;const q=(l=f.image.textFitWidth)!==null&&l!==void 0?l:"stretchOrShrink",Z=(g=f.image.textFitHeight)!==null&&g!==void 0?g:"stretchOrShrink",re=(f.image.content[2]-f.image.content[0])/(f.image.content[3]-f.image.content[1]);if(Z==="proportional"){if(q==="stretchOnly"&&O/B<re||q==="proportional"){const de=Math.ceil(B*re);T*=de/O,O=de}}else if(q==="proportional"&&Z==="stretchOnly"&&re!==0&&O/B>re){const de=Math.ceil(O/re);z*=de/B,B=de}return{x1:T,y1:z,x2:T+O,y2:z+B}}function Qn(f,l,g,T,z,O){const B=f.image;let q;if(B.content){const yt=B.content,Mt=B.pixelRatio||1;q=[yt[0]/Mt,yt[1]/Mt,B.displaySize[0]-yt[2]/Mt,B.displaySize[1]-yt[3]/Mt]}const Z=l.left*O,re=l.right*O;let de,ye,Ee,Le;g==="width"||g==="both"?(Le=z[0]+Z-T[3],ye=z[0]+re+T[1]):(Le=z[0]+(Z+re-B.displaySize[0])/2,ye=Le+B.displaySize[0]);const qe=l.top*O,Ke=l.bottom*O;return g==="height"||g==="both"?(de=z[1]+qe-T[0],Ee=z[1]+Ke+T[2]):(de=z[1]+(qe+Ke-B.displaySize[1])/2,Ee=de+B.displaySize[1]),{image:B,top:de,right:ye,bottom:Ee,left:Le,collisionPadding:q}}const yr=255,Gr=128,Kr=yr*Gr;function qr(f,l){const{expression:g}=l;if(g.kind==="constant")return{kind:"constant",layoutSize:g.evaluate(new ka(f+1))};if(g.kind==="source")return{kind:"source"};{const{zoomStops:T,interpolationType:z}=g;let O=0;for(;O<T.length&&T[O]<=f;)O++;O=Math.max(0,O-1);let B=O;for(;B<T.length&&T[B]<f+1;)B++;B=Math.min(T.length-1,B);const q=T[O],Z=T[B];return g.kind==="composite"?{kind:"composite",minZoom:q,maxZoom:Z,interpolationType:z}:{kind:"camera",minZoom:q,maxZoom:Z,minSize:g.evaluate(new ka(q)),maxSize:g.evaluate(new ka(Z)),interpolationType:z}}}function mr(f,l,g){let T="never";const z=f.get(l);return z?T=z:f.get(g)&&(T="always"),T}const wa=mh.VectorTileFeature.types,Bs=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ga(f,l,g,T,z,O,B,q,Z,re,de,ye,Ee){const Le=q?Math.min(Kr,Math.round(q[0])):0,qe=q?Math.min(Kr,Math.round(q[1])):0;f.emplaceBack(l,g,Math.round(32*T),Math.round(32*z),O,B,(Le<<1)+(Z?1:0),qe,16*re,16*de,256*ye,256*Ee)}function ya(f,l,g){f.emplaceBack(l.x,l.y,g),f.emplaceBack(l.x,l.y,g),f.emplaceBack(l.x,l.y,g),f.emplaceBack(l.x,l.y,g)}function Sr(f){for(const l of f.sections)if(tf(l.text))return!0;return!1}class gr{constructor(l){this.layoutVertexArray=new bu,this.indexArray=new Yo,this.programConfigurations=l,this.segments=new Ba,this.dynamicLayoutVertexArray=new Vl,this.opacityVertexArray=new di,this.hasVisibleVertices=!1,this.placedSymbolArray=new Qa}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(l,g,T,z){this.isEmpty()||(T&&(this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,gp.members),this.indexBuffer=l.createIndexBuffer(this.indexArray,g),this.dynamicLayoutVertexBuffer=l.createVertexBuffer(this.dynamicLayoutVertexArray,Sm.members,!0),this.opacityVertexBuffer=l.createVertexBuffer(this.opacityVertexArray,Bs,!0),this.opacityVertexBuffer.itemSize=1),(T||z)&&this.programConfigurations.upload(l))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}fn("SymbolBuffers",gr);class fa{constructor(l,g,T){this.layoutVertexArray=new l,this.layoutAttributes=g,this.indexArray=new T,this.segments=new Ba,this.collisionVertexArray=new fs}upload(l){this.layoutVertexBuffer=l.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=l.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=l.createVertexBuffer(this.collisionVertexArray,Wu.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}fn("CollisionBuffers",fa);class bs{constructor(l){this.collisionBoxArray=l.collisionBoxArray,this.zoom=l.zoom,this.overscaling=l.overscaling,this.layers=l.layers,this.layerIds=this.layers.map((B=>B.id)),this.index=l.index,this.pixelRatio=l.pixelRatio,this.sourceLayerIndex=l.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=uf([]),this.placementViewportMatrix=uf([]);const g=this.layers[0]._unevaluatedLayout._values;this.textSizeData=qr(this.zoom,g["text-size"]),this.iconSizeData=qr(this.zoom,g["icon-size"]);const T=this.layers[0].layout,z=T.get("symbol-sort-key"),O=T.get("symbol-z-order");this.canOverlap=mr(T,"text-overlap","text-allow-overlap")!=="never"||mr(T,"icon-overlap","icon-allow-overlap")!=="never"||T.get("text-ignore-placement")||T.get("icon-ignore-placement"),this.sortFeaturesByKey=O!=="viewport-y"&&!z.isConstant(),this.sortFeaturesByY=(O==="viewport-y"||O==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,T.get("symbol-placement")==="point"&&(this.writingModes=T.get("text-writing-mode").map((B=>le.ah[B]))),this.stateDependentLayerIds=this.layers.filter((B=>B.isStateDependent())).map((B=>B.id)),this.sourceID=l.sourceID}createArrays(){this.text=new gr(new xi(this.layers,this.zoom,(l=>/^text/.test(l)))),this.icon=new gr(new xi(this.layers,this.zoom,(l=>/^icon/.test(l)))),this.glyphOffsetArray=new Ls,this.lineVertexArray=new ol,this.symbolInstances=new Za,this.textAnchorOffsets=new ks}calculateGlyphDependencies(l,g,T,z,O){for(let B=0;B<l.length;B++)if(g[l.charCodeAt(B)]=!0,(T||z)&&O){const q=h[l.charAt(B)];q&&(g[q.charCodeAt(0)]=!0)}}populate(l,g,T){const z=this.layers[0],O=z.layout,B=O.get("text-font"),q=O.get("text-field"),Z=O.get("icon-image"),re=(q.value.kind!=="constant"||q.value.value instanceof $n&&!q.value.value.isEmpty()||q.value.value.toString().length>0)&&(B.value.kind!=="constant"||B.value.value.length>0),de=Z.value.kind!=="constant"||!!Z.value.value||Object.keys(Z.parameters).length>0,ye=O.get("symbol-sort-key");if(this.features=[],!re&&!de)return;const Ee=g.iconDependencies,Le=g.glyphDependencies,qe=g.availableImages,Ke=new ka(this.zoom);for(const{feature:yt,id:Mt,index:si,sourceLayerIndex:Ut}of l){const ii=z._featureFilter.needGeometry,Pi=xc(yt,ii);if(!z._featureFilter.filter(Ke,Pi,T))continue;let gn,Wn;if(ii||(Pi.geometry=qh(yt)),re){const Fn=z.getValueAndResolveTokens("text-field",Pi,T,qe),In=$n.factory(Fn),xr=this.hasRTLText=this.hasRTLText||Sr(In);(!xr||Wo.getRTLTextPluginStatus()==="unavailable"||xr&&Wo.isParsed())&&(gn=Au(In,z,Pi))}if(de){const Fn=z.getValueAndResolveTokens("icon-image",Pi,T,qe);Wn=Fn instanceof Ja?Fn:Ja.fromString(Fn)}if(!gn&&!Wn)continue;const Er=this.sortFeaturesByKey?ye.evaluate(Pi,{},T):void 0;if(this.features.push({id:Mt,text:gn,icon:Wn,index:si,sourceLayerIndex:Ut,geometry:Pi.geometry,properties:yt.properties,type:wa[yt.type],sortKey:Er}),Wn&&(Ee[Wn.name]=!0),gn){const Fn=B.evaluate(Pi,{},T).join(","),In=O.get("text-rotation-alignment")!=="viewport"&&O.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(le.ah.vertical)>=0;for(const xr of gn.sections)if(xr.image)Ee[xr.image.name]=!0;else{const or=Yc(gn.toString()),nr=xr.fontStack||Fn,Gi=Le[nr]=Le[nr]||{};this.calculateGlyphDependencies(xr.text,Gi,In,this.allowVerticalPlacement,or)}}}O.get("symbol-placement")==="line"&&(this.features=(function(yt){const Mt={},si={},Ut=[];let ii=0;function Pi(Fn){Ut.push(yt[Fn]),ii++}function gn(Fn,In,xr){const or=si[Fn];return delete si[Fn],si[In]=or,Ut[or].geometry[0].pop(),Ut[or].geometry[0]=Ut[or].geometry[0].concat(xr[0]),or}function Wn(Fn,In,xr){const or=Mt[In];return delete Mt[In],Mt[Fn]=or,Ut[or].geometry[0].shift(),Ut[or].geometry[0]=xr[0].concat(Ut[or].geometry[0]),or}function Er(Fn,In,xr){const or=xr?In[0][In[0].length-1]:In[0][0];return`${Fn}:${or.x}:${or.y}`}for(let Fn=0;Fn<yt.length;Fn++){const In=yt[Fn],xr=In.geometry,or=In.text?In.text.toString():null;if(!or){Pi(Fn);continue}const nr=Er(or,xr),Gi=Er(or,xr,!0);if(nr in si&&Gi in Mt&&si[nr]!==Mt[Gi]){const sr=Wn(nr,Gi,xr),vr=gn(nr,Gi,Ut[sr].geometry);delete Mt[nr],delete si[Gi],si[Er(or,Ut[vr].geometry,!0)]=vr,Ut[sr].geometry=null}else nr in si?gn(nr,Gi,xr):Gi in Mt?Wn(nr,Gi,xr):(Pi(Fn),Mt[nr]=ii-1,si[Gi]=ii-1)}return Ut.filter((Fn=>Fn.geometry))})(this.features)),this.sortFeaturesByKey&&this.features.sort(((yt,Mt)=>yt.sortKey-Mt.sortKey))}update(l,g,T){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(l,g,this.layers,T),this.icon.programConfigurations.updatePaintArrays(l,g,this.layers,T))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(l){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(l),this.iconCollisionBox.upload(l)),this.text.upload(l,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(l,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(l,g){const T=this.lineVertexArray.length;if(l.segment!==void 0){let z=l.dist(g[l.segment+1]),O=l.dist(g[l.segment]);const B={};for(let q=l.segment+1;q<g.length;q++)B[q]={x:g[q].x,y:g[q].y,tileUnitDistanceFromAnchor:z},q<g.length-1&&(z+=g[q+1].dist(g[q]));for(let q=l.segment||0;q>=0;q--)B[q]={x:g[q].x,y:g[q].y,tileUnitDistanceFromAnchor:O},q>0&&(O+=g[q-1].dist(g[q]));for(let q=0;q<g.length;q++){const Z=B[q];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:T,lineLength:this.lineVertexArray.length-T}}addSymbols(l,g,T,z,O,B,q,Z,re,de,ye,Ee){const Le=l.indexArray,qe=l.layoutVertexArray,Ke=l.segments.prepareSegment(4*g.length,qe,Le,this.canOverlap?B.sortKey:void 0),yt=this.glyphOffsetArray.length,Mt=Ke.vertexLength,si=this.allowVerticalPlacement&&q===le.ah.vertical?Math.PI/2:0,Ut=B.text&&B.text.sections;for(let ii=0;ii<g.length;ii++){const{tl:Pi,tr:gn,bl:Wn,br:Er,tex:Fn,pixelOffsetTL:In,pixelOffsetBR:xr,minFontScaleX:or,minFontScaleY:nr,glyphOffset:Gi,isSDF:sr,sectionIndex:vr}=g[ii],ia=Ke.vertexLength,ms=Gi[1];Ga(qe,Z.x,Z.y,Pi.x,ms+Pi.y,Fn.x,Fn.y,T,sr,In.x,In.y,or,nr),Ga(qe,Z.x,Z.y,gn.x,ms+gn.y,Fn.x+Fn.w,Fn.y,T,sr,xr.x,In.y,or,nr),Ga(qe,Z.x,Z.y,Wn.x,ms+Wn.y,Fn.x,Fn.y+Fn.h,T,sr,In.x,xr.y,or,nr),Ga(qe,Z.x,Z.y,Er.x,ms+Er.y,Fn.x+Fn.w,Fn.y+Fn.h,T,sr,xr.x,xr.y,or,nr),ya(l.dynamicLayoutVertexArray,Z,si),Le.emplaceBack(ia,ia+1,ia+2),Le.emplaceBack(ia+1,ia+2,ia+3),Ke.vertexLength+=4,Ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Gi[0]),ii!==g.length-1&&vr===g[ii+1].sectionIndex||l.programConfigurations.populatePaintArrays(qe.length,B,B.index,{},Ee,Ut&&Ut[vr])}l.placedSymbolArray.emplaceBack(Z.x,Z.y,yt,this.glyphOffsetArray.length-yt,Mt,re,de,Z.segment,T?T[0]:0,T?T[1]:0,z[0],z[1],q,0,!1,0,ye)}_addCollisionDebugVertex(l,g,T,z,O,B){return g.emplaceBack(0,0),l.emplaceBack(T.x,T.y,z,O,Math.round(B.x),Math.round(B.y))}addCollisionDebugVertices(l,g,T,z,O,B,q){const Z=O.segments.prepareSegment(4,O.layoutVertexArray,O.indexArray),re=Z.vertexLength,de=O.layoutVertexArray,ye=O.collisionVertexArray,Ee=q.anchorX,Le=q.anchorY;this._addCollisionDebugVertex(de,ye,B,Ee,Le,new ut(l,g)),this._addCollisionDebugVertex(de,ye,B,Ee,Le,new ut(T,g)),this._addCollisionDebugVertex(de,ye,B,Ee,Le,new ut(T,z)),this._addCollisionDebugVertex(de,ye,B,Ee,Le,new ut(l,z)),Z.vertexLength+=4;const qe=O.indexArray;qe.emplaceBack(re,re+1),qe.emplaceBack(re+1,re+2),qe.emplaceBack(re+2,re+3),qe.emplaceBack(re+3,re),Z.primitiveLength+=4}addDebugCollisionBoxes(l,g,T,z){for(let O=l;O<g;O++){const B=this.collisionBoxArray.get(O);this.addCollisionDebugVertices(B.x1,B.y1,B.x2,B.y2,z?this.textCollisionBox:this.iconCollisionBox,B.anchorPoint,T)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new fa(Oa,vs.members,mn),this.iconCollisionBox=new fa(Oa,vs.members,mn);for(let l=0;l<this.symbolInstances.length;l++){const g=this.symbolInstances.get(l);this.addDebugCollisionBoxes(g.textBoxStartIndex,g.textBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g,!0),this.addDebugCollisionBoxes(g.iconBoxStartIndex,g.iconBoxEndIndex,g,!1),this.addDebugCollisionBoxes(g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g,!1)}}_deserializeCollisionBoxesForSymbol(l,g,T,z,O,B,q,Z,re){const de={};for(let ye=g;ye<T;ye++){const Ee=l.get(ye);de.textBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},de.textFeatureIndex=Ee.featureIndex;break}for(let ye=z;ye<O;ye++){const Ee=l.get(ye);de.verticalTextBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},de.verticalTextFeatureIndex=Ee.featureIndex;break}for(let ye=B;ye<q;ye++){const Ee=l.get(ye);de.iconBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},de.iconFeatureIndex=Ee.featureIndex;break}for(let ye=Z;ye<re;ye++){const Ee=l.get(ye);de.verticalIconBox={x1:Ee.x1,y1:Ee.y1,x2:Ee.x2,y2:Ee.y2,anchorPointX:Ee.anchorPointX,anchorPointY:Ee.anchorPointY},de.verticalIconFeatureIndex=Ee.featureIndex;break}return de}deserializeCollisionBoxes(l){this.collisionArrays=[];for(let g=0;g<this.symbolInstances.length;g++){const T=this.symbolInstances.get(g);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(l,T.textBoxStartIndex,T.textBoxEndIndex,T.verticalTextBoxStartIndex,T.verticalTextBoxEndIndex,T.iconBoxStartIndex,T.iconBoxEndIndex,T.verticalIconBoxStartIndex,T.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(l,g){const T=l.placedSymbolArray.get(g),z=T.vertexStartIndex+4*T.numGlyphs;for(let O=T.vertexStartIndex;O<z;O+=4)l.indexArray.emplaceBack(O,O+1,O+2),l.indexArray.emplaceBack(O+1,O+2,O+3)}getSortedSymbolIndexes(l){if(this.sortedAngle===l&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const g=Math.sin(l),T=Math.cos(l),z=[],O=[],B=[];for(let q=0;q<this.symbolInstances.length;++q){B.push(q);const Z=this.symbolInstances.get(q);z.push(0|Math.round(g*Z.anchorX+T*Z.anchorY)),O.push(Z.featureIndex)}return B.sort(((q,Z)=>z[q]-z[Z]||O[Z]-O[q])),B}addToSortKeyRanges(l,g){const T=this.sortKeyRanges[this.sortKeyRanges.length-1];T&&T.sortKey===g?T.symbolInstanceEnd=l+1:this.sortKeyRanges.push({sortKey:g,symbolInstanceStart:l,symbolInstanceEnd:l+1})}sortFeatures(l){if(this.sortFeaturesByY&&this.sortedAngle!==l&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(l),this.sortedAngle=l,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const g of this.symbolInstanceIndexes){const T=this.symbolInstances.get(g);this.featureSortOrder.push(T.featureIndex),[T.rightJustifiedTextSymbolIndex,T.centerJustifiedTextSymbolIndex,T.leftJustifiedTextSymbolIndex].forEach(((z,O,B)=>{z>=0&&B.indexOf(z)===O&&this.addIndicesForPlacedSymbol(this.text,z)})),T.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,T.verticalPlacedTextSymbolIndex),T.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.placedIconSymbolIndex),T.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,T.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let ws,qa;fn("SymbolBucket",bs,{omit:["layers","collisionBoxArray","features","compareText"]}),bs.MAX_GLYPHS=65535,bs.addDynamicAttributes=ya;var Bo={get paint(){return qa=qa||new L({"icon-opacity":new Pr(Yt.paint_symbol["icon-opacity"]),"icon-color":new Pr(Yt.paint_symbol["icon-color"]),"icon-halo-color":new Pr(Yt.paint_symbol["icon-halo-color"]),"icon-halo-width":new Pr(Yt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Pr(Yt.paint_symbol["icon-halo-blur"]),"icon-translate":new Xn(Yt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xn(Yt.paint_symbol["icon-translate-anchor"]),"text-opacity":new Pr(Yt.paint_symbol["text-opacity"]),"text-color":new Pr(Yt.paint_symbol["text-color"],{runtimeType:Hs,getOverride:f=>f.textColor,hasOverride:f=>!!f.textColor}),"text-halo-color":new Pr(Yt.paint_symbol["text-halo-color"]),"text-halo-width":new Pr(Yt.paint_symbol["text-halo-width"]),"text-halo-blur":new Pr(Yt.paint_symbol["text-halo-blur"]),"text-translate":new Xn(Yt.paint_symbol["text-translate"]),"text-translate-anchor":new Xn(Yt.paint_symbol["text-translate-anchor"])})},get layout(){return ws=ws||new L({"symbol-placement":new Xn(Yt.layout_symbol["symbol-placement"]),"symbol-spacing":new Xn(Yt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xn(Yt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Pr(Yt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xn(Yt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Xn(Yt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Xn(Yt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Xn(Yt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xn(Yt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xn(Yt.layout_symbol["icon-rotation-alignment"]),"icon-size":new Pr(Yt.layout_symbol["icon-size"]),"icon-text-fit":new Xn(Yt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Xn(Yt.layout_symbol["icon-text-fit-padding"]),"icon-image":new Pr(Yt.layout_symbol["icon-image"]),"icon-rotate":new Pr(Yt.layout_symbol["icon-rotate"]),"icon-padding":new Pr(Yt.layout_symbol["icon-padding"]),"icon-keep-upright":new Xn(Yt.layout_symbol["icon-keep-upright"]),"icon-offset":new Pr(Yt.layout_symbol["icon-offset"]),"icon-anchor":new Pr(Yt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xn(Yt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xn(Yt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xn(Yt.layout_symbol["text-rotation-alignment"]),"text-field":new Pr(Yt.layout_symbol["text-field"]),"text-font":new Pr(Yt.layout_symbol["text-font"]),"text-size":new Pr(Yt.layout_symbol["text-size"]),"text-max-width":new Pr(Yt.layout_symbol["text-max-width"]),"text-line-height":new Xn(Yt.layout_symbol["text-line-height"]),"text-letter-spacing":new Pr(Yt.layout_symbol["text-letter-spacing"]),"text-justify":new Pr(Yt.layout_symbol["text-justify"]),"text-radial-offset":new Pr(Yt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xn(Yt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Pr(Yt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Pr(Yt.layout_symbol["text-anchor"]),"text-max-angle":new Xn(Yt.layout_symbol["text-max-angle"]),"text-writing-mode":new Xn(Yt.layout_symbol["text-writing-mode"]),"text-rotate":new Pr(Yt.layout_symbol["text-rotate"]),"text-padding":new Xn(Yt.layout_symbol["text-padding"]),"text-keep-upright":new Xn(Yt.layout_symbol["text-keep-upright"]),"text-transform":new Pr(Yt.layout_symbol["text-transform"]),"text-offset":new Pr(Yt.layout_symbol["text-offset"]),"text-allow-overlap":new Xn(Yt.layout_symbol["text-allow-overlap"]),"text-overlap":new Xn(Yt.layout_symbol["text-overlap"]),"text-ignore-placement":new Xn(Yt.layout_symbol["text-ignore-placement"]),"text-optional":new Xn(Yt.layout_symbol["text-optional"])})}};class Qo{constructor(l){if(l.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=l.property.overrides?l.property.overrides.runtimeType:So,this.defaultValue=l}evaluate(l){if(l.formattedSection){const g=this.defaultValue.property.overrides;if(g&&g.hasOverride(l.formattedSection))return g.getOverride(l.formattedSection)}return l.feature&&l.featureState?this.defaultValue.evaluate(l.feature,l.featureState):this.defaultValue.property.specification.default}eachChild(l){this.defaultValue.isConstant()||l(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}fn("FormatSectionOverride",Qo,{omit:["defaultValue"]});class oo extends x{constructor(l){super(l,Bo)}recalculate(l,g){if(super.recalculate(l,g),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const T=this.layout.get("text-writing-mode");if(T){const z=[];for(const O of T)z.indexOf(O)<0&&z.push(O);this.layout._values["text-writing-mode"]=z}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(l,g,T,z){const O=this.layout.get(l).evaluate(g,{},T,z),B=this._unevaluatedLayout._values[l];return B.isDataDriven()||Lc(B.value)||!O?O:(function(q,Z){return Z.replace(/{([^{}]+)}/g,((re,de)=>q&&de in q?String(q[de]):""))})(g.properties,O)}createBucket(l){return new bs(l)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const l of Bo.paint.overridableProperties){if(!oo.hasPaintOverride(this.layout,l))continue;const g=this.paint.get(l),T=new Qo(g),z=new fu(T,g.property.specification);let O=null;O=g.value.kind==="constant"||g.value.kind==="source"?new pu("source",z):new Xc("composite",z,g.value.zoomStops),this.paint._values[l]=new pc(g.property,O,g.parameters)}}_handleOverridablePaintPropertyUpdate(l,g,T){return!(!this.layout||g.isDataDriven()||T.isDataDriven())&&oo.hasPaintOverride(this.layout,l)}static hasPaintOverride(l,g){const T=l.get("text-field"),z=Bo.paint.properties[g];let O=!1;const B=q=>{for(const Z of q)if(z.overrides&&z.overrides.hasOverride(Z))return void(O=!0)};if(T.value.kind==="constant"&&T.value.value instanceof $n)B(T.value.value.sections);else if(T.value.kind==="source"){const q=re=>{O||(re instanceof da&&ea(re.value)===Uo?B(re.value.sections):re instanceof ah?B(re.sections):re.eachChild(q))},Z=T.value;Z._styleExpression&&q(Z._styleExpression.expression)}return O}}let Ho;var jl={get paint(){return Ho=Ho||new L({"background-color":new Xn(Yt.paint_background["background-color"]),"background-pattern":new ju(Yt.paint_background["background-pattern"]),"background-opacity":new Xn(Yt.paint_background["background-opacity"])})}};class fl extends x{constructor(l){super(l,jl)}}let eu;var Yu={get paint(){return eu=eu||new L({"raster-opacity":new Xn(Yt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Xn(Yt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xn(Yt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xn(Yt.paint_raster["raster-brightness-max"]),"raster-saturation":new Xn(Yt.paint_raster["raster-saturation"]),"raster-contrast":new Xn(Yt.paint_raster["raster-contrast"]),"raster-resampling":new Xn(Yt.paint_raster["raster-resampling"]),"raster-fade-duration":new Xn(Yt.paint_raster["raster-fade-duration"])})}};class ic extends x{constructor(l){super(l,Yu)}}class Fs extends x{constructor(l){super(l,{}),this.onAdd=g=>{this.implementation.onAdd&&this.implementation.onAdd(g,g.painter.context.gl)},this.onRemove=g=>{this.implementation.onRemove&&this.implementation.onRemove(g,g.painter.context.gl)},this.implementation=l}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class lo{constructor(l){this._methodToThrottle=l,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._methodToThrottle()}),0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Na=63710088e-1;class Ns{constructor(l,g){if(isNaN(l)||isNaN(g))throw new Error(`Invalid LngLat object: (${l}, ${g})`);if(this.lng=+l,this.lat=+g,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ns(Hn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(l){const g=Math.PI/180,T=this.lat*g,z=l.lat*g,O=Math.sin(T)*Math.sin(z)+Math.cos(T)*Math.cos(z)*Math.cos((l.lng-this.lng)*g);return Na*Math.acos(Math.min(O,1))}static convert(l){if(l instanceof Ns)return l;if(Array.isArray(l)&&(l.length===2||l.length===3))return new Ns(Number(l[0]),Number(l[1]));if(!Array.isArray(l)&&typeof l=="object"&&l!==null)return new Ns(Number("lng"in l?l.lng:l.lon),Number(l.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const zs=2*Math.PI*Na;function Ts(f){return zs*Math.cos(f*Math.PI/180)}function nc(f){return(180+f)/360}function Ud(f){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+f*Math.PI/360)))/360}function Ku(f,l){return f/Ts(l)}function vf(f){return 360/Math.PI*Math.atan(Math.exp((180-360*f)*Math.PI/180))-90}class Wh{constructor(l,g,T=0){this.x=+l,this.y=+g,this.z=+T}static fromLngLat(l,g=0){const T=Ns.convert(l);return new Wh(nc(T.lng),Ud(T.lat),Ku(g,T.lat))}toLngLat(){return new Ns(360*this.x-180,vf(this.y))}toAltitude(){return this.z*Ts(vf(this.y))}meterInMercatorCoordinateUnits(){return 1/zs*(l=vf(this.y),1/Math.cos(l*Math.PI/180));var l}}function vh(f,l,g){var T=2*Math.PI*6378137/256/Math.pow(2,g);return[f*T-2*Math.PI*6378137/2,l*T-2*Math.PI*6378137/2]}class bh{constructor(l,g,T){if(!(function(z,O,B){return!(z<0||z>25||B<0||B>=Math.pow(2,z)||O<0||O>=Math.pow(2,z))})(l,g,T))throw new Error(`x=${g}, y=${T}, z=${l} outside of bounds. 0<=x<${Math.pow(2,l)}, 0<=y<${Math.pow(2,l)} 0<=z<=25 `);this.z=l,this.x=g,this.y=T,this.key=Iu(0,l,l,g,T)}equals(l){return this.z===l.z&&this.x===l.x&&this.y===l.y}url(l,g,T){const z=(B=this.y,q=this.z,Z=vh(256*(O=this.x),256*(B=Math.pow(2,q)-B-1),q),re=vh(256*(O+1),256*(B+1),q),Z[0]+","+Z[1]+","+re[0]+","+re[1]);var O,B,q,Z,re;const de=(function(ye,Ee,Le){let qe,Ke="";for(let yt=ye;yt>0;yt--)qe=1<<yt-1,Ke+=(Ee&qe?1:0)+(Le&qe?2:0);return Ke})(this.z,this.x,this.y);return l[(this.x+this.y)%l.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(T==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,g>1?"@2x":"").replace(/{quadkey}/g,de).replace(/{bbox-epsg-3857}/g,z)}isChildOf(l){const g=this.z-l.z;return g>0&&l.x===this.x>>g&&l.y===this.y>>g}getTilePoint(l){const g=Math.pow(2,this.z);return new ut((l.x*g-this.x)*ca,(l.y*g-this.y)*ca)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bf{constructor(l,g){this.wrap=l,this.canonical=g,this.key=Iu(l,g.z,g.z,g.x,g.y)}}class el{constructor(l,g,T,z,O){if(l<T)throw new Error(`overscaledZ should be >= z; overscaledZ = ${l}; z = ${T}`);this.overscaledZ=l,this.wrap=g,this.canonical=new bh(T,+z,+O),this.key=Iu(g,l,T,z,O)}clone(){return new el(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(l){return this.overscaledZ===l.overscaledZ&&this.wrap===l.wrap&&this.canonical.equals(l.canonical)}scaledTo(l){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const g=this.canonical.z-l;return l>this.canonical.z?new el(l,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new el(l,this.wrap,l,this.canonical.x>>g,this.canonical.y>>g)}calculateScaledKey(l,g){if(l>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${l}; overscaledZ = ${this.overscaledZ}`);const T=this.canonical.z-l;return l>this.canonical.z?Iu(this.wrap*+g,l,this.canonical.z,this.canonical.x,this.canonical.y):Iu(this.wrap*+g,l,l,this.canonical.x>>T,this.canonical.y>>T)}isChildOf(l){if(l.wrap!==this.wrap)return!1;const g=this.canonical.z-l.canonical.z;return l.overscaledZ===0||l.overscaledZ<this.overscaledZ&&l.canonical.x===this.canonical.x>>g&&l.canonical.y===this.canonical.y>>g}children(l){if(this.overscaledZ>=l)return[new el(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const g=this.canonical.z+1,T=2*this.canonical.x,z=2*this.canonical.y;return[new el(g,this.wrap,g,T,z),new el(g,this.wrap,g,T+1,z),new el(g,this.wrap,g,T,z+1),new el(g,this.wrap,g,T+1,z+1)]}isLessThan(l){return this.wrap<l.wrap||!(this.wrap>l.wrap)&&(this.overscaledZ<l.overscaledZ||!(this.overscaledZ>l.overscaledZ)&&(this.canonical.x<l.canonical.x||!(this.canonical.x>l.canonical.x)&&this.canonical.y<l.canonical.y))}wrapped(){return new el(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(l){return new el(this.overscaledZ,l,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bf(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(l){return this.canonical.getTilePoint(new Wh(l.x-this.wrap,l.y))}}function Iu(f,l,g,T,z){(f*=2)<0&&(f=-1*f-1);const O=1<<g;return(O*O*f+O*z+T).toString(36)+g.toString(36)+l.toString(36)}fn("CanonicalTileID",bh),fn("OverscaledTileID",el,{omit:["posMatrix"]});class Ju{constructor(l,g,T,z=1,O=1,B=1,q=0){if(this.uid=l,g.height!==g.width)throw new RangeError("DEM tiles must be square");if(T&&!["mapbox","terrarium","custom"].includes(T))return void an(`"${T}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=g.height;const Z=this.dim=g.height-2;switch(this.data=new Uint32Array(g.data.buffer),T){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=z,this.greenFactor=O,this.blueFactor=B,this.baseShift=q;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let re=0;re<Z;re++)this.data[this._idx(-1,re)]=this.data[this._idx(0,re)],this.data[this._idx(Z,re)]=this.data[this._idx(Z-1,re)],this.data[this._idx(re,-1)]=this.data[this._idx(re,0)],this.data[this._idx(re,Z)]=this.data[this._idx(re,Z-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(Z,-1)]=this.data[this._idx(Z-1,0)],this.data[this._idx(-1,Z)]=this.data[this._idx(0,Z-1)],this.data[this._idx(Z,Z)]=this.data[this._idx(Z-1,Z-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let re=0;re<Z;re++)for(let de=0;de<Z;de++){const ye=this.get(re,de);ye>this.max&&(this.max=ye),ye<this.min&&(this.min=ye)}}get(l,g){const T=new Uint8Array(this.data.buffer),z=4*this._idx(l,g);return this.unpack(T[z],T[z+1],T[z+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(l,g){if(l<-1||l>=this.dim+1||g<-1||g>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(g+1)*this.stride+(l+1)}unpack(l,g,T){return l*this.redFactor+g*this.greenFactor+T*this.blueFactor-this.baseShift}getPixels(){return new go({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(l,g,T){if(this.dim!==l.dim)throw new Error("dem dimension mismatch");let z=g*this.dim,O=g*this.dim+this.dim,B=T*this.dim,q=T*this.dim+this.dim;switch(g){case-1:z=O-1;break;case 1:O=z+1}switch(T){case-1:B=q-1;break;case 1:q=B+1}const Z=-g*this.dim,re=-T*this.dim;for(let de=B;de<q;de++)for(let ye=z;ye<O;ye++)this.data[this._idx(ye,de)]=l.data[this._idx(ye+Z,de+re)]}}fn("DEMData",Ju);class cs{constructor(l){this._stringToNumber={},this._numberToString=[];for(let g=0;g<l.length;g++){const T=l[g];this._stringToNumber[T]=g,this._numberToString[g]=T}}encode(l){return this._stringToNumber[l]}decode(l){if(l>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${l} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[l]}}class Gm{constructor(l,g,T,z,O){this.type="Feature",this._vectorTileFeature=l,l._z=g,l._x=T,l._y=z,this.properties=l.properties,this.id=O}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(l){this._geometry=l}toJSON(){const l={geometry:this.geometry};for(const g in this)g!=="_geometry"&&g!=="_vectorTileFeature"&&(l[g]=this[g]);return l}}class A_{constructor(l,g){this.tileID=l,this.x=l.canonical.x,this.y=l.canonical.y,this.z=l.canonical.z,this.grid=new mo(ca,16,0),this.grid3D=new mo(ca,16,0),this.featureIndexArray=new Os,this.promoteId=g}insert(l,g,T,z,O,B){const q=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(T,z,O);const Z=B?this.grid3D:this.grid;for(let re=0;re<g.length;re++){const de=g[re],ye=[1/0,1/0,-1/0,-1/0];for(let Ee=0;Ee<de.length;Ee++){const Le=de[Ee];ye[0]=Math.min(ye[0],Le.x),ye[1]=Math.min(ye[1],Le.y),ye[2]=Math.max(ye[2],Le.x),ye[3]=Math.max(ye[3],Le.y)}ye[0]<ca&&ye[1]<ca&&ye[2]>=0&&ye[3]>=0&&Z.insert(q,ye[0],ye[1],ye[2],ye[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new mh.VectorTile(new Fe(this.rawTileData)).layers,this.sourceLayerCoder=new cs(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(l,g,T,z){this.loadVTLayers();const O=l.params||{},B=ca/l.tileSize/l.scale,q=zf(O.filter),Z=l.queryGeometry,re=l.queryPadding*B,de=h_(Z),ye=this.grid.query(de.minX-re,de.minY-re,de.maxX+re,de.maxY+re),Ee=h_(l.cameraQueryGeometry),Le=this.grid3D.query(Ee.minX-re,Ee.minY-re,Ee.maxX+re,Ee.maxY+re,((yt,Mt,si,Ut)=>(function(ii,Pi,gn,Wn,Er){for(const In of ii)if(Pi<=In.x&&gn<=In.y&&Wn>=In.x&&Er>=In.y)return!0;const Fn=[new ut(Pi,gn),new ut(Pi,Er),new ut(Wn,Er),new ut(Wn,gn)];if(ii.length>2){for(const In of Fn)if($u(ii,In))return!0}for(let In=0;In<ii.length-1;In++)if(cf(ii[In],ii[In+1],Fn))return!0;return!1})(l.cameraQueryGeometry,yt-re,Mt-re,si+re,Ut+re)));for(const yt of Le)ye.push(yt);ye.sort(qm);const qe={};let Ke;for(let yt=0;yt<ye.length;yt++){const Mt=ye[yt];if(Mt===Ke)continue;Ke=Mt;const si=this.featureIndexArray.get(Mt);let Ut=null;this.loadMatchingFeature(qe,si.bucketIndex,si.sourceLayerIndex,si.featureIndex,q,O.layers,O.availableImages,g,T,z,((ii,Pi,gn)=>(Ut||(Ut=qh(ii)),Pi.queryIntersectsFeature(Z,ii,gn,Ut,this.z,l.transform,B,l.pixelPosMatrix))))}return qe}loadMatchingFeature(l,g,T,z,O,B,q,Z,re,de,ye){const Ee=this.bucketLayerIDs[g];if(B&&!(function(yt,Mt){for(let si=0;si<yt.length;si++)if(Mt.indexOf(yt[si])>=0)return!0;return!1})(B,Ee))return;const Le=this.sourceLayerCoder.decode(T),qe=this.vtLayers[Le].feature(z);if(O.needGeometry){const yt=xc(qe,!0);if(!O.filter(new ka(this.tileID.overscaledZ),yt,this.tileID.canonical))return}else if(!O.filter(new ka(this.tileID.overscaledZ),qe))return;const Ke=this.getId(qe,Le);for(let yt=0;yt<Ee.length;yt++){const Mt=Ee[yt];if(B&&B.indexOf(Mt)<0)continue;const si=Z[Mt];if(!si)continue;let Ut={};Ke&&de&&(Ut=de.getState(si.sourceLayer||"_geojsonTileLayer",Ke));const ii=qi({},re[Mt]);ii.paint=Em(ii.paint,si.paint,qe,Ut,q),ii.layout=Em(ii.layout,si.layout,qe,Ut,q);const Pi=!ye||ye(qe,si,Ut);if(!Pi)continue;const gn=new Gm(qe,this.z,this.x,this.y,Ke);gn.layer=ii;let Wn=l[Mt];Wn===void 0&&(Wn=l[Mt]=[]),Wn.push({featureIndex:z,feature:gn,intersectionZ:Pi})}}lookupSymbolFeatures(l,g,T,z,O,B,q,Z){const re={};this.loadVTLayers();const de=zf(O);for(const ye of l)this.loadMatchingFeature(re,T,z,ye,de,B,q,Z,g);return re}hasLayer(l){for(const g of this.bucketLayerIDs)for(const T of g)if(l===T)return!0;return!1}getId(l,g){let T=l.id;return this.promoteId&&(T=l.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[g]],typeof T=="boolean"&&(T=Number(T))),T}}function Em(f,l,g,T,z){return Vt(f,((O,B)=>{const q=l instanceof Kc?l.get(B):null;return q&&q.evaluate?q.evaluate(g,T,z):q}))}function h_(f){let l=1/0,g=1/0,T=-1/0,z=-1/0;for(const O of f)l=Math.min(l,O.x),g=Math.min(g,O.y),T=Math.max(T,O.x),z=Math.max(z,O.y);return{minX:l,minY:g,maxX:T,maxY:z}}function qm(f,l){return l-f}function Hm(f,l,g,T,z){const O=[];for(let B=0;B<f.length;B++){const q=f[B];let Z;for(let re=0;re<q.length-1;re++){let de=q[re],ye=q[re+1];de.x<l&&ye.x<l||(de.x<l?de=new ut(l,de.y+(l-de.x)/(ye.x-de.x)*(ye.y-de.y))._round():ye.x<l&&(ye=new ut(l,de.y+(l-de.x)/(ye.x-de.x)*(ye.y-de.y))._round()),de.y<g&&ye.y<g||(de.y<g?de=new ut(de.x+(g-de.y)/(ye.y-de.y)*(ye.x-de.x),g)._round():ye.y<g&&(ye=new ut(de.x+(g-de.y)/(ye.y-de.y)*(ye.x-de.x),g)._round()),de.x>=T&&ye.x>=T||(de.x>=T?de=new ut(T,de.y+(T-de.x)/(ye.x-de.x)*(ye.y-de.y))._round():ye.x>=T&&(ye=new ut(T,de.y+(T-de.x)/(ye.x-de.x)*(ye.y-de.y))._round()),de.y>=z&&ye.y>=z||(de.y>=z?de=new ut(de.x+(z-de.y)/(ye.y-de.y)*(ye.x-de.x),z)._round():ye.y>=z&&(ye=new ut(de.x+(z-de.y)/(ye.y-de.y)*(ye.x-de.x),z)._round()),Z&&de.equals(Z[Z.length-1])||(Z=[de],O.push(Z)),Z.push(ye)))))}}return O}fn("FeatureIndex",A_,{omit:["rawTileData","sourceLayerCoder"]});class bd extends ut{constructor(l,g,T,z){super(l,g),this.angle=T,z!==void 0&&(this.segment=z)}clone(){return new bd(this.x,this.y,this.angle,this.segment)}}function wf(f,l,g,T,z){if(l.segment===void 0||g===0)return!0;let O=l,B=l.segment+1,q=0;for(;q>-g/2;){if(B--,B<0)return!1;q-=f[B].dist(O),O=f[B]}q+=f[B].dist(f[B+1]),B++;const Z=[];let re=0;for(;q<g/2;){const de=f[B],ye=f[B+1];if(!ye)return!1;let Ee=f[B-1].angleTo(de)-de.angleTo(ye);for(Ee=Math.abs((Ee+3*Math.PI)%(2*Math.PI)-Math.PI),Z.push({distance:q,angleDelta:Ee}),re+=Ee;q-Z[0].distance>T;)re-=Z.shift().angleDelta;if(re>z)return!1;B++,q+=de.dist(ye)}return!0}function Am(f){let l=0;for(let g=0;g<f.length-1;g++)l+=f[g].dist(f[g+1]);return l}function $p(f,l,g){return f?.6*l*g:0}function $m(f,l){return Math.max(f?f.right-f.left:0,l?l.right-l.left:0)}function qf(f,l,g,T,z,O){const B=$p(g,z,O),q=$m(g,T)*O;let Z=0;const re=Am(f)/2;for(let de=0;de<f.length-1;de++){const ye=f[de],Ee=f[de+1],Le=ye.dist(Ee);if(Z+Le>re){const qe=(re-Z)/Le,Ke=Po.number(ye.x,Ee.x,qe),yt=Po.number(ye.y,Ee.y,qe),Mt=new bd(Ke,yt,Ee.angleTo(ye),de);return Mt._round(),!B||wf(f,Mt,q,B,l)?Mt:void 0}Z+=Le}}function tu(f,l,g,T,z,O,B,q,Z){const re=$p(T,O,B),de=$m(T,z),ye=de*B,Ee=f[0].x===0||f[0].x===Z||f[0].y===0||f[0].y===Z;return l-ye<l/4&&(l=ye+l/4),Zp(f,Ee?l/2*q%l:(de/2+2*O)*B*q%l,l,re,g,ye,Ee,!1,Z)}function Zp(f,l,g,T,z,O,B,q,Z){const re=O/2,de=Am(f);let ye=0,Ee=l-g,Le=[];for(let qe=0;qe<f.length-1;qe++){const Ke=f[qe],yt=f[qe+1],Mt=Ke.dist(yt),si=yt.angleTo(Ke);for(;Ee+g<ye+Mt;){Ee+=g;const Ut=(Ee-ye)/Mt,ii=Po.number(Ke.x,yt.x,Ut),Pi=Po.number(Ke.y,yt.y,Ut);if(ii>=0&&ii<Z&&Pi>=0&&Pi<Z&&Ee-re>=0&&Ee+re<=de){const gn=new bd(ii,Pi,si,qe);gn._round(),T&&!wf(f,gn,O,T,z)||Le.push(gn)}}ye+=Mt}return q||Le.length||B||(Le=Zp(f,ye/2,g,T,z,O,B,!0,Z)),Le}fn("Anchor",bd);const yp=zt;function d_(f,l,g,T){const z=[],O=f.image,B=O.pixelRatio,q=O.paddedRect.w-2*yp,Z=O.paddedRect.h-2*yp;let re={x1:f.left,y1:f.top,x2:f.right,y2:f.bottom};const de=O.stretchX||[[0,q]],ye=O.stretchY||[[0,Z]],Ee=(Gi,sr)=>Gi+sr[1]-sr[0],Le=de.reduce(Ee,0),qe=ye.reduce(Ee,0),Ke=q-Le,yt=Z-qe;let Mt=0,si=Le,Ut=0,ii=qe,Pi=0,gn=Ke,Wn=0,Er=yt;if(O.content&&T){const Gi=O.content,sr=Gi[2]-Gi[0],vr=Gi[3]-Gi[1];(O.textFitWidth||O.textFitHeight)&&(re=aa(f)),Mt=Zm(de,0,Gi[0]),Ut=Zm(ye,0,Gi[1]),si=Zm(de,Gi[0],Gi[2]),ii=Zm(ye,Gi[1],Gi[3]),Pi=Gi[0]-Mt,Wn=Gi[1]-Ut,gn=sr-si,Er=vr-ii}const Fn=re.x1,In=re.y1,xr=re.x2-Fn,or=re.y2-In,nr=(Gi,sr,vr,ia)=>{const ms=Xm(Gi.stretch-Mt,si,xr,Fn),eo=Wm(Gi.fixed-Pi,gn,Gi.stretch,Le),Sl=Xm(sr.stretch-Ut,ii,or,In),Nc=Wm(sr.fixed-Wn,Er,sr.stretch,qe),rc=Xm(vr.stretch-Mt,si,xr,Fn),ql=Wm(vr.fixed-Pi,gn,vr.stretch,Le),iu=Xm(ia.stretch-Ut,ii,or,In),Sc=Wm(ia.fixed-Wn,Er,ia.stretch,qe),tl=new ut(ms,Sl),il=new ut(rc,Sl),ac=new ut(rc,iu),nu=new ut(ms,iu),Ec=new ut(eo/B,Nc/B),Hl=new ut(ql/B,Sc/B),El=l*Math.PI/180;if(El){const rs=Math.sin(El),Ds=Math.cos(El),vo=[Ds,-rs,rs,Ds];tl._matMult(vo),il._matMult(vo),nu._matMult(vo),ac._matMult(vo)}const wh=Gi.stretch+Gi.fixed,Qu=sr.stretch+sr.fixed;return{tl,tr:il,bl:nu,br:ac,tex:{x:O.paddedRect.x+yp+wh,y:O.paddedRect.y+yp+Qu,w:vr.stretch+vr.fixed-wh,h:ia.stretch+ia.fixed-Qu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ec,pixelOffsetBR:Hl,minFontScaleX:gn/B/xr,minFontScaleY:Er/B/or,isSDF:g}};if(T&&(O.stretchX||O.stretchY)){const Gi=I_(de,Ke,Le),sr=I_(ye,yt,qe);for(let vr=0;vr<Gi.length-1;vr++){const ia=Gi[vr],ms=Gi[vr+1];for(let eo=0;eo<sr.length-1;eo++)z.push(nr(ia,sr[eo],ms,sr[eo+1]))}}else z.push(nr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:q+1},{fixed:0,stretch:Z+1}));return z}function Zm(f,l,g){let T=0;for(const z of f)T+=Math.max(l,Math.min(g,z[1]))-Math.max(l,Math.min(g,z[0]));return T}function I_(f,l,g){const T=[{fixed:-yp,stretch:0}];for(const[z,O]of f){const B=T[T.length-1];T.push({fixed:z-B.stretch,stretch:B.stretch}),T.push({fixed:z-B.stretch,stretch:B.stretch+(O-z)})}return T.push({fixed:l+yp,stretch:g}),T}function Xm(f,l,g,T){return f/l*g+T}function Wm(f,l,g,T){return f-l*g/T}class Xp{constructor(l,g,T,z,O,B,q,Z,re,de){var ye;if(this.boxStartIndex=l.length,re){let Ee=B.top,Le=B.bottom;const qe=B.collisionPadding;qe&&(Ee-=qe[1],Le+=qe[3]);let Ke=Le-Ee;Ke>0&&(Ke=Math.max(10,Ke),this.circleDiameter=Ke)}else{const Ee=!((ye=B.image)===null||ye===void 0)&&ye.content&&(B.image.textFitWidth||B.image.textFitHeight)?aa(B):{x1:B.left,y1:B.top,x2:B.right,y2:B.bottom};Ee.y1=Ee.y1*q-Z[0],Ee.y2=Ee.y2*q+Z[2],Ee.x1=Ee.x1*q-Z[3],Ee.x2=Ee.x2*q+Z[1];const Le=B.collisionPadding;if(Le&&(Ee.x1-=Le[0]*q,Ee.y1-=Le[1]*q,Ee.x2+=Le[2]*q,Ee.y2+=Le[3]*q),de){const qe=new ut(Ee.x1,Ee.y1),Ke=new ut(Ee.x2,Ee.y1),yt=new ut(Ee.x1,Ee.y2),Mt=new ut(Ee.x2,Ee.y2),si=de*Math.PI/180;qe._rotate(si),Ke._rotate(si),yt._rotate(si),Mt._rotate(si),Ee.x1=Math.min(qe.x,Ke.x,yt.x,Mt.x),Ee.x2=Math.max(qe.x,Ke.x,yt.x,Mt.x),Ee.y1=Math.min(qe.y,Ke.y,yt.y,Mt.y),Ee.y2=Math.max(qe.y,Ke.y,yt.y,Mt.y)}l.emplaceBack(g.x,g.y,Ee.x1,Ee.y1,Ee.x2,Ee.y2,T,z,O)}this.boxEndIndex=l.length}}class $_{constructor(l=[],g=((T,z)=>T<z?-1:T>z?1:0)){if(this.data=l,this.length=this.data.length,this.compare=g,this.length>0)for(let T=(this.length>>1)-1;T>=0;T--)this._down(T)}push(l){this.data.push(l),this._up(this.length++)}pop(){if(this.length===0)return;const l=this.data[0],g=this.data.pop();return--this.length>0&&(this.data[0]=g,this._down(0)),l}peek(){return this.data[0]}_up(l){const{data:g,compare:T}=this,z=g[l];for(;l>0;){const O=l-1>>1,B=g[O];if(T(z,B)>=0)break;g[l]=B,l=O}g[l]=z}_down(l){const{data:g,compare:T}=this,z=this.length>>1,O=g[l];for(;l<z;){let B=1+(l<<1);const q=B+1;if(q<this.length&&T(g[q],g[B])<0&&(B=q),T(g[B],O)>=0)break;g[l]=g[B],l=B}g[l]=O}}function M_(f,l=1,g=!1){let T=1/0,z=1/0,O=-1/0,B=-1/0;const q=f[0];for(let Le=0;Le<q.length;Le++){const qe=q[Le];(!Le||qe.x<T)&&(T=qe.x),(!Le||qe.y<z)&&(z=qe.y),(!Le||qe.x>O)&&(O=qe.x),(!Le||qe.y>B)&&(B=qe.y)}const Z=Math.min(O-T,B-z);let re=Z/2;const de=new $_([],mg);if(Z===0)return new ut(T,z);for(let Le=T;Le<O;Le+=Z)for(let qe=z;qe<B;qe+=Z)de.push(new xp(Le+re,qe+re,re,f));let ye=(function(Le){let qe=0,Ke=0,yt=0;const Mt=Le[0];for(let si=0,Ut=Mt.length,ii=Ut-1;si<Ut;ii=si++){const Pi=Mt[si],gn=Mt[ii],Wn=Pi.x*gn.y-gn.x*Pi.y;Ke+=(Pi.x+gn.x)*Wn,yt+=(Pi.y+gn.y)*Wn,qe+=3*Wn}return new xp(Ke/qe,yt/qe,0,Le)})(f),Ee=de.length;for(;de.length;){const Le=de.pop();(Le.d>ye.d||!ye.d)&&(ye=Le,g&&console.log("found best %d after %d probes",Math.round(1e4*Le.d)/1e4,Ee)),Le.max-ye.d<=l||(re=Le.h/2,de.push(new xp(Le.p.x-re,Le.p.y-re,re,f)),de.push(new xp(Le.p.x+re,Le.p.y-re,re,f)),de.push(new xp(Le.p.x-re,Le.p.y+re,re,f)),de.push(new xp(Le.p.x+re,Le.p.y+re,re,f)),Ee+=4)}return g&&(console.log(`num probes: ${Ee}`),console.log(`best distance: ${ye.d}`)),ye.p}function mg(f,l){return l.max-f.max}function xp(f,l,g,T){this.p=new ut(f,l),this.h=g,this.d=(function(z,O){let B=!1,q=1/0;for(let Z=0;Z<O.length;Z++){const re=O[Z];for(let de=0,ye=re.length,Ee=ye-1;de<ye;Ee=de++){const Le=re[de],qe=re[Ee];Le.y>z.y!=qe.y>z.y&&z.x<(qe.x-Le.x)*(z.y-Le.y)/(qe.y-Le.y)+Le.x&&(B=!B),q=Math.min(q,rp(z,Le,qe))}}return(B?1:-1)*Math.sqrt(q)})(this.p,T),this.max=this.d+this.h*Math.SQRT2}var Gl;le.aq=void 0,(Gl=le.aq||(le.aq={}))[Gl.center=1]="center",Gl[Gl.left=2]="left",Gl[Gl.right=3]="right",Gl[Gl.top=4]="top",Gl[Gl.bottom=5]="bottom",Gl[Gl["top-left"]=6]="top-left",Gl[Gl["top-right"]=7]="top-right",Gl[Gl["bottom-left"]=8]="bottom-left",Gl[Gl["bottom-right"]=9]="bottom-right";const Hf=7,f_=Number.POSITIVE_INFINITY;function Wp(f,l){return l[1]!==f_?(function(g,T,z){let O=0,B=0;switch(T=Math.abs(T),z=Math.abs(z),g){case"top-right":case"top-left":case"top":B=z-Hf;break;case"bottom-right":case"bottom-left":case"bottom":B=-z+Hf}switch(g){case"top-right":case"bottom-right":case"right":O=-T;break;case"top-left":case"bottom-left":case"left":O=T}return[O,B]})(f,l[0],l[1]):(function(g,T){let z=0,O=0;T<0&&(T=0);const B=T/Math.SQRT2;switch(g){case"top-right":case"top-left":O=B-Hf;break;case"bottom-right":case"bottom-left":O=-B+Hf;break;case"bottom":O=-T+Hf;break;case"top":O=T-Hf}switch(g){case"top-right":case"bottom-right":z=-B;break;case"top-left":case"bottom-left":z=B;break;case"left":z=T;break;case"right":z=-T}return[z,O]})(f,l[0])}function C_(f,l,g){var T;const z=f.layout,O=(T=z.get("text-variable-anchor-offset"))===null||T===void 0?void 0:T.evaluate(l,{},g);if(O){const q=O.values,Z=[];for(let re=0;re<q.length;re+=2){const de=Z[re]=q[re],ye=q[re+1].map((Ee=>Ee*t));de.startsWith("top")?ye[1]-=Hf:de.startsWith("bottom")&&(ye[1]+=Hf),Z[re+1]=ye}return new La(Z)}const B=z.get("text-variable-anchor");if(B){let q;q=f._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[z.get("text-radial-offset").evaluate(l,{},g)*t,f_]:z.get("text-offset").evaluate(l,{},g).map((re=>re*t));const Z=[];for(const re of B)Z.push(re,Wp(re,q));return new La(Z)}return null}function Ym(f){switch(f){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Ss(f,l,g,T,z,O,B,q,Z,re,de){let ye=O.textMaxSize.evaluate(l,{});ye===void 0&&(ye=B);const Ee=f.layers[0].layout,Le=Ee.get("icon-offset").evaluate(l,{},de),qe=wd(g.horizontal),Ke=B/24,yt=f.tilePixelRatio*Ke,Mt=f.tilePixelRatio*ye/24,si=f.tilePixelRatio*q,Ut=f.tilePixelRatio*Ee.get("symbol-spacing"),ii=Ee.get("text-padding")*f.tilePixelRatio,Pi=(function(Gi,sr,vr,ia=1){const ms=Gi.get("icon-padding").evaluate(sr,{},vr),eo=ms&&ms.values;return[eo[0]*ia,eo[1]*ia,eo[2]*ia,eo[3]*ia]})(Ee,l,de,f.tilePixelRatio),gn=Ee.get("text-max-angle")/180*Math.PI,Wn=Ee.get("text-rotation-alignment")!=="viewport"&&Ee.get("symbol-placement")!=="point",Er=Ee.get("icon-rotation-alignment")==="map"&&Ee.get("symbol-placement")!=="point",Fn=Ee.get("symbol-placement"),In=Ut/2,xr=Ee.get("icon-text-fit");let or;T&&xr!=="none"&&(f.allowVerticalPlacement&&g.vertical&&(or=Qn(T,g.vertical,xr,Ee.get("icon-text-fit-padding"),Le,Ke)),qe&&(T=Qn(T,qe,xr,Ee.get("icon-text-fit-padding"),Le,Ke)));const nr=(Gi,sr)=>{sr.x<0||sr.x>=ca||sr.y<0||sr.y>=ca||(function(vr,ia,ms,eo,Sl,Nc,rc,ql,iu,Sc,tl,il,ac,nu,Ec,Hl,El,wh,Qu,rs,Ds,vo,Vc,bo,Zf){const eh=vr.addToLineVertexArray(ia,ms);let Th,Sh,Yh,Al,Sf=0,vp=0,z_=0,Jp=0,Qp=-1,bp=-1;const Xf={};let Mm=Ko("");if(vr.allowVerticalPlacement&&eo.vertical){const Uc=ql.layout.get("text-rotate").evaluate(Ds,{},bo)+90;Yh=new Xp(iu,ia,Sc,tl,il,eo.vertical,ac,nu,Ec,Uc),rc&&(Al=new Xp(iu,ia,Sc,tl,il,rc,El,wh,Ec,Uc))}if(Sl){const Uc=ql.layout.get("icon-rotate").evaluate(Ds,{}),ru=ql.layout.get("icon-text-fit")!=="none",au=d_(Sl,Uc,Vc,ru),Ac=rc?d_(rc,Uc,Vc,ru):void 0;Sh=new Xp(iu,ia,Sc,tl,il,Sl,El,wh,!1,Uc),Sf=4*au.length;const Eh=vr.iconSizeData;let ih=null;Eh.kind==="source"?(ih=[Gr*ql.layout.get("icon-size").evaluate(Ds,{})],ih[0]>Kr&&an(`${vr.layerIds[0]}: Value for "icon-size" is >= ${yr}. Reduce your "icon-size".`)):Eh.kind==="composite"&&(ih=[Gr*vo.compositeIconSizes[0].evaluate(Ds,{},bo),Gr*vo.compositeIconSizes[1].evaluate(Ds,{},bo)],(ih[0]>Kr||ih[1]>Kr)&&an(`${vr.layerIds[0]}: Value for "icon-size" is >= ${yr}. Reduce your "icon-size".`)),vr.addSymbols(vr.icon,au,ih,rs,Qu,Ds,le.ah.none,ia,eh.lineStartIndex,eh.lineLength,-1,bo),Qp=vr.icon.placedSymbolArray.length-1,Ac&&(vp=4*Ac.length,vr.addSymbols(vr.icon,Ac,ih,rs,Qu,Ds,le.ah.vertical,ia,eh.lineStartIndex,eh.lineLength,-1,bo),bp=vr.icon.placedSymbolArray.length-1)}const Z_=Object.keys(eo.horizontal);for(const Uc of Z_){const ru=eo.horizontal[Uc];if(!Th){Mm=Ko(ru.text);const Ac=ql.layout.get("text-rotate").evaluate(Ds,{},bo);Th=new Xp(iu,ia,Sc,tl,il,ru,ac,nu,Ec,Ac)}const au=ru.positionedLines.length===1;if(z_+=Im(vr,ia,ru,Nc,ql,Ec,Ds,Hl,eh,eo.vertical?le.ah.horizontal:le.ah.horizontalOnly,au?Z_:[Uc],Xf,Qp,vo,bo),au)break}eo.vertical&&(Jp+=Im(vr,ia,eo.vertical,Nc,ql,Ec,Ds,Hl,eh,le.ah.vertical,["vertical"],Xf,bp,vo,bo));const X_=Th?Th.boxStartIndex:vr.collisionBoxArray.length,D_=Th?Th.boxEndIndex:vr.collisionBoxArray.length,Ef=Yh?Yh.boxStartIndex:vr.collisionBoxArray.length,R_=Yh?Yh.boxEndIndex:vr.collisionBoxArray.length,g_=Sh?Sh.boxStartIndex:vr.collisionBoxArray.length,Cm=Sh?Sh.boxEndIndex:vr.collisionBoxArray.length,zm=Al?Al.boxStartIndex:vr.collisionBoxArray.length,em=Al?Al.boxEndIndex:vr.collisionBoxArray.length;let th=-1;const e_=(Uc,ru)=>Uc&&Uc.circleDiameter?Math.max(Uc.circleDiameter,ru):ru;th=e_(Th,th),th=e_(Yh,th),th=e_(Sh,th),th=e_(Al,th);const t_=th>-1?1:0;t_&&(th*=Zf/t),vr.glyphOffsetArray.length>=bs.MAX_GLYPHS&&an("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ds.sortKey!==void 0&&vr.addToSortKeyRanges(vr.symbolInstances.length,Ds.sortKey);const y_=C_(ql,Ds,bo),[i_,P_]=(function(Uc,ru){const au=Uc.length,Ac=ru?.values;if(Ac?.length>0)for(let Eh=0;Eh<Ac.length;Eh+=2){const ih=Ac[Eh+1];Uc.emplaceBack(le.aq[Ac[Eh]],ih[0],ih[1])}return[au,Uc.length]})(vr.textAnchorOffsets,y_);vr.symbolInstances.emplaceBack(ia.x,ia.y,Xf.right>=0?Xf.right:-1,Xf.center>=0?Xf.center:-1,Xf.left>=0?Xf.left:-1,Xf.vertical||-1,Qp,bp,Mm,X_,D_,Ef,R_,g_,Cm,zm,em,Sc,z_,Jp,Sf,vp,t_,0,ac,th,i_,P_)})(f,sr,Gi,g,T,z,or,f.layers[0],f.collisionBoxArray,l.index,l.sourceLayerIndex,f.index,yt,[ii,ii,ii,ii],Wn,Z,si,Pi,Er,Le,l,O,re,de,B)};if(Fn==="line")for(const Gi of Hm(l.geometry,0,0,ca,ca)){const sr=tu(Gi,Ut,gn,g.vertical||qe,T,24,Mt,f.overscaling,ca);for(const vr of sr)qe&&Tl(f,qe.text,In,vr)||nr(Gi,vr)}else if(Fn==="line-center"){for(const Gi of l.geometry)if(Gi.length>1){const sr=qf(Gi,gn,g.vertical||qe,T,24,Mt);sr&&nr(Gi,sr)}}else if(l.type==="Polygon")for(const Gi of Dc(l.geometry,0)){const sr=M_(Gi,16);nr(Gi[0],new bd(sr.x,sr.y,0))}else if(l.type==="LineString")for(const Gi of l.geometry)nr(Gi,new bd(Gi[0].x,Gi[0].y,0));else if(l.type==="Point")for(const Gi of l.geometry)for(const sr of Gi)nr([sr],new bd(sr.x,sr.y,0))}function Im(f,l,g,T,z,O,B,q,Z,re,de,ye,Ee,Le,qe){const Ke=(function(si,Ut,ii,Pi,gn,Wn,Er,Fn){const In=Pi.layout.get("text-rotate").evaluate(Wn,{})*Math.PI/180,xr=[];for(const or of Ut.positionedLines)for(const nr of or.positionedGlyphs){if(!nr.rect)continue;const Gi=nr.rect||{};let sr=St+1,vr=!0,ia=1,ms=0;const eo=(gn||Fn)&&nr.vertical,Sl=nr.metrics.advance*nr.scale/2;if(Fn&&Ut.verticalizable&&(ms=or.lineOffset/2-(nr.imageName?-(t-nr.metrics.width*nr.scale)/2:(nr.scale-1)*t)),nr.imageName){const rs=Er[nr.imageName];vr=rs.sdf,ia=rs.pixelRatio,sr=zt/ia}const Nc=gn?[nr.x+Sl,nr.y]:[0,0];let rc=gn?[0,0]:[nr.x+Sl+ii[0],nr.y+ii[1]-ms],ql=[0,0];eo&&(ql=rc,rc=[0,0]);const iu=nr.metrics.isDoubleResolution?2:1,Sc=(nr.metrics.left-sr)*nr.scale-Sl+rc[0],tl=(-nr.metrics.top-sr)*nr.scale+rc[1],il=Sc+Gi.w/iu*nr.scale/ia,ac=tl+Gi.h/iu*nr.scale/ia,nu=new ut(Sc,tl),Ec=new ut(il,tl),Hl=new ut(Sc,ac),El=new ut(il,ac);if(eo){const rs=new ut(-Sl,Sl-Bt),Ds=-Math.PI/2,vo=t/2-Sl,Vc=new ut(5-Bt-vo,-(nr.imageName?vo:0)),bo=new ut(...ql);nu._rotateAround(Ds,rs)._add(Vc)._add(bo),Ec._rotateAround(Ds,rs)._add(Vc)._add(bo),Hl._rotateAround(Ds,rs)._add(Vc)._add(bo),El._rotateAround(Ds,rs)._add(Vc)._add(bo)}if(In){const rs=Math.sin(In),Ds=Math.cos(In),vo=[Ds,-rs,rs,Ds];nu._matMult(vo),Ec._matMult(vo),Hl._matMult(vo),El._matMult(vo)}const wh=new ut(0,0),Qu=new ut(0,0);xr.push({tl:nu,tr:Ec,bl:Hl,br:El,tex:Gi,writingMode:Ut.writingMode,glyphOffset:Nc,sectionIndex:nr.sectionIndex,isSDF:vr,pixelOffsetTL:wh,pixelOffsetBR:Qu,minFontScaleX:0,minFontScaleY:0})}return xr})(0,g,q,z,O,B,T,f.allowVerticalPlacement),yt=f.textSizeData;let Mt=null;yt.kind==="source"?(Mt=[Gr*z.layout.get("text-size").evaluate(B,{})],Mt[0]>Kr&&an(`${f.layerIds[0]}: Value for "text-size" is >= ${yr}. Reduce your "text-size".`)):yt.kind==="composite"&&(Mt=[Gr*Le.compositeTextSizes[0].evaluate(B,{},qe),Gr*Le.compositeTextSizes[1].evaluate(B,{},qe)],(Mt[0]>Kr||Mt[1]>Kr)&&an(`${f.layerIds[0]}: Value for "text-size" is >= ${yr}. Reduce your "text-size".`)),f.addSymbols(f.text,Ke,Mt,q,O,B,re,l,Z.lineStartIndex,Z.lineLength,Ee,qe);for(const si of de)ye[si]=f.text.placedSymbolArray.length-1;return 4*Ke.length}function wd(f){for(const l in f)return f[l];return null}function Tl(f,l,g,T){const z=f.compareText;if(l in z){const O=z[l];for(let B=O.length-1;B>=0;B--)if(T.dist(O[B])<g)return!0}else z[l]=[];return z[l].push(T),!1}const p_=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class $f{static from(l){if(!(l instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[g,T]=new Uint8Array(l,0,2);if(g!==219)throw new Error("Data does not appear to be in a KDBush format.");const z=T>>4;if(z!==1)throw new Error(`Got v${z} data when expected v1.`);const O=p_[15&T];if(!O)throw new Error("Unrecognized array type.");const[B]=new Uint16Array(l,2,1),[q]=new Uint32Array(l,4,1);return new $f(q,B,O,l)}constructor(l,g=64,T=Float64Array,z){if(isNaN(l)||l<0)throw new Error(`Unpexpected numItems value: ${l}.`);this.numItems=+l,this.nodeSize=Math.min(Math.max(+g,2),65535),this.ArrayType=T,this.IndexArrayType=l<65536?Uint16Array:Uint32Array;const O=p_.indexOf(this.ArrayType),B=2*l*this.ArrayType.BYTES_PER_ELEMENT,q=l*this.IndexArrayType.BYTES_PER_ELEMENT,Z=(8-q%8)%8;if(O<0)throw new Error(`Unexpected typed array class: ${T}.`);z&&z instanceof ArrayBuffer?(this.data=z,this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+q+Z,2*l),this._pos=2*l,this._finished=!0):(this.data=new ArrayBuffer(8+B+q+Z),this.ids=new this.IndexArrayType(this.data,8,l),this.coords=new this.ArrayType(this.data,8+q+Z,2*l),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+O]),new Uint16Array(this.data,2,1)[0]=g,new Uint32Array(this.data,4,1)[0]=l)}add(l,g){const T=this._pos>>1;return this.ids[T]=T,this.coords[this._pos++]=l,this.coords[this._pos++]=g,T}finish(){const l=this._pos>>1;if(l!==this.numItems)throw new Error(`Added ${l} items when expected ${this.numItems}.`);return Yp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(l,g,T,z){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:O,coords:B,nodeSize:q}=this,Z=[0,O.length-1,0],re=[];for(;Z.length;){const de=Z.pop()||0,ye=Z.pop()||0,Ee=Z.pop()||0;if(ye-Ee<=q){for(let yt=Ee;yt<=ye;yt++){const Mt=B[2*yt],si=B[2*yt+1];Mt>=l&&Mt<=T&&si>=g&&si<=z&&re.push(O[yt])}continue}const Le=Ee+ye>>1,qe=B[2*Le],Ke=B[2*Le+1];qe>=l&&qe<=T&&Ke>=g&&Ke<=z&&re.push(O[Le]),(de===0?l<=qe:g<=Ke)&&(Z.push(Ee),Z.push(Le-1),Z.push(1-de)),(de===0?T>=qe:z>=Ke)&&(Z.push(Le+1),Z.push(ye),Z.push(1-de))}return re}within(l,g,T){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:z,coords:O,nodeSize:B}=this,q=[0,z.length-1,0],Z=[],re=T*T;for(;q.length;){const de=q.pop()||0,ye=q.pop()||0,Ee=q.pop()||0;if(ye-Ee<=B){for(let yt=Ee;yt<=ye;yt++)Kp(O[2*yt],O[2*yt+1],l,g)<=re&&Z.push(z[yt]);continue}const Le=Ee+ye>>1,qe=O[2*Le],Ke=O[2*Le+1];Kp(qe,Ke,l,g)<=re&&Z.push(z[Le]),(de===0?l-T<=qe:g-T<=Ke)&&(q.push(Ee),q.push(Le-1),q.push(1-de)),(de===0?l+T>=qe:g+T>=Ke)&&(q.push(Le+1),q.push(ye),q.push(1-de))}return Z}}function Yp(f,l,g,T,z,O){if(z-T<=g)return;const B=T+z>>1;Km(f,l,B,T,z,O),Yp(f,l,g,T,B-1,1-O),Yp(f,l,g,B+1,z,1-O)}function Km(f,l,g,T,z,O){for(;z>T;){if(z-T>600){const re=z-T+1,de=g-T+1,ye=Math.log(re),Ee=.5*Math.exp(2*ye/3),Le=.5*Math.sqrt(ye*Ee*(re-Ee)/re)*(de-re/2<0?-1:1);Km(f,l,g,Math.max(T,Math.floor(g-de*Ee/re+Le)),Math.min(z,Math.floor(g+(re-de)*Ee/re+Le)),O)}const B=l[2*g+O];let q=T,Z=z;for(Jm(f,l,T,g),l[2*z+O]>B&&Jm(f,l,T,z);q<Z;){for(Jm(f,l,q,Z),q++,Z--;l[2*q+O]<B;)q++;for(;l[2*Z+O]>B;)Z--}l[2*T+O]===B?Jm(f,l,T,Z):(Z++,Jm(f,l,Z,z)),Z<=g&&(T=Z+1),g<=Z&&(z=Z-1)}}function Jm(f,l,g,T){m_(f,g,T),m_(l,2*g,2*T),m_(l,2*g+1,2*T+1)}function m_(f,l,g){const T=f[l];f[l]=f[g],f[g]=T}function Kp(f,l,g,T){const z=f-g,O=l-T;return z*z+O*O}var __;le.bg=void 0,(__=le.bg||(le.bg={})).create="create",__.load="load",__.fullLoad="fullLoad";let jd=null,Tf=[];const xo=1e3/60,Qm="loadTime",Tc="fullLoadTime",_g={mark(f){performance.mark(f)},frame(f){const l=f;jd!=null&&Tf.push(l-jd),jd=l},clearMetrics(){jd=null,Tf=[],performance.clearMeasures(Qm),performance.clearMeasures(Tc);for(const f in le.bg)performance.clearMarks(le.bg[f])},getPerformanceMetrics(){performance.measure(Qm,le.bg.create,le.bg.load),performance.measure(Tc,le.bg.create,le.bg.fullLoad);const f=performance.getEntriesByName(Qm)[0].duration,l=performance.getEntriesByName(Tc)[0].duration,g=Tf.length,T=1/(Tf.reduce(((O,B)=>O+B),0)/g/1e3),z=Tf.filter((O=>O>xo)).reduce(((O,B)=>O+(B-xo)/xo),0);return{loadTime:f,fullLoadTime:l,fps:T,percentDroppedFrames:z/(g+z)*100,totalFrames:g}}};le.$=class extends be{},le.A=kd,le.B=Rf,le.C=function(f){if(ui==null){const l=f.navigator?f.navigator.userAgent:null;ui=!!f.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return ui},le.D=Xn,le.E=Da,le.F=class{constructor(f,l){this.target=f,this.mapId=l,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new lo((()=>this.process())),this.subscription=(function(g,T,z,O){return g.addEventListener(T,z,!1),{unsubscribe:()=>{g.removeEventListener(T,z,!1)}}})(this.target,"message",(g=>this.receive(g))),this.globalScope=Qr(self)?f:window}registerMessageHandler(f,l){this.messageHandlers[f]=l}sendAsync(f,l){return new Promise(((g,T)=>{const z=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[z]={resolve:g,reject:T},l&&l.signal.addEventListener("abort",(()=>{delete this.resolveRejects[z];const q={id:z,type:"<cancel>",origin:location.origin,targetMapId:f.targetMapId,sourceMapId:this.mapId};this.target.postMessage(q)}),{once:!0});const O=[],B=Object.assign(Object.assign({},f),{id:z,sourceMapId:this.mapId,origin:location.origin,data:Ql(f.data,O)});this.target.postMessage(B,{transfer:O})}))}receive(f){const l=f.data,g=l.id;if(!(l.origin!=="file://"&&location.origin!=="file://"&&l.origin!=="resource://android"&&location.origin!=="resource://android"&&l.origin!==location.origin||l.targetMapId&&this.mapId!==l.targetMapId)){if(l.type==="<cancel>"){delete this.tasks[g];const T=this.abortControllers[g];return delete this.abortControllers[g],void(T&&T.abort())}if(Qr(self)||l.mustQueue)return this.tasks[g]=l,this.taskQueue.push(g),void this.invoker.trigger();this.processTask(g,l)}}process(){if(this.taskQueue.length===0)return;const f=this.taskQueue.shift(),l=this.tasks[f];delete this.tasks[f],this.taskQueue.length>0&&this.invoker.trigger(),l&&this.processTask(f,l)}processTask(f,l){return n(this,void 0,void 0,(function*(){if(l.type==="<response>"){const z=this.resolveRejects[f];return delete this.resolveRejects[f],z?void(l.error?z.reject(ch(l.error)):z.resolve(ch(l.data))):void 0}if(!this.messageHandlers[l.type])return void this.completeTask(f,new Error(`Could not find a registered handler for ${l.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const g=ch(l.data),T=new AbortController;this.abortControllers[f]=T;try{const z=yield this.messageHandlers[l.type](l.sourceMapId,g,T);this.completeTask(f,null,z)}catch(z){this.completeTask(f,z)}}))}completeTask(f,l,g){const T=[];delete this.abortControllers[f];const z={id:f,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:l?Ql(l):null,data:Ql(g,T)};this.target.postMessage(z,{transfer:T})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},le.G=_r,le.H=function(){var f=new kd(16);return kd!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0),f[0]=1,f[5]=1,f[10]=1,f[15]=1,f},le.I=Jt,le.J=function(f,l,g){var T,z,O,B,q,Z,re,de,ye,Ee,Le,qe,Ke=g[0],yt=g[1],Mt=g[2];return l===f?(f[12]=l[0]*Ke+l[4]*yt+l[8]*Mt+l[12],f[13]=l[1]*Ke+l[5]*yt+l[9]*Mt+l[13],f[14]=l[2]*Ke+l[6]*yt+l[10]*Mt+l[14],f[15]=l[3]*Ke+l[7]*yt+l[11]*Mt+l[15]):(z=l[1],O=l[2],B=l[3],q=l[4],Z=l[5],re=l[6],de=l[7],ye=l[8],Ee=l[9],Le=l[10],qe=l[11],f[0]=T=l[0],f[1]=z,f[2]=O,f[3]=B,f[4]=q,f[5]=Z,f[6]=re,f[7]=de,f[8]=ye,f[9]=Ee,f[10]=Le,f[11]=qe,f[12]=T*Ke+q*yt+ye*Mt+l[12],f[13]=z*Ke+Z*yt+Ee*Mt+l[13],f[14]=O*Ke+re*yt+Le*Mt+l[14],f[15]=B*Ke+de*yt+qe*Mt+l[15]),f},le.K=function(f,l,g){var T=g[0],z=g[1],O=g[2];return f[0]=l[0]*T,f[1]=l[1]*T,f[2]=l[2]*T,f[3]=l[3]*T,f[4]=l[4]*z,f[5]=l[5]*z,f[6]=l[6]*z,f[7]=l[7]*z,f[8]=l[8]*O,f[9]=l[9]*O,f[10]=l[10]*O,f[11]=l[11]*O,f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},le.L=Bm,le.M=function(f,l){const g={};for(let T=0;T<l.length;T++){const z=l[T];z in f&&(g[z]=f[z])}return g},le.N=Ns,le.O=nc,le.P=ut,le.Q=Ud,le.R=go,le.S=el,le.T=Uh,le.U=Tn,le.V=Ci,le.W=Rn,le.X=ca,le.Y=H,le.Z=Wh,le._=n,le.a=ln,le.a$=function(f,l){var g=f[0],T=f[1],z=f[2],O=f[3],B=f[4],q=f[5],Z=f[6],re=f[7],de=f[8],ye=f[9],Ee=f[10],Le=f[11],qe=f[12],Ke=f[13],yt=f[14],Mt=f[15],si=l[0],Ut=l[1],ii=l[2],Pi=l[3],gn=l[4],Wn=l[5],Er=l[6],Fn=l[7],In=l[8],xr=l[9],or=l[10],nr=l[11],Gi=l[12],sr=l[13],vr=l[14],ia=l[15];return Math.abs(g-si)<=Zs*Math.max(1,Math.abs(g),Math.abs(si))&&Math.abs(T-Ut)<=Zs*Math.max(1,Math.abs(T),Math.abs(Ut))&&Math.abs(z-ii)<=Zs*Math.max(1,Math.abs(z),Math.abs(ii))&&Math.abs(O-Pi)<=Zs*Math.max(1,Math.abs(O),Math.abs(Pi))&&Math.abs(B-gn)<=Zs*Math.max(1,Math.abs(B),Math.abs(gn))&&Math.abs(q-Wn)<=Zs*Math.max(1,Math.abs(q),Math.abs(Wn))&&Math.abs(Z-Er)<=Zs*Math.max(1,Math.abs(Z),Math.abs(Er))&&Math.abs(re-Fn)<=Zs*Math.max(1,Math.abs(re),Math.abs(Fn))&&Math.abs(de-In)<=Zs*Math.max(1,Math.abs(de),Math.abs(In))&&Math.abs(ye-xr)<=Zs*Math.max(1,Math.abs(ye),Math.abs(xr))&&Math.abs(Ee-or)<=Zs*Math.max(1,Math.abs(Ee),Math.abs(or))&&Math.abs(Le-nr)<=Zs*Math.max(1,Math.abs(Le),Math.abs(nr))&&Math.abs(qe-Gi)<=Zs*Math.max(1,Math.abs(qe),Math.abs(Gi))&&Math.abs(Ke-sr)<=Zs*Math.max(1,Math.abs(Ke),Math.abs(sr))&&Math.abs(yt-vr)<=Zs*Math.max(1,Math.abs(yt),Math.abs(vr))&&Math.abs(Mt-ia)<=Zs*Math.max(1,Math.abs(Mt),Math.abs(ia))},le.a0=Ba,le.a1=bh,le.a2=cn,le.a3=f=>{const l=window.document.createElement("video");return l.muted=!0,new Promise((g=>{l.onloadstart=()=>{g(l)};for(const T of f){const z=window.document.createElement("source");Cr(T)||(l.crossOrigin="Anonymous"),z.src=T,l.appendChild(z)}}))},le.a4=function(){return Ot++},le.a5=qn,le.a6=bs,le.a7=zf,le.a8=xc,le.a9=Gm,le.aA=function(f){if(f.type==="custom")return new Fs(f);switch(f.type){case"background":return new fl(f);case"circle":return new hf(f);case"fill":return new Nm(f);case"fill-extrusion":return new Uf(f);case"heatmap":return new cp(f);case"hillshade":return new pf(f);case"line":return new Hp(f);case"raster":return new ic(f);case"symbol":return new oo(f)}},le.aB=dn,le.aC=function(f,l){if(!f)return[{command:"setStyle",args:[l]}];let g=[];try{if(!Dr(f.version,l.version))return[{command:"setStyle",args:[l]}];Dr(f.center,l.center)||g.push({command:"setCenter",args:[l.center]}),Dr(f.zoom,l.zoom)||g.push({command:"setZoom",args:[l.zoom]}),Dr(f.bearing,l.bearing)||g.push({command:"setBearing",args:[l.bearing]}),Dr(f.pitch,l.pitch)||g.push({command:"setPitch",args:[l.pitch]}),Dr(f.sprite,l.sprite)||g.push({command:"setSprite",args:[l.sprite]}),Dr(f.glyphs,l.glyphs)||g.push({command:"setGlyphs",args:[l.glyphs]}),Dr(f.transition,l.transition)||g.push({command:"setTransition",args:[l.transition]}),Dr(f.light,l.light)||g.push({command:"setLight",args:[l.light]}),Dr(f.terrain,l.terrain)||g.push({command:"setTerrain",args:[l.terrain]}),Dr(f.sky,l.sky)||g.push({command:"setSky",args:[l.sky]}),Dr(f.projection,l.projection)||g.push({command:"setProjection",args:[l.projection]});const T={},z=[];(function(B,q,Z,re){let de;for(de in q=q||{},B=B||{})Object.prototype.hasOwnProperty.call(B,de)&&(Object.prototype.hasOwnProperty.call(q,de)||ho(de,Z,re));for(de in q)Object.prototype.hasOwnProperty.call(q,de)&&(Object.prototype.hasOwnProperty.call(B,de)?Dr(B[de],q[de])||(B[de].type==="geojson"&&q[de].type==="geojson"&&la(B,q,de)?ma(Z,{command:"setGeoJSONSourceData",args:[de,q[de].data]}):Vo(de,q,Z,re)):rl(de,q,Z))})(f.sources,l.sources,z,T);const O=[];f.layers&&f.layers.forEach((B=>{"source"in B&&T[B.source]?g.push({command:"removeLayer",args:[B.id]}):O.push(B)})),g=g.concat(z),(function(B,q,Z){q=q||[];const re=(B=B||[]).map(qs),de=q.map(qs),ye=B.reduce(Us,{}),Ee=q.reduce(Us,{}),Le=re.slice(),qe=Object.create(null);let Ke,yt,Mt,si,Ut;for(let ii=0,Pi=0;ii<re.length;ii++)Ke=re[ii],Object.prototype.hasOwnProperty.call(Ee,Ke)?Pi++:(ma(Z,{command:"removeLayer",args:[Ke]}),Le.splice(Le.indexOf(Ke,Pi),1));for(let ii=0,Pi=0;ii<de.length;ii++)Ke=de[de.length-1-ii],Le[Le.length-1-ii]!==Ke&&(Object.prototype.hasOwnProperty.call(ye,Ke)?(ma(Z,{command:"removeLayer",args:[Ke]}),Le.splice(Le.lastIndexOf(Ke,Le.length-Pi),1)):Pi++,si=Le[Le.length-ii],ma(Z,{command:"addLayer",args:[Ee[Ke],si]}),Le.splice(Le.length-ii,0,Ke),qe[Ke]=!0);for(let ii=0;ii<de.length;ii++)if(Ke=de[ii],yt=ye[Ke],Mt=Ee[Ke],!qe[Ke]&&!Dr(yt,Mt))if(Dr(yt.source,Mt.source)&&Dr(yt["source-layer"],Mt["source-layer"])&&Dr(yt.type,Mt.type)){for(Ut in Vs(yt.layout,Mt.layout,Z,Ke,null,"setLayoutProperty"),Vs(yt.paint,Mt.paint,Z,Ke,null,"setPaintProperty"),Dr(yt.filter,Mt.filter)||ma(Z,{command:"setFilter",args:[Ke,Mt.filter]}),Dr(yt.minzoom,Mt.minzoom)&&Dr(yt.maxzoom,Mt.maxzoom)||ma(Z,{command:"setLayerZoomRange",args:[Ke,Mt.minzoom,Mt.maxzoom]}),yt)Object.prototype.hasOwnProperty.call(yt,Ut)&&Ut!=="layout"&&Ut!=="paint"&&Ut!=="filter"&&Ut!=="metadata"&&Ut!=="minzoom"&&Ut!=="maxzoom"&&(Ut.indexOf("paint.")===0?Vs(yt[Ut],Mt[Ut],Z,Ke,Ut.slice(6),"setPaintProperty"):Dr(yt[Ut],Mt[Ut])||ma(Z,{command:"setLayerProperty",args:[Ke,Ut,Mt[Ut]]}));for(Ut in Mt)Object.prototype.hasOwnProperty.call(Mt,Ut)&&!Object.prototype.hasOwnProperty.call(yt,Ut)&&Ut!=="layout"&&Ut!=="paint"&&Ut!=="filter"&&Ut!=="metadata"&&Ut!=="minzoom"&&Ut!=="maxzoom"&&(Ut.indexOf("paint.")===0?Vs(yt[Ut],Mt[Ut],Z,Ke,Ut.slice(6),"setPaintProperty"):Dr(yt[Ut],Mt[Ut])||ma(Z,{command:"setLayerProperty",args:[Ke,Ut,Mt[Ut]]}))}else ma(Z,{command:"removeLayer",args:[Ke]}),si=Le[Le.lastIndexOf(Ke)+1],ma(Z,{command:"addLayer",args:[Mt,si]})})(O,l.layers,g)}catch(T){console.warn("Unable to compute style diff:",T),g=[{command:"setStyle",args:[l]}]}return g},le.aD=function(f){const l=[],g=f.id;return g===void 0&&l.push({message:`layers.${g}: missing required property "id"`}),f.render===void 0&&l.push({message:`layers.${g}: missing required method "render"`}),f.renderingMode&&f.renderingMode!=="2d"&&f.renderingMode!=="3d"&&l.push({message:`layers.${g}: property "renderingMode" must be either "2d" or "3d"`}),l},le.aE=function f(l,g){if(Array.isArray(l)){if(!Array.isArray(g)||l.length!==g.length)return!1;for(let T=0;T<l.length;T++)if(!f(l[T],g[T]))return!1;return!0}if(typeof l=="object"&&l!==null&&g!==null){if(typeof g!="object"||Object.keys(l).length!==Object.keys(g).length)return!1;for(const T in l)if(!f(l[T],g[T]))return!1;return!0}return l===g},le.aF=Vt,le.aG=Hi,le.aH=class extends wu{constructor(f,l){super(f,l),this.current=0}set(f){this.current!==f&&(this.current=f,this.gl.uniform1i(this.location,f))}},le.aI=Dd,le.aJ=class extends wu{constructor(f,l){super(f,l),this.current=fh}set(f){if(f[12]!==this.current[12]||f[0]!==this.current[0])return this.current=f,void this.gl.uniformMatrix4fv(this.location,!1,f);for(let l=1;l<16;l++)if(f[l]!==this.current[l]){this.current=f,this.gl.uniformMatrix4fv(this.location,!1,f);break}}},le.aK=qu,le.aL=Xa,le.aM=Ki,le.aN=class extends wu{constructor(f,l){super(f,l),this.current=[0,0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]||(this.current=f,this.gl.uniform3f(this.location,f[0],f[1],f[2]))}},le.aO=class extends wu{constructor(f,l){super(f,l),this.current=[0,0]}set(f){f[0]===this.current[0]&&f[1]===this.current[1]||(this.current=f,this.gl.uniform2f(this.location,f[0],f[1]))}},le.aP=function(f,l,g,T,z,O,B){var q=1/(l-g),Z=1/(T-z),re=1/(O-B);return f[0]=-2*q,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=-2*Z,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=2*re,f[11]=0,f[12]=(l+g)*q,f[13]=(z+T)*Z,f[14]=(B+O)*re,f[15]=1,f},le.aQ=Zr,le.aR=class extends Ht{},le.aS=wl,le.aT=class extends oi{},le.aU=ff,le.aV=function(f){return f<=1?1:Math.pow(2,Math.ceil(Math.log(f)/Math.LN2))},le.aW=ph,le.aX=Ms,le.aY=Yo,le.aZ=class extends ir{},le.a_=function(f,l){return f[0]===l[0]&&f[1]===l[1]&&f[2]===l[2]&&f[3]===l[3]&&f[4]===l[4]&&f[5]===l[5]&&f[6]===l[6]&&f[7]===l[7]&&f[8]===l[8]&&f[9]===l[9]&&f[10]===l[10]&&f[11]===l[11]&&f[12]===l[12]&&f[13]===l[13]&&f[14]===l[14]&&f[15]===l[15]},le.aa=function(f){const l={};if(f.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((g,T,z,O)=>{const B=z||O;return l[T]=!B||B.toLowerCase(),""})),l["max-age"]){const g=parseInt(l["max-age"],10);isNaN(g)?delete l["max-age"]:l["max-age"]=g}return l},le.ab=function(f,l){const g=[];for(const T in f)T in l||g.push(T);return g},le.ac=Oi,le.ad=function(f,l,g){var T=Math.sin(g),z=Math.cos(g),O=l[0],B=l[1],q=l[2],Z=l[3],re=l[4],de=l[5],ye=l[6],Ee=l[7];return l!==f&&(f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[0]=O*z+re*T,f[1]=B*z+de*T,f[2]=q*z+ye*T,f[3]=Z*z+Ee*T,f[4]=re*z-O*T,f[5]=de*z-B*T,f[6]=ye*z-q*T,f[7]=Ee*z-Z*T,f},le.ae=function(f){var l=new kd(16);return l[0]=f[0],l[1]=f[1],l[2]=f[2],l[3]=f[3],l[4]=f[4],l[5]=f[5],l[6]=f[6],l[7]=f[7],l[8]=f[8],l[9]=f[9],l[10]=f[10],l[11]=f[11],l[12]=f[12],l[13]=f[13],l[14]=f[14],l[15]=f[15],l},le.af=sp,le.ag=function(f,l){let g=0,T=0;if(f.kind==="constant")T=f.layoutSize;else if(f.kind!=="source"){const{interpolationType:z,minZoom:O,maxZoom:B}=f,q=z?Oi(Eo.interpolationFactor(z,l,O,B),0,1):0;f.kind==="camera"?T=Po.number(f.minSize,f.maxSize,q):g=q}return{uSizeT:g,uSize:T}},le.ai=function(f,{uSize:l,uSizeT:g},{lowerSize:T,upperSize:z}){return f.kind==="source"?T/Gr:f.kind==="composite"?Po.number(T/Gr,z/Gr,g):l},le.aj=ya,le.ak=function(f,l,g,T){const z=l.y-f.y,O=l.x-f.x,B=T.y-g.y,q=T.x-g.x,Z=B*O-q*z;if(Z===0)return null;const re=(q*(f.y-g.y)-B*(f.x-g.x))/Z;return new ut(f.x+re*O,f.y+re*z)},le.al=Hm,le.am=dm,le.an=uf,le.ao=function(f){let l=1/0,g=1/0,T=-1/0,z=-1/0;for(const O of f)l=Math.min(l,O.x),g=Math.min(g,O.y),T=Math.max(T,O.x),z=Math.max(z,O.y);return[l,g,T,z]},le.ap=t,le.ar=mr,le.as=function(f,l){var g=l[0],T=l[1],z=l[2],O=l[3],B=l[4],q=l[5],Z=l[6],re=l[7],de=l[8],ye=l[9],Ee=l[10],Le=l[11],qe=l[12],Ke=l[13],yt=l[14],Mt=l[15],si=g*q-T*B,Ut=g*Z-z*B,ii=g*re-O*B,Pi=T*Z-z*q,gn=T*re-O*q,Wn=z*re-O*Z,Er=de*Ke-ye*qe,Fn=de*yt-Ee*qe,In=de*Mt-Le*qe,xr=ye*yt-Ee*Ke,or=ye*Mt-Le*Ke,nr=Ee*Mt-Le*yt,Gi=si*nr-Ut*or+ii*xr+Pi*In-gn*Fn+Wn*Er;return Gi?(f[0]=(q*nr-Z*or+re*xr)*(Gi=1/Gi),f[1]=(z*or-T*nr-O*xr)*Gi,f[2]=(Ke*Wn-yt*gn+Mt*Pi)*Gi,f[3]=(Ee*gn-ye*Wn-Le*Pi)*Gi,f[4]=(Z*In-B*nr-re*Fn)*Gi,f[5]=(g*nr-z*In+O*Fn)*Gi,f[6]=(yt*ii-qe*Wn-Mt*Ut)*Gi,f[7]=(de*Wn-Ee*ii+Le*Ut)*Gi,f[8]=(B*or-q*In+re*Er)*Gi,f[9]=(T*In-g*or-O*Er)*Gi,f[10]=(qe*gn-Ke*ii+Mt*si)*Gi,f[11]=(ye*ii-de*gn-Le*si)*Gi,f[12]=(q*Fn-B*xr-Z*Er)*Gi,f[13]=(g*xr-T*Fn+z*Er)*Gi,f[14]=(Ke*Ut-qe*Pi-yt*si)*Gi,f[15]=(de*Pi-ye*Ut+Ee*si)*Gi,f):null},le.at=Ym,le.au=Br,le.av=$f,le.aw=function(){const f={},l=Yt.$version;for(const g in Yt.$root){const T=Yt.$root[g];if(T.required){let z=null;z=g==="version"?l:T.type==="array"?[]:{},z!=null&&(f[g]=z)}}return f},le.ax=ef,le.ay=pr,le.az=function(f){f=f.slice();const l=Object.create(null);for(let g=0;g<f.length;g++)l[f[g].id]=f[g];for(let g=0;g<f.length;g++)"ref"in f[g]&&(f[g]=zr(f[g],l[f[g].ref]));return f},le.b=Si,le.b0=function(f,l){return f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[4]=l[4],f[5]=l[5],f[6]=l[6],f[7]=l[7],f[8]=l[8],f[9]=l[9],f[10]=l[10],f[11]=l[11],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15],f},le.b1=function(f,l,g){return f[0]=l[0]*g[0],f[1]=l[1]*g[1],f[2]=l[2]*g[2],f[3]=l[3]*g[3],f},le.b2=function(f,l){return f[0]*l[0]+f[1]*l[1]+f[2]*l[2]+f[3]*l[3]},le.b3=Hn,le.b4=bf,le.b5=Ku,le.b6=function(f,l,g,T,z){var O,B=1/Math.tan(l/2);return f[0]=B/g,f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=B,f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[11]=-1,f[12]=0,f[13]=0,f[15]=0,z!=null&&z!==1/0?(f[10]=(z+T)*(O=1/(T-z)),f[14]=2*z*T*O):(f[10]=-1,f[14]=-2*T),f},le.b7=function(f,l,g){var T=Math.sin(g),z=Math.cos(g),O=l[4],B=l[5],q=l[6],Z=l[7],re=l[8],de=l[9],ye=l[10],Ee=l[11];return l!==f&&(f[0]=l[0],f[1]=l[1],f[2]=l[2],f[3]=l[3],f[12]=l[12],f[13]=l[13],f[14]=l[14],f[15]=l[15]),f[4]=O*z+re*T,f[5]=B*z+de*T,f[6]=q*z+ye*T,f[7]=Z*z+Ee*T,f[8]=re*z-O*T,f[9]=de*z-B*T,f[10]=ye*z-q*T,f[11]=Ee*z-Z*T,f},le.b8=Ji,le.b9=Vn,le.bA=a,le.bB=function(f){return f.message===jt},le.bC=kc,le.bD=Wo,le.ba=function(f){return f*Math.PI/180},le.bb=function(f,l){const{x:g,y:T}=Wh.fromLngLat(l);return!(f<0||f>25||T<0||T>=1||g<0||g>=1)},le.bc=function(f,l){return f[0]=l[0],f[1]=0,f[2]=0,f[3]=0,f[4]=0,f[5]=l[1],f[6]=0,f[7]=0,f[8]=0,f[9]=0,f[10]=l[2],f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1,f},le.bd=class extends he{},le.be=Na,le.bf=_g,le.bh=Mr,le.bi=function(f,l){ln.REGISTERED_PROTOCOLS[f]=l},le.bj=function(f){delete ln.REGISTERED_PROTOCOLS[f]},le.bk=function(f,l){const g={};for(let z=0;z<f.length;z++){const O=l&&l[f[z].id]||dc(f[z]);l&&(l[f[z].id]=O);let B=g[O];B||(B=g[O]=[]),B.push(f[z])}const T=[];for(const z in g)T.push(g[z]);return T},le.bl=fn,le.bm=cs,le.bn=A_,le.bo=gt,le.bp=function(f){f.bucket.createArrays(),f.bucket.tilePixelRatio=ca/(512*f.bucket.overscaling),f.bucket.compareText={},f.bucket.iconsNeedLinear=!1;const l=f.bucket.layers[0],g=l.layout,T=l._unevaluatedLayout._values,z={layoutIconSize:T["icon-size"].possiblyEvaluate(new ka(f.bucket.zoom+1),f.canonical),layoutTextSize:T["text-size"].possiblyEvaluate(new ka(f.bucket.zoom+1),f.canonical),textMaxSize:T["text-size"].possiblyEvaluate(new ka(18))};if(f.bucket.textSizeData.kind==="composite"){const{minZoom:re,maxZoom:de}=f.bucket.textSizeData;z.compositeTextSizes=[T["text-size"].possiblyEvaluate(new ka(re),f.canonical),T["text-size"].possiblyEvaluate(new ka(de),f.canonical)]}if(f.bucket.iconSizeData.kind==="composite"){const{minZoom:re,maxZoom:de}=f.bucket.iconSizeData;z.compositeIconSizes=[T["icon-size"].possiblyEvaluate(new ka(re),f.canonical),T["icon-size"].possiblyEvaluate(new ka(de),f.canonical)]}const O=g.get("text-line-height")*t,B=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point",q=g.get("text-keep-upright"),Z=g.get("text-size");for(const re of f.bucket.features){const de=g.get("text-font").evaluate(re,{},f.canonical).join(","),ye=Z.evaluate(re,{},f.canonical),Ee=z.layoutTextSize.evaluate(re,{},f.canonical),Le=z.layoutIconSize.evaluate(re,{},f.canonical),qe={horizontal:{},vertical:void 0},Ke=re.text;let yt,Mt=[0,0];if(Ke){const ii=Ke.toString(),Pi=g.get("text-letter-spacing").evaluate(re,{},f.canonical)*t,gn=tp(ii)?Pi:0,Wn=g.get("text-anchor").evaluate(re,{},f.canonical),Er=C_(l,re,f.canonical);if(!Er){const or=g.get("text-radial-offset").evaluate(re,{},f.canonical);Mt=or?Wp(Wn,[or*t,f_]):g.get("text-offset").evaluate(re,{},f.canonical).map((nr=>nr*t))}let Fn=B?"center":g.get("text-justify").evaluate(re,{},f.canonical);const In=g.get("symbol-placement")==="point"?g.get("text-max-width").evaluate(re,{},f.canonical)*t:1/0,xr=()=>{f.bucket.allowVerticalPlacement&&Yc(ii)&&(qe.vertical=Ei(Ke,f.glyphMap,f.glyphPositions,f.imagePositions,de,In,O,Wn,"left",gn,Mt,le.ah.vertical,!0,Ee,ye))};if(!B&&Er){const or=new Set;if(Fn==="auto")for(let Gi=0;Gi<Er.values.length;Gi+=2)or.add(Ym(Er.values[Gi]));else or.add(Fn);let nr=!1;for(const Gi of or)if(!qe.horizontal[Gi])if(nr)qe.horizontal[Gi]=qe.horizontal[0];else{const sr=Ei(Ke,f.glyphMap,f.glyphPositions,f.imagePositions,de,In,O,"center",Gi,gn,Mt,le.ah.horizontal,!1,Ee,ye);sr&&(qe.horizontal[Gi]=sr,nr=sr.positionedLines.length===1)}xr()}else{Fn==="auto"&&(Fn=Ym(Wn));const or=Ei(Ke,f.glyphMap,f.glyphPositions,f.imagePositions,de,In,O,Wn,Fn,gn,Mt,le.ah.horizontal,!1,Ee,ye);or&&(qe.horizontal[Fn]=or),xr(),Yc(ii)&&B&&q&&(qe.vertical=Ei(Ke,f.glyphMap,f.glyphPositions,f.imagePositions,de,In,O,Wn,Fn,gn,Mt,le.ah.vertical,!1,Ee,ye))}}let si=!1;if(re.icon&&re.icon.name){const ii=f.imageMap[re.icon.name];ii&&(yt=_n(f.imagePositions[re.icon.name],g.get("icon-offset").evaluate(re,{},f.canonical),g.get("icon-anchor").evaluate(re,{},f.canonical)),si=!!ii.sdf,f.bucket.sdfIcons===void 0?f.bucket.sdfIcons=si:f.bucket.sdfIcons!==si&&an("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ii.pixelRatio!==f.bucket.pixelRatio||g.get("icon-rotate").constantOr(1)!==0)&&(f.bucket.iconsNeedLinear=!0))}const Ut=wd(qe.horizontal)||qe.vertical;f.bucket.iconsInText=!!Ut&&Ut.iconsInText,(Ut||yt)&&Ss(f.bucket,re,qe,yt,f.imageMap,z,Ee,Le,Mt,si,f.canonical)}f.showCollisionBoxes&&f.bucket.generateCollisionDebugBuffers()},le.bq=Gp,le.br=yf,le.bs=Vf,le.bt=mh,le.bu=Fe,le.bv=class{constructor(f){this._marks={start:[f.url,"start"].join("#"),end:[f.url,"end"].join("#"),measure:f.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let f=performance.getEntriesByName(this._marks.measure);return f.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),f=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),f}},le.bw=function(f,l,g,T,z){return n(this,void 0,void 0,(function*(){if(Ci())try{return yield Rn(f,l,g,T,z)}catch{}return(function(O,B,q,Z,re){const de=O.width,ye=O.height;wr&&Tt||(wr=new OffscreenCanvas(de,ye),Tt=wr.getContext("2d",{willReadFrequently:!0})),wr.width=de,wr.height=ye,Tt.drawImage(O,0,0,de,ye);const Ee=Tt.getImageData(B,q,Z,re);return Tt.clearRect(0,0,de,ye),Ee.data})(f,l,g,T,z)}))},le.bx=Ju,le.by=tt,le.bz=ke,le.c=ai,le.d=f=>n(void 0,void 0,void 0,(function*(){if(f.byteLength===0)return createImageBitmap(new ImageData(1,1));const l=new Blob([new Uint8Array(f)],{type:"image/png"});try{return createImageBitmap(l)}catch(g){throw new Error(`Could not load image because of ${g.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}})),le.e=qi,le.f=f=>new Promise(((l,g)=>{const T=new Image;T.onload=()=>{l(T),URL.revokeObjectURL(T.src),T.onload=null,window.requestAnimationFrame((()=>{T.src=yn}))},T.onerror=()=>g(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const z=new Blob([new Uint8Array(f)],{type:"image/png"});T.src=f.byteLength?URL.createObjectURL(z):yn})),le.g=Jn,le.h=(f,l)=>Cn(qi(f,{type:"json"}),l),le.i=Qr,le.j=Aa,le.k=ra,le.l=(f,l)=>Cn(qi(f,{type:"arrayBuffer"}),l),le.m=Cn,le.n=function(f){return new Fe(f).readFields(it,[])},le.o=bc,le.p=It,le.q=L,le.r=Vu,le.s=Cr,le.t=Nh,le.u=Bl,le.v=Yt,le.w=an,le.x=function([f,l,g]){return l+=90,l*=Math.PI/180,g*=Math.PI/180,{x:f*Math.cos(l)*Math.sin(g),y:f*Math.sin(l)*Math.sin(g),z:f*Math.cos(g)}},le.y=Po,le.z=ka})),Me("worker",["./shared"],(function(le){class n{constructor(Ce){this.keyCache={},Ce&&this.replace(Ce)}replace(Ce){this._layerConfigs={},this._layers={},this.update(Ce,[])}update(Ce,Re){for(const mt of Ce){this._layerConfigs[mt.id]=mt;const Nt=this._layers[mt.id]=le.aA(mt);Nt._featureFilter=le.a7(Nt.filter),this.keyCache[mt.id]&&delete this.keyCache[mt.id]}for(const mt of Re)delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt];this.familiesBySource={};const Qe=le.bk(Object.values(this._layerConfigs),this.keyCache);for(const mt of Qe){const Nt=mt.map((hi=>this._layers[hi.id])),je=Nt[0];if(je.visibility==="none")continue;const ei=je.source||"";let Pt=this.familiesBySource[ei];Pt||(Pt=this.familiesBySource[ei]={});const Di=je.sourceLayer||"_geojsonTileLayer";let fi=Pt[Di];fi||(fi=Pt[Di]=[]),fi.push(Nt)}}}class tt{constructor(Ce){const Re={},Qe=[];for(const ei in Ce){const Pt=Ce[ei],Di=Re[ei]={};for(const fi in Pt){const hi=Pt[+fi];if(!hi||hi.bitmap.width===0||hi.bitmap.height===0)continue;const kn={x:0,y:0,w:hi.bitmap.width+2,h:hi.bitmap.height+2};Qe.push(kn),Di[fi]={rect:kn,metrics:hi.metrics}}}const{w:mt,h:Nt}=le.p(Qe),je=new le.o({width:mt||1,height:Nt||1});for(const ei in Ce){const Pt=Ce[ei];for(const Di in Pt){const fi=Pt[+Di];if(!fi||fi.bitmap.width===0||fi.bitmap.height===0)continue;const hi=Re[ei][Di].rect;le.o.copy(fi.bitmap,je,{x:0,y:0},{x:hi.x+1,y:hi.y+1},fi.bitmap)}}this.image=je,this.positions=Re}}le.bl("GlyphAtlas",tt);class ke{constructor(Ce){this.tileID=new le.S(Ce.tileID.overscaledZ,Ce.tileID.wrap,Ce.tileID.canonical.z,Ce.tileID.canonical.x,Ce.tileID.canonical.y),this.uid=Ce.uid,this.zoom=Ce.zoom,this.pixelRatio=Ce.pixelRatio,this.tileSize=Ce.tileSize,this.source=Ce.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Ce.showCollisionBoxes,this.collectResourceTiming=!!Ce.collectResourceTiming,this.returnDependencies=!!Ce.returnDependencies,this.promoteId=Ce.promoteId,this.inFlightDependencies=[]}parse(Ce,Re,Qe,mt){return le._(this,void 0,void 0,(function*(){this.status="parsing",this.data=Ce,this.collisionBoxArray=new le.a5;const Nt=new le.bm(Object.keys(Ce.layers).sort()),je=new le.bn(this.tileID,this.promoteId);je.bucketLayerIDs=[];const ei={},Pt={featureIndex:je,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Qe},Di=Re.familiesBySource[this.source];for(const rt in Di){const wt=Ce.layers[rt];if(!wt)continue;wt.version===1&&le.w(`Vector tile source "${this.source}" layer "${rt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ot=Nt.encode(rt),At=[];for(let ti=0;ti<wt.length;ti++){const qt=wt.feature(ti),Yi=je.getId(qt,rt);At.push({feature:qt,id:Yi,index:ti,sourceLayerIndex:ot})}for(const ti of Di[rt]){const qt=ti[0];qt.source!==this.source&&le.w(`layer.source = ${qt.source} does not equal this.source = ${this.source}`),qt.minzoom&&this.zoom<Math.floor(qt.minzoom)||qt.maxzoom&&this.zoom>=qt.maxzoom||qt.visibility!=="none"&&(Rt(ti,this.zoom,Qe),(ei[qt.id]=qt.createBucket({index:je.bucketLayerIDs.length,layers:ti,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ot,sourceID:this.source})).populate(At,Pt,this.tileID.canonical),je.bucketLayerIDs.push(ti.map((Yi=>Yi.id))))}}const fi=le.aF(Pt.glyphDependencies,(rt=>Object.keys(rt).map(Number)));this.inFlightDependencies.forEach((rt=>rt?.abort())),this.inFlightDependencies=[];let hi=Promise.resolve({});if(Object.keys(fi).length){const rt=new AbortController;this.inFlightDependencies.push(rt),hi=mt.sendAsync({type:"GG",data:{stacks:fi,source:this.source,tileID:this.tileID,type:"glyphs"}},rt)}const kn=Object.keys(Pt.iconDependencies);let hr=Promise.resolve({});if(kn.length){const rt=new AbortController;this.inFlightDependencies.push(rt),hr=mt.sendAsync({type:"GI",data:{icons:kn,source:this.source,tileID:this.tileID,type:"icons"}},rt)}const Tr=Object.keys(Pt.patternDependencies);let lt=Promise.resolve({});if(Tr.length){const rt=new AbortController;this.inFlightDependencies.push(rt),lt=mt.sendAsync({type:"GI",data:{icons:Tr,source:this.source,tileID:this.tileID,type:"patterns"}},rt)}const[te,pe,ze]=yield Promise.all([hi,hr,lt]),et=new tt(te),Xe=new le.bo(pe,ze);for(const rt in ei){const wt=ei[rt];wt instanceof le.a6?(Rt(wt.layers,this.zoom,Qe),le.bp({bucket:wt,glyphMap:te,glyphPositions:et.positions,imageMap:pe,imagePositions:Xe.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):wt.hasPattern&&(wt instanceof le.bq||wt instanceof le.br||wt instanceof le.bs)&&(Rt(wt.layers,this.zoom,Qe),wt.addFeatures(Pt,this.tileID.canonical,Xe.patternPositions))}return this.status="done",{buckets:Object.values(ei).filter((rt=>!rt.isEmpty())),featureIndex:je,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:et.image,imageAtlas:Xe,glyphMap:this.returnDependencies?te:null,iconMap:this.returnDependencies?pe:null,glyphPositions:this.returnDependencies?et.positions:null}}))}}function Rt(dt,Ce,Re){const Qe=new le.z(Ce);for(const mt of dt)mt.recalculate(Qe,Re)}class ut{constructor(Ce,Re,Qe){this.actor=Ce,this.layerIndex=Re,this.availableImages=Qe,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Ce,Re){return le._(this,void 0,void 0,(function*(){const Qe=yield le.l(Ce.request,Re);try{return{vectorTile:new le.bt.VectorTile(new le.bu(Qe.data)),rawData:Qe.data,cacheControl:Qe.cacheControl,expires:Qe.expires}}catch(mt){const Nt=new Uint8Array(Qe.data);let je=`Unable to parse the tile at ${Ce.request.url}, `;throw je+=Nt[0]===31&&Nt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${mt.message}`,new Error(je)}}))}loadTile(Ce){return le._(this,void 0,void 0,(function*(){const Re=Ce.uid,Qe=!!(Ce&&Ce.request&&Ce.request.collectResourceTiming)&&new le.bv(Ce.request),mt=new ke(Ce);this.loading[Re]=mt;const Nt=new AbortController;mt.abort=Nt;try{const je=yield this.loadVectorTile(Ce,Nt);if(delete this.loading[Re],!je)return null;const ei=je.rawData,Pt={};je.expires&&(Pt.expires=je.expires),je.cacheControl&&(Pt.cacheControl=je.cacheControl);const Di={};if(Qe){const hi=Qe.finish();hi&&(Di.resourceTiming=JSON.parse(JSON.stringify(hi)))}mt.vectorTile=je.vectorTile;const fi=mt.parse(je.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[Re]=mt,this.fetching[Re]={rawTileData:ei,cacheControl:Pt,resourceTiming:Di};try{const hi=yield fi;return le.e({rawTileData:ei.slice(0)},hi,Pt,Di)}finally{delete this.fetching[Re]}}catch(je){throw delete this.loading[Re],mt.status="done",this.loaded[Re]=mt,je}}))}reloadTile(Ce){return le._(this,void 0,void 0,(function*(){const Re=Ce.uid;if(!this.loaded||!this.loaded[Re])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const Qe=this.loaded[Re];if(Qe.showCollisionBoxes=Ce.showCollisionBoxes,Qe.status==="parsing"){const mt=yield Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor);let Nt;if(this.fetching[Re]){const{rawTileData:je,cacheControl:ei,resourceTiming:Pt}=this.fetching[Re];delete this.fetching[Re],Nt=le.e({rawTileData:je.slice(0)},mt,ei,Pt)}else Nt=mt;return Nt}if(Qe.status==="done"&&Qe.vectorTile)return Qe.parse(Qe.vectorTile,this.layerIndex,this.availableImages,this.actor)}))}abortTile(Ce){return le._(this,void 0,void 0,(function*(){const Re=this.loading,Qe=Ce.uid;Re&&Re[Qe]&&Re[Qe].abort&&(Re[Qe].abort.abort(),delete Re[Qe])}))}removeTile(Ce){return le._(this,void 0,void 0,(function*(){this.loaded&&this.loaded[Ce.uid]&&delete this.loaded[Ce.uid]}))}}class bt{constructor(){this.loaded={}}loadTile(Ce){return le._(this,void 0,void 0,(function*(){const{uid:Re,encoding:Qe,rawImageData:mt,redFactor:Nt,greenFactor:je,blueFactor:ei,baseShift:Pt}=Ce,Di=mt.width+2,fi=mt.height+2,hi=le.b(mt)?new le.R({width:Di,height:fi},yield le.bw(mt,-1,-1,Di,fi)):mt,kn=new le.bx(Re,hi,Qe,Nt,je,ei,Pt);return this.loaded=this.loaded||{},this.loaded[Re]=kn,kn}))}removeTile(Ce){const Re=this.loaded,Qe=Ce.uid;Re&&Re[Qe]&&delete Re[Qe]}}function rn(dt,Ce){if(dt.length!==0){on(dt[0],Ce);for(var Re=1;Re<dt.length;Re++)on(dt[Re],!Ce)}}function on(dt,Ce){for(var Re=0,Qe=0,mt=0,Nt=dt.length,je=Nt-1;mt<Nt;je=mt++){var ei=(dt[mt][0]-dt[je][0])*(dt[je][1]+dt[mt][1]),Pt=Re+ei;Qe+=Math.abs(Re)>=Math.abs(ei)?Re-Pt+ei:ei-Pt+Re,Re=Pt}Re+Qe>=0!=!!Ce&&dt.reverse()}var Vi=le.by((function dt(Ce,Re){var Qe,mt=Ce&&Ce.type;if(mt==="FeatureCollection")for(Qe=0;Qe<Ce.features.length;Qe++)dt(Ce.features[Qe],Re);else if(mt==="GeometryCollection")for(Qe=0;Qe<Ce.geometries.length;Qe++)dt(Ce.geometries[Qe],Re);else if(mt==="Feature")dt(Ce.geometry,Re);else if(mt==="Polygon")rn(Ce.coordinates,Re);else if(mt==="MultiPolygon")for(Qe=0;Qe<Ce.coordinates.length;Qe++)rn(Ce.coordinates[Qe],Re);return Ce}));const Wi=le.bt.VectorTileFeature.prototype.toGeoJSON;var Tn={exports:{}},Ci=le.bz,Ji=le.bt.VectorTileFeature,Vn=Oi;function Oi(dt,Ce){this.options=Ce||{},this.features=dt,this.length=dt.length}function Hn(dt,Ce){this.id=typeof dt.id=="number"?dt.id:void 0,this.type=dt.type,this.rawGeometry=dt.type===1?[dt.geometry]:dt.geometry,this.properties=dt.tags,this.extent=Ce||4096}Oi.prototype.feature=function(dt){return new Hn(this.features[dt],this.options.extent)},Hn.prototype.loadGeometry=function(){var dt=this.rawGeometry;this.geometry=[];for(var Ce=0;Ce<dt.length;Ce++){for(var Re=dt[Ce],Qe=[],mt=0;mt<Re.length;mt++)Qe.push(new Ci(Re[mt][0],Re[mt][1]));this.geometry.push(Qe)}return this.geometry},Hn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var dt=this.geometry,Ce=1/0,Re=-1/0,Qe=1/0,mt=-1/0,Nt=0;Nt<dt.length;Nt++)for(var je=dt[Nt],ei=0;ei<je.length;ei++){var Pt=je[ei];Ce=Math.min(Ce,Pt.x),Re=Math.max(Re,Pt.x),Qe=Math.min(Qe,Pt.y),mt=Math.max(mt,Pt.y)}return[Ce,Qe,Re,mt]},Hn.prototype.toGeoJSON=Ji.prototype.toGeoJSON;var qi=le.bA,Ot=Vn;function Vt(dt){var Ce=new qi;return(function(Re,Qe){for(var mt in Re.layers)Qe.writeMessage(3,Hi,Re.layers[mt])})(dt,Ce),Ce.finish()}function Hi(dt,Ce){var Re;Ce.writeVarintField(15,dt.version||1),Ce.writeStringField(1,dt.name||""),Ce.writeVarintField(5,dt.extent||4096);var Qe={keys:[],values:[],keycache:{},valuecache:{}};for(Re=0;Re<dt.length;Re++)Qe.feature=dt.feature(Re),Ce.writeMessage(2,dn,Qe);var mt=Qe.keys;for(Re=0;Re<mt.length;Re++)Ce.writeStringField(3,mt[Re]);var Nt=Qe.values;for(Re=0;Re<Nt.length;Re++)Ce.writeMessage(4,ui,Nt[Re])}function dn(dt,Ce){var Re=dt.feature;Re.id!==void 0&&Ce.writeVarintField(1,Re.id),Ce.writeMessage(2,Ui,dt),Ce.writeVarintField(3,Re.type),Ce.writeMessage(4,Qr,Re)}function Ui(dt,Ce){var Re=dt.feature,Qe=dt.keys,mt=dt.values,Nt=dt.keycache,je=dt.valuecache;for(var ei in Re.properties){var Pt=Re.properties[ei],Di=Nt[ei];if(Pt!==null){Di===void 0&&(Qe.push(ei),Nt[ei]=Di=Qe.length-1),Ce.writeVarint(Di);var fi=typeof Pt;fi!=="string"&&fi!=="boolean"&&fi!=="number"&&(Pt=JSON.stringify(Pt));var hi=fi+":"+Pt,kn=je[hi];kn===void 0&&(mt.push(Pt),je[hi]=kn=mt.length-1),Ce.writeVarint(kn)}}}function an(dt,Ce){return(Ce<<3)+(7&dt)}function Hr(dt){return dt<<1^dt>>31}function Qr(dt,Ce){for(var Re=dt.loadGeometry(),Qe=dt.type,mt=0,Nt=0,je=Re.length,ei=0;ei<je;ei++){var Pt=Re[ei],Di=1;Qe===1&&(Di=Pt.length),Ce.writeVarint(an(1,Di));for(var fi=Qe===3?Pt.length-1:Pt.length,hi=0;hi<fi;hi++){hi===1&&Qe!==1&&Ce.writeVarint(an(2,fi-1));var kn=Pt[hi].x-mt,hr=Pt[hi].y-Nt;Ce.writeVarint(Hr(kn)),Ce.writeVarint(Hr(hr)),mt+=kn,Nt+=hr}Qe===3&&Ce.writeVarint(an(7,1))}}function ui(dt,Ce){var Re=typeof dt;Re==="string"?Ce.writeStringField(1,dt):Re==="boolean"?Ce.writeBooleanField(7,dt):Re==="number"&&(dt%1!=0?Ce.writeDoubleField(3,dt):dt<0?Ce.writeSVarintField(6,dt):Ce.writeVarintField(5,dt))}Tn.exports=Vt,Tn.exports.fromVectorTileJs=Vt,Tn.exports.fromGeojsonVt=function(dt,Ce){Ce=Ce||{};var Re={};for(var Qe in dt)Re[Qe]=new Ot(dt[Qe].features,Ce),Re[Qe].name=Qe,Re[Qe].version=Ce.version,Re[Qe].extent=Ce.extent;return Vt({layers:Re})},Tn.exports.GeoJSONWrapper=Ot;var Si=le.by(Tn.exports);const yn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:dt=>dt},Rn=Math.fround||(wr=new Float32Array(1),dt=>(wr[0]=+dt,wr[0]));var wr;const Tt=3,jt=5,ai=6;class ln{constructor(Ce){this.options=Object.assign(Object.create(yn),Ce),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Ce){const{log:Re,minZoom:Qe,maxZoom:mt}=this.options;Re&&console.time("total time");const Nt=`prepare ${Ce.length} points`;Re&&console.time(Nt),this.points=Ce;const je=[];for(let Pt=0;Pt<Ce.length;Pt++){const Di=Ce[Pt];if(!Di.geometry)continue;const[fi,hi]=Di.geometry.coordinates,kn=Rn(Mr(fi)),hr=Rn(pr(hi));je.push(kn,hr,1/0,Pt,-1,1),this.options.reduce&&je.push(0)}let ei=this.trees[mt+1]=this._createTree(je);Re&&console.timeEnd(Nt);for(let Pt=mt;Pt>=Qe;Pt--){const Di=+Date.now();ei=this.trees[Pt]=this._createTree(this._cluster(ei,Pt)),Re&&console.log("z%d: %d clusters in %dms",Pt,ei.numItems,+Date.now()-Di)}return Re&&console.timeEnd("total time"),this}getClusters(Ce,Re){let Qe=((Ce[0]+180)%360+360)%360-180;const mt=Math.max(-90,Math.min(90,Ce[1]));let Nt=Ce[2]===180?180:((Ce[2]+180)%360+360)%360-180;const je=Math.max(-90,Math.min(90,Ce[3]));if(Ce[2]-Ce[0]>=360)Qe=-180,Nt=180;else if(Qe>Nt){const hi=this.getClusters([Qe,mt,180,je],Re),kn=this.getClusters([-180,mt,Nt,je],Re);return hi.concat(kn)}const ei=this.trees[this._limitZoom(Re)],Pt=ei.range(Mr(Qe),pr(je),Mr(Nt),pr(mt)),Di=ei.data,fi=[];for(const hi of Pt){const kn=this.stride*hi;fi.push(Di[kn+jt]>1?Jn(Di,kn,this.clusterProps):this.points[Di[kn+Tt]])}return fi}getChildren(Ce){const Re=this._getOriginId(Ce),Qe=this._getOriginZoom(Ce),mt="No cluster with the specified id.",Nt=this.trees[Qe];if(!Nt)throw new Error(mt);const je=Nt.data;if(Re*this.stride>=je.length)throw new Error(mt);const ei=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),Pt=Nt.within(je[Re*this.stride],je[Re*this.stride+1],ei),Di=[];for(const fi of Pt){const hi=fi*this.stride;je[hi+4]===Ce&&Di.push(je[hi+jt]>1?Jn(je,hi,this.clusterProps):this.points[je[hi+Tt]])}if(Di.length===0)throw new Error(mt);return Di}getLeaves(Ce,Re,Qe){const mt=[];return this._appendLeaves(mt,Ce,Re=Re||10,Qe=Qe||0,0),mt}getTile(Ce,Re,Qe){const mt=this.trees[this._limitZoom(Ce)],Nt=Math.pow(2,Ce),{extent:je,radius:ei}=this.options,Pt=ei/je,Di=(Qe-Pt)/Nt,fi=(Qe+1+Pt)/Nt,hi={features:[]};return this._addTileFeatures(mt.range((Re-Pt)/Nt,Di,(Re+1+Pt)/Nt,fi),mt.data,Re,Qe,Nt,hi),Re===0&&this._addTileFeatures(mt.range(1-Pt/Nt,Di,1,fi),mt.data,Nt,Qe,Nt,hi),Re===Nt-1&&this._addTileFeatures(mt.range(0,Di,Pt/Nt,fi),mt.data,-1,Qe,Nt,hi),hi.features.length?hi:null}getClusterExpansionZoom(Ce){let Re=this._getOriginZoom(Ce)-1;for(;Re<=this.options.maxZoom;){const Qe=this.getChildren(Ce);if(Re++,Qe.length!==1)break;Ce=Qe[0].properties.cluster_id}return Re}_appendLeaves(Ce,Re,Qe,mt,Nt){const je=this.getChildren(Re);for(const ei of je){const Pt=ei.properties;if(Pt&&Pt.cluster?Nt+Pt.point_count<=mt?Nt+=Pt.point_count:Nt=this._appendLeaves(Ce,Pt.cluster_id,Qe,mt,Nt):Nt<mt?Nt++:Ce.push(ei),Ce.length===Qe)break}return Nt}_createTree(Ce){const Re=new le.av(Ce.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Qe=0;Qe<Ce.length;Qe+=this.stride)Re.add(Ce[Qe],Ce[Qe+1]);return Re.finish(),Re.data=Ce,Re}_addTileFeatures(Ce,Re,Qe,mt,Nt,je){for(const ei of Ce){const Pt=ei*this.stride,Di=Re[Pt+jt]>1;let fi,hi,kn;if(Di)fi=_r(Re,Pt,this.clusterProps),hi=Re[Pt],kn=Re[Pt+1];else{const lt=this.points[Re[Pt+Tt]];fi=lt.properties;const[te,pe]=lt.geometry.coordinates;hi=Mr(te),kn=pr(pe)}const hr={type:1,geometry:[[Math.round(this.options.extent*(hi*Nt-Qe)),Math.round(this.options.extent*(kn*Nt-mt))]],tags:fi};let Tr;Tr=Di||this.options.generateId?Re[Pt+Tt]:this.points[Re[Pt+Tt]].id,Tr!==void 0&&(hr.id=Tr),je.features.push(hr)}}_limitZoom(Ce){return Math.max(this.options.minZoom,Math.min(Math.floor(+Ce),this.options.maxZoom+1))}_cluster(Ce,Re){const{radius:Qe,extent:mt,reduce:Nt,minPoints:je}=this.options,ei=Qe/(mt*Math.pow(2,Re)),Pt=Ce.data,Di=[],fi=this.stride;for(let hi=0;hi<Pt.length;hi+=fi){if(Pt[hi+2]<=Re)continue;Pt[hi+2]=Re;const kn=Pt[hi],hr=Pt[hi+1],Tr=Ce.within(Pt[hi],Pt[hi+1],ei),lt=Pt[hi+jt];let te=lt;for(const pe of Tr){const ze=pe*fi;Pt[ze+2]>Re&&(te+=Pt[ze+jt])}if(te>lt&&te>=je){let pe,ze=kn*lt,et=hr*lt,Xe=-1;const rt=((hi/fi|0)<<5)+(Re+1)+this.points.length;for(const wt of Tr){const ot=wt*fi;if(Pt[ot+2]<=Re)continue;Pt[ot+2]=Re;const At=Pt[ot+jt];ze+=Pt[ot]*At,et+=Pt[ot+1]*At,Pt[ot+4]=rt,Nt&&(pe||(pe=this._map(Pt,hi,!0),Xe=this.clusterProps.length,this.clusterProps.push(pe)),Nt(pe,this._map(Pt,ot)))}Pt[hi+4]=rt,Di.push(ze/te,et/te,1/0,rt,-1,te),Nt&&Di.push(Xe)}else{for(let pe=0;pe<fi;pe++)Di.push(Pt[hi+pe]);if(te>1)for(const pe of Tr){const ze=pe*fi;if(!(Pt[ze+2]<=Re)){Pt[ze+2]=Re;for(let et=0;et<fi;et++)Di.push(Pt[ze+et])}}}}return Di}_getOriginId(Ce){return Ce-this.points.length>>5}_getOriginZoom(Ce){return(Ce-this.points.length)%32}_map(Ce,Re,Qe){if(Ce[Re+jt]>1){const je=this.clusterProps[Ce[Re+ai]];return Qe?Object.assign({},je):je}const mt=this.points[Ce[Re+Tt]].properties,Nt=this.options.map(mt);return Qe&&Nt===mt?Object.assign({},Nt):Nt}}function Jn(dt,Ce,Re){return{type:"Feature",id:dt[Ce+Tt],properties:_r(dt,Ce,Re),geometry:{type:"Point",coordinates:[(Qe=dt[Ce],360*(Qe-.5)),Cn(dt[Ce+1])]}};var Qe}function _r(dt,Ce,Re){const Qe=dt[Ce+jt],mt=Qe>=1e4?`${Math.round(Qe/1e3)}k`:Qe>=1e3?Math.round(Qe/100)/10+"k":Qe,Nt=dt[Ce+ai],je=Nt===-1?{}:Object.assign({},Re[Nt]);return Object.assign(je,{cluster:!0,cluster_id:dt[Ce+Tt],point_count:Qe,point_count_abbreviated:mt})}function Mr(dt){return dt/360+.5}function pr(dt){const Ce=Math.sin(dt*Math.PI/180),Re=.5-.25*Math.log((1+Ce)/(1-Ce))/Math.PI;return Re<0?0:Re>1?1:Re}function Cn(dt){const Ce=(180-360*dt)*Math.PI/180;return 360*Math.atan(Math.exp(Ce))/Math.PI-90}function Cr(dt,Ce,Re,Qe){let mt=Qe;const Nt=Ce+(Re-Ce>>1);let je,ei=Re-Ce;const Pt=dt[Ce],Di=dt[Ce+1],fi=dt[Re],hi=dt[Re+1];for(let kn=Ce+3;kn<Re;kn+=3){const hr=Ir(dt[kn],dt[kn+1],Pt,Di,fi,hi);if(hr>mt)je=kn,mt=hr;else if(hr===mt){const Tr=Math.abs(kn-Nt);Tr<ei&&(je=kn,ei=Tr)}}mt>Qe&&(je-Ce>3&&Cr(dt,Ce,je,Qe),dt[je+2]=mt,Re-je>3&&Cr(dt,je,Re,Qe))}function Ir(dt,Ce,Re,Qe,mt,Nt){let je=mt-Re,ei=Nt-Qe;if(je!==0||ei!==0){const Pt=((dt-Re)*je+(Ce-Qe)*ei)/(je*je+ei*ei);Pt>1?(Re=mt,Qe=Nt):Pt>0&&(Re+=je*Pt,Qe+=ei*Pt)}return je=dt-Re,ei=Ce-Qe,je*je+ei*ei}function Fa(dt,Ce,Re,Qe){const mt={id:dt??null,type:Ce,geometry:Re,tags:Qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Ce==="Point"||Ce==="MultiPoint"||Ce==="LineString")ra(mt,Re);else if(Ce==="Polygon")ra(mt,Re[0]);else if(Ce==="MultiLineString")for(const Nt of Re)ra(mt,Nt);else if(Ce==="MultiPolygon")for(const Nt of Re)ra(mt,Nt[0]);return mt}function ra(dt,Ce){for(let Re=0;Re<Ce.length;Re+=3)dt.minX=Math.min(dt.minX,Ce[Re]),dt.minY=Math.min(dt.minY,Ce[Re+1]),dt.maxX=Math.max(dt.maxX,Ce[Re]),dt.maxY=Math.max(dt.maxY,Ce[Re+1])}function Aa(dt,Ce,Re,Qe){if(!Ce.geometry)return;const mt=Ce.geometry.coordinates;if(mt&&mt.length===0)return;const Nt=Ce.geometry.type,je=Math.pow(Re.tolerance/((1<<Re.maxZoom)*Re.extent),2);let ei=[],Pt=Ce.id;if(Re.promoteId?Pt=Ce.properties[Re.promoteId]:Re.generateId&&(Pt=Qe||0),Nt==="Point")Da(mt,ei);else if(Nt==="MultiPoint")for(const Di of mt)Da(Di,ei);else if(Nt==="LineString")Yt(mt,ei,je,!1);else if(Nt==="MultiLineString"){if(Re.lineMetrics){for(const Di of mt)ei=[],Yt(Di,ei,je,!1),dt.push(Fa(Pt,"LineString",ei,Ce.properties));return}Ha(mt,ei,je,!1)}else if(Nt==="Polygon")Ha(mt,ei,je,!0);else{if(Nt!=="MultiPolygon"){if(Nt==="GeometryCollection"){for(const Di of Ce.geometry.geometries)Aa(dt,{id:Pt,geometry:Di,properties:Ce.properties},Re,Qe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Di of mt){const fi=[];Ha(Di,fi,je,!0),ei.push(fi)}}dt.push(Fa(Pt,Nt,ei,Ce.properties))}function Da(dt,Ce){Ce.push(zr(dt[0]),Dr(dt[1]),0)}function Yt(dt,Ce,Re,Qe){let mt,Nt,je=0;for(let Pt=0;Pt<dt.length;Pt++){const Di=zr(dt[Pt][0]),fi=Dr(dt[Pt][1]);Ce.push(Di,fi,0),Pt>0&&(je+=Qe?(mt*fi-Di*Nt)/2:Math.sqrt(Math.pow(Di-mt,2)+Math.pow(fi-Nt,2))),mt=Di,Nt=fi}const ei=Ce.length-3;Ce[2]=1,Cr(Ce,0,ei,Re),Ce[ei+2]=1,Ce.size=Math.abs(je),Ce.start=0,Ce.end=Ce.size}function Ha(dt,Ce,Re,Qe){for(let mt=0;mt<dt.length;mt++){const Nt=[];Yt(dt[mt],Nt,Re,Qe),Ce.push(Nt)}}function zr(dt){return dt/360+.5}function Dr(dt){const Ce=Math.sin(dt*Math.PI/180),Re=.5-.25*Math.log((1+Ce)/(1-Ce))/Math.PI;return Re<0?0:Re>1?1:Re}function ma(dt,Ce,Re,Qe,mt,Nt,je,ei){if(Qe/=Ce,Nt>=(Re/=Ce)&&je<Qe)return dt;if(je<Re||Nt>=Qe)return null;const Pt=[];for(const Di of dt){const fi=Di.geometry;let hi=Di.type;const kn=mt===0?Di.minX:Di.minY,hr=mt===0?Di.maxX:Di.maxY;if(kn>=Re&&hr<Qe){Pt.push(Di);continue}if(hr<Re||kn>=Qe)continue;let Tr=[];if(hi==="Point"||hi==="MultiPoint")rl(fi,Tr,Re,Qe,mt);else if(hi==="LineString")ho(fi,Tr,Re,Qe,mt,!1,ei.lineMetrics);else if(hi==="MultiLineString")la(fi,Tr,Re,Qe,mt,!1);else if(hi==="Polygon")la(fi,Tr,Re,Qe,mt,!0);else if(hi==="MultiPolygon")for(const lt of fi){const te=[];la(lt,te,Re,Qe,mt,!0),te.length&&Tr.push(te)}if(Tr.length){if(ei.lineMetrics&&hi==="LineString"){for(const lt of Tr)Pt.push(Fa(Di.id,hi,lt,Di.tags));continue}hi!=="LineString"&&hi!=="MultiLineString"||(Tr.length===1?(hi="LineString",Tr=Tr[0]):hi="MultiLineString"),hi!=="Point"&&hi!=="MultiPoint"||(hi=Tr.length===3?"Point":"MultiPoint"),Pt.push(Fa(Di.id,hi,Tr,Di.tags))}}return Pt.length?Pt:null}function rl(dt,Ce,Re,Qe,mt){for(let Nt=0;Nt<dt.length;Nt+=3){const je=dt[Nt+mt];je>=Re&&je<=Qe&&Vs(Ce,dt[Nt],dt[Nt+1],dt[Nt+2])}}function ho(dt,Ce,Re,Qe,mt,Nt,je){let ei=Vo(dt);const Pt=mt===0?qs:Us;let Di,fi,hi=dt.start;for(let te=0;te<dt.length-3;te+=3){const pe=dt[te],ze=dt[te+1],et=dt[te+2],Xe=dt[te+3],rt=dt[te+4],wt=mt===0?pe:ze,ot=mt===0?Xe:rt;let At=!1;je&&(Di=Math.sqrt(Math.pow(pe-Xe,2)+Math.pow(ze-rt,2))),wt<Re?ot>Re&&(fi=Pt(ei,pe,ze,Xe,rt,Re),je&&(ei.start=hi+Di*fi)):wt>Qe?ot<Qe&&(fi=Pt(ei,pe,ze,Xe,rt,Qe),je&&(ei.start=hi+Di*fi)):Vs(ei,pe,ze,et),ot<Re&&wt>=Re&&(fi=Pt(ei,pe,ze,Xe,rt,Re),At=!0),ot>Qe&&wt<=Qe&&(fi=Pt(ei,pe,ze,Xe,rt,Qe),At=!0),!Nt&&At&&(je&&(ei.end=hi+Di*fi),Ce.push(ei),ei=Vo(dt)),je&&(hi+=Di)}let kn=dt.length-3;const hr=dt[kn],Tr=dt[kn+1],lt=mt===0?hr:Tr;lt>=Re&&lt<=Qe&&Vs(ei,hr,Tr,dt[kn+2]),kn=ei.length-3,Nt&&kn>=3&&(ei[kn]!==ei[0]||ei[kn+1]!==ei[1])&&Vs(ei,ei[0],ei[1],ei[2]),ei.length&&Ce.push(ei)}function Vo(dt){const Ce=[];return Ce.size=dt.size,Ce.start=dt.start,Ce.end=dt.end,Ce}function la(dt,Ce,Re,Qe,mt,Nt){for(const je of dt)ho(je,Ce,Re,Qe,mt,Nt,!1)}function Vs(dt,Ce,Re,Qe){dt.push(Ce,Re,Qe)}function qs(dt,Ce,Re,Qe,mt,Nt){const je=(Nt-Ce)/(Qe-Ce);return Vs(dt,Nt,Re+(mt-Re)*je,1),je}function Us(dt,Ce,Re,Qe,mt,Nt){const je=(Nt-Re)/(mt-Re);return Vs(dt,Ce+(Qe-Ce)*je,Nt,1),je}function cn(dt,Ce){const Re=[];for(let Qe=0;Qe<dt.length;Qe++){const mt=dt[Qe],Nt=mt.type;let je;if(Nt==="Point"||Nt==="MultiPoint"||Nt==="LineString")je=Ws(mt.geometry,Ce);else if(Nt==="MultiLineString"||Nt==="Polygon"){je=[];for(const ei of mt.geometry)je.push(Ws(ei,Ce))}else if(Nt==="MultiPolygon"){je=[];for(const ei of mt.geometry){const Pt=[];for(const Di of ei)Pt.push(Ws(Di,Ce));je.push(Pt)}}Re.push(Fa(mt.id,Nt,je,mt.tags))}return Re}function Ws(dt,Ce){const Re=[];Re.size=dt.size,dt.start!==void 0&&(Re.start=dt.start,Re.end=dt.end);for(let Qe=0;Qe<dt.length;Qe+=3)Re.push(dt[Qe]+Ce,dt[Qe+1],dt[Qe+2]);return Re}function To(dt,Ce){if(dt.transformed)return dt;const Re=1<<dt.z,Qe=dt.x,mt=dt.y;for(const Nt of dt.features){const je=Nt.geometry,ei=Nt.type;if(Nt.geometry=[],ei===1)for(let Pt=0;Pt<je.length;Pt+=2)Nt.geometry.push(Do(je[Pt],je[Pt+1],Ce,Re,Qe,mt));else for(let Pt=0;Pt<je.length;Pt++){const Di=[];for(let fi=0;fi<je[Pt].length;fi+=2)Di.push(Do(je[Pt][fi],je[Pt][fi+1],Ce,Re,Qe,mt));Nt.geometry.push(Di)}}return dt.transformed=!0,dt}function Do(dt,Ce,Re,Qe,mt,Nt){return[Math.round(Re*(dt*Qe-mt)),Math.round(Re*(Ce*Qe-Nt))]}function So(dt,Ce,Re,Qe,mt){const Nt=Ce===mt.maxZoom?0:mt.tolerance/((1<<Ce)*mt.extent),je={features:[],numPoints:0,numSimplified:0,numFeatures:dt.length,source:null,x:Re,y:Qe,z:Ce,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ei of dt)Sn(je,ei,Nt,mt);return je}function Sn(dt,Ce,Re,Qe){const mt=Ce.geometry,Nt=Ce.type,je=[];if(dt.minX=Math.min(dt.minX,Ce.minX),dt.minY=Math.min(dt.minY,Ce.minY),dt.maxX=Math.max(dt.maxX,Ce.maxX),dt.maxY=Math.max(dt.maxY,Ce.maxY),Nt==="Point"||Nt==="MultiPoint")for(let ei=0;ei<mt.length;ei+=3)je.push(mt[ei],mt[ei+1]),dt.numPoints++,dt.numSimplified++;else if(Nt==="LineString")tr(je,mt,dt,Re,!1,!1);else if(Nt==="MultiLineString"||Nt==="Polygon")for(let ei=0;ei<mt.length;ei++)tr(je,mt[ei],dt,Re,Nt==="Polygon",ei===0);else if(Nt==="MultiPolygon")for(let ei=0;ei<mt.length;ei++){const Pt=mt[ei];for(let Di=0;Di<Pt.length;Di++)tr(je,Pt[Di],dt,Re,!0,Di===0)}if(je.length){let ei=Ce.tags||null;if(Nt==="LineString"&&Qe.lineMetrics){ei={};for(const Di in Ce.tags)ei[Di]=Ce.tags[Di];ei.mapbox_clip_start=mt.start/mt.size,ei.mapbox_clip_end=mt.end/mt.size}const Pt={geometry:je,type:Nt==="Polygon"||Nt==="MultiPolygon"?3:Nt==="LineString"||Nt==="MultiLineString"?2:1,tags:ei};Ce.id!==null&&(Pt.id=Ce.id),dt.features.push(Pt)}}function tr(dt,Ce,Re,Qe,mt,Nt){const je=Qe*Qe;if(Qe>0&&Ce.size<(mt?je:Qe))return void(Re.numPoints+=Ce.length/3);const ei=[];for(let Pt=0;Pt<Ce.length;Pt+=3)(Qe===0||Ce[Pt+2]>je)&&(Re.numSimplified++,ei.push(Ce[Pt],Ce[Pt+1])),Re.numPoints++;mt&&(function(Pt,Di){let fi=0;for(let hi=0,kn=Pt.length,hr=kn-2;hi<kn;hr=hi,hi+=2)fi+=(Pt[hi]-Pt[hr])*(Pt[hi+1]+Pt[hr+1]);if(fi>0===Di)for(let hi=0,kn=Pt.length;hi<kn/2;hi+=2){const hr=Pt[hi],Tr=Pt[hi+1];Pt[hi]=Pt[kn-2-hi],Pt[hi+1]=Pt[kn-1-hi],Pt[kn-2-hi]=hr,Pt[kn-1-hi]=Tr}})(ei,Nt),dt.push(ei)}const ar={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Hs{constructor(Ce,Re){const Qe=(Re=this.options=(function(Nt,je){for(const ei in je)Nt[ei]=je[ei];return Nt})(Object.create(ar),Re)).debug;if(Qe&&console.time("preprocess data"),Re.maxZoom<0||Re.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Re.promoteId&&Re.generateId)throw new Error("promoteId and generateId cannot be used together.");let mt=(function(Nt,je){const ei=[];if(Nt.type==="FeatureCollection")for(let Pt=0;Pt<Nt.features.length;Pt++)Aa(ei,Nt.features[Pt],je,Pt);else Aa(ei,Nt.type==="Feature"?Nt:{geometry:Nt},je);return ei})(Ce,Re);this.tiles={},this.tileCoords=[],Qe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Re.indexMaxZoom,Re.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),mt=(function(Nt,je){const ei=je.buffer/je.extent;let Pt=Nt;const Di=ma(Nt,1,-1-ei,ei,0,-1,2,je),fi=ma(Nt,1,1-ei,2+ei,0,-1,2,je);return(Di||fi)&&(Pt=ma(Nt,1,-ei,1+ei,0,-1,2,je)||[],Di&&(Pt=cn(Di,1).concat(Pt)),fi&&(Pt=Pt.concat(cn(fi,-1)))),Pt})(mt,Re),mt.length&&this.splitTile(mt,0,0,0),Qe&&(mt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Ce,Re,Qe,mt,Nt,je,ei){const Pt=[Ce,Re,Qe,mt],Di=this.options,fi=Di.debug;for(;Pt.length;){mt=Pt.pop(),Qe=Pt.pop(),Re=Pt.pop(),Ce=Pt.pop();const hi=1<<Re,kn=pl(Re,Qe,mt);let hr=this.tiles[kn];if(!hr&&(fi>1&&console.time("creation"),hr=this.tiles[kn]=So(Ce,Re,Qe,mt,Di),this.tileCoords.push({z:Re,x:Qe,y:mt}),fi)){fi>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Re,Qe,mt,hr.numFeatures,hr.numPoints,hr.numSimplified),console.timeEnd("creation"));const At=`z${Re}`;this.stats[At]=(this.stats[At]||0)+1,this.total++}if(hr.source=Ce,Nt==null){if(Re===Di.indexMaxZoom||hr.numPoints<=Di.indexMaxPoints)continue}else{if(Re===Di.maxZoom||Re===Nt)continue;if(Nt!=null){const At=Nt-Re;if(Qe!==je>>At||mt!==ei>>At)continue}}if(hr.source=null,Ce.length===0)continue;fi>1&&console.time("clipping");const Tr=.5*Di.buffer/Di.extent,lt=.5-Tr,te=.5+Tr,pe=1+Tr;let ze=null,et=null,Xe=null,rt=null,wt=ma(Ce,hi,Qe-Tr,Qe+te,0,hr.minX,hr.maxX,Di),ot=ma(Ce,hi,Qe+lt,Qe+pe,0,hr.minX,hr.maxX,Di);Ce=null,wt&&(ze=ma(wt,hi,mt-Tr,mt+te,1,hr.minY,hr.maxY,Di),et=ma(wt,hi,mt+lt,mt+pe,1,hr.minY,hr.maxY,Di),wt=null),ot&&(Xe=ma(ot,hi,mt-Tr,mt+te,1,hr.minY,hr.maxY,Di),rt=ma(ot,hi,mt+lt,mt+pe,1,hr.minY,hr.maxY,Di),ot=null),fi>1&&console.timeEnd("clipping"),Pt.push(ze||[],Re+1,2*Qe,2*mt),Pt.push(et||[],Re+1,2*Qe,2*mt+1),Pt.push(Xe||[],Re+1,2*Qe+1,2*mt),Pt.push(rt||[],Re+1,2*Qe+1,2*mt+1)}}getTile(Ce,Re,Qe){Ce=+Ce,Re=+Re,Qe=+Qe;const mt=this.options,{extent:Nt,debug:je}=mt;if(Ce<0||Ce>24)return null;const ei=1<<Ce,Pt=pl(Ce,Re=Re+ei&ei-1,Qe);if(this.tiles[Pt])return To(this.tiles[Pt],Nt);je>1&&console.log("drilling down to z%d-%d-%d",Ce,Re,Qe);let Di,fi=Ce,hi=Re,kn=Qe;for(;!Di&&fi>0;)fi--,hi>>=1,kn>>=1,Di=this.tiles[pl(fi,hi,kn)];return Di&&Di.source?(je>1&&(console.log("found parent tile z%d-%d-%d",fi,hi,kn),console.time("drilling down")),this.splitTile(Di.source,fi,hi,kn,Ce,Re,Qe),je>1&&console.timeEnd("drilling down"),this.tiles[Pt]?To(this.tiles[Pt],Nt):null):null}}function pl(dt,Ce,Re){return 32*((1<<dt)*Re+Ce)+dt}function Xr(dt,Ce){return Ce?dt.properties[Ce]:dt.id}function ml(dt,Ce){if(dt==null)return!0;if(dt.type==="Feature")return Xr(dt,Ce)!=null;if(dt.type==="FeatureCollection"){const Re=new Set;for(const Qe of dt.features){const mt=Xr(Qe,Ce);if(mt==null||Re.has(mt))return!1;Re.add(mt)}return!0}return!1}function Uo(dt,Ce){const Re=new Map;if(dt!=null)if(dt.type==="Feature")Re.set(Xr(dt,Ce),dt);else for(const Qe of dt.features)Re.set(Xr(Qe,Ce),Qe);return Re}class lc extends ut{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Ce,Re){return le._(this,void 0,void 0,(function*(){const Qe=Ce.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const mt=this._geoJSONIndex.getTile(Qe.z,Qe.x,Qe.y);if(!mt)return null;const Nt=new class{constructor(ei){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=le.X,this.length=ei.length,this._features=ei}feature(ei){return new class{constructor(Pt){this._feature=Pt,this.extent=le.X,this.type=Pt.type,this.properties=Pt.tags,"id"in Pt&&!isNaN(Pt.id)&&(this.id=parseInt(Pt.id,10))}loadGeometry(){if(this._feature.type===1){const Pt=[];for(const Di of this._feature.geometry)Pt.push([new le.P(Di[0],Di[1])]);return Pt}{const Pt=[];for(const Di of this._feature.geometry){const fi=[];for(const hi of Di)fi.push(new le.P(hi[0],hi[1]));Pt.push(fi)}return Pt}}toGeoJSON(Pt,Di,fi){return Wi.call(this,Pt,Di,fi)}}(this._features[ei])}}(mt.features);let je=Si(Nt);return je.byteOffset===0&&je.byteLength===je.buffer.byteLength||(je=new Uint8Array(je)),{vectorTile:Nt,rawData:je.buffer}}))}loadData(Ce){return le._(this,void 0,void 0,(function*(){var Re;(Re=this._pendingRequest)===null||Re===void 0||Re.abort();const Qe=!!(Ce&&Ce.request&&Ce.request.collectResourceTiming)&&new le.bv(Ce.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Ce,this._pendingRequest),this._geoJSONIndex=Ce.cluster?new ln((function({superclusterOptions:je,clusterProperties:ei}){if(!ei||!je)return je;const Pt={},Di={},fi={accumulated:null,zoom:0},hi={properties:null},kn=Object.keys(ei);for(const hr of kn){const[Tr,lt]=ei[hr],te=le.bC(lt),pe=le.bC(typeof Tr=="string"?[Tr,["accumulated"],["get",hr]]:Tr);Pt[hr]=te.value,Di[hr]=pe.value}return je.map=hr=>{hi.properties=hr;const Tr={};for(const lt of kn)Tr[lt]=Pt[lt].evaluate(fi,hi);return Tr},je.reduce=(hr,Tr)=>{hi.properties=Tr;for(const lt of kn)fi.accumulated=hr[lt],hr[lt]=Di[lt].evaluate(fi,hi)},je})(Ce)).load((yield this._pendingData).features):(mt=yield this._pendingData,new Hs(mt,Ce.geojsonVtOptions)),this.loaded={};const Nt={};if(Qe){const je=Qe.finish();je&&(Nt.resourceTiming={},Nt.resourceTiming[Ce.source]=JSON.parse(JSON.stringify(je)))}return Nt}catch(Nt){if(delete this._pendingRequest,le.bB(Nt))return{abandoned:!0};throw Nt}var mt}))}getData(){return le._(this,void 0,void 0,(function*(){return this._pendingData}))}reloadTile(Ce){const Re=this.loaded;return Re&&Re[Ce.uid]?super.reloadTile(Ce):this.loadTile(Ce)}loadAndProcessGeoJSON(Ce,Re){return le._(this,void 0,void 0,(function*(){let Qe=yield this.loadGeoJSON(Ce,Re);if(delete this._pendingRequest,typeof Qe!="object")throw new Error(`Input data given to '${Ce.source}' is not a valid GeoJSON object.`);if(Vi(Qe,!0),Ce.filter){const mt=le.bC(Ce.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(mt.result==="error")throw new Error(mt.value.map((je=>`${je.key}: ${je.message}`)).join(", "));Qe={type:"FeatureCollection",features:Qe.features.filter((je=>mt.value.evaluate({zoom:0},je)))}}return Qe}))}loadGeoJSON(Ce,Re){return le._(this,void 0,void 0,(function*(){const{promoteId:Qe}=Ce;if(Ce.request){const mt=yield le.h(Ce.request,Re);return this._dataUpdateable=ml(mt.data,Qe)?Uo(mt.data,Qe):void 0,mt.data}if(typeof Ce.data=="string")try{const mt=JSON.parse(Ce.data);return this._dataUpdateable=ml(mt,Qe)?Uo(mt,Qe):void 0,mt}catch{throw new Error(`Input data given to '${Ce.source}' is not a valid GeoJSON object.`)}if(!Ce.dataDiff)throw new Error(`Input data given to '${Ce.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Ce.source}`);return(function(mt,Nt,je){var ei,Pt,Di,fi;if(Nt.removeAll&&mt.clear(),Nt.remove)for(const hi of Nt.remove)mt.delete(hi);if(Nt.add)for(const hi of Nt.add){const kn=Xr(hi,je);kn!=null&&mt.set(kn,hi)}if(Nt.update)for(const hi of Nt.update){let kn=mt.get(hi.id);if(kn==null)continue;const hr=!hi.removeAllProperties&&(((ei=hi.removeProperties)===null||ei===void 0?void 0:ei.length)>0||((Pt=hi.addOrUpdateProperties)===null||Pt===void 0?void 0:Pt.length)>0);if((hi.newGeometry||hi.removeAllProperties||hr)&&(kn=Object.assign({},kn),mt.set(hi.id,kn),hr&&(kn.properties=Object.assign({},kn.properties))),hi.newGeometry&&(kn.geometry=hi.newGeometry),hi.removeAllProperties)kn.properties={};else if(((Di=hi.removeProperties)===null||Di===void 0?void 0:Di.length)>0)for(const Tr of hi.removeProperties)Object.prototype.hasOwnProperty.call(kn.properties,Tr)&&delete kn.properties[Tr];if(((fi=hi.addOrUpdateProperties)===null||fi===void 0?void 0:fi.length)>0)for(const{key:Tr,value:lt}of hi.addOrUpdateProperties)kn.properties[Tr]=lt}})(this._dataUpdateable,Ce.dataDiff,Qe),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}}))}removeSource(Ce){return le._(this,void 0,void 0,(function*(){this._pendingRequest&&this._pendingRequest.abort()}))}getClusterExpansionZoom(Ce){return this._geoJSONIndex.getClusterExpansionZoom(Ce.clusterId)}getClusterChildren(Ce){return this._geoJSONIndex.getChildren(Ce.clusterId)}getClusterLeaves(Ce){return this._geoJSONIndex.getLeaves(Ce.clusterId,Ce.limit,Ce.offset)}}class ul{constructor(Ce){this.self=Ce,this.actor=new le.F(Ce),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(Re,Qe)=>{if(this.externalWorkerSourceTypes[Re])throw new Error(`Worker source with name "${Re}" already registered.`);this.externalWorkerSourceTypes[Re]=Qe},this.self.addProtocol=le.bi,this.self.removeProtocol=le.bj,this.self.registerRTLTextPlugin=Re=>{if(le.bD.isParsed())throw new Error("RTL text plugin already registered.");le.bD.setMethods(Re)},this.actor.registerMessageHandler("LDT",((Re,Qe)=>this._getDEMWorkerSource(Re,Qe.source).loadTile(Qe))),this.actor.registerMessageHandler("RDT",((Re,Qe)=>le._(this,void 0,void 0,(function*(){this._getDEMWorkerSource(Re,Qe.source).removeTile(Qe)})))),this.actor.registerMessageHandler("GCEZ",((Re,Qe)=>le._(this,void 0,void 0,(function*(){return this._getWorkerSource(Re,Qe.type,Qe.source).getClusterExpansionZoom(Qe)})))),this.actor.registerMessageHandler("GCC",((Re,Qe)=>le._(this,void 0,void 0,(function*(){return this._getWorkerSource(Re,Qe.type,Qe.source).getClusterChildren(Qe)})))),this.actor.registerMessageHandler("GCL",((Re,Qe)=>le._(this,void 0,void 0,(function*(){return this._getWorkerSource(Re,Qe.type,Qe.source).getClusterLeaves(Qe)})))),this.actor.registerMessageHandler("LD",((Re,Qe)=>this._getWorkerSource(Re,Qe.type,Qe.source).loadData(Qe))),this.actor.registerMessageHandler("GD",((Re,Qe)=>this._getWorkerSource(Re,Qe.type,Qe.source).getData())),this.actor.registerMessageHandler("LT",((Re,Qe)=>this._getWorkerSource(Re,Qe.type,Qe.source).loadTile(Qe))),this.actor.registerMessageHandler("RT",((Re,Qe)=>this._getWorkerSource(Re,Qe.type,Qe.source).reloadTile(Qe))),this.actor.registerMessageHandler("AT",((Re,Qe)=>this._getWorkerSource(Re,Qe.type,Qe.source).abortTile(Qe))),this.actor.registerMessageHandler("RMT",((Re,Qe)=>this._getWorkerSource(Re,Qe.type,Qe.source).removeTile(Qe))),this.actor.registerMessageHandler("RS",((Re,Qe)=>le._(this,void 0,void 0,(function*(){if(!this.workerSources[Re]||!this.workerSources[Re][Qe.type]||!this.workerSources[Re][Qe.type][Qe.source])return;const mt=this.workerSources[Re][Qe.type][Qe.source];delete this.workerSources[Re][Qe.type][Qe.source],mt.removeSource!==void 0&&mt.removeSource(Qe)})))),this.actor.registerMessageHandler("RM",(Re=>le._(this,void 0,void 0,(function*(){delete this.layerIndexes[Re],delete this.availableImages[Re],delete this.workerSources[Re],delete this.demWorkerSources[Re]})))),this.actor.registerMessageHandler("SR",((Re,Qe)=>le._(this,void 0,void 0,(function*(){this.referrer=Qe})))),this.actor.registerMessageHandler("SRPS",((Re,Qe)=>this._syncRTLPluginState(Re,Qe))),this.actor.registerMessageHandler("IS",((Re,Qe)=>le._(this,void 0,void 0,(function*(){this.self.importScripts(Qe)})))),this.actor.registerMessageHandler("SI",((Re,Qe)=>this._setImages(Re,Qe))),this.actor.registerMessageHandler("UL",((Re,Qe)=>le._(this,void 0,void 0,(function*(){this._getLayerIndex(Re).update(Qe.layers,Qe.removedIds)})))),this.actor.registerMessageHandler("SL",((Re,Qe)=>le._(this,void 0,void 0,(function*(){this._getLayerIndex(Re).replace(Qe)}))))}_setImages(Ce,Re){return le._(this,void 0,void 0,(function*(){this.availableImages[Ce]=Re;for(const Qe in this.workerSources[Ce]){const mt=this.workerSources[Ce][Qe];for(const Nt in mt)mt[Nt].availableImages=Re}}))}_syncRTLPluginState(Ce,Re){return le._(this,void 0,void 0,(function*(){if(le.bD.isParsed())return le.bD.getState();if(Re.pluginStatus!=="loading")return le.bD.setState(Re),Re;const Qe=Re.pluginURL;if(this.self.importScripts(Qe),le.bD.isParsed()){const mt={pluginStatus:"loaded",pluginURL:Qe};return le.bD.setState(mt),mt}throw le.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${Qe}`)}))}_getAvailableImages(Ce){let Re=this.availableImages[Ce];return Re||(Re=[]),Re}_getLayerIndex(Ce){let Re=this.layerIndexes[Ce];return Re||(Re=this.layerIndexes[Ce]=new n),Re}_getWorkerSource(Ce,Re,Qe){if(this.workerSources[Ce]||(this.workerSources[Ce]={}),this.workerSources[Ce][Re]||(this.workerSources[Ce][Re]={}),!this.workerSources[Ce][Re][Qe]){const mt={sendAsync:(Nt,je)=>(Nt.targetMapId=Ce,this.actor.sendAsync(Nt,je))};switch(Re){case"vector":this.workerSources[Ce][Re][Qe]=new ut(mt,this._getLayerIndex(Ce),this._getAvailableImages(Ce));break;case"geojson":this.workerSources[Ce][Re][Qe]=new lc(mt,this._getLayerIndex(Ce),this._getAvailableImages(Ce));break;default:this.workerSources[Ce][Re][Qe]=new this.externalWorkerSourceTypes[Re](mt,this._getLayerIndex(Ce),this._getAvailableImages(Ce))}}return this.workerSources[Ce][Re][Qe]}_getDEMWorkerSource(Ce,Re){return this.demWorkerSources[Ce]||(this.demWorkerSources[Ce]={}),this.demWorkerSources[Ce][Re]||(this.demWorkerSources[Ce][Re]=new bt),this.demWorkerSources[Ce][Re]}}return le.i(self)&&(self.worker=new ul(self)),ul})),Me("index",["exports","./shared"],(function(le,n){var tt="4.7.1";let ke,Rt;const ut={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:L=>new Promise(((o,x)=>{const A=requestAnimationFrame(o);L.signal.addEventListener("abort",(()=>{cancelAnimationFrame(A),x(n.c())}))})),getImageData(L,o=0){return this.getImageCanvasContext(L).getImageData(-o,-o,L.width+2*o,L.height+2*o)},getImageCanvasContext(L){const o=window.document.createElement("canvas"),x=o.getContext("2d",{willReadFrequently:!0});if(!x)throw new Error("failed to create canvas 2d context");return o.width=L.width,o.height=L.height,x.drawImage(L,0,0,L.width,L.height),x},resolveURL:L=>(ke||(ke=document.createElement("a")),ke.href=L,ke.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Rt==null&&(Rt=matchMedia("(prefers-reduced-motion: reduce)")),Rt.matches)}};class bt{static testProp(o){if(!bt.docStyle)return o[0];for(let x=0;x<o.length;x++)if(o[x]in bt.docStyle)return o[x];return o[0]}static create(o,x,A){const I=window.document.createElement(o);return x!==void 0&&(I.className=x),A&&A.appendChild(I),I}static createNS(o,x){return window.document.createElementNS(o,x)}static disableDrag(){bt.docStyle&&bt.selectProp&&(bt.userSelect=bt.docStyle[bt.selectProp],bt.docStyle[bt.selectProp]="none")}static enableDrag(){bt.docStyle&&bt.selectProp&&(bt.docStyle[bt.selectProp]=bt.userSelect)}static setTransform(o,x){o.style[bt.transformProp]=x}static addEventListener(o,x,A,I={}){o.addEventListener(x,A,"passive"in I?I:I.capture)}static removeEventListener(o,x,A,I={}){o.removeEventListener(x,A,"passive"in I?I:I.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",bt.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",bt.suppressClickInternal,!0),window.setTimeout((()=>{window.removeEventListener("click",bt.suppressClickInternal,!0)}),0)}static getScale(o){const x=o.getBoundingClientRect();return{x:x.width/o.offsetWidth||1,y:x.height/o.offsetHeight||1,boundingClientRect:x}}static getPoint(o,x,A){const I=x.boundingClientRect;return new n.P((A.clientX-I.left)/x.x-o.clientLeft,(A.clientY-I.top)/x.y-o.clientTop)}static mousePos(o,x){const A=bt.getScale(o);return bt.getPoint(o,A,x)}static touchPos(o,x){const A=[],I=bt.getScale(o);for(let P=0;P<x.length;P++)A.push(bt.getPoint(o,I,x[P]));return A}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}bt.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,bt.selectProp=bt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),bt.transformProp=bt.testProp(["transform","WebkitTransform"]);const rn={supported:!1,testSupport:function(L){!Wi&&Vi&&(Tn?Ci(L):on=L)}};let on,Vi,Wi=!1,Tn=!1;function Ci(L){const o=L.createTexture();L.bindTexture(L.TEXTURE_2D,o);try{if(L.texImage2D(L.TEXTURE_2D,0,L.RGBA,L.RGBA,L.UNSIGNED_BYTE,Vi),L.isContextLost())return;rn.supported=!0}catch{}L.deleteTexture(o),Wi=!0}var Ji;typeof document<"u"&&(Vi=document.createElement("img"),Vi.onload=()=>{on&&Ci(on),on=null,Tn=!0},Vi.onerror=()=>{Wi=!0,on=null},Vi.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),(function(L){let o,x,A,I;L.resetRequestQueue=()=>{o=[],x=0,A=0,I={}},L.addThrottleControl=ne=>{const he=A++;return I[he]=ne,he},L.removeThrottleControl=ne=>{delete I[ne],H()},L.getImage=(ne,he,be=!0)=>new Promise(((we,Be)=>{rn.supported&&(ne.headers||(ne.headers={}),ne.headers.accept="image/webp,*/*"),n.e(ne,{type:"image"}),o.push({abortController:he,requestParameters:ne,supportImageRefresh:be,state:"queued",onError:Ye=>{Be(Ye)},onSuccess:Ye=>{we(Ye)}}),H()}));const P=ne=>n._(this,void 0,void 0,(function*(){ne.state="running";const{requestParameters:he,supportImageRefresh:be,onError:we,onSuccess:Be,abortController:Ye}=ne,st=be===!1&&!n.i(self)&&!n.g(he.url)&&(!he.headers||Object.keys(he.headers).reduce(((Ct,Lt)=>Ct&&Lt==="accept"),!0));x++;const vt=st?K(he,Ye):n.m(he,Ye);try{const Ct=yield vt;delete ne.abortController,ne.state="completed",Ct.data instanceof HTMLImageElement||n.b(Ct.data)?Be(Ct):Ct.data&&Be({data:yield(Et=Ct.data,typeof createImageBitmap=="function"?n.d(Et):n.f(Et)),cacheControl:Ct.cacheControl,expires:Ct.expires})}catch(Ct){delete ne.abortController,we(Ct)}finally{x--,H()}var Et})),H=()=>{const ne=(()=>{for(const he of Object.keys(I))if(I[he]())return!0;return!1})()?n.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:n.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let he=x;he<ne&&o.length>0;he++){const be=o.shift();be.abortController.signal.aborted?he--:P(be)}},K=(ne,he)=>new Promise(((be,we)=>{const Be=new Image,Ye=ne.url,st=ne.credentials;st&&st==="include"?Be.crossOrigin="use-credentials":(st&&st==="same-origin"||!n.s(Ye))&&(Be.crossOrigin="anonymous"),he.signal.addEventListener("abort",(()=>{Be.src="",we(n.c())})),Be.fetchPriority="high",Be.onload=()=>{Be.onerror=Be.onload=null,be({data:Be})},Be.onerror=()=>{Be.onerror=Be.onload=null,he.signal.aborted||we(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},Be.src=Ye}))})(Ji||(Ji={})),Ji.resetRequestQueue();class Vn{constructor(o){this._transformRequestFn=o}transformRequest(o,x){return this._transformRequestFn&&this._transformRequestFn(o,x)||{url:o}}setTransformRequest(o){this._transformRequestFn=o}}function Oi(L){var o=new n.A(3);return o[0]=L[0],o[1]=L[1],o[2]=L[2],o}var Hn,qi=function(L,o,x){return L[0]=o[0]-x[0],L[1]=o[1]-x[1],L[2]=o[2]-x[2],L};Hn=new n.A(3),n.A!=Float32Array&&(Hn[0]=0,Hn[1]=0,Hn[2]=0);var Ot=function(L){var o=L[0],x=L[1];return o*o+x*x};function Vt(L){const o=[];if(typeof L=="string")o.push({id:"default",url:L});else if(L&&L.length>0){const x=[];for(const{id:A,url:I}of L){const P=`${A}${I}`;x.indexOf(P)===-1&&(x.push(P),o.push({id:A,url:I}))}}return o}function Hi(L,o,x){const A=L.split("?");return A[0]+=`${o}${x}`,A.join("?")}(function(){var L=new n.A(2);n.A!=Float32Array&&(L[0]=0,L[1]=0)})();class dn{constructor(o,x,A,I){this.context=o,this.format=A,this.texture=o.gl.createTexture(),this.update(x,I)}update(o,x,A){const{width:I,height:P}=o,H=!(this.size&&this.size[0]===I&&this.size[1]===P||A),{context:K}=this,{gl:ne}=K;if(this.useMipmap=!!(x&&x.useMipmap),ne.bindTexture(ne.TEXTURE_2D,this.texture),K.pixelStoreUnpackFlipY.set(!1),K.pixelStoreUnpack.set(1),K.pixelStoreUnpackPremultiplyAlpha.set(this.format===ne.RGBA&&(!x||x.premultiply!==!1)),H)this.size=[I,P],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||n.b(o)?ne.texImage2D(ne.TEXTURE_2D,0,this.format,this.format,ne.UNSIGNED_BYTE,o):ne.texImage2D(ne.TEXTURE_2D,0,this.format,I,P,0,this.format,ne.UNSIGNED_BYTE,o.data);else{const{x:he,y:be}=A||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||n.b(o)?ne.texSubImage2D(ne.TEXTURE_2D,0,he,be,ne.RGBA,ne.UNSIGNED_BYTE,o):ne.texSubImage2D(ne.TEXTURE_2D,0,he,be,I,P,ne.RGBA,ne.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&ne.generateMipmap(ne.TEXTURE_2D)}bind(o,x,A){const{context:I}=this,{gl:P}=I;P.bindTexture(P.TEXTURE_2D,this.texture),A!==P.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(A=P.LINEAR),o!==this.filter&&(P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,o),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,A||o),this.filter=o),x!==this.wrap&&(P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,x),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,x),this.wrap=x)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Ui(L){const{userImage:o}=L;return!!(o&&o.render&&o.render())&&(L.data.replace(new Uint8Array(o.data.buffer)),!0)}class an extends n.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new n.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:x,promiseResolve:A}of this.requestors)A(this._getImagesForIds(x));this.requestors=[]}}getImage(o){const x=this.images[o];if(x&&!x.data&&x.spriteData){const A=x.spriteData;x.data=new n.R({width:A.width,height:A.height},A.context.getImageData(A.x,A.y,A.width,A.height).data),x.spriteData=null}return x}addImage(o,x){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,x)&&(this.images[o]=x)}_validate(o,x){let A=!0;const I=x.data||x.spriteData;return this._validateStretch(x.stretchX,I&&I.width)||(this.fire(new n.j(new Error(`Image "${o}" has invalid "stretchX" value`))),A=!1),this._validateStretch(x.stretchY,I&&I.height)||(this.fire(new n.j(new Error(`Image "${o}" has invalid "stretchY" value`))),A=!1),this._validateContent(x.content,x)||(this.fire(new n.j(new Error(`Image "${o}" has invalid "content" value`))),A=!1),A}_validateStretch(o,x){if(!o)return!0;let A=0;for(const I of o){if(I[0]<A||I[1]<I[0]||x<I[1])return!1;A=I[1]}return!0}_validateContent(o,x){if(!o)return!0;if(o.length!==4)return!1;const A=x.spriteData,I=A&&A.width||x.data.width,P=A&&A.height||x.data.height;return!(o[0]<0||I<o[0]||o[1]<0||P<o[1]||o[2]<0||I<o[2]||o[3]<0||P<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,x,A=!0){const I=this.getImage(o);if(A&&(I.data.width!==x.data.width||I.data.height!==x.data.height))throw new Error(`size mismatch between old image (${I.data.width}x${I.data.height}) and new image (${x.data.width}x${x.data.height}).`);x.version=I.version+1,this.images[o]=x,this.updatedImages[o]=!0}removeImage(o){const x=this.images[o];delete this.images[o],delete this.patterns[o],x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise(((x,A)=>{let I=!0;if(!this.isLoaded())for(const P of o)this.images[P]||(I=!1);this.isLoaded()||I?x(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:x})}))}_getImagesForIds(o){const x={};for(const A of o){let I=this.getImage(A);I||(this.fire(new n.k("styleimagemissing",{id:A})),I=this.getImage(A)),I?x[A]={data:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,textFitWidth:I.textFitWidth,textFitHeight:I.textFitHeight,hasRenderCallback:!!(I.userImage&&I.userImage.render)}:n.w(`Image "${A}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return x}getPixelSize(){const{width:o,height:x}=this.atlasImage;return{width:o,height:x}}getPattern(o){const x=this.patterns[o],A=this.getImage(o);if(!A)return null;if(x&&x.position.version===A.version)return x.position;if(x)x.position.version=A.version;else{const I={w:A.data.width+2,h:A.data.height+2,x:0,y:0},P=new n.I(I,A);this.patterns[o]={bin:I,position:P}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const x=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new dn(o,this.atlasImage,x.RGBA),this.atlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const P in this.patterns)o.push(this.patterns[P].bin);const{w:x,h:A}=n.p(o),I=this.atlasImage;I.resize({width:x||1,height:A||1});for(const P in this.patterns){const{bin:H}=this.patterns[P],K=H.x+1,ne=H.y+1,he=this.getImage(P).data,be=he.width,we=he.height;n.R.copy(he,I,{x:0,y:0},{x:K,y:ne},{width:be,height:we}),n.R.copy(he,I,{x:0,y:we-1},{x:K,y:ne-1},{width:be,height:1}),n.R.copy(he,I,{x:0,y:0},{x:K,y:ne+we},{width:be,height:1}),n.R.copy(he,I,{x:be-1,y:0},{x:K-1,y:ne},{width:1,height:we}),n.R.copy(he,I,{x:0,y:0},{x:K+be,y:ne},{width:1,height:we})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const x of o){if(this.callbackDispatchedThisFrame[x])continue;this.callbackDispatchedThisFrame[x]=!0;const A=this.getImage(x);A||n.w(`Image with ID: "${x}" was not found`),Ui(A)&&this.updateImage(x,A)}}}const Hr=1e20;function Qr(L,o,x,A,I,P,H,K,ne){for(let he=o;he<o+A;he++)ui(L,x*P+he,P,I,H,K,ne);for(let he=x;he<x+I;he++)ui(L,he*P+o,1,A,H,K,ne)}function ui(L,o,x,A,I,P,H){P[0]=0,H[0]=-Hr,H[1]=Hr,I[0]=L[o];for(let K=1,ne=0,he=0;K<A;K++){I[K]=L[o+K*x];const be=K*K;do{const we=P[ne];he=(I[K]-I[we]+be-we*we)/(K-we)/2}while(he<=H[ne]&&--ne>-1);ne++,P[ne]=K,H[ne]=he,H[ne+1]=Hr}for(let K=0,ne=0;K<A;K++){for(;H[ne+1]<K;)ne++;const he=P[ne],be=K-he;L[o+K*x]=I[he]+be*be}}class Si{constructor(o,x){this.requestManager=o,this.localIdeographFontFamily=x,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return n._(this,void 0,void 0,(function*(){const x=[];for(const P in o)for(const H of o[P])x.push(this._getAndCacheGlyphsPromise(P,H));const A=yield Promise.all(x),I={};for(const{stack:P,id:H,glyph:K}of A)I[P]||(I[P]={}),I[P][H]=K&&{id:K.id,bitmap:K.bitmap.clone(),metrics:K.metrics};return I}))}_getAndCacheGlyphsPromise(o,x){return n._(this,void 0,void 0,(function*(){let A=this.entries[o];A||(A=this.entries[o]={glyphs:{},requests:{},ranges:{}});let I=A.glyphs[x];if(I!==void 0)return{stack:o,id:x,glyph:I};if(I=this._tinySDF(A,o,x),I)return A.glyphs[x]=I,{stack:o,id:x,glyph:I};const P=Math.floor(x/256);if(256*P>65535)throw new Error("glyphs > 65535 not supported");if(A.ranges[P])return{stack:o,id:x,glyph:I};if(!this.url)throw new Error("glyphsUrl is not set");if(!A.requests[P]){const K=Si.loadGlyphRange(o,P,this.url,this.requestManager);A.requests[P]=K}const H=yield A.requests[P];for(const K in H)this._doesCharSupportLocalGlyph(+K)||(A.glyphs[+K]=H[+K]);return A.ranges[P]=!0,{stack:o,id:x,glyph:H[x]||null}}))}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(o))}_tinySDF(o,x,A){const I=this.localIdeographFontFamily;if(!I||!this._doesCharSupportLocalGlyph(A))return;let P=o.tinySDF;if(!P){let K="400";/bold/i.test(x)?K="900":/medium/i.test(x)?K="500":/light/i.test(x)&&(K="200"),P=o.tinySDF=new Si.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:I,fontWeight:K})}const H=P.draw(String.fromCharCode(A));return{id:A,bitmap:new n.o({width:H.width||60,height:H.height||60},H.data),metrics:{width:H.glyphWidth/2||24,height:H.glyphHeight/2||24,left:H.glyphLeft/2+.5||0,top:H.glyphTop/2-27.5||-8,advance:H.glyphAdvance/2||24,isDoubleResolution:!0}}}}Si.loadGlyphRange=function(L,o,x,A){return n._(this,void 0,void 0,(function*(){const I=256*o,P=I+255,H=A.transformRequest(x.replace("{fontstack}",L).replace("{range}",`${I}-${P}`),"Glyphs"),K=yield n.l(H,new AbortController);if(!K||!K.data)throw new Error(`Could not load glyph range. range: ${o}, ${I}-${P}`);const ne={};for(const he of n.n(K.data))ne[he.id]=he;return ne}))},Si.TinySDF=class{constructor({fontSize:L=24,buffer:o=3,radius:x=8,cutoff:A=.25,fontFamily:I="sans-serif",fontWeight:P="normal",fontStyle:H="normal"}={}){this.buffer=o,this.cutoff=A,this.radius=x;const K=this.size=L+4*o,ne=this._createCanvas(K),he=this.ctx=ne.getContext("2d",{willReadFrequently:!0});he.font=`${H} ${P} ${L}px ${I}`,he.textBaseline="alphabetic",he.textAlign="left",he.fillStyle="black",this.gridOuter=new Float64Array(K*K),this.gridInner=new Float64Array(K*K),this.f=new Float64Array(K),this.z=new Float64Array(K+1),this.v=new Uint16Array(K)}_createCanvas(L){const o=document.createElement("canvas");return o.width=o.height=L,o}draw(L){const{width:o,actualBoundingBoxAscent:x,actualBoundingBoxDescent:A,actualBoundingBoxLeft:I,actualBoundingBoxRight:P}=this.ctx.measureText(L),H=Math.ceil(x),K=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(P-I))),ne=Math.min(this.size-this.buffer,H+Math.ceil(A)),he=K+2*this.buffer,be=ne+2*this.buffer,we=Math.max(he*be,0),Be=new Uint8ClampedArray(we),Ye={data:Be,width:he,height:be,glyphWidth:K,glyphHeight:ne,glyphTop:H,glyphLeft:0,glyphAdvance:o};if(K===0||ne===0)return Ye;const{ctx:st,buffer:vt,gridInner:Et,gridOuter:Ct}=this;st.clearRect(vt,vt,K,ne),st.fillText(L,vt,vt+H);const Lt=st.getImageData(vt,vt,K,ne);Ct.fill(Hr,0,we),Et.fill(0,0,we);for(let _t=0;_t<ne;_t++)for(let Ht=0;Ht<K;Ht++){const Qt=Lt.data[4*(_t*K+Ht)+3]/255;if(Qt===0)continue;const oi=(_t+vt)*he+Ht+vt;if(Qt===1)Ct[oi]=0,Et[oi]=Hr;else{const $i=.5-Qt;Ct[oi]=$i>0?$i*$i:0,Et[oi]=$i<0?$i*$i:0}}Qr(Ct,0,0,he,be,he,this.f,this.v,this.z),Qr(Et,vt,vt,K,ne,he,this.f,this.v,this.z);for(let _t=0;_t<we;_t++){const Ht=Math.sqrt(Ct[_t])-Math.sqrt(Et[_t]);Be[_t]=Math.round(255-255*(Ht/this.radius+this.cutoff))}return Ye}};class yn{constructor(){this.specification=n.v.light.position}possiblyEvaluate(o,x){return n.x(o.expression.evaluate(x))}interpolate(o,x,A){return{x:n.y.number(o.x,x.x,A),y:n.y.number(o.y,x.y,A),z:n.y.number(o.z,x.z,A)}}}let Rn;class wr extends n.E{constructor(o){super(),Rn=Rn||new n.q({anchor:new n.D(n.v.light.anchor),position:new yn,color:new n.D(n.v.light.color),intensity:new n.D(n.v.light.intensity)}),this._transitionable=new n.T(Rn),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,x={}){if(!this._validate(n.r,o,x))for(const A in o){const I=o[A];A.endsWith("-transition")?this._transitionable.setTransition(A.slice(0,-11),I):this._transitionable.setValue(A,I)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,x,A){return(!A||A.validate!==!1)&&n.t(this,o.call(n.u,{value:x,style:{glyphs:!0,sprite:!0},styleSpec:n.v}))}}const Tt=new n.q({"sky-color":new n.D(n.v.sky["sky-color"]),"horizon-color":new n.D(n.v.sky["horizon-color"]),"fog-color":new n.D(n.v.sky["fog-color"]),"fog-ground-blend":new n.D(n.v.sky["fog-ground-blend"]),"horizon-fog-blend":new n.D(n.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new n.D(n.v.sky["sky-horizon-blend"]),"atmosphere-blend":new n.D(n.v.sky["atmosphere-blend"])});class jt extends n.E{constructor(o){super(),this._transitionable=new n.T(Tt),this.setSky(o),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new n.z(0))}setSky(o,x={}){if(!this._validate(n.B,o,x)){o||(o={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const A in o){const I=o[A];A.endsWith("-transition")?this._transitionable.setTransition(A.slice(0,-11),I):this._transitionable.setValue(A,I)}}}getSky(){return this._transitionable.serialize()}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,x,A={}){return A?.validate!==!1&&n.t(this,o.call(n.u,n.e({value:x,style:{glyphs:!0,sprite:!0},styleSpec:n.v})))}calculateFogBlendOpacity(o){return o<60?0:o<70?(o-60)/10:1}}class ai{constructor(o,x){this.width=o,this.height=x,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,x){const A=o.join(",")+String(x);return this.dashEntry[A]||(this.dashEntry[A]=this.addDash(o,x)),this.dashEntry[A]}getDashRanges(o,x,A){const I=[];let P=o.length%2==1?-o[o.length-1]*A:0,H=o[0]*A,K=!0;I.push({left:P,right:H,isDash:K,zeroLength:o[0]===0});let ne=o[0];for(let he=1;he<o.length;he++){K=!K;const be=o[he];P=ne*A,ne+=be,H=ne*A,I.push({left:P,right:H,isDash:K,zeroLength:be===0})}return I}addRoundDash(o,x,A){const I=x/2;for(let P=-A;P<=A;P++){const H=this.width*(this.nextRow+A+P);let K=0,ne=o[K];for(let he=0;he<this.width;he++){he/ne.right>1&&(ne=o[++K]);const be=Math.abs(he-ne.left),we=Math.abs(he-ne.right),Be=Math.min(be,we);let Ye;const st=P/A*(I+1);if(ne.isDash){const vt=I-Math.abs(st);Ye=Math.sqrt(Be*Be+vt*vt)}else Ye=I-Math.sqrt(Be*Be+st*st);this.data[H+he]=Math.max(0,Math.min(255,Ye+128))}}}addRegularDash(o){for(let K=o.length-1;K>=0;--K){const ne=o[K],he=o[K+1];ne.zeroLength?o.splice(K,1):he&&he.isDash===ne.isDash&&(he.left=ne.left,o.splice(K,1))}const x=o[0],A=o[o.length-1];x.isDash===A.isDash&&(x.left=A.left-this.width,A.right=x.right+this.width);const I=this.width*this.nextRow;let P=0,H=o[P];for(let K=0;K<this.width;K++){K/H.right>1&&(H=o[++P]);const ne=Math.abs(K-H.left),he=Math.abs(K-H.right),be=Math.min(ne,he);this.data[I+K]=Math.max(0,Math.min(255,(H.isDash?be:-be)+128))}}addDash(o,x){const A=x?7:0,I=2*A+1;if(this.nextRow+I>this.height)return n.w("LineAtlas out of space"),null;let P=0;for(let K=0;K<o.length;K++)P+=o[K];if(P!==0){const K=this.width/P,ne=this.getDashRanges(o,this.width,K);x?this.addRoundDash(ne,K,A):this.addRegularDash(ne)}const H={y:(this.nextRow+A+.5)/this.height,height:2*A/this.height,width:P};return this.nextRow+=I,this.dirty=!0,H}bind(o){const x=o.gl;this.texture?(x.bindTexture(x.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,x.texSubImage2D(x.TEXTURE_2D,0,0,0,this.width,this.height,x.ALPHA,x.UNSIGNED_BYTE,this.data))):(this.texture=x.createTexture(),x.bindTexture(x.TEXTURE_2D,this.texture),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,x.REPEAT),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,x.LINEAR),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,x.LINEAR),x.texImage2D(x.TEXTURE_2D,0,x.ALPHA,this.width,this.height,0,x.ALPHA,x.UNSIGNED_BYTE,this.data))}}const ln="maplibre_preloaded_worker_pool";class Jn{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Jn.workerCount;)this.workers.push(new Worker(n.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach((x=>{x.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[ln]}numActive(){return Object.keys(this.active).length}}const _r=Math.floor(ut.hardwareConcurrency/2);let Mr,pr;function Cn(){return Mr||(Mr=new Jn),Mr}Jn.workerCount=n.C(globalThis)?Math.max(Math.min(_r,3),1):1;class Cr{constructor(o,x){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=x;const A=this.workerPool.acquire(x);for(let I=0;I<A.length;I++){const P=new n.F(A[I],x);P.name=`Worker ${I}`,this.actors.push(P)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,x){const A=[];for(const I of this.actors)A.push(I.sendAsync({type:o,data:x}));return Promise.all(A)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach((x=>{x.remove()})),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,x){for(const A of this.actors)A.registerMessageHandler(o,x)}}function Ir(){return pr||(pr=new Cr(Cn(),n.G),pr.registerMessageHandler("GR",((L,o,x)=>n.m(o,x)))),pr}function Fa(L,o){const x=n.H();return n.J(x,x,[1,1,0]),n.K(x,x,[.5*L.width,.5*L.height,1]),n.L(x,x,L.calculatePosMatrix(o.toUnwrapped()))}function ra(L,o,x,A,I,P){const H=(function(we,Be,Ye){if(we)for(const st of we){const vt=Be[st];if(vt&&vt.source===Ye&&vt.type==="fill-extrusion")return!0}else for(const st in Be){const vt=Be[st];if(vt.source===Ye&&vt.type==="fill-extrusion")return!0}return!1})(I&&I.layers,o,L.id),K=P.maxPitchScaleFactor(),ne=L.tilesIn(A,K,H);ne.sort(Aa);const he=[];for(const we of ne)he.push({wrappedTileID:we.tileID.wrapped().key,queryResults:we.tile.queryRenderedFeatures(o,x,L._state,we.queryGeometry,we.cameraQueryGeometry,we.scale,I,P,K,Fa(L.transform,we.tileID))});const be=(function(we){const Be={},Ye={};for(const st of we){const vt=st.queryResults,Et=st.wrappedTileID,Ct=Ye[Et]=Ye[Et]||{};for(const Lt in vt){const _t=vt[Lt],Ht=Ct[Lt]=Ct[Lt]||{},Qt=Be[Lt]=Be[Lt]||[];for(const oi of _t)Ht[oi.featureIndex]||(Ht[oi.featureIndex]=!0,Qt.push(oi))}}return Be})(he);for(const we in be)be[we].forEach((Be=>{const Ye=Be.feature,st=L.getFeatureState(Ye.layer["source-layer"],Ye.id);Ye.source=Ye.layer.source,Ye.layer["source-layer"]&&(Ye.sourceLayer=Ye.layer["source-layer"]),Ye.state=st}));return be}function Aa(L,o){const x=L.tileID,A=o.tileID;return x.overscaledZ-A.overscaledZ||x.canonical.y-A.canonical.y||x.wrap-A.wrap||x.canonical.x-A.canonical.x}function Da(L,o,x){return n._(this,void 0,void 0,(function*(){let A=L;if(L.url?A=(yield n.h(o.transformRequest(L.url,"Source"),x)).data:yield ut.frameAsync(x),!A)return null;const I=n.M(n.e(A,L),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in A&&A.vector_layers&&(I.vectorLayerIds=A.vector_layers.map((P=>P.id))),I}))}class Yt{constructor(o,x){o&&(x?this.setSouthWest(o).setNorthEast(x):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof n.N?new n.N(o.lng,o.lat):n.N.convert(o),this}setSouthWest(o){return this._sw=o instanceof n.N?new n.N(o.lng,o.lat):n.N.convert(o),this}extend(o){const x=this._sw,A=this._ne;let I,P;if(o instanceof n.N)I=o,P=o;else{if(!(o instanceof Yt))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Yt.convert(o)):this.extend(n.N.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(n.N.convert(o)):this;if(I=o._sw,P=o._ne,!I||!P)return this}return x||A?(x.lng=Math.min(I.lng,x.lng),x.lat=Math.min(I.lat,x.lat),A.lng=Math.max(P.lng,A.lng),A.lat=Math.max(P.lat,A.lat)):(this._sw=new n.N(I.lng,I.lat),this._ne=new n.N(P.lng,P.lat)),this}getCenter(){return new n.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new n.N(this.getWest(),this.getNorth())}getSouthEast(){return new n.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:x,lat:A}=n.N.convert(o);let I=this._sw.lng<=x&&x<=this._ne.lng;return this._sw.lng>this._ne.lng&&(I=this._sw.lng>=x&&x>=this._ne.lng),this._sw.lat<=A&&A<=this._ne.lat&&I}static convert(o){return o instanceof Yt?o:o&&new Yt(o)}static fromLngLat(o,x=0){const A=360*x/40075017,I=A/Math.cos(Math.PI/180*o.lat);return new Yt(new n.N(o.lng-I,o.lat-A),new n.N(o.lng+I,o.lat+A))}adjustAntiMeridian(){const o=new n.N(this._sw.lng,this._sw.lat),x=new n.N(this._ne.lng,this._ne.lat);return new Yt(o,o.lng>x.lng?new n.N(x.lng+360,x.lat):x)}}class Ha{constructor(o,x,A){this.bounds=Yt.convert(this.validateBounds(o)),this.minzoom=x||0,this.maxzoom=A||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const x=Math.pow(2,o.z),A=Math.floor(n.O(this.bounds.getWest())*x),I=Math.floor(n.Q(this.bounds.getNorth())*x),P=Math.ceil(n.O(this.bounds.getEast())*x),H=Math.ceil(n.Q(this.bounds.getSouth())*x);return o.x>=A&&o.x<P&&o.y>=I&&o.y<H}}class zr extends n.E{constructor(o,x,A,I){if(super(),this.id=o,this.dispatcher=A,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.e(this,n.M(x,["url","scheme","tileSize","promoteId"])),this._options=n.e({type:"vector"},x),this._collectResourceTiming=x.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(I)}load(){return n._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new n.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Da(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(n.e(this,o),o.bounds&&(this.tileBounds=new Ha(o.bounds,this.minzoom,this.maxzoom)),this.fire(new n.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new n.j(o))}}))}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty((()=>{this._options.tiles=o})),this}setUrl(o){return this.setSourceProperty((()=>{this.url=o,this._options.url=o})),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return n.e({},this._options)}loadTile(o){return n._(this,void 0,void 0,(function*(){const x=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),A={request:this.map._requestManager.transformRequest(x,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};A.request.collectResourceTiming=this._collectResourceTiming;let I="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise(((P,H)=>{o.reloadPromise={resolve:P,reject:H}}))}else o.actor=this.dispatcher.getActor(),I="LT";o.abortController=new AbortController;try{const P=yield o.actor.sendAsync({type:I,data:A},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,P)}catch(P){if(delete o.abortController,o.aborted)return;if(P&&P.status!==404)throw P;this._afterTileLoadWorkerResponse(o,null)}}))}_afterTileLoadWorkerResponse(o,x){if(x&&x.resourceTiming&&(o.resourceTiming=x.resourceTiming),x&&this.map._refreshExpiredTiles&&o.setExpiryData(x),o.loadVectorData(x,this.map.painter),o.reloadPromise){const A=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(A.resolve).catch(A.reject)}}abortTile(o){return n._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))}))}unloadTile(o){return n._(this,void 0,void 0,(function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))}))}hasTransition(){return!1}}class Dr extends n.E{constructor(o,x,A,I){super(),this.id=o,this.dispatcher=A,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.e({type:"raster"},x),n.e(this,n.M(x,["url","scheme","tileSize"]))}load(){return n._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new n.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Da(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(n.e(this,o),o.bounds&&(this.tileBounds=new Ha(o.bounds,this.minzoom,this.maxzoom)),this.fire(new n.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new n.j(o))}}))}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty((()=>{this._options.tiles=o})),this}setUrl(o){return this.setSourceProperty((()=>{this.url=o,this._options.url=o})),this}serialize(){return n.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return n._(this,void 0,void 0,(function*(){const x=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const A=yield Ji.getImage(this.map._requestManager.transformRequest(x,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(A&&A.data){this.map._refreshExpiredTiles&&A.cacheControl&&A.expires&&o.setExpiryData({cacheControl:A.cacheControl,expires:A.expires});const I=this.map.painter.context,P=I.gl,H=A.data;o.texture=this.map.painter.getTileTexture(H.width),o.texture?o.texture.update(H,{useMipmap:!0}):(o.texture=new dn(I,H,P.RGBA,{useMipmap:!0}),o.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE,P.LINEAR_MIPMAP_NEAREST)),o.state="loaded"}}catch(A){if(delete o.abortController,o.aborted)o.state="unloaded";else if(A)throw o.state="errored",A}}))}abortTile(o){return n._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)}))}unloadTile(o){return n._(this,void 0,void 0,(function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)}))}hasTransition(){return!1}}class ma extends Dr{constructor(o,x,A,I){super(o,x,A,I),this.type="raster-dem",this.maxzoom=22,this._options=n.e({type:"raster-dem"},x),this.encoding=x.encoding||"mapbox",this.redFactor=x.redFactor,this.greenFactor=x.greenFactor,this.blueFactor=x.blueFactor,this.baseShift=x.baseShift}loadTile(o){return n._(this,void 0,void 0,(function*(){const x=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),A=this.map._requestManager.transformRequest(x,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const I=yield Ji.getImage(A,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(I&&I.data){const P=I.data;this.map._refreshExpiredTiles&&I.cacheControl&&I.expires&&o.setExpiryData({cacheControl:I.cacheControl,expires:I.expires});const H=n.b(P)&&n.U()?P:yield this.readImageNow(P),K={type:this.type,uid:o.uid,source:this.id,rawImageData:H,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const ne=yield o.actor.sendAsync({type:"LDT",data:K});o.dem=ne,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(I){if(delete o.abortController,o.aborted)o.state="unloaded";else if(I)throw o.state="errored",I}}))}readImageNow(o){return n._(this,void 0,void 0,(function*(){if(typeof VideoFrame<"u"&&n.V()){const x=o.width+2,A=o.height+2;try{return new n.R({width:x,height:A},yield n.W(o,-1,-1,x,A))}catch{}}return ut.getImageData(o,1)}))}_getNeighboringTiles(o){const x=o.canonical,A=Math.pow(2,x.z),I=(x.x-1+A)%A,P=x.x===0?o.wrap-1:o.wrap,H=(x.x+1+A)%A,K=x.x+1===A?o.wrap+1:o.wrap,ne={};return ne[new n.S(o.overscaledZ,P,x.z,I,x.y).key]={backfilled:!1},ne[new n.S(o.overscaledZ,K,x.z,H,x.y).key]={backfilled:!1},x.y>0&&(ne[new n.S(o.overscaledZ,P,x.z,I,x.y-1).key]={backfilled:!1},ne[new n.S(o.overscaledZ,o.wrap,x.z,x.x,x.y-1).key]={backfilled:!1},ne[new n.S(o.overscaledZ,K,x.z,H,x.y-1).key]={backfilled:!1}),x.y+1<A&&(ne[new n.S(o.overscaledZ,P,x.z,I,x.y+1).key]={backfilled:!1},ne[new n.S(o.overscaledZ,o.wrap,x.z,x.x,x.y+1).key]={backfilled:!1},ne[new n.S(o.overscaledZ,K,x.z,H,x.y+1).key]={backfilled:!1}),ne}unloadTile(o){return n._(this,void 0,void 0,(function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))}))}}class rl extends n.E{constructor(o,x,A,I){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=A.getActor(),this.setEventedParent(I),this._data=x.data,this._options=n.e({},x),this._collectResourceTiming=x.collectResourceTiming,x.maxzoom!==void 0&&(this.maxzoom=x.maxzoom),x.type&&(this.type=x.type),x.attribution&&(this.attribution=x.attribution),this.promoteId=x.promoteId;const P=n.X/this.tileSize;x.clusterMaxZoom!==void 0&&this.maxzoom<=x.clusterMaxZoom&&n.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${x.clusterMaxZoom}".`),this.workerOptions=n.e({source:this.id,cluster:x.cluster||!1,geojsonVtOptions:{buffer:(x.buffer!==void 0?x.buffer:128)*P,tolerance:(x.tolerance!==void 0?x.tolerance:.375)*P,extent:n.X,maxZoom:this.maxzoom,lineMetrics:x.lineMetrics||!1,generateId:x.generateId||!1},superclusterOptions:{maxZoom:x.clusterMaxZoom!==void 0?x.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,x.clusterMinPoints||2),extent:n.X,radius:(x.clusterRadius||50)*P,log:!1,generateId:x.generateId||!1},clusterProperties:x.clusterProperties,filter:x.filter},x.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return n._(this,void 0,void 0,(function*(){yield this._updateWorkerData()}))}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}getData(){return n._(this,void 0,void 0,(function*(){const o=n.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:o})}))}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,x,A){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:x,offset:A}})}_updateWorkerData(o){return n._(this,void 0,void 0,(function*(){const x=n.e({type:this.type},this.workerOptions);o?x.dataDiff=o:typeof this._data=="string"?(x.request=this.map._requestManager.transformRequest(ut.resolveURL(this._data),"Source"),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new n.k("dataloading",{dataType:"source"}));try{const A=yield this.actor.sendAsync({type:"LD",data:x});if(this._pendingLoads--,this._removed||A.abandoned)return void this.fire(new n.k("dataabort",{dataType:"source"}));let I=null;A.resourceTiming&&A.resourceTiming[this.id]&&(I=A.resourceTiming[this.id].slice(0));const P={dataType:"source"};this._collectResourceTiming&&I&&I.length>0&&n.e(P,{resourceTiming:I}),this.fire(new n.k("data",Object.assign(Object.assign({},P),{sourceDataType:"metadata"}))),this.fire(new n.k("data",Object.assign(Object.assign({},P),{sourceDataType:"content"})))}catch(A){if(this._pendingLoads--,this._removed)return void this.fire(new n.k("dataabort",{dataType:"source"}));this.fire(new n.j(A))}}))}loaded(){return this._pendingLoads===0}loadTile(o){return n._(this,void 0,void 0,(function*(){const x=o.actor?"RT":"LT";o.actor=this.actor;const A={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const I=yield this.actor.sendAsync({type:x,data:A},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(I,this.map.painter,x==="RT")}))}abortTile(o){return n._(this,void 0,void 0,(function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0}))}unloadTile(o){return n._(this,void 0,void 0,(function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})}))}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return n.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var ho=n.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Vo extends n.E{constructor(o,x,A,I){super(),this.id=o,this.dispatcher=A,this.coordinates=x.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=x}load(o){return n._(this,void 0,void 0,(function*(){this._loaded=!1,this.fire(new n.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const x=yield Ji.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,x&&x.data&&(this.image=x.data,o&&(this.coordinates=o),this._finishLoading())}catch(x){this._request=null,this._loaded=!0,this.fire(new n.j(x))}}))}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally((()=>{this.texture=null})),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new n.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const x=o.map(n.Z.fromLngLat);this.tileID=(function(I){let P=1/0,H=1/0,K=-1/0,ne=-1/0;for(const Be of I)P=Math.min(P,Be.x),H=Math.min(H,Be.y),K=Math.max(K,Be.x),ne=Math.max(ne,Be.y);const he=Math.max(K-P,ne-H),be=Math.max(0,Math.floor(-Math.log(he)/Math.LN2)),we=Math.pow(2,be);return new n.a1(be,Math.floor((P+K)/2*we),Math.floor((H+ne)/2*we))})(x),this.minzoom=this.maxzoom=this.tileID.z;const A=x.map((I=>this.tileID.getTilePoint(I)._round()));return this._boundsArray=new n.$,this._boundsArray.emplaceBack(A[0].x,A[0].y,0,0),this._boundsArray.emplaceBack(A[1].x,A[1].y,n.X,0),this._boundsArray.emplaceBack(A[3].x,A[3].y,0,n.X),this._boundsArray.emplaceBack(A[2].x,A[2].y,n.X,n.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new n.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,x=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,ho.members)),this.boundsSegments||(this.boundsSegments=n.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new dn(o,this.image,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let A=!1;for(const I in this.tiles){const P=this.tiles[I];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,A=!0)}A&&this.fire(new n.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return n._(this,void 0,void 0,(function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"}))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class la extends Vo{constructor(o,x,A,I){super(o,x,A,I),this.roundZoom=!0,this.type="video",this.options=x}load(){return n._(this,void 0,void 0,(function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const x of o.urls)this.urls.push(this.map._requestManager.transformRequest(x,"Source").url);try{const x=yield n.a3(this.urls);if(this._loaded=!0,!x)return;this.video=x,this.video.loop=!0,this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading()}catch(x){this.fire(new n.j(x))}}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const x=this.video.seekable;o<x.start(0)||o>x.end(0)?this.fire(new n.j(new n.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${x.start(0)} and ${x.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,x=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,ho.members)),this.boundsSegments||(this.boundsSegments=n.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.texSubImage2D(x.TEXTURE_2D,0,0,0,x.RGBA,x.UNSIGNED_BYTE,this.video)):(this.texture=new dn(o,this.video,x.RGBA),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE));let A=!1;for(const I in this.tiles){const P=this.tiles[I];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,A=!0)}A&&this.fire(new n.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Vs extends Vo{constructor(o,x,A,I){super(o,x,A,I),x.coordinates?Array.isArray(x.coordinates)&&x.coordinates.length===4&&!x.coordinates.some((P=>!Array.isArray(P)||P.length!==2||P.some((H=>typeof H!="number"))))||this.fire(new n.j(new n.a2(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.j(new n.a2(`sources.${o}`,null,'missing required property "coordinates"'))),x.animate&&typeof x.animate!="boolean"&&this.fire(new n.j(new n.a2(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),x.canvas?typeof x.canvas=="string"||x.canvas instanceof HTMLCanvasElement||this.fire(new n.j(new n.a2(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.j(new n.a2(`sources.${o}`,null,'missing required property "canvas"'))),this.options=x,this.animate=x.animate===void 0||x.animate}load(){return n._(this,void 0,void 0,(function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}))}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const x=this.map.painter.context,A=x.gl;this.boundsBuffer||(this.boundsBuffer=x.createVertexBuffer(this._boundsArray,ho.members)),this.boundsSegments||(this.boundsSegments=n.a0.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new dn(x,this.canvas,A.RGBA,{premultiply:!0});let I=!1;for(const P in this.tiles){const H=this.tiles[P];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture,I=!0)}I&&this.fire(new n.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const qs={},Us=L=>{switch(L){case"geojson":return rl;case"image":return Vo;case"raster":return Dr;case"raster-dem":return ma;case"vector":return zr;case"video":return la;case"canvas":return Vs}return qs[L]},cn="RTLPluginLoaded";class Ws extends n.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=Ir()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch((x=>{throw this.status="error",x}))}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return n._(this,arguments,void 0,(function*(x,A=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=ut.resolveURL(x),!this.url)throw new Error(`requested url ${x} is invalid`);if(this.status==="unavailable"){if(!A)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()}))}_requestImport(){return n._(this,void 0,void 0,(function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new n.k(cn))}))}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let To=null;function Do(){return To||(To=new Ws),To}class So{constructor(o,x){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=n.a4(),this.uses=0,this.tileSize=x,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const x=o+this.timeAdded;x<this.fadeEndTime||(this.fadeEndTime=x)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,x,A){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=(function(I,P){const H={};if(!P)return H;for(const K of I){const ne=K.layerIds.map((he=>P.getLayer(he))).filter(Boolean);if(ne.length!==0){K.layers=ne,K.stateDependentLayerIds&&(K.stateDependentLayers=K.stateDependentLayerIds.map((he=>ne.filter((be=>be.id===he))[0])));for(const he of ne)H[he.id]=K}}return H})(o.buckets,x.style),this.hasSymbolBuckets=!1;for(const I in this.buckets){const P=this.buckets[I];if(P instanceof n.a6){if(this.hasSymbolBuckets=!0,!A)break;P.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const I in this.buckets){const P=this.buckets[I];if(P instanceof n.a6&&P.hasRTLText){this.hasRTLText=!0,Do().lazyLoad();break}}this.queryPadding=0;for(const I in this.buckets){const P=this.buckets[I];this.queryPadding=Math.max(this.queryPadding,x.style.getLayer(I).queryRadius(P))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new n.a5}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const A in this.buckets){const I=this.buckets[A];I.uploadPending()&&I.upload(o)}const x=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new dn(o,this.imageAtlas.image,x.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new dn(o,this.glyphAtlasImage,x.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,x,A,I,P,H,K,ne,he,be){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:I,cameraQueryGeometry:P,scale:H,tileSize:this.tileSize,pixelPosMatrix:be,transform:ne,params:K,queryPadding:this.queryPadding*he},o,x,A):{}}querySourceFeatures(o,x){const A=this.latestFeatureIndex;if(!A||!A.rawTileData)return;const I=A.loadVTLayers(),P=x&&x.sourceLayer?x.sourceLayer:"",H=I._geojsonTileLayer||I[P];if(!H)return;const K=n.a7(x&&x.filter),{z:ne,x:he,y:be}=this.tileID.canonical,we={z:ne,x:he,y:be};for(let Be=0;Be<H.length;Be++){const Ye=H.feature(Be);if(K.needGeometry){const Et=n.a8(Ye,!0);if(!K.filter(new n.z(this.tileID.overscaledZ),Et,this.tileID.canonical))continue}else if(!K.filter(new n.z(this.tileID.overscaledZ),Ye))continue;const st=A.getId(Ye,P),vt=new n.a9(Ye,ne,he,be,st);vt.tile=we,o.push(vt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const x=this.expirationTime;if(o.cacheControl){const A=n.aa(o.cacheControl);A["max-age"]&&(this.expirationTime=Date.now()+1e3*A["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const A=Date.now();let I=!1;if(this.expirationTime>A)I=!1;else if(x)if(this.expirationTime<x)I=!0;else{const P=this.expirationTime-x;P?this.expirationTime=A+Math.max(P,3e4):I=!0}else I=!0;I?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,x){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const A=this.latestFeatureIndex.loadVTLayers();for(const I in this.buckets){if(!x.style.hasLayer(I))continue;const P=this.buckets[I],H=P.layers[0].sourceLayer||"_geojsonTileLayer",K=A[H],ne=o[H];if(!K||!ne||Object.keys(ne).length===0)continue;P.update(ne,K,this.imageAtlas&&this.imageAtlas.patternPositions||{});const he=x&&x.style&&x.style.getLayer(I);he&&(this.queryPadding=Math.max(this.queryPadding,he.queryRadius(P)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ut.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=ut.now()+o}setDependencies(o,x){const A={};for(const I of x)A[I]=!0;this.dependencies[o]=A}hasDependency(o,x){for(const A of o){const I=this.dependencies[A];if(I){for(const P of x)if(I[P])return!0}}return!1}}class Sn{constructor(o,x){this.max=o,this.onRemove=x,this.reset()}reset(){for(const o in this.data)for(const x of this.data[o])x.timeout&&clearTimeout(x.timeout),this.onRemove(x.value);return this.data={},this.order=[],this}add(o,x,A){const I=o.wrapped().key;this.data[I]===void 0&&(this.data[I]=[]);const P={value:x,timeout:void 0};if(A!==void 0&&(P.timeout=setTimeout((()=>{this.remove(o,P)}),A)),this.data[I].push(P),this.order.push(I),this.order.length>this.max){const H=this._getAndRemoveByKey(this.order[0]);H&&this.onRemove(H)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const x=this.data[o].shift();return x.timeout&&clearTimeout(x.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),x.value}getByKey(o){const x=this.data[o];return x?x[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,x){if(!this.has(o))return this;const A=o.wrapped().key,I=x===void 0?0:this.data[A].indexOf(x),P=this.data[A][I];return this.data[A].splice(I,1),P.timeout&&clearTimeout(P.timeout),this.data[A].length===0&&delete this.data[A],this.onRemove(P.value),this.order.splice(this.order.indexOf(A),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}filter(o){const x=[];for(const A in this.data)for(const I of this.data[A])o(I.value)||x.push(I);for(const A of x)this.remove(A.value.tileID,A)}}class tr{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,x,A){const I=String(x);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][I]=this.stateChanges[o][I]||{},n.e(this.stateChanges[o][I],A),this.deletedStates[o]===null){this.deletedStates[o]={};for(const P in this.state[o])P!==I&&(this.deletedStates[o][P]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][I]===null){this.deletedStates[o][I]={};for(const P in this.state[o][I])A[P]||(this.deletedStates[o][I][P]=null)}else for(const P in A)this.deletedStates[o]&&this.deletedStates[o][I]&&this.deletedStates[o][I][P]===null&&delete this.deletedStates[o][I][P]}removeFeatureState(o,x,A){if(this.deletedStates[o]===null)return;const I=String(x);if(this.deletedStates[o]=this.deletedStates[o]||{},A&&x!==void 0)this.deletedStates[o][I]!==null&&(this.deletedStates[o][I]=this.deletedStates[o][I]||{},this.deletedStates[o][I][A]=null);else if(x!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][I])for(A in this.deletedStates[o][I]={},this.stateChanges[o][I])this.deletedStates[o][I][A]=null;else this.deletedStates[o][I]=null;else this.deletedStates[o]=null}getState(o,x){const A=String(x),I=n.e({},(this.state[o]||{})[A],(this.stateChanges[o]||{})[A]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const P=this.deletedStates[o][x];if(P===null)return{};for(const H in P)delete I[H]}return I}initializeTileState(o,x){o.setFeatureState(this.state,x)}coalesceChanges(o,x){const A={};for(const I in this.stateChanges){this.state[I]=this.state[I]||{};const P={};for(const H in this.stateChanges[I])this.state[I][H]||(this.state[I][H]={}),n.e(this.state[I][H],this.stateChanges[I][H]),P[H]=this.state[I][H];A[I]=P}for(const I in this.deletedStates){this.state[I]=this.state[I]||{};const P={};if(this.deletedStates[I]===null)for(const H in this.state[I])P[H]={},this.state[I][H]={};else for(const H in this.deletedStates[I]){if(this.deletedStates[I][H]===null)this.state[I][H]={};else for(const K of Object.keys(this.deletedStates[I][H]))delete this.state[I][H][K];P[H]=this.state[I][H]}A[I]=A[I]||{},n.e(A[I],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(A).length!==0)for(const I in o)o[I].setFeatureState(A,x)}}class ar extends n.E{constructor(o,x,A){super(),this.id=o,this.dispatcher=A,this.on("data",(I=>this._dataHandler(I))),this.on("dataloading",(()=>{this._sourceErrored=!1})),this.on("error",(()=>{this._sourceErrored=this._source.loaded()})),this._source=((I,P,H,K)=>{const ne=new(Us(P.type))(I,P,H,K);if(ne.id!==I)throw new Error(`Expected Source id to be ${I} instead of ${ne.id}`);return ne})(o,x,A,this),this._tiles={},this._cache=new Sn(0,(I=>this._unloadTile(I))),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new tr,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const x=this._tiles[o];if(x.state!=="loaded"&&x.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,x,A){return n._(this,void 0,void 0,(function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,x,A)}catch(I){o.state="errored",I.status!==404?this._source.fire(new n.j(I,{tile:o})):this.update(this.transform,this.terrain)}}))}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new n.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const x in this._tiles){const A=this._tiles[x];A.upload(o),A.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map((o=>o.tileID)).sort(Hs).map((o=>o.key))}getRenderableIds(o){const x=[];for(const A in this._tiles)this._isIdRenderable(A,o)&&x.push(this._tiles[A]);return o?x.sort(((A,I)=>{const P=A.tileID,H=I.tileID,K=new n.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle),ne=new n.P(H.canonical.x,H.canonical.y)._rotate(this.transform.angle);return P.overscaledZ-H.overscaledZ||ne.y-K.y||ne.x-K.x})).map((A=>A.tileID.key)):x.map((A=>A.tileID)).sort(Hs).map((A=>A.key))}hasRenderableParent(o){const x=this.findLoadedParent(o,0);return!!x&&this._isIdRenderable(x.tileID.key)}_isIdRenderable(o,x){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(x||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,x){return n._(this,void 0,void 0,(function*(){const A=this._tiles[o];A&&(A.state!=="loading"&&(A.state=x),yield this._loadTile(A,o,x))}))}_tileLoaded(o,x,A){o.timeAdded=ut.now(),A==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(x,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new n.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const x=this.getRenderableIds();for(let I=0;I<x.length;I++){const P=x[I];if(o.neighboringTiles&&o.neighboringTiles[P]){const H=this.getTileByID(P);A(o,H),A(H,o)}}function A(I,P){I.needsHillshadePrepare=!0,I.needsTerrainPrepare=!0;let H=P.tileID.canonical.x-I.tileID.canonical.x;const K=P.tileID.canonical.y-I.tileID.canonical.y,ne=Math.pow(2,I.tileID.canonical.z),he=P.tileID.key;H===0&&K===0||Math.abs(K)>1||(Math.abs(H)>1&&(Math.abs(H+ne)===1?H+=ne:Math.abs(H-ne)===1&&(H-=ne)),P.dem&&I.dem&&(I.dem.backfillBorder(P.dem,H,K),I.neighboringTiles&&I.neighboringTiles[he]&&(I.neighboringTiles[he].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,x,A,I){for(const P in this._tiles){let H=this._tiles[P];if(I[P]||!H.hasData()||H.tileID.overscaledZ<=x||H.tileID.overscaledZ>A)continue;let K=H.tileID;for(;H&&H.tileID.overscaledZ>x+1;){const he=H.tileID.scaledTo(H.tileID.overscaledZ-1);H=this._tiles[he.key],H&&H.hasData()&&(K=he)}let ne=K;for(;ne.overscaledZ>x;)if(ne=ne.scaledTo(ne.overscaledZ-1),o[ne.key]){I[K.key]=K;break}}}findLoadedParent(o,x){if(o.key in this._loadedParentTiles){const A=this._loadedParentTiles[o.key];return A&&A.tileID.overscaledZ>=x?A:null}for(let A=o.overscaledZ-1;A>=x;A--){const I=o.scaledTo(A),P=this._getLoadedTile(I);if(P)return P}}findLoadedSibling(o){return this._getLoadedTile(o)}_getLoadedTile(o){const x=this._tiles[o.key];return x&&x.hasData()?x:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const x=Math.ceil(o.width/this._source.tileSize)+1,A=Math.ceil(o.height/this._source.tileSize)+1,I=Math.floor(x*A*(this._maxTileCacheZoomLevels===null?n.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),P=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,I):I;this._cache.setMaxSize(P)}handleWrapJump(o){const x=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,x){const A={};for(const I in this._tiles){const P=this._tiles[I];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+x),A[P.tileID.key]=P}this._tiles=A;for(const I in this._timers)clearTimeout(this._timers[I]),delete this._timers[I];for(const I in this._tiles)this._setTileReloadTimer(I,this._tiles[I])}}_updateCoveredAndRetainedTiles(o,x,A,I,P,H){const K={},ne={},he=Object.keys(o),be=ut.now();for(const we of he){const Be=o[we],Ye=this._tiles[we];if(!Ye||Ye.fadeEndTime!==0&&Ye.fadeEndTime<=be)continue;const st=this.findLoadedParent(Be,x),vt=this.findLoadedSibling(Be),Et=st||vt||null;Et&&(this._addTile(Et.tileID),K[Et.tileID.key]=Et.tileID),ne[we]=Be}this._retainLoadedChildren(ne,I,A,o);for(const we in K)o[we]||(this._coveredTiles[we]=!0,o[we]=K[we]);if(H){const we={},Be={};for(const Ye of P)this._tiles[Ye.key].hasData()?we[Ye.key]=Ye:Be[Ye.key]=Ye;for(const Ye in Be){const st=Be[Ye].children(this._source.maxzoom);this._tiles[st[0].key]&&this._tiles[st[1].key]&&this._tiles[st[2].key]&&this._tiles[st[3].key]&&(we[st[0].key]=o[st[0].key]=st[0],we[st[1].key]=o[st[1].key]=st[1],we[st[2].key]=o[st[2].key]=st[2],we[st[3].key]=o[st[3].key]=st[3],delete Be[Ye])}for(const Ye in Be){const st=Be[Ye],vt=this.findLoadedParent(st,this._source.minzoom),Et=this.findLoadedSibling(st),Ct=vt||Et||null;if(Ct){we[Ct.tileID.key]=o[Ct.tileID.key]=Ct.tileID;for(const Lt in we)we[Lt].isChildOf(Ct.tileID)&&delete we[Lt]}}for(const Ye in this._tiles)we[Ye]||(this._coveredTiles[Ye]=!0)}}update(o,x){if(!this._sourceLoaded||this._paused)return;let A;this.transform=o,this.terrain=x,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?A=o.getVisibleUnwrappedCoordinates(this._source.tileID).map((be=>new n.S(be.canonical.z,be.wrap,be.canonical.z,be.canonical.x,be.canonical.y))):(A=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:x}),this._source.hasTile&&(A=A.filter((be=>this._source.hasTile(be))))):A=[];const I=o.coveringZoomLevel(this._source),P=Math.max(I-ar.maxOverzooming,this._source.minzoom),H=Math.max(I+ar.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const be={};for(const we of A)if(we.canonical.z>this._source.minzoom){const Be=we.scaledTo(we.canonical.z-1);be[Be.key]=Be;const Ye=we.scaledTo(Math.max(this._source.minzoom,Math.min(we.canonical.z,5)));be[Ye.key]=Ye}A=A.concat(Object.values(be))}const K=A.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,K&&this.fire(new n.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const ne=this._updateRetainedTiles(A,I);pl(this._source.type)&&this._updateCoveredAndRetainedTiles(ne,P,H,I,A,x);for(const be in ne)this._tiles[be].clearFadeHold();const he=n.ab(this._tiles,ne);for(const be of he){const we=this._tiles[be];we.hasSymbolBuckets&&!we.holdingForFade()?we.setHoldDuration(this.map._fadeDuration):we.hasSymbolBuckets&&!we.symbolFadeFinished()||this._removeTile(be)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,x){var A;const I={},P={},H=Math.max(x-ar.maxOverzooming,this._source.minzoom),K=Math.max(x+ar.maxUnderzooming,this._source.minzoom),ne={};for(const he of o){const be=this._addTile(he);I[he.key]=he,be.hasData()||x<this._source.maxzoom&&(ne[he.key]=he)}this._retainLoadedChildren(ne,x,K,I);for(const he of o){let be=this._tiles[he.key];if(be.hasData())continue;if(x+1>this._source.maxzoom){const Be=he.children(this._source.maxzoom)[0],Ye=this.getTile(Be);if(Ye&&Ye.hasData()){I[Be.key]=Be;continue}}else{const Be=he.children(this._source.maxzoom);if(I[Be[0].key]&&I[Be[1].key]&&I[Be[2].key]&&I[Be[3].key])continue}let we=be.wasRequested();for(let Be=he.overscaledZ-1;Be>=H;--Be){const Ye=he.scaledTo(Be);if(P[Ye.key])break;if(P[Ye.key]=!0,be=this.getTile(Ye),!be&&we&&(be=this._addTile(Ye)),be){const st=be.hasData();if((st||!(!((A=this.map)===null||A===void 0)&&A.cancelPendingTileRequestsWhileZooming)||we)&&(I[Ye.key]=Ye),we=be.wasRequested(),st)break}}}return I}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const x=[];let A,I=this._tiles[o].tileID;for(;I.overscaledZ>0;){if(I.key in this._loadedParentTiles){A=this._loadedParentTiles[I.key];break}x.push(I.key);const P=I.scaledTo(I.overscaledZ-1);if(A=this._getLoadedTile(P),A)break;I=P}for(const P of x)this._loadedParentTiles[P]=A}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const o in this._tiles){const x=this._tiles[o].tileID,A=this._getLoadedTile(x);this._loadedSiblingTiles[x.key]=A}}_addTile(o){let x=this._tiles[o.key];if(x)return x;x=this._cache.getAndRemove(o),x&&(this._setTileReloadTimer(o.key,x),x.tileID=o,this._state.initializeTileState(x,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,x)));const A=x;return x||(x=new So(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(x,o.key,x.state)),x.uses++,this._tiles[o.key]=x,A||this._source.fire(new n.k("dataloading",{tile:x,coord:x.tileID,dataType:"source"})),x}_setTileReloadTimer(o,x){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const A=x.getExpiryTimeout();A&&(this._timers[o]=setTimeout((()=>{this._reloadTile(o,"expired"),delete this._timers[o]}),A))}_removeTile(o){const x=this._tiles[o];x&&(x.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),x.uses>0||(x.hasData()&&x.state!=="reloading"?this._cache.add(x.tileID,x,x.getExpiryTimeout()):(x.aborted=!0,this._abortTile(x),this._unloadTile(x))))}_dataHandler(o){const x=o.sourceDataType;o.dataType==="source"&&x==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&x==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,x,A){const I=[],P=this.transform;if(!P)return I;const H=A?P.getCameraQueryGeometry(o):o,K=o.map((st=>P.pointCoordinate(st,this.terrain))),ne=H.map((st=>P.pointCoordinate(st,this.terrain))),he=this.getIds();let be=1/0,we=1/0,Be=-1/0,Ye=-1/0;for(const st of ne)be=Math.min(be,st.x),we=Math.min(we,st.y),Be=Math.max(Be,st.x),Ye=Math.max(Ye,st.y);for(let st=0;st<he.length;st++){const vt=this._tiles[he[st]];if(vt.holdingForFade())continue;const Et=vt.tileID,Ct=Math.pow(2,P.zoom-vt.tileID.overscaledZ),Lt=x*vt.queryPadding*n.X/vt.tileSize/Ct,_t=[Et.getTilePoint(new n.Z(be,we)),Et.getTilePoint(new n.Z(Be,Ye))];if(_t[0].x-Lt<n.X&&_t[0].y-Lt<n.X&&_t[1].x+Lt>=0&&_t[1].y+Lt>=0){const Ht=K.map((oi=>Et.getTilePoint(oi))),Qt=ne.map((oi=>Et.getTilePoint(oi)));I.push({tile:vt,tileID:Et,queryGeometry:Ht,cameraQueryGeometry:Qt,scale:Ct})}}return I}getVisibleCoordinates(o){const x=this.getRenderableIds(o).map((A=>this._tiles[A].tileID));for(const A of x)A.posMatrix=this.transform.calculatePosMatrix(A.toUnwrapped());return x}hasTransition(){if(this._source.hasTransition())return!0;if(pl(this._source.type)){const o=ut.now();for(const x in this._tiles)if(this._tiles[x].fadeEndTime>=o)return!0}return!1}setFeatureState(o,x,A){this._state.updateState(o=o||"_geojsonTileLayer",x,A)}removeFeatureState(o,x,A){this._state.removeFeatureState(o=o||"_geojsonTileLayer",x,A)}getFeatureState(o,x){return this._state.getState(o=o||"_geojsonTileLayer",x)}setDependencies(o,x,A){const I=this._tiles[o];I&&I.setDependencies(x,A)}reloadTilesForDependencies(o,x){for(const A in this._tiles)this._tiles[A].hasDependency(o,x)&&this._reloadTile(A,"reloading");this._cache.filter((A=>!A.hasDependency(o,x)))}}function Hs(L,o){const x=Math.abs(2*L.wrap)-+(L.wrap<0),A=Math.abs(2*o.wrap)-+(o.wrap<0);return L.overscaledZ-o.overscaledZ||A-x||o.canonical.y-L.canonical.y||o.canonical.x-L.canonical.x}function pl(L){return L==="raster"||L==="image"||L==="video"}ar.maxOverzooming=10,ar.maxUnderzooming=3;class Xr{constructor(o,x){this.reset(o,x)}reset(o,x){this.points=o||[],this._distances=[0];for(let A=1;A<this.points.length;A++)this._distances[A]=this._distances[A-1]+this.points[A].dist(this.points[A-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(x||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=n.ac(o,0,1);let x=1,A=this._distances[x];const I=o*this.paddedLength+this.padding;for(;A<I&&x<this._distances.length;)A=this._distances[++x];const P=x-1,H=this._distances[P],K=A-H,ne=K>0?(I-H)/K:0;return this.points[P].mult(1-ne).add(this.points[x].mult(ne))}}function ml(L,o){let x=!0;return L==="always"||L!=="never"&&o!=="never"||(x=!1),x}class Uo{constructor(o,x,A){const I=this.boxCells=[],P=this.circleCells=[];this.xCellCount=Math.ceil(o/A),this.yCellCount=Math.ceil(x/A);for(let H=0;H<this.xCellCount*this.yCellCount;H++)I.push([]),P.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=x,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/x,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,x,A,I,P){this._forEachCell(x,A,I,P,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(x),this.bboxes.push(A),this.bboxes.push(I),this.bboxes.push(P)}insertCircle(o,x,A,I){this._forEachCell(x-I,A-I,x+I,A+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(x),this.circles.push(A),this.circles.push(I)}_insertBoxCell(o,x,A,I,P,H){this.boxCells[P].push(H)}_insertCircleCell(o,x,A,I,P,H){this.circleCells[P].push(H)}_query(o,x,A,I,P,H,K){if(A<0||o>this.width||I<0||x>this.height)return[];const ne=[];if(o<=0&&x<=0&&this.width<=A&&this.height<=I){if(P)return[{key:null,x1:o,y1:x,x2:A,y2:I}];for(let he=0;he<this.boxKeys.length;he++)ne.push({key:this.boxKeys[he],x1:this.bboxes[4*he],y1:this.bboxes[4*he+1],x2:this.bboxes[4*he+2],y2:this.bboxes[4*he+3]});for(let he=0;he<this.circleKeys.length;he++){const be=this.circles[3*he],we=this.circles[3*he+1],Be=this.circles[3*he+2];ne.push({key:this.circleKeys[he],x1:be-Be,y1:we-Be,x2:be+Be,y2:we+Be})}}else this._forEachCell(o,x,A,I,this._queryCell,ne,{hitTest:P,overlapMode:H,seenUids:{box:{},circle:{}}},K);return ne}query(o,x,A,I){return this._query(o,x,A,I,!1,null)}hitTest(o,x,A,I,P,H){return this._query(o,x,A,I,!0,P,H).length>0}hitTestCircle(o,x,A,I,P){const H=o-A,K=o+A,ne=x-A,he=x+A;if(K<0||H>this.width||he<0||ne>this.height)return!1;const be=[];return this._forEachCell(H,ne,K,he,this._queryCellCircle,be,{hitTest:!0,overlapMode:I,circle:{x:o,y:x,radius:A},seenUids:{box:{},circle:{}}},P),be.length>0}_queryCell(o,x,A,I,P,H,K,ne){const{seenUids:he,hitTest:be,overlapMode:we}=K,Be=this.boxCells[P];if(Be!==null){const st=this.bboxes;for(const vt of Be)if(!he.box[vt]){he.box[vt]=!0;const Et=4*vt,Ct=this.boxKeys[vt];if(o<=st[Et+2]&&x<=st[Et+3]&&A>=st[Et+0]&&I>=st[Et+1]&&(!ne||ne(Ct))&&(!be||!ml(we,Ct.overlapMode))&&(H.push({key:Ct,x1:st[Et],y1:st[Et+1],x2:st[Et+2],y2:st[Et+3]}),be))return!0}}const Ye=this.circleCells[P];if(Ye!==null){const st=this.circles;for(const vt of Ye)if(!he.circle[vt]){he.circle[vt]=!0;const Et=3*vt,Ct=this.circleKeys[vt];if(this._circleAndRectCollide(st[Et],st[Et+1],st[Et+2],o,x,A,I)&&(!ne||ne(Ct))&&(!be||!ml(we,Ct.overlapMode))){const Lt=st[Et],_t=st[Et+1],Ht=st[Et+2];if(H.push({key:Ct,x1:Lt-Ht,y1:_t-Ht,x2:Lt+Ht,y2:_t+Ht}),be)return!0}}}return!1}_queryCellCircle(o,x,A,I,P,H,K,ne){const{circle:he,seenUids:be,overlapMode:we}=K,Be=this.boxCells[P];if(Be!==null){const st=this.bboxes;for(const vt of Be)if(!be.box[vt]){be.box[vt]=!0;const Et=4*vt,Ct=this.boxKeys[vt];if(this._circleAndRectCollide(he.x,he.y,he.radius,st[Et+0],st[Et+1],st[Et+2],st[Et+3])&&(!ne||ne(Ct))&&!ml(we,Ct.overlapMode))return H.push(!0),!0}}const Ye=this.circleCells[P];if(Ye!==null){const st=this.circles;for(const vt of Ye)if(!be.circle[vt]){be.circle[vt]=!0;const Et=3*vt,Ct=this.circleKeys[vt];if(this._circlesCollide(st[Et],st[Et+1],st[Et+2],he.x,he.y,he.radius)&&(!ne||ne(Ct))&&!ml(we,Ct.overlapMode))return H.push(!0),!0}}}_forEachCell(o,x,A,I,P,H,K,ne){const he=this._convertToXCellCoord(o),be=this._convertToYCellCoord(x),we=this._convertToXCellCoord(A),Be=this._convertToYCellCoord(I);for(let Ye=he;Ye<=we;Ye++)for(let st=be;st<=Be;st++)if(P.call(this,o,x,A,I,this.xCellCount*st+Ye,H,K,ne))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,x,A,I,P,H){const K=I-o,ne=P-x,he=A+H;return he*he>K*K+ne*ne}_circleAndRectCollide(o,x,A,I,P,H,K){const ne=(H-I)/2,he=Math.abs(o-(I+ne));if(he>ne+A)return!1;const be=(K-P)/2,we=Math.abs(x-(P+be));if(we>be+A)return!1;if(he<=ne||we<=be)return!0;const Be=he-ne,Ye=we-be;return Be*Be+Ye*Ye<=A*A}}function lc(L,o,x,A,I){const P=n.H();return o?(n.K(P,P,[1/I,1/I,1]),x||n.ad(P,P,A.angle)):n.L(P,A.labelPlaneMatrix,L),P}function ul(L,o,x,A,I){if(o){const P=n.ae(L);return n.K(P,P,[I,I,1]),x||n.ad(P,P,-A.angle),P}return A.glCoordMatrix}function dt(L,o,x,A){let I;A?(I=[L,o,A(L,o),1],n.af(I,I,x)):(I=[L,o,0,1],lt(I,I,x));const P=I[3];return{point:new n.P(I[0]/P,I[1]/P),signedDistanceFromCamera:P,isOccluded:!1}}function Ce(L,o){return .5+L/o*.5}function Re(L,o){return L.x>=-o[0]&&L.x<=o[0]&&L.y>=-o[1]&&L.y<=o[1]}function Qe(L,o,x,A,I,P,H,K,ne,he,be,we,Be,Ye,st){const vt=A?L.textSizeData:L.iconSizeData,Et=n.ag(vt,x.transform.zoom),Ct=[256/x.width*2+1,256/x.height*2+1],Lt=A?L.text.dynamicLayoutVertexArray:L.icon.dynamicLayoutVertexArray;Lt.clear();const _t=L.lineVertexArray,Ht=A?L.text.placedSymbolArray:L.icon.placedSymbolArray,Qt=x.transform.width/x.transform.height;let oi=!1;for(let $i=0;$i<Ht.length;$i++){const An=Ht.get($i);if(An.hidden||An.writingMode===n.ah.vertical&&!oi){Tr(An.numGlyphs,Lt);continue}oi=!1;const Mn=dt(An.anchorX,An.anchorY,o,st);if(!Re(Mn.point,Ct)){Tr(An.numGlyphs,Lt);continue}const Zn=Ce(x.transform.cameraToCenterDistance,Mn.signedDistanceFromCamera),Ln=n.ai(vt,Et,An),zn=H?Ln/Zn:Ln*Zn,ir={getElevation:st,labelPlaneMatrix:I,lineVertexArray:_t,pitchWithMap:H,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:he,tileAnchorPoint:new n.P(An.anchorX,An.anchorY),unwrappedTileID:be,width:we,height:Be,translation:Ye},$r=je(ir,An,zn,!1,K,o,P,L.glyphOffsetArray,Lt,Qt,ne);oi=$r.useVertical,($r.notEnoughRoom||oi||$r.needsFlipping&&je(ir,An,zn,!0,K,o,P,L.glyphOffsetArray,Lt,Qt,ne).notEnoughRoom)&&Tr(An.numGlyphs,Lt)}A?L.text.dynamicLayoutVertexBuffer.updateData(Lt):L.icon.dynamicLayoutVertexBuffer.updateData(Lt)}function mt(L,o,x,A,I,P,H,K){const ne=P.glyphStartIndex+P.numGlyphs,he=P.lineStartIndex,be=P.lineStartIndex+P.lineLength,we=o.getoffsetX(P.glyphStartIndex),Be=o.getoffsetX(ne-1),Ye=kn(L*we,x,A,I,P.segment,he,be,K,H);if(!Ye)return null;const st=kn(L*Be,x,A,I,P.segment,he,be,K,H);return st?K.projectionCache.anyProjectionOccluded?null:{first:Ye,last:st}:null}function Nt(L,o,x,A){return L===n.ah.horizontal&&Math.abs(x.y-o.y)>Math.abs(x.x-o.x)*A?{useVertical:!0}:(L===n.ah.vertical?o.y<x.y:o.x>x.x)?{needsFlipping:!0}:null}function je(L,o,x,A,I,P,H,K,ne,he,be){const we=x/24,Be=o.lineOffsetX*we,Ye=o.lineOffsetY*we;let st;if(o.numGlyphs>1){const vt=o.glyphStartIndex+o.numGlyphs,Et=o.lineStartIndex,Ct=o.lineStartIndex+o.lineLength,Lt=mt(we,K,Be,Ye,A,o,be,L);if(!Lt)return{notEnoughRoom:!0};const _t=dt(Lt.first.point.x,Lt.first.point.y,H,L.getElevation).point,Ht=dt(Lt.last.point.x,Lt.last.point.y,H,L.getElevation).point;if(I&&!A){const Qt=Nt(o.writingMode,_t,Ht,he);if(Qt)return Qt}st=[Lt.first];for(let Qt=o.glyphStartIndex+1;Qt<vt-1;Qt++)st.push(kn(we*K.getoffsetX(Qt),Be,Ye,A,o.segment,Et,Ct,L,be));st.push(Lt.last)}else{if(I&&!A){const Et=dt(L.tileAnchorPoint.x,L.tileAnchorPoint.y,P,L.getElevation).point,Ct=o.lineStartIndex+o.segment+1,Lt=new n.P(L.lineVertexArray.getx(Ct),L.lineVertexArray.gety(Ct)),_t=dt(Lt.x,Lt.y,P,L.getElevation),Ht=_t.signedDistanceFromCamera>0?_t.point:(function(oi,$i,An,Mn,Zn,Ln){return ei(oi,$i,An,1,Zn,Ln)})(L.tileAnchorPoint,Lt,Et,0,P,L),Qt=Nt(o.writingMode,Et,Ht,he);if(Qt)return Qt}const vt=kn(we*K.getoffsetX(o.glyphStartIndex),Be,Ye,A,o.segment,o.lineStartIndex,o.lineStartIndex+o.lineLength,L,be);if(!vt||L.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};st=[vt]}for(const vt of st)n.aj(ne,vt.point,vt.angle);return{}}function ei(L,o,x,A,I,P){const H=L.add(L.sub(o)._unit()),K=I!==void 0?dt(H.x,H.y,I,P.getElevation).point:Di(H.x,H.y,P).point,ne=x.sub(K);return x.add(ne._mult(A/ne.mag()))}function Pt(L,o,x){const A=o.projectionCache;if(A.projections[L])return A.projections[L];const I=new n.P(o.lineVertexArray.getx(L),o.lineVertexArray.gety(L)),P=Di(I.x,I.y,o);if(P.signedDistanceFromCamera>0)return A.projections[L]=P.point,A.anyProjectionOccluded=A.anyProjectionOccluded||P.isOccluded,P.point;const H=L-x.direction;return(function(K,ne,he,be,we){return ei(K,ne,he,be,void 0,we)})(x.distanceFromAnchor===0?o.tileAnchorPoint:new n.P(o.lineVertexArray.getx(H),o.lineVertexArray.gety(H)),I,x.previousVertex,x.absOffsetX-x.distanceFromAnchor+1,o)}function Di(L,o,x){const A=L+x.translation[0],I=o+x.translation[1];let P;return!x.pitchWithMap&&x.projection.useSpecialProjectionForSymbols?(P=x.projection.projectTileCoordinates(A,I,x.unwrappedTileID,x.getElevation),P.point.x=(.5*P.point.x+.5)*x.width,P.point.y=(.5*-P.point.y+.5)*x.height):(P=dt(A,I,x.labelPlaneMatrix,x.getElevation),P.isOccluded=!1),P}function fi(L,o,x){return L._unit()._perp()._mult(o*x)}function hi(L,o,x,A,I,P,H,K,ne){if(K.projectionCache.offsets[L])return K.projectionCache.offsets[L];const he=x.add(o);if(L+ne.direction<A||L+ne.direction>=I)return K.projectionCache.offsets[L]=he,he;const be=Pt(L+ne.direction,K,ne),we=fi(be.sub(x),H,ne.direction),Be=x.add(we),Ye=be.add(we);return K.projectionCache.offsets[L]=n.ak(P,he,Be,Ye)||he,K.projectionCache.offsets[L]}function kn(L,o,x,A,I,P,H,K,ne){const he=A?L-o:L+o;let be=he>0?1:-1,we=0;A&&(be*=-1,we=Math.PI),be<0&&(we+=Math.PI);let Be,Ye=be>0?P+I:P+I+1;K.projectionCache.cachedAnchorPoint?Be=K.projectionCache.cachedAnchorPoint:(Be=Di(K.tileAnchorPoint.x,K.tileAnchorPoint.y,K).point,K.projectionCache.cachedAnchorPoint=Be);let st,vt,Et=Be,Ct=Be,Lt=0,_t=0;const Ht=Math.abs(he),Qt=[];let oi;for(;Lt+_t<=Ht;){if(Ye+=be,Ye<P||Ye>=H)return null;Lt+=_t,Ct=Et,vt=st;const Mn={absOffsetX:Ht,direction:be,distanceFromAnchor:Lt,previousVertex:Ct};if(Et=Pt(Ye,K,Mn),x===0)Qt.push(Ct),oi=Et.sub(Ct);else{let Zn;const Ln=Et.sub(Ct);Zn=Ln.mag()===0?fi(Pt(Ye+be,K,Mn).sub(Et),x,be):fi(Ln,x,be),vt||(vt=Ct.add(Zn)),st=hi(Ye,Zn,Et,P,H,vt,x,K,Mn),Qt.push(vt),oi=st.sub(vt)}_t=oi.mag()}const $i=oi._mult((Ht-Lt)/_t)._add(vt||Ct),An=we+Math.atan2(Et.y-Ct.y,Et.x-Ct.x);return Qt.push($i),{point:$i,angle:ne?An:0,path:Qt}}const hr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Tr(L,o){for(let x=0;x<L;x++){const A=o.length;o.resize(A+4),o.float32.set(hr,3*A)}}function lt(L,o,x){const A=o[0],I=o[1];return L[0]=x[0]*A+x[4]*I+x[12],L[1]=x[1]*A+x[5]*I+x[13],L[3]=x[3]*A+x[7]*I+x[15],L}const te=100;class pe{constructor(o,x,A=new Uo(o.width+200,o.height+200,25),I=new Uo(o.width+200,o.height+200,25)){this.transform=o,this.mapProjection=x,this.grid=A,this.ignoredGrid=I,this.pitchFactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+te,this.screenBottomBoundary=o.height+te,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,x,A,I,P,H,K,ne,he,be,we){const Be=o.anchorPointX+ne[0],Ye=o.anchorPointY+ne[1],st=this.projectAndGetPerspectiveRatio(I,Be,Ye,P,be),vt=A*st.perspectiveRatio;let Et;if(H||K)Et=this._projectCollisionBox(o,vt,I,P,H,K,ne,st,be,we);else{const Qt=st.point.x+(we?we.x*vt:0),oi=st.point.y+(we?we.y*vt:0);Et={allPointsOccluded:!1,box:[Qt+o.x1*vt,oi+o.y1*vt,Qt+o.x2*vt,oi+o.y2*vt]}}const[Ct,Lt,_t,Ht]=Et.box;return this.mapProjection.useSpecialProjectionForSymbols&&(H?Et.allPointsOccluded:this.mapProjection.isOccluded(Be,Ye,P))||st.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(Ct,Lt,_t,Ht)||x!=="always"&&this.grid.hitTest(Ct,Lt,_t,Ht,x,he)?{box:[Ct,Lt,_t,Ht],placeable:!1,offscreen:!1}:{box:[Ct,Lt,_t,Ht],placeable:!0,offscreen:this.isOffscreen(Ct,Lt,_t,Ht)}}placeCollisionCircles(o,x,A,I,P,H,K,ne,he,be,we,Be,Ye,st,vt,Et){const Ct=[],Lt=new n.P(x.anchorX,x.anchorY),_t=this.getPerspectiveRatio(H,Lt.x,Lt.y,K,Et),Ht=(we?P/_t:P*_t)/n.ap,Qt={getElevation:Et,labelPlaneMatrix:ne,lineVertexArray:A,pitchWithMap:we,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:Lt,unwrappedTileID:K,width:this.transform.width,height:this.transform.height,translation:vt},oi=mt(Ht,I,x.lineOffsetX*Ht,x.lineOffsetY*Ht,!1,x,!1,Qt);let $i=!1,An=!1,Mn=!0;if(oi){const Zn=.5*Ye*_t+st,Ln=new n.P(-100,-100),zn=new n.P(this.screenRightBoundary,this.screenBottomBoundary),ir=new Xr,$r=oi.first,On=oi.last;let qn=[];for(let Ma=$r.path.length-1;Ma>=1;Ma--)qn.push($r.path[Ma]);for(let Ma=1;Ma<On.path.length;Ma++)qn.push(On.path[Ma]);const Yr=2.5*Zn;if(he){const Ma=this.projectPathToScreenSpace(qn,Qt,he);qn=Ma.some((Za=>Za.signedDistanceFromCamera<=0))?[]:Ma.map((Za=>Za.point))}let Qa=[];if(qn.length>0){const Ma=qn[0].clone(),Za=qn[0].clone();for(let Ls=1;Ls<qn.length;Ls++)Ma.x=Math.min(Ma.x,qn[Ls].x),Ma.y=Math.min(Ma.y,qn[Ls].y),Za.x=Math.max(Za.x,qn[Ls].x),Za.y=Math.max(Za.y,qn[Ls].y);Qa=Ma.x>=Ln.x&&Za.x<=zn.x&&Ma.y>=Ln.y&&Za.y<=zn.y?[qn]:Za.x<Ln.x||Ma.x>zn.x||Za.y<Ln.y||Ma.y>zn.y?[]:n.al([qn],Ln.x,Ln.y,zn.x,zn.y)}for(const Ma of Qa){ir.reset(Ma,.25*Zn);let Za=0;Za=ir.length<=.5*Zn?1:Math.ceil(ir.paddedLength/Yr)+1;for(let Ls=0;Ls<Za;Ls++){const ol=Ls/Math.max(Za-1,1),mc=ir.lerp(ol),ks=mc.x+te,Lo=mc.y+te;Ct.push(ks,Lo,Zn,0);const Os=ks-Zn,Ms=Lo-Zn,Co=ks+Zn,_c=Lo+Zn;if(Mn=Mn&&this.isOffscreen(Os,Ms,Co,_c),An=An||this.isInsideGrid(Os,Ms,Co,_c),o!=="always"&&this.grid.hitTestCircle(ks,Lo,Zn,o,Be)&&($i=!0,!be))return{circles:[],offscreen:!1,collisionDetected:$i}}}}return{circles:!be&&$i||!An||_t<this.perspectiveRatioCutoff?[]:Ct,offscreen:Mn,collisionDetected:$i}}projectPathToScreenSpace(o,x,A){return o.map((I=>dt(I.x,I.y,A,x.getElevation)))}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const x=[];let A=1/0,I=1/0,P=-1/0,H=-1/0;for(const be of o){const we=new n.P(be.x+te,be.y+te);A=Math.min(A,we.x),I=Math.min(I,we.y),P=Math.max(P,we.x),H=Math.max(H,we.y),x.push(we)}const K=this.grid.query(A,I,P,H).concat(this.ignoredGrid.query(A,I,P,H)),ne={},he={};for(const be of K){const we=be.key;if(ne[we.bucketInstanceId]===void 0&&(ne[we.bucketInstanceId]={}),ne[we.bucketInstanceId][we.featureIndex])continue;const Be=[new n.P(be.x1,be.y1),new n.P(be.x2,be.y1),new n.P(be.x2,be.y2),new n.P(be.x1,be.y2)];n.am(x,Be)&&(ne[we.bucketInstanceId][we.featureIndex]=!0,he[we.bucketInstanceId]===void 0&&(he[we.bucketInstanceId]=[]),he[we.bucketInstanceId].push(we.featureIndex))}return he}insertCollisionBox(o,x,A,I,P,H){(A?this.ignoredGrid:this.grid).insert({bucketInstanceId:I,featureIndex:P,collisionGroupID:H,overlapMode:x},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,x,A,I,P,H){const K=A?this.ignoredGrid:this.grid,ne={bucketInstanceId:I,featureIndex:P,collisionGroupID:H,overlapMode:x};for(let he=0;he<o.length;he+=4)K.insertCircle(ne,o[he],o[he+1],o[he+2])}projectAndGetPerspectiveRatio(o,x,A,I,P){let H;P?(H=[x,A,P(x,A),1],n.af(H,H,o)):(H=[x,A,0,1],lt(H,H,o));const K=H[3];return{point:new n.P((H[0]/K+1)/2*this.transform.width+te,(-H[1]/K+1)/2*this.transform.height+te),perspectiveRatio:.5+this.transform.cameraToCenterDistance/K*.5,isOccluded:!1,signedDistanceFromCamera:K}}getPerspectiveRatio(o,x,A,I,P){const H=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(x,A,I,P):dt(x,A,o,P);return .5+this.transform.cameraToCenterDistance/H.signedDistanceFromCamera*.5}isOffscreen(o,x,A,I){return A<te||o>=this.screenRightBoundary||I<te||x>this.screenBottomBoundary}isInsideGrid(o,x,A,I){return A>=0&&o<this.gridRightBoundary&&I>=0&&x<this.gridBottomBoundary}getViewportMatrix(){const o=n.an([]);return n.J(o,o,[-100,-100,0]),o}_projectCollisionBox(o,x,A,I,P,H,K,ne,he,be){let we=new n.P(1,0),Be=new n.P(0,1);const Ye=new n.P(o.anchorPointX+K[0],o.anchorPointY+K[1]);if(H&&!P){const Mn=this.projectAndGetPerspectiveRatio(A,Ye.x+1,Ye.y,I,he).point.sub(ne.point).unit(),Zn=Math.atan(Mn.y/Mn.x)+(Mn.x<0?Math.PI:0),Ln=Math.sin(Zn),zn=Math.cos(Zn);we=new n.P(zn,Ln),Be=new n.P(-Ln,zn)}else if(!H&&P){const Mn=-this.transform.angle,Zn=Math.sin(Mn),Ln=Math.cos(Mn);we=new n.P(Ln,Zn),Be=new n.P(-Zn,Ln)}let st=ne.point,vt=x;if(P){st=Ye;const Mn=this.transform.zoom-Math.floor(this.transform.zoom);vt=Math.pow(2,-Mn),vt*=this.mapProjection.getPitchedTextCorrection(this.transform,Ye,I),be||(vt*=n.ac(.5+ne.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}be&&(st=st.add(we.mult(be.x*vt)).add(Be.mult(be.y*vt)));const Et=o.x1*vt,Ct=o.x2*vt,Lt=(Et+Ct)/2,_t=o.y1*vt,Ht=o.y2*vt,Qt=(_t+Ht)/2,oi=[{offsetX:Et,offsetY:_t},{offsetX:Lt,offsetY:_t},{offsetX:Ct,offsetY:_t},{offsetX:Ct,offsetY:Qt},{offsetX:Ct,offsetY:Ht},{offsetX:Lt,offsetY:Ht},{offsetX:Et,offsetY:Ht},{offsetX:Et,offsetY:Qt}];let $i=[];for(const{offsetX:Mn,offsetY:Zn}of oi)$i.push(new n.P(st.x+we.x*Mn+Be.x*Zn,st.y+we.y*Mn+Be.y*Zn));let An=!1;if(P){const Mn=$i.map((Zn=>this.projectAndGetPerspectiveRatio(A,Zn.x,Zn.y,I,he)));An=Mn.some((Zn=>!Zn.isOccluded)),$i=Mn.map((Zn=>Zn.point))}else An=!0;return{box:n.ao($i),allPointsOccluded:!An}}}function ze(L,o,x){return o*(n.X/(L.tileSize*Math.pow(2,x-L.tileID.overscaledZ)))}class et{constructor(o,x,A,I){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?x:-x))):I&&A?1:0,this.placed=A}isHidden(){return this.opacity===0&&!this.placed}}class Xe{constructor(o,x,A,I,P){this.text=new et(o?o.text:null,x,A,P),this.icon=new et(o?o.icon:null,x,I,P)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class rt{constructor(o,x,A){this.text=o,this.icon=x,this.skipFade=A}}class wt{constructor(){this.invProjMatrix=n.H(),this.viewportMatrix=n.H(),this.circles=[]}}class ot{constructor(o,x,A,I,P){this.bucketInstanceId=o,this.featureIndex=x,this.sourceLayerIndex=A,this.bucketIndex=I,this.tileID=P}}class At{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const x=++this.maxGroupID;this.collisionGroups[o]={ID:x,predicate:A=>A.collisionGroupID===x}}return this.collisionGroups[o]}}function ti(L,o,x,A,I){const{horizontalAlign:P,verticalAlign:H}=n.au(L);return new n.P(-(P-.5)*o+A[0]*I,-(H-.5)*x+A[1]*I)}class qt{constructor(o,x,A,I,P,H){this.transform=o.clone(),this.terrain=A,this.collisionIndex=new pe(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=I,this.retainedQueryData={},this.collisionGroups=new At(P),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=H,H&&(H.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(o){const x=this.terrain;return x?(A,I)=>x.getElevation(o,A,I):null}getBucketParts(o,x,A,I){const P=A.getBucket(x),H=A.latestFeatureIndex;if(!P||!H||x.id!==P.layerIds[0])return;const K=A.collisionBoxArray,ne=P.layers[0].layout,he=P.layers[0].paint,be=Math.pow(2,this.transform.zoom-A.tileID.overscaledZ),we=A.tileSize/n.X,Be=A.tileID.toUnwrapped(),Ye=this.transform.calculatePosMatrix(Be),st=ne.get("text-pitch-alignment")==="map",vt=ne.get("text-rotation-alignment")==="map",Et=ze(A,1,this.transform.zoom),Ct=this.collisionIndex.mapProjection.translatePosition(this.transform,A,he.get("text-translate"),he.get("text-translate-anchor")),Lt=this.collisionIndex.mapProjection.translatePosition(this.transform,A,he.get("icon-translate"),he.get("icon-translate-anchor")),_t=lc(Ye,st,vt,this.transform,Et);let Ht=null;if(st){const oi=ul(Ye,st,vt,this.transform,Et);Ht=n.L([],this.transform.labelPlaneMatrix,oi)}this.retainedQueryData[P.bucketInstanceId]=new ot(P.bucketInstanceId,H,P.sourceLayerIndex,P.index,A.tileID);const Qt={bucket:P,layout:ne,translationText:Ct,translationIcon:Lt,posMatrix:Ye,unwrappedTileID:Be,textLabelPlaneMatrix:_t,labelToScreenMatrix:Ht,scale:be,textPixelRatio:we,holdingForFade:A.holdingForFade(),collisionBoxArray:K,partiallyEvaluatedTextSize:n.ag(P.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(P.sourceID)};if(I)for(const oi of P.sortKeyRanges){const{sortKey:$i,symbolInstanceStart:An,symbolInstanceEnd:Mn}=oi;o.push({sortKey:$i,symbolInstanceStart:An,symbolInstanceEnd:Mn,parameters:Qt})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:P.symbolInstances.length,parameters:Qt})}attemptAnchorPlacement(o,x,A,I,P,H,K,ne,he,be,we,Be,Ye,st,vt,Et,Ct,Lt,_t){const Ht=n.aq[o.textAnchor],Qt=[o.textOffset0,o.textOffset1],oi=ti(Ht,A,I,Qt,P),$i=this.collisionIndex.placeCollisionBox(x,Be,ne,he,be,K,H,Et,we.predicate,_t,oi);if((!Lt||this.collisionIndex.placeCollisionBox(Lt,Be,ne,he,be,K,H,Ct,we.predicate,_t,oi).placeable)&&$i.placeable){let An;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ye.crossTileID]&&this.prevPlacement.placements[Ye.crossTileID]&&this.prevPlacement.placements[Ye.crossTileID].text&&(An=this.prevPlacement.variableOffsets[Ye.crossTileID].anchor),Ye.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Ye.crossTileID]={textOffset:Qt,width:A,height:I,anchor:Ht,textBoxScale:P,prevAnchor:An},this.markUsedJustification(st,Ht,Ye,vt),st.allowVerticalPlacement&&(this.markUsedOrientation(st,vt,Ye),this.placedOrientations[Ye.crossTileID]=vt),{shift:oi,placedGlyphBoxes:$i}}}placeLayerBucketPart(o,x,A){const{bucket:I,layout:P,translationText:H,translationIcon:K,posMatrix:ne,unwrappedTileID:he,textLabelPlaneMatrix:be,labelToScreenMatrix:we,textPixelRatio:Be,holdingForFade:Ye,collisionBoxArray:st,partiallyEvaluatedTextSize:vt,collisionGroup:Et}=o.parameters,Ct=P.get("text-optional"),Lt=P.get("icon-optional"),_t=n.ar(P,"text-overlap","text-allow-overlap"),Ht=_t==="always",Qt=n.ar(P,"icon-overlap","icon-allow-overlap"),oi=Qt==="always",$i=P.get("text-rotation-alignment")==="map",An=P.get("text-pitch-alignment")==="map",Mn=P.get("icon-text-fit")!=="none",Zn=P.get("symbol-z-order")==="viewport-y",Ln=Ht&&(oi||!I.hasIconData()||Lt),zn=oi&&(Ht||!I.hasTextData()||Ct);!I.collisionArrays&&st&&I.deserializeCollisionBoxes(st);const ir=this._getTerrainElevationFunc(this.retainedQueryData[I.bucketInstanceId].tileID),$r=(On,qn,Yr)=>{var Qa,Ma;if(x[On.crossTileID])return;if(Ye)return void(this.placements[On.crossTileID]=new rt(!1,!1,!1));let Za=!1,Ls=!1,ol=!0,mc=null,ks={box:null,placeable:!1,offscreen:null},Lo={placeable:!1},Os=null,Ms=null,Co=null,_c=0,Nl=0,Jc=0;qn.textFeatureIndex?_c=qn.textFeatureIndex:On.useRuntimeCollisionCircles&&(_c=On.featureIndex),qn.verticalTextFeatureIndex&&(Nl=qn.verticalTextFeatureIndex);const hl=qn.textBox;if(hl){const di=mn=>{let _o=n.ah.horizontal;if(I.allowVerticalPlacement&&!mn&&this.prevPlacement){const bl=this.prevPlacement.placedOrientations[On.crossTileID];bl&&(this.placedOrientations[On.crossTileID]=bl,_o=bl,this.markUsedOrientation(I,_o,On))}return _o},Oa=(mn,_o)=>{if(I.allowVerticalPlacement&&On.numVerticalGlyphVertices>0&&qn.verticalTextBox){for(const bl of I.writingModes)if(bl===n.ah.vertical?(ks=_o(),Lo=ks):ks=mn(),ks&&ks.placeable)break}else ks=mn()},fs=On.textAnchorOffsetStartIndex,Yo=On.textAnchorOffsetEndIndex;if(Yo===fs){const mn=(_o,bl)=>{const Ba=this.collisionIndex.placeCollisionBox(_o,_t,Be,ne,he,An,$i,H,Et.predicate,ir);return Ba&&Ba.placeable&&(this.markUsedOrientation(I,bl,On),this.placedOrientations[On.crossTileID]=bl),Ba};Oa((()=>mn(hl,n.ah.horizontal)),(()=>{const _o=qn.verticalTextBox;return I.allowVerticalPlacement&&On.numVerticalGlyphVertices>0&&_o?mn(_o,n.ah.vertical):{box:null,offscreen:null}})),di(ks&&ks.placeable)}else{let mn=n.aq[(Ma=(Qa=this.prevPlacement)===null||Qa===void 0?void 0:Qa.variableOffsets[On.crossTileID])===null||Ma===void 0?void 0:Ma.anchor];const _o=(Ba,gc,jh)=>{const $s=Ba.x2-Ba.x1,af=Ba.y2-Ba.y1,Gu=On.textBoxScale,Dp=Mn&&Qt==="never"?gc:null;let qo=null,np=_t==="never"?1:2,Ko="never";mn&&np++;for(let yc=0;yc<np;yc++){for(let dh=fs;dh<Yo;dh++){const Jo=I.textAnchorOffsets.get(dh);if(mn&&Jo.textAnchor!==mn)continue;const Qs=this.attemptAnchorPlacement(Jo,Ba,$s,af,Gu,$i,An,Be,ne,he,Et,Ko,On,I,jh,H,K,Dp,ir);if(Qs&&(qo=Qs.placedGlyphBoxes,qo&&qo.placeable))return Za=!0,mc=Qs.shift,qo}mn?mn=null:Ko=_t}return A&&!qo&&(qo={box:this.collisionIndex.placeCollisionBox(hl,"always",Be,ne,he,An,$i,H,Et.predicate,ir,new n.P(0,0)).box,offscreen:!1,placeable:!1}),qo};Oa((()=>_o(hl,qn.iconBox,n.ah.horizontal)),(()=>{const Ba=qn.verticalTextBox;return I.allowVerticalPlacement&&(!ks||!ks.placeable)&&On.numVerticalGlyphVertices>0&&Ba?_o(Ba,qn.verticalIconBox,n.ah.vertical):{box:null,occluded:!0,offscreen:null}})),ks&&(Za=ks.placeable,ol=ks.offscreen);const bl=di(ks&&ks.placeable);if(!Za&&this.prevPlacement){const Ba=this.prevPlacement.variableOffsets[On.crossTileID];Ba&&(this.variableOffsets[On.crossTileID]=Ba,this.markUsedJustification(I,Ba.anchor,On,bl))}}}if(Os=ks,Za=Os&&Os.placeable,ol=Os&&Os.offscreen,On.useRuntimeCollisionCircles){const di=I.text.placedSymbolArray.get(On.centerJustifiedTextSymbolIndex),Oa=n.ai(I.textSizeData,vt,di),fs=P.get("text-padding");Ms=this.collisionIndex.placeCollisionCircles(_t,di,I.lineVertexArray,I.glyphOffsetArray,Oa,ne,he,be,we,A,An,Et.predicate,On.collisionCircleDiameter,fs,H,ir),Ms.circles.length&&Ms.collisionDetected&&!A&&n.w("Collisions detected, but collision boxes are not shown"),Za=Ht||Ms.circles.length>0&&!Ms.collisionDetected,ol=ol&&Ms.offscreen}if(qn.iconFeatureIndex&&(Jc=qn.iconFeatureIndex),qn.iconBox){const di=Oa=>this.collisionIndex.placeCollisionBox(Oa,Qt,Be,ne,he,An,$i,K,Et.predicate,ir,Mn&&mc?mc:void 0);Lo&&Lo.placeable&&qn.verticalIconBox?(Co=di(qn.verticalIconBox),Ls=Co.placeable):(Co=di(qn.iconBox),Ls=Co.placeable),ol=ol&&Co.offscreen}const Cs=Ct||On.numHorizontalGlyphVertices===0&&On.numVerticalGlyphVertices===0,bu=Lt||On.numIconVertices===0;Cs||bu?bu?Cs||(Ls=Ls&&Za):Za=Ls&&Za:Ls=Za=Ls&&Za;const Vl=Ls&&Co.placeable;if(Za&&Os.placeable&&this.collisionIndex.insertCollisionBox(Os.box,_t,P.get("text-ignore-placement"),I.bucketInstanceId,Lo&&Lo.placeable&&Nl?Nl:_c,Et.ID),Vl&&this.collisionIndex.insertCollisionBox(Co.box,Qt,P.get("icon-ignore-placement"),I.bucketInstanceId,Jc,Et.ID),Ms&&Za&&this.collisionIndex.insertCollisionCircles(Ms.circles,_t,P.get("text-ignore-placement"),I.bucketInstanceId,_c,Et.ID),A&&this.storeCollisionData(I.bucketInstanceId,Yr,qn,Os,Co,Ms),On.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(I.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[On.crossTileID]=new rt(Za||Ln,Ls||zn,ol||I.justReloaded),x[On.crossTileID]=!0};if(Zn){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const On=I.getSortedSymbolIndexes(this.transform.angle);for(let qn=On.length-1;qn>=0;--qn){const Yr=On[qn];$r(I.symbolInstances.get(Yr),I.collisionArrays[Yr],Yr)}}else for(let On=o.symbolInstanceStart;On<o.symbolInstanceEnd;On++)$r(I.symbolInstances.get(On),I.collisionArrays[On],On);if(A&&I.bucketInstanceId in this.collisionCircleArrays){const On=this.collisionCircleArrays[I.bucketInstanceId];n.as(On.invProjMatrix,ne),On.viewportMatrix=this.collisionIndex.getViewportMatrix()}I.justReloaded=!1}storeCollisionData(o,x,A,I,P,H){if(A.textBox||A.iconBox){let K,ne;this.collisionBoxArrays.has(o)?K=this.collisionBoxArrays.get(o):(K=new Map,this.collisionBoxArrays.set(o,K)),K.has(x)?ne=K.get(x):(ne={text:null,icon:null},K.set(x,ne)),A.textBox&&(ne.text=I.box),A.iconBox&&(ne.icon=P.box)}if(H){let K=this.collisionCircleArrays[o];K===void 0&&(K=this.collisionCircleArrays[o]=new wt);for(let ne=0;ne<H.circles.length;ne+=4)K.circles.push(H.circles[ne+0]),K.circles.push(H.circles[ne+1]),K.circles.push(H.circles[ne+2]),K.circles.push(H.collisionDetected?1:0)}}markUsedJustification(o,x,A,I){let P;P=I===n.ah.vertical?A.verticalPlacedTextSymbolIndex:{left:A.leftJustifiedTextSymbolIndex,center:A.centerJustifiedTextSymbolIndex,right:A.rightJustifiedTextSymbolIndex}[n.at(x)];const H=[A.leftJustifiedTextSymbolIndex,A.centerJustifiedTextSymbolIndex,A.rightJustifiedTextSymbolIndex,A.verticalPlacedTextSymbolIndex];for(const K of H)K>=0&&(o.text.placedSymbolArray.get(K).crossTileID=P>=0&&K!==P?0:A.crossTileID)}markUsedOrientation(o,x,A){const I=x===n.ah.horizontal||x===n.ah.horizontalOnly?x:0,P=x===n.ah.vertical?x:0,H=[A.leftJustifiedTextSymbolIndex,A.centerJustifiedTextSymbolIndex,A.rightJustifiedTextSymbolIndex];for(const K of H)o.text.placedSymbolArray.get(K).placedOrientation=I;A.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(A.verticalPlacedTextSymbolIndex).placedOrientation=P)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const x=this.prevPlacement;let A=!1;this.prevZoomAdjustment=x?x.zoomAdjustment(this.transform.zoom):0;const I=x?x.symbolFadeChange(o):1,P=x?x.opacities:{},H=x?x.variableOffsets:{},K=x?x.placedOrientations:{};for(const ne in this.placements){const he=this.placements[ne],be=P[ne];be?(this.opacities[ne]=new Xe(be,I,he.text,he.icon),A=A||he.text!==be.text.placed||he.icon!==be.icon.placed):(this.opacities[ne]=new Xe(null,I,he.text,he.icon,he.skipFade),A=A||he.text||he.icon)}for(const ne in P){const he=P[ne];if(!this.opacities[ne]){const be=new Xe(he,I,!1,!1);be.isHidden()||(this.opacities[ne]=be,A=A||he.text.placed||he.icon.placed)}}for(const ne in H)this.variableOffsets[ne]||!this.opacities[ne]||this.opacities[ne].isHidden()||(this.variableOffsets[ne]=H[ne]);for(const ne in K)this.placedOrientations[ne]||!this.opacities[ne]||this.opacities[ne].isHidden()||(this.placedOrientations[ne]=K[ne]);if(x&&x.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");A?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=x?x.lastPlacementChangeTime:o)}updateLayerOpacities(o,x){const A={};for(const I of x){const P=I.getBucket(o);P&&I.latestFeatureIndex&&o.id===P.layerIds[0]&&this.updateBucketOpacities(P,I.tileID,A,I.collisionBoxArray)}}updateBucketOpacities(o,x,A,I){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const P=o.layers[0],H=P.layout,K=new Xe(null,0,!1,!1,!0),ne=H.get("text-allow-overlap"),he=H.get("icon-allow-overlap"),be=P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"),we=H.get("text-rotation-alignment")==="map",Be=H.get("text-pitch-alignment")==="map",Ye=H.get("icon-text-fit")!=="none",st=new Xe(null,0,ne&&(he||!o.hasIconData()||H.get("icon-optional")),he&&(ne||!o.hasTextData()||H.get("text-optional")),!0);!o.collisionArrays&&I&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(I);const vt=(Ct,Lt,_t)=>{for(let Ht=0;Ht<Lt/4;Ht++)Ct.opacityVertexArray.emplaceBack(_t);Ct.hasVisibleVertices=Ct.hasVisibleVertices||_t!==ss},Et=this.collisionBoxArrays.get(o.bucketInstanceId);for(let Ct=0;Ct<o.symbolInstances.length;Ct++){const Lt=o.symbolInstances.get(Ct),{numHorizontalGlyphVertices:_t,numVerticalGlyphVertices:Ht,crossTileID:Qt}=Lt;let oi=this.opacities[Qt];A[Qt]?oi=K:oi||(oi=st,this.opacities[Qt]=oi),A[Qt]=!0;const $i=Lt.numIconVertices>0,An=this.placedOrientations[Lt.crossTileID],Mn=An===n.ah.vertical,Zn=An===n.ah.horizontal||An===n.ah.horizontalOnly;if(_t>0||Ht>0){const zn=Ja(oi.text);vt(o.text,_t,Mn?ss:zn),vt(o.text,Ht,Zn?ss:zn);const ir=oi.text.isHidden();[Lt.rightJustifiedTextSymbolIndex,Lt.centerJustifiedTextSymbolIndex,Lt.leftJustifiedTextSymbolIndex].forEach((qn=>{qn>=0&&(o.text.placedSymbolArray.get(qn).hidden=ir||Mn?1:0)})),Lt.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Lt.verticalPlacedTextSymbolIndex).hidden=ir||Zn?1:0);const $r=this.variableOffsets[Lt.crossTileID];$r&&this.markUsedJustification(o,$r.anchor,Lt,An);const On=this.placedOrientations[Lt.crossTileID];On&&(this.markUsedJustification(o,"left",Lt,On),this.markUsedOrientation(o,On,Lt))}if($i){const zn=Ja(oi.icon),ir=!(Ye&&Lt.verticalPlacedIconSymbolIndex&&Mn);Lt.placedIconSymbolIndex>=0&&(vt(o.icon,Lt.numIconVertices,ir?zn:ss),o.icon.placedSymbolArray.get(Lt.placedIconSymbolIndex).hidden=oi.icon.isHidden()),Lt.verticalPlacedIconSymbolIndex>=0&&(vt(o.icon,Lt.numVerticalIconVertices,ir?ss:zn),o.icon.placedSymbolArray.get(Lt.verticalPlacedIconSymbolIndex).hidden=oi.icon.isHidden())}const Ln=Et&&Et.has(Ct)?Et.get(Ct):{text:null,icon:null};if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const zn=o.collisionArrays[Ct];if(zn){let ir=new n.P(0,0);if(zn.textBox||zn.verticalTextBox){let $r=!0;if(be){const On=this.variableOffsets[Qt];On?(ir=ti(On.anchor,On.width,On.height,On.textOffset,On.textBoxScale),we&&ir._rotate(Be?this.transform.angle:-this.transform.angle)):$r=!1}if(zn.textBox||zn.verticalTextBox){let On;zn.textBox&&(On=Mn),zn.verticalTextBox&&(On=Zn),Yi(o.textCollisionBox.collisionVertexArray,oi.text.placed,!$r||On,Ln.text,ir.x,ir.y)}}if(zn.iconBox||zn.verticalIconBox){const $r=!!(!Zn&&zn.verticalIconBox);let On;zn.iconBox&&(On=$r),zn.verticalIconBox&&(On=!$r),Yi(o.iconCollisionBox.collisionVertexArray,oi.icon.placed,On,Ln.icon,Ye?ir.x:0,Ye?ir.y:0)}}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const Ct=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Ct.invProjMatrix,o.placementViewportMatrix=Ct.viewportMatrix,o.collisionCircleArray=Ct.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,x){const A=this.zoomAtLastRecencyCheck===x?1-this.zoomAdjustment(x):1;return this.zoomAtLastRecencyCheck=x,this.commitTime+this.fadeDuration*A>o}setStale(){this.stale=!0}}function Yi(L,o,x,A,I,P){A&&A.length!==0||(A=[0,0,0,0]);const H=A[0]-te,K=A[1]-te,ne=A[2]-te,he=A[3]-te;L.emplaceBack(o?1:0,x?1:0,I||0,P||0,H,K),L.emplaceBack(o?1:0,x?1:0,I||0,P||0,ne,K),L.emplaceBack(o?1:0,x?1:0,I||0,P||0,ne,he),L.emplaceBack(o?1:0,x?1:0,I||0,P||0,H,he)}const Ki=Math.pow(2,25),Bi=Math.pow(2,24),dr=Math.pow(2,17),$n=Math.pow(2,16),Nn=Math.pow(2,9),Ur=Math.pow(2,8),La=Math.pow(2,1);function Ja(L){if(L.opacity===0&&!L.placed)return 0;if(L.opacity===1&&L.placed)return 4294967295;const o=L.placed?1:0,x=Math.floor(127*L.opacity);return x*Ki+o*Bi+x*dr+o*$n+x*Nn+o*Ur+x*La+o}const ss=0;function js(){return{isOccluded:(L,o,x)=>!1,getPitchedTextCorrection:(L,o,x)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(L,o,x,A){throw new Error("Not implemented.")},translatePosition:(L,o,x,A)=>(function(I,P,H,K,ne=!1){if(!H[0]&&!H[1])return[0,0];const he=ne?K==="map"?I.angle:0:K==="viewport"?-I.angle:0;if(he){const be=Math.sin(he),we=Math.cos(he);H=[H[0]*we-H[1]*be,H[0]*be+H[1]*we]}return[ne?H[0]:ze(P,H[0],I.zoom),ne?H[1]:ze(P,H[1],I.zoom)]})(L,o,x,A),getCircleRadiusCorrection:L=>1}}class ea{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,x,A,I,P){const H=this._bucketParts;for(;this._currentTileIndex<o.length;)if(x.getBucketParts(H,I,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,P())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,H.sort(((K,ne)=>K.sortKey-ne.sortKey)));this._currentPartIndex<H.length;)if(x.placeLayerBucketPart(H[this._currentPartIndex],this._seenCrossTileIDs,A),this._currentPartIndex++,P())return!0;return!1}}class jr{constructor(o,x,A,I,P,H,K,ne){this.placement=new qt(o,js(),x,H,K,ne),this._currentPlacementIndex=A.length-1,this._forceFullPlacement=I,this._showCollisionBoxes=P,this._done=!1}isDone(){return this._done}continuePlacement(o,x,A){const I=ut.now(),P=()=>!this._forceFullPlacement&&ut.now()-I>2;for(;this._currentPlacementIndex>=0;){const H=x[o[this._currentPlacementIndex]],K=this.placement.collisionIndex.transform.zoom;if(H.type==="symbol"&&(!H.minzoom||H.minzoom<=K)&&(!H.maxzoom||H.maxzoom>K)){if(this._inProgressLayer||(this._inProgressLayer=new ea(H)),this._inProgressLayer.continuePlacement(A[H.source],this.placement,this._showCollisionBoxes,H,P))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const da=512/n.X/2;class lr{constructor(o,x,A){this.tileID=o,this.bucketInstanceId=A,this._symbolsByKey={};const I=new Map;for(let P=0;P<x.length;P++){const H=x.get(P),K=H.key,ne=I.get(K);ne?ne.push(H):I.set(K,[H])}for(const[P,H]of I){const K={positions:H.map((ne=>({x:Math.floor(ne.anchorX*da),y:Math.floor(ne.anchorY*da)}))),crossTileIDs:H.map((ne=>ne.crossTileID))};if(K.positions.length>128){const ne=new n.av(K.positions.length,16,Uint16Array);for(const{x:he,y:be}of K.positions)ne.add(he,be);ne.finish(),delete K.positions,K.index=ne}this._symbolsByKey[P]=K}}getScaledCoordinates(o,x){const{x:A,y:I,z:P}=this.tileID.canonical,{x:H,y:K,z:ne}=x.canonical,he=da/Math.pow(2,ne-P),be=(K*n.X+o.anchorY)*he,we=I*n.X*da;return{x:Math.floor((H*n.X+o.anchorX)*he-A*n.X*da),y:Math.floor(be-we)}}findMatches(o,x,A){const I=this.tileID.canonical.z<x.canonical.z?1:Math.pow(2,this.tileID.canonical.z-x.canonical.z);for(let P=0;P<o.length;P++){const H=o.get(P);if(H.crossTileID)continue;const K=this._symbolsByKey[H.key];if(!K)continue;const ne=this.getScaledCoordinates(H,x);if(K.index){const he=K.index.range(ne.x-I,ne.y-I,ne.x+I,ne.y+I).sort();for(const be of he){const we=K.crossTileIDs[be];if(!A[we]){A[we]=!0,H.crossTileID=we;break}}}else if(K.positions)for(let he=0;he<K.positions.length;he++){const be=K.positions[he],we=K.crossTileIDs[he];if(Math.abs(be.x-ne.x)<=I&&Math.abs(be.y-ne.y)<=I&&!A[we]){A[we]=!0,H.crossTileID=we;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map((({crossTileIDs:o})=>o))}}class Rr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class $a{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const x=Math.round((o-this.lng)/360);if(x!==0)for(const A in this.indexes){const I=this.indexes[A],P={};for(const H in I){const K=I[H];K.tileID=K.tileID.unwrapTo(K.tileID.wrap+x),P[K.tileID.key]=K}this.indexes[A]=P}this.lng=o}addBucket(o,x,A){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===x.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let P=0;P<x.symbolInstances.length;P++)x.symbolInstances.get(P).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const I=this.usedCrossTileIDs[o.overscaledZ];for(const P in this.indexes){const H=this.indexes[P];if(Number(P)>o.overscaledZ)for(const K in H){const ne=H[K];ne.tileID.isChildOf(o)&&ne.findMatches(x.symbolInstances,o,I)}else{const K=H[o.scaledTo(Number(P)).key];K&&K.findMatches(x.symbolInstances,o,I)}}for(let P=0;P<x.symbolInstances.length;P++){const H=x.symbolInstances.get(P);H.crossTileID||(H.crossTileID=A.generate(),I[H.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new lr(o,x.symbolInstances,x.bucketInstanceId),!0}removeBucketCrossTileIDs(o,x){for(const A of x.getCrossTileIDsLists())for(const I of A)delete this.usedCrossTileIDs[o][I]}removeStaleBuckets(o){let x=!1;for(const A in this.indexes){const I=this.indexes[A];for(const P in I)o[I[P].bucketInstanceId]||(this.removeBucketCrossTileIDs(A,I[P]),delete I[P],x=!0)}return x}}class Ro{constructor(){this.layerIndexes={},this.crossTileIDs=new Rr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,x,A){let I=this.layerIndexes[o.id];I===void 0&&(I=this.layerIndexes[o.id]=new $a);let P=!1;const H={};I.handleWrapJump(A);for(const K of x){const ne=K.getBucket(o);ne&&o.id===ne.layerIds[0]&&(ne.bucketInstanceId||(ne.bucketInstanceId=++this.maxBucketInstanceId),I.addBucket(K.tileID,ne,this.crossTileIDs)&&(P=!0),H[ne.bucketInstanceId]=!0)}return I.removeStaleBuckets(H)&&(P=!0),P}pruneUnusedLayers(o){const x={};o.forEach((A=>{x[A]=!0}));for(const A in this.layerIndexes)x[A]||delete this.layerIndexes[A]}}const Ys=(L,o)=>n.t(L,o&&o.filter((x=>x.identifier!=="source.canvas"))),_l=n.aw();class nh extends n.E{constructor(o,x={}){super(),this._rtlPluginLoaded=()=>{for(const A in this.sourceCaches){const I=this.sourceCaches[A].getSource().type;I!=="vector"&&I!=="geojson"||this.sourceCaches[A].reload()}},this.map=o,this.dispatcher=new Cr(Cn(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",((A,I)=>this.getGlyphs(A,I))),this.dispatcher.registerMessageHandler("GI",((A,I)=>this.getImages(A,I))),this.imageManager=new an,this.imageManager.setEventedParent(this),this.glyphManager=new Si(o._requestManager,x.localIdeographFontFamily),this.lineAtlas=new ai(256,512),this.crossTileSymbolIndex=new Ro,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new n.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",n.ay()),Do().on(cn,this._rtlPluginLoaded),this.on("data",(A=>{if(A.dataType!=="source"||A.sourceDataType!=="metadata")return;const I=this.sourceCaches[A.sourceId];if(!I)return;const P=I.getSource();if(P&&P.vectorLayerIds)for(const H in this._layers){const K=this._layers[H];K.source===P.id&&this._validateLayer(K)}}))}loadURL(o,x={},A){this.fire(new n.k("dataloading",{dataType:"style"})),x.validate=typeof x.validate!="boolean"||x.validate;const I=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController;const P=this._loadStyleRequest;n.h(I,this._loadStyleRequest).then((H=>{this._loadStyleRequest=null,this._load(H.data,x,A)})).catch((H=>{this._loadStyleRequest=null,H&&!P.signal.aborted&&this.fire(new n.j(H))}))}loadJSON(o,x={},A){this.fire(new n.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,ut.frameAsync(this._frameRequest).then((()=>{this._frameRequest=null,x.validate=x.validate!==!1,this._load(o,x,A)})).catch((()=>{}))}loadEmpty(){this.fire(new n.k("dataloading",{dataType:"style"})),this._load(_l,{validate:!1})}_load(o,x,A){var I;const P=x.transformStyle?x.transformStyle(A,o):o;if(!x.validate||!Ys(this,n.u(P))){this._loaded=!0,this.stylesheet=P;for(const H in P.sources)this.addSource(H,P.sources[H],{validate:!1});P.sprite?this._loadSprite(P.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(P.glyphs),this._createLayers(),this.light=new wr(this.stylesheet.light),this.sky=new jt(this.stylesheet.sky),this.map.setTerrain((I=this.stylesheet.terrain)!==null&&I!==void 0?I:null),this.fire(new n.k("data",{dataType:"style"})),this.fire(new n.k("style.load"))}}_createLayers(){const o=n.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map((x=>x.id)),this._layers={},this._serializedLayers=null;for(const x of o){const A=n.aA(x);A.setEventedParent(this,{layer:{id:x.id}}),this._layers[x.id]=A}}_loadSprite(o,x=!1,A=void 0){let I;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,(function(P,H,K,ne){return n._(this,void 0,void 0,(function*(){const he=Vt(P),be=K>1?"@2x":"",we={},Be={};for(const{id:Ye,url:st}of he){const vt=H.transformRequest(Hi(st,be,".json"),"SpriteJSON");we[Ye]=n.h(vt,ne);const Et=H.transformRequest(Hi(st,be,".png"),"SpriteImage");Be[Ye]=Ji.getImage(Et,ne)}return yield Promise.all([...Object.values(we),...Object.values(Be)]),(function(Ye,st){return n._(this,void 0,void 0,(function*(){const vt={};for(const Et in Ye){vt[Et]={};const Ct=ut.getImageCanvasContext((yield st[Et]).data),Lt=(yield Ye[Et]).data;for(const _t in Lt){const{width:Ht,height:Qt,x:oi,y:$i,sdf:An,pixelRatio:Mn,stretchX:Zn,stretchY:Ln,content:zn,textFitWidth:ir,textFitHeight:$r}=Lt[_t];vt[Et][_t]={data:null,pixelRatio:Mn,sdf:An,stretchX:Zn,stretchY:Ln,content:zn,textFitWidth:ir,textFitHeight:$r,spriteData:{width:Ht,height:Qt,x:oi,y:$i,context:Ct}}}}return vt}))})(we,Be)}))})(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then((P=>{if(this._spriteRequest=null,P)for(const H in P){this._spritesImagesIds[H]=[];const K=this._spritesImagesIds[H]?this._spritesImagesIds[H].filter((ne=>!(ne in P))):[];for(const ne of K)this.imageManager.removeImage(ne),this._changedImages[ne]=!0;for(const ne in P[H]){const he=H==="default"?ne:`${H}:${ne}`;this._spritesImagesIds[H].push(he),he in this.imageManager.images?this.imageManager.updateImage(he,P[H][ne],!1):this.imageManager.addImage(he,P[H][ne]),x&&(this._changedImages[he]=!0)}}})).catch((P=>{this._spriteRequest=null,I=P,this.fire(new n.j(I))})).finally((()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),x&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new n.k("data",{dataType:"style"})),A&&A(I)}))}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new n.k("data",{dataType:"style"}))}_validateLayer(o){const x=this.sourceCaches[o.source];if(!x)return;const A=o.sourceLayer;if(!A)return;const I=x.getSource();(I.type==="geojson"||I.vectorLayerIds&&I.vectorLayerIds.indexOf(A)===-1)&&this.fire(new n.j(new Error(`Source layer "${A}" does not exist on source "${I.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o,x=!1){const A=this._serializedAllLayers();if(!o||o.length===0)return Object.values(x?n.aB(A):A);const I=[];for(const P of o)if(A[P]){const H=x?n.aB(A[P]):A[P];I.push(H)}return I}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const x=Object.keys(this._layers);for(const A of x){const I=this._layers[A];I.type!=="custom"&&(o[A]=I.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const x=this._changed;if(x){const I=Object.keys(this._updatedLayers),P=Object.keys(this._removedLayers);(I.length||P.length)&&this._updateWorkerLayers(I,P);for(const H in this._updatedSources){const K=this._updatedSources[H];if(K==="reload")this._reloadSource(H);else{if(K!=="clear")throw new Error(`Invalid action ${K}`);this._clearSource(H)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const H in this._updatedPaintProps)this._layers[H].updateTransitions(o);this.light.updateTransitions(o),this.sky.updateTransitions(o),this._resetUpdates()}const A={};for(const I in this.sourceCaches){const P=this.sourceCaches[I];A[I]=P.used,P.used=!1}for(const I of this._order){const P=this._layers[I];P.recalculate(o,this._availableImages),!P.isHidden(o.zoom)&&P.source&&(this.sourceCaches[P.source].used=!0)}for(const I in A){const P=this.sourceCaches[I];!!A[I]!=!!P.used&&P.fire(new n.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:I}))}this.light.recalculate(o),this.sky.recalculate(o),this.z=o.zoom,x&&this.fire(new n.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const x in this.sourceCaches)this.sourceCaches[x].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,x){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o,!1),removedIds:x})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,x={}){var A;this._checkLoaded();const I=this.serialize();if(o=x.transformStyle?x.transformStyle(I,o):o,((A=x.validate)===null||A===void 0||A)&&Ys(this,n.u(o)))return!1;(o=n.aB(o)).layers=n.az(o.layers);const P=n.aC(I,o),H=this._getOperationsToPerform(P);if(H.unimplemented.length>0)throw new Error(`Unimplemented: ${H.unimplemented.join(", ")}.`);if(H.operations.length===0)return!1;for(const K of H.operations)K();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const x=[],A=[];for(const I of o)switch(I.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":x.push((()=>this.addLayer.apply(this,I.args)));break;case"removeLayer":x.push((()=>this.removeLayer.apply(this,I.args)));break;case"setPaintProperty":x.push((()=>this.setPaintProperty.apply(this,I.args)));break;case"setLayoutProperty":x.push((()=>this.setLayoutProperty.apply(this,I.args)));break;case"setFilter":x.push((()=>this.setFilter.apply(this,I.args)));break;case"addSource":x.push((()=>this.addSource.apply(this,I.args)));break;case"removeSource":x.push((()=>this.removeSource.apply(this,I.args)));break;case"setLayerZoomRange":x.push((()=>this.setLayerZoomRange.apply(this,I.args)));break;case"setLight":x.push((()=>this.setLight.apply(this,I.args)));break;case"setGeoJSONSourceData":x.push((()=>this.setGeoJSONSourceData.apply(this,I.args)));break;case"setGlyphs":x.push((()=>this.setGlyphs.apply(this,I.args)));break;case"setSprite":x.push((()=>this.setSprite.apply(this,I.args)));break;case"setSky":x.push((()=>this.setSky.apply(this,I.args)));break;case"setTerrain":x.push((()=>this.map.setTerrain.apply(this,I.args)));break;case"setTransition":x.push((()=>{}));break;default:A.push(I.command)}return{operations:x,unimplemented:A}}addImage(o,x){if(this.getImage(o))return this.fire(new n.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,x),this._afterImageUpdated(o)}updateImage(o,x){this.imageManager.updateImage(o,x)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new n.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new n.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,x,A={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!x.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(x).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(x.type)>=0&&this._validate(n.u.source,`sources.${o}`,x,null,A))return;this.map&&this.map._collectResourceTiming&&(x.collectResourceTiming=!0);const I=this.sourceCaches[o]=new ar(o,x,this.dispatcher);I.style=this,I.setEventedParent(this,(()=>({isSourceLoaded:I.loaded(),source:I.serialize(),sourceId:o}))),I.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const A in this._layers)if(this._layers[A].source===o)return this.fire(new n.j(new Error(`Source "${o}" cannot be removed while layer "${A}" is using it.`)));const x=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],x.fire(new n.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),x.setEventedParent(null),x.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,x){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const A=this.sourceCaches[o].getSource();if(A.type!=="geojson")throw new Error(`geojsonSource.type is ${A.type}, which is !== 'geojson`);A.setData(x),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,x,A={}){this._checkLoaded();const I=o.id;if(this.getLayer(I))return void this.fire(new n.j(new Error(`Layer "${I}" already exists on this map.`)));let P;if(o.type==="custom"){if(Ys(this,n.aD(o)))return;P=n.aA(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(I,o.source),o=n.aB(o),o=n.e(o,{source:I})),this._validate(n.u.layer,`layers.${I}`,o,{arrayIndex:-1},A))return;P=n.aA(o),this._validateLayer(P),P.setEventedParent(this,{layer:{id:I}})}const H=x?this._order.indexOf(x):this._order.length;if(x&&H===-1)this.fire(new n.j(new Error(`Cannot add layer "${I}" before non-existing layer "${x}".`)));else{if(this._order.splice(H,0,I),this._layerOrderChanged=!0,this._layers[I]=P,this._removedLayers[I]&&P.source&&P.type!=="custom"){const K=this._removedLayers[I];delete this._removedLayers[I],K.type!==P.type?this._updatedSources[P.source]="clear":(this._updatedSources[P.source]="reload",this.sourceCaches[P.source].pause())}this._updateLayer(P),P.onAdd&&P.onAdd(this.map)}}moveLayer(o,x){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new n.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===x)return;const A=this._order.indexOf(o);this._order.splice(A,1);const I=x?this._order.indexOf(x):this._order.length;x&&I===-1?this.fire(new n.j(new Error(`Cannot move layer "${o}" before non-existing layer "${x}".`))):(this._order.splice(I,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const x=this._layers[o];if(!x)return void this.fire(new n.j(new Error(`Cannot remove non-existing layer "${o}".`)));x.setEventedParent(null);const A=this._order.indexOf(o);this._order.splice(A,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=x,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],x.onRemove&&x.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,x,A){this._checkLoaded();const I=this.getLayer(o);I?I.minzoom===x&&I.maxzoom===A||(x!=null&&(I.minzoom=x),A!=null&&(I.maxzoom=A),this._updateLayer(I)):this.fire(new n.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,x,A={}){this._checkLoaded();const I=this.getLayer(o);if(I){if(!n.aE(I.filter,x))return x==null?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(n.u.filter,`layers.${I.id}.filter`,x,null,A)||(I.filter=n.aB(x),this._updateLayer(I)))}else this.fire(new n.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return n.aB(this.getLayer(o).filter)}setLayoutProperty(o,x,A,I={}){this._checkLoaded();const P=this.getLayer(o);P?n.aE(P.getLayoutProperty(x),A)||(P.setLayoutProperty(x,A,I),this._updateLayer(P)):this.fire(new n.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,x){const A=this.getLayer(o);if(A)return A.getLayoutProperty(x);this.fire(new n.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,x,A,I={}){this._checkLoaded();const P=this.getLayer(o);P?n.aE(P.getPaintProperty(x),A)||(P.setPaintProperty(x,A,I)&&this._updateLayer(P),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new n.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,x){return this.getLayer(o).getPaintProperty(x)}setFeatureState(o,x){this._checkLoaded();const A=o.source,I=o.sourceLayer,P=this.sourceCaches[A];if(P===void 0)return void this.fire(new n.j(new Error(`The source '${A}' does not exist in the map's style.`)));const H=P.getSource().type;H==="geojson"&&I?this.fire(new n.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):H!=="vector"||I?(o.id===void 0&&this.fire(new n.j(new Error("The feature id parameter must be provided."))),P.setFeatureState(I,o.id,x)):this.fire(new n.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,x){this._checkLoaded();const A=o.source,I=this.sourceCaches[A];if(I===void 0)return void this.fire(new n.j(new Error(`The source '${A}' does not exist in the map's style.`)));const P=I.getSource().type,H=P==="vector"?o.sourceLayer:void 0;P!=="vector"||H?x&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new n.j(new Error("A feature id is required to remove its specific state property."))):I.removeFeatureState(H,o.id,x):this.fire(new n.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const x=o.source,A=o.sourceLayer,I=this.sourceCaches[x];if(I!==void 0)return I.getSource().type!=="vector"||A?(o.id===void 0&&this.fire(new n.j(new Error("The feature id parameter must be provided."))),I.getFeatureState(A,o.id)):void this.fire(new n.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new n.j(new Error(`The source '${x}' does not exist in the map's style.`)))}getTransition(){return n.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=n.aF(this.sourceCaches,(P=>P.serialize())),x=this._serializeByIds(this._order,!0),A=this.map.getTerrain()||void 0,I=this.stylesheet;return n.aG({version:I.version,name:I.name,metadata:I.metadata,light:I.light,sky:I.sky,center:I.center,zoom:I.zoom,bearing:I.bearing,pitch:I.pitch,sprite:I.sprite,glyphs:I.glyphs,transition:I.transition,sources:o,layers:x,terrain:A},(P=>P!==void 0))}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const x=H=>this._layers[H].type==="fill-extrusion",A={},I=[];for(let H=this._order.length-1;H>=0;H--){const K=this._order[H];if(x(K)){A[K]=H;for(const ne of o){const he=ne[K];if(he)for(const be of he)I.push(be)}}}I.sort(((H,K)=>K.intersectionZ-H.intersectionZ));const P=[];for(let H=this._order.length-1;H>=0;H--){const K=this._order[H];if(x(K))for(let ne=I.length-1;ne>=0;ne--){const he=I[ne].feature;if(A[he.layer.id]<H)break;P.push(he),I.pop()}else for(const ne of o){const he=ne[K];if(he)for(const be of he)P.push(be.feature)}}return P}queryRenderedFeatures(o,x,A){x&&x.filter&&this._validate(n.u.filter,"queryRenderedFeatures.filter",x.filter,null,x);const I={};if(x&&x.layers){if(!Array.isArray(x.layers))return this.fire(new n.j(new Error("parameters.layers must be an Array."))),[];for(const K of x.layers){const ne=this._layers[K];if(!ne)return this.fire(new n.j(new Error(`The layer '${K}' does not exist in the map's style and cannot be queried for features.`))),[];I[ne.source]=!0}}const P=[];x.availableImages=this._availableImages;const H=this._serializedAllLayers();for(const K in this.sourceCaches)x.layers&&!I[K]||P.push(ra(this.sourceCaches[K],this._layers,H,o,x,A));return this.placement&&P.push((function(K,ne,he,be,we,Be,Ye){const st={},vt=Be.queryRenderedSymbols(be),Et=[];for(const Ct of Object.keys(vt).map(Number))Et.push(Ye[Ct]);Et.sort(Aa);for(const Ct of Et){const Lt=Ct.featureIndex.lookupSymbolFeatures(vt[Ct.bucketInstanceId],ne,Ct.bucketIndex,Ct.sourceLayerIndex,we.filter,we.layers,we.availableImages,K);for(const _t in Lt){const Ht=st[_t]=st[_t]||[],Qt=Lt[_t];Qt.sort(((oi,$i)=>{const An=Ct.featureSortOrder;if(An){const Mn=An.indexOf(oi.featureIndex);return An.indexOf($i.featureIndex)-Mn}return $i.featureIndex-oi.featureIndex}));for(const oi of Qt)Ht.push(oi)}}for(const Ct in st)st[Ct].forEach((Lt=>{const _t=Lt.feature,Ht=he[K[Ct].source].getFeatureState(_t.layer["source-layer"],_t.id);_t.source=_t.layer.source,_t.layer["source-layer"]&&(_t.sourceLayer=_t.layer["source-layer"]),_t.state=Ht}));return st})(this._layers,H,this.sourceCaches,o,x,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(P)}querySourceFeatures(o,x){x&&x.filter&&this._validate(n.u.filter,"querySourceFeatures.filter",x.filter,null,x);const A=this.sourceCaches[o];return A?(function(I,P){const H=I.getRenderableIds().map((he=>I.getTileByID(he))),K=[],ne={};for(let he=0;he<H.length;he++){const be=H[he],we=be.tileID.canonical.key;ne[we]||(ne[we]=!0,be.querySourceFeatures(K,P))}return K})(A,x):[]}getLight(){return this.light.getLight()}setLight(o,x={}){this._checkLoaded();const A=this.light.getLight();let I=!1;for(const H in o)if(!n.aE(o[H],A[H])){I=!0;break}if(!I)return;const P={now:ut.now(),transition:n.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,x),this.light.updateTransitions(P)}getSky(){var o;return(o=this.stylesheet)===null||o===void 0?void 0:o.sky}setSky(o,x={}){const A=this.getSky();let I=!1;if(!o&&!A)return;if(o&&!A)I=!0;else if(!o&&A)I=!0;else for(const H in o)if(!n.aE(o[H],A[H])){I=!0;break}if(!I)return;const P={now:ut.now(),transition:n.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=o,this.sky.setSky(o,x),this.sky.updateTransitions(P)}_validate(o,x,A,I,P={}){return(!P||P.validate!==!1)&&Ys(this,o.call(n.u,n.e({key:x,style:this.serialize(),value:A,styleSpec:n.v},I)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Do().off(cn,this._rtlPluginLoaded);for(const x in this._layers)this._layers[x].setEventedParent(null);for(const x in this.sourceCaches){const A=this.sourceCaches[x];A.setEventedParent(null),A.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const x in this.sourceCaches)this.sourceCaches[x].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,x,A,I,P=!1){let H=!1,K=!1;const ne={};for(const he of this._order){const be=this._layers[he];if(be.type!=="symbol")continue;if(!ne[be.source]){const Be=this.sourceCaches[be.source];ne[be.source]=Be.getRenderableIds(!0).map((Ye=>Be.getTileByID(Ye))).sort(((Ye,st)=>st.tileID.overscaledZ-Ye.tileID.overscaledZ||(Ye.tileID.isLessThan(st.tileID)?-1:1)))}const we=this.crossTileSymbolIndex.addLayer(be,ne[be.source],o.center.lng);H=H||we}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((P=P||this._layerOrderChanged||A===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(ut.now(),o.zoom))&&(this.pauseablePlacement=new jr(o,this.map.terrain,this._order,P,x,A,I,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ne),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(ut.now()),K=!0),H&&this.pauseablePlacement.placement.setStale()),K||H)for(const he of this._order){const be=this._layers[he];be.type==="symbol"&&this.placement.updateLayerOpacities(be,ne[be.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(ut.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,x){return n._(this,void 0,void 0,(function*(){const A=yield this.imageManager.getImages(x.icons);this._updateTilesForChangedImages();const I=this.sourceCaches[x.source];return I&&I.setDependencies(x.tileID.key,x.type,x.icons),A}))}getGlyphs(o,x){return n._(this,void 0,void 0,(function*(){const A=yield this.glyphManager.getGlyphs(x.stacks),I=this.sourceCaches[x.source];return I&&I.setDependencies(x.tileID.key,x.type,[""]),A}))}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,x={}){this._checkLoaded(),o&&this._validate(n.u.glyphs,"glyphs",o,null,x)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,x,A={},I){this._checkLoaded();const P=[{id:o,url:x}],H=[...Vt(this.stylesheet.sprite),...P];this._validate(n.u.sprite,"sprite",H,null,A)||(this.stylesheet.sprite=H,this._loadSprite(P,!0,I))}removeSprite(o){this._checkLoaded();const x=Vt(this.stylesheet.sprite);if(x.find((A=>A.id===o))){if(this._spritesImagesIds[o])for(const A of this._spritesImagesIds[o])this.imageManager.removeImage(A),this._changedImages[A]=!0;x.splice(x.findIndex((A=>A.id===o)),1),this.stylesheet.sprite=x.length>0?x:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new n.k("data",{dataType:"style"}))}else this.fire(new n.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Vt(this.stylesheet.sprite)}setSprite(o,x={},A){this._checkLoaded(),o&&this._validate(n.u.sprite,"sprite",o,null,x)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,A):(this._unloadSprite(),A&&A(null)))}}var es=n.Y([{name:"a_pos",type:"Int16",components:2}]);const jo={prelude:_a(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:_a(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:_a(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:_a(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:_a("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:_a(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:_a(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:_a("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:_a("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:_a("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:_a(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:_a(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:_a(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:_a(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:_a(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:_a(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:_a(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:_a(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:_a(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:_a(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:_a(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:_a(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:_a(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:_a(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:_a(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:_a(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:_a("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:_a("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:_a("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:_a("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function _a(L,o){const x=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,A=o.match(/attribute ([\w]+) ([\w]+)/g),I=L.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),H=P?P.concat(I):I,K={};return{fragmentSource:L=L.replace(x,((ne,he,be,we,Be)=>(K[Be]=!0,he==="define"?`
#ifndef HAS_UNIFORM_u_${Be}
varying ${be} ${we} ${Be};
#else
uniform ${be} ${we} u_${Be};
#endif
`:`
#ifdef HAS_UNIFORM_u_${Be}
    ${be} ${we} ${Be} = u_${Be};
#endif
`))),vertexSource:o=o.replace(x,((ne,he,be,we,Be)=>{const Ye=we==="float"?"vec2":"vec4",st=Be.match(/color/)?"color":Ye;return K[Be]?he==="define"?`
#ifndef HAS_UNIFORM_u_${Be}
uniform lowp float u_${Be}_t;
attribute ${be} ${Ye} a_${Be};
varying ${be} ${we} ${Be};
#else
uniform ${be} ${we} u_${Be};
#endif
`:st==="vec4"?`
#ifndef HAS_UNIFORM_u_${Be}
    ${Be} = a_${Be};
#else
    ${be} ${we} ${Be} = u_${Be};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Be}
    ${Be} = unpack_mix_${st}(a_${Be}, u_${Be}_t);
#else
    ${be} ${we} ${Be} = u_${Be};
#endif
`:he==="define"?`
#ifndef HAS_UNIFORM_u_${Be}
uniform lowp float u_${Be}_t;
attribute ${be} ${Ye} a_${Be};
#else
uniform ${be} ${we} u_${Be};
#endif
`:st==="vec4"?`
#ifndef HAS_UNIFORM_u_${Be}
    ${be} ${we} ${Be} = a_${Be};
#else
    ${be} ${we} ${Be} = u_${Be};
#endif
`:`
#ifndef HAS_UNIFORM_u_${Be}
    ${be} ${we} ${Be} = unpack_mix_${st}(a_${Be}, u_${Be}_t);
#else
    ${be} ${we} ${Be} = u_${Be};
#endif
`})),staticAttributes:A,staticUniforms:H}}class Mc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,x,A,I,P,H,K,ne,he){this.context=o;let be=this.boundPaintVertexBuffers.length!==I.length;for(let we=0;!be&&we<I.length;we++)this.boundPaintVertexBuffers[we]!==I[we]&&(be=!0);!this.vao||this.boundProgram!==x||this.boundLayoutVertexBuffer!==A||be||this.boundIndexBuffer!==P||this.boundVertexOffset!==H||this.boundDynamicVertexBuffer!==K||this.boundDynamicVertexBuffer2!==ne||this.boundDynamicVertexBuffer3!==he?this.freshBind(x,A,I,P,H,K,ne,he):(o.bindVertexArray.set(this.vao),K&&K.bind(),P&&P.dynamicDraw&&P.bind(),ne&&ne.bind(),he&&he.bind())}freshBind(o,x,A,I,P,H,K,ne){const he=o.numAttributes,be=this.context,we=be.gl;this.vao&&this.destroy(),this.vao=be.createVertexArray(),be.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=x,this.boundPaintVertexBuffers=A,this.boundIndexBuffer=I,this.boundVertexOffset=P,this.boundDynamicVertexBuffer=H,this.boundDynamicVertexBuffer2=K,this.boundDynamicVertexBuffer3=ne,x.enableAttributes(we,o);for(const Be of A)Be.enableAttributes(we,o);H&&H.enableAttributes(we,o),K&&K.enableAttributes(we,o),ne&&ne.enableAttributes(we,o),x.bind(),x.setVertexAttribPointers(we,o,P);for(const Be of A)Be.bind(),Be.setVertexAttribPointers(we,o,P);H&&(H.bind(),H.setVertexAttribPointers(we,o,P)),I&&I.bind(),K&&(K.bind(),K.setVertexAttribPointers(we,o,P)),ne&&(ne.bind(),ne.setVertexAttribPointers(we,o,P)),be.currentNumAttributes=he}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Ks=(L,o,x,A,I)=>({u_matrix:L,u_texture:0,u_ele_delta:o,u_fog_matrix:x,u_fog_color:A?A.properties.get("fog-color"):n.aM.white,u_fog_ground_blend:A?A.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:A?A.calculateFogBlendOpacity(I):0,u_horizon_color:A?A.properties.get("horizon-color"):n.aM.white,u_horizon_fog_blend:A?A.properties.get("horizon-fog-blend"):1});function jc(L){const o=[];for(let x=0;x<L.length;x++){if(L[x]===null)continue;const A=L[x].split(" ");o.push(A.pop())}return o}class Mh{constructor(o,x,A,I,P,H){const K=o.gl;this.program=K.createProgram();const ne=jc(x.staticAttributes),he=A?A.getBinderAttributes():[],be=ne.concat(he),we=jo.prelude.staticUniforms?jc(jo.prelude.staticUniforms):[],Be=x.staticUniforms?jc(x.staticUniforms):[],Ye=A?A.getBinderUniforms():[],st=we.concat(Be).concat(Ye),vt=[];for(const oi of st)vt.indexOf(oi)<0&&vt.push(oi);const Et=A?A.defines():[];P&&Et.push("#define OVERDRAW_INSPECTOR;"),H&&Et.push("#define TERRAIN3D;");const Ct=Et.concat(jo.prelude.fragmentSource,x.fragmentSource).join(`
`),Lt=Et.concat(jo.prelude.vertexSource,x.vertexSource).join(`
`),_t=K.createShader(K.FRAGMENT_SHADER);if(K.isContextLost())return void(this.failedToCreate=!0);if(K.shaderSource(_t,Ct),K.compileShader(_t),!K.getShaderParameter(_t,K.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${K.getShaderInfoLog(_t)}`);K.attachShader(this.program,_t);const Ht=K.createShader(K.VERTEX_SHADER);if(K.isContextLost())return void(this.failedToCreate=!0);if(K.shaderSource(Ht,Lt),K.compileShader(Ht),!K.getShaderParameter(Ht,K.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${K.getShaderInfoLog(Ht)}`);K.attachShader(this.program,Ht),this.attributes={};const Qt={};this.numAttributes=be.length;for(let oi=0;oi<this.numAttributes;oi++)be[oi]&&(K.bindAttribLocation(this.program,oi,be[oi]),this.attributes[be[oi]]=oi);if(K.linkProgram(this.program),!K.getProgramParameter(this.program,K.LINK_STATUS))throw new Error(`Program failed to link: ${K.getProgramInfoLog(this.program)}`);K.deleteShader(Ht),K.deleteShader(_t);for(let oi=0;oi<vt.length;oi++){const $i=vt[oi];if($i&&!Qt[$i]){const An=K.getUniformLocation(this.program,$i);An&&(Qt[$i]=An)}}this.fixedUniforms=I(o,Qt),this.terrainUniforms=((oi,$i)=>({u_depth:new n.aH(oi,$i.u_depth),u_terrain:new n.aH(oi,$i.u_terrain),u_terrain_dim:new n.aI(oi,$i.u_terrain_dim),u_terrain_matrix:new n.aJ(oi,$i.u_terrain_matrix),u_terrain_unpack:new n.aK(oi,$i.u_terrain_unpack),u_terrain_exaggeration:new n.aI(oi,$i.u_terrain_exaggeration)}))(o,Qt),this.binderUniforms=A?A.getUniforms(o,Qt):[]}draw(o,x,A,I,P,H,K,ne,he,be,we,Be,Ye,st,vt,Et,Ct,Lt){const _t=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(A),o.setStencilMode(I),o.setColorMode(P),o.setCullFace(H),ne){o.activeTexture.set(_t.TEXTURE2),_t.bindTexture(_t.TEXTURE_2D,ne.depthTexture),o.activeTexture.set(_t.TEXTURE3),_t.bindTexture(_t.TEXTURE_2D,ne.texture);for(const Qt in this.terrainUniforms)this.terrainUniforms[Qt].set(ne[Qt])}for(const Qt in this.fixedUniforms)this.fixedUniforms[Qt].set(K[Qt]);vt&&vt.setUniforms(o,this.binderUniforms,Ye,{zoom:st});let Ht=0;switch(x){case _t.LINES:Ht=2;break;case _t.TRIANGLES:Ht=3;break;case _t.LINE_STRIP:Ht=1}for(const Qt of Be.get()){const oi=Qt.vaos||(Qt.vaos={});(oi[he]||(oi[he]=new Mc)).bind(o,this,be,vt?vt.getPaintVertexBuffers():[],we,Qt.vertexOffset,Et,Ct,Lt),_t.drawElements(x,Qt.primitiveLength*Ht,_t.UNSIGNED_SHORT,Qt.primitiveOffset*Ht*2)}}}function ou(L,o,x){const A=1/ze(x,1,o.transform.tileZoom),I=Math.pow(2,x.tileID.overscaledZ),P=x.tileSize*Math.pow(2,o.transform.tileZoom)/I,H=P*(x.tileID.canonical.x+x.tileID.wrap*I),K=P*x.tileID.canonical.y;return{u_image:0,u_texsize:x.imageAtlasTexture.size,u_scale:[A,L.fromScale,L.toScale],u_fade:L.t,u_pixel_coord_upper:[H>>16,K>>16],u_pixel_coord_lower:[65535&H,65535&K]}}const Jh=(L,o,x,A)=>{const I=o.style.light,P=I.properties.get("position"),H=[P.x,P.y,P.z],K=(function(){var he=new n.A(9);return n.A!=Float32Array&&(he[1]=0,he[2]=0,he[3]=0,he[5]=0,he[6]=0,he[7]=0),he[0]=1,he[4]=1,he[8]=1,he})();I.properties.get("anchor")==="viewport"&&(function(he,be){var we=Math.sin(be),Be=Math.cos(be);he[0]=Be,he[1]=we,he[2]=0,he[3]=-we,he[4]=Be,he[5]=0,he[6]=0,he[7]=0,he[8]=1})(K,-o.transform.angle),(function(he,be,we){var Be=be[0],Ye=be[1],st=be[2];he[0]=Be*we[0]+Ye*we[3]+st*we[6],he[1]=Be*we[1]+Ye*we[4]+st*we[7],he[2]=Be*we[2]+Ye*we[5]+st*we[8]})(H,H,K);const ne=I.properties.get("color");return{u_matrix:L,u_lightpos:H,u_lightintensity:I.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+x,u_opacity:A}},Qh=(L,o,x,A,I,P,H)=>n.e(Jh(L,o,x,A),ou(P,o,H),{u_height_factor:-Math.pow(2,I.overscaledZ)/H.tileSize/8}),Mu=L=>({u_matrix:L}),Gc=(L,o,x,A)=>n.e(Mu(L),ou(x,o,A)),cc=(L,o)=>({u_matrix:L,u_world:o}),lu=(L,o,x,A,I)=>n.e(Gc(L,o,x,A),{u_world:I}),Cc=(L,o,x,A)=>{const I=L.transform;let P,H;if(A.paint.get("circle-pitch-alignment")==="map"){const K=ze(x,1,I.zoom);P=!0,H=[K,K]}else P=!1,H=I.pixelsToGLUnits;return{u_camera_to_center_distance:I.cameraToCenterDistance,u_scale_with_map:+(A.paint.get("circle-pitch-scale")==="map"),u_matrix:L.translatePosMatrix(o.posMatrix,x,A.paint.get("circle-translate"),A.paint.get("circle-translate-anchor")),u_pitch_with_map:+P,u_device_pixel_ratio:L.pixelRatio,u_extrude_scale:H}},fo=(L,o,x)=>({u_matrix:L,u_inv_matrix:o,u_camera_to_center_distance:x.cameraToCenterDistance,u_viewport_size:[x.width,x.height]}),Xl=(L,o,x=1)=>({u_matrix:L,u_color:o,u_overlay:0,u_overlay_scale:x}),Po=L=>({u_matrix:L}),Eo=(L,o,x,A)=>({u_matrix:L,u_extrude_scale:ze(o,1,x),u_intensity:A}),cu=(L,o,x,A)=>{const I=n.H();n.aP(I,0,L.width,L.height,0,0,1);const P=L.context.gl;return{u_matrix:I,u_world:[P.drawingBufferWidth,P.drawingBufferHeight],u_image:x,u_color_ramp:A,u_opacity:o.paint.get("heatmap-opacity")}};function Cu(L,o){const x=Math.pow(2,o.canonical.z),A=o.canonical.y;return[new n.Z(0,A/x).toLngLat().lat,new n.Z(0,(A+1)/x).toLngLat().lat]}const Ch=(L,o,x,A)=>{const I=L.transform;return{u_matrix:uu(L,o,x,A),u_ratio:1/ze(o,1,I.zoom),u_device_pixel_ratio:L.pixelRatio,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]]}},Kf=(L,o,x,A,I)=>n.e(Ch(L,o,x,I),{u_image:0,u_image_height:A}),zc=(L,o,x,A,I)=>{const P=L.transform,H=Ed(o,P);return{u_matrix:uu(L,o,x,I),u_texsize:o.imageAtlasTexture.size,u_ratio:1/ze(o,1,P.zoom),u_device_pixel_ratio:L.pixelRatio,u_image:0,u_scale:[H,A.fromScale,A.toScale],u_fade:A.t,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]]}},Go=(L,o,x,A,I,P)=>{const H=L.lineAtlas,K=Ed(o,L.transform),ne=x.layout.get("line-cap")==="round",he=H.getDash(A.from,ne),be=H.getDash(A.to,ne),we=he.width*I.fromScale,Be=be.width*I.toScale;return n.e(Ch(L,o,x,P),{u_patternscale_a:[K/we,-he.height/2],u_patternscale_b:[K/Be,-be.height/2],u_sdfgamma:H.width/(256*Math.min(we,Be)*L.pixelRatio)/2,u_image:0,u_tex_y_a:he.y,u_tex_y_b:be.y,u_mix:I.t})};function Ed(L,o){return 1/ze(L,1,o.tileZoom)}function uu(L,o,x,A){return L.translatePosMatrix(A?A.posMatrix:o.tileID.posMatrix,o,x.paint.get("line-translate"),x.paint.get("line-translate-anchor"))}const Wl=(L,o,x,A,I)=>{return{u_matrix:L,u_tl_parent:o,u_scale_parent:x,u_buffer_scale:1,u_fade_t:A.mix,u_opacity:A.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(H=I.paint.get("raster-saturation"),H>0?1-1/(1.001-H):-H),u_contrast_factor:(P=I.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:Ep(I.paint.get("raster-hue-rotate"))};var P,H};function Ep(L){L*=Math.PI/180;const o=Math.sin(L),x=Math.cos(L);return[(2*x+1)/3,(-Math.sqrt(3)*o-x+1)/3,(Math.sqrt(3)*o-x+1)/3]}const Hd=(L,o,x,A,I,P,H,K,ne,he,be,we,Be,Ye)=>{const st=H.transform;return{u_is_size_zoom_constant:+(L==="constant"||L==="source"),u_is_size_feature_constant:+(L==="constant"||L==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:st.cameraToCenterDistance,u_pitch:st.pitch/360*2*Math.PI,u_rotate_symbol:+x,u_aspect_ratio:st.width/st.height,u_fade_change:H.options.fadeDuration?H.symbolFadeChange:1,u_matrix:K,u_label_plane_matrix:ne,u_coord_matrix:he,u_is_text:+we,u_pitch_with_map:+A,u_is_along_line:I,u_is_variable_anchor:P,u_texsize:Be,u_texture:0,u_translation:be,u_pitched_scale:Ye}},rh=(L,o,x,A,I,P,H,K,ne,he,be,we,Be,Ye,st)=>{const vt=H.transform;return n.e(Hd(L,o,x,A,I,P,H,K,ne,he,be,we,Be,st),{u_gamma_scale:A?Math.cos(vt._pitch)*vt.cameraToCenterDistance:1,u_device_pixel_ratio:H.pixelRatio,u_is_halo:1})},Wr=(L,o,x,A,I,P,H,K,ne,he,be,we,Be,Ye)=>n.e(rh(L,o,x,A,I,P,H,K,ne,he,be,!0,we,!0,Ye),{u_texsize_icon:Be,u_texture_icon:1}),ah=(L,o,x)=>({u_matrix:L,u_opacity:o,u_color:x}),$d=(L,o,x,A,I,P)=>n.e((function(H,K,ne,he){const be=ne.imageManager.getPattern(H.from.toString()),we=ne.imageManager.getPattern(H.to.toString()),{width:Be,height:Ye}=ne.imageManager.getPixelSize(),st=Math.pow(2,he.tileID.overscaledZ),vt=he.tileSize*Math.pow(2,ne.transform.tileZoom)/st,Et=vt*(he.tileID.canonical.x+he.tileID.wrap*st),Ct=vt*he.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:be.tl,u_pattern_br_a:be.br,u_pattern_tl_b:we.tl,u_pattern_br_b:we.br,u_texsize:[Be,Ye],u_mix:K.t,u_pattern_size_a:be.displaySize,u_pattern_size_b:we.displaySize,u_scale_a:K.fromScale,u_scale_b:K.toScale,u_tile_units_to_pixels:1/ze(he,1,ne.transform.tileZoom),u_pixel_coord_upper:[Et>>16,Ct>>16],u_pixel_coord_lower:[65535&Et,65535&Ct]}})(A,P,x,I),{u_matrix:L,u_opacity:o}),Cl={fillExtrusion:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_lightpos:new n.aN(L,o.u_lightpos),u_lightintensity:new n.aI(L,o.u_lightintensity),u_lightcolor:new n.aN(L,o.u_lightcolor),u_vertical_gradient:new n.aI(L,o.u_vertical_gradient),u_opacity:new n.aI(L,o.u_opacity)}),fillExtrusionPattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_lightpos:new n.aN(L,o.u_lightpos),u_lightintensity:new n.aI(L,o.u_lightintensity),u_lightcolor:new n.aN(L,o.u_lightcolor),u_vertical_gradient:new n.aI(L,o.u_vertical_gradient),u_height_factor:new n.aI(L,o.u_height_factor),u_image:new n.aH(L,o.u_image),u_texsize:new n.aO(L,o.u_texsize),u_pixel_coord_upper:new n.aO(L,o.u_pixel_coord_upper),u_pixel_coord_lower:new n.aO(L,o.u_pixel_coord_lower),u_scale:new n.aN(L,o.u_scale),u_fade:new n.aI(L,o.u_fade),u_opacity:new n.aI(L,o.u_opacity)}),fill:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix)}),fillPattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_image:new n.aH(L,o.u_image),u_texsize:new n.aO(L,o.u_texsize),u_pixel_coord_upper:new n.aO(L,o.u_pixel_coord_upper),u_pixel_coord_lower:new n.aO(L,o.u_pixel_coord_lower),u_scale:new n.aN(L,o.u_scale),u_fade:new n.aI(L,o.u_fade)}),fillOutline:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_world:new n.aO(L,o.u_world)}),fillOutlinePattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_world:new n.aO(L,o.u_world),u_image:new n.aH(L,o.u_image),u_texsize:new n.aO(L,o.u_texsize),u_pixel_coord_upper:new n.aO(L,o.u_pixel_coord_upper),u_pixel_coord_lower:new n.aO(L,o.u_pixel_coord_lower),u_scale:new n.aN(L,o.u_scale),u_fade:new n.aI(L,o.u_fade)}),circle:(L,o)=>({u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_scale_with_map:new n.aH(L,o.u_scale_with_map),u_pitch_with_map:new n.aH(L,o.u_pitch_with_map),u_extrude_scale:new n.aO(L,o.u_extrude_scale),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_matrix:new n.aJ(L,o.u_matrix)}),collisionBox:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_pixel_extrude_scale:new n.aO(L,o.u_pixel_extrude_scale)}),collisionCircle:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_inv_matrix:new n.aJ(L,o.u_inv_matrix),u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_viewport_size:new n.aO(L,o.u_viewport_size)}),debug:(L,o)=>({u_color:new n.aL(L,o.u_color),u_matrix:new n.aJ(L,o.u_matrix),u_overlay:new n.aH(L,o.u_overlay),u_overlay_scale:new n.aI(L,o.u_overlay_scale)}),clippingMask:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix)}),heatmap:(L,o)=>({u_extrude_scale:new n.aI(L,o.u_extrude_scale),u_intensity:new n.aI(L,o.u_intensity),u_matrix:new n.aJ(L,o.u_matrix)}),heatmapTexture:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_world:new n.aO(L,o.u_world),u_image:new n.aH(L,o.u_image),u_color_ramp:new n.aH(L,o.u_color_ramp),u_opacity:new n.aI(L,o.u_opacity)}),hillshade:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_image:new n.aH(L,o.u_image),u_latrange:new n.aO(L,o.u_latrange),u_light:new n.aO(L,o.u_light),u_shadow:new n.aL(L,o.u_shadow),u_highlight:new n.aL(L,o.u_highlight),u_accent:new n.aL(L,o.u_accent)}),hillshadePrepare:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_image:new n.aH(L,o.u_image),u_dimension:new n.aO(L,o.u_dimension),u_zoom:new n.aI(L,o.u_zoom),u_unpack:new n.aK(L,o.u_unpack)}),line:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_ratio:new n.aI(L,o.u_ratio),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_units_to_pixels:new n.aO(L,o.u_units_to_pixels)}),lineGradient:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_ratio:new n.aI(L,o.u_ratio),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_units_to_pixels:new n.aO(L,o.u_units_to_pixels),u_image:new n.aH(L,o.u_image),u_image_height:new n.aI(L,o.u_image_height)}),linePattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_texsize:new n.aO(L,o.u_texsize),u_ratio:new n.aI(L,o.u_ratio),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_image:new n.aH(L,o.u_image),u_units_to_pixels:new n.aO(L,o.u_units_to_pixels),u_scale:new n.aN(L,o.u_scale),u_fade:new n.aI(L,o.u_fade)}),lineSDF:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_ratio:new n.aI(L,o.u_ratio),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_units_to_pixels:new n.aO(L,o.u_units_to_pixels),u_patternscale_a:new n.aO(L,o.u_patternscale_a),u_patternscale_b:new n.aO(L,o.u_patternscale_b),u_sdfgamma:new n.aI(L,o.u_sdfgamma),u_image:new n.aH(L,o.u_image),u_tex_y_a:new n.aI(L,o.u_tex_y_a),u_tex_y_b:new n.aI(L,o.u_tex_y_b),u_mix:new n.aI(L,o.u_mix)}),raster:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_tl_parent:new n.aO(L,o.u_tl_parent),u_scale_parent:new n.aI(L,o.u_scale_parent),u_buffer_scale:new n.aI(L,o.u_buffer_scale),u_fade_t:new n.aI(L,o.u_fade_t),u_opacity:new n.aI(L,o.u_opacity),u_image0:new n.aH(L,o.u_image0),u_image1:new n.aH(L,o.u_image1),u_brightness_low:new n.aI(L,o.u_brightness_low),u_brightness_high:new n.aI(L,o.u_brightness_high),u_saturation_factor:new n.aI(L,o.u_saturation_factor),u_contrast_factor:new n.aI(L,o.u_contrast_factor),u_spin_weights:new n.aN(L,o.u_spin_weights)}),symbolIcon:(L,o)=>({u_is_size_zoom_constant:new n.aH(L,o.u_is_size_zoom_constant),u_is_size_feature_constant:new n.aH(L,o.u_is_size_feature_constant),u_size_t:new n.aI(L,o.u_size_t),u_size:new n.aI(L,o.u_size),u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_pitch:new n.aI(L,o.u_pitch),u_rotate_symbol:new n.aH(L,o.u_rotate_symbol),u_aspect_ratio:new n.aI(L,o.u_aspect_ratio),u_fade_change:new n.aI(L,o.u_fade_change),u_matrix:new n.aJ(L,o.u_matrix),u_label_plane_matrix:new n.aJ(L,o.u_label_plane_matrix),u_coord_matrix:new n.aJ(L,o.u_coord_matrix),u_is_text:new n.aH(L,o.u_is_text),u_pitch_with_map:new n.aH(L,o.u_pitch_with_map),u_is_along_line:new n.aH(L,o.u_is_along_line),u_is_variable_anchor:new n.aH(L,o.u_is_variable_anchor),u_texsize:new n.aO(L,o.u_texsize),u_texture:new n.aH(L,o.u_texture),u_translation:new n.aO(L,o.u_translation),u_pitched_scale:new n.aI(L,o.u_pitched_scale)}),symbolSDF:(L,o)=>({u_is_size_zoom_constant:new n.aH(L,o.u_is_size_zoom_constant),u_is_size_feature_constant:new n.aH(L,o.u_is_size_feature_constant),u_size_t:new n.aI(L,o.u_size_t),u_size:new n.aI(L,o.u_size),u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_pitch:new n.aI(L,o.u_pitch),u_rotate_symbol:new n.aH(L,o.u_rotate_symbol),u_aspect_ratio:new n.aI(L,o.u_aspect_ratio),u_fade_change:new n.aI(L,o.u_fade_change),u_matrix:new n.aJ(L,o.u_matrix),u_label_plane_matrix:new n.aJ(L,o.u_label_plane_matrix),u_coord_matrix:new n.aJ(L,o.u_coord_matrix),u_is_text:new n.aH(L,o.u_is_text),u_pitch_with_map:new n.aH(L,o.u_pitch_with_map),u_is_along_line:new n.aH(L,o.u_is_along_line),u_is_variable_anchor:new n.aH(L,o.u_is_variable_anchor),u_texsize:new n.aO(L,o.u_texsize),u_texture:new n.aH(L,o.u_texture),u_gamma_scale:new n.aI(L,o.u_gamma_scale),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_is_halo:new n.aH(L,o.u_is_halo),u_translation:new n.aO(L,o.u_translation),u_pitched_scale:new n.aI(L,o.u_pitched_scale)}),symbolTextAndIcon:(L,o)=>({u_is_size_zoom_constant:new n.aH(L,o.u_is_size_zoom_constant),u_is_size_feature_constant:new n.aH(L,o.u_is_size_feature_constant),u_size_t:new n.aI(L,o.u_size_t),u_size:new n.aI(L,o.u_size),u_camera_to_center_distance:new n.aI(L,o.u_camera_to_center_distance),u_pitch:new n.aI(L,o.u_pitch),u_rotate_symbol:new n.aH(L,o.u_rotate_symbol),u_aspect_ratio:new n.aI(L,o.u_aspect_ratio),u_fade_change:new n.aI(L,o.u_fade_change),u_matrix:new n.aJ(L,o.u_matrix),u_label_plane_matrix:new n.aJ(L,o.u_label_plane_matrix),u_coord_matrix:new n.aJ(L,o.u_coord_matrix),u_is_text:new n.aH(L,o.u_is_text),u_pitch_with_map:new n.aH(L,o.u_pitch_with_map),u_is_along_line:new n.aH(L,o.u_is_along_line),u_is_variable_anchor:new n.aH(L,o.u_is_variable_anchor),u_texsize:new n.aO(L,o.u_texsize),u_texsize_icon:new n.aO(L,o.u_texsize_icon),u_texture:new n.aH(L,o.u_texture),u_texture_icon:new n.aH(L,o.u_texture_icon),u_gamma_scale:new n.aI(L,o.u_gamma_scale),u_device_pixel_ratio:new n.aI(L,o.u_device_pixel_ratio),u_is_halo:new n.aH(L,o.u_is_halo),u_translation:new n.aO(L,o.u_translation),u_pitched_scale:new n.aI(L,o.u_pitched_scale)}),background:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_opacity:new n.aI(L,o.u_opacity),u_color:new n.aL(L,o.u_color)}),backgroundPattern:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_opacity:new n.aI(L,o.u_opacity),u_image:new n.aH(L,o.u_image),u_pattern_tl_a:new n.aO(L,o.u_pattern_tl_a),u_pattern_br_a:new n.aO(L,o.u_pattern_br_a),u_pattern_tl_b:new n.aO(L,o.u_pattern_tl_b),u_pattern_br_b:new n.aO(L,o.u_pattern_br_b),u_texsize:new n.aO(L,o.u_texsize),u_mix:new n.aI(L,o.u_mix),u_pattern_size_a:new n.aO(L,o.u_pattern_size_a),u_pattern_size_b:new n.aO(L,o.u_pattern_size_b),u_scale_a:new n.aI(L,o.u_scale_a),u_scale_b:new n.aI(L,o.u_scale_b),u_pixel_coord_upper:new n.aO(L,o.u_pixel_coord_upper),u_pixel_coord_lower:new n.aO(L,o.u_pixel_coord_lower),u_tile_units_to_pixels:new n.aI(L,o.u_tile_units_to_pixels)}),terrain:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_texture:new n.aH(L,o.u_texture),u_ele_delta:new n.aI(L,o.u_ele_delta),u_fog_matrix:new n.aJ(L,o.u_fog_matrix),u_fog_color:new n.aL(L,o.u_fog_color),u_fog_ground_blend:new n.aI(L,o.u_fog_ground_blend),u_fog_ground_blend_opacity:new n.aI(L,o.u_fog_ground_blend_opacity),u_horizon_color:new n.aL(L,o.u_horizon_color),u_horizon_fog_blend:new n.aI(L,o.u_horizon_fog_blend)}),terrainDepth:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_ele_delta:new n.aI(L,o.u_ele_delta)}),terrainCoords:(L,o)=>({u_matrix:new n.aJ(L,o.u_matrix),u_texture:new n.aH(L,o.u_texture),u_terrain_coords_id:new n.aI(L,o.u_terrain_coords_id),u_ele_delta:new n.aI(L,o.u_ele_delta)}),sky:(L,o)=>({u_sky_color:new n.aL(L,o.u_sky_color),u_horizon_color:new n.aL(L,o.u_horizon_color),u_horizon:new n.aI(L,o.u_horizon),u_sky_horizon_blend:new n.aI(L,o.u_sky_horizon_blend)})};class zl{constructor(o,x,A){this.context=o;const I=o.gl;this.buffer=I.createBuffer(),this.dynamicDraw=!!A,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const x=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),x.bufferSubData(x.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Du{constructor(o,x,A,I){this.length=x.length,this.attributes=A,this.itemSize=x.bytesPerElement,this.dynamicDraw=I,this.context=o;const P=o.gl;this.buffer=P.createBuffer(),o.bindVertexBuffer.set(this.buffer),P.bufferData(P.ARRAY_BUFFER,x.arrayBuffer,this.dynamicDraw?P.DYNAMIC_DRAW:P.STATIC_DRAW),this.dynamicDraw||delete x.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const x=this.context.gl;this.bind(),x.bufferSubData(x.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,x){for(let A=0;A<this.attributes.length;A++){const I=x.attributes[this.attributes[A].name];I!==void 0&&o.enableVertexAttribArray(I)}}setVertexAttribPointers(o,x,A){for(let I=0;I<this.attributes.length;I++){const P=this.attributes[I],H=x.attributes[P.name];H!==void 0&&o.vertexAttribPointer(H,P.components,o[zu[P.type]],!1,this.itemSize,P.offset+this.itemSize*(A||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ru=new WeakMap;function hu(L){var o;if(Ru.has(L))return Ru.get(L);{const x=(o=L.getParameter(L.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return Ru.set(L,x),x}}class ns{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Dl extends ns{getDefault(){return n.aM.transparent}set(o){const x=this.current;(o.r!==x.r||o.g!==x.g||o.b!==x.b||o.a!==x.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class ed extends ns{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class zh extends ns{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class td extends ns{getDefault(){return[!0,!0,!0,!0]}set(o){const x=this.current;(o[0]!==x[0]||o[1]!==x[1]||o[2]!==x[2]||o[3]!==x[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class id extends ns{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class Rl extends ns{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class Ad extends ns{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const x=this.current;(o.func!==x.func||o.ref!==x.ref||o.mask!==x.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Id extends ns{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const x=this.current;(o[0]!==x[0]||o[1]!==x[1]||o[2]!==x[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class qc extends ns{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;o?x.enable(x.STENCIL_TEST):x.disable(x.STENCIL_TEST),this.current=o,this.dirty=!1}}class Ta extends ns{getDefault(){return[0,1]}set(o){const x=this.current;(o[0]!==x[0]||o[1]!==x[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ap extends ns{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;o?x.enable(x.DEPTH_TEST):x.disable(x.DEPTH_TEST),this.current=o,this.dirty=!1}}class Ip extends ns{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Dh extends ns{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;o?x.enable(x.BLEND):x.disable(x.BLEND),this.current=o,this.dirty=!1}}class Gn extends ns{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const x=this.current;(o[0]!==x[0]||o[1]!==x[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Mp extends ns{getDefault(){return n.aM.transparent}set(o){const x=this.current;(o.r!==x.r||o.g!==x.g||o.b!==x.b||o.a!==x.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Zd extends ns{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Yl extends ns{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;o?x.enable(x.CULL_FACE):x.disable(x.CULL_FACE),this.current=o,this.dirty=!1}}class nd extends ns{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Dc extends ns{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class En extends ns{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class ta extends ns{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class Sa extends ns{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const x=this.current;(o[0]!==x[0]||o[1]!==x[1]||o[2]!==x[2]||o[3]!==x[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Kl extends ns{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;x.bindFramebuffer(x.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Pu extends ns{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;x.bindRenderbuffer(x.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class va extends ns{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;x.bindTexture(x.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class If extends ns{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;x.bindBuffer(x.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class rd extends ns{getDefault(){return null}set(o){const x=this.gl;x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Hc extends ns{getDefault(){return null}set(o){var x;if(o===this.current&&!this.dirty)return;const A=this.gl;hu(A)?A.bindVertexArray(o):(x=A.getExtension("OES_vertex_array_object"))===null||x===void 0||x.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class al extends ns{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class io extends ns{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class Cp extends ns{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const x=this.gl;x.pixelStorei(x.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class $c extends ns{constructor(o,x){super(o),this.context=o,this.parent=x}getDefault(){return null}}class Rh extends $c{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Lu extends $c{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_ATTACHMENT,x.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Md extends $c{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const x=this.gl;x.framebufferRenderbuffer(x.FRAMEBUFFER,x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Jf{constructor(o,x,A,I,P){this.context=o,this.width=x,this.height=A;const H=o.gl,K=this.framebuffer=H.createFramebuffer();if(this.colorAttachment=new Rh(o,K),I)this.depthAttachment=P?new Md(o,K):new Lu(o,K);else if(P)throw new Error("Stencil cannot be set without depth");if(H.checkFramebufferStatus(H.FRAMEBUFFER)!==H.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,x=this.colorAttachment.get();if(x&&o.deleteTexture(x),this.depthAttachment){const A=this.depthAttachment.get();A&&o.deleteRenderbuffer(A)}o.deleteFramebuffer(this.framebuffer)}}class po{constructor(o,x,A){this.blendFunction=o,this.blendColor=x,this.mask=A}}po.Replace=[1,0],po.disabled=new po(po.Replace,n.aM.transparent,[!1,!1,!1,!1]),po.unblended=new po(po.Replace,n.aM.transparent,[!0,!0,!0,!0]),po.alphaBlended=new po([1,771],n.aM.transparent,[!0,!0,!0,!0]);class Pl{constructor(o){var x,A;if(this.gl=o,this.clearColor=new Dl(this),this.clearDepth=new ed(this),this.clearStencil=new zh(this),this.colorMask=new td(this),this.depthMask=new id(this),this.stencilMask=new Rl(this),this.stencilFunc=new Ad(this),this.stencilOp=new Id(this),this.stencilTest=new qc(this),this.depthRange=new Ta(this),this.depthTest=new Ap(this),this.depthFunc=new Ip(this),this.blend=new Dh(this),this.blendFunc=new Gn(this),this.blendColor=new Mp(this),this.blendEquation=new Zd(this),this.cullFace=new Yl(this),this.cullFaceSide=new nd(this),this.frontFace=new Dc(this),this.program=new En(this),this.activeTexture=new ta(this),this.viewport=new Sa(this),this.bindFramebuffer=new Kl(this),this.bindRenderbuffer=new Pu(this),this.bindTexture=new va(this),this.bindVertexBuffer=new If(this),this.bindElementBuffer=new rd(this),this.bindVertexArray=new Hc(this),this.pixelStoreUnpack=new al(this),this.pixelStoreUnpackPremultiplyAlpha=new io(this),this.pixelStoreUnpackFlipY=new Cp(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),hu(o)){this.HALF_FLOAT=o.HALF_FLOAT;const I=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(x=o.RGBA16F)!==null&&x!==void 0?x:I?.RGBA16F_EXT,this.RGB16F=(A=o.RGB16F)!==null&&A!==void 0?A:I?.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const I=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=I?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,x){return new zl(this,o,x)}createVertexBuffer(o,x,A){return new Du(this,o,x,A)}createRenderbuffer(o,x,A){const I=this.gl,P=I.createRenderbuffer();return this.bindRenderbuffer.set(P),I.renderbufferStorage(I.RENDERBUFFER,o,x,A),this.bindRenderbuffer.set(null),P}createFramebuffer(o,x,A,I){return new Jf(this,o,x,A,I)}clear({color:o,depth:x,stencil:A}){const I=this.gl;let P=0;o&&(P|=I.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),x!==void 0&&(P|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(x),this.depthMask.set(!0)),A!==void 0&&(P|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(A),this.stencilMask.set(255)),I.clear(P)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){n.aE(o.blendFunction,po.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return hu(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var x;return hu(this.gl)?this.gl.deleteVertexArray(o):(x=this.gl.getExtension("OES_vertex_array_object"))===null||x===void 0?void 0:x.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class ga{constructor(o,x,A){this.func=o,this.mask=x,this.range=A}}ga.ReadOnly=!1,ga.ReadWrite=!0,ga.disabled=new ga(519,ga.ReadOnly,[0,1]);const Io=7680;class Is{constructor(o,x,A,I,P,H){this.test=o,this.ref=x,this.mask=A,this.fail=I,this.depthFail=P,this.pass=H}}Is.disabled=new Is({func:519,mask:0},0,0,Io,Io,Io);class ys{constructor(o,x,A){this.enable=o,this.mode=x,this.frontFace=A}}let no;function Ll(L,o,x,A,I){const P=L.context,H=P.gl,K=L.useProgram("collisionBox"),ne=[];let he=0,be=0;for(let Ct=0;Ct<A.length;Ct++){const Lt=A[Ct],_t=o.getTile(Lt).getBucket(x);if(!_t)continue;const Ht=I?_t.textCollisionBox:_t.iconCollisionBox,Qt=_t.collisionCircleArray;if(Qt.length>0){const oi=n.H();n.aQ(oi,_t.placementInvProjMatrix,L.transform.glCoordMatrix),n.aQ(oi,oi,_t.placementViewportMatrix),ne.push({circleArray:Qt,circleOffset:be,transform:Lt.posMatrix,invTransform:oi,coord:Lt}),he+=Qt.length/4,be=he}Ht&&K.draw(P,H.LINES,ga.disabled,Is.disabled,L.colorModeForRenderPass(),ys.disabled,{u_matrix:Lt.posMatrix,u_pixel_extrude_scale:[1/(we=L.transform).width,1/we.height]},L.style.map.terrain&&L.style.map.terrain.getTerrainData(Lt),x.id,Ht.layoutVertexBuffer,Ht.indexBuffer,Ht.segments,null,L.transform.zoom,null,null,Ht.collisionVertexBuffer)}var we;if(!I||!ne.length)return;const Be=L.useProgram("collisionCircle"),Ye=new n.aR;Ye.resize(4*he),Ye._trim();let st=0;for(const Ct of ne)for(let Lt=0;Lt<Ct.circleArray.length/4;Lt++){const _t=4*Lt,Ht=Ct.circleArray[_t+0],Qt=Ct.circleArray[_t+1],oi=Ct.circleArray[_t+2],$i=Ct.circleArray[_t+3];Ye.emplace(st++,Ht,Qt,oi,$i,0),Ye.emplace(st++,Ht,Qt,oi,$i,1),Ye.emplace(st++,Ht,Qt,oi,$i,2),Ye.emplace(st++,Ht,Qt,oi,$i,3)}(!no||no.length<2*he)&&(no=(function(Ct){const Lt=2*Ct,_t=new n.aT;_t.resize(Lt),_t._trim();for(let Ht=0;Ht<Lt;Ht++){const Qt=6*Ht;_t.uint16[Qt+0]=4*Ht+0,_t.uint16[Qt+1]=4*Ht+1,_t.uint16[Qt+2]=4*Ht+2,_t.uint16[Qt+3]=4*Ht+2,_t.uint16[Qt+4]=4*Ht+3,_t.uint16[Qt+5]=4*Ht+0}return _t})(he));const vt=P.createIndexBuffer(no,!0),Et=P.createVertexBuffer(Ye,n.aS.members,!0);for(const Ct of ne){const Lt=fo(Ct.transform,Ct.invTransform,L.transform);Be.draw(P,H.TRIANGLES,ga.disabled,Is.disabled,L.colorModeForRenderPass(),ys.disabled,Lt,L.style.map.terrain&&L.style.map.terrain.getTerrainData(Ct.coord),x.id,Et,vt,n.a0.simpleSegment(0,2*Ct.circleOffset,Ct.circleArray.length,Ct.circleArray.length/2),null,L.transform.zoom,null,null,null)}Et.destroy(),vt.destroy()}ys.disabled=new ys(!1,1029,2305),ys.backCCW=new ys(!0,1029,2305);const Rc=n.an(new Float32Array(16));function Js(L,o,x,A,I,P){const{horizontalAlign:H,verticalAlign:K}=n.au(L);return new n.P((-(H-.5)*o/I+A[0])*P,(-(K-.5)*x/I+A[1])*P)}function Zc(L,o,x,A,I,P){const H=o.tileAnchorPoint.add(new n.P(o.translation[0],o.translation[1]));if(o.pitchWithMap){let K=A.mult(P);x||(K=K.rotate(-I));const ne=H.add(K);return dt(ne.x,ne.y,o.labelPlaneMatrix,o.getElevation).point}if(x){const K=Di(o.tileAnchorPoint.x+1,o.tileAnchorPoint.y,o).point.sub(L),ne=Math.atan(K.y/K.x)+(K.x<0?Math.PI:0);return L.add(A.rotate(ne))}return L.add(A)}function Jl(L,o,x,A,I,P,H,K,ne,he,be,we,Be,Ye){const st=L.text.placedSymbolArray,vt=L.text.dynamicLayoutVertexArray,Et=L.icon.dynamicLayoutVertexArray,Ct={};vt.clear();for(let Lt=0;Lt<st.length;Lt++){const _t=st.get(Lt),Ht=_t.hidden||!_t.crossTileID||L.allowVerticalPlacement&&!_t.placedOrientation?null:A[_t.crossTileID];if(Ht){const Qt=new n.P(_t.anchorX,_t.anchorY),oi={getElevation:Ye,width:I.width,height:I.height,labelPlaneMatrix:P,pitchWithMap:x,projection:be,tileAnchorPoint:Qt,translation:we,unwrappedTileID:Be},$i=x?dt(Qt.x,Qt.y,H,Ye):Di(Qt.x,Qt.y,oi),An=Ce(I.cameraToCenterDistance,$i.signedDistanceFromCamera);let Mn=n.ai(L.textSizeData,ne,_t)*An/n.ap;x&&(Mn*=L.tilePixelRatio/K);const{width:Zn,height:Ln,anchor:zn,textOffset:ir,textBoxScale:$r}=Ht,On=Js(zn,Zn,Ln,ir,$r,Mn),qn=be.getPitchedTextCorrection(I,Qt.add(new n.P(we[0],we[1])),Be),Yr=Zc($i.point,oi,o,On,I.angle,qn),Qa=L.allowVerticalPlacement&&_t.placedOrientation===n.ah.vertical?Math.PI/2:0;for(let Ma=0;Ma<_t.numGlyphs;Ma++)n.aj(vt,Yr,Qa);he&&_t.associatedIconIndex>=0&&(Ct[_t.associatedIconIndex]={shiftedAnchor:Yr,angle:Qa})}else Tr(_t.numGlyphs,vt)}if(he){Et.clear();const Lt=L.icon.placedSymbolArray;for(let _t=0;_t<Lt.length;_t++){const Ht=Lt.get(_t);if(Ht.hidden)Tr(Ht.numGlyphs,Et);else{const Qt=Ct[_t];if(Qt)for(let oi=0;oi<Ht.numGlyphs;oi++)n.aj(Et,Qt.shiftedAnchor,Qt.angle);else Tr(Ht.numGlyphs,Et)}}L.icon.dynamicLayoutVertexBuffer.updateData(Et)}L.text.dynamicLayoutVertexBuffer.updateData(vt)}function Mo(L,o,x){return x.iconsInText&&o?"symbolTextAndIcon":L?"symbolSDF":"symbolIcon"}function cr(L,o,x,A,I,P,H,K,ne,he,be,we){const Be=L.context,Ye=Be.gl,st=L.transform,vt=js(),Et=K==="map",Ct=ne==="map",Lt=K!=="viewport"&&x.layout.get("symbol-placement")!=="point",_t=Et&&!Ct&&!Lt,Ht=!Ct&&Lt,Qt=!x.layout.get("symbol-sort-key").isConstant();let oi=!1;const $i=L.depthModeForSublayer(0,ga.ReadOnly),An=x._unevaluatedLayout.hasValue("text-variable-anchor")||x._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Mn=[],Zn=vt.getCircleRadiusCorrection(st);for(const Ln of A){const zn=o.getTile(Ln),ir=zn.getBucket(x);if(!ir)continue;const $r=I?ir.text:ir.icon;if(!$r||!$r.segments.get().length||!$r.hasVisibleVertices)continue;const On=$r.programConfigurations.get(x.id),qn=I||ir.sdfIcons,Yr=I?ir.textSizeData:ir.iconSizeData,Qa=Ct||st.pitch!==0,Ma=L.useProgram(Mo(qn,I,ir),On),Za=n.ag(Yr,st.zoom),Ls=L.style.map.terrain&&L.style.map.terrain.getTerrainData(Ln);let ol,mc,ks,Lo,Os=[0,0],Ms=null;if(I)mc=zn.glyphAtlasTexture,ks=Ye.LINEAR,ol=zn.glyphAtlasTexture.size,ir.iconsInText&&(Os=zn.imageAtlasTexture.size,Ms=zn.imageAtlasTexture,Lo=Qa||L.options.rotating||L.options.zooming||Yr.kind==="composite"||Yr.kind==="camera"?Ye.LINEAR:Ye.NEAREST);else{const Ba=x.layout.get("icon-size").constantOr(0)!==1||ir.iconsNeedLinear;mc=zn.imageAtlasTexture,ks=qn||L.options.rotating||L.options.zooming||Ba||Qa?Ye.LINEAR:Ye.NEAREST,ol=zn.imageAtlasTexture.size}const Co=ze(zn,1,L.transform.zoom),_c=Ht?Ln.posMatrix:Rc,Nl=lc(_c,Ct,Et,L.transform,Co),Jc=ul(_c,Ct,Et,L.transform,Co),hl=ul(Ln.posMatrix,Ct,Et,L.transform,Co),Cs=vt.translatePosition(L.transform,zn,P,H),bu=An&&ir.hasTextData(),Vl=x.layout.get("icon-text-fit")!=="none"&&bu&&ir.hasIconData();if(Lt){const Ba=L.style.map.terrain?(jh,$s)=>L.style.map.terrain.getElevation(Ln,jh,$s):null,gc=x.layout.get("text-rotation-alignment")==="map";Qe(ir,Ln.posMatrix,L,I,Nl,hl,Ct,he,gc,vt,Ln.toUnwrapped(),st.width,st.height,Cs,Ba)}const di=Ln.posMatrix,Oa=I&&An||Vl,fs=Lt||Oa?Rc:Nl,Yo=Jc,mn=qn&&x.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let _o;_o=qn?ir.iconsInText?Wr(Yr.kind,Za,_t,Ct,Lt,Oa,L,di,fs,Yo,Cs,ol,Os,Zn):rh(Yr.kind,Za,_t,Ct,Lt,Oa,L,di,fs,Yo,Cs,I,ol,!0,Zn):Hd(Yr.kind,Za,_t,Ct,Lt,Oa,L,di,fs,Yo,Cs,I,ol,Zn);const bl={program:Ma,buffers:$r,uniformValues:_o,atlasTexture:mc,atlasTextureIcon:Ms,atlasInterpolation:ks,atlasInterpolationIcon:Lo,isSDF:qn,hasHalo:mn};if(Qt&&ir.canOverlap){oi=!0;const Ba=$r.segments.get();for(const gc of Ba)Mn.push({segments:new n.a0([gc]),sortKey:gc.sortKey,state:bl,terrainData:Ls})}else Mn.push({segments:$r.segments,sortKey:0,state:bl,terrainData:Ls})}oi&&Mn.sort(((Ln,zn)=>Ln.sortKey-zn.sortKey));for(const Ln of Mn){const zn=Ln.state;if(Be.activeTexture.set(Ye.TEXTURE0),zn.atlasTexture.bind(zn.atlasInterpolation,Ye.CLAMP_TO_EDGE),zn.atlasTextureIcon&&(Be.activeTexture.set(Ye.TEXTURE1),zn.atlasTextureIcon&&zn.atlasTextureIcon.bind(zn.atlasInterpolationIcon,Ye.CLAMP_TO_EDGE)),zn.isSDF){const ir=zn.uniformValues;zn.hasHalo&&(ir.u_is_halo=1,xn(zn.buffers,Ln.segments,x,L,zn.program,$i,be,we,ir,Ln.terrainData)),ir.u_is_halo=0}xn(zn.buffers,Ln.segments,x,L,zn.program,$i,be,we,zn.uniformValues,Ln.terrainData)}}function xn(L,o,x,A,I,P,H,K,ne,he){const be=A.context;I.draw(be,be.gl.TRIANGLES,P,H,K,ys.disabled,ne,he,x.id,L.layoutVertexBuffer,L.indexBuffer,o,x.paint,A.transform.zoom,L.programConfigurations.get(x.id),L.dynamicLayoutVertexBuffer,L.opacityVertexBuffer)}function ad(L,o,x,A){const I=L.context,P=I.gl,H=Is.disabled,K=new po([P.ONE,P.ONE],n.aM.transparent,[!0,!0,!0,!0]),ne=o.getBucket(x);if(!ne)return;const he=A.key;let be=x.heatmapFbos.get(he);be||(be=ku(I,o.tileSize,o.tileSize),x.heatmapFbos.set(he,be)),I.bindFramebuffer.set(be.framebuffer),I.viewport.set([0,0,o.tileSize,o.tileSize]),I.clear({color:n.aM.transparent});const we=ne.programConfigurations.get(x.id),Be=L.useProgram("heatmap",we),Ye=L.style.map.terrain.getTerrainData(A);Be.draw(I,P.TRIANGLES,ga.disabled,H,K,ys.disabled,Eo(A.posMatrix,o,L.transform.zoom,x.paint.get("heatmap-intensity")),Ye,x.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,x.paint,L.transform.zoom,we)}function Un(L,o,x){const A=L.context,I=A.gl;A.setColorMode(L.colorModeForRenderPass());const P=Ph(A,o),H=x.key,K=o.heatmapFbos.get(H);K&&(A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,K.colorAttachment.get()),A.activeTexture.set(I.TEXTURE1),P.bind(I.LINEAR,I.CLAMP_TO_EDGE),L.useProgram("heatmapTexture").draw(A,I.TRIANGLES,ga.disabled,Is.disabled,L.colorModeForRenderPass(),ys.disabled,cu(L,o,0,1),null,o.id,L.rasterBoundsBuffer,L.quadTriangleIndexBuffer,L.rasterBoundsSegments,o.paint,L.transform.zoom),K.destroy(),o.heatmapFbos.delete(H))}function ku(L,o,x){var A,I;const P=L.gl,H=P.createTexture();P.bindTexture(P.TEXTURE_2D,H),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_S,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_WRAP_T,P.CLAMP_TO_EDGE),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MIN_FILTER,P.LINEAR),P.texParameteri(P.TEXTURE_2D,P.TEXTURE_MAG_FILTER,P.LINEAR);const K=(A=L.HALF_FLOAT)!==null&&A!==void 0?A:P.UNSIGNED_BYTE,ne=(I=L.RGBA16F)!==null&&I!==void 0?I:P.RGBA;P.texImage2D(P.TEXTURE_2D,0,ne,o,x,0,P.RGBA,K,null);const he=L.createFramebuffer(o,x,!1,!1);return he.colorAttachment.set(H),he}function Ph(L,o){return o.colorRampTexture||(o.colorRampTexture=new dn(L,o.colorRamp,L.gl.RGBA)),o.colorRampTexture}function jn(L,o,x,A,I){if(!x||!A||!A.imageAtlas)return;const P=A.imageAtlas.patternPositions;let H=P[x.to.toString()],K=P[x.from.toString()];if(!H&&K&&(H=K),!K&&H&&(K=H),!H||!K){const ne=I.getPaintProperty(o);H=P[ne],K=P[ne]}H&&K&&L.setConstantPatternPositions(H,K)}function Pc(L,o,x,A,I,P,H){const K=L.context.gl,ne="fill-pattern",he=x.paint.get(ne),be=he&&he.constantOr(1),we=x.getCrossfadeParameters();let Be,Ye,st,vt,Et;H?(Ye=be&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Be=K.LINES):(Ye=be?"fillPattern":"fill",Be=K.TRIANGLES);const Ct=he.constantOr(null);for(const Lt of A){const _t=o.getTile(Lt);if(be&&!_t.patternsLoaded())continue;const Ht=_t.getBucket(x);if(!Ht)continue;const Qt=Ht.programConfigurations.get(x.id),oi=L.useProgram(Ye,Qt),$i=L.style.map.terrain&&L.style.map.terrain.getTerrainData(Lt);be&&(L.context.activeTexture.set(K.TEXTURE0),_t.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Qt.updatePaintBuffers(we)),jn(Qt,ne,Ct,_t,x);const An=$i?Lt:null,Mn=L.translatePosMatrix(An?An.posMatrix:Lt.posMatrix,_t,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));if(H){vt=Ht.indexBuffer2,Et=Ht.segments2;const Zn=[K.drawingBufferWidth,K.drawingBufferHeight];st=Ye==="fillOutlinePattern"&&be?lu(Mn,L,we,_t,Zn):cc(Mn,Zn)}else vt=Ht.indexBuffer,Et=Ht.segments,st=be?Gc(Mn,L,we,_t):Mu(Mn);oi.draw(L.context,Be,I,L.stencilModeForClipping(Lt),P,ys.disabled,st,$i,x.id,Ht.layoutVertexBuffer,vt,Et,x.paint,L.transform.zoom,Qt)}}function Xd(L,o,x,A,I,P,H){const K=L.context,ne=K.gl,he="fill-extrusion-pattern",be=x.paint.get(he),we=be.constantOr(1),Be=x.getCrossfadeParameters(),Ye=x.paint.get("fill-extrusion-opacity"),st=be.constantOr(null);for(const vt of A){const Et=o.getTile(vt),Ct=Et.getBucket(x);if(!Ct)continue;const Lt=L.style.map.terrain&&L.style.map.terrain.getTerrainData(vt),_t=Ct.programConfigurations.get(x.id),Ht=L.useProgram(we?"fillExtrusionPattern":"fillExtrusion",_t);we&&(L.context.activeTexture.set(ne.TEXTURE0),Et.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),_t.updatePaintBuffers(Be)),jn(_t,he,st,Et,x);const Qt=L.translatePosMatrix(vt.posMatrix,Et,x.paint.get("fill-extrusion-translate"),x.paint.get("fill-extrusion-translate-anchor")),oi=x.paint.get("fill-extrusion-vertical-gradient"),$i=we?Qh(Qt,L,oi,Ye,vt,Be,Et):Jh(Qt,L,oi,Ye);Ht.draw(K,K.gl.TRIANGLES,I,P,H,ys.backCCW,$i,Lt,x.id,Ct.layoutVertexBuffer,Ct.indexBuffer,Ct.segments,x.paint,L.transform.zoom,_t,L.style.map.terrain&&Ct.centroidVertexBuffer)}}function Lh(L,o,x,A,I,P,H){const K=L.context,ne=K.gl,he=x.fbo;if(!he)return;const be=L.useProgram("hillshade"),we=L.style.map.terrain&&L.style.map.terrain.getTerrainData(o);K.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,he.colorAttachment.get()),be.draw(K,ne.TRIANGLES,I,P,H,ys.disabled,((Be,Ye,st,vt)=>{const Et=st.paint.get("hillshade-shadow-color"),Ct=st.paint.get("hillshade-highlight-color"),Lt=st.paint.get("hillshade-accent-color");let _t=st.paint.get("hillshade-illumination-direction")*(Math.PI/180);st.paint.get("hillshade-illumination-anchor")==="viewport"&&(_t-=Be.transform.angle);const Ht=!Be.options.moving;return{u_matrix:vt?vt.posMatrix:Be.transform.calculatePosMatrix(Ye.tileID.toUnwrapped(),Ht),u_image:0,u_latrange:Cu(0,Ye.tileID),u_light:[st.paint.get("hillshade-exaggeration"),_t],u_shadow:Et,u_highlight:Ct,u_accent:Lt}})(L,x,A,we?o:null),we,A.id,L.rasterBoundsBuffer,L.quadTriangleIndexBuffer,L.rasterBoundsSegments)}function $o(L,o,x,A,I,P){const H=L.context,K=H.gl,ne=o.dem;if(ne&&ne.data){const he=ne.dim,be=ne.stride,we=ne.getPixels();if(H.activeTexture.set(K.TEXTURE1),H.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||L.getTileTexture(be),o.demTexture){const Ye=o.demTexture;Ye.update(we,{premultiply:!1}),Ye.bind(K.NEAREST,K.CLAMP_TO_EDGE)}else o.demTexture=new dn(H,we,K.RGBA,{premultiply:!1}),o.demTexture.bind(K.NEAREST,K.CLAMP_TO_EDGE);H.activeTexture.set(K.TEXTURE0);let Be=o.fbo;if(!Be){const Ye=new dn(H,{width:he,height:he,data:null},K.RGBA);Ye.bind(K.LINEAR,K.CLAMP_TO_EDGE),Be=o.fbo=H.createFramebuffer(he,he,!0,!1),Be.colorAttachment.set(Ye.texture)}H.bindFramebuffer.set(Be.framebuffer),H.viewport.set([0,0,he,he]),L.useProgram("hillshadePrepare").draw(H,K.TRIANGLES,A,I,P,ys.disabled,((Ye,st)=>{const vt=st.stride,Et=n.H();return n.aP(Et,0,n.X,-n.X,0,0,1),n.J(Et,Et,[0,-n.X,0]),{u_matrix:Et,u_image:1,u_dimension:[vt,vt],u_zoom:Ye.overscaledZ,u_unpack:st.getUnpackVector()}})(o.tileID,ne),null,x.id,L.rasterBoundsBuffer,L.quadTriangleIndexBuffer,L.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function Mf(L,o,x,A,I,P){const H=A.paint.get("raster-fade-duration");if(!P&&H>0){const K=ut.now(),ne=(K-L.timeAdded)/H,he=o?(K-o.timeAdded)/H:-1,be=x.getSource(),we=I.coveringZoomLevel({tileSize:be.tileSize,roundZoom:be.roundZoom}),Be=!o||Math.abs(o.tileID.overscaledZ-we)>Math.abs(L.tileID.overscaledZ-we),Ye=Be&&L.refreshedUponExpiration?1:n.ac(Be?ne:1-he,0,1);return L.refreshedUponExpiration&&ne>=1&&(L.refreshedUponExpiration=!1),o?{opacity:1,mix:1-Ye}:{opacity:Ye,mix:0}}return{opacity:1,mix:0}}const ds=new n.aM(1,0,0,1),Ua=new n.aM(0,1,0,1),uc=new n.aM(0,0,1,1),Qf=new n.aM(1,0,1,1),sh=new n.aM(0,1,1,1);function gl(L,o,x,A){ep(L,0,o+x/2,L.transform.width,x,A)}function sd(L,o,x,A){ep(L,o-x/2,0,x,L.transform.height,A)}function ep(L,o,x,A,I,P){const H=L.context,K=H.gl;K.enable(K.SCISSOR_TEST),K.scissor(o*L.pixelRatio,x*L.pixelRatio,A*L.pixelRatio,I*L.pixelRatio),H.clear({color:P}),K.disable(K.SCISSOR_TEST)}function du(L,o,x){const A=L.context,I=A.gl,P=x.posMatrix,H=L.useProgram("debug"),K=ga.disabled,ne=Is.disabled,he=L.colorModeForRenderPass(),be="$debug",we=L.style.map.terrain&&L.style.map.terrain.getTerrainData(x);A.activeTexture.set(I.TEXTURE0);const Be=o.getTileByID(x.key).latestRawTileData,Ye=Math.floor((Be&&Be.byteLength||0)/1024),st=o.getTile(x).tileSize,vt=512/Math.min(st,512)*(x.overscaledZ/L.transform.zoom)*.5;let Et=x.canonical.toString();x.overscaledZ!==x.canonical.z&&(Et+=` => ${x.overscaledZ}`),(function(Ct,Lt){Ct.initDebugOverlayCanvas();const _t=Ct.debugOverlayCanvas,Ht=Ct.context.gl,Qt=Ct.debugOverlayCanvas.getContext("2d");Qt.clearRect(0,0,_t.width,_t.height),Qt.shadowColor="white",Qt.shadowBlur=2,Qt.lineWidth=1.5,Qt.strokeStyle="white",Qt.textBaseline="top",Qt.font="bold 36px Open Sans, sans-serif",Qt.fillText(Lt,5,5),Qt.strokeText(Lt,5,5),Ct.debugOverlayTexture.update(_t),Ct.debugOverlayTexture.bind(Ht.LINEAR,Ht.CLAMP_TO_EDGE)})(L,`${Et} ${Ye}kB`),H.draw(A,I.TRIANGLES,K,ne,po.alphaBlended,ys.disabled,Xl(P,n.aM.transparent,vt),null,be,L.debugBuffer,L.quadTriangleIndexBuffer,L.debugSegments),H.draw(A,I.LINE_STRIP,K,ne,he,ys.disabled,Xl(P,n.aM.red),we,be,L.debugBuffer,L.tileBorderIndexBuffer,L.debugSegments)}function od(L,o,x){const A=L.context,I=A.gl,P=L.colorModeForRenderPass(),H=new ga(I.LEQUAL,ga.ReadWrite,L.depthRangeFor3D),K=L.useProgram("terrain"),ne=o.getTerrainMesh();A.bindFramebuffer.set(null),A.viewport.set([0,0,L.width,L.height]);for(const he of x){const be=L.renderToTexture.getTexture(he),we=o.getTerrainData(he.tileID);A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,be.texture);const Be=L.transform.calculatePosMatrix(he.tileID.toUnwrapped()),Ye=o.getMeshFrameDelta(L.transform.zoom),st=L.transform.calculateFogMatrix(he.tileID.toUnwrapped()),vt=Ks(Be,Ye,st,L.style.sky,L.transform.pitch);K.draw(A,I.TRIANGLES,H,Is.disabled,P,ys.backCCW,vt,we,"terrain",ne.vertexBuffer,ne.indexBuffer,ne.segments)}}class fu{constructor(o,x,A){this.vertexBuffer=o,this.indexBuffer=x,this.segments=A}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Lc{constructor(o,x){this.context=new Pl(o),this.transform=x,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:n.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ar.maxUnderzooming+ar.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ro}resize(o,x,A){if(this.width=Math.floor(o*A),this.height=Math.floor(x*A),this.pixelRatio=A,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const I of this.style._order)this.style._layers[I].resize()}setup(){const o=this.context,x=new n.aX;x.emplaceBack(0,0),x.emplaceBack(n.X,0),x.emplaceBack(0,n.X),x.emplaceBack(n.X,n.X),this.tileExtentBuffer=o.createVertexBuffer(x,es.members),this.tileExtentSegments=n.a0.simpleSegment(0,0,4,2);const A=new n.aX;A.emplaceBack(0,0),A.emplaceBack(n.X,0),A.emplaceBack(0,n.X),A.emplaceBack(n.X,n.X),this.debugBuffer=o.createVertexBuffer(A,es.members),this.debugSegments=n.a0.simpleSegment(0,0,4,5);const I=new n.$;I.emplaceBack(0,0,0,0),I.emplaceBack(n.X,0,n.X,0),I.emplaceBack(0,n.X,0,n.X),I.emplaceBack(n.X,n.X,n.X,n.X),this.rasterBoundsBuffer=o.createVertexBuffer(I,ho.members),this.rasterBoundsSegments=n.a0.simpleSegment(0,0,4,2);const P=new n.aX;P.emplaceBack(0,0),P.emplaceBack(1,0),P.emplaceBack(0,1),P.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(P,es.members),this.viewportSegments=n.a0.simpleSegment(0,0,4,2);const H=new n.aZ;H.emplaceBack(0),H.emplaceBack(1),H.emplaceBack(3),H.emplaceBack(2),H.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(H);const K=new n.aY;K.emplaceBack(0,1,2),K.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(K);const ne=this.context.gl;this.stencilClearMode=new Is({func:ne.ALWAYS,mask:0},0,255,ne.ZERO,ne.ZERO,ne.ZERO)}clearStencil(){const o=this.context,x=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const A=n.H();n.aP(A,0,this.width,this.height,0,0,1),n.K(A,A,[x.drawingBufferWidth,x.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,x.TRIANGLES,ga.disabled,this.stencilClearMode,po.disabled,ys.disabled,Po(A),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,x){if(this.currentStencilSource===o.source||!o.isTileClipped()||!x||!x.length)return;this.currentStencilSource=o.source;const A=this.context,I=A.gl;this.nextStencilID+x.length>256&&this.clearStencil(),A.setColorMode(po.disabled),A.setDepthMode(ga.disabled);const P=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const H of x){const K=this._tileClippingMaskIDs[H.key]=this.nextStencilID++,ne=this.style.map.terrain&&this.style.map.terrain.getTerrainData(H);P.draw(A,I.TRIANGLES,ga.disabled,new Is({func:I.ALWAYS,mask:0},K,255,I.KEEP,I.KEEP,I.REPLACE),po.disabled,ys.disabled,Po(H.posMatrix),ne,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,x=this.context.gl;return new Is({func:x.NOTEQUAL,mask:255},o,255,x.KEEP,x.KEEP,x.REPLACE)}stencilModeForClipping(o){const x=this.context.gl;return new Is({func:x.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,x.KEEP,x.KEEP,x.REPLACE)}stencilConfigForOverlap(o){const x=this.context.gl,A=o.sort(((H,K)=>K.overscaledZ-H.overscaledZ)),I=A[A.length-1].overscaledZ,P=A[0].overscaledZ-I+1;if(P>1){this.currentStencilSource=void 0,this.nextStencilID+P>256&&this.clearStencil();const H={};for(let K=0;K<P;K++)H[K+I]=new Is({func:x.GEQUAL,mask:255},K+this.nextStencilID,255,x.KEEP,x.KEEP,x.REPLACE);return this.nextStencilID+=P,[H,A]}return[{[I]:Is.disabled},A]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new po([o.CONSTANT_COLOR,o.ONE],new n.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?po.unblended:po.alphaBlended}depthModeForSublayer(o,x,A){if(!this.opaquePassEnabledForLayer())return ga.disabled;const I=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new ga(A||this.context.gl.LEQUAL,x,[I,I])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,x){this.style=o,this.options=x,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(ut.now()),this.imageManager.beginFrame();const A=this.style._order,I=this.style.sourceCaches,P={},H={},K={};for(const ne in I){const he=I[ne];he.used&&he.prepare(this.context),P[ne]=he.getVisibleCoordinates(),H[ne]=P[ne].slice().reverse(),K[ne]=he.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ne=0;ne<A.length;ne++)if(this.style._layers[A[ne]].is3D()){this.opaquePassCutoff=ne;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const ne of A){const he=this.style._layers[ne];if(!he.hasOffscreenPass()||he.isHidden(this.transform.zoom))continue;const be=H[he.source];(he.type==="custom"||be.length)&&this.renderLayer(this,I[he.source],he,be)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:x.showOverdrawInspector?n.aM.black:n.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&(function(ne,he){const be=ne.context,we=be.gl,Be=((Ct,Lt,_t)=>({u_sky_color:Ct.properties.get("sky-color"),u_horizon_color:Ct.properties.get("horizon-color"),u_horizon:(Lt.height/2+Lt.getHorizon())*_t,u_sky_horizon_blend:Ct.properties.get("sky-horizon-blend")*Lt.height/2*_t}))(he,ne.style.map.transform,ne.pixelRatio),Ye=new ga(we.LEQUAL,ga.ReadWrite,[0,1]),st=Is.disabled,vt=ne.colorModeForRenderPass(),Et=ne.useProgram("sky");if(!he.mesh){const Ct=new n.aX;Ct.emplaceBack(-1,-1),Ct.emplaceBack(1,-1),Ct.emplaceBack(1,1),Ct.emplaceBack(-1,1);const Lt=new n.aY;Lt.emplaceBack(0,1,2),Lt.emplaceBack(0,2,3),he.mesh=new fu(be.createVertexBuffer(Ct,es.members),be.createIndexBuffer(Lt),n.a0.simpleSegment(0,0,Ct.length,Lt.length))}Et.draw(be,we.TRIANGLES,Ye,st,vt,ys.disabled,Be,void 0,"sky",he.mesh.vertexBuffer,he.mesh.indexBuffer,he.mesh.segments)})(this,this.style.sky),this._showOverdrawInspector=x.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=A.length-1;this.currentLayer>=0;this.currentLayer--){const ne=this.style._layers[A[this.currentLayer]],he=I[ne.source],be=P[ne.source];this._renderTileClippingMasks(ne,be),this.renderLayer(this,he,ne,be)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const ne=this.style._layers[A[this.currentLayer]],he=I[ne.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ne))continue;const be=(ne.type==="symbol"?K:H)[ne.source];this._renderTileClippingMasks(ne,P[ne.source]),this.renderLayer(this,he,ne,be)}if(this.options.showTileBoundaries){const ne=(function(he,be){let we=null;const Be=Object.values(he._layers).flatMap((Et=>Et.source&&!Et.isHidden(be)?[he.sourceCaches[Et.source]]:[])),Ye=Be.filter((Et=>Et.getSource().type==="vector")),st=Be.filter((Et=>Et.getSource().type!=="vector")),vt=Et=>{(!we||we.getSource().maxzoom<Et.getSource().maxzoom)&&(we=Et)};return Ye.forEach((Et=>vt(Et))),we||st.forEach((Et=>vt(Et))),we})(this.style,this.transform.zoom);ne&&(function(he,be,we){for(let Be=0;Be<we.length;Be++)du(he,be,we[Be])})(this,ne,ne.getVisibleCoordinates())}this.options.showPadding&&(function(ne){const he=ne.transform.padding;gl(ne,ne.transform.height-(he.top||0),3,ds),gl(ne,he.bottom||0,3,Ua),sd(ne,he.left||0,3,uc),sd(ne,ne.transform.width-(he.right||0),3,Qf);const be=ne.transform.centerPoint;(function(we,Be,Ye,st){ep(we,Be-1,Ye-10,2,20,st),ep(we,Be-10,Ye-1,20,2,st)})(ne,be.x,ne.transform.height-be.y,sh)})(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const x=this.terrainFacilitator.matrix,A=this.transform.modelViewProjectionMatrix;let I=this.terrainFacilitator.dirty;I||(I=o?!n.a_(x,A):!n.a$(x,A)),I||(I=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),I&&(n.b0(x,A),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,(function(P,H){const K=P.context,ne=K.gl,he=po.unblended,be=new ga(ne.LEQUAL,ga.ReadWrite,[0,1]),we=H.getTerrainMesh(),Be=H.sourceCache.getRenderableTiles(),Ye=P.useProgram("terrainDepth");K.bindFramebuffer.set(H.getFramebuffer("depth").framebuffer),K.viewport.set([0,0,P.width/devicePixelRatio,P.height/devicePixelRatio]),K.clear({color:n.aM.transparent,depth:1});for(const st of Be){const vt=H.getTerrainData(st.tileID),Et={u_matrix:P.transform.calculatePosMatrix(st.tileID.toUnwrapped()),u_ele_delta:H.getMeshFrameDelta(P.transform.zoom)};Ye.draw(K,ne.TRIANGLES,be,Is.disabled,he,ys.backCCW,Et,vt,"terrain",we.vertexBuffer,we.indexBuffer,we.segments)}K.bindFramebuffer.set(null),K.viewport.set([0,0,P.width,P.height])})(this,this.style.map.terrain),(function(P,H){const K=P.context,ne=K.gl,he=po.unblended,be=new ga(ne.LEQUAL,ga.ReadWrite,[0,1]),we=H.getTerrainMesh(),Be=H.getCoordsTexture(),Ye=H.sourceCache.getRenderableTiles(),st=P.useProgram("terrainCoords");K.bindFramebuffer.set(H.getFramebuffer("coords").framebuffer),K.viewport.set([0,0,P.width/devicePixelRatio,P.height/devicePixelRatio]),K.clear({color:n.aM.transparent,depth:1}),H.coordsIndex=[];for(const vt of Ye){const Et=H.getTerrainData(vt.tileID);K.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,Be.texture);const Ct={u_matrix:P.transform.calculatePosMatrix(vt.tileID.toUnwrapped()),u_terrain_coords_id:(255-H.coordsIndex.length)/255,u_texture:0,u_ele_delta:H.getMeshFrameDelta(P.transform.zoom)};st.draw(K,ne.TRIANGLES,be,Is.disabled,he,ys.backCCW,Ct,Et,"terrain",we.vertexBuffer,we.indexBuffer,we.segments),H.coordsIndex.push(vt.tileID.key)}K.bindFramebuffer.set(null),K.viewport.set([0,0,P.width,P.height])})(this,this.style.map.terrain))}renderLayer(o,x,A,I){if(!A.isHidden(this.transform.zoom)&&(A.type==="background"||A.type==="custom"||(I||[]).length))switch(this.id=A.id,A.type){case"symbol":(function(P,H,K,ne,he){if(P.renderPass!=="translucent")return;const be=Is.disabled,we=P.colorModeForRenderPass();(K._unevaluatedLayout.hasValue("text-variable-anchor")||K._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&(function(Be,Ye,st,vt,Et,Ct,Lt,_t,Ht){const Qt=Ye.transform,oi=js(),$i=Et==="map",An=Ct==="map";for(const Mn of Be){const Zn=vt.getTile(Mn),Ln=Zn.getBucket(st);if(!Ln||!Ln.text||!Ln.text.segments.get().length)continue;const zn=n.ag(Ln.textSizeData,Qt.zoom),ir=ze(Zn,1,Ye.transform.zoom),$r=lc(Mn.posMatrix,An,$i,Ye.transform,ir),On=st.layout.get("icon-text-fit")!=="none"&&Ln.hasIconData();if(zn){const qn=Math.pow(2,Qt.zoom-Zn.tileID.overscaledZ),Yr=Ye.style.map.terrain?(Ma,Za)=>Ye.style.map.terrain.getElevation(Mn,Ma,Za):null,Qa=oi.translatePosition(Qt,Zn,Lt,_t);Jl(Ln,$i,An,Ht,Qt,$r,Mn.posMatrix,qn,zn,On,oi,Qa,Mn.toUnwrapped(),Yr)}}})(ne,P,K,H,K.layout.get("text-rotation-alignment"),K.layout.get("text-pitch-alignment"),K.paint.get("text-translate"),K.paint.get("text-translate-anchor"),he),K.paint.get("icon-opacity").constantOr(1)!==0&&cr(P,H,K,ne,!1,K.paint.get("icon-translate"),K.paint.get("icon-translate-anchor"),K.layout.get("icon-rotation-alignment"),K.layout.get("icon-pitch-alignment"),K.layout.get("icon-keep-upright"),be,we),K.paint.get("text-opacity").constantOr(1)!==0&&cr(P,H,K,ne,!0,K.paint.get("text-translate"),K.paint.get("text-translate-anchor"),K.layout.get("text-rotation-alignment"),K.layout.get("text-pitch-alignment"),K.layout.get("text-keep-upright"),be,we),H.map.showCollisionBoxes&&(Ll(P,H,K,ne,!0),Ll(P,H,K,ne,!1))})(o,x,A,I,this.style.placement.variableOffsets);break;case"circle":(function(P,H,K,ne){if(P.renderPass!=="translucent")return;const he=K.paint.get("circle-opacity"),be=K.paint.get("circle-stroke-width"),we=K.paint.get("circle-stroke-opacity"),Be=!K.layout.get("circle-sort-key").isConstant();if(he.constantOr(1)===0&&(be.constantOr(1)===0||we.constantOr(1)===0))return;const Ye=P.context,st=Ye.gl,vt=P.depthModeForSublayer(0,ga.ReadOnly),Et=Is.disabled,Ct=P.colorModeForRenderPass(),Lt=[];for(let _t=0;_t<ne.length;_t++){const Ht=ne[_t],Qt=H.getTile(Ht),oi=Qt.getBucket(K);if(!oi)continue;const $i=oi.programConfigurations.get(K.id),An=P.useProgram("circle",$i),Mn=oi.layoutVertexBuffer,Zn=oi.indexBuffer,Ln=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Ht),zn={programConfiguration:$i,program:An,layoutVertexBuffer:Mn,indexBuffer:Zn,uniformValues:Cc(P,Ht,Qt,K),terrainData:Ln};if(Be){const ir=oi.segments.get();for(const $r of ir)Lt.push({segments:new n.a0([$r]),sortKey:$r.sortKey,state:zn})}else Lt.push({segments:oi.segments,sortKey:0,state:zn})}Be&&Lt.sort(((_t,Ht)=>_t.sortKey-Ht.sortKey));for(const _t of Lt){const{programConfiguration:Ht,program:Qt,layoutVertexBuffer:oi,indexBuffer:$i,uniformValues:An,terrainData:Mn}=_t.state;Qt.draw(Ye,st.TRIANGLES,vt,Et,Ct,ys.disabled,An,Mn,K.id,oi,$i,_t.segments,K.paint,P.transform.zoom,Ht)}})(o,x,A,I);break;case"heatmap":(function(P,H,K,ne){if(K.paint.get("heatmap-opacity")===0)return;const he=P.context;if(P.style.map.terrain){for(const be of ne){const we=H.getTile(be);H.hasRenderableParent(be)||(P.renderPass==="offscreen"?ad(P,we,K,be):P.renderPass==="translucent"&&Un(P,K,be))}he.viewport.set([0,0,P.width,P.height])}else P.renderPass==="offscreen"?(function(be,we,Be,Ye){const st=be.context,vt=st.gl,Et=Is.disabled,Ct=new po([vt.ONE,vt.ONE],n.aM.transparent,[!0,!0,!0,!0]);(function(Lt,_t,Ht){const Qt=Lt.gl;Lt.activeTexture.set(Qt.TEXTURE1),Lt.viewport.set([0,0,_t.width/4,_t.height/4]);let oi=Ht.heatmapFbos.get(n.aU);oi?(Qt.bindTexture(Qt.TEXTURE_2D,oi.colorAttachment.get()),Lt.bindFramebuffer.set(oi.framebuffer)):(oi=ku(Lt,_t.width/4,_t.height/4),Ht.heatmapFbos.set(n.aU,oi))})(st,be,Be),st.clear({color:n.aM.transparent});for(let Lt=0;Lt<Ye.length;Lt++){const _t=Ye[Lt];if(we.hasRenderableParent(_t))continue;const Ht=we.getTile(_t),Qt=Ht.getBucket(Be);if(!Qt)continue;const oi=Qt.programConfigurations.get(Be.id),$i=be.useProgram("heatmap",oi),{zoom:An}=be.transform;$i.draw(st,vt.TRIANGLES,ga.disabled,Et,Ct,ys.disabled,Eo(_t.posMatrix,Ht,An,Be.paint.get("heatmap-intensity")),null,Be.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Qt.segments,Be.paint,be.transform.zoom,oi)}st.viewport.set([0,0,be.width,be.height])})(P,H,K,ne):P.renderPass==="translucent"&&(function(be,we){const Be=be.context,Ye=Be.gl;Be.setColorMode(be.colorModeForRenderPass());const st=we.heatmapFbos.get(n.aU);st&&(Be.activeTexture.set(Ye.TEXTURE0),Ye.bindTexture(Ye.TEXTURE_2D,st.colorAttachment.get()),Be.activeTexture.set(Ye.TEXTURE1),Ph(Be,we).bind(Ye.LINEAR,Ye.CLAMP_TO_EDGE),be.useProgram("heatmapTexture").draw(Be,Ye.TRIANGLES,ga.disabled,Is.disabled,be.colorModeForRenderPass(),ys.disabled,cu(be,we,0,1),null,we.id,be.viewportBuffer,be.quadTriangleIndexBuffer,be.viewportSegments,we.paint,be.transform.zoom))})(P,K)})(o,x,A,I);break;case"line":(function(P,H,K,ne){if(P.renderPass!=="translucent")return;const he=K.paint.get("line-opacity"),be=K.paint.get("line-width");if(he.constantOr(1)===0||be.constantOr(1)===0)return;const we=P.depthModeForSublayer(0,ga.ReadOnly),Be=P.colorModeForRenderPass(),Ye=K.paint.get("line-dasharray"),st=K.paint.get("line-pattern"),vt=st.constantOr(1),Et=K.paint.get("line-gradient"),Ct=K.getCrossfadeParameters(),Lt=vt?"linePattern":Ye?"lineSDF":Et?"lineGradient":"line",_t=P.context,Ht=_t.gl;let Qt=!0;for(const oi of ne){const $i=H.getTile(oi);if(vt&&!$i.patternsLoaded())continue;const An=$i.getBucket(K);if(!An)continue;const Mn=An.programConfigurations.get(K.id),Zn=P.context.program.get(),Ln=P.useProgram(Lt,Mn),zn=Qt||Ln.program!==Zn,ir=P.style.map.terrain&&P.style.map.terrain.getTerrainData(oi),$r=st.constantOr(null);if($r&&$i.imageAtlas){const Yr=$i.imageAtlas,Qa=Yr.patternPositions[$r.to.toString()],Ma=Yr.patternPositions[$r.from.toString()];Qa&&Ma&&Mn.setConstantPatternPositions(Qa,Ma)}const On=ir?oi:null,qn=vt?zc(P,$i,K,Ct,On):Ye?Go(P,$i,K,Ye,Ct,On):Et?Kf(P,$i,K,An.lineClipsArray.length,On):Ch(P,$i,K,On);if(vt)_t.activeTexture.set(Ht.TEXTURE0),$i.imageAtlasTexture.bind(Ht.LINEAR,Ht.CLAMP_TO_EDGE),Mn.updatePaintBuffers(Ct);else if(Ye&&(zn||P.lineAtlas.dirty))_t.activeTexture.set(Ht.TEXTURE0),P.lineAtlas.bind(_t);else if(Et){const Yr=An.gradients[K.id];let Qa=Yr.texture;if(K.gradientVersion!==Yr.version){let Ma=256;if(K.stepInterpolant){const Za=H.getSource().maxzoom,Ls=oi.canonical.z===Za?Math.ceil(1<<P.transform.maxZoom-oi.canonical.z):1;Ma=n.ac(n.aV(An.maxLineLength/n.X*1024*Ls),256,_t.maxTextureSize)}Yr.gradient=n.aW({expression:K.gradientExpression(),evaluationKey:"lineProgress",resolution:Ma,image:Yr.gradient||void 0,clips:An.lineClipsArray}),Yr.texture?Yr.texture.update(Yr.gradient):Yr.texture=new dn(_t,Yr.gradient,Ht.RGBA),Yr.version=K.gradientVersion,Qa=Yr.texture}_t.activeTexture.set(Ht.TEXTURE0),Qa.bind(K.stepInterpolant?Ht.NEAREST:Ht.LINEAR,Ht.CLAMP_TO_EDGE)}Ln.draw(_t,Ht.TRIANGLES,we,P.stencilModeForClipping(oi),Be,ys.disabled,qn,ir,K.id,An.layoutVertexBuffer,An.indexBuffer,An.segments,K.paint,P.transform.zoom,Mn,An.layoutVertexBuffer2),Qt=!1}})(o,x,A,I);break;case"fill":(function(P,H,K,ne){const he=K.paint.get("fill-color"),be=K.paint.get("fill-opacity");if(be.constantOr(1)===0)return;const we=P.colorModeForRenderPass(),Be=K.paint.get("fill-pattern"),Ye=P.opaquePassEnabledForLayer()&&!Be.constantOr(1)&&he.constantOr(n.aM.transparent).a===1&&be.constantOr(0)===1?"opaque":"translucent";if(P.renderPass===Ye){const st=P.depthModeForSublayer(1,P.renderPass==="opaque"?ga.ReadWrite:ga.ReadOnly);Pc(P,H,K,ne,st,we,!1)}if(P.renderPass==="translucent"&&K.paint.get("fill-antialias")){const st=P.depthModeForSublayer(K.getPaintProperty("fill-outline-color")?2:0,ga.ReadOnly);Pc(P,H,K,ne,st,we,!0)}})(o,x,A,I);break;case"fill-extrusion":(function(P,H,K,ne){const he=K.paint.get("fill-extrusion-opacity");if(he!==0&&P.renderPass==="translucent"){const be=new ga(P.context.gl.LEQUAL,ga.ReadWrite,P.depthRangeFor3D);if(he!==1||K.paint.get("fill-extrusion-pattern").constantOr(1))Xd(P,H,K,ne,be,Is.disabled,po.disabled),Xd(P,H,K,ne,be,P.stencilModeFor3D(),P.colorModeForRenderPass());else{const we=P.colorModeForRenderPass();Xd(P,H,K,ne,be,Is.disabled,we)}}})(o,x,A,I);break;case"hillshade":(function(P,H,K,ne){if(P.renderPass!=="offscreen"&&P.renderPass!=="translucent")return;const he=P.context,be=P.depthModeForSublayer(0,ga.ReadOnly),we=P.colorModeForRenderPass(),[Be,Ye]=P.renderPass==="translucent"?P.stencilConfigForOverlap(ne):[{},ne];for(const st of Ye){const vt=H.getTile(st);vt.needsHillshadePrepare!==void 0&&vt.needsHillshadePrepare&&P.renderPass==="offscreen"?$o(P,vt,K,be,Is.disabled,we):P.renderPass==="translucent"&&Lh(P,st,vt,K,be,Be[st.overscaledZ],we)}he.viewport.set([0,0,P.width,P.height])})(o,x,A,I);break;case"raster":(function(P,H,K,ne){if(P.renderPass!=="translucent"||K.paint.get("raster-opacity")===0||!ne.length)return;const he=P.context,be=he.gl,we=H.getSource(),Be=P.useProgram("raster"),Ye=P.colorModeForRenderPass(),[st,vt]=we instanceof Vo?[{},ne]:P.stencilConfigForOverlap(ne),Et=vt[vt.length-1].overscaledZ,Ct=!P.options.moving;for(const Lt of vt){const _t=P.depthModeForSublayer(Lt.overscaledZ-Et,K.paint.get("raster-opacity")===1?ga.ReadWrite:ga.ReadOnly,be.LESS),Ht=H.getTile(Lt);Ht.registerFadeDuration(K.paint.get("raster-fade-duration"));const Qt=H.findLoadedParent(Lt,0),oi=H.findLoadedSibling(Lt),$i=Mf(Ht,Qt||oi||null,H,K,P.transform,P.style.map.terrain);let An,Mn;const Zn=K.paint.get("raster-resampling")==="nearest"?be.NEAREST:be.LINEAR;he.activeTexture.set(be.TEXTURE0),Ht.texture.bind(Zn,be.CLAMP_TO_EDGE,be.LINEAR_MIPMAP_NEAREST),he.activeTexture.set(be.TEXTURE1),Qt?(Qt.texture.bind(Zn,be.CLAMP_TO_EDGE,be.LINEAR_MIPMAP_NEAREST),An=Math.pow(2,Qt.tileID.overscaledZ-Ht.tileID.overscaledZ),Mn=[Ht.tileID.canonical.x*An%1,Ht.tileID.canonical.y*An%1]):Ht.texture.bind(Zn,be.CLAMP_TO_EDGE,be.LINEAR_MIPMAP_NEAREST),Ht.texture.useMipmap&&he.extTextureFilterAnisotropic&&P.transform.pitch>20&&be.texParameterf(be.TEXTURE_2D,he.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,he.extTextureFilterAnisotropicMax);const Ln=P.style.map.terrain&&P.style.map.terrain.getTerrainData(Lt),zn=Ln?Lt:null,ir=zn?zn.posMatrix:P.transform.calculatePosMatrix(Lt.toUnwrapped(),Ct),$r=Wl(ir,Mn||[0,0],An||1,$i,K);we instanceof Vo?Be.draw(he,be.TRIANGLES,_t,Is.disabled,Ye,ys.disabled,$r,Ln,K.id,we.boundsBuffer,P.quadTriangleIndexBuffer,we.boundsSegments):Be.draw(he,be.TRIANGLES,_t,st[Lt.overscaledZ],Ye,ys.disabled,$r,Ln,K.id,P.rasterBoundsBuffer,P.quadTriangleIndexBuffer,P.rasterBoundsSegments)}})(o,x,A,I);break;case"background":(function(P,H,K,ne){const he=K.paint.get("background-color"),be=K.paint.get("background-opacity");if(be===0)return;const we=P.context,Be=we.gl,Ye=P.transform,st=Ye.tileSize,vt=K.paint.get("background-pattern");if(P.isPatternMissing(vt))return;const Et=!vt&&he.a===1&&be===1&&P.opaquePassEnabledForLayer()?"opaque":"translucent";if(P.renderPass!==Et)return;const Ct=Is.disabled,Lt=P.depthModeForSublayer(0,Et==="opaque"?ga.ReadWrite:ga.ReadOnly),_t=P.colorModeForRenderPass(),Ht=P.useProgram(vt?"backgroundPattern":"background"),Qt=ne||Ye.coveringTiles({tileSize:st,terrain:P.style.map.terrain});vt&&(we.activeTexture.set(Be.TEXTURE0),P.imageManager.bind(P.context));const oi=K.getCrossfadeParameters();for(const $i of Qt){const An=ne?$i.posMatrix:P.transform.calculatePosMatrix($i.toUnwrapped()),Mn=vt?$d(An,be,P,vt,{tileID:$i,tileSize:st},oi):ah(An,be,he),Zn=P.style.map.terrain&&P.style.map.terrain.getTerrainData($i);Ht.draw(we,Be.TRIANGLES,Lt,Ct,_t,ys.disabled,Mn,Zn,K.id,P.tileExtentBuffer,P.quadTriangleIndexBuffer,P.tileExtentSegments)}})(o,0,A,I);break;case"custom":(function(P,H,K){const ne=P.context,he=K.implementation;if(P.renderPass==="offscreen"){const be=he.prerender;be&&(P.setCustomLayerDefaults(),ne.setColorMode(P.colorModeForRenderPass()),be.call(he,ne.gl,P.transform.customLayerMatrix()),ne.setDirty(),P.setBaseState())}else if(P.renderPass==="translucent"){P.setCustomLayerDefaults(),ne.setColorMode(P.colorModeForRenderPass()),ne.setStencilMode(Is.disabled);const be=he.renderingMode==="3d"?new ga(P.context.gl.LEQUAL,ga.ReadWrite,P.depthRangeFor3D):P.depthModeForSublayer(0,ga.ReadOnly);ne.setDepthMode(be),he.render(ne.gl,P.transform.customLayerMatrix(),{farZ:P.transform.farZ,nearZ:P.transform.nearZ,fov:P.transform._fov,modelViewProjectionMatrix:P.transform.modelViewProjectionMatrix,projectionMatrix:P.transform.projectionMatrix}),ne.setDirty(),P.setBaseState(),ne.bindFramebuffer.set(null)}})(o,0,A)}}translatePosMatrix(o,x,A,I,P){if(!A[0]&&!A[1])return o;const H=P?I==="map"?this.transform.angle:0:I==="viewport"?-this.transform.angle:0;if(H){const he=Math.sin(H),be=Math.cos(H);A=[A[0]*be-A[1]*he,A[0]*he+A[1]*be]}const K=[P?A[0]:ze(x,A[0],this.transform.zoom),P?A[1]:ze(x,A[1],this.transform.zoom),0],ne=new Float32Array(16);return n.J(ne,o,K),ne}saveTileTexture(o){const x=this._tileTextures[o.size[0]];x?x.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const x=this._tileTextures[o];return x&&x.length>0?x.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const x=this.imageManager.getPattern(o.from.toString()),A=this.imageManager.getPattern(o.to.toString());return!x||!A}useProgram(o,x){this.cache=this.cache||{};const A=o+(x?x.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[A]||(this.cache[A]=new Mh(this.context,jo[o],x,Cl[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new dn(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:x}=this.context.gl;return this.width!==o||this.height!==x}}class kc{constructor(o,x){this.points=o,this.planes=x}static fromInvProjectionMatrix(o,x,A){const I=Math.pow(2,A),P=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((K=>{const ne=1/(K=n.af([],K,o))[3]/x*I;return n.b1(K,K,[ne,ne,1/K[3],ne])})),H=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((K=>{const ne=(function(Be,Ye){var st=Ye[0],vt=Ye[1],Et=Ye[2],Ct=st*st+vt*vt+Et*Et;return Ct>0&&(Ct=1/Math.sqrt(Ct)),Be[0]=Ye[0]*Ct,Be[1]=Ye[1]*Ct,Be[2]=Ye[2]*Ct,Be})([],(function(Be,Ye,st){var vt=Ye[0],Et=Ye[1],Ct=Ye[2],Lt=st[0],_t=st[1],Ht=st[2];return Be[0]=Et*Ht-Ct*_t,Be[1]=Ct*Lt-vt*Ht,Be[2]=vt*_t-Et*Lt,Be})([],qi([],P[K[0]],P[K[1]]),qi([],P[K[2]],P[K[1]]))),he=-((be=ne)[0]*(we=P[K[1]])[0]+be[1]*we[1]+be[2]*we[2]);var be,we;return ne.concat(he)}));return new kc(P,H)}}class pu{constructor(o,x){this.min=o,this.max=x,this.center=(function(A,I,P){return A[0]=.5*I[0],A[1]=.5*I[1],A[2]=.5*I[2],A})([],(function(A,I,P){return A[0]=I[0]+P[0],A[1]=I[1]+P[1],A[2]=I[2]+P[2],A})([],this.min,this.max))}quadrant(o){const x=[o%2==0,o<2],A=Oi(this.min),I=Oi(this.max);for(let P=0;P<x.length;P++)A[P]=x[P]?this.min[P]:this.center[P],I[P]=x[P]?this.center[P]:this.max[P];return I[2]=this.max[2],new pu(A,I)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const x=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let A=!0;for(let I=0;I<o.planes.length;I++){const P=o.planes[I];let H=0;for(let K=0;K<x.length;K++)n.b2(P,x[K])>=0&&H++;if(H===0)return 0;H!==x.length&&(A=!1)}if(A)return 2;for(let I=0;I<3;I++){let P=Number.MAX_VALUE,H=-Number.MAX_VALUE;for(let K=0;K<o.points.length;K++){const ne=o.points[K][I]-this.min[I];P=Math.min(P,ne),H=Math.max(H,ne)}if(H<0||P>this.max[I]-this.min[I])return 0}return 1}}class Xc{constructor(o=0,x=0,A=0,I=0){if(isNaN(o)||o<0||isNaN(x)||x<0||isNaN(A)||A<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=x,this.left=A,this.right=I}interpolate(o,x,A){return x.top!=null&&o.top!=null&&(this.top=n.y.number(o.top,x.top,A)),x.bottom!=null&&o.bottom!=null&&(this.bottom=n.y.number(o.bottom,x.bottom,A)),x.left!=null&&o.left!=null&&(this.left=n.y.number(o.left,x.left,A)),x.right!=null&&o.right!=null&&(this.right=n.y.number(o.right,x.right,A)),this}getCenter(o,x){const A=n.ac((this.left+o-this.right)/2,0,o),I=n.ac((this.top+x-this.bottom)/2,0,x);return new n.P(A,I)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Xc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Cf=85.051129;class ld{constructor(o,x,A,I,P){this.tileSize=512,this._renderWorldCopies=P===void 0||!!P,this._minZoom=o||0,this._maxZoom=x||22,this._minPitch=A??0,this._maxPitch=I??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new n.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Xc,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new ld(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.lngRange=o.lngRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const x=-n.b3(o,-180,180)*Math.PI/180;this.angle!==x&&(this._unmodified=!1,this.angle=x,this._calcMatrices(),this.rotationMatrix=(function(){var A=new n.A(4);return n.A!=Float32Array&&(A[1]=0,A[2]=0),A[0]=1,A[3]=1,A})(),(function(A,I,P){var H=I[0],K=I[1],ne=I[2],he=I[3],be=Math.sin(P),we=Math.cos(P);A[0]=H*we+ne*be,A[1]=K*we+he*be,A[2]=H*-be+ne*we,A[3]=K*-be+he*we})(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const x=n.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==x&&(this._unmodified=!1,this._pitch=x,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const x=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==x&&(this._unmodified=!1,this._zoom=x,this.tileZoom=Math.max(0,Math.floor(x)),this.scale=this.zoomScale(x),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,x,A){this._unmodified=!1,this._edgeInsets.interpolate(o,x,A),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const x=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,x)}getVisibleUnwrappedCoordinates(o){const x=[new n.b4(0,o)];if(this._renderWorldCopies){const A=this.pointCoordinate(new n.P(0,0)),I=this.pointCoordinate(new n.P(this.width,0)),P=this.pointCoordinate(new n.P(this.width,this.height)),H=this.pointCoordinate(new n.P(0,this.height)),K=Math.floor(Math.min(A.x,I.x,P.x,H.x)),ne=Math.floor(Math.max(A.x,I.x,P.x,H.x)),he=1;for(let be=K-he;be<=ne+he;be++)be!==0&&x.push(new n.b4(be,o))}return x}coveringTiles(o){var x,A;let I=this.coveringZoomLevel(o);const P=I;if(o.minzoom!==void 0&&I<o.minzoom)return[];o.maxzoom!==void 0&&I>o.maxzoom&&(I=o.maxzoom);const H=this.pointCoordinate(this.getCameraPoint()),K=n.Z.fromLngLat(this.center),ne=Math.pow(2,I),he=[ne*H.x,ne*H.y,0],be=[ne*K.x,ne*K.y,0],we=kc.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,I);let Be=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(Be=I);const Ye=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,st=_t=>({aabb:new pu([_t*ne,0,0],[(_t+1)*ne,ne,0]),zoom:0,x:0,y:0,wrap:_t,fullyVisible:!1}),vt=[],Et=[],Ct=I,Lt=o.reparseOverscaled?P:I;if(this._renderWorldCopies)for(let _t=1;_t<=3;_t++)vt.push(st(-_t)),vt.push(st(_t));for(vt.push(st(0));vt.length>0;){const _t=vt.pop(),Ht=_t.x,Qt=_t.y;let oi=_t.fullyVisible;if(!oi){const Ln=_t.aabb.intersects(we);if(Ln===0)continue;oi=Ln===2}const $i=o.terrain?he:be,An=_t.aabb.distanceX($i),Mn=_t.aabb.distanceY($i),Zn=Math.max(Math.abs(An),Math.abs(Mn));if(_t.zoom===Ct||Zn>Ye+(1<<Ct-_t.zoom)-2&&_t.zoom>=Be){const Ln=Ct-_t.zoom,zn=he[0]-.5-(Ht<<Ln),ir=he[1]-.5-(Qt<<Ln);Et.push({tileID:new n.S(_t.zoom===Ct?Lt:_t.zoom,_t.wrap,_t.zoom,Ht,Qt),distanceSq:Ot([be[0]-.5-Ht,be[1]-.5-Qt]),tileDistanceToCamera:Math.sqrt(zn*zn+ir*ir)})}else for(let Ln=0;Ln<4;Ln++){const zn=(Ht<<1)+Ln%2,ir=(Qt<<1)+(Ln>>1),$r=_t.zoom+1;let On=_t.aabb.quadrant(Ln);if(o.terrain){const qn=new n.S($r,_t.wrap,$r,zn,ir),Yr=o.terrain.getMinMaxElevation(qn),Qa=(x=Yr.minElevation)!==null&&x!==void 0?x:this.elevation,Ma=(A=Yr.maxElevation)!==null&&A!==void 0?A:this.elevation;On=new pu([On.min[0],On.min[1],Qa],[On.max[0],On.max[1],Ma])}vt.push({aabb:On,zoom:$r,x:zn,y:ir,wrap:_t.wrap,fullyVisible:oi})}}return Et.sort(((_t,Ht)=>_t.distanceSq-Ht.distanceSq)).map((_t=>_t.tileID))}resize(o,x){this.width=o,this.height=x,this.pixelsToGLUnits=[2/o,-2/x],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const x=n.ac(o.lat,-85.051129,Cf);return new n.P(n.O(o.lng)*this.worldSize,n.Q(x)*this.worldSize)}unproject(o){return new n.Z(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const x=this.elevation,A=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,I=this.pointLocation(this.centerPoint,o),P=o.getElevationForLngLatZoom(I,this.tileZoom);if(!(this.elevation-P))return;const H=A+x-P,K=Math.cos(this._pitch)*this.cameraToCenterDistance/H/n.b5(1,I.lat),ne=this.scaleZoom(K/this.tileSize);this._elevation=P,this._center=I,this.zoom=ne}setLocationAtPoint(o,x){const A=this.pointCoordinate(x),I=this.pointCoordinate(this.centerPoint),P=this.locationCoordinate(o),H=new n.Z(P.x-(A.x-I.x),P.y-(A.y-I.y));this.center=this.coordinateLocation(H),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,x){return x?this.coordinatePoint(this.locationCoordinate(o),x.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,x){return this.coordinateLocation(this.pointCoordinate(o,x))}locationCoordinate(o){return n.Z.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,x){if(x){const Be=x.pointCoordinate(o);if(Be!=null)return Be}const A=[o.x,o.y,0,1],I=[o.x,o.y,1,1];n.af(A,A,this.pixelMatrixInverse),n.af(I,I,this.pixelMatrixInverse);const P=A[3],H=I[3],K=A[1]/P,ne=I[1]/H,he=A[2]/P,be=I[2]/H,we=he===be?0:(0-he)/(be-he);return new n.Z(n.y.number(A[0]/P,I[0]/H,we)/this.worldSize,n.y.number(K,ne,we)/this.worldSize)}coordinatePoint(o,x=0,A=this.pixelMatrix){const I=[o.x*this.worldSize,o.y*this.worldSize,x,1];return n.af(I,I,A),new n.P(I[0]/I[3],I[1]/I[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new Yt().extend(this.pointLocation(new n.P(0,o))).extend(this.pointLocation(new n.P(this.width,o))).extend(this.pointLocation(new n.P(this.width,this.height))).extend(this.pointLocation(new n.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Yt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Cf])}calculateTileMatrix(o){const x=o.canonical,A=this.worldSize/this.zoomScale(x.z),I=x.x+Math.pow(2,x.z)*o.wrap,P=n.an(new Float64Array(16));return n.J(P,P,[I*A,x.y*A,0]),n.K(P,P,[A/n.X,A/n.X,1]),P}calculatePosMatrix(o,x=!1){const A=o.key,I=x?this._alignedPosMatrixCache:this._posMatrixCache;if(I[A])return I[A];const P=this.calculateTileMatrix(o);return n.L(P,x?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,P),I[A]=new Float32Array(P),I[A]}calculateFogMatrix(o){const x=o.key,A=this._fogMatrixCache;if(A[x])return A[x];const I=this.calculateTileMatrix(o);return n.L(I,this.fogMatrix,I),A[x]=new Float32Array(I),A[x]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,x){x=n.ac(+x,this.minZoom,this.maxZoom);const A={center:new n.N(o.lng,o.lat),zoom:x};let I=this.lngRange;if(!this._renderWorldCopies&&I===null){const _t=179.9999999999;I=[-_t,_t]}const P=this.tileSize*this.zoomScale(A.zoom);let H=0,K=P,ne=0,he=P,be=0,we=0;const{x:Be,y:Ye}=this.size;if(this.latRange){const _t=this.latRange;H=n.Q(_t[1])*P,K=n.Q(_t[0])*P,K-H<Ye&&(be=Ye/(K-H))}I&&(ne=n.b3(n.O(I[0])*P,0,P),he=n.b3(n.O(I[1])*P,0,P),he<ne&&(he+=P),he-ne<Be&&(we=Be/(he-ne)));const{x:st,y:vt}=this.project.call({worldSize:P},o);let Et,Ct;const Lt=Math.max(we||0,be||0);if(Lt){const _t=new n.P(we?(he+ne)/2:st,be?(K+H)/2:vt);return A.center=this.unproject.call({worldSize:P},_t).wrap(),A.zoom+=this.scaleZoom(Lt),A}if(this.latRange){const _t=Ye/2;vt-_t<H&&(Ct=H+_t),vt+_t>K&&(Ct=K-_t)}if(I){const _t=(ne+he)/2;let Ht=st;this._renderWorldCopies&&(Ht=n.b3(st,_t-P/2,_t+P/2));const Qt=Be/2;Ht-Qt<ne&&(Et=ne+Qt),Ht+Qt>he&&(Et=he-Qt)}if(Et!==void 0||Ct!==void 0){const _t=new n.P(Et??st,Ct??vt);A.center=this.unproject.call({worldSize:P},_t).wrap()}return A}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:x,zoom:A}=this.getConstrained(this.center,this.zoom);this.center=x,this.zoom=A,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,x=this.point.x,A=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=n.b5(1,this.center.lat)*this.worldSize;let I=n.an(new Float64Array(16));n.K(I,I,[this.width/2,-this.height/2,1]),n.J(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=n.an(new Float64Array(16)),n.K(I,I,[1,-1,1]),n.J(I,I,[-1,-1,0]),n.K(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I;const P=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),H=Math.min(this.elevation,this.minElevationForCurrentTile),K=P-H*this._pixelPerMeter/Math.cos(this._pitch),ne=H<0?K:P,he=Math.PI/2+this._pitch,be=this._fov*(.5+o.y/this.height),we=Math.sin(be)*ne/Math.sin(n.ac(Math.PI-he-be,.01,Math.PI-.01)),Be=this.getHorizon(),Ye=2*Math.atan(Be/this.cameraToCenterDistance)*(.5+o.y/(2*Be)),st=Math.sin(Ye)*ne/Math.sin(n.ac(Math.PI-he-Ye,.01,Math.PI-.01)),vt=Math.min(we,st);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*vt+ne),this.nearZ=this.height/50,I=new Float64Array(16),n.b6(I,this._fov,this.width/this.height,this.nearZ,this.farZ),I[8]=2*-o.x/this.width,I[9]=2*o.y/this.height,this.projectionMatrix=n.ae(I),n.K(I,I,[1,-1,1]),n.J(I,I,[0,0,-this.cameraToCenterDistance]),n.b7(I,I,this._pitch),n.ad(I,I,this.angle),n.J(I,I,[-x,-A,0]),this.mercatorMatrix=n.K([],I,[this.worldSize,this.worldSize,this.worldSize]),n.K(I,I,[1,1,this._pixelPerMeter]),this.pixelMatrix=n.L(new Float64Array(16),this.labelPlaneMatrix,I),n.J(I,I,[0,0,-this.elevation]),this.modelViewProjectionMatrix=I,this.invModelViewProjectionMatrix=n.as([],I),this.fogMatrix=new Float64Array(16),n.b6(this.fogMatrix,this._fov,this.width/this.height,P,this.farZ),this.fogMatrix[8]=2*-o.x/this.width,this.fogMatrix[9]=2*o.y/this.height,n.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),n.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),n.b7(this.fogMatrix,this.fogMatrix,this._pitch),n.ad(this.fogMatrix,this.fogMatrix,this.angle),n.J(this.fogMatrix,this.fogMatrix,[-x,-A,0]),n.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),n.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=n.L(new Float64Array(16),this.labelPlaneMatrix,I);const Et=this.width%2/2,Ct=this.height%2/2,Lt=Math.cos(this.angle),_t=Math.sin(this.angle),Ht=x-Math.round(x)+Lt*Et+_t*Ct,Qt=A-Math.round(A)+Lt*Ct+_t*Et,oi=new Float64Array(I);if(n.J(oi,oi,[Ht>.5?Ht-1:Ht,Qt>.5?Qt-1:Qt,0]),this.alignedModelViewProjectionMatrix=oi,I=n.as(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");this.pixelMatrixInverse=I,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new n.P(0,0)),x=[o.x*this.worldSize,o.y*this.worldSize,0,1];return n.af(x,x,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,o))}getCameraQueryGeometry(o){const x=this.getCameraPoint();if(o.length===1)return[o[0],x];{let A=x.x,I=x.y,P=x.x,H=x.y;for(const K of o)A=Math.min(A,K.x),I=Math.min(I,K.y),P=Math.max(P,K.x),H=Math.max(H,K.y);return[new n.P(A,I),new n.P(P,I),new n.P(P,H),new n.P(A,H),new n.P(A,I)]}}lngLatToCameraDepth(o,x){const A=this.locationCoordinate(o),I=[A.x*this.worldSize,A.y*this.worldSize,x,1];return n.af(I,I,this.modelViewProjectionMatrix),I[2]/I[3]}}function mu(L,o){let x,A=!1,I=null,P=null;const H=()=>{I=null,A&&(L.apply(P,x),I=setTimeout(H,o),A=!1)};return(...K)=>(A=!0,P=this,x=K,I||H(),I)}class Cd{constructor(o){this._getCurrentHash=()=>{const x=window.location.hash.replace("#","");if(this._hashName){let A;return x.split("&").map((I=>I.split("="))).forEach((I=>{I[0]===this._hashName&&(A=I)})),(A&&A[1]||"").split("/")}return x.split("/")},this._onHashChange=()=>{const x=this._getCurrentHash();if(x.length>=3&&!x.some((A=>isNaN(A)))){const A=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(x[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+x[2],+x[1]],zoom:+x[0],bearing:A,pitch:+(x[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const x=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,x)},this._removeHash=()=>{const x=this._getCurrentHash();if(x.length===0)return;const A=x.join("/");let I=A;I.split("&").length>0&&(I=I.split("&")[0]),this._hashName&&(I=`${this._hashName}=${A}`);let P=window.location.hash.replace(I,"");P.startsWith("#&")?P=P.slice(0,1)+P.slice(2):P==="#"&&(P="");let H=window.location.href.replace(/(#.+)?$/,P);H=H.replace("&&","&"),window.history.replaceState(window.history.state,null,H)},this._updateHash=mu(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(o){const x=this._map.getCenter(),A=Math.round(100*this._map.getZoom())/100,I=Math.ceil((A*Math.LN2+Math.log(512/360/.5))/Math.LN10),P=Math.pow(10,I),H=Math.round(x.lng*P)/P,K=Math.round(x.lat*P)/P,ne=this._map.getBearing(),he=this._map.getPitch();let be="";if(be+=o?`/${H}/${K}/${A}`:`${A}/${K}/${H}`,(ne||he)&&(be+="/"+Math.round(10*ne)/10),he&&(be+=`/${Math.round(he)}`),this._hashName){const we=this._hashName;let Be=!1;const Ye=window.location.hash.slice(1).split("&").map((st=>{const vt=st.split("=")[0];return vt===we?(Be=!0,`${vt}=${be}`):st})).filter((st=>st));return Be||Ye.push(`${we}=${be}`),`#${Ye.join("&")}`}return`#${be}`}}const _u={linearity:.3,easing:n.b8(0,0,.3,1)},zf=n.e({deceleration:2500,maxSpeed:1400},_u),um=n.e({deceleration:20,maxSpeed:1400},_u),Df=n.e({deceleration:1e3,maxSpeed:360},_u),Ou=n.e({deceleration:1e3,maxSpeed:90},_u);class cd{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:ut.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,x=ut.now();for(;o.length>0&&x-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const x={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:P}of this._inertiaBuffer)x.zoom+=P.zoomDelta||0,x.bearing+=P.bearingDelta||0,x.pitch+=P.pitchDelta||0,P.panDelta&&x.pan._add(P.panDelta),P.around&&(x.around=P.around),P.pinchAround&&(x.pinchAround=P.pinchAround);const A=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(x.pan.mag()){const P=ud(x.pan.mag(),A,n.e({},zf,o||{}));I.offset=x.pan.mult(P.amount/x.pan.mag()),I.center=this._map.transform.center,kl(I,P)}if(x.zoom){const P=ud(x.zoom,A,um);I.zoom=this._map.transform.zoom+P.amount,kl(I,P)}if(x.bearing){const P=ud(x.bearing,A,Df);I.bearing=this._map.transform.bearing+n.ac(P.amount,-179,179),kl(I,P)}if(x.pitch){const P=ud(x.pitch,A,Ou);I.pitch=this._map.transform.pitch+P.amount,kl(I,P)}if(I.zoom||I.bearing){const P=x.pinchAround===void 0?x.around:x.pinchAround;I.around=P?this._map.unproject(P):this._map.getCenter()}return this.clear(),n.e(I,{noMoveStart:!0})}}function kl(L,o){(!L.duration||L.duration<o.duration)&&(L.duration=o.duration,L.easing=o.easing)}function ud(L,o,x){const{maxSpeed:A,linearity:I,deceleration:P}=x,H=n.ac(L*I/(o/1e3),-A,A),K=Math.abs(H)/(P*I);return{easing:x.easing,duration:1e3*K,amount:H*(K/2)}}class Gs extends n.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,x,A,I={}){const P=bt.mousePos(x.getCanvas(),A),H=x.unproject(P);super(o,n.e({point:P,lngLat:H,originalEvent:A},I)),this._defaultPrevented=!1,this.target=x}}class hc extends n.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,x,A){const I=o==="touchend"?A.changedTouches:A.touches,P=bt.touchPos(x.getCanvasContainer(),I),H=P.map((ne=>x.unproject(ne))),K=P.reduce(((ne,he,be,we)=>ne.add(he.div(we.length))),new n.P(0,0));super(o,{points:P,point:K,lngLats:H,lngLat:x.unproject(K),originalEvent:A}),this._defaultPrevented=!1}}class dc extends n.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,x,A){super(o,{originalEvent:A}),this._defaultPrevented=!1}}class oh{constructor(o,x){this._map=o,this._clickTolerance=x.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new dc(o.type,this._map,o))}mousedown(o,x){return this._mousedownPos=x,this._firePreventable(new Gs(o.type,this._map,o))}mouseup(o){this._map.fire(new Gs(o.type,this._map,o))}click(o,x){this._mousedownPos&&this._mousedownPos.dist(x)>=this._clickTolerance||this._map.fire(new Gs(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Gs(o.type,this._map,o))}mouseover(o){this._map.fire(new Gs(o.type,this._map,o))}mouseout(o){this._map.fire(new Gs(o.type,this._map,o))}touchstart(o){return this._firePreventable(new hc(o.type,this._map,o))}touchmove(o){this._map.fire(new hc(o.type,this._map,o))}touchend(o){this._map.fire(new hc(o.type,this._map,o))}touchcancel(o){this._map.fire(new hc(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class os{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Gs(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Gs(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ol{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(n.P.convert(o),this._map.terrain)}}class pi{constructor(o,x){this._map=o,this._tr=new Ol(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=x.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,x){this.isEnabled()&&o.shiftKey&&o.button===0&&(bt.disableDrag(),this._startPos=this._lastPos=x,this._active=!0)}mousemoveWindow(o,x){if(!this._active)return;const A=x;if(this._lastPos.equals(A)||!this._box&&A.dist(this._startPos)<this._clickTolerance)return;const I=this._startPos;this._lastPos=A,this._box||(this._box=bt.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const P=Math.min(I.x,A.x),H=Math.max(I.x,A.x),K=Math.min(I.y,A.y),ne=Math.max(I.y,A.y);bt.setTransform(this._box,`translate(${P}px,${K}px)`),this._box.style.width=H-P+"px",this._box.style.height=ne-K+"px"}mouseupWindow(o,x){if(!this._active||o.button!==0)return;const A=this._startPos,I=x;if(this.reset(),bt.suppressClick(),A.x!==I.x||A.y!==I.y)return this._map.fire(new n.k("boxzoomend",{originalEvent:o})),{cameraAnimation:P=>P.fitScreenCoordinates(A,I,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(bt.remove(this._box),this._box=null),bt.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,x){return this._map.fire(new n.k(o,{originalEvent:x}))}}function kh(L,o){if(L.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${L.length}, points ${o.length}`);const x={};for(let A=0;A<L.length;A++)x[L[A].identifier]=o[A];return x}class gu{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,x,A){(this.centroid||A.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),A.length===this.numTouches&&(this.centroid=(function(I){const P=new n.P(0,0);for(const H of I)P._add(H);return P.div(I.length)})(x),this.touches=kh(A,x)))}touchmove(o,x,A){if(this.aborted||!this.centroid)return;const I=kh(A,x);for(const P in this.touches){const H=I[P];(!H||H.dist(this.touches[P])>30)&&(this.aborted=!0)}}touchend(o,x,A){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),A.length===0){const I=!this.aborted&&this.centroid;if(this.reset(),I)return I}}}class hd{constructor(o){this.singleTap=new gu(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,x,A){this.singleTap.touchstart(o,x,A)}touchmove(o,x,A){this.singleTap.touchmove(o,x,A)}touchend(o,x,A){const I=this.singleTap.touchend(o,x,A);if(I){const P=o.timeStamp-this.lastTime<500,H=!this.lastTap||this.lastTap.dist(I)<30;if(P&&H||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}}}class Bu{constructor(o){this._tr=new Ol(o),this._zoomIn=new hd({numTouches:1,numTaps:2}),this._zoomOut=new hd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,x,A){this._zoomIn.touchstart(o,x,A),this._zoomOut.touchstart(o,x,A)}touchmove(o,x,A){this._zoomIn.touchmove(o,x,A),this._zoomOut.touchmove(o,x,A)}touchend(o,x,A){const I=this._zoomIn.touchend(o,x,A),P=this._zoomOut.touchend(o,x,A),H=this._tr;return I?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:K=>K.easeTo({duration:300,zoom:H.zoom+1,around:H.unproject(I)},{originalEvent:o})}):P?(this._active=!0,o.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:K=>K.easeTo({duration:300,zoom:H.zoom-1,around:H.unproject(P)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yl{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const x=this._moveFunction(...o);if(x.bearingDelta||x.pitchDelta||x.around||x.panDelta)return this._active=!0,x}dragStart(o,x){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=x.length?x[0]:x,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,x){if(!this.isEnabled())return;const A=this._lastPoint;if(!A)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const I=x.length?x[0]:x;return!this._moved&&I.dist(A)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=I,this._move(A,I))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&bt.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const yu={0:1,2:2};class xl{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const x=bt.mouseButton(o);this._eventButton=x}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!(function(x,A){const I=yu[A];return x.buttons===void 0||(x.buttons&I)!==I})(o,this._eventButton)}isValidEndEvent(o){return bt.mouseButton(o)===this._eventButton}}class Fu{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const vl=L=>{L.mousedown=L.dragStart,L.mousemoveWindow=L.dragMove,L.mouseup=L.dragEnd,L.contextmenu=o=>{o.preventDefault()}},Nu=({enable:L,clickTolerance:o,bearingDegreesPerPixelMoved:x=.8})=>{const A=new xl({checkCorrectEvent:I=>bt.mouseButton(I)===0&&I.ctrlKey||bt.mouseButton(I)===2});return new yl({clickTolerance:o,move:(I,P)=>({bearingDelta:(P.x-I.x)*x}),moveStateManager:A,enable:L,assignEvents:vl})},Oh=({enable:L,clickTolerance:o,pitchDegreesPerPixelMoved:x=-.5})=>{const A=new xl({checkCorrectEvent:I=>bt.mouseButton(I)===0&&I.ctrlKey||bt.mouseButton(I)===2});return new yl({clickTolerance:o,move:(I,P)=>({pitchDelta:(P.y-I.y)*x}),moveStateManager:A,enable:L,assignEvents:vl})};class Oc{constructor(o,x){this._clickTolerance=o.clickTolerance||1,this._map=x,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}_shouldBePrevented(o){return o<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(o,x,A){return this._calculateTransform(o,x,A)}touchmove(o,x,A){if(this._active){if(!this._shouldBePrevented(A.length))return o.preventDefault(),this._calculateTransform(o,x,A);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",o)}}touchend(o,x,A){this._calculateTransform(o,x,A),this._active&&this._shouldBePrevented(A.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,x,A){A.length>0&&(this._active=!0);const I=kh(A,x),P=new n.P(0,0),H=new n.P(0,0);let K=0;for(const he in I){const be=I[he],we=this._touches[he];we&&(P._add(be),H._add(be.sub(we)),K++,I[he]=be)}if(this._touches=I,this._shouldBePrevented(K)||!H.mag())return;const ne=H.div(K);return this._sum._add(ne),this._sum.mag()<this._clickTolerance?void 0:{around:P.div(K),panDelta:ne}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bh{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,x,A){this._firstTwoTouches||A.length<2||(this._firstTwoTouches=[A[0].identifier,A[1].identifier],this._start([x[0],x[1]]))}touchmove(o,x,A){if(!this._firstTwoTouches)return;o.preventDefault();const[I,P]=this._firstTwoTouches,H=Wd(A,x,I),K=Wd(A,x,P);if(!H||!K)return;const ne=this._aroundCenter?null:H.add(K).div(2);return this._move([H,K],ne,o)}touchend(o,x,A){if(!this._firstTwoTouches)return;const[I,P]=this._firstTwoTouches,H=Wd(A,x,I),K=Wd(A,x,P);H&&K||(this._active&&bt.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Wd(L,o,x){for(let A=0;A<L.length;A++)if(L[A].identifier===x)return o[A]}function Yd(L,o){return Math.log(L/o)/Math.LN2}class Kd extends Bh{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,x){const A=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Yd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Yd(this._distance,A),pinchAround:x}}}function Zo(L,o){return 180*L.angleWith(o)/Math.PI}class Or extends Bh{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,x,A){const I=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Zo(this._vector,I),pinchAround:x}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const x=25/(Math.PI*this._minDiameter)*360,A=Zo(o,this._startVector);return Math.abs(A)<x}}function Fh(L){return Math.abs(L.y)>Math.abs(L.x)}class dd extends Bh{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,x,A){super.touchstart(o,x,A),this._currentTouchCount=A.length}_start(o){this._lastPoints=o,Fh(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,x,A){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const I=o[0].sub(this._lastPoints[0]),P=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(I,P,A.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(I.y+P.y)/2*-.5}):void 0}gestureBeginsVertically(o,x,A){if(this._valid!==void 0)return this._valid;const I=o.mag()>=2,P=x.mag()>=2;if(!I&&!P)return;if(!I||!P)return this._firstMove===void 0&&(this._firstMove=A),A-this._firstMove<100&&void 0;const H=o.y>0==x.y>0;return Fh(o)&&Fh(x)&&H}}const Jd={panStep:100,bearingStep:15,pitchStep:10};class Ao{constructor(o){this._tr=new Ol(o);const x=Jd;this._panStep=x.panStep,this._bearingStep=x.bearingStep,this._pitchStep=x.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let x=0,A=0,I=0,P=0,H=0;switch(o.keyCode){case 61:case 107:case 171:case 187:x=1;break;case 189:case 109:case 173:x=-1;break;case 37:o.shiftKey?A=-1:(o.preventDefault(),P=-1);break;case 39:o.shiftKey?A=1:(o.preventDefault(),P=1);break;case 38:o.shiftKey?I=1:(o.preventDefault(),H=-1);break;case 40:o.shiftKey?I=-1:(o.preventDefault(),H=1);break;default:return}return this._rotationDisabled&&(A=0,I=0),{cameraAnimation:K=>{const ne=this._tr;K.easeTo({duration:300,easeId:"keyboardHandler",easing:Xo,zoom:x?Math.round(ne.zoom)+x*(o.shiftKey?2:1):ne.zoom,bearing:ne.bearing+A*this._bearingStep,pitch:ne.pitch+I*this._pitchStep,offset:[-P*this._panStep,-H*this._panStep],center:ne.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xo(L){return L*(2-L)}const Ra=4.000244140625;class sl{constructor(o,x){this._onTimeout=A=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(A)},this._map=o,this._tr=new Ol(o),this._triggerRenderFrame=x,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(o){return!!this._map.cooperativeGestures.isEnabled()&&!(o.ctrlKey||this._map.cooperativeGestures.isBypassed(o))}wheel(o){if(!this.isEnabled())return;if(this._shouldBePrevented(o))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",o);let x=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const A=ut.now(),I=A-(this._lastWheelEventTime||0);this._lastWheelEventTime=A,x!==0&&x%Ra==0?this._type="wheel":x!==0&&Math.abs(x)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=x,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(I*x)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,x+=this._lastValue)),o.shiftKey&&x&&(x/=4),this._type&&(this._lastWheelEvent=o,this._delta-=x,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const x=bt.mousePos(this._map.getCanvas(),o),A=this._tr;this._around=x.y>A.transform.height/2-A.transform.getHorizon()?n.N.convert(this._aroundCenter?A.center:A.unproject(x)):n.N.convert(A.center),this._aroundPoint=A.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const ne=this._type==="wheel"&&Math.abs(this._delta)>Ra?this._wheelZoomRate:this._defaultZoomRate;let he=2/(1+Math.exp(-Math.abs(this._delta*ne)));this._delta<0&&he!==0&&(he=1/he);const be=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(be*he))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const x=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,A=this._startZoom,I=this._easing;let P,H=!1;const K=ut.now()-this._lastWheelEventTime;if(this._type==="wheel"&&A&&I&&K){const ne=Math.min(K/200,1),he=I(ne);P=n.y.number(A,x,he),ne<1?this._frameId||(this._frameId=!0):H=!0}else P=x,H=!0;return this._active=!0,H&&(this._active=!1,this._finishTimeout=setTimeout((()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!H,zoomDelta:P-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let x=n.b9;if(this._prevEase){const A=this._prevEase,I=(ut.now()-A.start)/A.duration,P=A.easing(I+.01)-A.easing(I),H=.27/Math.sqrt(P*P+1e-4)*.01,K=Math.sqrt(.0729-H*H);x=n.b8(H,K,.25,1)}return this._prevEase={start:ut.now(),duration:o,easing:x},x}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Bl{constructor(o,x){this._clickZoom=o,this._tapZoom=x}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vu{constructor(o){this._tr=new Ol(o),this.reset()}reset(){this._active=!1}dblclick(o,x){return o.preventDefault(),{cameraAnimation:A=>{A.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(x)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rf{constructor(){this._tap=new hd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,x,A){if(!this._swipePoint)if(this._tapTime){const I=x[0],P=o.timeStamp-this._tapTime<500,H=this._tapPoint.dist(I)<30;P&&H?A.length>0&&(this._swipePoint=I,this._swipeTouch=A[0].identifier):this.reset()}else this._tap.touchstart(o,x,A)}touchmove(o,x,A){if(this._tapTime){if(this._swipePoint){if(A[0].identifier!==this._swipeTouch)return;const I=x[0],P=I.y-this._swipePoint.y;return this._swipePoint=I,o.preventDefault(),this._active=!0,{zoomDelta:P/128}}}else this._tap.touchmove(o,x,A)}touchend(o,x,A){if(this._tapTime)this._swipePoint&&A.length===0&&this.reset();else{const I=this._tap.touchend(o,x,A);I&&(this._tapTime=o.timeStamp,this._tapPoint=I)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qd{constructor(o,x,A){this._el=o,this._mousePan=x,this._touchPan=A}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class lh{constructor(o,x,A){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=x,this._mousePitch=A}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Nh{constructor(o,x,A,I){this._el=o,this._touchZoom=x,this._touchRotate=A,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class mo{constructor(o,x){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=x,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=bt.create("div","maplibregl-cooperative-gesture-screen",o);let x=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(x=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const A=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),I=document.createElement("div");I.className="maplibregl-desktop-message",I.textContent=x,this._container.appendChild(I);const P=document.createElement("div");P.className="maplibregl-mobile-message",P.textContent=A,this._container.appendChild(P),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(bt.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(o){return o[this._bypassKey]}notifyGestureBlocked(o,x){this._enabled&&(this._map.fire(new n.k("cooperativegestureprevented",{gestureType:o,originalEvent:x})),this._container.classList.add("maplibregl-show"),setTimeout((()=>{this._container.classList.remove("maplibregl-show")}),100))}}const ja=L=>L.zoom||L.drag||L.pitch||L.rotate;class fn extends n.k{}function Wc(L){return L.panDelta&&L.panDelta.mag()||L.zoomDelta||L.bearingDelta||L.pitchDelta}class fc{constructor(o,x){this.handleWindowEvent=I=>{this.handleEvent(I,`${I.type}Window`)},this.handleEvent=(I,P)=>{if(I.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const H=I.type==="renderFrame"?void 0:I,K={needsRenderFrame:!1},ne={},he={},be=I.touches,we=be?this._getMapTouches(be):void 0,Be=we?bt.touchPos(this._map.getCanvas(),we):bt.mousePos(this._map.getCanvas(),I);for(const{handlerName:vt,handler:Et,allowed:Ct}of this._handlers){if(!Et.isEnabled())continue;let Lt;this._blockedByActive(he,Ct,vt)?Et.reset():Et[P||I.type]&&(Lt=Et[P||I.type](I,Be,we),this.mergeHandlerResult(K,ne,Lt,vt,H),Lt&&Lt.needsRenderFrame&&this._triggerRenderFrame()),(Lt||Et.isActive())&&(he[vt]=Et)}const Ye={};for(const vt in this._previousActiveHandlers)he[vt]||(Ye[vt]=H);this._previousActiveHandlers=he,(Object.keys(Ye).length||Wc(K))&&(this._changes.push([K,ne,Ye]),this._triggerRenderFrame()),(Object.keys(he).length||Wc(K))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:st}=K;st&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],st(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new cd(o),this._bearingSnap=x.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(x);const A=this._el;this._listeners=[[A,"touchstart",{passive:!0}],[A,"touchmove",{passive:!1}],[A,"touchend",void 0],[A,"touchcancel",void 0],[A,"mousedown",void 0],[A,"mousemove",void 0],[A,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[A,"mouseover",void 0],[A,"mouseout",void 0],[A,"dblclick",void 0],[A,"click",void 0],[A,"keydown",{capture:!1}],[A,"keyup",void 0],[A,"wheel",{passive:!1}],[A,"contextmenu",void 0],[window,"blur",void 0]];for(const[I,P,H]of this._listeners)bt.addEventListener(I,P,I===document?this.handleWindowEvent:this.handleEvent,H)}destroy(){for(const[o,x,A]of this._listeners)bt.removeEventListener(o,x,o===document?this.handleWindowEvent:this.handleEvent,A)}_addDefaultHandlers(o){const x=this._map,A=x.getCanvasContainer();this._add("mapEvent",new oh(x,o));const I=x.boxZoom=new pi(x,o);this._add("boxZoom",I),o.interactive&&o.boxZoom&&I.enable();const P=x.cooperativeGestures=new mo(x,o.cooperativeGestures);this._add("cooperativeGestures",P),o.cooperativeGestures&&P.enable();const H=new Bu(x),K=new Vu(x);x.doubleClickZoom=new Bl(K,H),this._add("tapZoom",H),this._add("clickZoom",K),o.interactive&&o.doubleClickZoom&&x.doubleClickZoom.enable();const ne=new Rf;this._add("tapDragZoom",ne);const he=x.touchPitch=new dd(x);this._add("touchPitch",he),o.interactive&&o.touchPitch&&x.touchPitch.enable(o.touchPitch);const be=Nu(o),we=Oh(o);x.dragRotate=new lh(o,be,we),this._add("mouseRotate",be,["mousePitch"]),this._add("mousePitch",we,["mouseRotate"]),o.interactive&&o.dragRotate&&x.dragRotate.enable();const Be=(({enable:Lt,clickTolerance:_t})=>{const Ht=new xl({checkCorrectEvent:Qt=>bt.mouseButton(Qt)===0&&!Qt.ctrlKey});return new yl({clickTolerance:_t,move:(Qt,oi)=>({around:oi,panDelta:oi.sub(Qt)}),activateOnStart:!0,moveStateManager:Ht,enable:Lt,assignEvents:vl})})(o),Ye=new Oc(o,x);x.dragPan=new Qd(A,Be,Ye),this._add("mousePan",Be),this._add("touchPan",Ye,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&x.dragPan.enable(o.dragPan);const st=new Or,vt=new Kd;x.touchZoomRotate=new Nh(A,vt,st,ne),this._add("touchRotate",st,["touchPan","touchZoom"]),this._add("touchZoom",vt,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&x.touchZoomRotate.enable(o.touchZoomRotate);const Et=x.scrollZoom=new sl(x,(()=>this._triggerRenderFrame()));this._add("scrollZoom",Et,["mousePan"]),o.interactive&&o.scrollZoom&&x.scrollZoom.enable(o.scrollZoom);const Ct=x.keyboard=new Ao(x);this._add("keyboard",Ct),o.interactive&&o.keyboard&&x.keyboard.enable(),this._add("blockableMapEvent",new os(x))}_add(o,x,A){this._handlers.push({handlerName:o,handler:x,allowed:A}),this._handlersById[o]=x}stop(o){if(!this._updatingCamera){for(const{handler:x}of this._handlers)x.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ja(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,x,A){for(const I in o)if(I!==A&&(!x||x.indexOf(I)<0))return!0;return!1}_getMapTouches(o){const x=[];for(const A of o)this._el.contains(A.target)&&x.push(A);return x}mergeHandlerResult(o,x,A,I,P){if(!A)return;n.e(o,A);const H={handlerName:I,originalEvent:A.originalEvent||P};A.zoomDelta!==void 0&&(x.zoom=H),A.panDelta!==void 0&&(x.drag=H),A.pitchDelta!==void 0&&(x.pitch=H),A.bearingDelta!==void 0&&(x.rotate=H)}_applyChanges(){const o={},x={},A={};for(const[I,P,H]of this._changes)I.panDelta&&(o.panDelta=(o.panDelta||new n.P(0,0))._add(I.panDelta)),I.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+I.pitchDelta),I.around!==void 0&&(o.around=I.around),I.pinchAround!==void 0&&(o.pinchAround=I.pinchAround),I.noInertia&&(o.noInertia=I.noInertia),n.e(x,P),n.e(A,H);this._updateMapTransform(o,x,A),this._changes=[]}_updateMapTransform(o,x,A){const I=this._map,P=I._getTransformForUpdate(),H=I.terrain;if(!(Wc(o)||H&&this._terrainMovement))return this._fireEvents(x,A,!0);let{panDelta:K,zoomDelta:ne,bearingDelta:he,pitchDelta:be,around:we,pinchAround:Be}=o;Be!==void 0&&(we=Be),I._stop(!0),we=we||I.transform.centerPoint;const Ye=P.pointLocation(K?we.sub(K):we);he&&(P.bearing+=he),be&&(P.pitch+=be),ne&&(P.zoom+=ne),H?this._terrainMovement||!x.drag&&!x.zoom?x.drag&&this._terrainMovement?P.center=P.pointLocation(P.centerPoint.sub(K)):P.setLocationAtPoint(Ye,we):(this._terrainMovement=!0,this._map._elevationFreeze=!0,P.setLocationAtPoint(Ye,we)):P.setLocationAtPoint(Ye,we),I._applyUpdatedTransform(P),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(x,A,!0)}_fireEvents(o,x,A){const I=ja(this._eventsInProgress),P=ja(o),H={};for(const we in o){const{originalEvent:Be}=o[we];this._eventsInProgress[we]||(H[`${we}start`]=Be),this._eventsInProgress[we]=o[we]}!I&&P&&this._fireEvent("movestart",P.originalEvent);for(const we in H)this._fireEvent(we,H[we]);P&&this._fireEvent("move",P.originalEvent);for(const we in o){const{originalEvent:Be}=o[we];this._fireEvent(we,Be)}const K={};let ne;for(const we in this._eventsInProgress){const{handlerName:Be,originalEvent:Ye}=this._eventsInProgress[we];this._handlersById[Be].isActive()||(delete this._eventsInProgress[we],ne=x[Be]||Ye,K[`${we}end`]=ne)}for(const we in K)this._fireEvent(we,K[we]);const he=ja(this._eventsInProgress),be=(I||P)&&!he;if(be&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const we=this._map._getTransformForUpdate();we.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(we)}if(A&&be){this._updatingCamera=!0;const we=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Be=Ye=>Ye!==0&&-this._bearingSnap<Ye&&Ye<this._bearingSnap;!we||!we.essential&&ut.prefersReducedMotion?(this._map.fire(new n.k("moveend",{originalEvent:ne})),Be(this._map.getBearing())&&this._map.resetNorth()):(Be(we.bearing||this._map.getBearing())&&(we.bearing=0),we.freezeElevation=!0,this._map.easeTo(we,{originalEvent:ne})),this._updatingCamera=!1}}_fireEvent(o,x){this._map.fire(new n.k(o,x?{originalEvent:x}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((o=>{delete this._frameId,this.handleEvent(new fn("renderFrame",{timeStamp:o})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Vh extends n.E{constructor(o,x){super(),this._renderFrameCallback=()=>{const A=Math.min((ut.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(A)),A<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=x.bearingSnap,this.on("moveend",(()=>{delete this._requestedCameraState}))}getCenter(){return new n.N(this.transform.center.lng,this.transform.center.lat)}setCenter(o,x){return this.jumpTo({center:o},x)}panBy(o,x,A){return o=n.P.convert(o).mult(-1),this.panTo(this.transform.center,n.e({offset:o},x),A)}panTo(o,x,A){return this.easeTo(n.e({center:o},x),A)}getZoom(){return this.transform.zoom}setZoom(o,x){return this.jumpTo({zoom:o},x),this}zoomTo(o,x,A){return this.easeTo(n.e({zoom:o},x),A)}zoomIn(o,x){return this.zoomTo(this.getZoom()+1,o,x),this}zoomOut(o,x){return this.zoomTo(this.getZoom()-1,o,x),this}getBearing(){return this.transform.bearing}setBearing(o,x){return this.jumpTo({bearing:o},x),this}getPadding(){return this.transform.padding}setPadding(o,x){return this.jumpTo({padding:o},x),this}rotateTo(o,x,A){return this.easeTo(n.e({bearing:o},x),A)}resetNorth(o,x){return this.rotateTo(0,n.e({duration:1e3},o),x),this}resetNorthPitch(o,x){return this.easeTo(n.e({bearing:0,pitch:0,duration:1e3},o),x),this}snapToNorth(o,x){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,x):this}getPitch(){return this.transform.pitch}setPitch(o,x){return this.jumpTo({pitch:o},x),this}cameraForBounds(o,x){o=Yt.convert(o).adjustAntiMeridian();const A=x&&x.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),A,x)}_cameraForBoxAndBearing(o,x,A,I){const P={top:0,bottom:0,right:0,left:0};if(typeof(I=n.e({padding:P,offset:[0,0],maxZoom:this.transform.maxZoom},I)).padding=="number"){const Ln=I.padding;I.padding={top:Ln,bottom:Ln,right:Ln,left:Ln}}I.padding=n.e(P,I.padding);const H=this.transform,K=H.padding,ne=new Yt(o,x),he=H.project(ne.getNorthWest()),be=H.project(ne.getNorthEast()),we=H.project(ne.getSouthEast()),Be=H.project(ne.getSouthWest()),Ye=n.ba(-A),st=he.rotate(Ye),vt=be.rotate(Ye),Et=we.rotate(Ye),Ct=Be.rotate(Ye),Lt=new n.P(Math.max(st.x,vt.x,Ct.x,Et.x),Math.max(st.y,vt.y,Ct.y,Et.y)),_t=new n.P(Math.min(st.x,vt.x,Ct.x,Et.x),Math.min(st.y,vt.y,Ct.y,Et.y)),Ht=Lt.sub(_t),Qt=(H.width-(K.left+K.right+I.padding.left+I.padding.right))/Ht.x,oi=(H.height-(K.top+K.bottom+I.padding.top+I.padding.bottom))/Ht.y;if(oi<0||Qt<0)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const $i=Math.min(H.scaleZoom(H.scale*Math.min(Qt,oi)),I.maxZoom),An=n.P.convert(I.offset),Mn=new n.P((I.padding.left-I.padding.right)/2,(I.padding.top-I.padding.bottom)/2).rotate(n.ba(A)),Zn=An.add(Mn).mult(H.scale/H.zoomScale($i));return{center:H.unproject(he.add(we).div(2).sub(Zn)),zoom:$i,bearing:A}}fitBounds(o,x,A){return this._fitInternal(this.cameraForBounds(o,x),x,A)}fitScreenCoordinates(o,x,A,I,P){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(n.P.convert(o)),this.transform.pointLocation(n.P.convert(x)),A,I),I,P)}_fitInternal(o,x,A){return o?(delete(x=n.e(o,x)).padding,x.linear?this.easeTo(x,A):this.flyTo(x,A)):this}jumpTo(o,x){this.stop();const A=this._getTransformForUpdate();let I=!1,P=!1,H=!1;return"zoom"in o&&A.zoom!==+o.zoom&&(I=!0,A.zoom=+o.zoom),o.center!==void 0&&(A.center=n.N.convert(o.center)),"bearing"in o&&A.bearing!==+o.bearing&&(P=!0,A.bearing=+o.bearing),"pitch"in o&&A.pitch!==+o.pitch&&(H=!0,A.pitch=+o.pitch),o.padding==null||A.isPaddingEqual(o.padding)||(A.padding=o.padding),this._applyUpdatedTransform(A),this.fire(new n.k("movestart",x)).fire(new n.k("move",x)),I&&this.fire(new n.k("zoomstart",x)).fire(new n.k("zoom",x)).fire(new n.k("zoomend",x)),P&&this.fire(new n.k("rotatestart",x)).fire(new n.k("rotate",x)).fire(new n.k("rotateend",x)),H&&this.fire(new n.k("pitchstart",x)).fire(new n.k("pitch",x)).fire(new n.k("pitchend",x)),this.fire(new n.k("moveend",x))}calculateCameraOptionsFromTo(o,x,A,I=0){const P=n.Z.fromLngLat(o,x),H=n.Z.fromLngLat(A,I),K=H.x-P.x,ne=H.y-P.y,he=H.z-P.z,be=Math.hypot(K,ne,he);if(be===0)throw new Error("Can't calculate camera options with same From and To");const we=Math.hypot(K,ne),Be=this.transform.scaleZoom(this.transform.cameraToCenterDistance/be/this.transform.tileSize),Ye=180*Math.atan2(K,-ne)/Math.PI;let st=180*Math.acos(we/be)/Math.PI;return st=he<0?90-st:90+st,{center:H.toLngLat(),zoom:Be,pitch:st,bearing:Ye}}easeTo(o,x){var A;this._stop(!1,o.easeId),((o=n.e({offset:[0,0],duration:500,easing:n.b9},o)).animate===!1||!o.essential&&ut.prefersReducedMotion)&&(o.duration=0);const I=this._getTransformForUpdate(),P=I.zoom,H=I.bearing,K=I.pitch,ne=I.padding,he="bearing"in o?this._normalizeBearing(o.bearing,H):H,be="pitch"in o?+o.pitch:K,we="padding"in o?o.padding:I.padding,Be=n.P.convert(o.offset);let Ye=I.centerPoint.add(Be);const st=I.pointLocation(Ye),{center:vt,zoom:Et}=I.getConstrained(n.N.convert(o.center||st),(A=o.zoom)!==null&&A!==void 0?A:P);this._normalizeCenter(vt,I);const Ct=I.project(st),Lt=I.project(vt).sub(Ct),_t=I.zoomScale(Et-P);let Ht,Qt;o.around&&(Ht=n.N.convert(o.around),Qt=I.locationPoint(Ht));const oi={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Et!==P,this._rotating=this._rotating||H!==he,this._pitching=this._pitching||be!==K,this._padding=!I.isPaddingEqual(we),this._easeId=o.easeId,this._prepareEase(x,o.noMoveStart,oi),this.terrain&&this._prepareElevation(vt),this._ease(($i=>{if(this._zooming&&(I.zoom=n.y.number(P,Et,$i)),this._rotating&&(I.bearing=n.y.number(H,he,$i)),this._pitching&&(I.pitch=n.y.number(K,be,$i)),this._padding&&(I.interpolatePadding(ne,we,$i),Ye=I.centerPoint.add(Be)),this.terrain&&!o.freezeElevation&&this._updateElevation($i),Ht)I.setLocationAtPoint(Ht,Qt);else{const An=I.zoomScale(I.zoom-P),Mn=Et>P?Math.min(2,_t):Math.max(.5,_t),Zn=Math.pow(Mn,1-$i),Ln=I.unproject(Ct.add(Lt.mult($i*Zn)).mult(An));I.setLocationAtPoint(I.renderWorldCopies?Ln.wrap():Ln,Ye)}this._applyUpdatedTransform(I),this._fireMoveEvents(x)}),($i=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(x,$i)}),o),this}_prepareEase(o,x,A={}){this._moving=!0,x||A.moving||this.fire(new n.k("movestart",o)),this._zooming&&!A.zooming&&this.fire(new n.k("zoomstart",o)),this._rotating&&!A.rotating&&this.fire(new n.k("rotatestart",o)),this._pitching&&!A.pitching&&this.fire(new n.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const x=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&x!==this._elevationTarget){const A=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(A-(x-(A*o+this._elevationStart))/(1-o)),this._elevationTarget=x}this.transform.elevation=n.y.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(o){const x=o.getCameraPosition(),A=this.terrain.getElevationForLngLatZoom(x.lngLat,o.zoom);if(x.altitude<A){const I=this.calculateCameraOptionsFromTo(x.lngLat,A,o.center,o.elevation);return{pitch:I.pitch,zoom:I.zoom}}return{}}_applyUpdatedTransform(o){const x=[];if(this.terrain&&x.push((I=>this._elevateCameraIfInsideTerrain(I))),this.transformCameraUpdate&&x.push((I=>this.transformCameraUpdate(I))),!x.length)return;const A=o.clone();for(const I of x){const P=A.clone(),{center:H,zoom:K,pitch:ne,bearing:he,elevation:be}=I(P);H&&(P.center=H),K!==void 0&&(P.zoom=K),ne!==void 0&&(P.pitch=ne),he!==void 0&&(P.bearing=he),be!==void 0&&(P.elevation=be),A.apply(P)}this.transform.apply(A)}_fireMoveEvents(o){this.fire(new n.k("move",o)),this._zooming&&this.fire(new n.k("zoom",o)),this._rotating&&this.fire(new n.k("rotate",o)),this._pitching&&this.fire(new n.k("pitch",o))}_afterEase(o,x){if(this._easeId&&x&&this._easeId===x)return;delete this._easeId;const A=this._zooming,I=this._rotating,P=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,A&&this.fire(new n.k("zoomend",o)),I&&this.fire(new n.k("rotateend",o)),P&&this.fire(new n.k("pitchend",o)),this.fire(new n.k("moveend",o))}flyTo(o,x){var A;if(!o.essential&&ut.prefersReducedMotion){const qn=n.M(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(qn,x)}this.stop(),o=n.e({offset:[0,0],speed:1.2,curve:1.42,easing:n.b9},o);const I=this._getTransformForUpdate(),P=I.zoom,H=I.bearing,K=I.pitch,ne=I.padding,he="bearing"in o?this._normalizeBearing(o.bearing,H):H,be="pitch"in o?+o.pitch:K,we="padding"in o?o.padding:I.padding,Be=n.P.convert(o.offset);let Ye=I.centerPoint.add(Be);const st=I.pointLocation(Ye),{center:vt,zoom:Et}=I.getConstrained(n.N.convert(o.center||st),(A=o.zoom)!==null&&A!==void 0?A:P);this._normalizeCenter(vt,I);const Ct=I.zoomScale(Et-P),Lt=I.project(st),_t=I.project(vt).sub(Lt);let Ht=o.curve;const Qt=Math.max(I.width,I.height),oi=Qt/Ct,$i=_t.mag();if("minZoom"in o){const qn=n.ac(Math.min(o.minZoom,P,Et),I.minZoom,I.maxZoom),Yr=Qt/I.zoomScale(qn-P);Ht=Math.sqrt(Yr/$i*2)}const An=Ht*Ht;function Mn(qn){const Yr=(oi*oi-Qt*Qt+(qn?-1:1)*An*An*$i*$i)/(2*(qn?oi:Qt)*An*$i);return Math.log(Math.sqrt(Yr*Yr+1)-Yr)}function Zn(qn){return(Math.exp(qn)-Math.exp(-qn))/2}function Ln(qn){return(Math.exp(qn)+Math.exp(-qn))/2}const zn=Mn(!1);let ir=function(qn){return Ln(zn)/Ln(zn+Ht*qn)},$r=function(qn){return Qt*((Ln(zn)*(Zn(Yr=zn+Ht*qn)/Ln(Yr))-Zn(zn))/An)/$i;var Yr},On=(Mn(!0)-zn)/Ht;if(Math.abs($i)<1e-6||!isFinite(On)){if(Math.abs(Qt-oi)<1e-6)return this.easeTo(o,x);const qn=oi<Qt?-1:1;On=Math.abs(Math.log(oi/Qt))/Ht,$r=()=>0,ir=Yr=>Math.exp(qn*Ht*Yr)}return o.duration="duration"in o?+o.duration:1e3*On/("screenSpeed"in o?+o.screenSpeed/Ht:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=H!==he,this._pitching=be!==K,this._padding=!I.isPaddingEqual(we),this._prepareEase(x,!1),this.terrain&&this._prepareElevation(vt),this._ease((qn=>{const Yr=qn*On,Qa=1/ir(Yr);I.zoom=qn===1?Et:P+I.scaleZoom(Qa),this._rotating&&(I.bearing=n.y.number(H,he,qn)),this._pitching&&(I.pitch=n.y.number(K,be,qn)),this._padding&&(I.interpolatePadding(ne,we,qn),Ye=I.centerPoint.add(Be)),this.terrain&&!o.freezeElevation&&this._updateElevation(qn);const Ma=qn===1?vt:I.unproject(Lt.add(_t.mult($r(Yr))).mult(Qa));I.setLocationAtPoint(I.renderWorldCopies?Ma.wrap():Ma,Ye),this._applyUpdatedTransform(I),this._fireMoveEvents(x)}),(()=>{this.terrain&&o.freezeElevation&&this._finalizeElevation(),this._afterEase(x)}),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,x){var A;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const I=this._onEaseEnd;delete this._onEaseEnd,I.call(this,x)}return o||(A=this.handlers)===null||A===void 0||A.stop(!1),this}_ease(o,x,A){A.animate===!1||A.duration===0?(o(1),x()):(this._easeStart=ut.now(),this._easeOptions=A,this._onEaseFrame=o,this._onEaseEnd=x,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,x){o=n.b3(o,-180,180);const A=Math.abs(o-x);return Math.abs(o-360-x)<A&&(o-=360),Math.abs(o+360-x)<A&&(o+=360),o}_normalizeCenter(o,x){if(!x.renderWorldCopies||x.lngRange)return;const A=o.lng-x.center.lng;o.lng+=A>180?-360:A<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(n.N.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const Ql={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ch{constructor(o=Ql){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=x=>{!x||x.sourceDataType!=="metadata"&&x.sourceDataType!=="visibility"&&x.dataType!=="style"&&x.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=bt.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=bt.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=bt.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){bt.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,x){const A=this._map._getUIString(`AttributionControl.${x}`);o.title=A,o.setAttribute("aria-label",A)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map((I=>typeof I!="string"?"":I))):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const I=this._map.style.stylesheet;this.styleOwner=I.owner,this.styleId=I.id}const x=this._map.style.sourceCaches;for(const I in x){const P=x[I];if(P.used||P.usedForTerrain){const H=P.getSource();H.attribution&&o.indexOf(H.attribution)<0&&o.push(H.attribution)}}o=o.filter((I=>String(I).trim())),o.sort(((I,P)=>I.length-P.length)),o=o.filter(((I,P)=>{for(let H=P+1;H<o.length;H++)if(o[H].indexOf(I)>=0)return!1;return!0}));const A=o.join(" | ");A!==this._attribHTML&&(this._attribHTML=A,o.length?(this._innerContainer.innerHTML=A,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ef{constructor(o={}){this._updateCompact=()=>{const x=this._container.children;if(x.length){const A=x[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&A.classList.add("maplibregl-compact"):A.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=bt.create("div","maplibregl-ctrl");const x=bt.create("a","maplibregl-ctrl-logo");return x.target="_blank",x.rel="noopener nofollow",x.href="https://maplibre.org/",x.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),x.setAttribute("rel","noopener nofollow"),this._container.appendChild(x),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){bt.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ia{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const x=++this._id;return this._queue.push({callback:o,id:x,cancelled:!1}),x}remove(o){const x=this._currentlyRunning,A=x?this._queue.concat(x):this._queue;for(const I of A)if(I.id===o)return void(I.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const x=this._currentlyRunning=this._queue;this._queue=[];for(const A of x)if(!A.cancelled&&(A.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Yc=n.Y([{name:"a_pos3d",type:"Int16",components:3}]);class tp extends n.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,x){this.sourceCache.update(o,x),this._renderableTilesKeys=[];const A={};for(const I of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:x}))A[I.key]=!0,this._renderableTilesKeys.push(I.key),this._tiles[I.key]||(I.posMatrix=new Float64Array(16),n.aP(I.posMatrix,0,n.X,0,n.X,0,1),this._tiles[I.key]=new So(I,this.tileSize));for(const I in this._tiles)A[I]||delete this._tiles[I]}freeRtt(o){for(const x in this._tiles){const A=this._tiles[x];(!o||A.tileID.equals(o)||A.tileID.isChildOf(o)||o.isChildOf(A.tileID))&&(A.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map((o=>this.getTileByID(o)))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const x={};for(const A of this._renderableTilesKeys){const I=this._tiles[A].tileID;if(I.canonical.equals(o.canonical)){const P=o.clone();P.posMatrix=new Float64Array(16),n.aP(P.posMatrix,0,n.X,0,n.X,0,1),x[A]=P}else if(I.canonical.isChildOf(o.canonical)){const P=o.clone();P.posMatrix=new Float64Array(16);const H=I.canonical.z-o.canonical.z,K=I.canonical.x-(I.canonical.x>>H<<H),ne=I.canonical.y-(I.canonical.y>>H<<H),he=n.X>>H;n.aP(P.posMatrix,0,he,0,he,0,1),n.J(P.posMatrix,P.posMatrix,[-K*he,-ne*he,0]),x[A]=P}else if(o.canonical.isChildOf(I.canonical)){const P=o.clone();P.posMatrix=new Float64Array(16);const H=o.canonical.z-I.canonical.z,K=o.canonical.x-(o.canonical.x>>H<<H),ne=o.canonical.y-(o.canonical.y>>H<<H),he=n.X>>H;n.aP(P.posMatrix,0,n.X,0,n.X,0,1),n.J(P.posMatrix,P.posMatrix,[K*he,ne*he,0]),n.K(P.posMatrix,P.posMatrix,[1/2**H,1/2**H,0]),x[A]=P}}return x}getSourceTile(o,x){const A=this.sourceCache._source;let I=o.overscaledZ-this.deltaZoom;if(I>A.maxzoom&&(I=A.maxzoom),I<A.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(I).key);let P=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!P||!P.dem)&&x)for(;I>=A.minzoom&&(!P||!P.dem);)P=this.sourceCache.getTileByID(o.scaledTo(I--).key);return P}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter((x=>x.timeAdded>=o))}}class fd{constructor(o,x,A){this.painter=o,this.sourceCache=new tp(x),this.options=A,this.exaggeration=typeof A.exaggeration=="number"?A.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,x,A,I=n.X){var P;if(!(x>=0&&x<I&&A>=0&&A<I))return 0;const H=this.getTerrainData(o),K=(P=H.tile)===null||P===void 0?void 0:P.dem;if(!K)return 0;const ne=(function(st,vt,Et){var Ct=vt[0],Lt=vt[1];return st[0]=Et[0]*Ct+Et[4]*Lt+Et[12],st[1]=Et[1]*Ct+Et[5]*Lt+Et[13],st})([],[x/I*n.X,A/I*n.X],H.u_terrain_matrix),he=[ne[0]*K.dim,ne[1]*K.dim],be=Math.floor(he[0]),we=Math.floor(he[1]),Be=he[0]-be,Ye=he[1]-we;return K.get(be,we)*(1-Be)*(1-Ye)+K.get(be+1,we)*Be*(1-Ye)+K.get(be,we+1)*(1-Be)*Ye+K.get(be+1,we+1)*Be*Ye}getElevationForLngLatZoom(o,x){if(!n.bb(x,o.wrap()))return 0;const{tileID:A,mercatorX:I,mercatorY:P}=this._getOverscaledTileIDFromLngLatZoom(o,x);return this.getElevation(A,I%n.X,P%n.X,n.X)}getElevation(o,x,A,I=n.X){return this.getDEMElevation(o,x,A,I)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const I=this.painter.context,P=new n.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new dn(I,P,I.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new dn(I,new n.R({width:1,height:1}),I.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(I.gl.NEAREST,I.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=n.an([])}const x=this.sourceCache.getSourceTile(o,!0);if(x&&x.dem&&(!x.demTexture||x.needsTerrainPrepare)){const I=this.painter.context;x.demTexture=this.painter.getTileTexture(x.dem.stride),x.demTexture?x.demTexture.update(x.dem.getPixels(),{premultiply:!1}):x.demTexture=new dn(I,x.dem.getPixels(),I.gl.RGBA,{premultiply:!1}),x.demTexture.bind(I.gl.NEAREST,I.gl.CLAMP_TO_EDGE),x.needsTerrainPrepare=!1}const A=x&&x+x.tileID.key+o.key;if(A&&!this._demMatrixCache[A]){const I=this.sourceCache.sourceCache._source.maxzoom;let P=o.canonical.z-x.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=I?P=o.canonical.z-I:n.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const H=o.canonical.x-(o.canonical.x>>P<<P),K=o.canonical.y-(o.canonical.y>>P<<P),ne=n.bc(new Float64Array(16),[1/(n.X<<P),1/(n.X<<P),0]);n.J(ne,ne,[H*n.X,K*n.X,0]),this._demMatrixCache[o.key]={matrix:ne,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:x&&x.dem&&x.dem.dim||1,u_terrain_matrix:A?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:x&&x.dem&&x.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(x&&x.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:x}}getFramebuffer(o){const x=this.painter,A=x.width/devicePixelRatio,I=x.height/devicePixelRatio;return!this._fbo||this._fbo.width===A&&this._fbo.height===I||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new dn(x.context,{width:A,height:I,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new dn(x.context,{width:A,height:I,data:null},x.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(x.context.gl.NEAREST,x.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=x.context.createFramebuffer(A,I,!0,!1),this._fbo.depthAttachment.set(x.context.createRenderbuffer(x.context.gl.DEPTH_COMPONENT16,A,I))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const x=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let P=0,H=0;P<this._coordsTextureSize;P++)for(let K=0;K<this._coordsTextureSize;K++,H+=4)x[H+0]=255&K,x[H+1]=255&P,x[H+2]=K>>8<<4|P>>8,x[H+3]=0;const A=new n.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(x.buffer)),I=new dn(o,A,o.gl.RGBA,{premultiply:!1});return I.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=I,I}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const x=new Uint8Array(4),A=this.painter.context,I=A.gl,P=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),H=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),K=Math.round(this.painter.height/devicePixelRatio);A.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),I.readPixels(P,K-H-1,1,1,I.RGBA,I.UNSIGNED_BYTE,x),A.bindFramebuffer.set(null);const ne=x[0]+(x[2]>>4<<8),he=x[1]+((15&x[2])<<8),be=this.coordsIndex[255-x[3]],we=be&&this.sourceCache.getTileByID(be);if(!we)return null;const Be=this._coordsTextureSize,Ye=(1<<we.tileID.canonical.z)*Be;return new n.Z((we.tileID.canonical.x*Be+ne)/Ye+we.tileID.wrap,(we.tileID.canonical.y*Be+he)/Ye,this.getElevation(we.tileID,ne,he,Be))}depthAtPoint(o){const x=new Uint8Array(4),A=this.painter.context,I=A.gl;return A.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),I.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,I.RGBA,I.UNSIGNED_BYTE,x),A.bindFramebuffer.set(null),(x[0]/16777216+x[1]/65536+x[2]/256+x[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,x=new n.bd,A=new n.aY,I=this.meshSize,P=n.X/I,H=I*I;for(let we=0;we<=I;we++)for(let Be=0;Be<=I;Be++)x.emplaceBack(Be*P,we*P,0);for(let we=0;we<H;we+=I+1)for(let Be=0;Be<I;Be++)A.emplaceBack(Be+we,I+Be+we+1,I+Be+we+2),A.emplaceBack(Be+we,I+Be+we+2,Be+we+1);const K=x.length,ne=K+2*(I+1);for(const we of[0,1])for(let Be=0;Be<=I;Be++)for(const Ye of[0,1])x.emplaceBack(Be*P,we*n.X,Ye);for(let we=0;we<2*I;we+=2)A.emplaceBack(ne+we,ne+we+1,ne+we+3),A.emplaceBack(ne+we,ne+we+3,ne+we+2),A.emplaceBack(K+we,K+we+3,K+we+1),A.emplaceBack(K+we,K+we+2,K+we+3);const he=x.length,be=he+2*(I+1);for(const we of[0,1])for(let Be=0;Be<=I;Be++)for(const Ye of[0,1])x.emplaceBack(we*n.X,Be*P,Ye);for(let we=0;we<2*I;we+=2)A.emplaceBack(he+we,he+we+1,he+we+3),A.emplaceBack(he+we,he+we+3,he+we+2),A.emplaceBack(be+we,be+we+3,be+we+1),A.emplaceBack(be+we,be+we+2,be+we+3);return this._mesh=new fu(o.createVertexBuffer(x,Yc.members),o.createIndexBuffer(A),n.a0.simpleSegment(0,0,x.length,A.length)),this._mesh}getMeshFrameDelta(o){return 2*Math.PI*n.be/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,x){var A;const{tileID:I}=this._getOverscaledTileIDFromLngLatZoom(o,x);return(A=this.getMinMaxElevation(I).minElevation)!==null&&A!==void 0?A:0}getMinMaxElevation(o){const x=this.getTerrainData(o).tile,A={minElevation:null,maxElevation:null};return x&&x.dem&&(A.minElevation=x.dem.min*this.exaggeration,A.maxElevation=x.dem.max*this.exaggeration),A}_getOverscaledTileIDFromLngLatZoom(o,x){const A=n.Z.fromLngLat(o.wrap()),I=(1<<x)*n.X,P=A.x*I,H=A.y*I,K=Math.floor(P/n.X),ne=Math.floor(H/n.X);return{tileID:new n.S(x,0,x,K,ne),mercatorX:P,mercatorY:H}}}class ip{constructor(o,x,A){this._context=o,this._size=x,this._tileSize=A,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const x=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),A=new dn(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return A.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),x.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),x.colorAttachment.set(A.texture),{id:o,fbo:x,texture:A,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter((x=>o.id!==x)),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const x of this._recentlyUsed)if(!this._objects[x].inUse)return this._objects[x];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some((o=>!o.inUse))===!1}}const Fl={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Uu{constructor(o,x){this.painter=o,this.terrain=x,this.pool=new ip(o.context,30,x.sourceCache.tileSize*x.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,x){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter((A=>!o._layers[A].isHidden(x))),this._coordsDescendingInv={};for(const A in o.sourceCaches){this._coordsDescendingInv[A]={};const I=o.sourceCaches[A].getVisibleCoordinates();for(const P of I){const H=this.terrain.sourceCache.getTerrainCoords(P);for(const K in H)this._coordsDescendingInv[A][K]||(this._coordsDescendingInv[A][K]=[]),this._coordsDescendingInv[A][K].push(H[K])}}this._coordsDescendingInvStr={};for(const A of o._order){const I=o._layers[A],P=I.source;if(Fl[I.type]&&!this._coordsDescendingInvStr[P]){this._coordsDescendingInvStr[P]={};for(const H in this._coordsDescendingInv[P])this._coordsDescendingInvStr[P][H]=this._coordsDescendingInv[P][H].map((K=>K.key)).sort().join()}}for(const A of this._renderableTiles)for(const I in this._coordsDescendingInvStr){const P=this._coordsDescendingInvStr[I][A.tileID.key];P&&P!==A.rttCoords[I]&&(A.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const x=o.type,A=this.painter,I=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Fl[x]&&(this._prevType&&Fl[this._prevType]||this._stacks.push([]),this._prevType=x,this._stacks[this._stacks.length-1].push(o.id),!I))return!0;if(Fl[this._prevType]||Fl[x]&&I){this._prevType=x;const P=this._stacks.length-1,H=this._stacks[P]||[];for(const K of this._renderableTiles){if(this.pool.isFull()&&(od(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(K),K.rtt[P]){const he=this.pool.getObjectForId(K.rtt[P].id);if(he.stamp===K.rtt[P].stamp){this.pool.useObject(he);continue}}const ne=this.pool.getOrCreateFreeObject();this.pool.useObject(ne),this.pool.stampObject(ne),K.rtt[P]={id:ne.id,stamp:ne.stamp},A.context.bindFramebuffer.set(ne.fbo.framebuffer),A.context.clear({color:n.aM.transparent,stencil:0}),A.currentStencilSource=void 0;for(let he=0;he<H.length;he++){const be=A.style._layers[H[he]],we=be.source?this._coordsDescendingInv[be.source][K.tileID.key]:[K.tileID];A.context.viewport.set([0,0,ne.fbo.width,ne.fbo.height]),A._renderTileClippingMasks(be,we),A.renderLayer(A,A.style.sourceCaches[be.source],be,we),be.source&&(K.rttCoords[be.source]=this._coordsDescendingInvStr[be.source][K.tileID.key])}}return od(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Fl[x]}return!1}}const uh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},hh=tt,zp={hash:!1,interactive:!0,bearingSnap:7,attributionControl:Ql,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:n.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},zd=L=>{L.touchstart=L.dragStart,L.touchmoveWindow=L.dragMove,L.touchend=L.dragEnd},pd={showCompass:!0,showZoom:!0,visualizePitch:!1};class tf{constructor(o,x,A=!1){this.mousedown=H=>{this.startMouse(n.e({},H,{ctrlKey:!0,preventDefault:()=>H.preventDefault()}),bt.mousePos(this.element,H)),bt.addEventListener(window,"mousemove",this.mousemove),bt.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=H=>{this.moveMouse(H,bt.mousePos(this.element,H))},this.mouseup=H=>{this.mouseRotate.dragEnd(H),this.mousePitch&&this.mousePitch.dragEnd(H),this.offTemp()},this.touchstart=H=>{H.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=bt.touchPos(this.element,H.targetTouches)[0],this.startTouch(H,this._startPos),bt.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),bt.addEventListener(window,"touchend",this.touchend))},this.touchmove=H=>{H.targetTouches.length!==1?this.reset():(this._lastPos=bt.touchPos(this.element,H.targetTouches)[0],this.moveTouch(H,this._lastPos))},this.touchend=H=>{H.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const I=o.dragRotate._mouseRotate.getClickTolerance(),P=o.dragRotate._mousePitch.getClickTolerance();this.element=x,this.mouseRotate=Nu({clickTolerance:I,enable:!0}),this.touchRotate=(({enable:H,clickTolerance:K,bearingDegreesPerPixelMoved:ne=.8})=>{const he=new Fu;return new yl({clickTolerance:K,move:(be,we)=>({bearingDelta:(we.x-be.x)*ne}),moveStateManager:he,enable:H,assignEvents:zd})})({clickTolerance:I,enable:!0}),this.map=o,A&&(this.mousePitch=Oh({clickTolerance:P,enable:!0}),this.touchPitch=(({enable:H,clickTolerance:K,pitchDegreesPerPixelMoved:ne=-.5})=>{const he=new Fu;return new yl({clickTolerance:K,move:(be,we)=>({pitchDelta:(we.y-be.y)*ne}),moveStateManager:he,enable:H,assignEvents:zd})})({clickTolerance:P,enable:!0})),bt.addEventListener(x,"mousedown",this.mousedown),bt.addEventListener(x,"touchstart",this.touchstart,{passive:!1}),bt.addEventListener(x,"touchcancel",this.reset)}startMouse(o,x){this.mouseRotate.dragStart(o,x),this.mousePitch&&this.mousePitch.dragStart(o,x),bt.disableDrag()}startTouch(o,x){this.touchRotate.dragStart(o,x),this.touchPitch&&this.touchPitch.dragStart(o,x),bt.disableDrag()}moveMouse(o,x){const A=this.map,{bearingDelta:I}=this.mouseRotate.dragMove(o,x)||{};if(I&&A.setBearing(A.getBearing()+I),this.mousePitch){const{pitchDelta:P}=this.mousePitch.dragMove(o,x)||{};P&&A.setPitch(A.getPitch()+P)}}moveTouch(o,x){const A=this.map,{bearingDelta:I}=this.touchRotate.dragMove(o,x)||{};if(I&&A.setBearing(A.getBearing()+I),this.touchPitch){const{pitchDelta:P}=this.touchPitch.dragMove(o,x)||{};P&&A.setPitch(A.getPitch()+P)}}off(){const o=this.element;bt.removeEventListener(o,"mousedown",this.mousedown),bt.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),bt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),bt.removeEventListener(window,"touchend",this.touchend),bt.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){bt.enableDrag(),bt.removeEventListener(window,"mousemove",this.mousemove),bt.removeEventListener(window,"mouseup",this.mouseup),bt.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),bt.removeEventListener(window,"touchend",this.touchend)}}let Wo;function ka(L,o,x){const A=new n.N(L.lng,L.lat);if(L=new n.N(L.lng,L.lat),o){const I=new n.N(L.lng-360,L.lat),P=new n.N(L.lng+360,L.lat),H=x.locationPoint(L).distSqr(o);x.locationPoint(I).distSqr(o)<H?L=I:x.locationPoint(P).distSqr(o)<H&&(L=P)}for(;Math.abs(L.lng-x.center.lng)>180;){const I=x.locationPoint(L);if(I.x>=0&&I.y>=0&&I.x<=x.width&&I.y<=x.height)break;L.lng>x.center.lng?L.lng-=360:L.lng+=360}return L.lng!==A.lng&&x.locationPoint(L).y>x.height/2-x.getHorizon()?L:A}const xu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function md(L,o,x){const A=L.classList;for(const I in xu)A.remove(`maplibregl-${x}-anchor-${I}`);A.add(`maplibregl-${x}-anchor-${o}`)}class Uh extends n.E{constructor(o){if(super(),this._onKeyPress=x=>{const A=x.code,I=x.charCode||x.keyCode;A!=="Space"&&A!=="Enter"&&I!==32&&I!==13||this.togglePopup()},this._onMapClick=x=>{const A=x.originalEvent.target,I=this._element;this._popup&&(A===I||I.contains(A))&&this.togglePopup()},this._update=x=>{var A;if(!this._map)return;const I=this._map.loaded()&&!this._map.isMoving();(x?.type==="terrain"||x?.type==="render"&&!I)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ka(this._lngLat,this._flatPos,this._map.transform):(A=this._lngLat)===null||A===void 0?void 0:A.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let P="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?P=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(P=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let H="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?H="rotateX(0deg)":this._pitchAlignment==="map"&&(H=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||x&&x.type!=="moveend"||(this._pos=this._pos.round()),bt.setTransform(this._element,`${xu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${H} ${P}`),ut.frameAsync(new AbortController).then((()=>{this._updateOpacity(x&&x.type==="moveend")})).catch((()=>{}))},this._onMove=x=>{if(!this._isDragging){const A=this._clickTolerance||this._map._clickTolerance;this._isDragging=x.point.dist(this._pointerdownPos)>=A}this._isDragging&&(this._pos=x.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.k("dragstart"))),this.fire(new n.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new n.k("dragend")),this._state="inactive"},this._addDragHandler=x=>{this._element.contains(x.originalEvent.target)&&(x.preventDefault(),this._positionDelta=x.point.sub(this._pos).add(this._offset),this._pointerdownPos=x.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._subpixelPositioning=o&&o.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o?.opacity,o?.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=n.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=bt.create("div");const x=bt.createNS("http://www.w3.org/2000/svg","svg"),A=41,I=27;x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height",`${A}px`),x.setAttributeNS(null,"width",`${I}px`),x.setAttributeNS(null,"viewBox",`0 0 ${I} ${A}`);const P=bt.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"stroke","none"),P.setAttributeNS(null,"stroke-width","1"),P.setAttributeNS(null,"fill","none"),P.setAttributeNS(null,"fill-rule","evenodd");const H=bt.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill-rule","nonzero");const K=bt.createNS("http://www.w3.org/2000/svg","g");K.setAttributeNS(null,"transform","translate(3.0, 29.0)"),K.setAttributeNS(null,"fill","#000000");const ne=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ct of ne){const Lt=bt.createNS("http://www.w3.org/2000/svg","ellipse");Lt.setAttributeNS(null,"opacity","0.04"),Lt.setAttributeNS(null,"cx","10.5"),Lt.setAttributeNS(null,"cy","5.80029008"),Lt.setAttributeNS(null,"rx",Ct.rx),Lt.setAttributeNS(null,"ry",Ct.ry),K.appendChild(Lt)}const he=bt.createNS("http://www.w3.org/2000/svg","g");he.setAttributeNS(null,"fill",this._color);const be=bt.createNS("http://www.w3.org/2000/svg","path");be.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),he.appendChild(be);const we=bt.createNS("http://www.w3.org/2000/svg","g");we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"fill","#000000");const Be=bt.createNS("http://www.w3.org/2000/svg","path");Be.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),we.appendChild(Be);const Ye=bt.createNS("http://www.w3.org/2000/svg","g");Ye.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Ye.setAttributeNS(null,"fill","#FFFFFF");const st=bt.createNS("http://www.w3.org/2000/svg","g");st.setAttributeNS(null,"transform","translate(8.0, 8.0)");const vt=bt.createNS("http://www.w3.org/2000/svg","circle");vt.setAttributeNS(null,"fill","#000000"),vt.setAttributeNS(null,"opacity","0.25"),vt.setAttributeNS(null,"cx","5.5"),vt.setAttributeNS(null,"cy","5.5"),vt.setAttributeNS(null,"r","5.4999962");const Et=bt.createNS("http://www.w3.org/2000/svg","circle");Et.setAttributeNS(null,"fill","#FFFFFF"),Et.setAttributeNS(null,"cx","5.5"),Et.setAttributeNS(null,"cy","5.5"),Et.setAttributeNS(null,"r","5.4999962"),st.appendChild(vt),st.appendChild(Et),H.appendChild(K),H.appendChild(he),H.appendChild(we),H.appendChild(Ye),H.appendChild(st),x.appendChild(H),x.setAttributeNS(null,"height",A*this._scale+"px"),x.setAttributeNS(null,"width",I*this._scale+"px"),this._element.appendChild(x),this._offset=n.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",(x=>{x.preventDefault()})),this._element.addEventListener("mousedown",(x=>{x.preventDefault()})),md(this._element,this._anchor,"marker"),o&&o.className)for(const x of o.className.split(" "))this._element.classList.add(x);this._popup=null}addTo(o){return this.remove(),this._map=o,this._element.setAttribute("aria-label",o._getUIString("Marker.Title")),o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),bt.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=n.N.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const I=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(38.1-13.5+I)],"bottom-right":[-I,-1*(38.1-13.5+I)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(o){return this._subpixelPositioning=o,this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var x,A;if(!(!((x=this._map)===null||x===void 0)&&x.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout((()=>{this._opacityTimeout=null}),100)}const I=this._map,P=I.terrain.depthAtPoint(this._pos),H=I.terrain.getElevationForLngLatZoom(this._lngLat,I.transform.tileZoom);if(I.transform.lngLatToCameraDepth(this._lngLat,H)-P<.006)return void(this._element.style.opacity=this._opacity);const K=-this._offset.y/I.transform._pixelPerMeter,ne=Math.sin(I.getPitch()*Math.PI/180)*K,he=I.terrain.depthAtPoint(new n.P(this._pos.x,this._pos.y-this._offset.y)),be=I.transform.lngLatToCameraDepth(this._lngLat,H+ne)-he>.006;!((A=this._popup)===null||A===void 0)&&A.isOpen()&&be&&this._popup.remove(),this._element.style.opacity=be?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=n.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,x){return o===void 0&&x===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),x!==void 0&&(this._opacityWhenCovered=x),this._map&&this._updateOpacity(!0),this}}const nf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let rf=0,ls=!1;const pc={maxWidth:100,unit:"metric"};function Kc(L,o,x){const A=x&&x.maxWidth||100,I=L._container.clientHeight/2,P=L.unproject([0,I]),H=L.unproject([A,I]),K=P.distanceTo(H);if(x&&x.unit==="imperial"){const ne=3.2808*K;ne>5280?Xn(o,A,ne/5280,L._getUIString("ScaleControl.Miles")):Xn(o,A,ne,L._getUIString("ScaleControl.Feet"))}else x&&x.unit==="nautical"?Xn(o,A,K/1852,L._getUIString("ScaleControl.NauticalMiles")):K>=1e3?Xn(o,A,K/1e3,L._getUIString("ScaleControl.Kilometers")):Xn(o,A,K,L._getUIString("ScaleControl.Meters"))}function Xn(L,o,x,A){const I=(function(P){const H=Math.pow(10,`${Math.floor(P)}`.length-1);let K=P/H;return K=K>=10?10:K>=5?5:K>=3?3:K>=2?2:K>=1?1:(function(ne){const he=Math.pow(10,Math.ceil(-Math.log(ne)/Math.LN10));return Math.round(ne*he)/he})(K),H*K})(x);L.style.width=o*(I/x)+"px",L.innerHTML=`${I}&nbsp;${A}`}const Pr={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},vu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ju(L){if(L){if(typeof L=="number"){const o=Math.round(Math.abs(L)/Math.SQRT2);return{center:new n.P(0,0),top:new n.P(0,L),"top-left":new n.P(o,o),"top-right":new n.P(-o,o),bottom:new n.P(0,-L),"bottom-left":new n.P(o,-o),"bottom-right":new n.P(-o,-o),left:new n.P(L,0),right:new n.P(-L,0)}}if(L instanceof n.P||Array.isArray(L)){const o=n.P.convert(L);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:n.P.convert(L.center||[0,0]),top:n.P.convert(L.top||[0,0]),"top-left":n.P.convert(L["top-left"]||[0,0]),"top-right":n.P.convert(L["top-right"]||[0,0]),bottom:n.P.convert(L.bottom||[0,0]),"bottom-left":n.P.convert(L["bottom-left"]||[0,0]),"bottom-right":n.P.convert(L["bottom-right"]||[0,0]),left:n.P.convert(L.left||[0,0]),right:n.P.convert(L.right||[0,0])}}return ju(new n.P(0,0))}const _d=tt;le.AJAXError=n.bh,le.Evented=n.E,le.LngLat=n.N,le.MercatorCoordinate=n.Z,le.Point=n.P,le.addProtocol=n.bi,le.config=n.a,le.removeProtocol=n.bj,le.AttributionControl=ch,le.BoxZoomHandler=pi,le.CanvasSource=Vs,le.CooperativeGesturesHandler=mo,le.DoubleClickZoomHandler=Bl,le.DragPanHandler=Qd,le.DragRotateHandler=lh,le.EdgeInsets=Xc,le.FullscreenControl=class extends n.E{constructor(L={}){super(),this._onFullscreenChange=()=>{var o;let x=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=x?.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)x=x.shadowRoot.fullscreenElement;x===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,L&&L.container&&(L.container instanceof HTMLElement?this._container=L.container:n.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(L){return this._map=L,this._container||(this._container=this._map.getContainer()),this._controlContainer=bt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){bt.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const L=this._fullscreenButton=bt.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);bt.create("span","maplibregl-ctrl-icon",L).setAttribute("aria-hidden","true"),L.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const L=this._getTitle();this._fullscreenButton.setAttribute("aria-label",L),this._fullscreenButton.title=L}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new n.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new n.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},le.GeoJSONSource=rl,le.GeolocateControl=class extends n.E{constructor(L){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new n.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new n.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const x=new n.N(o.coords.longitude,o.coords.latitude),A=o.coords.accuracy,I=this._map.getBearing(),P=n.e({bearing:I},this.options.fitBoundsOptions),H=Yt.fromLngLat(x,A);this._map.fitBounds(H,P,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const x=new n.N(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(x).addTo(this._map),this._userLocationDotMarker.setLngLat(x).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&ls)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new n.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this._geolocateButton=bt.create("button","maplibregl-ctrl-geolocate",this._container),bt.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=o=>{if(this._map){if(o===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{const x=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=bt.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Uh({element:this._dotElement}),this._circleElement=bt.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",(()=>this.trigger())),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(x=>{x.geolocateSource||this._watchState!=="ACTIVE_LOCK"||x.originalEvent&&x.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new n.k("trackuserlocationend")),this.fire(new n.k("userlocationlostfocus")))}))}},this.options=n.e({},nf,L)}onAdd(L){return this._map=L,this._container=bt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),(function(){return n._(this,arguments,void 0,(function*(o=!1){if(Wo!==void 0&&!o)return Wo;if(window.navigator.permissions===void 0)return Wo=!!window.navigator.geolocation,Wo;try{Wo=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Wo=!!window.navigator.geolocation}return Wo}))})().then((o=>this._finishSetupUI(o))),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),bt.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,rf=0,ls=!1}_isOutOfMapMaxBounds(L){const o=this._map.getMaxBounds(),x=L.coords;return o&&(x.longitude<o.getWest()||x.longitude>o.getEast()||x.latitude<o.getSouth()||x.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const L=this._map.getBounds(),o=L.getSouthEast(),x=L.getNorthEast(),A=o.distanceTo(x),I=Math.ceil(this._accuracy/(A/this._map._container.clientHeight)*2);this._circleElement.style.width=`${I}px`,this._circleElement.style.height=`${I}px`}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":rf--,ls=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new n.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.k("trackuserlocationstart")),this.fire(new n.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let L;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),rf++,rf>1?(L={maximumAge:6e5,timeout:0},ls=!0):(L=this.options.positionOptions,ls=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,L)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},le.Hash=Cd,le.ImageSource=Vo,le.KeyboardHandler=Ao,le.LngLatBounds=Yt,le.LogoControl=ef,le.Map=class extends Vh{constructor(L){n.bf.mark(n.bg.create);const o=Object.assign(Object.assign({},zp),L);if(o.minZoom!=null&&o.maxZoom!=null&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(o.minPitch!=null&&o.maxPitch!=null&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(o.minPitch!=null&&o.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(o.maxPitch!=null&&o.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new ld(o.minZoom,o.maxZoom,o.minPitch,o.maxPitch,o.renderWorldCopies),{bearingSnap:o.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new Ia,this._controls=[],this._mapId=n.a4(),this._contextLost=x=>{x.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new n.k("webglcontextlost",{originalEvent:x}))},this._contextRestored=x=>{this._setupPainter(),this.resize(),this._update(),this.fire(new n.k("webglcontextrestored",{originalEvent:x}))},this._onMapScroll=x=>{if(x.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=o.interactive,this._maxTileCacheSize=o.maxTileCacheSize,this._maxTileCacheZoomLevels=o.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=o.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=o.preserveDrawingBuffer===!0,this._antialias=o.antialias===!0,this._trackResize=o.trackResize===!0,this._bearingSnap=o.bearingSnap,this._refreshExpiredTiles=o.refreshExpiredTiles===!0,this._fadeDuration=o.fadeDuration,this._crossSourceCollisions=o.crossSourceCollisions===!0,this._collectResourceTiming=o.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},uh),o.locale),this._clickTolerance=o.clickTolerance,this._overridePixelRatio=o.pixelRatio,this._maxCanvasSize=o.maxCanvasSize,this.transformCameraUpdate=o.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=o.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Ji.addThrottleControl((()=>this.isMoving())),this._requestManager=new Vn(o.transformRequest),typeof o.container=="string"){if(this._container=document.getElementById(o.container),!this._container)throw new Error(`Container '${o.container}' not found.`)}else{if(!(o.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=o.container}if(o.maxBounds&&this.setMaxBounds(o.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",(()=>this._update(!1))).on("moveend",(()=>this._update(!1))).on("zoom",(()=>this._update(!0))).on("terrain",(()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)})).once("idle",(()=>{this._idleTriggered=!0})),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let x=!1;const A=mu((I=>{this._trackResize&&!this._removed&&(this.resize(I),this.redraw())}),50);this._resizeObserver=new ResizeObserver((I=>{x?A(I):x=!0})),this._resizeObserver.observe(this._container)}this.handlers=new fc(this,o),this._hash=o.hash&&new Cd(typeof o.hash=="string"&&o.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch}),o.bounds&&(this.resize(),this.fitBounds(o.bounds,n.e({},o.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=o.localIdeographFontFamily,this._validateStyle=o.validateStyle,o.style&&this.setStyle(o.style,{localIdeographFontFamily:o.localIdeographFontFamily}),o.attributionControl&&this.addControl(new ch(typeof o.attributionControl=="boolean"?void 0:o.attributionControl)),o.maplibreLogo&&this.addControl(new ef,o.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)})),this.on("data",(x=>{this._update(x.dataType==="style"),this.fire(new n.k(`${x.dataType}data`,x))})),this.on("dataloading",(x=>{this.fire(new n.k(`${x.dataType}dataloading`,x))})),this.on("dataabort",(x=>{this.fire(new n.k("sourcedataabort",x))}))}_getMapId(){return this._mapId}addControl(L,o){if(o===void 0&&(o=L.getDefaultPosition?L.getDefaultPosition():"top-right"),!L||!L.onAdd)return this.fire(new n.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const x=L.onAdd(this);this._controls.push(L);const A=this._controlPositions[o];return o.indexOf("bottom")!==-1?A.insertBefore(x,A.firstChild):A.appendChild(x),this}removeControl(L){if(!L||!L.onRemove)return this.fire(new n.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(L);return o>-1&&this._controls.splice(o,1),L.onRemove(this),this}hasControl(L){return this._controls.indexOf(L)>-1}calculateCameraOptionsFromTo(L,o,x,A){return A==null&&this.terrain&&(A=this.terrain.getElevationForLngLatZoom(x,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(L,o,x,A)}resize(L){var o;const x=this._containerDimensions(),A=x[0],I=x[1],P=this._getClampedPixelRatio(A,I);if(this._resizeCanvas(A,I,P),this.painter.resize(A,I,P),this.painter.overLimit()){const K=this.painter.context.gl;this._maxCanvasSize=[K.drawingBufferWidth,K.drawingBufferHeight];const ne=this._getClampedPixelRatio(A,I);this._resizeCanvas(A,I,ne),this.painter.resize(A,I,ne)}this.transform.resize(A,I),(o=this._requestedCameraState)===null||o===void 0||o.resize(A,I);const H=!this._moving;return H&&(this.stop(),this.fire(new n.k("movestart",L)).fire(new n.k("move",L))),this.fire(new n.k("resize",L)),H&&this.fire(new n.k("moveend",L)),this}_getClampedPixelRatio(L,o){const{0:x,1:A}=this._maxCanvasSize,I=this.getPixelRatio(),P=L*I,H=o*I;return Math.min(P>x?x/P:1,H>A?A/H:1)*I}getPixelRatio(){var L;return(L=this._overridePixelRatio)!==null&&L!==void 0?L:devicePixelRatio}setPixelRatio(L){this._overridePixelRatio=L,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(L){return this.transform.setMaxBounds(Yt.convert(L)),this._update()}setMinZoom(L){if((L=L??-2)>=-2&&L<=this.transform.maxZoom)return this.transform.minZoom=L,this._update(),this.getZoom()<L&&this.setZoom(L),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(L){if((L=L??22)>=this.transform.minZoom)return this.transform.maxZoom=L,this._update(),this.getZoom()>L&&this.setZoom(L),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(L){if((L=L??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(L>=0&&L<=this.transform.maxPitch)return this.transform.minPitch=L,this._update(),this.getPitch()<L&&this.setPitch(L),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(L){if((L=L??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(L>=this.transform.minPitch)return this.transform.maxPitch=L,this._update(),this.getPitch()>L&&this.setPitch(L),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(L){return this.transform.renderWorldCopies=L,this._update()}project(L){return this.transform.locationPoint(n.N.convert(L),this.style&&this.terrain)}unproject(L){return this.transform.pointLocation(n.P.convert(L),this.terrain)}isMoving(){var L;return this._moving||((L=this.handlers)===null||L===void 0?void 0:L.isMoving())}isZooming(){var L;return this._zooming||((L=this.handlers)===null||L===void 0?void 0:L.isZooming())}isRotating(){var L;return this._rotating||((L=this.handlers)===null||L===void 0?void 0:L.isRotating())}_createDelegatedListener(L,o,x){if(L==="mouseenter"||L==="mouseover"){let A=!1;return{layers:o,listener:x,delegates:{mousemove:P=>{const H=o.filter((ne=>this.getLayer(ne))),K=H.length!==0?this.queryRenderedFeatures(P.point,{layers:H}):[];K.length?A||(A=!0,x.call(this,new Gs(L,this,P.originalEvent,{features:K}))):A=!1},mouseout:()=>{A=!1}}}}if(L==="mouseleave"||L==="mouseout"){let A=!1;return{layers:o,listener:x,delegates:{mousemove:H=>{const K=o.filter((ne=>this.getLayer(ne)));(K.length!==0?this.queryRenderedFeatures(H.point,{layers:K}):[]).length?A=!0:A&&(A=!1,x.call(this,new Gs(L,this,H.originalEvent)))},mouseout:H=>{A&&(A=!1,x.call(this,new Gs(L,this,H.originalEvent)))}}}}{const A=I=>{const P=o.filter((K=>this.getLayer(K))),H=P.length!==0?this.queryRenderedFeatures(I.point,{layers:P}):[];H.length&&(I.features=H,x.call(this,I),delete I.features)};return{layers:o,listener:x,delegates:{[L]:A}}}}_saveDelegatedListener(L,o){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[L]=this._delegatedListeners[L]||[],this._delegatedListeners[L].push(o)}_removeDelegatedListener(L,o,x){if(!this._delegatedListeners||!this._delegatedListeners[L])return;const A=this._delegatedListeners[L];for(let I=0;I<A.length;I++){const P=A[I];if(P.listener===x&&P.layers.length===o.length&&P.layers.every((H=>o.includes(H)))){for(const H in P.delegates)this.off(H,P.delegates[H]);return void A.splice(I,1)}}}on(L,o,x){if(x===void 0)return super.on(L,o);const A=this._createDelegatedListener(L,typeof o=="string"?[o]:o,x);this._saveDelegatedListener(L,A);for(const I in A.delegates)this.on(I,A.delegates[I]);return this}once(L,o,x){if(x===void 0)return super.once(L,o);const A=typeof o=="string"?[o]:o,I=this._createDelegatedListener(L,A,x);for(const P in I.delegates){const H=I.delegates[P];I.delegates[P]=(...K)=>{this._removeDelegatedListener(L,A,x),H(...K)}}this._saveDelegatedListener(L,I);for(const P in I.delegates)this.once(P,I.delegates[P]);return this}off(L,o,x){return x===void 0?super.off(L,o):(this._removeDelegatedListener(L,typeof o=="string"?[o]:o,x),this)}queryRenderedFeatures(L,o){if(!this.style)return[];let x;const A=L instanceof n.P||Array.isArray(L),I=A?L:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(A?{}:L)||{},I instanceof n.P||typeof I[0]=="number")x=[n.P.convert(I)];else{const P=n.P.convert(I[0]),H=n.P.convert(I[1]);x=[P,new n.P(H.x,P.y),H,new n.P(P.x,H.y),P]}return this.style.queryRenderedFeatures(x,o,this.transform)}querySourceFeatures(L,o){return this.style.querySourceFeatures(L,o)}setStyle(L,o){return(o=n.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&L?(this._diffStyle(L,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(L,o))}setTransformRequest(L){return this._requestManager.setTransformRequest(L),this}_getUIString(L){const o=this._locale[L];if(o==null)throw new Error(`Missing UI string '${L}'`);return o}_updateStyle(L,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",(()=>this._updateStyle(L,o)));const x=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!L)),L?(this.style=new nh(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof L=="string"?this.style.loadURL(L,o,x):this.style.loadJSON(L,o,x),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new nh(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(L,o){if(typeof L=="string"){const x=this._requestManager.transformRequest(L,"Style");n.h(x,new AbortController).then((A=>{this._updateDiff(A.data,o)})).catch((A=>{A&&this.fire(new n.j(A))}))}else typeof L=="object"&&this._updateDiff(L,o)}_updateDiff(L,o){try{this.style.setState(L,o)&&this._update(!0)}catch(x){n.w(`Unable to perform style diff: ${x.message||x.error||x}.  Rebuilding the style from scratch.`),this._updateStyle(L,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():n.w("There is no style added to the map.")}addSource(L,o){return this._lazyInitEmptyStyle(),this.style.addSource(L,o),this._update(!0)}isSourceLoaded(L){const o=this.style&&this.style.sourceCaches[L];if(o!==void 0)return o.loaded();this.fire(new n.j(new Error(`There is no source with ID '${L}'`)))}setTerrain(L){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),L){const o=this.style.sourceCaches[L.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${L.source}`);this.terrain===null&&o.reload();for(const x in this.style._layers){const A=this.style._layers[x];A.type==="hillshade"&&A.source===L.source&&n.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new fd(this.painter,o,L),this.painter.renderToTexture=new Uu(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=x=>{x.dataType==="style"?this.terrain.sourceCache.freeRtt():x.dataType==="source"&&x.tile&&(x.sourceId!==L.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(x.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new n.k("terrain",{terrain:L})),this}getTerrain(){var L,o;return(o=(L=this.terrain)===null||L===void 0?void 0:L.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const L=this.style&&this.style.sourceCaches;for(const o in L){const x=L[o]._tiles;for(const A in x){const I=x[A];if(I.state!=="loaded"&&I.state!=="errored")return!1}}return!0}removeSource(L){return this.style.removeSource(L),this._update(!0)}getSource(L){return this.style.getSource(L)}addImage(L,o,x={}){const{pixelRatio:A=1,sdf:I=!1,stretchX:P,stretchY:H,content:K,textFitWidth:ne,textFitHeight:he}=x;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||n.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new n.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:be,height:we,data:Be}=o,Ye=o;return this.style.addImage(L,{data:new n.R({width:be,height:we},new Uint8Array(Be)),pixelRatio:A,stretchX:P,stretchY:H,content:K,textFitWidth:ne,textFitHeight:he,sdf:I,version:0,userImage:Ye}),Ye.onAdd&&Ye.onAdd(this,L),this}}{const{width:be,height:we,data:Be}=ut.getImageData(o);this.style.addImage(L,{data:new n.R({width:be,height:we},Be),pixelRatio:A,stretchX:P,stretchY:H,content:K,textFitWidth:ne,textFitHeight:he,sdf:I,version:0})}}updateImage(L,o){const x=this.style.getImage(L);if(!x)return this.fire(new n.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const A=o instanceof HTMLImageElement||n.b(o)?ut.getImageData(o):o,{width:I,height:P,data:H}=A;if(I===void 0||P===void 0)return this.fire(new n.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(I!==x.data.width||P!==x.data.height)return this.fire(new n.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const K=!(o instanceof HTMLImageElement||n.b(o));return x.data.replace(H,K),this.style.updateImage(L,x),this}getImage(L){return this.style.getImage(L)}hasImage(L){return L?!!this.style.getImage(L):(this.fire(new n.j(new Error("Missing required image id"))),!1)}removeImage(L){this.style.removeImage(L)}loadImage(L){return Ji.getImage(this._requestManager.transformRequest(L,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(L,o){return this._lazyInitEmptyStyle(),this.style.addLayer(L,o),this._update(!0)}moveLayer(L,o){return this.style.moveLayer(L,o),this._update(!0)}removeLayer(L){return this.style.removeLayer(L),this._update(!0)}getLayer(L){return this.style.getLayer(L)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(L,o,x){return this.style.setLayerZoomRange(L,o,x),this._update(!0)}setFilter(L,o,x={}){return this.style.setFilter(L,o,x),this._update(!0)}getFilter(L){return this.style.getFilter(L)}setPaintProperty(L,o,x,A={}){return this.style.setPaintProperty(L,o,x,A),this._update(!0)}getPaintProperty(L,o){return this.style.getPaintProperty(L,o)}setLayoutProperty(L,o,x,A={}){return this.style.setLayoutProperty(L,o,x,A),this._update(!0)}getLayoutProperty(L,o){return this.style.getLayoutProperty(L,o)}setGlyphs(L,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(L,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(L,o,x={}){return this._lazyInitEmptyStyle(),this.style.addSprite(L,o,x,(A=>{A||this._update(!0)})),this}removeSprite(L){return this._lazyInitEmptyStyle(),this.style.removeSprite(L),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(L,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(L,o,(x=>{x||this._update(!0)})),this}setLight(L,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(L,o),this._update(!0)}getLight(){return this.style.getLight()}setSky(L){return this._lazyInitEmptyStyle(),this.style.setSky(L),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(L,o){return this.style.setFeatureState(L,o),this._update()}removeFeatureState(L,o){return this.style.removeFeatureState(L,o),this._update()}getFeatureState(L){return this.style.getFeatureState(L)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let L=0,o=0;return this._container&&(L=this._container.clientWidth||400,o=this._container.clientHeight||300),[L,o]}_setupContainer(){const L=this._container;L.classList.add("maplibregl-map");const o=this._canvasContainer=bt.create("div","maplibregl-canvas-container",L);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=bt.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const x=this._containerDimensions(),A=this._getClampedPixelRatio(x[0],x[1]);this._resizeCanvas(x[0],x[1],A);const I=this._controlContainer=bt.create("div","maplibregl-control-container",L),P=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((H=>{P[H]=bt.create("div",`maplibregl-ctrl-${H} `,I)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(L,o,x){this._canvas.width=Math.floor(x*L),this._canvas.height=Math.floor(x*o),this._canvas.style.width=`${L}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const L={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",(A=>{o={requestedAttributes:L},A&&(o.statusMessage=A.statusMessage,o.type=A.type)}),{once:!0});const x=this._canvas.getContext("webgl2",L)||this._canvas.getContext("webgl",L);if(!x){const A="Failed to initialize WebGL";throw o?(o.message=A,new Error(JSON.stringify(o))):new Error(A)}this.painter=new Lc(x,this.transform),rn.testSupport(x)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(L){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||L,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(L){return this._update(),this._renderTaskQueue.add(L)}_cancelRenderFrame(L){this._renderTaskQueue.remove(L)}_render(L){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(L),this._removed)return;let x=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const I=this.transform.zoom,P=ut.now();this.style.zoomHistory.update(I,P);const H=new n.z(I,{now:P,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=H.crossFadingFactor();K===1&&K===this._crossFadingFactor||(x=!0,this._crossFadingFactor=K),this.style.update(H)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new n.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,n.bf.mark(n.bg.load),this.fire(new n.k("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const A=this._sourcesDirty||this._styleDirty||this._placementDirty;return A||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new n.k("idle")),!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,n.bf.mark(n.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var L;this._hash&&this._hash.remove();for(const x of this._controls)x.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Ji.removeThrottleControl(this._imageQueueHandle),(L=this._resizeObserver)===null||L===void 0||L.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o?.loseContext&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),bt.remove(this._canvasContainer),bt.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),n.bf.clearMetrics(),this._removed=!0,this.fire(new n.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,ut.frameAsync(this._frameRequest).then((L=>{n.bf.frame(L),this._frameRequest=null,this._render(L)})).catch((()=>{})))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(L){this._showTileBoundaries!==L&&(this._showTileBoundaries=L,this._update())}get showPadding(){return!!this._showPadding}set showPadding(L){this._showPadding!==L&&(this._showPadding=L,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(L){this._showCollisionBoxes!==L&&(this._showCollisionBoxes=L,L?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(L){this._showOverdrawInspector!==L&&(this._showOverdrawInspector=L,this._update())}get repaint(){return!!this._repaint}set repaint(L){this._repaint!==L&&(this._repaint=L,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(L){this._vertices=L,this._update()}get version(){return hh}getCameraTargetElevation(){return this.transform.elevation}},le.MapMouseEvent=Gs,le.MapTouchEvent=hc,le.MapWheelEvent=dc,le.Marker=Uh,le.NavigationControl=class{constructor(L){this._updateZoomButtons=()=>{const o=this._map.getZoom(),x=o===this._map.getMaxZoom(),A=o===this._map.getMinZoom();this._zoomInButton.disabled=x,this._zoomOutButton.disabled=A,this._zoomInButton.setAttribute("aria-disabled",x.toString()),this._zoomOutButton.setAttribute("aria-disabled",A.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,x)=>{const A=this._map._getUIString(`NavigationControl.${x}`);o.title=A,o.setAttribute("aria-label",A)},this.options=n.e({},pd,L),this._container=bt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",(o=>o.preventDefault())),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",(o=>this._map.zoomIn({},{originalEvent:o}))),bt.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",(o=>this._map.zoomOut({},{originalEvent:o}))),bt.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",(o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})})),this._compassIcon=bt.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(L){return this._map=L,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new tf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){bt.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(L,o){const x=bt.create("button",L,this._container);return x.type="button",x.addEventListener("click",o),x}},le.Popup=class extends n.E{constructor(L){super(),this.remove=()=>(this._content&&bt.remove(this._content),this._container&&(bt.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new n.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var x;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=bt.create("div","maplibregl-popup",this._map.getContainer()),this._tip=bt.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const K of this.options.className.split(" "))this._container.classList.add(K);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ka(this._lngLat,this._flatPos,this._map.transform):(x=this._lngLat)===null||x===void 0?void 0:x.wrap(),this._trackPointer&&!o)return;const A=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let I=this.options.anchor;const P=ju(this.options.offset);if(!I){const K=this._container.offsetWidth,ne=this._container.offsetHeight;let he;he=A.y+P.bottom.y<ne?["top"]:A.y>this._map.transform.height-ne?["bottom"]:[],A.x<K/2?he.push("left"):A.x>this._map.transform.width-K/2&&he.push("right"),I=he.length===0?"bottom":he.join("-")}let H=A.add(P[I]);this.options.subpixelPositioning||(H=H.round()),bt.setTransform(this._container,`${xu[I]} translate(${H.x}px,${H.y}px)`),md(this._container,I,"popup")},this._onClose=()=>{this.remove()},this.options=n.e(Object.create(Pr),L)}addTo(L){return this._map&&this.remove(),this._map=L,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new n.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(L){return this._lngLat=n.N.convert(L),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(L){return this.setDOMContent(document.createTextNode(L))}setHTML(L){const o=document.createDocumentFragment(),x=document.createElement("body");let A;for(x.innerHTML=L;A=x.firstChild,A;)o.appendChild(A);return this.setDOMContent(o)}getMaxWidth(){var L;return(L=this._container)===null||L===void 0?void 0:L.style.maxWidth}setMaxWidth(L){return this.options.maxWidth=L,this._update(),this}setDOMContent(L){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=bt.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(L),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(L){return this._container&&this._container.classList.add(L),this}removeClassName(L){return this._container&&this._container.classList.remove(L),this}setOffset(L){return this.options.offset=L,this._update(),this}toggleClassName(L){if(this._container)return this._container.classList.toggle(L)}setSubpixelPositioning(L){this.options.subpixelPositioning=L}_createCloseButton(){this.options.closeButton&&(this._closeButton=bt.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const L=this._container.querySelector(vu);L&&L.focus()}},le.RasterDEMTileSource=ma,le.RasterTileSource=Dr,le.ScaleControl=class{constructor(L){this._onMove=()=>{Kc(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Kc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},pc),L)}getDefaultPosition(){return"bottom-left"}onAdd(L){return this._map=L,this._container=bt.create("div","maplibregl-ctrl maplibregl-ctrl-scale",L.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){bt.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},le.ScrollZoomHandler=sl,le.Style=nh,le.TerrainControl=class{constructor(L){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=L}onAdd(L){return this._map=L,this._container=bt.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=bt.create("button","maplibregl-ctrl-terrain",this._container),bt.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){bt.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},le.TwoFingersTouchPitchHandler=dd,le.TwoFingersTouchRotateHandler=Or,le.TwoFingersTouchZoomHandler=Kd,le.TwoFingersTouchZoomRotateHandler=Nh,le.VectorTileSource=zr,le.VideoSource=la,le.addSourceType=(L,o)=>n._(void 0,void 0,void 0,(function*(){if(Us(L))throw new Error(`A source type called "${L}" already exists.`);((x,A)=>{qs[x]=A})(L,o)})),le.clearPrewarmedResources=function(){const L=Mr;L&&(L.isPreloaded()&&L.numActive()===1?(L.release(ln),Mr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},le.getMaxParallelImageRequests=function(){return n.a.MAX_PARALLEL_IMAGE_REQUESTS},le.getRTLTextPluginStatus=function(){return Do().getRTLTextPluginStatus()},le.getVersion=function(){return _d},le.getWorkerCount=function(){return Jn.workerCount},le.getWorkerUrl=function(){return n.a.WORKER_URL},le.importScriptInWorkers=function(L){return Ir().broadcast("IS",L)},le.prewarm=function(){Cn().acquire(ln)},le.setMaxParallelImageRequests=function(L){n.a.MAX_PARALLEL_IMAGE_REQUESTS=L},le.setRTLTextPlugin=function(L,o){return Do().setRTLTextPlugin(L,o)},le.setWorkerCount=function(L){Jn.workerCount=L},le.setWorkerUrl=function(L){n.a.WORKER_URL=L}}));var Pe=me;return Pe}))})(qy)),qy.exports}var hw=OA();const dw=Kg(hw),BA=D1({__proto__:null,default:dw},[hw]),fw="/p87/assets/btv2busicon-BuI07VNn.svg",FA={A2:"#FF5810",A1:"#FF5810",A:"#FF5810",B:"#9ACE00",C:"#FF5810",D1:"#FF5810",D:"#FF5810",D2:"#FF5810",E:"#FFD133",F:"#7860FF",G:"#33FFF3",H:"#FF8F33",J:"#337BFF",L:"#33FF8A",O:"#FF5810",P:"#33C1A8",R:"#FF5810",S:"#6F61FF",W:"#61C1FF",28:"#FF5810",38:"#FF5810",55:"#61FFA8",60:"#FF5733",61:"#33C1FF",62:"#33FF57",63:"#FF33A8",64:"#FFD133",65:"#8D33FF",75:"#33FFF3",80:"#FF8F33",84:"#337BFF"};function NA({stopId:J}){const ue=cw();return Ft.useEffect(()=>{const me=ue.current?.getMap();!me||me.hasImage("bus-icon")||me.loadImage(fw,(ce,Me)=>{if(ce){console.error("Failed to load bus icon:",ce);return}me.hasImage("bus-icon")||me.addImage("bus-icon",Me,{pixelRatio:2})})},[ue]),Ft.useEffect(()=>{const me=ue.current?.getMap();if(!me)return;const ce="buses-source",Me="routes-source",Pe="buses-layer",le="routes-layer",n=async()=>{try{const ut=(await(await fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/predictions/${J}`)).json()).results||[],bt={};for(const Ci of ut){if(!Ci.route||!Ci.polyline||Ci.polyline.length<2)continue;const Ji=Ci.eta_minutes??1/0;(!bt[Ci.route]||Ji<bt[Ci.route].eta_minutes)&&(bt[Ci.route]=Ci)}const rn=ut.filter(Ci=>Ci.vehicle_lat&&Ci.vehicle_lon).map(Ci=>({type:"Feature",geometry:{type:"Point",coordinates:[Ci.vehicle_lon,Ci.vehicle_lat]},properties:{route:Ci.route,destination:Ci.destination,stopsAway:Ci.stops_away,occupancy:Ci.occupancy||"Unknown"}})),on=Object.values(bt),Vi=on.map((Ci,Ji)=>{const Vn=Ci.polyline.map(Ot=>[Ot.lon,Ot.lat]),Oi=on.length,qi=(Ji-(Oi-1)/2)*6;return{type:"Feature",geometry:{type:"LineString",coordinates:Vn},properties:{route:Ci.route,color:FA[Ci.route]||"#FFD60A",offset:qi}}}),Wi={type:"FeatureCollection",features:rn},Tn={type:"FeatureCollection",features:Vi};me.getSource(ce)?(me.getSource(ce).setData(Wi),me.getSource(Me).setData(Tn)):(me.addSource(ce,{type:"geojson",data:Wi}),me.addSource(Me,{type:"geojson",data:Tn}),me.addLayer({id:le,type:"line",source:Me,layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get","color"],"line-width":["interpolate",["exponential",1.5],["zoom"],13,2,15,5,17,8,18,10],"line-opacity":.9}}),me.addLayer({id:Pe,type:"symbol",source:ce,layout:{"icon-image":"bus-icon","icon-size":.6,"icon-allow-overlap":!0}}),me.on("click",Pe,Ci=>{const Ji=Ci.features?.[0];if(!Ji)return;const{route:Vn,destination:Oi,stopsAway:Hn,occupancy:qi}=Ji.properties;new dw.Popup().setLngLat(Ji.geometry.coordinates).setHTML(`<b>Route ${Vn}</b><br/>${Oi}<br/>Stops away: ${Hn}<br/>Occupancy: ${qi}`).addTo(me)}),me.on("mouseenter",Pe,()=>{me.getCanvas().style.cursor="pointer"}),me.on("mouseleave",Pe,()=>{me.getCanvas().style.cursor=""}))}catch(ke){console.error("Failed to fetch bus data:",ke)}};n();const tt=setInterval(n,2e4);return()=>{clearInterval(tt),me.getLayer(le)&&me.removeLayer(le),me.getLayer(Pe)&&me.removeLayer(Pe),me.getSource(ce)&&me.removeSource(ce),me.getSource(Me)&&me.removeSource(Me)}},[ue,J]),null}const VA="/p87/assets/btv2longbusicon-EoiJrL0g.svg";function UA({routeData:J}){const{current:ue}=cw();Ft.useEffect(()=>{if(!ue)return;const Pe=(le,n)=>{if(ue.hasImage(le))return;const tt=new Image;tt.crossOrigin="anonymous",tt.onload=()=>{if(!ue.hasImage(le)){const ke=window.devicePixelRatio||2;ue.addImage(le,tt,{pixelRatio:ke})}},tt.src=n};Pe("btv2-bus-icon",fw),Pe("btv2-long-bus-icon",VA)},[ue]);const me=(J.route_polylines||[]).map((Pe,le)=>({type:"Feature",geometry:{type:"LineString",coordinates:(Pe.polyline||[]).map(n=>[n.lon,n.lat])},properties:{id:`${J.route}-${Pe.direction}-${le}`,direction:Pe.direction}}))||[],ce=(J.vehicles||[]).map((Pe,le)=>{const n=Pe.vehicle_id!=null?String(Pe.vehicle_id):String(le),tt=n.length===4?"btv2-long-bus-icon":"btv2-bus-icon";return{type:"Feature",geometry:{type:"Point",coordinates:[Number(Pe.lon),Number(Pe.lat)]},properties:{id:n,destination:Pe.destination,occupancy:Pe.occupancy,bearing:Pe.bearing!=null?Number(Pe.bearing):0,icon:tt}}})||[],Me=J.route||"route";return Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(T1,{id:`route-lines-${Me}`,type:"geojson",data:{type:"FeatureCollection",features:me},children:Ae.jsx(w1,{id:`route-line-layer-${Me}`,type:"line",paint:{"line-color":"#111111","line-width":3}})}),Ae.jsx(T1,{id:`route-vehicles-${Me}`,type:"geojson",data:{type:"FeatureCollection",features:ce},children:Ae.jsx(w1,{id:`route-vehicle-layer-${Me}`,type:"symbol",layout:{"icon-image":["coalesce",["get","icon"],"btv2-bus-icon"],"icon-size":["interpolate",["linear"],["zoom"],8,.025,12,.025,16,.1],"icon-rotate":["-",["coalesce",["get","bearing"],0],["case",["==",["get","icon"],"btv2-long-bus-icon"],-90,90]],"icon-rotation-alignment":"map","icon-anchor":"center","icon-allow-overlap":!0,"icon-ignore-placement":!0}})})]})}var Hy={exports:{}};var jA=Hy.exports,E1;function GA(){return E1||(E1=1,(function(J,ue){((me,ce)=>{J.exports=ce()})(jA,function me(){var ce=typeof self<"u"?self:typeof window<"u"?window:ce!==void 0?ce:{},Me,Pe=!ce.document&&!!ce.postMessage,le=ce.IS_PAPA_WORKER||!1,n={},tt=0,ke={};function Rt(Ot){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(Vt){var Hi=Oi(Vt);Hi.chunkSize=parseInt(Hi.chunkSize),Vt.step||Vt.chunk||(Hi.chunkSize=null),this._handle=new Vi(Hi),(this._handle.streamer=this)._config=Hi}).call(this,Ot),this.parseChunk=function(Vt,Hi){var dn=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<dn){let an=this._config.newline;an||(Ui=this._config.quoteChar||'"',an=this._handle.guessLineEndings(Vt,Ui)),Vt=[...Vt.split(an).slice(dn)].join(an)}this.isFirstChunk&&qi(this._config.beforeFirstChunk)&&(Ui=this._config.beforeFirstChunk(Vt))!==void 0&&(Vt=Ui),this.isFirstChunk=!1,this._halted=!1;var dn=this._partialLine+Vt,Ui=(this._partialLine="",this._handle.parse(dn,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(Vt=Ui.meta.cursor,dn=(this._finished||(this._partialLine=dn.substring(Vt-this._baseIndex),this._baseIndex=Vt),Ui&&Ui.data&&(this._rowCount+=Ui.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),le)ce.postMessage({results:Ui,workerId:ke.WORKER_ID,finished:dn});else if(qi(this._config.chunk)&&!Hi){if(this._config.chunk(Ui,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=Ui=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(Ui.data),this._completeResults.errors=this._completeResults.errors.concat(Ui.errors),this._completeResults.meta=Ui.meta),this._completed||!dn||!qi(this._config.complete)||Ui&&Ui.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),dn||Ui&&Ui.meta.paused||this._nextChunk(),Ui}this._halted=!0},this._sendError=function(Vt){qi(this._config.error)?this._config.error(Vt):le&&this._config.error&&ce.postMessage({workerId:ke.WORKER_ID,error:Vt,finished:!1})}}function ut(Ot){var Vt;(Ot=Ot||{}).chunkSize||(Ot.chunkSize=ke.RemoteChunkSize),Rt.call(this,Ot),this._nextChunk=Pe?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(Hi){this._input=Hi,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(Vt=new XMLHttpRequest,this._config.withCredentials&&(Vt.withCredentials=this._config.withCredentials),Pe||(Vt.onload=Hn(this._chunkLoaded,this),Vt.onerror=Hn(this._chunkError,this)),Vt.open(this._config.downloadRequestBody?"POST":"GET",this._input,!Pe),this._config.downloadRequestHeaders){var Hi,dn=this._config.downloadRequestHeaders;for(Hi in dn)Vt.setRequestHeader(Hi,dn[Hi])}var Ui;this._config.chunkSize&&(Ui=this._start+this._config.chunkSize-1,Vt.setRequestHeader("Range","bytes="+this._start+"-"+Ui));try{Vt.send(this._config.downloadRequestBody)}catch(an){this._chunkError(an.message)}Pe&&Vt.status===0&&this._chunkError()}},this._chunkLoaded=function(){Vt.readyState===4&&(Vt.status<200||400<=Vt.status?this._chunkError():(this._start+=this._config.chunkSize||Vt.responseText.length,this._finished=!this._config.chunkSize||this._start>=(Hi=>(Hi=Hi.getResponseHeader("Content-Range"))!==null?parseInt(Hi.substring(Hi.lastIndexOf("/")+1)):-1)(Vt),this.parseChunk(Vt.responseText)))},this._chunkError=function(Hi){Hi=Vt.statusText||Hi,this._sendError(new Error(Hi))}}function bt(Ot){(Ot=Ot||{}).chunkSize||(Ot.chunkSize=ke.LocalChunkSize),Rt.call(this,Ot);var Vt,Hi,dn=typeof FileReader<"u";this.stream=function(Ui){this._input=Ui,Hi=Ui.slice||Ui.webkitSlice||Ui.mozSlice,dn?((Vt=new FileReader).onload=Hn(this._chunkLoaded,this),Vt.onerror=Hn(this._chunkError,this)):Vt=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var Ui=this._input,an=(this._config.chunkSize&&(an=Math.min(this._start+this._config.chunkSize,this._input.size),Ui=Hi.call(Ui,this._start,an)),Vt.readAsText(Ui,this._config.encoding));dn||this._chunkLoaded({target:{result:an}})},this._chunkLoaded=function(Ui){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(Ui.target.result)},this._chunkError=function(){this._sendError(Vt.error)}}function rn(Ot){var Vt;Rt.call(this,Ot=Ot||{}),this.stream=function(Hi){return Vt=Hi,this._nextChunk()},this._nextChunk=function(){var Hi,dn;if(!this._finished)return Hi=this._config.chunkSize,Vt=Hi?(dn=Vt.substring(0,Hi),Vt.substring(Hi)):(dn=Vt,""),this._finished=!Vt,this.parseChunk(dn)}}function on(Ot){Rt.call(this,Ot=Ot||{});var Vt=[],Hi=!0,dn=!1;this.pause=function(){Rt.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){Rt.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(Ui){this._input=Ui,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){dn&&Vt.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),Vt.length?this.parseChunk(Vt.shift()):Hi=!0},this._streamData=Hn(function(Ui){try{Vt.push(typeof Ui=="string"?Ui:Ui.toString(this._config.encoding)),Hi&&(Hi=!1,this._checkIsFinished(),this.parseChunk(Vt.shift()))}catch(an){this._streamError(an)}},this),this._streamError=Hn(function(Ui){this._streamCleanUp(),this._sendError(Ui)},this),this._streamEnd=Hn(function(){this._streamCleanUp(),dn=!0,this._streamData("")},this),this._streamCleanUp=Hn(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function Vi(Ot){var Vt,Hi,dn,Ui,an=Math.pow(2,53),Hr=-an,Qr=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ui=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,Si=this,yn=0,Rn=0,wr=!1,Tt=!1,jt=[],ai={data:[],errors:[],meta:{}};function ln(pr){return Ot.skipEmptyLines==="greedy"?pr.join("").trim()==="":pr.length===1&&pr[0].length===0}function Jn(){if(ai&&dn&&(Mr("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+ke.DefaultDelimiter+"'"),dn=!1),Ot.skipEmptyLines&&(ai.data=ai.data.filter(function(Fa){return!ln(Fa)})),_r()){let Fa=function(ra,Aa){qi(Ot.transformHeader)&&(ra=Ot.transformHeader(ra,Aa)),jt.push(ra)};var Ir=Fa;if(ai)if(Array.isArray(ai.data[0])){for(var pr=0;_r()&&pr<ai.data.length;pr++)ai.data[pr].forEach(Fa);ai.data.splice(0,1)}else ai.data.forEach(Fa)}function Cn(Fa,ra){for(var Aa=Ot.header?{}:[],Da=0;Da<Fa.length;Da++){var Yt=Da,Ha=Fa[Da],Ha=((zr,Dr)=>(ma=>(Ot.dynamicTypingFunction&&Ot.dynamicTyping[ma]===void 0&&(Ot.dynamicTyping[ma]=Ot.dynamicTypingFunction(ma)),(Ot.dynamicTyping[ma]||Ot.dynamicTyping)===!0))(zr)?Dr==="true"||Dr==="TRUE"||Dr!=="false"&&Dr!=="FALSE"&&((ma=>{if(Qr.test(ma)&&(ma=parseFloat(ma),Hr<ma&&ma<an))return 1})(Dr)?parseFloat(Dr):ui.test(Dr)?new Date(Dr):Dr===""?null:Dr):Dr)(Yt=Ot.header?Da>=jt.length?"__parsed_extra":jt[Da]:Yt,Ha=Ot.transform?Ot.transform(Ha,Yt):Ha);Yt==="__parsed_extra"?(Aa[Yt]=Aa[Yt]||[],Aa[Yt].push(Ha)):Aa[Yt]=Ha}return Ot.header&&(Da>jt.length?Mr("FieldMismatch","TooManyFields","Too many fields: expected "+jt.length+" fields but parsed "+Da,Rn+ra):Da<jt.length&&Mr("FieldMismatch","TooFewFields","Too few fields: expected "+jt.length+" fields but parsed "+Da,Rn+ra)),Aa}var Cr;ai&&(Ot.header||Ot.dynamicTyping||Ot.transform)&&(Cr=1,!ai.data.length||Array.isArray(ai.data[0])?(ai.data=ai.data.map(Cn),Cr=ai.data.length):ai.data=Cn(ai.data,0),Ot.header&&ai.meta&&(ai.meta.fields=jt),Rn+=Cr)}function _r(){return Ot.header&&jt.length===0}function Mr(pr,Cn,Cr,Ir){pr={type:pr,code:Cn,message:Cr},Ir!==void 0&&(pr.row=Ir),ai.errors.push(pr)}qi(Ot.step)&&(Ui=Ot.step,Ot.step=function(pr){ai=pr,_r()?Jn():(Jn(),ai.data.length!==0&&(yn+=pr.data.length,Ot.preview&&yn>Ot.preview?Hi.abort():(ai.data=ai.data[0],Ui(ai,Si))))}),this.parse=function(pr,Cn,Cr){var Ir=Ot.quoteChar||'"',Ir=(Ot.newline||(Ot.newline=this.guessLineEndings(pr,Ir)),dn=!1,Ot.delimiter?qi(Ot.delimiter)&&(Ot.delimiter=Ot.delimiter(pr),ai.meta.delimiter=Ot.delimiter):((Ir=((Fa,ra,Aa,Da,Yt)=>{var Ha,zr,Dr,ma;Yt=Yt||[",","	","|",";",ke.RECORD_SEP,ke.UNIT_SEP];for(var rl=0;rl<Yt.length;rl++){for(var ho,Vo=Yt[rl],la=0,Vs=0,qs=0,Us=(Dr=void 0,new Tn({comments:Da,delimiter:Vo,newline:ra,preview:10}).parse(Fa)),cn=0;cn<Us.data.length;cn++)Aa&&ln(Us.data[cn])?qs++:(ho=Us.data[cn].length,Vs+=ho,Dr===void 0?Dr=ho:0<ho&&(la+=Math.abs(ho-Dr),Dr=ho));0<Us.data.length&&(Vs/=Us.data.length-qs),(zr===void 0||la<=zr)&&(ma===void 0||ma<Vs)&&1.99<Vs&&(zr=la,Ha=Vo,ma=Vs)}return{successful:!!(Ot.delimiter=Ha),bestDelimiter:Ha}})(pr,Ot.newline,Ot.skipEmptyLines,Ot.comments,Ot.delimitersToGuess)).successful?Ot.delimiter=Ir.bestDelimiter:(dn=!0,Ot.delimiter=ke.DefaultDelimiter),ai.meta.delimiter=Ot.delimiter),Oi(Ot));return Ot.preview&&Ot.header&&Ir.preview++,Vt=pr,Hi=new Tn(Ir),ai=Hi.parse(Vt,Cn,Cr),Jn(),wr?{meta:{paused:!0}}:ai||{meta:{paused:!1}}},this.paused=function(){return wr},this.pause=function(){wr=!0,Hi.abort(),Vt=qi(Ot.chunk)?"":Vt.substring(Hi.getCharIndex())},this.resume=function(){Si.streamer._halted?(wr=!1,Si.streamer.parseChunk(Vt,!0)):setTimeout(Si.resume,3)},this.aborted=function(){return Tt},this.abort=function(){Tt=!0,Hi.abort(),ai.meta.aborted=!0,qi(Ot.complete)&&Ot.complete(ai),Vt=""},this.guessLineEndings=function(Fa,Ir){Fa=Fa.substring(0,1048576);var Ir=new RegExp(Wi(Ir)+"([^]*?)"+Wi(Ir),"gm"),Cr=(Fa=Fa.replace(Ir,"")).split("\r"),Ir=Fa.split(`
`),Fa=1<Ir.length&&Ir[0].length<Cr[0].length;if(Cr.length===1||Fa)return`
`;for(var ra=0,Aa=0;Aa<Cr.length;Aa++)Cr[Aa][0]===`
`&&ra++;return ra>=Cr.length/2?`\r
`:"\r"}}function Wi(Ot){return Ot.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Tn(Ot){var Vt=(Ot=Ot||{}).delimiter,Hi=Ot.newline,dn=Ot.comments,Ui=Ot.step,an=Ot.preview,Hr=Ot.fastMode,Qr=null,ui=!1,Si=Ot.quoteChar==null?'"':Ot.quoteChar,yn=Si;if(Ot.escapeChar!==void 0&&(yn=Ot.escapeChar),(typeof Vt!="string"||-1<ke.BAD_DELIMITERS.indexOf(Vt))&&(Vt=","),dn===Vt)throw new Error("Comment character same as delimiter");dn===!0?dn="#":(typeof dn!="string"||-1<ke.BAD_DELIMITERS.indexOf(dn))&&(dn=!1),Hi!==`
`&&Hi!=="\r"&&Hi!==`\r
`&&(Hi=`
`);var Rn=0,wr=!1;this.parse=function(Tt,jt,ai){if(typeof Tt!="string")throw new Error("Input must be a string");var ln=Tt.length,Jn=Vt.length,_r=Hi.length,Mr=dn.length,pr=qi(Ui),Cn=[],Cr=[],Ir=[],Fa=Rn=0;if(!Tt)return la();if(Hr||Hr!==!1&&Tt.indexOf(Si)===-1){for(var ra=Tt.split(Hi),Aa=0;Aa<ra.length;Aa++){if(Ir=ra[Aa],Rn+=Ir.length,Aa!==ra.length-1)Rn+=Hi.length;else if(ai)return la();if(!dn||Ir.substring(0,Mr)!==dn){if(pr){if(Cn=[],ma(Ir.split(Vt)),Vs(),wr)return la()}else ma(Ir.split(Vt));if(an&&an<=Aa)return Cn=Cn.slice(0,an),la(!0)}}return la()}for(var Da=Tt.indexOf(Vt,Rn),Yt=Tt.indexOf(Hi,Rn),Ha=new RegExp(Wi(yn)+Wi(Si),"g"),zr=Tt.indexOf(Si,Rn);;)if(Tt[Rn]===Si)for(zr=Rn,Rn++;;){if((zr=Tt.indexOf(Si,zr+1))===-1)return ai||Cr.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:Cn.length,index:Rn}),ho();if(zr===ln-1)return ho(Tt.substring(Rn,zr).replace(Ha,Si));if(Si===yn&&Tt[zr+1]===yn)zr++;else if(Si===yn||zr===0||Tt[zr-1]!==yn){Da!==-1&&Da<zr+1&&(Da=Tt.indexOf(Vt,zr+1));var Dr=rl((Yt=Yt!==-1&&Yt<zr+1?Tt.indexOf(Hi,zr+1):Yt)===-1?Da:Math.min(Da,Yt));if(Tt.substr(zr+1+Dr,Jn)===Vt){Ir.push(Tt.substring(Rn,zr).replace(Ha,Si)),Tt[Rn=zr+1+Dr+Jn]!==Si&&(zr=Tt.indexOf(Si,Rn)),Da=Tt.indexOf(Vt,Rn),Yt=Tt.indexOf(Hi,Rn);break}if(Dr=rl(Yt),Tt.substring(zr+1+Dr,zr+1+Dr+_r)===Hi){if(Ir.push(Tt.substring(Rn,zr).replace(Ha,Si)),Vo(zr+1+Dr+_r),Da=Tt.indexOf(Vt,Rn),zr=Tt.indexOf(Si,Rn),pr&&(Vs(),wr))return la();if(an&&Cn.length>=an)return la(!0);break}Cr.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:Cn.length,index:Rn}),zr++}}else if(dn&&Ir.length===0&&Tt.substring(Rn,Rn+Mr)===dn){if(Yt===-1)return la();Rn=Yt+_r,Yt=Tt.indexOf(Hi,Rn),Da=Tt.indexOf(Vt,Rn)}else if(Da!==-1&&(Da<Yt||Yt===-1))Ir.push(Tt.substring(Rn,Da)),Rn=Da+Jn,Da=Tt.indexOf(Vt,Rn);else{if(Yt===-1)break;if(Ir.push(Tt.substring(Rn,Yt)),Vo(Yt+_r),pr&&(Vs(),wr))return la();if(an&&Cn.length>=an)return la(!0)}return ho();function ma(qs){Cn.push(qs),Fa=Rn}function rl(qs){var Us=0;return Us=qs!==-1&&(qs=Tt.substring(zr+1,qs))&&qs.trim()===""?qs.length:Us}function ho(qs){return ai||(qs===void 0&&(qs=Tt.substring(Rn)),Ir.push(qs),Rn=ln,ma(Ir),pr&&Vs()),la()}function Vo(qs){Rn=qs,ma(Ir),Ir=[],Yt=Tt.indexOf(Hi,Rn)}function la(qs){if(Ot.header&&!jt&&Cn.length&&!ui){var Us=Cn[0],cn=Object.create(null),Ws=new Set(Us);let To=!1;for(let Do=0;Do<Us.length;Do++){let So=Us[Do];if(cn[So=qi(Ot.transformHeader)?Ot.transformHeader(So,Do):So]){let Sn,tr=cn[So];for(;Sn=So+"_"+tr,tr++,Ws.has(Sn););Ws.add(Sn),Us[Do]=Sn,cn[So]++,To=!0,(Qr=Qr===null?{}:Qr)[Sn]=So}else cn[So]=1,Us[Do]=So;Ws.add(So)}To&&console.warn("Duplicate headers found and renamed."),ui=!0}return{data:Cn,errors:Cr,meta:{delimiter:Vt,linebreak:Hi,aborted:wr,truncated:!!qs,cursor:Fa+(jt||0),renamedHeaders:Qr}}}function Vs(){Ui(la()),Cn=[],Cr=[]}},this.abort=function(){wr=!0},this.getCharIndex=function(){return Rn}}function Ci(Ot){var Vt=Ot.data,Hi=n[Vt.workerId],dn=!1;if(Vt.error)Hi.userError(Vt.error,Vt.file);else if(Vt.results&&Vt.results.data){var Ui={abort:function(){dn=!0,Ji(Vt.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:Vn,resume:Vn};if(qi(Hi.userStep)){for(var an=0;an<Vt.results.data.length&&(Hi.userStep({data:Vt.results.data[an],errors:Vt.results.errors,meta:Vt.results.meta},Ui),!dn);an++);delete Vt.results}else qi(Hi.userChunk)&&(Hi.userChunk(Vt.results,Ui,Vt.file),delete Vt.results)}Vt.finished&&!dn&&Ji(Vt.workerId,Vt.results)}function Ji(Ot,Vt){var Hi=n[Ot];qi(Hi.userComplete)&&Hi.userComplete(Vt),Hi.terminate(),delete n[Ot]}function Vn(){throw new Error("Not implemented.")}function Oi(Ot){if(typeof Ot!="object"||Ot===null)return Ot;var Vt,Hi=Array.isArray(Ot)?[]:{};for(Vt in Ot)Hi[Vt]=Oi(Ot[Vt]);return Hi}function Hn(Ot,Vt){return function(){Ot.apply(Vt,arguments)}}function qi(Ot){return typeof Ot=="function"}return ke.parse=function(Ot,Vt){var Hi=(Vt=Vt||{}).dynamicTyping||!1;if(qi(Hi)&&(Vt.dynamicTypingFunction=Hi,Hi={}),Vt.dynamicTyping=Hi,Vt.transform=!!qi(Vt.transform)&&Vt.transform,!Vt.worker||!ke.WORKERS_SUPPORTED)return Hi=null,ke.NODE_STREAM_INPUT,typeof Ot=="string"?(Ot=(dn=>dn.charCodeAt(0)!==65279?dn:dn.slice(1))(Ot),Hi=new(Vt.download?ut:rn)(Vt)):Ot.readable===!0&&qi(Ot.read)&&qi(Ot.on)?Hi=new on(Vt):(ce.File&&Ot instanceof File||Ot instanceof Object)&&(Hi=new bt(Vt)),Hi.stream(Ot);(Hi=(()=>{var dn;return!!ke.WORKERS_SUPPORTED&&(dn=(()=>{var Ui=ce.URL||ce.webkitURL||null,an=me.toString();return ke.BLOB_URL||(ke.BLOB_URL=Ui.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",an,")();"],{type:"text/javascript"})))})(),(dn=new ce.Worker(dn)).onmessage=Ci,dn.id=tt++,n[dn.id]=dn)})()).userStep=Vt.step,Hi.userChunk=Vt.chunk,Hi.userComplete=Vt.complete,Hi.userError=Vt.error,Vt.step=qi(Vt.step),Vt.chunk=qi(Vt.chunk),Vt.complete=qi(Vt.complete),Vt.error=qi(Vt.error),delete Vt.worker,Hi.postMessage({input:Ot,config:Vt,workerId:Hi.id})},ke.unparse=function(Ot,Vt){var Hi=!1,dn=!0,Ui=",",an=`\r
`,Hr='"',Qr=Hr+Hr,ui=!1,Si=null,yn=!1,Rn=((()=>{if(typeof Vt=="object"){if(typeof Vt.delimiter!="string"||ke.BAD_DELIMITERS.filter(function(jt){return Vt.delimiter.indexOf(jt)!==-1}).length||(Ui=Vt.delimiter),typeof Vt.quotes!="boolean"&&typeof Vt.quotes!="function"&&!Array.isArray(Vt.quotes)||(Hi=Vt.quotes),typeof Vt.skipEmptyLines!="boolean"&&typeof Vt.skipEmptyLines!="string"||(ui=Vt.skipEmptyLines),typeof Vt.newline=="string"&&(an=Vt.newline),typeof Vt.quoteChar=="string"&&(Hr=Vt.quoteChar),typeof Vt.header=="boolean"&&(dn=Vt.header),Array.isArray(Vt.columns)){if(Vt.columns.length===0)throw new Error("Option columns is empty");Si=Vt.columns}Vt.escapeChar!==void 0&&(Qr=Vt.escapeChar+Hr),Vt.escapeFormulae instanceof RegExp?yn=Vt.escapeFormulae:typeof Vt.escapeFormulae=="boolean"&&Vt.escapeFormulae&&(yn=/^[=+\-@\t\r].*$/)}})(),new RegExp(Wi(Hr),"g"));if(typeof Ot=="string"&&(Ot=JSON.parse(Ot)),Array.isArray(Ot)){if(!Ot.length||Array.isArray(Ot[0]))return wr(null,Ot,ui);if(typeof Ot[0]=="object")return wr(Si||Object.keys(Ot[0]),Ot,ui)}else if(typeof Ot=="object")return typeof Ot.data=="string"&&(Ot.data=JSON.parse(Ot.data)),Array.isArray(Ot.data)&&(Ot.fields||(Ot.fields=Ot.meta&&Ot.meta.fields||Si),Ot.fields||(Ot.fields=Array.isArray(Ot.data[0])?Ot.fields:typeof Ot.data[0]=="object"?Object.keys(Ot.data[0]):[]),Array.isArray(Ot.data[0])||typeof Ot.data[0]=="object"||(Ot.data=[Ot.data])),wr(Ot.fields||[],Ot.data||[],ui);throw new Error("Unable to serialize unrecognized input");function wr(jt,ai,ln){var Jn="",_r=(typeof jt=="string"&&(jt=JSON.parse(jt)),typeof ai=="string"&&(ai=JSON.parse(ai)),Array.isArray(jt)&&0<jt.length),Mr=!Array.isArray(ai[0]);if(_r&&dn){for(var pr=0;pr<jt.length;pr++)0<pr&&(Jn+=Ui),Jn+=Tt(jt[pr],pr);0<ai.length&&(Jn+=an)}for(var Cn=0;Cn<ai.length;Cn++){var Cr=(_r?jt:ai[Cn]).length,Ir=!1,Fa=_r?Object.keys(ai[Cn]).length===0:ai[Cn].length===0;if(ln&&!_r&&(Ir=ln==="greedy"?ai[Cn].join("").trim()==="":ai[Cn].length===1&&ai[Cn][0].length===0),ln==="greedy"&&_r){for(var ra=[],Aa=0;Aa<Cr;Aa++){var Da=Mr?jt[Aa]:Aa;ra.push(ai[Cn][Da])}Ir=ra.join("").trim()===""}if(!Ir){for(var Yt=0;Yt<Cr;Yt++){0<Yt&&!Fa&&(Jn+=Ui);var Ha=_r&&Mr?jt[Yt]:Yt;Jn+=Tt(ai[Cn][Ha],Yt)}Cn<ai.length-1&&(!ln||0<Cr&&!Fa)&&(Jn+=an)}}return Jn}function Tt(jt,ai){var ln,Jn;return jt==null?"":jt.constructor===Date?JSON.stringify(jt).slice(1,25):(Jn=!1,yn&&typeof jt=="string"&&yn.test(jt)&&(jt="'"+jt,Jn=!0),ln=jt.toString().replace(Rn,Qr),(Jn=Jn||Hi===!0||typeof Hi=="function"&&Hi(jt,ai)||Array.isArray(Hi)&&Hi[ai]||((_r,Mr)=>{for(var pr=0;pr<Mr.length;pr++)if(-1<_r.indexOf(Mr[pr]))return!0;return!1})(ln,ke.BAD_DELIMITERS)||-1<ln.indexOf(Ui)||ln.charAt(0)===" "||ln.charAt(ln.length-1)===" ")?Hr+ln+Hr:ln)}},ke.RECORD_SEP="",ke.UNIT_SEP="",ke.BYTE_ORDER_MARK="\uFEFF",ke.BAD_DELIMITERS=["\r",`
`,'"',ke.BYTE_ORDER_MARK],ke.WORKERS_SUPPORTED=!Pe&&!!ce.Worker,ke.NODE_STREAM_INPUT=1,ke.LocalChunkSize=10485760,ke.RemoteChunkSize=5242880,ke.DefaultDelimiter=",",ke.Parser=Tn,ke.ParserHandle=Vi,ke.NetworkStreamer=ut,ke.FileStreamer=bt,ke.StringStreamer=rn,ke.ReadableStreamStreamer=on,ce.jQuery&&((Me=ce.jQuery).fn.parse=function(Ot){var Vt=Ot.config||{},Hi=[];return this.each(function(an){if(!(Me(this).prop("tagName").toUpperCase()==="INPUT"&&Me(this).attr("type").toLowerCase()==="file"&&ce.FileReader)||!this.files||this.files.length===0)return!0;for(var Hr=0;Hr<this.files.length;Hr++)Hi.push({file:this.files[Hr],inputElem:this,instanceConfig:Me.extend({},Vt)})}),dn(),this;function dn(){if(Hi.length===0)qi(Ot.complete)&&Ot.complete();else{var an,Hr,Qr,ui,Si=Hi[0];if(qi(Ot.before)){var yn=Ot.before(Si.file,Si.inputElem);if(typeof yn=="object"){if(yn.action==="abort")return an="AbortError",Hr=Si.file,Qr=Si.inputElem,ui=yn.reason,void(qi(Ot.error)&&Ot.error({name:an},Hr,Qr,ui));if(yn.action==="skip")return void Ui();typeof yn.config=="object"&&(Si.instanceConfig=Me.extend(Si.instanceConfig,yn.config))}else if(yn==="skip")return void Ui()}var Rn=Si.instanceConfig.complete;Si.instanceConfig.complete=function(wr){qi(Rn)&&Rn(wr,Si.file,Si.inputElem),Ui()},ke.parse(Si.file,Si.instanceConfig)}}function Ui(){Hi.splice(0,1),dn()}}),le&&(ce.onmessage=function(Ot){Ot=Ot.data,ke.WORKER_ID===void 0&&Ot&&(ke.WORKER_ID=Ot.workerId),typeof Ot.input=="string"?ce.postMessage({workerId:ke.WORKER_ID,results:ke.parse(Ot.input,Ot.config),finished:!0}):(ce.File&&Ot.input instanceof File||Ot.input instanceof Object)&&(Ot=ke.parse(Ot.input,Ot.config))&&ce.postMessage({workerId:ke.WORKER_ID,results:Ot,finished:!0})}),(ut.prototype=Object.create(Rt.prototype)).constructor=ut,(bt.prototype=Object.create(Rt.prototype)).constructor=bt,(rn.prototype=Object.create(rn.prototype)).constructor=rn,(on.prototype=Object.create(Rt.prototype)).constructor=on,ke})})(Hy)),Hy.exports}var qA=GA();const HA=Kg(qA);async function $A(){const ue=await fetch("/p87/stops.csv");if(!ue.ok)throw new Error(`Failed to load stops.csv: ${ue.status} ${ue.statusText}`);const me=await ue.text();return new Promise(ce=>{HA.parse(me,{header:!0,dynamicTyping:!0,complete:Me=>ce(Me.data)})})}const pw="bt_smart_launch_rules";function pv(){try{const J=localStorage.getItem(pw);if(!J)return[];const ue=JSON.parse(J);return Array.isArray(ue)?ue:[]}catch(J){return console.error("Failed to load SmartLaunch rules",J),[]}}function $y(J){try{localStorage.setItem(pw,JSON.stringify(J))}catch(ue){console.error("Failed to save SmartLaunch rules",ue)}}const ZA={A:"#FF0000",A1:"#FF0000",A2:"#FF0000",B:"#84BC00",F:"#0039AA",80:"#FF7300",81:"#00B7C8",82:"#BC009D",84:"#C1C800"};function XA(J){return ZA[J]||"#000000"}function WA(J){if(!J)return"";const[,ue]=J.split(" ");if(!ue)return"";const[me,ce]=ue.split(":"),Me=new Date;return Me.setHours(Number(me),Number(ce),0,0),Me.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function YA(J){if(J.dyn===4)return"Drop offs only";if(J.stops_away!=null){const ue=J.stops_away;return`${ue} stop${ue===1?"":"s"} away`}if(Array.isArray(J.stops_between)&&J.stops_between.length>0){const ue=J.stops_between.length;return`${ue} stop${ue===1?"":"s"} away`}return J.stops_away===0?"Approaching Stop":J.eta_minutes<=1?"At Stop":J.stops_away===null?"En Route":"Many Stops Away"}function KA(J){return J==="N/A"?5:J==="EMPTY"?1:J==="HALF_EMPTY"?3:J==="FULL"?5:0}function JA({pred:J}){const ue=WA(J.predicted_time),me=YA(J),ce=KA(J.occupancy||"");return Ae.jsxs("article",{className:"bus-card","aria-label":`Route ${J.route} to ${J.destination}, arriving in ${J.eta_minutes} minutes`,children:[Ae.jsx("div",{className:"bus-card-route",style:{backgroundColor:XA(J.route)},"aria-label":`Route ${J.route}`,children:J.route}),Ae.jsxs("div",{className:"bus-card-main",children:[Ae.jsxs("div",{className:"bus-card-left",children:[Ae.jsxs("div",{className:"bus-card-top",children:[Ae.jsx("div",{className:"bus-card-destination",children:J.destination}),Ae.jsx("div",{className:"bus-card-times",children:Ae.jsx("div",{className:"bus-card-eta","aria-label":`Estimated time: ${J.eta_minutes} minutes`,children:J.eta_minutes!=null?`${J.eta_minutes} min`:"--"})})]}),Ae.jsxs("div",{className:"bus-card-bottom",children:[Ae.jsxs("div",{className:"bus-card-occupancy",children:[Ae.jsx("div",{className:"bus-card-dots","aria-label":`Occupancy: ${J.occupancy||"unknown"}`,children:Array.from({length:5}).map((Me,Pe)=>Ae.jsx("span",{className:"occ-dot"+(Pe<ce?" occ-dot-filled":""),"aria-hidden":"true"},Pe))}),Ae.jsxs("span",{className:"bus-card-sub",children:[me,"  Tracking bus #",J.vehicle_id]})]}),Ae.jsx("div",{className:"bus-card-clock",children:ue})]})]}),Ae.jsx("div",{className:"bus-card-right",children:Ae.jsx("div",{className:"bus-card-track bus-card-track--inactive","aria-label":"Currently tracking this bus",children:"Tracking"})})]})]})}function QA(J,ue,me,ce,Me,Pe=64){const le=[],tt=me/111320,ke=me/(111320*Math.cos(J*Math.PI/180));for(let Rt=0;Rt<=Pe;Rt++){const ut=Rt/Pe*2*Math.PI,bt=Math.cos(ut),rn=Math.sin(ut),on=J+rn*tt,Vi=ue+bt*ke;le.push([Vi,on])}return{type:"Feature",geometry:{type:"Polygon",coordinates:[le]},properties:{id:ce,stopId:Me}}}function rv(){const{routeId:J,stopId:ue,vehicleId:me}=j1(),[ce]=Y1(),Me=pg(),Pe=ce.get("selectMode")==="true",le=ce.get("returnTo"),n=ce.get("existingStops"),tt=!!J&&!me,ke=!!ue&&!!me,[Rt,ut]=Ft.useState([]),[bt,rn]=Ft.useState(null),[on,Vi]=Ft.useState(!1),[Wi,Tn]=Ft.useState(null),[Ci,Ji]=Ft.useState(null),[Vn,Oi]=Ft.useState(!1),[Hn,qi]=Ft.useState(null),[Ot,Vt]=Ft.useState([]),[Hi,dn]=Ft.useState(null),[Ui,an]=Ft.useState(!1),Hr=new Date,Qr=Hr.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),ui=Hr.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});Ft.useEffect(()=>{$A().then(ut).catch(jt=>{console.error("Failed to load stops",jt),ut([])})},[]),Ft.useEffect(()=>{Vt(pv())},[]),Ft.useEffect(()=>{if(!tt){rn(null),Tn(null),Vi(!1);return}Vi(!0),Tn(null),fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/routes/${J}`).then(jt=>{if(!jt.ok)throw new Error(`Failed to load route ${J}`);return jt.json()}).then(jt=>{rn(jt)}).catch(jt=>{console.error(jt),Tn(jt.message||"Error loading route")}).finally(()=>{Vi(!1)})},[tt,J]),Ft.useEffect(()=>{if(!ke){Ji(null),qi(null),Oi(!1);return}Oi(!0),qi(null),Ji(null),fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/predictions/${ue}`).then(jt=>{if(!jt.ok)throw new Error("Failed to load tracking info");return jt.json()}).then(jt=>{const ln=(jt.results||[]).find(Jn=>String(Jn.vehicle_id)===String(me));if(!ln)throw new Error("Bus not found at this stop (it may have departed)");Ji(ln)}).catch(jt=>{console.error(jt),qi(jt.message||"Error loading tracking data")}).finally(()=>{Oi(!1)})},[ke,ue,me]);const Si=Ft.useMemo(()=>{if(!Ci)return null;const jt=Array.isArray(Ci.polyline)&&Ci.polyline.length>0?Ci.polyline:Array.isArray(Ci.waypoints)&&Ci.waypoints.length>0?Ci.waypoints:null;return jt?{type:"Feature",geometry:{type:"LineString",coordinates:jt.map(ln=>[Number(ln.lon),Number(ln.lat)])},properties:{}}:null},[Ci]),yn=Ft.useMemo(()=>!Ci||!Ci.vehicle_lat||!Ci.vehicle_lon?null:{longitude:Number(Ci.vehicle_lon),latitude:Number(Ci.vehicle_lat)},[Ci]),Rn=Ft.useMemo(()=>{const jt=Ot.filter(ai=>ai.enabled!==!1);return jt.length===0?null:{type:"FeatureCollection",features:jt.map(ai=>QA(ai.center.lat,ai.center.lon,ai.radiusMeters,ai.id,ai.stopId))}},[Ot]),wr=()=>{const jt=window.prompt("Enter stop ID to auto-open when inside this circle:",ue||"");if(!jt)return;const ai=window.prompt("Enter radius in meters for this SmartLaunch circle:","200"),ln=Number(ai),Jn=Number.isFinite(ln)&&ln>0?ln:200,_r=Hi||{lat:43.0731,lon:-89.4012},Mr={id:String(Date.now()),name:`SmartLaunch for stop ${jt}`,stopId:jt,center:_r,radiusMeters:Jn,enabled:!0};Vt(pr=>{const Cn=[...pr,Mr];return $y(Cn),Cn})},Tt=jt=>{if(!Pe||!le){Me(`/stop/${jt}`);return}const ai=n?n.split(","):[];if(ai.includes(jt)){alert(`Stop ${jt} is already added to your group!`);return}ai.push(jt);const[ln]=le.split("?"),[Jn,..._r]=ai,Mr=_r.length>0?`?stops=${_r.join(",")}`:"";Me(`${ln}${Mr}`)};return Ae.jsx("main",{className:"home-root",children:Ae.jsxs("div",{className:"home-phone",children:[Ae.jsxs("header",{className:"home-header",children:[Ae.jsxs("div",{className:"home-header-top",children:[Ae.jsxs(Ih,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[Ae.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),Ae.jsxs("div",{className:"home-wordmark",children:[Ae.jsx("div",{className:"home-logo-text-main",children:"badger"}),Ae.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),Ae.jsxs("div",{className:"home-clock","aria-live":"off",children:[Ae.jsx("div",{className:"home-clock-date",children:ui}),Ae.jsx("div",{className:"home-clock-time",children:Qr})]})]}),Ae.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[Ae.jsx(nl,{to:"/",end:!0,className:({isActive:jt})=>`home-nav-tab${jt?" home-nav-tab--active":""}`,children:"Home"}),Ae.jsx(nl,{to:"/recent",className:({isActive:jt})=>`home-nav-tab${jt?" home-nav-tab--active":""}`,children:"Recent"}),Ae.jsx(nl,{to:"/map",className:({isActive:jt})=>`home-nav-tab${jt?" home-nav-tab--active":""}`,children:"Map"}),Ae.jsx(nl,{to:"/routes",className:({isActive:jt})=>`home-nav-tab${jt?" home-nav-tab--active":""}`,children:"Routes"})]})]}),Pe&&Ae.jsx("div",{className:"map-overlay map-select-mode",role:"alert","aria-live":"polite",children:Ae.jsxs("div",{className:"map-select-banner",children:[Ae.jsx("span",{children:" Select a stop to add to your group"}),Ae.jsx("button",{onClick:()=>Me(le),className:"map-select-cancel","aria-label":"Cancel stop selection",children:"Cancel"})]})}),tt&&on&&Ae.jsxs("div",{className:"map-overlay",role:"status","aria-live":"polite",children:["Loading route ",J,""]}),tt&&Wi&&Ae.jsx("div",{className:"map-overlay map-overlay-error",role:"alert","aria-live":"assertive",children:Wi}),ke&&Vn&&Ae.jsxs("div",{className:"map-overlay",role:"status","aria-live":"polite",children:["Tracking bus ",me," from stop ",ue,""]}),ke&&Hn&&Ae.jsx("div",{className:"map-overlay map-overlay-error",role:"alert","aria-live":"assertive",children:Hn}),Ae.jsxs("section",{className:"map-page-main","aria-labelledby":"map-title",children:[Ae.jsx("h1",{id:"map-title",className:"visually-hidden",children:ke?`Tracking bus ${me} from stop ${ue}`:tt?`Route ${J} map view`:Pe?"Select a stop to add to group":"Transit map view"}),Ae.jsxs("div",{className:"map-page-map-wrapper",children:[Ae.jsx(aw,{onLoad:()=>an(!0),onMapClick:jt=>{if(!jt?.lngLat)return;const{lat:ai,lng:ln}=jt.lngLat;dn({lat:ai,lon:ln})},"aria-label":"Interactive transit map showing bus stops and routes",children:Ui&&Ae.jsxs(Ae.Fragment,{children:[Ae.jsx(PA,{stops:Rt,onStopClick:Tt,selectMode:Pe}),tt&&bt&&Ae.jsx(UA,{routeData:bt}),tt&&J&&Ae.jsx(NA,{routeId:J}),ke&&Si&&Ae.jsx(v1,{id:"tracked-bus-line",type:"geojson",data:Si,children:Ae.jsx(iv,{id:"tracked-bus-line-layer",type:"line",paint:{"line-color":"#ff0000","line-width":4}})}),ke&&yn&&Ae.jsx(rw,{longitude:yn.longitude,latitude:yn.latitude,anchor:"center",children:Ae.jsx("div",{className:"tracked-bus-marker",role:"img","aria-label":`Bus ${me} current location`,children:""})}),Rn&&Ae.jsxs(v1,{id:"smartlaunch-circles",type:"geojson",data:Rn,children:[Ae.jsx(iv,{id:"smartlaunch-fill",type:"fill",paint:{"fill-color":"#0000ff","fill-opacity":.12}}),Ae.jsx(iv,{id:"smartlaunch-outline",type:"line",paint:{"line-color":"#0000ff","line-width":2}})]})]})}),Ae.jsx("button",{type:"button",className:"map-page-back-btn",onClick:()=>Me(-1),"aria-label":"Go back to previous page",children:""}),Ae.jsx("button",{type:"button",className:"map-page-center-btn","aria-label":"Center map on your location",children:""}),Ae.jsx("button",{type:"button",className:"map-page-locate-btn","aria-label":"Show your current location",children:""}),!Pe&&Ae.jsx("button",{type:"button",className:"map-smartlaunch-btn",onClick:wr,"aria-label":"Create SmartLaunch rule at current map location",children:"+ SmartLaunch here"})]}),ke&&Ci&&Ae.jsxs("section",{className:"map-track-card","aria-labelledby":"tracking-title",children:[Ae.jsx("h2",{id:"tracking-title",className:"visually-hidden",children:"Currently Tracking Bus"}),Ae.jsx(JA,{pred:Ci})]})]}),Ae.jsxs("footer",{className:"home-footer",children:[Ae.jsxs("div",{className:"home-footer-left",children:[Ae.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),Ae.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),Ae.jsxs("div",{className:"home-footer-links",children:[Ae.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),Ae.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),Ae.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}const eI={A:"#FF0000",A1:"#FF0000",A2:"#FF0000",B:"#84BC00",F:"#0039AA",80:"#FF7300",81:"#FF7300",82:"#00B7C8",84:"#C1C800",C:"#00B7C8",D:"#FFA600",D1:"#FFA600",D2:"#FFA600",E:"#C1C800",G:"#00B7C8",H:"#C1C800",J:"#C1C800",L:"#9269EB",O:"#BC009D",P:"#C1C800",R:"#BC009D",R1:"#BC009D",R2:"#BC009D",S:"#C1C800",W:"#9269EB",28:"#0039AA",38:"#FF7300",55:"#FFA600",60:"#9269EB",61:"#9269EB",62:"#FFA600",63:"#9269EB",64:"#FF7300",65:"#BC009D",75:"#9269EB"};function mw(J){return eI[J]||"#000000"}function _w(J){if(!J)return"";const[,ue]=J.split(" ");if(!ue)return"";const[me,ce]=ue.split(":"),Me=new Date;return Me.setHours(Number(me),Number(ce),0,0),Me.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}function gw(J){if(J.dyn===4)return"Drop offs only";if(J.stops_away!=null){const ue=J.stops_away;return`${ue} stop${ue===1?"":"s"} away`}if(Array.isArray(J.stops_between)&&J.stops_between.length>0){const ue=J.stops_between.length;return`${ue} stop${ue===1?"":"s"} away`}return J.stops_away===0?"Approaching Stop":J.eta_minutes<=1?"At Stop":J.stops_away===null?"En Route":"Many Stops Away"}function tI(J){return J==="N/A"?5:J==="EMPTY"?1:J==="HALF_EMPTY"?3:J==="FULL"?5:0}function iI(J){return J==="N/A"?"Unknown occupancy":J==="EMPTY"?"Empty":J==="HALF_EMPTY"?"Half full":J==="FULL"?"Full":"Unknown occupancy"}function nI({pred:J,onTrack:ue,stopName:me}){const ce=_w(J.predicted_time),Me=gw(J),Pe=tI(J.occupancy||""),le=iI(J.occupancy||"");return Ae.jsxs("article",{className:"bus-card","aria-label":`Route ${J.route} to ${J.destination}, arriving in ${J.eta_minutes} minutes${me?` at ${me}`:""}`,children:[Ae.jsx("div",{className:"bus-card-route",style:{backgroundColor:mw(J.route)},"aria-label":`Route ${J.route}`,children:J.route}),Ae.jsxs("div",{className:"bus-card-main",children:[Ae.jsxs("div",{className:"bus-card-left",children:[Ae.jsxs("div",{className:"bus-card-top",children:[Ae.jsx("div",{className:"bus-card-destination",children:J.destination}),Ae.jsx("div",{className:"bus-card-times",children:Ae.jsx("div",{className:"bus-card-eta","aria-label":`Estimated arrival: ${J.eta_minutes} minutes`,children:J.eta_minutes!=null?`${J.eta_minutes} min`:"--"})})]}),Ae.jsxs("div",{className:"bus-card-bottom",children:[Ae.jsxs("div",{className:"bus-card-occupancy",children:[Ae.jsx("div",{className:"bus-card-dots","aria-label":le,children:Array.from({length:5}).map((n,tt)=>Ae.jsx("span",{className:"occ-dot"+(tt<Pe?" occ-dot-filled":""),"aria-hidden":"true"},tt))}),Ae.jsxs("span",{className:"bus-card-sub",children:[Me,me&&`  at ${me}`]})]}),Ae.jsx("div",{className:"bus-card-clock",children:ce})]})]}),Ae.jsx("div",{className:"bus-card-right",children:Ae.jsx("button",{className:"bus-card-track",type:"button",onClick:ue,disabled:!ue,"aria-label":`Track bus ${J.vehicle_id||""} on route ${J.route}`,children:"Track"})})]})]})}function rI({pred:J,stopName:ue}){const me=_w(J.predicted_time);return Ae.jsxs("article",{className:"bus-card-short","aria-label":`Route ${J.route} to ${J.destination}, arriving in ${J.eta_minutes} minutes, too far to track${ue?` at ${ue}`:""}`,children:[Ae.jsx("div",{className:"bus-card-route",style:{backgroundColor:mw(J.route)},"aria-label":`Route ${J.route}`,children:J.route}),Ae.jsxs("div",{className:"bus-card-main",children:[Ae.jsxs("div",{className:"bus-card-left",children:[Ae.jsxs("div",{className:"bus-card-top",children:[Ae.jsx("div",{className:"bus-card-destination",children:J.destination}),Ae.jsx("div",{className:"bus-card-times",children:Ae.jsx("div",{className:"bus-card-eta","aria-label":`Estimated arrival: ${J.eta_minutes} minutes`,children:J.eta_minutes!=null?`${J.eta_minutes} min`:"--"})})]}),Ae.jsxs("div",{className:"bus-card-bottom",children:[Ae.jsx("div",{className:"bus-card-occupancy",children:Ae.jsxs("span",{className:"bus-card-sub",children:["This bus is too far to track",ue&&`  at ${ue}`]})}),Ae.jsx("div",{className:"bus-card-clock",children:me})]})]}),Ae.jsx("div",{className:"bus-card-right",children:Ae.jsx("div",{className:"bus-card-track-short","aria-hidden":"true",children:"--------"})})]})]})}function aI(){const{stopId:J}=j1(),[ue]=Y1(),me=pg(),ce=ue.get("stops"),Me=ce?ce.split(",").filter(Boolean):[],Pe=[J,...Me],le=Pe.length>1,[n,tt]=Ft.useState({}),[ke,Rt]=Ft.useState(!0),[ut,bt]=Ft.useState(null);Ft.useEffect(()=>{Pe.length!==0&&(Rt(!0),bt(null),Promise.all(Pe.map(Oi=>fetch(`https://badger-transit-dawn-darkness-55.fly.dev/api/predictions/${Oi}`).then(Hn=>{if(!Hn.ok)throw new Error(`Failed to load stop ${Oi}`);return Hn.json()}).then(Hn=>({stopId:Oi,results:Hn.results||[]})))).then(Oi=>{const Hn={};Oi.forEach(({stopId:qi,results:Ot})=>{Hn[qi]=Ot.sort((Vt,Hi)=>(Vt.eta_minutes??9999)-(Hi.eta_minutes??9999))}),tt(Hn)}).catch(Oi=>{console.error(Oi),bt(Oi.message||"Error loading predictions")}).finally(()=>Rt(!1)))},[Pe.join(",")]);const rn=new Date,on=rn.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),Vi=rn.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"}),Wi=Oi=>Oi==="10070"?"W Johnson at East Campus":`Stop ${Oi}`;Ft.useEffect(()=>{if(J)try{const Oi="bt_recent_stops",Hn=localStorage.getItem(Oi);let qi=[];if(Hn)try{qi=JSON.parse(Hn),Array.isArray(qi)||(qi=[])}catch{qi=[]}qi=qi.filter(Ot=>Ot.stopId!==J),qi.unshift({stopId:J,name:Wi(J),lastVisited:new Date().toISOString()}),qi=qi.slice(0,10),localStorage.setItem(Oi,JSON.stringify(qi))}catch(Oi){console.error("Failed to persist recent stop",Oi)}},[J]);const Tn=()=>{const Oi=Pe.join(",");me(`/map?selectMode=true&returnTo=/stop/${J}&existingStops=${Oi}`)},Ci=()=>{try{const Oi="bt_saved_stops",Hn=localStorage.getItem(Oi);let qi=[];if(Hn)try{qi=JSON.parse(Hn),Array.isArray(qi)||(qi=[])}catch{qi=[]}const Ot=le?window.prompt("Name this stop group:",`Group ${qi.length+1}`):window.prompt("Name this stop:",Wi(J));if(!Ot)return;const Vt={id:`saved_${Date.now()}`,name:Ot,stopIds:Pe,isGroup:le,savedAt:new Date().toISOString()};qi.unshift(Vt),localStorage.setItem(Oi,JSON.stringify(qi)),me("/saved")}catch(Oi){console.error("Failed to save stop",Oi),alert("Failed to save stop. Please try again.")}},Ji=Oi=>{const Hn=Pe.filter(Hi=>Hi!==Oi);if(Hn.length===0){me("/");return}const[qi,...Ot]=Hn,Vt=Ot.length>0?`?stops=${Ot.join(",")}`:"";me(`/stop/${qi}${Vt}`)},Vn=[];return Object.keys(n).forEach(Oi=>{(n[Oi]||[]).forEach(qi=>{Vn.push({...qi,sourceStopId:Oi,sourceStopName:Wi(Oi)})})}),Vn.sort((Oi,Hn)=>(Oi.eta_minutes??9999)-(Hn.eta_minutes??9999)),le?`${Pe.length}${Pe.map(Wi).join(", ")}`:`${J}${Wi(J)}`,Ae.jsx("main",{className:"stop-root",children:Ae.jsxs("div",{className:"stop-inner",children:[Ae.jsxs("header",{className:"home-header",children:[Ae.jsxs("div",{className:"home-header-top",children:[Ae.jsxs(Ih,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[Ae.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),Ae.jsxs("div",{className:"home-wordmark",children:[Ae.jsx("div",{className:"home-logo-text-main",children:"badger"}),Ae.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),Ae.jsxs("div",{className:"home-clock","aria-live":"off",children:[Ae.jsx("div",{className:"home-clock-date",children:Vi}),Ae.jsx("div",{className:"home-clock-time",children:on})]})]}),Ae.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[Ae.jsx(nl,{to:"/",end:!0,className:({isActive:Oi})=>`home-nav-tab${Oi?" home-nav-tab--active":""}`,children:"Home"}),Ae.jsx(nl,{to:"/recent",className:({isActive:Oi})=>`home-nav-tab${Oi?" home-nav-tab--active":""}`,children:"Recent"}),Ae.jsx(nl,{to:"/map",className:({isActive:Oi})=>`home-nav-tab${Oi?" home-nav-tab--active":""}`,children:"Map"}),Ae.jsx(nl,{to:"/routes",className:({isActive:Oi})=>`home-nav-tab${Oi?" home-nav-tab--active":""}`,children:"Routes"})]})]}),Ae.jsxs("section",{className:"stop-header-bar","aria-labelledby":"stop-title",children:[Ae.jsxs("div",{className:"stop-header-left",children:[Ae.jsx("button",{className:"stop-header-circle",type:"button",onClick:()=>me(-1),"aria-label":"Go back to previous page",children:""}),Ae.jsxs("div",{className:"stop-header-text",children:[Ae.jsx("h1",{id:"stop-title",className:"stop-header-title",children:le?`${Pe.length} Stops`:`Stop #${J}`}),Ae.jsx("div",{className:"stop-header-subtitle",children:le?Pe.map(Wi).join("  "):Wi(J)})]})]}),Ae.jsxs("div",{className:"stop-header-actions",children:[Ae.jsx("button",{className:"stop-add-btn",type:"button",onClick:Tn,"aria-label":"Add another stop to this view",children:"+ Add stop"}),Ae.jsx("button",{className:"stop-save-btn",type:"button",onClick:Ci,"aria-label":le?"Save this group of stops":"Save this stop",children:le?"Save Group":"Save Stop"})]})]}),le&&Ae.jsx("section",{className:"stop-chips","aria-label":"Selected stops",children:Pe.map(Oi=>Ae.jsxs("div",{className:"stop-chip",children:[Ae.jsxs("span",{children:["Stop ",Oi]}),Ae.jsx("button",{type:"button",onClick:()=>Ji(Oi),className:"stop-chip-remove","aria-label":`Remove stop ${Oi} from this group`,children:""})]},Oi))}),Ae.jsxs("div",{className:"stop-label-row",role:"presentation",children:[Ae.jsx("span",{children:"Route"}),Ae.jsx("span",{children:"Bus Info"})]}),Ae.jsxs("section",{className:"stop-cards","aria-labelledby":"upcoming-buses-title",children:[Ae.jsx("h2",{id:"upcoming-buses-title",className:"visually-hidden",children:"Upcoming Buses"}),ke&&Ae.jsx("div",{className:"stop-loading",role:"status","aria-live":"polite",children:"Loading buses"}),ut&&Ae.jsx("div",{className:"stop-error",role:"alert","aria-live":"assertive",children:ut}),!ke&&!ut&&Vn.length===0&&Ae.jsxs("div",{className:"stop-empty",role:"status",children:["No upcoming buses at ",le?"these stops":"this stop","."]}),!ke&&!ut&&Vn.map(Oi=>{const qi=gw(Oi)==="En Route",Ot=`${Oi.sourceStopId}-${Oi.trip_uid||Oi.route}-${Oi.predicted_time}`,Vt=()=>{Oi.vehicle_id&&me(`/map/${Oi.sourceStopId}/${Oi.vehicle_id}`)},Hi=le?Oi.sourceStopName:null;return qi?Ae.jsx(rI,{pred:Oi,stopName:Hi},Ot):Ae.jsx(nI,{pred:Oi,onTrack:Oi.vehicle_id?Vt:void 0,stopName:Hi},Ot)})]}),Ae.jsx("div",{className:"stop-end-label",role:"separator",children:"End of Bus Information"}),Ae.jsxs("section",{className:"stop-report-card",children:[Ae.jsx("div",{className:"stop-report-icon","aria-hidden":"true"}),Ae.jsxs("span",{children:["Report an issue at ",le?"these stops":"this bus stop"]})]}),Ae.jsxs("footer",{className:"home-footer routes-footer",children:[Ae.jsxs("div",{className:"home-footer-left",children:[Ae.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),Ae.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),Ae.jsxs("div",{className:"home-footer-links",children:[Ae.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),Ae.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),Ae.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}const sI="bt_recent_stops";function A1(J){if(!J)return"";const ue=new Date(J);if(Number.isNaN(ue.getTime()))return"";const me=ue.toLocaleDateString([],{month:"short",day:"numeric"}),ce=ue.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return`${me}  ${ce}`}function oI(){const[J,ue]=Ft.useState([]);Ft.useEffect(()=>{if(!(typeof window>"u"))try{const Pe=localStorage.getItem(sI);if(!Pe){ue([]);return}let le=JSON.parse(Pe);Array.isArray(le)||(le=[]),le.sort((n,tt)=>{const ke=new Date(n.lastVisited||0).getTime();return new Date(tt.lastVisited||0).getTime()-ke}),ue(le)}catch(Pe){console.error("Failed to read recent stops",Pe),ue([])}},[]);const me=new Date,ce=me.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),Me=me.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return Ae.jsx("main",{className:"stop-root",children:Ae.jsxs("div",{className:"stop-inner",children:[Ae.jsxs("header",{className:"home-header",children:[Ae.jsxs("div",{className:"home-header-top",children:[Ae.jsxs(Ih,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[Ae.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),Ae.jsxs("div",{className:"home-wordmark",children:[Ae.jsx("div",{className:"home-logo-text-main",children:"badger"}),Ae.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),Ae.jsxs("div",{className:"home-clock","aria-live":"off",children:[Ae.jsx("div",{className:"home-clock-date",children:Me}),Ae.jsx("div",{className:"home-clock-time",children:ce})]})]}),Ae.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[Ae.jsx(nl,{to:"/",end:!0,className:({isActive:Pe})=>`home-nav-tab${Pe?" home-nav-tab--active":""}`,children:"Home"}),Ae.jsx(nl,{to:"/recent",className:({isActive:Pe})=>`home-nav-tab${Pe?" home-nav-tab--active":""}`,children:"Recent"}),Ae.jsx(nl,{to:"/map",className:({isActive:Pe})=>`home-nav-tab${Pe?" home-nav-tab--active":""}`,children:"Map"}),Ae.jsx(nl,{to:"/routes",className:({isActive:Pe})=>`home-nav-tab${Pe?" home-nav-tab--active":""}`,children:"Routes"})]})]}),Ae.jsx("section",{className:"stop-header-bar","aria-labelledby":"recent-title",children:Ae.jsx("div",{className:"stop-header-left",children:Ae.jsxs("div",{className:"stop-header-text",children:[Ae.jsx("h1",{id:"recent-title",className:"stop-header-title",children:"Recent stops"}),Ae.jsx("div",{className:"stop-header-subtitle",children:"Stops you've viewed recently"})]})})}),Ae.jsxs("div",{className:"stop-label-row",role:"presentation",children:[Ae.jsx("span",{children:"Stop"}),Ae.jsx("span",{children:"Last visited"})]}),Ae.jsxs("section",{className:"stop-cards","aria-labelledby":"recent-stops-list",children:[Ae.jsx("h2",{id:"recent-stops-list",className:"visually-hidden",children:"Recently Visited Stops"}),J.length===0&&Ae.jsx("div",{className:"stop-empty",role:"status",children:"You haven't viewed any stops yet."}),J.map(Pe=>Ae.jsx(Ih,{to:`/stop/${Pe.stopId}`,className:"recent-stop-link","aria-label":`View stop ${Pe.stopId}, ${Pe.name||`Stop ${Pe.stopId}`}, last visited ${A1(Pe.lastVisited)}`,children:Ae.jsxs("article",{className:"bus-card",children:[Ae.jsx("div",{className:"bus-card-route",style:{backgroundColor:"#111827"},"aria-label":`Stop ${Pe.stopId}`,children:Pe.stopId}),Ae.jsxs("div",{className:"bus-card-main",children:[Ae.jsxs("div",{className:"bus-card-left",children:[Ae.jsxs("div",{className:"bus-card-top",children:[Ae.jsx("div",{className:"bus-card-destination",children:Pe.name||`Stop ${Pe.stopId}`}),Ae.jsx("div",{className:"bus-card-times",children:Ae.jsx("div",{className:"bus-card-eta",children:A1(Pe.lastVisited)})})]}),Ae.jsxs("div",{className:"bus-card-bottom",children:[Ae.jsxs("div",{className:"bus-card-occupancy",children:[Ae.jsx("div",{className:"bus-card-dots","aria-hidden":"true",children:Array.from({length:5}).map((le,n)=>Ae.jsx("span",{className:"occ-dot"},n))}),Ae.jsx("span",{className:"bus-card-sub",children:"Tap to view arrivals"})]}),Ae.jsx("div",{className:"bus-card-clock"})]})]}),Ae.jsx("div",{className:"bus-card-right",children:Ae.jsx("span",{className:"bus-card-track-label","aria-hidden":"true",children:"View stop"})})]})]})},Pe.stopId))]}),Ae.jsxs("footer",{className:"home-footer routes-footer",children:[Ae.jsxs("div",{className:"home-footer-left",children:[Ae.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),Ae.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),Ae.jsxs("div",{className:"home-footer-links",children:[Ae.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),Ae.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),Ae.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}function I1(J,ue){const me=40075016686e-3,ce=ue*Math.PI/180;return Math.cos(ce)*me/Math.pow(2,J+8)}function lI(){const[J,ue]=Ft.useState([]),[me,ce]=Ft.useState(!1),[Me,Pe]=Ft.useState(null),[le,n]=Ft.useState(""),[tt,ke]=Ft.useState(""),[Rt,ut]=Ft.useState("07:00"),[bt,rn]=Ft.useState("12:00"),[on,Vi]=Ft.useState({longitude:-89.4012,latitude:43.0731,zoom:15}),Wi=80;Ft.useEffect(()=>{ue(pv())},[]);const Tn=()=>{ke(""),ut("07:00"),rn("12:00"),n(""),Vi({longitude:-89.4012,latitude:43.0731,zoom:15})},Ci=()=>{ce(!0),Pe(null),Tn()},Ji=Ui=>{ce(!0),Pe(Ui.id),ke(Ui.stopId??""),ut(Ui.startTime??"07:00"),rn(Ui.endTime??"12:00"),n(""),Vi(an=>({...an,longitude:Ui.center?.lon??an.longitude,latitude:Ui.center?.lat??an.latitude,zoom:an.zoom??15}))},Vn=()=>{ce(!1),Pe(null),n("")},Oi=Ui=>{if(Ui.preventDefault(),!tt.trim()){n("Please enter a stop ID.");return}const an=on.latitude,Hr=on.longitude,ui=I1(on.zoom,an)*Wi,Si={name:`SmartLaunch for stop ${tt.trim()}`,stopId:tt.trim(),center:{lat:an,lon:Hr},radiusMeters:ui,startTime:Rt||null,endTime:bt||null};let yn;if(Me)yn=J.map(Rn=>Rn.id===Me?{...Rn,...Si}:Rn);else{const Rn={id:String(Date.now()),enabled:!0,...Si};yn=[...J,Rn]}ue(yn),$y(yn),ce(!1),Pe(null),n("")},Hn=Ui=>{const an=J.map(Hr=>Hr.id===Ui?{...Hr,enabled:!Hr.enabled}:Hr);ue(an),$y(an)},qi=Ui=>{const an=J.filter(Hr=>Hr.id!==Ui);ue(an),$y(an),Me===Ui&&(ce(!1),Pe(null))},Ot=!!Me,Vt=new Date,Hi=Vt.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),dn=Vt.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return Ae.jsx("main",{className:"home-root",children:Ae.jsxs("div",{className:"home-phone",children:[Ae.jsxs("header",{className:"home-header",children:[Ae.jsxs("div",{className:"home-header-top",children:[Ae.jsxs(Ih,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[Ae.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),Ae.jsxs("div",{className:"home-wordmark",children:[Ae.jsx("div",{className:"home-logo-text-main",children:"badger"}),Ae.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),Ae.jsxs("div",{className:"home-clock","aria-live":"off",children:[Ae.jsx("div",{className:"home-clock-date",children:dn}),Ae.jsx("div",{className:"home-clock-time",children:Hi})]})]}),Ae.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[Ae.jsx(nl,{to:"/",end:!0,className:({isActive:Ui})=>`home-nav-tab${Ui?" home-nav-tab--active":""}`,children:"Home"}),Ae.jsx(nl,{to:"/recent",className:({isActive:Ui})=>`home-nav-tab${Ui?" home-nav-tab--active":""}`,children:"Recent"}),Ae.jsx(nl,{to:"/map",className:({isActive:Ui})=>`home-nav-tab${Ui?" home-nav-tab--active":""}`,children:"Map"}),Ae.jsx(nl,{to:"/routes",className:({isActive:Ui})=>`home-nav-tab${Ui?" home-nav-tab--active":""}`,children:"Routes"})]})]}),Ae.jsxs("section",{className:"home-hero","aria-labelledby":"smartlaunch-title",children:[Ae.jsx("h1",{id:"smartlaunch-title",className:"home-hero-title",children:"SmartLaunch Automations"}),Ae.jsx("p",{className:"home-notice-body",children:"Automatically open a stop when you're in a specific place and time window."})]}),Ae.jsxs("section",{className:"home-card-grid","aria-labelledby":"existing-rules-title",children:[Ae.jsx("h2",{id:"existing-rules-title",className:"visually-hidden",children:"Your SmartLaunch Automations"}),J.length===0&&Ae.jsx("p",{className:"home-notice-body",role:"status",children:"No SmartLaunch automations yet. Create one below."}),J.map(Ui=>Ae.jsx("article",{className:"home-card smartlaunch-rule-card","aria-label":`SmartLaunch automation for stop ${Ui.stopId}, ${Ui.enabled?"enabled":"disabled"}`,children:Ae.jsxs("div",{className:"smartlaunch-rule-content",children:[Ae.jsx("h3",{className:"home-card-title",children:Ui.name}),Ae.jsxs("dl",{className:"smartlaunch-rule-details",children:[Ae.jsx("dt",{className:"visually-hidden",children:"Stop ID"}),Ae.jsxs("dd",{children:[Ae.jsx("strong",{children:"Stop:"})," ",Ui.stopId]}),Ae.jsx("dt",{className:"visually-hidden",children:"Active time window"}),Ae.jsxs("dd",{children:[Ae.jsx("strong",{children:"Time:"})," ",Ui.startTime&&Ui.endTime?`${Ui.startTime}${Ui.endTime}`:"All day"]}),Ae.jsx("dt",{className:"visually-hidden",children:"Status"}),Ae.jsxs("dd",{children:[Ae.jsx("strong",{children:"Status:"})," ",Ui.enabled?"Enabled":"Disabled"]})]}),Ae.jsxs("div",{className:"smartlaunch-rule-actions",children:[Ae.jsx("button",{type:"button",className:"smartlaunch-action-btn",onClick:()=>Hn(Ui.id),"aria-label":Ui.enabled?`Disable ${Ui.name}`:`Enable ${Ui.name}`,children:Ui.enabled?"Disable":"Enable"}),Ae.jsx("button",{type:"button",className:"smartlaunch-action-btn",onClick:()=>Ji(Ui),"aria-label":`Edit ${Ui.name}`,children:"Edit"}),Ae.jsx("button",{type:"button",className:"smartlaunch-action-btn smartlaunch-delete-btn",onClick:()=>qi(Ui.id),"aria-label":`Delete ${Ui.name}`,children:"Delete"})]})]})},Ui.id))]}),Ae.jsxs("section",{className:"home-notice secondary","aria-labelledby":"create-section-title",children:[Ae.jsx("h2",{id:"create-section-title",className:"visually-hidden",children:me?Ot?"Edit Automation":"Create New Automation":"Create Automation"}),me?Ae.jsxs("form",{onSubmit:Oi,"aria-labelledby":"form-title",children:[Ae.jsx("h3",{id:"form-title",className:"home-notice-title",children:Ot?"Edit SmartLaunch":"Create SmartLaunch"}),le&&Ae.jsx("div",{className:"form-error",role:"alert","aria-live":"assertive",children:le}),Ae.jsxs("div",{className:"form-field",children:[Ae.jsx("label",{htmlFor:"stop-id-input",className:"form-label",children:"Stop ID:"}),Ae.jsx("input",{id:"stop-id-input",type:"text",value:tt,onChange:Ui=>{ke(Ui.target.value),n("")},className:"form-input",required:!0,"aria-required":"true","aria-invalid":le?"true":"false","aria-describedby":le?"stop-id-error":void 0}),le&&Ae.jsx("span",{id:"stop-id-error",className:"visually-hidden",children:le})]}),Ae.jsxs("fieldset",{className:"form-fieldset",children:[Ae.jsx("legend",{className:"form-legend",children:"Active time window"}),Ae.jsxs("div",{className:"form-time-group",children:[Ae.jsxs("div",{className:"form-field",children:[Ae.jsx("label",{htmlFor:"start-time-input",className:"form-label",children:"From:"}),Ae.jsx("input",{id:"start-time-input",type:"time",value:Rt,onChange:Ui=>ut(Ui.target.value),className:"form-input"})]}),Ae.jsxs("div",{className:"form-field",children:[Ae.jsx("label",{htmlFor:"end-time-input",className:"form-label",children:"To:"}),Ae.jsx("input",{id:"end-time-input",type:"time",value:bt,onChange:Ui=>rn(Ui.target.value),className:"form-input"})]})]})]}),Ae.jsx("p",{className:"home-notice-body",children:"Drag and zoom the map so the red circle covers the area where you want this automation to trigger."}),Ae.jsxs("div",{className:"map-container",children:[Ae.jsx(aw,{viewState:on,onMove:Ui=>Vi(Ui.viewState),"aria-label":"Interactive map for setting SmartLaunch trigger location"}),Ae.jsx("div",{className:"smartlaunch-circle-overlay",role:"img","aria-label":`Trigger radius circle, approximately ${Math.round(I1(on.zoom,on.latitude)*Wi)} meters`,style:{width:`${Wi*2}px`,height:`${Wi*2}px`,marginLeft:`-${Wi}px`,marginTop:`-${Wi}px`}})]}),Ae.jsxs("div",{className:"form-actions",children:[Ae.jsx("button",{type:"submit",className:"smartlaunch-action-btn smartlaunch-primary-btn",children:Ot?"Save changes":"Save SmartLaunch"}),Ae.jsx("button",{type:"button",className:"smartlaunch-action-btn",onClick:Vn,children:"Cancel"})]})]}):Ae.jsx("button",{type:"button",className:"smartlaunch-create-btn",onClick:Ci,children:"+ New SmartLaunch"})]}),Ae.jsxs("footer",{className:"home-footer",children:[Ae.jsxs("div",{className:"home-footer-left",children:[Ae.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),Ae.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),Ae.jsxs("div",{className:"home-footer-links",children:[Ae.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),Ae.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),Ae.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}const M1="bt_saved_stops";function C1(J){if(!J)return"";const ue=new Date(J);if(Number.isNaN(ue.getTime()))return"";const me=ue.toLocaleDateString([],{month:"short",day:"numeric"}),ce=ue.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"});return`${me}  ${ce}`}function cI(){const J=pg(),[ue,me]=Ft.useState([]);Ft.useEffect(()=>{if(!(typeof window>"u"))try{const tt=localStorage.getItem(M1);if(!tt){me([]);return}let ke=JSON.parse(tt);Array.isArray(ke)||(ke=[]),ke.sort((Rt,ut)=>{const bt=new Date(Rt.savedAt||0).getTime();return new Date(ut.savedAt||0).getTime()-bt}),me(ke)}catch(tt){console.error("Failed to read saved stops",tt),me([])}},[]);const ce=(tt,ke)=>{if(ke.preventDefault(),ke.stopPropagation(),!!window.confirm("Delete this saved stop/group?"))try{const Rt=ue.filter(ut=>ut.id!==tt);me(Rt),localStorage.setItem(M1,JSON.stringify(Rt))}catch(Rt){console.error("Failed to delete",Rt)}},Me=tt=>{const[ke,...Rt]=tt.stopIds,ut=Rt.length>0?`?stops=${Rt.join(",")}`:"";J(`/stop/${ke}${ut}`)},Pe=new Date,le=Pe.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),n=Pe.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return Ae.jsx("main",{className:"stop-root",children:Ae.jsxs("div",{className:"stop-inner",children:[Ae.jsxs("header",{className:"home-header",children:[Ae.jsxs("div",{className:"home-header-top",children:[Ae.jsxs(Ih,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[Ae.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),Ae.jsxs("div",{className:"home-wordmark",children:[Ae.jsx("div",{className:"home-logo-text-main",children:"badger"}),Ae.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),Ae.jsxs("div",{className:"home-clock","aria-live":"off",children:[Ae.jsx("div",{className:"home-clock-date",children:n}),Ae.jsx("div",{className:"home-clock-time",children:le})]})]}),Ae.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[Ae.jsx(nl,{to:"/",end:!0,className:({isActive:tt})=>`home-nav-tab${tt?" home-nav-tab--active":""}`,children:"Home"}),Ae.jsx(nl,{to:"/recent",className:({isActive:tt})=>`home-nav-tab${tt?" home-nav-tab--active":""}`,children:"Recent"}),Ae.jsx(nl,{to:"/map",className:({isActive:tt})=>`home-nav-tab${tt?" home-nav-tab--active":""}`,children:"Map"}),Ae.jsx(nl,{to:"/routes",className:({isActive:tt})=>`home-nav-tab${tt?" home-nav-tab--active":""}`,children:"Routes"})]})]}),Ae.jsx("section",{className:"stop-header-bar","aria-labelledby":"saved-title",children:Ae.jsx("div",{className:"stop-header-left",children:Ae.jsxs("div",{className:"stop-header-text",children:[Ae.jsx("h1",{id:"saved-title",className:"stop-header-title",children:"Saved stops"}),Ae.jsx("div",{className:"stop-header-subtitle",children:"Your saved stops and groups"})]})})}),Ae.jsxs("div",{className:"stop-label-row",role:"presentation",children:[Ae.jsx("span",{children:"Stop"}),Ae.jsx("span",{children:"Saved"})]}),Ae.jsxs("section",{className:"stop-cards","aria-labelledby":"saved-stops-list",children:[Ae.jsx("h2",{id:"saved-stops-list",className:"visually-hidden",children:"Your Saved Stops and Groups"}),ue.length===0&&Ae.jsx("div",{className:"stop-empty",role:"status",children:"You haven't saved any stops yet."}),ue.map(tt=>Ae.jsxs("article",{className:"bus-card saved-stop-card","aria-label":`${tt.name}, ${tt.isGroup?`group with ${tt.stopIds.length} stops`:`stop ${tt.stopIds[0]}`}, saved on ${C1(tt.savedAt)}`,children:[Ae.jsx("div",{className:"bus-card-route",style:{backgroundColor:tt.isGroup?"#8B5CF6":"#111827",minWidth:tt.isGroup?"60px":"50px",fontSize:tt.isGroup?"12px":"20px"},"aria-label":tt.isGroup?`Group with ${tt.stopIds.length} stops`:`Stop ${tt.stopIds[0]}`,children:tt.isGroup?`${tt.stopIds.length} stops`:tt.stopIds[0]}),Ae.jsxs("div",{className:"bus-card-main",children:[Ae.jsxs("div",{className:"bus-card-left",children:[Ae.jsxs("div",{className:"bus-card-top",children:[Ae.jsxs("div",{className:"bus-card-destination",children:[tt.name,tt.isGroup&&Ae.jsx("span",{className:"group-badge","aria-label":"This is a group",children:"GROUP"})]}),Ae.jsx("div",{className:"bus-card-times",children:Ae.jsx("div",{className:"bus-card-eta",children:C1(tt.savedAt)})})]}),Ae.jsxs("div",{className:"bus-card-bottom",children:[Ae.jsxs("div",{className:"bus-card-occupancy",children:[Ae.jsx("div",{className:"bus-card-dots","aria-hidden":"true",children:Array.from({length:5}).map((ke,Rt)=>Ae.jsx("span",{className:"occ-dot"},Rt))}),Ae.jsx("span",{className:"bus-card-sub",children:tt.isGroup?`Stops: ${tt.stopIds.join(", ")}`:"Tap to view arrivals"})]}),Ae.jsx("div",{className:"bus-card-clock"})]})]}),Ae.jsxs("div",{className:"bus-card-right",children:[Ae.jsx("button",{className:"bus-card-track",type:"button",onClick:ke=>{ke.stopPropagation(),Me(tt)},style:{marginRight:"8px"},"aria-label":`View ${tt.name}`,children:"View"}),Ae.jsx("button",{className:"bus-card-track bus-card-delete",type:"button",onClick:ke=>ce(tt.id,ke),"aria-label":`Delete ${tt.name}`,children:"Delete"})]})]})]},tt.id))]}),Ae.jsxs("footer",{className:"home-footer routes-footer",children:[Ae.jsxs("div",{className:"home-footer-left",children:[Ae.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),Ae.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),Ae.jsxs("div",{className:"home-footer-links",children:[Ae.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),Ae.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),Ae.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026"})]})]})})}function uI(J,ue,me,ce){const Pe=Rt=>Rt*Math.PI/180,le=Pe(me-J),n=Pe(ce-ue),tt=Math.sin(le/2)*Math.sin(le/2)+Math.cos(Pe(J))*Math.cos(Pe(me))*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(tt),Math.sqrt(1-tt)))}function hI(J,ue=new Date){if(!J.startTime||!J.endTime)return!0;const[me,ce]=J.startTime.split(":").map(Number),[Me,Pe]=J.endTime.split(":").map(Number);if(!Number.isFinite(me)||!Number.isFinite(ce)||!Number.isFinite(Me)||!Number.isFinite(Pe))return!0;const le=me*60+ce,n=Me*60+Pe,tt=ue.getHours()*60+ue.getMinutes();return le<=n?tt>=le&&tt<=n:tt>=le||tt<=n}function z1(){const J=pg(),[ue,me]=Ft.useState(null),ce=Ft.useRef(null),Me=Ft.useRef(!1);Ft.useEffect(()=>{const ke=pv().filter(Rt=>Rt.enabled!==!1);if(ke.length!==0&&"geolocation"in navigator)return Me.current=!1,navigator.geolocation.getCurrentPosition(Rt=>{const{latitude:ut,longitude:bt}=Rt.coords,rn=new Date,on=ke.find(Vi=>hI(Vi,rn)?uI(ut,bt,Vi.center.lat,Vi.center.lon)<=Vi.radiusMeters:!1);on&&!Me.current&&(me({stopId:on.stopId,name:on.name||`Stop ${on.stopId}`}),ce.current=window.setTimeout(()=>{Me.current||J(`/stop/${on.stopId}`),ce.current=null},1100))},Rt=>{console.warn("SmartLaunch geolocation failed/denied",Rt)},{enableHighAccuracy:!1,maximumAge:6e4,timeout:1e4}),()=>{Me.current=!0,ce.current&&(window.clearTimeout(ce.current),ce.current=null)}},[J]);const Pe=()=>{Me.current=!0,ce.current&&(window.clearTimeout(ce.current),ce.current=null),me(null)},le=new Date,n=le.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"}),tt=le.toLocaleDateString([],{weekday:"short",month:"short",day:"numeric"});return Ae.jsx("main",{className:"home-root",children:Ae.jsxs("div",{className:"home-phone",children:[ue&&Ae.jsx("div",{className:"smartlaunch-toast",role:"alert","aria-live":"assertive",children:Ae.jsxs("div",{className:"smartlaunch-toast-inner",children:[Ae.jsxs("div",{className:"smartlaunch-toast-icon-circle","aria-hidden":"true",children:[Ae.jsxs("svg",{className:"smartlaunch-progress-svg",viewBox:"0 0 88 88",children:[Ae.jsx("circle",{className:"bg"}),Ae.jsx("circle",{className:"fg"})]}),Ae.jsx("span",{className:"smartlaunch-toast-icon-arrow",children:""})]}),Ae.jsxs("div",{className:"smartlaunch-toast-stop-id",children:["#",ue.stopId]}),Ae.jsx("button",{type:"button",className:"smartlaunch-toast-button",onClick:Pe,"aria-label":`Cancel redirect to stop ${ue.stopId}`,children:"Stop"})]})}),Ae.jsxs("header",{className:"home-header",children:[Ae.jsxs("div",{className:"home-header-top",children:[Ae.jsxs(Ih,{to:"/",className:"home-logo","aria-label":"BadgerTransit Home",children:[Ae.jsx("div",{className:"home-logo-square","aria-hidden":"true"}),Ae.jsxs("div",{className:"home-wordmark",children:[Ae.jsx("div",{className:"home-logo-text-main",children:"badger"}),Ae.jsx("div",{className:"home-logo-text-sub",children:"transit"})]})]}),Ae.jsxs("div",{className:"home-clock","aria-live":"off",children:[Ae.jsx("div",{className:"home-clock-date",children:tt}),Ae.jsx("div",{className:"home-clock-time",children:n})]})]}),Ae.jsxs("nav",{className:"home-nav","aria-label":"Primary navigation",children:[Ae.jsx(nl,{to:"/",end:!0,className:({isActive:ke})=>`home-nav-tab${ke?" home-nav-tab--active":""}`,children:"Home"}),Ae.jsx(nl,{to:"/recent",className:({isActive:ke})=>`home-nav-tab${ke?" home-nav-tab--active":""}`,children:"Recent"}),Ae.jsx(nl,{to:"/map",className:({isActive:ke})=>`home-nav-tab${ke?" home-nav-tab--active":""}`,children:"Map"}),Ae.jsx(nl,{to:"/routes",className:({isActive:ke})=>`home-nav-tab${ke?" home-nav-tab--active":""}`,children:"Routes"})]})]}),Ae.jsx("section",{className:"home-hero","aria-labelledby":"hero-title",children:Ae.jsx("h1",{id:"hero-title",className:"home-hero-title",children:"Select an option to begin tracking"})}),Ae.jsxs("section",{className:"home-card-grid","aria-label":"Quick actions",children:[Ae.jsxs(Ih,{to:"/recent",className:"home-card",children:[Ae.jsx("div",{className:"home-card-icon home-card-icon-star","aria-hidden":"true"}),Ae.jsx("p",{className:"home-card-title",children:"View your recently visited stops"})]}),Ae.jsxs(Ih,{to:"/map",className:"home-card",children:[Ae.jsx("div",{className:"home-card-icon home-card-icon-map","aria-hidden":"true"}),Ae.jsx("p",{className:"home-card-title",children:"Select a stop from MapView"})]}),Ae.jsxs(Ih,{to:"/map",className:"home-card",children:[Ae.jsx("div",{className:"home-card-icon home-card-icon-location","aria-hidden":"true"}),Ae.jsx("p",{className:"home-card-title",children:"See nearby bus stops"})]}),Ae.jsxs(Ih,{to:"/saved",className:"home-card",children:[Ae.jsx("div",{className:"home-card-icon home-card-icon-saved","aria-hidden":"true"}),Ae.jsx("p",{className:"home-card-title",children:"View your saved stops and groups"})]}),Ae.jsxs(Ih,{to:"/routes",className:"home-card",children:[Ae.jsx("div",{className:"home-card-icon home-card-icon-search","aria-hidden":"true"}),Ae.jsx("p",{className:"home-card-title",children:"Search for stop by Stop ID"})]}),Ae.jsxs(Ih,{to:"/routes",className:"home-card",children:[Ae.jsx("div",{className:"home-card-icon home-card-icon-routes","aria-hidden":"true"}),Ae.jsx("p",{className:"home-card-title",children:"See live bus locations by route"})]})]}),Ae.jsx("section",{className:"home-hero","aria-labelledby":"settings-title",children:Ae.jsx("h2",{id:"settings-title",className:"home-hero-title",children:"User Settings"})}),Ae.jsx("section",{className:"home-card-grid","aria-label":"User settings",children:Ae.jsxs(Ih,{to:"/settings",className:"home-card",children:[Ae.jsx("div",{className:"home-card-icon home-card-icon-launch","aria-hidden":"true"}),Ae.jsx("p",{className:"home-card-title",children:"Configure SmartLaunch"})]})}),Ae.jsxs("section",{className:"home-notice","aria-labelledby":"notice-title",children:[Ae.jsx("h2",{id:"notice-title",className:"home-notice-title",children:"Important Notice: BadgerTransit is designed for experienced Madison Transit riders."}),Ae.jsx("p",{className:"home-notice-body",children:"BadgerTransit does not provide navigation. Users are expected to know which bus stops they must board and depart at."})]}),Ae.jsxs("section",{className:"home-notice secondary","aria-labelledby":"about-title",children:[Ae.jsx("h3",{id:"about-title",className:"home-notice-title",children:"BadgerTransit uses an open source Madison API to obtain bus information."}),Ae.jsx("p",{className:"home-notice-body",children:"Designed, coded and used by transit riders in Madison, WI."})]}),Ae.jsxs("footer",{className:"home-footer",children:[Ae.jsxs("div",{className:"home-footer-left",children:[Ae.jsx("div",{className:"home-logo-small-square","aria-hidden":"true"}),Ae.jsx("span",{className:"home-footer-brand",children:"badger transit"})]}),Ae.jsxs("div",{className:"home-footer-links",children:[Ae.jsx("a",{href:"mailto:support@badgertransit.com?subject=Bug Report",className:"home-footer-link",children:"report a bug"}),Ae.jsx("a",{href:"/terms",className:"home-footer-link",children:"terms of service"})]}),Ae.jsx("div",{className:"home-footer-meta",children:"badgertransit 2026 built for CS571"})]})]})})}function dI(){return Ae.jsxs(hE,{children:[Ae.jsx(cm,{path:"/",element:Ae.jsx(z1,{})}),Ae.jsx(cm,{path:"/map",element:Ae.jsx(rv,{})}),Ae.jsx(cm,{path:"/map/:routeId",element:Ae.jsx(rv,{})}),Ae.jsx(cm,{path:"/map/:stopId/:vehicleId",element:Ae.jsx(rv,{})}),Ae.jsx(cm,{path:"/routes",element:Ae.jsx(HE,{})}),Ae.jsx(cm,{path:"/stop/:stopId",element:Ae.jsx(aI,{})}),Ae.jsx(cm,{path:"/recent",element:Ae.jsx(oI,{})}),Ae.jsx(cm,{path:"/saved",element:Ae.jsx(cI,{})}),Ae.jsx(cm,{path:"/settings",element:Ae.jsx(lI,{})}),Ae.jsx(cm,{path:"*",element:Ae.jsx(z1,{})})]})}vS.createRoot(document.getElementById("root")).render(Ae.jsx(fS.StrictMode,{children:Ae.jsx(kE,{basename:"/p87",children:Ae.jsx(dI,{})})}));
